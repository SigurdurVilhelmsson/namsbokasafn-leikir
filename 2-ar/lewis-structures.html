<!DOCTYPE html>
<html lang="is">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Lewis-formúlur | Kvennaskólinn</title>
    <meta name="description" content="Lærðu að teikna Lewis-formúlur og skilja rafeindasamsetningu sameinda" />
    <script type="module" crossorigin>var z$=Object.defineProperty;var G$=(i,e,t)=>e in i?z$(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var Zr=(i,e,t)=>G$(i,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function t(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(r){if(r.ep)return;r.ep=!0;const s=t(r);fetch(r.href,s)}})();function AA(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var PC={exports:{}},Iy={},BC={exports:{}},oi={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var HL;function H$(){if(HL)return oi;HL=1;var i=Symbol.for("react.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),n=Symbol.for("react.strict_mode"),r=Symbol.for("react.profiler"),s=Symbol.for("react.provider"),o=Symbol.for("react.context"),a=Symbol.for("react.forward_ref"),l=Symbol.for("react.suspense"),c=Symbol.for("react.memo"),u=Symbol.for("react.lazy"),h=Symbol.iterator;function f(O){return O===null||typeof O!="object"?null:(O=h&&O[h]||O["@@iterator"],typeof O=="function"?O:null)}var d={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},m=Object.assign,A={};function g(O,K,te){this.props=O,this.context=K,this.refs=A,this.updater=te||d}g.prototype.isReactComponent={},g.prototype.setState=function(O,K){if(typeof O!="object"&&typeof O!="function"&&O!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,O,K,"setState")},g.prototype.forceUpdate=function(O){this.updater.enqueueForceUpdate(this,O,"forceUpdate")};function y(){}y.prototype=g.prototype;function E(O,K,te){this.props=O,this.context=K,this.refs=A,this.updater=te||d}var x=E.prototype=new y;x.constructor=E,m(x,g.prototype),x.isPureReactComponent=!0;var C=Array.isArray,T=Object.prototype.hasOwnProperty,I={current:null},M={key:!0,ref:!0,__self:!0,__source:!0};function L(O,K,te){var q,J={},ie=null,re=null;if(K!=null)for(q in K.ref!==void 0&&(re=K.ref),K.key!==void 0&&(ie=""+K.key),K)T.call(K,q)&&!M.hasOwnProperty(q)&&(J[q]=K[q]);var se=arguments.length-2;if(se===1)J.children=te;else if(1<se){for(var ge=Array(se),xe=0;xe<se;xe++)ge[xe]=arguments[xe+2];J.children=ge}if(O&&O.defaultProps)for(q in se=O.defaultProps,se)J[q]===void 0&&(J[q]=se[q]);return{$$typeof:i,type:O,key:ie,ref:re,props:J,_owner:I.current}}function R(O,K){return{$$typeof:i,type:O.type,key:K,ref:O.ref,props:O.props,_owner:O._owner}}function P(O){return typeof O=="object"&&O!==null&&O.$$typeof===i}function F(O){var K={"=":"=0",":":"=2"};return"$"+O.replace(/[=:]/g,function(te){return K[te]})}var k=/\/+/g;function z(O,K){return typeof O=="object"&&O!==null&&O.key!=null?F(""+O.key):K.toString(36)}function U(O,K,te,q,J){var ie=typeof O;(ie==="undefined"||ie==="boolean")&&(O=null);var re=!1;if(O===null)re=!0;else switch(ie){case"string":case"number":re=!0;break;case"object":switch(O.$$typeof){case i:case e:re=!0}}if(re)return re=O,J=J(re),O=q===""?"."+z(re,0):q,C(J)?(te="",O!=null&&(te=O.replace(k,"$&/")+"/"),U(J,K,te,"",function(xe){return xe})):J!=null&&(P(J)&&(J=R(J,te+(!J.key||re&&re.key===J.key?"":(""+J.key).replace(k,"$&/")+"/")+O)),K.push(J)),1;if(re=0,q=q===""?".":q+":",C(O))for(var se=0;se<O.length;se++){ie=O[se];var ge=q+z(ie,se);re+=U(ie,K,te,ge,J)}else if(ge=f(O),typeof ge=="function")for(O=ge.call(O),se=0;!(ie=O.next()).done;)ie=ie.value,ge=q+z(ie,se++),re+=U(ie,K,te,ge,J);else if(ie==="object")throw K=String(O),Error("Objects are not valid as a React child (found: "+(K==="[object Object]"?"object with keys {"+Object.keys(O).join(", ")+"}":K)+"). If you meant to render a collection of children, use an array instead.");return re}function W(O,K,te){if(O==null)return O;var q=[],J=0;return U(O,q,"","",function(ie){return K.call(te,ie,J++)}),q}function $(O){if(O._status===-1){var K=O._result;K=K(),K.then(function(te){(O._status===0||O._status===-1)&&(O._status=1,O._result=te)},function(te){(O._status===0||O._status===-1)&&(O._status=2,O._result=te)}),O._status===-1&&(O._status=0,O._result=K)}if(O._status===1)return O._result.default;throw O._result}var oe={current:null},X={transition:null},Q={ReactCurrentDispatcher:oe,ReactCurrentBatchConfig:X,ReactCurrentOwner:I};function Y(){throw Error("act(...) is not supported in production builds of React.")}return oi.Children={map:W,forEach:function(O,K,te){W(O,function(){K.apply(this,arguments)},te)},count:function(O){var K=0;return W(O,function(){K++}),K},toArray:function(O){return W(O,function(K){return K})||[]},only:function(O){if(!P(O))throw Error("React.Children.only expected to receive a single React element child.");return O}},oi.Component=g,oi.Fragment=t,oi.Profiler=r,oi.PureComponent=E,oi.StrictMode=n,oi.Suspense=l,oi.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Q,oi.act=Y,oi.cloneElement=function(O,K,te){if(O==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+O+".");var q=m({},O.props),J=O.key,ie=O.ref,re=O._owner;if(K!=null){if(K.ref!==void 0&&(ie=K.ref,re=I.current),K.key!==void 0&&(J=""+K.key),O.type&&O.type.defaultProps)var se=O.type.defaultProps;for(ge in K)T.call(K,ge)&&!M.hasOwnProperty(ge)&&(q[ge]=K[ge]===void 0&&se!==void 0?se[ge]:K[ge])}var ge=arguments.length-2;if(ge===1)q.children=te;else if(1<ge){se=Array(ge);for(var xe=0;xe<ge;xe++)se[xe]=arguments[xe+2];q.children=se}return{$$typeof:i,type:O.type,key:J,ref:ie,props:q,_owner:re}},oi.createContext=function(O){return O={$$typeof:o,_currentValue:O,_currentValue2:O,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},O.Provider={$$typeof:s,_context:O},O.Consumer=O},oi.createElement=L,oi.createFactory=function(O){var K=L.bind(null,O);return K.type=O,K},oi.createRef=function(){return{current:null}},oi.forwardRef=function(O){return{$$typeof:a,render:O}},oi.isValidElement=P,oi.lazy=function(O){return{$$typeof:u,_payload:{_status:-1,_result:O},_init:$}},oi.memo=function(O,K){return{$$typeof:c,type:O,compare:K===void 0?null:K}},oi.startTransition=function(O){var K=X.transition;X.transition={};try{O()}finally{X.transition=K}},oi.unstable_act=Y,oi.useCallback=function(O,K){return oe.current.useCallback(O,K)},oi.useContext=function(O){return oe.current.useContext(O)},oi.useDebugValue=function(){},oi.useDeferredValue=function(O){return oe.current.useDeferredValue(O)},oi.useEffect=function(O,K){return oe.current.useEffect(O,K)},oi.useId=function(){return oe.current.useId()},oi.useImperativeHandle=function(O,K,te){return oe.current.useImperativeHandle(O,K,te)},oi.useInsertionEffect=function(O,K){return oe.current.useInsertionEffect(O,K)},oi.useLayoutEffect=function(O,K){return oe.current.useLayoutEffect(O,K)},oi.useMemo=function(O,K){return oe.current.useMemo(O,K)},oi.useReducer=function(O,K,te){return oe.current.useReducer(O,K,te)},oi.useRef=function(O){return oe.current.useRef(O)},oi.useState=function(O){return oe.current.useState(O)},oi.useSyncExternalStore=function(O,K,te){return oe.current.useSyncExternalStore(O,K,te)},oi.useTransition=function(){return oe.current.useTransition()},oi.version="18.3.1",oi}var QL;function yA(){return QL||(QL=1,BC.exports=H$()),BC.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var VL;function Q$(){if(VL)return Iy;VL=1;var i=yA(),e=Symbol.for("react.element"),t=Symbol.for("react.fragment"),n=Object.prototype.hasOwnProperty,r=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,s={key:!0,ref:!0,__self:!0,__source:!0};function o(a,l,c){var u,h={},f=null,d=null;c!==void 0&&(f=""+c),l.key!==void 0&&(f=""+l.key),l.ref!==void 0&&(d=l.ref);for(u in l)n.call(l,u)&&!s.hasOwnProperty(u)&&(h[u]=l[u]);if(a&&a.defaultProps)for(u in l=a.defaultProps,l)h[u]===void 0&&(h[u]=l[u]);return{$$typeof:e,type:a,key:f,ref:d,props:h,_owner:r.current}}return Iy.Fragment=t,Iy.jsx=o,Iy.jsxs=o,Iy}var WL;function V$(){return WL||(WL=1,PC.exports=Q$()),PC.exports}var Z=V$(),w=yA();const bl=AA(w);var _E={},DC={exports:{}},Ua={},kC={exports:{}},FC={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var jL;function W$(){return jL||(jL=1,(function(i){function e(X,Q){var Y=X.length;X.push(Q);e:for(;0<Y;){var O=Y-1>>>1,K=X[O];if(0<r(K,Q))X[O]=Q,X[Y]=K,Y=O;else break e}}function t(X){return X.length===0?null:X[0]}function n(X){if(X.length===0)return null;var Q=X[0],Y=X.pop();if(Y!==Q){X[0]=Y;e:for(var O=0,K=X.length,te=K>>>1;O<te;){var q=2*(O+1)-1,J=X[q],ie=q+1,re=X[ie];if(0>r(J,Y))ie<K&&0>r(re,J)?(X[O]=re,X[ie]=Y,O=ie):(X[O]=J,X[q]=Y,O=q);else if(ie<K&&0>r(re,Y))X[O]=re,X[ie]=Y,O=ie;else break e}}return Q}function r(X,Q){var Y=X.sortIndex-Q.sortIndex;return Y!==0?Y:X.id-Q.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;i.unstable_now=function(){return s.now()}}else{var o=Date,a=o.now();i.unstable_now=function(){return o.now()-a}}var l=[],c=[],u=1,h=null,f=3,d=!1,m=!1,A=!1,g=typeof setTimeout=="function"?setTimeout:null,y=typeof clearTimeout=="function"?clearTimeout:null,E=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function x(X){for(var Q=t(c);Q!==null;){if(Q.callback===null)n(c);else if(Q.startTime<=X)n(c),Q.sortIndex=Q.expirationTime,e(l,Q);else break;Q=t(c)}}function C(X){if(A=!1,x(X),!m)if(t(l)!==null)m=!0,$(T);else{var Q=t(c);Q!==null&&oe(C,Q.startTime-X)}}function T(X,Q){m=!1,A&&(A=!1,y(L),L=-1),d=!0;var Y=f;try{for(x(Q),h=t(l);h!==null&&(!(h.expirationTime>Q)||X&&!F());){var O=h.callback;if(typeof O=="function"){h.callback=null,f=h.priorityLevel;var K=O(h.expirationTime<=Q);Q=i.unstable_now(),typeof K=="function"?h.callback=K:h===t(l)&&n(l),x(Q)}else n(l);h=t(l)}if(h!==null)var te=!0;else{var q=t(c);q!==null&&oe(C,q.startTime-Q),te=!1}return te}finally{h=null,f=Y,d=!1}}var I=!1,M=null,L=-1,R=5,P=-1;function F(){return!(i.unstable_now()-P<R)}function k(){if(M!==null){var X=i.unstable_now();P=X;var Q=!0;try{Q=M(!0,X)}finally{Q?z():(I=!1,M=null)}}else I=!1}var z;if(typeof E=="function")z=function(){E(k)};else if(typeof MessageChannel<"u"){var U=new MessageChannel,W=U.port2;U.port1.onmessage=k,z=function(){W.postMessage(null)}}else z=function(){g(k,0)};function $(X){M=X,I||(I=!0,z())}function oe(X,Q){L=g(function(){X(i.unstable_now())},Q)}i.unstable_IdlePriority=5,i.unstable_ImmediatePriority=1,i.unstable_LowPriority=4,i.unstable_NormalPriority=3,i.unstable_Profiling=null,i.unstable_UserBlockingPriority=2,i.unstable_cancelCallback=function(X){X.callback=null},i.unstable_continueExecution=function(){m||d||(m=!0,$(T))},i.unstable_forceFrameRate=function(X){0>X||125<X?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):R=0<X?Math.floor(1e3/X):5},i.unstable_getCurrentPriorityLevel=function(){return f},i.unstable_getFirstCallbackNode=function(){return t(l)},i.unstable_next=function(X){switch(f){case 1:case 2:case 3:var Q=3;break;default:Q=f}var Y=f;f=Q;try{return X()}finally{f=Y}},i.unstable_pauseExecution=function(){},i.unstable_requestPaint=function(){},i.unstable_runWithPriority=function(X,Q){switch(X){case 1:case 2:case 3:case 4:case 5:break;default:X=3}var Y=f;f=X;try{return Q()}finally{f=Y}},i.unstable_scheduleCallback=function(X,Q,Y){var O=i.unstable_now();switch(typeof Y=="object"&&Y!==null?(Y=Y.delay,Y=typeof Y=="number"&&0<Y?O+Y:O):Y=O,X){case 1:var K=-1;break;case 2:K=250;break;case 5:K=1073741823;break;case 4:K=1e4;break;default:K=5e3}return K=Y+K,X={id:u++,callback:Q,priorityLevel:X,startTime:Y,expirationTime:K,sortIndex:-1},Y>O?(X.sortIndex=Y,e(c,X),t(l)===null&&X===t(c)&&(A?(y(L),L=-1):A=!0,oe(C,Y-O))):(X.sortIndex=K,e(l,X),m||d||(m=!0,$(T))),X},i.unstable_shouldYield=F,i.unstable_wrapCallback=function(X){var Q=f;return function(){var Y=f;f=Q;try{return X.apply(this,arguments)}finally{f=Y}}}})(FC)),FC}var KL;function j$(){return KL||(KL=1,kC.exports=W$()),kC.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var $L;function K$(){if($L)return Ua;$L=1;var i=yA(),e=j$();function t(p){for(var v="https://reactjs.org/docs/error-decoder.html?invariant="+p,b=1;b<arguments.length;b++)v+="&args[]="+encodeURIComponent(arguments[b]);return"Minified React error #"+p+"; visit "+v+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var n=new Set,r={};function s(p,v){o(p,v),o(p+"Capture",v)}function o(p,v){for(r[p]=v,p=0;p<v.length;p++)n.add(v[p])}var a=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),l=Object.prototype.hasOwnProperty,c=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,u={},h={};function f(p){return l.call(h,p)?!0:l.call(u,p)?!1:c.test(p)?h[p]=!0:(u[p]=!0,!1)}function d(p,v,b,D){if(b!==null&&b.type===0)return!1;switch(typeof v){case"function":case"symbol":return!0;case"boolean":return D?!1:b!==null?!b.acceptsBooleans:(p=p.toLowerCase().slice(0,5),p!=="data-"&&p!=="aria-");default:return!1}}function m(p,v,b,D){if(v===null||typeof v>"u"||d(p,v,b,D))return!0;if(D)return!1;if(b!==null)switch(b.type){case 3:return!v;case 4:return v===!1;case 5:return isNaN(v);case 6:return isNaN(v)||1>v}return!1}function A(p,v,b,D,G,ee,fe){this.acceptsBooleans=v===2||v===3||v===4,this.attributeName=D,this.attributeNamespace=G,this.mustUseProperty=b,this.propertyName=p,this.type=v,this.sanitizeURL=ee,this.removeEmptyString=fe}var g={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(p){g[p]=new A(p,0,!1,p,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(p){var v=p[0];g[v]=new A(v,1,!1,p[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(p){g[p]=new A(p,2,!1,p.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(p){g[p]=new A(p,2,!1,p,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(p){g[p]=new A(p,3,!1,p.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(p){g[p]=new A(p,3,!0,p,null,!1,!1)}),["capture","download"].forEach(function(p){g[p]=new A(p,4,!1,p,null,!1,!1)}),["cols","rows","size","span"].forEach(function(p){g[p]=new A(p,6,!1,p,null,!1,!1)}),["rowSpan","start"].forEach(function(p){g[p]=new A(p,5,!1,p.toLowerCase(),null,!1,!1)});var y=/[\-:]([a-z])/g;function E(p){return p[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(p){var v=p.replace(y,E);g[v]=new A(v,1,!1,p,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(p){var v=p.replace(y,E);g[v]=new A(v,1,!1,p,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(p){var v=p.replace(y,E);g[v]=new A(v,1,!1,p,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(p){g[p]=new A(p,1,!1,p.toLowerCase(),null,!1,!1)}),g.xlinkHref=new A("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(p){g[p]=new A(p,1,!1,p.toLowerCase(),null,!0,!0)});function x(p,v,b,D){var G=g.hasOwnProperty(v)?g[v]:null;(G!==null?G.type!==0:D||!(2<v.length)||v[0]!=="o"&&v[0]!=="O"||v[1]!=="n"&&v[1]!=="N")&&(m(v,b,G,D)&&(b=null),D||G===null?f(v)&&(b===null?p.removeAttribute(v):p.setAttribute(v,""+b)):G.mustUseProperty?p[G.propertyName]=b===null?G.type===3?!1:"":b:(v=G.attributeName,D=G.attributeNamespace,b===null?p.removeAttribute(v):(G=G.type,b=G===3||G===4&&b===!0?"":""+b,D?p.setAttributeNS(D,v,b):p.setAttribute(v,b))))}var C=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,T=Symbol.for("react.element"),I=Symbol.for("react.portal"),M=Symbol.for("react.fragment"),L=Symbol.for("react.strict_mode"),R=Symbol.for("react.profiler"),P=Symbol.for("react.provider"),F=Symbol.for("react.context"),k=Symbol.for("react.forward_ref"),z=Symbol.for("react.suspense"),U=Symbol.for("react.suspense_list"),W=Symbol.for("react.memo"),$=Symbol.for("react.lazy"),oe=Symbol.for("react.offscreen"),X=Symbol.iterator;function Q(p){return p===null||typeof p!="object"?null:(p=X&&p[X]||p["@@iterator"],typeof p=="function"?p:null)}var Y=Object.assign,O;function K(p){if(O===void 0)try{throw Error()}catch(b){var v=b.stack.trim().match(/\n( *(at )?)/);O=v&&v[1]||""}return`
`+O+p}var te=!1;function q(p,v){if(!p||te)return"";te=!0;var b=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(v)if(v=function(){throw Error()},Object.defineProperty(v.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(v,[])}catch(rt){var D=rt}Reflect.construct(p,[],v)}else{try{v.call()}catch(rt){D=rt}p.call(v.prototype)}else{try{throw Error()}catch(rt){D=rt}p()}}catch(rt){if(rt&&D&&typeof rt.stack=="string"){for(var G=rt.stack.split(`
`),ee=D.stack.split(`
`),fe=G.length-1,Ie=ee.length-1;1<=fe&&0<=Ie&&G[fe]!==ee[Ie];)Ie--;for(;1<=fe&&0<=Ie;fe--,Ie--)if(G[fe]!==ee[Ie]){if(fe!==1||Ie!==1)do if(fe--,Ie--,0>Ie||G[fe]!==ee[Ie]){var Ne=`
`+G[fe].replace(" at new "," at ");return p.displayName&&Ne.includes("<anonymous>")&&(Ne=Ne.replace("<anonymous>",p.displayName)),Ne}while(1<=fe&&0<=Ie);break}}}finally{te=!1,Error.prepareStackTrace=b}return(p=p?p.displayName||p.name:"")?K(p):""}function J(p){switch(p.tag){case 5:return K(p.type);case 16:return K("Lazy");case 13:return K("Suspense");case 19:return K("SuspenseList");case 0:case 2:case 15:return p=q(p.type,!1),p;case 11:return p=q(p.type.render,!1),p;case 1:return p=q(p.type,!0),p;default:return""}}function ie(p){if(p==null)return null;if(typeof p=="function")return p.displayName||p.name||null;if(typeof p=="string")return p;switch(p){case M:return"Fragment";case I:return"Portal";case R:return"Profiler";case L:return"StrictMode";case z:return"Suspense";case U:return"SuspenseList"}if(typeof p=="object")switch(p.$$typeof){case F:return(p.displayName||"Context")+".Consumer";case P:return(p._context.displayName||"Context")+".Provider";case k:var v=p.render;return p=p.displayName,p||(p=v.displayName||v.name||"",p=p!==""?"ForwardRef("+p+")":"ForwardRef"),p;case W:return v=p.displayName||null,v!==null?v:ie(p.type)||"Memo";case $:v=p._payload,p=p._init;try{return ie(p(v))}catch{}}return null}function re(p){var v=p.type;switch(p.tag){case 24:return"Cache";case 9:return(v.displayName||"Context")+".Consumer";case 10:return(v._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return p=v.render,p=p.displayName||p.name||"",v.displayName||(p!==""?"ForwardRef("+p+")":"ForwardRef");case 7:return"Fragment";case 5:return v;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return ie(v);case 8:return v===L?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof v=="function")return v.displayName||v.name||null;if(typeof v=="string")return v}return null}function se(p){switch(typeof p){case"boolean":case"number":case"string":case"undefined":return p;case"object":return p;default:return""}}function ge(p){var v=p.type;return(p=p.nodeName)&&p.toLowerCase()==="input"&&(v==="checkbox"||v==="radio")}function xe(p){var v=ge(p)?"checked":"value",b=Object.getOwnPropertyDescriptor(p.constructor.prototype,v),D=""+p[v];if(!p.hasOwnProperty(v)&&typeof b<"u"&&typeof b.get=="function"&&typeof b.set=="function"){var G=b.get,ee=b.set;return Object.defineProperty(p,v,{configurable:!0,get:function(){return G.call(this)},set:function(fe){D=""+fe,ee.call(this,fe)}}),Object.defineProperty(p,v,{enumerable:b.enumerable}),{getValue:function(){return D},setValue:function(fe){D=""+fe},stopTracking:function(){p._valueTracker=null,delete p[v]}}}}function pe(p){p._valueTracker||(p._valueTracker=xe(p))}function ce(p){if(!p)return!1;var v=p._valueTracker;if(!v)return!0;var b=v.getValue(),D="";return p&&(D=ge(p)?p.checked?"true":"false":p.value),p=D,p!==b?(v.setValue(p),!0):!1}function we(p){if(p=p||(typeof document<"u"?document:void 0),typeof p>"u")return null;try{return p.activeElement||p.body}catch{return p.body}}function Ee(p,v){var b=v.checked;return Y({},v,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:b??p._wrapperState.initialChecked})}function ve(p,v){var b=v.defaultValue==null?"":v.defaultValue,D=v.checked!=null?v.checked:v.defaultChecked;b=se(v.value!=null?v.value:b),p._wrapperState={initialChecked:D,initialValue:b,controlled:v.type==="checkbox"||v.type==="radio"?v.checked!=null:v.value!=null}}function Ae(p,v){v=v.checked,v!=null&&x(p,"checked",v,!1)}function Le(p,v){Ae(p,v);var b=se(v.value),D=v.type;if(b!=null)D==="number"?(b===0&&p.value===""||p.value!=b)&&(p.value=""+b):p.value!==""+b&&(p.value=""+b);else if(D==="submit"||D==="reset"){p.removeAttribute("value");return}v.hasOwnProperty("value")?ne(p,v.type,b):v.hasOwnProperty("defaultValue")&&ne(p,v.type,se(v.defaultValue)),v.checked==null&&v.defaultChecked!=null&&(p.defaultChecked=!!v.defaultChecked)}function Te(p,v,b){if(v.hasOwnProperty("value")||v.hasOwnProperty("defaultValue")){var D=v.type;if(!(D!=="submit"&&D!=="reset"||v.value!==void 0&&v.value!==null))return;v=""+p._wrapperState.initialValue,b||v===p.value||(p.value=v),p.defaultValue=v}b=p.name,b!==""&&(p.name=""),p.defaultChecked=!!p._wrapperState.initialChecked,b!==""&&(p.name=b)}function ne(p,v,b){(v!=="number"||we(p.ownerDocument)!==p)&&(b==null?p.defaultValue=""+p._wrapperState.initialValue:p.defaultValue!==""+b&&(p.defaultValue=""+b))}var V=Array.isArray;function de(p,v,b,D){if(p=p.options,v){v={};for(var G=0;G<b.length;G++)v["$"+b[G]]=!0;for(b=0;b<p.length;b++)G=v.hasOwnProperty("$"+p[b].value),p[b].selected!==G&&(p[b].selected=G),G&&D&&(p[b].defaultSelected=!0)}else{for(b=""+se(b),v=null,G=0;G<p.length;G++){if(p[G].value===b){p[G].selected=!0,D&&(p[G].defaultSelected=!0);return}v!==null||p[G].disabled||(v=p[G])}v!==null&&(v.selected=!0)}}function Re(p,v){if(v.dangerouslySetInnerHTML!=null)throw Error(t(91));return Y({},v,{value:void 0,defaultValue:void 0,children:""+p._wrapperState.initialValue})}function Be(p,v){var b=v.value;if(b==null){if(b=v.children,v=v.defaultValue,b!=null){if(v!=null)throw Error(t(92));if(V(b)){if(1<b.length)throw Error(t(93));b=b[0]}v=b}v==null&&(v=""),b=v}p._wrapperState={initialValue:se(b)}}function Fe(p,v){var b=se(v.value),D=se(v.defaultValue);b!=null&&(b=""+b,b!==p.value&&(p.value=b),v.defaultValue==null&&p.defaultValue!==b&&(p.defaultValue=b)),D!=null&&(p.defaultValue=""+D)}function He(p){var v=p.textContent;v===p._wrapperState.initialValue&&v!==""&&v!==null&&(p.value=v)}function it(p){switch(p){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function $e(p,v){return p==null||p==="http://www.w3.org/1999/xhtml"?it(v):p==="http://www.w3.org/2000/svg"&&v==="foreignObject"?"http://www.w3.org/1999/xhtml":p}var ct,pt=(function(p){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(v,b,D,G){MSApp.execUnsafeLocalFunction(function(){return p(v,b,D,G)})}:p})(function(p,v){if(p.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in p)p.innerHTML=v;else{for(ct=ct||document.createElement("div"),ct.innerHTML="<svg>"+v.valueOf().toString()+"</svg>",v=ct.firstChild;p.firstChild;)p.removeChild(p.firstChild);for(;v.firstChild;)p.appendChild(v.firstChild)}});function We(p,v){if(v){var b=p.firstChild;if(b&&b===p.lastChild&&b.nodeType===3){b.nodeValue=v;return}}p.textContent=v}var Mt={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Ft=["Webkit","ms","Moz","O"];Object.keys(Mt).forEach(function(p){Ft.forEach(function(v){v=v+p.charAt(0).toUpperCase()+p.substring(1),Mt[v]=Mt[p]})});function St(p,v,b){return v==null||typeof v=="boolean"||v===""?"":b||typeof v!="number"||v===0||Mt.hasOwnProperty(p)&&Mt[p]?(""+v).trim():v+"px"}function gt(p,v){p=p.style;for(var b in v)if(v.hasOwnProperty(b)){var D=b.indexOf("--")===0,G=St(b,v[b],D);b==="float"&&(b="cssFloat"),D?p.setProperty(b,G):p[b]=G}}var ft=Y({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function be(p,v){if(v){if(ft[p]&&(v.children!=null||v.dangerouslySetInnerHTML!=null))throw Error(t(137,p));if(v.dangerouslySetInnerHTML!=null){if(v.children!=null)throw Error(t(60));if(typeof v.dangerouslySetInnerHTML!="object"||!("__html"in v.dangerouslySetInnerHTML))throw Error(t(61))}if(v.style!=null&&typeof v.style!="object")throw Error(t(62))}}function qe(p,v){if(p.indexOf("-")===-1)return typeof v.is=="string";switch(p){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var At=null;function yt(p){return p=p.target||p.srcElement||window,p.correspondingUseElement&&(p=p.correspondingUseElement),p.nodeType===3?p.parentNode:p}var De=null,Ce=null,_t=null;function vt(p){if(p=Oc(p)){if(typeof De!="function")throw Error(t(280));var v=p.stateNode;v&&(v=W0(v),De(p.stateNode,p.type,v))}}function bt(p){Ce?_t?_t.push(p):_t=[p]:Ce=p}function Pt(){if(Ce){var p=Ce,v=_t;if(_t=Ce=null,vt(p),v)for(p=0;p<v.length;p++)vt(v[p])}}function qt(p,v){return p(v)}function Nt(){}var dn=!1;function Vn(p,v,b){if(dn)return p(v,b);dn=!0;try{return qt(p,v,b)}finally{dn=!1,(Ce!==null||_t!==null)&&(Nt(),Pt())}}function pn(p,v){var b=p.stateNode;if(b===null)return null;var D=W0(b);if(D===null)return null;b=D[v];e:switch(v){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(D=!D.disabled)||(p=p.type,D=!(p==="button"||p==="input"||p==="select"||p==="textarea")),p=!D;break e;default:p=!1}if(p)return null;if(b&&typeof b!="function")throw Error(t(231,v,typeof b));return b}var qn=!1;if(a)try{var Ci={};Object.defineProperty(Ci,"passive",{get:function(){qn=!0}}),window.addEventListener("test",Ci,Ci),window.removeEventListener("test",Ci,Ci)}catch{qn=!1}function as(p,v,b,D,G,ee,fe,Ie,Ne){var rt=Array.prototype.slice.call(arguments,3);try{v.apply(b,rt)}catch(Ct){this.onError(Ct)}}var Nr=!1,ur=null,tr=!1,An=null,vr={onError:function(p){Nr=!0,ur=p}};function Uo(p,v,b,D,G,ee,fe,Ie,Ne){Nr=!1,ur=null,as.apply(vr,arguments)}function he(p,v,b,D,G,ee,fe,Ie,Ne){if(Uo.apply(this,arguments),Nr){if(Nr){var rt=ur;Nr=!1,ur=null}else throw Error(t(198));tr||(tr=!0,An=rt)}}function me(p){var v=p,b=p;if(p.alternate)for(;v.return;)v=v.return;else{p=v;do v=p,(v.flags&4098)!==0&&(b=v.return),p=v.return;while(p)}return v.tag===3?b:null}function ke(p){if(p.tag===13){var v=p.memoizedState;if(v===null&&(p=p.alternate,p!==null&&(v=p.memoizedState)),v!==null)return v.dehydrated}return null}function ue(p){if(me(p)!==p)throw Error(t(188))}function ye(p){var v=p.alternate;if(!v){if(v=me(p),v===null)throw Error(t(188));return v!==p?null:p}for(var b=p,D=v;;){var G=b.return;if(G===null)break;var ee=G.alternate;if(ee===null){if(D=G.return,D!==null){b=D;continue}break}if(G.child===ee.child){for(ee=G.child;ee;){if(ee===b)return ue(G),p;if(ee===D)return ue(G),v;ee=ee.sibling}throw Error(t(188))}if(b.return!==D.return)b=G,D=ee;else{for(var fe=!1,Ie=G.child;Ie;){if(Ie===b){fe=!0,b=G,D=ee;break}if(Ie===D){fe=!0,D=G,b=ee;break}Ie=Ie.sibling}if(!fe){for(Ie=ee.child;Ie;){if(Ie===b){fe=!0,b=ee,D=G;break}if(Ie===D){fe=!0,D=ee,b=G;break}Ie=Ie.sibling}if(!fe)throw Error(t(189))}}if(b.alternate!==D)throw Error(t(190))}if(b.tag!==3)throw Error(t(188));return b.stateNode.current===b?p:v}function _e(p){return p=ye(p),p!==null?Pe(p):null}function Pe(p){if(p.tag===5||p.tag===6)return p;for(p=p.child;p!==null;){var v=Pe(p);if(v!==null)return v;p=p.sibling}return null}var Me=e.unstable_scheduleCallback,Je=e.unstable_cancelCallback,st=e.unstable_shouldYield,lt=e.unstable_requestPaint,Oe=e.unstable_now,Ht=e.unstable_getCurrentPriorityLevel,xt=e.unstable_ImmediatePriority,Et=e.unstable_UserBlockingPriority,Qt=e.unstable_NormalPriority,sn=e.unstable_LowPriority,ln=e.unstable_IdlePriority,vn=null,Dt=null;function Bt(p){if(Dt&&typeof Dt.onCommitFiberRoot=="function")try{Dt.onCommitFiberRoot(vn,p,void 0,(p.current.flags&128)===128)}catch{}}var yn=Math.clz32?Math.clz32:Ai,xn=Math.log,Sn=Math.LN2;function Ai(p){return p>>>=0,p===0?32:31-(xn(p)/Sn|0)|0}var xi=64,Ei=4194304;function Dn(p){switch(p&-p){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return p&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return p&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return p}}function kn(p,v){var b=p.pendingLanes;if(b===0)return 0;var D=0,G=p.suspendedLanes,ee=p.pingedLanes,fe=b&268435455;if(fe!==0){var Ie=fe&~G;Ie!==0?D=Dn(Ie):(ee&=fe,ee!==0&&(D=Dn(ee)))}else fe=b&~G,fe!==0?D=Dn(fe):ee!==0&&(D=Dn(ee));if(D===0)return 0;if(v!==0&&v!==D&&(v&G)===0&&(G=D&-D,ee=v&-v,G>=ee||G===16&&(ee&4194240)!==0))return v;if((D&4)!==0&&(D|=b&16),v=p.entangledLanes,v!==0)for(p=p.entanglements,v&=D;0<v;)b=31-yn(v),G=1<<b,D|=p[b],v&=~G;return D}function zi(p,v){switch(p){case 1:case 2:case 4:return v+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return v+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Bn(p,v){for(var b=p.suspendedLanes,D=p.pingedLanes,G=p.expirationTimes,ee=p.pendingLanes;0<ee;){var fe=31-yn(ee),Ie=1<<fe,Ne=G[fe];Ne===-1?((Ie&b)===0||(Ie&D)!==0)&&(G[fe]=zi(Ie,v)):Ne<=v&&(p.expiredLanes|=Ie),ee&=~Ie}}function Ln(p){return p=p.pendingLanes&-1073741825,p!==0?p:p&1073741824?1073741824:0}function Ri(){var p=xi;return xi<<=1,(xi&4194240)===0&&(xi=64),p}function ls(p){for(var v=[],b=0;31>b;b++)v.push(p);return v}function nr(p,v,b){p.pendingLanes|=v,v!==536870912&&(p.suspendedLanes=0,p.pingedLanes=0),p=p.eventTimes,v=31-yn(v),p[v]=b}function ta(p,v){var b=p.pendingLanes&~v;p.pendingLanes=v,p.suspendedLanes=0,p.pingedLanes=0,p.expiredLanes&=v,p.mutableReadLanes&=v,p.entangledLanes&=v,v=p.entanglements;var D=p.eventTimes;for(p=p.expirationTimes;0<b;){var G=31-yn(b),ee=1<<G;v[G]=0,D[G]=-1,p[G]=-1,b&=~ee}}function ol(p,v){var b=p.entangledLanes|=v;for(p=p.entanglements;b;){var D=31-yn(b),G=1<<D;G&v|p[D]&v&&(p[D]|=v),b&=~G}}var ri=0;function Ul(p){return p&=-p,1<p?4<p?(p&268435455)!==0?16:536870912:4:1}var ku,Qf,Vf,zl,Mh,ba=!1,al=[],zs=null,Fn=null,Ia=null,na=new Map,Gl=new Map,Ma=[],x0="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function hr(p,v){switch(p){case"focusin":case"focusout":zs=null;break;case"dragenter":case"dragleave":Fn=null;break;case"mouseover":case"mouseout":Ia=null;break;case"pointerover":case"pointerout":na.delete(v.pointerId);break;case"gotpointercapture":case"lostpointercapture":Gl.delete(v.pointerId)}}function ll(p,v,b,D,G,ee){return p===null||p.nativeEvent!==ee?(p={blockedOn:v,domEventName:b,eventSystemFlags:D,nativeEvent:ee,targetContainers:[G]},v!==null&&(v=Oc(v),v!==null&&Qf(v)),p):(p.eventSystemFlags|=D,v=p.targetContainers,G!==null&&v.indexOf(G)===-1&&v.push(G),p)}function E0(p,v,b,D,G){switch(v){case"focusin":return zs=ll(zs,p,v,b,D,G),!0;case"dragenter":return Fn=ll(Fn,p,v,b,D,G),!0;case"mouseover":return Ia=ll(Ia,p,v,b,D,G),!0;case"pointerover":var ee=G.pointerId;return na.set(ee,ll(na.get(ee)||null,p,v,b,D,G)),!0;case"gotpointercapture":return ee=G.pointerId,Gl.set(ee,ll(Gl.get(ee)||null,p,v,b,D,G)),!0}return!1}function lo(p){var v=Ku(p.target);if(v!==null){var b=me(v);if(b!==null){if(v=b.tag,v===13){if(v=ke(b),v!==null){p.blockedOn=v,Mh(p.priority,function(){Vf(b)});return}}else if(v===3&&b.stateNode.current.memoizedState.isDehydrated){p.blockedOn=b.tag===3?b.stateNode.containerInfo:null;return}}}p.blockedOn=null}function Fu(p){if(p.blockedOn!==null)return!1;for(var v=p.targetContainers;0<v.length;){var b=co(p.domEventName,p.eventSystemFlags,v[0],p.nativeEvent);if(b===null){b=p.nativeEvent;var D=new b.constructor(b.type,b);At=D,b.target.dispatchEvent(D),At=null}else return v=Oc(b),v!==null&&Qf(v),p.blockedOn=b,!1;v.shift()}return!0}function Ou(p,v,b){Fu(p)&&b.delete(v)}function ia(){ba=!1,zs!==null&&Fu(zs)&&(zs=null),Fn!==null&&Fu(Fn)&&(Fn=null),Ia!==null&&Fu(Ia)&&(Ia=null),na.forEach(Ou),Gl.forEach(Ou)}function Tc(p,v){p.blockedOn===v&&(p.blockedOn=null,ba||(ba=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,ia)))}function Nu(p){function v(G){return Tc(G,p)}if(0<al.length){Tc(al[0],p);for(var b=1;b<al.length;b++){var D=al[b];D.blockedOn===p&&(D.blockedOn=null)}}for(zs!==null&&Tc(zs,p),Fn!==null&&Tc(Fn,p),Ia!==null&&Tc(Ia,p),na.forEach(v),Gl.forEach(v),b=0;b<Ma.length;b++)D=Ma[b],D.blockedOn===p&&(D.blockedOn=null);for(;0<Ma.length&&(b=Ma[0],b.blockedOn===null);)lo(b),b.blockedOn===null&&Ma.shift()}var _s=C.ReactCurrentBatchConfig,Ss=!0;function Hl(p,v,b,D){var G=ri,ee=_s.transition;_s.transition=null;try{ri=1,Rh(p,v,b,D)}finally{ri=G,_s.transition=ee}}function Ra(p,v,b,D){var G=ri,ee=_s.transition;_s.transition=null;try{ri=4,Rh(p,v,b,D)}finally{ri=G,_s.transition=ee}}function Rh(p,v,b,D){if(Ss){var G=co(p,v,b,D);if(G===null)U0(p,v,D,Uu,b),hr(p,D);else if(E0(G,p,v,b,D))D.stopPropagation();else if(hr(p,D),v&4&&-1<x0.indexOf(p)){for(;G!==null;){var ee=Oc(G);if(ee!==null&&ku(ee),ee=co(p,v,b,D),ee===null&&U0(p,v,D,Uu,b),ee===G)break;G=ee}G!==null&&D.stopPropagation()}else U0(p,v,D,null,b)}}var Uu=null;function co(p,v,b,D){if(Uu=null,p=yt(D),p=Ku(p),p!==null)if(v=me(p),v===null)p=null;else if(b=v.tag,b===13){if(p=ke(v),p!==null)return p;p=null}else if(b===3){if(v.stateNode.current.memoizedState.isDehydrated)return v.tag===3?v.stateNode.containerInfo:null;p=null}else v!==p&&(p=null);return Uu=p,null}function zu(p){switch(p){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Ht()){case xt:return 1;case Et:return 4;case Qt:case sn:return 16;case ln:return 536870912;default:return 16}default:return 16}}var zo=null,bc=null,ws=null;function cs(){if(ws)return ws;var p,v=bc,b=v.length,D,G="value"in zo?zo.value:zo.textContent,ee=G.length;for(p=0;p<b&&v[p]===G[p];p++);var fe=b-p;for(D=1;D<=fe&&v[b-D]===G[ee-D];D++);return ws=G.slice(p,1<D?1-D:void 0)}function Ic(p){var v=p.keyCode;return"charCode"in p?(p=p.charCode,p===0&&v===13&&(p=13)):p=v,p===10&&(p=13),32<=p||p===13?p:0}function Go(){return!0}function Mc(){return!1}function Cs(p){function v(b,D,G,ee,fe){this._reactName=b,this._targetInst=G,this.type=D,this.nativeEvent=ee,this.target=fe,this.currentTarget=null;for(var Ie in p)p.hasOwnProperty(Ie)&&(b=p[Ie],this[Ie]=b?b(ee):ee[Ie]);return this.isDefaultPrevented=(ee.defaultPrevented!=null?ee.defaultPrevented:ee.returnValue===!1)?Go:Mc,this.isPropagationStopped=Mc,this}return Y(v.prototype,{preventDefault:function(){this.defaultPrevented=!0;var b=this.nativeEvent;b&&(b.preventDefault?b.preventDefault():typeof b.returnValue!="unknown"&&(b.returnValue=!1),this.isDefaultPrevented=Go)},stopPropagation:function(){var b=this.nativeEvent;b&&(b.stopPropagation?b.stopPropagation():typeof b.cancelBubble!="unknown"&&(b.cancelBubble=!0),this.isPropagationStopped=Go)},persist:function(){},isPersistent:Go}),v}var Rc={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(p){return p.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Yr=Cs(Rc),us=Y({},Rc,{view:0,detail:0}),Ur=Cs(us),xr,So,La,Wf=Y({},us,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Hu,button:0,buttons:0,relatedTarget:function(p){return p.relatedTarget===void 0?p.fromElement===p.srcElement?p.toElement:p.fromElement:p.relatedTarget},movementX:function(p){return"movementX"in p?p.movementX:(p!==La&&(La&&p.type==="mousemove"?(xr=p.screenX-La.screenX,So=p.screenY-La.screenY):So=xr=0,La=p),xr)},movementY:function(p){return"movementY"in p?p.movementY:So}}),OA=Cs(Wf),Lc=Y({},Wf,{dataTransfer:0}),Gu=Cs(Lc),_0=Y({},us,{relatedTarget:0}),S0=Cs(_0),w0=Y({},Rc,{animationName:0,elapsedTime:0,pseudoElement:0}),Px=Cs(w0),Bx=Y({},Rc,{clipboardData:function(p){return"clipboardData"in p?p.clipboardData:window.clipboardData}}),NA=Cs(Bx),C0=Y({},Rc,{data:0}),UA=Cs(C0),Dx={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},kx={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},zA={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function jf(p){var v=this.nativeEvent;return v.getModifierState?v.getModifierState(p):(p=zA[p])?!!v[p]:!1}function Hu(){return jf}var T0=Y({},us,{key:function(p){if(p.key){var v=Dx[p.key]||p.key;if(v!=="Unidentified")return v}return p.type==="keypress"?(p=Ic(p),p===13?"Enter":String.fromCharCode(p)):p.type==="keydown"||p.type==="keyup"?kx[p.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Hu,charCode:function(p){return p.type==="keypress"?Ic(p):0},keyCode:function(p){return p.type==="keydown"||p.type==="keyup"?p.keyCode:0},which:function(p){return p.type==="keypress"?Ic(p):p.type==="keydown"||p.type==="keyup"?p.keyCode:0}}),b0=Cs(T0),Pa=Y({},Wf,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),ra=Cs(Pa),Lh=Y({},us,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Hu}),Pc=Cs(Lh),Bc=Y({},Rc,{propertyName:0,elapsedTime:0,pseudoElement:0}),Ph=Cs(Bc),Fx=Y({},Wf,{deltaX:function(p){return"deltaX"in p?p.deltaX:"wheelDeltaX"in p?-p.wheelDeltaX:0},deltaY:function(p){return"deltaY"in p?p.deltaY:"wheelDeltaY"in p?-p.wheelDeltaY:"wheelDelta"in p?-p.wheelDelta:0},deltaZ:0,deltaMode:0}),GA=Cs(Fx),HA=[9,13,27,32],wo=a&&"CompositionEvent"in window,Gs=null;a&&"documentMode"in document&&(Gs=document.documentMode);var fr=a&&"TextEvent"in window&&!Gs,Kf=a&&(!wo||Gs&&8<Gs&&11>=Gs),Ba=" ",QA=!1;function VA(p,v){switch(p){case"keyup":return HA.indexOf(v.keyCode)!==-1;case"keydown":return v.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function I0(p){return p=p.detail,typeof p=="object"&&"data"in p?p.data:null}var Qu=!1;function Ox(p,v){switch(p){case"compositionend":return I0(v);case"keypress":return v.which!==32?null:(QA=!0,Ba);case"textInput":return p=v.data,p===Ba&&QA?null:p;default:return null}}function Sp(p,v){if(Qu)return p==="compositionend"||!wo&&VA(p,v)?(p=cs(),ws=bc=zo=null,Qu=!1,p):null;switch(p){case"paste":return null;case"keypress":if(!(v.ctrlKey||v.altKey||v.metaKey)||v.ctrlKey&&v.altKey){if(v.char&&1<v.char.length)return v.char;if(v.which)return String.fromCharCode(v.which)}return null;case"compositionend":return Kf&&v.locale!=="ko"?null:v.data;default:return null}}var $f={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function M0(p){var v=p&&p.nodeName&&p.nodeName.toLowerCase();return v==="input"?!!$f[p.type]:v==="textarea"}function Yf(p,v,b,D){bt(D),v=z0(v,"onChange"),0<v.length&&(b=new Yr("onChange","change",null,b,D),p.push({event:b,listeners:v}))}var Vu=null,Xf=null;function Nx(p){ed(p,0)}function Dc(p){var v=zr(p);if(ce(v))return p}function Ux(p,v){if(p==="change")return v}var qf=!1;if(a){var Ho;if(a){var Bh="oninput"in document;if(!Bh){var Dh=document.createElement("div");Dh.setAttribute("oninput","return;"),Bh=typeof Dh.oninput=="function"}Ho=Bh}else Ho=!1;qf=Ho&&(!document.documentMode||9<document.documentMode)}function cl(){Vu&&(Vu.detachEvent("onpropertychange",R0),Xf=Vu=null)}function R0(p){if(p.propertyName==="value"&&Dc(Xf)){var v=[];Yf(v,Xf,p,yt(p)),Vn(Nx,v)}}function Jf(p,v,b){p==="focusin"?(cl(),Vu=v,Xf=b,Vu.attachEvent("onpropertychange",R0)):p==="focusout"&&cl()}function zx(p){if(p==="selectionchange"||p==="keyup"||p==="keydown")return Dc(Xf)}function WA(p,v){if(p==="click")return Dc(v)}function Er(p,v){if(p==="input"||p==="change")return Dc(v)}function L0(p,v){return p===v&&(p!==0||1/p===1/v)||p!==p&&v!==v}var sa=typeof Object.is=="function"?Object.is:L0;function kh(p,v){if(sa(p,v))return!0;if(typeof p!="object"||p===null||typeof v!="object"||v===null)return!1;var b=Object.keys(p),D=Object.keys(v);if(b.length!==D.length)return!1;for(D=0;D<b.length;D++){var G=b[D];if(!l.call(v,G)||!sa(p[G],v[G]))return!1}return!0}function wp(p){for(;p&&p.firstChild;)p=p.firstChild;return p}function oa(p,v){var b=wp(p);p=0;for(var D;b;){if(b.nodeType===3){if(D=p+b.textContent.length,p<=v&&D>=v)return{node:b,offset:v-p};p=D}e:{for(;b;){if(b.nextSibling){b=b.nextSibling;break e}b=b.parentNode}b=void 0}b=wp(b)}}function Fh(p,v){return p&&v?p===v?!0:p&&p.nodeType===3?!1:v&&v.nodeType===3?Fh(p,v.parentNode):"contains"in p?p.contains(v):p.compareDocumentPosition?!!(p.compareDocumentPosition(v)&16):!1:!1}function _r(){for(var p=window,v=we();v instanceof p.HTMLIFrameElement;){try{var b=typeof v.contentWindow.location.href=="string"}catch{b=!1}if(b)p=v.contentWindow;else break;v=we(p.document)}return v}function Ts(p){var v=p&&p.nodeName&&p.nodeName.toLowerCase();return v&&(v==="input"&&(p.type==="text"||p.type==="search"||p.type==="tel"||p.type==="url"||p.type==="password")||v==="textarea"||p.contentEditable==="true")}function bs(p){var v=_r(),b=p.focusedElem,D=p.selectionRange;if(v!==b&&b&&b.ownerDocument&&Fh(b.ownerDocument.documentElement,b)){if(D!==null&&Ts(b)){if(v=D.start,p=D.end,p===void 0&&(p=v),"selectionStart"in b)b.selectionStart=v,b.selectionEnd=Math.min(p,b.value.length);else if(p=(v=b.ownerDocument||document)&&v.defaultView||window,p.getSelection){p=p.getSelection();var G=b.textContent.length,ee=Math.min(D.start,G);D=D.end===void 0?ee:Math.min(D.end,G),!p.extend&&ee>D&&(G=D,D=ee,ee=G),G=oa(b,ee);var fe=oa(b,D);G&&fe&&(p.rangeCount!==1||p.anchorNode!==G.node||p.anchorOffset!==G.offset||p.focusNode!==fe.node||p.focusOffset!==fe.offset)&&(v=v.createRange(),v.setStart(G.node,G.offset),p.removeAllRanges(),ee>D?(p.addRange(v),p.extend(fe.node,fe.offset)):(v.setEnd(fe.node,fe.offset),p.addRange(v)))}}for(v=[],p=b;p=p.parentNode;)p.nodeType===1&&v.push({element:p,left:p.scrollLeft,top:p.scrollTop});for(typeof b.focus=="function"&&b.focus(),b=0;b<v.length;b++)p=v[b],p.element.scrollLeft=p.left,p.element.scrollTop=p.top}}var P0=a&&"documentMode"in document&&11>=document.documentMode,Ql=null,Oh=null,Cp=null,Is=!1;function B0(p,v,b){var D=b.window===b?b.document:b.nodeType===9?b:b.ownerDocument;Is||Ql==null||Ql!==we(D)||(D=Ql,"selectionStart"in D&&Ts(D)?D={start:D.selectionStart,end:D.selectionEnd}:(D=(D.ownerDocument&&D.ownerDocument.defaultView||window).getSelection(),D={anchorNode:D.anchorNode,anchorOffset:D.anchorOffset,focusNode:D.focusNode,focusOffset:D.focusOffset}),Cp&&kh(Cp,D)||(Cp=D,D=z0(Oh,"onSelect"),0<D.length&&(v=new Yr("onSelect","select",null,v,b),p.push({event:v,listeners:D}),v.target=Ql)))}function Zf(p,v){var b={};return b[p.toLowerCase()]=v.toLowerCase(),b["Webkit"+p]="webkit"+v,b["Moz"+p]="moz"+v,b}var Wu={animationend:Zf("Animation","AnimationEnd"),animationiteration:Zf("Animation","AnimationIteration"),animationstart:Zf("Animation","AnimationStart"),transitionend:Zf("Transition","TransitionEnd")},ul={},hl={};a&&(hl=document.createElement("div").style,"AnimationEvent"in window||(delete Wu.animationend.animation,delete Wu.animationiteration.animation,delete Wu.animationstart.animation),"TransitionEvent"in window||delete Wu.transitionend.transition);function Vl(p){if(ul[p])return ul[p];if(!Wu[p])return p;var v=Wu[p],b;for(b in v)if(v.hasOwnProperty(b)&&b in hl)return ul[p]=v[b];return p}var Tp=Vl("animationend"),bp=Vl("animationiteration"),jA=Vl("animationstart"),KA=Vl("transitionend"),$A=new Map,YA="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function kc(p,v){$A.set(p,v),s(v,[p])}for(var D0=0;D0<YA.length;D0++){var Ip=YA[D0],Mp=Ip.toLowerCase(),Gx=Ip[0].toUpperCase()+Ip.slice(1);kc(Mp,"on"+Gx)}kc(Tp,"onAnimationEnd"),kc(bp,"onAnimationIteration"),kc(jA,"onAnimationStart"),kc("dblclick","onDoubleClick"),kc("focusin","onFocus"),kc("focusout","onBlur"),kc(KA,"onTransitionEnd"),o("onMouseEnter",["mouseout","mouseover"]),o("onMouseLeave",["mouseout","mouseover"]),o("onPointerEnter",["pointerout","pointerover"]),o("onPointerLeave",["pointerout","pointerover"]),s("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),s("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),s("onBeforeInput",["compositionend","keypress","textInput","paste"]),s("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),s("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),s("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var ju="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),k0=new Set("cancel close invalid load scroll toggle".split(" ").concat(ju));function F0(p,v,b){var D=p.type||"unknown-event";p.currentTarget=b,he(D,v,void 0,p),p.currentTarget=null}function ed(p,v){v=(v&4)!==0;for(var b=0;b<p.length;b++){var D=p[b],G=D.event;D=D.listeners;e:{var ee=void 0;if(v)for(var fe=D.length-1;0<=fe;fe--){var Ie=D[fe],Ne=Ie.instance,rt=Ie.currentTarget;if(Ie=Ie.listener,Ne!==ee&&G.isPropagationStopped())break e;F0(G,Ie,rt),ee=Ne}else for(fe=0;fe<D.length;fe++){if(Ie=D[fe],Ne=Ie.instance,rt=Ie.currentTarget,Ie=Ie.listener,Ne!==ee&&G.isPropagationStopped())break e;F0(G,Ie,rt),ee=Ne}}}if(tr)throw p=An,tr=!1,An=null,p}function $i(p,v){var b=v[zh];b===void 0&&(b=v[zh]=new Set);var D=p+"__bubble";b.has(D)||(N0(v,p,2,!1),b.add(D))}function O0(p,v,b){var D=0;v&&(D|=4),N0(b,p,D,v)}var Rp="_reactListening"+Math.random().toString(36).slice(2);function td(p){if(!p[Rp]){p[Rp]=!0,n.forEach(function(b){b!=="selectionchange"&&(k0.has(b)||O0(b,!1,p),O0(b,!0,p))});var v=p.nodeType===9?p:p.ownerDocument;v===null||v[Rp]||(v[Rp]=!0,O0("selectionchange",!1,v))}}function N0(p,v,b,D){switch(zu(v)){case 1:var G=Hl;break;case 4:G=Ra;break;default:G=Rh}b=G.bind(null,v,b,p),G=void 0,!qn||v!=="touchstart"&&v!=="touchmove"&&v!=="wheel"||(G=!0),D?G!==void 0?p.addEventListener(v,b,{capture:!0,passive:G}):p.addEventListener(v,b,!0):G!==void 0?p.addEventListener(v,b,{passive:G}):p.addEventListener(v,b,!1)}function U0(p,v,b,D,G){var ee=D;if((v&1)===0&&(v&2)===0&&D!==null)e:for(;;){if(D===null)return;var fe=D.tag;if(fe===3||fe===4){var Ie=D.stateNode.containerInfo;if(Ie===G||Ie.nodeType===8&&Ie.parentNode===G)break;if(fe===4)for(fe=D.return;fe!==null;){var Ne=fe.tag;if((Ne===3||Ne===4)&&(Ne=fe.stateNode.containerInfo,Ne===G||Ne.nodeType===8&&Ne.parentNode===G))return;fe=fe.return}for(;Ie!==null;){if(fe=Ku(Ie),fe===null)return;if(Ne=fe.tag,Ne===5||Ne===6){D=ee=fe;continue e}Ie=Ie.parentNode}}D=D.return}Vn(function(){var rt=ee,Ct=yt(b),Tt=[];e:{var wt=$A.get(p);if(wt!==void 0){var $t=Yr,tn=p;switch(p){case"keypress":if(Ic(b)===0)break e;case"keydown":case"keyup":$t=b0;break;case"focusin":tn="focus",$t=S0;break;case"focusout":tn="blur",$t=S0;break;case"beforeblur":case"afterblur":$t=S0;break;case"click":if(b.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":$t=OA;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":$t=Gu;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":$t=Pc;break;case Tp:case bp:case jA:$t=Px;break;case KA:$t=Ph;break;case"scroll":$t=Ur;break;case"wheel":$t=GA;break;case"copy":case"cut":case"paste":$t=NA;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":$t=ra}var nn=(v&4)!==0,fs=!nn&&p==="scroll",Ye=nn?wt!==null?wt+"Capture":null:wt;nn=[];for(var ze=rt,Ze;ze!==null;){Ze=ze;var Lt=Ze.stateNode;if(Ze.tag===5&&Lt!==null&&(Ze=Lt,Ye!==null&&(Lt=pn(ze,Ye),Lt!=null&&nn.push(nd(ze,Lt,Ze)))),fs)break;ze=ze.return}0<nn.length&&(wt=new $t(wt,tn,null,b,Ct),Tt.push({event:wt,listeners:nn}))}}if((v&7)===0){e:{if(wt=p==="mouseover"||p==="pointerover",$t=p==="mouseout"||p==="pointerout",wt&&b!==At&&(tn=b.relatedTarget||b.fromElement)&&(Ku(tn)||tn[aa]))break e;if(($t||wt)&&(wt=Ct.window===Ct?Ct:(wt=Ct.ownerDocument)?wt.defaultView||wt.parentWindow:window,$t?(tn=b.relatedTarget||b.toElement,$t=rt,tn=tn?Ku(tn):null,tn!==null&&(fs=me(tn),tn!==fs||tn.tag!==5&&tn.tag!==6)&&(tn=null)):($t=null,tn=rt),$t!==tn)){if(nn=OA,Lt="onMouseLeave",Ye="onMouseEnter",ze="mouse",(p==="pointerout"||p==="pointerover")&&(nn=ra,Lt="onPointerLeave",Ye="onPointerEnter",ze="pointer"),fs=$t==null?wt:zr($t),Ze=tn==null?wt:zr(tn),wt=new nn(Lt,ze+"leave",$t,b,Ct),wt.target=fs,wt.relatedTarget=Ze,Lt=null,Ku(Ct)===rt&&(nn=new nn(Ye,ze+"enter",tn,b,Ct),nn.target=Ze,nn.relatedTarget=fs,Lt=nn),fs=Lt,$t&&tn)t:{for(nn=$t,Ye=tn,ze=0,Ze=nn;Ze;Ze=Nh(Ze))ze++;for(Ze=0,Lt=Ye;Lt;Lt=Nh(Lt))Ze++;for(;0<ze-Ze;)nn=Nh(nn),ze--;for(;0<Ze-ze;)Ye=Nh(Ye),Ze--;for(;ze--;){if(nn===Ye||Ye!==null&&nn===Ye.alternate)break t;nn=Nh(nn),Ye=Nh(Ye)}nn=null}else nn=null;$t!==null&&Hx(Tt,wt,$t,nn,!1),tn!==null&&fs!==null&&Hx(Tt,fs,tn,nn,!0)}}e:{if(wt=rt?zr(rt):window,$t=wt.nodeName&&wt.nodeName.toLowerCase(),$t==="select"||$t==="input"&&wt.type==="file")var cn=Ux;else if(M0(wt))if(qf)cn=Er;else{cn=zx;var bn=Jf}else($t=wt.nodeName)&&$t.toLowerCase()==="input"&&(wt.type==="checkbox"||wt.type==="radio")&&(cn=WA);if(cn&&(cn=cn(p,rt))){Yf(Tt,cn,b,Ct);break e}bn&&bn(p,wt,rt),p==="focusout"&&(bn=wt._wrapperState)&&bn.controlled&&wt.type==="number"&&ne(wt,"number",wt.value)}switch(bn=rt?zr(rt):window,p){case"focusin":(M0(bn)||bn.contentEditable==="true")&&(Ql=bn,Oh=rt,Cp=null);break;case"focusout":Cp=Oh=Ql=null;break;case"mousedown":Is=!0;break;case"contextmenu":case"mouseup":case"dragend":Is=!1,B0(Tt,b,Ct);break;case"selectionchange":if(P0)break;case"keydown":case"keyup":B0(Tt,b,Ct)}var In;if(wo)e:{switch(p){case"compositionstart":var On="onCompositionStart";break e;case"compositionend":On="onCompositionEnd";break e;case"compositionupdate":On="onCompositionUpdate";break e}On=void 0}else Qu?VA(p,b)&&(On="onCompositionEnd"):p==="keydown"&&b.keyCode===229&&(On="onCompositionStart");On&&(Kf&&b.locale!=="ko"&&(Qu||On!=="onCompositionStart"?On==="onCompositionEnd"&&Qu&&(In=cs()):(zo=Ct,bc="value"in zo?zo.value:zo.textContent,Qu=!0)),bn=z0(rt,On),0<bn.length&&(On=new UA(On,p,null,b,Ct),Tt.push({event:On,listeners:bn}),In?On.data=In:(In=I0(b),In!==null&&(On.data=In)))),(In=fr?Ox(p,b):Sp(p,b))&&(rt=z0(rt,"onBeforeInput"),0<rt.length&&(Ct=new UA("onBeforeInput","beforeinput",null,b,Ct),Tt.push({event:Ct,listeners:rt}),Ct.data=In))}ed(Tt,v)})}function nd(p,v,b){return{instance:p,listener:v,currentTarget:b}}function z0(p,v){for(var b=v+"Capture",D=[];p!==null;){var G=p,ee=G.stateNode;G.tag===5&&ee!==null&&(G=ee,ee=pn(p,b),ee!=null&&D.unshift(nd(p,ee,G)),ee=pn(p,v),ee!=null&&D.push(nd(p,ee,G))),p=p.return}return D}function Nh(p){if(p===null)return null;do p=p.return;while(p&&p.tag!==5);return p||null}function Hx(p,v,b,D,G){for(var ee=v._reactName,fe=[];b!==null&&b!==D;){var Ie=b,Ne=Ie.alternate,rt=Ie.stateNode;if(Ne!==null&&Ne===D)break;Ie.tag===5&&rt!==null&&(Ie=rt,G?(Ne=pn(b,ee),Ne!=null&&fe.unshift(nd(b,Ne,Ie))):G||(Ne=pn(b,ee),Ne!=null&&fe.push(nd(b,Ne,Ie)))),b=b.return}fe.length!==0&&p.push({event:v,listeners:fe})}var sC=/\r\n?/g,Qx=/\u0000|\uFFFD/g;function XA(p){return(typeof p=="string"?p:""+p).replace(sC,`
`).replace(Qx,"")}function Lp(p,v,b){if(v=XA(v),XA(p)!==v&&b)throw Error(t(425))}function Pp(){}var id=null,qA=null;function JA(p,v){return p==="textarea"||p==="noscript"||typeof v.children=="string"||typeof v.children=="number"||typeof v.dangerouslySetInnerHTML=="object"&&v.dangerouslySetInnerHTML!==null&&v.dangerouslySetInnerHTML.__html!=null}var ZA=typeof setTimeout=="function"?setTimeout:void 0,ey=typeof clearTimeout=="function"?clearTimeout:void 0,G0=typeof Promise=="function"?Promise:void 0,oC=typeof queueMicrotask=="function"?queueMicrotask:typeof G0<"u"?function(p){return G0.resolve(null).then(p).catch(Vx)}:ZA;function Vx(p){setTimeout(function(){throw p})}function H0(p,v){var b=v,D=0;do{var G=b.nextSibling;if(p.removeChild(b),G&&G.nodeType===8)if(b=G.data,b==="/$"){if(D===0){p.removeChild(G),Nu(v);return}D--}else b!=="$"&&b!=="$?"&&b!=="$!"||D++;b=G}while(b);Nu(v)}function Fc(p){for(;p!=null;p=p.nextSibling){var v=p.nodeType;if(v===1||v===3)break;if(v===8){if(v=p.data,v==="$"||v==="$!"||v==="$?")break;if(v==="/$")return null}}return p}function ty(p){p=p.previousSibling;for(var v=0;p;){if(p.nodeType===8){var b=p.data;if(b==="$"||b==="$!"||b==="$?"){if(v===0)return p;v--}else b==="/$"&&v++}p=p.previousSibling}return null}var Uh=Math.random().toString(36).slice(2),hs="__reactFiber$"+Uh,rd="__reactProps$"+Uh,aa="__reactContainer$"+Uh,zh="__reactEvents$"+Uh,Q0="__reactListeners$"+Uh,V0="__reactHandles$"+Uh;function Ku(p){var v=p[hs];if(v)return v;for(var b=p.parentNode;b;){if(v=b[aa]||b[hs]){if(b=v.alternate,v.child!==null||b!==null&&b.child!==null)for(p=ty(p);p!==null;){if(b=p[hs])return b;p=ty(p)}return v}p=b,b=p.parentNode}return null}function Oc(p){return p=p[hs]||p[aa],!p||p.tag!==5&&p.tag!==6&&p.tag!==13&&p.tag!==3?null:p}function zr(p){if(p.tag===5||p.tag===6)return p.stateNode;throw Error(t(33))}function W0(p){return p[rd]||null}var ny=[],Ms=-1;function Rr(p){return{current:p}}function Yi(p){0>Ms||(p.current=ny[Ms],ny[Ms]=null,Ms--)}function Gi(p,v){Ms++,ny[Ms]=p.current,p.current=v}var Nc={},Hs=Rr(Nc),Co=Rr(!1),Uc=Nc;function Gh(p,v){var b=p.type.contextTypes;if(!b)return Nc;var D=p.stateNode;if(D&&D.__reactInternalMemoizedUnmaskedChildContext===v)return D.__reactInternalMemoizedMaskedChildContext;var G={},ee;for(ee in b)G[ee]=v[ee];return D&&(p=p.stateNode,p.__reactInternalMemoizedUnmaskedChildContext=v,p.__reactInternalMemoizedMaskedChildContext=G),G}function uo(p){return p=p.childContextTypes,p!=null}function Bp(){Yi(Co),Yi(Hs)}function iy(p,v,b){if(Hs.current!==Nc)throw Error(t(168));Gi(Hs,v),Gi(Co,b)}function Dp(p,v,b){var D=p.stateNode;if(v=v.childContextTypes,typeof D.getChildContext!="function")return b;D=D.getChildContext();for(var G in D)if(!(G in v))throw Error(t(108,re(p)||"Unknown",G));return Y({},b,D)}function Hh(p){return p=(p=p.stateNode)&&p.__reactInternalMemoizedMergedChildContext||Nc,Uc=Hs.current,Gi(Hs,p),Gi(Co,Co.current),!0}function ry(p,v,b){var D=p.stateNode;if(!D)throw Error(t(169));b?(p=Dp(p,v,Uc),D.__reactInternalMemoizedMergedChildContext=p,Yi(Co),Yi(Hs),Gi(Hs,p)):Yi(Co),Gi(Co,b)}var fl=null,kp=!1,j0=!1;function Fp(p){fl===null?fl=[p]:fl.push(p)}function Wx(p){kp=!0,Fp(p)}function Wl(){if(!j0&&fl!==null){j0=!0;var p=0,v=ri;try{var b=fl;for(ri=1;p<b.length;p++){var D=b[p];do D=D(!0);while(D!==null)}fl=null,kp=!1}catch(G){throw fl!==null&&(fl=fl.slice(p+1)),Me(xt,Wl),G}finally{ri=v,j0=!1}}return null}var Qh=[],Qo=0,K0=null,$0=0,To=[],Rs=0,Vh=null,kt=1,Da="";function zc(p,v){Qh[Qo++]=$0,Qh[Qo++]=K0,K0=p,$0=v}function sy(p,v,b){To[Rs++]=kt,To[Rs++]=Da,To[Rs++]=Vh,Vh=p;var D=kt;p=Da;var G=32-yn(D)-1;D&=~(1<<G),b+=1;var ee=32-yn(v)+G;if(30<ee){var fe=G-G%5;ee=(D&(1<<fe)-1).toString(32),D>>=fe,G-=fe,kt=1<<32-yn(v)+G|b<<G|D,Da=ee+p}else kt=1<<ee|b<<G|D,Da=p}function oy(p){p.return!==null&&(zc(p,1),sy(p,1,0))}function Gc(p){for(;p===K0;)K0=Qh[--Qo],Qh[Qo]=null,$0=Qh[--Qo],Qh[Qo]=null;for(;p===Vh;)Vh=To[--Rs],To[Rs]=null,Da=To[--Rs],To[Rs]=null,kt=To[--Rs],To[Rs]=null}var Qs=null,bo=null,ir=!1,ka=null;function ay(p,v){var b=Xl(5,null,null,0);b.elementType="DELETED",b.stateNode=v,b.return=p,v=p.deletions,v===null?(p.deletions=[b],p.flags|=16):v.push(b)}function ly(p,v){switch(p.tag){case 5:var b=p.type;return v=v.nodeType!==1||b.toLowerCase()!==v.nodeName.toLowerCase()?null:v,v!==null?(p.stateNode=v,Qs=p,bo=Fc(v.firstChild),!0):!1;case 6:return v=p.pendingProps===""||v.nodeType!==3?null:v,v!==null?(p.stateNode=v,Qs=p,bo=null,!0):!1;case 13:return v=v.nodeType!==8?null:v,v!==null?(b=Vh!==null?{id:kt,overflow:Da}:null,p.memoizedState={dehydrated:v,treeContext:b,retryLane:1073741824},b=Xl(18,null,null,0),b.stateNode=v,b.return=p,p.child=b,Qs=p,bo=null,!0):!1;default:return!1}}function Y0(p){return(p.mode&1)!==0&&(p.flags&128)===0}function X0(p){if(ir){var v=bo;if(v){var b=v;if(!ly(p,v)){if(Y0(p))throw Error(t(418));v=Fc(b.nextSibling);var D=Qs;v&&ly(p,v)?ay(D,b):(p.flags=p.flags&-4097|2,ir=!1,Qs=p)}}else{if(Y0(p))throw Error(t(418));p.flags=p.flags&-4097|2,ir=!1,Qs=p}}}function q0(p){for(p=p.return;p!==null&&p.tag!==5&&p.tag!==3&&p.tag!==13;)p=p.return;Qs=p}function sd(p){if(p!==Qs)return!1;if(!ir)return q0(p),ir=!0,!1;var v;if((v=p.tag!==3)&&!(v=p.tag!==5)&&(v=p.type,v=v!=="head"&&v!=="body"&&!JA(p.type,p.memoizedProps)),v&&(v=bo)){if(Y0(p))throw cy(),Error(t(418));for(;v;)ay(p,v),v=Fc(v.nextSibling)}if(q0(p),p.tag===13){if(p=p.memoizedState,p=p!==null?p.dehydrated:null,!p)throw Error(t(317));e:{for(p=p.nextSibling,v=0;p;){if(p.nodeType===8){var b=p.data;if(b==="/$"){if(v===0){bo=Fc(p.nextSibling);break e}v--}else b!=="$"&&b!=="$!"&&b!=="$?"||v++}p=p.nextSibling}bo=null}}else bo=Qs?Fc(p.stateNode.nextSibling):null;return!0}function cy(){for(var p=bo;p;)p=Fc(p.nextSibling)}function $u(){bo=Qs=null,ir=!1}function od(p){ka===null?ka=[p]:ka.push(p)}var aC=C.ReactCurrentBatchConfig;function Op(p,v,b){if(p=b.ref,p!==null&&typeof p!="function"&&typeof p!="object"){if(b._owner){if(b=b._owner,b){if(b.tag!==1)throw Error(t(309));var D=b.stateNode}if(!D)throw Error(t(147,p));var G=D,ee=""+p;return v!==null&&v.ref!==null&&typeof v.ref=="function"&&v.ref._stringRef===ee?v.ref:(v=function(fe){var Ie=G.refs;fe===null?delete Ie[ee]:Ie[ee]=fe},v._stringRef=ee,v)}if(typeof p!="string")throw Error(t(284));if(!b._owner)throw Error(t(290,p))}return p}function Np(p,v){throw p=Object.prototype.toString.call(v),Error(t(31,p==="[object Object]"?"object with keys {"+Object.keys(v).join(", ")+"}":p))}function uy(p){var v=p._init;return v(p._payload)}function hy(p){function v(Ye,ze){if(p){var Ze=Ye.deletions;Ze===null?(Ye.deletions=[ze],Ye.flags|=16):Ze.push(ze)}}function b(Ye,ze){if(!p)return null;for(;ze!==null;)v(Ye,ze),ze=ze.sibling;return null}function D(Ye,ze){for(Ye=new Map;ze!==null;)ze.key!==null?Ye.set(ze.key,ze):Ye.set(ze.index,ze),ze=ze.sibling;return Ye}function G(Ye,ze){return Ye=Ad(Ye,ze),Ye.index=0,Ye.sibling=null,Ye}function ee(Ye,ze,Ze){return Ye.index=Ze,p?(Ze=Ye.alternate,Ze!==null?(Ze=Ze.index,Ze<ze?(Ye.flags|=2,ze):Ze):(Ye.flags|=2,ze)):(Ye.flags|=1048576,ze)}function fe(Ye){return p&&Ye.alternate===null&&(Ye.flags|=2),Ye}function Ie(Ye,ze,Ze,Lt){return ze===null||ze.tag!==6?(ze=TC(Ze,Ye.mode,Lt),ze.return=Ye,ze):(ze=G(ze,Ze),ze.return=Ye,ze)}function Ne(Ye,ze,Ze,Lt){var cn=Ze.type;return cn===M?Ct(Ye,ze,Ze.props.children,Lt,Ze.key):ze!==null&&(ze.elementType===cn||typeof cn=="object"&&cn!==null&&cn.$$typeof===$&&uy(cn)===ze.type)?(Lt=G(ze,Ze.props),Lt.ref=Op(Ye,ze,Ze),Lt.return=Ye,Lt):(Lt=pE(Ze.type,Ze.key,Ze.props,null,Ye.mode,Lt),Lt.ref=Op(Ye,ze,Ze),Lt.return=Ye,Lt)}function rt(Ye,ze,Ze,Lt){return ze===null||ze.tag!==4||ze.stateNode.containerInfo!==Ze.containerInfo||ze.stateNode.implementation!==Ze.implementation?(ze=bC(Ze,Ye.mode,Lt),ze.return=Ye,ze):(ze=G(ze,Ze.children||[]),ze.return=Ye,ze)}function Ct(Ye,ze,Ze,Lt,cn){return ze===null||ze.tag!==7?(ze=tm(Ze,Ye.mode,Lt,cn),ze.return=Ye,ze):(ze=G(ze,Ze),ze.return=Ye,ze)}function Tt(Ye,ze,Ze){if(typeof ze=="string"&&ze!==""||typeof ze=="number")return ze=TC(""+ze,Ye.mode,Ze),ze.return=Ye,ze;if(typeof ze=="object"&&ze!==null){switch(ze.$$typeof){case T:return Ze=pE(ze.type,ze.key,ze.props,null,Ye.mode,Ze),Ze.ref=Op(Ye,null,ze),Ze.return=Ye,Ze;case I:return ze=bC(ze,Ye.mode,Ze),ze.return=Ye,ze;case $:var Lt=ze._init;return Tt(Ye,Lt(ze._payload),Ze)}if(V(ze)||Q(ze))return ze=tm(ze,Ye.mode,Ze,null),ze.return=Ye,ze;Np(Ye,ze)}return null}function wt(Ye,ze,Ze,Lt){var cn=ze!==null?ze.key:null;if(typeof Ze=="string"&&Ze!==""||typeof Ze=="number")return cn!==null?null:Ie(Ye,ze,""+Ze,Lt);if(typeof Ze=="object"&&Ze!==null){switch(Ze.$$typeof){case T:return Ze.key===cn?Ne(Ye,ze,Ze,Lt):null;case I:return Ze.key===cn?rt(Ye,ze,Ze,Lt):null;case $:return cn=Ze._init,wt(Ye,ze,cn(Ze._payload),Lt)}if(V(Ze)||Q(Ze))return cn!==null?null:Ct(Ye,ze,Ze,Lt,null);Np(Ye,Ze)}return null}function $t(Ye,ze,Ze,Lt,cn){if(typeof Lt=="string"&&Lt!==""||typeof Lt=="number")return Ye=Ye.get(Ze)||null,Ie(ze,Ye,""+Lt,cn);if(typeof Lt=="object"&&Lt!==null){switch(Lt.$$typeof){case T:return Ye=Ye.get(Lt.key===null?Ze:Lt.key)||null,Ne(ze,Ye,Lt,cn);case I:return Ye=Ye.get(Lt.key===null?Ze:Lt.key)||null,rt(ze,Ye,Lt,cn);case $:var bn=Lt._init;return $t(Ye,ze,Ze,bn(Lt._payload),cn)}if(V(Lt)||Q(Lt))return Ye=Ye.get(Ze)||null,Ct(ze,Ye,Lt,cn,null);Np(ze,Lt)}return null}function tn(Ye,ze,Ze,Lt){for(var cn=null,bn=null,In=ze,On=ze=0,mo=null;In!==null&&On<Ze.length;On++){In.index>On?(mo=In,In=null):mo=In.sibling;var Ti=wt(Ye,In,Ze[On],Lt);if(Ti===null){In===null&&(In=mo);break}p&&In&&Ti.alternate===null&&v(Ye,In),ze=ee(Ti,ze,On),bn===null?cn=Ti:bn.sibling=Ti,bn=Ti,In=mo}if(On===Ze.length)return b(Ye,In),ir&&zc(Ye,On),cn;if(In===null){for(;On<Ze.length;On++)In=Tt(Ye,Ze[On],Lt),In!==null&&(ze=ee(In,ze,On),bn===null?cn=In:bn.sibling=In,bn=In);return ir&&zc(Ye,On),cn}for(In=D(Ye,In);On<Ze.length;On++)mo=$t(In,Ye,On,Ze[On],Lt),mo!==null&&(p&&mo.alternate!==null&&In.delete(mo.key===null?On:mo.key),ze=ee(mo,ze,On),bn===null?cn=mo:bn.sibling=mo,bn=mo);return p&&In.forEach(function(yd){return v(Ye,yd)}),ir&&zc(Ye,On),cn}function nn(Ye,ze,Ze,Lt){var cn=Q(Ze);if(typeof cn!="function")throw Error(t(150));if(Ze=cn.call(Ze),Ze==null)throw Error(t(151));for(var bn=cn=null,In=ze,On=ze=0,mo=null,Ti=Ze.next();In!==null&&!Ti.done;On++,Ti=Ze.next()){In.index>On?(mo=In,In=null):mo=In.sibling;var yd=wt(Ye,In,Ti.value,Lt);if(yd===null){In===null&&(In=mo);break}p&&In&&yd.alternate===null&&v(Ye,In),ze=ee(yd,ze,On),bn===null?cn=yd:bn.sibling=yd,bn=yd,In=mo}if(Ti.done)return b(Ye,In),ir&&zc(Ye,On),cn;if(In===null){for(;!Ti.done;On++,Ti=Ze.next())Ti=Tt(Ye,Ti.value,Lt),Ti!==null&&(ze=ee(Ti,ze,On),bn===null?cn=Ti:bn.sibling=Ti,bn=Ti);return ir&&zc(Ye,On),cn}for(In=D(Ye,In);!Ti.done;On++,Ti=Ze.next())Ti=$t(In,Ye,On,Ti.value,Lt),Ti!==null&&(p&&Ti.alternate!==null&&In.delete(Ti.key===null?On:Ti.key),ze=ee(Ti,ze,On),bn===null?cn=Ti:bn.sibling=Ti,bn=Ti);return p&&In.forEach(function(U$){return v(Ye,U$)}),ir&&zc(Ye,On),cn}function fs(Ye,ze,Ze,Lt){if(typeof Ze=="object"&&Ze!==null&&Ze.type===M&&Ze.key===null&&(Ze=Ze.props.children),typeof Ze=="object"&&Ze!==null){switch(Ze.$$typeof){case T:e:{for(var cn=Ze.key,bn=ze;bn!==null;){if(bn.key===cn){if(cn=Ze.type,cn===M){if(bn.tag===7){b(Ye,bn.sibling),ze=G(bn,Ze.props.children),ze.return=Ye,Ye=ze;break e}}else if(bn.elementType===cn||typeof cn=="object"&&cn!==null&&cn.$$typeof===$&&uy(cn)===bn.type){b(Ye,bn.sibling),ze=G(bn,Ze.props),ze.ref=Op(Ye,bn,Ze),ze.return=Ye,Ye=ze;break e}b(Ye,bn);break}else v(Ye,bn);bn=bn.sibling}Ze.type===M?(ze=tm(Ze.props.children,Ye.mode,Lt,Ze.key),ze.return=Ye,Ye=ze):(Lt=pE(Ze.type,Ze.key,Ze.props,null,Ye.mode,Lt),Lt.ref=Op(Ye,ze,Ze),Lt.return=Ye,Ye=Lt)}return fe(Ye);case I:e:{for(bn=Ze.key;ze!==null;){if(ze.key===bn)if(ze.tag===4&&ze.stateNode.containerInfo===Ze.containerInfo&&ze.stateNode.implementation===Ze.implementation){b(Ye,ze.sibling),ze=G(ze,Ze.children||[]),ze.return=Ye,Ye=ze;break e}else{b(Ye,ze);break}else v(Ye,ze);ze=ze.sibling}ze=bC(Ze,Ye.mode,Lt),ze.return=Ye,Ye=ze}return fe(Ye);case $:return bn=Ze._init,fs(Ye,ze,bn(Ze._payload),Lt)}if(V(Ze))return tn(Ye,ze,Ze,Lt);if(Q(Ze))return nn(Ye,ze,Ze,Lt);Np(Ye,Ze)}return typeof Ze=="string"&&Ze!==""||typeof Ze=="number"?(Ze=""+Ze,ze!==null&&ze.tag===6?(b(Ye,ze.sibling),ze=G(ze,Ze),ze.return=Ye,Ye=ze):(b(Ye,ze),ze=TC(Ze,Ye.mode,Lt),ze.return=Ye,Ye=ze),fe(Ye)):b(Ye,ze)}return fs}var Wh=hy(!0),Up=hy(!1),jh=Rr(null),Kh=null,Hc=null,ad=null;function $h(){ad=Hc=Kh=null}function zp(p){var v=jh.current;Yi(jh),p._currentValue=v}function Gp(p,v,b){for(;p!==null;){var D=p.alternate;if((p.childLanes&v)!==v?(p.childLanes|=v,D!==null&&(D.childLanes|=v)):D!==null&&(D.childLanes&v)!==v&&(D.childLanes|=v),p===b)break;p=p.return}}function Yu(p,v){Kh=p,ad=Hc=null,p=p.dependencies,p!==null&&p.firstContext!==null&&((p.lanes&v)!==0&&(Zn=!0),p.firstContext=null)}function la(p){var v=p._currentValue;if(ad!==p)if(p={context:p,memoizedValue:v,next:null},Hc===null){if(Kh===null)throw Error(t(308));Hc=p,Kh.dependencies={lanes:0,firstContext:p}}else Hc=Hc.next=p;return v}var Qc=null;function fy(p){Qc===null?Qc=[p]:Qc.push(p)}function Hp(p,v,b,D){var G=v.interleaved;return G===null?(b.next=b,fy(v)):(b.next=G.next,G.next=b),v.interleaved=b,dl(p,D)}function dl(p,v){p.lanes|=v;var b=p.alternate;for(b!==null&&(b.lanes|=v),b=p,p=p.return;p!==null;)p.childLanes|=v,b=p.alternate,b!==null&&(b.childLanes|=v),b=p,p=p.return;return b.tag===3?b.stateNode:null}var Di=!1;function Jn(p){p.updateQueue={baseState:p.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Gr(p,v){p=p.updateQueue,v.updateQueue===p&&(v.updateQueue={baseState:p.baseState,firstBaseUpdate:p.firstBaseUpdate,lastBaseUpdate:p.lastBaseUpdate,shared:p.shared,effects:p.effects})}function ki(p,v){return{eventTime:p,lane:v,tag:0,payload:null,callback:null,next:null}}function dr(p,v,b){var D=p.updateQueue;if(D===null)return null;if(D=D.shared,(_i&2)!==0){var G=D.pending;return G===null?v.next=v:(v.next=G.next,G.next=v),D.pending=v,dl(p,b)}return G=D.interleaved,G===null?(v.next=v,fy(D)):(v.next=G.next,G.next=v),D.interleaved=v,dl(p,b)}function ho(p,v,b){if(v=v.updateQueue,v!==null&&(v=v.shared,(b&4194240)!==0)){var D=v.lanes;D&=p.pendingLanes,b|=D,v.lanes=b,ol(p,b)}}function Yh(p,v){var b=p.updateQueue,D=p.alternate;if(D!==null&&(D=D.updateQueue,b===D)){var G=null,ee=null;if(b=b.firstBaseUpdate,b!==null){do{var fe={eventTime:b.eventTime,lane:b.lane,tag:b.tag,payload:b.payload,callback:b.callback,next:null};ee===null?G=ee=fe:ee=ee.next=fe,b=b.next}while(b!==null);ee===null?G=ee=v:ee=ee.next=v}else G=ee=v;b={baseState:D.baseState,firstBaseUpdate:G,lastBaseUpdate:ee,shared:D.shared,effects:D.effects},p.updateQueue=b;return}p=b.lastBaseUpdate,p===null?b.firstBaseUpdate=v:p.next=v,b.lastBaseUpdate=v}function Lr(p,v,b,D){var G=p.updateQueue;Di=!1;var ee=G.firstBaseUpdate,fe=G.lastBaseUpdate,Ie=G.shared.pending;if(Ie!==null){G.shared.pending=null;var Ne=Ie,rt=Ne.next;Ne.next=null,fe===null?ee=rt:fe.next=rt,fe=Ne;var Ct=p.alternate;Ct!==null&&(Ct=Ct.updateQueue,Ie=Ct.lastBaseUpdate,Ie!==fe&&(Ie===null?Ct.firstBaseUpdate=rt:Ie.next=rt,Ct.lastBaseUpdate=Ne))}if(ee!==null){var Tt=G.baseState;fe=0,Ct=rt=Ne=null,Ie=ee;do{var wt=Ie.lane,$t=Ie.eventTime;if((D&wt)===wt){Ct!==null&&(Ct=Ct.next={eventTime:$t,lane:0,tag:Ie.tag,payload:Ie.payload,callback:Ie.callback,next:null});e:{var tn=p,nn=Ie;switch(wt=v,$t=b,nn.tag){case 1:if(tn=nn.payload,typeof tn=="function"){Tt=tn.call($t,Tt,wt);break e}Tt=tn;break e;case 3:tn.flags=tn.flags&-65537|128;case 0:if(tn=nn.payload,wt=typeof tn=="function"?tn.call($t,Tt,wt):tn,wt==null)break e;Tt=Y({},Tt,wt);break e;case 2:Di=!0}}Ie.callback!==null&&Ie.lane!==0&&(p.flags|=64,wt=G.effects,wt===null?G.effects=[Ie]:wt.push(Ie))}else $t={eventTime:$t,lane:wt,tag:Ie.tag,payload:Ie.payload,callback:Ie.callback,next:null},Ct===null?(rt=Ct=$t,Ne=Tt):Ct=Ct.next=$t,fe|=wt;if(Ie=Ie.next,Ie===null){if(Ie=G.shared.pending,Ie===null)break;wt=Ie,Ie=wt.next,wt.next=null,G.lastBaseUpdate=wt,G.shared.pending=null}}while(!0);if(Ct===null&&(Ne=Tt),G.baseState=Ne,G.firstBaseUpdate=rt,G.lastBaseUpdate=Ct,v=G.shared.interleaved,v!==null){G=v;do fe|=G.lane,G=G.next;while(G!==v)}else ee===null&&(G.shared.lanes=0);qp|=fe,p.lanes=fe,p.memoizedState=Tt}}function ld(p,v,b){if(p=v.effects,v.effects=null,p!==null)for(v=0;v<p.length;v++){var D=p[v],G=D.callback;if(G!==null){if(D.callback=null,D=b,typeof G!="function")throw Error(t(191,G));G.call(D)}}}var jl={},ca=Rr(jl),Xh=Rr(jl),Vc=Rr(jl);function Xr(p){if(p===jl)throw Error(t(174));return p}function Qp(p,v){switch(Gi(Vc,v),Gi(Xh,p),Gi(ca,jl),p=v.nodeType,p){case 9:case 11:v=(v=v.documentElement)?v.namespaceURI:$e(null,"");break;default:p=p===8?v.parentNode:v,v=p.namespaceURI||null,p=p.tagName,v=$e(v,p)}Yi(ca),Gi(ca,v)}function Xu(){Yi(ca),Yi(Xh),Yi(Vc)}function qh(p){Xr(Vc.current);var v=Xr(ca.current),b=$e(v,p.type);v!==b&&(Gi(Xh,p),Gi(ca,b))}function cd(p){Xh.current===p&&(Yi(ca),Yi(Xh))}var rr=Rr(0);function pl(p){for(var v=p;v!==null;){if(v.tag===13){var b=v.memoizedState;if(b!==null&&(b=b.dehydrated,b===null||b.data==="$?"||b.data==="$!"))return v}else if(v.tag===19&&v.memoizedProps.revealOrder!==void 0){if((v.flags&128)!==0)return v}else if(v.child!==null){v.child.return=v,v=v.child;continue}if(v===p)break;for(;v.sibling===null;){if(v.return===null||v.return===p)return null;v=v.return}v.sibling.return=v.return,v=v.sibling}return null}var ud=[];function Kl(){for(var p=0;p<ud.length;p++)ud[p]._workInProgressVersionPrimary=null;ud.length=0}var Jh=C.ReactCurrentDispatcher,Zh=C.ReactCurrentBatchConfig,Wc=0,Xi=null,Pr=null,yi=null,ml=!1,fo=!1,qu=0,Vo=0;function Vs(){throw Error(t(321))}function Vp(p,v){if(v===null)return!1;for(var b=0;b<v.length&&b<p.length;b++)if(!sa(p[b],v[b]))return!1;return!0}function Wp(p,v,b,D,G,ee){if(Wc=ee,Xi=v,v.memoizedState=null,v.updateQueue=null,v.lanes=0,Jh.current=p===null||p.memoizedState===null?Jx:Zx,p=b(D,G),fo){ee=0;do{if(fo=!1,qu=0,25<=ee)throw Error(t(301));ee+=1,yi=Pr=null,v.updateQueue=null,Jh.current=eE,p=b(D,G)}while(fo)}if(Jh.current=rg,v=Pr!==null&&Pr.next!==null,Wc=0,yi=Pr=Xi=null,ml=!1,v)throw Error(t(300));return p}function dy(){var p=qu!==0;return qu=0,p}function Ws(){var p={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return yi===null?Xi.memoizedState=yi=p:yi=yi.next=p,yi}function ua(){if(Pr===null){var p=Xi.alternate;p=p!==null?p.memoizedState:null}else p=Pr.next;var v=yi===null?Xi.memoizedState:yi.next;if(v!==null)yi=v,Pr=p;else{if(p===null)throw Error(t(310));Pr=p,p={memoizedState:Pr.memoizedState,baseState:Pr.baseState,baseQueue:Pr.baseQueue,queue:Pr.queue,next:null},yi===null?Xi.memoizedState=yi=p:yi=yi.next=p}return yi}function hd(p,v){return typeof v=="function"?v(p):v}function jp(p){var v=ua(),b=v.queue;if(b===null)throw Error(t(311));b.lastRenderedReducer=p;var D=Pr,G=D.baseQueue,ee=b.pending;if(ee!==null){if(G!==null){var fe=G.next;G.next=ee.next,ee.next=fe}D.baseQueue=G=ee,b.pending=null}if(G!==null){ee=G.next,D=D.baseState;var Ie=fe=null,Ne=null,rt=ee;do{var Ct=rt.lane;if((Wc&Ct)===Ct)Ne!==null&&(Ne=Ne.next={lane:0,action:rt.action,hasEagerState:rt.hasEagerState,eagerState:rt.eagerState,next:null}),D=rt.hasEagerState?rt.eagerState:p(D,rt.action);else{var Tt={lane:Ct,action:rt.action,hasEagerState:rt.hasEagerState,eagerState:rt.eagerState,next:null};Ne===null?(Ie=Ne=Tt,fe=D):Ne=Ne.next=Tt,Xi.lanes|=Ct,qp|=Ct}rt=rt.next}while(rt!==null&&rt!==ee);Ne===null?fe=D:Ne.next=Ie,sa(D,v.memoizedState)||(Zn=!0),v.memoizedState=D,v.baseState=fe,v.baseQueue=Ne,b.lastRenderedState=D}if(p=b.interleaved,p!==null){G=p;do ee=G.lane,Xi.lanes|=ee,qp|=ee,G=G.next;while(G!==p)}else G===null&&(b.lanes=0);return[v.memoizedState,b.dispatch]}function jc(p){var v=ua(),b=v.queue;if(b===null)throw Error(t(311));b.lastRenderedReducer=p;var D=b.dispatch,G=b.pending,ee=v.memoizedState;if(G!==null){b.pending=null;var fe=G=G.next;do ee=p(ee,fe.action),fe=fe.next;while(fe!==G);sa(ee,v.memoizedState)||(Zn=!0),v.memoizedState=ee,v.baseQueue===null&&(v.baseState=ee),b.lastRenderedState=ee}return[ee,D]}function py(){}function my(p,v){var b=Xi,D=ua(),G=v(),ee=!sa(D.memoizedState,G);if(ee&&(D.memoizedState=G,Zn=!0),D=D.queue,yy(jx.bind(null,b,D,p),[p]),D.getSnapshot!==v||ee||yi!==null&&yi.memoizedState.tag&1){if(b.flags|=2048,gl(9,Kp.bind(null,b,D,G,v),void 0,null),po===null)throw Error(t(349));(Wc&30)!==0||J0(b,v,G)}return G}function J0(p,v,b){p.flags|=16384,p={getSnapshot:v,value:b},v=Xi.updateQueue,v===null?(v={lastEffect:null,stores:null},Xi.updateQueue=v,v.stores=[p]):(b=v.stores,b===null?v.stores=[p]:b.push(p))}function Kp(p,v,b,D){v.value=b,v.getSnapshot=D,Kx(v)&&gy(p)}function jx(p,v,b){return b(function(){Kx(v)&&gy(p)})}function Kx(p){var v=p.getSnapshot;p=p.value;try{var b=v();return!sa(p,b)}catch{return!0}}function gy(p){var v=dl(p,1);v!==null&&qc(v,p,1,-1)}function Ay(p){var v=Ws();return typeof p=="function"&&(p=p()),v.memoizedState=v.baseState=p,p={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:hd,lastRenderedState:p},v.queue=p,p=p.dispatch=ef.bind(null,Xi,p),[v.memoizedState,p]}function gl(p,v,b,D){return p={tag:p,create:v,destroy:b,deps:D,next:null},v=Xi.updateQueue,v===null?(v={lastEffect:null,stores:null},Xi.updateQueue=v,v.lastEffect=p.next=p):(b=v.lastEffect,b===null?v.lastEffect=p.next=p:(D=b.next,b.next=p,p.next=D,v.lastEffect=p)),p}function $x(){return ua().memoizedState}function $l(p,v,b,D){var G=Ws();Xi.flags|=p,G.memoizedState=gl(1|v,b,void 0,D===void 0?null:D)}function $p(p,v,b,D){var G=ua();D=D===void 0?null:D;var ee=void 0;if(Pr!==null){var fe=Pr.memoizedState;if(ee=fe.destroy,D!==null&&Vp(D,fe.deps)){G.memoizedState=gl(v,b,ee,D);return}}Xi.flags|=p,G.memoizedState=gl(1|v,b,ee,D)}function Io(p,v){return $l(8390656,8,p,v)}function yy(p,v){return $p(2048,8,p,v)}function vy(p,v){return $p(4,2,p,v)}function Yx(p,v){return $p(4,4,p,v)}function Xx(p,v){if(typeof v=="function")return p=p(),v(p),function(){v(null)};if(v!=null)return p=p(),v.current=p,function(){v.current=null}}function xy(p,v,b){return b=b!=null?b.concat([p]):null,$p(4,4,Xx.bind(null,v,p),b)}function Z0(){}function qx(p,v){var b=ua();v=v===void 0?null:v;var D=b.memoizedState;return D!==null&&v!==null&&Vp(v,D[1])?D[0]:(b.memoizedState=[p,v],p)}function ha(p,v){var b=ua();v=v===void 0?null:v;var D=b.memoizedState;return D!==null&&v!==null&&Vp(v,D[1])?D[0]:(p=p(),b.memoizedState=[p,v],p)}function eg(p,v,b){return(Wc&21)===0?(p.baseState&&(p.baseState=!1,Zn=!0),p.memoizedState=b):(sa(b,v)||(b=Ri(),Xi.lanes|=b,qp|=b,p.baseState=!0),v)}function lC(p,v){var b=ri;ri=b!==0&&4>b?b:4,p(!0);var D=Zh.transition;Zh.transition={};try{p(!1),v()}finally{ri=b,Zh.transition=D}}function Kc(){return ua().memoizedState}function tg(p,v,b){var D=md(p);if(b={lane:D,action:b,hasEagerState:!1,eagerState:null,next:null},Yp(p))ng(v,b);else if(b=Hp(p,v,b,D),b!==null){var G=da();qc(b,p,D,G),ig(b,v,D)}}function ef(p,v,b){var D=md(p),G={lane:D,action:b,hasEagerState:!1,eagerState:null,next:null};if(Yp(p))ng(v,G);else{var ee=p.alternate;if(p.lanes===0&&(ee===null||ee.lanes===0)&&(ee=v.lastRenderedReducer,ee!==null))try{var fe=v.lastRenderedState,Ie=ee(fe,b);if(G.hasEagerState=!0,G.eagerState=Ie,sa(Ie,fe)){var Ne=v.interleaved;Ne===null?(G.next=G,fy(v)):(G.next=Ne.next,Ne.next=G),v.interleaved=G;return}}catch{}finally{}b=Hp(p,v,G,D),b!==null&&(G=da(),qc(b,p,D,G),ig(b,v,D))}}function Yp(p){var v=p.alternate;return p===Xi||v!==null&&v===Xi}function ng(p,v){fo=ml=!0;var b=p.pending;b===null?v.next=v:(v.next=b.next,b.next=v),p.pending=v}function ig(p,v,b){if((b&4194240)!==0){var D=v.lanes;D&=p.pendingLanes,b|=D,v.lanes=b,ol(p,b)}}var rg={readContext:la,useCallback:Vs,useContext:Vs,useEffect:Vs,useImperativeHandle:Vs,useInsertionEffect:Vs,useLayoutEffect:Vs,useMemo:Vs,useReducer:Vs,useRef:Vs,useState:Vs,useDebugValue:Vs,useDeferredValue:Vs,useTransition:Vs,useMutableSource:Vs,useSyncExternalStore:Vs,useId:Vs,unstable_isNewReconciler:!1},Jx={readContext:la,useCallback:function(p,v){return Ws().memoizedState=[p,v===void 0?null:v],p},useContext:la,useEffect:Io,useImperativeHandle:function(p,v,b){return b=b!=null?b.concat([p]):null,$l(4194308,4,Xx.bind(null,v,p),b)},useLayoutEffect:function(p,v){return $l(4194308,4,p,v)},useInsertionEffect:function(p,v){return $l(4,2,p,v)},useMemo:function(p,v){var b=Ws();return v=v===void 0?null:v,p=p(),b.memoizedState=[p,v],p},useReducer:function(p,v,b){var D=Ws();return v=b!==void 0?b(v):v,D.memoizedState=D.baseState=v,p={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:p,lastRenderedState:v},D.queue=p,p=p.dispatch=tg.bind(null,Xi,p),[D.memoizedState,p]},useRef:function(p){var v=Ws();return p={current:p},v.memoizedState=p},useState:Ay,useDebugValue:Z0,useDeferredValue:function(p){return Ws().memoizedState=p},useTransition:function(){var p=Ay(!1),v=p[0];return p=lC.bind(null,p[1]),Ws().memoizedState=p,[v,p]},useMutableSource:function(){},useSyncExternalStore:function(p,v,b){var D=Xi,G=Ws();if(ir){if(b===void 0)throw Error(t(407));b=b()}else{if(b=v(),po===null)throw Error(t(349));(Wc&30)!==0||J0(D,v,b)}G.memoizedState=b;var ee={value:b,getSnapshot:v};return G.queue=ee,Io(jx.bind(null,D,ee,p),[p]),D.flags|=2048,gl(9,Kp.bind(null,D,ee,b,v),void 0,null),b},useId:function(){var p=Ws(),v=po.identifierPrefix;if(ir){var b=Da,D=kt;b=(D&~(1<<32-yn(D)-1)).toString(32)+b,v=":"+v+"R"+b,b=qu++,0<b&&(v+="H"+b.toString(32)),v+=":"}else b=Vo++,v=":"+v+"r"+b.toString(32)+":";return p.memoizedState=v},unstable_isNewReconciler:!1},Zx={readContext:la,useCallback:qx,useContext:la,useEffect:yy,useImperativeHandle:xy,useInsertionEffect:vy,useLayoutEffect:Yx,useMemo:ha,useReducer:jp,useRef:$x,useState:function(){return jp(hd)},useDebugValue:Z0,useDeferredValue:function(p){var v=ua();return eg(v,Pr.memoizedState,p)},useTransition:function(){var p=jp(hd)[0],v=ua().memoizedState;return[p,v]},useMutableSource:py,useSyncExternalStore:my,useId:Kc,unstable_isNewReconciler:!1},eE={readContext:la,useCallback:qx,useContext:la,useEffect:yy,useImperativeHandle:xy,useInsertionEffect:vy,useLayoutEffect:Yx,useMemo:ha,useReducer:jc,useRef:$x,useState:function(){return jc(hd)},useDebugValue:Z0,useDeferredValue:function(p){var v=ua();return Pr===null?v.memoizedState=p:eg(v,Pr.memoizedState,p)},useTransition:function(){var p=jc(hd)[0],v=ua().memoizedState;return[p,v]},useMutableSource:py,useSyncExternalStore:my,useId:Kc,unstable_isNewReconciler:!1};function Fa(p,v){if(p&&p.defaultProps){v=Y({},v),p=p.defaultProps;for(var b in p)v[b]===void 0&&(v[b]=p[b]);return v}return v}function Xp(p,v,b,D){v=p.memoizedState,b=b(D,v),b=b==null?v:Y({},v,b),p.memoizedState=b,p.lanes===0&&(p.updateQueue.baseState=b)}var sg={isMounted:function(p){return(p=p._reactInternals)?me(p)===p:!1},enqueueSetState:function(p,v,b){p=p._reactInternals;var D=da(),G=md(p),ee=ki(D,G);ee.payload=v,b!=null&&(ee.callback=b),v=dr(p,ee,G),v!==null&&(qc(v,p,G,D),ho(v,p,G))},enqueueReplaceState:function(p,v,b){p=p._reactInternals;var D=da(),G=md(p),ee=ki(D,G);ee.tag=1,ee.payload=v,b!=null&&(ee.callback=b),v=dr(p,ee,G),v!==null&&(qc(v,p,G,D),ho(v,p,G))},enqueueForceUpdate:function(p,v){p=p._reactInternals;var b=da(),D=md(p),G=ki(b,D);G.tag=2,v!=null&&(G.callback=v),v=dr(p,G,D),v!==null&&(qc(v,p,D,b),ho(v,p,D))}};function tE(p,v,b,D,G,ee,fe){return p=p.stateNode,typeof p.shouldComponentUpdate=="function"?p.shouldComponentUpdate(D,ee,fe):v.prototype&&v.prototype.isPureReactComponent?!kh(b,D)||!kh(G,ee):!0}function _(p,v,b){var D=!1,G=Nc,ee=v.contextType;return typeof ee=="object"&&ee!==null?ee=la(ee):(G=uo(v)?Uc:Hs.current,D=v.contextTypes,ee=(D=D!=null)?Gh(p,G):Nc),v=new v(b,ee),p.memoizedState=v.state!==null&&v.state!==void 0?v.state:null,v.updater=sg,p.stateNode=v,v._reactInternals=p,D&&(p=p.stateNode,p.__reactInternalMemoizedUnmaskedChildContext=G,p.__reactInternalMemoizedMaskedChildContext=ee),v}function S(p,v,b,D){p=v.state,typeof v.componentWillReceiveProps=="function"&&v.componentWillReceiveProps(b,D),typeof v.UNSAFE_componentWillReceiveProps=="function"&&v.UNSAFE_componentWillReceiveProps(b,D),v.state!==p&&sg.enqueueReplaceState(v,v.state,null)}function B(p,v,b,D){var G=p.stateNode;G.props=b,G.state=p.memoizedState,G.refs={},Jn(p);var ee=v.contextType;typeof ee=="object"&&ee!==null?G.context=la(ee):(ee=uo(v)?Uc:Hs.current,G.context=Gh(p,ee)),G.state=p.memoizedState,ee=v.getDerivedStateFromProps,typeof ee=="function"&&(Xp(p,v,ee,b),G.state=p.memoizedState),typeof v.getDerivedStateFromProps=="function"||typeof G.getSnapshotBeforeUpdate=="function"||typeof G.UNSAFE_componentWillMount!="function"&&typeof G.componentWillMount!="function"||(v=G.state,typeof G.componentWillMount=="function"&&G.componentWillMount(),typeof G.UNSAFE_componentWillMount=="function"&&G.UNSAFE_componentWillMount(),v!==G.state&&sg.enqueueReplaceState(G,G.state,null),Lr(p,b,G,D),G.state=p.memoizedState),typeof G.componentDidMount=="function"&&(p.flags|=4194308)}function N(p,v){try{var b="",D=v;do b+=J(D),D=D.return;while(D);var G=b}catch(ee){G=`
Error generating stack: `+ee.message+`
`+ee.stack}return{value:p,source:v,stack:G,digest:null}}function j(p,v,b){return{value:p,source:null,stack:b??null,digest:v??null}}function le(p,v){try{console.error(v.value)}catch(b){setTimeout(function(){throw b})}}var Se=typeof WeakMap=="function"?WeakMap:Map;function Ge(p,v,b){b=ki(-1,b),b.tag=3,b.payload={element:null};var D=v.value;return b.callback=function(){lE||(lE=!0,yC=D),le(p,v)},b}function ht(p,v,b){b=ki(-1,b),b.tag=3;var D=p.type.getDerivedStateFromError;if(typeof D=="function"){var G=v.value;b.payload=function(){return D(G)},b.callback=function(){le(p,v)}}var ee=p.stateNode;return ee!==null&&typeof ee.componentDidCatch=="function"&&(b.callback=function(){le(p,v),typeof D!="function"&&(dd===null?dd=new Set([this]):dd.add(this));var fe=v.stack;this.componentDidCatch(v.value,{componentStack:fe!==null?fe:""})}),b}function Rt(p,v,b){var D=p.pingCache;if(D===null){D=p.pingCache=new Se;var G=new Set;D.set(v,G)}else G=D.get(v),G===void 0&&(G=new Set,D.set(v,G));G.has(b)||(G.add(b),p=I$.bind(null,p,v,b),v.then(p,p))}function Jt(p){do{var v;if((v=p.tag===13)&&(v=p.memoizedState,v=v!==null?v.dehydrated!==null:!0),v)return p;p=p.return}while(p!==null);return null}function Hn(p,v,b,D,G){return(p.mode&1)===0?(p===v?p.flags|=65536:(p.flags|=128,b.flags|=131072,b.flags&=-52805,b.tag===1&&(b.alternate===null?b.tag=17:(v=ki(-1,1),v.tag=2,dr(b,v,1))),b.lanes|=1),p):(p.flags|=65536,p.lanes=G,p)}var wn=C.ReactCurrentOwner,Zn=!1;function jt(p,v,b,D){v.child=p===null?Up(v,null,b,D):Wh(v,p.child,b,D)}function js(p,v,b,D,G){b=b.render;var ee=v.ref;return Yu(v,G),D=Wp(p,v,b,D,ee,G),b=dy(),p!==null&&!Zn?(v.updateQueue=p.updateQueue,v.flags&=-2053,p.lanes&=~G,tf(p,v,G)):(ir&&b&&oy(v),v.flags|=1,jt(p,v,D,G),v.child)}function fa(p,v,b,D,G){if(p===null){var ee=b.type;return typeof ee=="function"&&!CC(ee)&&ee.defaultProps===void 0&&b.compare===null&&b.defaultProps===void 0?(v.tag=15,v.type=ee,et(p,v,ee,D,G)):(p=pE(b.type,null,D,v,v.mode,G),p.ref=v.ref,p.return=v,v.child=p)}if(ee=p.child,(p.lanes&G)===0){var fe=ee.memoizedProps;if(b=b.compare,b=b!==null?b:kh,b(fe,D)&&p.ref===v.ref)return tf(p,v,G)}return v.flags|=1,p=Ad(ee,D),p.ref=v.ref,p.return=v,v.child=p}function et(p,v,b,D,G){if(p!==null){var ee=p.memoizedProps;if(kh(ee,D)&&p.ref===v.ref)if(Zn=!1,v.pendingProps=D=ee,(p.lanes&G)!==0)(p.flags&131072)!==0&&(Zn=!0);else return v.lanes=p.lanes,tf(p,v,G)}return Vt(p,v,b,D,G)}function Qe(p,v,b){var D=v.pendingProps,G=D.children,ee=p!==null?p.memoizedState:null;if(D.mode==="hidden")if((v.mode&1)===0)v.memoizedState={baseLanes:0,cachePool:null,transitions:null},Gi(ag,Al),Al|=b;else{if((b&1073741824)===0)return p=ee!==null?ee.baseLanes|b:b,v.lanes=v.childLanes=1073741824,v.memoizedState={baseLanes:p,cachePool:null,transitions:null},v.updateQueue=null,Gi(ag,Al),Al|=p,null;v.memoizedState={baseLanes:0,cachePool:null,transitions:null},D=ee!==null?ee.baseLanes:b,Gi(ag,Al),Al|=D}else ee!==null?(D=ee.baseLanes|b,v.memoizedState=null):D=b,Gi(ag,Al),Al|=D;return jt(p,v,G,b),v.child}function at(p,v){var b=v.ref;(p===null&&b!==null||p!==null&&p.ref!==b)&&(v.flags|=512,v.flags|=2097152)}function Vt(p,v,b,D,G){var ee=uo(b)?Uc:Hs.current;return ee=Gh(v,ee),Yu(v,G),b=Wp(p,v,b,D,ee,G),D=dy(),p!==null&&!Zn?(v.updateQueue=p.updateQueue,v.flags&=-2053,p.lanes&=~G,tf(p,v,G)):(ir&&D&&oy(v),v.flags|=1,jt(p,v,b,G),v.child)}function on(p,v,b,D,G){if(uo(b)){var ee=!0;Hh(v)}else ee=!1;if(Yu(v,G),v.stateNode===null)iE(p,v),_(v,b,D),B(v,b,D,G),D=!0;else if(p===null){var fe=v.stateNode,Ie=v.memoizedProps;fe.props=Ie;var Ne=fe.context,rt=b.contextType;typeof rt=="object"&&rt!==null?rt=la(rt):(rt=uo(b)?Uc:Hs.current,rt=Gh(v,rt));var Ct=b.getDerivedStateFromProps,Tt=typeof Ct=="function"||typeof fe.getSnapshotBeforeUpdate=="function";Tt||typeof fe.UNSAFE_componentWillReceiveProps!="function"&&typeof fe.componentWillReceiveProps!="function"||(Ie!==D||Ne!==rt)&&S(v,fe,D,rt),Di=!1;var wt=v.memoizedState;fe.state=wt,Lr(v,D,fe,G),Ne=v.memoizedState,Ie!==D||wt!==Ne||Co.current||Di?(typeof Ct=="function"&&(Xp(v,b,Ct,D),Ne=v.memoizedState),(Ie=Di||tE(v,b,Ie,D,wt,Ne,rt))?(Tt||typeof fe.UNSAFE_componentWillMount!="function"&&typeof fe.componentWillMount!="function"||(typeof fe.componentWillMount=="function"&&fe.componentWillMount(),typeof fe.UNSAFE_componentWillMount=="function"&&fe.UNSAFE_componentWillMount()),typeof fe.componentDidMount=="function"&&(v.flags|=4194308)):(typeof fe.componentDidMount=="function"&&(v.flags|=4194308),v.memoizedProps=D,v.memoizedState=Ne),fe.props=D,fe.state=Ne,fe.context=rt,D=Ie):(typeof fe.componentDidMount=="function"&&(v.flags|=4194308),D=!1)}else{fe=v.stateNode,Gr(p,v),Ie=v.memoizedProps,rt=v.type===v.elementType?Ie:Fa(v.type,Ie),fe.props=rt,Tt=v.pendingProps,wt=fe.context,Ne=b.contextType,typeof Ne=="object"&&Ne!==null?Ne=la(Ne):(Ne=uo(b)?Uc:Hs.current,Ne=Gh(v,Ne));var $t=b.getDerivedStateFromProps;(Ct=typeof $t=="function"||typeof fe.getSnapshotBeforeUpdate=="function")||typeof fe.UNSAFE_componentWillReceiveProps!="function"&&typeof fe.componentWillReceiveProps!="function"||(Ie!==Tt||wt!==Ne)&&S(v,fe,D,Ne),Di=!1,wt=v.memoizedState,fe.state=wt,Lr(v,D,fe,G);var tn=v.memoizedState;Ie!==Tt||wt!==tn||Co.current||Di?(typeof $t=="function"&&(Xp(v,b,$t,D),tn=v.memoizedState),(rt=Di||tE(v,b,rt,D,wt,tn,Ne)||!1)?(Ct||typeof fe.UNSAFE_componentWillUpdate!="function"&&typeof fe.componentWillUpdate!="function"||(typeof fe.componentWillUpdate=="function"&&fe.componentWillUpdate(D,tn,Ne),typeof fe.UNSAFE_componentWillUpdate=="function"&&fe.UNSAFE_componentWillUpdate(D,tn,Ne)),typeof fe.componentDidUpdate=="function"&&(v.flags|=4),typeof fe.getSnapshotBeforeUpdate=="function"&&(v.flags|=1024)):(typeof fe.componentDidUpdate!="function"||Ie===p.memoizedProps&&wt===p.memoizedState||(v.flags|=4),typeof fe.getSnapshotBeforeUpdate!="function"||Ie===p.memoizedProps&&wt===p.memoizedState||(v.flags|=1024),v.memoizedProps=D,v.memoizedState=tn),fe.props=D,fe.state=tn,fe.context=Ne,D=rt):(typeof fe.componentDidUpdate!="function"||Ie===p.memoizedProps&&wt===p.memoizedState||(v.flags|=4),typeof fe.getSnapshotBeforeUpdate!="function"||Ie===p.memoizedProps&&wt===p.memoizedState||(v.flags|=1024),D=!1)}return Kn(p,v,b,D,ee,G)}function Kn(p,v,b,D,G,ee){at(p,v);var fe=(v.flags&128)!==0;if(!D&&!fe)return G&&ry(v,b,!1),tf(p,v,ee);D=v.stateNode,wn.current=v;var Ie=fe&&typeof b.getDerivedStateFromError!="function"?null:D.render();return v.flags|=1,p!==null&&fe?(v.child=Wh(v,p.child,null,ee),v.child=Wh(v,null,Ie,ee)):jt(p,v,Ie,ee),v.memoizedState=D.state,G&&ry(v,b,!0),v.child}function Qn(p){var v=p.stateNode;v.pendingContext?iy(p,v.pendingContext,v.pendingContext!==v.context):v.context&&iy(p,v.context,!1),Qp(p,v.containerInfo)}function pi(p,v,b,D,G){return $u(),od(G),v.flags|=256,jt(p,v,b,D),v.child}var qr={dehydrated:null,treeContext:null,retryLane:0};function hi(p){return{baseLanes:p,cachePool:null,transitions:null}}function $c(p,v,b){var D=v.pendingProps,G=rr.current,ee=!1,fe=(v.flags&128)!==0,Ie;if((Ie=fe)||(Ie=p!==null&&p.memoizedState===null?!1:(G&2)!==0),Ie?(ee=!0,v.flags&=-129):(p===null||p.memoizedState!==null)&&(G|=1),Gi(rr,G&1),p===null)return X0(v),p=v.memoizedState,p!==null&&(p=p.dehydrated,p!==null)?((v.mode&1)===0?v.lanes=1:p.data==="$!"?v.lanes=8:v.lanes=1073741824,null):(fe=D.children,p=D.fallback,ee?(D=v.mode,ee=v.child,fe={mode:"hidden",children:fe},(D&1)===0&&ee!==null?(ee.childLanes=0,ee.pendingProps=fe):ee=mE(fe,D,0,null),p=tm(p,D,b,null),ee.return=v,p.return=v,ee.sibling=p,v.child=ee,v.child.memoizedState=hi(b),v.memoizedState=qr,p):Ey(v,fe));if(G=p.memoizedState,G!==null&&(Ie=G.dehydrated,Ie!==null))return g$(p,v,fe,D,Ie,G,b);if(ee){ee=D.fallback,fe=v.mode,G=p.child,Ie=G.sibling;var Ne={mode:"hidden",children:D.children};return(fe&1)===0&&v.child!==G?(D=v.child,D.childLanes=0,D.pendingProps=Ne,v.deletions=null):(D=Ad(G,Ne),D.subtreeFlags=G.subtreeFlags&14680064),Ie!==null?ee=Ad(Ie,ee):(ee=tm(ee,fe,b,null),ee.flags|=2),ee.return=v,D.return=v,D.sibling=ee,v.child=D,D=ee,ee=v.child,fe=p.child.memoizedState,fe=fe===null?hi(b):{baseLanes:fe.baseLanes|b,cachePool:null,transitions:fe.transitions},ee.memoizedState=fe,ee.childLanes=p.childLanes&~b,v.memoizedState=qr,D}return ee=p.child,p=ee.sibling,D=Ad(ee,{mode:"visible",children:D.children}),(v.mode&1)===0&&(D.lanes=b),D.return=v,D.sibling=null,p!==null&&(b=v.deletions,b===null?(v.deletions=[p],v.flags|=16):b.push(p)),v.child=D,v.memoizedState=null,D}function Ey(p,v){return v=mE({mode:"visible",children:v},p.mode,0,null),v.return=p,p.child=v}function nE(p,v,b,D){return D!==null&&od(D),Wh(v,p.child,null,b),p=Ey(v,v.pendingProps.children),p.flags|=2,v.memoizedState=null,p}function g$(p,v,b,D,G,ee,fe){if(b)return v.flags&256?(v.flags&=-257,D=j(Error(t(422))),nE(p,v,fe,D)):v.memoizedState!==null?(v.child=p.child,v.flags|=128,null):(ee=D.fallback,G=v.mode,D=mE({mode:"visible",children:D.children},G,0,null),ee=tm(ee,G,fe,null),ee.flags|=2,D.return=v,ee.return=v,D.sibling=ee,v.child=D,(v.mode&1)!==0&&Wh(v,p.child,null,fe),v.child.memoizedState=hi(fe),v.memoizedState=qr,ee);if((v.mode&1)===0)return nE(p,v,fe,null);if(G.data==="$!"){if(D=G.nextSibling&&G.nextSibling.dataset,D)var Ie=D.dgst;return D=Ie,ee=Error(t(419)),D=j(ee,D,void 0),nE(p,v,fe,D)}if(Ie=(fe&p.childLanes)!==0,Zn||Ie){if(D=po,D!==null){switch(fe&-fe){case 4:G=2;break;case 16:G=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:G=32;break;case 536870912:G=268435456;break;default:G=0}G=(G&(D.suspendedLanes|fe))!==0?0:G,G!==0&&G!==ee.retryLane&&(ee.retryLane=G,dl(p,G),qc(D,p,G,-1))}return wC(),D=j(Error(t(421))),nE(p,v,fe,D)}return G.data==="$?"?(v.flags|=128,v.child=p.child,v=M$.bind(null,p),G._reactRetry=v,null):(p=ee.treeContext,bo=Fc(G.nextSibling),Qs=v,ir=!0,ka=null,p!==null&&(To[Rs++]=kt,To[Rs++]=Da,To[Rs++]=Vh,kt=p.id,Da=p.overflow,Vh=v),v=Ey(v,D.children),v.flags|=4096,v)}function hL(p,v,b){p.lanes|=v;var D=p.alternate;D!==null&&(D.lanes|=v),Gp(p.return,v,b)}function cC(p,v,b,D,G){var ee=p.memoizedState;ee===null?p.memoizedState={isBackwards:v,rendering:null,renderingStartTime:0,last:D,tail:b,tailMode:G}:(ee.isBackwards=v,ee.rendering=null,ee.renderingStartTime=0,ee.last=D,ee.tail=b,ee.tailMode=G)}function fL(p,v,b){var D=v.pendingProps,G=D.revealOrder,ee=D.tail;if(jt(p,v,D.children,b),D=rr.current,(D&2)!==0)D=D&1|2,v.flags|=128;else{if(p!==null&&(p.flags&128)!==0)e:for(p=v.child;p!==null;){if(p.tag===13)p.memoizedState!==null&&hL(p,b,v);else if(p.tag===19)hL(p,b,v);else if(p.child!==null){p.child.return=p,p=p.child;continue}if(p===v)break e;for(;p.sibling===null;){if(p.return===null||p.return===v)break e;p=p.return}p.sibling.return=p.return,p=p.sibling}D&=1}if(Gi(rr,D),(v.mode&1)===0)v.memoizedState=null;else switch(G){case"forwards":for(b=v.child,G=null;b!==null;)p=b.alternate,p!==null&&pl(p)===null&&(G=b),b=b.sibling;b=G,b===null?(G=v.child,v.child=null):(G=b.sibling,b.sibling=null),cC(v,!1,G,b,ee);break;case"backwards":for(b=null,G=v.child,v.child=null;G!==null;){if(p=G.alternate,p!==null&&pl(p)===null){v.child=G;break}p=G.sibling,G.sibling=b,b=G,G=p}cC(v,!0,b,null,ee);break;case"together":cC(v,!1,null,null,void 0);break;default:v.memoizedState=null}return v.child}function iE(p,v){(v.mode&1)===0&&p!==null&&(p.alternate=null,v.alternate=null,v.flags|=2)}function tf(p,v,b){if(p!==null&&(v.dependencies=p.dependencies),qp|=v.lanes,(b&v.childLanes)===0)return null;if(p!==null&&v.child!==p.child)throw Error(t(153));if(v.child!==null){for(p=v.child,b=Ad(p,p.pendingProps),v.child=b,b.return=v;p.sibling!==null;)p=p.sibling,b=b.sibling=Ad(p,p.pendingProps),b.return=v;b.sibling=null}return v.child}function A$(p,v,b){switch(v.tag){case 3:Qn(v),$u();break;case 5:qh(v);break;case 1:uo(v.type)&&Hh(v);break;case 4:Qp(v,v.stateNode.containerInfo);break;case 10:var D=v.type._context,G=v.memoizedProps.value;Gi(jh,D._currentValue),D._currentValue=G;break;case 13:if(D=v.memoizedState,D!==null)return D.dehydrated!==null?(Gi(rr,rr.current&1),v.flags|=128,null):(b&v.child.childLanes)!==0?$c(p,v,b):(Gi(rr,rr.current&1),p=tf(p,v,b),p!==null?p.sibling:null);Gi(rr,rr.current&1);break;case 19:if(D=(b&v.childLanes)!==0,(p.flags&128)!==0){if(D)return fL(p,v,b);v.flags|=128}if(G=v.memoizedState,G!==null&&(G.rendering=null,G.tail=null,G.lastEffect=null),Gi(rr,rr.current),D)break;return null;case 22:case 23:return v.lanes=0,Qe(p,v,b)}return tf(p,v,b)}var dL,uC,pL,mL;dL=function(p,v){for(var b=v.child;b!==null;){if(b.tag===5||b.tag===6)p.appendChild(b.stateNode);else if(b.tag!==4&&b.child!==null){b.child.return=b,b=b.child;continue}if(b===v)break;for(;b.sibling===null;){if(b.return===null||b.return===v)return;b=b.return}b.sibling.return=b.return,b=b.sibling}},uC=function(){},pL=function(p,v,b,D){var G=p.memoizedProps;if(G!==D){p=v.stateNode,Xr(ca.current);var ee=null;switch(b){case"input":G=Ee(p,G),D=Ee(p,D),ee=[];break;case"select":G=Y({},G,{value:void 0}),D=Y({},D,{value:void 0}),ee=[];break;case"textarea":G=Re(p,G),D=Re(p,D),ee=[];break;default:typeof G.onClick!="function"&&typeof D.onClick=="function"&&(p.onclick=Pp)}be(b,D);var fe;b=null;for(rt in G)if(!D.hasOwnProperty(rt)&&G.hasOwnProperty(rt)&&G[rt]!=null)if(rt==="style"){var Ie=G[rt];for(fe in Ie)Ie.hasOwnProperty(fe)&&(b||(b={}),b[fe]="")}else rt!=="dangerouslySetInnerHTML"&&rt!=="children"&&rt!=="suppressContentEditableWarning"&&rt!=="suppressHydrationWarning"&&rt!=="autoFocus"&&(r.hasOwnProperty(rt)?ee||(ee=[]):(ee=ee||[]).push(rt,null));for(rt in D){var Ne=D[rt];if(Ie=G!=null?G[rt]:void 0,D.hasOwnProperty(rt)&&Ne!==Ie&&(Ne!=null||Ie!=null))if(rt==="style")if(Ie){for(fe in Ie)!Ie.hasOwnProperty(fe)||Ne&&Ne.hasOwnProperty(fe)||(b||(b={}),b[fe]="");for(fe in Ne)Ne.hasOwnProperty(fe)&&Ie[fe]!==Ne[fe]&&(b||(b={}),b[fe]=Ne[fe])}else b||(ee||(ee=[]),ee.push(rt,b)),b=Ne;else rt==="dangerouslySetInnerHTML"?(Ne=Ne?Ne.__html:void 0,Ie=Ie?Ie.__html:void 0,Ne!=null&&Ie!==Ne&&(ee=ee||[]).push(rt,Ne)):rt==="children"?typeof Ne!="string"&&typeof Ne!="number"||(ee=ee||[]).push(rt,""+Ne):rt!=="suppressContentEditableWarning"&&rt!=="suppressHydrationWarning"&&(r.hasOwnProperty(rt)?(Ne!=null&&rt==="onScroll"&&$i("scroll",p),ee||Ie===Ne||(ee=[])):(ee=ee||[]).push(rt,Ne))}b&&(ee=ee||[]).push("style",b);var rt=ee;(v.updateQueue=rt)&&(v.flags|=4)}},mL=function(p,v,b,D){b!==D&&(v.flags|=4)};function _y(p,v){if(!ir)switch(p.tailMode){case"hidden":v=p.tail;for(var b=null;v!==null;)v.alternate!==null&&(b=v),v=v.sibling;b===null?p.tail=null:b.sibling=null;break;case"collapsed":b=p.tail;for(var D=null;b!==null;)b.alternate!==null&&(D=b),b=b.sibling;D===null?v||p.tail===null?p.tail=null:p.tail.sibling=null:D.sibling=null}}function Wo(p){var v=p.alternate!==null&&p.alternate.child===p.child,b=0,D=0;if(v)for(var G=p.child;G!==null;)b|=G.lanes|G.childLanes,D|=G.subtreeFlags&14680064,D|=G.flags&14680064,G.return=p,G=G.sibling;else for(G=p.child;G!==null;)b|=G.lanes|G.childLanes,D|=G.subtreeFlags,D|=G.flags,G.return=p,G=G.sibling;return p.subtreeFlags|=D,p.childLanes=b,v}function y$(p,v,b){var D=v.pendingProps;switch(Gc(v),v.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Wo(v),null;case 1:return uo(v.type)&&Bp(),Wo(v),null;case 3:return D=v.stateNode,Xu(),Yi(Co),Yi(Hs),Kl(),D.pendingContext&&(D.context=D.pendingContext,D.pendingContext=null),(p===null||p.child===null)&&(sd(v)?v.flags|=4:p===null||p.memoizedState.isDehydrated&&(v.flags&256)===0||(v.flags|=1024,ka!==null&&(EC(ka),ka=null))),uC(p,v),Wo(v),null;case 5:cd(v);var G=Xr(Vc.current);if(b=v.type,p!==null&&v.stateNode!=null)pL(p,v,b,D,G),p.ref!==v.ref&&(v.flags|=512,v.flags|=2097152);else{if(!D){if(v.stateNode===null)throw Error(t(166));return Wo(v),null}if(p=Xr(ca.current),sd(v)){D=v.stateNode,b=v.type;var ee=v.memoizedProps;switch(D[hs]=v,D[rd]=ee,p=(v.mode&1)!==0,b){case"dialog":$i("cancel",D),$i("close",D);break;case"iframe":case"object":case"embed":$i("load",D);break;case"video":case"audio":for(G=0;G<ju.length;G++)$i(ju[G],D);break;case"source":$i("error",D);break;case"img":case"image":case"link":$i("error",D),$i("load",D);break;case"details":$i("toggle",D);break;case"input":ve(D,ee),$i("invalid",D);break;case"select":D._wrapperState={wasMultiple:!!ee.multiple},$i("invalid",D);break;case"textarea":Be(D,ee),$i("invalid",D)}be(b,ee),G=null;for(var fe in ee)if(ee.hasOwnProperty(fe)){var Ie=ee[fe];fe==="children"?typeof Ie=="string"?D.textContent!==Ie&&(ee.suppressHydrationWarning!==!0&&Lp(D.textContent,Ie,p),G=["children",Ie]):typeof Ie=="number"&&D.textContent!==""+Ie&&(ee.suppressHydrationWarning!==!0&&Lp(D.textContent,Ie,p),G=["children",""+Ie]):r.hasOwnProperty(fe)&&Ie!=null&&fe==="onScroll"&&$i("scroll",D)}switch(b){case"input":pe(D),Te(D,ee,!0);break;case"textarea":pe(D),He(D);break;case"select":case"option":break;default:typeof ee.onClick=="function"&&(D.onclick=Pp)}D=G,v.updateQueue=D,D!==null&&(v.flags|=4)}else{fe=G.nodeType===9?G:G.ownerDocument,p==="http://www.w3.org/1999/xhtml"&&(p=it(b)),p==="http://www.w3.org/1999/xhtml"?b==="script"?(p=fe.createElement("div"),p.innerHTML="<script><\/script>",p=p.removeChild(p.firstChild)):typeof D.is=="string"?p=fe.createElement(b,{is:D.is}):(p=fe.createElement(b),b==="select"&&(fe=p,D.multiple?fe.multiple=!0:D.size&&(fe.size=D.size))):p=fe.createElementNS(p,b),p[hs]=v,p[rd]=D,dL(p,v,!1,!1),v.stateNode=p;e:{switch(fe=qe(b,D),b){case"dialog":$i("cancel",p),$i("close",p),G=D;break;case"iframe":case"object":case"embed":$i("load",p),G=D;break;case"video":case"audio":for(G=0;G<ju.length;G++)$i(ju[G],p);G=D;break;case"source":$i("error",p),G=D;break;case"img":case"image":case"link":$i("error",p),$i("load",p),G=D;break;case"details":$i("toggle",p),G=D;break;case"input":ve(p,D),G=Ee(p,D),$i("invalid",p);break;case"option":G=D;break;case"select":p._wrapperState={wasMultiple:!!D.multiple},G=Y({},D,{value:void 0}),$i("invalid",p);break;case"textarea":Be(p,D),G=Re(p,D),$i("invalid",p);break;default:G=D}be(b,G),Ie=G;for(ee in Ie)if(Ie.hasOwnProperty(ee)){var Ne=Ie[ee];ee==="style"?gt(p,Ne):ee==="dangerouslySetInnerHTML"?(Ne=Ne?Ne.__html:void 0,Ne!=null&&pt(p,Ne)):ee==="children"?typeof Ne=="string"?(b!=="textarea"||Ne!=="")&&We(p,Ne):typeof Ne=="number"&&We(p,""+Ne):ee!=="suppressContentEditableWarning"&&ee!=="suppressHydrationWarning"&&ee!=="autoFocus"&&(r.hasOwnProperty(ee)?Ne!=null&&ee==="onScroll"&&$i("scroll",p):Ne!=null&&x(p,ee,Ne,fe))}switch(b){case"input":pe(p),Te(p,D,!1);break;case"textarea":pe(p),He(p);break;case"option":D.value!=null&&p.setAttribute("value",""+se(D.value));break;case"select":p.multiple=!!D.multiple,ee=D.value,ee!=null?de(p,!!D.multiple,ee,!1):D.defaultValue!=null&&de(p,!!D.multiple,D.defaultValue,!0);break;default:typeof G.onClick=="function"&&(p.onclick=Pp)}switch(b){case"button":case"input":case"select":case"textarea":D=!!D.autoFocus;break e;case"img":D=!0;break e;default:D=!1}}D&&(v.flags|=4)}v.ref!==null&&(v.flags|=512,v.flags|=2097152)}return Wo(v),null;case 6:if(p&&v.stateNode!=null)mL(p,v,p.memoizedProps,D);else{if(typeof D!="string"&&v.stateNode===null)throw Error(t(166));if(b=Xr(Vc.current),Xr(ca.current),sd(v)){if(D=v.stateNode,b=v.memoizedProps,D[hs]=v,(ee=D.nodeValue!==b)&&(p=Qs,p!==null))switch(p.tag){case 3:Lp(D.nodeValue,b,(p.mode&1)!==0);break;case 5:p.memoizedProps.suppressHydrationWarning!==!0&&Lp(D.nodeValue,b,(p.mode&1)!==0)}ee&&(v.flags|=4)}else D=(b.nodeType===9?b:b.ownerDocument).createTextNode(D),D[hs]=v,v.stateNode=D}return Wo(v),null;case 13:if(Yi(rr),D=v.memoizedState,p===null||p.memoizedState!==null&&p.memoizedState.dehydrated!==null){if(ir&&bo!==null&&(v.mode&1)!==0&&(v.flags&128)===0)cy(),$u(),v.flags|=98560,ee=!1;else if(ee=sd(v),D!==null&&D.dehydrated!==null){if(p===null){if(!ee)throw Error(t(318));if(ee=v.memoizedState,ee=ee!==null?ee.dehydrated:null,!ee)throw Error(t(317));ee[hs]=v}else $u(),(v.flags&128)===0&&(v.memoizedState=null),v.flags|=4;Wo(v),ee=!1}else ka!==null&&(EC(ka),ka=null),ee=!0;if(!ee)return v.flags&65536?v:null}return(v.flags&128)!==0?(v.lanes=b,v):(D=D!==null,D!==(p!==null&&p.memoizedState!==null)&&D&&(v.child.flags|=8192,(v.mode&1)!==0&&(p===null||(rr.current&1)!==0?Ks===0&&(Ks=3):wC())),v.updateQueue!==null&&(v.flags|=4),Wo(v),null);case 4:return Xu(),uC(p,v),p===null&&td(v.stateNode.containerInfo),Wo(v),null;case 10:return zp(v.type._context),Wo(v),null;case 17:return uo(v.type)&&Bp(),Wo(v),null;case 19:if(Yi(rr),ee=v.memoizedState,ee===null)return Wo(v),null;if(D=(v.flags&128)!==0,fe=ee.rendering,fe===null)if(D)_y(ee,!1);else{if(Ks!==0||p!==null&&(p.flags&128)!==0)for(p=v.child;p!==null;){if(fe=pl(p),fe!==null){for(v.flags|=128,_y(ee,!1),D=fe.updateQueue,D!==null&&(v.updateQueue=D,v.flags|=4),v.subtreeFlags=0,D=b,b=v.child;b!==null;)ee=b,p=D,ee.flags&=14680066,fe=ee.alternate,fe===null?(ee.childLanes=0,ee.lanes=p,ee.child=null,ee.subtreeFlags=0,ee.memoizedProps=null,ee.memoizedState=null,ee.updateQueue=null,ee.dependencies=null,ee.stateNode=null):(ee.childLanes=fe.childLanes,ee.lanes=fe.lanes,ee.child=fe.child,ee.subtreeFlags=0,ee.deletions=null,ee.memoizedProps=fe.memoizedProps,ee.memoizedState=fe.memoizedState,ee.updateQueue=fe.updateQueue,ee.type=fe.type,p=fe.dependencies,ee.dependencies=p===null?null:{lanes:p.lanes,firstContext:p.firstContext}),b=b.sibling;return Gi(rr,rr.current&1|2),v.child}p=p.sibling}ee.tail!==null&&Oe()>lg&&(v.flags|=128,D=!0,_y(ee,!1),v.lanes=4194304)}else{if(!D)if(p=pl(fe),p!==null){if(v.flags|=128,D=!0,b=p.updateQueue,b!==null&&(v.updateQueue=b,v.flags|=4),_y(ee,!0),ee.tail===null&&ee.tailMode==="hidden"&&!fe.alternate&&!ir)return Wo(v),null}else 2*Oe()-ee.renderingStartTime>lg&&b!==1073741824&&(v.flags|=128,D=!0,_y(ee,!1),v.lanes=4194304);ee.isBackwards?(fe.sibling=v.child,v.child=fe):(b=ee.last,b!==null?b.sibling=fe:v.child=fe,ee.last=fe)}return ee.tail!==null?(v=ee.tail,ee.rendering=v,ee.tail=v.sibling,ee.renderingStartTime=Oe(),v.sibling=null,b=rr.current,Gi(rr,D?b&1|2:b&1),v):(Wo(v),null);case 22:case 23:return SC(),D=v.memoizedState!==null,p!==null&&p.memoizedState!==null!==D&&(v.flags|=8192),D&&(v.mode&1)!==0?(Al&1073741824)!==0&&(Wo(v),v.subtreeFlags&6&&(v.flags|=8192)):Wo(v),null;case 24:return null;case 25:return null}throw Error(t(156,v.tag))}function v$(p,v){switch(Gc(v),v.tag){case 1:return uo(v.type)&&Bp(),p=v.flags,p&65536?(v.flags=p&-65537|128,v):null;case 3:return Xu(),Yi(Co),Yi(Hs),Kl(),p=v.flags,(p&65536)!==0&&(p&128)===0?(v.flags=p&-65537|128,v):null;case 5:return cd(v),null;case 13:if(Yi(rr),p=v.memoizedState,p!==null&&p.dehydrated!==null){if(v.alternate===null)throw Error(t(340));$u()}return p=v.flags,p&65536?(v.flags=p&-65537|128,v):null;case 19:return Yi(rr),null;case 4:return Xu(),null;case 10:return zp(v.type._context),null;case 22:case 23:return SC(),null;case 24:return null;default:return null}}var rE=!1,jo=!1,x$=typeof WeakSet=="function"?WeakSet:Set,Zt=null;function og(p,v){var b=p.ref;if(b!==null)if(typeof b=="function")try{b(null)}catch(D){Jr(p,v,D)}else b.current=null}function hC(p,v,b){try{b()}catch(D){Jr(p,v,D)}}var gL=!1;function E$(p,v){if(id=Ss,p=_r(),Ts(p)){if("selectionStart"in p)var b={start:p.selectionStart,end:p.selectionEnd};else e:{b=(b=p.ownerDocument)&&b.defaultView||window;var D=b.getSelection&&b.getSelection();if(D&&D.rangeCount!==0){b=D.anchorNode;var G=D.anchorOffset,ee=D.focusNode;D=D.focusOffset;try{b.nodeType,ee.nodeType}catch{b=null;break e}var fe=0,Ie=-1,Ne=-1,rt=0,Ct=0,Tt=p,wt=null;t:for(;;){for(var $t;Tt!==b||G!==0&&Tt.nodeType!==3||(Ie=fe+G),Tt!==ee||D!==0&&Tt.nodeType!==3||(Ne=fe+D),Tt.nodeType===3&&(fe+=Tt.nodeValue.length),($t=Tt.firstChild)!==null;)wt=Tt,Tt=$t;for(;;){if(Tt===p)break t;if(wt===b&&++rt===G&&(Ie=fe),wt===ee&&++Ct===D&&(Ne=fe),($t=Tt.nextSibling)!==null)break;Tt=wt,wt=Tt.parentNode}Tt=$t}b=Ie===-1||Ne===-1?null:{start:Ie,end:Ne}}else b=null}b=b||{start:0,end:0}}else b=null;for(qA={focusedElem:p,selectionRange:b},Ss=!1,Zt=v;Zt!==null;)if(v=Zt,p=v.child,(v.subtreeFlags&1028)!==0&&p!==null)p.return=v,Zt=p;else for(;Zt!==null;){v=Zt;try{var tn=v.alternate;if((v.flags&1024)!==0)switch(v.tag){case 0:case 11:case 15:break;case 1:if(tn!==null){var nn=tn.memoizedProps,fs=tn.memoizedState,Ye=v.stateNode,ze=Ye.getSnapshotBeforeUpdate(v.elementType===v.type?nn:Fa(v.type,nn),fs);Ye.__reactInternalSnapshotBeforeUpdate=ze}break;case 3:var Ze=v.stateNode.containerInfo;Ze.nodeType===1?Ze.textContent="":Ze.nodeType===9&&Ze.documentElement&&Ze.removeChild(Ze.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(t(163))}}catch(Lt){Jr(v,v.return,Lt)}if(p=v.sibling,p!==null){p.return=v.return,Zt=p;break}Zt=v.return}return tn=gL,gL=!1,tn}function Sy(p,v,b){var D=v.updateQueue;if(D=D!==null?D.lastEffect:null,D!==null){var G=D=D.next;do{if((G.tag&p)===p){var ee=G.destroy;G.destroy=void 0,ee!==void 0&&hC(v,b,ee)}G=G.next}while(G!==D)}}function sE(p,v){if(v=v.updateQueue,v=v!==null?v.lastEffect:null,v!==null){var b=v=v.next;do{if((b.tag&p)===p){var D=b.create;b.destroy=D()}b=b.next}while(b!==v)}}function fC(p){var v=p.ref;if(v!==null){var b=p.stateNode;switch(p.tag){case 5:p=b;break;default:p=b}typeof v=="function"?v(p):v.current=p}}function AL(p){var v=p.alternate;v!==null&&(p.alternate=null,AL(v)),p.child=null,p.deletions=null,p.sibling=null,p.tag===5&&(v=p.stateNode,v!==null&&(delete v[hs],delete v[rd],delete v[zh],delete v[Q0],delete v[V0])),p.stateNode=null,p.return=null,p.dependencies=null,p.memoizedProps=null,p.memoizedState=null,p.pendingProps=null,p.stateNode=null,p.updateQueue=null}function yL(p){return p.tag===5||p.tag===3||p.tag===4}function vL(p){e:for(;;){for(;p.sibling===null;){if(p.return===null||yL(p.return))return null;p=p.return}for(p.sibling.return=p.return,p=p.sibling;p.tag!==5&&p.tag!==6&&p.tag!==18;){if(p.flags&2||p.child===null||p.tag===4)continue e;p.child.return=p,p=p.child}if(!(p.flags&2))return p.stateNode}}function dC(p,v,b){var D=p.tag;if(D===5||D===6)p=p.stateNode,v?b.nodeType===8?b.parentNode.insertBefore(p,v):b.insertBefore(p,v):(b.nodeType===8?(v=b.parentNode,v.insertBefore(p,b)):(v=b,v.appendChild(p)),b=b._reactRootContainer,b!=null||v.onclick!==null||(v.onclick=Pp));else if(D!==4&&(p=p.child,p!==null))for(dC(p,v,b),p=p.sibling;p!==null;)dC(p,v,b),p=p.sibling}function pC(p,v,b){var D=p.tag;if(D===5||D===6)p=p.stateNode,v?b.insertBefore(p,v):b.appendChild(p);else if(D!==4&&(p=p.child,p!==null))for(pC(p,v,b),p=p.sibling;p!==null;)pC(p,v,b),p=p.sibling}var Mo=null,Yc=!1;function fd(p,v,b){for(b=b.child;b!==null;)xL(p,v,b),b=b.sibling}function xL(p,v,b){if(Dt&&typeof Dt.onCommitFiberUnmount=="function")try{Dt.onCommitFiberUnmount(vn,b)}catch{}switch(b.tag){case 5:jo||og(b,v);case 6:var D=Mo,G=Yc;Mo=null,fd(p,v,b),Mo=D,Yc=G,Mo!==null&&(Yc?(p=Mo,b=b.stateNode,p.nodeType===8?p.parentNode.removeChild(b):p.removeChild(b)):Mo.removeChild(b.stateNode));break;case 18:Mo!==null&&(Yc?(p=Mo,b=b.stateNode,p.nodeType===8?H0(p.parentNode,b):p.nodeType===1&&H0(p,b),Nu(p)):H0(Mo,b.stateNode));break;case 4:D=Mo,G=Yc,Mo=b.stateNode.containerInfo,Yc=!0,fd(p,v,b),Mo=D,Yc=G;break;case 0:case 11:case 14:case 15:if(!jo&&(D=b.updateQueue,D!==null&&(D=D.lastEffect,D!==null))){G=D=D.next;do{var ee=G,fe=ee.destroy;ee=ee.tag,fe!==void 0&&((ee&2)!==0||(ee&4)!==0)&&hC(b,v,fe),G=G.next}while(G!==D)}fd(p,v,b);break;case 1:if(!jo&&(og(b,v),D=b.stateNode,typeof D.componentWillUnmount=="function"))try{D.props=b.memoizedProps,D.state=b.memoizedState,D.componentWillUnmount()}catch(Ie){Jr(b,v,Ie)}fd(p,v,b);break;case 21:fd(p,v,b);break;case 22:b.mode&1?(jo=(D=jo)||b.memoizedState!==null,fd(p,v,b),jo=D):fd(p,v,b);break;default:fd(p,v,b)}}function EL(p){var v=p.updateQueue;if(v!==null){p.updateQueue=null;var b=p.stateNode;b===null&&(b=p.stateNode=new x$),v.forEach(function(D){var G=R$.bind(null,p,D);b.has(D)||(b.add(D),D.then(G,G))})}}function Xc(p,v){var b=v.deletions;if(b!==null)for(var D=0;D<b.length;D++){var G=b[D];try{var ee=p,fe=v,Ie=fe;e:for(;Ie!==null;){switch(Ie.tag){case 5:Mo=Ie.stateNode,Yc=!1;break e;case 3:Mo=Ie.stateNode.containerInfo,Yc=!0;break e;case 4:Mo=Ie.stateNode.containerInfo,Yc=!0;break e}Ie=Ie.return}if(Mo===null)throw Error(t(160));xL(ee,fe,G),Mo=null,Yc=!1;var Ne=G.alternate;Ne!==null&&(Ne.return=null),G.return=null}catch(rt){Jr(G,v,rt)}}if(v.subtreeFlags&12854)for(v=v.child;v!==null;)_L(v,p),v=v.sibling}function _L(p,v){var b=p.alternate,D=p.flags;switch(p.tag){case 0:case 11:case 14:case 15:if(Xc(v,p),Ju(p),D&4){try{Sy(3,p,p.return),sE(3,p)}catch(nn){Jr(p,p.return,nn)}try{Sy(5,p,p.return)}catch(nn){Jr(p,p.return,nn)}}break;case 1:Xc(v,p),Ju(p),D&512&&b!==null&&og(b,b.return);break;case 5:if(Xc(v,p),Ju(p),D&512&&b!==null&&og(b,b.return),p.flags&32){var G=p.stateNode;try{We(G,"")}catch(nn){Jr(p,p.return,nn)}}if(D&4&&(G=p.stateNode,G!=null)){var ee=p.memoizedProps,fe=b!==null?b.memoizedProps:ee,Ie=p.type,Ne=p.updateQueue;if(p.updateQueue=null,Ne!==null)try{Ie==="input"&&ee.type==="radio"&&ee.name!=null&&Ae(G,ee),qe(Ie,fe);var rt=qe(Ie,ee);for(fe=0;fe<Ne.length;fe+=2){var Ct=Ne[fe],Tt=Ne[fe+1];Ct==="style"?gt(G,Tt):Ct==="dangerouslySetInnerHTML"?pt(G,Tt):Ct==="children"?We(G,Tt):x(G,Ct,Tt,rt)}switch(Ie){case"input":Le(G,ee);break;case"textarea":Fe(G,ee);break;case"select":var wt=G._wrapperState.wasMultiple;G._wrapperState.wasMultiple=!!ee.multiple;var $t=ee.value;$t!=null?de(G,!!ee.multiple,$t,!1):wt!==!!ee.multiple&&(ee.defaultValue!=null?de(G,!!ee.multiple,ee.defaultValue,!0):de(G,!!ee.multiple,ee.multiple?[]:"",!1))}G[rd]=ee}catch(nn){Jr(p,p.return,nn)}}break;case 6:if(Xc(v,p),Ju(p),D&4){if(p.stateNode===null)throw Error(t(162));G=p.stateNode,ee=p.memoizedProps;try{G.nodeValue=ee}catch(nn){Jr(p,p.return,nn)}}break;case 3:if(Xc(v,p),Ju(p),D&4&&b!==null&&b.memoizedState.isDehydrated)try{Nu(v.containerInfo)}catch(nn){Jr(p,p.return,nn)}break;case 4:Xc(v,p),Ju(p);break;case 13:Xc(v,p),Ju(p),G=p.child,G.flags&8192&&(ee=G.memoizedState!==null,G.stateNode.isHidden=ee,!ee||G.alternate!==null&&G.alternate.memoizedState!==null||(AC=Oe())),D&4&&EL(p);break;case 22:if(Ct=b!==null&&b.memoizedState!==null,p.mode&1?(jo=(rt=jo)||Ct,Xc(v,p),jo=rt):Xc(v,p),Ju(p),D&8192){if(rt=p.memoizedState!==null,(p.stateNode.isHidden=rt)&&!Ct&&(p.mode&1)!==0)for(Zt=p,Ct=p.child;Ct!==null;){for(Tt=Zt=Ct;Zt!==null;){switch(wt=Zt,$t=wt.child,wt.tag){case 0:case 11:case 14:case 15:Sy(4,wt,wt.return);break;case 1:og(wt,wt.return);var tn=wt.stateNode;if(typeof tn.componentWillUnmount=="function"){D=wt,b=wt.return;try{v=D,tn.props=v.memoizedProps,tn.state=v.memoizedState,tn.componentWillUnmount()}catch(nn){Jr(D,b,nn)}}break;case 5:og(wt,wt.return);break;case 22:if(wt.memoizedState!==null){CL(Tt);continue}}$t!==null?($t.return=wt,Zt=$t):CL(Tt)}Ct=Ct.sibling}e:for(Ct=null,Tt=p;;){if(Tt.tag===5){if(Ct===null){Ct=Tt;try{G=Tt.stateNode,rt?(ee=G.style,typeof ee.setProperty=="function"?ee.setProperty("display","none","important"):ee.display="none"):(Ie=Tt.stateNode,Ne=Tt.memoizedProps.style,fe=Ne!=null&&Ne.hasOwnProperty("display")?Ne.display:null,Ie.style.display=St("display",fe))}catch(nn){Jr(p,p.return,nn)}}}else if(Tt.tag===6){if(Ct===null)try{Tt.stateNode.nodeValue=rt?"":Tt.memoizedProps}catch(nn){Jr(p,p.return,nn)}}else if((Tt.tag!==22&&Tt.tag!==23||Tt.memoizedState===null||Tt===p)&&Tt.child!==null){Tt.child.return=Tt,Tt=Tt.child;continue}if(Tt===p)break e;for(;Tt.sibling===null;){if(Tt.return===null||Tt.return===p)break e;Ct===Tt&&(Ct=null),Tt=Tt.return}Ct===Tt&&(Ct=null),Tt.sibling.return=Tt.return,Tt=Tt.sibling}}break;case 19:Xc(v,p),Ju(p),D&4&&EL(p);break;case 21:break;default:Xc(v,p),Ju(p)}}function Ju(p){var v=p.flags;if(v&2){try{e:{for(var b=p.return;b!==null;){if(yL(b)){var D=b;break e}b=b.return}throw Error(t(160))}switch(D.tag){case 5:var G=D.stateNode;D.flags&32&&(We(G,""),D.flags&=-33);var ee=vL(p);pC(p,ee,G);break;case 3:case 4:var fe=D.stateNode.containerInfo,Ie=vL(p);dC(p,Ie,fe);break;default:throw Error(t(161))}}catch(Ne){Jr(p,p.return,Ne)}p.flags&=-3}v&4096&&(p.flags&=-4097)}function _$(p,v,b){Zt=p,SL(p)}function SL(p,v,b){for(var D=(p.mode&1)!==0;Zt!==null;){var G=Zt,ee=G.child;if(G.tag===22&&D){var fe=G.memoizedState!==null||rE;if(!fe){var Ie=G.alternate,Ne=Ie!==null&&Ie.memoizedState!==null||jo;Ie=rE;var rt=jo;if(rE=fe,(jo=Ne)&&!rt)for(Zt=G;Zt!==null;)fe=Zt,Ne=fe.child,fe.tag===22&&fe.memoizedState!==null?TL(G):Ne!==null?(Ne.return=fe,Zt=Ne):TL(G);for(;ee!==null;)Zt=ee,SL(ee),ee=ee.sibling;Zt=G,rE=Ie,jo=rt}wL(p)}else(G.subtreeFlags&8772)!==0&&ee!==null?(ee.return=G,Zt=ee):wL(p)}}function wL(p){for(;Zt!==null;){var v=Zt;if((v.flags&8772)!==0){var b=v.alternate;try{if((v.flags&8772)!==0)switch(v.tag){case 0:case 11:case 15:jo||sE(5,v);break;case 1:var D=v.stateNode;if(v.flags&4&&!jo)if(b===null)D.componentDidMount();else{var G=v.elementType===v.type?b.memoizedProps:Fa(v.type,b.memoizedProps);D.componentDidUpdate(G,b.memoizedState,D.__reactInternalSnapshotBeforeUpdate)}var ee=v.updateQueue;ee!==null&&ld(v,ee,D);break;case 3:var fe=v.updateQueue;if(fe!==null){if(b=null,v.child!==null)switch(v.child.tag){case 5:b=v.child.stateNode;break;case 1:b=v.child.stateNode}ld(v,fe,b)}break;case 5:var Ie=v.stateNode;if(b===null&&v.flags&4){b=Ie;var Ne=v.memoizedProps;switch(v.type){case"button":case"input":case"select":case"textarea":Ne.autoFocus&&b.focus();break;case"img":Ne.src&&(b.src=Ne.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(v.memoizedState===null){var rt=v.alternate;if(rt!==null){var Ct=rt.memoizedState;if(Ct!==null){var Tt=Ct.dehydrated;Tt!==null&&Nu(Tt)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(t(163))}jo||v.flags&512&&fC(v)}catch(wt){Jr(v,v.return,wt)}}if(v===p){Zt=null;break}if(b=v.sibling,b!==null){b.return=v.return,Zt=b;break}Zt=v.return}}function CL(p){for(;Zt!==null;){var v=Zt;if(v===p){Zt=null;break}var b=v.sibling;if(b!==null){b.return=v.return,Zt=b;break}Zt=v.return}}function TL(p){for(;Zt!==null;){var v=Zt;try{switch(v.tag){case 0:case 11:case 15:var b=v.return;try{sE(4,v)}catch(Ne){Jr(v,b,Ne)}break;case 1:var D=v.stateNode;if(typeof D.componentDidMount=="function"){var G=v.return;try{D.componentDidMount()}catch(Ne){Jr(v,G,Ne)}}var ee=v.return;try{fC(v)}catch(Ne){Jr(v,ee,Ne)}break;case 5:var fe=v.return;try{fC(v)}catch(Ne){Jr(v,fe,Ne)}}}catch(Ne){Jr(v,v.return,Ne)}if(v===p){Zt=null;break}var Ie=v.sibling;if(Ie!==null){Ie.return=v.return,Zt=Ie;break}Zt=v.return}}var S$=Math.ceil,oE=C.ReactCurrentDispatcher,mC=C.ReactCurrentOwner,Yl=C.ReactCurrentBatchConfig,_i=0,po=null,Ls=null,Ro=0,Al=0,ag=Rr(0),Ks=0,wy=null,qp=0,aE=0,gC=0,Cy=null,Oa=null,AC=0,lg=1/0,nf=null,lE=!1,yC=null,dd=null,cE=!1,pd=null,uE=0,Ty=0,vC=null,hE=-1,fE=0;function da(){return(_i&6)!==0?Oe():hE!==-1?hE:hE=Oe()}function md(p){return(p.mode&1)===0?1:(_i&2)!==0&&Ro!==0?Ro&-Ro:aC.transition!==null?(fE===0&&(fE=Ri()),fE):(p=ri,p!==0||(p=window.event,p=p===void 0?16:zu(p.type)),p)}function qc(p,v,b,D){if(50<Ty)throw Ty=0,vC=null,Error(t(185));nr(p,b,D),((_i&2)===0||p!==po)&&(p===po&&((_i&2)===0&&(aE|=b),Ks===4&&gd(p,Ro)),Na(p,D),b===1&&_i===0&&(v.mode&1)===0&&(lg=Oe()+500,kp&&Wl()))}function Na(p,v){var b=p.callbackNode;Bn(p,v);var D=kn(p,p===po?Ro:0);if(D===0)b!==null&&Je(b),p.callbackNode=null,p.callbackPriority=0;else if(v=D&-D,p.callbackPriority!==v){if(b!=null&&Je(b),v===1)p.tag===0?Wx(IL.bind(null,p)):Fp(IL.bind(null,p)),oC(function(){(_i&6)===0&&Wl()}),b=null;else{switch(Ul(D)){case 1:b=xt;break;case 4:b=Et;break;case 16:b=Qt;break;case 536870912:b=ln;break;default:b=Qt}b=FL(b,bL.bind(null,p))}p.callbackPriority=v,p.callbackNode=b}}function bL(p,v){if(hE=-1,fE=0,(_i&6)!==0)throw Error(t(327));var b=p.callbackNode;if(cg()&&p.callbackNode!==b)return null;var D=kn(p,p===po?Ro:0);if(D===0)return null;if((D&30)!==0||(D&p.expiredLanes)!==0||v)v=dE(p,D);else{v=D;var G=_i;_i|=2;var ee=RL();(po!==p||Ro!==v)&&(nf=null,lg=Oe()+500,Zp(p,v));do try{T$();break}catch(Ie){ML(p,Ie)}while(!0);$h(),oE.current=ee,_i=G,Ls!==null?v=0:(po=null,Ro=0,v=Ks)}if(v!==0){if(v===2&&(G=Ln(p),G!==0&&(D=G,v=xC(p,G))),v===1)throw b=wy,Zp(p,0),gd(p,D),Na(p,Oe()),b;if(v===6)gd(p,D);else{if(G=p.current.alternate,(D&30)===0&&!w$(G)&&(v=dE(p,D),v===2&&(ee=Ln(p),ee!==0&&(D=ee,v=xC(p,ee))),v===1))throw b=wy,Zp(p,0),gd(p,D),Na(p,Oe()),b;switch(p.finishedWork=G,p.finishedLanes=D,v){case 0:case 1:throw Error(t(345));case 2:em(p,Oa,nf);break;case 3:if(gd(p,D),(D&130023424)===D&&(v=AC+500-Oe(),10<v)){if(kn(p,0)!==0)break;if(G=p.suspendedLanes,(G&D)!==D){da(),p.pingedLanes|=p.suspendedLanes&G;break}p.timeoutHandle=ZA(em.bind(null,p,Oa,nf),v);break}em(p,Oa,nf);break;case 4:if(gd(p,D),(D&4194240)===D)break;for(v=p.eventTimes,G=-1;0<D;){var fe=31-yn(D);ee=1<<fe,fe=v[fe],fe>G&&(G=fe),D&=~ee}if(D=G,D=Oe()-D,D=(120>D?120:480>D?480:1080>D?1080:1920>D?1920:3e3>D?3e3:4320>D?4320:1960*S$(D/1960))-D,10<D){p.timeoutHandle=ZA(em.bind(null,p,Oa,nf),D);break}em(p,Oa,nf);break;case 5:em(p,Oa,nf);break;default:throw Error(t(329))}}}return Na(p,Oe()),p.callbackNode===b?bL.bind(null,p):null}function xC(p,v){var b=Cy;return p.current.memoizedState.isDehydrated&&(Zp(p,v).flags|=256),p=dE(p,v),p!==2&&(v=Oa,Oa=b,v!==null&&EC(v)),p}function EC(p){Oa===null?Oa=p:Oa.push.apply(Oa,p)}function w$(p){for(var v=p;;){if(v.flags&16384){var b=v.updateQueue;if(b!==null&&(b=b.stores,b!==null))for(var D=0;D<b.length;D++){var G=b[D],ee=G.getSnapshot;G=G.value;try{if(!sa(ee(),G))return!1}catch{return!1}}}if(b=v.child,v.subtreeFlags&16384&&b!==null)b.return=v,v=b;else{if(v===p)break;for(;v.sibling===null;){if(v.return===null||v.return===p)return!0;v=v.return}v.sibling.return=v.return,v=v.sibling}}return!0}function gd(p,v){for(v&=~gC,v&=~aE,p.suspendedLanes|=v,p.pingedLanes&=~v,p=p.expirationTimes;0<v;){var b=31-yn(v),D=1<<b;p[b]=-1,v&=~D}}function IL(p){if((_i&6)!==0)throw Error(t(327));cg();var v=kn(p,0);if((v&1)===0)return Na(p,Oe()),null;var b=dE(p,v);if(p.tag!==0&&b===2){var D=Ln(p);D!==0&&(v=D,b=xC(p,D))}if(b===1)throw b=wy,Zp(p,0),gd(p,v),Na(p,Oe()),b;if(b===6)throw Error(t(345));return p.finishedWork=p.current.alternate,p.finishedLanes=v,em(p,Oa,nf),Na(p,Oe()),null}function _C(p,v){var b=_i;_i|=1;try{return p(v)}finally{_i=b,_i===0&&(lg=Oe()+500,kp&&Wl())}}function Jp(p){pd!==null&&pd.tag===0&&(_i&6)===0&&cg();var v=_i;_i|=1;var b=Yl.transition,D=ri;try{if(Yl.transition=null,ri=1,p)return p()}finally{ri=D,Yl.transition=b,_i=v,(_i&6)===0&&Wl()}}function SC(){Al=ag.current,Yi(ag)}function Zp(p,v){p.finishedWork=null,p.finishedLanes=0;var b=p.timeoutHandle;if(b!==-1&&(p.timeoutHandle=-1,ey(b)),Ls!==null)for(b=Ls.return;b!==null;){var D=b;switch(Gc(D),D.tag){case 1:D=D.type.childContextTypes,D!=null&&Bp();break;case 3:Xu(),Yi(Co),Yi(Hs),Kl();break;case 5:cd(D);break;case 4:Xu();break;case 13:Yi(rr);break;case 19:Yi(rr);break;case 10:zp(D.type._context);break;case 22:case 23:SC()}b=b.return}if(po=p,Ls=p=Ad(p.current,null),Ro=Al=v,Ks=0,wy=null,gC=aE=qp=0,Oa=Cy=null,Qc!==null){for(v=0;v<Qc.length;v++)if(b=Qc[v],D=b.interleaved,D!==null){b.interleaved=null;var G=D.next,ee=b.pending;if(ee!==null){var fe=ee.next;ee.next=G,D.next=fe}b.pending=D}Qc=null}return p}function ML(p,v){do{var b=Ls;try{if($h(),Jh.current=rg,ml){for(var D=Xi.memoizedState;D!==null;){var G=D.queue;G!==null&&(G.pending=null),D=D.next}ml=!1}if(Wc=0,yi=Pr=Xi=null,fo=!1,qu=0,mC.current=null,b===null||b.return===null){Ks=1,wy=v,Ls=null;break}e:{var ee=p,fe=b.return,Ie=b,Ne=v;if(v=Ro,Ie.flags|=32768,Ne!==null&&typeof Ne=="object"&&typeof Ne.then=="function"){var rt=Ne,Ct=Ie,Tt=Ct.tag;if((Ct.mode&1)===0&&(Tt===0||Tt===11||Tt===15)){var wt=Ct.alternate;wt?(Ct.updateQueue=wt.updateQueue,Ct.memoizedState=wt.memoizedState,Ct.lanes=wt.lanes):(Ct.updateQueue=null,Ct.memoizedState=null)}var $t=Jt(fe);if($t!==null){$t.flags&=-257,Hn($t,fe,Ie,ee,v),$t.mode&1&&Rt(ee,rt,v),v=$t,Ne=rt;var tn=v.updateQueue;if(tn===null){var nn=new Set;nn.add(Ne),v.updateQueue=nn}else tn.add(Ne);break e}else{if((v&1)===0){Rt(ee,rt,v),wC();break e}Ne=Error(t(426))}}else if(ir&&Ie.mode&1){var fs=Jt(fe);if(fs!==null){(fs.flags&65536)===0&&(fs.flags|=256),Hn(fs,fe,Ie,ee,v),od(N(Ne,Ie));break e}}ee=Ne=N(Ne,Ie),Ks!==4&&(Ks=2),Cy===null?Cy=[ee]:Cy.push(ee),ee=fe;do{switch(ee.tag){case 3:ee.flags|=65536,v&=-v,ee.lanes|=v;var Ye=Ge(ee,Ne,v);Yh(ee,Ye);break e;case 1:Ie=Ne;var ze=ee.type,Ze=ee.stateNode;if((ee.flags&128)===0&&(typeof ze.getDerivedStateFromError=="function"||Ze!==null&&typeof Ze.componentDidCatch=="function"&&(dd===null||!dd.has(Ze)))){ee.flags|=65536,v&=-v,ee.lanes|=v;var Lt=ht(ee,Ie,v);Yh(ee,Lt);break e}}ee=ee.return}while(ee!==null)}PL(b)}catch(cn){v=cn,Ls===b&&b!==null&&(Ls=b=b.return);continue}break}while(!0)}function RL(){var p=oE.current;return oE.current=rg,p===null?rg:p}function wC(){(Ks===0||Ks===3||Ks===2)&&(Ks=4),po===null||(qp&268435455)===0&&(aE&268435455)===0||gd(po,Ro)}function dE(p,v){var b=_i;_i|=2;var D=RL();(po!==p||Ro!==v)&&(nf=null,Zp(p,v));do try{C$();break}catch(G){ML(p,G)}while(!0);if($h(),_i=b,oE.current=D,Ls!==null)throw Error(t(261));return po=null,Ro=0,Ks}function C$(){for(;Ls!==null;)LL(Ls)}function T$(){for(;Ls!==null&&!st();)LL(Ls)}function LL(p){var v=kL(p.alternate,p,Al);p.memoizedProps=p.pendingProps,v===null?PL(p):Ls=v,mC.current=null}function PL(p){var v=p;do{var b=v.alternate;if(p=v.return,(v.flags&32768)===0){if(b=y$(b,v,Al),b!==null){Ls=b;return}}else{if(b=v$(b,v),b!==null){b.flags&=32767,Ls=b;return}if(p!==null)p.flags|=32768,p.subtreeFlags=0,p.deletions=null;else{Ks=6,Ls=null;return}}if(v=v.sibling,v!==null){Ls=v;return}Ls=v=p}while(v!==null);Ks===0&&(Ks=5)}function em(p,v,b){var D=ri,G=Yl.transition;try{Yl.transition=null,ri=1,b$(p,v,b,D)}finally{Yl.transition=G,ri=D}return null}function b$(p,v,b,D){do cg();while(pd!==null);if((_i&6)!==0)throw Error(t(327));b=p.finishedWork;var G=p.finishedLanes;if(b===null)return null;if(p.finishedWork=null,p.finishedLanes=0,b===p.current)throw Error(t(177));p.callbackNode=null,p.callbackPriority=0;var ee=b.lanes|b.childLanes;if(ta(p,ee),p===po&&(Ls=po=null,Ro=0),(b.subtreeFlags&2064)===0&&(b.flags&2064)===0||cE||(cE=!0,FL(Qt,function(){return cg(),null})),ee=(b.flags&15990)!==0,(b.subtreeFlags&15990)!==0||ee){ee=Yl.transition,Yl.transition=null;var fe=ri;ri=1;var Ie=_i;_i|=4,mC.current=null,E$(p,b),_L(b,p),bs(qA),Ss=!!id,qA=id=null,p.current=b,_$(b),lt(),_i=Ie,ri=fe,Yl.transition=ee}else p.current=b;if(cE&&(cE=!1,pd=p,uE=G),ee=p.pendingLanes,ee===0&&(dd=null),Bt(b.stateNode),Na(p,Oe()),v!==null)for(D=p.onRecoverableError,b=0;b<v.length;b++)G=v[b],D(G.value,{componentStack:G.stack,digest:G.digest});if(lE)throw lE=!1,p=yC,yC=null,p;return(uE&1)!==0&&p.tag!==0&&cg(),ee=p.pendingLanes,(ee&1)!==0?p===vC?Ty++:(Ty=0,vC=p):Ty=0,Wl(),null}function cg(){if(pd!==null){var p=Ul(uE),v=Yl.transition,b=ri;try{if(Yl.transition=null,ri=16>p?16:p,pd===null)var D=!1;else{if(p=pd,pd=null,uE=0,(_i&6)!==0)throw Error(t(331));var G=_i;for(_i|=4,Zt=p.current;Zt!==null;){var ee=Zt,fe=ee.child;if((Zt.flags&16)!==0){var Ie=ee.deletions;if(Ie!==null){for(var Ne=0;Ne<Ie.length;Ne++){var rt=Ie[Ne];for(Zt=rt;Zt!==null;){var Ct=Zt;switch(Ct.tag){case 0:case 11:case 15:Sy(8,Ct,ee)}var Tt=Ct.child;if(Tt!==null)Tt.return=Ct,Zt=Tt;else for(;Zt!==null;){Ct=Zt;var wt=Ct.sibling,$t=Ct.return;if(AL(Ct),Ct===rt){Zt=null;break}if(wt!==null){wt.return=$t,Zt=wt;break}Zt=$t}}}var tn=ee.alternate;if(tn!==null){var nn=tn.child;if(nn!==null){tn.child=null;do{var fs=nn.sibling;nn.sibling=null,nn=fs}while(nn!==null)}}Zt=ee}}if((ee.subtreeFlags&2064)!==0&&fe!==null)fe.return=ee,Zt=fe;else e:for(;Zt!==null;){if(ee=Zt,(ee.flags&2048)!==0)switch(ee.tag){case 0:case 11:case 15:Sy(9,ee,ee.return)}var Ye=ee.sibling;if(Ye!==null){Ye.return=ee.return,Zt=Ye;break e}Zt=ee.return}}var ze=p.current;for(Zt=ze;Zt!==null;){fe=Zt;var Ze=fe.child;if((fe.subtreeFlags&2064)!==0&&Ze!==null)Ze.return=fe,Zt=Ze;else e:for(fe=ze;Zt!==null;){if(Ie=Zt,(Ie.flags&2048)!==0)try{switch(Ie.tag){case 0:case 11:case 15:sE(9,Ie)}}catch(cn){Jr(Ie,Ie.return,cn)}if(Ie===fe){Zt=null;break e}var Lt=Ie.sibling;if(Lt!==null){Lt.return=Ie.return,Zt=Lt;break e}Zt=Ie.return}}if(_i=G,Wl(),Dt&&typeof Dt.onPostCommitFiberRoot=="function")try{Dt.onPostCommitFiberRoot(vn,p)}catch{}D=!0}return D}finally{ri=b,Yl.transition=v}}return!1}function BL(p,v,b){v=N(b,v),v=Ge(p,v,1),p=dr(p,v,1),v=da(),p!==null&&(nr(p,1,v),Na(p,v))}function Jr(p,v,b){if(p.tag===3)BL(p,p,b);else for(;v!==null;){if(v.tag===3){BL(v,p,b);break}else if(v.tag===1){var D=v.stateNode;if(typeof v.type.getDerivedStateFromError=="function"||typeof D.componentDidCatch=="function"&&(dd===null||!dd.has(D))){p=N(b,p),p=ht(v,p,1),v=dr(v,p,1),p=da(),v!==null&&(nr(v,1,p),Na(v,p));break}}v=v.return}}function I$(p,v,b){var D=p.pingCache;D!==null&&D.delete(v),v=da(),p.pingedLanes|=p.suspendedLanes&b,po===p&&(Ro&b)===b&&(Ks===4||Ks===3&&(Ro&130023424)===Ro&&500>Oe()-AC?Zp(p,0):gC|=b),Na(p,v)}function DL(p,v){v===0&&((p.mode&1)===0?v=1:(v=Ei,Ei<<=1,(Ei&130023424)===0&&(Ei=4194304)));var b=da();p=dl(p,v),p!==null&&(nr(p,v,b),Na(p,b))}function M$(p){var v=p.memoizedState,b=0;v!==null&&(b=v.retryLane),DL(p,b)}function R$(p,v){var b=0;switch(p.tag){case 13:var D=p.stateNode,G=p.memoizedState;G!==null&&(b=G.retryLane);break;case 19:D=p.stateNode;break;default:throw Error(t(314))}D!==null&&D.delete(v),DL(p,b)}var kL;kL=function(p,v,b){if(p!==null)if(p.memoizedProps!==v.pendingProps||Co.current)Zn=!0;else{if((p.lanes&b)===0&&(v.flags&128)===0)return Zn=!1,A$(p,v,b);Zn=(p.flags&131072)!==0}else Zn=!1,ir&&(v.flags&1048576)!==0&&sy(v,$0,v.index);switch(v.lanes=0,v.tag){case 2:var D=v.type;iE(p,v),p=v.pendingProps;var G=Gh(v,Hs.current);Yu(v,b),G=Wp(null,v,D,p,G,b);var ee=dy();return v.flags|=1,typeof G=="object"&&G!==null&&typeof G.render=="function"&&G.$$typeof===void 0?(v.tag=1,v.memoizedState=null,v.updateQueue=null,uo(D)?(ee=!0,Hh(v)):ee=!1,v.memoizedState=G.state!==null&&G.state!==void 0?G.state:null,Jn(v),G.updater=sg,v.stateNode=G,G._reactInternals=v,B(v,D,p,b),v=Kn(null,v,D,!0,ee,b)):(v.tag=0,ir&&ee&&oy(v),jt(null,v,G,b),v=v.child),v;case 16:D=v.elementType;e:{switch(iE(p,v),p=v.pendingProps,G=D._init,D=G(D._payload),v.type=D,G=v.tag=P$(D),p=Fa(D,p),G){case 0:v=Vt(null,v,D,p,b);break e;case 1:v=on(null,v,D,p,b);break e;case 11:v=js(null,v,D,p,b);break e;case 14:v=fa(null,v,D,Fa(D.type,p),b);break e}throw Error(t(306,D,""))}return v;case 0:return D=v.type,G=v.pendingProps,G=v.elementType===D?G:Fa(D,G),Vt(p,v,D,G,b);case 1:return D=v.type,G=v.pendingProps,G=v.elementType===D?G:Fa(D,G),on(p,v,D,G,b);case 3:e:{if(Qn(v),p===null)throw Error(t(387));D=v.pendingProps,ee=v.memoizedState,G=ee.element,Gr(p,v),Lr(v,D,null,b);var fe=v.memoizedState;if(D=fe.element,ee.isDehydrated)if(ee={element:D,isDehydrated:!1,cache:fe.cache,pendingSuspenseBoundaries:fe.pendingSuspenseBoundaries,transitions:fe.transitions},v.updateQueue.baseState=ee,v.memoizedState=ee,v.flags&256){G=N(Error(t(423)),v),v=pi(p,v,D,b,G);break e}else if(D!==G){G=N(Error(t(424)),v),v=pi(p,v,D,b,G);break e}else for(bo=Fc(v.stateNode.containerInfo.firstChild),Qs=v,ir=!0,ka=null,b=Up(v,null,D,b),v.child=b;b;)b.flags=b.flags&-3|4096,b=b.sibling;else{if($u(),D===G){v=tf(p,v,b);break e}jt(p,v,D,b)}v=v.child}return v;case 5:return qh(v),p===null&&X0(v),D=v.type,G=v.pendingProps,ee=p!==null?p.memoizedProps:null,fe=G.children,JA(D,G)?fe=null:ee!==null&&JA(D,ee)&&(v.flags|=32),at(p,v),jt(p,v,fe,b),v.child;case 6:return p===null&&X0(v),null;case 13:return $c(p,v,b);case 4:return Qp(v,v.stateNode.containerInfo),D=v.pendingProps,p===null?v.child=Wh(v,null,D,b):jt(p,v,D,b),v.child;case 11:return D=v.type,G=v.pendingProps,G=v.elementType===D?G:Fa(D,G),js(p,v,D,G,b);case 7:return jt(p,v,v.pendingProps,b),v.child;case 8:return jt(p,v,v.pendingProps.children,b),v.child;case 12:return jt(p,v,v.pendingProps.children,b),v.child;case 10:e:{if(D=v.type._context,G=v.pendingProps,ee=v.memoizedProps,fe=G.value,Gi(jh,D._currentValue),D._currentValue=fe,ee!==null)if(sa(ee.value,fe)){if(ee.children===G.children&&!Co.current){v=tf(p,v,b);break e}}else for(ee=v.child,ee!==null&&(ee.return=v);ee!==null;){var Ie=ee.dependencies;if(Ie!==null){fe=ee.child;for(var Ne=Ie.firstContext;Ne!==null;){if(Ne.context===D){if(ee.tag===1){Ne=ki(-1,b&-b),Ne.tag=2;var rt=ee.updateQueue;if(rt!==null){rt=rt.shared;var Ct=rt.pending;Ct===null?Ne.next=Ne:(Ne.next=Ct.next,Ct.next=Ne),rt.pending=Ne}}ee.lanes|=b,Ne=ee.alternate,Ne!==null&&(Ne.lanes|=b),Gp(ee.return,b,v),Ie.lanes|=b;break}Ne=Ne.next}}else if(ee.tag===10)fe=ee.type===v.type?null:ee.child;else if(ee.tag===18){if(fe=ee.return,fe===null)throw Error(t(341));fe.lanes|=b,Ie=fe.alternate,Ie!==null&&(Ie.lanes|=b),Gp(fe,b,v),fe=ee.sibling}else fe=ee.child;if(fe!==null)fe.return=ee;else for(fe=ee;fe!==null;){if(fe===v){fe=null;break}if(ee=fe.sibling,ee!==null){ee.return=fe.return,fe=ee;break}fe=fe.return}ee=fe}jt(p,v,G.children,b),v=v.child}return v;case 9:return G=v.type,D=v.pendingProps.children,Yu(v,b),G=la(G),D=D(G),v.flags|=1,jt(p,v,D,b),v.child;case 14:return D=v.type,G=Fa(D,v.pendingProps),G=Fa(D.type,G),fa(p,v,D,G,b);case 15:return et(p,v,v.type,v.pendingProps,b);case 17:return D=v.type,G=v.pendingProps,G=v.elementType===D?G:Fa(D,G),iE(p,v),v.tag=1,uo(D)?(p=!0,Hh(v)):p=!1,Yu(v,b),_(v,D,G),B(v,D,G,b),Kn(null,v,D,!0,p,b);case 19:return fL(p,v,b);case 22:return Qe(p,v,b)}throw Error(t(156,v.tag))};function FL(p,v){return Me(p,v)}function L$(p,v,b,D){this.tag=p,this.key=b,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=v,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=D,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Xl(p,v,b,D){return new L$(p,v,b,D)}function CC(p){return p=p.prototype,!(!p||!p.isReactComponent)}function P$(p){if(typeof p=="function")return CC(p)?1:0;if(p!=null){if(p=p.$$typeof,p===k)return 11;if(p===W)return 14}return 2}function Ad(p,v){var b=p.alternate;return b===null?(b=Xl(p.tag,v,p.key,p.mode),b.elementType=p.elementType,b.type=p.type,b.stateNode=p.stateNode,b.alternate=p,p.alternate=b):(b.pendingProps=v,b.type=p.type,b.flags=0,b.subtreeFlags=0,b.deletions=null),b.flags=p.flags&14680064,b.childLanes=p.childLanes,b.lanes=p.lanes,b.child=p.child,b.memoizedProps=p.memoizedProps,b.memoizedState=p.memoizedState,b.updateQueue=p.updateQueue,v=p.dependencies,b.dependencies=v===null?null:{lanes:v.lanes,firstContext:v.firstContext},b.sibling=p.sibling,b.index=p.index,b.ref=p.ref,b}function pE(p,v,b,D,G,ee){var fe=2;if(D=p,typeof p=="function")CC(p)&&(fe=1);else if(typeof p=="string")fe=5;else e:switch(p){case M:return tm(b.children,G,ee,v);case L:fe=8,G|=8;break;case R:return p=Xl(12,b,v,G|2),p.elementType=R,p.lanes=ee,p;case z:return p=Xl(13,b,v,G),p.elementType=z,p.lanes=ee,p;case U:return p=Xl(19,b,v,G),p.elementType=U,p.lanes=ee,p;case oe:return mE(b,G,ee,v);default:if(typeof p=="object"&&p!==null)switch(p.$$typeof){case P:fe=10;break e;case F:fe=9;break e;case k:fe=11;break e;case W:fe=14;break e;case $:fe=16,D=null;break e}throw Error(t(130,p==null?p:typeof p,""))}return v=Xl(fe,b,v,G),v.elementType=p,v.type=D,v.lanes=ee,v}function tm(p,v,b,D){return p=Xl(7,p,D,v),p.lanes=b,p}function mE(p,v,b,D){return p=Xl(22,p,D,v),p.elementType=oe,p.lanes=b,p.stateNode={isHidden:!1},p}function TC(p,v,b){return p=Xl(6,p,null,v),p.lanes=b,p}function bC(p,v,b){return v=Xl(4,p.children!==null?p.children:[],p.key,v),v.lanes=b,v.stateNode={containerInfo:p.containerInfo,pendingChildren:null,implementation:p.implementation},v}function B$(p,v,b,D,G){this.tag=v,this.containerInfo=p,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=ls(0),this.expirationTimes=ls(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=ls(0),this.identifierPrefix=D,this.onRecoverableError=G,this.mutableSourceEagerHydrationData=null}function IC(p,v,b,D,G,ee,fe,Ie,Ne){return p=new B$(p,v,b,Ie,Ne),v===1?(v=1,ee===!0&&(v|=8)):v=0,ee=Xl(3,null,null,v),p.current=ee,ee.stateNode=p,ee.memoizedState={element:D,isDehydrated:b,cache:null,transitions:null,pendingSuspenseBoundaries:null},Jn(ee),p}function D$(p,v,b){var D=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:I,key:D==null?null:""+D,children:p,containerInfo:v,implementation:b}}function OL(p){if(!p)return Nc;p=p._reactInternals;e:{if(me(p)!==p||p.tag!==1)throw Error(t(170));var v=p;do{switch(v.tag){case 3:v=v.stateNode.context;break e;case 1:if(uo(v.type)){v=v.stateNode.__reactInternalMemoizedMergedChildContext;break e}}v=v.return}while(v!==null);throw Error(t(171))}if(p.tag===1){var b=p.type;if(uo(b))return Dp(p,b,v)}return v}function NL(p,v,b,D,G,ee,fe,Ie,Ne){return p=IC(b,D,!0,p,G,ee,fe,Ie,Ne),p.context=OL(null),b=p.current,D=da(),G=md(b),ee=ki(D,G),ee.callback=v??null,dr(b,ee,G),p.current.lanes=G,nr(p,G,D),Na(p,D),p}function gE(p,v,b,D){var G=v.current,ee=da(),fe=md(G);return b=OL(b),v.context===null?v.context=b:v.pendingContext=b,v=ki(ee,fe),v.payload={element:p},D=D===void 0?null:D,D!==null&&(v.callback=D),p=dr(G,v,fe),p!==null&&(qc(p,G,fe,ee),ho(p,G,fe)),fe}function AE(p){if(p=p.current,!p.child)return null;switch(p.child.tag){case 5:return p.child.stateNode;default:return p.child.stateNode}}function UL(p,v){if(p=p.memoizedState,p!==null&&p.dehydrated!==null){var b=p.retryLane;p.retryLane=b!==0&&b<v?b:v}}function MC(p,v){UL(p,v),(p=p.alternate)&&UL(p,v)}function k$(){return null}var zL=typeof reportError=="function"?reportError:function(p){console.error(p)};function RC(p){this._internalRoot=p}yE.prototype.render=RC.prototype.render=function(p){var v=this._internalRoot;if(v===null)throw Error(t(409));gE(p,v,null,null)},yE.prototype.unmount=RC.prototype.unmount=function(){var p=this._internalRoot;if(p!==null){this._internalRoot=null;var v=p.containerInfo;Jp(function(){gE(null,p,null,null)}),v[aa]=null}};function yE(p){this._internalRoot=p}yE.prototype.unstable_scheduleHydration=function(p){if(p){var v=zl();p={blockedOn:null,target:p,priority:v};for(var b=0;b<Ma.length&&v!==0&&v<Ma[b].priority;b++);Ma.splice(b,0,p),b===0&&lo(p)}};function LC(p){return!(!p||p.nodeType!==1&&p.nodeType!==9&&p.nodeType!==11)}function vE(p){return!(!p||p.nodeType!==1&&p.nodeType!==9&&p.nodeType!==11&&(p.nodeType!==8||p.nodeValue!==" react-mount-point-unstable "))}function GL(){}function F$(p,v,b,D,G){if(G){if(typeof D=="function"){var ee=D;D=function(){var rt=AE(fe);ee.call(rt)}}var fe=NL(v,D,p,0,null,!1,!1,"",GL);return p._reactRootContainer=fe,p[aa]=fe.current,td(p.nodeType===8?p.parentNode:p),Jp(),fe}for(;G=p.lastChild;)p.removeChild(G);if(typeof D=="function"){var Ie=D;D=function(){var rt=AE(Ne);Ie.call(rt)}}var Ne=IC(p,0,!1,null,null,!1,!1,"",GL);return p._reactRootContainer=Ne,p[aa]=Ne.current,td(p.nodeType===8?p.parentNode:p),Jp(function(){gE(v,Ne,b,D)}),Ne}function xE(p,v,b,D,G){var ee=b._reactRootContainer;if(ee){var fe=ee;if(typeof G=="function"){var Ie=G;G=function(){var Ne=AE(fe);Ie.call(Ne)}}gE(v,fe,p,G)}else fe=F$(b,v,p,G,D);return AE(fe)}ku=function(p){switch(p.tag){case 3:var v=p.stateNode;if(v.current.memoizedState.isDehydrated){var b=Dn(v.pendingLanes);b!==0&&(ol(v,b|1),Na(v,Oe()),(_i&6)===0&&(lg=Oe()+500,Wl()))}break;case 13:Jp(function(){var D=dl(p,1);if(D!==null){var G=da();qc(D,p,1,G)}}),MC(p,1)}},Qf=function(p){if(p.tag===13){var v=dl(p,134217728);if(v!==null){var b=da();qc(v,p,134217728,b)}MC(p,134217728)}},Vf=function(p){if(p.tag===13){var v=md(p),b=dl(p,v);if(b!==null){var D=da();qc(b,p,v,D)}MC(p,v)}},zl=function(){return ri},Mh=function(p,v){var b=ri;try{return ri=p,v()}finally{ri=b}},De=function(p,v,b){switch(v){case"input":if(Le(p,b),v=b.name,b.type==="radio"&&v!=null){for(b=p;b.parentNode;)b=b.parentNode;for(b=b.querySelectorAll("input[name="+JSON.stringify(""+v)+'][type="radio"]'),v=0;v<b.length;v++){var D=b[v];if(D!==p&&D.form===p.form){var G=W0(D);if(!G)throw Error(t(90));ce(D),Le(D,G)}}}break;case"textarea":Fe(p,b);break;case"select":v=b.value,v!=null&&de(p,!!b.multiple,v,!1)}},qt=_C,Nt=Jp;var O$={usingClientEntryPoint:!1,Events:[Oc,zr,W0,bt,Pt,_C]},by={findFiberByHostInstance:Ku,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},N$={bundleType:by.bundleType,version:by.version,rendererPackageName:by.rendererPackageName,rendererConfig:by.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:C.ReactCurrentDispatcher,findHostInstanceByFiber:function(p){return p=_e(p),p===null?null:p.stateNode},findFiberByHostInstance:by.findFiberByHostInstance||k$,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var EE=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!EE.isDisabled&&EE.supportsFiber)try{vn=EE.inject(N$),Dt=EE}catch{}}return Ua.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=O$,Ua.createPortal=function(p,v){var b=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!LC(v))throw Error(t(200));return D$(p,v,null,b)},Ua.createRoot=function(p,v){if(!LC(p))throw Error(t(299));var b=!1,D="",G=zL;return v!=null&&(v.unstable_strictMode===!0&&(b=!0),v.identifierPrefix!==void 0&&(D=v.identifierPrefix),v.onRecoverableError!==void 0&&(G=v.onRecoverableError)),v=IC(p,1,!1,null,null,b,!1,D,G),p[aa]=v.current,td(p.nodeType===8?p.parentNode:p),new RC(v)},Ua.findDOMNode=function(p){if(p==null)return null;if(p.nodeType===1)return p;var v=p._reactInternals;if(v===void 0)throw typeof p.render=="function"?Error(t(188)):(p=Object.keys(p).join(","),Error(t(268,p)));return p=_e(v),p=p===null?null:p.stateNode,p},Ua.flushSync=function(p){return Jp(p)},Ua.hydrate=function(p,v,b){if(!vE(v))throw Error(t(200));return xE(null,p,v,!0,b)},Ua.hydrateRoot=function(p,v,b){if(!LC(p))throw Error(t(405));var D=b!=null&&b.hydratedSources||null,G=!1,ee="",fe=zL;if(b!=null&&(b.unstable_strictMode===!0&&(G=!0),b.identifierPrefix!==void 0&&(ee=b.identifierPrefix),b.onRecoverableError!==void 0&&(fe=b.onRecoverableError)),v=NL(v,null,p,1,b??null,G,!1,ee,fe),p[aa]=v.current,td(p),D)for(p=0;p<D.length;p++)b=D[p],G=b._getVersion,G=G(b._source),v.mutableSourceEagerHydrationData==null?v.mutableSourceEagerHydrationData=[b,G]:v.mutableSourceEagerHydrationData.push(b,G);return new yE(v)},Ua.render=function(p,v,b){if(!vE(v))throw Error(t(200));return xE(null,p,v,!1,b)},Ua.unmountComponentAtNode=function(p){if(!vE(p))throw Error(t(40));return p._reactRootContainer?(Jp(function(){xE(null,null,p,!1,function(){p._reactRootContainer=null,p[aa]=null})}),!0):!1},Ua.unstable_batchedUpdates=_C,Ua.unstable_renderSubtreeIntoContainer=function(p,v,b,D){if(!vE(b))throw Error(t(200));if(p==null||p._reactInternals===void 0)throw Error(t(38));return xE(p,v,b,!1,D)},Ua.version="18.3.1-next-f1338f8080-20240426",Ua}var YL;function $$(){if(YL)return DC.exports;YL=1;function i(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(i)}catch(e){console.error(e)}}return i(),DC.exports=K$(),DC.exports}var XL;function Y$(){if(XL)return _E;XL=1;var i=$$();return _E.createRoot=i.createRoot,_E.hydrateRoot=i.hydrateRoot,_E}var h6=Y$();const X$=AA(h6),gS={common:{bg:"bg-gray-100",border:"border-gray-300",text:"text-gray-700"},uncommon:{bg:"bg-green-100",border:"border-green-400",text:"text-green-700"},rare:{bg:"bg-blue-100",border:"border-blue-400",text:"text-blue-700"},epic:{bg:"bg-purple-100",border:"border-purple-400",text:"text-purple-700"},legendary:{bg:"bg-yellow-100",border:"border-yellow-400",text:"text-yellow-700"}},TN={common:"Almennur",uncommon:"Óvenjulegur",rare:"Sjaldgæfur",epic:"Epískur",legendary:"Goðsagnakenndur"};function q$({achievement:i,progress:e,size:t="md",showProgress:n=!0,onClick:r}){const s=(e==null?void 0:e.unlocked)??!1,o=gS[i.rarity],a={sm:"w-12 h-12 text-lg",md:"w-16 h-16 text-2xl",lg:"w-20 h-20 text-3xl"},l={sm:"gap-2",md:"gap-3",lg:"gap-4"};return Z.jsxs("div",{className:`flex items-center ${l[t]} ${r?"cursor-pointer hover:scale-105 transition-transform":""}`,onClick:r,role:r?"button":void 0,tabIndex:r?0:void 0,onKeyDown:r?c=>c.key==="Enter"&&r():void 0,children:[Z.jsx("div",{className:`
          ${a[t]}
          ${s?o.bg:"bg-gray-200"}
          ${s?o.border:"border-gray-300"}
          border-2 rounded-full flex items-center justify-center
          ${s?"":"grayscale opacity-50"}
          transition-all
        `,children:Z.jsx("span",{className:s?"":"opacity-30",children:i.icon})}),Z.jsxs("div",{className:"flex-1 min-w-0",children:[Z.jsx("div",{className:`font-semibold truncate ${s?o.text:"text-gray-500"}`,children:i.secret&&!s?"???":i.name}),Z.jsx("div",{className:"text-xs text-gray-500 truncate",children:i.secret&&!s?"Leynilegt afrek":i.description}),n&&e&&!s&&Z.jsxs("div",{className:"mt-1",children:[Z.jsx("div",{className:"h-1.5 bg-gray-200 rounded-full overflow-hidden",children:Z.jsx("div",{className:`h-full ${o.bg.replace("100","400")} transition-all`,style:{width:`${Math.min(100,e.currentValue/e.targetValue*100)}%`}})}),Z.jsxs("div",{className:"text-xs text-gray-400 mt-0.5",children:[e.currentValue," / ",e.targetValue]})]}),s&&Z.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[Z.jsxs("span",{className:`text-xs ${o.text}`,children:["+",i.points," stig"]}),Z.jsx("span",{className:`text-xs px-1.5 py-0.5 rounded ${o.bg} ${o.text}`,children:TN[i.rarity]})]})]})]})}function J$({notification:i,onDismiss:e,autoDismissMs:t=5e3}){const[n,r]=w.useState(!1),[s,o]=w.useState(!1),{achievement:a}=i,l=gS[a.rarity];w.useEffect(()=>{const u=setTimeout(()=>r(!0),50),h=setTimeout(()=>{o(!0),setTimeout(e,300)},t);return()=>{clearTimeout(u),clearTimeout(h)}},[t,e]);const c=()=>{o(!0),setTimeout(e,300)};return Z.jsx("div",{className:`
        fixed top-4 right-4 z-50
        transform transition-all duration-300 ease-out
        ${n&&!s?"translate-x-0 opacity-100":"translate-x-full opacity-0"}
      `,children:Z.jsxs("div",{className:`
          ${l.bg} ${l.border}
          border-2 rounded-xl shadow-2xl p-4 max-w-sm
          backdrop-blur-sm
        `,children:[Z.jsxs("div",{className:"flex items-center justify-between mb-3",children:[Z.jsxs("div",{className:"flex items-center gap-2",children:[Z.jsx("span",{className:"text-lg",children:"🎉"}),Z.jsx("span",{className:`font-bold ${l.text}`,children:"Afrek opnað!"})]}),Z.jsx("button",{onClick:c,className:"text-gray-400 hover:text-gray-600 transition-colors","aria-label":"Loka",children:"×"})]}),Z.jsxs("div",{className:"flex items-center gap-4",children:[Z.jsx("div",{className:`
              w-16 h-16 ${l.bg} ${l.border}
              border-2 rounded-full flex items-center justify-center text-3xl
              animate-bounce
            `,children:a.icon}),Z.jsxs("div",{className:"flex-1",children:[Z.jsx("div",{className:`font-bold text-lg ${l.text}`,children:a.name}),Z.jsx("div",{className:"text-sm text-gray-600",children:a.description}),Z.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[Z.jsxs("span",{className:`text-sm font-semibold ${l.text}`,children:["+",a.points," stig"]}),Z.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${l.bg} ${l.text} border ${l.border}`,children:TN[a.rarity]})]})]})]}),Z.jsx("div",{className:"mt-3 h-1 bg-gray-200 rounded-full overflow-hidden",children:Z.jsx("div",{className:"h-full bg-gradient-to-r from-yellow-400 to-yellow-500 transition-all duration-1000",style:{width:"100%"}})})]})})}function SE({notifications:i,onDismiss:e}){const t=i[0];return t?Z.jsx(J$,{notification:t,onDismiss:()=>e(t.achievement.id)},t.achievement.id):null}const bN="kvenno-chemistry-achievements",Z2=[{id:"perfect-level-1",name:"Fullkominn byrjandi",description:"Fáðu 100% á stigi 1",icon:"🌟",category:"performance",rarity:"uncommon",criteria:{type:"perfect_score",target:100,level:1},points:10},{id:"perfect-level-2",name:"Fullkominn framhaldsnemi",description:"Fáðu 100% á stigi 2",icon:"⭐",category:"performance",rarity:"rare",criteria:{type:"perfect_score",target:100,level:2},points:20},{id:"perfect-level-3",name:"Fullkominn meistari",description:"Fáðu 100% á stigi 3",icon:"🏆",category:"performance",rarity:"epic",criteria:{type:"perfect_score",target:100,level:3},points:30},{id:"high-scorer",name:"Hámarks stigamaður",description:"Náðu 90+ stigum í einu stigi",icon:"📈",category:"performance",rarity:"uncommon",criteria:{type:"high_score",target:90},points:15},{id:"streak-3",name:"Þrefalt rétt",description:"3 rétt svör í röð",icon:"🔥",category:"streak",rarity:"common",criteria:{type:"streak",target:3},points:5},{id:"streak-5",name:"Fimmfalt rétt",description:"5 rétt svör í röð",icon:"🔥",category:"streak",rarity:"uncommon",criteria:{type:"streak",target:5},points:10},{id:"streak-10",name:"Óstöðvandi",description:"10 rétt svör í röð",icon:"💥",category:"streak",rarity:"rare",criteria:{type:"streak",target:10},points:25},{id:"streak-20",name:"Eldfjall",description:"20 rétt svör í röð",icon:"🌋",category:"streak",rarity:"epic",criteria:{type:"streak",target:20},points:50},{id:"speed-demon",name:"Hraðfari",description:"Ljúktu stigi á undir 60 sekúndum",icon:"⚡",category:"speed",rarity:"rare",criteria:{type:"speed",target:60},points:20},{id:"lightning",name:"Eldingur",description:"Ljúktu stigi á undir 30 sekúndum",icon:"⚡",category:"speed",rarity:"epic",criteria:{type:"speed",target:30},points:40},{id:"first-level-complete",name:"Fyrsta stig lokið",description:"Ljúktu stigi 1 í einhverjum leik",icon:"✅",category:"mastery",rarity:"common",criteria:{type:"level_complete",target:1,level:1},points:5},{id:"game-complete",name:"Leik lokið",description:"Ljúktu öllum stigum í einum leik",icon:"🎮",category:"mastery",rarity:"uncommon",criteria:{type:"game_complete",target:1},points:15},{id:"five-games",name:"Fimm leikir",description:"Ljúktu 5 leikjum",icon:"🎯",category:"mastery",rarity:"rare",criteria:{type:"total_games",target:5},points:30},{id:"all-games",name:"Allar leikvangur",description:"Ljúktu öllum 18 leikjum",icon:"👑",category:"mastery",rarity:"legendary",criteria:{type:"total_games",target:18},points:100},{id:"problem-solver-10",name:"Vandamálaleysir",description:"Leystu 10 verkefni",icon:"🧩",category:"dedication",rarity:"common",criteria:{type:"total_problems",target:10},points:5},{id:"problem-solver-50",name:"Duglegur nemandi",description:"Leystu 50 verkefni",icon:"📚",category:"dedication",rarity:"uncommon",criteria:{type:"total_problems",target:50},points:15},{id:"problem-solver-100",name:"Ákafur iðjumaður",description:"Leystu 100 verkefni",icon:"🏅",category:"dedication",rarity:"rare",criteria:{type:"total_problems",target:100},points:30},{id:"problem-solver-500",name:"Efnafræðingur",description:"Leystu 500 verkefni",icon:"🔬",category:"dedication",rarity:"epic",criteria:{type:"total_problems",target:500},points:75},{id:"daily-player-3",name:"Stöðugur nemandi",description:"Spilaðu 3 daga",icon:"📅",category:"dedication",rarity:"uncommon",criteria:{type:"daily_play",target:3},points:10},{id:"daily-player-7",name:"Vikuflakkari",description:"Spilaðu 7 daga",icon:"📆",category:"dedication",rarity:"rare",criteria:{type:"daily_play",target:7},points:25},{id:"first-try-master",name:"Rétt í fyrstu",description:"Svaraðu 5 spurningum rétt í fyrstu tilraun",icon:"🎯",category:"special",rarity:"rare",criteria:{type:"first_try",target:5},points:20},{id:"no-hints",name:"Án hjálpar",description:"Ljúktu stigi án þess að nota vísbendingar",icon:"💪",category:"special",rarity:"uncommon",criteria:{type:"no_hints",target:1},points:15},{id:"comeback-king",name:"Aftur á sporin",description:"Batnaðu úr 50% eða lægra í 80%+ í sama stigi",icon:"🦅",category:"special",rarity:"rare",criteria:{type:"high_score",target:80},points:25,secret:!0}];function XI(){return{unlocked:[],progress:{},totalPoints:0,currentStreak:0,bestStreak:0,daysPlayed:[],totalProblemsSolved:0,totalGamesCompleted:0,lastUpdated:new Date().toISOString()}}function wE(){try{const i=localStorage.getItem(bN);if(i){const e=JSON.parse(i);if(e&&typeof e=="object"&&Array.isArray(e.unlocked))return{...XI(),...e}}}catch(i){console.error("Failed to load achievements:",i)}return XI()}function f6(i){try{i.lastUpdated=new Date().toISOString(),localStorage.setItem(bN,JSON.stringify(i))}catch(e){console.error("Failed to save achievements:",e)}}function Z$(i,e){return i.unlocked.includes(e)}function IN(i,e){const t=i.progress[e.id];return t||{achievementId:e.id,currentValue:0,targetValue:e.criteria.target,unlocked:Z$(i,e.id)}}function qL(i,e){var s;const t=[],n={...i},r=new Date().toISOString().split("T")[0];switch(n.daysPlayed.includes(r)||(n.daysPlayed=[...n.daysPlayed,r]),e.type){case"answer_correct":n.currentStreak+=1,n.bestStreak=Math.max(n.bestStreak,n.currentStreak),n.totalProblemsSolved+=1;break;case"answer_incorrect":n.currentStreak=0;break;case"level_complete":break;case"game_complete":n.totalGamesCompleted+=1;break}for(const o of Z2){if(n.unlocked.includes(o.id))continue;let a=!1,l=0;switch(o.criteria.type){case"streak":l=n.currentStreak,a=n.currentStreak>=o.criteria.target;break;case"perfect_score":e.type==="level_complete"&&e.score!==void 0&&e.maxScore&&e.score/e.maxScore*100>=100&&(!o.criteria.level||o.criteria.level===e.level)&&(a=!0,l=100);break;case"high_score":e.type==="level_complete"&&e.score!==void 0&&(l=e.score,a=e.score>=o.criteria.target);break;case"speed":e.type==="level_complete"&&e.timeTaken!==void 0&&(l=e.timeTaken,a=e.timeTaken<=o.criteria.target);break;case"level_complete":e.type==="level_complete"&&(l=1,a=!o.criteria.level||o.criteria.level===e.level);break;case"game_complete":l=n.totalGamesCompleted,a=n.totalGamesCompleted>=o.criteria.target;break;case"total_problems":l=n.totalProblemsSolved,a=n.totalProblemsSolved>=o.criteria.target;break;case"total_games":l=n.totalGamesCompleted,a=n.totalGamesCompleted>=o.criteria.target;break;case"daily_play":l=n.daysPlayed.length,a=n.daysPlayed.length>=o.criteria.target;break;case"no_hints":e.type==="level_complete"&&e.hintsUsed===0&&(a=!0,l=1);break;case"first_try":if(e.type==="answer_correct"&&e.firstAttempt){const c=(((s=n.progress[o.id])==null?void 0:s.currentValue)||0)+1;l=c,a=c>=o.criteria.target}break}n.progress[o.id]={achievementId:o.id,currentValue:l,targetValue:o.criteria.target,unlocked:a,unlockedAt:a?new Date().toISOString():void 0},a&&(n.unlocked.push(o.id),n.totalPoints+=o.points,t.push({achievement:o,unlockedAt:new Date().toISOString(),isNew:!0}))}return f6(n),t}function eY(i){return Math.round(i.unlocked.length/Z2.length*100)}function tY(i){return Z2.filter(e=>i.unlocked.includes(e.id))}function nY(i){return Z2.filter(e=>!i.unlocked.includes(e.id)&&!e.secret)}function iY(){f6(XI())}const OC={performance:{label:"Frammistaða",icon:"⭐"},streak:{label:"Röð",icon:"🔥"},speed:{label:"Hraði",icon:"⚡"},mastery:{label:"Leikni",icon:"🎮"},dedication:{label:"Hollusta",icon:"📚"},special:{label:"Sérstök",icon:"🎯"}};function rY({achievements:i,allAchievements:e,onClose:t,onReset:n}){const[r,s]=w.useState("all"),o=r==="all"?e:e.filter(u=>u.category===r),a=i.unlocked.length,l=e.filter(u=>!u.secret||i.unlocked.includes(u.id)).length,c=Math.round(a/e.length*100);return Z.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50",children:Z.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[Z.jsxs("div",{className:"bg-gradient-to-r from-yellow-400 to-orange-500 p-6 text-white",children:[Z.jsxs("div",{className:"flex items-center justify-between",children:[Z.jsxs("div",{children:[Z.jsx("h2",{className:"text-2xl font-bold flex items-center gap-2",children:"🏆 Afrek"}),Z.jsxs("p",{className:"text-yellow-100 text-sm mt-1",children:[a," / ",l," opnuð (",c,"%)"]})]}),t&&Z.jsx("button",{onClick:t,className:"text-white/80 hover:text-white text-2xl transition-colors","aria-label":"Loka",children:"×"})]}),Z.jsx("div",{className:"mt-4 h-3 bg-white/30 rounded-full overflow-hidden",children:Z.jsx("div",{className:"h-full bg-white transition-all duration-500",style:{width:`${c}%`}})}),Z.jsxs("div",{className:"mt-4 grid grid-cols-3 gap-4 text-center",children:[Z.jsxs("div",{className:"bg-white/20 rounded-lg p-2",children:[Z.jsx("div",{className:"text-2xl font-bold",children:i.totalPoints}),Z.jsx("div",{className:"text-xs text-yellow-100",children:"Stig"})]}),Z.jsxs("div",{className:"bg-white/20 rounded-lg p-2",children:[Z.jsx("div",{className:"text-2xl font-bold",children:i.bestStreak}),Z.jsx("div",{className:"text-xs text-yellow-100",children:"Besta röð"})]}),Z.jsxs("div",{className:"bg-white/20 rounded-lg p-2",children:[Z.jsx("div",{className:"text-2xl font-bold",children:i.totalProblemsSolved}),Z.jsx("div",{className:"text-xs text-yellow-100",children:"Verkefni"})]})]})]}),Z.jsxs("div",{className:"flex gap-1 p-2 bg-gray-100 overflow-x-auto",children:[Z.jsx("button",{onClick:()=>s("all"),className:`px-3 py-1.5 rounded-lg text-sm font-medium transition-colors whitespace-nowrap ${r==="all"?"bg-white shadow text-gray-800":"text-gray-600 hover:bg-white/50"}`,children:"Allt"}),Object.keys(OC).map(u=>Z.jsxs("button",{onClick:()=>s(u),className:`px-3 py-1.5 rounded-lg text-sm font-medium transition-colors whitespace-nowrap ${r===u?"bg-white shadow text-gray-800":"text-gray-600 hover:bg-white/50"}`,children:[OC[u].icon," ",OC[u].label]},u))]}),Z.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:Z.jsx("div",{className:"space-y-3",children:o.map(u=>{const h=IN(i,u),f=i.unlocked.includes(u.id);return u.secret&&!f?null:Z.jsx("div",{className:`p-3 rounded-xl border-2 transition-all ${f?`${gS[u.rarity].bg} ${gS[u.rarity].border}`:"bg-gray-50 border-gray-200"}`,children:Z.jsx(q$,{achievement:u,progress:h,size:"md"})},u.id)})})}),Z.jsxs("div",{className:"p-4 bg-gray-50 border-t flex justify-between items-center",children:[Z.jsxs("div",{className:"text-sm text-gray-500",children:["🔥 Núverandi röð: ",i.currentStreak]}),n&&Z.jsx("button",{onClick:()=>{window.confirm("Ertu viss um að þú viljir endurstilla öll afrek?")&&n()},className:"text-sm text-red-500 hover:text-red-700 transition-colors",children:"Endurstilla"})]})]})})}function sY({achievements:i,onClick:e}){return Z.jsxs("button",{onClick:e,className:"flex items-center gap-2 px-3 py-2 bg-yellow-100 hover:bg-yellow-200 border-2 border-yellow-400 rounded-xl transition-colors",title:"Skoða afrek",children:[Z.jsx("span",{className:"text-lg",children:"🏆"}),Z.jsx("span",{className:"font-semibold text-yellow-800",children:i.totalPoints}),i.currentStreak>0&&Z.jsxs("span",{className:"flex items-center gap-1 text-sm text-orange-600",children:["🔥 ",i.currentStreak]})]})}const MN={H:{color:"#F3F4F6",radius:.6,name:"Hydrogen",mass:1.008,strokeColor:"#9CA3AF"},C:{color:"#4B5563",radius:1,name:"Carbon",mass:12.011,strokeColor:"#D1D5DB"},N:{color:"#3B82F6",radius:.95,name:"Nitrogen",mass:14.007},O:{color:"#EF4444",radius:.9,name:"Oxygen",mass:15.999},F:{color:"#84CC16",radius:.7,name:"Fluorine",mass:18.998},Cl:{color:"#22C55E",radius:1.15,name:"Chlorine",mass:35.453},Br:{color:"#991B1B",radius:1.25,name:"Bromine",mass:79.904},I:{color:"#7C3AED",radius:1.4,name:"Iodine",mass:126.904},Li:{color:"#A855F7",radius:1.2,name:"Lithium",mass:6.941},Na:{color:"#8B5CF6",radius:1.5,name:"Sodium",mass:22.99},K:{color:"#EC4899",radius:1.8,name:"Potassium",mass:39.098},Be:{color:"#A3E635",radius:.9,name:"Beryllium",mass:9.012},Mg:{color:"#14B8A6",radius:1.3,name:"Magnesium",mass:24.305},Ca:{color:"#F97316",radius:1.6,name:"Calcium",mass:40.078},S:{color:"#EAB308",radius:1.2,name:"Sulfur",mass:32.065},P:{color:"#F59E0B",radius:1.1,name:"Phosphorus",mass:30.974},Si:{color:"#D4A574",radius:1.15,name:"Silicon",mass:28.086},Al:{color:"#A1A1AA",radius:1.25,name:"Aluminum",mass:26.982},Fe:{color:"#78716C",radius:1.3,name:"Iron",mass:55.845},Cu:{color:"#B45309",radius:1.28,name:"Copper",mass:63.546},Zn:{color:"#71717A",radius:1.35,name:"Zinc",mass:65.38},Ag:{color:"#C0C0C0",radius:1.45,name:"Silver",mass:107.868},Au:{color:"#FFD700",radius:1.44,name:"Gold",mass:196.967},He:{color:"#00FFFF",radius:.5,name:"Helium",mass:4.003},Ne:{color:"#FF6347",radius:.7,name:"Neon",mass:20.18},Ar:{color:"#00CED1",radius:1,name:"Argon",mass:39.948}},RN={color:"#9CA3AF",radius:1,name:"Unknown",mass:0},oY={sm:{width:120,height:120,atomRadius:14,bondWidth:2,fontSize:10},md:{width:180,height:180,atomRadius:20,bondWidth:3,fontSize:12},lg:{width:240,height:240,atomRadius:26,bondWidth:4,fontSize:14},xl:{width:320,height:320,atomRadius:32,bondWidth:5,fontSize:16}},aY={single:{lines:1,gap:0},double:{lines:2,gap:4},triple:{lines:3,gap:3}},CE={fast:200,normal:400,build:800},LN={linear:[{x:-1,y:0,z:0},{x:1,y:0,z:0}],bent:[{x:-.7,y:-.5,z:0},{x:.7,y:-.5,z:0}],"trigonal-planar":[{x:0,y:-1,z:0},{x:-.87,y:.5,z:0},{x:.87,y:.5,z:0}],"trigonal-pyramidal":[{x:0,y:-.8,z:.3},{x:-.7,y:.4,z:.3},{x:.7,y:.4,z:.3}],tetrahedral:[{x:0,y:-.9,z:.3},{x:-.85,y:.3,z:.3},{x:.85,y:.3,z:.3},{x:0,y:.3,z:-.9}],"see-saw":[{x:-1,y:0,z:0},{x:1,y:0,z:0},{x:0,y:-.8,z:.3},{x:0,y:.8,z:-.3}],"t-shaped":[{x:-1,y:0,z:0},{x:1,y:0,z:0},{x:0,y:-1,z:0}],"square-planar":[{x:0,y:-1,z:0},{x:-1,y:0,z:0},{x:0,y:1,z:0},{x:1,y:0,z:0}],"trigonal-bipyramidal":[{x:0,y:-1,z:0},{x:0,y:1,z:0},{x:-.87,y:0,z:.3},{x:.87,y:0,z:.3},{x:0,y:0,z:-1}],"square-pyramidal":[{x:0,y:-1,z:0},{x:-.8,y:.3,z:.3},{x:.8,y:.3,z:.3},{x:-.8,y:.3,z:-.6},{x:.8,y:.3,z:-.6}],octahedral:[{x:0,y:-1,z:0},{x:0,y:1,z:0},{x:-1,y:0,z:0},{x:1,y:0,z:0},{x:0,y:0,z:1},{x:0,y:0,z:-1}]},Ya={bond:"#374151",bondHighlight:"#3B82F6",bondPolar:"#6366F1",formalChargePositive:"#EF4444",formalChargeNegative:"#3B82F6",partialChargePositive:"#F97316",partialChargeNegative:"#0EA5E9",lonePair:"#6B7280",radical:"#EF4444",atomHighlight:"#FCD34D",dipole:"#8B5CF6"};function U_(i){return MN[i]||RN}function lY(i,e,t=0,n=0){return{x:t+(i.x+i.z*.3)*e,y:n+(i.y-i.z*.3)*e}}function cY(i){const e=(i+1)/2;return{opacity:.6+e*.4,scale:.8+e*.2}}function uY(i,e,t,n){const r=LN[i];return r?r.map(s=>lY(s,n,e,t)):[]}function PN(i,e,t,n){const r=new Map,s=e/2,o=t/2;if(i.atoms.some(c=>c.position)){for(const c of i.atoms)c.position&&r.set(c.id,{x:c.position.x*(e/2)+s,y:c.position.y*(t/2)+o});return r}if(i.geometry&&i.atoms.length>1){const c=Math.min(e,t)/3,u=uY(i.geometry,s,o,c);r.set(i.atoms[0].id,{x:s,y:o});for(let h=1;h<i.atoms.length&&h<=u.length;h++)r.set(i.atoms[h].id,u[h-1]);return r}const l=i.atoms.length;if(l===1)r.set(i.atoms[0].id,{x:s,y:o});else if(l===2){const c=n*3;r.set(i.atoms[0].id,{x:s-c,y:o}),r.set(i.atoms[1].id,{x:s+c,y:o})}else{const c=(l-1)*n*2.5,u=s-c/2;for(let h=0;h<l;h++)r.set(i.atoms[h].id,{x:u+h*n*2.5,y:o})}return r}function hY(i,e,t,n){const r=e.x-i.x,s=e.y-i.y,o=Math.sqrt(r*r+s*s);if(o===0)return{start:i,end:e};const a=r/o,l=s/o,c={x:i.x+a*t,y:i.y+l*t},u={x:e.x-a*n,y:e.y-l*n};return{start:c,end:u}}function JL(i,e){const t=e.x-i.x,n=e.y-i.y;return Math.atan2(n,t)*(180/Math.PI)}function NC(i,e,t){const n=e*(Math.PI/180);return{x:i.x+Math.cos(n)*t,y:i.y+Math.sin(n)*t}}function fY(i){return oY[i]}function dY(i){const e=i.replace("#",""),t=parseInt(e.substr(0,2),16),n=parseInt(e.substr(2,2),16),r=parseInt(e.substr(4,2),16);return(.299*t+.587*n+.114*r)/255>.5?"#1F2937":"#FFFFFF"}function pY(i){return i.map((e,t)=>({...e,id:e.id||`atom-${t}`}))}function mY(i,e,t,n){const r=new Map,s=t/2,o=i.atoms.filter(d=>d.symbol==="C"),a=i.atoms.filter(d=>d.symbol!=="C");if(o.length===0)return PN(i,e,t,n);const l=n*2,c=e-l*2,u=Math.min(n*3,c/Math.max(o.length-1,1)),h=(o.length-1)*u,f=(e-h)/2;o.forEach((d,m)=>{r.set(d.id,{x:f+m*u,y:s})});for(const d of a){const m=i.bonds.find(A=>A.from===d.id||A.to===d.id);if(m){const A=m.from===d.id?m.to:m.from,g=r.get(A);if(g){const y=n*1.5,E=a.indexOf(d)%2===0?-y:y;r.set(d.id,{x:g.x,y:g.y+E})}}}return r}function gY(i){switch(i){case"single":return"#4B5563";case"double":return"#16A34A";case"triple":return"#9333EA";default:return"#4B5563"}}function AY(i){switch(i){case"double":return"rgba(34, 197, 94, 0.4)";case"triple":return"rgba(168, 85, 247, 0.4)";default:return null}}function yY({atom:i,position:e,baseRadius:t,fontSize:n,mode:r,showLabel:s=!1,showFormalCharge:o=!0,showPartialCharge:a=!1,isHighlighted:l=!1,isInteractive:c=!1,onClick:u,animationDelay:h=0,reducedMotion:f=!1,depthOpacity:d=1,depthScale:m=1}){const A=U_(i.symbol),g=t*A.radius*m,y=dY(A.color),E=f?{}:{opacity:0,transform:"scale(0)",animation:`atomEnter 300ms ease-out ${h}ms forwards`},x=l?"url(#atomHighlightGlow)":void 0,C=A.strokeColor,T=C?2:0;return Z.jsxs("g",{className:`molecule-atom ${c?"cursor-pointer":""}`,onClick:c?u:void 0,role:c?"button":void 0,"aria-label":`${A.name||i.symbol} atom`,style:{opacity:d},children:[Z.jsx("circle",{cx:e.x,cy:e.y,r:g,fill:A.color,stroke:C||"transparent",strokeWidth:T,filter:x,style:E}),l&&Z.jsx("circle",{cx:e.x,cy:e.y,r:g+4,fill:"none",stroke:Ya.atomHighlight,strokeWidth:3,opacity:.7,style:E}),Z.jsx("text",{x:e.x,y:e.y,textAnchor:"middle",dominantBaseline:"central",fontSize:n*m,fontWeight:"bold",fill:y,style:E,children:i.symbol}),s&&i.label&&Z.jsx("text",{x:e.x,y:e.y-g-8,textAnchor:"middle",fontSize:n*.8,fill:"#6B7280",style:E,children:i.label}),o&&i.formalCharge!==void 0&&i.formalCharge!==0&&Z.jsxs("g",{style:E,children:[Z.jsx("circle",{cx:e.x+g*.7,cy:e.y-g*.7,r:n*.6,fill:i.formalCharge>0?Ya.formalChargePositive:Ya.formalChargeNegative}),Z.jsx("text",{x:e.x+g*.7,y:e.y-g*.7,textAnchor:"middle",dominantBaseline:"central",fontSize:n*.7,fontWeight:"bold",fill:"white",children:i.formalCharge>0?`+${i.formalCharge}`:i.formalCharge})]}),a&&i.partialCharge&&i.partialCharge!=="none"&&Z.jsx("text",{x:e.x+g*.8,y:e.y-g*.8,textAnchor:"middle",dominantBaseline:"central",fontSize:n*.9,fontWeight:"bold",fill:i.partialCharge==="positive"?Ya.partialChargePositive:Ya.partialChargeNegative,style:E,children:i.partialCharge==="positive"?"δ+":"δ−"}),i.isRadical&&Z.jsx("circle",{cx:e.x+g*.9,cy:e.y,r:4,fill:Ya.radical,style:E,children:!f&&Z.jsx("animate",{attributeName:"opacity",values:"1;0.5;1",dur:"1s",repeatCount:"indefinite"})})]})}function vY(){return Z.jsxs("defs",{children:[Z.jsxs("filter",{id:"atomHighlightGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[Z.jsx("feGaussianBlur",{stdDeviation:"3",result:"blur"}),Z.jsx("feFlood",{floodColor:Ya.atomHighlight,result:"color"}),Z.jsx("feComposite",{in:"color",in2:"blur",operator:"in",result:"glow"}),Z.jsxs("feMerge",{children:[Z.jsx("feMergeNode",{in:"glow"}),Z.jsx("feMergeNode",{in:"SourceGraphic"})]})]}),Z.jsx("style",{children:`
          @keyframes atomEnter {
            from {
              opacity: 0;
              transform: scale(0);
            }
            to {
              opacity: 1;
              transform: scale(1);
            }
          }

          @media (prefers-reduced-motion: reduce) {
            .molecule-atom * {
              animation: none !important;
              transition: none !important;
              opacity: 1 !important;
              transform: scale(1) !important;
            }
          }
        `})]})}function ZL(i,e,t){const n=e.x-i.x,r=e.y-i.y,s=Math.sqrt(n*n+r*r);return s===0?{dx:0,dy:0}:{dx:-r/s*t,dy:n/s*t}}function xY({bond:i,startPos:e,endPos:t,bondWidth:n,mode:r="simple",isHighlighted:s=!1,isInteractive:o=!1,onClick:a,animationDelay:l=0,reducedMotion:c=!1}){const u=aY[i.type];let h;s?h=Ya.bondHighlight:r==="organic"?h=gY(i.type):i.polar?h=Ya.bondPolar:h=Ya.bond;const f=r==="organic"?AY(i.type):null,d=t.x-e.x,m=t.y-e.y,A=Math.sqrt(d*d+m*m),g=c?{}:{strokeDasharray:A,strokeDashoffset:A,animation:`bondDraw 300ms ease-out ${l}ms forwards`};if(i.type==="single")return Z.jsx("g",{className:`molecule-bond ${o?"cursor-pointer":""}`,onClick:o?a:void 0,role:o?"button":void 0,"aria-label":`${i.type} bond`,children:Z.jsx("line",{x1:e.x,y1:e.y,x2:t.x,y2:t.y,stroke:h,strokeWidth:n,strokeLinecap:"round",style:g})});if(i.type==="double"){const y=ZL(e,t,u.gap/2),E=(e.x+t.x)/2,x=(e.y+t.y)/2;return Z.jsxs("g",{className:`molecule-bond ${o?"cursor-pointer":""}`,onClick:o?a:void 0,role:o?"button":void 0,"aria-label":"double bond",children:[f&&Z.jsx("ellipse",{cx:E,cy:x,rx:A/2+8,ry:12,fill:f,style:g}),Z.jsx("line",{x1:e.x+y.dx,y1:e.y+y.dy,x2:t.x+y.dx,y2:t.y+y.dy,stroke:h,strokeWidth:n,strokeLinecap:"round",style:g}),Z.jsx("line",{x1:e.x-y.dx,y1:e.y-y.dy,x2:t.x-y.dx,y2:t.y-y.dy,stroke:h,strokeWidth:n,strokeLinecap:"round",style:{...g,animationDelay:c?"0ms":`${l+50}ms`}})]})}if(i.type==="triple"){const y=ZL(e,t,u.gap),E=(e.x+t.x)/2,x=(e.y+t.y)/2;return Z.jsxs("g",{className:`molecule-bond ${o?"cursor-pointer":""}`,onClick:o?a:void 0,role:o?"button":void 0,"aria-label":"triple bond",children:[f&&Z.jsx("ellipse",{cx:E,cy:x,rx:A/2+8,ry:14,fill:f,style:g}),Z.jsx("line",{x1:e.x,y1:e.y,x2:t.x,y2:t.y,stroke:h,strokeWidth:n,strokeLinecap:"round",style:g}),Z.jsx("line",{x1:e.x+y.dx,y1:e.y+y.dy,x2:t.x+y.dx,y2:t.y+y.dy,stroke:h,strokeWidth:n,strokeLinecap:"round",style:{...g,animationDelay:c?"0ms":`${l+50}ms`}}),Z.jsx("line",{x1:e.x-y.dx,y1:e.y-y.dy,x2:t.x-y.dx,y2:t.y-y.dy,stroke:h,strokeWidth:n,strokeLinecap:"round",style:{...g,animationDelay:c?"0ms":`${l+100}ms`}})]})}return null}function EY(){return Z.jsx("defs",{children:Z.jsx("style",{children:`
          @keyframes bondDraw {
            to {
              stroke-dashoffset: 0;
            }
          }

          @media (prefers-reduced-motion: reduce) {
            .molecule-bond {
              animation: none !important;
              stroke-dashoffset: 0 !important;
            }
          }
        `})})}function _Y({atomPosition:i,angle:e,distance:t,dotSize:n=4,color:r=Ya.lonePair,animationDelay:s=0,reducedMotion:o=!1}){const a=NC(i,e,t),l=e+90,c=n*1.2,u=NC(a,l,c/2),h=NC(a,l+180,c/2),f=o?{}:{opacity:0,transform:"scale(0)",animation:`lonePairEnter 200ms ease-out ${s}ms forwards`};return Z.jsxs("g",{className:"molecule-lone-pair","aria-label":"lone pair",children:[Z.jsx("circle",{cx:u.x,cy:u.y,r:n/2,fill:r,style:f}),Z.jsx("circle",{cx:h.x,cy:h.y,r:n/2,fill:r,style:{...f,animationDelay:o?"0ms":`${s+50}ms`}})]})}function SY(i,e){if(e===0)return[];if(i.length===0){const s=[],o=360/e;for(let a=0;a<e;a++)s.push(a*o-90);return s}const t=[...i].sort((s,o)=>s-o),n=[];for(let s=0;s<t.length;s++){const o=t[s];let l=t[(s+1)%t.length]-o;l<=0&&(l+=360);const c=o+l/2;n.push({midAngle:c%360,size:l})}n.sort((s,o)=>o.size-s.size);const r=[];for(let s=0;s<e&&s<n.length;s++)r.push(n[s].midAngle);return r}function wY(){return Z.jsx("defs",{children:Z.jsx("style",{children:`
          @keyframes lonePairEnter {
            from {
              opacity: 0;
              transform: scale(0);
            }
            to {
              opacity: 1;
              transform: scale(1);
            }
          }

          @media (prefers-reduced-motion: reduce) {
            .molecule-lone-pair circle {
              animation: none !important;
              opacity: 1 !important;
              transform: scale(1) !important;
            }
          }
        `})})}function CY(i){switch(i){case"right":return 0;case"down":return 90;case"left":return 180;case"up":return 270;default:return 0}}function TE(i,e,t){const n=e*Math.PI/180;return{x:i.x+Math.cos(n)*t,y:i.y+Math.sin(n)*t}}function TY({moleculeCenter:i,dipole:e,length:t=60,strokeWidth:n=3,color:r=Ya.dipole,animationDelay:s=0,reducedMotion:o=!1,showLabels:a=!0}){const l=CY(e.direction),c=t/2,u=TE(i,l+180,c),h=TE(i,l,c),f=12,d=8,m=l*Math.PI/180,A=m+Math.PI/2,g={x:h.x-Math.cos(m)*f,y:h.y-Math.sin(m)*f},y={x:g.x+Math.cos(A)*d/2,y:g.y+Math.sin(A)*d/2},E={x:g.x-Math.cos(A)*d/2,y:g.y-Math.sin(A)*d/2},x=o?{}:{opacity:0,animation:`dipoleEnter 400ms ease-out ${s}ms forwards`},C=14,T=TE(u,l+180,C),I=TE(h,l,C);return Z.jsxs("g",{className:"molecule-dipole","aria-label":"dipole moment arrow",style:x,children:[Z.jsx("line",{x1:u.x,y1:u.y,x2:g.x,y2:g.y,stroke:r,strokeWidth:n,strokeLinecap:"round"}),Z.jsx("polygon",{points:`${h.x},${h.y} ${y.x},${y.y} ${E.x},${E.y}`,fill:r}),Z.jsx("line",{x1:u.x+Math.cos(A)*6,y1:u.y+Math.sin(A)*6,x2:u.x-Math.cos(A)*6,y2:u.y-Math.sin(A)*6,stroke:r,strokeWidth:n,strokeLinecap:"round"}),a&&Z.jsxs(Z.Fragment,{children:[Z.jsx("text",{x:T.x,y:T.y,textAnchor:"middle",dominantBaseline:"central",fontSize:12,fontWeight:"bold",fill:Ya.partialChargePositive,children:"δ+"}),Z.jsx("text",{x:I.x,y:I.y,textAnchor:"middle",dominantBaseline:"central",fontSize:12,fontWeight:"bold",fill:Ya.partialChargeNegative,children:"δ−"})]})]})}function bY(i,e){const t=i.filter(c=>c.partialCharge==="positive"),n=i.filter(c=>c.partialCharge==="negative");if(t.length===0||n.length===0)return;const r={x:t.reduce((c,u)=>c+u.position.x,0)/t.length,y:t.reduce((c,u)=>c+u.position.y,0)/t.length},s={x:n.reduce((c,u)=>c+u.position.x,0)/n.length,y:n.reduce((c,u)=>c+u.position.y,0)/n.length},o=s.x-r.x,a=s.y-r.y,l=Math.atan2(a,o)*(180/Math.PI);return l>=-45&&l<45?"right":l>=45&&l<135?"down":l>=-135&&l<-45?"up":"left"}function IY(i,e,t){const n=Math.min(i,e)*.6,r=t?n*Math.min(t,2):n;return Math.max(40,Math.min(r,100))}function MY(){return Z.jsx("defs",{children:Z.jsx("style",{children:`
          @keyframes dipoleEnter {
            from {
              opacity: 0;
              transform: scale(0.8);
            }
            to {
              opacity: 1;
              transform: scale(1);
            }
          }

          @media (prefers-reduced-motion: reduce) {
            .molecule-dipole {
              animation: none !important;
              opacity: 1 !important;
              transform: scale(1) !important;
            }
          }
        `})})}function RY({atomCount:i,bondCount:e,lonePairCount:t,animation:n,baseDuration:r,reducedMotion:s=!1,onAnimationComplete:o}){const[a,l]=w.useState("idle"),[c,u]=w.useState(0),h=s||n==="none",f=w.useMemo(()=>{if(r)return r;switch(n){case"none":return 0;case"fade-in":return CE.fast;case"scale-in":return CE.normal;case"build":return CE.build;default:return CE.normal}},[n,r]),d=w.useMemo(()=>{if(h)return{atomDelay:0,atomDuration:0,bondStartDelay:0,bondDelay:0,bondDuration:0,lonePairStartDelay:0,lonePairDelay:0,lonePairDuration:0};switch(n){case"build":const x=Math.max(50,f/Math.max(i,1)),C=Math.max(30,f*.5/Math.max(e,1));return{atomDelay:x,atomDuration:300,bondStartDelay:i*x,bondDelay:C,bondDuration:300,lonePairStartDelay:i*x+e*C,lonePairDelay:50,lonePairDuration:200};case"scale-in":return{atomDelay:30,atomDuration:f,bondStartDelay:50,bondDelay:20,bondDuration:f,lonePairStartDelay:100,lonePairDelay:30,lonePairDuration:f*.8};case"fade-in":default:return{atomDelay:20,atomDuration:f,bondStartDelay:30,bondDelay:15,bondDuration:f,lonePairStartDelay:50,lonePairDelay:25,lonePairDuration:f}}},[n,f,i,e,h]),m=w.useMemo(()=>{if(h)return 0;const x=i*d.atomDelay+d.atomDuration,C=d.bondStartDelay+e*d.bondDelay+d.bondDuration,T=d.lonePairStartDelay+t*d.lonePairDelay+d.lonePairDuration;return Math.max(x,C,T)},[i,e,t,d,h]),A=w.useCallback(x=>h?{delay:0,duration:0}:{delay:x*d.atomDelay,duration:d.atomDuration},[d,h]),g=w.useCallback(x=>h?{delay:0,duration:0}:{delay:d.bondStartDelay+x*d.bondDelay,duration:d.bondDuration},[d,h]),y=w.useCallback((x,C)=>{if(h)return{delay:0,duration:0};const T=x*2+C;return{delay:d.lonePairStartDelay+T*d.lonePairDelay,duration:d.lonePairDuration}},[d,h]),E=w.useCallback(()=>{u(x=>x+1),l("idle")},[]);return w.useEffect(()=>{if(h){l("complete");return}l("running");const x=setTimeout(()=>{l("complete"),o==null||o()},m+50);return()=>clearTimeout(x)},[c,m,h,o]),{state:a,getAtomTiming:A,getBondTiming:g,getLonePairTiming:y,totalDuration:m,shouldSkipAnimation:h,restart:E}}const LY=`
  @keyframes moleculeFadeIn {
    from {
      opacity: 0;
    }
    to {
      opacity: 1;
    }
  }

  @keyframes moleculeScaleIn {
    from {
      opacity: 0;
      transform: scale(0);
    }
    to {
      opacity: 1;
      transform: scale(1);
    }
  }

  @keyframes moleculeBuildAtom {
    0% {
      opacity: 0;
      transform: scale(0);
    }
    50% {
      opacity: 1;
      transform: scale(1.1);
    }
    100% {
      opacity: 1;
      transform: scale(1);
    }
  }

  @keyframes moleculeBuildBond {
    from {
      stroke-dashoffset: var(--bond-length, 100);
    }
    to {
      stroke-dashoffset: 0;
    }
  }

  @keyframes moleculePulse {
    0%, 100% {
      transform: scale(1);
    }
    50% {
      transform: scale(1.05);
    }
  }
`;function PY({molecule:i,mode:e="simple",size:t="md",animation:n="fade-in",animationDuration:r,showLonePairs:s=!1,showFormalCharges:o=!0,showPartialCharges:a=!1,showDipoleMoment:l=!1,showAtomLabels:c=!1,interactive:u=!1,onAtomClick:h,onBondClick:f,highlightedAtoms:d=[],highlightedBonds:m=[],className:A="",reducedMotion:g=!1,ariaLabel:y,onAnimationComplete:E}){const x=fY(t),{width:C,height:T,atomRadius:I,bondWidth:M,fontSize:L}=x,R=w.useMemo(()=>pY(i.atoms),[i.atoms]),P=w.useMemo(()=>!s||e!=="lewis"?0:R.reduce((q,J)=>q+(J.lonePairs||0),0),[R,s,e]),{getAtomTiming:F,getBondTiming:k,getLonePairTiming:z,shouldSkipAnimation:U}=RY({atomCount:R.length,bondCount:i.bonds.length,lonePairCount:P,animation:n,baseDuration:r,reducedMotion:g,onAnimationComplete:E}),W=w.useMemo(()=>e==="organic"?mY({...i,atoms:R},C,T,I):PN({...i,atoms:R},C,T,I),[i,R,C,T,I,e]),$=w.useMemo(()=>{const q=new Map;for(const J of R){const ie=W.get(J.id);if(!ie)continue;const re=[];for(const se of i.bonds)if(se.from===J.id){const ge=W.get(se.to);ge&&re.push(JL(ie,ge))}else if(se.to===J.id){const ge=W.get(se.from);ge&&re.push(JL(ie,ge))}q.set(J.id,re)}return q},[R,W,i.bonds]),oe=w.useMemo(()=>{if(e!=="vsepr"||!i.geometry)return new Map;const q=LN[i.geometry];if(!q)return new Map;const J=new Map;R.length>0&&J.set(R[0].id,{opacity:1,scale:1});for(let ie=1;ie<R.length&&ie<=q.length;ie++){const re=q[ie-1].z;J.set(R[ie].id,cY(re))}return J},[e,i.geometry,R]),X=w.useMemo(()=>{var ie,re,se;if(!l)return null;let q=(ie=i.dipoleMoment)==null?void 0:ie.direction;if(!q&&i.isPolar){const ge=R.map(xe=>({position:W.get(xe.id),partialCharge:xe.partialCharge})).filter(xe=>xe.position);q=bY(ge)}if(!q)return null;const J=IY(C*.6,T*.6,(re=i.dipoleMoment)==null?void 0:re.magnitude);return{direction:q,magnitude:(se=i.dipoleMoment)==null?void 0:se.magnitude,length:J,center:{x:C/2,y:T/2}}},[l,i.dipoleMoment,i.isPolar,R,W,C,T]),Q=q=>{if(!u||!h)return;const J=R.find(ie=>ie.id===q);h({type:"atom",atomId:q,atom:J})},Y=q=>{if(!u||!f)return;const J=i.bonds[q];f({type:"bond",bondIndex:q,bond:J})},O=i.bonds.map((q,J)=>{const ie=W.get(q.from),re=W.get(q.to);if(!ie||!re)return null;const se=R.find(ve=>ve.id===q.from),ge=R.find(ve=>ve.id===q.to),xe=I*(se?U_(se.symbol).radius:1),pe=I*(ge?U_(ge.symbol).radius:1),{start:ce,end:we}=hY(ie,re,xe,pe),Ee=k(J);return Z.jsx(xY,{bond:q,startPos:ce,endPos:we,bondWidth:M,mode:e,isHighlighted:m.includes(J)||q.highlight,isInteractive:u,onClick:()=>Y(J),animationDelay:Ee.delay,reducedMotion:U},`bond-${J}`)}),K=R.map((q,J)=>{const ie=W.get(q.id);if(!ie)return null;const re=oe.get(q.id)||{opacity:1,scale:1},se=F(J);return Z.jsx(yY,{atom:q,position:ie,baseRadius:I,fontSize:L,mode:e,showLabel:c,showFormalCharge:o&&e==="lewis",showPartialCharge:a,isHighlighted:d.includes(q.id)||q.highlight,isInteractive:u,onClick:()=>Q(q.id),animationDelay:se.delay,reducedMotion:U,depthOpacity:re.opacity,depthScale:re.scale},q.id)}),te=y||`${i.name||i.formula} molecule with ${R.length} atoms and ${i.bonds.length} bonds`;return Z.jsxs("svg",{width:C,height:T,viewBox:`0 0 ${C} ${T}`,className:`animated-molecule ${A}`,role:"img","aria-label":te,children:[Z.jsx("defs",{children:Z.jsx("style",{children:LY})}),Z.jsx(vY,{}),Z.jsx(EY,{}),Z.jsx(wY,{}),Z.jsx(MY,{}),Z.jsx("rect",{x:0,y:0,width:C,height:T,fill:"transparent",rx:8}),Z.jsx("g",{className:"molecule-bonds",children:O}),Z.jsx("g",{className:"molecule-atoms",children:K}),s&&e==="lewis"&&Z.jsx("g",{className:"molecule-lone-pairs",children:R.map((q,J)=>{if(!q.lonePairs||q.lonePairs===0)return null;const ie=W.get(q.id);if(!ie)return null;const re=$.get(q.id)||[],se=SY(re,q.lonePairs),ge=U_(q.symbol),pe=I*ge.radius+8;return se.map((ce,we)=>{const Ee=z(J,we);return Z.jsx(_Y,{atomPosition:ie,angle:ce,distance:pe,dotSize:Math.max(4,L*.4),animationDelay:Ee.delay,reducedMotion:U},`${q.id}-lp-${we}`)})})}),l&&X&&Z.jsx(TY,{moleculeCenter:X.center,dipole:{direction:X.direction,magnitude:X.magnitude},length:X.length,animationDelay:U?0:500,reducedMotion:U,showLabels:!a})]})}const eP={0:1,1:.8,2:.6,3:.4,4:.4},BN={topic:"Efni",strategy:"Aðferð",method:"Formúla",solution:"Lausn"},BY={topic:"📌",strategy:"🎯",method:"🔧",solution:"✅"},UC=["topic","strategy","method","solution"],DY={topic:{bg:"bg-yellow-50",border:"border-yellow-400",text:"text-yellow-800"},strategy:{bg:"bg-orange-50",border:"border-orange-400",text:"text-orange-800"},method:{bg:"bg-amber-50",border:"border-amber-500",text:"text-amber-800"},solution:{bg:"bg-green-50",border:"border-green-500",text:"text-green-800"}};function kY({tier:i,content:e,animationDelay:t=0}){const n=DY[i],r=BY[i],s=BN[i];return Z.jsx("div",{className:`
        ${n.bg} ${n.border} ${n.text}
        border-l-4 rounded-lg p-3 mb-2
        animate-fadeIn
      `,style:{animationDelay:`${t}ms`,animationFillMode:"backwards"},children:Z.jsxs("div",{className:"flex items-start gap-2",children:[Z.jsx("span",{className:"text-lg flex-shrink-0",role:"img","aria-label":s,children:r}),Z.jsxs("div",{className:"flex-1 min-w-0",children:[Z.jsx("span",{className:"font-semibold text-xs uppercase tracking-wide opacity-70",children:s}),Z.jsx("p",{className:"text-sm mt-0.5 leading-relaxed",children:e})]})]})})}function FY({hints:i,basePoints:e=20,onHintUsed:t,onPointsChange:n,disabled:r=!1,className:s="",resetKey:o=0}){const[a,l]=w.useState([]),[c,u]=w.useState(0);w.useEffect(()=>{l([]),u(0)},[o]);const h=c>=UC.length,f=h?null:UC[c],d=c+1,m=w.useCallback(()=>{if(h||!f)return;const A=c+1,g=UC[c],y=eP[A];l(E=>[...E,g]),u(A),t==null||t(A,y),n==null||n(y)},[c,h,f,t,n]);return r?null:Z.jsxs("div",{className:`hint-system ${s}`,children:[a.length>0&&Z.jsx("div",{className:"mb-3",children:a.map((A,g)=>Z.jsx(kY,{tier:A,content:i[A],animationDelay:g*100},A))}),!h&&f&&Z.jsxs("button",{onClick:m,className:`
            w-full bg-yellow-100 hover:bg-yellow-200
            text-yellow-800 font-semibold
            py-3 px-4 rounded-xl
            transition-colors
            flex items-center justify-center gap-2
          `,type:"button",children:[Z.jsx("span",{children:"💡"}),Z.jsxs("span",{children:["Vísbending ",d,"/4: ",BN[f]]})]}),h&&Z.jsx("div",{className:"text-center text-gray-500 text-sm py-2",children:"Allar vísbendingar notaðar"}),a.length>0&&Z.jsxs("div",{className:"text-center text-xs text-gray-400 mt-2",children:["Stig: ",Math.round(e*eP[c])," / ",e]})]})}const OY={showExplanation:!0,showMisconceptions:!0,showRelatedConcepts:!0,showNextSteps:!0,autoCollapseMs:0};function NY(i){switch(i){case"success":return{container:"bg-green-50 border-green-200",icon:"text-green-500",text:"text-green-800"};case"error":return{container:"bg-red-50 border-red-200",icon:"text-red-500",text:"text-red-800"};case"warning":return{container:"bg-amber-50 border-amber-200",icon:"text-amber-500",text:"text-amber-800"};case"info":default:return{container:"bg-blue-50 border-blue-200",icon:"text-blue-500",text:"text-blue-800"}}}function UY(i){switch(i){case"success":return"✓";case"error":return"✗";case"warning":return"⚠";case"info":default:return"ℹ"}}function DN({feedback:i,severity:e,config:t,onDismiss:n,onConceptClick:r,className:s=""}){const[o,a]=w.useState(!1),[l,c]=w.useState(!0),u={...OY,...t},h=e??(i.isCorrect?"success":"error"),f=NY(h),d=UY(h);w.useEffect(()=>{if(u.autoCollapseMs&&u.autoCollapseMs>0){const g=setTimeout(()=>{a(!1)},u.autoCollapseMs);return()=>clearTimeout(g)}},[u.autoCollapseMs,o]);const m=w.useCallback(()=>{c(!1),n==null||n()},[n]),A=w.useCallback(g=>{r==null||r(g.toLowerCase().replace(/\s+/g,"-"))},[r]);return l?Z.jsx("div",{className:`
        feedback-panel
        ${f.container}
        border rounded-xl p-4
        transition-all duration-300 ease-in-out
        ${s}
      `,role:"alert","aria-live":"polite",children:Z.jsxs("div",{className:"flex items-start gap-3",children:[Z.jsx("span",{className:`
            ${f.icon}
            text-2xl font-bold
            flex-shrink-0
          `,"aria-hidden":"true",children:d}),Z.jsxs("div",{className:"flex-1 min-w-0",children:[Z.jsx("p",{className:`${f.text} font-medium`,children:i.isCorrect?"Rétt!":"Rangt"}),u.showExplanation&&i.explanation&&Z.jsxs("div",{className:"mt-2",children:[Z.jsxs("button",{onClick:()=>a(!o),className:`
                  text-sm ${f.text} opacity-75
                  hover:opacity-100 transition-opacity
                  flex items-center gap-1
                `,type:"button","aria-expanded":o,children:[Z.jsx("span",{className:"text-xs",children:o?"▼":"▶"}),Z.jsx("span",{children:"Af hverju?"})]}),o&&Z.jsx("div",{className:`
                    mt-2 p-3 rounded-lg
                    bg-white/50
                    ${f.text} text-sm
                    animate-fadeIn
                  `,children:i.explanation})]}),u.showMisconceptions&&i.misconception&&!i.isCorrect&&Z.jsxs("div",{className:`
                mt-3 p-3 rounded-lg
                bg-amber-100 border border-amber-300
                text-amber-800 text-sm
              `,children:[Z.jsx("span",{className:"font-medium",children:"Algeng villa: "}),i.misconception]}),u.showRelatedConcepts&&i.relatedConcepts&&i.relatedConcepts.length>0&&Z.jsxs("div",{className:"mt-3",children:[Z.jsx("span",{className:`text-xs ${f.text} opacity-75`,children:"Tengd efni:"}),Z.jsx("div",{className:"flex flex-wrap gap-2 mt-1",children:i.relatedConcepts.map(g=>Z.jsx("button",{onClick:()=>A(g),className:`
                        px-2 py-1 rounded-full
                        text-xs font-medium
                        bg-white/70 ${f.text}
                        hover:bg-white transition-colors
                      `,type:"button",children:g},g))})]}),u.showNextSteps&&i.nextSteps&&Z.jsxs("div",{className:`
                mt-3 text-sm ${f.text} opacity-90
                flex items-center gap-2
              `,children:[Z.jsx("span",{children:"→"}),Z.jsx("span",{children:i.nextSteps})]})]}),n&&Z.jsx("button",{onClick:m,className:`
              ${f.text} opacity-50
              hover:opacity-100 transition-opacity
              flex-shrink-0 p-1
            `,type:"button","aria-label":"Loka",children:"✕"})]})}):null}function kN({item:i,isDragging:e=!1,onDragStart:t,onDragEnd:n,className:r=""}){const s=w.useRef(null),o=w.useCallback(u=>{if(i.disabled){u.preventDefault();return}if(u.dataTransfer.setData("text/plain",i.id),u.dataTransfer.effectAllowed="move",s.current){const h=s.current.getBoundingClientRect();u.dataTransfer.setDragImage(s.current,h.width/2,h.height/2)}t==null||t(i.id)},[i.id,i.disabled,t]),a=w.useCallback(()=>{n==null||n()},[n]),l=w.useCallback(u=>{if(i.disabled)return;const h=u.currentTarget;h.style.transform="scale(1.05)",h.style.opacity="0.8",t==null||t(i.id)},[i.id,i.disabled,t]),c=w.useCallback(u=>{const h=u.currentTarget;h.style.transform="",h.style.opacity="",n==null||n()},[n]);return Z.jsx("div",{ref:s,draggable:!i.disabled,onDragStart:o,onDragEnd:a,onTouchStart:l,onTouchEnd:c,className:`
        draggable-item
        px-3 py-2 rounded-lg
        bg-white border-2 border-gray-200
        shadow-sm
        cursor-grab active:cursor-grabbing
        transition-all duration-150
        select-none
        ${e?"opacity-50 scale-95":"hover:border-blue-300 hover:shadow-md"}
        ${i.disabled?"opacity-50 cursor-not-allowed":""}
        ${r}
      `,"data-item-id":i.id,"data-category":i.category,role:"button","aria-grabbed":e,"aria-disabled":i.disabled,tabIndex:i.disabled?-1:0,children:i.content})}function zY({zone:i,items:e,isOver:t=!1,canDrop:n=!0,onDrop:r,onReorder:s,orientation:o="horizontal",className:a="",renderItem:l}){const[c,u]=w.useState(null),[h,f]=w.useState(null),d=w.useRef(null),m=w.useCallback(I=>{if(I.preventDefault(),!n){I.dataTransfer.dropEffect="none";return}if(I.dataTransfer.dropEffect="move",!d.current)return;const M=Array.from(d.current.querySelectorAll(".draggable-item")),L=d.current.getBoundingClientRect();if(o==="horizontal"){const R=I.clientX-L.left;let P=M.length;for(let F=0;F<M.length;F++){const k=M[F].getBoundingClientRect(),z=k.left-L.left+k.width/2;if(R<z){P=F;break}}u(P)}else{const R=I.clientY-L.top;let P=M.length;for(let F=0;F<M.length;F++){const k=M[F].getBoundingClientRect(),z=k.top-L.top+k.height/2;if(R<z){P=F;break}}u(P)}},[n,o]),A=w.useCallback(()=>{u(null)},[]),g=w.useCallback(I=>{I.preventDefault();const M=I.dataTransfer.getData("text/plain"),L=c??e.length;if(u(null),!M||!n)return;const R=e.findIndex(P=>P.id===M);if(R!==-1){const P=[...e.map(F=>F.id)];P.splice(R,1),P.splice(L>R?L-1:L,0,M),s==null||s(P)}else r==null||r(M,L)},[e,c,n,r,s]),y=w.useCallback(I=>{f(I)},[]),E=w.useCallback(()=>{f(null)},[]),x=w.useCallback(I=>{if(!d.current||e.length===0)return;const M=I.touches[0],L=d.current.getBoundingClientRect();M.clientX>=L.left&&M.clientX<=L.right&&M.clientY>=L.top&&M.clientY<=L.bottom},[e.length]),C=i.maxItems!==void 0&&e.length>=i.maxItems,T=t&&n&&!C;return Z.jsxs("div",{ref:d,onDragOver:m,onDragLeave:A,onDrop:g,onTouchMove:x,className:`
        drop-zone
        min-h-[60px] p-3 rounded-xl
        border-2 border-dashed
        transition-all duration-200
        ${T?"border-blue-400 bg-blue-50":"border-gray-300 bg-gray-50"}
        ${!n&&t?"border-red-300 bg-red-50":""}
        ${C?"border-amber-300 bg-amber-50":""}
        ${a}
      `,"data-zone-id":i.id,role:"listbox","aria-label":i.label||`Drop zone ${i.id}`,children:[i.label&&Z.jsx("div",{className:"text-xs font-medium text-gray-500 mb-2",children:i.label}),Z.jsxs("div",{className:`
          flex gap-2
          ${o==="horizontal"?"flex-row flex-wrap":"flex-col"}
        `,children:[e.length===0&&i.placeholder&&Z.jsx("div",{className:"text-gray-400 text-sm italic py-2",children:i.placeholder}),e.map((I,M)=>Z.jsxs("div",{className:"relative",children:[c===M&&Z.jsx("div",{className:`
                  absolute bg-blue-500 rounded-full
                  ${o==="horizontal"?"w-1 h-full -left-1.5 top-0":"h-1 w-full -top-1.5 left-0"}
                `}),l?l(I,M):Z.jsx(kN,{item:I,isDragging:h===I.id,onDragStart:y,onDragEnd:E})]},I.id)),c===e.length&&e.length>0&&Z.jsx("div",{className:`
              bg-blue-500 rounded-full
              ${o==="horizontal"?"w-1 h-8 self-center":"h-1 w-full"}
            `})]}),i.maxItems!==void 0&&Z.jsxs("div",{className:"text-xs text-gray-400 mt-2 text-right",children:[e.length," / ",i.maxItems]})]})}function GY({items:i,zones:e,initialState:t={},onDrop:n,onReorder:r,validateDrop:s,orientation:o="horizontal",disabled:a=!1,className:l="",itemsPoolClassName:c="",zonesClassName:u=""}){const[h,f]=w.useState(()=>{const F={};for(const k of e)F[k.id]=t[k.id]||[];return F}),[d,m]=w.useState(null),[A,g]=w.useState(null),y=w.useMemo(()=>{const F=new Set(Object.values(h).flat());return i.filter(k=>!F.has(k.id))},[i,h]),E=w.useCallback(F=>(h[F]||[]).map(z=>i.find(U=>U.id===z)).filter(z=>z!==void 0),[i,h]),x=w.useCallback((F,k)=>{if(a)return!1;const z=i.find(W=>W.id===F),U=e.find(W=>W.id===k);if(!z||!U||z.disabled||U.acceptedCategories&&z.category&&!U.acceptedCategories.includes(z.category))return!1;if(U.maxItems!==void 0){const W=h[k]||[];if(!W.includes(F)&&W.length>=U.maxItems)return!1}return!(s&&!s(F,k))},[a,i,e,h,s]),C=w.useCallback(F=>(k,z)=>{if(!x(k,F))return;let U;for(const[$,oe]of Object.entries(h))if(oe.includes(k)){U=$;break}f($=>{const oe={...$};U&&(oe[U]=$[U].filter(Q=>Q!==k));const X=[...$[F]||[]];return X.splice(z,0,k),oe[F]=X,oe});const W={itemId:k,zoneId:F,fromZoneId:U,index:z};n==null||n(W)},[h,x,n]),T=w.useCallback(F=>k=>{f(z=>({...z,[F]:k})),r==null||r(F,k)},[r]),I=w.useCallback(F=>{m(F)},[]),M=w.useCallback(()=>{m(null),g(null)},[]),L=w.useCallback(F=>{g(F)},[]),R=w.useCallback(F=>{F.preventDefault();const k=F.dataTransfer.getData("text/plain");k&&f(z=>{const U={...z};for(const W of Object.keys(U))U[W]=z[W].filter($=>$!==k);return U})},[]),P=w.useCallback(F=>{F.preventDefault(),F.dataTransfer.dropEffect="move"},[]);return Z.jsxs("div",{className:`
        drag-drop-builder
        flex flex-col gap-4
        ${l}
      `,children:[Z.jsxs("div",{className:`
          items-pool
          p-4 rounded-xl
          bg-gray-100 border border-gray-200
          ${c}
        `,onDrop:R,onDragOver:P,children:[Z.jsx("div",{className:"text-xs font-medium text-gray-500 mb-2",children:"Tiltæk atriði"}),Z.jsxs("div",{className:`
            flex gap-2
            ${o==="horizontal"?"flex-row flex-wrap":"flex-col"}
          `,children:[y.length===0&&Z.jsx("div",{className:"text-gray-400 text-sm italic py-2",children:"Öll atriði hafa verið sett"}),y.map(F=>Z.jsx(kN,{item:a?{...F,disabled:!0}:F,isDragging:d===F.id,onDragStart:I,onDragEnd:M},F.id))]})]}),Z.jsx("div",{className:`
          drop-zones
          flex gap-4
          ${e.length>2?"flex-col md:flex-row":"flex-col sm:flex-row"}
          ${u}
        `,children:e.map(F=>{const k=E(F.id),z=A===F.id,U=d?x(d,F.id):!0;return Z.jsx("div",{className:"flex-1",onDragOver:()=>L(F.id),children:Z.jsx(zY,{zone:F,items:k,isOver:z,canDrop:U,onDrop:C(F.id),onReorder:T(F.id),orientation:o})},F.id)})})]})}const HY="modulepreload",QY=function(i,e){return new URL(i,e).href},tP={},k1=function(e,t,n){let r=Promise.resolve();if(t&&t.length>0){let o=function(u){return Promise.all(u.map(h=>Promise.resolve(h).then(f=>({status:"fulfilled",value:f}),f=>({status:"rejected",reason:f}))))};const a=document.getElementsByTagName("link"),l=document.querySelector("meta[property=csp-nonce]"),c=(l==null?void 0:l.nonce)||(l==null?void 0:l.getAttribute("nonce"));r=o(t.map(u=>{if(u=QY(u,n),u in tP)return;tP[u]=!0;const h=u.endsWith(".css"),f=h?'[rel="stylesheet"]':"";if(!!n)for(let A=a.length-1;A>=0;A--){const g=a[A];if(g.href===u&&(!h||g.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${u}"]${f}`))return;const m=document.createElement("link");if(m.rel=h?"stylesheet":HY,h||(m.as="script"),m.crossOrigin="",m.href=u,c&&m.setAttribute("nonce",c),document.head.appendChild(m),h)return new Promise((A,g)=>{m.addEventListener("load",A),m.addEventListener("error",()=>g(new Error(`Unable to preload CSS for ${u}`)))})}))}function s(o){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=o,window.dispatchEvent(a),!a.defaultPrevented)throw o}return r.then(o=>{for(const a of o||[])a.status==="rejected"&&s(a.reason);return e().catch(s)})},VY=w.lazy(()=>k1(()=>Promise.resolve().then(()=>pEe),void 0,import.meta.url).then(i=>({default:i.MoleculeViewer3D})));function WY({width:i,height:e}){return Z.jsx("div",{className:`
        flex items-center justify-center
        bg-gray-100 rounded-xl
        text-gray-500 text-sm
      `,style:{width:typeof i=="number"?`${i}px`:i||"100%",height:typeof e=="number"?`${e}px`:e||"300px"},children:Z.jsxs("div",{className:"text-center",children:[Z.jsx("div",{className:"animate-spin w-6 h-6 border-2 border-gray-300 border-t-blue-500 rounded-full mx-auto mb-2"}),Z.jsx("span",{children:"Loading 3D viewer..."})]})})}function jY({width:i,height:e,error:t}){return Z.jsx("div",{className:`
        flex items-center justify-center
        bg-gray-100 rounded-xl
        text-gray-500 text-sm
      `,style:{width:typeof i=="number"?`${i}px`:i||"100%",height:typeof e=="number"?`${e}px`:e||"300px"},children:Z.jsxs("div",{className:"text-center p-4",children:[Z.jsx("span",{className:"block text-amber-500 text-lg mb-2",children:"⚠"}),Z.jsx("span",{className:"block",children:"3D viewer not available"}),Z.jsx("span",{className:"block text-xs text-gray-400 mt-1",children:t||"Three.js dependencies may not be installed"})]})})}function KY(i){const[e,t]=w.useState(!1),[n,r]=w.useState();return w.useEffect(()=>{(async()=>{try{await k1(()=>Promise.resolve().then(()=>X6),void 0,import.meta.url),await k1(()=>Promise.resolve().then(()=>rre),void 0,import.meta.url),await k1(()=>Promise.resolve().then(()=>lEe),void 0,import.meta.url)}catch(o){t(!0),r(o instanceof Error?o.message:"Failed to load 3D dependencies")}})()},[]),e?Z.jsx(jY,{width:i.width,height:i.height,error:n}):Z.jsx(w.Suspense,{fallback:i.loadingFallback||Z.jsx(WY,{width:i.width,height:i.height}),children:Z.jsx(VY,{...i})})}/**
 * @license
 * Copyright 2010-2023 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const dp="160",oc={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},Sf={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},FN=0,qI=1,ON=2,$Y=3,NN=0,dw=1,Vv=2,fu=3,tl=0,ys=1,Pi=2,YY=2,gc=0,Kd=1,AS=2,JI=3,ZI=4,pw=5,Nd=100,UN=101,zN=102,eM=103,tM=104,GN=200,mw=201,HN=202,QN=203,A2=204,yS=205,VN=206,WN=207,jN=208,KN=209,$N=210,YN=211,XN=212,qN=213,JN=214,ZN=0,eU=1,tU=2,y2=3,nU=4,iU=5,rU=6,sU=7,ex=0,oU=1,aU=2,yu=0,lU=1,cU=2,uU=3,d6=4,hU=5,fU=6,nM="attached",dU="detached",np=300,_u=301,ip=302,Ym=303,v2=304,vA=306,_o=1e3,ji=1001,X1=1002,zn=1003,x2=1004,XY=1004,F1=1005,qY=1005,Pn=1006,gw=1007,JY=1007,Bl=1008,iM=1008,Zi=1009,E2=1010,Aw=1011,pp=1012,Nm=1013,Zo=1014,fi=1015,Ni=1016,p6=1017,m6=1018,$d=1020,pU=1021,gi=1023,mU=1024,gU=1025,vu=1026,Xm=1027,hc=1028,yw=1029,Gd=1030,tx=1031,qm=1033,Wv=33776,z_=33777,G_=33778,jv=33779,vS=35840,rM=35841,xS=35842,sM=35843,vw=36196,ES=37492,_S=37496,SS=37808,oM=37809,aM=37810,lM=37811,_2=37812,cM=37813,uM=37814,hM=37815,fM=37816,dM=37817,pM=37818,mM=37819,gM=37820,AM=37821,Kv=36492,yM=36494,vM=36495,AU=36283,xM=36284,EM=36285,_M=36286,yU=2200,vU=2201,xU=2202,q1=2300,Jm=2301,H_=2302,Im=2400,Mm=2401,S2=2402,xw=2500,g6=2501,EU=0,A6=1,wS=2,y6=3e3,Yd=3001,_U=3200,Ew=3201,mp=0,SU=1,Tl="",gs="srgb",Dl="srgb-linear",_w="display-p3",nx="display-p3-linear",w2="linear",mr="srgb",C2="rec709",T2="p3",ZY=0,hh=7680,Q_=7681,eX=7682,tX=7683,nX=34055,iX=34056,rX=5386,sX=512,oX=513,wU=514,aX=515,lX=516,CU=517,cX=518,CS=519,TU=512,bU=513,IU=514,v6=515,MU=516,RU=517,LU=518,PU=519,b2=35044,No=35048,uX=35040,hX=35045,fX=35049,dX=35041,pX=35046,mX=35050,gX=35042,AX="100",SM="300 es",TS=1035,mu=2e3,J1=2001;let Ch=class{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const n=this._listeners;n[e]===void 0&&(n[e]=[]),n[e].indexOf(t)===-1&&n[e].push(t)}hasEventListener(e,t){if(this._listeners===void 0)return!1;const n=this._listeners;return n[e]!==void 0&&n[e].indexOf(t)!==-1}removeEventListener(e,t){if(this._listeners===void 0)return;const r=this._listeners[e];if(r!==void 0){const s=r.indexOf(t);s!==-1&&r.splice(s,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const n=this._listeners[e.type];if(n!==void 0){e.target=this;const r=n.slice(0);for(let s=0,o=r.length;s<o;s++)r[s].call(this,e);e.target=null}}};const Ko=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let nP=1234567;const Um=Math.PI/180,Z1=180/Math.PI;function Ll(){const i=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,n=Math.random()*4294967295|0;return(Ko[i&255]+Ko[i>>8&255]+Ko[i>>16&255]+Ko[i>>24&255]+"-"+Ko[e&255]+Ko[e>>8&255]+"-"+Ko[e>>16&15|64]+Ko[e>>24&255]+"-"+Ko[t&63|128]+Ko[t>>8&255]+"-"+Ko[t>>16&255]+Ko[t>>24&255]+Ko[n&255]+Ko[n>>8&255]+Ko[n>>16&255]+Ko[n>>24&255]).toLowerCase()}function rs(i,e,t){return Math.max(e,Math.min(t,i))}function x6(i,e){return(i%e+e)%e}function yX(i,e,t,n,r){return n+(i-e)*(r-n)/(t-e)}function vX(i,e,t){return i!==e?(t-i)/(e-i):0}function $v(i,e,t){return(1-t)*i+t*e}function xX(i,e,t,n){return $v(i,e,1-Math.exp(-t*n))}function EX(i,e=1){return e-Math.abs(x6(i,e*2)-e)}function _X(i,e,t){return i<=e?0:i>=t?1:(i=(i-e)/(t-e),i*i*(3-2*i))}function SX(i,e,t){return i<=e?0:i>=t?1:(i=(i-e)/(t-e),i*i*i*(i*(i*6-15)+10))}function wX(i,e){return i+Math.floor(Math.random()*(e-i+1))}function CX(i,e){return i+Math.random()*(e-i)}function TX(i){return i*(.5-Math.random())}function bX(i){i!==void 0&&(nP=i);let e=nP+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function IX(i){return i*Um}function MX(i){return i*Z1}function wM(i){return(i&i-1)===0&&i!==0}function RX(i){return Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))}function bS(i){return Math.pow(2,Math.floor(Math.log(i)/Math.LN2))}function LX(i,e,t,n,r){const s=Math.cos,o=Math.sin,a=s(t/2),l=o(t/2),c=s((e+n)/2),u=o((e+n)/2),h=s((e-n)/2),f=o((e-n)/2),d=s((n-e)/2),m=o((n-e)/2);switch(r){case"XYX":i.set(a*u,l*h,l*f,a*c);break;case"YZY":i.set(l*f,a*u,l*h,a*c);break;case"ZXZ":i.set(l*h,l*f,a*u,a*c);break;case"XZX":i.set(a*u,l*m,l*d,a*c);break;case"YXY":i.set(l*d,a*u,l*m,a*c);break;case"ZYZ":i.set(l*m,l*d,a*u,a*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+r)}}function qa(i,e){switch(e.constructor){case Float32Array:return i;case Uint32Array:return i/4294967295;case Uint16Array:return i/65535;case Uint8Array:return i/255;case Int32Array:return Math.max(i/2147483647,-1);case Int16Array:return Math.max(i/32767,-1);case Int8Array:return Math.max(i/127,-1);default:throw new Error("Invalid component type.")}}function ii(i,e){switch(e.constructor){case Float32Array:return i;case Uint32Array:return Math.round(i*4294967295);case Uint16Array:return Math.round(i*65535);case Uint8Array:return Math.round(i*255);case Int32Array:return Math.round(i*2147483647);case Int16Array:return Math.round(i*32767);case Int8Array:return Math.round(i*127);default:throw new Error("Invalid component type.")}}const un={DEG2RAD:Um,RAD2DEG:Z1,generateUUID:Ll,clamp:rs,euclideanModulo:x6,mapLinear:yX,inverseLerp:vX,lerp:$v,damp:xX,pingpong:EX,smoothstep:_X,smootherstep:SX,randInt:wX,randFloat:CX,randFloatSpread:TX,seededRandom:bX,degToRad:IX,radToDeg:MX,isPowerOfTwo:wM,ceilPowerOfTwo:RX,floorPowerOfTwo:bS,setQuaternionFromProperEuler:LX,normalize:ii,denormalize:qa};class Ue{constructor(e=0,t=0){Ue.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,n=this.y,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6],this.y=r[1]*t+r[4]*n+r[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(rs(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y;return t*t+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const n=Math.cos(t),r=Math.sin(t),s=this.x-e.x,o=this.y-e.y;return this.x=s*n-o*r+e.x,this.y=s*r+o*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Tn{constructor(e,t,n,r,s,o,a,l,c){Tn.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,t,n,r,s,o,a,l,c)}set(e,t,n,r,s,o,a,l,c){const u=this.elements;return u[0]=e,u[1]=r,u[2]=a,u[3]=t,u[4]=s,u[5]=l,u[6]=n,u[7]=o,u[8]=c,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,r=t.elements,s=this.elements,o=n[0],a=n[3],l=n[6],c=n[1],u=n[4],h=n[7],f=n[2],d=n[5],m=n[8],A=r[0],g=r[3],y=r[6],E=r[1],x=r[4],C=r[7],T=r[2],I=r[5],M=r[8];return s[0]=o*A+a*E+l*T,s[3]=o*g+a*x+l*I,s[6]=o*y+a*C+l*M,s[1]=c*A+u*E+h*T,s[4]=c*g+u*x+h*I,s[7]=c*y+u*C+h*M,s[2]=f*A+d*E+m*T,s[5]=f*g+d*x+m*I,s[8]=f*y+d*C+m*M,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8];return t*o*u-t*a*c-n*s*u+n*a*l+r*s*c-r*o*l}invert(){const e=this.elements,t=e[0],n=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],h=u*o-a*c,f=a*l-u*s,d=c*s-o*l,m=t*h+n*f+r*d;if(m===0)return this.set(0,0,0,0,0,0,0,0,0);const A=1/m;return e[0]=h*A,e[1]=(r*c-u*n)*A,e[2]=(a*n-r*o)*A,e[3]=f*A,e[4]=(u*t-r*l)*A,e[5]=(r*s-a*t)*A,e[6]=d*A,e[7]=(n*l-c*t)*A,e[8]=(o*t-n*s)*A,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,r,s,o,a){const l=Math.cos(s),c=Math.sin(s);return this.set(n*l,n*c,-n*(l*o+c*a)+o+e,-r*c,r*l,-r*(-c*o+l*a)+a+t,0,0,1),this}scale(e,t){return this.premultiply(zC.makeScale(e,t)),this}rotate(e){return this.premultiply(zC.makeRotation(-e)),this}translate(e,t){return this.premultiply(zC.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,n,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,n=e.elements;for(let r=0;r<9;r++)if(t[r]!==n[r])return!1;return!0}fromArray(e,t=0){for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const zC=new Tn;function BU(i){for(let e=i.length-1;e>=0;--e)if(i[e]>=65535)return!0;return!1}const PX={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function T1(i,e){return new PX[i](e)}function I2(i){return document.createElementNS("http://www.w3.org/1999/xhtml",i)}function DU(){const i=I2("canvas");return i.style.display="block",i}const iP={};function Yv(i){i in iP||(iP[i]=!0,console.warn(i))}const rP=new Tn().set(.8224621,.177538,0,.0331941,.9668058,0,.0170827,.0723974,.9105199),sP=new Tn().set(1.2249401,-.2249404,0,-.0420569,1.0420571,0,-.0196376,-.0786361,1.0982735),bE={[Dl]:{transfer:w2,primaries:C2,toReference:i=>i,fromReference:i=>i},[gs]:{transfer:mr,primaries:C2,toReference:i=>i.convertSRGBToLinear(),fromReference:i=>i.convertLinearToSRGB()},[nx]:{transfer:w2,primaries:T2,toReference:i=>i.applyMatrix3(sP),fromReference:i=>i.applyMatrix3(rP)},[_w]:{transfer:mr,primaries:T2,toReference:i=>i.convertSRGBToLinear().applyMatrix3(sP),fromReference:i=>i.applyMatrix3(rP).convertLinearToSRGB()}},BX=new Set([Dl,nx]),Vi={enabled:!0,_workingColorSpace:Dl,get workingColorSpace(){return this._workingColorSpace},set workingColorSpace(i){if(!BX.has(i))throw new Error(`Unsupported working color space, "${i}".`);this._workingColorSpace=i},convert:function(i,e,t){if(this.enabled===!1||e===t||!e||!t)return i;const n=bE[e].toReference,r=bE[t].fromReference;return r(n(i))},fromWorkingColorSpace:function(i,e){return this.convert(i,this._workingColorSpace,e)},toWorkingColorSpace:function(i,e){return this.convert(i,e,this._workingColorSpace)},getPrimaries:function(i){return bE[i].primaries},getTransfer:function(i){return i===Tl?w2:bE[i].transfer}};function O1(i){return i<.04045?i*.0773993808:Math.pow(i*.9478672986+.0521327014,2.4)}function GC(i){return i<.0031308?i*12.92:1.055*Math.pow(i,.41666)-.055}let ug;class E6{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{ug===void 0&&(ug=I2("canvas")),ug.width=e.width,ug.height=e.height;const n=ug.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),t=ug}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const t=I2("canvas");t.width=e.width,t.height=e.height;const n=t.getContext("2d");n.drawImage(e,0,0,e.width,e.height);const r=n.getImageData(0,0,e.width,e.height),s=r.data;for(let o=0;o<s.length;o++)s[o]=O1(s[o]/255)*255;return n.putImageData(r,0,0),t}else if(e.data){const t=e.data.slice(0);for(let n=0;n<t.length;n++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[n]=Math.floor(O1(t[n]/255)*255):t[n]=O1(t[n]);return{data:t,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let DX=0;class Rm{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:DX++}),this.uuid=Ll(),this.data=e,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const n={uuid:this.uuid,url:""},r=this.data;if(r!==null){let s;if(Array.isArray(r)){s=[];for(let o=0,a=r.length;o<a;o++)r[o].isDataTexture?s.push(HC(r[o].image)):s.push(HC(r[o]))}else s=HC(r);n.url=s}return t||(e.images[this.uuid]=n),n}}function HC(i){return typeof HTMLImageElement<"u"&&i instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&i instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&i instanceof ImageBitmap?E6.getDataURL(i):i.data?{data:Array.from(i.data),width:i.width,height:i.height,type:i.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let kX=0,vi=class V_ extends Ch{constructor(e=V_.DEFAULT_IMAGE,t=V_.DEFAULT_MAPPING,n=ji,r=ji,s=Pn,o=Bl,a=gi,l=Zi,c=V_.DEFAULT_ANISOTROPY,u=Tl){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:kX++}),this.uuid=Ll(),this.name="",this.source=new Rm(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=n,this.wrapT=r,this.magFilter=s,this.minFilter=o,this.anisotropy=c,this.format=a,this.internalFormat=null,this.type=l,this.offset=new Ue(0,0),this.repeat=new Ue(1,1),this.center=new Ue(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Tn,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,typeof u=="string"?this.colorSpace=u:(Yv("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=u===Yd?gs:Tl),this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const n={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(n.userData=this.userData),t||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==np)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case _o:e.x=e.x-Math.floor(e.x);break;case ji:e.x=e.x<0?0:1;break;case X1:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case _o:e.y=e.y-Math.floor(e.y);break;case ji:e.y=e.y<0?0:1;break;case X1:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}get encoding(){return Yv("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace===gs?Yd:y6}set encoding(e){Yv("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=e===Yd?gs:Tl}};vi.DEFAULT_IMAGE=null;vi.DEFAULT_MAPPING=np;vi.DEFAULT_ANISOTROPY=1;class Rn{constructor(e=0,t=0,n=0,r=1){Rn.prototype.isVector4=!0,this.x=e,this.y=t,this.z=n,this.w=r}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,n,r){return this.x=e,this.y=t,this.z=n,this.w=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,n=this.y,r=this.z,s=this.w,o=e.elements;return this.x=o[0]*t+o[4]*n+o[8]*r+o[12]*s,this.y=o[1]*t+o[5]*n+o[9]*r+o[13]*s,this.z=o[2]*t+o[6]*n+o[10]*r+o[14]*s,this.w=o[3]*t+o[7]*n+o[11]*r+o[15]*s,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,n,r,s;const l=e.elements,c=l[0],u=l[4],h=l[8],f=l[1],d=l[5],m=l[9],A=l[2],g=l[6],y=l[10];if(Math.abs(u-f)<.01&&Math.abs(h-A)<.01&&Math.abs(m-g)<.01){if(Math.abs(u+f)<.1&&Math.abs(h+A)<.1&&Math.abs(m+g)<.1&&Math.abs(c+d+y-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const x=(c+1)/2,C=(d+1)/2,T=(y+1)/2,I=(u+f)/4,M=(h+A)/4,L=(m+g)/4;return x>C&&x>T?x<.01?(n=0,r=.707106781,s=.707106781):(n=Math.sqrt(x),r=I/n,s=M/n):C>T?C<.01?(n=.707106781,r=0,s=.707106781):(r=Math.sqrt(C),n=I/r,s=L/r):T<.01?(n=.707106781,r=.707106781,s=0):(s=Math.sqrt(T),n=M/s,r=L/s),this.set(n,r,s,t),this}let E=Math.sqrt((g-m)*(g-m)+(h-A)*(h-A)+(f-u)*(f-u));return Math.abs(E)<.001&&(E=1),this.x=(g-m)/E,this.y=(h-A)/E,this.z=(f-u)/E,this.w=Math.acos((c+d+y-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class kU extends Ch{constructor(e=1,t=1,n={}){super(),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new Rn(0,0,e,t),this.scissorTest=!1,this.viewport=new Rn(0,0,e,t);const r={width:e,height:t,depth:1};n.encoding!==void 0&&(Yv("THREE.WebGLRenderTarget: option.encoding has been replaced by option.colorSpace."),n.colorSpace=n.encoding===Yd?gs:Tl),n=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:Pn,depthBuffer:!0,stencilBuffer:!1,depthTexture:null,samples:0},n),this.texture=new vi(r,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=n.generateMipmaps,this.texture.internalFormat=n.internalFormat,this.depthBuffer=n.depthBuffer,this.stencilBuffer=n.stencilBuffer,this.depthTexture=n.depthTexture,this.samples=n.samples}setSize(e,t,n=1){(this.width!==e||this.height!==t||this.depth!==n)&&(this.width=e,this.height=t,this.depth=n,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=n,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.isRenderTargetTexture=!0;const t=Object.assign({},e.texture.image);return this.texture.source=new Rm(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class Si extends kU{constructor(e=1,t=1,n={}){super(e,t,n),this.isWebGLRenderTarget=!0}}class Sw extends vi{constructor(e=null,t=1,n=1,r=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:n,depth:r},this.magFilter=zn,this.minFilter=zn,this.wrapR=ji,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class FX extends Si{constructor(e=1,t=1,n=1,r={}){super(e,t,r),this.isWebGLArrayRenderTarget=!0,this.depth=n,this.texture=new Sw(null,e,t,n),this.texture.isRenderTargetTexture=!0}}let _6=class extends vi{constructor(e=null,t=1,n=1,r=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:n,depth:r},this.magFilter=zn,this.minFilter=zn,this.wrapR=ji,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}};class OX extends Si{constructor(e=1,t=1,n=1,r={}){super(e,t,r),this.isWebGL3DRenderTarget=!0,this.depth=n,this.texture=new _6(null,e,t,n),this.texture.isRenderTargetTexture=!0}}class NX extends Si{constructor(e=1,t=1,n=1,r={}){super(e,t,r),this.isWebGLMultipleRenderTargets=!0;const s=this.texture;this.texture=[];for(let o=0;o<n;o++)this.texture[o]=s.clone(),this.texture[o].isRenderTargetTexture=!0}setSize(e,t,n=1){if(this.width!==e||this.height!==t||this.depth!==n){this.width=e,this.height=t,this.depth=n;for(let r=0,s=this.texture.length;r<s;r++)this.texture[r].image.width=e,this.texture[r].image.height=t,this.texture[r].image.depth=n;this.dispose()}this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}copy(e){this.dispose(),this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.texture.length=0;for(let t=0,n=e.texture.length;t<n;t++)this.texture[t]=e.texture[t].clone(),this.texture[t].isRenderTargetTexture=!0;return this}}class Xt{constructor(e=0,t=0,n=0,r=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=n,this._w=r}static slerpFlat(e,t,n,r,s,o,a){let l=n[r+0],c=n[r+1],u=n[r+2],h=n[r+3];const f=s[o+0],d=s[o+1],m=s[o+2],A=s[o+3];if(a===0){e[t+0]=l,e[t+1]=c,e[t+2]=u,e[t+3]=h;return}if(a===1){e[t+0]=f,e[t+1]=d,e[t+2]=m,e[t+3]=A;return}if(h!==A||l!==f||c!==d||u!==m){let g=1-a;const y=l*f+c*d+u*m+h*A,E=y>=0?1:-1,x=1-y*y;if(x>Number.EPSILON){const T=Math.sqrt(x),I=Math.atan2(T,y*E);g=Math.sin(g*I)/T,a=Math.sin(a*I)/T}const C=a*E;if(l=l*g+f*C,c=c*g+d*C,u=u*g+m*C,h=h*g+A*C,g===1-a){const T=1/Math.sqrt(l*l+c*c+u*u+h*h);l*=T,c*=T,u*=T,h*=T}}e[t]=l,e[t+1]=c,e[t+2]=u,e[t+3]=h}static multiplyQuaternionsFlat(e,t,n,r,s,o){const a=n[r],l=n[r+1],c=n[r+2],u=n[r+3],h=s[o],f=s[o+1],d=s[o+2],m=s[o+3];return e[t]=a*m+u*h+l*d-c*f,e[t+1]=l*m+u*f+c*h-a*d,e[t+2]=c*m+u*d+a*f-l*h,e[t+3]=u*m-a*h-l*f-c*d,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,n,r){return this._x=e,this._y=t,this._z=n,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t=!0){const n=e._x,r=e._y,s=e._z,o=e._order,a=Math.cos,l=Math.sin,c=a(n/2),u=a(r/2),h=a(s/2),f=l(n/2),d=l(r/2),m=l(s/2);switch(o){case"XYZ":this._x=f*u*h+c*d*m,this._y=c*d*h-f*u*m,this._z=c*u*m+f*d*h,this._w=c*u*h-f*d*m;break;case"YXZ":this._x=f*u*h+c*d*m,this._y=c*d*h-f*u*m,this._z=c*u*m-f*d*h,this._w=c*u*h+f*d*m;break;case"ZXY":this._x=f*u*h-c*d*m,this._y=c*d*h+f*u*m,this._z=c*u*m+f*d*h,this._w=c*u*h-f*d*m;break;case"ZYX":this._x=f*u*h-c*d*m,this._y=c*d*h+f*u*m,this._z=c*u*m-f*d*h,this._w=c*u*h+f*d*m;break;case"YZX":this._x=f*u*h+c*d*m,this._y=c*d*h+f*u*m,this._z=c*u*m-f*d*h,this._w=c*u*h-f*d*m;break;case"XZY":this._x=f*u*h-c*d*m,this._y=c*d*h-f*u*m,this._z=c*u*m+f*d*h,this._w=c*u*h+f*d*m;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return t===!0&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const n=t/2,r=Math.sin(n);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,n=t[0],r=t[4],s=t[8],o=t[1],a=t[5],l=t[9],c=t[2],u=t[6],h=t[10],f=n+a+h;if(f>0){const d=.5/Math.sqrt(f+1);this._w=.25/d,this._x=(u-l)*d,this._y=(s-c)*d,this._z=(o-r)*d}else if(n>a&&n>h){const d=2*Math.sqrt(1+n-a-h);this._w=(u-l)/d,this._x=.25*d,this._y=(r+o)/d,this._z=(s+c)/d}else if(a>h){const d=2*Math.sqrt(1+a-n-h);this._w=(s-c)/d,this._x=(r+o)/d,this._y=.25*d,this._z=(l+u)/d}else{const d=2*Math.sqrt(1+h-n-a);this._w=(o-r)/d,this._x=(s+c)/d,this._y=(l+u)/d,this._z=.25*d}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let n=e.dot(t)+1;return n<Number.EPSILON?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(rs(this.dot(e),-1,1)))}rotateTowards(e,t){const n=this.angleTo(e);if(n===0)return this;const r=Math.min(1,t/n);return this.slerp(e,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const n=e._x,r=e._y,s=e._z,o=e._w,a=t._x,l=t._y,c=t._z,u=t._w;return this._x=n*u+o*a+r*c-s*l,this._y=r*u+o*l+s*a-n*c,this._z=s*u+o*c+n*l-r*a,this._w=o*u-n*a-r*l-s*c,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);const n=this._x,r=this._y,s=this._z,o=this._w;let a=o*e._w+n*e._x+r*e._y+s*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=o,this._x=n,this._y=r,this._z=s,this;const l=1-a*a;if(l<=Number.EPSILON){const d=1-t;return this._w=d*o+t*this._w,this._x=d*n+t*this._x,this._y=d*r+t*this._y,this._z=d*s+t*this._z,this.normalize(),this}const c=Math.sqrt(l),u=Math.atan2(c,a),h=Math.sin((1-t)*u)/c,f=Math.sin(t*u)/c;return this._w=o*h+this._w*f,this._x=n*h+this._x*f,this._y=r*h+this._y*f,this._z=s*h+this._z*f,this._onChangeCallback(),this}slerpQuaternions(e,t,n){return this.copy(e).slerp(t,n)}random(){const e=Math.random(),t=Math.sqrt(1-e),n=Math.sqrt(e),r=2*Math.PI*Math.random(),s=2*Math.PI*Math.random();return this.set(t*Math.cos(r),n*Math.sin(s),n*Math.cos(s),t*Math.sin(r))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class H{constructor(e=0,t=0,n=0){H.prototype.isVector3=!0,this.x=e,this.y=t,this.z=n}set(e,t,n){return n===void 0&&(n=this.z),this.x=e,this.y=t,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(oP.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(oP.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,n=this.y,r=this.z,s=e.elements;return this.x=s[0]*t+s[3]*n+s[6]*r,this.y=s[1]*t+s[4]*n+s[7]*r,this.z=s[2]*t+s[5]*n+s[8]*r,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,n=this.y,r=this.z,s=e.elements,o=1/(s[3]*t+s[7]*n+s[11]*r+s[15]);return this.x=(s[0]*t+s[4]*n+s[8]*r+s[12])*o,this.y=(s[1]*t+s[5]*n+s[9]*r+s[13])*o,this.z=(s[2]*t+s[6]*n+s[10]*r+s[14])*o,this}applyQuaternion(e){const t=this.x,n=this.y,r=this.z,s=e.x,o=e.y,a=e.z,l=e.w,c=2*(o*r-a*n),u=2*(a*t-s*r),h=2*(s*n-o*t);return this.x=t+l*c+o*h-a*u,this.y=n+l*u+a*c-s*h,this.z=r+l*h+s*u-o*c,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,n=this.y,r=this.z,s=e.elements;return this.x=s[0]*t+s[4]*n+s[8]*r,this.y=s[1]*t+s[5]*n+s[9]*r,this.z=s[2]*t+s[6]*n+s[10]*r,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const n=e.x,r=e.y,s=e.z,o=t.x,a=t.y,l=t.z;return this.x=r*l-s*a,this.y=s*o-n*l,this.z=n*a-r*o,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return QC.copy(this).projectOnVector(e),this.sub(QC)}reflect(e){return this.sub(QC.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(rs(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y,r=this.z-e.z;return t*t+n*n+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,n){const r=Math.sin(t)*e;return this.x=r*Math.sin(n),this.y=Math.cos(t)*e,this.z=r*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=r,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=(Math.random()-.5)*2,t=Math.random()*Math.PI*2,n=Math.sqrt(1-e**2);return this.x=n*Math.cos(t),this.y=n*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const QC=new H,oP=new Xt;class ti{constructor(e=new H(1/0,1/0,1/0),t=new H(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t+=3)this.expandByPoint(Jc.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,n=e.count;t<n;t++)this.expandByPoint(Jc.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=Jc.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const n=e.geometry;if(n!==void 0){const s=n.getAttribute("position");if(t===!0&&s!==void 0&&e.isInstancedMesh!==!0)for(let o=0,a=s.count;o<a;o++)e.isMesh===!0?e.getVertexPosition(o,Jc):Jc.fromBufferAttribute(s,o),Jc.applyMatrix4(e.matrixWorld),this.expandByPoint(Jc);else e.boundingBox!==void 0?(e.boundingBox===null&&e.computeBoundingBox(),IE.copy(e.boundingBox)):(n.boundingBox===null&&n.computeBoundingBox(),IE.copy(n.boundingBox)),IE.applyMatrix4(e.matrixWorld),this.union(IE)}const r=e.children;for(let s=0,o=r.length;s<o;s++)this.expandByObject(r[s],t);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,Jc),Jc.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(My),ME.subVectors(this.max,My),hg.subVectors(e.a,My),fg.subVectors(e.b,My),dg.subVectors(e.c,My),vd.subVectors(fg,hg),xd.subVectors(dg,fg),nm.subVectors(hg,dg);let t=[0,-vd.z,vd.y,0,-xd.z,xd.y,0,-nm.z,nm.y,vd.z,0,-vd.x,xd.z,0,-xd.x,nm.z,0,-nm.x,-vd.y,vd.x,0,-xd.y,xd.x,0,-nm.y,nm.x,0];return!VC(t,hg,fg,dg,ME)||(t=[1,0,0,0,1,0,0,0,1],!VC(t,hg,fg,dg,ME))?!1:(RE.crossVectors(vd,xd),t=[RE.x,RE.y,RE.z],VC(t,hg,fg,dg,ME))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,Jc).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=this.getSize(Jc).length()*.5),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(rf[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),rf[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),rf[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),rf[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),rf[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),rf[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),rf[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),rf[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(rf),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const rf=[new H,new H,new H,new H,new H,new H,new H,new H],Jc=new H,IE=new ti,hg=new H,fg=new H,dg=new H,vd=new H,xd=new H,nm=new H,My=new H,ME=new H,RE=new H,im=new H;function VC(i,e,t,n,r){for(let s=0,o=i.length-3;s<=o;s+=3){im.fromArray(i,s);const a=r.x*Math.abs(im.x)+r.y*Math.abs(im.y)+r.z*Math.abs(im.z),l=e.dot(im),c=t.dot(im),u=n.dot(im);if(Math.max(-Math.max(l,c,u),Math.min(l,c,u))>a)return!1}return!0}const UX=new ti,Ry=new H,WC=new H;let Bi=class{constructor(e=new H,t=-1){this.isSphere=!0,this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const n=this.center;t!==void 0?n.copy(t):UX.setFromPoints(e).getCenter(n);let r=0;for(let s=0,o=e.length;s<o;s++)r=Math.max(r,n.distanceToSquared(e[s]));return this.radius=Math.sqrt(r),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const n=this.center.distanceToSquared(e);return t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;Ry.subVectors(e,this.center);const t=Ry.lengthSq();if(t>this.radius*this.radius){const n=Math.sqrt(t),r=(n-this.radius)*.5;this.center.addScaledVector(Ry,r/n),this.radius+=r}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(WC.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(Ry.copy(e.center).add(WC)),this.expandByPoint(Ry.copy(e.center).sub(WC))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}};const sf=new H,jC=new H,LE=new H,Ed=new H,KC=new H,PE=new H,$C=new H;class vc{constructor(e=new H,t=new H(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,sf)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,n)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=sf.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(sf.copy(this.origin).addScaledVector(this.direction,t),sf.distanceToSquared(e))}distanceSqToSegment(e,t,n,r){jC.copy(e).add(t).multiplyScalar(.5),LE.copy(t).sub(e).normalize(),Ed.copy(this.origin).sub(jC);const s=e.distanceTo(t)*.5,o=-this.direction.dot(LE),a=Ed.dot(this.direction),l=-Ed.dot(LE),c=Ed.lengthSq(),u=Math.abs(1-o*o);let h,f,d,m;if(u>0)if(h=o*l-a,f=o*a-l,m=s*u,h>=0)if(f>=-m)if(f<=m){const A=1/u;h*=A,f*=A,d=h*(h+o*f+2*a)+f*(o*h+f+2*l)+c}else f=s,h=Math.max(0,-(o*f+a)),d=-h*h+f*(f+2*l)+c;else f=-s,h=Math.max(0,-(o*f+a)),d=-h*h+f*(f+2*l)+c;else f<=-m?(h=Math.max(0,-(-o*s+a)),f=h>0?-s:Math.min(Math.max(-s,-l),s),d=-h*h+f*(f+2*l)+c):f<=m?(h=0,f=Math.min(Math.max(-s,-l),s),d=f*(f+2*l)+c):(h=Math.max(0,-(o*s+a)),f=h>0?s:Math.min(Math.max(-s,-l),s),d=-h*h+f*(f+2*l)+c);else f=o>0?-s:s,h=Math.max(0,-(o*f+a)),d=-h*h+f*(f+2*l)+c;return n&&n.copy(this.origin).addScaledVector(this.direction,h),r&&r.copy(jC).addScaledVector(LE,f),d}intersectSphere(e,t){sf.subVectors(e.center,this.origin);const n=sf.dot(this.direction),r=sf.dot(sf)-n*n,s=e.radius*e.radius;if(r>s)return null;const o=Math.sqrt(s-r),a=n-o,l=n+o;return l<0?null:a<0?this.at(l,t):this.at(a,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;const n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}intersectPlane(e,t){const n=this.distanceToPlane(e);return n===null?null:this.at(n,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let n,r,s,o,a,l;const c=1/this.direction.x,u=1/this.direction.y,h=1/this.direction.z,f=this.origin;return c>=0?(n=(e.min.x-f.x)*c,r=(e.max.x-f.x)*c):(n=(e.max.x-f.x)*c,r=(e.min.x-f.x)*c),u>=0?(s=(e.min.y-f.y)*u,o=(e.max.y-f.y)*u):(s=(e.max.y-f.y)*u,o=(e.min.y-f.y)*u),n>o||s>r||((s>n||isNaN(n))&&(n=s),(o<r||isNaN(r))&&(r=o),h>=0?(a=(e.min.z-f.z)*h,l=(e.max.z-f.z)*h):(a=(e.max.z-f.z)*h,l=(e.min.z-f.z)*h),n>l||a>r)||((a>n||n!==n)&&(n=a),(l<r||r!==r)&&(r=l),r<0)?null:this.at(n>=0?n:r,t)}intersectsBox(e){return this.intersectBox(e,sf)!==null}intersectTriangle(e,t,n,r,s){KC.subVectors(t,e),PE.subVectors(n,e),$C.crossVectors(KC,PE);let o=this.direction.dot($C),a;if(o>0){if(r)return null;a=1}else if(o<0)a=-1,o=-o;else return null;Ed.subVectors(this.origin,e);const l=a*this.direction.dot(PE.crossVectors(Ed,PE));if(l<0)return null;const c=a*this.direction.dot(KC.cross(Ed));if(c<0||l+c>o)return null;const u=-a*Ed.dot($C);return u<0?null:this.at(u/o,s)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class Xe{constructor(e,t,n,r,s,o,a,l,c,u,h,f,d,m,A,g){Xe.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,t,n,r,s,o,a,l,c,u,h,f,d,m,A,g)}set(e,t,n,r,s,o,a,l,c,u,h,f,d,m,A,g){const y=this.elements;return y[0]=e,y[4]=t,y[8]=n,y[12]=r,y[1]=s,y[5]=o,y[9]=a,y[13]=l,y[2]=c,y[6]=u,y[10]=h,y[14]=f,y[3]=d,y[7]=m,y[11]=A,y[15]=g,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new Xe().fromArray(this.elements)}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}copyPosition(e){const t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,n=e.elements,r=1/pg.setFromMatrixColumn(e,0).length(),s=1/pg.setFromMatrixColumn(e,1).length(),o=1/pg.setFromMatrixColumn(e,2).length();return t[0]=n[0]*r,t[1]=n[1]*r,t[2]=n[2]*r,t[3]=0,t[4]=n[4]*s,t[5]=n[5]*s,t[6]=n[6]*s,t[7]=0,t[8]=n[8]*o,t[9]=n[9]*o,t[10]=n[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,n=e.x,r=e.y,s=e.z,o=Math.cos(n),a=Math.sin(n),l=Math.cos(r),c=Math.sin(r),u=Math.cos(s),h=Math.sin(s);if(e.order==="XYZ"){const f=o*u,d=o*h,m=a*u,A=a*h;t[0]=l*u,t[4]=-l*h,t[8]=c,t[1]=d+m*c,t[5]=f-A*c,t[9]=-a*l,t[2]=A-f*c,t[6]=m+d*c,t[10]=o*l}else if(e.order==="YXZ"){const f=l*u,d=l*h,m=c*u,A=c*h;t[0]=f+A*a,t[4]=m*a-d,t[8]=o*c,t[1]=o*h,t[5]=o*u,t[9]=-a,t[2]=d*a-m,t[6]=A+f*a,t[10]=o*l}else if(e.order==="ZXY"){const f=l*u,d=l*h,m=c*u,A=c*h;t[0]=f-A*a,t[4]=-o*h,t[8]=m+d*a,t[1]=d+m*a,t[5]=o*u,t[9]=A-f*a,t[2]=-o*c,t[6]=a,t[10]=o*l}else if(e.order==="ZYX"){const f=o*u,d=o*h,m=a*u,A=a*h;t[0]=l*u,t[4]=m*c-d,t[8]=f*c+A,t[1]=l*h,t[5]=A*c+f,t[9]=d*c-m,t[2]=-c,t[6]=a*l,t[10]=o*l}else if(e.order==="YZX"){const f=o*l,d=o*c,m=a*l,A=a*c;t[0]=l*u,t[4]=A-f*h,t[8]=m*h+d,t[1]=h,t[5]=o*u,t[9]=-a*u,t[2]=-c*u,t[6]=d*h+m,t[10]=f-A*h}else if(e.order==="XZY"){const f=o*l,d=o*c,m=a*l,A=a*c;t[0]=l*u,t[4]=-h,t[8]=c*u,t[1]=f*h+A,t[5]=o*u,t[9]=d*h-m,t[2]=m*h-d,t[6]=a*u,t[10]=A*h+f}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(zX,e,GX)}lookAt(e,t,n){const r=this.elements;return yl.subVectors(e,t),yl.lengthSq()===0&&(yl.z=1),yl.normalize(),_d.crossVectors(n,yl),_d.lengthSq()===0&&(Math.abs(n.z)===1?yl.x+=1e-4:yl.z+=1e-4,yl.normalize(),_d.crossVectors(n,yl)),_d.normalize(),BE.crossVectors(yl,_d),r[0]=_d.x,r[4]=BE.x,r[8]=yl.x,r[1]=_d.y,r[5]=BE.y,r[9]=yl.y,r[2]=_d.z,r[6]=BE.z,r[10]=yl.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,r=t.elements,s=this.elements,o=n[0],a=n[4],l=n[8],c=n[12],u=n[1],h=n[5],f=n[9],d=n[13],m=n[2],A=n[6],g=n[10],y=n[14],E=n[3],x=n[7],C=n[11],T=n[15],I=r[0],M=r[4],L=r[8],R=r[12],P=r[1],F=r[5],k=r[9],z=r[13],U=r[2],W=r[6],$=r[10],oe=r[14],X=r[3],Q=r[7],Y=r[11],O=r[15];return s[0]=o*I+a*P+l*U+c*X,s[4]=o*M+a*F+l*W+c*Q,s[8]=o*L+a*k+l*$+c*Y,s[12]=o*R+a*z+l*oe+c*O,s[1]=u*I+h*P+f*U+d*X,s[5]=u*M+h*F+f*W+d*Q,s[9]=u*L+h*k+f*$+d*Y,s[13]=u*R+h*z+f*oe+d*O,s[2]=m*I+A*P+g*U+y*X,s[6]=m*M+A*F+g*W+y*Q,s[10]=m*L+A*k+g*$+y*Y,s[14]=m*R+A*z+g*oe+y*O,s[3]=E*I+x*P+C*U+T*X,s[7]=E*M+x*F+C*W+T*Q,s[11]=E*L+x*k+C*$+T*Y,s[15]=E*R+x*z+C*oe+T*O,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[4],r=e[8],s=e[12],o=e[1],a=e[5],l=e[9],c=e[13],u=e[2],h=e[6],f=e[10],d=e[14],m=e[3],A=e[7],g=e[11],y=e[15];return m*(+s*l*h-r*c*h-s*a*f+n*c*f+r*a*d-n*l*d)+A*(+t*l*d-t*c*f+s*o*f-r*o*d+r*c*u-s*l*u)+g*(+t*c*h-t*a*d-s*o*h+n*o*d+s*a*u-n*c*u)+y*(-r*a*u-t*l*h+t*a*f+r*o*h-n*o*f+n*l*u)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,n){const r=this.elements;return e.isVector3?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=t,r[14]=n),this}invert(){const e=this.elements,t=e[0],n=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],h=e[9],f=e[10],d=e[11],m=e[12],A=e[13],g=e[14],y=e[15],E=h*g*c-A*f*c+A*l*d-a*g*d-h*l*y+a*f*y,x=m*f*c-u*g*c-m*l*d+o*g*d+u*l*y-o*f*y,C=u*A*c-m*h*c+m*a*d-o*A*d-u*a*y+o*h*y,T=m*h*l-u*A*l-m*a*f+o*A*f+u*a*g-o*h*g,I=t*E+n*x+r*C+s*T;if(I===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const M=1/I;return e[0]=E*M,e[1]=(A*f*s-h*g*s-A*r*d+n*g*d+h*r*y-n*f*y)*M,e[2]=(a*g*s-A*l*s+A*r*c-n*g*c-a*r*y+n*l*y)*M,e[3]=(h*l*s-a*f*s-h*r*c+n*f*c+a*r*d-n*l*d)*M,e[4]=x*M,e[5]=(u*g*s-m*f*s+m*r*d-t*g*d-u*r*y+t*f*y)*M,e[6]=(m*l*s-o*g*s-m*r*c+t*g*c+o*r*y-t*l*y)*M,e[7]=(o*f*s-u*l*s+u*r*c-t*f*c-o*r*d+t*l*d)*M,e[8]=C*M,e[9]=(m*h*s-u*A*s-m*n*d+t*A*d+u*n*y-t*h*y)*M,e[10]=(o*A*s-m*a*s+m*n*c-t*A*c-o*n*y+t*a*y)*M,e[11]=(u*a*s-o*h*s-u*n*c+t*h*c+o*n*d-t*a*d)*M,e[12]=T*M,e[13]=(u*A*r-m*h*r+m*n*f-t*A*f-u*n*g+t*h*g)*M,e[14]=(m*a*r-o*A*r-m*n*l+t*A*l+o*n*g-t*a*g)*M,e[15]=(o*h*r-u*a*r+u*n*l-t*h*l-o*n*f+t*a*f)*M,this}scale(e){const t=this.elements,n=e.x,r=e.y,s=e.z;return t[0]*=n,t[4]*=r,t[8]*=s,t[1]*=n,t[5]*=r,t[9]*=s,t[2]*=n,t[6]*=r,t[10]*=s,t[3]*=n,t[7]*=r,t[11]*=s,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,r))}makeTranslation(e,t,n){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const n=Math.cos(t),r=Math.sin(t),s=1-n,o=e.x,a=e.y,l=e.z,c=s*o,u=s*a;return this.set(c*o+n,c*a-r*l,c*l+r*a,0,c*a+r*l,u*a+n,u*l-r*o,0,c*l-r*a,u*l+r*o,s*l*l+n,0,0,0,0,1),this}makeScale(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,t,n,r,s,o){return this.set(1,n,s,0,e,1,o,0,t,r,1,0,0,0,0,1),this}compose(e,t,n){const r=this.elements,s=t._x,o=t._y,a=t._z,l=t._w,c=s+s,u=o+o,h=a+a,f=s*c,d=s*u,m=s*h,A=o*u,g=o*h,y=a*h,E=l*c,x=l*u,C=l*h,T=n.x,I=n.y,M=n.z;return r[0]=(1-(A+y))*T,r[1]=(d+C)*T,r[2]=(m-x)*T,r[3]=0,r[4]=(d-C)*I,r[5]=(1-(f+y))*I,r[6]=(g+E)*I,r[7]=0,r[8]=(m+x)*M,r[9]=(g-E)*M,r[10]=(1-(f+A))*M,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this}decompose(e,t,n){const r=this.elements;let s=pg.set(r[0],r[1],r[2]).length();const o=pg.set(r[4],r[5],r[6]).length(),a=pg.set(r[8],r[9],r[10]).length();this.determinant()<0&&(s=-s),e.x=r[12],e.y=r[13],e.z=r[14],Zc.copy(this);const c=1/s,u=1/o,h=1/a;return Zc.elements[0]*=c,Zc.elements[1]*=c,Zc.elements[2]*=c,Zc.elements[4]*=u,Zc.elements[5]*=u,Zc.elements[6]*=u,Zc.elements[8]*=h,Zc.elements[9]*=h,Zc.elements[10]*=h,t.setFromRotationMatrix(Zc),n.x=s,n.y=o,n.z=a,this}makePerspective(e,t,n,r,s,o,a=mu){const l=this.elements,c=2*s/(t-e),u=2*s/(n-r),h=(t+e)/(t-e),f=(n+r)/(n-r);let d,m;if(a===mu)d=-(o+s)/(o-s),m=-2*o*s/(o-s);else if(a===J1)d=-o/(o-s),m=-o*s/(o-s);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+a);return l[0]=c,l[4]=0,l[8]=h,l[12]=0,l[1]=0,l[5]=u,l[9]=f,l[13]=0,l[2]=0,l[6]=0,l[10]=d,l[14]=m,l[3]=0,l[7]=0,l[11]=-1,l[15]=0,this}makeOrthographic(e,t,n,r,s,o,a=mu){const l=this.elements,c=1/(t-e),u=1/(n-r),h=1/(o-s),f=(t+e)*c,d=(n+r)*u;let m,A;if(a===mu)m=(o+s)*h,A=-2*h;else if(a===J1)m=s*h,A=-1*h;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+a);return l[0]=2*c,l[4]=0,l[8]=0,l[12]=-f,l[1]=0,l[5]=2*u,l[9]=0,l[13]=-d,l[2]=0,l[6]=0,l[10]=A,l[14]=-m,l[3]=0,l[7]=0,l[11]=0,l[15]=1,this}equals(e){const t=this.elements,n=e.elements;for(let r=0;r<16;r++)if(t[r]!==n[r])return!1;return!0}fromArray(e,t=0){for(let n=0;n<16;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}const pg=new H,Zc=new Xe,zX=new H(0,0,0),GX=new H(1,1,1),_d=new H,BE=new H,yl=new H,aP=new Xe,lP=new Xt;class Eo{constructor(e=0,t=0,n=0,r=Eo.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=n,this._order=r}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,n,r=this._order){return this._x=e,this._y=t,this._z=n,this._order=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,n=!0){const r=e.elements,s=r[0],o=r[4],a=r[8],l=r[1],c=r[5],u=r[9],h=r[2],f=r[6],d=r[10];switch(t){case"XYZ":this._y=Math.asin(rs(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-u,d),this._z=Math.atan2(-o,s)):(this._x=Math.atan2(f,c),this._z=0);break;case"YXZ":this._x=Math.asin(-rs(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(a,d),this._z=Math.atan2(l,c)):(this._y=Math.atan2(-h,s),this._z=0);break;case"ZXY":this._x=Math.asin(rs(f,-1,1)),Math.abs(f)<.9999999?(this._y=Math.atan2(-h,d),this._z=Math.atan2(-o,c)):(this._y=0,this._z=Math.atan2(l,s));break;case"ZYX":this._y=Math.asin(-rs(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(f,d),this._z=Math.atan2(l,s)):(this._x=0,this._z=Math.atan2(-o,c));break;case"YZX":this._z=Math.asin(rs(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-u,c),this._y=Math.atan2(-h,s)):(this._x=0,this._y=Math.atan2(a,d));break;case"XZY":this._z=Math.asin(-rs(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(f,c),this._y=Math.atan2(a,s)):(this._x=Math.atan2(-u,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,n===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,n){return aP.makeRotationFromQuaternion(e),this.setFromRotationMatrix(aP,t,n)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return lP.setFromEuler(this),this.setFromQuaternion(lP,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}Eo.DEFAULT_ORDER="XYZ";class zm{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}let HX=0;const cP=new H,mg=new Xt,of=new Xe,DE=new H,Ly=new H,QX=new H,VX=new Xt,uP=new H(1,0,0),hP=new H(0,1,0),fP=new H(0,0,1),WX={type:"added"},jX={type:"removed"};class _n extends Ch{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:HX++}),this.uuid=Ll(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=_n.DEFAULT_UP.clone();const e=new H,t=new Eo,n=new Xt,r=new H(1,1,1);function s(){n.setFromEuler(t,!1)}function o(){t.setFromQuaternion(n,void 0,!1)}t._onChange(s),n._onChange(o),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new Xe},normalMatrix:{value:new Tn}}),this.matrix=new Xe,this.matrixWorld=new Xe,this.matrixAutoUpdate=_n.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=_n.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new zm,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return mg.setFromAxisAngle(e,t),this.quaternion.multiply(mg),this}rotateOnWorldAxis(e,t){return mg.setFromAxisAngle(e,t),this.quaternion.premultiply(mg),this}rotateX(e){return this.rotateOnAxis(uP,e)}rotateY(e){return this.rotateOnAxis(hP,e)}rotateZ(e){return this.rotateOnAxis(fP,e)}translateOnAxis(e,t){return cP.copy(e).applyQuaternion(this.quaternion),this.position.add(cP.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(uP,e)}translateY(e){return this.translateOnAxis(hP,e)}translateZ(e){return this.translateOnAxis(fP,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(of.copy(this.matrixWorld).invert())}lookAt(e,t,n){e.isVector3?DE.copy(e):DE.set(e,t,n);const r=this.parent;this.updateWorldMatrix(!0,!1),Ly.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?of.lookAt(Ly,DE,this.up):of.lookAt(DE,Ly,this.up),this.quaternion.setFromRotationMatrix(of),r&&(of.extractRotation(r.matrixWorld),mg.setFromRotationMatrix(of),this.quaternion.premultiply(mg.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.parent!==null&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(WX)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let n=0;n<arguments.length;n++)this.remove(arguments[n]);return this}const t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(jX)),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),of.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),of.multiply(e.parent.matrixWorld)),e.applyMatrix4(of),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let n=0,r=this.children.length;n<r;n++){const o=this.children[n].getObjectByProperty(e,t);if(o!==void 0)return o}}getObjectsByProperty(e,t,n=[]){this[e]===t&&n.push(this);const r=this.children;for(let s=0,o=r.length;s<o;s++)r[s].getObjectsByProperty(e,t,n);return n}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Ly,e,QX),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Ly,VX,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let n=0,r=t.length;n<r;n++)t[n].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const t=this.children;for(let n=0,r=t.length;n<r;n++)t[n].traverseVisible(e)}traverseAncestors(e){const t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let n=0,r=t.length;n<r;n++){const s=t[n];(s.matrixWorldAutoUpdate===!0||e===!0)&&s.updateMatrixWorld(e)}}updateWorldMatrix(e,t){const n=this.parent;if(e===!0&&n!==null&&n.matrixWorldAutoUpdate===!0&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),t===!0){const r=this.children;for(let s=0,o=r.length;s<o;s++){const a=r[s];a.matrixWorldAutoUpdate===!0&&a.updateWorldMatrix(!1,!0)}}}toJSON(e){const t=e===void 0||typeof e=="string",n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const r={};r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),this.castShadow===!0&&(r.castShadow=!0),this.receiveShadow===!0&&(r.receiveShadow=!0),this.visible===!1&&(r.visible=!1),this.frustumCulled===!1&&(r.frustumCulled=!1),this.renderOrder!==0&&(r.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),r.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(r.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(r.type="BatchedMesh",r.perObjectFrustumCulled=this.perObjectFrustumCulled,r.sortObjects=this.sortObjects,r.drawRanges=this._drawRanges,r.reservedRanges=this._reservedRanges,r.visibility=this._visibility,r.active=this._active,r.bounds=this._bounds.map(a=>({boxInitialized:a.boxInitialized,boxMin:a.box.min.toArray(),boxMax:a.box.max.toArray(),sphereInitialized:a.sphereInitialized,sphereRadius:a.sphere.radius,sphereCenter:a.sphere.center.toArray()})),r.maxGeometryCount=this._maxGeometryCount,r.maxVertexCount=this._maxVertexCount,r.maxIndexCount=this._maxIndexCount,r.geometryInitialized=this._geometryInitialized,r.geometryCount=this._geometryCount,r.matricesTexture=this._matricesTexture.toJSON(e),this.boundingSphere!==null&&(r.boundingSphere={center:r.boundingSphere.center.toArray(),radius:r.boundingSphere.radius}),this.boundingBox!==null&&(r.boundingBox={min:r.boundingBox.min.toArray(),max:r.boundingBox.max.toArray()}));function s(a,l){return a[l.uuid]===void 0&&(a[l.uuid]=l.toJSON(e)),l.uuid}if(this.isScene)this.background&&(this.background.isColor?r.background=this.background.toJSON():this.background.isTexture&&(r.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(r.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){r.geometry=s(e.geometries,this.geometry);const a=this.geometry.parameters;if(a!==void 0&&a.shapes!==void 0){const l=a.shapes;if(Array.isArray(l))for(let c=0,u=l.length;c<u;c++){const h=l[c];s(e.shapes,h)}else s(e.shapes,l)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(s(e.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const a=[];for(let l=0,c=this.material.length;l<c;l++)a.push(s(e.materials,this.material[l]));r.material=a}else r.material=s(e.materials,this.material);if(this.children.length>0){r.children=[];for(let a=0;a<this.children.length;a++)r.children.push(this.children[a].toJSON(e).object)}if(this.animations.length>0){r.animations=[];for(let a=0;a<this.animations.length;a++){const l=this.animations[a];r.animations.push(s(e.animations,l))}}if(t){const a=o(e.geometries),l=o(e.materials),c=o(e.textures),u=o(e.images),h=o(e.shapes),f=o(e.skeletons),d=o(e.animations),m=o(e.nodes);a.length>0&&(n.geometries=a),l.length>0&&(n.materials=l),c.length>0&&(n.textures=c),u.length>0&&(n.images=u),h.length>0&&(n.shapes=h),f.length>0&&(n.skeletons=f),d.length>0&&(n.animations=d),m.length>0&&(n.nodes=m)}return n.object=r,n;function o(a){const l=[];for(const c in a){const u=a[c];delete u.metadata,l.push(u)}return l}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let n=0;n<e.children.length;n++){const r=e.children[n];this.add(r.clone())}return this}}_n.DEFAULT_UP=new H(0,1,0);_n.DEFAULT_MATRIX_AUTO_UPDATE=!0;_n.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const eu=new H,af=new H,YC=new H,lf=new H,gg=new H,Ag=new H,dP=new H,XC=new H,qC=new H,JC=new H;let kE=!1;class ks{constructor(e=new H,t=new H,n=new H){this.a=e,this.b=t,this.c=n}static getNormal(e,t,n,r){r.subVectors(n,t),eu.subVectors(e,t),r.cross(eu);const s=r.lengthSq();return s>0?r.multiplyScalar(1/Math.sqrt(s)):r.set(0,0,0)}static getBarycoord(e,t,n,r,s){eu.subVectors(r,t),af.subVectors(n,t),YC.subVectors(e,t);const o=eu.dot(eu),a=eu.dot(af),l=eu.dot(YC),c=af.dot(af),u=af.dot(YC),h=o*c-a*a;if(h===0)return s.set(0,0,0),null;const f=1/h,d=(c*l-a*u)*f,m=(o*u-a*l)*f;return s.set(1-d-m,m,d)}static containsPoint(e,t,n,r){return this.getBarycoord(e,t,n,r,lf)===null?!1:lf.x>=0&&lf.y>=0&&lf.x+lf.y<=1}static getUV(e,t,n,r,s,o,a,l){return kE===!1&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),kE=!0),this.getInterpolation(e,t,n,r,s,o,a,l)}static getInterpolation(e,t,n,r,s,o,a,l){return this.getBarycoord(e,t,n,r,lf)===null?(l.x=0,l.y=0,"z"in l&&(l.z=0),"w"in l&&(l.w=0),null):(l.setScalar(0),l.addScaledVector(s,lf.x),l.addScaledVector(o,lf.y),l.addScaledVector(a,lf.z),l)}static isFrontFacing(e,t,n,r){return eu.subVectors(n,t),af.subVectors(e,t),eu.cross(af).dot(r)<0}set(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}setFromPointsAndIndices(e,t,n,r){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[r]),this}setFromAttributeAndIndices(e,t,n,r){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,n),this.c.fromBufferAttribute(e,r),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return eu.subVectors(this.c,this.b),af.subVectors(this.a,this.b),eu.cross(af).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return ks.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return ks.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,n,r,s){return kE===!1&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),kE=!0),ks.getInterpolation(e,this.a,this.b,this.c,t,n,r,s)}getInterpolation(e,t,n,r,s){return ks.getInterpolation(e,this.a,this.b,this.c,t,n,r,s)}containsPoint(e){return ks.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return ks.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const n=this.a,r=this.b,s=this.c;let o,a;gg.subVectors(r,n),Ag.subVectors(s,n),XC.subVectors(e,n);const l=gg.dot(XC),c=Ag.dot(XC);if(l<=0&&c<=0)return t.copy(n);qC.subVectors(e,r);const u=gg.dot(qC),h=Ag.dot(qC);if(u>=0&&h<=u)return t.copy(r);const f=l*h-u*c;if(f<=0&&l>=0&&u<=0)return o=l/(l-u),t.copy(n).addScaledVector(gg,o);JC.subVectors(e,s);const d=gg.dot(JC),m=Ag.dot(JC);if(m>=0&&d<=m)return t.copy(s);const A=d*c-l*m;if(A<=0&&c>=0&&m<=0)return a=c/(c-m),t.copy(n).addScaledVector(Ag,a);const g=u*m-d*h;if(g<=0&&h-u>=0&&d-m>=0)return dP.subVectors(s,r),a=(h-u)/(h-u+(d-m)),t.copy(r).addScaledVector(dP,a);const y=1/(g+A+f);return o=A*y,a=f*y,t.copy(n).addScaledVector(gg,o).addScaledVector(Ag,a)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const FU={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Sd={h:0,s:0,l:0},FE={h:0,s:0,l:0};function ZC(i,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?i+(e-i)*6*t:t<1/2?e:t<2/3?i+(e-i)*6*(2/3-t):i}class ut{constructor(e,t,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,n)}set(e,t,n){if(t===void 0&&n===void 0){const r=e;r&&r.isColor?this.copy(r):typeof r=="number"?this.setHex(r):typeof r=="string"&&this.setStyle(r)}else this.setRGB(e,t,n);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=gs){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,Vi.toWorkingColorSpace(this,t),this}setRGB(e,t,n,r=Vi.workingColorSpace){return this.r=e,this.g=t,this.b=n,Vi.toWorkingColorSpace(this,r),this}setHSL(e,t,n,r=Vi.workingColorSpace){if(e=x6(e,1),t=rs(t,0,1),n=rs(n,0,1),t===0)this.r=this.g=this.b=n;else{const s=n<=.5?n*(1+t):n+t-n*t,o=2*n-s;this.r=ZC(o,s,e+1/3),this.g=ZC(o,s,e),this.b=ZC(o,s,e-1/3)}return Vi.toWorkingColorSpace(this,r),this}setStyle(e,t=gs){function n(s){s!==void 0&&parseFloat(s)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let r;if(r=/^(\w+)\(([^\)]*)\)/.exec(e)){let s;const o=r[1],a=r[2];switch(o){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return n(s[4]),this.setRGB(Math.min(255,parseInt(s[1],10))/255,Math.min(255,parseInt(s[2],10))/255,Math.min(255,parseInt(s[3],10))/255,t);if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return n(s[4]),this.setRGB(Math.min(100,parseInt(s[1],10))/100,Math.min(100,parseInt(s[2],10))/100,Math.min(100,parseInt(s[3],10))/100,t);break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return n(s[4]),this.setHSL(parseFloat(s[1])/360,parseFloat(s[2])/100,parseFloat(s[3])/100,t);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(r=/^\#([A-Fa-f\d]+)$/.exec(e)){const s=r[1],o=s.length;if(o===3)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,t);if(o===6)return this.setHex(parseInt(s,16),t);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=gs){const n=FU[e.toLowerCase()];return n!==void 0?this.setHex(n,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=O1(e.r),this.g=O1(e.g),this.b=O1(e.b),this}copyLinearToSRGB(e){return this.r=GC(e.r),this.g=GC(e.g),this.b=GC(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=gs){return Vi.fromWorkingColorSpace($o.copy(this),e),Math.round(rs($o.r*255,0,255))*65536+Math.round(rs($o.g*255,0,255))*256+Math.round(rs($o.b*255,0,255))}getHexString(e=gs){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=Vi.workingColorSpace){Vi.fromWorkingColorSpace($o.copy(this),t);const n=$o.r,r=$o.g,s=$o.b,o=Math.max(n,r,s),a=Math.min(n,r,s);let l,c;const u=(a+o)/2;if(a===o)l=0,c=0;else{const h=o-a;switch(c=u<=.5?h/(o+a):h/(2-o-a),o){case n:l=(r-s)/h+(r<s?6:0);break;case r:l=(s-n)/h+2;break;case s:l=(n-r)/h+4;break}l/=6}return e.h=l,e.s=c,e.l=u,e}getRGB(e,t=Vi.workingColorSpace){return Vi.fromWorkingColorSpace($o.copy(this),t),e.r=$o.r,e.g=$o.g,e.b=$o.b,e}getStyle(e=gs){Vi.fromWorkingColorSpace($o.copy(this),e);const t=$o.r,n=$o.g,r=$o.b;return e!==gs?`color(${e} ${t.toFixed(3)} ${n.toFixed(3)} ${r.toFixed(3)})`:`rgb(${Math.round(t*255)},${Math.round(n*255)},${Math.round(r*255)})`}offsetHSL(e,t,n){return this.getHSL(Sd),this.setHSL(Sd.h+e,Sd.s+t,Sd.l+n)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}lerpHSL(e,t){this.getHSL(Sd),e.getHSL(FE);const n=$v(Sd.h,FE.h,t),r=$v(Sd.s,FE.s,t),s=$v(Sd.l,FE.l,t);return this.setHSL(n,r,s),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,n=this.g,r=this.b,s=e.elements;return this.r=s[0]*t+s[3]*n+s[6]*r,this.g=s[1]*t+s[4]*n+s[7]*r,this.b=s[2]*t+s[5]*n+s[8]*r,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const $o=new ut;ut.NAMES=FU;let KX=0;class Us extends Ch{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:KX++}),this.uuid=Ll(),this.name="",this.type="Material",this.blending=Kd,this.side=tl,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=A2,this.blendDst=yS,this.blendEquation=Nd,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new ut(0,0,0),this.blendAlpha=0,this.depthFunc=y2,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=CS,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=hh,this.stencilZFail=hh,this.stencilZPass=hh,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const t in e){const n=e[t];if(n===void 0){console.warn(`THREE.Material: parameter '${t}' has value of undefined.`);continue}const r=this[t];if(r===void 0){console.warn(`THREE.Material: '${t}' is not a property of THREE.${this.type}.`);continue}r&&r.isColor?r.set(n):r&&r.isVector3&&n&&n.isVector3?r.copy(n):this[t]=n}}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});const n={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};n.uuid=this.uuid,n.type=this.type,this.name!==""&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),this.roughness!==void 0&&(n.roughness=this.roughness),this.metalness!==void 0&&(n.metalness=this.metalness),this.sheen!==void 0&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(n.shininess=this.shininess),this.clearcoat!==void 0&&(n.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.iridescence!==void 0&&(n.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(n.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.anisotropy!==void 0&&(n.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(n.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(n.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(n.combine=this.combine)),this.envMapIntensity!==void 0&&(n.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(n.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(n.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(n.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(n.size=this.size),this.shadowSide!==null&&(n.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==Kd&&(n.blending=this.blending),this.side!==tl&&(n.side=this.side),this.vertexColors===!0&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),this.transparent===!0&&(n.transparent=!0),this.blendSrc!==A2&&(n.blendSrc=this.blendSrc),this.blendDst!==yS&&(n.blendDst=this.blendDst),this.blendEquation!==Nd&&(n.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(n.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(n.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(n.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(n.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(n.blendAlpha=this.blendAlpha),this.depthFunc!==y2&&(n.depthFunc=this.depthFunc),this.depthTest===!1&&(n.depthTest=this.depthTest),this.depthWrite===!1&&(n.depthWrite=this.depthWrite),this.colorWrite===!1&&(n.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(n.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==CS&&(n.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(n.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(n.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==hh&&(n.stencilFail=this.stencilFail),this.stencilZFail!==hh&&(n.stencilZFail=this.stencilZFail),this.stencilZPass!==hh&&(n.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(n.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(n.rotation=this.rotation),this.polygonOffset===!0&&(n.polygonOffset=!0),this.polygonOffsetFactor!==0&&(n.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(n.linewidth=this.linewidth),this.dashSize!==void 0&&(n.dashSize=this.dashSize),this.gapSize!==void 0&&(n.gapSize=this.gapSize),this.scale!==void 0&&(n.scale=this.scale),this.dithering===!0&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),this.alphaHash===!0&&(n.alphaHash=!0),this.alphaToCoverage===!0&&(n.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(n.premultipliedAlpha=!0),this.forceSinglePass===!0&&(n.forceSinglePass=!0),this.wireframe===!0&&(n.wireframe=!0),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(n.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(n.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(n.flatShading=!0),this.visible===!1&&(n.visible=!1),this.toneMapped===!1&&(n.toneMapped=!1),this.fog===!1&&(n.fog=!1),Object.keys(this.userData).length>0&&(n.userData=this.userData);function r(s){const o=[];for(const a in s){const l=s[a];delete l.metadata,o.push(l)}return o}if(t){const s=r(e.textures),o=r(e.images);s.length>0&&(n.textures=s),o.length>0&&(n.images=o)}return n}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let n=null;if(t!==null){const r=t.length;n=new Array(r);for(let s=0;s!==r;++s)n[s]=t[s].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}}class no extends Us{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new ut(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=ex,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const Cf=$X();function $X(){const i=new ArrayBuffer(4),e=new Float32Array(i),t=new Uint32Array(i),n=new Uint32Array(512),r=new Uint32Array(512);for(let l=0;l<256;++l){const c=l-127;c<-27?(n[l]=0,n[l|256]=32768,r[l]=24,r[l|256]=24):c<-14?(n[l]=1024>>-c-14,n[l|256]=1024>>-c-14|32768,r[l]=-c-1,r[l|256]=-c-1):c<=15?(n[l]=c+15<<10,n[l|256]=c+15<<10|32768,r[l]=13,r[l|256]=13):c<128?(n[l]=31744,n[l|256]=64512,r[l]=24,r[l|256]=24):(n[l]=31744,n[l|256]=64512,r[l]=13,r[l|256]=13)}const s=new Uint32Array(2048),o=new Uint32Array(64),a=new Uint32Array(64);for(let l=1;l<1024;++l){let c=l<<13,u=0;for(;(c&8388608)===0;)c<<=1,u-=8388608;c&=-8388609,u+=947912704,s[l]=c|u}for(let l=1024;l<2048;++l)s[l]=939524096+(l-1024<<13);for(let l=1;l<31;++l)o[l]=l<<23;o[31]=1199570944,o[32]=2147483648;for(let l=33;l<63;++l)o[l]=2147483648+(l-32<<23);o[63]=3347054592;for(let l=1;l<64;++l)l!==32&&(a[l]=1024);return{floatView:e,uint32View:t,baseTable:n,shiftTable:r,mantissaTable:s,exponentTable:o,offsetTable:a}}function Ha(i){Math.abs(i)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),i=rs(i,-65504,65504),Cf.floatView[0]=i;const e=Cf.uint32View[0],t=e>>23&511;return Cf.baseTable[t]+((e&8388607)>>Cf.shiftTable[t])}function Dv(i){const e=i>>10;return Cf.uint32View[0]=Cf.mantissaTable[Cf.offsetTable[e]+(i&1023)]+Cf.exponentTable[e],Cf.floatView[0]}const Lm={toHalfFloat:Ha,fromHalfFloat:Dv},Ps=new H,OE=new Ue;class mn{constructor(e,t,n=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=n,this.usage=b2,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.gpuType=fi,this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}get updateRange(){return console.warn("THREE.BufferAttribute: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,n){e*=this.itemSize,n*=t.itemSize;for(let r=0,s=this.itemSize;r<s;r++)this.array[e+r]=t.array[n+r];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,n=this.count;t<n;t++)OE.fromBufferAttribute(this,t),OE.applyMatrix3(e),this.setXY(t,OE.x,OE.y);else if(this.itemSize===3)for(let t=0,n=this.count;t<n;t++)Ps.fromBufferAttribute(this,t),Ps.applyMatrix3(e),this.setXYZ(t,Ps.x,Ps.y,Ps.z);return this}applyMatrix4(e){for(let t=0,n=this.count;t<n;t++)Ps.fromBufferAttribute(this,t),Ps.applyMatrix4(e),this.setXYZ(t,Ps.x,Ps.y,Ps.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)Ps.fromBufferAttribute(this,t),Ps.applyNormalMatrix(e),this.setXYZ(t,Ps.x,Ps.y,Ps.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)Ps.fromBufferAttribute(this,t),Ps.transformDirection(e),this.setXYZ(t,Ps.x,Ps.y,Ps.z);return this}set(e,t=0){return this.array.set(e,t),this}getComponent(e,t){let n=this.array[e*this.itemSize+t];return this.normalized&&(n=qa(n,this.array)),n}setComponent(e,t,n){return this.normalized&&(n=ii(n,this.array)),this.array[e*this.itemSize+t]=n,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=qa(t,this.array)),t}setX(e,t){return this.normalized&&(t=ii(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=qa(t,this.array)),t}setY(e,t){return this.normalized&&(t=ii(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=qa(t,this.array)),t}setZ(e,t){return this.normalized&&(t=ii(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=qa(t,this.array)),t}setW(e,t){return this.normalized&&(t=ii(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=ii(t,this.array),n=ii(n,this.array)),this.array[e+0]=t,this.array[e+1]=n,this}setXYZ(e,t,n,r){return e*=this.itemSize,this.normalized&&(t=ii(t,this.array),n=ii(n,this.array),r=ii(r,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this}setXYZW(e,t,n,r,s){return e*=this.itemSize,this.normalized&&(t=ii(t,this.array),n=ii(n,this.array),r=ii(r,this.array),s=ii(s,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this.array[e+3]=s,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==b2&&(e.usage=this.usage),e}}class YX extends mn{constructor(e,t,n){super(new Int8Array(e),t,n)}}class XX extends mn{constructor(e,t,n){super(new Uint8Array(e),t,n)}}class qX extends mn{constructor(e,t,n){super(new Uint8ClampedArray(e),t,n)}}class JX extends mn{constructor(e,t,n){super(new Int16Array(e),t,n)}}class ww extends mn{constructor(e,t,n){super(new Uint16Array(e),t,n)}}class ZX extends mn{constructor(e,t,n){super(new Int32Array(e),t,n)}}class S6 extends mn{constructor(e,t,n){super(new Uint32Array(e),t,n)}}class eq extends mn{constructor(e,t,n){super(new Uint16Array(e),t,n),this.isFloat16BufferAttribute=!0}getX(e){let t=Dv(this.array[e*this.itemSize]);return this.normalized&&(t=qa(t,this.array)),t}setX(e,t){return this.normalized&&(t=ii(t,this.array)),this.array[e*this.itemSize]=Ha(t),this}getY(e){let t=Dv(this.array[e*this.itemSize+1]);return this.normalized&&(t=qa(t,this.array)),t}setY(e,t){return this.normalized&&(t=ii(t,this.array)),this.array[e*this.itemSize+1]=Ha(t),this}getZ(e){let t=Dv(this.array[e*this.itemSize+2]);return this.normalized&&(t=qa(t,this.array)),t}setZ(e,t){return this.normalized&&(t=ii(t,this.array)),this.array[e*this.itemSize+2]=Ha(t),this}getW(e){let t=Dv(this.array[e*this.itemSize+3]);return this.normalized&&(t=qa(t,this.array)),t}setW(e,t){return this.normalized&&(t=ii(t,this.array)),this.array[e*this.itemSize+3]=Ha(t),this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=ii(t,this.array),n=ii(n,this.array)),this.array[e+0]=Ha(t),this.array[e+1]=Ha(n),this}setXYZ(e,t,n,r){return e*=this.itemSize,this.normalized&&(t=ii(t,this.array),n=ii(n,this.array),r=ii(r,this.array)),this.array[e+0]=Ha(t),this.array[e+1]=Ha(n),this.array[e+2]=Ha(r),this}setXYZW(e,t,n,r,s){return e*=this.itemSize,this.normalized&&(t=ii(t,this.array),n=ii(n,this.array),r=ii(r,this.array),s=ii(s,this.array)),this.array[e+0]=Ha(t),this.array[e+1]=Ha(n),this.array[e+2]=Ha(r),this.array[e+3]=Ha(s),this}}class Gt extends mn{constructor(e,t,n){super(new Float32Array(e),t,n)}}class tq extends mn{constructor(e,t,n){super(new Float64Array(e),t,n)}}let nq=0;const ql=new Xe,eT=new _n,yg=new H,vl=new ti,Py=new ti,go=new H;class fn extends Ch{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:nq++}),this.uuid=Ll(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(BU(e)?S6:ww)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,n=0){this.groups.push({start:e,count:t,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);const n=this.attributes.normal;if(n!==void 0){const s=new Tn().getNormalMatrix(e);n.applyNormalMatrix(s),n.needsUpdate=!0}const r=this.attributes.tangent;return r!==void 0&&(r.transformDirection(e),r.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return ql.makeRotationFromQuaternion(e),this.applyMatrix4(ql),this}rotateX(e){return ql.makeRotationX(e),this.applyMatrix4(ql),this}rotateY(e){return ql.makeRotationY(e),this.applyMatrix4(ql),this}rotateZ(e){return ql.makeRotationZ(e),this.applyMatrix4(ql),this}translate(e,t,n){return ql.makeTranslation(e,t,n),this.applyMatrix4(ql),this}scale(e,t,n){return ql.makeScale(e,t,n),this.applyMatrix4(ql),this}lookAt(e){return eT.lookAt(e),eT.updateMatrix(),this.applyMatrix4(eT.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(yg).negate(),this.translate(yg.x,yg.y,yg.z),this}setFromPoints(e){const t=[];for(let n=0,r=e.length;n<r;n++){const s=e[n];t.push(s.x,s.y,s.z||0)}return this.setAttribute("position",new Gt(t,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new ti);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingBox.set(new H(-1/0,-1/0,-1/0),new H(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let n=0,r=t.length;n<r;n++){const s=t[n];vl.setFromBufferAttribute(s),this.morphTargetsRelative?(go.addVectors(this.boundingBox.min,vl.min),this.boundingBox.expandByPoint(go),go.addVectors(this.boundingBox.max,vl.max),this.boundingBox.expandByPoint(go)):(this.boundingBox.expandByPoint(vl.min),this.boundingBox.expandByPoint(vl.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Bi);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingSphere.set(new H,1/0);return}if(e){const n=this.boundingSphere.center;if(vl.setFromBufferAttribute(e),t)for(let s=0,o=t.length;s<o;s++){const a=t[s];Py.setFromBufferAttribute(a),this.morphTargetsRelative?(go.addVectors(vl.min,Py.min),vl.expandByPoint(go),go.addVectors(vl.max,Py.max),vl.expandByPoint(go)):(vl.expandByPoint(Py.min),vl.expandByPoint(Py.max))}vl.getCenter(n);let r=0;for(let s=0,o=e.count;s<o;s++)go.fromBufferAttribute(e,s),r=Math.max(r,n.distanceToSquared(go));if(t)for(let s=0,o=t.length;s<o;s++){const a=t[s],l=this.morphTargetsRelative;for(let c=0,u=a.count;c<u;c++)go.fromBufferAttribute(a,c),l&&(yg.fromBufferAttribute(e,c),go.add(yg)),r=Math.max(r,n.distanceToSquared(go))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const n=e.array,r=t.position.array,s=t.normal.array,o=t.uv.array,a=r.length/3;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new mn(new Float32Array(4*a),4));const l=this.getAttribute("tangent").array,c=[],u=[];for(let P=0;P<a;P++)c[P]=new H,u[P]=new H;const h=new H,f=new H,d=new H,m=new Ue,A=new Ue,g=new Ue,y=new H,E=new H;function x(P,F,k){h.fromArray(r,P*3),f.fromArray(r,F*3),d.fromArray(r,k*3),m.fromArray(o,P*2),A.fromArray(o,F*2),g.fromArray(o,k*2),f.sub(h),d.sub(h),A.sub(m),g.sub(m);const z=1/(A.x*g.y-g.x*A.y);isFinite(z)&&(y.copy(f).multiplyScalar(g.y).addScaledVector(d,-A.y).multiplyScalar(z),E.copy(d).multiplyScalar(A.x).addScaledVector(f,-g.x).multiplyScalar(z),c[P].add(y),c[F].add(y),c[k].add(y),u[P].add(E),u[F].add(E),u[k].add(E))}let C=this.groups;C.length===0&&(C=[{start:0,count:n.length}]);for(let P=0,F=C.length;P<F;++P){const k=C[P],z=k.start,U=k.count;for(let W=z,$=z+U;W<$;W+=3)x(n[W+0],n[W+1],n[W+2])}const T=new H,I=new H,M=new H,L=new H;function R(P){M.fromArray(s,P*3),L.copy(M);const F=c[P];T.copy(F),T.sub(M.multiplyScalar(M.dot(F))).normalize(),I.crossVectors(L,F);const z=I.dot(u[P])<0?-1:1;l[P*4]=T.x,l[P*4+1]=T.y,l[P*4+2]=T.z,l[P*4+3]=z}for(let P=0,F=C.length;P<F;++P){const k=C[P],z=k.start,U=k.count;for(let W=z,$=z+U;W<$;W+=3)R(n[W+0]),R(n[W+1]),R(n[W+2])}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(t!==void 0){let n=this.getAttribute("normal");if(n===void 0)n=new mn(new Float32Array(t.count*3),3),this.setAttribute("normal",n);else for(let f=0,d=n.count;f<d;f++)n.setXYZ(f,0,0,0);const r=new H,s=new H,o=new H,a=new H,l=new H,c=new H,u=new H,h=new H;if(e)for(let f=0,d=e.count;f<d;f+=3){const m=e.getX(f+0),A=e.getX(f+1),g=e.getX(f+2);r.fromBufferAttribute(t,m),s.fromBufferAttribute(t,A),o.fromBufferAttribute(t,g),u.subVectors(o,s),h.subVectors(r,s),u.cross(h),a.fromBufferAttribute(n,m),l.fromBufferAttribute(n,A),c.fromBufferAttribute(n,g),a.add(u),l.add(u),c.add(u),n.setXYZ(m,a.x,a.y,a.z),n.setXYZ(A,l.x,l.y,l.z),n.setXYZ(g,c.x,c.y,c.z)}else for(let f=0,d=t.count;f<d;f+=3)r.fromBufferAttribute(t,f+0),s.fromBufferAttribute(t,f+1),o.fromBufferAttribute(t,f+2),u.subVectors(o,s),h.subVectors(r,s),u.cross(h),n.setXYZ(f+0,u.x,u.y,u.z),n.setXYZ(f+1,u.x,u.y,u.z),n.setXYZ(f+2,u.x,u.y,u.z);this.normalizeNormals(),n.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let t=0,n=e.count;t<n;t++)go.fromBufferAttribute(e,t),go.normalize(),e.setXYZ(t,go.x,go.y,go.z)}toNonIndexed(){function e(a,l){const c=a.array,u=a.itemSize,h=a.normalized,f=new c.constructor(l.length*u);let d=0,m=0;for(let A=0,g=l.length;A<g;A++){a.isInterleavedBufferAttribute?d=l[A]*a.data.stride+a.offset:d=l[A]*u;for(let y=0;y<u;y++)f[m++]=c[d++]}return new mn(f,u,h)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new fn,n=this.index.array,r=this.attributes;for(const a in r){const l=r[a],c=e(l,n);t.setAttribute(a,c)}const s=this.morphAttributes;for(const a in s){const l=[],c=s[a];for(let u=0,h=c.length;u<h;u++){const f=c[u],d=e(f,n);l.push(d)}t.morphAttributes[a]=l}t.morphTargetsRelative=this.morphTargetsRelative;const o=this.groups;for(let a=0,l=o.length;a<l;a++){const c=o[a];t.addGroup(c.start,c.count,c.materialIndex)}return t}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const l=this.parameters;for(const c in l)l[c]!==void 0&&(e[c]=l[c]);return e}e.data={attributes:{}};const t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const n=this.attributes;for(const l in n){const c=n[l];e.data.attributes[l]=c.toJSON(e.data)}const r={};let s=!1;for(const l in this.morphAttributes){const c=this.morphAttributes[l],u=[];for(let h=0,f=c.length;h<f;h++){const d=c[h];u.push(d.toJSON(e.data))}u.length>0&&(r[l]=u,s=!0)}s&&(e.data.morphAttributes=r,e.data.morphTargetsRelative=this.morphTargetsRelative);const o=this.groups;o.length>0&&(e.data.groups=JSON.parse(JSON.stringify(o)));const a=this.boundingSphere;return a!==null&&(e.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const n=e.index;n!==null&&this.setIndex(n.clone(t));const r=e.attributes;for(const c in r){const u=r[c];this.setAttribute(c,u.clone(t))}const s=e.morphAttributes;for(const c in s){const u=[],h=s[c];for(let f=0,d=h.length;f<d;f++)u.push(h[f].clone(t));this.morphAttributes[c]=u}this.morphTargetsRelative=e.morphTargetsRelative;const o=e.groups;for(let c=0,u=o.length;c<u;c++){const h=o[c];this.addGroup(h.start,h.count,h.materialIndex)}const a=e.boundingBox;a!==null&&(this.boundingBox=a.clone());const l=e.boundingSphere;return l!==null&&(this.boundingSphere=l.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const pP=new Xe,rm=new vc,NE=new Bi,mP=new H,vg=new H,xg=new H,Eg=new H,tT=new H,UE=new H,zE=new Ue,GE=new Ue,HE=new Ue,gP=new H,AP=new H,yP=new H,QE=new H,VE=new H;class It extends _n{constructor(e=new fn,t=new no){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,n=Object.keys(t);if(n.length>0){const r=t[n[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=r.length;s<o;s++){const a=r[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}getVertexPosition(e,t){const n=this.geometry,r=n.attributes.position,s=n.morphAttributes.position,o=n.morphTargetsRelative;t.fromBufferAttribute(r,e);const a=this.morphTargetInfluences;if(s&&a){UE.set(0,0,0);for(let l=0,c=s.length;l<c;l++){const u=a[l],h=s[l];u!==0&&(tT.fromBufferAttribute(h,e),o?UE.addScaledVector(tT,u):UE.addScaledVector(tT.sub(t),u))}t.add(UE)}return t}raycast(e,t){const n=this.geometry,r=this.material,s=this.matrixWorld;r!==void 0&&(n.boundingSphere===null&&n.computeBoundingSphere(),NE.copy(n.boundingSphere),NE.applyMatrix4(s),rm.copy(e.ray).recast(e.near),!(NE.containsPoint(rm.origin)===!1&&(rm.intersectSphere(NE,mP)===null||rm.origin.distanceToSquared(mP)>(e.far-e.near)**2))&&(pP.copy(s).invert(),rm.copy(e.ray).applyMatrix4(pP),!(n.boundingBox!==null&&rm.intersectsBox(n.boundingBox)===!1)&&this._computeIntersections(e,t,rm)))}_computeIntersections(e,t,n){let r;const s=this.geometry,o=this.material,a=s.index,l=s.attributes.position,c=s.attributes.uv,u=s.attributes.uv1,h=s.attributes.normal,f=s.groups,d=s.drawRange;if(a!==null)if(Array.isArray(o))for(let m=0,A=f.length;m<A;m++){const g=f[m],y=o[g.materialIndex],E=Math.max(g.start,d.start),x=Math.min(a.count,Math.min(g.start+g.count,d.start+d.count));for(let C=E,T=x;C<T;C+=3){const I=a.getX(C),M=a.getX(C+1),L=a.getX(C+2);r=WE(this,y,e,n,c,u,h,I,M,L),r&&(r.faceIndex=Math.floor(C/3),r.face.materialIndex=g.materialIndex,t.push(r))}}else{const m=Math.max(0,d.start),A=Math.min(a.count,d.start+d.count);for(let g=m,y=A;g<y;g+=3){const E=a.getX(g),x=a.getX(g+1),C=a.getX(g+2);r=WE(this,o,e,n,c,u,h,E,x,C),r&&(r.faceIndex=Math.floor(g/3),t.push(r))}}else if(l!==void 0)if(Array.isArray(o))for(let m=0,A=f.length;m<A;m++){const g=f[m],y=o[g.materialIndex],E=Math.max(g.start,d.start),x=Math.min(l.count,Math.min(g.start+g.count,d.start+d.count));for(let C=E,T=x;C<T;C+=3){const I=C,M=C+1,L=C+2;r=WE(this,y,e,n,c,u,h,I,M,L),r&&(r.faceIndex=Math.floor(C/3),r.face.materialIndex=g.materialIndex,t.push(r))}}else{const m=Math.max(0,d.start),A=Math.min(l.count,d.start+d.count);for(let g=m,y=A;g<y;g+=3){const E=g,x=g+1,C=g+2;r=WE(this,o,e,n,c,u,h,E,x,C),r&&(r.faceIndex=Math.floor(g/3),t.push(r))}}}}function iq(i,e,t,n,r,s,o,a){let l;if(e.side===ys?l=n.intersectTriangle(o,s,r,!0,a):l=n.intersectTriangle(r,s,o,e.side===tl,a),l===null)return null;VE.copy(a),VE.applyMatrix4(i.matrixWorld);const c=t.ray.origin.distanceTo(VE);return c<t.near||c>t.far?null:{distance:c,point:VE.clone(),object:i}}function WE(i,e,t,n,r,s,o,a,l,c){i.getVertexPosition(a,vg),i.getVertexPosition(l,xg),i.getVertexPosition(c,Eg);const u=iq(i,e,t,n,vg,xg,Eg,QE);if(u){r&&(zE.fromBufferAttribute(r,a),GE.fromBufferAttribute(r,l),HE.fromBufferAttribute(r,c),u.uv=ks.getInterpolation(QE,vg,xg,Eg,zE,GE,HE,new Ue)),s&&(zE.fromBufferAttribute(s,a),GE.fromBufferAttribute(s,l),HE.fromBufferAttribute(s,c),u.uv1=ks.getInterpolation(QE,vg,xg,Eg,zE,GE,HE,new Ue),u.uv2=u.uv1),o&&(gP.fromBufferAttribute(o,a),AP.fromBufferAttribute(o,l),yP.fromBufferAttribute(o,c),u.normal=ks.getInterpolation(QE,vg,xg,Eg,gP,AP,yP,new H),u.normal.dot(n.direction)>0&&u.normal.multiplyScalar(-1));const h={a,b:l,c,normal:new H,materialIndex:0};ks.getNormal(vg,xg,Eg,h.normal),u.face=h}return u}class ya extends fn{constructor(e=1,t=1,n=1,r=1,s=1,o=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:r,heightSegments:s,depthSegments:o};const a=this;r=Math.floor(r),s=Math.floor(s),o=Math.floor(o);const l=[],c=[],u=[],h=[];let f=0,d=0;m("z","y","x",-1,-1,n,t,e,o,s,0),m("z","y","x",1,-1,n,t,-e,o,s,1),m("x","z","y",1,1,e,n,t,r,o,2),m("x","z","y",1,-1,e,n,-t,r,o,3),m("x","y","z",1,-1,e,t,n,r,s,4),m("x","y","z",-1,-1,e,t,-n,r,s,5),this.setIndex(l),this.setAttribute("position",new Gt(c,3)),this.setAttribute("normal",new Gt(u,3)),this.setAttribute("uv",new Gt(h,2));function m(A,g,y,E,x,C,T,I,M,L,R){const P=C/M,F=T/L,k=C/2,z=T/2,U=I/2,W=M+1,$=L+1;let oe=0,X=0;const Q=new H;for(let Y=0;Y<$;Y++){const O=Y*F-z;for(let K=0;K<W;K++){const te=K*P-k;Q[A]=te*E,Q[g]=O*x,Q[y]=U,c.push(Q.x,Q.y,Q.z),Q[A]=0,Q[g]=0,Q[y]=I>0?1:-1,u.push(Q.x,Q.y,Q.z),h.push(K/M),h.push(1-Y/L),oe+=1}}for(let Y=0;Y<L;Y++)for(let O=0;O<M;O++){const K=f+O+W*Y,te=f+O+W*(Y+1),q=f+(O+1)+W*(Y+1),J=f+(O+1)+W*Y;l.push(K,te,J),l.push(te,q,J),X+=6}a.addGroup(d,X,R),d+=X,f+=oe}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new ya(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function eA(i){const e={};for(const t in i){e[t]={};for(const n in i[t]){const r=i[t][n];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?r.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[t][n]=null):e[t][n]=r.clone():Array.isArray(r)?e[t][n]=r.slice():e[t][n]=r}}return e}function Aa(i){const e={};for(let t=0;t<i.length;t++){const n=eA(i[t]);for(const r in n)e[r]=n[r]}return e}function rq(i){const e=[];for(let t=0;t<i.length;t++)e.push(i[t].clone());return e}function OU(i){return i.getRenderTarget()===null?i.outputColorSpace:Vi.workingColorSpace}const rp={clone:eA,merge:Aa};var sq=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,oq=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class Mi extends Us{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=sq,this.fragmentShader=oq,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1,clipCullDistance:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=eA(e.uniforms),this.uniformsGroups=rq(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const r in this.uniforms){const o=this.uniforms[r].value;o&&o.isTexture?t.uniforms[r]={type:"t",value:o.toJSON(e).uuid}:o&&o.isColor?t.uniforms[r]={type:"c",value:o.getHex()}:o&&o.isVector2?t.uniforms[r]={type:"v2",value:o.toArray()}:o&&o.isVector3?t.uniforms[r]={type:"v3",value:o.toArray()}:o&&o.isVector4?t.uniforms[r]={type:"v4",value:o.toArray()}:o&&o.isMatrix3?t.uniforms[r]={type:"m3",value:o.toArray()}:o&&o.isMatrix4?t.uniforms[r]={type:"m4",value:o.toArray()}:t.uniforms[r]={value:o}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;const n={};for(const r in this.extensions)this.extensions[r]===!0&&(n[r]=!0);return Object.keys(n).length>0&&(t.extensions=n),t}}class u0 extends _n{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Xe,this.projectionMatrix=new Xe,this.projectionMatrixInverse=new Xe,this.coordinateSystem=mu}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}let Wn=class extends u0{constructor(e=50,t=1,n=.1,r=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=n,this.far=r,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=Z1*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(Um*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return Z1*2*Math.atan(Math.tan(Um*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,n,r,s,o){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=s,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(Um*.5*this.fov)/this.zoom,n=2*t,r=this.aspect*n,s=-.5*r;const o=this.view;if(this.view!==null&&this.view.enabled){const l=o.fullWidth,c=o.fullHeight;s+=o.offsetX*r/l,t-=o.offsetY*n/c,r*=o.width/l,n*=o.height/c}const a=this.filmOffset;a!==0&&(s+=e*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(s,s+r,t,t-n,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}};const _g=-90,Sg=1;let Cw=class extends _n{constructor(e,t,n){super(),this.type="CubeCamera",this.renderTarget=n,this.coordinateSystem=null,this.activeMipmapLevel=0;const r=new Wn(_g,Sg,e,t);r.layers=this.layers,this.add(r);const s=new Wn(_g,Sg,e,t);s.layers=this.layers,this.add(s);const o=new Wn(_g,Sg,e,t);o.layers=this.layers,this.add(o);const a=new Wn(_g,Sg,e,t);a.layers=this.layers,this.add(a);const l=new Wn(_g,Sg,e,t);l.layers=this.layers,this.add(l);const c=new Wn(_g,Sg,e,t);c.layers=this.layers,this.add(c)}updateCoordinateSystem(){const e=this.coordinateSystem,t=this.children.concat(),[n,r,s,o,a,l]=t;for(const c of t)this.remove(c);if(e===mu)n.up.set(0,1,0),n.lookAt(1,0,0),r.up.set(0,1,0),r.lookAt(-1,0,0),s.up.set(0,0,-1),s.lookAt(0,1,0),o.up.set(0,0,1),o.lookAt(0,-1,0),a.up.set(0,1,0),a.lookAt(0,0,1),l.up.set(0,1,0),l.lookAt(0,0,-1);else if(e===J1)n.up.set(0,-1,0),n.lookAt(-1,0,0),r.up.set(0,-1,0),r.lookAt(1,0,0),s.up.set(0,0,1),s.lookAt(0,1,0),o.up.set(0,0,-1),o.lookAt(0,-1,0),a.up.set(0,-1,0),a.lookAt(0,0,1),l.up.set(0,-1,0),l.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);for(const c of t)this.add(c),c.updateMatrixWorld()}update(e,t){this.parent===null&&this.updateMatrixWorld();const{renderTarget:n,activeMipmapLevel:r}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[s,o,a,l,c,u]=this.children,h=e.getRenderTarget(),f=e.getActiveCubeFace(),d=e.getActiveMipmapLevel(),m=e.xr.enabled;e.xr.enabled=!1;const A=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0,r),e.render(t,s),e.setRenderTarget(n,1,r),e.render(t,o),e.setRenderTarget(n,2,r),e.render(t,a),e.setRenderTarget(n,3,r),e.render(t,l),e.setRenderTarget(n,4,r),e.render(t,c),n.texture.generateMipmaps=A,e.setRenderTarget(n,5,r),e.render(t,u),e.setRenderTarget(h,f,d),e.xr.enabled=m,n.texture.needsPMREMUpdate=!0}},ix=class extends vi{constructor(e,t,n,r,s,o,a,l,c,u){e=e!==void 0?e:[],t=t!==void 0?t:_u,super(e,t,n,r,s,o,a,l,c,u),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}};class xA extends Si{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const n={width:e,height:e,depth:1},r=[n,n,n,n,n,n];t.encoding!==void 0&&(Yv("THREE.WebGLCubeRenderTarget: option.encoding has been replaced by option.colorSpace."),t.colorSpace=t.encoding===Yd?gs:Tl),this.texture=new ix(r,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=t.generateMipmaps!==void 0?t.generateMipmaps:!1,this.texture.minFilter=t.minFilter!==void 0?t.minFilter:Pn}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const n={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},r=new ya(5,5,5),s=new Mi({name:"CubemapFromEquirect",uniforms:eA(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:ys,blending:gc});s.uniforms.tEquirect.value=t;const o=new It(r,s),a=t.minFilter;return t.minFilter===Bl&&(t.minFilter=Pn),new Cw(1,10,this).update(e,o),t.minFilter=a,o.geometry.dispose(),o.material.dispose(),this}clear(e,t,n,r){const s=e.getRenderTarget();for(let o=0;o<6;o++)e.setRenderTarget(this,o),e.clear(t,n,r);e.setRenderTarget(s)}}const nT=new H,aq=new H,lq=new Tn;let vo=class{constructor(e=new H(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,n,r){return this.normal.set(e,t,n),this.constant=r,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,n){const r=nT.subVectors(n,t).cross(aq.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const n=e.delta(nT),r=this.normal.dot(n);if(r===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;const s=-(e.start.dot(this.normal)+this.constant)/r;return s<0||s>1?null:t.copy(e.start).addScaledVector(n,s)}intersectsLine(e){const t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const n=t||lq.getNormalMatrix(e),r=this.coplanarPoint(nT).applyMatrix4(e),s=this.normal.applyMatrix3(n).normalize();return this.constant=-r.dot(s),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}};const sm=new Bi,jE=new H;class h0{constructor(e=new vo,t=new vo,n=new vo,r=new vo,s=new vo,o=new vo){this.planes=[e,t,n,r,s,o]}set(e,t,n,r,s,o){const a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(n),a[3].copy(r),a[4].copy(s),a[5].copy(o),this}copy(e){const t=this.planes;for(let n=0;n<6;n++)t[n].copy(e.planes[n]);return this}setFromProjectionMatrix(e,t=mu){const n=this.planes,r=e.elements,s=r[0],o=r[1],a=r[2],l=r[3],c=r[4],u=r[5],h=r[6],f=r[7],d=r[8],m=r[9],A=r[10],g=r[11],y=r[12],E=r[13],x=r[14],C=r[15];if(n[0].setComponents(l-s,f-c,g-d,C-y).normalize(),n[1].setComponents(l+s,f+c,g+d,C+y).normalize(),n[2].setComponents(l+o,f+u,g+m,C+E).normalize(),n[3].setComponents(l-o,f-u,g-m,C-E).normalize(),n[4].setComponents(l-a,f-h,g-A,C-x).normalize(),t===mu)n[5].setComponents(l+a,f+h,g+A,C+x).normalize();else if(t===J1)n[5].setComponents(a,h,A,x).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);return this}intersectsObject(e){if(e.boundingSphere!==void 0)e.boundingSphere===null&&e.computeBoundingSphere(),sm.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;t.boundingSphere===null&&t.computeBoundingSphere(),sm.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(sm)}intersectsSprite(e){return sm.center.set(0,0,0),sm.radius=.7071067811865476,sm.applyMatrix4(e.matrixWorld),this.intersectsSphere(sm)}intersectsSphere(e){const t=this.planes,n=e.center,r=-e.radius;for(let s=0;s<6;s++)if(t[s].distanceToPoint(n)<r)return!1;return!0}intersectsBox(e){const t=this.planes;for(let n=0;n<6;n++){const r=t[n];if(jE.x=r.normal.x>0?e.max.x:e.min.x,jE.y=r.normal.y>0?e.max.y:e.min.y,jE.z=r.normal.z>0?e.max.z:e.min.z,r.distanceToPoint(jE)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function NU(){let i=null,e=!1,t=null,n=null;function r(s,o){t(s,o),n=i.requestAnimationFrame(r)}return{start:function(){e!==!0&&t!==null&&(n=i.requestAnimationFrame(r),e=!0)},stop:function(){i.cancelAnimationFrame(n),e=!1},setAnimationLoop:function(s){t=s},setContext:function(s){i=s}}}function cq(i,e){const t=e.isWebGL2,n=new WeakMap;function r(c,u){const h=c.array,f=c.usage,d=h.byteLength,m=i.createBuffer();i.bindBuffer(u,m),i.bufferData(u,h,f),c.onUploadCallback();let A;if(h instanceof Float32Array)A=i.FLOAT;else if(h instanceof Uint16Array)if(c.isFloat16BufferAttribute)if(t)A=i.HALF_FLOAT;else throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");else A=i.UNSIGNED_SHORT;else if(h instanceof Int16Array)A=i.SHORT;else if(h instanceof Uint32Array)A=i.UNSIGNED_INT;else if(h instanceof Int32Array)A=i.INT;else if(h instanceof Int8Array)A=i.BYTE;else if(h instanceof Uint8Array)A=i.UNSIGNED_BYTE;else if(h instanceof Uint8ClampedArray)A=i.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+h);return{buffer:m,type:A,bytesPerElement:h.BYTES_PER_ELEMENT,version:c.version,size:d}}function s(c,u,h){const f=u.array,d=u._updateRange,m=u.updateRanges;if(i.bindBuffer(h,c),d.count===-1&&m.length===0&&i.bufferSubData(h,0,f),m.length!==0){for(let A=0,g=m.length;A<g;A++){const y=m[A];t?i.bufferSubData(h,y.start*f.BYTES_PER_ELEMENT,f,y.start,y.count):i.bufferSubData(h,y.start*f.BYTES_PER_ELEMENT,f.subarray(y.start,y.start+y.count))}u.clearUpdateRanges()}d.count!==-1&&(t?i.bufferSubData(h,d.offset*f.BYTES_PER_ELEMENT,f,d.offset,d.count):i.bufferSubData(h,d.offset*f.BYTES_PER_ELEMENT,f.subarray(d.offset,d.offset+d.count)),d.count=-1),u.onUploadCallback()}function o(c){return c.isInterleavedBufferAttribute&&(c=c.data),n.get(c)}function a(c){c.isInterleavedBufferAttribute&&(c=c.data);const u=n.get(c);u&&(i.deleteBuffer(u.buffer),n.delete(c))}function l(c,u){if(c.isGLBufferAttribute){const f=n.get(c);(!f||f.version<c.version)&&n.set(c,{buffer:c.buffer,type:c.type,bytesPerElement:c.elementSize,version:c.version});return}c.isInterleavedBufferAttribute&&(c=c.data);const h=n.get(c);if(h===void 0)n.set(c,r(c,u));else if(h.version<c.version){if(h.size!==c.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");s(h.buffer,c,u),h.version=c.version}}return{get:o,remove:a,update:l}}class Fs extends fn{constructor(e=1,t=1,n=1,r=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:r};const s=e/2,o=t/2,a=Math.floor(n),l=Math.floor(r),c=a+1,u=l+1,h=e/a,f=t/l,d=[],m=[],A=[],g=[];for(let y=0;y<u;y++){const E=y*f-o;for(let x=0;x<c;x++){const C=x*h-s;m.push(C,-E,0),A.push(0,0,1),g.push(x/a),g.push(1-y/l)}}for(let y=0;y<l;y++)for(let E=0;E<a;E++){const x=E+c*y,C=E+c*(y+1),T=E+1+c*(y+1),I=E+1+c*y;d.push(x,C,I),d.push(C,T,I)}this.setIndex(d),this.setAttribute("position",new Gt(m,3)),this.setAttribute("normal",new Gt(A,3)),this.setAttribute("uv",new Gt(g,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Fs(e.width,e.height,e.widthSegments,e.heightSegments)}}var uq=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,hq=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,fq=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,dq=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,pq=`#ifdef USE_ALPHATEST
	if ( diffuseColor.a < alphaTest ) discard;
#endif`,mq=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,gq=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,Aq=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,yq=`#ifdef USE_BATCHING
	attribute float batchId;
	uniform highp sampler2D batchingTexture;
	mat4 getBatchingMatrix( const in float i ) {
		int size = textureSize( batchingTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,vq=`#ifdef USE_BATCHING
	mat4 batchingMatrix = getBatchingMatrix( batchId );
#endif`,xq=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,Eq=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,_q=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,Sq=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,wq=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,Cq=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,Tq=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,bq=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,Iq=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,Mq=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,Rq=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,Lq=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,Pq=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,Bq=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float luminance( const in vec3 rgb ) {
	const vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );
	return dot( weights, rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,Dq=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,kq=`vec3 transformedNormal = objectNormal;
#ifdef USE_TANGENT
	vec3 transformedTangent = objectTangent;
#endif
#ifdef USE_BATCHING
	mat3 bm = mat3( batchingMatrix );
	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );
	transformedNormal = bm * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = bm * transformedTangent;
	#endif
#endif
#ifdef USE_INSTANCING
	mat3 im = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );
	transformedNormal = im * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = im * transformedTangent;
	#endif
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,Fq=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,Oq=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,Nq=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,Uq=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,zq="gl_FragColor = linearToOutputTexel( gl_FragColor );",Gq=`
const mat3 LINEAR_SRGB_TO_LINEAR_DISPLAY_P3 = mat3(
	vec3( 0.8224621, 0.177538, 0.0 ),
	vec3( 0.0331941, 0.9668058, 0.0 ),
	vec3( 0.0170827, 0.0723974, 0.9105199 )
);
const mat3 LINEAR_DISPLAY_P3_TO_LINEAR_SRGB = mat3(
	vec3( 1.2249401, - 0.2249404, 0.0 ),
	vec3( - 0.0420569, 1.0420571, 0.0 ),
	vec3( - 0.0196376, - 0.0786361, 1.0982735 )
);
vec4 LinearSRGBToLinearDisplayP3( in vec4 value ) {
	return vec4( value.rgb * LINEAR_SRGB_TO_LINEAR_DISPLAY_P3, value.a );
}
vec4 LinearDisplayP3ToLinearSRGB( in vec4 value ) {
	return vec4( value.rgb * LINEAR_DISPLAY_P3_TO_LINEAR_SRGB, value.a );
}
vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}
vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return sRGBTransferOETF( value );
}`,Hq=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,Qq=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,Vq=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,Wq=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,jq=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,Kq=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,$q=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,Yq=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,Xq=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,qq=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,Jq=`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
	vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
	reflectedLight.indirectDiffuse += lightMapIrradiance;
#endif`,Zq=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,eJ=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,tJ=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,nJ=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( LEGACY_LIGHTS )
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#else
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,iJ=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,rJ=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,sJ=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,oJ=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,aJ=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,lJ=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	if( material.anisotropy == 0.0 ) {
		anisotropyV = vec2( 1.0, 0.0 );
	} else {
		anisotropyV /= material.anisotropy;
		material.anisotropy = saturate( material.anisotropy );
	}
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;
#endif`,cJ=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,uJ=`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal = vec3( 0.0 );
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,hJ=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,fJ=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,dJ=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,pJ=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,mJ=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,gJ=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,AJ=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );
	
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,yJ=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,vJ=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,xJ=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,EJ=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,_J=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,SJ=`#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,wJ=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,CJ=`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		uniform sampler2DArray morphTargetsTexture;
		uniform ivec2 morphTargetsTextureSize;
		vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
			int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
			int y = texelIndex / morphTargetsTextureSize.x;
			int x = texelIndex - y * morphTargetsTextureSize.x;
			ivec3 morphUV = ivec3( x, y, morphTargetIndex );
			return texelFetch( morphTargetsTexture, morphUV, 0 );
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,TJ=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,bJ=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,IJ=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,MJ=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,RJ=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,LJ=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,PJ=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,BJ=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,DJ=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,kJ=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,FJ=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,OJ=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,NJ=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec2 packDepthToRG( in highp float v ) {
	return packDepthToRGBA( v ).yx;
}
float unpackRGToDepth( const in highp vec2 v ) {
	return unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,UJ=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,zJ=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_BATCHING
	mvPosition = batchingMatrix * mvPosition;
#endif
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,GJ=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,HJ=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,QJ=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,VJ=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,WJ=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,jJ=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,KJ=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,$J=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,YJ=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,XJ=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	mat4 getBoneMatrix( const in float i ) {
		int size = textureSize( boneTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,qJ=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,JJ=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,ZJ=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,eZ=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,tZ=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,nZ=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
const mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(
	vec3( 1.6605, - 0.1246, - 0.0182 ),
	vec3( - 0.5876, 1.1329, - 0.1006 ),
	vec3( - 0.0728, - 0.0083, 1.1187 )
);
const mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(
	vec3( 0.6274, 0.0691, 0.0164 ),
	vec3( 0.3293, 0.9195, 0.0880 ),
	vec3( 0.0433, 0.0113, 0.8956 )
);
vec3 agxDefaultContrastApprox( vec3 x ) {
	vec3 x2 = x * x;
	vec3 x4 = x2 * x2;
	return + 15.5 * x4 * x2
		- 40.14 * x4 * x
		+ 31.96 * x4
		- 6.868 * x2 * x
		+ 0.4298 * x2
		+ 0.1191 * x
		- 0.00232;
}
vec3 AgXToneMapping( vec3 color ) {
	const mat3 AgXInsetMatrix = mat3(
		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),
		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),
		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )
	);
	const mat3 AgXOutsetMatrix = mat3(
		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),
		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),
		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )
	);
	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;
	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;
	color *= toneMappingExposure;
	color = AgXInsetMatrix * color;
	color = max( color, 1e-10 );	color = log2( color );
	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );
	color = clamp( color, 0.0, 1.0 );
	color = agxDefaultContrastApprox( color );
	color = AgXOutsetMatrix * color;
	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );
	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;
	return color;
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,iZ=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,rZ=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
		vec3 transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,sZ=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,oZ=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,aZ=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,lZ=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_BATCHING
		worldPosition = batchingMatrix * worldPosition;
	#endif
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const cZ=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,uZ=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,hZ=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,fZ=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,dZ=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,pZ=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,mZ=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,gZ=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,AZ=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,yZ=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,vZ=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,xZ=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,EZ=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,_Z=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,SZ=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,wZ=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,CZ=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,TZ=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,bZ=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,IZ=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,MZ=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,RZ=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,LZ=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,PZ=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,BZ=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,DZ=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,kZ=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,FZ=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,OZ=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,NZ=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,UZ=`#include <common>
#include <batching_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,zZ=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,GZ=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,HZ=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,Un={alphahash_fragment:uq,alphahash_pars_fragment:hq,alphamap_fragment:fq,alphamap_pars_fragment:dq,alphatest_fragment:pq,alphatest_pars_fragment:mq,aomap_fragment:gq,aomap_pars_fragment:Aq,batching_pars_vertex:yq,batching_vertex:vq,begin_vertex:xq,beginnormal_vertex:Eq,bsdfs:_q,iridescence_fragment:Sq,bumpmap_pars_fragment:wq,clipping_planes_fragment:Cq,clipping_planes_pars_fragment:Tq,clipping_planes_pars_vertex:bq,clipping_planes_vertex:Iq,color_fragment:Mq,color_pars_fragment:Rq,color_pars_vertex:Lq,color_vertex:Pq,common:Bq,cube_uv_reflection_fragment:Dq,defaultnormal_vertex:kq,displacementmap_pars_vertex:Fq,displacementmap_vertex:Oq,emissivemap_fragment:Nq,emissivemap_pars_fragment:Uq,colorspace_fragment:zq,colorspace_pars_fragment:Gq,envmap_fragment:Hq,envmap_common_pars_fragment:Qq,envmap_pars_fragment:Vq,envmap_pars_vertex:Wq,envmap_physical_pars_fragment:iJ,envmap_vertex:jq,fog_vertex:Kq,fog_pars_vertex:$q,fog_fragment:Yq,fog_pars_fragment:Xq,gradientmap_pars_fragment:qq,lightmap_fragment:Jq,lightmap_pars_fragment:Zq,lights_lambert_fragment:eJ,lights_lambert_pars_fragment:tJ,lights_pars_begin:nJ,lights_toon_fragment:rJ,lights_toon_pars_fragment:sJ,lights_phong_fragment:oJ,lights_phong_pars_fragment:aJ,lights_physical_fragment:lJ,lights_physical_pars_fragment:cJ,lights_fragment_begin:uJ,lights_fragment_maps:hJ,lights_fragment_end:fJ,logdepthbuf_fragment:dJ,logdepthbuf_pars_fragment:pJ,logdepthbuf_pars_vertex:mJ,logdepthbuf_vertex:gJ,map_fragment:AJ,map_pars_fragment:yJ,map_particle_fragment:vJ,map_particle_pars_fragment:xJ,metalnessmap_fragment:EJ,metalnessmap_pars_fragment:_J,morphcolor_vertex:SJ,morphnormal_vertex:wJ,morphtarget_pars_vertex:CJ,morphtarget_vertex:TJ,normal_fragment_begin:bJ,normal_fragment_maps:IJ,normal_pars_fragment:MJ,normal_pars_vertex:RJ,normal_vertex:LJ,normalmap_pars_fragment:PJ,clearcoat_normal_fragment_begin:BJ,clearcoat_normal_fragment_maps:DJ,clearcoat_pars_fragment:kJ,iridescence_pars_fragment:FJ,opaque_fragment:OJ,packing:NJ,premultiplied_alpha_fragment:UJ,project_vertex:zJ,dithering_fragment:GJ,dithering_pars_fragment:HJ,roughnessmap_fragment:QJ,roughnessmap_pars_fragment:VJ,shadowmap_pars_fragment:WJ,shadowmap_pars_vertex:jJ,shadowmap_vertex:KJ,shadowmask_pars_fragment:$J,skinbase_vertex:YJ,skinning_pars_vertex:XJ,skinning_vertex:qJ,skinnormal_vertex:JJ,specularmap_fragment:ZJ,specularmap_pars_fragment:eZ,tonemapping_fragment:tZ,tonemapping_pars_fragment:nZ,transmission_fragment:iZ,transmission_pars_fragment:rZ,uv_pars_fragment:sZ,uv_pars_vertex:oZ,uv_vertex:aZ,worldpos_vertex:lZ,background_vert:cZ,background_frag:uZ,backgroundCube_vert:hZ,backgroundCube_frag:fZ,cube_vert:dZ,cube_frag:pZ,depth_vert:mZ,depth_frag:gZ,distanceRGBA_vert:AZ,distanceRGBA_frag:yZ,equirect_vert:vZ,equirect_frag:xZ,linedashed_vert:EZ,linedashed_frag:_Z,meshbasic_vert:SZ,meshbasic_frag:wZ,meshlambert_vert:CZ,meshlambert_frag:TZ,meshmatcap_vert:bZ,meshmatcap_frag:IZ,meshnormal_vert:MZ,meshnormal_frag:RZ,meshphong_vert:LZ,meshphong_frag:PZ,meshphysical_vert:BZ,meshphysical_frag:DZ,meshtoon_vert:kZ,meshtoon_frag:FZ,points_vert:OZ,points_frag:NZ,shadow_vert:UZ,shadow_frag:zZ,sprite_vert:GZ,sprite_frag:HZ},Ot={common:{diffuse:{value:new ut(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new Tn},alphaMap:{value:null},alphaMapTransform:{value:new Tn},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new Tn}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new Tn}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new Tn}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new Tn},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new Tn},normalScale:{value:new Ue(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new Tn},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new Tn}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new Tn}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new Tn}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new ut(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new ut(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new Tn},alphaTest:{value:0},uvTransform:{value:new Tn}},sprite:{diffuse:{value:new ut(16777215)},opacity:{value:1},center:{value:new Ue(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new Tn},alphaMap:{value:null},alphaMapTransform:{value:new Tn},alphaTest:{value:0}}},du={basic:{uniforms:Aa([Ot.common,Ot.specularmap,Ot.envmap,Ot.aomap,Ot.lightmap,Ot.fog]),vertexShader:Un.meshbasic_vert,fragmentShader:Un.meshbasic_frag},lambert:{uniforms:Aa([Ot.common,Ot.specularmap,Ot.envmap,Ot.aomap,Ot.lightmap,Ot.emissivemap,Ot.bumpmap,Ot.normalmap,Ot.displacementmap,Ot.fog,Ot.lights,{emissive:{value:new ut(0)}}]),vertexShader:Un.meshlambert_vert,fragmentShader:Un.meshlambert_frag},phong:{uniforms:Aa([Ot.common,Ot.specularmap,Ot.envmap,Ot.aomap,Ot.lightmap,Ot.emissivemap,Ot.bumpmap,Ot.normalmap,Ot.displacementmap,Ot.fog,Ot.lights,{emissive:{value:new ut(0)},specular:{value:new ut(1118481)},shininess:{value:30}}]),vertexShader:Un.meshphong_vert,fragmentShader:Un.meshphong_frag},standard:{uniforms:Aa([Ot.common,Ot.envmap,Ot.aomap,Ot.lightmap,Ot.emissivemap,Ot.bumpmap,Ot.normalmap,Ot.displacementmap,Ot.roughnessmap,Ot.metalnessmap,Ot.fog,Ot.lights,{emissive:{value:new ut(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Un.meshphysical_vert,fragmentShader:Un.meshphysical_frag},toon:{uniforms:Aa([Ot.common,Ot.aomap,Ot.lightmap,Ot.emissivemap,Ot.bumpmap,Ot.normalmap,Ot.displacementmap,Ot.gradientmap,Ot.fog,Ot.lights,{emissive:{value:new ut(0)}}]),vertexShader:Un.meshtoon_vert,fragmentShader:Un.meshtoon_frag},matcap:{uniforms:Aa([Ot.common,Ot.bumpmap,Ot.normalmap,Ot.displacementmap,Ot.fog,{matcap:{value:null}}]),vertexShader:Un.meshmatcap_vert,fragmentShader:Un.meshmatcap_frag},points:{uniforms:Aa([Ot.points,Ot.fog]),vertexShader:Un.points_vert,fragmentShader:Un.points_frag},dashed:{uniforms:Aa([Ot.common,Ot.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Un.linedashed_vert,fragmentShader:Un.linedashed_frag},depth:{uniforms:Aa([Ot.common,Ot.displacementmap]),vertexShader:Un.depth_vert,fragmentShader:Un.depth_frag},normal:{uniforms:Aa([Ot.common,Ot.bumpmap,Ot.normalmap,Ot.displacementmap,{opacity:{value:1}}]),vertexShader:Un.meshnormal_vert,fragmentShader:Un.meshnormal_frag},sprite:{uniforms:Aa([Ot.sprite,Ot.fog]),vertexShader:Un.sprite_vert,fragmentShader:Un.sprite_frag},background:{uniforms:{uvTransform:{value:new Tn},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:Un.background_vert,fragmentShader:Un.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1}},vertexShader:Un.backgroundCube_vert,fragmentShader:Un.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Un.cube_vert,fragmentShader:Un.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Un.equirect_vert,fragmentShader:Un.equirect_frag},distanceRGBA:{uniforms:Aa([Ot.common,Ot.displacementmap,{referencePosition:{value:new H},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Un.distanceRGBA_vert,fragmentShader:Un.distanceRGBA_frag},shadow:{uniforms:Aa([Ot.lights,Ot.fog,{color:{value:new ut(0)},opacity:{value:1}}]),vertexShader:Un.shadow_vert,fragmentShader:Un.shadow_frag}};du.physical={uniforms:Aa([du.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new Tn},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new Tn},clearcoatNormalScale:{value:new Ue(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new Tn},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new Tn},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new Tn},sheen:{value:0},sheenColor:{value:new ut(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new Tn},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new Tn},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new Tn},transmissionSamplerSize:{value:new Ue},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new Tn},attenuationDistance:{value:0},attenuationColor:{value:new ut(0)},specularColor:{value:new ut(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new Tn},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new Tn},anisotropyVector:{value:new Ue},anisotropyMap:{value:null},anisotropyMapTransform:{value:new Tn}}]),vertexShader:Un.meshphysical_vert,fragmentShader:Un.meshphysical_frag};const KE={r:0,b:0,g:0};function QZ(i,e,t,n,r,s,o){const a=new ut(0);let l=s===!0?0:1,c,u,h=null,f=0,d=null;function m(g,y){let E=!1,x=y.isScene===!0?y.background:null;x&&x.isTexture&&(x=(y.backgroundBlurriness>0?t:e).get(x)),x===null?A(a,l):x&&x.isColor&&(A(x,1),E=!0);const C=i.xr.getEnvironmentBlendMode();C==="additive"?n.buffers.color.setClear(0,0,0,1,o):C==="alpha-blend"&&n.buffers.color.setClear(0,0,0,0,o),(i.autoClear||E)&&i.clear(i.autoClearColor,i.autoClearDepth,i.autoClearStencil),x&&(x.isCubeTexture||x.mapping===vA)?(u===void 0&&(u=new It(new ya(1,1,1),new Mi({name:"BackgroundCubeMaterial",uniforms:eA(du.backgroundCube.uniforms),vertexShader:du.backgroundCube.vertexShader,fragmentShader:du.backgroundCube.fragmentShader,side:ys,depthTest:!1,depthWrite:!1,fog:!1})),u.geometry.deleteAttribute("normal"),u.geometry.deleteAttribute("uv"),u.onBeforeRender=function(T,I,M){this.matrixWorld.copyPosition(M.matrixWorld)},Object.defineProperty(u.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(u)),u.material.uniforms.envMap.value=x,u.material.uniforms.flipEnvMap.value=x.isCubeTexture&&x.isRenderTargetTexture===!1?-1:1,u.material.uniforms.backgroundBlurriness.value=y.backgroundBlurriness,u.material.uniforms.backgroundIntensity.value=y.backgroundIntensity,u.material.toneMapped=Vi.getTransfer(x.colorSpace)!==mr,(h!==x||f!==x.version||d!==i.toneMapping)&&(u.material.needsUpdate=!0,h=x,f=x.version,d=i.toneMapping),u.layers.enableAll(),g.unshift(u,u.geometry,u.material,0,0,null)):x&&x.isTexture&&(c===void 0&&(c=new It(new Fs(2,2),new Mi({name:"BackgroundMaterial",uniforms:eA(du.background.uniforms),vertexShader:du.background.vertexShader,fragmentShader:du.background.fragmentShader,side:tl,depthTest:!1,depthWrite:!1,fog:!1})),c.geometry.deleteAttribute("normal"),Object.defineProperty(c.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(c)),c.material.uniforms.t2D.value=x,c.material.uniforms.backgroundIntensity.value=y.backgroundIntensity,c.material.toneMapped=Vi.getTransfer(x.colorSpace)!==mr,x.matrixAutoUpdate===!0&&x.updateMatrix(),c.material.uniforms.uvTransform.value.copy(x.matrix),(h!==x||f!==x.version||d!==i.toneMapping)&&(c.material.needsUpdate=!0,h=x,f=x.version,d=i.toneMapping),c.layers.enableAll(),g.unshift(c,c.geometry,c.material,0,0,null))}function A(g,y){g.getRGB(KE,OU(i)),n.buffers.color.setClear(KE.r,KE.g,KE.b,y,o)}return{getClearColor:function(){return a},setClearColor:function(g,y=1){a.set(g),l=y,A(a,l)},getClearAlpha:function(){return l},setClearAlpha:function(g){l=g,A(a,l)},render:m}}function VZ(i,e,t,n){const r=i.getParameter(i.MAX_VERTEX_ATTRIBS),s=n.isWebGL2?null:e.get("OES_vertex_array_object"),o=n.isWebGL2||s!==null,a={},l=g(null);let c=l,u=!1;function h(U,W,$,oe,X){let Q=!1;if(o){const Y=A(oe,$,W);c!==Y&&(c=Y,d(c.object)),Q=y(U,oe,$,X),Q&&E(U,oe,$,X)}else{const Y=W.wireframe===!0;(c.geometry!==oe.id||c.program!==$.id||c.wireframe!==Y)&&(c.geometry=oe.id,c.program=$.id,c.wireframe=Y,Q=!0)}X!==null&&t.update(X,i.ELEMENT_ARRAY_BUFFER),(Q||u)&&(u=!1,L(U,W,$,oe),X!==null&&i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,t.get(X).buffer))}function f(){return n.isWebGL2?i.createVertexArray():s.createVertexArrayOES()}function d(U){return n.isWebGL2?i.bindVertexArray(U):s.bindVertexArrayOES(U)}function m(U){return n.isWebGL2?i.deleteVertexArray(U):s.deleteVertexArrayOES(U)}function A(U,W,$){const oe=$.wireframe===!0;let X=a[U.id];X===void 0&&(X={},a[U.id]=X);let Q=X[W.id];Q===void 0&&(Q={},X[W.id]=Q);let Y=Q[oe];return Y===void 0&&(Y=g(f()),Q[oe]=Y),Y}function g(U){const W=[],$=[],oe=[];for(let X=0;X<r;X++)W[X]=0,$[X]=0,oe[X]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:W,enabledAttributes:$,attributeDivisors:oe,object:U,attributes:{},index:null}}function y(U,W,$,oe){const X=c.attributes,Q=W.attributes;let Y=0;const O=$.getAttributes();for(const K in O)if(O[K].location>=0){const q=X[K];let J=Q[K];if(J===void 0&&(K==="instanceMatrix"&&U.instanceMatrix&&(J=U.instanceMatrix),K==="instanceColor"&&U.instanceColor&&(J=U.instanceColor)),q===void 0||q.attribute!==J||J&&q.data!==J.data)return!0;Y++}return c.attributesNum!==Y||c.index!==oe}function E(U,W,$,oe){const X={},Q=W.attributes;let Y=0;const O=$.getAttributes();for(const K in O)if(O[K].location>=0){let q=Q[K];q===void 0&&(K==="instanceMatrix"&&U.instanceMatrix&&(q=U.instanceMatrix),K==="instanceColor"&&U.instanceColor&&(q=U.instanceColor));const J={};J.attribute=q,q&&q.data&&(J.data=q.data),X[K]=J,Y++}c.attributes=X,c.attributesNum=Y,c.index=oe}function x(){const U=c.newAttributes;for(let W=0,$=U.length;W<$;W++)U[W]=0}function C(U){T(U,0)}function T(U,W){const $=c.newAttributes,oe=c.enabledAttributes,X=c.attributeDivisors;$[U]=1,oe[U]===0&&(i.enableVertexAttribArray(U),oe[U]=1),X[U]!==W&&((n.isWebGL2?i:e.get("ANGLE_instanced_arrays"))[n.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](U,W),X[U]=W)}function I(){const U=c.newAttributes,W=c.enabledAttributes;for(let $=0,oe=W.length;$<oe;$++)W[$]!==U[$]&&(i.disableVertexAttribArray($),W[$]=0)}function M(U,W,$,oe,X,Q,Y){Y===!0?i.vertexAttribIPointer(U,W,$,X,Q):i.vertexAttribPointer(U,W,$,oe,X,Q)}function L(U,W,$,oe){if(n.isWebGL2===!1&&(U.isInstancedMesh||oe.isInstancedBufferGeometry)&&e.get("ANGLE_instanced_arrays")===null)return;x();const X=oe.attributes,Q=$.getAttributes(),Y=W.defaultAttributeValues;for(const O in Q){const K=Q[O];if(K.location>=0){let te=X[O];if(te===void 0&&(O==="instanceMatrix"&&U.instanceMatrix&&(te=U.instanceMatrix),O==="instanceColor"&&U.instanceColor&&(te=U.instanceColor)),te!==void 0){const q=te.normalized,J=te.itemSize,ie=t.get(te);if(ie===void 0)continue;const re=ie.buffer,se=ie.type,ge=ie.bytesPerElement,xe=n.isWebGL2===!0&&(se===i.INT||se===i.UNSIGNED_INT||te.gpuType===Nm);if(te.isInterleavedBufferAttribute){const pe=te.data,ce=pe.stride,we=te.offset;if(pe.isInstancedInterleavedBuffer){for(let Ee=0;Ee<K.locationSize;Ee++)T(K.location+Ee,pe.meshPerAttribute);U.isInstancedMesh!==!0&&oe._maxInstanceCount===void 0&&(oe._maxInstanceCount=pe.meshPerAttribute*pe.count)}else for(let Ee=0;Ee<K.locationSize;Ee++)C(K.location+Ee);i.bindBuffer(i.ARRAY_BUFFER,re);for(let Ee=0;Ee<K.locationSize;Ee++)M(K.location+Ee,J/K.locationSize,se,q,ce*ge,(we+J/K.locationSize*Ee)*ge,xe)}else{if(te.isInstancedBufferAttribute){for(let pe=0;pe<K.locationSize;pe++)T(K.location+pe,te.meshPerAttribute);U.isInstancedMesh!==!0&&oe._maxInstanceCount===void 0&&(oe._maxInstanceCount=te.meshPerAttribute*te.count)}else for(let pe=0;pe<K.locationSize;pe++)C(K.location+pe);i.bindBuffer(i.ARRAY_BUFFER,re);for(let pe=0;pe<K.locationSize;pe++)M(K.location+pe,J/K.locationSize,se,q,J*ge,J/K.locationSize*pe*ge,xe)}}else if(Y!==void 0){const q=Y[O];if(q!==void 0)switch(q.length){case 2:i.vertexAttrib2fv(K.location,q);break;case 3:i.vertexAttrib3fv(K.location,q);break;case 4:i.vertexAttrib4fv(K.location,q);break;default:i.vertexAttrib1fv(K.location,q)}}}}I()}function R(){k();for(const U in a){const W=a[U];for(const $ in W){const oe=W[$];for(const X in oe)m(oe[X].object),delete oe[X];delete W[$]}delete a[U]}}function P(U){if(a[U.id]===void 0)return;const W=a[U.id];for(const $ in W){const oe=W[$];for(const X in oe)m(oe[X].object),delete oe[X];delete W[$]}delete a[U.id]}function F(U){for(const W in a){const $=a[W];if($[U.id]===void 0)continue;const oe=$[U.id];for(const X in oe)m(oe[X].object),delete oe[X];delete $[U.id]}}function k(){z(),u=!0,c!==l&&(c=l,d(c.object))}function z(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:h,reset:k,resetDefaultState:z,dispose:R,releaseStatesOfGeometry:P,releaseStatesOfProgram:F,initAttributes:x,enableAttribute:C,disableUnusedAttributes:I}}function WZ(i,e,t,n){const r=n.isWebGL2;let s;function o(u){s=u}function a(u,h){i.drawArrays(s,u,h),t.update(h,s,1)}function l(u,h,f){if(f===0)return;let d,m;if(r)d=i,m="drawArraysInstanced";else if(d=e.get("ANGLE_instanced_arrays"),m="drawArraysInstancedANGLE",d===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}d[m](s,u,h,f),t.update(h,s,f)}function c(u,h,f){if(f===0)return;const d=e.get("WEBGL_multi_draw");if(d===null)for(let m=0;m<f;m++)this.render(u[m],h[m]);else{d.multiDrawArraysWEBGL(s,u,0,h,0,f);let m=0;for(let A=0;A<f;A++)m+=h[A];t.update(m,s,1)}}this.setMode=o,this.render=a,this.renderInstances=l,this.renderMultiDraw=c}function jZ(i,e,t){let n;function r(){if(n!==void 0)return n;if(e.has("EXT_texture_filter_anisotropic")===!0){const M=e.get("EXT_texture_filter_anisotropic");n=i.getParameter(M.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else n=0;return n}function s(M){if(M==="highp"){if(i.getShaderPrecisionFormat(i.VERTEX_SHADER,i.HIGH_FLOAT).precision>0&&i.getShaderPrecisionFormat(i.FRAGMENT_SHADER,i.HIGH_FLOAT).precision>0)return"highp";M="mediump"}return M==="mediump"&&i.getShaderPrecisionFormat(i.VERTEX_SHADER,i.MEDIUM_FLOAT).precision>0&&i.getShaderPrecisionFormat(i.FRAGMENT_SHADER,i.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}const o=typeof WebGL2RenderingContext<"u"&&i.constructor.name==="WebGL2RenderingContext";let a=t.precision!==void 0?t.precision:"highp";const l=s(a);l!==a&&(console.warn("THREE.WebGLRenderer:",a,"not supported, using",l,"instead."),a=l);const c=o||e.has("WEBGL_draw_buffers"),u=t.logarithmicDepthBuffer===!0,h=i.getParameter(i.MAX_TEXTURE_IMAGE_UNITS),f=i.getParameter(i.MAX_VERTEX_TEXTURE_IMAGE_UNITS),d=i.getParameter(i.MAX_TEXTURE_SIZE),m=i.getParameter(i.MAX_CUBE_MAP_TEXTURE_SIZE),A=i.getParameter(i.MAX_VERTEX_ATTRIBS),g=i.getParameter(i.MAX_VERTEX_UNIFORM_VECTORS),y=i.getParameter(i.MAX_VARYING_VECTORS),E=i.getParameter(i.MAX_FRAGMENT_UNIFORM_VECTORS),x=f>0,C=o||e.has("OES_texture_float"),T=x&&C,I=o?i.getParameter(i.MAX_SAMPLES):0;return{isWebGL2:o,drawBuffers:c,getMaxAnisotropy:r,getMaxPrecision:s,precision:a,logarithmicDepthBuffer:u,maxTextures:h,maxVertexTextures:f,maxTextureSize:d,maxCubemapSize:m,maxAttributes:A,maxVertexUniforms:g,maxVaryings:y,maxFragmentUniforms:E,vertexTextures:x,floatFragmentTextures:C,floatVertexTextures:T,maxSamples:I}}function KZ(i){const e=this;let t=null,n=0,r=!1,s=!1;const o=new vo,a=new Tn,l={value:null,needsUpdate:!1};this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(h,f){const d=h.length!==0||f||n!==0||r;return r=f,n=h.length,d},this.beginShadows=function(){s=!0,u(null)},this.endShadows=function(){s=!1},this.setGlobalState=function(h,f){t=u(h,f,0)},this.setState=function(h,f,d){const m=h.clippingPlanes,A=h.clipIntersection,g=h.clipShadows,y=i.get(h);if(!r||m===null||m.length===0||s&&!g)s?u(null):c();else{const E=s?0:n,x=E*4;let C=y.clippingState||null;l.value=C,C=u(m,f,x,d);for(let T=0;T!==x;++T)C[T]=t[T];y.clippingState=C,this.numIntersection=A?this.numPlanes:0,this.numPlanes+=E}};function c(){l.value!==t&&(l.value=t,l.needsUpdate=n>0),e.numPlanes=n,e.numIntersection=0}function u(h,f,d,m){const A=h!==null?h.length:0;let g=null;if(A!==0){if(g=l.value,m!==!0||g===null){const y=d+A*4,E=f.matrixWorldInverse;a.getNormalMatrix(E),(g===null||g.length<y)&&(g=new Float32Array(y));for(let x=0,C=d;x!==A;++x,C+=4)o.copy(h[x]).applyMatrix4(E,a),o.normal.toArray(g,C),g[C+3]=o.constant}l.value=g,l.needsUpdate=!0}return e.numPlanes=A,e.numIntersection=0,g}}function $Z(i){let e=new WeakMap;function t(o,a){return a===Ym?o.mapping=_u:a===v2&&(o.mapping=ip),o}function n(o){if(o&&o.isTexture){const a=o.mapping;if(a===Ym||a===v2)if(e.has(o)){const l=e.get(o).texture;return t(l,o.mapping)}else{const l=o.image;if(l&&l.height>0){const c=new xA(l.height/2);return c.fromEquirectangularTexture(i,o),e.set(o,c),o.addEventListener("dispose",r),t(c.texture,o.mapping)}else return null}}return o}function r(o){const a=o.target;a.removeEventListener("dispose",r);const l=e.get(a);l!==void 0&&(e.delete(a),l.dispose())}function s(){e=new WeakMap}return{get:n,dispose:s}}let qi=class extends u0{constructor(e=-1,t=1,n=1,r=-1,s=.1,o=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=n,this.bottom=r,this.near=s,this.far=o,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,n,r,s,o){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=s,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,r=(this.top+this.bottom)/2;let s=n-e,o=n+e,a=r+t,l=r-t;if(this.view!==null&&this.view.enabled){const c=(this.right-this.left)/this.view.fullWidth/this.zoom,u=(this.top-this.bottom)/this.view.fullHeight/this.zoom;s+=c*this.view.offsetX,o=s+c*this.view.width,a-=u*this.view.offsetY,l=a-u*this.view.height}this.projectionMatrix.makeOrthographic(s,o,a,l,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}};const b1=4,vP=[.125,.215,.35,.446,.526,.582],Tm=20,iT=new qi,xP=new ut;let rT=null,sT=0,oT=0;const Sm=(1+Math.sqrt(5))/2,wg=1/Sm,EP=[new H(1,1,1),new H(-1,1,1),new H(1,1,-1),new H(-1,1,-1),new H(0,Sm,wg),new H(0,Sm,-wg),new H(wg,0,Sm),new H(-wg,0,Sm),new H(Sm,wg,0),new H(-Sm,wg,0)];class CM{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,n=.1,r=100){rT=this._renderer.getRenderTarget(),sT=this._renderer.getActiveCubeFace(),oT=this._renderer.getActiveMipmapLevel(),this._setSize(256);const s=this._allocateTargets();return s.depthBuffer=!0,this._sceneToCubeUV(e,n,r,s),t>0&&this._blur(s,0,0,t),this._applyPMREM(s),this._cleanup(s),s}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=wP(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=SP(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(rT,sT,oT),e.scissorTest=!1,$E(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===_u||e.mapping===ip?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),rT=this._renderer.getRenderTarget(),sT=this._renderer.getActiveCubeFace(),oT=this._renderer.getActiveMipmapLevel();const n=t||this._allocateTargets();return this._textureToCubeUV(e,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,n={magFilter:Pn,minFilter:Pn,generateMipmaps:!1,type:Ni,format:gi,colorSpace:Dl,depthBuffer:!1},r=_P(e,t,n);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=_P(e,t,n);const{_lodMax:s}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=YZ(s)),this._blurMaterial=XZ(s,e,t)}return r}_compileMaterial(e){const t=new It(this._lodPlanes[0],e);this._renderer.compile(t,iT)}_sceneToCubeUV(e,t,n,r){const a=new Wn(90,1,t,n),l=[1,-1,1,1,1,1],c=[1,1,1,-1,-1,-1],u=this._renderer,h=u.autoClear,f=u.toneMapping;u.getClearColor(xP),u.toneMapping=yu,u.autoClear=!1;const d=new no({name:"PMREM.Background",side:ys,depthWrite:!1,depthTest:!1}),m=new It(new ya,d);let A=!1;const g=e.background;g?g.isColor&&(d.color.copy(g),e.background=null,A=!0):(d.color.copy(xP),A=!0);for(let y=0;y<6;y++){const E=y%3;E===0?(a.up.set(0,l[y],0),a.lookAt(c[y],0,0)):E===1?(a.up.set(0,0,l[y]),a.lookAt(0,c[y],0)):(a.up.set(0,l[y],0),a.lookAt(0,0,c[y]));const x=this._cubeSize;$E(r,E*x,y>2?x:0,x,x),u.setRenderTarget(r),A&&u.render(m,a),u.render(e,a)}m.geometry.dispose(),m.material.dispose(),u.toneMapping=f,u.autoClear=h,e.background=g}_textureToCubeUV(e,t){const n=this._renderer,r=e.mapping===_u||e.mapping===ip;r?(this._cubemapMaterial===null&&(this._cubemapMaterial=wP()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=SP());const s=r?this._cubemapMaterial:this._equirectMaterial,o=new It(this._lodPlanes[0],s),a=s.uniforms;a.envMap.value=e;const l=this._cubeSize;$E(t,0,0,3*l,2*l),n.setRenderTarget(t),n.render(o,iT)}_applyPMREM(e){const t=this._renderer,n=t.autoClear;t.autoClear=!1;for(let r=1;r<this._lodPlanes.length;r++){const s=Math.sqrt(this._sigmas[r]*this._sigmas[r]-this._sigmas[r-1]*this._sigmas[r-1]),o=EP[(r-1)%EP.length];this._blur(e,r-1,r,s,o)}t.autoClear=n}_blur(e,t,n,r,s){const o=this._pingPongRenderTarget;this._halfBlur(e,o,t,n,r,"latitudinal",s),this._halfBlur(o,e,n,n,r,"longitudinal",s)}_halfBlur(e,t,n,r,s,o,a){const l=this._renderer,c=this._blurMaterial;o!=="latitudinal"&&o!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const u=3,h=new It(this._lodPlanes[r],c),f=c.uniforms,d=this._sizeLods[n]-1,m=isFinite(s)?Math.PI/(2*d):2*Math.PI/(2*Tm-1),A=s/m,g=isFinite(s)?1+Math.floor(u*A):Tm;g>Tm&&console.warn(`sigmaRadians, ${s}, is too large and will clip, as it requested ${g} samples when the maximum is set to ${Tm}`);const y=[];let E=0;for(let M=0;M<Tm;++M){const L=M/A,R=Math.exp(-L*L/2);y.push(R),M===0?E+=R:M<g&&(E+=2*R)}for(let M=0;M<y.length;M++)y[M]=y[M]/E;f.envMap.value=e.texture,f.samples.value=g,f.weights.value=y,f.latitudinal.value=o==="latitudinal",a&&(f.poleAxis.value=a);const{_lodMax:x}=this;f.dTheta.value=m,f.mipInt.value=x-n;const C=this._sizeLods[r],T=3*C*(r>x-b1?r-x+b1:0),I=4*(this._cubeSize-C);$E(t,T,I,3*C,2*C),l.setRenderTarget(t),l.render(h,iT)}}function YZ(i){const e=[],t=[],n=[];let r=i;const s=i-b1+1+vP.length;for(let o=0;o<s;o++){const a=Math.pow(2,r);t.push(a);let l=1/a;o>i-b1?l=vP[o-i+b1-1]:o===0&&(l=0),n.push(l);const c=1/(a-2),u=-c,h=1+c,f=[u,u,h,u,h,h,u,u,h,h,u,h],d=6,m=6,A=3,g=2,y=1,E=new Float32Array(A*m*d),x=new Float32Array(g*m*d),C=new Float32Array(y*m*d);for(let I=0;I<d;I++){const M=I%3*2/3-1,L=I>2?0:-1,R=[M,L,0,M+2/3,L,0,M+2/3,L+1,0,M,L,0,M+2/3,L+1,0,M,L+1,0];E.set(R,A*m*I),x.set(f,g*m*I);const P=[I,I,I,I,I,I];C.set(P,y*m*I)}const T=new fn;T.setAttribute("position",new mn(E,A)),T.setAttribute("uv",new mn(x,g)),T.setAttribute("faceIndex",new mn(C,y)),e.push(T),r>b1&&r--}return{lodPlanes:e,sizeLods:t,sigmas:n}}function _P(i,e,t){const n=new Si(i,e,t);return n.texture.mapping=vA,n.texture.name="PMREM.cubeUv",n.scissorTest=!0,n}function $E(i,e,t,n,r){i.viewport.set(e,t,n,r),i.scissor.set(e,t,n,r)}function XZ(i,e,t){const n=new Float32Array(Tm),r=new H(0,1,0);return new Mi({name:"SphericalGaussianBlur",defines:{n:Tm,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:`${i}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:n},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:r}},vertexShader:w6(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:gc,depthTest:!1,depthWrite:!1})}function SP(){return new Mi({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:w6(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:gc,depthTest:!1,depthWrite:!1})}function wP(){return new Mi({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:w6(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:gc,depthTest:!1,depthWrite:!1})}function w6(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function qZ(i){let e=new WeakMap,t=null;function n(a){if(a&&a.isTexture){const l=a.mapping,c=l===Ym||l===v2,u=l===_u||l===ip;if(c||u)if(a.isRenderTargetTexture&&a.needsPMREMUpdate===!0){a.needsPMREMUpdate=!1;let h=e.get(a);return t===null&&(t=new CM(i)),h=c?t.fromEquirectangular(a,h):t.fromCubemap(a,h),e.set(a,h),h.texture}else{if(e.has(a))return e.get(a).texture;{const h=a.image;if(c&&h&&h.height>0||u&&h&&r(h)){t===null&&(t=new CM(i));const f=c?t.fromEquirectangular(a):t.fromCubemap(a);return e.set(a,f),a.addEventListener("dispose",s),f.texture}else return null}}}return a}function r(a){let l=0;const c=6;for(let u=0;u<c;u++)a[u]!==void 0&&l++;return l===c}function s(a){const l=a.target;l.removeEventListener("dispose",s);const c=e.get(l);c!==void 0&&(e.delete(l),c.dispose())}function o(){e=new WeakMap,t!==null&&(t.dispose(),t=null)}return{get:n,dispose:o}}function JZ(i){const e={};function t(n){if(e[n]!==void 0)return e[n];let r;switch(n){case"WEBGL_depth_texture":r=i.getExtension("WEBGL_depth_texture")||i.getExtension("MOZ_WEBGL_depth_texture")||i.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=i.getExtension("EXT_texture_filter_anisotropic")||i.getExtension("MOZ_EXT_texture_filter_anisotropic")||i.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=i.getExtension("WEBGL_compressed_texture_s3tc")||i.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||i.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=i.getExtension("WEBGL_compressed_texture_pvrtc")||i.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=i.getExtension(n)}return e[n]=r,r}return{has:function(n){return t(n)!==null},init:function(n){n.isWebGL2?(t("EXT_color_buffer_float"),t("WEBGL_clip_cull_distance")):(t("WEBGL_depth_texture"),t("OES_texture_float"),t("OES_texture_half_float"),t("OES_texture_half_float_linear"),t("OES_standard_derivatives"),t("OES_element_index_uint"),t("OES_vertex_array_object"),t("ANGLE_instanced_arrays")),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float"),t("WEBGL_multisampled_render_to_texture")},get:function(n){const r=t(n);return r===null&&console.warn("THREE.WebGLRenderer: "+n+" extension not supported."),r}}}function ZZ(i,e,t,n){const r={},s=new WeakMap;function o(h){const f=h.target;f.index!==null&&e.remove(f.index);for(const m in f.attributes)e.remove(f.attributes[m]);for(const m in f.morphAttributes){const A=f.morphAttributes[m];for(let g=0,y=A.length;g<y;g++)e.remove(A[g])}f.removeEventListener("dispose",o),delete r[f.id];const d=s.get(f);d&&(e.remove(d),s.delete(f)),n.releaseStatesOfGeometry(f),f.isInstancedBufferGeometry===!0&&delete f._maxInstanceCount,t.memory.geometries--}function a(h,f){return r[f.id]===!0||(f.addEventListener("dispose",o),r[f.id]=!0,t.memory.geometries++),f}function l(h){const f=h.attributes;for(const m in f)e.update(f[m],i.ARRAY_BUFFER);const d=h.morphAttributes;for(const m in d){const A=d[m];for(let g=0,y=A.length;g<y;g++)e.update(A[g],i.ARRAY_BUFFER)}}function c(h){const f=[],d=h.index,m=h.attributes.position;let A=0;if(d!==null){const E=d.array;A=d.version;for(let x=0,C=E.length;x<C;x+=3){const T=E[x+0],I=E[x+1],M=E[x+2];f.push(T,I,I,M,M,T)}}else if(m!==void 0){const E=m.array;A=m.version;for(let x=0,C=E.length/3-1;x<C;x+=3){const T=x+0,I=x+1,M=x+2;f.push(T,I,I,M,M,T)}}else return;const g=new(BU(f)?S6:ww)(f,1);g.version=A;const y=s.get(h);y&&e.remove(y),s.set(h,g)}function u(h){const f=s.get(h);if(f){const d=h.index;d!==null&&f.version<d.version&&c(h)}else c(h);return s.get(h)}return{get:a,update:l,getWireframeAttribute:u}}function eee(i,e,t,n){const r=n.isWebGL2;let s;function o(d){s=d}let a,l;function c(d){a=d.type,l=d.bytesPerElement}function u(d,m){i.drawElements(s,m,a,d*l),t.update(m,s,1)}function h(d,m,A){if(A===0)return;let g,y;if(r)g=i,y="drawElementsInstanced";else if(g=e.get("ANGLE_instanced_arrays"),y="drawElementsInstancedANGLE",g===null){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}g[y](s,m,a,d*l,A),t.update(m,s,A)}function f(d,m,A){if(A===0)return;const g=e.get("WEBGL_multi_draw");if(g===null)for(let y=0;y<A;y++)this.render(d[y]/l,m[y]);else{g.multiDrawElementsWEBGL(s,m,0,a,d,0,A);let y=0;for(let E=0;E<A;E++)y+=m[E];t.update(y,s,1)}}this.setMode=o,this.setIndex=c,this.render=u,this.renderInstances=h,this.renderMultiDraw=f}function tee(i){const e={geometries:0,textures:0},t={frame:0,calls:0,triangles:0,points:0,lines:0};function n(s,o,a){switch(t.calls++,o){case i.TRIANGLES:t.triangles+=a*(s/3);break;case i.LINES:t.lines+=a*(s/2);break;case i.LINE_STRIP:t.lines+=a*(s-1);break;case i.LINE_LOOP:t.lines+=a*s;break;case i.POINTS:t.points+=a*s;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",o);break}}function r(){t.calls=0,t.triangles=0,t.points=0,t.lines=0}return{memory:e,render:t,programs:null,autoReset:!0,reset:r,update:n}}function nee(i,e){return i[0]-e[0]}function iee(i,e){return Math.abs(e[1])-Math.abs(i[1])}function ree(i,e,t){const n={},r=new Float32Array(8),s=new WeakMap,o=new Rn,a=[];for(let c=0;c<8;c++)a[c]=[c,0];function l(c,u,h){const f=c.morphTargetInfluences;if(e.isWebGL2===!0){const d=u.morphAttributes.position||u.morphAttributes.normal||u.morphAttributes.color,m=d!==void 0?d.length:0;let A=s.get(u);if(A===void 0||A.count!==m){let U=function(){k.dispose(),s.delete(u),u.removeEventListener("dispose",U)};A!==void 0&&A.texture.dispose();const E=u.morphAttributes.position!==void 0,x=u.morphAttributes.normal!==void 0,C=u.morphAttributes.color!==void 0,T=u.morphAttributes.position||[],I=u.morphAttributes.normal||[],M=u.morphAttributes.color||[];let L=0;E===!0&&(L=1),x===!0&&(L=2),C===!0&&(L=3);let R=u.attributes.position.count*L,P=1;R>e.maxTextureSize&&(P=Math.ceil(R/e.maxTextureSize),R=e.maxTextureSize);const F=new Float32Array(R*P*4*m),k=new Sw(F,R,P,m);k.type=fi,k.needsUpdate=!0;const z=L*4;for(let W=0;W<m;W++){const $=T[W],oe=I[W],X=M[W],Q=R*P*4*W;for(let Y=0;Y<$.count;Y++){const O=Y*z;E===!0&&(o.fromBufferAttribute($,Y),F[Q+O+0]=o.x,F[Q+O+1]=o.y,F[Q+O+2]=o.z,F[Q+O+3]=0),x===!0&&(o.fromBufferAttribute(oe,Y),F[Q+O+4]=o.x,F[Q+O+5]=o.y,F[Q+O+6]=o.z,F[Q+O+7]=0),C===!0&&(o.fromBufferAttribute(X,Y),F[Q+O+8]=o.x,F[Q+O+9]=o.y,F[Q+O+10]=o.z,F[Q+O+11]=X.itemSize===4?o.w:1)}}A={count:m,texture:k,size:new Ue(R,P)},s.set(u,A),u.addEventListener("dispose",U)}let g=0;for(let E=0;E<f.length;E++)g+=f[E];const y=u.morphTargetsRelative?1:1-g;h.getUniforms().setValue(i,"morphTargetBaseInfluence",y),h.getUniforms().setValue(i,"morphTargetInfluences",f),h.getUniforms().setValue(i,"morphTargetsTexture",A.texture,t),h.getUniforms().setValue(i,"morphTargetsTextureSize",A.size)}else{const d=f===void 0?0:f.length;let m=n[u.id];if(m===void 0||m.length!==d){m=[];for(let x=0;x<d;x++)m[x]=[x,0];n[u.id]=m}for(let x=0;x<d;x++){const C=m[x];C[0]=x,C[1]=f[x]}m.sort(iee);for(let x=0;x<8;x++)x<d&&m[x][1]?(a[x][0]=m[x][0],a[x][1]=m[x][1]):(a[x][0]=Number.MAX_SAFE_INTEGER,a[x][1]=0);a.sort(nee);const A=u.morphAttributes.position,g=u.morphAttributes.normal;let y=0;for(let x=0;x<8;x++){const C=a[x],T=C[0],I=C[1];T!==Number.MAX_SAFE_INTEGER&&I?(A&&u.getAttribute("morphTarget"+x)!==A[T]&&u.setAttribute("morphTarget"+x,A[T]),g&&u.getAttribute("morphNormal"+x)!==g[T]&&u.setAttribute("morphNormal"+x,g[T]),r[x]=I,y+=I):(A&&u.hasAttribute("morphTarget"+x)===!0&&u.deleteAttribute("morphTarget"+x),g&&u.hasAttribute("morphNormal"+x)===!0&&u.deleteAttribute("morphNormal"+x),r[x]=0)}const E=u.morphTargetsRelative?1:1-y;h.getUniforms().setValue(i,"morphTargetBaseInfluence",E),h.getUniforms().setValue(i,"morphTargetInfluences",r)}}return{update:l}}function see(i,e,t,n){let r=new WeakMap;function s(l){const c=n.render.frame,u=l.geometry,h=e.get(l,u);if(r.get(h)!==c&&(e.update(h),r.set(h,c)),l.isInstancedMesh&&(l.hasEventListener("dispose",a)===!1&&l.addEventListener("dispose",a),r.get(l)!==c&&(t.update(l.instanceMatrix,i.ARRAY_BUFFER),l.instanceColor!==null&&t.update(l.instanceColor,i.ARRAY_BUFFER),r.set(l,c))),l.isSkinnedMesh){const f=l.skeleton;r.get(f)!==c&&(f.update(),r.set(f,c))}return h}function o(){r=new WeakMap}function a(l){const c=l.target;c.removeEventListener("dispose",a),t.remove(c.instanceMatrix),c.instanceColor!==null&&t.remove(c.instanceColor)}return{update:s,dispose:o}}class f0 extends vi{constructor(e,t,n,r,s,o,a,l,c,u){if(u=u!==void 0?u:vu,u!==vu&&u!==Xm)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");n===void 0&&u===vu&&(n=Zo),n===void 0&&u===Xm&&(n=$d),super(null,r,s,o,a,l,u,n,c),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=a!==void 0?a:zn,this.minFilter=l!==void 0?l:zn,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return this.compareFunction!==null&&(t.compareFunction=this.compareFunction),t}}const UU=new vi,zU=new f0(1,1);zU.compareFunction=v6;const GU=new Sw,HU=new _6,QU=new ix,CP=[],TP=[],bP=new Float32Array(16),IP=new Float32Array(9),MP=new Float32Array(4);function EA(i,e,t){const n=i[0];if(n<=0||n>0)return i;const r=e*t;let s=CP[r];if(s===void 0&&(s=new Float32Array(r),CP[r]=s),e!==0){n.toArray(s,0);for(let o=1,a=0;o!==e;++o)a+=t,i[o].toArray(s,a)}return s}function so(i,e){if(i.length!==e.length)return!1;for(let t=0,n=i.length;t<n;t++)if(i[t]!==e[t])return!1;return!0}function oo(i,e){for(let t=0,n=e.length;t<n;t++)i[t]=e[t]}function Tw(i,e){let t=TP[e];t===void 0&&(t=new Int32Array(e),TP[e]=t);for(let n=0;n!==e;++n)t[n]=i.allocateTextureUnit();return t}function oee(i,e){const t=this.cache;t[0]!==e&&(i.uniform1f(this.addr,e),t[0]=e)}function aee(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(i.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(so(t,e))return;i.uniform2fv(this.addr,e),oo(t,e)}}function lee(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(i.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(e.r!==void 0)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(i.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(so(t,e))return;i.uniform3fv(this.addr,e),oo(t,e)}}function cee(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(i.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(so(t,e))return;i.uniform4fv(this.addr,e),oo(t,e)}}function uee(i,e){const t=this.cache,n=e.elements;if(n===void 0){if(so(t,e))return;i.uniformMatrix2fv(this.addr,!1,e),oo(t,e)}else{if(so(t,n))return;MP.set(n),i.uniformMatrix2fv(this.addr,!1,MP),oo(t,n)}}function hee(i,e){const t=this.cache,n=e.elements;if(n===void 0){if(so(t,e))return;i.uniformMatrix3fv(this.addr,!1,e),oo(t,e)}else{if(so(t,n))return;IP.set(n),i.uniformMatrix3fv(this.addr,!1,IP),oo(t,n)}}function fee(i,e){const t=this.cache,n=e.elements;if(n===void 0){if(so(t,e))return;i.uniformMatrix4fv(this.addr,!1,e),oo(t,e)}else{if(so(t,n))return;bP.set(n),i.uniformMatrix4fv(this.addr,!1,bP),oo(t,n)}}function dee(i,e){const t=this.cache;t[0]!==e&&(i.uniform1i(this.addr,e),t[0]=e)}function pee(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(i.uniform2i(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(so(t,e))return;i.uniform2iv(this.addr,e),oo(t,e)}}function mee(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(i.uniform3i(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(so(t,e))return;i.uniform3iv(this.addr,e),oo(t,e)}}function gee(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(i.uniform4i(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(so(t,e))return;i.uniform4iv(this.addr,e),oo(t,e)}}function Aee(i,e){const t=this.cache;t[0]!==e&&(i.uniform1ui(this.addr,e),t[0]=e)}function yee(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(i.uniform2ui(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(so(t,e))return;i.uniform2uiv(this.addr,e),oo(t,e)}}function vee(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(i.uniform3ui(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(so(t,e))return;i.uniform3uiv(this.addr,e),oo(t,e)}}function xee(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(i.uniform4ui(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(so(t,e))return;i.uniform4uiv(this.addr,e),oo(t,e)}}function Eee(i,e,t){const n=this.cache,r=t.allocateTextureUnit();n[0]!==r&&(i.uniform1i(this.addr,r),n[0]=r);const s=this.type===i.SAMPLER_2D_SHADOW?zU:UU;t.setTexture2D(e||s,r)}function _ee(i,e,t){const n=this.cache,r=t.allocateTextureUnit();n[0]!==r&&(i.uniform1i(this.addr,r),n[0]=r),t.setTexture3D(e||HU,r)}function See(i,e,t){const n=this.cache,r=t.allocateTextureUnit();n[0]!==r&&(i.uniform1i(this.addr,r),n[0]=r),t.setTextureCube(e||QU,r)}function wee(i,e,t){const n=this.cache,r=t.allocateTextureUnit();n[0]!==r&&(i.uniform1i(this.addr,r),n[0]=r),t.setTexture2DArray(e||GU,r)}function Cee(i){switch(i){case 5126:return oee;case 35664:return aee;case 35665:return lee;case 35666:return cee;case 35674:return uee;case 35675:return hee;case 35676:return fee;case 5124:case 35670:return dee;case 35667:case 35671:return pee;case 35668:case 35672:return mee;case 35669:case 35673:return gee;case 5125:return Aee;case 36294:return yee;case 36295:return vee;case 36296:return xee;case 35678:case 36198:case 36298:case 36306:case 35682:return Eee;case 35679:case 36299:case 36307:return _ee;case 35680:case 36300:case 36308:case 36293:return See;case 36289:case 36303:case 36311:case 36292:return wee}}function Tee(i,e){i.uniform1fv(this.addr,e)}function bee(i,e){const t=EA(e,this.size,2);i.uniform2fv(this.addr,t)}function Iee(i,e){const t=EA(e,this.size,3);i.uniform3fv(this.addr,t)}function Mee(i,e){const t=EA(e,this.size,4);i.uniform4fv(this.addr,t)}function Ree(i,e){const t=EA(e,this.size,4);i.uniformMatrix2fv(this.addr,!1,t)}function Lee(i,e){const t=EA(e,this.size,9);i.uniformMatrix3fv(this.addr,!1,t)}function Pee(i,e){const t=EA(e,this.size,16);i.uniformMatrix4fv(this.addr,!1,t)}function Bee(i,e){i.uniform1iv(this.addr,e)}function Dee(i,e){i.uniform2iv(this.addr,e)}function kee(i,e){i.uniform3iv(this.addr,e)}function Fee(i,e){i.uniform4iv(this.addr,e)}function Oee(i,e){i.uniform1uiv(this.addr,e)}function Nee(i,e){i.uniform2uiv(this.addr,e)}function Uee(i,e){i.uniform3uiv(this.addr,e)}function zee(i,e){i.uniform4uiv(this.addr,e)}function Gee(i,e,t){const n=this.cache,r=e.length,s=Tw(t,r);so(n,s)||(i.uniform1iv(this.addr,s),oo(n,s));for(let o=0;o!==r;++o)t.setTexture2D(e[o]||UU,s[o])}function Hee(i,e,t){const n=this.cache,r=e.length,s=Tw(t,r);so(n,s)||(i.uniform1iv(this.addr,s),oo(n,s));for(let o=0;o!==r;++o)t.setTexture3D(e[o]||HU,s[o])}function Qee(i,e,t){const n=this.cache,r=e.length,s=Tw(t,r);so(n,s)||(i.uniform1iv(this.addr,s),oo(n,s));for(let o=0;o!==r;++o)t.setTextureCube(e[o]||QU,s[o])}function Vee(i,e,t){const n=this.cache,r=e.length,s=Tw(t,r);so(n,s)||(i.uniform1iv(this.addr,s),oo(n,s));for(let o=0;o!==r;++o)t.setTexture2DArray(e[o]||GU,s[o])}function Wee(i){switch(i){case 5126:return Tee;case 35664:return bee;case 35665:return Iee;case 35666:return Mee;case 35674:return Ree;case 35675:return Lee;case 35676:return Pee;case 5124:case 35670:return Bee;case 35667:case 35671:return Dee;case 35668:case 35672:return kee;case 35669:case 35673:return Fee;case 5125:return Oee;case 36294:return Nee;case 36295:return Uee;case 36296:return zee;case 35678:case 36198:case 36298:case 36306:case 35682:return Gee;case 35679:case 36299:case 36307:return Hee;case 35680:case 36300:case 36308:case 36293:return Qee;case 36289:case 36303:case 36311:case 36292:return Vee}}class jee{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.type=t.type,this.setValue=Cee(t.type)}}class Kee{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.type=t.type,this.size=t.size,this.setValue=Wee(t.type)}}class $ee{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,n){const r=this.seq;for(let s=0,o=r.length;s!==o;++s){const a=r[s];a.setValue(e,t[a.id],n)}}}const aT=/(\w+)(\])?(\[|\.)?/g;function RP(i,e){i.seq.push(e),i.map[e.id]=e}function Yee(i,e,t){const n=i.name,r=n.length;for(aT.lastIndex=0;;){const s=aT.exec(n),o=aT.lastIndex;let a=s[1];const l=s[2]==="]",c=s[3];if(l&&(a=a|0),c===void 0||c==="["&&o+2===r){RP(t,c===void 0?new jee(a,i,e):new Kee(a,i,e));break}else{let h=t.map[a];h===void 0&&(h=new $ee(a),RP(t,h)),t=h}}}class W_{constructor(e,t){this.seq=[],this.map={};const n=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let r=0;r<n;++r){const s=e.getActiveUniform(t,r),o=e.getUniformLocation(t,s.name);Yee(s,o,this)}}setValue(e,t,n,r){const s=this.map[t];s!==void 0&&s.setValue(e,n,r)}setOptional(e,t,n){const r=t[n];r!==void 0&&this.setValue(e,n,r)}static upload(e,t,n,r){for(let s=0,o=t.length;s!==o;++s){const a=t[s],l=n[a.id];l.needsUpdate!==!1&&a.setValue(e,l.value,r)}}static seqWithValue(e,t){const n=[];for(let r=0,s=e.length;r!==s;++r){const o=e[r];o.id in t&&n.push(o)}return n}}function LP(i,e,t){const n=i.createShader(e);return i.shaderSource(n,t),i.compileShader(n),n}const Xee=37297;let qee=0;function Jee(i,e){const t=i.split(`
`),n=[],r=Math.max(e-6,0),s=Math.min(e+6,t.length);for(let o=r;o<s;o++){const a=o+1;n.push(`${a===e?">":" "} ${a}: ${t[o]}`)}return n.join(`
`)}function Zee(i){const e=Vi.getPrimaries(Vi.workingColorSpace),t=Vi.getPrimaries(i);let n;switch(e===t?n="":e===T2&&t===C2?n="LinearDisplayP3ToLinearSRGB":e===C2&&t===T2&&(n="LinearSRGBToLinearDisplayP3"),i){case Dl:case nx:return[n,"LinearTransferOETF"];case gs:case _w:return[n,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space:",i),[n,"LinearTransferOETF"]}}function PP(i,e,t){const n=i.getShaderParameter(e,i.COMPILE_STATUS),r=i.getShaderInfoLog(e).trim();if(n&&r==="")return"";const s=/ERROR: 0:(\d+)/.exec(r);if(s){const o=parseInt(s[1]);return t.toUpperCase()+`

`+r+`

`+Jee(i.getShaderSource(e),o)}else return r}function ete(i,e){const t=Zee(e);return`vec4 ${i}( vec4 value ) { return ${t[0]}( ${t[1]}( value ) ); }`}function tte(i,e){let t;switch(e){case lU:t="Linear";break;case cU:t="Reinhard";break;case uU:t="OptimizedCineon";break;case d6:t="ACESFilmic";break;case fU:t="AgX";break;case hU:t="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),t="Linear"}return"vec3 "+i+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}function nte(i){return[i.extensionDerivatives||i.envMapCubeUVHeight||i.bumpMap||i.normalMapTangentSpace||i.clearcoatNormalMap||i.flatShading||i.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(i.extensionFragDepth||i.logarithmicDepthBuffer)&&i.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",i.extensionDrawBuffers&&i.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(i.extensionShaderTextureLOD||i.envMap||i.transmission)&&i.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(I1).join(`
`)}function ite(i){return[i.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":""].filter(I1).join(`
`)}function rte(i){const e=[];for(const t in i){const n=i[t];n!==!1&&e.push("#define "+t+" "+n)}return e.join(`
`)}function ste(i,e){const t={},n=i.getProgramParameter(e,i.ACTIVE_ATTRIBUTES);for(let r=0;r<n;r++){const s=i.getActiveAttrib(e,r),o=s.name;let a=1;s.type===i.FLOAT_MAT2&&(a=2),s.type===i.FLOAT_MAT3&&(a=3),s.type===i.FLOAT_MAT4&&(a=4),t[o]={type:s.type,location:i.getAttribLocation(e,o),locationSize:a}}return t}function I1(i){return i!==""}function BP(i,e){const t=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return i.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,t).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function DP(i,e){return i.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const ote=/^[ \t]*#include +<([\w\d./]+)>/gm;function TM(i){return i.replace(ote,lte)}const ate=new Map([["encodings_fragment","colorspace_fragment"],["encodings_pars_fragment","colorspace_pars_fragment"],["output_fragment","opaque_fragment"]]);function lte(i,e){let t=Un[e];if(t===void 0){const n=ate.get(e);if(n!==void 0)t=Un[n],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,n);else throw new Error("Can not resolve #include <"+e+">")}return TM(t)}const cte=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function kP(i){return i.replace(cte,ute)}function ute(i,e,t,n){let r="";for(let s=parseInt(e);s<parseInt(t);s++)r+=n.replace(/\[\s*i\s*\]/g,"[ "+s+" ]").replace(/UNROLLED_LOOP_INDEX/g,s);return r}function FP(i){let e="precision "+i.precision+` float;
precision `+i.precision+" int;";return i.precision==="highp"?e+=`
#define HIGH_PRECISION`:i.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:i.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function hte(i){let e="SHADOWMAP_TYPE_BASIC";return i.shadowMapType===dw?e="SHADOWMAP_TYPE_PCF":i.shadowMapType===Vv?e="SHADOWMAP_TYPE_PCF_SOFT":i.shadowMapType===fu&&(e="SHADOWMAP_TYPE_VSM"),e}function fte(i){let e="ENVMAP_TYPE_CUBE";if(i.envMap)switch(i.envMapMode){case _u:case ip:e="ENVMAP_TYPE_CUBE";break;case vA:e="ENVMAP_TYPE_CUBE_UV";break}return e}function dte(i){let e="ENVMAP_MODE_REFLECTION";if(i.envMap)switch(i.envMapMode){case ip:e="ENVMAP_MODE_REFRACTION";break}return e}function pte(i){let e="ENVMAP_BLENDING_NONE";if(i.envMap)switch(i.combine){case ex:e="ENVMAP_BLENDING_MULTIPLY";break;case oU:e="ENVMAP_BLENDING_MIX";break;case aU:e="ENVMAP_BLENDING_ADD";break}return e}function mte(i){const e=i.envMapCubeUVHeight;if(e===null)return null;const t=Math.log2(e)-2,n=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,t),112)),texelHeight:n,maxMip:t}}function gte(i,e,t,n){const r=i.getContext(),s=t.defines;let o=t.vertexShader,a=t.fragmentShader;const l=hte(t),c=fte(t),u=dte(t),h=pte(t),f=mte(t),d=t.isWebGL2?"":nte(t),m=ite(t),A=rte(s),g=r.createProgram();let y,E,x=t.glslVersion?"#version "+t.glslVersion+`
`:"";t.isRawShaderMaterial?(y=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,A].filter(I1).join(`
`),y.length>0&&(y+=`
`),E=[d,"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,A].filter(I1).join(`
`),E.length>0&&(E+=`
`)):(y=[FP(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,A,t.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",t.batching?"#define USE_BATCHING":"",t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+u:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.displacementMap?"#define USE_DISPLACEMENTMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.mapUv?"#define MAP_UV "+t.mapUv:"",t.alphaMapUv?"#define ALPHAMAP_UV "+t.alphaMapUv:"",t.lightMapUv?"#define LIGHTMAP_UV "+t.lightMapUv:"",t.aoMapUv?"#define AOMAP_UV "+t.aoMapUv:"",t.emissiveMapUv?"#define EMISSIVEMAP_UV "+t.emissiveMapUv:"",t.bumpMapUv?"#define BUMPMAP_UV "+t.bumpMapUv:"",t.normalMapUv?"#define NORMALMAP_UV "+t.normalMapUv:"",t.displacementMapUv?"#define DISPLACEMENTMAP_UV "+t.displacementMapUv:"",t.metalnessMapUv?"#define METALNESSMAP_UV "+t.metalnessMapUv:"",t.roughnessMapUv?"#define ROUGHNESSMAP_UV "+t.roughnessMapUv:"",t.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+t.anisotropyMapUv:"",t.clearcoatMapUv?"#define CLEARCOATMAP_UV "+t.clearcoatMapUv:"",t.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+t.clearcoatNormalMapUv:"",t.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+t.clearcoatRoughnessMapUv:"",t.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+t.iridescenceMapUv:"",t.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+t.iridescenceThicknessMapUv:"",t.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+t.sheenColorMapUv:"",t.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+t.sheenRoughnessMapUv:"",t.specularMapUv?"#define SPECULARMAP_UV "+t.specularMapUv:"",t.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+t.specularColorMapUv:"",t.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+t.specularIntensityMapUv:"",t.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+t.transmissionMapUv:"",t.thicknessMapUv?"#define THICKNESSMAP_UV "+t.thicknessMapUv:"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&t.flatShading===!1?"#define USE_MORPHNORMALS":"",t.morphColors&&t.isWebGL2?"#define USE_MORPHCOLORS":"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+t.morphTextureStride:"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.useLegacyLights?"#define LEGACY_LIGHTS":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(I1).join(`
`),E=[d,FP(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,A,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+c:"",t.envMap?"#define "+u:"",t.envMap?"#define "+h:"",f?"#define CUBEUV_TEXEL_WIDTH "+f.texelWidth:"",f?"#define CUBEUV_TEXEL_HEIGHT "+f.texelHeight:"",f?"#define CUBEUV_MAX_MIP "+f.maxMip+".0":"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescence?"#define USE_IRIDESCENCE":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.sheen?"#define USE_SHEEN":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.useLegacyLights?"#define LEGACY_LIGHTS":"",t.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==yu?"#define TONE_MAPPING":"",t.toneMapping!==yu?Un.tonemapping_pars_fragment:"",t.toneMapping!==yu?tte("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.opaque?"#define OPAQUE":"",Un.colorspace_pars_fragment,ete("linearToOutputTexel",t.outputColorSpace),t.useDepthPacking?"#define DEPTH_PACKING "+t.depthPacking:"",`
`].filter(I1).join(`
`)),o=TM(o),o=BP(o,t),o=DP(o,t),a=TM(a),a=BP(a,t),a=DP(a,t),o=kP(o),a=kP(a),t.isWebGL2&&t.isRawShaderMaterial!==!0&&(x=`#version 300 es
`,y=[m,"precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+y,E=["precision mediump sampler2DArray;","#define varying in",t.glslVersion===SM?"":"layout(location = 0) out highp vec4 pc_fragColor;",t.glslVersion===SM?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+E);const C=x+y+o,T=x+E+a,I=LP(r,r.VERTEX_SHADER,C),M=LP(r,r.FRAGMENT_SHADER,T);r.attachShader(g,I),r.attachShader(g,M),t.index0AttributeName!==void 0?r.bindAttribLocation(g,0,t.index0AttributeName):t.morphTargets===!0&&r.bindAttribLocation(g,0,"position"),r.linkProgram(g);function L(k){if(i.debug.checkShaderErrors){const z=r.getProgramInfoLog(g).trim(),U=r.getShaderInfoLog(I).trim(),W=r.getShaderInfoLog(M).trim();let $=!0,oe=!0;if(r.getProgramParameter(g,r.LINK_STATUS)===!1)if($=!1,typeof i.debug.onShaderError=="function")i.debug.onShaderError(r,g,I,M);else{const X=PP(r,I,"vertex"),Q=PP(r,M,"fragment");console.error("THREE.WebGLProgram: Shader Error "+r.getError()+" - VALIDATE_STATUS "+r.getProgramParameter(g,r.VALIDATE_STATUS)+`

Program Info Log: `+z+`
`+X+`
`+Q)}else z!==""?console.warn("THREE.WebGLProgram: Program Info Log:",z):(U===""||W==="")&&(oe=!1);oe&&(k.diagnostics={runnable:$,programLog:z,vertexShader:{log:U,prefix:y},fragmentShader:{log:W,prefix:E}})}r.deleteShader(I),r.deleteShader(M),R=new W_(r,g),P=ste(r,g)}let R;this.getUniforms=function(){return R===void 0&&L(this),R};let P;this.getAttributes=function(){return P===void 0&&L(this),P};let F=t.rendererExtensionParallelShaderCompile===!1;return this.isReady=function(){return F===!1&&(F=r.getProgramParameter(g,Xee)),F},this.destroy=function(){n.releaseStatesOfProgram(this),r.deleteProgram(g),this.program=void 0},this.type=t.shaderType,this.name=t.shaderName,this.id=qee++,this.cacheKey=e,this.usedTimes=1,this.program=g,this.vertexShader=I,this.fragmentShader=M,this}let Ate=0;class yte{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,n=e.fragmentShader,r=this._getShaderStage(t),s=this._getShaderStage(n),o=this._getShaderCacheForMaterial(e);return o.has(r)===!1&&(o.add(r),r.usedTimes++),o.has(s)===!1&&(o.add(s),s.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const n of t)n.usedTimes--,n.usedTimes===0&&this.shaderCache.delete(n.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let n=t.get(e);return n===void 0&&(n=new Set,t.set(e,n)),n}_getShaderStage(e){const t=this.shaderCache;let n=t.get(e);return n===void 0&&(n=new vte(e),t.set(e,n)),n}}class vte{constructor(e){this.id=Ate++,this.code=e,this.usedTimes=0}}function xte(i,e,t,n,r,s,o){const a=new zm,l=new yte,c=[],u=r.isWebGL2,h=r.logarithmicDepthBuffer,f=r.vertexTextures;let d=r.precision;const m={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function A(R){return R===0?"uv":`uv${R}`}function g(R,P,F,k,z){const U=k.fog,W=z.geometry,$=R.isMeshStandardMaterial?k.environment:null,oe=(R.isMeshStandardMaterial?t:e).get(R.envMap||$),X=oe&&oe.mapping===vA?oe.image.height:null,Q=m[R.type];R.precision!==null&&(d=r.getMaxPrecision(R.precision),d!==R.precision&&console.warn("THREE.WebGLProgram.getParameters:",R.precision,"not supported, using",d,"instead."));const Y=W.morphAttributes.position||W.morphAttributes.normal||W.morphAttributes.color,O=Y!==void 0?Y.length:0;let K=0;W.morphAttributes.position!==void 0&&(K=1),W.morphAttributes.normal!==void 0&&(K=2),W.morphAttributes.color!==void 0&&(K=3);let te,q,J,ie;if(Q){const Vn=du[Q];te=Vn.vertexShader,q=Vn.fragmentShader}else te=R.vertexShader,q=R.fragmentShader,l.update(R),J=l.getVertexShaderID(R),ie=l.getFragmentShaderID(R);const re=i.getRenderTarget(),se=z.isInstancedMesh===!0,ge=z.isBatchedMesh===!0,xe=!!R.map,pe=!!R.matcap,ce=!!oe,we=!!R.aoMap,Ee=!!R.lightMap,ve=!!R.bumpMap,Ae=!!R.normalMap,Le=!!R.displacementMap,Te=!!R.emissiveMap,ne=!!R.metalnessMap,V=!!R.roughnessMap,de=R.anisotropy>0,Re=R.clearcoat>0,Be=R.iridescence>0,Fe=R.sheen>0,He=R.transmission>0,it=de&&!!R.anisotropyMap,$e=Re&&!!R.clearcoatMap,ct=Re&&!!R.clearcoatNormalMap,pt=Re&&!!R.clearcoatRoughnessMap,We=Be&&!!R.iridescenceMap,Mt=Be&&!!R.iridescenceThicknessMap,Ft=Fe&&!!R.sheenColorMap,St=Fe&&!!R.sheenRoughnessMap,gt=!!R.specularMap,ft=!!R.specularColorMap,be=!!R.specularIntensityMap,qe=He&&!!R.transmissionMap,At=He&&!!R.thicknessMap,yt=!!R.gradientMap,De=!!R.alphaMap,Ce=R.alphaTest>0,_t=!!R.alphaHash,vt=!!R.extensions,bt=!!W.attributes.uv1,Pt=!!W.attributes.uv2,qt=!!W.attributes.uv3;let Nt=yu;return R.toneMapped&&(re===null||re.isXRRenderTarget===!0)&&(Nt=i.toneMapping),{isWebGL2:u,shaderID:Q,shaderType:R.type,shaderName:R.name,vertexShader:te,fragmentShader:q,defines:R.defines,customVertexShaderID:J,customFragmentShaderID:ie,isRawShaderMaterial:R.isRawShaderMaterial===!0,glslVersion:R.glslVersion,precision:d,batching:ge,instancing:se,instancingColor:se&&z.instanceColor!==null,supportsVertexTextures:f,outputColorSpace:re===null?i.outputColorSpace:re.isXRRenderTarget===!0?re.texture.colorSpace:Dl,map:xe,matcap:pe,envMap:ce,envMapMode:ce&&oe.mapping,envMapCubeUVHeight:X,aoMap:we,lightMap:Ee,bumpMap:ve,normalMap:Ae,displacementMap:f&&Le,emissiveMap:Te,normalMapObjectSpace:Ae&&R.normalMapType===SU,normalMapTangentSpace:Ae&&R.normalMapType===mp,metalnessMap:ne,roughnessMap:V,anisotropy:de,anisotropyMap:it,clearcoat:Re,clearcoatMap:$e,clearcoatNormalMap:ct,clearcoatRoughnessMap:pt,iridescence:Be,iridescenceMap:We,iridescenceThicknessMap:Mt,sheen:Fe,sheenColorMap:Ft,sheenRoughnessMap:St,specularMap:gt,specularColorMap:ft,specularIntensityMap:be,transmission:He,transmissionMap:qe,thicknessMap:At,gradientMap:yt,opaque:R.transparent===!1&&R.blending===Kd,alphaMap:De,alphaTest:Ce,alphaHash:_t,combine:R.combine,mapUv:xe&&A(R.map.channel),aoMapUv:we&&A(R.aoMap.channel),lightMapUv:Ee&&A(R.lightMap.channel),bumpMapUv:ve&&A(R.bumpMap.channel),normalMapUv:Ae&&A(R.normalMap.channel),displacementMapUv:Le&&A(R.displacementMap.channel),emissiveMapUv:Te&&A(R.emissiveMap.channel),metalnessMapUv:ne&&A(R.metalnessMap.channel),roughnessMapUv:V&&A(R.roughnessMap.channel),anisotropyMapUv:it&&A(R.anisotropyMap.channel),clearcoatMapUv:$e&&A(R.clearcoatMap.channel),clearcoatNormalMapUv:ct&&A(R.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:pt&&A(R.clearcoatRoughnessMap.channel),iridescenceMapUv:We&&A(R.iridescenceMap.channel),iridescenceThicknessMapUv:Mt&&A(R.iridescenceThicknessMap.channel),sheenColorMapUv:Ft&&A(R.sheenColorMap.channel),sheenRoughnessMapUv:St&&A(R.sheenRoughnessMap.channel),specularMapUv:gt&&A(R.specularMap.channel),specularColorMapUv:ft&&A(R.specularColorMap.channel),specularIntensityMapUv:be&&A(R.specularIntensityMap.channel),transmissionMapUv:qe&&A(R.transmissionMap.channel),thicknessMapUv:At&&A(R.thicknessMap.channel),alphaMapUv:De&&A(R.alphaMap.channel),vertexTangents:!!W.attributes.tangent&&(Ae||de),vertexColors:R.vertexColors,vertexAlphas:R.vertexColors===!0&&!!W.attributes.color&&W.attributes.color.itemSize===4,vertexUv1s:bt,vertexUv2s:Pt,vertexUv3s:qt,pointsUvs:z.isPoints===!0&&!!W.attributes.uv&&(xe||De),fog:!!U,useFog:R.fog===!0,fogExp2:U&&U.isFogExp2,flatShading:R.flatShading===!0,sizeAttenuation:R.sizeAttenuation===!0,logarithmicDepthBuffer:h,skinning:z.isSkinnedMesh===!0,morphTargets:W.morphAttributes.position!==void 0,morphNormals:W.morphAttributes.normal!==void 0,morphColors:W.morphAttributes.color!==void 0,morphTargetsCount:O,morphTextureStride:K,numDirLights:P.directional.length,numPointLights:P.point.length,numSpotLights:P.spot.length,numSpotLightMaps:P.spotLightMap.length,numRectAreaLights:P.rectArea.length,numHemiLights:P.hemi.length,numDirLightShadows:P.directionalShadowMap.length,numPointLightShadows:P.pointShadowMap.length,numSpotLightShadows:P.spotShadowMap.length,numSpotLightShadowsWithMaps:P.numSpotLightShadowsWithMaps,numLightProbes:P.numLightProbes,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:R.dithering,shadowMapEnabled:i.shadowMap.enabled&&F.length>0,shadowMapType:i.shadowMap.type,toneMapping:Nt,useLegacyLights:i._useLegacyLights,decodeVideoTexture:xe&&R.map.isVideoTexture===!0&&Vi.getTransfer(R.map.colorSpace)===mr,premultipliedAlpha:R.premultipliedAlpha,doubleSided:R.side===Pi,flipSided:R.side===ys,useDepthPacking:R.depthPacking>=0,depthPacking:R.depthPacking||0,index0AttributeName:R.index0AttributeName,extensionDerivatives:vt&&R.extensions.derivatives===!0,extensionFragDepth:vt&&R.extensions.fragDepth===!0,extensionDrawBuffers:vt&&R.extensions.drawBuffers===!0,extensionShaderTextureLOD:vt&&R.extensions.shaderTextureLOD===!0,extensionClipCullDistance:vt&&R.extensions.clipCullDistance&&n.has("WEBGL_clip_cull_distance"),rendererExtensionFragDepth:u||n.has("EXT_frag_depth"),rendererExtensionDrawBuffers:u||n.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:u||n.has("EXT_shader_texture_lod"),rendererExtensionParallelShaderCompile:n.has("KHR_parallel_shader_compile"),customProgramCacheKey:R.customProgramCacheKey()}}function y(R){const P=[];if(R.shaderID?P.push(R.shaderID):(P.push(R.customVertexShaderID),P.push(R.customFragmentShaderID)),R.defines!==void 0)for(const F in R.defines)P.push(F),P.push(R.defines[F]);return R.isRawShaderMaterial===!1&&(E(P,R),x(P,R),P.push(i.outputColorSpace)),P.push(R.customProgramCacheKey),P.join()}function E(R,P){R.push(P.precision),R.push(P.outputColorSpace),R.push(P.envMapMode),R.push(P.envMapCubeUVHeight),R.push(P.mapUv),R.push(P.alphaMapUv),R.push(P.lightMapUv),R.push(P.aoMapUv),R.push(P.bumpMapUv),R.push(P.normalMapUv),R.push(P.displacementMapUv),R.push(P.emissiveMapUv),R.push(P.metalnessMapUv),R.push(P.roughnessMapUv),R.push(P.anisotropyMapUv),R.push(P.clearcoatMapUv),R.push(P.clearcoatNormalMapUv),R.push(P.clearcoatRoughnessMapUv),R.push(P.iridescenceMapUv),R.push(P.iridescenceThicknessMapUv),R.push(P.sheenColorMapUv),R.push(P.sheenRoughnessMapUv),R.push(P.specularMapUv),R.push(P.specularColorMapUv),R.push(P.specularIntensityMapUv),R.push(P.transmissionMapUv),R.push(P.thicknessMapUv),R.push(P.combine),R.push(P.fogExp2),R.push(P.sizeAttenuation),R.push(P.morphTargetsCount),R.push(P.morphAttributeCount),R.push(P.numDirLights),R.push(P.numPointLights),R.push(P.numSpotLights),R.push(P.numSpotLightMaps),R.push(P.numHemiLights),R.push(P.numRectAreaLights),R.push(P.numDirLightShadows),R.push(P.numPointLightShadows),R.push(P.numSpotLightShadows),R.push(P.numSpotLightShadowsWithMaps),R.push(P.numLightProbes),R.push(P.shadowMapType),R.push(P.toneMapping),R.push(P.numClippingPlanes),R.push(P.numClipIntersection),R.push(P.depthPacking)}function x(R,P){a.disableAll(),P.isWebGL2&&a.enable(0),P.supportsVertexTextures&&a.enable(1),P.instancing&&a.enable(2),P.instancingColor&&a.enable(3),P.matcap&&a.enable(4),P.envMap&&a.enable(5),P.normalMapObjectSpace&&a.enable(6),P.normalMapTangentSpace&&a.enable(7),P.clearcoat&&a.enable(8),P.iridescence&&a.enable(9),P.alphaTest&&a.enable(10),P.vertexColors&&a.enable(11),P.vertexAlphas&&a.enable(12),P.vertexUv1s&&a.enable(13),P.vertexUv2s&&a.enable(14),P.vertexUv3s&&a.enable(15),P.vertexTangents&&a.enable(16),P.anisotropy&&a.enable(17),P.alphaHash&&a.enable(18),P.batching&&a.enable(19),R.push(a.mask),a.disableAll(),P.fog&&a.enable(0),P.useFog&&a.enable(1),P.flatShading&&a.enable(2),P.logarithmicDepthBuffer&&a.enable(3),P.skinning&&a.enable(4),P.morphTargets&&a.enable(5),P.morphNormals&&a.enable(6),P.morphColors&&a.enable(7),P.premultipliedAlpha&&a.enable(8),P.shadowMapEnabled&&a.enable(9),P.useLegacyLights&&a.enable(10),P.doubleSided&&a.enable(11),P.flipSided&&a.enable(12),P.useDepthPacking&&a.enable(13),P.dithering&&a.enable(14),P.transmission&&a.enable(15),P.sheen&&a.enable(16),P.opaque&&a.enable(17),P.pointsUvs&&a.enable(18),P.decodeVideoTexture&&a.enable(19),R.push(a.mask)}function C(R){const P=m[R.type];let F;if(P){const k=du[P];F=rp.clone(k.uniforms)}else F=R.uniforms;return F}function T(R,P){let F;for(let k=0,z=c.length;k<z;k++){const U=c[k];if(U.cacheKey===P){F=U,++F.usedTimes;break}}return F===void 0&&(F=new gte(i,P,R,s),c.push(F)),F}function I(R){if(--R.usedTimes===0){const P=c.indexOf(R);c[P]=c[c.length-1],c.pop(),R.destroy()}}function M(R){l.remove(R)}function L(){l.dispose()}return{getParameters:g,getProgramCacheKey:y,getUniforms:C,acquireProgram:T,releaseProgram:I,releaseShaderCache:M,programs:c,dispose:L}}function Ete(){let i=new WeakMap;function e(s){let o=i.get(s);return o===void 0&&(o={},i.set(s,o)),o}function t(s){i.delete(s)}function n(s,o,a){i.get(s)[o]=a}function r(){i=new WeakMap}return{get:e,remove:t,update:n,dispose:r}}function _te(i,e){return i.groupOrder!==e.groupOrder?i.groupOrder-e.groupOrder:i.renderOrder!==e.renderOrder?i.renderOrder-e.renderOrder:i.material.id!==e.material.id?i.material.id-e.material.id:i.z!==e.z?i.z-e.z:i.id-e.id}function OP(i,e){return i.groupOrder!==e.groupOrder?i.groupOrder-e.groupOrder:i.renderOrder!==e.renderOrder?i.renderOrder-e.renderOrder:i.z!==e.z?e.z-i.z:i.id-e.id}function NP(){const i=[];let e=0;const t=[],n=[],r=[];function s(){e=0,t.length=0,n.length=0,r.length=0}function o(h,f,d,m,A,g){let y=i[e];return y===void 0?(y={id:h.id,object:h,geometry:f,material:d,groupOrder:m,renderOrder:h.renderOrder,z:A,group:g},i[e]=y):(y.id=h.id,y.object=h,y.geometry=f,y.material=d,y.groupOrder=m,y.renderOrder=h.renderOrder,y.z=A,y.group=g),e++,y}function a(h,f,d,m,A,g){const y=o(h,f,d,m,A,g);d.transmission>0?n.push(y):d.transparent===!0?r.push(y):t.push(y)}function l(h,f,d,m,A,g){const y=o(h,f,d,m,A,g);d.transmission>0?n.unshift(y):d.transparent===!0?r.unshift(y):t.unshift(y)}function c(h,f){t.length>1&&t.sort(h||_te),n.length>1&&n.sort(f||OP),r.length>1&&r.sort(f||OP)}function u(){for(let h=e,f=i.length;h<f;h++){const d=i[h];if(d.id===null)break;d.id=null,d.object=null,d.geometry=null,d.material=null,d.group=null}}return{opaque:t,transmissive:n,transparent:r,init:s,push:a,unshift:l,finish:u,sort:c}}function Ste(){let i=new WeakMap;function e(n,r){const s=i.get(n);let o;return s===void 0?(o=new NP,i.set(n,[o])):r>=s.length?(o=new NP,s.push(o)):o=s[r],o}function t(){i=new WeakMap}return{get:e,dispose:t}}function wte(){const i={};return{get:function(e){if(i[e.id]!==void 0)return i[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new H,color:new ut};break;case"SpotLight":t={position:new H,direction:new H,color:new ut,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new H,color:new ut,distance:0,decay:0};break;case"HemisphereLight":t={direction:new H,skyColor:new ut,groundColor:new ut};break;case"RectAreaLight":t={color:new ut,position:new H,halfWidth:new H,halfHeight:new H};break}return i[e.id]=t,t}}}function Cte(){const i={};return{get:function(e){if(i[e.id]!==void 0)return i[e.id];let t;switch(e.type){case"DirectionalLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Ue};break;case"SpotLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Ue};break;case"PointLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Ue,shadowCameraNear:1,shadowCameraFar:1e3};break}return i[e.id]=t,t}}}let Tte=0;function bte(i,e){return(e.castShadow?2:0)-(i.castShadow?2:0)+(e.map?1:0)-(i.map?1:0)}function Ite(i,e){const t=new wte,n=Cte(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let u=0;u<9;u++)r.probe.push(new H);const s=new H,o=new Xe,a=new Xe;function l(u,h){let f=0,d=0,m=0;for(let k=0;k<9;k++)r.probe[k].set(0,0,0);let A=0,g=0,y=0,E=0,x=0,C=0,T=0,I=0,M=0,L=0,R=0;u.sort(bte);const P=h===!0?Math.PI:1;for(let k=0,z=u.length;k<z;k++){const U=u[k],W=U.color,$=U.intensity,oe=U.distance,X=U.shadow&&U.shadow.map?U.shadow.map.texture:null;if(U.isAmbientLight)f+=W.r*$*P,d+=W.g*$*P,m+=W.b*$*P;else if(U.isLightProbe){for(let Q=0;Q<9;Q++)r.probe[Q].addScaledVector(U.sh.coefficients[Q],$);R++}else if(U.isDirectionalLight){const Q=t.get(U);if(Q.color.copy(U.color).multiplyScalar(U.intensity*P),U.castShadow){const Y=U.shadow,O=n.get(U);O.shadowBias=Y.bias,O.shadowNormalBias=Y.normalBias,O.shadowRadius=Y.radius,O.shadowMapSize=Y.mapSize,r.directionalShadow[A]=O,r.directionalShadowMap[A]=X,r.directionalShadowMatrix[A]=U.shadow.matrix,C++}r.directional[A]=Q,A++}else if(U.isSpotLight){const Q=t.get(U);Q.position.setFromMatrixPosition(U.matrixWorld),Q.color.copy(W).multiplyScalar($*P),Q.distance=oe,Q.coneCos=Math.cos(U.angle),Q.penumbraCos=Math.cos(U.angle*(1-U.penumbra)),Q.decay=U.decay,r.spot[y]=Q;const Y=U.shadow;if(U.map&&(r.spotLightMap[M]=U.map,M++,Y.updateMatrices(U),U.castShadow&&L++),r.spotLightMatrix[y]=Y.matrix,U.castShadow){const O=n.get(U);O.shadowBias=Y.bias,O.shadowNormalBias=Y.normalBias,O.shadowRadius=Y.radius,O.shadowMapSize=Y.mapSize,r.spotShadow[y]=O,r.spotShadowMap[y]=X,I++}y++}else if(U.isRectAreaLight){const Q=t.get(U);Q.color.copy(W).multiplyScalar($),Q.halfWidth.set(U.width*.5,0,0),Q.halfHeight.set(0,U.height*.5,0),r.rectArea[E]=Q,E++}else if(U.isPointLight){const Q=t.get(U);if(Q.color.copy(U.color).multiplyScalar(U.intensity*P),Q.distance=U.distance,Q.decay=U.decay,U.castShadow){const Y=U.shadow,O=n.get(U);O.shadowBias=Y.bias,O.shadowNormalBias=Y.normalBias,O.shadowRadius=Y.radius,O.shadowMapSize=Y.mapSize,O.shadowCameraNear=Y.camera.near,O.shadowCameraFar=Y.camera.far,r.pointShadow[g]=O,r.pointShadowMap[g]=X,r.pointShadowMatrix[g]=U.shadow.matrix,T++}r.point[g]=Q,g++}else if(U.isHemisphereLight){const Q=t.get(U);Q.skyColor.copy(U.color).multiplyScalar($*P),Q.groundColor.copy(U.groundColor).multiplyScalar($*P),r.hemi[x]=Q,x++}}E>0&&(e.isWebGL2?i.has("OES_texture_float_linear")===!0?(r.rectAreaLTC1=Ot.LTC_FLOAT_1,r.rectAreaLTC2=Ot.LTC_FLOAT_2):(r.rectAreaLTC1=Ot.LTC_HALF_1,r.rectAreaLTC2=Ot.LTC_HALF_2):i.has("OES_texture_float_linear")===!0?(r.rectAreaLTC1=Ot.LTC_FLOAT_1,r.rectAreaLTC2=Ot.LTC_FLOAT_2):i.has("OES_texture_half_float_linear")===!0?(r.rectAreaLTC1=Ot.LTC_HALF_1,r.rectAreaLTC2=Ot.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),r.ambient[0]=f,r.ambient[1]=d,r.ambient[2]=m;const F=r.hash;(F.directionalLength!==A||F.pointLength!==g||F.spotLength!==y||F.rectAreaLength!==E||F.hemiLength!==x||F.numDirectionalShadows!==C||F.numPointShadows!==T||F.numSpotShadows!==I||F.numSpotMaps!==M||F.numLightProbes!==R)&&(r.directional.length=A,r.spot.length=y,r.rectArea.length=E,r.point.length=g,r.hemi.length=x,r.directionalShadow.length=C,r.directionalShadowMap.length=C,r.pointShadow.length=T,r.pointShadowMap.length=T,r.spotShadow.length=I,r.spotShadowMap.length=I,r.directionalShadowMatrix.length=C,r.pointShadowMatrix.length=T,r.spotLightMatrix.length=I+M-L,r.spotLightMap.length=M,r.numSpotLightShadowsWithMaps=L,r.numLightProbes=R,F.directionalLength=A,F.pointLength=g,F.spotLength=y,F.rectAreaLength=E,F.hemiLength=x,F.numDirectionalShadows=C,F.numPointShadows=T,F.numSpotShadows=I,F.numSpotMaps=M,F.numLightProbes=R,r.version=Tte++)}function c(u,h){let f=0,d=0,m=0,A=0,g=0;const y=h.matrixWorldInverse;for(let E=0,x=u.length;E<x;E++){const C=u[E];if(C.isDirectionalLight){const T=r.directional[f];T.direction.setFromMatrixPosition(C.matrixWorld),s.setFromMatrixPosition(C.target.matrixWorld),T.direction.sub(s),T.direction.transformDirection(y),f++}else if(C.isSpotLight){const T=r.spot[m];T.position.setFromMatrixPosition(C.matrixWorld),T.position.applyMatrix4(y),T.direction.setFromMatrixPosition(C.matrixWorld),s.setFromMatrixPosition(C.target.matrixWorld),T.direction.sub(s),T.direction.transformDirection(y),m++}else if(C.isRectAreaLight){const T=r.rectArea[A];T.position.setFromMatrixPosition(C.matrixWorld),T.position.applyMatrix4(y),a.identity(),o.copy(C.matrixWorld),o.premultiply(y),a.extractRotation(o),T.halfWidth.set(C.width*.5,0,0),T.halfHeight.set(0,C.height*.5,0),T.halfWidth.applyMatrix4(a),T.halfHeight.applyMatrix4(a),A++}else if(C.isPointLight){const T=r.point[d];T.position.setFromMatrixPosition(C.matrixWorld),T.position.applyMatrix4(y),d++}else if(C.isHemisphereLight){const T=r.hemi[g];T.direction.setFromMatrixPosition(C.matrixWorld),T.direction.transformDirection(y),g++}}}return{setup:l,setupView:c,state:r}}function UP(i,e){const t=new Ite(i,e),n=[],r=[];function s(){n.length=0,r.length=0}function o(h){n.push(h)}function a(h){r.push(h)}function l(h){t.setup(n,h)}function c(h){t.setupView(n,h)}return{init:s,state:{lightsArray:n,shadowsArray:r,lights:t},setupLights:l,setupLightsView:c,pushLight:o,pushShadow:a}}function Mte(i,e){let t=new WeakMap;function n(s,o=0){const a=t.get(s);let l;return a===void 0?(l=new UP(i,e),t.set(s,[l])):o>=a.length?(l=new UP(i,e),a.push(l)):l=a[o],l}function r(){t=new WeakMap}return{get:n,dispose:r}}class rx extends Us{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=_U,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class bw extends Us{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}const Rte=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,Lte=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function Pte(i,e,t){let n=new h0;const r=new Ue,s=new Ue,o=new Rn,a=new rx({depthPacking:Ew}),l=new bw,c={},u=t.maxTextureSize,h={[tl]:ys,[ys]:tl,[Pi]:Pi},f=new Mi({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Ue},radius:{value:4}},vertexShader:Rte,fragmentShader:Lte}),d=f.clone();d.defines.HORIZONTAL_PASS=1;const m=new fn;m.setAttribute("position",new mn(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const A=new It(m,f),g=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=dw;let y=this.type;this.render=function(I,M,L){if(g.enabled===!1||g.autoUpdate===!1&&g.needsUpdate===!1||I.length===0)return;const R=i.getRenderTarget(),P=i.getActiveCubeFace(),F=i.getActiveMipmapLevel(),k=i.state;k.setBlending(gc),k.buffers.color.setClear(1,1,1,1),k.buffers.depth.setTest(!0),k.setScissorTest(!1);const z=y!==fu&&this.type===fu,U=y===fu&&this.type!==fu;for(let W=0,$=I.length;W<$;W++){const oe=I[W],X=oe.shadow;if(X===void 0){console.warn("THREE.WebGLShadowMap:",oe,"has no shadow.");continue}if(X.autoUpdate===!1&&X.needsUpdate===!1)continue;r.copy(X.mapSize);const Q=X.getFrameExtents();if(r.multiply(Q),s.copy(X.mapSize),(r.x>u||r.y>u)&&(r.x>u&&(s.x=Math.floor(u/Q.x),r.x=s.x*Q.x,X.mapSize.x=s.x),r.y>u&&(s.y=Math.floor(u/Q.y),r.y=s.y*Q.y,X.mapSize.y=s.y)),X.map===null||z===!0||U===!0){const O=this.type!==fu?{minFilter:zn,magFilter:zn}:{};X.map!==null&&X.map.dispose(),X.map=new Si(r.x,r.y,O),X.map.texture.name=oe.name+".shadowMap",X.camera.updateProjectionMatrix()}i.setRenderTarget(X.map),i.clear();const Y=X.getViewportCount();for(let O=0;O<Y;O++){const K=X.getViewport(O);o.set(s.x*K.x,s.y*K.y,s.x*K.z,s.y*K.w),k.viewport(o),X.updateMatrices(oe,O),n=X.getFrustum(),C(M,L,X.camera,oe,this.type)}X.isPointLightShadow!==!0&&this.type===fu&&E(X,L),X.needsUpdate=!1}y=this.type,g.needsUpdate=!1,i.setRenderTarget(R,P,F)};function E(I,M){const L=e.update(A);f.defines.VSM_SAMPLES!==I.blurSamples&&(f.defines.VSM_SAMPLES=I.blurSamples,d.defines.VSM_SAMPLES=I.blurSamples,f.needsUpdate=!0,d.needsUpdate=!0),I.mapPass===null&&(I.mapPass=new Si(r.x,r.y)),f.uniforms.shadow_pass.value=I.map.texture,f.uniforms.resolution.value=I.mapSize,f.uniforms.radius.value=I.radius,i.setRenderTarget(I.mapPass),i.clear(),i.renderBufferDirect(M,null,L,f,A,null),d.uniforms.shadow_pass.value=I.mapPass.texture,d.uniforms.resolution.value=I.mapSize,d.uniforms.radius.value=I.radius,i.setRenderTarget(I.map),i.clear(),i.renderBufferDirect(M,null,L,d,A,null)}function x(I,M,L,R){let P=null;const F=L.isPointLight===!0?I.customDistanceMaterial:I.customDepthMaterial;if(F!==void 0)P=F;else if(P=L.isPointLight===!0?l:a,i.localClippingEnabled&&M.clipShadows===!0&&Array.isArray(M.clippingPlanes)&&M.clippingPlanes.length!==0||M.displacementMap&&M.displacementScale!==0||M.alphaMap&&M.alphaTest>0||M.map&&M.alphaTest>0){const k=P.uuid,z=M.uuid;let U=c[k];U===void 0&&(U={},c[k]=U);let W=U[z];W===void 0&&(W=P.clone(),U[z]=W,M.addEventListener("dispose",T)),P=W}if(P.visible=M.visible,P.wireframe=M.wireframe,R===fu?P.side=M.shadowSide!==null?M.shadowSide:M.side:P.side=M.shadowSide!==null?M.shadowSide:h[M.side],P.alphaMap=M.alphaMap,P.alphaTest=M.alphaTest,P.map=M.map,P.clipShadows=M.clipShadows,P.clippingPlanes=M.clippingPlanes,P.clipIntersection=M.clipIntersection,P.displacementMap=M.displacementMap,P.displacementScale=M.displacementScale,P.displacementBias=M.displacementBias,P.wireframeLinewidth=M.wireframeLinewidth,P.linewidth=M.linewidth,L.isPointLight===!0&&P.isMeshDistanceMaterial===!0){const k=i.properties.get(P);k.light=L}return P}function C(I,M,L,R,P){if(I.visible===!1)return;if(I.layers.test(M.layers)&&(I.isMesh||I.isLine||I.isPoints)&&(I.castShadow||I.receiveShadow&&P===fu)&&(!I.frustumCulled||n.intersectsObject(I))){I.modelViewMatrix.multiplyMatrices(L.matrixWorldInverse,I.matrixWorld);const z=e.update(I),U=I.material;if(Array.isArray(U)){const W=z.groups;for(let $=0,oe=W.length;$<oe;$++){const X=W[$],Q=U[X.materialIndex];if(Q&&Q.visible){const Y=x(I,Q,R,P);I.onBeforeShadow(i,I,M,L,z,Y,X),i.renderBufferDirect(L,null,z,Y,I,X),I.onAfterShadow(i,I,M,L,z,Y,X)}}}else if(U.visible){const W=x(I,U,R,P);I.onBeforeShadow(i,I,M,L,z,W,null),i.renderBufferDirect(L,null,z,W,I,null),I.onAfterShadow(i,I,M,L,z,W,null)}}const k=I.children;for(let z=0,U=k.length;z<U;z++)C(k[z],M,L,R,P)}function T(I){I.target.removeEventListener("dispose",T);for(const L in c){const R=c[L],P=I.target.uuid;P in R&&(R[P].dispose(),delete R[P])}}}function Bte(i,e,t){const n=t.isWebGL2;function r(){let Ce=!1;const _t=new Rn;let vt=null;const bt=new Rn(0,0,0,0);return{setMask:function(Pt){vt!==Pt&&!Ce&&(i.colorMask(Pt,Pt,Pt,Pt),vt=Pt)},setLocked:function(Pt){Ce=Pt},setClear:function(Pt,qt,Nt,dn,Vn){Vn===!0&&(Pt*=dn,qt*=dn,Nt*=dn),_t.set(Pt,qt,Nt,dn),bt.equals(_t)===!1&&(i.clearColor(Pt,qt,Nt,dn),bt.copy(_t))},reset:function(){Ce=!1,vt=null,bt.set(-1,0,0,0)}}}function s(){let Ce=!1,_t=null,vt=null,bt=null;return{setTest:function(Pt){Pt?ge(i.DEPTH_TEST):xe(i.DEPTH_TEST)},setMask:function(Pt){_t!==Pt&&!Ce&&(i.depthMask(Pt),_t=Pt)},setFunc:function(Pt){if(vt!==Pt){switch(Pt){case ZN:i.depthFunc(i.NEVER);break;case eU:i.depthFunc(i.ALWAYS);break;case tU:i.depthFunc(i.LESS);break;case y2:i.depthFunc(i.LEQUAL);break;case nU:i.depthFunc(i.EQUAL);break;case iU:i.depthFunc(i.GEQUAL);break;case rU:i.depthFunc(i.GREATER);break;case sU:i.depthFunc(i.NOTEQUAL);break;default:i.depthFunc(i.LEQUAL)}vt=Pt}},setLocked:function(Pt){Ce=Pt},setClear:function(Pt){bt!==Pt&&(i.clearDepth(Pt),bt=Pt)},reset:function(){Ce=!1,_t=null,vt=null,bt=null}}}function o(){let Ce=!1,_t=null,vt=null,bt=null,Pt=null,qt=null,Nt=null,dn=null,Vn=null;return{setTest:function(pn){Ce||(pn?ge(i.STENCIL_TEST):xe(i.STENCIL_TEST))},setMask:function(pn){_t!==pn&&!Ce&&(i.stencilMask(pn),_t=pn)},setFunc:function(pn,qn,Ci){(vt!==pn||bt!==qn||Pt!==Ci)&&(i.stencilFunc(pn,qn,Ci),vt=pn,bt=qn,Pt=Ci)},setOp:function(pn,qn,Ci){(qt!==pn||Nt!==qn||dn!==Ci)&&(i.stencilOp(pn,qn,Ci),qt=pn,Nt=qn,dn=Ci)},setLocked:function(pn){Ce=pn},setClear:function(pn){Vn!==pn&&(i.clearStencil(pn),Vn=pn)},reset:function(){Ce=!1,_t=null,vt=null,bt=null,Pt=null,qt=null,Nt=null,dn=null,Vn=null}}}const a=new r,l=new s,c=new o,u=new WeakMap,h=new WeakMap;let f={},d={},m=new WeakMap,A=[],g=null,y=!1,E=null,x=null,C=null,T=null,I=null,M=null,L=null,R=new ut(0,0,0),P=0,F=!1,k=null,z=null,U=null,W=null,$=null;const oe=i.getParameter(i.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let X=!1,Q=0;const Y=i.getParameter(i.VERSION);Y.indexOf("WebGL")!==-1?(Q=parseFloat(/^WebGL (\d)/.exec(Y)[1]),X=Q>=1):Y.indexOf("OpenGL ES")!==-1&&(Q=parseFloat(/^OpenGL ES (\d)/.exec(Y)[1]),X=Q>=2);let O=null,K={};const te=i.getParameter(i.SCISSOR_BOX),q=i.getParameter(i.VIEWPORT),J=new Rn().fromArray(te),ie=new Rn().fromArray(q);function re(Ce,_t,vt,bt){const Pt=new Uint8Array(4),qt=i.createTexture();i.bindTexture(Ce,qt),i.texParameteri(Ce,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(Ce,i.TEXTURE_MAG_FILTER,i.NEAREST);for(let Nt=0;Nt<vt;Nt++)n&&(Ce===i.TEXTURE_3D||Ce===i.TEXTURE_2D_ARRAY)?i.texImage3D(_t,0,i.RGBA,1,1,bt,0,i.RGBA,i.UNSIGNED_BYTE,Pt):i.texImage2D(_t+Nt,0,i.RGBA,1,1,0,i.RGBA,i.UNSIGNED_BYTE,Pt);return qt}const se={};se[i.TEXTURE_2D]=re(i.TEXTURE_2D,i.TEXTURE_2D,1),se[i.TEXTURE_CUBE_MAP]=re(i.TEXTURE_CUBE_MAP,i.TEXTURE_CUBE_MAP_POSITIVE_X,6),n&&(se[i.TEXTURE_2D_ARRAY]=re(i.TEXTURE_2D_ARRAY,i.TEXTURE_2D_ARRAY,1,1),se[i.TEXTURE_3D]=re(i.TEXTURE_3D,i.TEXTURE_3D,1,1)),a.setClear(0,0,0,1),l.setClear(1),c.setClear(0),ge(i.DEPTH_TEST),l.setFunc(y2),Te(!1),ne(qI),ge(i.CULL_FACE),Ae(gc);function ge(Ce){f[Ce]!==!0&&(i.enable(Ce),f[Ce]=!0)}function xe(Ce){f[Ce]!==!1&&(i.disable(Ce),f[Ce]=!1)}function pe(Ce,_t){return d[Ce]!==_t?(i.bindFramebuffer(Ce,_t),d[Ce]=_t,n&&(Ce===i.DRAW_FRAMEBUFFER&&(d[i.FRAMEBUFFER]=_t),Ce===i.FRAMEBUFFER&&(d[i.DRAW_FRAMEBUFFER]=_t)),!0):!1}function ce(Ce,_t){let vt=A,bt=!1;if(Ce)if(vt=m.get(_t),vt===void 0&&(vt=[],m.set(_t,vt)),Ce.isWebGLMultipleRenderTargets){const Pt=Ce.texture;if(vt.length!==Pt.length||vt[0]!==i.COLOR_ATTACHMENT0){for(let qt=0,Nt=Pt.length;qt<Nt;qt++)vt[qt]=i.COLOR_ATTACHMENT0+qt;vt.length=Pt.length,bt=!0}}else vt[0]!==i.COLOR_ATTACHMENT0&&(vt[0]=i.COLOR_ATTACHMENT0,bt=!0);else vt[0]!==i.BACK&&(vt[0]=i.BACK,bt=!0);bt&&(t.isWebGL2?i.drawBuffers(vt):e.get("WEBGL_draw_buffers").drawBuffersWEBGL(vt))}function we(Ce){return g!==Ce?(i.useProgram(Ce),g=Ce,!0):!1}const Ee={[Nd]:i.FUNC_ADD,[UN]:i.FUNC_SUBTRACT,[zN]:i.FUNC_REVERSE_SUBTRACT};if(n)Ee[eM]=i.MIN,Ee[tM]=i.MAX;else{const Ce=e.get("EXT_blend_minmax");Ce!==null&&(Ee[eM]=Ce.MIN_EXT,Ee[tM]=Ce.MAX_EXT)}const ve={[GN]:i.ZERO,[mw]:i.ONE,[HN]:i.SRC_COLOR,[A2]:i.SRC_ALPHA,[$N]:i.SRC_ALPHA_SATURATE,[jN]:i.DST_COLOR,[VN]:i.DST_ALPHA,[QN]:i.ONE_MINUS_SRC_COLOR,[yS]:i.ONE_MINUS_SRC_ALPHA,[KN]:i.ONE_MINUS_DST_COLOR,[WN]:i.ONE_MINUS_DST_ALPHA,[YN]:i.CONSTANT_COLOR,[XN]:i.ONE_MINUS_CONSTANT_COLOR,[qN]:i.CONSTANT_ALPHA,[JN]:i.ONE_MINUS_CONSTANT_ALPHA};function Ae(Ce,_t,vt,bt,Pt,qt,Nt,dn,Vn,pn){if(Ce===gc){y===!0&&(xe(i.BLEND),y=!1);return}if(y===!1&&(ge(i.BLEND),y=!0),Ce!==pw){if(Ce!==E||pn!==F){if((x!==Nd||I!==Nd)&&(i.blendEquation(i.FUNC_ADD),x=Nd,I=Nd),pn)switch(Ce){case Kd:i.blendFuncSeparate(i.ONE,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA);break;case AS:i.blendFunc(i.ONE,i.ONE);break;case JI:i.blendFuncSeparate(i.ZERO,i.ONE_MINUS_SRC_COLOR,i.ZERO,i.ONE);break;case ZI:i.blendFuncSeparate(i.ZERO,i.SRC_COLOR,i.ZERO,i.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",Ce);break}else switch(Ce){case Kd:i.blendFuncSeparate(i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA);break;case AS:i.blendFunc(i.SRC_ALPHA,i.ONE);break;case JI:i.blendFuncSeparate(i.ZERO,i.ONE_MINUS_SRC_COLOR,i.ZERO,i.ONE);break;case ZI:i.blendFunc(i.ZERO,i.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",Ce);break}C=null,T=null,M=null,L=null,R.set(0,0,0),P=0,E=Ce,F=pn}return}Pt=Pt||_t,qt=qt||vt,Nt=Nt||bt,(_t!==x||Pt!==I)&&(i.blendEquationSeparate(Ee[_t],Ee[Pt]),x=_t,I=Pt),(vt!==C||bt!==T||qt!==M||Nt!==L)&&(i.blendFuncSeparate(ve[vt],ve[bt],ve[qt],ve[Nt]),C=vt,T=bt,M=qt,L=Nt),(dn.equals(R)===!1||Vn!==P)&&(i.blendColor(dn.r,dn.g,dn.b,Vn),R.copy(dn),P=Vn),E=Ce,F=!1}function Le(Ce,_t){Ce.side===Pi?xe(i.CULL_FACE):ge(i.CULL_FACE);let vt=Ce.side===ys;_t&&(vt=!vt),Te(vt),Ce.blending===Kd&&Ce.transparent===!1?Ae(gc):Ae(Ce.blending,Ce.blendEquation,Ce.blendSrc,Ce.blendDst,Ce.blendEquationAlpha,Ce.blendSrcAlpha,Ce.blendDstAlpha,Ce.blendColor,Ce.blendAlpha,Ce.premultipliedAlpha),l.setFunc(Ce.depthFunc),l.setTest(Ce.depthTest),l.setMask(Ce.depthWrite),a.setMask(Ce.colorWrite);const bt=Ce.stencilWrite;c.setTest(bt),bt&&(c.setMask(Ce.stencilWriteMask),c.setFunc(Ce.stencilFunc,Ce.stencilRef,Ce.stencilFuncMask),c.setOp(Ce.stencilFail,Ce.stencilZFail,Ce.stencilZPass)),de(Ce.polygonOffset,Ce.polygonOffsetFactor,Ce.polygonOffsetUnits),Ce.alphaToCoverage===!0?ge(i.SAMPLE_ALPHA_TO_COVERAGE):xe(i.SAMPLE_ALPHA_TO_COVERAGE)}function Te(Ce){k!==Ce&&(Ce?i.frontFace(i.CW):i.frontFace(i.CCW),k=Ce)}function ne(Ce){Ce!==FN?(ge(i.CULL_FACE),Ce!==z&&(Ce===qI?i.cullFace(i.BACK):Ce===ON?i.cullFace(i.FRONT):i.cullFace(i.FRONT_AND_BACK))):xe(i.CULL_FACE),z=Ce}function V(Ce){Ce!==U&&(X&&i.lineWidth(Ce),U=Ce)}function de(Ce,_t,vt){Ce?(ge(i.POLYGON_OFFSET_FILL),(W!==_t||$!==vt)&&(i.polygonOffset(_t,vt),W=_t,$=vt)):xe(i.POLYGON_OFFSET_FILL)}function Re(Ce){Ce?ge(i.SCISSOR_TEST):xe(i.SCISSOR_TEST)}function Be(Ce){Ce===void 0&&(Ce=i.TEXTURE0+oe-1),O!==Ce&&(i.activeTexture(Ce),O=Ce)}function Fe(Ce,_t,vt){vt===void 0&&(O===null?vt=i.TEXTURE0+oe-1:vt=O);let bt=K[vt];bt===void 0&&(bt={type:void 0,texture:void 0},K[vt]=bt),(bt.type!==Ce||bt.texture!==_t)&&(O!==vt&&(i.activeTexture(vt),O=vt),i.bindTexture(Ce,_t||se[Ce]),bt.type=Ce,bt.texture=_t)}function He(){const Ce=K[O];Ce!==void 0&&Ce.type!==void 0&&(i.bindTexture(Ce.type,null),Ce.type=void 0,Ce.texture=void 0)}function it(){try{i.compressedTexImage2D.apply(i,arguments)}catch(Ce){console.error("THREE.WebGLState:",Ce)}}function $e(){try{i.compressedTexImage3D.apply(i,arguments)}catch(Ce){console.error("THREE.WebGLState:",Ce)}}function ct(){try{i.texSubImage2D.apply(i,arguments)}catch(Ce){console.error("THREE.WebGLState:",Ce)}}function pt(){try{i.texSubImage3D.apply(i,arguments)}catch(Ce){console.error("THREE.WebGLState:",Ce)}}function We(){try{i.compressedTexSubImage2D.apply(i,arguments)}catch(Ce){console.error("THREE.WebGLState:",Ce)}}function Mt(){try{i.compressedTexSubImage3D.apply(i,arguments)}catch(Ce){console.error("THREE.WebGLState:",Ce)}}function Ft(){try{i.texStorage2D.apply(i,arguments)}catch(Ce){console.error("THREE.WebGLState:",Ce)}}function St(){try{i.texStorage3D.apply(i,arguments)}catch(Ce){console.error("THREE.WebGLState:",Ce)}}function gt(){try{i.texImage2D.apply(i,arguments)}catch(Ce){console.error("THREE.WebGLState:",Ce)}}function ft(){try{i.texImage3D.apply(i,arguments)}catch(Ce){console.error("THREE.WebGLState:",Ce)}}function be(Ce){J.equals(Ce)===!1&&(i.scissor(Ce.x,Ce.y,Ce.z,Ce.w),J.copy(Ce))}function qe(Ce){ie.equals(Ce)===!1&&(i.viewport(Ce.x,Ce.y,Ce.z,Ce.w),ie.copy(Ce))}function At(Ce,_t){let vt=h.get(_t);vt===void 0&&(vt=new WeakMap,h.set(_t,vt));let bt=vt.get(Ce);bt===void 0&&(bt=i.getUniformBlockIndex(_t,Ce.name),vt.set(Ce,bt))}function yt(Ce,_t){const bt=h.get(_t).get(Ce);u.get(_t)!==bt&&(i.uniformBlockBinding(_t,bt,Ce.__bindingPointIndex),u.set(_t,bt))}function De(){i.disable(i.BLEND),i.disable(i.CULL_FACE),i.disable(i.DEPTH_TEST),i.disable(i.POLYGON_OFFSET_FILL),i.disable(i.SCISSOR_TEST),i.disable(i.STENCIL_TEST),i.disable(i.SAMPLE_ALPHA_TO_COVERAGE),i.blendEquation(i.FUNC_ADD),i.blendFunc(i.ONE,i.ZERO),i.blendFuncSeparate(i.ONE,i.ZERO,i.ONE,i.ZERO),i.blendColor(0,0,0,0),i.colorMask(!0,!0,!0,!0),i.clearColor(0,0,0,0),i.depthMask(!0),i.depthFunc(i.LESS),i.clearDepth(1),i.stencilMask(4294967295),i.stencilFunc(i.ALWAYS,0,4294967295),i.stencilOp(i.KEEP,i.KEEP,i.KEEP),i.clearStencil(0),i.cullFace(i.BACK),i.frontFace(i.CCW),i.polygonOffset(0,0),i.activeTexture(i.TEXTURE0),i.bindFramebuffer(i.FRAMEBUFFER,null),n===!0&&(i.bindFramebuffer(i.DRAW_FRAMEBUFFER,null),i.bindFramebuffer(i.READ_FRAMEBUFFER,null)),i.useProgram(null),i.lineWidth(1),i.scissor(0,0,i.canvas.width,i.canvas.height),i.viewport(0,0,i.canvas.width,i.canvas.height),f={},O=null,K={},d={},m=new WeakMap,A=[],g=null,y=!1,E=null,x=null,C=null,T=null,I=null,M=null,L=null,R=new ut(0,0,0),P=0,F=!1,k=null,z=null,U=null,W=null,$=null,J.set(0,0,i.canvas.width,i.canvas.height),ie.set(0,0,i.canvas.width,i.canvas.height),a.reset(),l.reset(),c.reset()}return{buffers:{color:a,depth:l,stencil:c},enable:ge,disable:xe,bindFramebuffer:pe,drawBuffers:ce,useProgram:we,setBlending:Ae,setMaterial:Le,setFlipSided:Te,setCullFace:ne,setLineWidth:V,setPolygonOffset:de,setScissorTest:Re,activeTexture:Be,bindTexture:Fe,unbindTexture:He,compressedTexImage2D:it,compressedTexImage3D:$e,texImage2D:gt,texImage3D:ft,updateUBOMapping:At,uniformBlockBinding:yt,texStorage2D:Ft,texStorage3D:St,texSubImage2D:ct,texSubImage3D:pt,compressedTexSubImage2D:We,compressedTexSubImage3D:Mt,scissor:be,viewport:qe,reset:De}}function Dte(i,e,t,n,r,s,o){const a=r.isWebGL2,l=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,c=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),u=new WeakMap;let h;const f=new WeakMap;let d=!1;try{d=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function m(ne,V){return d?new OffscreenCanvas(ne,V):I2("canvas")}function A(ne,V,de,Re){let Be=1;if((ne.width>Re||ne.height>Re)&&(Be=Re/Math.max(ne.width,ne.height)),Be<1||V===!0)if(typeof HTMLImageElement<"u"&&ne instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&ne instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&ne instanceof ImageBitmap){const Fe=V?bS:Math.floor,He=Fe(Be*ne.width),it=Fe(Be*ne.height);h===void 0&&(h=m(He,it));const $e=de?m(He,it):h;return $e.width=He,$e.height=it,$e.getContext("2d").drawImage(ne,0,0,He,it),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+ne.width+"x"+ne.height+") to ("+He+"x"+it+")."),$e}else return"data"in ne&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+ne.width+"x"+ne.height+")."),ne;return ne}function g(ne){return wM(ne.width)&&wM(ne.height)}function y(ne){return a?!1:ne.wrapS!==ji||ne.wrapT!==ji||ne.minFilter!==zn&&ne.minFilter!==Pn}function E(ne,V){return ne.generateMipmaps&&V&&ne.minFilter!==zn&&ne.minFilter!==Pn}function x(ne){i.generateMipmap(ne)}function C(ne,V,de,Re,Be=!1){if(a===!1)return V;if(ne!==null){if(i[ne]!==void 0)return i[ne];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+ne+"'")}let Fe=V;if(V===i.RED&&(de===i.FLOAT&&(Fe=i.R32F),de===i.HALF_FLOAT&&(Fe=i.R16F),de===i.UNSIGNED_BYTE&&(Fe=i.R8)),V===i.RED_INTEGER&&(de===i.UNSIGNED_BYTE&&(Fe=i.R8UI),de===i.UNSIGNED_SHORT&&(Fe=i.R16UI),de===i.UNSIGNED_INT&&(Fe=i.R32UI),de===i.BYTE&&(Fe=i.R8I),de===i.SHORT&&(Fe=i.R16I),de===i.INT&&(Fe=i.R32I)),V===i.RG&&(de===i.FLOAT&&(Fe=i.RG32F),de===i.HALF_FLOAT&&(Fe=i.RG16F),de===i.UNSIGNED_BYTE&&(Fe=i.RG8)),V===i.RGBA){const He=Be?w2:Vi.getTransfer(Re);de===i.FLOAT&&(Fe=i.RGBA32F),de===i.HALF_FLOAT&&(Fe=i.RGBA16F),de===i.UNSIGNED_BYTE&&(Fe=He===mr?i.SRGB8_ALPHA8:i.RGBA8),de===i.UNSIGNED_SHORT_4_4_4_4&&(Fe=i.RGBA4),de===i.UNSIGNED_SHORT_5_5_5_1&&(Fe=i.RGB5_A1)}return(Fe===i.R16F||Fe===i.R32F||Fe===i.RG16F||Fe===i.RG32F||Fe===i.RGBA16F||Fe===i.RGBA32F)&&e.get("EXT_color_buffer_float"),Fe}function T(ne,V,de){return E(ne,de)===!0||ne.isFramebufferTexture&&ne.minFilter!==zn&&ne.minFilter!==Pn?Math.log2(Math.max(V.width,V.height))+1:ne.mipmaps!==void 0&&ne.mipmaps.length>0?ne.mipmaps.length:ne.isCompressedTexture&&Array.isArray(ne.image)?V.mipmaps.length:1}function I(ne){return ne===zn||ne===x2||ne===F1?i.NEAREST:i.LINEAR}function M(ne){const V=ne.target;V.removeEventListener("dispose",M),R(V),V.isVideoTexture&&u.delete(V)}function L(ne){const V=ne.target;V.removeEventListener("dispose",L),F(V)}function R(ne){const V=n.get(ne);if(V.__webglInit===void 0)return;const de=ne.source,Re=f.get(de);if(Re){const Be=Re[V.__cacheKey];Be.usedTimes--,Be.usedTimes===0&&P(ne),Object.keys(Re).length===0&&f.delete(de)}n.remove(ne)}function P(ne){const V=n.get(ne);i.deleteTexture(V.__webglTexture);const de=ne.source,Re=f.get(de);delete Re[V.__cacheKey],o.memory.textures--}function F(ne){const V=ne.texture,de=n.get(ne),Re=n.get(V);if(Re.__webglTexture!==void 0&&(i.deleteTexture(Re.__webglTexture),o.memory.textures--),ne.depthTexture&&ne.depthTexture.dispose(),ne.isWebGLCubeRenderTarget)for(let Be=0;Be<6;Be++){if(Array.isArray(de.__webglFramebuffer[Be]))for(let Fe=0;Fe<de.__webglFramebuffer[Be].length;Fe++)i.deleteFramebuffer(de.__webglFramebuffer[Be][Fe]);else i.deleteFramebuffer(de.__webglFramebuffer[Be]);de.__webglDepthbuffer&&i.deleteRenderbuffer(de.__webglDepthbuffer[Be])}else{if(Array.isArray(de.__webglFramebuffer))for(let Be=0;Be<de.__webglFramebuffer.length;Be++)i.deleteFramebuffer(de.__webglFramebuffer[Be]);else i.deleteFramebuffer(de.__webglFramebuffer);if(de.__webglDepthbuffer&&i.deleteRenderbuffer(de.__webglDepthbuffer),de.__webglMultisampledFramebuffer&&i.deleteFramebuffer(de.__webglMultisampledFramebuffer),de.__webglColorRenderbuffer)for(let Be=0;Be<de.__webglColorRenderbuffer.length;Be++)de.__webglColorRenderbuffer[Be]&&i.deleteRenderbuffer(de.__webglColorRenderbuffer[Be]);de.__webglDepthRenderbuffer&&i.deleteRenderbuffer(de.__webglDepthRenderbuffer)}if(ne.isWebGLMultipleRenderTargets)for(let Be=0,Fe=V.length;Be<Fe;Be++){const He=n.get(V[Be]);He.__webglTexture&&(i.deleteTexture(He.__webglTexture),o.memory.textures--),n.remove(V[Be])}n.remove(V),n.remove(ne)}let k=0;function z(){k=0}function U(){const ne=k;return ne>=r.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+ne+" texture units while this GPU supports only "+r.maxTextures),k+=1,ne}function W(ne){const V=[];return V.push(ne.wrapS),V.push(ne.wrapT),V.push(ne.wrapR||0),V.push(ne.magFilter),V.push(ne.minFilter),V.push(ne.anisotropy),V.push(ne.internalFormat),V.push(ne.format),V.push(ne.type),V.push(ne.generateMipmaps),V.push(ne.premultiplyAlpha),V.push(ne.flipY),V.push(ne.unpackAlignment),V.push(ne.colorSpace),V.join()}function $(ne,V){const de=n.get(ne);if(ne.isVideoTexture&&Le(ne),ne.isRenderTargetTexture===!1&&ne.version>0&&de.__version!==ne.version){const Re=ne.image;if(Re===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(Re.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{J(de,ne,V);return}}t.bindTexture(i.TEXTURE_2D,de.__webglTexture,i.TEXTURE0+V)}function oe(ne,V){const de=n.get(ne);if(ne.version>0&&de.__version!==ne.version){J(de,ne,V);return}t.bindTexture(i.TEXTURE_2D_ARRAY,de.__webglTexture,i.TEXTURE0+V)}function X(ne,V){const de=n.get(ne);if(ne.version>0&&de.__version!==ne.version){J(de,ne,V);return}t.bindTexture(i.TEXTURE_3D,de.__webglTexture,i.TEXTURE0+V)}function Q(ne,V){const de=n.get(ne);if(ne.version>0&&de.__version!==ne.version){ie(de,ne,V);return}t.bindTexture(i.TEXTURE_CUBE_MAP,de.__webglTexture,i.TEXTURE0+V)}const Y={[_o]:i.REPEAT,[ji]:i.CLAMP_TO_EDGE,[X1]:i.MIRRORED_REPEAT},O={[zn]:i.NEAREST,[x2]:i.NEAREST_MIPMAP_NEAREST,[F1]:i.NEAREST_MIPMAP_LINEAR,[Pn]:i.LINEAR,[gw]:i.LINEAR_MIPMAP_NEAREST,[Bl]:i.LINEAR_MIPMAP_LINEAR},K={[TU]:i.NEVER,[PU]:i.ALWAYS,[bU]:i.LESS,[v6]:i.LEQUAL,[IU]:i.EQUAL,[LU]:i.GEQUAL,[MU]:i.GREATER,[RU]:i.NOTEQUAL};function te(ne,V,de){if(de?(i.texParameteri(ne,i.TEXTURE_WRAP_S,Y[V.wrapS]),i.texParameteri(ne,i.TEXTURE_WRAP_T,Y[V.wrapT]),(ne===i.TEXTURE_3D||ne===i.TEXTURE_2D_ARRAY)&&i.texParameteri(ne,i.TEXTURE_WRAP_R,Y[V.wrapR]),i.texParameteri(ne,i.TEXTURE_MAG_FILTER,O[V.magFilter]),i.texParameteri(ne,i.TEXTURE_MIN_FILTER,O[V.minFilter])):(i.texParameteri(ne,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(ne,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),(ne===i.TEXTURE_3D||ne===i.TEXTURE_2D_ARRAY)&&i.texParameteri(ne,i.TEXTURE_WRAP_R,i.CLAMP_TO_EDGE),(V.wrapS!==ji||V.wrapT!==ji)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),i.texParameteri(ne,i.TEXTURE_MAG_FILTER,I(V.magFilter)),i.texParameteri(ne,i.TEXTURE_MIN_FILTER,I(V.minFilter)),V.minFilter!==zn&&V.minFilter!==Pn&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),V.compareFunction&&(i.texParameteri(ne,i.TEXTURE_COMPARE_MODE,i.COMPARE_REF_TO_TEXTURE),i.texParameteri(ne,i.TEXTURE_COMPARE_FUNC,K[V.compareFunction])),e.has("EXT_texture_filter_anisotropic")===!0){const Re=e.get("EXT_texture_filter_anisotropic");if(V.magFilter===zn||V.minFilter!==F1&&V.minFilter!==Bl||V.type===fi&&e.has("OES_texture_float_linear")===!1||a===!1&&V.type===Ni&&e.has("OES_texture_half_float_linear")===!1)return;(V.anisotropy>1||n.get(V).__currentAnisotropy)&&(i.texParameterf(ne,Re.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(V.anisotropy,r.getMaxAnisotropy())),n.get(V).__currentAnisotropy=V.anisotropy)}}function q(ne,V){let de=!1;ne.__webglInit===void 0&&(ne.__webglInit=!0,V.addEventListener("dispose",M));const Re=V.source;let Be=f.get(Re);Be===void 0&&(Be={},f.set(Re,Be));const Fe=W(V);if(Fe!==ne.__cacheKey){Be[Fe]===void 0&&(Be[Fe]={texture:i.createTexture(),usedTimes:0},o.memory.textures++,de=!0),Be[Fe].usedTimes++;const He=Be[ne.__cacheKey];He!==void 0&&(Be[ne.__cacheKey].usedTimes--,He.usedTimes===0&&P(V)),ne.__cacheKey=Fe,ne.__webglTexture=Be[Fe].texture}return de}function J(ne,V,de){let Re=i.TEXTURE_2D;(V.isDataArrayTexture||V.isCompressedArrayTexture)&&(Re=i.TEXTURE_2D_ARRAY),V.isData3DTexture&&(Re=i.TEXTURE_3D);const Be=q(ne,V),Fe=V.source;t.bindTexture(Re,ne.__webglTexture,i.TEXTURE0+de);const He=n.get(Fe);if(Fe.version!==He.__version||Be===!0){t.activeTexture(i.TEXTURE0+de);const it=Vi.getPrimaries(Vi.workingColorSpace),$e=V.colorSpace===Tl?null:Vi.getPrimaries(V.colorSpace),ct=V.colorSpace===Tl||it===$e?i.NONE:i.BROWSER_DEFAULT_WEBGL;i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,V.flipY),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,V.premultiplyAlpha),i.pixelStorei(i.UNPACK_ALIGNMENT,V.unpackAlignment),i.pixelStorei(i.UNPACK_COLORSPACE_CONVERSION_WEBGL,ct);const pt=y(V)&&g(V.image)===!1;let We=A(V.image,pt,!1,r.maxTextureSize);We=Te(V,We);const Mt=g(We)||a,Ft=s.convert(V.format,V.colorSpace);let St=s.convert(V.type),gt=C(V.internalFormat,Ft,St,V.colorSpace,V.isVideoTexture);te(Re,V,Mt);let ft;const be=V.mipmaps,qe=a&&V.isVideoTexture!==!0&&gt!==vw,At=He.__version===void 0||Be===!0,yt=T(V,We,Mt);if(V.isDepthTexture)gt=i.DEPTH_COMPONENT,a?V.type===fi?gt=i.DEPTH_COMPONENT32F:V.type===Zo?gt=i.DEPTH_COMPONENT24:V.type===$d?gt=i.DEPTH24_STENCIL8:gt=i.DEPTH_COMPONENT16:V.type===fi&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),V.format===vu&&gt===i.DEPTH_COMPONENT&&V.type!==pp&&V.type!==Zo&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),V.type=Zo,St=s.convert(V.type)),V.format===Xm&&gt===i.DEPTH_COMPONENT&&(gt=i.DEPTH_STENCIL,V.type!==$d&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),V.type=$d,St=s.convert(V.type))),At&&(qe?t.texStorage2D(i.TEXTURE_2D,1,gt,We.width,We.height):t.texImage2D(i.TEXTURE_2D,0,gt,We.width,We.height,0,Ft,St,null));else if(V.isDataTexture)if(be.length>0&&Mt){qe&&At&&t.texStorage2D(i.TEXTURE_2D,yt,gt,be[0].width,be[0].height);for(let De=0,Ce=be.length;De<Ce;De++)ft=be[De],qe?t.texSubImage2D(i.TEXTURE_2D,De,0,0,ft.width,ft.height,Ft,St,ft.data):t.texImage2D(i.TEXTURE_2D,De,gt,ft.width,ft.height,0,Ft,St,ft.data);V.generateMipmaps=!1}else qe?(At&&t.texStorage2D(i.TEXTURE_2D,yt,gt,We.width,We.height),t.texSubImage2D(i.TEXTURE_2D,0,0,0,We.width,We.height,Ft,St,We.data)):t.texImage2D(i.TEXTURE_2D,0,gt,We.width,We.height,0,Ft,St,We.data);else if(V.isCompressedTexture)if(V.isCompressedArrayTexture){qe&&At&&t.texStorage3D(i.TEXTURE_2D_ARRAY,yt,gt,be[0].width,be[0].height,We.depth);for(let De=0,Ce=be.length;De<Ce;De++)ft=be[De],V.format!==gi?Ft!==null?qe?t.compressedTexSubImage3D(i.TEXTURE_2D_ARRAY,De,0,0,0,ft.width,ft.height,We.depth,Ft,ft.data,0,0):t.compressedTexImage3D(i.TEXTURE_2D_ARRAY,De,gt,ft.width,ft.height,We.depth,0,ft.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):qe?t.texSubImage3D(i.TEXTURE_2D_ARRAY,De,0,0,0,ft.width,ft.height,We.depth,Ft,St,ft.data):t.texImage3D(i.TEXTURE_2D_ARRAY,De,gt,ft.width,ft.height,We.depth,0,Ft,St,ft.data)}else{qe&&At&&t.texStorage2D(i.TEXTURE_2D,yt,gt,be[0].width,be[0].height);for(let De=0,Ce=be.length;De<Ce;De++)ft=be[De],V.format!==gi?Ft!==null?qe?t.compressedTexSubImage2D(i.TEXTURE_2D,De,0,0,ft.width,ft.height,Ft,ft.data):t.compressedTexImage2D(i.TEXTURE_2D,De,gt,ft.width,ft.height,0,ft.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):qe?t.texSubImage2D(i.TEXTURE_2D,De,0,0,ft.width,ft.height,Ft,St,ft.data):t.texImage2D(i.TEXTURE_2D,De,gt,ft.width,ft.height,0,Ft,St,ft.data)}else if(V.isDataArrayTexture)qe?(At&&t.texStorage3D(i.TEXTURE_2D_ARRAY,yt,gt,We.width,We.height,We.depth),t.texSubImage3D(i.TEXTURE_2D_ARRAY,0,0,0,0,We.width,We.height,We.depth,Ft,St,We.data)):t.texImage3D(i.TEXTURE_2D_ARRAY,0,gt,We.width,We.height,We.depth,0,Ft,St,We.data);else if(V.isData3DTexture)qe?(At&&t.texStorage3D(i.TEXTURE_3D,yt,gt,We.width,We.height,We.depth),t.texSubImage3D(i.TEXTURE_3D,0,0,0,0,We.width,We.height,We.depth,Ft,St,We.data)):t.texImage3D(i.TEXTURE_3D,0,gt,We.width,We.height,We.depth,0,Ft,St,We.data);else if(V.isFramebufferTexture){if(At)if(qe)t.texStorage2D(i.TEXTURE_2D,yt,gt,We.width,We.height);else{let De=We.width,Ce=We.height;for(let _t=0;_t<yt;_t++)t.texImage2D(i.TEXTURE_2D,_t,gt,De,Ce,0,Ft,St,null),De>>=1,Ce>>=1}}else if(be.length>0&&Mt){qe&&At&&t.texStorage2D(i.TEXTURE_2D,yt,gt,be[0].width,be[0].height);for(let De=0,Ce=be.length;De<Ce;De++)ft=be[De],qe?t.texSubImage2D(i.TEXTURE_2D,De,0,0,Ft,St,ft):t.texImage2D(i.TEXTURE_2D,De,gt,Ft,St,ft);V.generateMipmaps=!1}else qe?(At&&t.texStorage2D(i.TEXTURE_2D,yt,gt,We.width,We.height),t.texSubImage2D(i.TEXTURE_2D,0,0,0,Ft,St,We)):t.texImage2D(i.TEXTURE_2D,0,gt,Ft,St,We);E(V,Mt)&&x(Re),He.__version=Fe.version,V.onUpdate&&V.onUpdate(V)}ne.__version=V.version}function ie(ne,V,de){if(V.image.length!==6)return;const Re=q(ne,V),Be=V.source;t.bindTexture(i.TEXTURE_CUBE_MAP,ne.__webglTexture,i.TEXTURE0+de);const Fe=n.get(Be);if(Be.version!==Fe.__version||Re===!0){t.activeTexture(i.TEXTURE0+de);const He=Vi.getPrimaries(Vi.workingColorSpace),it=V.colorSpace===Tl?null:Vi.getPrimaries(V.colorSpace),$e=V.colorSpace===Tl||He===it?i.NONE:i.BROWSER_DEFAULT_WEBGL;i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,V.flipY),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,V.premultiplyAlpha),i.pixelStorei(i.UNPACK_ALIGNMENT,V.unpackAlignment),i.pixelStorei(i.UNPACK_COLORSPACE_CONVERSION_WEBGL,$e);const ct=V.isCompressedTexture||V.image[0].isCompressedTexture,pt=V.image[0]&&V.image[0].isDataTexture,We=[];for(let De=0;De<6;De++)!ct&&!pt?We[De]=A(V.image[De],!1,!0,r.maxCubemapSize):We[De]=pt?V.image[De].image:V.image[De],We[De]=Te(V,We[De]);const Mt=We[0],Ft=g(Mt)||a,St=s.convert(V.format,V.colorSpace),gt=s.convert(V.type),ft=C(V.internalFormat,St,gt,V.colorSpace),be=a&&V.isVideoTexture!==!0,qe=Fe.__version===void 0||Re===!0;let At=T(V,Mt,Ft);te(i.TEXTURE_CUBE_MAP,V,Ft);let yt;if(ct){be&&qe&&t.texStorage2D(i.TEXTURE_CUBE_MAP,At,ft,Mt.width,Mt.height);for(let De=0;De<6;De++){yt=We[De].mipmaps;for(let Ce=0;Ce<yt.length;Ce++){const _t=yt[Ce];V.format!==gi?St!==null?be?t.compressedTexSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+De,Ce,0,0,_t.width,_t.height,St,_t.data):t.compressedTexImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+De,Ce,ft,_t.width,_t.height,0,_t.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):be?t.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+De,Ce,0,0,_t.width,_t.height,St,gt,_t.data):t.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+De,Ce,ft,_t.width,_t.height,0,St,gt,_t.data)}}}else{yt=V.mipmaps,be&&qe&&(yt.length>0&&At++,t.texStorage2D(i.TEXTURE_CUBE_MAP,At,ft,We[0].width,We[0].height));for(let De=0;De<6;De++)if(pt){be?t.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+De,0,0,0,We[De].width,We[De].height,St,gt,We[De].data):t.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+De,0,ft,We[De].width,We[De].height,0,St,gt,We[De].data);for(let Ce=0;Ce<yt.length;Ce++){const vt=yt[Ce].image[De].image;be?t.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+De,Ce+1,0,0,vt.width,vt.height,St,gt,vt.data):t.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+De,Ce+1,ft,vt.width,vt.height,0,St,gt,vt.data)}}else{be?t.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+De,0,0,0,St,gt,We[De]):t.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+De,0,ft,St,gt,We[De]);for(let Ce=0;Ce<yt.length;Ce++){const _t=yt[Ce];be?t.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+De,Ce+1,0,0,St,gt,_t.image[De]):t.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+De,Ce+1,ft,St,gt,_t.image[De])}}}E(V,Ft)&&x(i.TEXTURE_CUBE_MAP),Fe.__version=Be.version,V.onUpdate&&V.onUpdate(V)}ne.__version=V.version}function re(ne,V,de,Re,Be,Fe){const He=s.convert(de.format,de.colorSpace),it=s.convert(de.type),$e=C(de.internalFormat,He,it,de.colorSpace);if(!n.get(V).__hasExternalTextures){const pt=Math.max(1,V.width>>Fe),We=Math.max(1,V.height>>Fe);Be===i.TEXTURE_3D||Be===i.TEXTURE_2D_ARRAY?t.texImage3D(Be,Fe,$e,pt,We,V.depth,0,He,it,null):t.texImage2D(Be,Fe,$e,pt,We,0,He,it,null)}t.bindFramebuffer(i.FRAMEBUFFER,ne),Ae(V)?l.framebufferTexture2DMultisampleEXT(i.FRAMEBUFFER,Re,Be,n.get(de).__webglTexture,0,ve(V)):(Be===i.TEXTURE_2D||Be>=i.TEXTURE_CUBE_MAP_POSITIVE_X&&Be<=i.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&i.framebufferTexture2D(i.FRAMEBUFFER,Re,Be,n.get(de).__webglTexture,Fe),t.bindFramebuffer(i.FRAMEBUFFER,null)}function se(ne,V,de){if(i.bindRenderbuffer(i.RENDERBUFFER,ne),V.depthBuffer&&!V.stencilBuffer){let Re=a===!0?i.DEPTH_COMPONENT24:i.DEPTH_COMPONENT16;if(de||Ae(V)){const Be=V.depthTexture;Be&&Be.isDepthTexture&&(Be.type===fi?Re=i.DEPTH_COMPONENT32F:Be.type===Zo&&(Re=i.DEPTH_COMPONENT24));const Fe=ve(V);Ae(V)?l.renderbufferStorageMultisampleEXT(i.RENDERBUFFER,Fe,Re,V.width,V.height):i.renderbufferStorageMultisample(i.RENDERBUFFER,Fe,Re,V.width,V.height)}else i.renderbufferStorage(i.RENDERBUFFER,Re,V.width,V.height);i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.RENDERBUFFER,ne)}else if(V.depthBuffer&&V.stencilBuffer){const Re=ve(V);de&&Ae(V)===!1?i.renderbufferStorageMultisample(i.RENDERBUFFER,Re,i.DEPTH24_STENCIL8,V.width,V.height):Ae(V)?l.renderbufferStorageMultisampleEXT(i.RENDERBUFFER,Re,i.DEPTH24_STENCIL8,V.width,V.height):i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_STENCIL,V.width,V.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.RENDERBUFFER,ne)}else{const Re=V.isWebGLMultipleRenderTargets===!0?V.texture:[V.texture];for(let Be=0;Be<Re.length;Be++){const Fe=Re[Be],He=s.convert(Fe.format,Fe.colorSpace),it=s.convert(Fe.type),$e=C(Fe.internalFormat,He,it,Fe.colorSpace),ct=ve(V);de&&Ae(V)===!1?i.renderbufferStorageMultisample(i.RENDERBUFFER,ct,$e,V.width,V.height):Ae(V)?l.renderbufferStorageMultisampleEXT(i.RENDERBUFFER,ct,$e,V.width,V.height):i.renderbufferStorage(i.RENDERBUFFER,$e,V.width,V.height)}}i.bindRenderbuffer(i.RENDERBUFFER,null)}function ge(ne,V){if(V&&V.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(i.FRAMEBUFFER,ne),!(V.depthTexture&&V.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!n.get(V.depthTexture).__webglTexture||V.depthTexture.image.width!==V.width||V.depthTexture.image.height!==V.height)&&(V.depthTexture.image.width=V.width,V.depthTexture.image.height=V.height,V.depthTexture.needsUpdate=!0),$(V.depthTexture,0);const Re=n.get(V.depthTexture).__webglTexture,Be=ve(V);if(V.depthTexture.format===vu)Ae(V)?l.framebufferTexture2DMultisampleEXT(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.TEXTURE_2D,Re,0,Be):i.framebufferTexture2D(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.TEXTURE_2D,Re,0);else if(V.depthTexture.format===Xm)Ae(V)?l.framebufferTexture2DMultisampleEXT(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.TEXTURE_2D,Re,0,Be):i.framebufferTexture2D(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.TEXTURE_2D,Re,0);else throw new Error("Unknown depthTexture format")}function xe(ne){const V=n.get(ne),de=ne.isWebGLCubeRenderTarget===!0;if(ne.depthTexture&&!V.__autoAllocateDepthBuffer){if(de)throw new Error("target.depthTexture not supported in Cube render targets");ge(V.__webglFramebuffer,ne)}else if(de){V.__webglDepthbuffer=[];for(let Re=0;Re<6;Re++)t.bindFramebuffer(i.FRAMEBUFFER,V.__webglFramebuffer[Re]),V.__webglDepthbuffer[Re]=i.createRenderbuffer(),se(V.__webglDepthbuffer[Re],ne,!1)}else t.bindFramebuffer(i.FRAMEBUFFER,V.__webglFramebuffer),V.__webglDepthbuffer=i.createRenderbuffer(),se(V.__webglDepthbuffer,ne,!1);t.bindFramebuffer(i.FRAMEBUFFER,null)}function pe(ne,V,de){const Re=n.get(ne);V!==void 0&&re(Re.__webglFramebuffer,ne,ne.texture,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,0),de!==void 0&&xe(ne)}function ce(ne){const V=ne.texture,de=n.get(ne),Re=n.get(V);ne.addEventListener("dispose",L),ne.isWebGLMultipleRenderTargets!==!0&&(Re.__webglTexture===void 0&&(Re.__webglTexture=i.createTexture()),Re.__version=V.version,o.memory.textures++);const Be=ne.isWebGLCubeRenderTarget===!0,Fe=ne.isWebGLMultipleRenderTargets===!0,He=g(ne)||a;if(Be){de.__webglFramebuffer=[];for(let it=0;it<6;it++)if(a&&V.mipmaps&&V.mipmaps.length>0){de.__webglFramebuffer[it]=[];for(let $e=0;$e<V.mipmaps.length;$e++)de.__webglFramebuffer[it][$e]=i.createFramebuffer()}else de.__webglFramebuffer[it]=i.createFramebuffer()}else{if(a&&V.mipmaps&&V.mipmaps.length>0){de.__webglFramebuffer=[];for(let it=0;it<V.mipmaps.length;it++)de.__webglFramebuffer[it]=i.createFramebuffer()}else de.__webglFramebuffer=i.createFramebuffer();if(Fe)if(r.drawBuffers){const it=ne.texture;for(let $e=0,ct=it.length;$e<ct;$e++){const pt=n.get(it[$e]);pt.__webglTexture===void 0&&(pt.__webglTexture=i.createTexture(),o.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(a&&ne.samples>0&&Ae(ne)===!1){const it=Fe?V:[V];de.__webglMultisampledFramebuffer=i.createFramebuffer(),de.__webglColorRenderbuffer=[],t.bindFramebuffer(i.FRAMEBUFFER,de.__webglMultisampledFramebuffer);for(let $e=0;$e<it.length;$e++){const ct=it[$e];de.__webglColorRenderbuffer[$e]=i.createRenderbuffer(),i.bindRenderbuffer(i.RENDERBUFFER,de.__webglColorRenderbuffer[$e]);const pt=s.convert(ct.format,ct.colorSpace),We=s.convert(ct.type),Mt=C(ct.internalFormat,pt,We,ct.colorSpace,ne.isXRRenderTarget===!0),Ft=ve(ne);i.renderbufferStorageMultisample(i.RENDERBUFFER,Ft,Mt,ne.width,ne.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+$e,i.RENDERBUFFER,de.__webglColorRenderbuffer[$e])}i.bindRenderbuffer(i.RENDERBUFFER,null),ne.depthBuffer&&(de.__webglDepthRenderbuffer=i.createRenderbuffer(),se(de.__webglDepthRenderbuffer,ne,!0)),t.bindFramebuffer(i.FRAMEBUFFER,null)}}if(Be){t.bindTexture(i.TEXTURE_CUBE_MAP,Re.__webglTexture),te(i.TEXTURE_CUBE_MAP,V,He);for(let it=0;it<6;it++)if(a&&V.mipmaps&&V.mipmaps.length>0)for(let $e=0;$e<V.mipmaps.length;$e++)re(de.__webglFramebuffer[it][$e],ne,V,i.COLOR_ATTACHMENT0,i.TEXTURE_CUBE_MAP_POSITIVE_X+it,$e);else re(de.__webglFramebuffer[it],ne,V,i.COLOR_ATTACHMENT0,i.TEXTURE_CUBE_MAP_POSITIVE_X+it,0);E(V,He)&&x(i.TEXTURE_CUBE_MAP),t.unbindTexture()}else if(Fe){const it=ne.texture;for(let $e=0,ct=it.length;$e<ct;$e++){const pt=it[$e],We=n.get(pt);t.bindTexture(i.TEXTURE_2D,We.__webglTexture),te(i.TEXTURE_2D,pt,He),re(de.__webglFramebuffer,ne,pt,i.COLOR_ATTACHMENT0+$e,i.TEXTURE_2D,0),E(pt,He)&&x(i.TEXTURE_2D)}t.unbindTexture()}else{let it=i.TEXTURE_2D;if((ne.isWebGL3DRenderTarget||ne.isWebGLArrayRenderTarget)&&(a?it=ne.isWebGL3DRenderTarget?i.TEXTURE_3D:i.TEXTURE_2D_ARRAY:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),t.bindTexture(it,Re.__webglTexture),te(it,V,He),a&&V.mipmaps&&V.mipmaps.length>0)for(let $e=0;$e<V.mipmaps.length;$e++)re(de.__webglFramebuffer[$e],ne,V,i.COLOR_ATTACHMENT0,it,$e);else re(de.__webglFramebuffer,ne,V,i.COLOR_ATTACHMENT0,it,0);E(V,He)&&x(it),t.unbindTexture()}ne.depthBuffer&&xe(ne)}function we(ne){const V=g(ne)||a,de=ne.isWebGLMultipleRenderTargets===!0?ne.texture:[ne.texture];for(let Re=0,Be=de.length;Re<Be;Re++){const Fe=de[Re];if(E(Fe,V)){const He=ne.isWebGLCubeRenderTarget?i.TEXTURE_CUBE_MAP:i.TEXTURE_2D,it=n.get(Fe).__webglTexture;t.bindTexture(He,it),x(He),t.unbindTexture()}}}function Ee(ne){if(a&&ne.samples>0&&Ae(ne)===!1){const V=ne.isWebGLMultipleRenderTargets?ne.texture:[ne.texture],de=ne.width,Re=ne.height;let Be=i.COLOR_BUFFER_BIT;const Fe=[],He=ne.stencilBuffer?i.DEPTH_STENCIL_ATTACHMENT:i.DEPTH_ATTACHMENT,it=n.get(ne),$e=ne.isWebGLMultipleRenderTargets===!0;if($e)for(let ct=0;ct<V.length;ct++)t.bindFramebuffer(i.FRAMEBUFFER,it.__webglMultisampledFramebuffer),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+ct,i.RENDERBUFFER,null),t.bindFramebuffer(i.FRAMEBUFFER,it.__webglFramebuffer),i.framebufferTexture2D(i.DRAW_FRAMEBUFFER,i.COLOR_ATTACHMENT0+ct,i.TEXTURE_2D,null,0);t.bindFramebuffer(i.READ_FRAMEBUFFER,it.__webglMultisampledFramebuffer),t.bindFramebuffer(i.DRAW_FRAMEBUFFER,it.__webglFramebuffer);for(let ct=0;ct<V.length;ct++){Fe.push(i.COLOR_ATTACHMENT0+ct),ne.depthBuffer&&Fe.push(He);const pt=it.__ignoreDepthValues!==void 0?it.__ignoreDepthValues:!1;if(pt===!1&&(ne.depthBuffer&&(Be|=i.DEPTH_BUFFER_BIT),ne.stencilBuffer&&(Be|=i.STENCIL_BUFFER_BIT)),$e&&i.framebufferRenderbuffer(i.READ_FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.RENDERBUFFER,it.__webglColorRenderbuffer[ct]),pt===!0&&(i.invalidateFramebuffer(i.READ_FRAMEBUFFER,[He]),i.invalidateFramebuffer(i.DRAW_FRAMEBUFFER,[He])),$e){const We=n.get(V[ct]).__webglTexture;i.framebufferTexture2D(i.DRAW_FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,We,0)}i.blitFramebuffer(0,0,de,Re,0,0,de,Re,Be,i.NEAREST),c&&i.invalidateFramebuffer(i.READ_FRAMEBUFFER,Fe)}if(t.bindFramebuffer(i.READ_FRAMEBUFFER,null),t.bindFramebuffer(i.DRAW_FRAMEBUFFER,null),$e)for(let ct=0;ct<V.length;ct++){t.bindFramebuffer(i.FRAMEBUFFER,it.__webglMultisampledFramebuffer),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+ct,i.RENDERBUFFER,it.__webglColorRenderbuffer[ct]);const pt=n.get(V[ct]).__webglTexture;t.bindFramebuffer(i.FRAMEBUFFER,it.__webglFramebuffer),i.framebufferTexture2D(i.DRAW_FRAMEBUFFER,i.COLOR_ATTACHMENT0+ct,i.TEXTURE_2D,pt,0)}t.bindFramebuffer(i.DRAW_FRAMEBUFFER,it.__webglMultisampledFramebuffer)}}function ve(ne){return Math.min(r.maxSamples,ne.samples)}function Ae(ne){const V=n.get(ne);return a&&ne.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&V.__useRenderToTexture!==!1}function Le(ne){const V=o.render.frame;u.get(ne)!==V&&(u.set(ne,V),ne.update())}function Te(ne,V){const de=ne.colorSpace,Re=ne.format,Be=ne.type;return ne.isCompressedTexture===!0||ne.isVideoTexture===!0||ne.format===TS||de!==Dl&&de!==Tl&&(Vi.getTransfer(de)===mr?a===!1?e.has("EXT_sRGB")===!0&&Re===gi?(ne.format=TS,ne.minFilter=Pn,ne.generateMipmaps=!1):V=E6.sRGBToLinear(V):(Re!==gi||Be!==Zi)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",de)),V}this.allocateTextureUnit=U,this.resetTextureUnits=z,this.setTexture2D=$,this.setTexture2DArray=oe,this.setTexture3D=X,this.setTextureCube=Q,this.rebindTextures=pe,this.setupRenderTarget=ce,this.updateRenderTargetMipmap=we,this.updateMultisampleRenderTarget=Ee,this.setupDepthRenderbuffer=xe,this.setupFrameBufferTexture=re,this.useMultisampledRTT=Ae}function VU(i,e,t){const n=t.isWebGL2;function r(s,o=Tl){let a;const l=Vi.getTransfer(o);if(s===Zi)return i.UNSIGNED_BYTE;if(s===p6)return i.UNSIGNED_SHORT_4_4_4_4;if(s===m6)return i.UNSIGNED_SHORT_5_5_5_1;if(s===E2)return i.BYTE;if(s===Aw)return i.SHORT;if(s===pp)return i.UNSIGNED_SHORT;if(s===Nm)return i.INT;if(s===Zo)return i.UNSIGNED_INT;if(s===fi)return i.FLOAT;if(s===Ni)return n?i.HALF_FLOAT:(a=e.get("OES_texture_half_float"),a!==null?a.HALF_FLOAT_OES:null);if(s===pU)return i.ALPHA;if(s===gi)return i.RGBA;if(s===mU)return i.LUMINANCE;if(s===gU)return i.LUMINANCE_ALPHA;if(s===vu)return i.DEPTH_COMPONENT;if(s===Xm)return i.DEPTH_STENCIL;if(s===TS)return a=e.get("EXT_sRGB"),a!==null?a.SRGB_ALPHA_EXT:null;if(s===hc)return i.RED;if(s===yw)return i.RED_INTEGER;if(s===Gd)return i.RG;if(s===tx)return i.RG_INTEGER;if(s===qm)return i.RGBA_INTEGER;if(s===Wv||s===z_||s===G_||s===jv)if(l===mr)if(a=e.get("WEBGL_compressed_texture_s3tc_srgb"),a!==null){if(s===Wv)return a.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(s===z_)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(s===G_)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(s===jv)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(a=e.get("WEBGL_compressed_texture_s3tc"),a!==null){if(s===Wv)return a.COMPRESSED_RGB_S3TC_DXT1_EXT;if(s===z_)return a.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(s===G_)return a.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(s===jv)return a.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(s===vS||s===rM||s===xS||s===sM)if(a=e.get("WEBGL_compressed_texture_pvrtc"),a!==null){if(s===vS)return a.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(s===rM)return a.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(s===xS)return a.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(s===sM)return a.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(s===vw)return a=e.get("WEBGL_compressed_texture_etc1"),a!==null?a.COMPRESSED_RGB_ETC1_WEBGL:null;if(s===ES||s===_S)if(a=e.get("WEBGL_compressed_texture_etc"),a!==null){if(s===ES)return l===mr?a.COMPRESSED_SRGB8_ETC2:a.COMPRESSED_RGB8_ETC2;if(s===_S)return l===mr?a.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:a.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(s===SS||s===oM||s===aM||s===lM||s===_2||s===cM||s===uM||s===hM||s===fM||s===dM||s===pM||s===mM||s===gM||s===AM)if(a=e.get("WEBGL_compressed_texture_astc"),a!==null){if(s===SS)return l===mr?a.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:a.COMPRESSED_RGBA_ASTC_4x4_KHR;if(s===oM)return l===mr?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:a.COMPRESSED_RGBA_ASTC_5x4_KHR;if(s===aM)return l===mr?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:a.COMPRESSED_RGBA_ASTC_5x5_KHR;if(s===lM)return l===mr?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:a.COMPRESSED_RGBA_ASTC_6x5_KHR;if(s===_2)return l===mr?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:a.COMPRESSED_RGBA_ASTC_6x6_KHR;if(s===cM)return l===mr?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:a.COMPRESSED_RGBA_ASTC_8x5_KHR;if(s===uM)return l===mr?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:a.COMPRESSED_RGBA_ASTC_8x6_KHR;if(s===hM)return l===mr?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:a.COMPRESSED_RGBA_ASTC_8x8_KHR;if(s===fM)return l===mr?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:a.COMPRESSED_RGBA_ASTC_10x5_KHR;if(s===dM)return l===mr?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:a.COMPRESSED_RGBA_ASTC_10x6_KHR;if(s===pM)return l===mr?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:a.COMPRESSED_RGBA_ASTC_10x8_KHR;if(s===mM)return l===mr?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:a.COMPRESSED_RGBA_ASTC_10x10_KHR;if(s===gM)return l===mr?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:a.COMPRESSED_RGBA_ASTC_12x10_KHR;if(s===AM)return l===mr?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:a.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(s===Kv||s===yM||s===vM)if(a=e.get("EXT_texture_compression_bptc"),a!==null){if(s===Kv)return l===mr?a.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:a.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(s===yM)return a.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(s===vM)return a.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}else return null;if(s===AU||s===xM||s===EM||s===_M)if(a=e.get("EXT_texture_compression_rgtc"),a!==null){if(s===Kv)return a.COMPRESSED_RED_RGTC1_EXT;if(s===xM)return a.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(s===EM)return a.COMPRESSED_RED_GREEN_RGTC2_EXT;if(s===_M)return a.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return s===$d?n?i.UNSIGNED_INT_24_8:(a=e.get("WEBGL_depth_texture"),a!==null?a.UNSIGNED_INT_24_8_WEBGL:null):i[s]!==void 0?i[s]:null}return{convert:r}}class WU extends Wn{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}}class xa extends _n{constructor(){super(),this.isGroup=!0,this.type="Group"}}const kte={type:"move"};class lT{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new xa,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new xa,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new H,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new H),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new xa,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new H,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new H),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const n of e.hand.values())this._getHandJoint(t,n)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,n){let r=null,s=null,o=null;const a=this._targetRay,l=this._grip,c=this._hand;if(e&&t.session.visibilityState!=="visible-blurred"){if(c&&e.hand){o=!0;for(const A of e.hand.values()){const g=t.getJointPose(A,n),y=this._getHandJoint(c,A);g!==null&&(y.matrix.fromArray(g.transform.matrix),y.matrix.decompose(y.position,y.rotation,y.scale),y.matrixWorldNeedsUpdate=!0,y.jointRadius=g.radius),y.visible=g!==null}const u=c.joints["index-finger-tip"],h=c.joints["thumb-tip"],f=u.position.distanceTo(h.position),d=.02,m=.005;c.inputState.pinching&&f>d+m?(c.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!c.inputState.pinching&&f<=d-m&&(c.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else l!==null&&e.gripSpace&&(s=t.getPose(e.gripSpace,n),s!==null&&(l.matrix.fromArray(s.transform.matrix),l.matrix.decompose(l.position,l.rotation,l.scale),l.matrixWorldNeedsUpdate=!0,s.linearVelocity?(l.hasLinearVelocity=!0,l.linearVelocity.copy(s.linearVelocity)):l.hasLinearVelocity=!1,s.angularVelocity?(l.hasAngularVelocity=!0,l.angularVelocity.copy(s.angularVelocity)):l.hasAngularVelocity=!1));a!==null&&(r=t.getPose(e.targetRaySpace,n),r===null&&s!==null&&(r=s),r!==null&&(a.matrix.fromArray(r.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),a.matrixWorldNeedsUpdate=!0,r.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(r.linearVelocity)):a.hasLinearVelocity=!1,r.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(r.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(kte)))}return a!==null&&(a.visible=r!==null),l!==null&&(l.visible=s!==null),c!==null&&(c.visible=o!==null),this}_getHandJoint(e,t){if(e.joints[t.jointName]===void 0){const n=new xa;n.matrixAutoUpdate=!1,n.visible=!1,e.joints[t.jointName]=n,e.add(n)}return e.joints[t.jointName]}}class Fte extends Ch{constructor(e,t){super();const n=this;let r=null,s=1,o=null,a="local-floor",l=1,c=null,u=null,h=null,f=null,d=null,m=null;const A=t.getContextAttributes();let g=null,y=null;const E=[],x=[],C=new Ue;let T=null;const I=new Wn;I.layers.enable(1),I.viewport=new Rn;const M=new Wn;M.layers.enable(2),M.viewport=new Rn;const L=[I,M],R=new WU;R.layers.enable(1),R.layers.enable(2);let P=null,F=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(te){let q=E[te];return q===void 0&&(q=new lT,E[te]=q),q.getTargetRaySpace()},this.getControllerGrip=function(te){let q=E[te];return q===void 0&&(q=new lT,E[te]=q),q.getGripSpace()},this.getHand=function(te){let q=E[te];return q===void 0&&(q=new lT,E[te]=q),q.getHandSpace()};function k(te){const q=x.indexOf(te.inputSource);if(q===-1)return;const J=E[q];J!==void 0&&(J.update(te.inputSource,te.frame,c||o),J.dispatchEvent({type:te.type,data:te.inputSource}))}function z(){r.removeEventListener("select",k),r.removeEventListener("selectstart",k),r.removeEventListener("selectend",k),r.removeEventListener("squeeze",k),r.removeEventListener("squeezestart",k),r.removeEventListener("squeezeend",k),r.removeEventListener("end",z),r.removeEventListener("inputsourceschange",U);for(let te=0;te<E.length;te++){const q=x[te];q!==null&&(x[te]=null,E[te].disconnect(q))}P=null,F=null,e.setRenderTarget(g),d=null,f=null,h=null,r=null,y=null,K.stop(),n.isPresenting=!1,e.setPixelRatio(T),e.setSize(C.width,C.height,!1),n.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(te){s=te,n.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(te){a=te,n.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return c||o},this.setReferenceSpace=function(te){c=te},this.getBaseLayer=function(){return f!==null?f:d},this.getBinding=function(){return h},this.getFrame=function(){return m},this.getSession=function(){return r},this.setSession=async function(te){if(r=te,r!==null){if(g=e.getRenderTarget(),r.addEventListener("select",k),r.addEventListener("selectstart",k),r.addEventListener("selectend",k),r.addEventListener("squeeze",k),r.addEventListener("squeezestart",k),r.addEventListener("squeezeend",k),r.addEventListener("end",z),r.addEventListener("inputsourceschange",U),A.xrCompatible!==!0&&await t.makeXRCompatible(),T=e.getPixelRatio(),e.getSize(C),r.renderState.layers===void 0||e.capabilities.isWebGL2===!1){const q={antialias:r.renderState.layers===void 0?A.antialias:!0,alpha:!0,depth:A.depth,stencil:A.stencil,framebufferScaleFactor:s};d=new XRWebGLLayer(r,t,q),r.updateRenderState({baseLayer:d}),e.setPixelRatio(1),e.setSize(d.framebufferWidth,d.framebufferHeight,!1),y=new Si(d.framebufferWidth,d.framebufferHeight,{format:gi,type:Zi,colorSpace:e.outputColorSpace,stencilBuffer:A.stencil})}else{let q=null,J=null,ie=null;A.depth&&(ie=A.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,q=A.stencil?Xm:vu,J=A.stencil?$d:Zo);const re={colorFormat:t.RGBA8,depthFormat:ie,scaleFactor:s};h=new XRWebGLBinding(r,t),f=h.createProjectionLayer(re),r.updateRenderState({layers:[f]}),e.setPixelRatio(1),e.setSize(f.textureWidth,f.textureHeight,!1),y=new Si(f.textureWidth,f.textureHeight,{format:gi,type:Zi,depthTexture:new f0(f.textureWidth,f.textureHeight,J,void 0,void 0,void 0,void 0,void 0,void 0,q),stencilBuffer:A.stencil,colorSpace:e.outputColorSpace,samples:A.antialias?4:0});const se=e.properties.get(y);se.__ignoreDepthValues=f.ignoreDepthValues}y.isXRRenderTarget=!0,this.setFoveation(l),c=null,o=await r.requestReferenceSpace(a),K.setContext(r),K.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(r!==null)return r.environmentBlendMode};function U(te){for(let q=0;q<te.removed.length;q++){const J=te.removed[q],ie=x.indexOf(J);ie>=0&&(x[ie]=null,E[ie].disconnect(J))}for(let q=0;q<te.added.length;q++){const J=te.added[q];let ie=x.indexOf(J);if(ie===-1){for(let se=0;se<E.length;se++)if(se>=x.length){x.push(J),ie=se;break}else if(x[se]===null){x[se]=J,ie=se;break}if(ie===-1)break}const re=E[ie];re&&re.connect(J)}}const W=new H,$=new H;function oe(te,q,J){W.setFromMatrixPosition(q.matrixWorld),$.setFromMatrixPosition(J.matrixWorld);const ie=W.distanceTo($),re=q.projectionMatrix.elements,se=J.projectionMatrix.elements,ge=re[14]/(re[10]-1),xe=re[14]/(re[10]+1),pe=(re[9]+1)/re[5],ce=(re[9]-1)/re[5],we=(re[8]-1)/re[0],Ee=(se[8]+1)/se[0],ve=ge*we,Ae=ge*Ee,Le=ie/(-we+Ee),Te=Le*-we;q.matrixWorld.decompose(te.position,te.quaternion,te.scale),te.translateX(Te),te.translateZ(Le),te.matrixWorld.compose(te.position,te.quaternion,te.scale),te.matrixWorldInverse.copy(te.matrixWorld).invert();const ne=ge+Le,V=xe+Le,de=ve-Te,Re=Ae+(ie-Te),Be=pe*xe/V*ne,Fe=ce*xe/V*ne;te.projectionMatrix.makePerspective(de,Re,Be,Fe,ne,V),te.projectionMatrixInverse.copy(te.projectionMatrix).invert()}function X(te,q){q===null?te.matrixWorld.copy(te.matrix):te.matrixWorld.multiplyMatrices(q.matrixWorld,te.matrix),te.matrixWorldInverse.copy(te.matrixWorld).invert()}this.updateCamera=function(te){if(r===null)return;R.near=M.near=I.near=te.near,R.far=M.far=I.far=te.far,(P!==R.near||F!==R.far)&&(r.updateRenderState({depthNear:R.near,depthFar:R.far}),P=R.near,F=R.far);const q=te.parent,J=R.cameras;X(R,q);for(let ie=0;ie<J.length;ie++)X(J[ie],q);J.length===2?oe(R,I,M):R.projectionMatrix.copy(I.projectionMatrix),Q(te,R,q)};function Q(te,q,J){J===null?te.matrix.copy(q.matrixWorld):(te.matrix.copy(J.matrixWorld),te.matrix.invert(),te.matrix.multiply(q.matrixWorld)),te.matrix.decompose(te.position,te.quaternion,te.scale),te.updateMatrixWorld(!0),te.projectionMatrix.copy(q.projectionMatrix),te.projectionMatrixInverse.copy(q.projectionMatrixInverse),te.isPerspectiveCamera&&(te.fov=Z1*2*Math.atan(1/te.projectionMatrix.elements[5]),te.zoom=1)}this.getCamera=function(){return R},this.getFoveation=function(){if(!(f===null&&d===null))return l},this.setFoveation=function(te){l=te,f!==null&&(f.fixedFoveation=te),d!==null&&d.fixedFoveation!==void 0&&(d.fixedFoveation=te)};let Y=null;function O(te,q){if(u=q.getViewerPose(c||o),m=q,u!==null){const J=u.views;d!==null&&(e.setRenderTargetFramebuffer(y,d.framebuffer),e.setRenderTarget(y));let ie=!1;J.length!==R.cameras.length&&(R.cameras.length=0,ie=!0);for(let re=0;re<J.length;re++){const se=J[re];let ge=null;if(d!==null)ge=d.getViewport(se);else{const pe=h.getViewSubImage(f,se);ge=pe.viewport,re===0&&(e.setRenderTargetTextures(y,pe.colorTexture,f.ignoreDepthValues?void 0:pe.depthStencilTexture),e.setRenderTarget(y))}let xe=L[re];xe===void 0&&(xe=new Wn,xe.layers.enable(re),xe.viewport=new Rn,L[re]=xe),xe.matrix.fromArray(se.transform.matrix),xe.matrix.decompose(xe.position,xe.quaternion,xe.scale),xe.projectionMatrix.fromArray(se.projectionMatrix),xe.projectionMatrixInverse.copy(xe.projectionMatrix).invert(),xe.viewport.set(ge.x,ge.y,ge.width,ge.height),re===0&&(R.matrix.copy(xe.matrix),R.matrix.decompose(R.position,R.quaternion,R.scale)),ie===!0&&R.cameras.push(xe)}}for(let J=0;J<E.length;J++){const ie=x[J],re=E[J];ie!==null&&re!==void 0&&re.update(ie,q,c||o)}Y&&Y(te,q),q.detectedPlanes&&n.dispatchEvent({type:"planesdetected",data:q}),m=null}const K=new NU;K.setAnimationLoop(O),this.setAnimationLoop=function(te){Y=te},this.dispose=function(){}}}function Ote(i,e){function t(g,y){g.matrixAutoUpdate===!0&&g.updateMatrix(),y.value.copy(g.matrix)}function n(g,y){y.color.getRGB(g.fogColor.value,OU(i)),y.isFog?(g.fogNear.value=y.near,g.fogFar.value=y.far):y.isFogExp2&&(g.fogDensity.value=y.density)}function r(g,y,E,x,C){y.isMeshBasicMaterial||y.isMeshLambertMaterial?s(g,y):y.isMeshToonMaterial?(s(g,y),h(g,y)):y.isMeshPhongMaterial?(s(g,y),u(g,y)):y.isMeshStandardMaterial?(s(g,y),f(g,y),y.isMeshPhysicalMaterial&&d(g,y,C)):y.isMeshMatcapMaterial?(s(g,y),m(g,y)):y.isMeshDepthMaterial?s(g,y):y.isMeshDistanceMaterial?(s(g,y),A(g,y)):y.isMeshNormalMaterial?s(g,y):y.isLineBasicMaterial?(o(g,y),y.isLineDashedMaterial&&a(g,y)):y.isPointsMaterial?l(g,y,E,x):y.isSpriteMaterial?c(g,y):y.isShadowMaterial?(g.color.value.copy(y.color),g.opacity.value=y.opacity):y.isShaderMaterial&&(y.uniformsNeedUpdate=!1)}function s(g,y){g.opacity.value=y.opacity,y.color&&g.diffuse.value.copy(y.color),y.emissive&&g.emissive.value.copy(y.emissive).multiplyScalar(y.emissiveIntensity),y.map&&(g.map.value=y.map,t(y.map,g.mapTransform)),y.alphaMap&&(g.alphaMap.value=y.alphaMap,t(y.alphaMap,g.alphaMapTransform)),y.bumpMap&&(g.bumpMap.value=y.bumpMap,t(y.bumpMap,g.bumpMapTransform),g.bumpScale.value=y.bumpScale,y.side===ys&&(g.bumpScale.value*=-1)),y.normalMap&&(g.normalMap.value=y.normalMap,t(y.normalMap,g.normalMapTransform),g.normalScale.value.copy(y.normalScale),y.side===ys&&g.normalScale.value.negate()),y.displacementMap&&(g.displacementMap.value=y.displacementMap,t(y.displacementMap,g.displacementMapTransform),g.displacementScale.value=y.displacementScale,g.displacementBias.value=y.displacementBias),y.emissiveMap&&(g.emissiveMap.value=y.emissiveMap,t(y.emissiveMap,g.emissiveMapTransform)),y.specularMap&&(g.specularMap.value=y.specularMap,t(y.specularMap,g.specularMapTransform)),y.alphaTest>0&&(g.alphaTest.value=y.alphaTest);const E=e.get(y).envMap;if(E&&(g.envMap.value=E,g.flipEnvMap.value=E.isCubeTexture&&E.isRenderTargetTexture===!1?-1:1,g.reflectivity.value=y.reflectivity,g.ior.value=y.ior,g.refractionRatio.value=y.refractionRatio),y.lightMap){g.lightMap.value=y.lightMap;const x=i._useLegacyLights===!0?Math.PI:1;g.lightMapIntensity.value=y.lightMapIntensity*x,t(y.lightMap,g.lightMapTransform)}y.aoMap&&(g.aoMap.value=y.aoMap,g.aoMapIntensity.value=y.aoMapIntensity,t(y.aoMap,g.aoMapTransform))}function o(g,y){g.diffuse.value.copy(y.color),g.opacity.value=y.opacity,y.map&&(g.map.value=y.map,t(y.map,g.mapTransform))}function a(g,y){g.dashSize.value=y.dashSize,g.totalSize.value=y.dashSize+y.gapSize,g.scale.value=y.scale}function l(g,y,E,x){g.diffuse.value.copy(y.color),g.opacity.value=y.opacity,g.size.value=y.size*E,g.scale.value=x*.5,y.map&&(g.map.value=y.map,t(y.map,g.uvTransform)),y.alphaMap&&(g.alphaMap.value=y.alphaMap,t(y.alphaMap,g.alphaMapTransform)),y.alphaTest>0&&(g.alphaTest.value=y.alphaTest)}function c(g,y){g.diffuse.value.copy(y.color),g.opacity.value=y.opacity,g.rotation.value=y.rotation,y.map&&(g.map.value=y.map,t(y.map,g.mapTransform)),y.alphaMap&&(g.alphaMap.value=y.alphaMap,t(y.alphaMap,g.alphaMapTransform)),y.alphaTest>0&&(g.alphaTest.value=y.alphaTest)}function u(g,y){g.specular.value.copy(y.specular),g.shininess.value=Math.max(y.shininess,1e-4)}function h(g,y){y.gradientMap&&(g.gradientMap.value=y.gradientMap)}function f(g,y){g.metalness.value=y.metalness,y.metalnessMap&&(g.metalnessMap.value=y.metalnessMap,t(y.metalnessMap,g.metalnessMapTransform)),g.roughness.value=y.roughness,y.roughnessMap&&(g.roughnessMap.value=y.roughnessMap,t(y.roughnessMap,g.roughnessMapTransform)),e.get(y).envMap&&(g.envMapIntensity.value=y.envMapIntensity)}function d(g,y,E){g.ior.value=y.ior,y.sheen>0&&(g.sheenColor.value.copy(y.sheenColor).multiplyScalar(y.sheen),g.sheenRoughness.value=y.sheenRoughness,y.sheenColorMap&&(g.sheenColorMap.value=y.sheenColorMap,t(y.sheenColorMap,g.sheenColorMapTransform)),y.sheenRoughnessMap&&(g.sheenRoughnessMap.value=y.sheenRoughnessMap,t(y.sheenRoughnessMap,g.sheenRoughnessMapTransform))),y.clearcoat>0&&(g.clearcoat.value=y.clearcoat,g.clearcoatRoughness.value=y.clearcoatRoughness,y.clearcoatMap&&(g.clearcoatMap.value=y.clearcoatMap,t(y.clearcoatMap,g.clearcoatMapTransform)),y.clearcoatRoughnessMap&&(g.clearcoatRoughnessMap.value=y.clearcoatRoughnessMap,t(y.clearcoatRoughnessMap,g.clearcoatRoughnessMapTransform)),y.clearcoatNormalMap&&(g.clearcoatNormalMap.value=y.clearcoatNormalMap,t(y.clearcoatNormalMap,g.clearcoatNormalMapTransform),g.clearcoatNormalScale.value.copy(y.clearcoatNormalScale),y.side===ys&&g.clearcoatNormalScale.value.negate())),y.iridescence>0&&(g.iridescence.value=y.iridescence,g.iridescenceIOR.value=y.iridescenceIOR,g.iridescenceThicknessMinimum.value=y.iridescenceThicknessRange[0],g.iridescenceThicknessMaximum.value=y.iridescenceThicknessRange[1],y.iridescenceMap&&(g.iridescenceMap.value=y.iridescenceMap,t(y.iridescenceMap,g.iridescenceMapTransform)),y.iridescenceThicknessMap&&(g.iridescenceThicknessMap.value=y.iridescenceThicknessMap,t(y.iridescenceThicknessMap,g.iridescenceThicknessMapTransform))),y.transmission>0&&(g.transmission.value=y.transmission,g.transmissionSamplerMap.value=E.texture,g.transmissionSamplerSize.value.set(E.width,E.height),y.transmissionMap&&(g.transmissionMap.value=y.transmissionMap,t(y.transmissionMap,g.transmissionMapTransform)),g.thickness.value=y.thickness,y.thicknessMap&&(g.thicknessMap.value=y.thicknessMap,t(y.thicknessMap,g.thicknessMapTransform)),g.attenuationDistance.value=y.attenuationDistance,g.attenuationColor.value.copy(y.attenuationColor)),y.anisotropy>0&&(g.anisotropyVector.value.set(y.anisotropy*Math.cos(y.anisotropyRotation),y.anisotropy*Math.sin(y.anisotropyRotation)),y.anisotropyMap&&(g.anisotropyMap.value=y.anisotropyMap,t(y.anisotropyMap,g.anisotropyMapTransform))),g.specularIntensity.value=y.specularIntensity,g.specularColor.value.copy(y.specularColor),y.specularColorMap&&(g.specularColorMap.value=y.specularColorMap,t(y.specularColorMap,g.specularColorMapTransform)),y.specularIntensityMap&&(g.specularIntensityMap.value=y.specularIntensityMap,t(y.specularIntensityMap,g.specularIntensityMapTransform))}function m(g,y){y.matcap&&(g.matcap.value=y.matcap)}function A(g,y){const E=e.get(y).light;g.referencePosition.value.setFromMatrixPosition(E.matrixWorld),g.nearDistance.value=E.shadow.camera.near,g.farDistance.value=E.shadow.camera.far}return{refreshFogUniforms:n,refreshMaterialUniforms:r}}function Nte(i,e,t,n){let r={},s={},o=[];const a=t.isWebGL2?i.getParameter(i.MAX_UNIFORM_BUFFER_BINDINGS):0;function l(E,x){const C=x.program;n.uniformBlockBinding(E,C)}function c(E,x){let C=r[E.id];C===void 0&&(m(E),C=u(E),r[E.id]=C,E.addEventListener("dispose",g));const T=x.program;n.updateUBOMapping(E,T);const I=e.render.frame;s[E.id]!==I&&(f(E),s[E.id]=I)}function u(E){const x=h();E.__bindingPointIndex=x;const C=i.createBuffer(),T=E.__size,I=E.usage;return i.bindBuffer(i.UNIFORM_BUFFER,C),i.bufferData(i.UNIFORM_BUFFER,T,I),i.bindBuffer(i.UNIFORM_BUFFER,null),i.bindBufferBase(i.UNIFORM_BUFFER,x,C),C}function h(){for(let E=0;E<a;E++)if(o.indexOf(E)===-1)return o.push(E),E;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function f(E){const x=r[E.id],C=E.uniforms,T=E.__cache;i.bindBuffer(i.UNIFORM_BUFFER,x);for(let I=0,M=C.length;I<M;I++){const L=Array.isArray(C[I])?C[I]:[C[I]];for(let R=0,P=L.length;R<P;R++){const F=L[R];if(d(F,I,R,T)===!0){const k=F.__offset,z=Array.isArray(F.value)?F.value:[F.value];let U=0;for(let W=0;W<z.length;W++){const $=z[W],oe=A($);typeof $=="number"||typeof $=="boolean"?(F.__data[0]=$,i.bufferSubData(i.UNIFORM_BUFFER,k+U,F.__data)):$.isMatrix3?(F.__data[0]=$.elements[0],F.__data[1]=$.elements[1],F.__data[2]=$.elements[2],F.__data[3]=0,F.__data[4]=$.elements[3],F.__data[5]=$.elements[4],F.__data[6]=$.elements[5],F.__data[7]=0,F.__data[8]=$.elements[6],F.__data[9]=$.elements[7],F.__data[10]=$.elements[8],F.__data[11]=0):($.toArray(F.__data,U),U+=oe.storage/Float32Array.BYTES_PER_ELEMENT)}i.bufferSubData(i.UNIFORM_BUFFER,k,F.__data)}}}i.bindBuffer(i.UNIFORM_BUFFER,null)}function d(E,x,C,T){const I=E.value,M=x+"_"+C;if(T[M]===void 0)return typeof I=="number"||typeof I=="boolean"?T[M]=I:T[M]=I.clone(),!0;{const L=T[M];if(typeof I=="number"||typeof I=="boolean"){if(L!==I)return T[M]=I,!0}else if(L.equals(I)===!1)return L.copy(I),!0}return!1}function m(E){const x=E.uniforms;let C=0;const T=16;for(let M=0,L=x.length;M<L;M++){const R=Array.isArray(x[M])?x[M]:[x[M]];for(let P=0,F=R.length;P<F;P++){const k=R[P],z=Array.isArray(k.value)?k.value:[k.value];for(let U=0,W=z.length;U<W;U++){const $=z[U],oe=A($),X=C%T;X!==0&&T-X<oe.boundary&&(C+=T-X),k.__data=new Float32Array(oe.storage/Float32Array.BYTES_PER_ELEMENT),k.__offset=C,C+=oe.storage}}}const I=C%T;return I>0&&(C+=T-I),E.__size=C,E.__cache={},this}function A(E){const x={boundary:0,storage:0};return typeof E=="number"||typeof E=="boolean"?(x.boundary=4,x.storage=4):E.isVector2?(x.boundary=8,x.storage=8):E.isVector3||E.isColor?(x.boundary=16,x.storage=12):E.isVector4?(x.boundary=16,x.storage=16):E.isMatrix3?(x.boundary=48,x.storage=48):E.isMatrix4?(x.boundary=64,x.storage=64):E.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",E),x}function g(E){const x=E.target;x.removeEventListener("dispose",g);const C=o.indexOf(x.__bindingPointIndex);o.splice(C,1),i.deleteBuffer(r[x.id]),delete r[x.id],delete s[x.id]}function y(){for(const E in r)i.deleteBuffer(r[E]);o=[],r={},s={}}return{bind:l,update:c,dispose:y}}class Iw{constructor(e={}){const{canvas:t=DU(),context:n=null,depth:r=!0,stencil:s=!0,alpha:o=!1,antialias:a=!1,premultipliedAlpha:l=!0,preserveDrawingBuffer:c=!1,powerPreference:u="default",failIfMajorPerformanceCaveat:h=!1}=e;this.isWebGLRenderer=!0;let f;n!==null?f=n.getContextAttributes().alpha:f=o;const d=new Uint32Array(4),m=new Int32Array(4);let A=null,g=null;const y=[],E=[];this.domElement=t,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=gs,this._useLegacyLights=!1,this.toneMapping=yu,this.toneMappingExposure=1;const x=this;let C=!1,T=0,I=0,M=null,L=-1,R=null;const P=new Rn,F=new Rn;let k=null;const z=new ut(0);let U=0,W=t.width,$=t.height,oe=1,X=null,Q=null;const Y=new Rn(0,0,W,$),O=new Rn(0,0,W,$);let K=!1;const te=new h0;let q=!1,J=!1,ie=null;const re=new Xe,se=new Ue,ge=new H,xe={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function pe(){return M===null?oe:1}let ce=n;function we(ue,ye){for(let _e=0;_e<ue.length;_e++){const Pe=ue[_e],Me=t.getContext(Pe,ye);if(Me!==null)return Me}return null}try{const ue={alpha:!0,depth:r,stencil:s,antialias:a,premultipliedAlpha:l,preserveDrawingBuffer:c,powerPreference:u,failIfMajorPerformanceCaveat:h};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${dp}`),t.addEventListener("webglcontextlost",De,!1),t.addEventListener("webglcontextrestored",Ce,!1),t.addEventListener("webglcontextcreationerror",_t,!1),ce===null){const ye=["webgl2","webgl","experimental-webgl"];if(x.isWebGL1Renderer===!0&&ye.shift(),ce=we(ye,ue),ce===null)throw we(ye)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}typeof WebGLRenderingContext<"u"&&ce instanceof WebGLRenderingContext&&console.warn("THREE.WebGLRenderer: WebGL 1 support was deprecated in r153 and will be removed in r163."),ce.getShaderPrecisionFormat===void 0&&(ce.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(ue){throw console.error("THREE.WebGLRenderer: "+ue.message),ue}let Ee,ve,Ae,Le,Te,ne,V,de,Re,Be,Fe,He,it,$e,ct,pt,We,Mt,Ft,St,gt,ft,be,qe;function At(){Ee=new JZ(ce),ve=new jZ(ce,Ee,e),Ee.init(ve),ft=new VU(ce,Ee,ve),Ae=new Bte(ce,Ee,ve),Le=new tee(ce),Te=new Ete,ne=new Dte(ce,Ee,Ae,Te,ve,ft,Le),V=new $Z(x),de=new qZ(x),Re=new cq(ce,ve),be=new VZ(ce,Ee,Re,ve),Be=new ZZ(ce,Re,Le,be),Fe=new see(ce,Be,Re,Le),Ft=new ree(ce,ve,ne),pt=new KZ(Te),He=new xte(x,V,de,Ee,ve,be,pt),it=new Ote(x,Te),$e=new Ste,ct=new Mte(Ee,ve),Mt=new QZ(x,V,de,Ae,Fe,f,l),We=new Pte(x,Fe,ve),qe=new Nte(ce,Le,ve,Ae),St=new WZ(ce,Ee,Le,ve),gt=new eee(ce,Ee,Le,ve),Le.programs=He.programs,x.capabilities=ve,x.extensions=Ee,x.properties=Te,x.renderLists=$e,x.shadowMap=We,x.state=Ae,x.info=Le}At();const yt=new Fte(x,ce);this.xr=yt,this.getContext=function(){return ce},this.getContextAttributes=function(){return ce.getContextAttributes()},this.forceContextLoss=function(){const ue=Ee.get("WEBGL_lose_context");ue&&ue.loseContext()},this.forceContextRestore=function(){const ue=Ee.get("WEBGL_lose_context");ue&&ue.restoreContext()},this.getPixelRatio=function(){return oe},this.setPixelRatio=function(ue){ue!==void 0&&(oe=ue,this.setSize(W,$,!1))},this.getSize=function(ue){return ue.set(W,$)},this.setSize=function(ue,ye,_e=!0){if(yt.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}W=ue,$=ye,t.width=Math.floor(ue*oe),t.height=Math.floor(ye*oe),_e===!0&&(t.style.width=ue+"px",t.style.height=ye+"px"),this.setViewport(0,0,ue,ye)},this.getDrawingBufferSize=function(ue){return ue.set(W*oe,$*oe).floor()},this.setDrawingBufferSize=function(ue,ye,_e){W=ue,$=ye,oe=_e,t.width=Math.floor(ue*_e),t.height=Math.floor(ye*_e),this.setViewport(0,0,ue,ye)},this.getCurrentViewport=function(ue){return ue.copy(P)},this.getViewport=function(ue){return ue.copy(Y)},this.setViewport=function(ue,ye,_e,Pe){ue.isVector4?Y.set(ue.x,ue.y,ue.z,ue.w):Y.set(ue,ye,_e,Pe),Ae.viewport(P.copy(Y).multiplyScalar(oe).floor())},this.getScissor=function(ue){return ue.copy(O)},this.setScissor=function(ue,ye,_e,Pe){ue.isVector4?O.set(ue.x,ue.y,ue.z,ue.w):O.set(ue,ye,_e,Pe),Ae.scissor(F.copy(O).multiplyScalar(oe).floor())},this.getScissorTest=function(){return K},this.setScissorTest=function(ue){Ae.setScissorTest(K=ue)},this.setOpaqueSort=function(ue){X=ue},this.setTransparentSort=function(ue){Q=ue},this.getClearColor=function(ue){return ue.copy(Mt.getClearColor())},this.setClearColor=function(){Mt.setClearColor.apply(Mt,arguments)},this.getClearAlpha=function(){return Mt.getClearAlpha()},this.setClearAlpha=function(){Mt.setClearAlpha.apply(Mt,arguments)},this.clear=function(ue=!0,ye=!0,_e=!0){let Pe=0;if(ue){let Me=!1;if(M!==null){const Je=M.texture.format;Me=Je===qm||Je===tx||Je===yw}if(Me){const Je=M.texture.type,st=Je===Zi||Je===Zo||Je===pp||Je===$d||Je===p6||Je===m6,lt=Mt.getClearColor(),Oe=Mt.getClearAlpha(),Ht=lt.r,xt=lt.g,Et=lt.b;st?(d[0]=Ht,d[1]=xt,d[2]=Et,d[3]=Oe,ce.clearBufferuiv(ce.COLOR,0,d)):(m[0]=Ht,m[1]=xt,m[2]=Et,m[3]=Oe,ce.clearBufferiv(ce.COLOR,0,m))}else Pe|=ce.COLOR_BUFFER_BIT}ye&&(Pe|=ce.DEPTH_BUFFER_BIT),_e&&(Pe|=ce.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),ce.clear(Pe)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",De,!1),t.removeEventListener("webglcontextrestored",Ce,!1),t.removeEventListener("webglcontextcreationerror",_t,!1),$e.dispose(),ct.dispose(),Te.dispose(),V.dispose(),de.dispose(),Fe.dispose(),be.dispose(),qe.dispose(),He.dispose(),yt.dispose(),yt.removeEventListener("sessionstart",Vn),yt.removeEventListener("sessionend",pn),ie&&(ie.dispose(),ie=null),qn.stop()};function De(ue){ue.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),C=!0}function Ce(){console.log("THREE.WebGLRenderer: Context Restored."),C=!1;const ue=Le.autoReset,ye=We.enabled,_e=We.autoUpdate,Pe=We.needsUpdate,Me=We.type;At(),Le.autoReset=ue,We.enabled=ye,We.autoUpdate=_e,We.needsUpdate=Pe,We.type=Me}function _t(ue){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",ue.statusMessage)}function vt(ue){const ye=ue.target;ye.removeEventListener("dispose",vt),bt(ye)}function bt(ue){Pt(ue),Te.remove(ue)}function Pt(ue){const ye=Te.get(ue).programs;ye!==void 0&&(ye.forEach(function(_e){He.releaseProgram(_e)}),ue.isShaderMaterial&&He.releaseShaderCache(ue))}this.renderBufferDirect=function(ue,ye,_e,Pe,Me,Je){ye===null&&(ye=xe);const st=Me.isMesh&&Me.matrixWorld.determinant()<0,lt=he(ue,ye,_e,Pe,Me);Ae.setMaterial(Pe,st);let Oe=_e.index,Ht=1;if(Pe.wireframe===!0){if(Oe=Be.getWireframeAttribute(_e),Oe===void 0)return;Ht=2}const xt=_e.drawRange,Et=_e.attributes.position;let Qt=xt.start*Ht,sn=(xt.start+xt.count)*Ht;Je!==null&&(Qt=Math.max(Qt,Je.start*Ht),sn=Math.min(sn,(Je.start+Je.count)*Ht)),Oe!==null?(Qt=Math.max(Qt,0),sn=Math.min(sn,Oe.count)):Et!=null&&(Qt=Math.max(Qt,0),sn=Math.min(sn,Et.count));const ln=sn-Qt;if(ln<0||ln===1/0)return;be.setup(Me,Pe,lt,_e,Oe);let vn,Dt=St;if(Oe!==null&&(vn=Re.get(Oe),Dt=gt,Dt.setIndex(vn)),Me.isMesh)Pe.wireframe===!0?(Ae.setLineWidth(Pe.wireframeLinewidth*pe()),Dt.setMode(ce.LINES)):Dt.setMode(ce.TRIANGLES);else if(Me.isLine){let Bt=Pe.linewidth;Bt===void 0&&(Bt=1),Ae.setLineWidth(Bt*pe()),Me.isLineSegments?Dt.setMode(ce.LINES):Me.isLineLoop?Dt.setMode(ce.LINE_LOOP):Dt.setMode(ce.LINE_STRIP)}else Me.isPoints?Dt.setMode(ce.POINTS):Me.isSprite&&Dt.setMode(ce.TRIANGLES);if(Me.isBatchedMesh)Dt.renderMultiDraw(Me._multiDrawStarts,Me._multiDrawCounts,Me._multiDrawCount);else if(Me.isInstancedMesh)Dt.renderInstances(Qt,ln,Me.count);else if(_e.isInstancedBufferGeometry){const Bt=_e._maxInstanceCount!==void 0?_e._maxInstanceCount:1/0,yn=Math.min(_e.instanceCount,Bt);Dt.renderInstances(Qt,ln,yn)}else Dt.render(Qt,ln)};function qt(ue,ye,_e){ue.transparent===!0&&ue.side===Pi&&ue.forceSinglePass===!1?(ue.side=ys,ue.needsUpdate=!0,An(ue,ye,_e),ue.side=tl,ue.needsUpdate=!0,An(ue,ye,_e),ue.side=Pi):An(ue,ye,_e)}this.compile=function(ue,ye,_e=null){_e===null&&(_e=ue),g=ct.get(_e),g.init(),E.push(g),_e.traverseVisible(function(Me){Me.isLight&&Me.layers.test(ye.layers)&&(g.pushLight(Me),Me.castShadow&&g.pushShadow(Me))}),ue!==_e&&ue.traverseVisible(function(Me){Me.isLight&&Me.layers.test(ye.layers)&&(g.pushLight(Me),Me.castShadow&&g.pushShadow(Me))}),g.setupLights(x._useLegacyLights);const Pe=new Set;return ue.traverse(function(Me){const Je=Me.material;if(Je)if(Array.isArray(Je))for(let st=0;st<Je.length;st++){const lt=Je[st];qt(lt,_e,Me),Pe.add(lt)}else qt(Je,_e,Me),Pe.add(Je)}),E.pop(),g=null,Pe},this.compileAsync=function(ue,ye,_e=null){const Pe=this.compile(ue,ye,_e);return new Promise(Me=>{function Je(){if(Pe.forEach(function(st){Te.get(st).currentProgram.isReady()&&Pe.delete(st)}),Pe.size===0){Me(ue);return}setTimeout(Je,10)}Ee.get("KHR_parallel_shader_compile")!==null?Je():setTimeout(Je,10)})};let Nt=null;function dn(ue){Nt&&Nt(ue)}function Vn(){qn.stop()}function pn(){qn.start()}const qn=new NU;qn.setAnimationLoop(dn),typeof self<"u"&&qn.setContext(self),this.setAnimationLoop=function(ue){Nt=ue,yt.setAnimationLoop(ue),ue===null?qn.stop():qn.start()},yt.addEventListener("sessionstart",Vn),yt.addEventListener("sessionend",pn),this.render=function(ue,ye){if(ye!==void 0&&ye.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(C===!0)return;ue.matrixWorldAutoUpdate===!0&&ue.updateMatrixWorld(),ye.parent===null&&ye.matrixWorldAutoUpdate===!0&&ye.updateMatrixWorld(),yt.enabled===!0&&yt.isPresenting===!0&&(yt.cameraAutoUpdate===!0&&yt.updateCamera(ye),ye=yt.getCamera()),ue.isScene===!0&&ue.onBeforeRender(x,ue,ye,M),g=ct.get(ue,E.length),g.init(),E.push(g),re.multiplyMatrices(ye.projectionMatrix,ye.matrixWorldInverse),te.setFromProjectionMatrix(re),J=this.localClippingEnabled,q=pt.init(this.clippingPlanes,J),A=$e.get(ue,y.length),A.init(),y.push(A),Ci(ue,ye,0,x.sortObjects),A.finish(),x.sortObjects===!0&&A.sort(X,Q),this.info.render.frame++,q===!0&&pt.beginShadows();const _e=g.state.shadowsArray;if(We.render(_e,ue,ye),q===!0&&pt.endShadows(),this.info.autoReset===!0&&this.info.reset(),Mt.render(A,ue),g.setupLights(x._useLegacyLights),ye.isArrayCamera){const Pe=ye.cameras;for(let Me=0,Je=Pe.length;Me<Je;Me++){const st=Pe[Me];as(A,ue,st,st.viewport)}}else as(A,ue,ye);M!==null&&(ne.updateMultisampleRenderTarget(M),ne.updateRenderTargetMipmap(M)),ue.isScene===!0&&ue.onAfterRender(x,ue,ye),be.resetDefaultState(),L=-1,R=null,E.pop(),E.length>0?g=E[E.length-1]:g=null,y.pop(),y.length>0?A=y[y.length-1]:A=null};function Ci(ue,ye,_e,Pe){if(ue.visible===!1)return;if(ue.layers.test(ye.layers)){if(ue.isGroup)_e=ue.renderOrder;else if(ue.isLOD)ue.autoUpdate===!0&&ue.update(ye);else if(ue.isLight)g.pushLight(ue),ue.castShadow&&g.pushShadow(ue);else if(ue.isSprite){if(!ue.frustumCulled||te.intersectsSprite(ue)){Pe&&ge.setFromMatrixPosition(ue.matrixWorld).applyMatrix4(re);const st=Fe.update(ue),lt=ue.material;lt.visible&&A.push(ue,st,lt,_e,ge.z,null)}}else if((ue.isMesh||ue.isLine||ue.isPoints)&&(!ue.frustumCulled||te.intersectsObject(ue))){const st=Fe.update(ue),lt=ue.material;if(Pe&&(ue.boundingSphere!==void 0?(ue.boundingSphere===null&&ue.computeBoundingSphere(),ge.copy(ue.boundingSphere.center)):(st.boundingSphere===null&&st.computeBoundingSphere(),ge.copy(st.boundingSphere.center)),ge.applyMatrix4(ue.matrixWorld).applyMatrix4(re)),Array.isArray(lt)){const Oe=st.groups;for(let Ht=0,xt=Oe.length;Ht<xt;Ht++){const Et=Oe[Ht],Qt=lt[Et.materialIndex];Qt&&Qt.visible&&A.push(ue,st,Qt,_e,ge.z,Et)}}else lt.visible&&A.push(ue,st,lt,_e,ge.z,null)}}const Je=ue.children;for(let st=0,lt=Je.length;st<lt;st++)Ci(Je[st],ye,_e,Pe)}function as(ue,ye,_e,Pe){const Me=ue.opaque,Je=ue.transmissive,st=ue.transparent;g.setupLightsView(_e),q===!0&&pt.setGlobalState(x.clippingPlanes,_e),Je.length>0&&Nr(Me,Je,ye,_e),Pe&&Ae.viewport(P.copy(Pe)),Me.length>0&&ur(Me,ye,_e),Je.length>0&&ur(Je,ye,_e),st.length>0&&ur(st,ye,_e),Ae.buffers.depth.setTest(!0),Ae.buffers.depth.setMask(!0),Ae.buffers.color.setMask(!0),Ae.setPolygonOffset(!1)}function Nr(ue,ye,_e,Pe){if((_e.isScene===!0?_e.overrideMaterial:null)!==null)return;const Je=ve.isWebGL2;ie===null&&(ie=new Si(1,1,{generateMipmaps:!0,type:Ee.has("EXT_color_buffer_half_float")?Ni:Zi,minFilter:Bl,samples:Je?4:0})),x.getDrawingBufferSize(se),Je?ie.setSize(se.x,se.y):ie.setSize(bS(se.x),bS(se.y));const st=x.getRenderTarget();x.setRenderTarget(ie),x.getClearColor(z),U=x.getClearAlpha(),U<1&&x.setClearColor(16777215,.5),x.clear();const lt=x.toneMapping;x.toneMapping=yu,ur(ue,_e,Pe),ne.updateMultisampleRenderTarget(ie),ne.updateRenderTargetMipmap(ie);let Oe=!1;for(let Ht=0,xt=ye.length;Ht<xt;Ht++){const Et=ye[Ht],Qt=Et.object,sn=Et.geometry,ln=Et.material,vn=Et.group;if(ln.side===Pi&&Qt.layers.test(Pe.layers)){const Dt=ln.side;ln.side=ys,ln.needsUpdate=!0,tr(Qt,_e,Pe,sn,ln,vn),ln.side=Dt,ln.needsUpdate=!0,Oe=!0}}Oe===!0&&(ne.updateMultisampleRenderTarget(ie),ne.updateRenderTargetMipmap(ie)),x.setRenderTarget(st),x.setClearColor(z,U),x.toneMapping=lt}function ur(ue,ye,_e){const Pe=ye.isScene===!0?ye.overrideMaterial:null;for(let Me=0,Je=ue.length;Me<Je;Me++){const st=ue[Me],lt=st.object,Oe=st.geometry,Ht=Pe===null?st.material:Pe,xt=st.group;lt.layers.test(_e.layers)&&tr(lt,ye,_e,Oe,Ht,xt)}}function tr(ue,ye,_e,Pe,Me,Je){ue.onBeforeRender(x,ye,_e,Pe,Me,Je),ue.modelViewMatrix.multiplyMatrices(_e.matrixWorldInverse,ue.matrixWorld),ue.normalMatrix.getNormalMatrix(ue.modelViewMatrix),Me.onBeforeRender(x,ye,_e,Pe,ue,Je),Me.transparent===!0&&Me.side===Pi&&Me.forceSinglePass===!1?(Me.side=ys,Me.needsUpdate=!0,x.renderBufferDirect(_e,ye,Pe,Me,ue,Je),Me.side=tl,Me.needsUpdate=!0,x.renderBufferDirect(_e,ye,Pe,Me,ue,Je),Me.side=Pi):x.renderBufferDirect(_e,ye,Pe,Me,ue,Je),ue.onAfterRender(x,ye,_e,Pe,Me,Je)}function An(ue,ye,_e){ye.isScene!==!0&&(ye=xe);const Pe=Te.get(ue),Me=g.state.lights,Je=g.state.shadowsArray,st=Me.state.version,lt=He.getParameters(ue,Me.state,Je,ye,_e),Oe=He.getProgramCacheKey(lt);let Ht=Pe.programs;Pe.environment=ue.isMeshStandardMaterial?ye.environment:null,Pe.fog=ye.fog,Pe.envMap=(ue.isMeshStandardMaterial?de:V).get(ue.envMap||Pe.environment),Ht===void 0&&(ue.addEventListener("dispose",vt),Ht=new Map,Pe.programs=Ht);let xt=Ht.get(Oe);if(xt!==void 0){if(Pe.currentProgram===xt&&Pe.lightsStateVersion===st)return Uo(ue,lt),xt}else lt.uniforms=He.getUniforms(ue),ue.onBuild(_e,lt,x),ue.onBeforeCompile(lt,x),xt=He.acquireProgram(lt,Oe),Ht.set(Oe,xt),Pe.uniforms=lt.uniforms;const Et=Pe.uniforms;return(!ue.isShaderMaterial&&!ue.isRawShaderMaterial||ue.clipping===!0)&&(Et.clippingPlanes=pt.uniform),Uo(ue,lt),Pe.needsLights=ke(ue),Pe.lightsStateVersion=st,Pe.needsLights&&(Et.ambientLightColor.value=Me.state.ambient,Et.lightProbe.value=Me.state.probe,Et.directionalLights.value=Me.state.directional,Et.directionalLightShadows.value=Me.state.directionalShadow,Et.spotLights.value=Me.state.spot,Et.spotLightShadows.value=Me.state.spotShadow,Et.rectAreaLights.value=Me.state.rectArea,Et.ltc_1.value=Me.state.rectAreaLTC1,Et.ltc_2.value=Me.state.rectAreaLTC2,Et.pointLights.value=Me.state.point,Et.pointLightShadows.value=Me.state.pointShadow,Et.hemisphereLights.value=Me.state.hemi,Et.directionalShadowMap.value=Me.state.directionalShadowMap,Et.directionalShadowMatrix.value=Me.state.directionalShadowMatrix,Et.spotShadowMap.value=Me.state.spotShadowMap,Et.spotLightMatrix.value=Me.state.spotLightMatrix,Et.spotLightMap.value=Me.state.spotLightMap,Et.pointShadowMap.value=Me.state.pointShadowMap,Et.pointShadowMatrix.value=Me.state.pointShadowMatrix),Pe.currentProgram=xt,Pe.uniformsList=null,xt}function vr(ue){if(ue.uniformsList===null){const ye=ue.currentProgram.getUniforms();ue.uniformsList=W_.seqWithValue(ye.seq,ue.uniforms)}return ue.uniformsList}function Uo(ue,ye){const _e=Te.get(ue);_e.outputColorSpace=ye.outputColorSpace,_e.batching=ye.batching,_e.instancing=ye.instancing,_e.instancingColor=ye.instancingColor,_e.skinning=ye.skinning,_e.morphTargets=ye.morphTargets,_e.morphNormals=ye.morphNormals,_e.morphColors=ye.morphColors,_e.morphTargetsCount=ye.morphTargetsCount,_e.numClippingPlanes=ye.numClippingPlanes,_e.numIntersection=ye.numClipIntersection,_e.vertexAlphas=ye.vertexAlphas,_e.vertexTangents=ye.vertexTangents,_e.toneMapping=ye.toneMapping}function he(ue,ye,_e,Pe,Me){ye.isScene!==!0&&(ye=xe),ne.resetTextureUnits();const Je=ye.fog,st=Pe.isMeshStandardMaterial?ye.environment:null,lt=M===null?x.outputColorSpace:M.isXRRenderTarget===!0?M.texture.colorSpace:Dl,Oe=(Pe.isMeshStandardMaterial?de:V).get(Pe.envMap||st),Ht=Pe.vertexColors===!0&&!!_e.attributes.color&&_e.attributes.color.itemSize===4,xt=!!_e.attributes.tangent&&(!!Pe.normalMap||Pe.anisotropy>0),Et=!!_e.morphAttributes.position,Qt=!!_e.morphAttributes.normal,sn=!!_e.morphAttributes.color;let ln=yu;Pe.toneMapped&&(M===null||M.isXRRenderTarget===!0)&&(ln=x.toneMapping);const vn=_e.morphAttributes.position||_e.morphAttributes.normal||_e.morphAttributes.color,Dt=vn!==void 0?vn.length:0,Bt=Te.get(Pe),yn=g.state.lights;if(q===!0&&(J===!0||ue!==R)){const Bn=ue===R&&Pe.id===L;pt.setState(Pe,ue,Bn)}let xn=!1;Pe.version===Bt.__version?(Bt.needsLights&&Bt.lightsStateVersion!==yn.state.version||Bt.outputColorSpace!==lt||Me.isBatchedMesh&&Bt.batching===!1||!Me.isBatchedMesh&&Bt.batching===!0||Me.isInstancedMesh&&Bt.instancing===!1||!Me.isInstancedMesh&&Bt.instancing===!0||Me.isSkinnedMesh&&Bt.skinning===!1||!Me.isSkinnedMesh&&Bt.skinning===!0||Me.isInstancedMesh&&Bt.instancingColor===!0&&Me.instanceColor===null||Me.isInstancedMesh&&Bt.instancingColor===!1&&Me.instanceColor!==null||Bt.envMap!==Oe||Pe.fog===!0&&Bt.fog!==Je||Bt.numClippingPlanes!==void 0&&(Bt.numClippingPlanes!==pt.numPlanes||Bt.numIntersection!==pt.numIntersection)||Bt.vertexAlphas!==Ht||Bt.vertexTangents!==xt||Bt.morphTargets!==Et||Bt.morphNormals!==Qt||Bt.morphColors!==sn||Bt.toneMapping!==ln||ve.isWebGL2===!0&&Bt.morphTargetsCount!==Dt)&&(xn=!0):(xn=!0,Bt.__version=Pe.version);let Sn=Bt.currentProgram;xn===!0&&(Sn=An(Pe,ye,Me));let Ai=!1,xi=!1,Ei=!1;const Dn=Sn.getUniforms(),kn=Bt.uniforms;if(Ae.useProgram(Sn.program)&&(Ai=!0,xi=!0,Ei=!0),Pe.id!==L&&(L=Pe.id,xi=!0),Ai||R!==ue){Dn.setValue(ce,"projectionMatrix",ue.projectionMatrix),Dn.setValue(ce,"viewMatrix",ue.matrixWorldInverse);const Bn=Dn.map.cameraPosition;Bn!==void 0&&Bn.setValue(ce,ge.setFromMatrixPosition(ue.matrixWorld)),ve.logarithmicDepthBuffer&&Dn.setValue(ce,"logDepthBufFC",2/(Math.log(ue.far+1)/Math.LN2)),(Pe.isMeshPhongMaterial||Pe.isMeshToonMaterial||Pe.isMeshLambertMaterial||Pe.isMeshBasicMaterial||Pe.isMeshStandardMaterial||Pe.isShaderMaterial)&&Dn.setValue(ce,"isOrthographic",ue.isOrthographicCamera===!0),R!==ue&&(R=ue,xi=!0,Ei=!0)}if(Me.isSkinnedMesh){Dn.setOptional(ce,Me,"bindMatrix"),Dn.setOptional(ce,Me,"bindMatrixInverse");const Bn=Me.skeleton;Bn&&(ve.floatVertexTextures?(Bn.boneTexture===null&&Bn.computeBoneTexture(),Dn.setValue(ce,"boneTexture",Bn.boneTexture,ne)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}Me.isBatchedMesh&&(Dn.setOptional(ce,Me,"batchingTexture"),Dn.setValue(ce,"batchingTexture",Me._matricesTexture,ne));const zi=_e.morphAttributes;if((zi.position!==void 0||zi.normal!==void 0||zi.color!==void 0&&ve.isWebGL2===!0)&&Ft.update(Me,_e,Sn),(xi||Bt.receiveShadow!==Me.receiveShadow)&&(Bt.receiveShadow=Me.receiveShadow,Dn.setValue(ce,"receiveShadow",Me.receiveShadow)),Pe.isMeshGouraudMaterial&&Pe.envMap!==null&&(kn.envMap.value=Oe,kn.flipEnvMap.value=Oe.isCubeTexture&&Oe.isRenderTargetTexture===!1?-1:1),xi&&(Dn.setValue(ce,"toneMappingExposure",x.toneMappingExposure),Bt.needsLights&&me(kn,Ei),Je&&Pe.fog===!0&&it.refreshFogUniforms(kn,Je),it.refreshMaterialUniforms(kn,Pe,oe,$,ie),W_.upload(ce,vr(Bt),kn,ne)),Pe.isShaderMaterial&&Pe.uniformsNeedUpdate===!0&&(W_.upload(ce,vr(Bt),kn,ne),Pe.uniformsNeedUpdate=!1),Pe.isSpriteMaterial&&Dn.setValue(ce,"center",Me.center),Dn.setValue(ce,"modelViewMatrix",Me.modelViewMatrix),Dn.setValue(ce,"normalMatrix",Me.normalMatrix),Dn.setValue(ce,"modelMatrix",Me.matrixWorld),Pe.isShaderMaterial||Pe.isRawShaderMaterial){const Bn=Pe.uniformsGroups;for(let Ln=0,Ri=Bn.length;Ln<Ri;Ln++)if(ve.isWebGL2){const ls=Bn[Ln];qe.update(ls,Sn),qe.bind(ls,Sn)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return Sn}function me(ue,ye){ue.ambientLightColor.needsUpdate=ye,ue.lightProbe.needsUpdate=ye,ue.directionalLights.needsUpdate=ye,ue.directionalLightShadows.needsUpdate=ye,ue.pointLights.needsUpdate=ye,ue.pointLightShadows.needsUpdate=ye,ue.spotLights.needsUpdate=ye,ue.spotLightShadows.needsUpdate=ye,ue.rectAreaLights.needsUpdate=ye,ue.hemisphereLights.needsUpdate=ye}function ke(ue){return ue.isMeshLambertMaterial||ue.isMeshToonMaterial||ue.isMeshPhongMaterial||ue.isMeshStandardMaterial||ue.isShadowMaterial||ue.isShaderMaterial&&ue.lights===!0}this.getActiveCubeFace=function(){return T},this.getActiveMipmapLevel=function(){return I},this.getRenderTarget=function(){return M},this.setRenderTargetTextures=function(ue,ye,_e){Te.get(ue.texture).__webglTexture=ye,Te.get(ue.depthTexture).__webglTexture=_e;const Pe=Te.get(ue);Pe.__hasExternalTextures=!0,Pe.__hasExternalTextures&&(Pe.__autoAllocateDepthBuffer=_e===void 0,Pe.__autoAllocateDepthBuffer||Ee.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),Pe.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(ue,ye){const _e=Te.get(ue);_e.__webglFramebuffer=ye,_e.__useDefaultFramebuffer=ye===void 0},this.setRenderTarget=function(ue,ye=0,_e=0){M=ue,T=ye,I=_e;let Pe=!0,Me=null,Je=!1,st=!1;if(ue){const Oe=Te.get(ue);Oe.__useDefaultFramebuffer!==void 0?(Ae.bindFramebuffer(ce.FRAMEBUFFER,null),Pe=!1):Oe.__webglFramebuffer===void 0?ne.setupRenderTarget(ue):Oe.__hasExternalTextures&&ne.rebindTextures(ue,Te.get(ue.texture).__webglTexture,Te.get(ue.depthTexture).__webglTexture);const Ht=ue.texture;(Ht.isData3DTexture||Ht.isDataArrayTexture||Ht.isCompressedArrayTexture)&&(st=!0);const xt=Te.get(ue).__webglFramebuffer;ue.isWebGLCubeRenderTarget?(Array.isArray(xt[ye])?Me=xt[ye][_e]:Me=xt[ye],Je=!0):ve.isWebGL2&&ue.samples>0&&ne.useMultisampledRTT(ue)===!1?Me=Te.get(ue).__webglMultisampledFramebuffer:Array.isArray(xt)?Me=xt[_e]:Me=xt,P.copy(ue.viewport),F.copy(ue.scissor),k=ue.scissorTest}else P.copy(Y).multiplyScalar(oe).floor(),F.copy(O).multiplyScalar(oe).floor(),k=K;if(Ae.bindFramebuffer(ce.FRAMEBUFFER,Me)&&ve.drawBuffers&&Pe&&Ae.drawBuffers(ue,Me),Ae.viewport(P),Ae.scissor(F),Ae.setScissorTest(k),Je){const Oe=Te.get(ue.texture);ce.framebufferTexture2D(ce.FRAMEBUFFER,ce.COLOR_ATTACHMENT0,ce.TEXTURE_CUBE_MAP_POSITIVE_X+ye,Oe.__webglTexture,_e)}else if(st){const Oe=Te.get(ue.texture),Ht=ye||0;ce.framebufferTextureLayer(ce.FRAMEBUFFER,ce.COLOR_ATTACHMENT0,Oe.__webglTexture,_e||0,Ht)}L=-1},this.readRenderTargetPixels=function(ue,ye,_e,Pe,Me,Je,st){if(!(ue&&ue.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let lt=Te.get(ue).__webglFramebuffer;if(ue.isWebGLCubeRenderTarget&&st!==void 0&&(lt=lt[st]),lt){Ae.bindFramebuffer(ce.FRAMEBUFFER,lt);try{const Oe=ue.texture,Ht=Oe.format,xt=Oe.type;if(Ht!==gi&&ft.convert(Ht)!==ce.getParameter(ce.IMPLEMENTATION_COLOR_READ_FORMAT)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}const Et=xt===Ni&&(Ee.has("EXT_color_buffer_half_float")||ve.isWebGL2&&Ee.has("EXT_color_buffer_float"));if(xt!==Zi&&ft.convert(xt)!==ce.getParameter(ce.IMPLEMENTATION_COLOR_READ_TYPE)&&!(xt===fi&&(ve.isWebGL2||Ee.has("OES_texture_float")||Ee.has("WEBGL_color_buffer_float")))&&!Et){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}ye>=0&&ye<=ue.width-Pe&&_e>=0&&_e<=ue.height-Me&&ce.readPixels(ye,_e,Pe,Me,ft.convert(Ht),ft.convert(xt),Je)}finally{const Oe=M!==null?Te.get(M).__webglFramebuffer:null;Ae.bindFramebuffer(ce.FRAMEBUFFER,Oe)}}},this.copyFramebufferToTexture=function(ue,ye,_e=0){const Pe=Math.pow(2,-_e),Me=Math.floor(ye.image.width*Pe),Je=Math.floor(ye.image.height*Pe);ne.setTexture2D(ye,0),ce.copyTexSubImage2D(ce.TEXTURE_2D,_e,0,0,ue.x,ue.y,Me,Je),Ae.unbindTexture()},this.copyTextureToTexture=function(ue,ye,_e,Pe=0){const Me=ye.image.width,Je=ye.image.height,st=ft.convert(_e.format),lt=ft.convert(_e.type);ne.setTexture2D(_e,0),ce.pixelStorei(ce.UNPACK_FLIP_Y_WEBGL,_e.flipY),ce.pixelStorei(ce.UNPACK_PREMULTIPLY_ALPHA_WEBGL,_e.premultiplyAlpha),ce.pixelStorei(ce.UNPACK_ALIGNMENT,_e.unpackAlignment),ye.isDataTexture?ce.texSubImage2D(ce.TEXTURE_2D,Pe,ue.x,ue.y,Me,Je,st,lt,ye.image.data):ye.isCompressedTexture?ce.compressedTexSubImage2D(ce.TEXTURE_2D,Pe,ue.x,ue.y,ye.mipmaps[0].width,ye.mipmaps[0].height,st,ye.mipmaps[0].data):ce.texSubImage2D(ce.TEXTURE_2D,Pe,ue.x,ue.y,st,lt,ye.image),Pe===0&&_e.generateMipmaps&&ce.generateMipmap(ce.TEXTURE_2D),Ae.unbindTexture()},this.copyTextureToTexture3D=function(ue,ye,_e,Pe,Me=0){if(x.isWebGL1Renderer){console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");return}const Je=ue.max.x-ue.min.x+1,st=ue.max.y-ue.min.y+1,lt=ue.max.z-ue.min.z+1,Oe=ft.convert(Pe.format),Ht=ft.convert(Pe.type);let xt;if(Pe.isData3DTexture)ne.setTexture3D(Pe,0),xt=ce.TEXTURE_3D;else if(Pe.isDataArrayTexture||Pe.isCompressedArrayTexture)ne.setTexture2DArray(Pe,0),xt=ce.TEXTURE_2D_ARRAY;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}ce.pixelStorei(ce.UNPACK_FLIP_Y_WEBGL,Pe.flipY),ce.pixelStorei(ce.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Pe.premultiplyAlpha),ce.pixelStorei(ce.UNPACK_ALIGNMENT,Pe.unpackAlignment);const Et=ce.getParameter(ce.UNPACK_ROW_LENGTH),Qt=ce.getParameter(ce.UNPACK_IMAGE_HEIGHT),sn=ce.getParameter(ce.UNPACK_SKIP_PIXELS),ln=ce.getParameter(ce.UNPACK_SKIP_ROWS),vn=ce.getParameter(ce.UNPACK_SKIP_IMAGES),Dt=_e.isCompressedTexture?_e.mipmaps[Me]:_e.image;ce.pixelStorei(ce.UNPACK_ROW_LENGTH,Dt.width),ce.pixelStorei(ce.UNPACK_IMAGE_HEIGHT,Dt.height),ce.pixelStorei(ce.UNPACK_SKIP_PIXELS,ue.min.x),ce.pixelStorei(ce.UNPACK_SKIP_ROWS,ue.min.y),ce.pixelStorei(ce.UNPACK_SKIP_IMAGES,ue.min.z),_e.isDataTexture||_e.isData3DTexture?ce.texSubImage3D(xt,Me,ye.x,ye.y,ye.z,Je,st,lt,Oe,Ht,Dt.data):_e.isCompressedArrayTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),ce.compressedTexSubImage3D(xt,Me,ye.x,ye.y,ye.z,Je,st,lt,Oe,Dt.data)):ce.texSubImage3D(xt,Me,ye.x,ye.y,ye.z,Je,st,lt,Oe,Ht,Dt),ce.pixelStorei(ce.UNPACK_ROW_LENGTH,Et),ce.pixelStorei(ce.UNPACK_IMAGE_HEIGHT,Qt),ce.pixelStorei(ce.UNPACK_SKIP_PIXELS,sn),ce.pixelStorei(ce.UNPACK_SKIP_ROWS,ln),ce.pixelStorei(ce.UNPACK_SKIP_IMAGES,vn),Me===0&&Pe.generateMipmaps&&ce.generateMipmap(xt),Ae.unbindTexture()},this.initTexture=function(ue){ue.isCubeTexture?ne.setTextureCube(ue,0):ue.isData3DTexture?ne.setTexture3D(ue,0):ue.isDataArrayTexture||ue.isCompressedArrayTexture?ne.setTexture2DArray(ue,0):ne.setTexture2D(ue,0),Ae.unbindTexture()},this.resetState=function(){T=0,I=0,M=null,Ae.reset(),be.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return mu}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const t=this.getContext();t.drawingBufferColorSpace=e===_w?"display-p3":"srgb",t.unpackColorSpace=Vi.workingColorSpace===nx?"display-p3":"srgb"}get outputEncoding(){return console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace===gs?Yd:y6}set outputEncoding(e){console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace=e===Yd?gs:Dl}get useLegacyLights(){return console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights}set useLegacyLights(e){console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights=e}}class jU extends Iw{}jU.prototype.isWebGL1Renderer=!0;class Mw{constructor(e,t=25e-5){this.isFogExp2=!0,this.name="",this.color=new ut(e),this.density=t}clone(){return new Mw(this.color,this.density)}toJSON(){return{type:"FogExp2",name:this.name,color:this.color.getHex(),density:this.density}}}class Rw{constructor(e,t=1,n=1e3){this.isFog=!0,this.name="",this.color=new ut(e),this.near=t,this.far=n}clone(){return new Rw(this.color,this.near,this.far)}toJSON(){return{type:"Fog",name:this.name,color:this.color.getHex(),near:this.near,far:this.far}}}class Mu extends _n{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(t.object.backgroundIntensity=this.backgroundIntensity),t}}class sx{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=e!==void 0?e.length/t:0,this.usage=b2,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.version=0,this.uuid=Ll()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}get updateRange(){return console.warn("THREE.InterleavedBuffer: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,n){e*=this.stride,n*=t.stride;for(let r=0,s=this.stride;r<s;r++)this.array[e+r]=t.array[n+r];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Ll()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(t,this.stride);return n.setUsage(this.usage),n}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Ll()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const pa=new H;class Ja{constructor(e,t,n,r=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=n,this.normalized=r}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,n=this.data.count;t<n;t++)pa.fromBufferAttribute(this,t),pa.applyMatrix4(e),this.setXYZ(t,pa.x,pa.y,pa.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)pa.fromBufferAttribute(this,t),pa.applyNormalMatrix(e),this.setXYZ(t,pa.x,pa.y,pa.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)pa.fromBufferAttribute(this,t),pa.transformDirection(e),this.setXYZ(t,pa.x,pa.y,pa.z);return this}setX(e,t){return this.normalized&&(t=ii(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=ii(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=ii(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=ii(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=qa(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=qa(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=qa(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=qa(t,this.array)),t}setXY(e,t,n){return e=e*this.data.stride+this.offset,this.normalized&&(t=ii(t,this.array),n=ii(n,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this}setXYZ(e,t,n,r){return e=e*this.data.stride+this.offset,this.normalized&&(t=ii(t,this.array),n=ii(n,this.array),r=ii(r,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=r,this}setXYZW(e,t,n,r,s){return e=e*this.data.stride+this.offset,this.normalized&&(t=ii(t,this.array),n=ii(n,this.array),r=ii(r,this.array),s=ii(s,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=r,this.data.array[e+3]=s,this}clone(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let n=0;n<this.count;n++){const r=n*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)t.push(this.data.array[r+s])}return new mn(new this.array.constructor(t),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new Ja(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let n=0;n<this.count;n++){const r=n*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)t.push(this.data.array[r+s])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class C6 extends Us{constructor(e){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new ut(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}let Cg;const By=new H,Tg=new H,bg=new H,Ig=new Ue,Dy=new Ue,KU=new Xe,YE=new H,ky=new H,XE=new H,zP=new Ue,cT=new Ue,GP=new Ue;class $U extends _n{constructor(e=new C6){if(super(),this.isSprite=!0,this.type="Sprite",Cg===void 0){Cg=new fn;const t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),n=new sx(t,5);Cg.setIndex([0,1,2,0,2,3]),Cg.setAttribute("position",new Ja(n,3,0,!1)),Cg.setAttribute("uv",new Ja(n,2,3,!1))}this.geometry=Cg,this.material=e,this.center=new Ue(.5,.5)}raycast(e,t){e.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),Tg.setFromMatrixScale(this.matrixWorld),KU.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),bg.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&Tg.multiplyScalar(-bg.z);const n=this.material.rotation;let r,s;n!==0&&(s=Math.cos(n),r=Math.sin(n));const o=this.center;qE(YE.set(-.5,-.5,0),bg,o,Tg,r,s),qE(ky.set(.5,-.5,0),bg,o,Tg,r,s),qE(XE.set(.5,.5,0),bg,o,Tg,r,s),zP.set(0,0),cT.set(1,0),GP.set(1,1);let a=e.ray.intersectTriangle(YE,ky,XE,!1,By);if(a===null&&(qE(ky.set(-.5,.5,0),bg,o,Tg,r,s),cT.set(0,1),a=e.ray.intersectTriangle(YE,XE,ky,!1,By),a===null))return;const l=e.ray.origin.distanceTo(By);l<e.near||l>e.far||t.push({distance:l,point:By.clone(),uv:ks.getInterpolation(By,YE,ky,XE,zP,cT,GP,new Ue),face:null,object:this})}copy(e,t){return super.copy(e,t),e.center!==void 0&&this.center.copy(e.center),this.material=e.material,this}}function qE(i,e,t,n,r,s){Ig.subVectors(i,t).addScalar(.5).multiply(n),r!==void 0?(Dy.x=s*Ig.x-r*Ig.y,Dy.y=r*Ig.x+s*Ig.y):Dy.copy(Ig),i.copy(e),i.x+=Dy.x,i.y+=Dy.y,i.applyMatrix4(KU)}const JE=new H,HP=new H;class YU extends _n{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(e){super.copy(e,!1);const t=e.levels;for(let n=0,r=t.length;n<r;n++){const s=t[n];this.addLevel(s.object.clone(),s.distance,s.hysteresis)}return this.autoUpdate=e.autoUpdate,this}addLevel(e,t=0,n=0){t=Math.abs(t);const r=this.levels;let s;for(s=0;s<r.length&&!(t<r[s].distance);s++);return r.splice(s,0,{distance:t,hysteresis:n,object:e}),this.add(e),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(e){const t=this.levels;if(t.length>0){let n,r;for(n=1,r=t.length;n<r;n++){let s=t[n].distance;if(t[n].object.visible&&(s-=s*t[n].hysteresis),e<s)break}return t[n-1].object}return null}raycast(e,t){if(this.levels.length>0){JE.setFromMatrixPosition(this.matrixWorld);const r=e.ray.origin.distanceTo(JE);this.getObjectForDistance(r).raycast(e,t)}}update(e){const t=this.levels;if(t.length>1){JE.setFromMatrixPosition(e.matrixWorld),HP.setFromMatrixPosition(this.matrixWorld);const n=JE.distanceTo(HP)/e.zoom;t[0].object.visible=!0;let r,s;for(r=1,s=t.length;r<s;r++){let o=t[r].distance;if(t[r].object.visible&&(o-=o*t[r].hysteresis),n>=o)t[r-1].object.visible=!1,t[r].object.visible=!0;else break}for(this._currentLevel=r-1;r<s;r++)t[r].object.visible=!1}}toJSON(e){const t=super.toJSON(e);this.autoUpdate===!1&&(t.object.autoUpdate=!1),t.object.levels=[];const n=this.levels;for(let r=0,s=n.length;r<s;r++){const o=n[r];t.object.levels.push({object:o.object.uuid,distance:o.distance,hysteresis:o.hysteresis})}return t}}const QP=new H,VP=new Rn,WP=new Rn,Ute=new H,jP=new Xe,ZE=new H,uT=new Bi,KP=new Xe,hT=new vc;class ox extends It{constructor(e,t){super(e,t),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=nM,this.bindMatrix=new Xe,this.bindMatrixInverse=new Xe,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const e=this.geometry;this.boundingBox===null&&(this.boundingBox=new ti),this.boundingBox.makeEmpty();const t=e.getAttribute("position");for(let n=0;n<t.count;n++)this.getVertexPosition(n,ZE),this.boundingBox.expandByPoint(ZE)}computeBoundingSphere(){const e=this.geometry;this.boundingSphere===null&&(this.boundingSphere=new Bi),this.boundingSphere.makeEmpty();const t=e.getAttribute("position");for(let n=0;n<t.count;n++)this.getVertexPosition(n,ZE),this.boundingSphere.expandByPoint(ZE)}copy(e,t){return super.copy(e,t),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}raycast(e,t){const n=this.material,r=this.matrixWorld;n!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),uT.copy(this.boundingSphere),uT.applyMatrix4(r),e.ray.intersectsSphere(uT)!==!1&&(KP.copy(r).invert(),hT.copy(e.ray).applyMatrix4(KP),!(this.boundingBox!==null&&hT.intersectsBox(this.boundingBox)===!1)&&this._computeIntersections(e,t,hT)))}getVertexPosition(e,t){return super.getVertexPosition(e,t),this.applyBoneTransform(e,t),t}bind(e,t){this.skeleton=e,t===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new Rn,t=this.geometry.attributes.skinWeight;for(let n=0,r=t.count;n<r;n++){e.fromBufferAttribute(t,n);const s=1/e.manhattanLength();s!==1/0?e.multiplyScalar(s):e.set(1,0,0,0),t.setXYZW(n,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode===nM?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode===dU?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(e,t){const n=this.skeleton,r=this.geometry;VP.fromBufferAttribute(r.attributes.skinIndex,e),WP.fromBufferAttribute(r.attributes.skinWeight,e),QP.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let s=0;s<4;s++){const o=WP.getComponent(s);if(o!==0){const a=VP.getComponent(s);jP.multiplyMatrices(n.bones[a].matrixWorld,n.boneInverses[a]),t.addScaledVector(Ute.copy(QP).applyMatrix4(jP),o)}}return t.applyMatrix4(this.bindMatrixInverse)}boneTransform(e,t){return console.warn("THREE.SkinnedMesh: .boneTransform() was renamed to .applyBoneTransform() in r151."),this.applyBoneTransform(e,t)}}class tA extends _n{constructor(){super(),this.isBone=!0,this.type="Bone"}}class Sa extends vi{constructor(e=null,t=1,n=1,r,s,o,a,l,c=zn,u=zn,h,f){super(null,o,a,l,c,u,r,s,h,f),this.isDataTexture=!0,this.image={data:e,width:t,height:n},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const $P=new Xe,zte=new Xe;class _A{constructor(e=[],t=[]){this.uuid=Ll(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.init()}init(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(e.length*16),t.length===0)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let n=0,r=this.bones.length;n<r;n++)this.boneInverses.push(new Xe)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const n=new Xe;this.bones[e]&&n.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(n)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){const n=this.bones[e];n&&n.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const n=this.bones[e];n&&(n.parent&&n.parent.isBone?(n.matrix.copy(n.parent.matrixWorld).invert(),n.matrix.multiply(n.matrixWorld)):n.matrix.copy(n.matrixWorld),n.matrix.decompose(n.position,n.quaternion,n.scale))}}update(){const e=this.bones,t=this.boneInverses,n=this.boneMatrices,r=this.boneTexture;for(let s=0,o=e.length;s<o;s++){const a=e[s]?e[s].matrixWorld:zte;$P.multiplyMatrices(a,t[s]),$P.toArray(n,s*16)}r!==null&&(r.needsUpdate=!0)}clone(){return new _A(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(this.bones.length*4);e=Math.ceil(e/4)*4,e=Math.max(e,4);const t=new Float32Array(e*e*4);t.set(this.boneMatrices);const n=new Sa(t,e,e,gi,fi);return n.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=n,this}getBoneByName(e){for(let t=0,n=this.bones.length;t<n;t++){const r=this.bones[t];if(r.name===e)return r}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let n=0,r=e.bones.length;n<r;n++){const s=e.bones[n];let o=t[s];o===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",s),o=new tA),this.bones.push(o),this.boneInverses.push(new Xe().fromArray(e.boneInverses[n]))}return this.init(),this}toJSON(){const e={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,n=this.boneInverses;for(let r=0,s=t.length;r<s;r++){const o=t[r];e.bones.push(o.uuid);const a=n[r];e.boneInverses.push(a.toArray())}return e}}class Su extends mn{constructor(e,t,n,r=1){super(e,t,n),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=r}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const Mg=new Xe,YP=new Xe,e3=[],XP=new ti,Gte=new Xe,Fy=new It,Oy=new Bi;class ax extends It{constructor(e,t,n){super(e,t),this.isInstancedMesh=!0,this.instanceMatrix=new Su(new Float32Array(n*16),16),this.instanceColor=null,this.count=n,this.boundingBox=null,this.boundingSphere=null;for(let r=0;r<n;r++)this.setMatrixAt(r,Gte)}computeBoundingBox(){const e=this.geometry,t=this.count;this.boundingBox===null&&(this.boundingBox=new ti),e.boundingBox===null&&e.computeBoundingBox(),this.boundingBox.makeEmpty();for(let n=0;n<t;n++)this.getMatrixAt(n,Mg),XP.copy(e.boundingBox).applyMatrix4(Mg),this.boundingBox.union(XP)}computeBoundingSphere(){const e=this.geometry,t=this.count;this.boundingSphere===null&&(this.boundingSphere=new Bi),e.boundingSphere===null&&e.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let n=0;n<t;n++)this.getMatrixAt(n,Mg),Oy.copy(e.boundingSphere).applyMatrix4(Mg),this.boundingSphere.union(Oy)}copy(e,t){return super.copy(e,t),this.instanceMatrix.copy(e.instanceMatrix),e.instanceColor!==null&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}getColorAt(e,t){t.fromArray(this.instanceColor.array,e*3)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,e*16)}raycast(e,t){const n=this.matrixWorld,r=this.count;if(Fy.geometry=this.geometry,Fy.material=this.material,Fy.material!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),Oy.copy(this.boundingSphere),Oy.applyMatrix4(n),e.ray.intersectsSphere(Oy)!==!1))for(let s=0;s<r;s++){this.getMatrixAt(s,Mg),YP.multiplyMatrices(n,Mg),Fy.matrixWorld=YP,Fy.raycast(e,e3);for(let o=0,a=e3.length;o<a;o++){const l=e3[o];l.instanceId=s,l.object=this,t.push(l)}e3.length=0}}setColorAt(e,t){this.instanceColor===null&&(this.instanceColor=new Su(new Float32Array(this.instanceMatrix.count*3),3)),t.toArray(this.instanceColor.array,e*3)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,e*16)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}function Hte(i,e){return i.z-e.z}function Qte(i,e){return e.z-i.z}class Vte{constructor(){this.index=0,this.pool=[],this.list=[]}push(e,t){const n=this.pool,r=this.list;this.index>=n.length&&n.push({start:-1,count:-1,z:-1});const s=n[this.index];r.push(s),this.index++,s.start=e.start,s.count=e.count,s.z=t}reset(){this.list.length=0,this.index=0}}const Rg="batchId",wd=new Xe,qP=new Xe,Wte=new Xe,JP=new Xe,fT=new h0,t3=new ti,om=new Bi,Ny=new H,dT=new Vte,Yo=new It,n3=[];function jte(i,e,t=0){const n=e.itemSize;if(i.isInterleavedBufferAttribute||i.array.constructor!==e.array.constructor){const r=i.count;for(let s=0;s<r;s++)for(let o=0;o<n;o++)e.setComponent(s+t,o,i.getComponent(s,o))}else e.array.set(i.array,t*n);e.needsUpdate=!0}let T6=class extends It{get maxGeometryCount(){return this._maxGeometryCount}constructor(e,t,n=t*2,r){super(new fn,r),this.isBatchedMesh=!0,this.perObjectFrustumCulled=!0,this.sortObjects=!0,this.boundingBox=null,this.boundingSphere=null,this.customSort=null,this._drawRanges=[],this._reservedRanges=[],this._visibility=[],this._active=[],this._bounds=[],this._maxGeometryCount=e,this._maxVertexCount=t,this._maxIndexCount=n,this._geometryInitialized=!1,this._geometryCount=0,this._multiDrawCounts=new Int32Array(e),this._multiDrawStarts=new Int32Array(e),this._multiDrawCount=0,this._visibilityChanged=!0,this._matricesTexture=null,this._initMatricesTexture()}_initMatricesTexture(){let e=Math.sqrt(this._maxGeometryCount*4);e=Math.ceil(e/4)*4,e=Math.max(e,4);const t=new Float32Array(e*e*4),n=new Sa(t,e,e,gi,fi);this._matricesTexture=n}_initializeGeometry(e){const t=this.geometry,n=this._maxVertexCount,r=this._maxGeometryCount,s=this._maxIndexCount;if(this._geometryInitialized===!1){for(const a in e.attributes){const l=e.getAttribute(a),{array:c,itemSize:u,normalized:h}=l,f=new c.constructor(n*u),d=new l.constructor(f,u,h);d.setUsage(l.usage),t.setAttribute(a,d)}if(e.getIndex()!==null){const a=n>65536?new Uint32Array(s):new Uint16Array(s);t.setIndex(new mn(a,1))}const o=r>65536?new Uint32Array(n):new Uint16Array(n);t.setAttribute(Rg,new mn(o,1)),this._geometryInitialized=!0}}_validateGeometry(e){if(e.getAttribute(Rg))throw new Error(`BatchedMesh: Geometry cannot use attribute "${Rg}"`);const t=this.geometry;if(!!e.getIndex()!=!!t.getIndex())throw new Error('BatchedMesh: All geometries must consistently have "index".');for(const n in t.attributes){if(n===Rg)continue;if(!e.hasAttribute(n))throw new Error(`BatchedMesh: Added geometry missing "${n}". All geometries must have consistent attributes.`);const r=e.getAttribute(n),s=t.getAttribute(n);if(r.itemSize!==s.itemSize||r.normalized!==s.normalized)throw new Error("BatchedMesh: All attributes must have a consistent itemSize and normalized value.")}}setCustomSort(e){return this.customSort=e,this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new ti);const e=this._geometryCount,t=this.boundingBox,n=this._active;t.makeEmpty();for(let r=0;r<e;r++)n[r]!==!1&&(this.getMatrixAt(r,wd),this.getBoundingBoxAt(r,t3).applyMatrix4(wd),t.union(t3))}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Bi);const e=this._geometryCount,t=this.boundingSphere,n=this._active;t.makeEmpty();for(let r=0;r<e;r++)n[r]!==!1&&(this.getMatrixAt(r,wd),this.getBoundingSphereAt(r,om).applyMatrix4(wd),t.union(om))}addGeometry(e,t=-1,n=-1){if(this._initializeGeometry(e),this._validateGeometry(e),this._geometryCount>=this._maxGeometryCount)throw new Error("BatchedMesh: Maximum geometry count reached.");const r={vertexStart:-1,vertexCount:-1,indexStart:-1,indexCount:-1};let s=null;const o=this._reservedRanges,a=this._drawRanges,l=this._bounds;this._geometryCount!==0&&(s=o[o.length-1]),t===-1?r.vertexCount=e.getAttribute("position").count:r.vertexCount=t,s===null?r.vertexStart=0:r.vertexStart=s.vertexStart+s.vertexCount;const c=e.getIndex(),u=c!==null;if(u&&(n===-1?r.indexCount=c.count:r.indexCount=n,s===null?r.indexStart=0:r.indexStart=s.indexStart+s.indexCount),r.indexStart!==-1&&r.indexStart+r.indexCount>this._maxIndexCount||r.vertexStart+r.vertexCount>this._maxVertexCount)throw new Error("BatchedMesh: Reserved space request exceeds the maximum buffer size.");const h=this._visibility,f=this._active,d=this._matricesTexture,m=this._matricesTexture.image.data;h.push(!0),f.push(!0);const A=this._geometryCount;this._geometryCount++,Wte.toArray(m,A*16),d.needsUpdate=!0,o.push(r),a.push({start:u?r.indexStart:r.vertexStart,count:-1}),l.push({boxInitialized:!1,box:new ti,sphereInitialized:!1,sphere:new Bi});const g=this.geometry.getAttribute(Rg);for(let y=0;y<r.vertexCount;y++)g.setX(r.vertexStart+y,A);return g.needsUpdate=!0,this.setGeometryAt(A,e),A}setGeometryAt(e,t){if(e>=this._geometryCount)throw new Error("BatchedMesh: Maximum geometry count reached.");this._validateGeometry(t);const n=this.geometry,r=n.getIndex()!==null,s=n.getIndex(),o=t.getIndex(),a=this._reservedRanges[e];if(r&&o.count>a.indexCount||t.attributes.position.count>a.vertexCount)throw new Error("BatchedMesh: Reserved space not large enough for provided geometry.");const l=a.vertexStart,c=a.vertexCount;for(const d in n.attributes){if(d===Rg)continue;const m=t.getAttribute(d),A=n.getAttribute(d);jte(m,A,l);const g=m.itemSize;for(let y=m.count,E=c;y<E;y++){const x=l+y;for(let C=0;C<g;C++)A.setComponent(x,C,0)}A.needsUpdate=!0}if(r){const d=a.indexStart;for(let m=0;m<o.count;m++)s.setX(d+m,l+o.getX(m));for(let m=o.count,A=a.indexCount;m<A;m++)s.setX(d+m,l);s.needsUpdate=!0}const u=this._bounds[e];t.boundingBox!==null?(u.box.copy(t.boundingBox),u.boxInitialized=!0):u.boxInitialized=!1,t.boundingSphere!==null?(u.sphere.copy(t.boundingSphere),u.sphereInitialized=!0):u.sphereInitialized=!1;const h=this._drawRanges[e],f=t.getAttribute("position");return h.count=r?o.count:f.count,this._visibilityChanged=!0,e}deleteGeometry(e){const t=this._active;return e>=t.length||t[e]===!1?this:(t[e]=!1,this._visibilityChanged=!0,this)}getBoundingBoxAt(e,t){if(this._active[e]===!1)return this;const r=this._bounds[e],s=r.box,o=this.geometry;if(r.boxInitialized===!1){s.makeEmpty();const a=o.index,l=o.attributes.position,c=this._drawRanges[e];for(let u=c.start,h=c.start+c.count;u<h;u++){let f=u;a&&(f=a.getX(f)),s.expandByPoint(Ny.fromBufferAttribute(l,f))}r.boxInitialized=!0}return t.copy(s),t}getBoundingSphereAt(e,t){if(this._active[e]===!1)return this;const r=this._bounds[e],s=r.sphere,o=this.geometry;if(r.sphereInitialized===!1){s.makeEmpty(),this.getBoundingBoxAt(e,t3),t3.getCenter(s.center);const a=o.index,l=o.attributes.position,c=this._drawRanges[e];let u=0;for(let h=c.start,f=c.start+c.count;h<f;h++){let d=h;a&&(d=a.getX(d)),Ny.fromBufferAttribute(l,d),u=Math.max(u,s.center.distanceToSquared(Ny))}s.radius=Math.sqrt(u),r.sphereInitialized=!0}return t.copy(s),t}setMatrixAt(e,t){const n=this._active,r=this._matricesTexture,s=this._matricesTexture.image.data,o=this._geometryCount;return e>=o||n[e]===!1?this:(t.toArray(s,e*16),r.needsUpdate=!0,this)}getMatrixAt(e,t){const n=this._active,r=this._matricesTexture.image.data,s=this._geometryCount;return e>=s||n[e]===!1?null:t.fromArray(r,e*16)}setVisibleAt(e,t){const n=this._visibility,r=this._active,s=this._geometryCount;return e>=s||r[e]===!1||n[e]===t?this:(n[e]=t,this._visibilityChanged=!0,this)}getVisibleAt(e){const t=this._visibility,n=this._active,r=this._geometryCount;return e>=r||n[e]===!1?!1:t[e]}raycast(e,t){const n=this._visibility,r=this._active,s=this._drawRanges,o=this._geometryCount,a=this.matrixWorld,l=this.geometry;Yo.material=this.material,Yo.geometry.index=l.index,Yo.geometry.attributes=l.attributes,Yo.geometry.boundingBox===null&&(Yo.geometry.boundingBox=new ti),Yo.geometry.boundingSphere===null&&(Yo.geometry.boundingSphere=new Bi);for(let c=0;c<o;c++){if(!n[c]||!r[c])continue;const u=s[c];Yo.geometry.setDrawRange(u.start,u.count),this.getMatrixAt(c,Yo.matrixWorld).premultiply(a),this.getBoundingBoxAt(c,Yo.geometry.boundingBox),this.getBoundingSphereAt(c,Yo.geometry.boundingSphere),Yo.raycast(e,n3);for(let h=0,f=n3.length;h<f;h++){const d=n3[h];d.object=this,d.batchId=c,t.push(d)}n3.length=0}Yo.material=null,Yo.geometry.index=null,Yo.geometry.attributes={},Yo.geometry.setDrawRange(0,1/0)}copy(e){return super.copy(e),this.geometry=e.geometry.clone(),this.perObjectFrustumCulled=e.perObjectFrustumCulled,this.sortObjects=e.sortObjects,this.boundingBox=e.boundingBox!==null?e.boundingBox.clone():null,this.boundingSphere=e.boundingSphere!==null?e.boundingSphere.clone():null,this._drawRanges=e._drawRanges.map(t=>({...t})),this._reservedRanges=e._reservedRanges.map(t=>({...t})),this._visibility=e._visibility.slice(),this._active=e._active.slice(),this._bounds=e._bounds.map(t=>({boxInitialized:t.boxInitialized,box:t.box.clone(),sphereInitialized:t.sphereInitialized,sphere:t.sphere.clone()})),this._maxGeometryCount=e._maxGeometryCount,this._maxVertexCount=e._maxVertexCount,this._maxIndexCount=e._maxIndexCount,this._geometryInitialized=e._geometryInitialized,this._geometryCount=e._geometryCount,this._multiDrawCounts=e._multiDrawCounts.slice(),this._multiDrawStarts=e._multiDrawStarts.slice(),this._matricesTexture=e._matricesTexture.clone(),this._matricesTexture.image.data=this._matricesTexture.image.slice(),this}dispose(){return this.geometry.dispose(),this._matricesTexture.dispose(),this._matricesTexture=null,this}onBeforeRender(e,t,n,r,s){if(!this._visibilityChanged&&!this.perObjectFrustumCulled&&!this.sortObjects)return;const o=r.getIndex(),a=o===null?1:o.array.BYTES_PER_ELEMENT,l=this._visibility,c=this._multiDrawStarts,u=this._multiDrawCounts,h=this._drawRanges,f=this.perObjectFrustumCulled;f&&(JP.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse).multiply(this.matrixWorld),fT.setFromProjectionMatrix(JP,e.isWebGPURenderer?J1:mu));let d=0;if(this.sortObjects){qP.copy(this.matrixWorld).invert(),Ny.setFromMatrixPosition(n.matrixWorld).applyMatrix4(qP);for(let g=0,y=l.length;g<y;g++)if(l[g]){this.getMatrixAt(g,wd),this.getBoundingSphereAt(g,om).applyMatrix4(wd);let E=!1;if(f&&(E=!fT.intersectsSphere(om)),!E){const x=Ny.distanceTo(om.center);dT.push(h[g],x)}}const m=dT.list,A=this.customSort;A===null?m.sort(s.transparent?Qte:Hte):A.call(this,m,n);for(let g=0,y=m.length;g<y;g++){const E=m[g];c[d]=E.start*a,u[d]=E.count,d++}dT.reset()}else for(let m=0,A=l.length;m<A;m++)if(l[m]){let g=!1;if(f&&(this.getMatrixAt(m,wd),this.getBoundingSphereAt(m,om).applyMatrix4(wd),g=!fT.intersectsSphere(om)),!g){const y=h[m];c[d]=y.start*a,u[d]=y.count,d++}}this._multiDrawCount=d,this._visibilityChanged=!1}onBeforeShadow(e,t,n,r,s,o){this.onBeforeRender(e,null,r,s,o)}};class vs extends Us{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new ut(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const ZP=new H,eB=new H,tB=new Xe,pT=new vc,i3=new Bi;let Yn=class extends _n{constructor(e=new fn,t=new vs){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,n=[0];for(let r=1,s=t.count;r<s;r++)ZP.fromBufferAttribute(t,r-1),eB.fromBufferAttribute(t,r),n[r]=n[r-1],n[r]+=ZP.distanceTo(eB);e.setAttribute("lineDistance",new Gt(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const n=this.geometry,r=this.matrixWorld,s=e.params.Line.threshold,o=n.drawRange;if(n.boundingSphere===null&&n.computeBoundingSphere(),i3.copy(n.boundingSphere),i3.applyMatrix4(r),i3.radius+=s,e.ray.intersectsSphere(i3)===!1)return;tB.copy(r).invert(),pT.copy(e.ray).applyMatrix4(tB);const a=s/((this.scale.x+this.scale.y+this.scale.z)/3),l=a*a,c=new H,u=new H,h=new H,f=new H,d=this.isLineSegments?2:1,m=n.index,g=n.attributes.position;if(m!==null){const y=Math.max(0,o.start),E=Math.min(m.count,o.start+o.count);for(let x=y,C=E-1;x<C;x+=d){const T=m.getX(x),I=m.getX(x+1);if(c.fromBufferAttribute(g,T),u.fromBufferAttribute(g,I),pT.distanceSqToSegment(c,u,f,h)>l)continue;f.applyMatrix4(this.matrixWorld);const L=e.ray.origin.distanceTo(f);L<e.near||L>e.far||t.push({distance:L,point:h.clone().applyMatrix4(this.matrixWorld),index:x,face:null,faceIndex:null,object:this})}}else{const y=Math.max(0,o.start),E=Math.min(g.count,o.start+o.count);for(let x=y,C=E-1;x<C;x+=d){if(c.fromBufferAttribute(g,x),u.fromBufferAttribute(g,x+1),pT.distanceSqToSegment(c,u,f,h)>l)continue;f.applyMatrix4(this.matrixWorld);const I=e.ray.origin.distanceTo(f);I<e.near||I>e.far||t.push({distance:I,point:h.clone().applyMatrix4(this.matrixWorld),index:x,face:null,faceIndex:null,object:this})}}}updateMorphTargets(){const t=this.geometry.morphAttributes,n=Object.keys(t);if(n.length>0){const r=t[n[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=r.length;s<o;s++){const a=r[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}};const nB=new H,iB=new H;class Ru extends Yn{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,n=[];for(let r=0,s=t.count;r<s;r+=2)nB.fromBufferAttribute(t,r),iB.fromBufferAttribute(t,r+1),n[r]=r===0?0:n[r-1],n[r+1]=n[r]+nB.distanceTo(iB);e.setAttribute("lineDistance",new Gt(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class b6 extends Yn{constructor(e,t){super(e,t),this.isLineLoop=!0,this.type="LineLoop"}}class lx extends Us{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new ut(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const rB=new Xe,bM=new vc,r3=new Bi,s3=new H;let I6=class extends _n{constructor(e=new fn,t=new lx){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}raycast(e,t){const n=this.geometry,r=this.matrixWorld,s=e.params.Points.threshold,o=n.drawRange;if(n.boundingSphere===null&&n.computeBoundingSphere(),r3.copy(n.boundingSphere),r3.applyMatrix4(r),r3.radius+=s,e.ray.intersectsSphere(r3)===!1)return;rB.copy(r).invert(),bM.copy(e.ray).applyMatrix4(rB);const a=s/((this.scale.x+this.scale.y+this.scale.z)/3),l=a*a,c=n.index,h=n.attributes.position;if(c!==null){const f=Math.max(0,o.start),d=Math.min(c.count,o.start+o.count);for(let m=f,A=d;m<A;m++){const g=c.getX(m);s3.fromBufferAttribute(h,g),sB(s3,g,l,r,e,t,this)}}else{const f=Math.max(0,o.start),d=Math.min(h.count,o.start+o.count);for(let m=f,A=d;m<A;m++)s3.fromBufferAttribute(h,m),sB(s3,m,l,r,e,t,this)}}updateMorphTargets(){const t=this.geometry.morphAttributes,n=Object.keys(t);if(n.length>0){const r=t[n[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=r.length;s<o;s++){const a=r[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}};function sB(i,e,t,n,r,s,o){const a=bM.distanceSqToPoint(i);if(a<t){const l=new H;bM.closestPointToPoint(i,l),l.applyMatrix4(n);const c=r.ray.origin.distanceTo(l);if(c<r.near||c>r.far)return;s.push({distance:c,distanceToRay:Math.sqrt(a),point:l,index:e,face:null,object:o})}}let XU=class extends vi{constructor(e,t,n,r,s,o,a,l,c){super(e,t,n,r,s,o,a,l,c),this.isVideoTexture=!0,this.minFilter=o!==void 0?o:Pn,this.magFilter=s!==void 0?s:Pn,this.generateMipmaps=!1;const u=this;function h(){u.needsUpdate=!0,e.requestVideoFrameCallback(h)}"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback(h)}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image;"requestVideoFrameCallback"in e===!1&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}};class Kte extends vi{constructor(e,t){super({width:e,height:t}),this.isFramebufferTexture=!0,this.magFilter=zn,this.minFilter=zn,this.generateMipmaps=!1,this.needsUpdate=!0}}class gp extends vi{constructor(e,t,n,r,s,o,a,l,c,u,h,f){super(null,o,a,l,c,u,r,s,h,f),this.isCompressedTexture=!0,this.image={width:t,height:n},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}let $te=class extends gp{constructor(e,t,n,r,s,o){super(e,t,n,s,o),this.isCompressedArrayTexture=!0,this.image.depth=r,this.wrapR=ji}},Yte=class extends gp{constructor(e,t,n){super(void 0,e[0].width,e[0].height,t,n,_u),this.isCompressedCubeTexture=!0,this.isCubeTexture=!0,this.image=e}};class M6 extends vi{constructor(e,t,n,r,s,o,a,l,c){super(e,t,n,r,s,o,a,l,c),this.isCanvasTexture=!0,this.needsUpdate=!0}}class xc{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){const n=this.getUtoTmapping(e);return this.getPoint(n,t)}getPoints(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return t}getSpacedPoints(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPointAt(n/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let n,r=this.getPoint(0),s=0;t.push(0);for(let o=1;o<=e;o++)n=this.getPoint(o/e),s+=n.distanceTo(r),t.push(s),r=n;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){const n=this.getLengths();let r=0;const s=n.length;let o;t?o=t:o=e*n[s-1];let a=0,l=s-1,c;for(;a<=l;)if(r=Math.floor(a+(l-a)/2),c=n[r]-o,c<0)a=r+1;else if(c>0)l=r-1;else{l=r;break}if(r=l,n[r]===o)return r/(s-1);const u=n[r],f=n[r+1]-u,d=(o-u)/f;return(r+d)/(s-1)}getTangent(e,t){let r=e-1e-4,s=e+1e-4;r<0&&(r=0),s>1&&(s=1);const o=this.getPoint(r),a=this.getPoint(s),l=t||(o.isVector2?new Ue:new H);return l.copy(a).sub(o).normalize(),l}getTangentAt(e,t){const n=this.getUtoTmapping(e);return this.getTangent(n,t)}computeFrenetFrames(e,t){const n=new H,r=[],s=[],o=[],a=new H,l=new Xe;for(let d=0;d<=e;d++){const m=d/e;r[d]=this.getTangentAt(m,new H)}s[0]=new H,o[0]=new H;let c=Number.MAX_VALUE;const u=Math.abs(r[0].x),h=Math.abs(r[0].y),f=Math.abs(r[0].z);u<=c&&(c=u,n.set(1,0,0)),h<=c&&(c=h,n.set(0,1,0)),f<=c&&n.set(0,0,1),a.crossVectors(r[0],n).normalize(),s[0].crossVectors(r[0],a),o[0].crossVectors(r[0],s[0]);for(let d=1;d<=e;d++){if(s[d]=s[d-1].clone(),o[d]=o[d-1].clone(),a.crossVectors(r[d-1],r[d]),a.length()>Number.EPSILON){a.normalize();const m=Math.acos(rs(r[d-1].dot(r[d]),-1,1));s[d].applyMatrix4(l.makeRotationAxis(a,m))}o[d].crossVectors(r[d],s[d])}if(t===!0){let d=Math.acos(rs(s[0].dot(s[e]),-1,1));d/=e,r[0].dot(a.crossVectors(s[0],s[e]))>0&&(d=-d);for(let m=1;m<=e;m++)s[m].applyMatrix4(l.makeRotationAxis(r[m],d*m)),o[m].crossVectors(r[m],s[m])}return{tangents:r,normals:s,binormals:o}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class Gm extends xc{constructor(e=0,t=0,n=1,r=1,s=0,o=Math.PI*2,a=!1,l=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=n,this.yRadius=r,this.aStartAngle=s,this.aEndAngle=o,this.aClockwise=a,this.aRotation=l}getPoint(e,t){const n=t||new Ue,r=Math.PI*2;let s=this.aEndAngle-this.aStartAngle;const o=Math.abs(s)<Number.EPSILON;for(;s<0;)s+=r;for(;s>r;)s-=r;s<Number.EPSILON&&(o?s=0:s=r),this.aClockwise===!0&&!o&&(s===r?s=-r:s=s-r);const a=this.aStartAngle+e*s;let l=this.aX+this.xRadius*Math.cos(a),c=this.aY+this.yRadius*Math.sin(a);if(this.aRotation!==0){const u=Math.cos(this.aRotation),h=Math.sin(this.aRotation),f=l-this.aX,d=c-this.aY;l=f*u-d*h+this.aX,c=f*h+d*u+this.aY}return n.set(l,c)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}class qU extends Gm{constructor(e,t,n,r,s,o){super(e,t,n,n,r,s,o),this.isArcCurve=!0,this.type="ArcCurve"}}function R6(){let i=0,e=0,t=0,n=0;function r(s,o,a,l){i=s,e=a,t=-3*s+3*o-2*a-l,n=2*s-2*o+a+l}return{initCatmullRom:function(s,o,a,l,c){r(o,a,c*(a-s),c*(l-o))},initNonuniformCatmullRom:function(s,o,a,l,c,u,h){let f=(o-s)/c-(a-s)/(c+u)+(a-o)/u,d=(a-o)/u-(l-o)/(u+h)+(l-a)/h;f*=u,d*=u,r(o,a,f,d)},calc:function(s){const o=s*s,a=o*s;return i+e*s+t*o+n*a}}}const o3=new H,mT=new R6,gT=new R6,AT=new R6;class Lw extends xc{constructor(e=[],t=!1,n="centripetal",r=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=n,this.tension=r}getPoint(e,t=new H){const n=t,r=this.points,s=r.length,o=(s-(this.closed?0:1))*e;let a=Math.floor(o),l=o-a;this.closed?a+=a>0?0:(Math.floor(Math.abs(a)/s)+1)*s:l===0&&a===s-1&&(a=s-2,l=1);let c,u;this.closed||a>0?c=r[(a-1)%s]:(o3.subVectors(r[0],r[1]).add(r[0]),c=o3);const h=r[a%s],f=r[(a+1)%s];if(this.closed||a+2<s?u=r[(a+2)%s]:(o3.subVectors(r[s-1],r[s-2]).add(r[s-1]),u=o3),this.curveType==="centripetal"||this.curveType==="chordal"){const d=this.curveType==="chordal"?.5:.25;let m=Math.pow(c.distanceToSquared(h),d),A=Math.pow(h.distanceToSquared(f),d),g=Math.pow(f.distanceToSquared(u),d);A<1e-4&&(A=1),m<1e-4&&(m=A),g<1e-4&&(g=A),mT.initNonuniformCatmullRom(c.x,h.x,f.x,u.x,m,A,g),gT.initNonuniformCatmullRom(c.y,h.y,f.y,u.y,m,A,g),AT.initNonuniformCatmullRom(c.z,h.z,f.z,u.z,m,A,g)}else this.curveType==="catmullrom"&&(mT.initCatmullRom(c.x,h.x,f.x,u.x,this.tension),gT.initCatmullRom(c.y,h.y,f.y,u.y,this.tension),AT.initCatmullRom(c.z,h.z,f.z,u.z,this.tension));return n.set(mT.calc(l),gT.calc(l),AT.calc(l)),n}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const r=e.points[t];this.points.push(r.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const r=this.points[t];e.points.push(r.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const r=e.points[t];this.points.push(new H().fromArray(r))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function oB(i,e,t,n,r){const s=(n-e)*.5,o=(r-t)*.5,a=i*i,l=i*a;return(2*t-2*n+s+o)*l+(-3*t+3*n-2*s-o)*a+s*i+t}function Xte(i,e){const t=1-i;return t*t*e}function qte(i,e){return 2*(1-i)*i*e}function Jte(i,e){return i*i*e}function Xv(i,e,t,n){return Xte(i,e)+qte(i,t)+Jte(i,n)}function Zte(i,e){const t=1-i;return t*t*t*e}function ene(i,e){const t=1-i;return 3*t*t*i*e}function tne(i,e){return 3*(1-i)*i*i*e}function nne(i,e){return i*i*i*e}function qv(i,e,t,n,r){return Zte(i,e)+ene(i,t)+tne(i,n)+nne(i,r)}class L6 extends xc{constructor(e=new Ue,t=new Ue,n=new Ue,r=new Ue){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=n,this.v3=r}getPoint(e,t=new Ue){const n=t,r=this.v0,s=this.v1,o=this.v2,a=this.v3;return n.set(qv(e,r.x,s.x,o.x,a.x),qv(e,r.y,s.y,o.y,a.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class P6 extends xc{constructor(e=new H,t=new H,n=new H,r=new H){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=n,this.v3=r}getPoint(e,t=new H){const n=t,r=this.v0,s=this.v1,o=this.v2,a=this.v3;return n.set(qv(e,r.x,s.x,o.x,a.x),qv(e,r.y,s.y,o.y,a.y),qv(e,r.z,s.z,o.z,a.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class B6 extends xc{constructor(e=new Ue,t=new Ue){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new Ue){const n=t;return e===1?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new Ue){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class JU extends xc{constructor(e=new H,t=new H){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=t}getPoint(e,t=new H){const n=t;return e===1?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new H){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class D6 extends xc{constructor(e=new Ue,t=new Ue,n=new Ue){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new Ue){const n=t,r=this.v0,s=this.v1,o=this.v2;return n.set(Xv(e,r.x,s.x,o.x),Xv(e,r.y,s.y,o.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class Pw extends xc{constructor(e=new H,t=new H,n=new H){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new H){const n=t,r=this.v0,s=this.v1,o=this.v2;return n.set(Xv(e,r.x,s.x,o.x),Xv(e,r.y,s.y,o.y),Xv(e,r.z,s.z,o.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class k6 extends xc{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e,t=new Ue){const n=t,r=this.points,s=(r.length-1)*e,o=Math.floor(s),a=s-o,l=r[o===0?o:o-1],c=r[o],u=r[o>r.length-2?r.length-1:o+1],h=r[o>r.length-3?r.length-1:o+2];return n.set(oB(a,l.x,c.x,u.x,h.x),oB(a,l.y,c.y,u.y,h.y)),n}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const r=e.points[t];this.points.push(r.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const r=this.points[t];e.points.push(r.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const r=e.points[t];this.points.push(new Ue().fromArray(r))}return this}}var IS=Object.freeze({__proto__:null,ArcCurve:qU,CatmullRomCurve3:Lw,CubicBezierCurve:L6,CubicBezierCurve3:P6,EllipseCurve:Gm,LineCurve:B6,LineCurve3:JU,QuadraticBezierCurve:D6,QuadraticBezierCurve3:Pw,SplineCurve:k6});class F6 extends xc{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);if(!e.equals(t)){const n=e.isVector2===!0?"LineCurve":"LineCurve3";this.curves.push(new IS[n](t,e))}return this}getPoint(e,t){const n=e*this.getLength(),r=this.getCurveLengths();let s=0;for(;s<r.length;){if(r[s]>=n){const o=r[s]-n,a=this.curves[s],l=a.getLength(),c=l===0?0:1-o/l;return a.getPointAt(c,t)}s++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let t=0;for(let n=0,r=this.curves.length;n<r;n++)t+=this.curves[n].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){const t=[];let n;for(let r=0,s=this.curves;r<s.length;r++){const o=s[r],a=o.isEllipseCurve?e*2:o.isLineCurve||o.isLineCurve3?1:o.isSplineCurve?e*o.points.length:e,l=o.getPoints(a);for(let c=0;c<l.length;c++){const u=l[c];n&&n.equals(u)||(t.push(u),n=u)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const r=e.curves[t];this.curves.push(r.clone())}return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,n=this.curves.length;t<n;t++){const r=this.curves[t];e.curves.push(r.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const r=e.curves[t];this.curves.push(new IS[r.type]().fromJSON(r))}return this}}class Xd extends F6{constructor(e){super(),this.type="Path",this.currentPoint=new Ue,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,n=e.length;t<n;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){const n=new B6(this.currentPoint.clone(),new Ue(e,t));return this.curves.push(n),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,n,r){const s=new D6(this.currentPoint.clone(),new Ue(e,t),new Ue(n,r));return this.curves.push(s),this.currentPoint.set(n,r),this}bezierCurveTo(e,t,n,r,s,o){const a=new L6(this.currentPoint.clone(),new Ue(e,t),new Ue(n,r),new Ue(s,o));return this.curves.push(a),this.currentPoint.set(s,o),this}splineThru(e){const t=[this.currentPoint.clone()].concat(e),n=new k6(t);return this.curves.push(n),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,n,r,s,o){const a=this.currentPoint.x,l=this.currentPoint.y;return this.absarc(e+a,t+l,n,r,s,o),this}absarc(e,t,n,r,s,o){return this.absellipse(e,t,n,n,r,s,o),this}ellipse(e,t,n,r,s,o,a,l){const c=this.currentPoint.x,u=this.currentPoint.y;return this.absellipse(e+c,t+u,n,r,s,o,a,l),this}absellipse(e,t,n,r,s,o,a,l){const c=new Gm(e,t,n,r,s,o,a,l);if(this.curves.length>0){const h=c.getPoint(0);h.equals(this.currentPoint)||this.lineTo(h.x,h.y)}this.curves.push(c);const u=c.getPoint(1);return this.currentPoint.copy(u),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class cx extends fn{constructor(e=[new Ue(0,-.5),new Ue(.5,0),new Ue(0,.5)],t=12,n=0,r=Math.PI*2){super(),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:n,phiLength:r},t=Math.floor(t),r=rs(r,0,Math.PI*2);const s=[],o=[],a=[],l=[],c=[],u=1/t,h=new H,f=new Ue,d=new H,m=new H,A=new H;let g=0,y=0;for(let E=0;E<=e.length-1;E++)switch(E){case 0:g=e[E+1].x-e[E].x,y=e[E+1].y-e[E].y,d.x=y*1,d.y=-g,d.z=y*0,A.copy(d),d.normalize(),l.push(d.x,d.y,d.z);break;case e.length-1:l.push(A.x,A.y,A.z);break;default:g=e[E+1].x-e[E].x,y=e[E+1].y-e[E].y,d.x=y*1,d.y=-g,d.z=y*0,m.copy(d),d.x+=A.x,d.y+=A.y,d.z+=A.z,d.normalize(),l.push(d.x,d.y,d.z),A.copy(m)}for(let E=0;E<=t;E++){const x=n+E*u*r,C=Math.sin(x),T=Math.cos(x);for(let I=0;I<=e.length-1;I++){h.x=e[I].x*C,h.y=e[I].y,h.z=e[I].x*T,o.push(h.x,h.y,h.z),f.x=E/t,f.y=I/(e.length-1),a.push(f.x,f.y);const M=l[3*I+0]*C,L=l[3*I+1],R=l[3*I+0]*T;c.push(M,L,R)}}for(let E=0;E<t;E++)for(let x=0;x<e.length-1;x++){const C=x+E*e.length,T=C,I=C+e.length,M=C+e.length+1,L=C+1;s.push(T,I,L),s.push(M,L,I)}this.setIndex(s),this.setAttribute("position",new Gt(o,3)),this.setAttribute("uv",new Gt(a,2)),this.setAttribute("normal",new Gt(c,3))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new cx(e.points,e.segments,e.phiStart,e.phiLength)}}class Bw extends cx{constructor(e=1,t=1,n=4,r=8){const s=new Xd;s.absarc(0,-t/2,e,Math.PI*1.5,0),s.absarc(0,t/2,e,0,Math.PI*.5),super(s.getPoints(n),r),this.type="CapsuleGeometry",this.parameters={radius:e,length:t,capSegments:n,radialSegments:r}}static fromJSON(e){return new Bw(e.radius,e.length,e.capSegments,e.radialSegments)}}class Dw extends fn{constructor(e=1,t=32,n=0,r=Math.PI*2){super(),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:n,thetaLength:r},t=Math.max(3,t);const s=[],o=[],a=[],l=[],c=new H,u=new Ue;o.push(0,0,0),a.push(0,0,1),l.push(.5,.5);for(let h=0,f=3;h<=t;h++,f+=3){const d=n+h/t*r;c.x=e*Math.cos(d),c.y=e*Math.sin(d),o.push(c.x,c.y,c.z),a.push(0,0,1),u.x=(o[f]/e+1)/2,u.y=(o[f+1]/e+1)/2,l.push(u.x,u.y)}for(let h=1;h<=t;h++)s.push(h,h+1,0);this.setIndex(s),this.setAttribute("position",new Gt(o,3)),this.setAttribute("normal",new Gt(a,3)),this.setAttribute("uv",new Gt(l,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Dw(e.radius,e.segments,e.thetaStart,e.thetaLength)}}class yo extends fn{constructor(e=1,t=1,n=1,r=32,s=1,o=!1,a=0,l=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:r,heightSegments:s,openEnded:o,thetaStart:a,thetaLength:l};const c=this;r=Math.floor(r),s=Math.floor(s);const u=[],h=[],f=[],d=[];let m=0;const A=[],g=n/2;let y=0;E(),o===!1&&(e>0&&x(!0),t>0&&x(!1)),this.setIndex(u),this.setAttribute("position",new Gt(h,3)),this.setAttribute("normal",new Gt(f,3)),this.setAttribute("uv",new Gt(d,2));function E(){const C=new H,T=new H;let I=0;const M=(t-e)/n;for(let L=0;L<=s;L++){const R=[],P=L/s,F=P*(t-e)+e;for(let k=0;k<=r;k++){const z=k/r,U=z*l+a,W=Math.sin(U),$=Math.cos(U);T.x=F*W,T.y=-P*n+g,T.z=F*$,h.push(T.x,T.y,T.z),C.set(W,M,$).normalize(),f.push(C.x,C.y,C.z),d.push(z,1-P),R.push(m++)}A.push(R)}for(let L=0;L<r;L++)for(let R=0;R<s;R++){const P=A[R][L],F=A[R+1][L],k=A[R+1][L+1],z=A[R][L+1];u.push(P,F,z),u.push(F,k,z),I+=6}c.addGroup(y,I,0),y+=I}function x(C){const T=m,I=new Ue,M=new H;let L=0;const R=C===!0?e:t,P=C===!0?1:-1;for(let k=1;k<=r;k++)h.push(0,g*P,0),f.push(0,P,0),d.push(.5,.5),m++;const F=m;for(let k=0;k<=r;k++){const U=k/r*l+a,W=Math.cos(U),$=Math.sin(U);M.x=R*$,M.y=g*P,M.z=R*W,h.push(M.x,M.y,M.z),f.push(0,P,0),I.x=W*.5+.5,I.y=$*.5*P+.5,d.push(I.x,I.y),m++}for(let k=0;k<r;k++){const z=T+k,U=F+k;C===!0?u.push(U,U+1,z):u.push(U+1,U,z),L+=3}c.addGroup(y,L,C===!0?1:2),y+=L}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new yo(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class kw extends yo{constructor(e=1,t=1,n=32,r=1,s=!1,o=0,a=Math.PI*2){super(0,e,t,n,r,s,o,a),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:n,heightSegments:r,openEnded:s,thetaStart:o,thetaLength:a}}static fromJSON(e){return new kw(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class Ap extends fn{constructor(e=[],t=[],n=1,r=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:n,detail:r};const s=[],o=[];a(r),c(n),u(),this.setAttribute("position",new Gt(s,3)),this.setAttribute("normal",new Gt(s.slice(),3)),this.setAttribute("uv",new Gt(o,2)),r===0?this.computeVertexNormals():this.normalizeNormals();function a(E){const x=new H,C=new H,T=new H;for(let I=0;I<t.length;I+=3)d(t[I+0],x),d(t[I+1],C),d(t[I+2],T),l(x,C,T,E)}function l(E,x,C,T){const I=T+1,M=[];for(let L=0;L<=I;L++){M[L]=[];const R=E.clone().lerp(C,L/I),P=x.clone().lerp(C,L/I),F=I-L;for(let k=0;k<=F;k++)k===0&&L===I?M[L][k]=R:M[L][k]=R.clone().lerp(P,k/F)}for(let L=0;L<I;L++)for(let R=0;R<2*(I-L)-1;R++){const P=Math.floor(R/2);R%2===0?(f(M[L][P+1]),f(M[L+1][P]),f(M[L][P])):(f(M[L][P+1]),f(M[L+1][P+1]),f(M[L+1][P]))}}function c(E){const x=new H;for(let C=0;C<s.length;C+=3)x.x=s[C+0],x.y=s[C+1],x.z=s[C+2],x.normalize().multiplyScalar(E),s[C+0]=x.x,s[C+1]=x.y,s[C+2]=x.z}function u(){const E=new H;for(let x=0;x<s.length;x+=3){E.x=s[x+0],E.y=s[x+1],E.z=s[x+2];const C=g(E)/2/Math.PI+.5,T=y(E)/Math.PI+.5;o.push(C,1-T)}m(),h()}function h(){for(let E=0;E<o.length;E+=6){const x=o[E+0],C=o[E+2],T=o[E+4],I=Math.max(x,C,T),M=Math.min(x,C,T);I>.9&&M<.1&&(x<.2&&(o[E+0]+=1),C<.2&&(o[E+2]+=1),T<.2&&(o[E+4]+=1))}}function f(E){s.push(E.x,E.y,E.z)}function d(E,x){const C=E*3;x.x=e[C+0],x.y=e[C+1],x.z=e[C+2]}function m(){const E=new H,x=new H,C=new H,T=new H,I=new Ue,M=new Ue,L=new Ue;for(let R=0,P=0;R<s.length;R+=9,P+=6){E.set(s[R+0],s[R+1],s[R+2]),x.set(s[R+3],s[R+4],s[R+5]),C.set(s[R+6],s[R+7],s[R+8]),I.set(o[P+0],o[P+1]),M.set(o[P+2],o[P+3]),L.set(o[P+4],o[P+5]),T.copy(E).add(x).add(C).divideScalar(3);const F=g(T);A(I,P+0,E,F),A(M,P+2,x,F),A(L,P+4,C,F)}}function A(E,x,C,T){T<0&&E.x===1&&(o[x]=E.x-1),C.x===0&&C.z===0&&(o[x]=T/2/Math.PI+.5)}function g(E){return Math.atan2(E.z,-E.x)}function y(E){return Math.atan2(-E.y,Math.sqrt(E.x*E.x+E.z*E.z))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Ap(e.vertices,e.indices,e.radius,e.details)}}class Fw extends Ap{constructor(e=1,t=0){const n=(1+Math.sqrt(5))/2,r=1/n,s=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-r,-n,0,-r,n,0,r,-n,0,r,n,-r,-n,0,-r,n,0,r,-n,0,r,n,0,-n,0,-r,n,0,-r,-n,0,r,n,0,r],o=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];super(s,o,e,t),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Fw(e.radius,e.detail)}}const a3=new H,l3=new H,yT=new H,c3=new ks;class O6 extends fn{constructor(e=null,t=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:e,thresholdAngle:t},e!==null){const r=Math.pow(10,4),s=Math.cos(Um*t),o=e.getIndex(),a=e.getAttribute("position"),l=o?o.count:a.count,c=[0,0,0],u=["a","b","c"],h=new Array(3),f={},d=[];for(let m=0;m<l;m+=3){o?(c[0]=o.getX(m),c[1]=o.getX(m+1),c[2]=o.getX(m+2)):(c[0]=m,c[1]=m+1,c[2]=m+2);const{a:A,b:g,c:y}=c3;if(A.fromBufferAttribute(a,c[0]),g.fromBufferAttribute(a,c[1]),y.fromBufferAttribute(a,c[2]),c3.getNormal(yT),h[0]=`${Math.round(A.x*r)},${Math.round(A.y*r)},${Math.round(A.z*r)}`,h[1]=`${Math.round(g.x*r)},${Math.round(g.y*r)},${Math.round(g.z*r)}`,h[2]=`${Math.round(y.x*r)},${Math.round(y.y*r)},${Math.round(y.z*r)}`,!(h[0]===h[1]||h[1]===h[2]||h[2]===h[0]))for(let E=0;E<3;E++){const x=(E+1)%3,C=h[E],T=h[x],I=c3[u[E]],M=c3[u[x]],L=`${C}_${T}`,R=`${T}_${C}`;R in f&&f[R]?(yT.dot(f[R].normal)<=s&&(d.push(I.x,I.y,I.z),d.push(M.x,M.y,M.z)),f[R]=null):L in f||(f[L]={index0:c[E],index1:c[x],normal:yT.clone()})}}for(const m in f)if(f[m]){const{index0:A,index1:g}=f[m];a3.fromBufferAttribute(a,A),l3.fromBufferAttribute(a,g),d.push(a3.x,a3.y,a3.z),d.push(l3.x,l3.y,l3.z)}this.setAttribute("position",new Gt(d,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}let Lf=class extends Xd{constructor(e){super(e),this.uuid=Ll(),this.type="Shape",this.holes=[]}getPointsHoles(e){const t=[];for(let n=0,r=this.holes.length;n<r;n++)t[n]=this.holes[n].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const r=e.holes[t];this.holes.push(r.clone())}return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,n=this.holes.length;t<n;t++){const r=this.holes[t];e.holes.push(r.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const r=e.holes[t];this.holes.push(new Xd().fromJSON(r))}return this}};const ine={triangulate:function(i,e,t=2){const n=e&&e.length,r=n?e[0]*t:i.length;let s=ZU(i,0,r,t,!0);const o=[];if(!s||s.next===s.prev)return o;let a,l,c,u,h,f,d;if(n&&(s=lne(i,e,s,t)),i.length>80*t){a=c=i[0],l=u=i[1];for(let m=t;m<r;m+=t)h=i[m],f=i[m+1],h<a&&(a=h),f<l&&(l=f),h>c&&(c=h),f>u&&(u=f);d=Math.max(c-a,u-l),d=d!==0?32767/d:0}return M2(s,o,t,a,l,d,0),o}};function ZU(i,e,t,n,r){let s,o;if(r===vne(i,e,t,n)>0)for(s=e;s<t;s+=n)o=aB(s,i[s],i[s+1],o);else for(s=t-n;s>=e;s-=n)o=aB(s,i[s],i[s+1],o);return o&&Ow(o,o.next)&&(L2(o),o=o.next),o}function Zm(i,e){if(!i)return i;e||(e=i);let t=i,n;do if(n=!1,!t.steiner&&(Ow(t,t.next)||Wr(t.prev,t,t.next)===0)){if(L2(t),t=e=t.prev,t===t.next)break;n=!0}else t=t.next;while(n||t!==e);return e}function M2(i,e,t,n,r,s,o){if(!i)return;!o&&s&&dne(i,n,r,s);let a=i,l,c;for(;i.prev!==i.next;){if(l=i.prev,c=i.next,s?sne(i,n,r,s):rne(i)){e.push(l.i/t|0),e.push(i.i/t|0),e.push(c.i/t|0),L2(i),i=c.next,a=c.next;continue}if(i=c,i===a){o?o===1?(i=one(Zm(i),e,t),M2(i,e,t,n,r,s,2)):o===2&&ane(i,e,t,n,r,s):M2(Zm(i),e,t,n,r,s,1);break}}}function rne(i){const e=i.prev,t=i,n=i.next;if(Wr(e,t,n)>=0)return!1;const r=e.x,s=t.x,o=n.x,a=e.y,l=t.y,c=n.y,u=r<s?r<o?r:o:s<o?s:o,h=a<l?a<c?a:c:l<c?l:c,f=r>s?r>o?r:o:s>o?s:o,d=a>l?a>c?a:c:l>c?l:c;let m=n.next;for(;m!==e;){if(m.x>=u&&m.x<=f&&m.y>=h&&m.y<=d&&M1(r,a,s,l,o,c,m.x,m.y)&&Wr(m.prev,m,m.next)>=0)return!1;m=m.next}return!0}function sne(i,e,t,n){const r=i.prev,s=i,o=i.next;if(Wr(r,s,o)>=0)return!1;const a=r.x,l=s.x,c=o.x,u=r.y,h=s.y,f=o.y,d=a<l?a<c?a:c:l<c?l:c,m=u<h?u<f?u:f:h<f?h:f,A=a>l?a>c?a:c:l>c?l:c,g=u>h?u>f?u:f:h>f?h:f,y=IM(d,m,e,t,n),E=IM(A,g,e,t,n);let x=i.prevZ,C=i.nextZ;for(;x&&x.z>=y&&C&&C.z<=E;){if(x.x>=d&&x.x<=A&&x.y>=m&&x.y<=g&&x!==r&&x!==o&&M1(a,u,l,h,c,f,x.x,x.y)&&Wr(x.prev,x,x.next)>=0||(x=x.prevZ,C.x>=d&&C.x<=A&&C.y>=m&&C.y<=g&&C!==r&&C!==o&&M1(a,u,l,h,c,f,C.x,C.y)&&Wr(C.prev,C,C.next)>=0))return!1;C=C.nextZ}for(;x&&x.z>=y;){if(x.x>=d&&x.x<=A&&x.y>=m&&x.y<=g&&x!==r&&x!==o&&M1(a,u,l,h,c,f,x.x,x.y)&&Wr(x.prev,x,x.next)>=0)return!1;x=x.prevZ}for(;C&&C.z<=E;){if(C.x>=d&&C.x<=A&&C.y>=m&&C.y<=g&&C!==r&&C!==o&&M1(a,u,l,h,c,f,C.x,C.y)&&Wr(C.prev,C,C.next)>=0)return!1;C=C.nextZ}return!0}function one(i,e,t){let n=i;do{const r=n.prev,s=n.next.next;!Ow(r,s)&&ez(r,n,n.next,s)&&R2(r,s)&&R2(s,r)&&(e.push(r.i/t|0),e.push(n.i/t|0),e.push(s.i/t|0),L2(n),L2(n.next),n=i=s),n=n.next}while(n!==i);return Zm(n)}function ane(i,e,t,n,r,s){let o=i;do{let a=o.next.next;for(;a!==o.prev;){if(o.i!==a.i&&gne(o,a)){let l=tz(o,a);o=Zm(o,o.next),l=Zm(l,l.next),M2(o,e,t,n,r,s,0),M2(l,e,t,n,r,s,0);return}a=a.next}o=o.next}while(o!==i)}function lne(i,e,t,n){const r=[];let s,o,a,l,c;for(s=0,o=e.length;s<o;s++)a=e[s]*n,l=s<o-1?e[s+1]*n:i.length,c=ZU(i,a,l,n,!1),c===c.next&&(c.steiner=!0),r.push(mne(c));for(r.sort(cne),s=0;s<r.length;s++)t=une(r[s],t);return t}function cne(i,e){return i.x-e.x}function une(i,e){const t=hne(i,e);if(!t)return e;const n=tz(t,i);return Zm(n,n.next),Zm(t,t.next)}function hne(i,e){let t=e,n=-1/0,r;const s=i.x,o=i.y;do{if(o<=t.y&&o>=t.next.y&&t.next.y!==t.y){const f=t.x+(o-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(f<=s&&f>n&&(n=f,r=t.x<t.next.x?t:t.next,f===s))return r}t=t.next}while(t!==e);if(!r)return null;const a=r,l=r.x,c=r.y;let u=1/0,h;t=r;do s>=t.x&&t.x>=l&&s!==t.x&&M1(o<c?s:n,o,l,c,o<c?n:s,o,t.x,t.y)&&(h=Math.abs(o-t.y)/(s-t.x),R2(t,i)&&(h<u||h===u&&(t.x>r.x||t.x===r.x&&fne(r,t)))&&(r=t,u=h)),t=t.next;while(t!==a);return r}function fne(i,e){return Wr(i.prev,i,e.prev)<0&&Wr(e.next,i,i.next)<0}function dne(i,e,t,n){let r=i;do r.z===0&&(r.z=IM(r.x,r.y,e,t,n)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next;while(r!==i);r.prevZ.nextZ=null,r.prevZ=null,pne(r)}function pne(i){let e,t,n,r,s,o,a,l,c=1;do{for(t=i,i=null,s=null,o=0;t;){for(o++,n=t,a=0,e=0;e<c&&(a++,n=n.nextZ,!!n);e++);for(l=c;a>0||l>0&&n;)a!==0&&(l===0||!n||t.z<=n.z)?(r=t,t=t.nextZ,a--):(r=n,n=n.nextZ,l--),s?s.nextZ=r:i=r,r.prevZ=s,s=r;t=n}s.nextZ=null,c*=2}while(o>1);return i}function IM(i,e,t,n,r){return i=(i-t)*r|0,e=(e-n)*r|0,i=(i|i<<8)&16711935,i=(i|i<<4)&252645135,i=(i|i<<2)&858993459,i=(i|i<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,i|e<<1}function mne(i){let e=i,t=i;do(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next;while(e!==i);return t}function M1(i,e,t,n,r,s,o,a){return(r-o)*(e-a)>=(i-o)*(s-a)&&(i-o)*(n-a)>=(t-o)*(e-a)&&(t-o)*(s-a)>=(r-o)*(n-a)}function gne(i,e){return i.next.i!==e.i&&i.prev.i!==e.i&&!Ane(i,e)&&(R2(i,e)&&R2(e,i)&&yne(i,e)&&(Wr(i.prev,i,e.prev)||Wr(i,e.prev,e))||Ow(i,e)&&Wr(i.prev,i,i.next)>0&&Wr(e.prev,e,e.next)>0)}function Wr(i,e,t){return(e.y-i.y)*(t.x-e.x)-(e.x-i.x)*(t.y-e.y)}function Ow(i,e){return i.x===e.x&&i.y===e.y}function ez(i,e,t,n){const r=h3(Wr(i,e,t)),s=h3(Wr(i,e,n)),o=h3(Wr(t,n,i)),a=h3(Wr(t,n,e));return!!(r!==s&&o!==a||r===0&&u3(i,t,e)||s===0&&u3(i,n,e)||o===0&&u3(t,i,n)||a===0&&u3(t,e,n))}function u3(i,e,t){return e.x<=Math.max(i.x,t.x)&&e.x>=Math.min(i.x,t.x)&&e.y<=Math.max(i.y,t.y)&&e.y>=Math.min(i.y,t.y)}function h3(i){return i>0?1:i<0?-1:0}function Ane(i,e){let t=i;do{if(t.i!==i.i&&t.next.i!==i.i&&t.i!==e.i&&t.next.i!==e.i&&ez(t,t.next,i,e))return!0;t=t.next}while(t!==i);return!1}function R2(i,e){return Wr(i.prev,i,i.next)<0?Wr(i,e,i.next)>=0&&Wr(i,i.prev,e)>=0:Wr(i,e,i.prev)<0||Wr(i,i.next,e)<0}function yne(i,e){let t=i,n=!1;const r=(i.x+e.x)/2,s=(i.y+e.y)/2;do t.y>s!=t.next.y>s&&t.next.y!==t.y&&r<(t.next.x-t.x)*(s-t.y)/(t.next.y-t.y)+t.x&&(n=!n),t=t.next;while(t!==i);return n}function tz(i,e){const t=new MM(i.i,i.x,i.y),n=new MM(e.i,e.x,e.y),r=i.next,s=e.prev;return i.next=e,e.prev=i,t.next=r,r.prev=t,n.next=t,t.prev=n,s.next=n,n.prev=s,n}function aB(i,e,t,n){const r=new MM(i,e,t);return n?(r.next=n.next,r.prev=n,n.next.prev=r,n.next=r):(r.prev=r,r.next=r),r}function L2(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function MM(i,e,t){this.i=i,this.x=e,this.y=t,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function vne(i,e,t,n){let r=0;for(let s=e,o=t-n;s<t;s+=n)r+=(i[o]-i[s])*(i[s+1]+i[o+1]),o=s;return r}class xu{static area(e){const t=e.length;let n=0;for(let r=t-1,s=0;s<t;r=s++)n+=e[r].x*e[s].y-e[s].x*e[r].y;return n*.5}static isClockWise(e){return xu.area(e)<0}static triangulateShape(e,t){const n=[],r=[],s=[];lB(e),cB(n,e);let o=e.length;t.forEach(lB);for(let l=0;l<t.length;l++)r.push(o),o+=t[l].length,cB(n,t[l]);const a=ine.triangulate(n,r);for(let l=0;l<a.length;l+=3)s.push(a.slice(l,l+3));return s}}function lB(i){const e=i.length;e>2&&i[e-1].equals(i[0])&&i.pop()}function cB(i,e){for(let t=0;t<e.length;t++)i.push(e[t].x),i.push(e[t].y)}class ux extends fn{constructor(e=new Lf([new Ue(.5,.5),new Ue(-.5,.5),new Ue(-.5,-.5),new Ue(.5,-.5)]),t={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];const n=this,r=[],s=[];for(let a=0,l=e.length;a<l;a++){const c=e[a];o(c)}this.setAttribute("position",new Gt(r,3)),this.setAttribute("uv",new Gt(s,2)),this.computeVertexNormals();function o(a){const l=[],c=t.curveSegments!==void 0?t.curveSegments:12,u=t.steps!==void 0?t.steps:1,h=t.depth!==void 0?t.depth:1;let f=t.bevelEnabled!==void 0?t.bevelEnabled:!0,d=t.bevelThickness!==void 0?t.bevelThickness:.2,m=t.bevelSize!==void 0?t.bevelSize:d-.1,A=t.bevelOffset!==void 0?t.bevelOffset:0,g=t.bevelSegments!==void 0?t.bevelSegments:3;const y=t.extrudePath,E=t.UVGenerator!==void 0?t.UVGenerator:xne;let x,C=!1,T,I,M,L;y&&(x=y.getSpacedPoints(u),C=!0,f=!1,T=y.computeFrenetFrames(u,!1),I=new H,M=new H,L=new H),f||(g=0,d=0,m=0,A=0);const R=a.extractPoints(c);let P=R.shape;const F=R.holes;if(!xu.isClockWise(P)){P=P.reverse();for(let ce=0,we=F.length;ce<we;ce++){const Ee=F[ce];xu.isClockWise(Ee)&&(F[ce]=Ee.reverse())}}const z=xu.triangulateShape(P,F),U=P;for(let ce=0,we=F.length;ce<we;ce++){const Ee=F[ce];P=P.concat(Ee)}function W(ce,we,Ee){return we||console.error("THREE.ExtrudeGeometry: vec does not exist"),ce.clone().addScaledVector(we,Ee)}const $=P.length,oe=z.length;function X(ce,we,Ee){let ve,Ae,Le;const Te=ce.x-we.x,ne=ce.y-we.y,V=Ee.x-ce.x,de=Ee.y-ce.y,Re=Te*Te+ne*ne,Be=Te*de-ne*V;if(Math.abs(Be)>Number.EPSILON){const Fe=Math.sqrt(Re),He=Math.sqrt(V*V+de*de),it=we.x-ne/Fe,$e=we.y+Te/Fe,ct=Ee.x-de/He,pt=Ee.y+V/He,We=((ct-it)*de-(pt-$e)*V)/(Te*de-ne*V);ve=it+Te*We-ce.x,Ae=$e+ne*We-ce.y;const Mt=ve*ve+Ae*Ae;if(Mt<=2)return new Ue(ve,Ae);Le=Math.sqrt(Mt/2)}else{let Fe=!1;Te>Number.EPSILON?V>Number.EPSILON&&(Fe=!0):Te<-Number.EPSILON?V<-Number.EPSILON&&(Fe=!0):Math.sign(ne)===Math.sign(de)&&(Fe=!0),Fe?(ve=-ne,Ae=Te,Le=Math.sqrt(Re)):(ve=Te,Ae=ne,Le=Math.sqrt(Re/2))}return new Ue(ve/Le,Ae/Le)}const Q=[];for(let ce=0,we=U.length,Ee=we-1,ve=ce+1;ce<we;ce++,Ee++,ve++)Ee===we&&(Ee=0),ve===we&&(ve=0),Q[ce]=X(U[ce],U[Ee],U[ve]);const Y=[];let O,K=Q.concat();for(let ce=0,we=F.length;ce<we;ce++){const Ee=F[ce];O=[];for(let ve=0,Ae=Ee.length,Le=Ae-1,Te=ve+1;ve<Ae;ve++,Le++,Te++)Le===Ae&&(Le=0),Te===Ae&&(Te=0),O[ve]=X(Ee[ve],Ee[Le],Ee[Te]);Y.push(O),K=K.concat(O)}for(let ce=0;ce<g;ce++){const we=ce/g,Ee=d*Math.cos(we*Math.PI/2),ve=m*Math.sin(we*Math.PI/2)+A;for(let Ae=0,Le=U.length;Ae<Le;Ae++){const Te=W(U[Ae],Q[Ae],ve);re(Te.x,Te.y,-Ee)}for(let Ae=0,Le=F.length;Ae<Le;Ae++){const Te=F[Ae];O=Y[Ae];for(let ne=0,V=Te.length;ne<V;ne++){const de=W(Te[ne],O[ne],ve);re(de.x,de.y,-Ee)}}}const te=m+A;for(let ce=0;ce<$;ce++){const we=f?W(P[ce],K[ce],te):P[ce];C?(M.copy(T.normals[0]).multiplyScalar(we.x),I.copy(T.binormals[0]).multiplyScalar(we.y),L.copy(x[0]).add(M).add(I),re(L.x,L.y,L.z)):re(we.x,we.y,0)}for(let ce=1;ce<=u;ce++)for(let we=0;we<$;we++){const Ee=f?W(P[we],K[we],te):P[we];C?(M.copy(T.normals[ce]).multiplyScalar(Ee.x),I.copy(T.binormals[ce]).multiplyScalar(Ee.y),L.copy(x[ce]).add(M).add(I),re(L.x,L.y,L.z)):re(Ee.x,Ee.y,h/u*ce)}for(let ce=g-1;ce>=0;ce--){const we=ce/g,Ee=d*Math.cos(we*Math.PI/2),ve=m*Math.sin(we*Math.PI/2)+A;for(let Ae=0,Le=U.length;Ae<Le;Ae++){const Te=W(U[Ae],Q[Ae],ve);re(Te.x,Te.y,h+Ee)}for(let Ae=0,Le=F.length;Ae<Le;Ae++){const Te=F[Ae];O=Y[Ae];for(let ne=0,V=Te.length;ne<V;ne++){const de=W(Te[ne],O[ne],ve);C?re(de.x,de.y+x[u-1].y,x[u-1].x+Ee):re(de.x,de.y,h+Ee)}}}q(),J();function q(){const ce=r.length/3;if(f){let we=0,Ee=$*we;for(let ve=0;ve<oe;ve++){const Ae=z[ve];se(Ae[2]+Ee,Ae[1]+Ee,Ae[0]+Ee)}we=u+g*2,Ee=$*we;for(let ve=0;ve<oe;ve++){const Ae=z[ve];se(Ae[0]+Ee,Ae[1]+Ee,Ae[2]+Ee)}}else{for(let we=0;we<oe;we++){const Ee=z[we];se(Ee[2],Ee[1],Ee[0])}for(let we=0;we<oe;we++){const Ee=z[we];se(Ee[0]+$*u,Ee[1]+$*u,Ee[2]+$*u)}}n.addGroup(ce,r.length/3-ce,0)}function J(){const ce=r.length/3;let we=0;ie(U,we),we+=U.length;for(let Ee=0,ve=F.length;Ee<ve;Ee++){const Ae=F[Ee];ie(Ae,we),we+=Ae.length}n.addGroup(ce,r.length/3-ce,1)}function ie(ce,we){let Ee=ce.length;for(;--Ee>=0;){const ve=Ee;let Ae=Ee-1;Ae<0&&(Ae=ce.length-1);for(let Le=0,Te=u+g*2;Le<Te;Le++){const ne=$*Le,V=$*(Le+1),de=we+ve+ne,Re=we+Ae+ne,Be=we+Ae+V,Fe=we+ve+V;ge(de,Re,Be,Fe)}}}function re(ce,we,Ee){l.push(ce),l.push(we),l.push(Ee)}function se(ce,we,Ee){xe(ce),xe(we),xe(Ee);const ve=r.length/3,Ae=E.generateTopUV(n,r,ve-3,ve-2,ve-1);pe(Ae[0]),pe(Ae[1]),pe(Ae[2])}function ge(ce,we,Ee,ve){xe(ce),xe(we),xe(ve),xe(we),xe(Ee),xe(ve);const Ae=r.length/3,Le=E.generateSideWallUV(n,r,Ae-6,Ae-3,Ae-2,Ae-1);pe(Le[0]),pe(Le[1]),pe(Le[3]),pe(Le[1]),pe(Le[2]),pe(Le[3])}function xe(ce){r.push(l[ce*3+0]),r.push(l[ce*3+1]),r.push(l[ce*3+2])}function pe(ce){s.push(ce.x),s.push(ce.y)}}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON(),t=this.parameters.shapes,n=this.parameters.options;return Ene(t,n,e)}static fromJSON(e,t){const n=[];for(let s=0,o=e.shapes.length;s<o;s++){const a=t[e.shapes[s]];n.push(a)}const r=e.options.extrudePath;return r!==void 0&&(e.options.extrudePath=new IS[r.type]().fromJSON(r)),new ux(n,e.options)}}const xne={generateTopUV:function(i,e,t,n,r){const s=e[t*3],o=e[t*3+1],a=e[n*3],l=e[n*3+1],c=e[r*3],u=e[r*3+1];return[new Ue(s,o),new Ue(a,l),new Ue(c,u)]},generateSideWallUV:function(i,e,t,n,r,s){const o=e[t*3],a=e[t*3+1],l=e[t*3+2],c=e[n*3],u=e[n*3+1],h=e[n*3+2],f=e[r*3],d=e[r*3+1],m=e[r*3+2],A=e[s*3],g=e[s*3+1],y=e[s*3+2];return Math.abs(a-u)<Math.abs(o-c)?[new Ue(o,1-l),new Ue(c,1-h),new Ue(f,1-m),new Ue(A,1-y)]:[new Ue(a,1-l),new Ue(u,1-h),new Ue(d,1-m),new Ue(g,1-y)]}};function Ene(i,e,t){if(t.shapes=[],Array.isArray(i))for(let n=0,r=i.length;n<r;n++){const s=i[n];t.shapes.push(s.uuid)}else t.shapes.push(i.uuid);return t.options=Object.assign({},e),e.extrudePath!==void 0&&(t.options.extrudePath=e.extrudePath.toJSON()),t}class hx extends Ap{constructor(e=1,t=0){const n=(1+Math.sqrt(5))/2,r=[-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1],s=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];super(r,s,e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new hx(e.radius,e.detail)}}class rc extends Ap{constructor(e=1,t=0){const n=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],r=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];super(n,r,e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new rc(e.radius,e.detail)}}class Nw extends fn{constructor(e=.5,t=1,n=32,r=1,s=0,o=Math.PI*2){super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:n,phiSegments:r,thetaStart:s,thetaLength:o},n=Math.max(3,n),r=Math.max(1,r);const a=[],l=[],c=[],u=[];let h=e;const f=(t-e)/r,d=new H,m=new Ue;for(let A=0;A<=r;A++){for(let g=0;g<=n;g++){const y=s+g/n*o;d.x=h*Math.cos(y),d.y=h*Math.sin(y),l.push(d.x,d.y,d.z),c.push(0,0,1),m.x=(d.x/t+1)/2,m.y=(d.y/t+1)/2,u.push(m.x,m.y)}h+=f}for(let A=0;A<r;A++){const g=A*(n+1);for(let y=0;y<n;y++){const E=y+g,x=E,C=E+n+1,T=E+n+2,I=E+1;a.push(x,C,I),a.push(C,T,I)}}this.setIndex(a),this.setAttribute("position",new Gt(l,3)),this.setAttribute("normal",new Gt(c,3)),this.setAttribute("uv",new Gt(u,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Nw(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}}class Uw extends fn{constructor(e=new Lf([new Ue(0,.5),new Ue(-.5,-.5),new Ue(.5,-.5)]),t=12){super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:t};const n=[],r=[],s=[],o=[];let a=0,l=0;if(Array.isArray(e)===!1)c(e);else for(let u=0;u<e.length;u++)c(e[u]),this.addGroup(a,l,u),a+=l,l=0;this.setIndex(n),this.setAttribute("position",new Gt(r,3)),this.setAttribute("normal",new Gt(s,3)),this.setAttribute("uv",new Gt(o,2));function c(u){const h=r.length/3,f=u.extractPoints(t);let d=f.shape;const m=f.holes;xu.isClockWise(d)===!1&&(d=d.reverse());for(let g=0,y=m.length;g<y;g++){const E=m[g];xu.isClockWise(E)===!0&&(m[g]=E.reverse())}const A=xu.triangulateShape(d,m);for(let g=0,y=m.length;g<y;g++){const E=m[g];d=d.concat(E)}for(let g=0,y=d.length;g<y;g++){const E=d[g];r.push(E.x,E.y,0),s.push(0,0,1),o.push(E.x,E.y)}for(let g=0,y=A.length;g<y;g++){const E=A[g],x=E[0]+h,C=E[1]+h,T=E[2]+h;n.push(x,C,T),l+=3}}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON(),t=this.parameters.shapes;return _ne(t,e)}static fromJSON(e,t){const n=[];for(let r=0,s=e.shapes.length;r<s;r++){const o=t[e.shapes[r]];n.push(o)}return new Uw(n,e.curveSegments)}}function _ne(i,e){if(e.shapes=[],Array.isArray(i))for(let t=0,n=i.length;t<n;t++){const r=i[t];e.shapes.push(r.uuid)}else e.shapes.push(i.uuid);return e}class d0 extends fn{constructor(e=1,t=32,n=16,r=0,s=Math.PI*2,o=0,a=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:r,phiLength:s,thetaStart:o,thetaLength:a},t=Math.max(3,Math.floor(t)),n=Math.max(2,Math.floor(n));const l=Math.min(o+a,Math.PI);let c=0;const u=[],h=new H,f=new H,d=[],m=[],A=[],g=[];for(let y=0;y<=n;y++){const E=[],x=y/n;let C=0;y===0&&o===0?C=.5/t:y===n&&l===Math.PI&&(C=-.5/t);for(let T=0;T<=t;T++){const I=T/t;h.x=-e*Math.cos(r+I*s)*Math.sin(o+x*a),h.y=e*Math.cos(o+x*a),h.z=e*Math.sin(r+I*s)*Math.sin(o+x*a),m.push(h.x,h.y,h.z),f.copy(h).normalize(),A.push(f.x,f.y,f.z),g.push(I+C,1-x),E.push(c++)}u.push(E)}for(let y=0;y<n;y++)for(let E=0;E<t;E++){const x=u[y][E+1],C=u[y][E],T=u[y+1][E],I=u[y+1][E+1];(y!==0||o>0)&&d.push(x,C,I),(y!==n-1||l<Math.PI)&&d.push(C,T,I)}this.setIndex(d),this.setAttribute("position",new Gt(m,3)),this.setAttribute("normal",new Gt(A,3)),this.setAttribute("uv",new Gt(g,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new d0(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class zw extends Ap{constructor(e=1,t=0){const n=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],r=[2,1,0,0,3,2,1,3,0,2,3,1];super(n,r,e,t),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new zw(e.radius,e.detail)}}class Hd extends fn{constructor(e=1,t=.4,n=12,r=48,s=Math.PI*2){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:n,tubularSegments:r,arc:s},n=Math.floor(n),r=Math.floor(r);const o=[],a=[],l=[],c=[],u=new H,h=new H,f=new H;for(let d=0;d<=n;d++)for(let m=0;m<=r;m++){const A=m/r*s,g=d/n*Math.PI*2;h.x=(e+t*Math.cos(g))*Math.cos(A),h.y=(e+t*Math.cos(g))*Math.sin(A),h.z=t*Math.sin(g),a.push(h.x,h.y,h.z),u.x=e*Math.cos(A),u.y=e*Math.sin(A),f.subVectors(h,u).normalize(),l.push(f.x,f.y,f.z),c.push(m/r),c.push(d/n)}for(let d=1;d<=n;d++)for(let m=1;m<=r;m++){const A=(r+1)*d+m-1,g=(r+1)*(d-1)+m-1,y=(r+1)*(d-1)+m,E=(r+1)*d+m;o.push(A,g,E),o.push(g,y,E)}this.setIndex(o),this.setAttribute("position",new Gt(a,3)),this.setAttribute("normal",new Gt(l,3)),this.setAttribute("uv",new Gt(c,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Hd(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}class Gw extends fn{constructor(e=1,t=.4,n=64,r=8,s=2,o=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:n,radialSegments:r,p:s,q:o},n=Math.floor(n),r=Math.floor(r);const a=[],l=[],c=[],u=[],h=new H,f=new H,d=new H,m=new H,A=new H,g=new H,y=new H;for(let x=0;x<=n;++x){const C=x/n*s*Math.PI*2;E(C,s,o,e,d),E(C+.01,s,o,e,m),g.subVectors(m,d),y.addVectors(m,d),A.crossVectors(g,y),y.crossVectors(A,g),A.normalize(),y.normalize();for(let T=0;T<=r;++T){const I=T/r*Math.PI*2,M=-t*Math.cos(I),L=t*Math.sin(I);h.x=d.x+(M*y.x+L*A.x),h.y=d.y+(M*y.y+L*A.y),h.z=d.z+(M*y.z+L*A.z),l.push(h.x,h.y,h.z),f.subVectors(h,d).normalize(),c.push(f.x,f.y,f.z),u.push(x/n),u.push(T/r)}}for(let x=1;x<=n;x++)for(let C=1;C<=r;C++){const T=(r+1)*(x-1)+(C-1),I=(r+1)*x+(C-1),M=(r+1)*x+C,L=(r+1)*(x-1)+C;a.push(T,I,L),a.push(I,M,L)}this.setIndex(a),this.setAttribute("position",new Gt(l,3)),this.setAttribute("normal",new Gt(c,3)),this.setAttribute("uv",new Gt(u,2));function E(x,C,T,I,M){const L=Math.cos(x),R=Math.sin(x),P=T/C*x,F=Math.cos(P);M.x=I*(2+F)*.5*L,M.y=I*(2+F)*R*.5,M.z=I*Math.sin(P)*.5}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Gw(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}}class Hw extends fn{constructor(e=new Pw(new H(-1,-1,0),new H(-1,1,0),new H(1,1,0)),t=64,n=1,r=8,s=!1){super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:n,radialSegments:r,closed:s};const o=e.computeFrenetFrames(t,s);this.tangents=o.tangents,this.normals=o.normals,this.binormals=o.binormals;const a=new H,l=new H,c=new Ue;let u=new H;const h=[],f=[],d=[],m=[];A(),this.setIndex(m),this.setAttribute("position",new Gt(h,3)),this.setAttribute("normal",new Gt(f,3)),this.setAttribute("uv",new Gt(d,2));function A(){for(let x=0;x<t;x++)g(x);g(s===!1?t:0),E(),y()}function g(x){u=e.getPointAt(x/t,u);const C=o.normals[x],T=o.binormals[x];for(let I=0;I<=r;I++){const M=I/r*Math.PI*2,L=Math.sin(M),R=-Math.cos(M);l.x=R*C.x+L*T.x,l.y=R*C.y+L*T.y,l.z=R*C.z+L*T.z,l.normalize(),f.push(l.x,l.y,l.z),a.x=u.x+n*l.x,a.y=u.y+n*l.y,a.z=u.z+n*l.z,h.push(a.x,a.y,a.z)}}function y(){for(let x=1;x<=t;x++)for(let C=1;C<=r;C++){const T=(r+1)*(x-1)+(C-1),I=(r+1)*x+(C-1),M=(r+1)*x+C,L=(r+1)*(x-1)+C;m.push(T,I,L),m.push(I,M,L)}}function E(){for(let x=0;x<=t;x++)for(let C=0;C<=r;C++)c.x=x/t,c.y=C/r,d.push(c.x,c.y)}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new Hw(new IS[e.path.type]().fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}class N6 extends fn{constructor(e=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:e},e!==null){const t=[],n=new Set,r=new H,s=new H;if(e.index!==null){const o=e.attributes.position,a=e.index;let l=e.groups;l.length===0&&(l=[{start:0,count:a.count,materialIndex:0}]);for(let c=0,u=l.length;c<u;++c){const h=l[c],f=h.start,d=h.count;for(let m=f,A=f+d;m<A;m+=3)for(let g=0;g<3;g++){const y=a.getX(m+g),E=a.getX(m+(g+1)%3);r.fromBufferAttribute(o,y),s.fromBufferAttribute(o,E),uB(r,s,n)===!0&&(t.push(r.x,r.y,r.z),t.push(s.x,s.y,s.z))}}}else{const o=e.attributes.position;for(let a=0,l=o.count/3;a<l;a++)for(let c=0;c<3;c++){const u=3*a+c,h=3*a+(c+1)%3;r.fromBufferAttribute(o,u),s.fromBufferAttribute(o,h),uB(r,s,n)===!0&&(t.push(r.x,r.y,r.z),t.push(s.x,s.y,s.z))}}this.setAttribute("position",new Gt(t,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}function uB(i,e,t){const n=`${i.x},${i.y},${i.z}-${e.x},${e.y},${e.z}`,r=`${e.x},${e.y},${e.z}-${i.x},${i.y},${i.z}`;return t.has(n)===!0||t.has(r)===!0?!1:(t.add(n),t.add(r),!0)}var hB=Object.freeze({__proto__:null,BoxGeometry:ya,CapsuleGeometry:Bw,CircleGeometry:Dw,ConeGeometry:kw,CylinderGeometry:yo,DodecahedronGeometry:Fw,EdgesGeometry:O6,ExtrudeGeometry:ux,IcosahedronGeometry:hx,LatheGeometry:cx,OctahedronGeometry:rc,PlaneGeometry:Fs,PolyhedronGeometry:Ap,RingGeometry:Nw,ShapeGeometry:Uw,SphereGeometry:d0,TetrahedronGeometry:zw,TorusGeometry:Hd,TorusKnotGeometry:Gw,TubeGeometry:Hw,WireframeGeometry:N6});class nz extends Us{constructor(e){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new ut(0),this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.fog=e.fog,this}}class iz extends Mi{constructor(e){super(e),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class p0 extends Us{constructor(e){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new ut(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ut(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=mp,this.normalScale=new Ue(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class nl extends p0{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Ue(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return rs(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new ut(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new ut(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new ut(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(e)}get anisotropy(){return this._anisotropy}set anisotropy(e){this._anisotropy>0!=e>0&&this.version++,this._anisotropy=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=e.anisotropy,this.anisotropyRotation=e.anisotropyRotation,this.anisotropyMap=e.anisotropyMap,this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}class Jv extends Us{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new ut(16777215),this.specular=new ut(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ut(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=mp,this.normalScale=new Ue(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=ex,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class rz extends Us{constructor(e){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new ut(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ut(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=mp,this.normalScale=new Ue(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}class U6 extends Us{constructor(e){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=mp,this.normalScale=new Ue(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}class fx extends Us{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new ut(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ut(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=mp,this.normalScale=new Ue(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=ex,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class sz extends Us{constructor(e){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new ut(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=mp,this.normalScale=new Ue(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this.fog=e.fog,this}}class oz extends vs{constructor(e){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}function Pm(i,e,t){return!i||!t&&i.constructor===e?i:typeof e.BYTES_PER_ELEMENT=="number"?new e(i):Array.prototype.slice.call(i)}function az(i){return ArrayBuffer.isView(i)&&!(i instanceof DataView)}function lz(i){function e(r,s){return i[r]-i[s]}const t=i.length,n=new Array(t);for(let r=0;r!==t;++r)n[r]=r;return n.sort(e),n}function RM(i,e,t){const n=i.length,r=new i.constructor(n);for(let s=0,o=0;o!==n;++s){const a=t[s]*e;for(let l=0;l!==e;++l)r[o++]=i[a+l]}return r}function z6(i,e,t,n){let r=1,s=i[0];for(;s!==void 0&&s[n]===void 0;)s=i[r++];if(s===void 0)return;let o=s[n];if(o!==void 0)if(Array.isArray(o))do o=s[n],o!==void 0&&(e.push(s.time),t.push.apply(t,o)),s=i[r++];while(s!==void 0);else if(o.toArray!==void 0)do o=s[n],o!==void 0&&(e.push(s.time),o.toArray(t,t.length)),s=i[r++];while(s!==void 0);else do o=s[n],o!==void 0&&(e.push(s.time),t.push(o)),s=i[r++];while(s!==void 0)}function Sne(i,e,t,n,r=30){const s=i.clone();s.name=e;const o=[];for(let l=0;l<s.tracks.length;++l){const c=s.tracks[l],u=c.getValueSize(),h=[],f=[];for(let d=0;d<c.times.length;++d){const m=c.times[d]*r;if(!(m<t||m>=n)){h.push(c.times[d]);for(let A=0;A<u;++A)f.push(c.values[d*u+A])}}h.length!==0&&(c.times=Pm(h,c.times.constructor),c.values=Pm(f,c.values.constructor),o.push(c))}s.tracks=o;let a=1/0;for(let l=0;l<s.tracks.length;++l)a>s.tracks[l].times[0]&&(a=s.tracks[l].times[0]);for(let l=0;l<s.tracks.length;++l)s.tracks[l].shift(-1*a);return s.resetDuration(),s}function wne(i,e=0,t=i,n=30){n<=0&&(n=30);const r=t.tracks.length,s=e/n;for(let o=0;o<r;++o){const a=t.tracks[o],l=a.ValueTypeName;if(l==="bool"||l==="string")continue;const c=i.tracks.find(function(y){return y.name===a.name&&y.ValueTypeName===l});if(c===void 0)continue;let u=0;const h=a.getValueSize();a.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(u=h/3);let f=0;const d=c.getValueSize();c.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(f=d/3);const m=a.times.length-1;let A;if(s<=a.times[0]){const y=u,E=h-u;A=a.values.slice(y,E)}else if(s>=a.times[m]){const y=m*h+u,E=y+h-u;A=a.values.slice(y,E)}else{const y=a.createInterpolant(),E=u,x=h-u;y.evaluate(s),A=y.resultBuffer.slice(E,x)}l==="quaternion"&&new Xt().fromArray(A).normalize().conjugate().toArray(A);const g=c.times.length;for(let y=0;y<g;++y){const E=y*d+f;if(l==="quaternion")Xt.multiplyQuaternionsFlat(c.values,E,A,0,c.values,E);else{const x=d-f*2;for(let C=0;C<x;++C)c.values[E+C]-=A[C]}}}return i.blendMode=g6,i}const Cne={convertArray:Pm,isTypedArray:az,getKeyframeOrder:lz,sortedArray:RM,flattenJSON:z6,subclip:Sne,makeClipAdditive:wne};class SA{constructor(e,t,n,r){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=r!==void 0?r:new t.constructor(n),this.sampleValues=t,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let n=this._cachedIndex,r=t[n],s=t[n-1];e:{t:{let o;n:{i:if(!(e<r)){for(let a=n+2;;){if(r===void 0){if(e<s)break i;return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}if(n===a)break;if(s=r,r=t[++n],e<r)break t}o=t.length;break n}if(!(e>=s)){const a=t[1];e<a&&(n=2,s=a);for(let l=n-2;;){if(s===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(n===l)break;if(r=s,s=t[--n-1],e>=s)break t}o=n,n=0;break n}break e}for(;n<o;){const a=n+o>>>1;e<t[a]?o=a:n=a+1}if(r=t[n],s=t[n-1],s===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(r===void 0)return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}this._cachedIndex=n,this.intervalChanged_(n,s,r)}return this.interpolate_(n,s,e,r)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,r=this.valueSize,s=e*r;for(let o=0;o!==r;++o)t[o]=n[s+o];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class cz extends SA{constructor(e,t,n,r){super(e,t,n,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:Im,endingEnd:Im}}intervalChanged_(e,t,n){const r=this.parameterPositions;let s=e-2,o=e+1,a=r[s],l=r[o];if(a===void 0)switch(this.getSettings_().endingStart){case Mm:s=e,a=2*t-n;break;case S2:s=r.length-2,a=t+r[s]-r[s+1];break;default:s=e,a=n}if(l===void 0)switch(this.getSettings_().endingEnd){case Mm:o=e,l=2*n-t;break;case S2:o=1,l=n+r[1]-r[0];break;default:o=e-1,l=t}const c=(n-t)*.5,u=this.valueSize;this._weightPrev=c/(t-a),this._weightNext=c/(l-n),this._offsetPrev=s*u,this._offsetNext=o*u}interpolate_(e,t,n,r){const s=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=e*a,c=l-a,u=this._offsetPrev,h=this._offsetNext,f=this._weightPrev,d=this._weightNext,m=(n-t)/(r-t),A=m*m,g=A*m,y=-f*g+2*f*A-f*m,E=(1+f)*g+(-1.5-2*f)*A+(-.5+f)*m+1,x=(-1-d)*g+(1.5+d)*A+.5*m,C=d*g-d*A;for(let T=0;T!==a;++T)s[T]=y*o[u+T]+E*o[c+T]+x*o[l+T]+C*o[h+T];return s}}class G6 extends SA{constructor(e,t,n,r){super(e,t,n,r)}interpolate_(e,t,n,r){const s=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=e*a,c=l-a,u=(n-t)/(r-t),h=1-u;for(let f=0;f!==a;++f)s[f]=o[c+f]*h+o[l+f]*u;return s}}class uz extends SA{constructor(e,t,n,r){super(e,t,n,r)}interpolate_(e){return this.copySampleValue_(e-1)}}class Lu{constructor(e,t,n,r){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(t===void 0||t.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=Pm(t,this.TimeBufferType),this.values=Pm(n,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let n;if(t.toJSON!==this.toJSON)n=t.toJSON(e);else{n={name:e.name,times:Pm(e.times,Array),values:Pm(e.values,Array)};const r=e.getInterpolation();r!==e.DefaultInterpolation&&(n.interpolation=r)}return n.type=e.ValueTypeName,n}InterpolantFactoryMethodDiscrete(e){return new uz(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new G6(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new cz(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case q1:t=this.InterpolantFactoryMethodDiscrete;break;case Jm:t=this.InterpolantFactoryMethodLinear;break;case H_:t=this.InterpolantFactoryMethodSmooth;break}if(t===void 0){const n="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(n);return console.warn("THREE.KeyframeTrack:",n),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return q1;case this.InterpolantFactoryMethodLinear:return Jm;case this.InterpolantFactoryMethodSmooth:return H_}}getValueSize(){return this.values.length/this.times.length}shift(e){if(e!==0){const t=this.times;for(let n=0,r=t.length;n!==r;++n)t[n]+=e}return this}scale(e){if(e!==1){const t=this.times;for(let n=0,r=t.length;n!==r;++n)t[n]*=e}return this}trim(e,t){const n=this.times,r=n.length;let s=0,o=r-1;for(;s!==r&&n[s]<e;)++s;for(;o!==-1&&n[o]>t;)--o;if(++o,s!==0||o!==r){s>=o&&(o=Math.max(o,1),s=o-1);const a=this.getValueSize();this.times=n.slice(s,o),this.values=this.values.slice(s*a,o*a)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const n=this.times,r=this.values,s=n.length;s===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let o=null;for(let a=0;a!==s;a++){const l=n[a];if(typeof l=="number"&&isNaN(l)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,a,l),e=!1;break}if(o!==null&&o>l){console.error("THREE.KeyframeTrack: Out of order keys.",this,a,l,o),e=!1;break}o=l}if(r!==void 0&&az(r))for(let a=0,l=r.length;a!==l;++a){const c=r[a];if(isNaN(c)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,a,c),e=!1;break}}return e}optimize(){const e=this.times.slice(),t=this.values.slice(),n=this.getValueSize(),r=this.getInterpolation()===H_,s=e.length-1;let o=1;for(let a=1;a<s;++a){let l=!1;const c=e[a],u=e[a+1];if(c!==u&&(a!==1||c!==e[0]))if(r)l=!0;else{const h=a*n,f=h-n,d=h+n;for(let m=0;m!==n;++m){const A=t[h+m];if(A!==t[f+m]||A!==t[d+m]){l=!0;break}}}if(l){if(a!==o){e[o]=e[a];const h=a*n,f=o*n;for(let d=0;d!==n;++d)t[f+d]=t[h+d]}++o}}if(s>0){e[o]=e[s];for(let a=s*n,l=o*n,c=0;c!==n;++c)t[l+c]=t[a+c];++o}return o!==e.length?(this.times=e.slice(0,o),this.values=t.slice(0,o*n)):(this.times=e,this.values=t),this}clone(){const e=this.times.slice(),t=this.values.slice(),n=this.constructor,r=new n(this.name,e,t);return r.createInterpolant=this.createInterpolant,r}}Lu.prototype.TimeBufferType=Float32Array;Lu.prototype.ValueBufferType=Float32Array;Lu.prototype.DefaultInterpolation=Jm;class m0 extends Lu{}m0.prototype.ValueTypeName="bool";m0.prototype.ValueBufferType=Array;m0.prototype.DefaultInterpolation=q1;m0.prototype.InterpolantFactoryMethodLinear=void 0;m0.prototype.InterpolantFactoryMethodSmooth=void 0;class H6 extends Lu{}H6.prototype.ValueTypeName="color";class sp extends Lu{}sp.prototype.ValueTypeName="number";class hz extends SA{constructor(e,t,n,r){super(e,t,n,r)}interpolate_(e,t,n,r){const s=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=(n-t)/(r-t);let c=e*a;for(let u=c+a;c!==u;c+=4)Xt.slerpFlat(s,0,o,c-a,o,c,l);return s}}class vh extends Lu{InterpolantFactoryMethodLinear(e){return new hz(this.times,this.values,this.getValueSize(),e)}}vh.prototype.ValueTypeName="quaternion";vh.prototype.DefaultInterpolation=Jm;vh.prototype.InterpolantFactoryMethodSmooth=void 0;class g0 extends Lu{}g0.prototype.ValueTypeName="string";g0.prototype.ValueBufferType=Array;g0.prototype.DefaultInterpolation=q1;g0.prototype.InterpolantFactoryMethodLinear=void 0;g0.prototype.InterpolantFactoryMethodSmooth=void 0;class Of extends Lu{}Of.prototype.ValueTypeName="vector";class op{constructor(e,t=-1,n,r=xw){this.name=e,this.tracks=n,this.duration=t,this.blendMode=r,this.uuid=Ll(),this.duration<0&&this.resetDuration()}static parse(e){const t=[],n=e.tracks,r=1/(e.fps||1);for(let o=0,a=n.length;o!==a;++o)t.push(bne(n[o]).scale(r));const s=new this(e.name,e.duration,t,e.blendMode);return s.uuid=e.uuid,s}static toJSON(e){const t=[],n=e.tracks,r={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let s=0,o=n.length;s!==o;++s)t.push(Lu.toJSON(n[s]));return r}static CreateFromMorphTargetSequence(e,t,n,r){const s=t.length,o=[];for(let a=0;a<s;a++){let l=[],c=[];l.push((a+s-1)%s,a,(a+1)%s),c.push(0,1,0);const u=lz(l);l=RM(l,1,u),c=RM(c,1,u),!r&&l[0]===0&&(l.push(s),c.push(c[0])),o.push(new sp(".morphTargetInfluences["+t[a].name+"]",l,c).scale(1/n))}return new this(e,-1,o)}static findByName(e,t){let n=e;if(!Array.isArray(e)){const r=e;n=r.geometry&&r.geometry.animations||r.animations}for(let r=0;r<n.length;r++)if(n[r].name===t)return n[r];return null}static CreateClipsFromMorphTargetSequences(e,t,n){const r={},s=/^([\w-]*?)([\d]+)$/;for(let a=0,l=e.length;a<l;a++){const c=e[a],u=c.name.match(s);if(u&&u.length>1){const h=u[1];let f=r[h];f||(r[h]=f=[]),f.push(c)}}const o=[];for(const a in r)o.push(this.CreateFromMorphTargetSequence(a,r[a],t,n));return o}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const n=function(h,f,d,m,A){if(d.length!==0){const g=[],y=[];z6(d,g,y,m),g.length!==0&&A.push(new h(f,g,y))}},r=[],s=e.name||"default",o=e.fps||30,a=e.blendMode;let l=e.length||-1;const c=e.hierarchy||[];for(let h=0;h<c.length;h++){const f=c[h].keys;if(!(!f||f.length===0))if(f[0].morphTargets){const d={};let m;for(m=0;m<f.length;m++)if(f[m].morphTargets)for(let A=0;A<f[m].morphTargets.length;A++)d[f[m].morphTargets[A]]=-1;for(const A in d){const g=[],y=[];for(let E=0;E!==f[m].morphTargets.length;++E){const x=f[m];g.push(x.time),y.push(x.morphTarget===A?1:0)}r.push(new sp(".morphTargetInfluence["+A+"]",g,y))}l=d.length*o}else{const d=".bones["+t[h].name+"]";n(Of,d+".position",f,"pos",r),n(vh,d+".quaternion",f,"rot",r),n(Of,d+".scale",f,"scl",r)}}return r.length===0?null:new this(s,l,r,a)}resetDuration(){const e=this.tracks;let t=0;for(let n=0,r=e.length;n!==r;++n){const s=this.tracks[n];t=Math.max(t,s.times[s.times.length-1])}return this.duration=t,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function Tne(i){switch(i.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return sp;case"vector":case"vector2":case"vector3":case"vector4":return Of;case"color":return H6;case"quaternion":return vh;case"bool":case"boolean":return m0;case"string":return g0}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+i)}function bne(i){if(i.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=Tne(i.type);if(i.times===void 0){const t=[],n=[];z6(i.keys,t,n,"value"),i.times=t,i.values=n}return e.parse!==void 0?e.parse(i):new e(i.name,i.times,i.values,i.interpolation)}const Rf={enabled:!1,files:{},add:function(i,e){this.enabled!==!1&&(this.files[i]=e)},get:function(i){if(this.enabled!==!1)return this.files[i]},remove:function(i){delete this.files[i]},clear:function(){this.files={}}};class Qw{constructor(e,t,n){const r=this;let s=!1,o=0,a=0,l;const c=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=n,this.itemStart=function(u){a++,s===!1&&r.onStart!==void 0&&r.onStart(u,o,a),s=!0},this.itemEnd=function(u){o++,r.onProgress!==void 0&&r.onProgress(u,o,a),o===a&&(s=!1,r.onLoad!==void 0&&r.onLoad())},this.itemError=function(u){r.onError!==void 0&&r.onError(u)},this.resolveURL=function(u){return l?l(u):u},this.setURLModifier=function(u){return l=u,this},this.addHandler=function(u,h){return c.push(u,h),this},this.removeHandler=function(u){const h=c.indexOf(u);return h!==-1&&c.splice(h,2),this},this.getHandler=function(u){for(let h=0,f=c.length;h<f;h+=2){const d=c[h],m=c[h+1];if(d.global&&(d.lastIndex=0),d.test(u))return m}return null}}}const R1=new Qw;let os=class{constructor(e){this.manager=e!==void 0?e:R1,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const n=this;return new Promise(function(r,s){n.load(e,r,t,s)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}};os.DEFAULT_MATERIAL_NAME="__DEFAULT";const cf={};class Ine extends Error{constructor(e,t){super(e),this.response=t}}class $r extends os{constructor(e){super(e)}load(e,t,n,r){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const s=Rf.get(e);if(s!==void 0)return this.manager.itemStart(e),setTimeout(()=>{t&&t(s),this.manager.itemEnd(e)},0),s;if(cf[e]!==void 0){cf[e].push({onLoad:t,onProgress:n,onError:r});return}cf[e]=[],cf[e].push({onLoad:t,onProgress:n,onError:r});const o=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),a=this.mimeType,l=this.responseType;fetch(o).then(c=>{if(c.status===200||c.status===0){if(c.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||c.body===void 0||c.body.getReader===void 0)return c;const u=cf[e],h=c.body.getReader(),f=c.headers.get("Content-Length")||c.headers.get("X-File-Size"),d=f?parseInt(f):0,m=d!==0;let A=0;const g=new ReadableStream({start(y){E();function E(){h.read().then(({done:x,value:C})=>{if(x)y.close();else{A+=C.byteLength;const T=new ProgressEvent("progress",{lengthComputable:m,loaded:A,total:d});for(let I=0,M=u.length;I<M;I++){const L=u[I];L.onProgress&&L.onProgress(T)}y.enqueue(C),E()}})}}});return new Response(g)}else throw new Ine(`fetch for "${c.url}" responded with ${c.status}: ${c.statusText}`,c)}).then(c=>{switch(l){case"arraybuffer":return c.arrayBuffer();case"blob":return c.blob();case"document":return c.text().then(u=>new DOMParser().parseFromString(u,a));case"json":return c.json();default:if(a===void 0)return c.text();{const h=/charset="?([^;"\s]*)"?/i.exec(a),f=h&&h[1]?h[1].toLowerCase():void 0,d=new TextDecoder(f);return c.arrayBuffer().then(m=>d.decode(m))}}}).then(c=>{Rf.add(e,c);const u=cf[e];delete cf[e];for(let h=0,f=u.length;h<f;h++){const d=u[h];d.onLoad&&d.onLoad(c)}}).catch(c=>{const u=cf[e];if(u===void 0)throw this.manager.itemError(e),c;delete cf[e];for(let h=0,f=u.length;h<f;h++){const d=u[h];d.onError&&d.onError(c)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class Mne extends os{constructor(e){super(e)}load(e,t,n,r){const s=this,o=new $r(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(a){try{t(s.parse(JSON.parse(a)))}catch(l){r?r(l):console.error(l),s.manager.itemError(e)}},n,r)}parse(e){const t=[];for(let n=0;n<e.length;n++){const r=op.parse(e[n]);t.push(r)}return t}}class Rne extends os{constructor(e){super(e)}load(e,t,n,r){const s=this,o=[],a=new gp,l=new $r(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(s.withCredentials);let c=0;function u(h){l.load(e[h],function(f){const d=s.parse(f,!0);o[h]={width:d.width,height:d.height,format:d.format,mipmaps:d.mipmaps},c+=1,c===6&&(d.mipmapCount===1&&(a.minFilter=Pn),a.image=o,a.format=d.format,a.needsUpdate=!0,t&&t(a))},n,r)}if(Array.isArray(e))for(let h=0,f=e.length;h<f;++h)u(h);else l.load(e,function(h){const f=s.parse(h,!0);if(f.isCubemap){const d=f.mipmaps.length/f.mipmapCount;for(let m=0;m<d;m++){o[m]={mipmaps:[]};for(let A=0;A<f.mipmapCount;A++)o[m].mipmaps.push(f.mipmaps[m*f.mipmapCount+A]),o[m].format=f.format,o[m].width=f.width,o[m].height=f.height}a.image=o}else a.image.width=f.width,a.image.height=f.height,a.mipmaps=f.mipmaps;f.mipmapCount===1&&(a.minFilter=Pn),a.format=f.format,a.needsUpdate=!0,t&&t(a)},n,r);return a}}class P2 extends os{constructor(e){super(e)}load(e,t,n,r){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const s=this,o=Rf.get(e);if(o!==void 0)return s.manager.itemStart(e),setTimeout(function(){t&&t(o),s.manager.itemEnd(e)},0),o;const a=I2("img");function l(){u(),Rf.add(e,this),t&&t(this),s.manager.itemEnd(e)}function c(h){u(),r&&r(h),s.manager.itemError(e),s.manager.itemEnd(e)}function u(){a.removeEventListener("load",l,!1),a.removeEventListener("error",c,!1)}return a.addEventListener("load",l,!1),a.addEventListener("error",c,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(a.crossOrigin=this.crossOrigin),s.manager.itemStart(e),a.src=e,a}}class Vw extends os{constructor(e){super(e)}load(e,t,n,r){const s=new ix;s.colorSpace=gs;const o=new P2(this.manager);o.setCrossOrigin(this.crossOrigin),o.setPath(this.path);let a=0;function l(c){o.load(e[c],function(u){s.images[c]=u,a++,a===6&&(s.needsUpdate=!0,t&&t(s))},void 0,r)}for(let c=0;c<e.length;++c)l(c);return s}}class Q6 extends os{constructor(e){super(e)}load(e,t,n,r){const s=this,o=new Sa,a=new $r(this.manager);return a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setPath(this.path),a.setWithCredentials(s.withCredentials),a.load(e,function(l){let c;try{c=s.parse(l)}catch(u){if(r!==void 0)r(u);else{console.error(u);return}}c.image!==void 0?o.image=c.image:c.data!==void 0&&(o.image.width=c.width,o.image.height=c.height,o.image.data=c.data),o.wrapS=c.wrapS!==void 0?c.wrapS:ji,o.wrapT=c.wrapT!==void 0?c.wrapT:ji,o.magFilter=c.magFilter!==void 0?c.magFilter:Pn,o.minFilter=c.minFilter!==void 0?c.minFilter:Pn,o.anisotropy=c.anisotropy!==void 0?c.anisotropy:1,c.colorSpace!==void 0?o.colorSpace=c.colorSpace:c.encoding!==void 0&&(o.encoding=c.encoding),c.flipY!==void 0&&(o.flipY=c.flipY),c.format!==void 0&&(o.format=c.format),c.type!==void 0&&(o.type=c.type),c.mipmaps!==void 0&&(o.mipmaps=c.mipmaps,o.minFilter=Bl),c.mipmapCount===1&&(o.minFilter=Pn),c.generateMipmaps!==void 0&&(o.generateMipmaps=c.generateMipmaps),o.needsUpdate=!0,t&&t(o,c)},n,r),o}}class xh extends os{constructor(e){super(e)}load(e,t,n,r){const s=new vi,o=new P2(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(e,function(a){s.image=a,s.needsUpdate=!0,t!==void 0&&t(s)},n,r),s}}class yp extends _n{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new ut(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,this.groundColor!==void 0&&(t.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(t.object.distance=this.distance),this.angle!==void 0&&(t.object.angle=this.angle),this.decay!==void 0&&(t.object.decay=this.decay),this.penumbra!==void 0&&(t.object.penumbra=this.penumbra),this.shadow!==void 0&&(t.object.shadow=this.shadow.toJSON()),t}}class fz extends yp{constructor(e,t,n){super(e,n),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(_n.DEFAULT_UP),this.updateMatrix(),this.groundColor=new ut(t)}copy(e,t){return super.copy(e,t),this.groundColor.copy(e.groundColor),this}}const vT=new Xe,fB=new H,dB=new H;class V6{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Ue(512,512),this.map=null,this.mapPass=null,this.matrix=new Xe,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new h0,this._frameExtents=new Ue(1,1),this._viewportCount=1,this._viewports=[new Rn(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,n=this.matrix;fB.setFromMatrixPosition(e.matrixWorld),t.position.copy(fB),dB.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(dB),t.updateMatrixWorld(),vT.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(vT),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(vT)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const e={};return this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}let Lne=class extends V6{constructor(){super(new Wn(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){const t=this.camera,n=Z1*2*e.angle*this.focus,r=this.mapSize.width/this.mapSize.height,s=e.distance||t.far;(n!==t.fov||r!==t.aspect||s!==t.far)&&(t.fov=n,t.aspect=r,t.far=s,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}},Ww=class extends yp{constructor(e,t,n=0,r=Math.PI/3,s=0,o=2){super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(_n.DEFAULT_UP),this.updateMatrix(),this.target=new _n,this.distance=n,this.angle=r,this.penumbra=s,this.decay=o,this.map=null,this.shadow=new Lne}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}};const pB=new Xe,Uy=new H,xT=new H;class Pne extends V6{constructor(){super(new Wn(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new Ue(4,2),this._viewportCount=6,this._viewports=[new Rn(2,1,1,1),new Rn(0,1,1,1),new Rn(3,1,1,1),new Rn(1,1,1,1),new Rn(3,0,1,1),new Rn(1,0,1,1)],this._cubeDirections=[new H(1,0,0),new H(-1,0,0),new H(0,0,1),new H(0,0,-1),new H(0,1,0),new H(0,-1,0)],this._cubeUps=[new H(0,1,0),new H(0,1,0),new H(0,1,0),new H(0,1,0),new H(0,0,1),new H(0,0,-1)]}updateMatrices(e,t=0){const n=this.camera,r=this.matrix,s=e.distance||n.far;s!==n.far&&(n.far=s,n.updateProjectionMatrix()),Uy.setFromMatrixPosition(e.matrixWorld),n.position.copy(Uy),xT.copy(n.position),xT.add(this._cubeDirections[t]),n.up.copy(this._cubeUps[t]),n.lookAt(xT),n.updateMatrixWorld(),r.makeTranslation(-Uy.x,-Uy.y,-Uy.z),pB.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(pB)}}class B2 extends yp{constructor(e,t,n=0,r=2){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=n,this.decay=r,this.shadow=new Pne}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class Bne extends V6{constructor(){super(new qi(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class jw extends yp{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(_n.DEFAULT_UP),this.updateMatrix(),this.target=new _n,this.shadow=new Bne}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class W6 extends yp{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}}class dz extends yp{constructor(e,t,n=10,r=10){super(e,t),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=n,this.height=r}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}}class pz{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new H)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){const n=e.x,r=e.y,s=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.282095),t.addScaledVector(o[1],.488603*r),t.addScaledVector(o[2],.488603*s),t.addScaledVector(o[3],.488603*n),t.addScaledVector(o[4],1.092548*(n*r)),t.addScaledVector(o[5],1.092548*(r*s)),t.addScaledVector(o[6],.315392*(3*s*s-1)),t.addScaledVector(o[7],1.092548*(n*s)),t.addScaledVector(o[8],.546274*(n*n-r*r)),t}getIrradianceAt(e,t){const n=e.x,r=e.y,s=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.886227),t.addScaledVector(o[1],2*.511664*r),t.addScaledVector(o[2],2*.511664*s),t.addScaledVector(o[3],2*.511664*n),t.addScaledVector(o[4],2*.429043*n*r),t.addScaledVector(o[5],2*.429043*r*s),t.addScaledVector(o[6],.743125*s*s-.247708),t.addScaledVector(o[7],2*.429043*n*s),t.addScaledVector(o[8],.429043*(n*n-r*r)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let n=0;n<9;n++)this.coefficients[n].addScaledVector(e.coefficients[n],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let n=0;n<9;n++)this.coefficients[n].lerp(e.coefficients[n],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(e,t=0){const n=this.coefficients;for(let r=0;r<9;r++)n[r].fromArray(e,t+r*3);return this}toArray(e=[],t=0){const n=this.coefficients;for(let r=0;r<9;r++)n[r].toArray(e,t+r*3);return e}static getBasisAt(e,t){const n=e.x,r=e.y,s=e.z;t[0]=.282095,t[1]=.488603*r,t[2]=.488603*s,t[3]=.488603*n,t[4]=1.092548*n*r,t[5]=1.092548*r*s,t[6]=.315392*(3*s*s-1),t[7]=1.092548*n*s,t[8]=.546274*(n*n-r*r)}}class mz extends yp{constructor(e=new pz,t=1){super(void 0,t),this.isLightProbe=!0,this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}}class Kw extends os{constructor(e){super(e),this.textures={}}load(e,t,n,r){const s=this,o=new $r(s.manager);o.setPath(s.path),o.setRequestHeader(s.requestHeader),o.setWithCredentials(s.withCredentials),o.load(e,function(a){try{t(s.parse(JSON.parse(a)))}catch(l){r?r(l):console.error(l),s.manager.itemError(e)}},n,r)}parse(e){const t=this.textures;function n(s){return t[s]===void 0&&console.warn("THREE.MaterialLoader: Undefined texture",s),t[s]}const r=Kw.createMaterialFromType(e.type);if(e.uuid!==void 0&&(r.uuid=e.uuid),e.name!==void 0&&(r.name=e.name),e.color!==void 0&&r.color!==void 0&&r.color.setHex(e.color),e.roughness!==void 0&&(r.roughness=e.roughness),e.metalness!==void 0&&(r.metalness=e.metalness),e.sheen!==void 0&&(r.sheen=e.sheen),e.sheenColor!==void 0&&(r.sheenColor=new ut().setHex(e.sheenColor)),e.sheenRoughness!==void 0&&(r.sheenRoughness=e.sheenRoughness),e.emissive!==void 0&&r.emissive!==void 0&&r.emissive.setHex(e.emissive),e.specular!==void 0&&r.specular!==void 0&&r.specular.setHex(e.specular),e.specularIntensity!==void 0&&(r.specularIntensity=e.specularIntensity),e.specularColor!==void 0&&r.specularColor!==void 0&&r.specularColor.setHex(e.specularColor),e.shininess!==void 0&&(r.shininess=e.shininess),e.clearcoat!==void 0&&(r.clearcoat=e.clearcoat),e.clearcoatRoughness!==void 0&&(r.clearcoatRoughness=e.clearcoatRoughness),e.iridescence!==void 0&&(r.iridescence=e.iridescence),e.iridescenceIOR!==void 0&&(r.iridescenceIOR=e.iridescenceIOR),e.iridescenceThicknessRange!==void 0&&(r.iridescenceThicknessRange=e.iridescenceThicknessRange),e.transmission!==void 0&&(r.transmission=e.transmission),e.thickness!==void 0&&(r.thickness=e.thickness),e.attenuationDistance!==void 0&&(r.attenuationDistance=e.attenuationDistance),e.attenuationColor!==void 0&&r.attenuationColor!==void 0&&r.attenuationColor.setHex(e.attenuationColor),e.anisotropy!==void 0&&(r.anisotropy=e.anisotropy),e.anisotropyRotation!==void 0&&(r.anisotropyRotation=e.anisotropyRotation),e.fog!==void 0&&(r.fog=e.fog),e.flatShading!==void 0&&(r.flatShading=e.flatShading),e.blending!==void 0&&(r.blending=e.blending),e.combine!==void 0&&(r.combine=e.combine),e.side!==void 0&&(r.side=e.side),e.shadowSide!==void 0&&(r.shadowSide=e.shadowSide),e.opacity!==void 0&&(r.opacity=e.opacity),e.transparent!==void 0&&(r.transparent=e.transparent),e.alphaTest!==void 0&&(r.alphaTest=e.alphaTest),e.alphaHash!==void 0&&(r.alphaHash=e.alphaHash),e.depthFunc!==void 0&&(r.depthFunc=e.depthFunc),e.depthTest!==void 0&&(r.depthTest=e.depthTest),e.depthWrite!==void 0&&(r.depthWrite=e.depthWrite),e.colorWrite!==void 0&&(r.colorWrite=e.colorWrite),e.blendSrc!==void 0&&(r.blendSrc=e.blendSrc),e.blendDst!==void 0&&(r.blendDst=e.blendDst),e.blendEquation!==void 0&&(r.blendEquation=e.blendEquation),e.blendSrcAlpha!==void 0&&(r.blendSrcAlpha=e.blendSrcAlpha),e.blendDstAlpha!==void 0&&(r.blendDstAlpha=e.blendDstAlpha),e.blendEquationAlpha!==void 0&&(r.blendEquationAlpha=e.blendEquationAlpha),e.blendColor!==void 0&&r.blendColor!==void 0&&r.blendColor.setHex(e.blendColor),e.blendAlpha!==void 0&&(r.blendAlpha=e.blendAlpha),e.stencilWriteMask!==void 0&&(r.stencilWriteMask=e.stencilWriteMask),e.stencilFunc!==void 0&&(r.stencilFunc=e.stencilFunc),e.stencilRef!==void 0&&(r.stencilRef=e.stencilRef),e.stencilFuncMask!==void 0&&(r.stencilFuncMask=e.stencilFuncMask),e.stencilFail!==void 0&&(r.stencilFail=e.stencilFail),e.stencilZFail!==void 0&&(r.stencilZFail=e.stencilZFail),e.stencilZPass!==void 0&&(r.stencilZPass=e.stencilZPass),e.stencilWrite!==void 0&&(r.stencilWrite=e.stencilWrite),e.wireframe!==void 0&&(r.wireframe=e.wireframe),e.wireframeLinewidth!==void 0&&(r.wireframeLinewidth=e.wireframeLinewidth),e.wireframeLinecap!==void 0&&(r.wireframeLinecap=e.wireframeLinecap),e.wireframeLinejoin!==void 0&&(r.wireframeLinejoin=e.wireframeLinejoin),e.rotation!==void 0&&(r.rotation=e.rotation),e.linewidth!==void 0&&(r.linewidth=e.linewidth),e.dashSize!==void 0&&(r.dashSize=e.dashSize),e.gapSize!==void 0&&(r.gapSize=e.gapSize),e.scale!==void 0&&(r.scale=e.scale),e.polygonOffset!==void 0&&(r.polygonOffset=e.polygonOffset),e.polygonOffsetFactor!==void 0&&(r.polygonOffsetFactor=e.polygonOffsetFactor),e.polygonOffsetUnits!==void 0&&(r.polygonOffsetUnits=e.polygonOffsetUnits),e.dithering!==void 0&&(r.dithering=e.dithering),e.alphaToCoverage!==void 0&&(r.alphaToCoverage=e.alphaToCoverage),e.premultipliedAlpha!==void 0&&(r.premultipliedAlpha=e.premultipliedAlpha),e.forceSinglePass!==void 0&&(r.forceSinglePass=e.forceSinglePass),e.visible!==void 0&&(r.visible=e.visible),e.toneMapped!==void 0&&(r.toneMapped=e.toneMapped),e.userData!==void 0&&(r.userData=e.userData),e.vertexColors!==void 0&&(typeof e.vertexColors=="number"?r.vertexColors=e.vertexColors>0:r.vertexColors=e.vertexColors),e.uniforms!==void 0)for(const s in e.uniforms){const o=e.uniforms[s];switch(r.uniforms[s]={},o.type){case"t":r.uniforms[s].value=n(o.value);break;case"c":r.uniforms[s].value=new ut().setHex(o.value);break;case"v2":r.uniforms[s].value=new Ue().fromArray(o.value);break;case"v3":r.uniforms[s].value=new H().fromArray(o.value);break;case"v4":r.uniforms[s].value=new Rn().fromArray(o.value);break;case"m3":r.uniforms[s].value=new Tn().fromArray(o.value);break;case"m4":r.uniforms[s].value=new Xe().fromArray(o.value);break;default:r.uniforms[s].value=o.value}}if(e.defines!==void 0&&(r.defines=e.defines),e.vertexShader!==void 0&&(r.vertexShader=e.vertexShader),e.fragmentShader!==void 0&&(r.fragmentShader=e.fragmentShader),e.glslVersion!==void 0&&(r.glslVersion=e.glslVersion),e.extensions!==void 0)for(const s in e.extensions)r.extensions[s]=e.extensions[s];if(e.lights!==void 0&&(r.lights=e.lights),e.clipping!==void 0&&(r.clipping=e.clipping),e.size!==void 0&&(r.size=e.size),e.sizeAttenuation!==void 0&&(r.sizeAttenuation=e.sizeAttenuation),e.map!==void 0&&(r.map=n(e.map)),e.matcap!==void 0&&(r.matcap=n(e.matcap)),e.alphaMap!==void 0&&(r.alphaMap=n(e.alphaMap)),e.bumpMap!==void 0&&(r.bumpMap=n(e.bumpMap)),e.bumpScale!==void 0&&(r.bumpScale=e.bumpScale),e.normalMap!==void 0&&(r.normalMap=n(e.normalMap)),e.normalMapType!==void 0&&(r.normalMapType=e.normalMapType),e.normalScale!==void 0){let s=e.normalScale;Array.isArray(s)===!1&&(s=[s,s]),r.normalScale=new Ue().fromArray(s)}return e.displacementMap!==void 0&&(r.displacementMap=n(e.displacementMap)),e.displacementScale!==void 0&&(r.displacementScale=e.displacementScale),e.displacementBias!==void 0&&(r.displacementBias=e.displacementBias),e.roughnessMap!==void 0&&(r.roughnessMap=n(e.roughnessMap)),e.metalnessMap!==void 0&&(r.metalnessMap=n(e.metalnessMap)),e.emissiveMap!==void 0&&(r.emissiveMap=n(e.emissiveMap)),e.emissiveIntensity!==void 0&&(r.emissiveIntensity=e.emissiveIntensity),e.specularMap!==void 0&&(r.specularMap=n(e.specularMap)),e.specularIntensityMap!==void 0&&(r.specularIntensityMap=n(e.specularIntensityMap)),e.specularColorMap!==void 0&&(r.specularColorMap=n(e.specularColorMap)),e.envMap!==void 0&&(r.envMap=n(e.envMap)),e.envMapIntensity!==void 0&&(r.envMapIntensity=e.envMapIntensity),e.reflectivity!==void 0&&(r.reflectivity=e.reflectivity),e.refractionRatio!==void 0&&(r.refractionRatio=e.refractionRatio),e.lightMap!==void 0&&(r.lightMap=n(e.lightMap)),e.lightMapIntensity!==void 0&&(r.lightMapIntensity=e.lightMapIntensity),e.aoMap!==void 0&&(r.aoMap=n(e.aoMap)),e.aoMapIntensity!==void 0&&(r.aoMapIntensity=e.aoMapIntensity),e.gradientMap!==void 0&&(r.gradientMap=n(e.gradientMap)),e.clearcoatMap!==void 0&&(r.clearcoatMap=n(e.clearcoatMap)),e.clearcoatRoughnessMap!==void 0&&(r.clearcoatRoughnessMap=n(e.clearcoatRoughnessMap)),e.clearcoatNormalMap!==void 0&&(r.clearcoatNormalMap=n(e.clearcoatNormalMap)),e.clearcoatNormalScale!==void 0&&(r.clearcoatNormalScale=new Ue().fromArray(e.clearcoatNormalScale)),e.iridescenceMap!==void 0&&(r.iridescenceMap=n(e.iridescenceMap)),e.iridescenceThicknessMap!==void 0&&(r.iridescenceThicknessMap=n(e.iridescenceThicknessMap)),e.transmissionMap!==void 0&&(r.transmissionMap=n(e.transmissionMap)),e.thicknessMap!==void 0&&(r.thicknessMap=n(e.thicknessMap)),e.anisotropyMap!==void 0&&(r.anisotropyMap=n(e.anisotropyMap)),e.sheenColorMap!==void 0&&(r.sheenColorMap=n(e.sheenColorMap)),e.sheenRoughnessMap!==void 0&&(r.sheenRoughnessMap=n(e.sheenRoughnessMap)),r}setTextures(e){return this.textures=e,this}static createMaterialFromType(e){const t={ShadowMaterial:nz,SpriteMaterial:C6,RawShaderMaterial:iz,ShaderMaterial:Mi,PointsMaterial:lx,MeshPhysicalMaterial:nl,MeshStandardMaterial:p0,MeshPhongMaterial:Jv,MeshToonMaterial:rz,MeshNormalMaterial:U6,MeshLambertMaterial:fx,MeshDepthMaterial:rx,MeshDistanceMaterial:bw,MeshBasicMaterial:no,MeshMatcapMaterial:sz,LineDashedMaterial:oz,LineBasicMaterial:vs,Material:Us};return new t[e]}}class Pf{static decodeText(e){if(typeof TextDecoder<"u")return new TextDecoder().decode(e);let t="";for(let n=0,r=e.length;n<r;n++)t+=String.fromCharCode(e[n]);try{return decodeURIComponent(escape(t))}catch{return t}}static extractUrlBase(e){const t=e.lastIndexOf("/");return t===-1?"./":e.slice(0,t+1)}static resolveURL(e,t){return typeof e!="string"||e===""?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}class dx extends fn{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}toJSON(){const e=super.toJSON();return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}class gz extends os{constructor(e){super(e)}load(e,t,n,r){const s=this,o=new $r(s.manager);o.setPath(s.path),o.setRequestHeader(s.requestHeader),o.setWithCredentials(s.withCredentials),o.load(e,function(a){try{t(s.parse(JSON.parse(a)))}catch(l){r?r(l):console.error(l),s.manager.itemError(e)}},n,r)}parse(e){const t={},n={};function r(d,m){if(t[m]!==void 0)return t[m];const g=d.interleavedBuffers[m],y=s(d,g.buffer),E=T1(g.type,y),x=new sx(E,g.stride);return x.uuid=g.uuid,t[m]=x,x}function s(d,m){if(n[m]!==void 0)return n[m];const g=d.arrayBuffers[m],y=new Uint32Array(g).buffer;return n[m]=y,y}const o=e.isInstancedBufferGeometry?new dx:new fn,a=e.data.index;if(a!==void 0){const d=T1(a.type,a.array);o.setIndex(new mn(d,1))}const l=e.data.attributes;for(const d in l){const m=l[d];let A;if(m.isInterleavedBufferAttribute){const g=r(e.data,m.data);A=new Ja(g,m.itemSize,m.offset,m.normalized)}else{const g=T1(m.type,m.array),y=m.isInstancedBufferAttribute?Su:mn;A=new y(g,m.itemSize,m.normalized)}m.name!==void 0&&(A.name=m.name),m.usage!==void 0&&A.setUsage(m.usage),o.setAttribute(d,A)}const c=e.data.morphAttributes;if(c)for(const d in c){const m=c[d],A=[];for(let g=0,y=m.length;g<y;g++){const E=m[g];let x;if(E.isInterleavedBufferAttribute){const C=r(e.data,E.data);x=new Ja(C,E.itemSize,E.offset,E.normalized)}else{const C=T1(E.type,E.array);x=new mn(C,E.itemSize,E.normalized)}E.name!==void 0&&(x.name=E.name),A.push(x)}o.morphAttributes[d]=A}e.data.morphTargetsRelative&&(o.morphTargetsRelative=!0);const h=e.data.groups||e.data.drawcalls||e.data.offsets;if(h!==void 0)for(let d=0,m=h.length;d!==m;++d){const A=h[d];o.addGroup(A.start,A.count,A.materialIndex)}const f=e.data.boundingSphere;if(f!==void 0){const d=new H;f.center!==void 0&&d.fromArray(f.center),o.boundingSphere=new Bi(d,f.radius)}return e.name&&(o.name=e.name),e.userData&&(o.userData=e.userData),o}}class Dne extends os{constructor(e){super(e)}load(e,t,n,r){const s=this,o=this.path===""?Pf.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||o;const a=new $r(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(l){let c=null;try{c=JSON.parse(l)}catch(h){r!==void 0&&r(h),console.error("THREE:ObjectLoader: Can't parse "+e+".",h.message);return}const u=c.metadata;if(u===void 0||u.type===void 0||u.type.toLowerCase()==="geometry"){r!==void 0&&r(new Error("THREE.ObjectLoader: Can't load "+e)),console.error("THREE.ObjectLoader: Can't load "+e);return}s.parse(c,t)},n,r)}async loadAsync(e,t){const n=this,r=this.path===""?Pf.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||r;const s=new $r(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials);const o=await s.loadAsync(e,t),a=JSON.parse(o),l=a.metadata;if(l===void 0||l.type===void 0||l.type.toLowerCase()==="geometry")throw new Error("THREE.ObjectLoader: Can't load "+e);return await n.parseAsync(a)}parse(e,t){const n=this.parseAnimations(e.animations),r=this.parseShapes(e.shapes),s=this.parseGeometries(e.geometries,r),o=this.parseImages(e.images,function(){t!==void 0&&t(c)}),a=this.parseTextures(e.textures,o),l=this.parseMaterials(e.materials,a),c=this.parseObject(e.object,s,l,a,n),u=this.parseSkeletons(e.skeletons,c);if(this.bindSkeletons(c,u),t!==void 0){let h=!1;for(const f in o)if(o[f].data instanceof HTMLImageElement){h=!0;break}h===!1&&t(c)}return c}async parseAsync(e){const t=this.parseAnimations(e.animations),n=this.parseShapes(e.shapes),r=this.parseGeometries(e.geometries,n),s=await this.parseImagesAsync(e.images),o=this.parseTextures(e.textures,s),a=this.parseMaterials(e.materials,o),l=this.parseObject(e.object,r,a,o,t),c=this.parseSkeletons(e.skeletons,l);return this.bindSkeletons(l,c),l}parseShapes(e){const t={};if(e!==void 0)for(let n=0,r=e.length;n<r;n++){const s=new Lf().fromJSON(e[n]);t[s.uuid]=s}return t}parseSkeletons(e,t){const n={},r={};if(t.traverse(function(s){s.isBone&&(r[s.uuid]=s)}),e!==void 0)for(let s=0,o=e.length;s<o;s++){const a=new _A().fromJSON(e[s],r);n[a.uuid]=a}return n}parseGeometries(e,t){const n={};if(e!==void 0){const r=new gz;for(let s=0,o=e.length;s<o;s++){let a;const l=e[s];switch(l.type){case"BufferGeometry":case"InstancedBufferGeometry":a=r.parse(l);break;default:l.type in hB?a=hB[l.type].fromJSON(l,t):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${l.type}"`)}a.uuid=l.uuid,l.name!==void 0&&(a.name=l.name),l.userData!==void 0&&(a.userData=l.userData),n[l.uuid]=a}}return n}parseMaterials(e,t){const n={},r={};if(e!==void 0){const s=new Kw;s.setTextures(t);for(let o=0,a=e.length;o<a;o++){const l=e[o];n[l.uuid]===void 0&&(n[l.uuid]=s.parse(l)),r[l.uuid]=n[l.uuid]}}return r}parseAnimations(e){const t={};if(e!==void 0)for(let n=0;n<e.length;n++){const r=e[n],s=op.parse(r);t[s.uuid]=s}return t}parseImages(e,t){const n=this,r={};let s;function o(l){return n.manager.itemStart(l),s.load(l,function(){n.manager.itemEnd(l)},void 0,function(){n.manager.itemError(l),n.manager.itemEnd(l)})}function a(l){if(typeof l=="string"){const c=l,u=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(c)?c:n.resourcePath+c;return o(u)}else return l.data?{data:T1(l.type,l.data),width:l.width,height:l.height}:null}if(e!==void 0&&e.length>0){const l=new Qw(t);s=new P2(l),s.setCrossOrigin(this.crossOrigin);for(let c=0,u=e.length;c<u;c++){const h=e[c],f=h.url;if(Array.isArray(f)){const d=[];for(let m=0,A=f.length;m<A;m++){const g=f[m],y=a(g);y!==null&&(y instanceof HTMLImageElement?d.push(y):d.push(new Sa(y.data,y.width,y.height)))}r[h.uuid]=new Rm(d)}else{const d=a(h.url);r[h.uuid]=new Rm(d)}}}return r}async parseImagesAsync(e){const t=this,n={};let r;async function s(o){if(typeof o=="string"){const a=o,l=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(a)?a:t.resourcePath+a;return await r.loadAsync(l)}else return o.data?{data:T1(o.type,o.data),width:o.width,height:o.height}:null}if(e!==void 0&&e.length>0){r=new P2(this.manager),r.setCrossOrigin(this.crossOrigin);for(let o=0,a=e.length;o<a;o++){const l=e[o],c=l.url;if(Array.isArray(c)){const u=[];for(let h=0,f=c.length;h<f;h++){const d=c[h],m=await s(d);m!==null&&(m instanceof HTMLImageElement?u.push(m):u.push(new Sa(m.data,m.width,m.height)))}n[l.uuid]=new Rm(u)}else{const u=await s(l.url);n[l.uuid]=new Rm(u)}}}return n}parseTextures(e,t){function n(s,o){return typeof s=="number"?s:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",s),o[s])}const r={};if(e!==void 0)for(let s=0,o=e.length;s<o;s++){const a=e[s];a.image===void 0&&console.warn('THREE.ObjectLoader: No "image" specified for',a.uuid),t[a.image]===void 0&&console.warn("THREE.ObjectLoader: Undefined image",a.image);const l=t[a.image],c=l.data;let u;Array.isArray(c)?(u=new ix,c.length===6&&(u.needsUpdate=!0)):(c&&c.data?u=new Sa:u=new vi,c&&(u.needsUpdate=!0)),u.source=l,u.uuid=a.uuid,a.name!==void 0&&(u.name=a.name),a.mapping!==void 0&&(u.mapping=n(a.mapping,kne)),a.channel!==void 0&&(u.channel=a.channel),a.offset!==void 0&&u.offset.fromArray(a.offset),a.repeat!==void 0&&u.repeat.fromArray(a.repeat),a.center!==void 0&&u.center.fromArray(a.center),a.rotation!==void 0&&(u.rotation=a.rotation),a.wrap!==void 0&&(u.wrapS=n(a.wrap[0],mB),u.wrapT=n(a.wrap[1],mB)),a.format!==void 0&&(u.format=a.format),a.internalFormat!==void 0&&(u.internalFormat=a.internalFormat),a.type!==void 0&&(u.type=a.type),a.colorSpace!==void 0&&(u.colorSpace=a.colorSpace),a.encoding!==void 0&&(u.encoding=a.encoding),a.minFilter!==void 0&&(u.minFilter=n(a.minFilter,gB)),a.magFilter!==void 0&&(u.magFilter=n(a.magFilter,gB)),a.anisotropy!==void 0&&(u.anisotropy=a.anisotropy),a.flipY!==void 0&&(u.flipY=a.flipY),a.generateMipmaps!==void 0&&(u.generateMipmaps=a.generateMipmaps),a.premultiplyAlpha!==void 0&&(u.premultiplyAlpha=a.premultiplyAlpha),a.unpackAlignment!==void 0&&(u.unpackAlignment=a.unpackAlignment),a.compareFunction!==void 0&&(u.compareFunction=a.compareFunction),a.userData!==void 0&&(u.userData=a.userData),r[a.uuid]=u}return r}parseObject(e,t,n,r,s){let o;function a(f){return t[f]===void 0&&console.warn("THREE.ObjectLoader: Undefined geometry",f),t[f]}function l(f){if(f!==void 0){if(Array.isArray(f)){const d=[];for(let m=0,A=f.length;m<A;m++){const g=f[m];n[g]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",g),d.push(n[g])}return d}return n[f]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",f),n[f]}}function c(f){return r[f]===void 0&&console.warn("THREE.ObjectLoader: Undefined texture",f),r[f]}let u,h;switch(e.type){case"Scene":o=new Mu,e.background!==void 0&&(Number.isInteger(e.background)?o.background=new ut(e.background):o.background=c(e.background)),e.environment!==void 0&&(o.environment=c(e.environment)),e.fog!==void 0&&(e.fog.type==="Fog"?o.fog=new Rw(e.fog.color,e.fog.near,e.fog.far):e.fog.type==="FogExp2"&&(o.fog=new Mw(e.fog.color,e.fog.density)),e.fog.name!==""&&(o.fog.name=e.fog.name)),e.backgroundBlurriness!==void 0&&(o.backgroundBlurriness=e.backgroundBlurriness),e.backgroundIntensity!==void 0&&(o.backgroundIntensity=e.backgroundIntensity);break;case"PerspectiveCamera":o=new Wn(e.fov,e.aspect,e.near,e.far),e.focus!==void 0&&(o.focus=e.focus),e.zoom!==void 0&&(o.zoom=e.zoom),e.filmGauge!==void 0&&(o.filmGauge=e.filmGauge),e.filmOffset!==void 0&&(o.filmOffset=e.filmOffset),e.view!==void 0&&(o.view=Object.assign({},e.view));break;case"OrthographicCamera":o=new qi(e.left,e.right,e.top,e.bottom,e.near,e.far),e.zoom!==void 0&&(o.zoom=e.zoom),e.view!==void 0&&(o.view=Object.assign({},e.view));break;case"AmbientLight":o=new W6(e.color,e.intensity);break;case"DirectionalLight":o=new jw(e.color,e.intensity);break;case"PointLight":o=new B2(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":o=new dz(e.color,e.intensity,e.width,e.height);break;case"SpotLight":o=new Ww(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":o=new fz(e.color,e.groundColor,e.intensity);break;case"LightProbe":o=new mz().fromJSON(e);break;case"SkinnedMesh":u=a(e.geometry),h=l(e.material),o=new ox(u,h),e.bindMode!==void 0&&(o.bindMode=e.bindMode),e.bindMatrix!==void 0&&o.bindMatrix.fromArray(e.bindMatrix),e.skeleton!==void 0&&(o.skeleton=e.skeleton);break;case"Mesh":u=a(e.geometry),h=l(e.material),o=new It(u,h);break;case"InstancedMesh":u=a(e.geometry),h=l(e.material);const f=e.count,d=e.instanceMatrix,m=e.instanceColor;o=new ax(u,h,f),o.instanceMatrix=new Su(new Float32Array(d.array),16),m!==void 0&&(o.instanceColor=new Su(new Float32Array(m.array),m.itemSize));break;case"BatchedMesh":u=a(e.geometry),h=l(e.material),o=new T6(e.maxGeometryCount,e.maxVertexCount,e.maxIndexCount,h),o.geometry=u,o.perObjectFrustumCulled=e.perObjectFrustumCulled,o.sortObjects=e.sortObjects,o._drawRanges=e.drawRanges,o._reservedRanges=e.reservedRanges,o._visibility=e.visibility,o._active=e.active,o._bounds=e.bounds.map(A=>{const g=new ti;g.min.fromArray(A.boxMin),g.max.fromArray(A.boxMax);const y=new Bi;return y.radius=A.sphereRadius,y.center.fromArray(A.sphereCenter),{boxInitialized:A.boxInitialized,box:g,sphereInitialized:A.sphereInitialized,sphere:y}}),o._maxGeometryCount=e.maxGeometryCount,o._maxVertexCount=e.maxVertexCount,o._maxIndexCount=e.maxIndexCount,o._geometryInitialized=e.geometryInitialized,o._geometryCount=e.geometryCount,o._matricesTexture=c(e.matricesTexture.uuid);break;case"LOD":o=new YU;break;case"Line":o=new Yn(a(e.geometry),l(e.material));break;case"LineLoop":o=new b6(a(e.geometry),l(e.material));break;case"LineSegments":o=new Ru(a(e.geometry),l(e.material));break;case"PointCloud":case"Points":o=new I6(a(e.geometry),l(e.material));break;case"Sprite":o=new $U(l(e.material));break;case"Group":o=new xa;break;case"Bone":o=new tA;break;default:o=new _n}if(o.uuid=e.uuid,e.name!==void 0&&(o.name=e.name),e.matrix!==void 0?(o.matrix.fromArray(e.matrix),e.matrixAutoUpdate!==void 0&&(o.matrixAutoUpdate=e.matrixAutoUpdate),o.matrixAutoUpdate&&o.matrix.decompose(o.position,o.quaternion,o.scale)):(e.position!==void 0&&o.position.fromArray(e.position),e.rotation!==void 0&&o.rotation.fromArray(e.rotation),e.quaternion!==void 0&&o.quaternion.fromArray(e.quaternion),e.scale!==void 0&&o.scale.fromArray(e.scale)),e.up!==void 0&&o.up.fromArray(e.up),e.castShadow!==void 0&&(o.castShadow=e.castShadow),e.receiveShadow!==void 0&&(o.receiveShadow=e.receiveShadow),e.shadow&&(e.shadow.bias!==void 0&&(o.shadow.bias=e.shadow.bias),e.shadow.normalBias!==void 0&&(o.shadow.normalBias=e.shadow.normalBias),e.shadow.radius!==void 0&&(o.shadow.radius=e.shadow.radius),e.shadow.mapSize!==void 0&&o.shadow.mapSize.fromArray(e.shadow.mapSize),e.shadow.camera!==void 0&&(o.shadow.camera=this.parseObject(e.shadow.camera))),e.visible!==void 0&&(o.visible=e.visible),e.frustumCulled!==void 0&&(o.frustumCulled=e.frustumCulled),e.renderOrder!==void 0&&(o.renderOrder=e.renderOrder),e.userData!==void 0&&(o.userData=e.userData),e.layers!==void 0&&(o.layers.mask=e.layers),e.children!==void 0){const f=e.children;for(let d=0;d<f.length;d++)o.add(this.parseObject(f[d],t,n,r,s))}if(e.animations!==void 0){const f=e.animations;for(let d=0;d<f.length;d++){const m=f[d];o.animations.push(s[m])}}if(e.type==="LOD"){e.autoUpdate!==void 0&&(o.autoUpdate=e.autoUpdate);const f=e.levels;for(let d=0;d<f.length;d++){const m=f[d],A=o.getObjectByProperty("uuid",m.object);A!==void 0&&o.addLevel(A,m.distance,m.hysteresis)}}return o}bindSkeletons(e,t){Object.keys(t).length!==0&&e.traverse(function(n){if(n.isSkinnedMesh===!0&&n.skeleton!==void 0){const r=t[n.skeleton];r===void 0?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",n.skeleton):n.bind(r,n.bindMatrix)}})}}const kne={UVMapping:np,CubeReflectionMapping:_u,CubeRefractionMapping:ip,EquirectangularReflectionMapping:Ym,EquirectangularRefractionMapping:v2,CubeUVReflectionMapping:vA},mB={RepeatWrapping:_o,ClampToEdgeWrapping:ji,MirroredRepeatWrapping:X1},gB={NearestFilter:zn,NearestMipmapNearestFilter:x2,NearestMipmapLinearFilter:F1,LinearFilter:Pn,LinearMipmapNearestFilter:gw,LinearMipmapLinearFilter:Bl};class Az extends os{constructor(e){super(e),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,t,n,r){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const s=this,o=Rf.get(e);if(o!==void 0){if(s.manager.itemStart(e),o.then){o.then(c=>{t&&t(c),s.manager.itemEnd(e)}).catch(c=>{r&&r(c)});return}return setTimeout(function(){t&&t(o),s.manager.itemEnd(e)},0),o}const a={};a.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",a.headers=this.requestHeader;const l=fetch(e,a).then(function(c){return c.blob()}).then(function(c){return createImageBitmap(c,Object.assign(s.options,{colorSpaceConversion:"none"}))}).then(function(c){return Rf.add(e,c),t&&t(c),s.manager.itemEnd(e),c}).catch(function(c){r&&r(c),Rf.remove(e),s.manager.itemError(e),s.manager.itemEnd(e)});Rf.add(e,l),s.manager.itemStart(e)}}let f3;class j6{static getContext(){return f3===void 0&&(f3=new(window.AudioContext||window.webkitAudioContext)),f3}static setContext(e){f3=e}}class yz extends os{constructor(e){super(e)}load(e,t,n,r){const s=this,o=new $r(this.manager);o.setResponseType("arraybuffer"),o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(l){try{const c=l.slice(0);j6.getContext().decodeAudioData(c,function(h){t(h)}).catch(a)}catch(c){a(c)}},n,r);function a(l){r?r(l):console.error(l),s.manager.itemError(e)}}}const AB=new Xe,yB=new Xe,am=new Xe;class Fne{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new Wn,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new Wn,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(e){const t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep,am.copy(e.projectionMatrix);const r=t.eyeSep/2,s=r*t.near/t.focus,o=t.near*Math.tan(Um*t.fov*.5)/t.zoom;let a,l;yB.elements[12]=-r,AB.elements[12]=r,a=-o*t.aspect+s,l=o*t.aspect+s,am.elements[0]=2*t.near/(l-a),am.elements[8]=(l+a)/(l-a),this.cameraL.projectionMatrix.copy(am),a=-o*t.aspect-s,l=o*t.aspect-s,am.elements[0]=2*t.near/(l-a),am.elements[8]=(l+a)/(l-a),this.cameraR.projectionMatrix.copy(am)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(yB),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(AB)}}class $w{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=vB(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=vB();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}function vB(){return(typeof performance>"u"?Date:performance).now()}const lm=new H,xB=new Xt,One=new H,cm=new H;class vz extends _n{constructor(){super(),this.type="AudioListener",this.context=j6.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new $w}getInput(){return this.gain}removeFilter(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(e){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}updateMatrixWorld(e){super.updateMatrixWorld(e);const t=this.context.listener,n=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(lm,xB,One),cm.set(0,0,-1).applyQuaternion(xB),t.positionX){const r=this.context.currentTime+this.timeDelta;t.positionX.linearRampToValueAtTime(lm.x,r),t.positionY.linearRampToValueAtTime(lm.y,r),t.positionZ.linearRampToValueAtTime(lm.z,r),t.forwardX.linearRampToValueAtTime(cm.x,r),t.forwardY.linearRampToValueAtTime(cm.y,r),t.forwardZ.linearRampToValueAtTime(cm.z,r),t.upX.linearRampToValueAtTime(n.x,r),t.upY.linearRampToValueAtTime(n.y,r),t.upZ.linearRampToValueAtTime(n.z,r)}else t.setPosition(lm.x,lm.y,lm.z),t.setOrientation(cm.x,cm.y,cm.z,n.x,n.y,n.z)}}class xz extends _n{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(this.isPlaying===!0){console.warn("THREE.Audio: Audio is already playing.");return}if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}this._startedAt=this.context.currentTime+e;const t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this}stop(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this._progress=0,this.source!==null&&(this.source.stop(),this.source.onended=null),this.isPlaying=!1,this}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this._connected!==!1){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}}getFilters(){return this.filters}setFilters(e){return e||(e=[]),this._connected===!0?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){if(this.detune=e,this.source.detune!==void 0)return this.isPlaying===!0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.playbackRate=e,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.loop=e,this.isPlaying===!0&&(this.source.loop=this.loop),this}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}}const um=new H,EB=new Xt,Nne=new H,hm=new H;let Une=class extends xz{constructor(e){super(e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}connect(){super.connect(),this.panner.connect(this.gain)}disconnect(){super.disconnect(),this.panner.disconnect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(e){return this.panner.refDistance=e,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(e){return this.panner.rolloffFactor=e,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(e){return this.panner.distanceModel=e,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(e){return this.panner.maxDistance=e,this}setDirectionalCone(e,t,n){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=n,this}updateMatrixWorld(e){if(super.updateMatrixWorld(e),this.hasPlaybackControl===!0&&this.isPlaying===!1)return;this.matrixWorld.decompose(um,EB,Nne),hm.set(0,0,1).applyQuaternion(EB);const t=this.panner;if(t.positionX){const n=this.context.currentTime+this.listener.timeDelta;t.positionX.linearRampToValueAtTime(um.x,n),t.positionY.linearRampToValueAtTime(um.y,n),t.positionZ.linearRampToValueAtTime(um.z,n),t.orientationX.linearRampToValueAtTime(hm.x,n),t.orientationY.linearRampToValueAtTime(hm.y,n),t.orientationZ.linearRampToValueAtTime(hm.z,n)}else t.setPosition(um.x,um.y,um.z),t.setOrientation(hm.x,hm.y,hm.z)}};class zne{constructor(e,t=2048){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=t,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let e=0;const t=this.getFrequencyData();for(let n=0;n<t.length;n++)e+=t[n];return e/t.length}}class Ez{constructor(e,t,n){this.binding=e,this.valueSize=n;let r,s,o;switch(t){case"quaternion":r=this._slerp,s=this._slerpAdditive,o=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(n*6),this._workIndex=5;break;case"string":case"bool":r=this._select,s=this._select,o=this._setAdditiveIdentityOther,this.buffer=new Array(n*5);break;default:r=this._lerp,s=this._lerpAdditive,o=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(n*5)}this._mixBufferRegion=r,this._mixBufferRegionAdditive=s,this._setIdentity=o,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){const n=this.buffer,r=this.valueSize,s=e*r+r;let o=this.cumulativeWeight;if(o===0){for(let a=0;a!==r;++a)n[s+a]=n[a];o=t}else{o+=t;const a=t/o;this._mixBufferRegion(n,s,0,a,r)}this.cumulativeWeight=o}accumulateAdditive(e){const t=this.buffer,n=this.valueSize,r=n*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(t,r,0,e,n),this.cumulativeWeightAdditive+=e}apply(e){const t=this.valueSize,n=this.buffer,r=e*t+t,s=this.cumulativeWeight,o=this.cumulativeWeightAdditive,a=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,s<1){const l=t*this._origIndex;this._mixBufferRegion(n,r,l,1-s,t)}o>0&&this._mixBufferRegionAdditive(n,r,this._addIndex*t,1,t);for(let l=t,c=t+t;l!==c;++l)if(n[l]!==n[l+t]){a.setValue(n,r);break}}saveOriginalState(){const e=this.binding,t=this.buffer,n=this.valueSize,r=n*this._origIndex;e.getValue(t,r);for(let s=n,o=r;s!==o;++s)t[s]=t[r+s%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const e=this.valueSize*3;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let n=e;n<t;n++)this.buffer[n]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let n=0;n<this.valueSize;n++)this.buffer[t+n]=this.buffer[e+n]}_select(e,t,n,r,s){if(r>=.5)for(let o=0;o!==s;++o)e[t+o]=e[n+o]}_slerp(e,t,n,r){Xt.slerpFlat(e,t,e,t,e,n,r)}_slerpAdditive(e,t,n,r,s){const o=this._workIndex*s;Xt.multiplyQuaternionsFlat(e,o,e,t,e,n),Xt.slerpFlat(e,t,e,t,e,o,r)}_lerp(e,t,n,r,s){const o=1-r;for(let a=0;a!==s;++a){const l=t+a;e[l]=e[l]*o+e[n+a]*r}}_lerpAdditive(e,t,n,r,s){for(let o=0;o!==s;++o){const a=t+o;e[a]=e[a]+e[n+o]*r}}}const K6="\\[\\]\\.:\\/",Gne=new RegExp("["+K6+"]","g"),$6="[^"+K6+"]",Hne="[^"+K6.replace("\\.","")+"]",Qne=/((?:WC+[\/:])*)/.source.replace("WC",$6),Vne=/(WCOD+)?/.source.replace("WCOD",Hne),Wne=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",$6),jne=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",$6),Kne=new RegExp("^"+Qne+Vne+Wne+jne+"$"),$ne=["material","materials","bones","map"];class Yne{constructor(e,t,n){const r=n||li.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,r)}getValue(e,t){this.bind();const n=this._targetGroup.nCachedObjects_,r=this._bindings[n];r!==void 0&&r.getValue(e,t)}setValue(e,t){const n=this._bindings;for(let r=this._targetGroup.nCachedObjects_,s=n.length;r!==s;++r)n[r].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].unbind()}}class li{constructor(e,t,n){this.path=t,this.parsedPath=n||li.parseTrackName(t),this.node=li.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,n){return e&&e.isAnimationObjectGroup?new li.Composite(e,t,n):new li(e,t,n)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(Gne,"")}static parseTrackName(e){const t=Kne.exec(e);if(t===null)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const n={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},r=n.nodeName&&n.nodeName.lastIndexOf(".");if(r!==void 0&&r!==-1){const s=n.nodeName.substring(r+1);$ne.indexOf(s)!==-1&&(n.nodeName=n.nodeName.substring(0,r),n.objectName=s)}if(n.propertyName===null||n.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n}static findNode(e,t){if(t===void 0||t===""||t==="."||t===-1||t===e.name||t===e.uuid)return e;if(e.skeleton){const n=e.skeleton.getBoneByName(t);if(n!==void 0)return n}if(e.children){const n=function(s){for(let o=0;o<s.length;o++){const a=s[o];if(a.name===t||a.uuid===t)return a;const l=n(a.children);if(l)return l}return null},r=n(e.children);if(r)return r}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){const n=this.resolvedProperty;for(let r=0,s=n.length;r!==s;++r)e[t++]=n[r]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const n=this.resolvedProperty;for(let r=0,s=n.length;r!==s;++r)n[r]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const n=this.resolvedProperty;for(let r=0,s=n.length;r!==s;++r)n[r]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const n=this.resolvedProperty;for(let r=0,s=n.length;r!==s;++r)n[r]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,n=t.objectName,r=t.propertyName;let s=t.propertyIndex;if(e||(e=li.findNode(this.rootNode,t.nodeName),this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");return}if(n){let c=t.objectIndex;switch(n){case"materials":if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(let u=0;u<e.length;u++)if(e[u].name===c){c=u;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}e=e.material.map;break;default:if(e[n]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[n]}if(c!==void 0){if(e[c]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[c]}}const o=e[r];if(o===void 0){const c=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+c+"."+r+" but it wasn't found.",e);return}let a=this.Versioning.None;this.targetObject=e,e.needsUpdate!==void 0?a=this.Versioning.NeedsUpdate:e.matrixWorldNeedsUpdate!==void 0&&(a=this.Versioning.MatrixWorldNeedsUpdate);let l=this.BindingType.Direct;if(s!==void 0){if(r==="morphTargetInfluences"){if(!e.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!e.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}e.morphTargetDictionary[s]!==void 0&&(s=e.morphTargetDictionary[s])}l=this.BindingType.ArrayElement,this.resolvedProperty=o,this.propertyIndex=s}else o.fromArray!==void 0&&o.toArray!==void 0?(l=this.BindingType.HasFromToArray,this.resolvedProperty=o):Array.isArray(o)?(l=this.BindingType.EntireArray,this.resolvedProperty=o):this.propertyName=r;this.getValue=this.GetterByBindingType[l],this.setValue=this.SetterByBindingTypeAndVersioning[l][a]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}li.Composite=Yne;li.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};li.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};li.prototype.GetterByBindingType=[li.prototype._getValue_direct,li.prototype._getValue_array,li.prototype._getValue_arrayElement,li.prototype._getValue_toArray];li.prototype.SetterByBindingTypeAndVersioning=[[li.prototype._setValue_direct,li.prototype._setValue_direct_setNeedsUpdate,li.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[li.prototype._setValue_array,li.prototype._setValue_array_setNeedsUpdate,li.prototype._setValue_array_setMatrixWorldNeedsUpdate],[li.prototype._setValue_arrayElement,li.prototype._setValue_arrayElement_setNeedsUpdate,li.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[li.prototype._setValue_fromArray,li.prototype._setValue_fromArray_setNeedsUpdate,li.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class Xne{constructor(){this.isAnimationObjectGroup=!0,this.uuid=Ll(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const e={};this._indicesByUUID=e;for(let n=0,r=arguments.length;n!==r;++n)e[arguments[n].uuid]=n;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const t=this;this.stats={objects:{get total(){return t._objects.length},get inUse(){return this.total-t.nCachedObjects_}},get bindingsPerObject(){return t._bindings.length}}}add(){const e=this._objects,t=this._indicesByUUID,n=this._paths,r=this._parsedPaths,s=this._bindings,o=s.length;let a,l=e.length,c=this.nCachedObjects_;for(let u=0,h=arguments.length;u!==h;++u){const f=arguments[u],d=f.uuid;let m=t[d];if(m===void 0){m=l++,t[d]=m,e.push(f);for(let A=0,g=o;A!==g;++A)s[A].push(new li(f,n[A],r[A]))}else if(m<c){a=e[m];const A=--c,g=e[A];t[g.uuid]=m,e[m]=g,t[d]=A,e[A]=f;for(let y=0,E=o;y!==E;++y){const x=s[y],C=x[A];let T=x[m];x[m]=C,T===void 0&&(T=new li(f,n[y],r[y])),x[A]=T}}else e[m]!==a&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=c}remove(){const e=this._objects,t=this._indicesByUUID,n=this._bindings,r=n.length;let s=this.nCachedObjects_;for(let o=0,a=arguments.length;o!==a;++o){const l=arguments[o],c=l.uuid,u=t[c];if(u!==void 0&&u>=s){const h=s++,f=e[h];t[f.uuid]=u,e[u]=f,t[c]=h,e[h]=l;for(let d=0,m=r;d!==m;++d){const A=n[d],g=A[h],y=A[u];A[u]=g,A[h]=y}}}this.nCachedObjects_=s}uncache(){const e=this._objects,t=this._indicesByUUID,n=this._bindings,r=n.length;let s=this.nCachedObjects_,o=e.length;for(let a=0,l=arguments.length;a!==l;++a){const c=arguments[a],u=c.uuid,h=t[u];if(h!==void 0)if(delete t[u],h<s){const f=--s,d=e[f],m=--o,A=e[m];t[d.uuid]=h,e[h]=d,t[A.uuid]=f,e[f]=A,e.pop();for(let g=0,y=r;g!==y;++g){const E=n[g],x=E[f],C=E[m];E[h]=x,E[f]=C,E.pop()}}else{const f=--o,d=e[f];f>0&&(t[d.uuid]=h),e[h]=d,e.pop();for(let m=0,A=r;m!==A;++m){const g=n[m];g[h]=g[f],g.pop()}}}this.nCachedObjects_=s}subscribe_(e,t){const n=this._bindingsIndicesByPath;let r=n[e];const s=this._bindings;if(r!==void 0)return s[r];const o=this._paths,a=this._parsedPaths,l=this._objects,c=l.length,u=this.nCachedObjects_,h=new Array(c);r=s.length,n[e]=r,o.push(e),a.push(t),s.push(h);for(let f=u,d=l.length;f!==d;++f){const m=l[f];h[f]=new li(m,e,t)}return h}unsubscribe_(e){const t=this._bindingsIndicesByPath,n=t[e];if(n!==void 0){const r=this._paths,s=this._parsedPaths,o=this._bindings,a=o.length-1,l=o[a],c=e[a];t[c]=n,o[n]=l,o.pop(),s[n]=s[a],s.pop(),r[n]=r[a],r.pop()}}}class _z{constructor(e,t,n=null,r=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=n,this.blendMode=r;const s=t.tracks,o=s.length,a=new Array(o),l={endingStart:Im,endingEnd:Im};for(let c=0;c!==o;++c){const u=s[c].createInterpolant(null);a[c]=u,u.settings=l}this._interpolantSettings=l,this._interpolants=a,this._propertyBindings=new Array(o),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=vU,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,n){if(e.fadeOut(t),this.fadeIn(t),n){const r=this._clip.duration,s=e._clip.duration,o=s/r,a=r/s;e.warp(1,o,t),this.warp(a,1,t)}return this}crossFadeTo(e,t,n){return e.crossFadeFrom(this,t,n)}stopFading(){const e=this._weightInterpolant;return e!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,n){const r=this._mixer,s=r.time,o=this.timeScale;let a=this._timeScaleInterpolant;a===null&&(a=r._lendControlInterpolant(),this._timeScaleInterpolant=a);const l=a.parameterPositions,c=a.sampleValues;return l[0]=s,l[1]=s+n,c[0]=e/o,c[1]=t/o,this}stopWarping(){const e=this._timeScaleInterpolant;return e!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,n,r){if(!this.enabled){this._updateWeight(e);return}const s=this._startTime;if(s!==null){const l=(e-s)*n;l<0||n===0?t=0:(this._startTime=null,t=n*l)}t*=this._updateTimeScale(e);const o=this._updateTime(t),a=this._updateWeight(e);if(a>0){const l=this._interpolants,c=this._propertyBindings;switch(this.blendMode){case g6:for(let u=0,h=l.length;u!==h;++u)l[u].evaluate(o),c[u].accumulateAdditive(a);break;case xw:default:for(let u=0,h=l.length;u!==h;++u)l[u].evaluate(o),c[u].accumulate(r,a)}}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;const n=this._weightInterpolant;if(n!==null){const r=n.evaluate(e)[0];t*=r,e>n.parameterPositions[1]&&(this.stopFading(),r===0&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;const n=this._timeScaleInterpolant;if(n!==null){const r=n.evaluate(e)[0];t*=r,e>n.parameterPositions[1]&&(this.stopWarping(),t===0?this.paused=!0:this.timeScale=t)}}return this._effectiveTimeScale=t,t}_updateTime(e){const t=this._clip.duration,n=this.loop;let r=this.time+e,s=this._loopCount;const o=n===xU;if(e===0)return s===-1?r:o&&(s&1)===1?t-r:r;if(n===yU){s===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(r>=t)r=t;else if(r<0)r=0;else{this.time=r;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(s===-1&&(e>=0?(s=0,this._setEndings(!0,this.repetitions===0,o)):this._setEndings(this.repetitions===0,!0,o)),r>=t||r<0){const a=Math.floor(r/t);r-=t*a,s+=Math.abs(a);const l=this.repetitions-s;if(l<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,r=e>0?t:0,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(l===1){const c=e<0;this._setEndings(c,!c,o)}else this._setEndings(!1,!1,o);this._loopCount=s,this.time=r,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:a})}}else this.time=r;if(o&&(s&1)===1)return t-r}return r}_setEndings(e,t,n){const r=this._interpolantSettings;n?(r.endingStart=Mm,r.endingEnd=Mm):(e?r.endingStart=this.zeroSlopeAtStart?Mm:Im:r.endingStart=S2,t?r.endingEnd=this.zeroSlopeAtEnd?Mm:Im:r.endingEnd=S2)}_scheduleFading(e,t,n){const r=this._mixer,s=r.time;let o=this._weightInterpolant;o===null&&(o=r._lendControlInterpolant(),this._weightInterpolant=o);const a=o.parameterPositions,l=o.sampleValues;return a[0]=s,l[0]=t,a[1]=s+e,l[1]=n,this}}const qne=new Float32Array(1);class Y6 extends Ch{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){const n=e._localRoot||this._root,r=e._clip.tracks,s=r.length,o=e._propertyBindings,a=e._interpolants,l=n.uuid,c=this._bindingsByRootAndName;let u=c[l];u===void 0&&(u={},c[l]=u);for(let h=0;h!==s;++h){const f=r[h],d=f.name;let m=u[d];if(m!==void 0)++m.referenceCount,o[h]=m;else{if(m=o[h],m!==void 0){m._cacheIndex===null&&(++m.referenceCount,this._addInactiveBinding(m,l,d));continue}const A=t&&t._propertyBindings[h].binding.parsedPath;m=new Ez(li.create(n,d,A),f.ValueTypeName,f.getValueSize()),++m.referenceCount,this._addInactiveBinding(m,l,d),o[h]=m}a[h].resultBuffer=m.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(e._cacheIndex===null){const n=(e._localRoot||this._root).uuid,r=e._clip.uuid,s=this._actionsByClip[r];this._bindAction(e,s&&s.knownActions[0]),this._addInactiveAction(e,r,n)}const t=e._propertyBindings;for(let n=0,r=t.length;n!==r;++n){const s=t[n];s.useCount++===0&&(this._lendBinding(s),s.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const t=e._propertyBindings;for(let n=0,r=t.length;n!==r;++n){const s=t[n];--s.useCount===0&&(s.restoreOriginalState(),this._takeBackBinding(s))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const t=e._cacheIndex;return t!==null&&t<this._nActiveActions}_addInactiveAction(e,t,n){const r=this._actions,s=this._actionsByClip;let o=s[t];if(o===void 0)o={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,s[t]=o;else{const a=o.knownActions;e._byClipCacheIndex=a.length,a.push(e)}e._cacheIndex=r.length,r.push(e),o.actionByRoot[n]=e}_removeInactiveAction(e){const t=this._actions,n=t[t.length-1],r=e._cacheIndex;n._cacheIndex=r,t[r]=n,t.pop(),e._cacheIndex=null;const s=e._clip.uuid,o=this._actionsByClip,a=o[s],l=a.knownActions,c=l[l.length-1],u=e._byClipCacheIndex;c._byClipCacheIndex=u,l[u]=c,l.pop(),e._byClipCacheIndex=null;const h=a.actionByRoot,f=(e._localRoot||this._root).uuid;delete h[f],l.length===0&&delete o[s],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const t=e._propertyBindings;for(let n=0,r=t.length;n!==r;++n){const s=t[n];--s.referenceCount===0&&this._removeInactiveBinding(s)}}_lendAction(e){const t=this._actions,n=e._cacheIndex,r=this._nActiveActions++,s=t[r];e._cacheIndex=r,t[r]=e,s._cacheIndex=n,t[n]=s}_takeBackAction(e){const t=this._actions,n=e._cacheIndex,r=--this._nActiveActions,s=t[r];e._cacheIndex=r,t[r]=e,s._cacheIndex=n,t[n]=s}_addInactiveBinding(e,t,n){const r=this._bindingsByRootAndName,s=this._bindings;let o=r[t];o===void 0&&(o={},r[t]=o),o[n]=e,e._cacheIndex=s.length,s.push(e)}_removeInactiveBinding(e){const t=this._bindings,n=e.binding,r=n.rootNode.uuid,s=n.path,o=this._bindingsByRootAndName,a=o[r],l=t[t.length-1],c=e._cacheIndex;l._cacheIndex=c,t[c]=l,t.pop(),delete a[s],Object.keys(a).length===0&&delete o[r]}_lendBinding(e){const t=this._bindings,n=e._cacheIndex,r=this._nActiveBindings++,s=t[r];e._cacheIndex=r,t[r]=e,s._cacheIndex=n,t[n]=s}_takeBackBinding(e){const t=this._bindings,n=e._cacheIndex,r=--this._nActiveBindings,s=t[r];e._cacheIndex=r,t[r]=e,s._cacheIndex=n,t[n]=s}_lendControlInterpolant(){const e=this._controlInterpolants,t=this._nActiveControlInterpolants++;let n=e[t];return n===void 0&&(n=new G6(new Float32Array(2),new Float32Array(2),1,qne),n.__cacheIndex=t,e[t]=n),n}_takeBackControlInterpolant(e){const t=this._controlInterpolants,n=e.__cacheIndex,r=--this._nActiveControlInterpolants,s=t[r];e.__cacheIndex=r,t[r]=e,s.__cacheIndex=n,t[n]=s}clipAction(e,t,n){const r=t||this._root,s=r.uuid;let o=typeof e=="string"?op.findByName(r,e):e;const a=o!==null?o.uuid:e,l=this._actionsByClip[a];let c=null;if(n===void 0&&(o!==null?n=o.blendMode:n=xw),l!==void 0){const h=l.actionByRoot[s];if(h!==void 0&&h.blendMode===n)return h;c=l.knownActions[0],o===null&&(o=c._clip)}if(o===null)return null;const u=new _z(this,o,t,n);return this._bindAction(u,c),this._addInactiveAction(u,a,s),u}existingAction(e,t){const n=t||this._root,r=n.uuid,s=typeof e=="string"?op.findByName(n,e):e,o=s?s.uuid:e,a=this._actionsByClip[o];return a!==void 0&&a.actionByRoot[r]||null}stopAllAction(){const e=this._actions,t=this._nActiveActions;for(let n=t-1;n>=0;--n)e[n].stop();return this}update(e){e*=this.timeScale;const t=this._actions,n=this._nActiveActions,r=this.time+=e,s=Math.sign(e),o=this._accuIndex^=1;for(let c=0;c!==n;++c)t[c]._update(r,e,s,o);const a=this._bindings,l=this._nActiveBindings;for(let c=0;c!==l;++c)a[c].apply(o);return this}setTime(e){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const t=this._actions,n=e.uuid,r=this._actionsByClip,s=r[n];if(s!==void 0){const o=s.knownActions;for(let a=0,l=o.length;a!==l;++a){const c=o[a];this._deactivateAction(c);const u=c._cacheIndex,h=t[t.length-1];c._cacheIndex=null,c._byClipCacheIndex=null,h._cacheIndex=u,t[u]=h,t.pop(),this._removeInactiveBindingsForAction(c)}delete r[n]}}uncacheRoot(e){const t=e.uuid,n=this._actionsByClip;for(const o in n){const a=n[o].actionByRoot,l=a[t];l!==void 0&&(this._deactivateAction(l),this._removeInactiveAction(l))}const r=this._bindingsByRootAndName,s=r[t];if(s!==void 0)for(const o in s){const a=s[o];a.restoreOriginalState(),this._removeInactiveBinding(a)}}uncacheAction(e,t){const n=this.existingAction(e,t);n!==null&&(this._deactivateAction(n),this._removeInactiveAction(n))}}class Xo{constructor(e){this.value=e}clone(){return new Xo(this.value.clone===void 0?this.value:this.value.clone())}}let Jne=0;class Zne extends Ch{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:Jne++}),this.name="",this.usage=b2,this.uniforms=[]}add(e){return this.uniforms.push(e),this}remove(e){const t=this.uniforms.indexOf(e);return t!==-1&&this.uniforms.splice(t,1),this}setName(e){return this.name=e,this}setUsage(e){return this.usage=e,this}dispose(){return this.dispatchEvent({type:"dispose"}),this}copy(e){this.name=e.name,this.usage=e.usage;const t=e.uniforms;this.uniforms.length=0;for(let n=0,r=t.length;n<r;n++){const s=Array.isArray(t[n])?t[n]:[t[n]];for(let o=0;o<s.length;o++)this.uniforms.push(s[o].clone())}return this}clone(){return new this.constructor().copy(this)}}class MS extends sx{constructor(e,t,n=1){super(e,t),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=n}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){const t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}class eie{constructor(e,t,n,r,s){this.isGLBufferAttribute=!0,this.name="",this.buffer=e,this.type=t,this.itemSize=n,this.elementSize=r,this.count=s,this.version=0}set needsUpdate(e){e===!0&&this.version++}setBuffer(e){return this.buffer=e,this}setType(e,t){return this.type=e,this.elementSize=t,this}setItemSize(e){return this.itemSize=e,this}setCount(e){return this.count=e,this}}class A0{constructor(e,t,n=0,r=1/0){this.ray=new vc(e,t),this.near=n,this.far=r,this.camera=null,this.layers=new zm,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}intersectObject(e,t=!0,n=[]){return LM(e,this,n,t),n.sort(_B),n}intersectObjects(e,t=!0,n=[]){for(let r=0,s=e.length;r<s;r++)LM(e[r],this,n,t);return n.sort(_B),n}}function _B(i,e){return i.distance-e.distance}function LM(i,e,t,n){if(i.layers.test(e.layers)&&i.raycast(e,t),n===!0){const r=i.children;for(let s=0,o=r.length;s<o;s++)LM(r[s],e,t,!0)}}class e0{constructor(e=1,t=0,n=0){return this.radius=e,this.phi=t,this.theta=n,this}set(e,t,n){return this.radius=e,this.phi=t,this.theta=n,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+t*t+n*n),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,n),this.phi=Math.acos(rs(t/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class tie{constructor(e=1,t=0,n=0){return this.radius=e,this.theta=t,this.y=n,this}set(e,t,n){return this.radius=e,this.theta=t,this.y=n,this}copy(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+n*n),this.theta=Math.atan2(e,n),this.y=t,this}clone(){return new this.constructor().copy(this)}}const SB=new Ue;class Sz{constructor(e=new Ue(1/0,1/0),t=new Ue(-1/0,-1/0)){this.isBox2=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=SB.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,SB).distanceTo(e)}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const wB=new H,d3=new H;class Eu{constructor(e=new H,t=new H){this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){wB.subVectors(e,this.start),d3.subVectors(this.end,this.start);const n=d3.dot(d3);let s=d3.dot(wB)/n;return t&&(s=rs(s,0,1)),s}closestPointToPoint(e,t,n){const r=this.closestPointToPointParameter(e,t);return this.delta(n).multiplyScalar(r).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return new this.constructor().copy(this)}}const CB=new H;class nie extends _n{constructor(e,t){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t,this.type="SpotLightHelper";const n=new fn,r=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let o=0,a=1,l=32;o<l;o++,a++){const c=o/l*Math.PI*2,u=a/l*Math.PI*2;r.push(Math.cos(c),Math.sin(c),1,Math.cos(u),Math.sin(u),1)}n.setAttribute("position",new Gt(r,3));const s=new vs({fog:!1,toneMapped:!1});this.cone=new Ru(n,s),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1);const e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),CB.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(CB),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const Cd=new H,p3=new Xe,ET=new Xe;class wz extends Ru{constructor(e){const t=Cz(e),n=new fn,r=[],s=[],o=new ut(0,0,1),a=new ut(0,1,0);for(let c=0;c<t.length;c++){const u=t[c];u.parent&&u.parent.isBone&&(r.push(0,0,0),r.push(0,0,0),s.push(o.r,o.g,o.b),s.push(a.r,a.g,a.b))}n.setAttribute("position",new Gt(r,3)),n.setAttribute("color",new Gt(s,3));const l=new vs({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});super(n,l),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){const t=this.bones,n=this.geometry,r=n.getAttribute("position");ET.copy(this.root.matrixWorld).invert();for(let s=0,o=0;s<t.length;s++){const a=t[s];a.parent&&a.parent.isBone&&(p3.multiplyMatrices(ET,a.matrixWorld),Cd.setFromMatrixPosition(p3),r.setXYZ(o,Cd.x,Cd.y,Cd.z),p3.multiplyMatrices(ET,a.parent.matrixWorld),Cd.setFromMatrixPosition(p3),r.setXYZ(o+1,Cd.x,Cd.y,Cd.z),o+=2)}n.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose()}}function Cz(i){const e=[];i.isBone===!0&&e.push(i);for(let t=0;t<i.children.length;t++)e.push.apply(e,Cz(i.children[t]));return e}class iie extends It{constructor(e,t,n){const r=new d0(t,4,2),s=new no({wireframe:!0,fog:!1,toneMapped:!1});super(r,s),this.light=e,this.color=n,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const rie=new H,TB=new ut,bB=new ut;class sie extends _n{constructor(e,t,n){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,this.type="HemisphereLightHelper";const r=new rc(t);r.rotateY(Math.PI*.5),this.material=new no({wireframe:!0,fog:!1,toneMapped:!1}),this.color===void 0&&(this.material.vertexColors=!0);const s=r.getAttribute("position"),o=new Float32Array(s.count*3);r.setAttribute("color",new mn(o,3)),this.add(new It(r,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const e=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{const t=e.geometry.getAttribute("color");TB.copy(this.light.color),bB.copy(this.light.groundColor);for(let n=0,r=t.count;n<r;n++){const s=n<r/2?TB:bB;t.setXYZ(n,s.r,s.g,s.b)}t.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),e.lookAt(rie.setFromMatrixPosition(this.light.matrixWorld).negate())}}class Tz extends Ru{constructor(e=10,t=10,n=4473924,r=8947848){n=new ut(n),r=new ut(r);const s=t/2,o=e/t,a=e/2,l=[],c=[];for(let f=0,d=0,m=-a;f<=t;f++,m+=o){l.push(-a,0,m,a,0,m),l.push(m,0,-a,m,0,a);const A=f===s?n:r;A.toArray(c,d),d+=3,A.toArray(c,d),d+=3,A.toArray(c,d),d+=3,A.toArray(c,d),d+=3}const u=new fn;u.setAttribute("position",new Gt(l,3)),u.setAttribute("color",new Gt(c,3));const h=new vs({vertexColors:!0,toneMapped:!1});super(u,h),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}class oie extends Ru{constructor(e=10,t=16,n=8,r=64,s=4473924,o=8947848){s=new ut(s),o=new ut(o);const a=[],l=[];if(t>1)for(let h=0;h<t;h++){const f=h/t*(Math.PI*2),d=Math.sin(f)*e,m=Math.cos(f)*e;a.push(0,0,0),a.push(d,0,m);const A=h&1?s:o;l.push(A.r,A.g,A.b),l.push(A.r,A.g,A.b)}for(let h=0;h<n;h++){const f=h&1?s:o,d=e-e/n*h;for(let m=0;m<r;m++){let A=m/r*(Math.PI*2),g=Math.sin(A)*d,y=Math.cos(A)*d;a.push(g,0,y),l.push(f.r,f.g,f.b),A=(m+1)/r*(Math.PI*2),g=Math.sin(A)*d,y=Math.cos(A)*d,a.push(g,0,y),l.push(f.r,f.g,f.b)}}const c=new fn;c.setAttribute("position",new Gt(a,3)),c.setAttribute("color",new Gt(l,3));const u=new vs({vertexColors:!0,toneMapped:!1});super(c,u),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}const IB=new H,m3=new H,MB=new H;class aie extends _n{constructor(e,t,n){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,this.type="DirectionalLightHelper",t===void 0&&(t=1);let r=new fn;r.setAttribute("position",new Gt([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));const s=new vs({fog:!1,toneMapped:!1});this.lightPlane=new Yn(r,s),this.add(this.lightPlane),r=new fn,r.setAttribute("position",new Gt([0,0,0,0,0,1],3)),this.targetLine=new Yn(r,s),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),IB.setFromMatrixPosition(this.light.matrixWorld),m3.setFromMatrixPosition(this.light.target.matrixWorld),MB.subVectors(m3,IB),this.lightPlane.lookAt(m3),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(m3),this.targetLine.scale.z=MB.length()}}const g3=new H,es=new u0;class bz extends Ru{constructor(e){const t=new fn,n=new vs({color:16777215,vertexColors:!0,toneMapped:!1}),r=[],s=[],o={};a("n1","n2"),a("n2","n4"),a("n4","n3"),a("n3","n1"),a("f1","f2"),a("f2","f4"),a("f4","f3"),a("f3","f1"),a("n1","f1"),a("n2","f2"),a("n3","f3"),a("n4","f4"),a("p","n1"),a("p","n2"),a("p","n3"),a("p","n4"),a("u1","u2"),a("u2","u3"),a("u3","u1"),a("c","t"),a("p","c"),a("cn1","cn2"),a("cn3","cn4"),a("cf1","cf2"),a("cf3","cf4");function a(m,A){l(m),l(A)}function l(m){r.push(0,0,0),s.push(0,0,0),o[m]===void 0&&(o[m]=[]),o[m].push(r.length/3-1)}t.setAttribute("position",new Gt(r,3)),t.setAttribute("color",new Gt(s,3)),super(t,n),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=o,this.update();const c=new ut(16755200),u=new ut(16711680),h=new ut(43775),f=new ut(16777215),d=new ut(3355443);this.setColors(c,u,h,f,d)}setColors(e,t,n,r,s){const a=this.geometry.getAttribute("color");a.setXYZ(0,e.r,e.g,e.b),a.setXYZ(1,e.r,e.g,e.b),a.setXYZ(2,e.r,e.g,e.b),a.setXYZ(3,e.r,e.g,e.b),a.setXYZ(4,e.r,e.g,e.b),a.setXYZ(5,e.r,e.g,e.b),a.setXYZ(6,e.r,e.g,e.b),a.setXYZ(7,e.r,e.g,e.b),a.setXYZ(8,e.r,e.g,e.b),a.setXYZ(9,e.r,e.g,e.b),a.setXYZ(10,e.r,e.g,e.b),a.setXYZ(11,e.r,e.g,e.b),a.setXYZ(12,e.r,e.g,e.b),a.setXYZ(13,e.r,e.g,e.b),a.setXYZ(14,e.r,e.g,e.b),a.setXYZ(15,e.r,e.g,e.b),a.setXYZ(16,e.r,e.g,e.b),a.setXYZ(17,e.r,e.g,e.b),a.setXYZ(18,e.r,e.g,e.b),a.setXYZ(19,e.r,e.g,e.b),a.setXYZ(20,e.r,e.g,e.b),a.setXYZ(21,e.r,e.g,e.b),a.setXYZ(22,e.r,e.g,e.b),a.setXYZ(23,e.r,e.g,e.b),a.setXYZ(24,t.r,t.g,t.b),a.setXYZ(25,t.r,t.g,t.b),a.setXYZ(26,t.r,t.g,t.b),a.setXYZ(27,t.r,t.g,t.b),a.setXYZ(28,t.r,t.g,t.b),a.setXYZ(29,t.r,t.g,t.b),a.setXYZ(30,t.r,t.g,t.b),a.setXYZ(31,t.r,t.g,t.b),a.setXYZ(32,n.r,n.g,n.b),a.setXYZ(33,n.r,n.g,n.b),a.setXYZ(34,n.r,n.g,n.b),a.setXYZ(35,n.r,n.g,n.b),a.setXYZ(36,n.r,n.g,n.b),a.setXYZ(37,n.r,n.g,n.b),a.setXYZ(38,r.r,r.g,r.b),a.setXYZ(39,r.r,r.g,r.b),a.setXYZ(40,s.r,s.g,s.b),a.setXYZ(41,s.r,s.g,s.b),a.setXYZ(42,s.r,s.g,s.b),a.setXYZ(43,s.r,s.g,s.b),a.setXYZ(44,s.r,s.g,s.b),a.setXYZ(45,s.r,s.g,s.b),a.setXYZ(46,s.r,s.g,s.b),a.setXYZ(47,s.r,s.g,s.b),a.setXYZ(48,s.r,s.g,s.b),a.setXYZ(49,s.r,s.g,s.b),a.needsUpdate=!0}update(){const e=this.geometry,t=this.pointMap,n=1,r=1;es.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),ds("c",t,e,es,0,0,-1),ds("t",t,e,es,0,0,1),ds("n1",t,e,es,-n,-r,-1),ds("n2",t,e,es,n,-r,-1),ds("n3",t,e,es,-n,r,-1),ds("n4",t,e,es,n,r,-1),ds("f1",t,e,es,-n,-r,1),ds("f2",t,e,es,n,-r,1),ds("f3",t,e,es,-n,r,1),ds("f4",t,e,es,n,r,1),ds("u1",t,e,es,n*.7,r*1.1,-1),ds("u2",t,e,es,-n*.7,r*1.1,-1),ds("u3",t,e,es,0,r*2,-1),ds("cf1",t,e,es,-n,0,1),ds("cf2",t,e,es,n,0,1),ds("cf3",t,e,es,0,-r,1),ds("cf4",t,e,es,0,r,1),ds("cn1",t,e,es,-n,0,-1),ds("cn2",t,e,es,n,0,-1),ds("cn3",t,e,es,0,-r,-1),ds("cn4",t,e,es,0,r,-1),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function ds(i,e,t,n,r,s,o){g3.set(r,s,o).unproject(n);const a=e[i];if(a!==void 0){const l=t.getAttribute("position");for(let c=0,u=a.length;c<u;c++)l.setXYZ(a[c],g3.x,g3.y,g3.z)}}const A3=new ti;class lie extends Ru{constructor(e,t=16776960){const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=new Float32Array(24),s=new fn;s.setIndex(new mn(n,1)),s.setAttribute("position",new mn(r,3)),super(s,new vs({color:t,toneMapped:!1})),this.object=e,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(e){if(e!==void 0&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),this.object!==void 0&&A3.setFromObject(this.object),A3.isEmpty())return;const t=A3.min,n=A3.max,r=this.geometry.attributes.position,s=r.array;s[0]=n.x,s[1]=n.y,s[2]=n.z,s[3]=t.x,s[4]=n.y,s[5]=n.z,s[6]=t.x,s[7]=t.y,s[8]=n.z,s[9]=n.x,s[10]=t.y,s[11]=n.z,s[12]=n.x,s[13]=n.y,s[14]=t.z,s[15]=t.x,s[16]=n.y,s[17]=t.z,s[18]=t.x,s[19]=t.y,s[20]=t.z,s[21]=n.x,s[22]=t.y,s[23]=t.z,r.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(e){return this.object=e,this.update(),this}copy(e,t){return super.copy(e,t),this.object=e.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class cie extends Ru{constructor(e,t=16776960){const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],s=new fn;s.setIndex(new mn(n,1)),s.setAttribute("position",new Gt(r,3)),super(s,new vs({color:t,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){const t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}dispose(){this.geometry.dispose(),this.material.dispose()}}class uie extends Yn{constructor(e,t=1,n=16776960){const r=n,s=[1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],o=new fn;o.setAttribute("position",new Gt(s,3)),o.computeBoundingSphere(),super(o,new vs({color:r,toneMapped:!1})),this.type="PlaneHelper",this.plane=e,this.size=t;const a=[1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],l=new fn;l.setAttribute("position",new Gt(a,3)),l.computeBoundingSphere(),this.add(new It(l,new no({color:r,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(e){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}const RB=new H;let y3,_T;class hie extends _n{constructor(e=new H(0,0,1),t=new H(0,0,0),n=1,r=16776960,s=n*.2,o=s*.2){super(),this.type="ArrowHelper",y3===void 0&&(y3=new fn,y3.setAttribute("position",new Gt([0,0,0,0,1,0],3)),_T=new yo(0,.5,1,5,1),_T.translate(0,-.5,0)),this.position.copy(t),this.line=new Yn(y3,new vs({color:r,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new It(_T,new no({color:r,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(n,s,o)}setDirection(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{RB.set(e.z,0,-e.x).normalize();const t=Math.acos(e.y);this.quaternion.setFromAxisAngle(RB,t)}}setLength(e,t=e*.2,n=t*.2){this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(n,t,n),this.cone.position.y=e,this.cone.updateMatrix()}setColor(e){this.line.material.color.set(e),this.cone.material.color.set(e)}copy(e){return super.copy(e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}class fie extends Ru{constructor(e=1){const t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],n=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],r=new fn;r.setAttribute("position",new Gt(t,3)),r.setAttribute("color",new Gt(n,3));const s=new vs({vertexColors:!0,toneMapped:!1});super(r,s),this.type="AxesHelper"}setColors(e,t,n){const r=new ut,s=this.geometry.attributes.color.array;return r.set(e),r.toArray(s,0),r.toArray(s,3),r.set(t),r.toArray(s,6),r.toArray(s,9),r.set(n),r.toArray(s,12),r.toArray(s,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class yf{constructor(){this.type="ShapePath",this.color=new ut,this.subPaths=[],this.currentPath=null}moveTo(e,t){return this.currentPath=new Xd,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){return this.currentPath.lineTo(e,t),this}quadraticCurveTo(e,t,n,r){return this.currentPath.quadraticCurveTo(e,t,n,r),this}bezierCurveTo(e,t,n,r,s,o){return this.currentPath.bezierCurveTo(e,t,n,r,s,o),this}splineThru(e){return this.currentPath.splineThru(e),this}toShapes(e){function t(y){const E=[];for(let x=0,C=y.length;x<C;x++){const T=y[x],I=new Lf;I.curves=T.curves,E.push(I)}return E}function n(y,E){const x=E.length;let C=!1;for(let T=x-1,I=0;I<x;T=I++){let M=E[T],L=E[I],R=L.x-M.x,P=L.y-M.y;if(Math.abs(P)>Number.EPSILON){if(P<0&&(M=E[I],R=-R,L=E[T],P=-P),y.y<M.y||y.y>L.y)continue;if(y.y===M.y){if(y.x===M.x)return!0}else{const F=P*(y.x-M.x)-R*(y.y-M.y);if(F===0)return!0;if(F<0)continue;C=!C}}else{if(y.y!==M.y)continue;if(L.x<=y.x&&y.x<=M.x||M.x<=y.x&&y.x<=L.x)return!0}}return C}const r=xu.isClockWise,s=this.subPaths;if(s.length===0)return[];let o,a,l;const c=[];if(s.length===1)return a=s[0],l=new Lf,l.curves=a.curves,c.push(l),c;let u=!r(s[0].getPoints());u=e?!u:u;const h=[],f=[];let d=[],m=0,A;f[m]=void 0,d[m]=[];for(let y=0,E=s.length;y<E;y++)a=s[y],A=a.getPoints(),o=r(A),o=e?!o:o,o?(!u&&f[m]&&m++,f[m]={s:new Lf,p:A},f[m].s.curves=a.curves,u&&m++,d[m]=[]):d[m].push({h:a,p:A[0]});if(!f[0])return t(s);if(f.length>1){let y=!1,E=0;for(let x=0,C=f.length;x<C;x++)h[x]=[];for(let x=0,C=f.length;x<C;x++){const T=d[x];for(let I=0;I<T.length;I++){const M=T[I];let L=!0;for(let R=0;R<f.length;R++)n(M.p,f[R].p)&&(x!==R&&E++,L?(L=!1,h[R].push(M)):y=!0);L&&h[x].push(M)}}E>0&&y===!1&&(d=h)}let g;for(let y=0,E=f.length;y<E;y++){l=f[y].s,c.push(l),g=d[y];for(let x=0,C=g.length;x<C;x++)l.holes.push(g[x].h)}return c}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:dp}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=dp);const X6=Object.freeze(Object.defineProperty({__proto__:null,ACESFilmicToneMapping:d6,AddEquation:Nd,AddOperation:aU,AdditiveAnimationBlendMode:g6,AdditiveBlending:AS,AgXToneMapping:fU,AlphaFormat:pU,AlwaysCompare:PU,AlwaysDepth:eU,AlwaysStencilFunc:CS,AmbientLight:W6,AnimationAction:_z,AnimationClip:op,AnimationLoader:Mne,AnimationMixer:Y6,AnimationObjectGroup:Xne,AnimationUtils:Cne,ArcCurve:qU,ArrayCamera:WU,ArrowHelper:hie,AttachedBindMode:nM,Audio:xz,AudioAnalyser:zne,AudioContext:j6,AudioListener:vz,AudioLoader:yz,AxesHelper:fie,BackSide:ys,BasicDepthPacking:_U,BasicShadowMap:NN,BatchedMesh:T6,Bone:tA,BooleanKeyframeTrack:m0,Box2:Sz,Box3:ti,Box3Helper:cie,BoxGeometry:ya,BoxHelper:lie,BufferAttribute:mn,BufferGeometry:fn,BufferGeometryLoader:gz,ByteType:E2,Cache:Rf,Camera:u0,CameraHelper:bz,CanvasTexture:M6,CapsuleGeometry:Bw,CatmullRomCurve3:Lw,CineonToneMapping:uU,CircleGeometry:Dw,ClampToEdgeWrapping:ji,Clock:$w,Color:ut,ColorKeyframeTrack:H6,ColorManagement:Vi,CompressedArrayTexture:$te,CompressedCubeTexture:Yte,CompressedTexture:gp,CompressedTextureLoader:Rne,ConeGeometry:kw,ConstantAlphaFactor:qN,ConstantColorFactor:YN,CubeCamera:Cw,CubeReflectionMapping:_u,CubeRefractionMapping:ip,CubeTexture:ix,CubeTextureLoader:Vw,CubeUVReflectionMapping:vA,CubicBezierCurve:L6,CubicBezierCurve3:P6,CubicInterpolant:cz,CullFaceBack:qI,CullFaceFront:ON,CullFaceFrontBack:$Y,CullFaceNone:FN,Curve:xc,CurvePath:F6,CustomBlending:pw,CustomToneMapping:hU,CylinderGeometry:yo,Cylindrical:tie,Data3DTexture:_6,DataArrayTexture:Sw,DataTexture:Sa,DataTextureLoader:Q6,DataUtils:Lm,DecrementStencilOp:tX,DecrementWrapStencilOp:iX,DefaultLoadingManager:R1,DepthFormat:vu,DepthStencilFormat:Xm,DepthTexture:f0,DetachedBindMode:dU,DirectionalLight:jw,DirectionalLightHelper:aie,DiscreteInterpolant:uz,DisplayP3ColorSpace:_w,DodecahedronGeometry:Fw,DoubleSide:Pi,DstAlphaFactor:VN,DstColorFactor:jN,DynamicCopyUsage:mX,DynamicDrawUsage:No,DynamicReadUsage:fX,EdgesGeometry:O6,EllipseCurve:Gm,EqualCompare:IU,EqualDepth:nU,EqualStencilFunc:wU,EquirectangularReflectionMapping:Ym,EquirectangularRefractionMapping:v2,Euler:Eo,EventDispatcher:Ch,ExtrudeGeometry:ux,FileLoader:$r,Float16BufferAttribute:eq,Float32BufferAttribute:Gt,Float64BufferAttribute:tq,FloatType:fi,Fog:Rw,FogExp2:Mw,FramebufferTexture:Kte,FrontSide:tl,Frustum:h0,GLBufferAttribute:eie,GLSL1:AX,GLSL3:SM,GreaterCompare:MU,GreaterDepth:rU,GreaterEqualCompare:LU,GreaterEqualDepth:iU,GreaterEqualStencilFunc:cX,GreaterStencilFunc:lX,GridHelper:Tz,Group:xa,HalfFloatType:Ni,HemisphereLight:fz,HemisphereLightHelper:sie,IcosahedronGeometry:hx,ImageBitmapLoader:Az,ImageLoader:P2,ImageUtils:E6,IncrementStencilOp:eX,IncrementWrapStencilOp:nX,InstancedBufferAttribute:Su,InstancedBufferGeometry:dx,InstancedInterleavedBuffer:MS,InstancedMesh:ax,Int16BufferAttribute:JX,Int32BufferAttribute:ZX,Int8BufferAttribute:YX,IntType:Nm,InterleavedBuffer:sx,InterleavedBufferAttribute:Ja,Interpolant:SA,InterpolateDiscrete:q1,InterpolateLinear:Jm,InterpolateSmooth:H_,InvertStencilOp:rX,KeepStencilOp:hh,KeyframeTrack:Lu,LOD:YU,LatheGeometry:cx,Layers:zm,LessCompare:bU,LessDepth:tU,LessEqualCompare:v6,LessEqualDepth:y2,LessEqualStencilFunc:aX,LessStencilFunc:oX,Light:yp,LightProbe:mz,Line:Yn,Line3:Eu,LineBasicMaterial:vs,LineCurve:B6,LineCurve3:JU,LineDashedMaterial:oz,LineLoop:b6,LineSegments:Ru,LinearDisplayP3ColorSpace:nx,LinearEncoding:y6,LinearFilter:Pn,LinearInterpolant:G6,LinearMipMapLinearFilter:iM,LinearMipMapNearestFilter:JY,LinearMipmapLinearFilter:Bl,LinearMipmapNearestFilter:gw,LinearSRGBColorSpace:Dl,LinearToneMapping:lU,LinearTransfer:w2,Loader:os,LoaderUtils:Pf,LoadingManager:Qw,LoopOnce:yU,LoopPingPong:xU,LoopRepeat:vU,LuminanceAlphaFormat:gU,LuminanceFormat:mU,MOUSE:oc,Material:Us,MaterialLoader:Kw,MathUtils:un,Matrix3:Tn,Matrix4:Xe,MaxEquation:tM,Mesh:It,MeshBasicMaterial:no,MeshDepthMaterial:rx,MeshDistanceMaterial:bw,MeshLambertMaterial:fx,MeshMatcapMaterial:sz,MeshNormalMaterial:U6,MeshPhongMaterial:Jv,MeshPhysicalMaterial:nl,MeshStandardMaterial:p0,MeshToonMaterial:rz,MinEquation:eM,MirroredRepeatWrapping:X1,MixOperation:oU,MultiplyBlending:ZI,MultiplyOperation:ex,NearestFilter:zn,NearestMipMapLinearFilter:qY,NearestMipMapNearestFilter:XY,NearestMipmapLinearFilter:F1,NearestMipmapNearestFilter:x2,NeverCompare:TU,NeverDepth:ZN,NeverStencilFunc:sX,NoBlending:gc,NoColorSpace:Tl,NoToneMapping:yu,NormalAnimationBlendMode:xw,NormalBlending:Kd,NotEqualCompare:RU,NotEqualDepth:sU,NotEqualStencilFunc:CU,NumberKeyframeTrack:sp,Object3D:_n,ObjectLoader:Dne,ObjectSpaceNormalMap:SU,OctahedronGeometry:rc,OneFactor:mw,OneMinusConstantAlphaFactor:JN,OneMinusConstantColorFactor:XN,OneMinusDstAlphaFactor:WN,OneMinusDstColorFactor:KN,OneMinusSrcAlphaFactor:yS,OneMinusSrcColorFactor:QN,OrthographicCamera:qi,P3Primaries:T2,PCFShadowMap:dw,PCFSoftShadowMap:Vv,PMREMGenerator:CM,Path:Xd,PerspectiveCamera:Wn,Plane:vo,PlaneGeometry:Fs,PlaneHelper:uie,PointLight:B2,PointLightHelper:iie,Points:I6,PointsMaterial:lx,PolarGridHelper:oie,PolyhedronGeometry:Ap,PositionalAudio:Une,PropertyBinding:li,PropertyMixer:Ez,QuadraticBezierCurve:D6,QuadraticBezierCurve3:Pw,Quaternion:Xt,QuaternionKeyframeTrack:vh,QuaternionLinearInterpolant:hz,RED_GREEN_RGTC2_Format:EM,RED_RGTC1_Format:AU,REVISION:dp,RGBADepthPacking:Ew,RGBAFormat:gi,RGBAIntegerFormat:qm,RGBA_ASTC_10x10_Format:mM,RGBA_ASTC_10x5_Format:fM,RGBA_ASTC_10x6_Format:dM,RGBA_ASTC_10x8_Format:pM,RGBA_ASTC_12x10_Format:gM,RGBA_ASTC_12x12_Format:AM,RGBA_ASTC_4x4_Format:SS,RGBA_ASTC_5x4_Format:oM,RGBA_ASTC_5x5_Format:aM,RGBA_ASTC_6x5_Format:lM,RGBA_ASTC_6x6_Format:_2,RGBA_ASTC_8x5_Format:cM,RGBA_ASTC_8x6_Format:uM,RGBA_ASTC_8x8_Format:hM,RGBA_BPTC_Format:Kv,RGBA_ETC2_EAC_Format:_S,RGBA_PVRTC_2BPPV1_Format:sM,RGBA_PVRTC_4BPPV1_Format:xS,RGBA_S3TC_DXT1_Format:z_,RGBA_S3TC_DXT3_Format:G_,RGBA_S3TC_DXT5_Format:jv,RGB_BPTC_SIGNED_Format:yM,RGB_BPTC_UNSIGNED_Format:vM,RGB_ETC1_Format:vw,RGB_ETC2_Format:ES,RGB_PVRTC_2BPPV1_Format:rM,RGB_PVRTC_4BPPV1_Format:vS,RGB_S3TC_DXT1_Format:Wv,RGFormat:Gd,RGIntegerFormat:tx,RawShaderMaterial:iz,Ray:vc,Raycaster:A0,Rec709Primaries:C2,RectAreaLight:dz,RedFormat:hc,RedIntegerFormat:yw,ReinhardToneMapping:cU,RenderTarget:kU,RepeatWrapping:_o,ReplaceStencilOp:Q_,ReverseSubtractEquation:zN,RingGeometry:Nw,SIGNED_RED_GREEN_RGTC2_Format:_M,SIGNED_RED_RGTC1_Format:xM,SRGBColorSpace:gs,SRGBTransfer:mr,Scene:Mu,ShaderChunk:Un,ShaderLib:du,ShaderMaterial:Mi,ShadowMaterial:nz,Shape:Lf,ShapeGeometry:Uw,ShapePath:yf,ShapeUtils:xu,ShortType:Aw,Skeleton:_A,SkeletonHelper:wz,SkinnedMesh:ox,Source:Rm,Sphere:Bi,SphereGeometry:d0,Spherical:e0,SphericalHarmonics3:pz,SplineCurve:k6,SpotLight:Ww,SpotLightHelper:nie,Sprite:$U,SpriteMaterial:C6,SrcAlphaFactor:A2,SrcAlphaSaturateFactor:$N,SrcColorFactor:HN,StaticCopyUsage:pX,StaticDrawUsage:b2,StaticReadUsage:hX,StereoCamera:Fne,StreamCopyUsage:gX,StreamDrawUsage:uX,StreamReadUsage:dX,StringKeyframeTrack:g0,SubtractEquation:UN,SubtractiveBlending:JI,TOUCH:Sf,TangentSpaceNormalMap:mp,TetrahedronGeometry:zw,Texture:vi,TextureLoader:xh,TorusGeometry:Hd,TorusKnotGeometry:Gw,Triangle:ks,TriangleFanDrawMode:wS,TriangleStripDrawMode:A6,TrianglesDrawMode:EU,TubeGeometry:Hw,TwoPassDoubleSide:YY,UVMapping:np,Uint16BufferAttribute:ww,Uint32BufferAttribute:S6,Uint8BufferAttribute:XX,Uint8ClampedBufferAttribute:qX,Uniform:Xo,UniformsGroup:Zne,UniformsLib:Ot,UniformsUtils:rp,UnsignedByteType:Zi,UnsignedInt248Type:$d,UnsignedIntType:Zo,UnsignedShort4444Type:p6,UnsignedShort5551Type:m6,UnsignedShortType:pp,VSMShadowMap:fu,Vector2:Ue,Vector3:H,Vector4:Rn,VectorKeyframeTrack:Of,VideoTexture:XU,WebGL1Renderer:jU,WebGL3DRenderTarget:OX,WebGLArrayRenderTarget:FX,WebGLCoordinateSystem:mu,WebGLCubeRenderTarget:xA,WebGLMultipleRenderTargets:NX,WebGLRenderTarget:Si,WebGLRenderer:Iw,WebGLUtils:VU,WebGPUCoordinateSystem:J1,WireframeGeometry:N6,WrapAroundEnding:S2,ZeroCurvatureEnding:Im,ZeroFactor:GN,ZeroSlopeEnding:Mm,ZeroStencilOp:ZY,_SRGBAFormat:TS,createCanvasElement:DU,sRGBEncoding:Yd},Symbol.toStringTag,{value:"Module"}));var ST={exports:{}},Td={};/**
 * @license React
 * react-reconciler-constants.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var LB;function die(){return LB||(LB=1,Td.ConcurrentRoot=1,Td.ContinuousEventPriority=4,Td.DefaultEventPriority=16,Td.DiscreteEventPriority=1,Td.IdleEventPriority=536870912,Td.LegacyRoot=0),Td}var PB;function pie(){return PB||(PB=1,ST.exports=die()),ST.exports}var L1=pie();function mie(i){let e;const t=new Set,n=(c,u)=>{const h=typeof c=="function"?c(e):c;if(h!==e){const f=e;e=u?h:Object.assign({},e,h),t.forEach(d=>d(e,f))}},r=()=>e,s=(c,u=r,h=Object.is)=>{console.warn("[DEPRECATED] Please use `subscribeWithSelector` middleware");let f=u(e);function d(){const m=u(e);if(!h(f,m)){const A=f;c(f=m,A)}}return t.add(d),()=>t.delete(d)},l={setState:n,getState:r,subscribe:(c,u,h)=>u||h?s(c,u,h):(t.add(c),()=>t.delete(c)),destroy:()=>t.clear()};return e=i(n,r,l),l}const gie=typeof window>"u"||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent),BB=gie?w.useEffect:w.useLayoutEffect;function Iz(i){const e=typeof i=="function"?mie(i):i,t=(n=e.getState,r=Object.is)=>{const[,s]=w.useReducer(g=>g+1,0),o=e.getState(),a=w.useRef(o),l=w.useRef(n),c=w.useRef(r),u=w.useRef(!1),h=w.useRef();h.current===void 0&&(h.current=n(o));let f,d=!1;(a.current!==o||l.current!==n||c.current!==r||u.current)&&(f=n(o),d=!r(h.current,f)),BB(()=>{d&&(h.current=f),a.current=o,l.current=n,c.current=r,u.current=!1});const m=w.useRef(o);BB(()=>{const g=()=>{try{const E=e.getState(),x=l.current(E);c.current(h.current,x)||(a.current=E,h.current=x,s())}catch{u.current=!0,s()}},y=e.subscribe(g);return e.getState()!==m.current&&g(),y},[]);const A=d?f:h.current;return w.useDebugValue(A),A};return Object.assign(t,e),t[Symbol.iterator]=function(){console.warn("[useStore, api] = create() is deprecated and will be removed in v4");const n=[t,e];return{next(){const r=n.length<=0;return{value:n.shift(),done:r}}}},t}const Aie=i=>typeof i=="object"&&typeof i.then=="function",Bm=[];function Mz(i,e,t=(n,r)=>n===r){if(i===e)return!0;if(!i||!e)return!1;const n=i.length;if(e.length!==n)return!1;for(let r=0;r<n;r++)if(!t(i[r],e[r]))return!1;return!0}function Rz(i,e=null,t=!1,n={}){e===null&&(e=[i]);for(const s of Bm)if(Mz(e,s.keys,s.equal)){if(t)return;if(Object.prototype.hasOwnProperty.call(s,"error"))throw s.error;if(Object.prototype.hasOwnProperty.call(s,"response"))return n.lifespan&&n.lifespan>0&&(s.timeout&&clearTimeout(s.timeout),s.timeout=setTimeout(s.remove,n.lifespan)),s.response;if(!t)throw s.promise}const r={keys:e,equal:n.equal,remove:()=>{const s=Bm.indexOf(r);s!==-1&&Bm.splice(s,1)},promise:(Aie(i)?i:i(...e)).then(s=>{r.response=s,n.lifespan&&n.lifespan>0&&(r.timeout=setTimeout(r.remove,n.lifespan))}).catch(s=>r.error=s)};if(Bm.push(r),!t)throw r.promise}const Th=(i,e,t)=>Rz(i,e,!1,t),Lz=(i,e,t)=>void Rz(i,e,!0,t),px=i=>{if(i===void 0||i.length===0)Bm.splice(0,Bm.length);else{const e=Bm.find(t=>Mz(i,t.keys,t.equal));e&&e.remove()}};var wT={exports:{}},CT={exports:{}},TT={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var DB;function yie(){return DB||(DB=1,(function(i){function e(X,Q){var Y=X.length;X.push(Q);e:for(;0<Y;){var O=Y-1>>>1,K=X[O];if(0<r(K,Q))X[O]=Q,X[Y]=K,Y=O;else break e}}function t(X){return X.length===0?null:X[0]}function n(X){if(X.length===0)return null;var Q=X[0],Y=X.pop();if(Y!==Q){X[0]=Y;e:for(var O=0,K=X.length,te=K>>>1;O<te;){var q=2*(O+1)-1,J=X[q],ie=q+1,re=X[ie];if(0>r(J,Y))ie<K&&0>r(re,J)?(X[O]=re,X[ie]=Y,O=ie):(X[O]=J,X[q]=Y,O=q);else if(ie<K&&0>r(re,Y))X[O]=re,X[ie]=Y,O=ie;else break e}}return Q}function r(X,Q){var Y=X.sortIndex-Q.sortIndex;return Y!==0?Y:X.id-Q.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;i.unstable_now=function(){return s.now()}}else{var o=Date,a=o.now();i.unstable_now=function(){return o.now()-a}}var l=[],c=[],u=1,h=null,f=3,d=!1,m=!1,A=!1,g=typeof setTimeout=="function"?setTimeout:null,y=typeof clearTimeout=="function"?clearTimeout:null,E=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function x(X){for(var Q=t(c);Q!==null;){if(Q.callback===null)n(c);else if(Q.startTime<=X)n(c),Q.sortIndex=Q.expirationTime,e(l,Q);else break;Q=t(c)}}function C(X){if(A=!1,x(X),!m)if(t(l)!==null)m=!0,$(T);else{var Q=t(c);Q!==null&&oe(C,Q.startTime-X)}}function T(X,Q){m=!1,A&&(A=!1,y(L),L=-1),d=!0;var Y=f;try{for(x(Q),h=t(l);h!==null&&(!(h.expirationTime>Q)||X&&!F());){var O=h.callback;if(typeof O=="function"){h.callback=null,f=h.priorityLevel;var K=O(h.expirationTime<=Q);Q=i.unstable_now(),typeof K=="function"?h.callback=K:h===t(l)&&n(l),x(Q)}else n(l);h=t(l)}if(h!==null)var te=!0;else{var q=t(c);q!==null&&oe(C,q.startTime-Q),te=!1}return te}finally{h=null,f=Y,d=!1}}var I=!1,M=null,L=-1,R=5,P=-1;function F(){return!(i.unstable_now()-P<R)}function k(){if(M!==null){var X=i.unstable_now();P=X;var Q=!0;try{Q=M(!0,X)}finally{Q?z():(I=!1,M=null)}}else I=!1}var z;if(typeof E=="function")z=function(){E(k)};else if(typeof MessageChannel<"u"){var U=new MessageChannel,W=U.port2;U.port1.onmessage=k,z=function(){W.postMessage(null)}}else z=function(){g(k,0)};function $(X){M=X,I||(I=!0,z())}function oe(X,Q){L=g(function(){X(i.unstable_now())},Q)}i.unstable_IdlePriority=5,i.unstable_ImmediatePriority=1,i.unstable_LowPriority=4,i.unstable_NormalPriority=3,i.unstable_Profiling=null,i.unstable_UserBlockingPriority=2,i.unstable_cancelCallback=function(X){X.callback=null},i.unstable_continueExecution=function(){m||d||(m=!0,$(T))},i.unstable_forceFrameRate=function(X){0>X||125<X?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):R=0<X?Math.floor(1e3/X):5},i.unstable_getCurrentPriorityLevel=function(){return f},i.unstable_getFirstCallbackNode=function(){return t(l)},i.unstable_next=function(X){switch(f){case 1:case 2:case 3:var Q=3;break;default:Q=f}var Y=f;f=Q;try{return X()}finally{f=Y}},i.unstable_pauseExecution=function(){},i.unstable_requestPaint=function(){},i.unstable_runWithPriority=function(X,Q){switch(X){case 1:case 2:case 3:case 4:case 5:break;default:X=3}var Y=f;f=X;try{return Q()}finally{f=Y}},i.unstable_scheduleCallback=function(X,Q,Y){var O=i.unstable_now();switch(typeof Y=="object"&&Y!==null?(Y=Y.delay,Y=typeof Y=="number"&&0<Y?O+Y:O):Y=O,X){case 1:var K=-1;break;case 2:K=250;break;case 5:K=1073741823;break;case 4:K=1e4;break;default:K=5e3}return K=Y+K,X={id:u++,callback:Q,priorityLevel:X,startTime:Y,expirationTime:K,sortIndex:-1},Y>O?(X.sortIndex=Y,e(c,X),t(l)===null&&X===t(c)&&(A?(y(L),L=-1):A=!0,oe(C,Y-O))):(X.sortIndex=K,e(l,X),m||d||(m=!0,$(T))),X},i.unstable_shouldYield=F,i.unstable_wrapCallback=function(X){var Q=f;return function(){var Y=f;f=Q;try{return X.apply(this,arguments)}finally{f=Y}}}})(TT)),TT}var kB;function Pz(){return kB||(kB=1,CT.exports=yie()),CT.exports}/**
 * @license React
 * react-reconciler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var bT,FB;function vie(){return FB||(FB=1,bT=function(e){var t={},n=yA(),r=Pz(),s=Object.assign;function o(_){for(var S="https://reactjs.org/docs/error-decoder.html?invariant="+_,B=1;B<arguments.length;B++)S+="&args[]="+encodeURIComponent(arguments[B]);return"Minified React error #"+_+"; visit "+S+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var a=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,l=Symbol.for("react.element"),c=Symbol.for("react.portal"),u=Symbol.for("react.fragment"),h=Symbol.for("react.strict_mode"),f=Symbol.for("react.profiler"),d=Symbol.for("react.provider"),m=Symbol.for("react.context"),A=Symbol.for("react.forward_ref"),g=Symbol.for("react.suspense"),y=Symbol.for("react.suspense_list"),E=Symbol.for("react.memo"),x=Symbol.for("react.lazy"),C=Symbol.for("react.offscreen"),T=Symbol.iterator;function I(_){return _===null||typeof _!="object"?null:(_=T&&_[T]||_["@@iterator"],typeof _=="function"?_:null)}function M(_){if(_==null)return null;if(typeof _=="function")return _.displayName||_.name||null;if(typeof _=="string")return _;switch(_){case u:return"Fragment";case c:return"Portal";case f:return"Profiler";case h:return"StrictMode";case g:return"Suspense";case y:return"SuspenseList"}if(typeof _=="object")switch(_.$$typeof){case m:return(_.displayName||"Context")+".Consumer";case d:return(_._context.displayName||"Context")+".Provider";case A:var S=_.render;return _=_.displayName,_||(_=S.displayName||S.name||"",_=_!==""?"ForwardRef("+_+")":"ForwardRef"),_;case E:return S=_.displayName||null,S!==null?S:M(_.type)||"Memo";case x:S=_._payload,_=_._init;try{return M(_(S))}catch{}}return null}function L(_){var S=_.type;switch(_.tag){case 24:return"Cache";case 9:return(S.displayName||"Context")+".Consumer";case 10:return(S._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return _=S.render,_=_.displayName||_.name||"",S.displayName||(_!==""?"ForwardRef("+_+")":"ForwardRef");case 7:return"Fragment";case 5:return S;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return M(S);case 8:return S===h?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof S=="function")return S.displayName||S.name||null;if(typeof S=="string")return S}return null}function R(_){var S=_,B=_;if(_.alternate)for(;S.return;)S=S.return;else{_=S;do S=_,(S.flags&4098)!==0&&(B=S.return),_=S.return;while(_)}return S.tag===3?B:null}function P(_){if(R(_)!==_)throw Error(o(188))}function F(_){var S=_.alternate;if(!S){if(S=R(_),S===null)throw Error(o(188));return S!==_?null:_}for(var B=_,N=S;;){var j=B.return;if(j===null)break;var le=j.alternate;if(le===null){if(N=j.return,N!==null){B=N;continue}break}if(j.child===le.child){for(le=j.child;le;){if(le===B)return P(j),_;if(le===N)return P(j),S;le=le.sibling}throw Error(o(188))}if(B.return!==N.return)B=j,N=le;else{for(var Se=!1,Ge=j.child;Ge;){if(Ge===B){Se=!0,B=j,N=le;break}if(Ge===N){Se=!0,N=j,B=le;break}Ge=Ge.sibling}if(!Se){for(Ge=le.child;Ge;){if(Ge===B){Se=!0,B=le,N=j;break}if(Ge===N){Se=!0,N=le,B=j;break}Ge=Ge.sibling}if(!Se)throw Error(o(189))}}if(B.alternate!==N)throw Error(o(190))}if(B.tag!==3)throw Error(o(188));return B.stateNode.current===B?_:S}function k(_){return _=F(_),_!==null?z(_):null}function z(_){if(_.tag===5||_.tag===6)return _;for(_=_.child;_!==null;){var S=z(_);if(S!==null)return S;_=_.sibling}return null}function U(_){if(_.tag===5||_.tag===6)return _;for(_=_.child;_!==null;){if(_.tag!==4){var S=U(_);if(S!==null)return S}_=_.sibling}return null}var W=Array.isArray,$=e.getPublicInstance,oe=e.getRootHostContext,X=e.getChildHostContext,Q=e.prepareForCommit,Y=e.resetAfterCommit,O=e.createInstance,K=e.appendInitialChild,te=e.finalizeInitialChildren,q=e.prepareUpdate,J=e.shouldSetTextContent,ie=e.createTextInstance,re=e.scheduleTimeout,se=e.cancelTimeout,ge=e.noTimeout,xe=e.isPrimaryRenderer,pe=e.supportsMutation,ce=e.supportsPersistence,we=e.supportsHydration,Ee=e.getInstanceFromNode,ve=e.preparePortalMount,Ae=e.getCurrentEventPriority,Le=e.detachDeletedInstance,Te=e.supportsMicrotasks,ne=e.scheduleMicrotask,V=e.supportsTestSelectors,de=e.findFiberRoot,Re=e.getBoundingRect,Be=e.getTextContent,Fe=e.isHiddenSubtree,He=e.matchAccessibilityRole,it=e.setFocusIfFocusable,$e=e.setupIntersectionObserver,ct=e.appendChild,pt=e.appendChildToContainer,We=e.commitTextUpdate,Mt=e.commitMount,Ft=e.commitUpdate,St=e.insertBefore,gt=e.insertInContainerBefore,ft=e.removeChild,be=e.removeChildFromContainer,qe=e.resetTextContent,At=e.hideInstance,yt=e.hideTextInstance,De=e.unhideInstance,Ce=e.unhideTextInstance,_t=e.clearContainer,vt=e.cloneInstance,bt=e.createContainerChildSet,Pt=e.appendChildToContainerChildSet,qt=e.finalizeContainerChildren,Nt=e.replaceContainerChildren,dn=e.cloneHiddenInstance,Vn=e.cloneHiddenTextInstance,pn=e.canHydrateInstance,qn=e.canHydrateTextInstance,Ci=e.canHydrateSuspenseInstance,as=e.isSuspenseInstancePending,Nr=e.isSuspenseInstanceFallback,ur=e.registerSuspenseInstanceRetry,tr=e.getNextHydratableSibling,An=e.getFirstHydratableChild,vr=e.getFirstHydratableChildWithinContainer,Uo=e.getFirstHydratableChildWithinSuspenseInstance,he=e.hydrateInstance,me=e.hydrateTextInstance,ke=e.hydrateSuspenseInstance,ue=e.getNextHydratableInstanceAfterSuspenseInstance,ye=e.commitHydratedContainer,_e=e.commitHydratedSuspenseInstance,Pe=e.clearSuspenseBoundary,Me=e.clearSuspenseBoundaryFromContainer,Je=e.shouldDeleteUnhydratedTailInstances,st=e.didNotMatchHydratedContainerTextInstance,lt=e.didNotMatchHydratedTextInstance,Oe;function Ht(_){if(Oe===void 0)try{throw Error()}catch(B){var S=B.stack.trim().match(/\n( *(at )?)/);Oe=S&&S[1]||""}return`
`+Oe+_}var xt=!1;function Et(_,S){if(!_||xt)return"";xt=!0;var B=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(S)if(S=function(){throw Error()},Object.defineProperty(S.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(S,[])}catch(Rt){var N=Rt}Reflect.construct(_,[],S)}else{try{S.call()}catch(Rt){N=Rt}_.call(S.prototype)}else{try{throw Error()}catch(Rt){N=Rt}_()}}catch(Rt){if(Rt&&N&&typeof Rt.stack=="string"){for(var j=Rt.stack.split(`
`),le=N.stack.split(`
`),Se=j.length-1,Ge=le.length-1;1<=Se&&0<=Ge&&j[Se]!==le[Ge];)Ge--;for(;1<=Se&&0<=Ge;Se--,Ge--)if(j[Se]!==le[Ge]){if(Se!==1||Ge!==1)do if(Se--,Ge--,0>Ge||j[Se]!==le[Ge]){var ht=`
`+j[Se].replace(" at new "," at ");return _.displayName&&ht.includes("<anonymous>")&&(ht=ht.replace("<anonymous>",_.displayName)),ht}while(1<=Se&&0<=Ge);break}}}finally{xt=!1,Error.prepareStackTrace=B}return(_=_?_.displayName||_.name:"")?Ht(_):""}var Qt=Object.prototype.hasOwnProperty,sn=[],ln=-1;function vn(_){return{current:_}}function Dt(_){0>ln||(_.current=sn[ln],sn[ln]=null,ln--)}function Bt(_,S){ln++,sn[ln]=_.current,_.current=S}var yn={},xn=vn(yn),Sn=vn(!1),Ai=yn;function xi(_,S){var B=_.type.contextTypes;if(!B)return yn;var N=_.stateNode;if(N&&N.__reactInternalMemoizedUnmaskedChildContext===S)return N.__reactInternalMemoizedMaskedChildContext;var j={},le;for(le in B)j[le]=S[le];return N&&(_=_.stateNode,_.__reactInternalMemoizedUnmaskedChildContext=S,_.__reactInternalMemoizedMaskedChildContext=j),j}function Ei(_){return _=_.childContextTypes,_!=null}function Dn(){Dt(Sn),Dt(xn)}function kn(_,S,B){if(xn.current!==yn)throw Error(o(168));Bt(xn,S),Bt(Sn,B)}function zi(_,S,B){var N=_.stateNode;if(S=S.childContextTypes,typeof N.getChildContext!="function")return B;N=N.getChildContext();for(var j in N)if(!(j in S))throw Error(o(108,L(_)||"Unknown",j));return s({},B,N)}function Bn(_){return _=(_=_.stateNode)&&_.__reactInternalMemoizedMergedChildContext||yn,Ai=xn.current,Bt(xn,_),Bt(Sn,Sn.current),!0}function Ln(_,S,B){var N=_.stateNode;if(!N)throw Error(o(169));B?(_=zi(_,S,Ai),N.__reactInternalMemoizedMergedChildContext=_,Dt(Sn),Dt(xn),Bt(xn,_)):Dt(Sn),Bt(Sn,B)}var Ri=Math.clz32?Math.clz32:ta,ls=Math.log,nr=Math.LN2;function ta(_){return _>>>=0,_===0?32:31-(ls(_)/nr|0)|0}var ol=64,ri=4194304;function Ul(_){switch(_&-_){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return _&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return _&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return _}}function ku(_,S){var B=_.pendingLanes;if(B===0)return 0;var N=0,j=_.suspendedLanes,le=_.pingedLanes,Se=B&268435455;if(Se!==0){var Ge=Se&~j;Ge!==0?N=Ul(Ge):(le&=Se,le!==0&&(N=Ul(le)))}else Se=B&~j,Se!==0?N=Ul(Se):le!==0&&(N=Ul(le));if(N===0)return 0;if(S!==0&&S!==N&&(S&j)===0&&(j=N&-N,le=S&-S,j>=le||j===16&&(le&4194240)!==0))return S;if((N&4)!==0&&(N|=B&16),S=_.entangledLanes,S!==0)for(_=_.entanglements,S&=N;0<S;)B=31-Ri(S),j=1<<B,N|=_[B],S&=~j;return N}function Qf(_,S){switch(_){case 1:case 2:case 4:return S+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return S+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Vf(_,S){for(var B=_.suspendedLanes,N=_.pingedLanes,j=_.expirationTimes,le=_.pendingLanes;0<le;){var Se=31-Ri(le),Ge=1<<Se,ht=j[Se];ht===-1?((Ge&B)===0||(Ge&N)!==0)&&(j[Se]=Qf(Ge,S)):ht<=S&&(_.expiredLanes|=Ge),le&=~Ge}}function zl(_){return _=_.pendingLanes&-1073741825,_!==0?_:_&1073741824?1073741824:0}function Mh(_){for(var S=[],B=0;31>B;B++)S.push(_);return S}function ba(_,S,B){_.pendingLanes|=S,S!==536870912&&(_.suspendedLanes=0,_.pingedLanes=0),_=_.eventTimes,S=31-Ri(S),_[S]=B}function al(_,S){var B=_.pendingLanes&~S;_.pendingLanes=S,_.suspendedLanes=0,_.pingedLanes=0,_.expiredLanes&=S,_.mutableReadLanes&=S,_.entangledLanes&=S,S=_.entanglements;var N=_.eventTimes;for(_=_.expirationTimes;0<B;){var j=31-Ri(B),le=1<<j;S[j]=0,N[j]=-1,_[j]=-1,B&=~le}}function zs(_,S){var B=_.entangledLanes|=S;for(_=_.entanglements;B;){var N=31-Ri(B),j=1<<N;j&S|_[N]&S&&(_[N]|=S),B&=~j}}var Fn=0;function Ia(_){return _&=-_,1<_?4<_?(_&268435455)!==0?16:536870912:4:1}var na=r.unstable_scheduleCallback,Gl=r.unstable_cancelCallback,Ma=r.unstable_shouldYield,x0=r.unstable_requestPaint,hr=r.unstable_now,ll=r.unstable_ImmediatePriority,E0=r.unstable_UserBlockingPriority,lo=r.unstable_NormalPriority,Fu=r.unstable_IdlePriority,Ou=null,ia=null;function Tc(_){if(ia&&typeof ia.onCommitFiberRoot=="function")try{ia.onCommitFiberRoot(Ou,_,void 0,(_.current.flags&128)===128)}catch{}}function Nu(_,S){return _===S&&(_!==0||1/_===1/S)||_!==_&&S!==S}var _s=typeof Object.is=="function"?Object.is:Nu,Ss=null,Hl=!1,Ra=!1;function Rh(_){Ss===null?Ss=[_]:Ss.push(_)}function Uu(_){Hl=!0,Rh(_)}function co(){if(!Ra&&Ss!==null){Ra=!0;var _=0,S=Fn;try{var B=Ss;for(Fn=1;_<B.length;_++){var N=B[_];do N=N(!0);while(N!==null)}Ss=null,Hl=!1}catch(j){throw Ss!==null&&(Ss=Ss.slice(_+1)),na(ll,co),j}finally{Fn=S,Ra=!1}}return null}var zu=a.ReactCurrentBatchConfig;function zo(_,S){if(_s(_,S))return!0;if(typeof _!="object"||_===null||typeof S!="object"||S===null)return!1;var B=Object.keys(_),N=Object.keys(S);if(B.length!==N.length)return!1;for(N=0;N<B.length;N++){var j=B[N];if(!Qt.call(S,j)||!_s(_[j],S[j]))return!1}return!0}function bc(_){switch(_.tag){case 5:return Ht(_.type);case 16:return Ht("Lazy");case 13:return Ht("Suspense");case 19:return Ht("SuspenseList");case 0:case 2:case 15:return _=Et(_.type,!1),_;case 11:return _=Et(_.type.render,!1),_;case 1:return _=Et(_.type,!0),_;default:return""}}function ws(_,S){if(_&&_.defaultProps){S=s({},S),_=_.defaultProps;for(var B in _)S[B]===void 0&&(S[B]=_[B]);return S}return S}var cs=vn(null),Ic=null,Go=null,Mc=null;function Cs(){Mc=Go=Ic=null}function Rc(_,S,B){xe?(Bt(cs,S._currentValue),S._currentValue=B):(Bt(cs,S._currentValue2),S._currentValue2=B)}function Yr(_){var S=cs.current;Dt(cs),xe?_._currentValue=S:_._currentValue2=S}function us(_,S,B){for(;_!==null;){var N=_.alternate;if((_.childLanes&S)!==S?(_.childLanes|=S,N!==null&&(N.childLanes|=S)):N!==null&&(N.childLanes&S)!==S&&(N.childLanes|=S),_===B)break;_=_.return}}function Ur(_,S){Ic=_,Mc=Go=null,_=_.dependencies,_!==null&&_.firstContext!==null&&((_.lanes&S)!==0&&(Ms=!0),_.firstContext=null)}function xr(_){var S=xe?_._currentValue:_._currentValue2;if(Mc!==_)if(_={context:_,memoizedValue:S,next:null},Go===null){if(Ic===null)throw Error(o(308));Go=_,Ic.dependencies={lanes:0,firstContext:_}}else Go=Go.next=_;return S}var So=null,La=!1;function Wf(_){_.updateQueue={baseState:_.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function OA(_,S){_=_.updateQueue,S.updateQueue===_&&(S.updateQueue={baseState:_.baseState,firstBaseUpdate:_.firstBaseUpdate,lastBaseUpdate:_.lastBaseUpdate,shared:_.shared,effects:_.effects})}function Lc(_,S){return{eventTime:_,lane:S,tag:0,payload:null,callback:null,next:null}}function Gu(_,S){var B=_.updateQueue;B!==null&&(B=B.shared,Gr!==null&&(_.mode&1)!==0&&(Jn&2)===0?(_=B.interleaved,_===null?(S.next=S,So===null?So=[B]:So.push(B)):(S.next=_.next,_.next=S),B.interleaved=S):(_=B.pending,_===null?S.next=S:(S.next=_.next,_.next=S),B.pending=S))}function _0(_,S,B){if(S=S.updateQueue,S!==null&&(S=S.shared,(B&4194240)!==0)){var N=S.lanes;N&=_.pendingLanes,B|=N,S.lanes=B,zs(_,B)}}function S0(_,S){var B=_.updateQueue,N=_.alternate;if(N!==null&&(N=N.updateQueue,B===N)){var j=null,le=null;if(B=B.firstBaseUpdate,B!==null){do{var Se={eventTime:B.eventTime,lane:B.lane,tag:B.tag,payload:B.payload,callback:B.callback,next:null};le===null?j=le=Se:le=le.next=Se,B=B.next}while(B!==null);le===null?j=le=S:le=le.next=S}else j=le=S;B={baseState:N.baseState,firstBaseUpdate:j,lastBaseUpdate:le,shared:N.shared,effects:N.effects},_.updateQueue=B;return}_=B.lastBaseUpdate,_===null?B.firstBaseUpdate=S:_.next=S,B.lastBaseUpdate=S}function w0(_,S,B,N){var j=_.updateQueue;La=!1;var le=j.firstBaseUpdate,Se=j.lastBaseUpdate,Ge=j.shared.pending;if(Ge!==null){j.shared.pending=null;var ht=Ge,Rt=ht.next;ht.next=null,Se===null?le=Rt:Se.next=Rt,Se=ht;var Jt=_.alternate;Jt!==null&&(Jt=Jt.updateQueue,Ge=Jt.lastBaseUpdate,Ge!==Se&&(Ge===null?Jt.firstBaseUpdate=Rt:Ge.next=Rt,Jt.lastBaseUpdate=ht))}if(le!==null){var Hn=j.baseState;Se=0,Jt=Rt=ht=null,Ge=le;do{var wn=Ge.lane,Zn=Ge.eventTime;if((N&wn)===wn){Jt!==null&&(Jt=Jt.next={eventTime:Zn,lane:0,tag:Ge.tag,payload:Ge.payload,callback:Ge.callback,next:null});e:{var jt=_,js=Ge;switch(wn=S,Zn=B,js.tag){case 1:if(jt=js.payload,typeof jt=="function"){Hn=jt.call(Zn,Hn,wn);break e}Hn=jt;break e;case 3:jt.flags=jt.flags&-65537|128;case 0:if(jt=js.payload,wn=typeof jt=="function"?jt.call(Zn,Hn,wn):jt,wn==null)break e;Hn=s({},Hn,wn);break e;case 2:La=!0}}Ge.callback!==null&&Ge.lane!==0&&(_.flags|=64,wn=j.effects,wn===null?j.effects=[Ge]:wn.push(Ge))}else Zn={eventTime:Zn,lane:wn,tag:Ge.tag,payload:Ge.payload,callback:Ge.callback,next:null},Jt===null?(Rt=Jt=Zn,ht=Hn):Jt=Jt.next=Zn,Se|=wn;if(Ge=Ge.next,Ge===null){if(Ge=j.shared.pending,Ge===null)break;wn=Ge,Ge=wn.next,wn.next=null,j.lastBaseUpdate=wn,j.shared.pending=null}}while(!0);if(Jt===null&&(ht=Hn),j.baseState=ht,j.firstBaseUpdate=Rt,j.lastBaseUpdate=Jt,S=j.shared.interleaved,S!==null){j=S;do Se|=j.lane,j=j.next;while(j!==S)}else le===null&&(j.shared.lanes=0);jl|=Se,_.lanes=Se,_.memoizedState=Hn}}function Px(_,S,B){if(_=S.effects,S.effects=null,_!==null)for(S=0;S<_.length;S++){var N=_[S],j=N.callback;if(j!==null){if(N.callback=null,N=B,typeof j!="function")throw Error(o(191,j));j.call(N)}}}var Bx=new n.Component().refs;function NA(_,S,B,N){S=_.memoizedState,B=B(N,S),B=B==null?S:s({},S,B),_.memoizedState=B,_.lanes===0&&(_.updateQueue.baseState=B)}var C0={isMounted:function(_){return(_=_._reactInternals)?R(_)===_:!1},enqueueSetState:function(_,S,B){_=_._reactInternals;var N=yi(),j=ml(_),le=Lc(N,j);le.payload=S,B!=null&&(le.callback=B),Gu(_,le),S=fo(_,j,N),S!==null&&_0(S,_,j)},enqueueReplaceState:function(_,S,B){_=_._reactInternals;var N=yi(),j=ml(_),le=Lc(N,j);le.tag=1,le.payload=S,B!=null&&(le.callback=B),Gu(_,le),S=fo(_,j,N),S!==null&&_0(S,_,j)},enqueueForceUpdate:function(_,S){_=_._reactInternals;var B=yi(),N=ml(_),j=Lc(B,N);j.tag=2,S!=null&&(j.callback=S),Gu(_,j),S=fo(_,N,B),S!==null&&_0(S,_,N)}};function UA(_,S,B,N,j,le,Se){return _=_.stateNode,typeof _.shouldComponentUpdate=="function"?_.shouldComponentUpdate(N,le,Se):S.prototype&&S.prototype.isPureReactComponent?!zo(B,N)||!zo(j,le):!0}function Dx(_,S,B){var N=!1,j=yn,le=S.contextType;return typeof le=="object"&&le!==null?le=xr(le):(j=Ei(S)?Ai:xn.current,N=S.contextTypes,le=(N=N!=null)?xi(_,j):yn),S=new S(B,le),_.memoizedState=S.state!==null&&S.state!==void 0?S.state:null,S.updater=C0,_.stateNode=S,S._reactInternals=_,N&&(_=_.stateNode,_.__reactInternalMemoizedUnmaskedChildContext=j,_.__reactInternalMemoizedMaskedChildContext=le),S}function kx(_,S,B,N){_=S.state,typeof S.componentWillReceiveProps=="function"&&S.componentWillReceiveProps(B,N),typeof S.UNSAFE_componentWillReceiveProps=="function"&&S.UNSAFE_componentWillReceiveProps(B,N),S.state!==_&&C0.enqueueReplaceState(S,S.state,null)}function zA(_,S,B,N){var j=_.stateNode;j.props=B,j.state=_.memoizedState,j.refs=Bx,Wf(_);var le=S.contextType;typeof le=="object"&&le!==null?j.context=xr(le):(le=Ei(S)?Ai:xn.current,j.context=xi(_,le)),j.state=_.memoizedState,le=S.getDerivedStateFromProps,typeof le=="function"&&(NA(_,S,le,B),j.state=_.memoizedState),typeof S.getDerivedStateFromProps=="function"||typeof j.getSnapshotBeforeUpdate=="function"||typeof j.UNSAFE_componentWillMount!="function"&&typeof j.componentWillMount!="function"||(S=j.state,typeof j.componentWillMount=="function"&&j.componentWillMount(),typeof j.UNSAFE_componentWillMount=="function"&&j.UNSAFE_componentWillMount(),S!==j.state&&C0.enqueueReplaceState(j,j.state,null),w0(_,B,j,N),j.state=_.memoizedState),typeof j.componentDidMount=="function"&&(_.flags|=4194308)}var jf=[],Hu=0,T0=null,b0=0,Pa=[],ra=0,Lh=null,Pc=1,Bc="";function Ph(_,S){jf[Hu++]=b0,jf[Hu++]=T0,T0=_,b0=S}function Fx(_,S,B){Pa[ra++]=Pc,Pa[ra++]=Bc,Pa[ra++]=Lh,Lh=_;var N=Pc;_=Bc;var j=32-Ri(N)-1;N&=~(1<<j),B+=1;var le=32-Ri(S)+j;if(30<le){var Se=j-j%5;le=(N&(1<<Se)-1).toString(32),N>>=Se,j-=Se,Pc=1<<32-Ri(S)+j|B<<j|N,Bc=le+_}else Pc=1<<le|B<<j|N,Bc=_}function GA(_){_.return!==null&&(Ph(_,1),Fx(_,1,0))}function HA(_){for(;_===T0;)T0=jf[--Hu],jf[Hu]=null,b0=jf[--Hu],jf[Hu]=null;for(;_===Lh;)Lh=Pa[--ra],Pa[ra]=null,Bc=Pa[--ra],Pa[ra]=null,Pc=Pa[--ra],Pa[ra]=null}var wo=null,Gs=null,fr=!1,Kf=!1,Ba=null;function QA(_,S){var B=ha(5,null,null,0);B.elementType="DELETED",B.stateNode=S,B.return=_,S=_.deletions,S===null?(_.deletions=[B],_.flags|=16):S.push(B)}function VA(_,S){switch(_.tag){case 5:return S=pn(S,_.type,_.pendingProps),S!==null?(_.stateNode=S,wo=_,Gs=An(S),!0):!1;case 6:return S=qn(S,_.pendingProps),S!==null?(_.stateNode=S,wo=_,Gs=null,!0):!1;case 13:if(S=Ci(S),S!==null){var B=Lh!==null?{id:Pc,overflow:Bc}:null;return _.memoizedState={dehydrated:S,treeContext:B,retryLane:1073741824},B=ha(18,null,null,0),B.stateNode=S,B.return=_,_.child=B,wo=_,Gs=null,!0}return!1;default:return!1}}function I0(_){return(_.mode&1)!==0&&(_.flags&128)===0}function Qu(_){if(fr){var S=Gs;if(S){var B=S;if(!VA(_,S)){if(I0(_))throw Error(o(418));S=tr(B);var N=wo;S&&VA(_,S)?QA(N,B):(_.flags=_.flags&-4097|2,fr=!1,wo=_)}}else{if(I0(_))throw Error(o(418));_.flags=_.flags&-4097|2,fr=!1,wo=_}}}function Ox(_){for(_=_.return;_!==null&&_.tag!==5&&_.tag!==3&&_.tag!==13;)_=_.return;wo=_}function Sp(_){if(!we||_!==wo)return!1;if(!fr)return Ox(_),fr=!0,!1;if(_.tag!==3&&(_.tag!==5||Je(_.type)&&!J(_.type,_.memoizedProps))){var S=Gs;if(S){if(I0(_)){for(_=Gs;_;)_=tr(_);throw Error(o(418))}for(;S;)QA(_,S),S=tr(S)}}if(Ox(_),_.tag===13){if(!we)throw Error(o(316));if(_=_.memoizedState,_=_!==null?_.dehydrated:null,!_)throw Error(o(317));Gs=ue(_)}else Gs=wo?tr(_.stateNode):null;return!0}function $f(){we&&(Gs=wo=null,Kf=fr=!1)}function M0(_){Ba===null?Ba=[_]:Ba.push(_)}function Yf(_,S,B){if(_=B.ref,_!==null&&typeof _!="function"&&typeof _!="object"){if(B._owner){if(B=B._owner,B){if(B.tag!==1)throw Error(o(309));var N=B.stateNode}if(!N)throw Error(o(147,_));var j=N,le=""+_;return S!==null&&S.ref!==null&&typeof S.ref=="function"&&S.ref._stringRef===le?S.ref:(S=function(Se){var Ge=j.refs;Ge===Bx&&(Ge=j.refs={}),Se===null?delete Ge[le]:Ge[le]=Se},S._stringRef=le,S)}if(typeof _!="string")throw Error(o(284));if(!B._owner)throw Error(o(290,_))}return _}function Vu(_,S){throw _=Object.prototype.toString.call(S),Error(o(31,_==="[object Object]"?"object with keys {"+Object.keys(S).join(", ")+"}":_))}function Xf(_){var S=_._init;return S(_._payload)}function Nx(_){function S(et,Qe){if(_){var at=et.deletions;at===null?(et.deletions=[Qe],et.flags|=16):at.push(Qe)}}function B(et,Qe){if(!_)return null;for(;Qe!==null;)S(et,Qe),Qe=Qe.sibling;return null}function N(et,Qe){for(et=new Map;Qe!==null;)Qe.key!==null?et.set(Qe.key,Qe):et.set(Qe.index,Qe),Qe=Qe.sibling;return et}function j(et,Qe){return et=Kc(et,Qe),et.index=0,et.sibling=null,et}function le(et,Qe,at){return et.index=at,_?(at=et.alternate,at!==null?(at=at.index,at<Qe?(et.flags|=2,Qe):at):(et.flags|=2,Qe)):(et.flags|=1048576,Qe)}function Se(et){return _&&et.alternate===null&&(et.flags|=2),et}function Ge(et,Qe,at,Vt){return Qe===null||Qe.tag!==6?(Qe=ng(at,et.mode,Vt),Qe.return=et,Qe):(Qe=j(Qe,at),Qe.return=et,Qe)}function ht(et,Qe,at,Vt){var on=at.type;return on===u?Jt(et,Qe,at.props.children,Vt,at.key):Qe!==null&&(Qe.elementType===on||typeof on=="object"&&on!==null&&on.$$typeof===x&&Xf(on)===Qe.type)?(Vt=j(Qe,at.props),Vt.ref=Yf(et,Qe,at),Vt.return=et,Vt):(Vt=tg(at.type,at.key,at.props,null,et.mode,Vt),Vt.ref=Yf(et,Qe,at),Vt.return=et,Vt)}function Rt(et,Qe,at,Vt){return Qe===null||Qe.tag!==4||Qe.stateNode.containerInfo!==at.containerInfo||Qe.stateNode.implementation!==at.implementation?(Qe=ig(at,et.mode,Vt),Qe.return=et,Qe):(Qe=j(Qe,at.children||[]),Qe.return=et,Qe)}function Jt(et,Qe,at,Vt,on){return Qe===null||Qe.tag!==7?(Qe=ef(at,et.mode,Vt,on),Qe.return=et,Qe):(Qe=j(Qe,at),Qe.return=et,Qe)}function Hn(et,Qe,at){if(typeof Qe=="string"&&Qe!==""||typeof Qe=="number")return Qe=ng(""+Qe,et.mode,at),Qe.return=et,Qe;if(typeof Qe=="object"&&Qe!==null){switch(Qe.$$typeof){case l:return at=tg(Qe.type,Qe.key,Qe.props,null,et.mode,at),at.ref=Yf(et,null,Qe),at.return=et,at;case c:return Qe=ig(Qe,et.mode,at),Qe.return=et,Qe;case x:var Vt=Qe._init;return Hn(et,Vt(Qe._payload),at)}if(W(Qe)||I(Qe))return Qe=ef(Qe,et.mode,at,null),Qe.return=et,Qe;Vu(et,Qe)}return null}function wn(et,Qe,at,Vt){var on=Qe!==null?Qe.key:null;if(typeof at=="string"&&at!==""||typeof at=="number")return on!==null?null:Ge(et,Qe,""+at,Vt);if(typeof at=="object"&&at!==null){switch(at.$$typeof){case l:return at.key===on?ht(et,Qe,at,Vt):null;case c:return at.key===on?Rt(et,Qe,at,Vt):null;case x:return on=at._init,wn(et,Qe,on(at._payload),Vt)}if(W(at)||I(at))return on!==null?null:Jt(et,Qe,at,Vt,null);Vu(et,at)}return null}function Zn(et,Qe,at,Vt,on){if(typeof Vt=="string"&&Vt!==""||typeof Vt=="number")return et=et.get(at)||null,Ge(Qe,et,""+Vt,on);if(typeof Vt=="object"&&Vt!==null){switch(Vt.$$typeof){case l:return et=et.get(Vt.key===null?at:Vt.key)||null,ht(Qe,et,Vt,on);case c:return et=et.get(Vt.key===null?at:Vt.key)||null,Rt(Qe,et,Vt,on);case x:var Kn=Vt._init;return Zn(et,Qe,at,Kn(Vt._payload),on)}if(W(Vt)||I(Vt))return et=et.get(at)||null,Jt(Qe,et,Vt,on,null);Vu(Qe,Vt)}return null}function jt(et,Qe,at,Vt){for(var on=null,Kn=null,Qn=Qe,pi=Qe=0,qr=null;Qn!==null&&pi<at.length;pi++){Qn.index>pi?(qr=Qn,Qn=null):qr=Qn.sibling;var hi=wn(et,Qn,at[pi],Vt);if(hi===null){Qn===null&&(Qn=qr);break}_&&Qn&&hi.alternate===null&&S(et,Qn),Qe=le(hi,Qe,pi),Kn===null?on=hi:Kn.sibling=hi,Kn=hi,Qn=qr}if(pi===at.length)return B(et,Qn),fr&&Ph(et,pi),on;if(Qn===null){for(;pi<at.length;pi++)Qn=Hn(et,at[pi],Vt),Qn!==null&&(Qe=le(Qn,Qe,pi),Kn===null?on=Qn:Kn.sibling=Qn,Kn=Qn);return fr&&Ph(et,pi),on}for(Qn=N(et,Qn);pi<at.length;pi++)qr=Zn(Qn,et,pi,at[pi],Vt),qr!==null&&(_&&qr.alternate!==null&&Qn.delete(qr.key===null?pi:qr.key),Qe=le(qr,Qe,pi),Kn===null?on=qr:Kn.sibling=qr,Kn=qr);return _&&Qn.forEach(function($c){return S(et,$c)}),fr&&Ph(et,pi),on}function js(et,Qe,at,Vt){var on=I(at);if(typeof on!="function")throw Error(o(150));if(at=on.call(at),at==null)throw Error(o(151));for(var Kn=on=null,Qn=Qe,pi=Qe=0,qr=null,hi=at.next();Qn!==null&&!hi.done;pi++,hi=at.next()){Qn.index>pi?(qr=Qn,Qn=null):qr=Qn.sibling;var $c=wn(et,Qn,hi.value,Vt);if($c===null){Qn===null&&(Qn=qr);break}_&&Qn&&$c.alternate===null&&S(et,Qn),Qe=le($c,Qe,pi),Kn===null?on=$c:Kn.sibling=$c,Kn=$c,Qn=qr}if(hi.done)return B(et,Qn),fr&&Ph(et,pi),on;if(Qn===null){for(;!hi.done;pi++,hi=at.next())hi=Hn(et,hi.value,Vt),hi!==null&&(Qe=le(hi,Qe,pi),Kn===null?on=hi:Kn.sibling=hi,Kn=hi);return fr&&Ph(et,pi),on}for(Qn=N(et,Qn);!hi.done;pi++,hi=at.next())hi=Zn(Qn,et,pi,hi.value,Vt),hi!==null&&(_&&hi.alternate!==null&&Qn.delete(hi.key===null?pi:hi.key),Qe=le(hi,Qe,pi),Kn===null?on=hi:Kn.sibling=hi,Kn=hi);return _&&Qn.forEach(function(Ey){return S(et,Ey)}),fr&&Ph(et,pi),on}function fa(et,Qe,at,Vt){if(typeof at=="object"&&at!==null&&at.type===u&&at.key===null&&(at=at.props.children),typeof at=="object"&&at!==null){switch(at.$$typeof){case l:e:{for(var on=at.key,Kn=Qe;Kn!==null;){if(Kn.key===on){if(on=at.type,on===u){if(Kn.tag===7){B(et,Kn.sibling),Qe=j(Kn,at.props.children),Qe.return=et,et=Qe;break e}}else if(Kn.elementType===on||typeof on=="object"&&on!==null&&on.$$typeof===x&&Xf(on)===Kn.type){B(et,Kn.sibling),Qe=j(Kn,at.props),Qe.ref=Yf(et,Kn,at),Qe.return=et,et=Qe;break e}B(et,Kn);break}else S(et,Kn);Kn=Kn.sibling}at.type===u?(Qe=ef(at.props.children,et.mode,Vt,at.key),Qe.return=et,et=Qe):(Vt=tg(at.type,at.key,at.props,null,et.mode,Vt),Vt.ref=Yf(et,Qe,at),Vt.return=et,et=Vt)}return Se(et);case c:e:{for(Kn=at.key;Qe!==null;){if(Qe.key===Kn)if(Qe.tag===4&&Qe.stateNode.containerInfo===at.containerInfo&&Qe.stateNode.implementation===at.implementation){B(et,Qe.sibling),Qe=j(Qe,at.children||[]),Qe.return=et,et=Qe;break e}else{B(et,Qe);break}else S(et,Qe);Qe=Qe.sibling}Qe=ig(at,et.mode,Vt),Qe.return=et,et=Qe}return Se(et);case x:return Kn=at._init,fa(et,Qe,Kn(at._payload),Vt)}if(W(at))return jt(et,Qe,at,Vt);if(I(at))return js(et,Qe,at,Vt);Vu(et,at)}return typeof at=="string"&&at!==""||typeof at=="number"?(at=""+at,Qe!==null&&Qe.tag===6?(B(et,Qe.sibling),Qe=j(Qe,at),Qe.return=et,et=Qe):(B(et,Qe),Qe=ng(at,et.mode,Vt),Qe.return=et,et=Qe),Se(et)):B(et,Qe)}return fa}var Dc=Nx(!0),Ux=Nx(!1),qf={},Ho=vn(qf),Bh=vn(qf),Dh=vn(qf);function cl(_){if(_===qf)throw Error(o(174));return _}function R0(_,S){Bt(Dh,S),Bt(Bh,_),Bt(Ho,qf),_=oe(S),Dt(Ho),Bt(Ho,_)}function Jf(){Dt(Ho),Dt(Bh),Dt(Dh)}function zx(_){var S=cl(Dh.current),B=cl(Ho.current);S=X(B,_.type,S),B!==S&&(Bt(Bh,_),Bt(Ho,S))}function WA(_){Bh.current===_&&(Dt(Ho),Dt(Bh))}var Er=vn(0);function L0(_){for(var S=_;S!==null;){if(S.tag===13){var B=S.memoizedState;if(B!==null&&(B=B.dehydrated,B===null||as(B)||Nr(B)))return S}else if(S.tag===19&&S.memoizedProps.revealOrder!==void 0){if((S.flags&128)!==0)return S}else if(S.child!==null){S.child.return=S,S=S.child;continue}if(S===_)break;for(;S.sibling===null;){if(S.return===null||S.return===_)return null;S=S.return}S.sibling.return=S.return,S=S.sibling}return null}var sa=[];function kh(){for(var _=0;_<sa.length;_++){var S=sa[_];xe?S._workInProgressVersionPrimary=null:S._workInProgressVersionSecondary=null}sa.length=0}var wp=a.ReactCurrentDispatcher,oa=a.ReactCurrentBatchConfig,Fh=0,_r=null,Ts=null,bs=null,P0=!1,Ql=!1,Oh=0,Cp=0;function Is(){throw Error(o(321))}function B0(_,S){if(S===null)return!1;for(var B=0;B<S.length&&B<_.length;B++)if(!_s(_[B],S[B]))return!1;return!0}function Zf(_,S,B,N,j,le){if(Fh=le,_r=S,S.memoizedState=null,S.updateQueue=null,S.lanes=0,wp.current=_===null||_.memoizedState===null?qA:JA,_=B(N,j),Ql){le=0;do{if(Ql=!1,Oh=0,25<=le)throw Error(o(301));le+=1,bs=Ts=null,S.updateQueue=null,wp.current=ZA,_=B(N,j)}while(Ql)}if(wp.current=id,S=Ts!==null&&Ts.next!==null,Fh=0,bs=Ts=_r=null,P0=!1,S)throw Error(o(300));return _}function Wu(){var _=Oh!==0;return Oh=0,_}function ul(){var _={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return bs===null?_r.memoizedState=bs=_:bs=bs.next=_,bs}function hl(){if(Ts===null){var _=_r.alternate;_=_!==null?_.memoizedState:null}else _=Ts.next;var S=bs===null?_r.memoizedState:bs.next;if(S!==null)bs=S,Ts=_;else{if(_===null)throw Error(o(310));Ts=_,_={memoizedState:Ts.memoizedState,baseState:Ts.baseState,baseQueue:Ts.baseQueue,queue:Ts.queue,next:null},bs===null?_r.memoizedState=bs=_:bs=bs.next=_}return bs}function Vl(_,S){return typeof S=="function"?S(_):S}function Tp(_){var S=hl(),B=S.queue;if(B===null)throw Error(o(311));B.lastRenderedReducer=_;var N=Ts,j=N.baseQueue,le=B.pending;if(le!==null){if(j!==null){var Se=j.next;j.next=le.next,le.next=Se}N.baseQueue=j=le,B.pending=null}if(j!==null){le=j.next,N=N.baseState;var Ge=Se=null,ht=null,Rt=le;do{var Jt=Rt.lane;if((Fh&Jt)===Jt)ht!==null&&(ht=ht.next={lane:0,action:Rt.action,hasEagerState:Rt.hasEagerState,eagerState:Rt.eagerState,next:null}),N=Rt.hasEagerState?Rt.eagerState:_(N,Rt.action);else{var Hn={lane:Jt,action:Rt.action,hasEagerState:Rt.hasEagerState,eagerState:Rt.eagerState,next:null};ht===null?(Ge=ht=Hn,Se=N):ht=ht.next=Hn,_r.lanes|=Jt,jl|=Jt}Rt=Rt.next}while(Rt!==null&&Rt!==le);ht===null?Se=N:ht.next=Ge,_s(N,S.memoizedState)||(Ms=!0),S.memoizedState=N,S.baseState=Se,S.baseQueue=ht,B.lastRenderedState=N}if(_=B.interleaved,_!==null){j=_;do le=j.lane,_r.lanes|=le,jl|=le,j=j.next;while(j!==_)}else j===null&&(B.lanes=0);return[S.memoizedState,B.dispatch]}function bp(_){var S=hl(),B=S.queue;if(B===null)throw Error(o(311));B.lastRenderedReducer=_;var N=B.dispatch,j=B.pending,le=S.memoizedState;if(j!==null){B.pending=null;var Se=j=j.next;do le=_(le,Se.action),Se=Se.next;while(Se!==j);_s(le,S.memoizedState)||(Ms=!0),S.memoizedState=le,S.baseQueue===null&&(S.baseState=le),B.lastRenderedState=le}return[le,N]}function jA(){}function KA(_,S){var B=_r,N=hl(),j=S(),le=!_s(N.memoizedState,j);if(le&&(N.memoizedState=j,Ms=!0),N=N.queue,ed(kc.bind(null,B,N,_),[_]),N.getSnapshot!==S||le||bs!==null&&bs.memoizedState.tag&1){if(B.flags|=2048,Mp(9,YA.bind(null,B,N,j,S),void 0,null),Gr===null)throw Error(o(349));(Fh&30)!==0||$A(B,S,j)}return j}function $A(_,S,B){_.flags|=16384,_={getSnapshot:S,value:B},S=_r.updateQueue,S===null?(S={lastEffect:null,stores:null},_r.updateQueue=S,S.stores=[_]):(B=S.stores,B===null?S.stores=[_]:B.push(_))}function YA(_,S,B,N){S.value=B,S.getSnapshot=N,D0(S)&&fo(_,1,-1)}function kc(_,S,B){return B(function(){D0(S)&&fo(_,1,-1)})}function D0(_){var S=_.getSnapshot;_=_.value;try{var B=S();return!_s(_,B)}catch{return!0}}function Ip(_){var S=ul();return typeof _=="function"&&(_=_()),S.memoizedState=S.baseState=_,_={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Vl,lastRenderedState:_},S.queue=_,_=_.dispatch=sC.bind(null,_r,_),[S.memoizedState,_]}function Mp(_,S,B,N){return _={tag:_,create:S,destroy:B,deps:N,next:null},S=_r.updateQueue,S===null?(S={lastEffect:null,stores:null},_r.updateQueue=S,S.lastEffect=_.next=_):(B=S.lastEffect,B===null?S.lastEffect=_.next=_:(N=B.next,B.next=_,_.next=N,S.lastEffect=_)),_}function Gx(){return hl().memoizedState}function ju(_,S,B,N){var j=ul();_r.flags|=_,j.memoizedState=Mp(1|S,B,void 0,N===void 0?null:N)}function k0(_,S,B,N){var j=hl();N=N===void 0?null:N;var le=void 0;if(Ts!==null){var Se=Ts.memoizedState;if(le=Se.destroy,N!==null&&B0(N,Se.deps)){j.memoizedState=Mp(S,B,le,N);return}}_r.flags|=_,j.memoizedState=Mp(1|S,B,le,N)}function F0(_,S){return ju(8390656,8,_,S)}function ed(_,S){return k0(2048,8,_,S)}function $i(_,S){return k0(4,2,_,S)}function O0(_,S){return k0(4,4,_,S)}function Rp(_,S){if(typeof S=="function")return _=_(),S(_),function(){S(null)};if(S!=null)return _=_(),S.current=_,function(){S.current=null}}function td(_,S,B){return B=B!=null?B.concat([_]):null,k0(4,4,Rp.bind(null,S,_),B)}function N0(){}function U0(_,S){var B=hl();S=S===void 0?null:S;var N=B.memoizedState;return N!==null&&S!==null&&B0(S,N[1])?N[0]:(B.memoizedState=[_,S],_)}function nd(_,S){var B=hl();S=S===void 0?null:S;var N=B.memoizedState;return N!==null&&S!==null&&B0(S,N[1])?N[0]:(_=_(),B.memoizedState=[_,S],_)}function z0(_,S){var B=Fn;Fn=B!==0&&4>B?B:4,_(!0);var N=oa.transition;oa.transition={};try{_(!1),S()}finally{Fn=B,oa.transition=N}}function Nh(){return hl().memoizedState}function Hx(_,S,B){var N=ml(_);B={lane:N,action:B,hasEagerState:!1,eagerState:null,next:null},Qx(_)?XA(S,B):(Lp(_,S,B),B=yi(),_=fo(_,N,B),_!==null&&Pp(_,S,N))}function sC(_,S,B){var N=ml(_),j={lane:N,action:B,hasEagerState:!1,eagerState:null,next:null};if(Qx(_))XA(S,j);else{Lp(_,S,j);var le=_.alternate;if(_.lanes===0&&(le===null||le.lanes===0)&&(le=S.lastRenderedReducer,le!==null))try{var Se=S.lastRenderedState,Ge=le(Se,B);if(j.hasEagerState=!0,j.eagerState=Ge,_s(Ge,Se))return}catch{}finally{}B=yi(),_=fo(_,N,B),_!==null&&Pp(_,S,N)}}function Qx(_){var S=_.alternate;return _===_r||S!==null&&S===_r}function XA(_,S){Ql=P0=!0;var B=_.pending;B===null?S.next=S:(S.next=B.next,B.next=S),_.pending=S}function Lp(_,S,B){Gr!==null&&(_.mode&1)!==0&&(Jn&2)===0?(_=S.interleaved,_===null?(B.next=B,So===null?So=[S]:So.push(S)):(B.next=_.next,_.next=B),S.interleaved=B):(_=S.pending,_===null?B.next=B:(B.next=_.next,_.next=B),S.pending=B)}function Pp(_,S,B){if((B&4194240)!==0){var N=S.lanes;N&=_.pendingLanes,B|=N,S.lanes=B,zs(_,B)}}var id={readContext:xr,useCallback:Is,useContext:Is,useEffect:Is,useImperativeHandle:Is,useInsertionEffect:Is,useLayoutEffect:Is,useMemo:Is,useReducer:Is,useRef:Is,useState:Is,useDebugValue:Is,useDeferredValue:Is,useTransition:Is,useMutableSource:Is,useSyncExternalStore:Is,useId:Is,unstable_isNewReconciler:!1},qA={readContext:xr,useCallback:function(_,S){return ul().memoizedState=[_,S===void 0?null:S],_},useContext:xr,useEffect:F0,useImperativeHandle:function(_,S,B){return B=B!=null?B.concat([_]):null,ju(4194308,4,Rp.bind(null,S,_),B)},useLayoutEffect:function(_,S){return ju(4194308,4,_,S)},useInsertionEffect:function(_,S){return ju(4,2,_,S)},useMemo:function(_,S){var B=ul();return S=S===void 0?null:S,_=_(),B.memoizedState=[_,S],_},useReducer:function(_,S,B){var N=ul();return S=B!==void 0?B(S):S,N.memoizedState=N.baseState=S,_={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:_,lastRenderedState:S},N.queue=_,_=_.dispatch=Hx.bind(null,_r,_),[N.memoizedState,_]},useRef:function(_){var S=ul();return _={current:_},S.memoizedState=_},useState:Ip,useDebugValue:N0,useDeferredValue:function(_){var S=Ip(_),B=S[0],N=S[1];return F0(function(){var j=oa.transition;oa.transition={};try{N(_)}finally{oa.transition=j}},[_]),B},useTransition:function(){var _=Ip(!1),S=_[0];return _=z0.bind(null,_[1]),ul().memoizedState=_,[S,_]},useMutableSource:function(){},useSyncExternalStore:function(_,S,B){var N=_r,j=ul();if(fr){if(B===void 0)throw Error(o(407));B=B()}else{if(B=S(),Gr===null)throw Error(o(349));(Fh&30)!==0||$A(N,S,B)}j.memoizedState=B;var le={value:B,getSnapshot:S};return j.queue=le,F0(kc.bind(null,N,le,_),[_]),N.flags|=2048,Mp(9,YA.bind(null,N,le,B,S),void 0,null),B},useId:function(){var _=ul(),S=Gr.identifierPrefix;if(fr){var B=Bc,N=Pc;B=(N&~(1<<32-Ri(N)-1)).toString(32)+B,S=":"+S+"R"+B,B=Oh++,0<B&&(S+="H"+B.toString(32)),S+=":"}else B=Cp++,S=":"+S+"r"+B.toString(32)+":";return _.memoizedState=S},unstable_isNewReconciler:!1},JA={readContext:xr,useCallback:U0,useContext:xr,useEffect:ed,useImperativeHandle:td,useInsertionEffect:$i,useLayoutEffect:O0,useMemo:nd,useReducer:Tp,useRef:Gx,useState:function(){return Tp(Vl)},useDebugValue:N0,useDeferredValue:function(_){var S=Tp(Vl),B=S[0],N=S[1];return ed(function(){var j=oa.transition;oa.transition={};try{N(_)}finally{oa.transition=j}},[_]),B},useTransition:function(){var _=Tp(Vl)[0],S=hl().memoizedState;return[_,S]},useMutableSource:jA,useSyncExternalStore:KA,useId:Nh,unstable_isNewReconciler:!1},ZA={readContext:xr,useCallback:U0,useContext:xr,useEffect:ed,useImperativeHandle:td,useInsertionEffect:$i,useLayoutEffect:O0,useMemo:nd,useReducer:bp,useRef:Gx,useState:function(){return bp(Vl)},useDebugValue:N0,useDeferredValue:function(_){var S=bp(Vl),B=S[0],N=S[1];return ed(function(){var j=oa.transition;oa.transition={};try{N(_)}finally{oa.transition=j}},[_]),B},useTransition:function(){var _=bp(Vl)[0],S=hl().memoizedState;return[_,S]},useMutableSource:jA,useSyncExternalStore:KA,useId:Nh,unstable_isNewReconciler:!1};function ey(_,S){try{var B="",N=S;do B+=bc(N),N=N.return;while(N);var j=B}catch(le){j=`
Error generating stack: `+le.message+`
`+le.stack}return{value:_,source:S,stack:j}}function G0(_,S){try{console.error(S.value)}catch(B){setTimeout(function(){throw B})}}var oC=typeof WeakMap=="function"?WeakMap:Map;function Vx(_,S,B){B=Lc(-1,B),B.tag=3,B.payload={element:null};var N=S.value;return B.callback=function(){cd||(cd=!0,rr=N),G0(_,S)},B}function H0(_,S,B){B=Lc(-1,B),B.tag=3;var N=_.type.getDerivedStateFromError;if(typeof N=="function"){var j=S.value;B.payload=function(){return N(j)},B.callback=function(){G0(_,S)}}var le=_.stateNode;return le!==null&&typeof le.componentDidCatch=="function"&&(B.callback=function(){G0(_,S),typeof N!="function"&&(pl===null?pl=new Set([this]):pl.add(this));var Se=S.stack;this.componentDidCatch(S.value,{componentStack:Se!==null?Se:""})}),B}function Fc(_,S,B){var N=_.pingCache;if(N===null){N=_.pingCache=new oC;var j=new Set;N.set(S,j)}else j=N.get(S),j===void 0&&(j=new Set,N.set(S,j));j.has(B)||(j.add(B),_=yy.bind(null,_,S,B),S.then(_,_))}function ty(_){do{var S;if((S=_.tag===13)&&(S=_.memoizedState,S=S!==null?S.dehydrated!==null:!0),S)return _;_=_.return}while(_!==null);return null}function Uh(_,S,B,N,j){return(_.mode&1)===0?(_===S?_.flags|=65536:(_.flags|=128,B.flags|=131072,B.flags&=-52805,B.tag===1&&(B.alternate===null?B.tag=17:(S=Lc(-1,1),S.tag=2,Gu(B,S))),B.lanes|=1),_):(_.flags|=65536,_.lanes=j,_)}function hs(_){_.flags|=4}function rd(_,S){if(_!==null&&_.child===S.child)return!0;if((S.flags&16)!==0)return!1;for(_=S.child;_!==null;){if((_.flags&12854)!==0||(_.subtreeFlags&12854)!==0)return!1;_=_.sibling}return!0}var aa,zh,Q0,V0;if(pe)aa=function(_,S){for(var B=S.child;B!==null;){if(B.tag===5||B.tag===6)K(_,B.stateNode);else if(B.tag!==4&&B.child!==null){B.child.return=B,B=B.child;continue}if(B===S)break;for(;B.sibling===null;){if(B.return===null||B.return===S)return;B=B.return}B.sibling.return=B.return,B=B.sibling}},zh=function(){},Q0=function(_,S,B,N,j){if(_=_.memoizedProps,_!==N){var le=S.stateNode,Se=cl(Ho.current);B=q(le,B,_,N,j,Se),(S.updateQueue=B)&&hs(S)}},V0=function(_,S,B,N){B!==N&&hs(S)};else if(ce){aa=function(_,S,B,N){for(var j=S.child;j!==null;){if(j.tag===5){var le=j.stateNode;B&&N&&(le=dn(le,j.type,j.memoizedProps,j)),K(_,le)}else if(j.tag===6)le=j.stateNode,B&&N&&(le=Vn(le,j.memoizedProps,j)),K(_,le);else if(j.tag!==4){if(j.tag===22&&j.memoizedState!==null)le=j.child,le!==null&&(le.return=j),aa(_,j,!0,!0);else if(j.child!==null){j.child.return=j,j=j.child;continue}}if(j===S)break;for(;j.sibling===null;){if(j.return===null||j.return===S)return;j=j.return}j.sibling.return=j.return,j=j.sibling}};var Ku=function(_,S,B,N){for(var j=S.child;j!==null;){if(j.tag===5){var le=j.stateNode;B&&N&&(le=dn(le,j.type,j.memoizedProps,j)),Pt(_,le)}else if(j.tag===6)le=j.stateNode,B&&N&&(le=Vn(le,j.memoizedProps,j)),Pt(_,le);else if(j.tag!==4){if(j.tag===22&&j.memoizedState!==null)le=j.child,le!==null&&(le.return=j),Ku(_,j,!0,!0);else if(j.child!==null){j.child.return=j,j=j.child;continue}}if(j===S)break;for(;j.sibling===null;){if(j.return===null||j.return===S)return;j=j.return}j.sibling.return=j.return,j=j.sibling}};zh=function(_,S){var B=S.stateNode;if(!rd(_,S)){_=B.containerInfo;var N=bt(_);Ku(N,S,!1,!1),B.pendingChildren=N,hs(S),qt(_,N)}},Q0=function(_,S,B,N,j){var le=_.stateNode,Se=_.memoizedProps;if((_=rd(_,S))&&Se===N)S.stateNode=le;else{var Ge=S.stateNode,ht=cl(Ho.current),Rt=null;Se!==N&&(Rt=q(Ge,B,Se,N,j,ht)),_&&Rt===null?S.stateNode=le:(le=vt(le,Rt,B,Se,N,S,_,Ge),te(le,B,N,j,ht)&&hs(S),S.stateNode=le,_?hs(S):aa(le,S,!1,!1))}},V0=function(_,S,B,N){B!==N?(_=cl(Dh.current),B=cl(Ho.current),S.stateNode=ie(N,_,B,S),hs(S)):S.stateNode=_.stateNode}}else zh=function(){},Q0=function(){},V0=function(){};function Oc(_,S){if(!fr)switch(_.tailMode){case"hidden":S=_.tail;for(var B=null;S!==null;)S.alternate!==null&&(B=S),S=S.sibling;B===null?_.tail=null:B.sibling=null;break;case"collapsed":B=_.tail;for(var N=null;B!==null;)B.alternate!==null&&(N=B),B=B.sibling;N===null?S||_.tail===null?_.tail=null:_.tail.sibling=null:N.sibling=null}}function zr(_){var S=_.alternate!==null&&_.alternate.child===_.child,B=0,N=0;if(S)for(var j=_.child;j!==null;)B|=j.lanes|j.childLanes,N|=j.subtreeFlags&14680064,N|=j.flags&14680064,j.return=_,j=j.sibling;else for(j=_.child;j!==null;)B|=j.lanes|j.childLanes,N|=j.subtreeFlags,N|=j.flags,j.return=_,j=j.sibling;return _.subtreeFlags|=N,_.childLanes=B,S}function W0(_,S,B){var N=S.pendingProps;switch(HA(S),S.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return zr(S),null;case 1:return Ei(S.type)&&Dn(),zr(S),null;case 3:return N=S.stateNode,Jf(),Dt(Sn),Dt(xn),kh(),N.pendingContext&&(N.context=N.pendingContext,N.pendingContext=null),(_===null||_.child===null)&&(Sp(S)?hs(S):_===null||_.memoizedState.isDehydrated&&(S.flags&256)===0||(S.flags|=1024,Ba!==null&&(Wp(Ba),Ba=null))),zh(_,S),zr(S),null;case 5:WA(S),B=cl(Dh.current);var j=S.type;if(_!==null&&S.stateNode!=null)Q0(_,S,j,N,B),_.ref!==S.ref&&(S.flags|=512,S.flags|=2097152);else{if(!N){if(S.stateNode===null)throw Error(o(166));return zr(S),null}if(_=cl(Ho.current),Sp(S)){if(!we)throw Error(o(175));_=he(S.stateNode,S.type,S.memoizedProps,B,_,S,!Kf),S.updateQueue=_,_!==null&&hs(S)}else{var le=O(j,N,B,_,S);aa(le,S,!1,!1),S.stateNode=le,te(le,j,N,B,_)&&hs(S)}S.ref!==null&&(S.flags|=512,S.flags|=2097152)}return zr(S),null;case 6:if(_&&S.stateNode!=null)V0(_,S,_.memoizedProps,N);else{if(typeof N!="string"&&S.stateNode===null)throw Error(o(166));if(_=cl(Dh.current),B=cl(Ho.current),Sp(S)){if(!we)throw Error(o(176));if(_=S.stateNode,N=S.memoizedProps,(B=me(_,N,S,!Kf))&&(j=wo,j!==null))switch(le=(j.mode&1)!==0,j.tag){case 3:st(j.stateNode.containerInfo,_,N,le);break;case 5:lt(j.type,j.memoizedProps,j.stateNode,_,N,le)}B&&hs(S)}else S.stateNode=ie(N,_,B,S)}return zr(S),null;case 13:if(Dt(Er),N=S.memoizedState,fr&&Gs!==null&&(S.mode&1)!==0&&(S.flags&128)===0){for(_=Gs;_;)_=tr(_);return $f(),S.flags|=98560,S}if(N!==null&&N.dehydrated!==null){if(N=Sp(S),_===null){if(!N)throw Error(o(318));if(!we)throw Error(o(344));if(_=S.memoizedState,_=_!==null?_.dehydrated:null,!_)throw Error(o(317));ke(_,S)}else $f(),(S.flags&128)===0&&(S.memoizedState=null),S.flags|=4;return zr(S),null}return Ba!==null&&(Wp(Ba),Ba=null),(S.flags&128)!==0?(S.lanes=B,S):(N=N!==null,B=!1,_===null?Sp(S):B=_.memoizedState!==null,N&&!B&&(S.child.flags|=8192,(S.mode&1)!==0&&(_===null||(Er.current&1)!==0?Lr===0&&(Lr=3):J0())),S.updateQueue!==null&&(S.flags|=4),zr(S),null);case 4:return Jf(),zh(_,S),_===null&&ve(S.stateNode.containerInfo),zr(S),null;case 10:return Yr(S.type._context),zr(S),null;case 17:return Ei(S.type)&&Dn(),zr(S),null;case 19:if(Dt(Er),j=S.memoizedState,j===null)return zr(S),null;if(N=(S.flags&128)!==0,le=j.rendering,le===null)if(N)Oc(j,!1);else{if(Lr!==0||_!==null&&(_.flags&128)!==0)for(_=S.child;_!==null;){if(le=L0(_),le!==null){for(S.flags|=128,Oc(j,!1),_=le.updateQueue,_!==null&&(S.updateQueue=_,S.flags|=4),S.subtreeFlags=0,_=B,N=S.child;N!==null;)B=N,j=_,B.flags&=14680066,le=B.alternate,le===null?(B.childLanes=0,B.lanes=j,B.child=null,B.subtreeFlags=0,B.memoizedProps=null,B.memoizedState=null,B.updateQueue=null,B.dependencies=null,B.stateNode=null):(B.childLanes=le.childLanes,B.lanes=le.lanes,B.child=le.child,B.subtreeFlags=0,B.deletions=null,B.memoizedProps=le.memoizedProps,B.memoizedState=le.memoizedState,B.updateQueue=le.updateQueue,B.type=le.type,j=le.dependencies,B.dependencies=j===null?null:{lanes:j.lanes,firstContext:j.firstContext}),N=N.sibling;return Bt(Er,Er.current&1|2),S.child}_=_.sibling}j.tail!==null&&hr()>Xu&&(S.flags|=128,N=!0,Oc(j,!1),S.lanes=4194304)}else{if(!N)if(_=L0(le),_!==null){if(S.flags|=128,N=!0,_=_.updateQueue,_!==null&&(S.updateQueue=_,S.flags|=4),Oc(j,!0),j.tail===null&&j.tailMode==="hidden"&&!le.alternate&&!fr)return zr(S),null}else 2*hr()-j.renderingStartTime>Xu&&B!==1073741824&&(S.flags|=128,N=!0,Oc(j,!1),S.lanes=4194304);j.isBackwards?(le.sibling=S.child,S.child=le):(_=j.last,_!==null?_.sibling=le:S.child=le,j.last=le)}return j.tail!==null?(S=j.tail,j.rendering=S,j.tail=S.sibling,j.renderingStartTime=hr(),S.sibling=null,_=Er.current,Bt(Er,N?_&1|2:_&1),S):(zr(S),null);case 22:case 23:return jp(),N=S.memoizedState!==null,_!==null&&_.memoizedState!==null!==N&&(S.flags|=8192),N&&(S.mode&1)!==0?(ho&1073741824)!==0&&(zr(S),pe&&S.subtreeFlags&6&&(S.flags|=8192)):zr(S),null;case 24:return null;case 25:return null}throw Error(o(156,S.tag))}var ny=a.ReactCurrentOwner,Ms=!1;function Rr(_,S,B,N){S.child=_===null?Ux(S,null,B,N):Dc(S,_.child,B,N)}function Yi(_,S,B,N,j){B=B.render;var le=S.ref;return Ur(S,j),N=Zf(_,S,B,N,le,j),B=Wu(),_!==null&&!Ms?(S.updateQueue=_.updateQueue,S.flags&=-2053,_.lanes&=~j,Qo(_,S,j)):(fr&&B&&GA(S),S.flags|=1,Rr(_,S,N,j),S.child)}function Gi(_,S,B,N,j){if(_===null){var le=B.type;return typeof le=="function"&&!eg(le)&&le.defaultProps===void 0&&B.compare===null&&B.defaultProps===void 0?(S.tag=15,S.type=le,Nc(_,S,le,N,j)):(_=tg(B.type,null,N,S,S.mode,j),_.ref=S.ref,_.return=S,S.child=_)}if(le=_.child,(_.lanes&j)===0){var Se=le.memoizedProps;if(B=B.compare,B=B!==null?B:zo,B(Se,N)&&_.ref===S.ref)return Qo(_,S,j)}return S.flags|=1,_=Kc(le,N),_.ref=S.ref,_.return=S,S.child=_}function Nc(_,S,B,N,j){if(_!==null&&zo(_.memoizedProps,N)&&_.ref===S.ref)if(Ms=!1,(_.lanes&j)!==0)(_.flags&131072)!==0&&(Ms=!0);else return S.lanes=_.lanes,Qo(_,S,j);return Uc(_,S,B,N,j)}function Hs(_,S,B){var N=S.pendingProps,j=N.children,le=_!==null?_.memoizedState:null;if(N.mode==="hidden")if((S.mode&1)===0)S.memoizedState={baseLanes:0,cachePool:null},Bt(Yh,ho),ho|=B;else if((B&1073741824)!==0)S.memoizedState={baseLanes:0,cachePool:null},N=le!==null?le.baseLanes:B,Bt(Yh,ho),ho|=N;else return _=le!==null?le.baseLanes|B:B,S.lanes=S.childLanes=1073741824,S.memoizedState={baseLanes:_,cachePool:null},S.updateQueue=null,Bt(Yh,ho),ho|=_,null;else le!==null?(N=le.baseLanes|B,S.memoizedState=null):N=B,Bt(Yh,ho),ho|=N;return Rr(_,S,j,B),S.child}function Co(_,S){var B=S.ref;(_===null&&B!==null||_!==null&&_.ref!==B)&&(S.flags|=512,S.flags|=2097152)}function Uc(_,S,B,N,j){var le=Ei(B)?Ai:xn.current;return le=xi(S,le),Ur(S,j),B=Zf(_,S,B,N,le,j),N=Wu(),_!==null&&!Ms?(S.updateQueue=_.updateQueue,S.flags&=-2053,_.lanes&=~j,Qo(_,S,j)):(fr&&N&&GA(S),S.flags|=1,Rr(_,S,B,j),S.child)}function Gh(_,S,B,N,j){if(Ei(B)){var le=!0;Bn(S)}else le=!1;if(Ur(S,j),S.stateNode===null)_!==null&&(_.alternate=null,S.alternate=null,S.flags|=2),Dx(S,B,N),zA(S,B,N,j),N=!0;else if(_===null){var Se=S.stateNode,Ge=S.memoizedProps;Se.props=Ge;var ht=Se.context,Rt=B.contextType;typeof Rt=="object"&&Rt!==null?Rt=xr(Rt):(Rt=Ei(B)?Ai:xn.current,Rt=xi(S,Rt));var Jt=B.getDerivedStateFromProps,Hn=typeof Jt=="function"||typeof Se.getSnapshotBeforeUpdate=="function";Hn||typeof Se.UNSAFE_componentWillReceiveProps!="function"&&typeof Se.componentWillReceiveProps!="function"||(Ge!==N||ht!==Rt)&&kx(S,Se,N,Rt),La=!1;var wn=S.memoizedState;Se.state=wn,w0(S,N,Se,j),ht=S.memoizedState,Ge!==N||wn!==ht||Sn.current||La?(typeof Jt=="function"&&(NA(S,B,Jt,N),ht=S.memoizedState),(Ge=La||UA(S,B,Ge,N,wn,ht,Rt))?(Hn||typeof Se.UNSAFE_componentWillMount!="function"&&typeof Se.componentWillMount!="function"||(typeof Se.componentWillMount=="function"&&Se.componentWillMount(),typeof Se.UNSAFE_componentWillMount=="function"&&Se.UNSAFE_componentWillMount()),typeof Se.componentDidMount=="function"&&(S.flags|=4194308)):(typeof Se.componentDidMount=="function"&&(S.flags|=4194308),S.memoizedProps=N,S.memoizedState=ht),Se.props=N,Se.state=ht,Se.context=Rt,N=Ge):(typeof Se.componentDidMount=="function"&&(S.flags|=4194308),N=!1)}else{Se=S.stateNode,OA(_,S),Ge=S.memoizedProps,Rt=S.type===S.elementType?Ge:ws(S.type,Ge),Se.props=Rt,Hn=S.pendingProps,wn=Se.context,ht=B.contextType,typeof ht=="object"&&ht!==null?ht=xr(ht):(ht=Ei(B)?Ai:xn.current,ht=xi(S,ht));var Zn=B.getDerivedStateFromProps;(Jt=typeof Zn=="function"||typeof Se.getSnapshotBeforeUpdate=="function")||typeof Se.UNSAFE_componentWillReceiveProps!="function"&&typeof Se.componentWillReceiveProps!="function"||(Ge!==Hn||wn!==ht)&&kx(S,Se,N,ht),La=!1,wn=S.memoizedState,Se.state=wn,w0(S,N,Se,j);var jt=S.memoizedState;Ge!==Hn||wn!==jt||Sn.current||La?(typeof Zn=="function"&&(NA(S,B,Zn,N),jt=S.memoizedState),(Rt=La||UA(S,B,Rt,N,wn,jt,ht)||!1)?(Jt||typeof Se.UNSAFE_componentWillUpdate!="function"&&typeof Se.componentWillUpdate!="function"||(typeof Se.componentWillUpdate=="function"&&Se.componentWillUpdate(N,jt,ht),typeof Se.UNSAFE_componentWillUpdate=="function"&&Se.UNSAFE_componentWillUpdate(N,jt,ht)),typeof Se.componentDidUpdate=="function"&&(S.flags|=4),typeof Se.getSnapshotBeforeUpdate=="function"&&(S.flags|=1024)):(typeof Se.componentDidUpdate!="function"||Ge===_.memoizedProps&&wn===_.memoizedState||(S.flags|=4),typeof Se.getSnapshotBeforeUpdate!="function"||Ge===_.memoizedProps&&wn===_.memoizedState||(S.flags|=1024),S.memoizedProps=N,S.memoizedState=jt),Se.props=N,Se.state=jt,Se.context=ht,N=Rt):(typeof Se.componentDidUpdate!="function"||Ge===_.memoizedProps&&wn===_.memoizedState||(S.flags|=4),typeof Se.getSnapshotBeforeUpdate!="function"||Ge===_.memoizedProps&&wn===_.memoizedState||(S.flags|=1024),N=!1)}return uo(_,S,B,N,le,j)}function uo(_,S,B,N,j,le){Co(_,S);var Se=(S.flags&128)!==0;if(!N&&!Se)return j&&Ln(S,B,!1),Qo(_,S,le);N=S.stateNode,ny.current=S;var Ge=Se&&typeof B.getDerivedStateFromError!="function"?null:N.render();return S.flags|=1,_!==null&&Se?(S.child=Dc(S,_.child,null,le),S.child=Dc(S,null,Ge,le)):Rr(_,S,Ge,le),S.memoizedState=N.state,j&&Ln(S,B,!0),S.child}function Bp(_){var S=_.stateNode;S.pendingContext?kn(_,S.pendingContext,S.pendingContext!==S.context):S.context&&kn(_,S.context,!1),R0(_,S.containerInfo)}function iy(_,S,B,N,j){return $f(),M0(j),S.flags|=256,Rr(_,S,B,N),S.child}var Dp={dehydrated:null,treeContext:null,retryLane:0};function Hh(_){return{baseLanes:_,cachePool:null}}function ry(_,S,B){var N=S.pendingProps,j=Er.current,le=!1,Se=(S.flags&128)!==0,Ge;if((Ge=Se)||(Ge=_!==null&&_.memoizedState===null?!1:(j&2)!==0),Ge?(le=!0,S.flags&=-129):(_===null||_.memoizedState!==null)&&(j|=1),Bt(Er,j&1),_===null)return Qu(S),_=S.memoizedState,_!==null&&(_=_.dehydrated,_!==null)?((S.mode&1)===0?S.lanes=1:Nr(_)?S.lanes=8:S.lanes=1073741824,null):(j=N.children,_=N.fallback,le?(N=S.mode,le=S.child,j={mode:"hidden",children:j},(N&1)===0&&le!==null?(le.childLanes=0,le.pendingProps=j):le=Yp(j,N,0,null),_=ef(_,N,B,null),le.return=S,_.return=S,le.sibling=_,S.child=le,S.child.memoizedState=Hh(B),S.memoizedState=Dp,_):fl(S,j));if(j=_.memoizedState,j!==null){if(Ge=j.dehydrated,Ge!==null){if(Se)return S.flags&256?(S.flags&=-257,Fp(_,S,B,Error(o(422)))):S.memoizedState!==null?(S.child=_.child,S.flags|=128,null):(le=N.fallback,j=S.mode,N=Yp({mode:"visible",children:N.children},j,0,null),le=ef(le,j,B,null),le.flags|=2,N.return=S,le.return=S,N.sibling=le,S.child=N,(S.mode&1)!==0&&Dc(S,_.child,null,B),S.child.memoizedState=Hh(B),S.memoizedState=Dp,le);if((S.mode&1)===0)S=Fp(_,S,B,null);else if(Nr(Ge))S=Fp(_,S,B,Error(o(419)));else if(N=(B&_.childLanes)!==0,Ms||N){if(N=Gr,N!==null){switch(B&-B){case 4:le=2;break;case 16:le=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:le=32;break;case 536870912:le=268435456;break;default:le=0}N=(le&(N.suspendedLanes|B))!==0?0:le,N!==0&&N!==j.retryLane&&(j.retryLane=N,fo(_,N,-1))}J0(),S=Fp(_,S,B,Error(o(421)))}else as(Ge)?(S.flags|=128,S.child=_.child,S=Yx.bind(null,_),ur(Ge,S),S=null):(B=j.treeContext,we&&(Gs=Uo(Ge),wo=S,fr=!0,Ba=null,Kf=!1,B!==null&&(Pa[ra++]=Pc,Pa[ra++]=Bc,Pa[ra++]=Lh,Pc=B.id,Bc=B.overflow,Lh=S)),S=fl(S,S.pendingProps.children),S.flags|=4096);return S}return le?(N=j0(_,S,N.children,N.fallback,B),le=S.child,j=_.child.memoizedState,le.memoizedState=j===null?Hh(B):{baseLanes:j.baseLanes|B,cachePool:null},le.childLanes=_.childLanes&~B,S.memoizedState=Dp,N):(B=kp(_,S,N.children,B),S.memoizedState=null,B)}return le?(N=j0(_,S,N.children,N.fallback,B),le=S.child,j=_.child.memoizedState,le.memoizedState=j===null?Hh(B):{baseLanes:j.baseLanes|B,cachePool:null},le.childLanes=_.childLanes&~B,S.memoizedState=Dp,N):(B=kp(_,S,N.children,B),S.memoizedState=null,B)}function fl(_,S){return S=Yp({mode:"visible",children:S},_.mode,0,null),S.return=_,_.child=S}function kp(_,S,B,N){var j=_.child;return _=j.sibling,B=Kc(j,{mode:"visible",children:B}),(S.mode&1)===0&&(B.lanes=N),B.return=S,B.sibling=null,_!==null&&(N=S.deletions,N===null?(S.deletions=[_],S.flags|=16):N.push(_)),S.child=B}function j0(_,S,B,N,j){var le=S.mode;_=_.child;var Se=_.sibling,Ge={mode:"hidden",children:B};return(le&1)===0&&S.child!==_?(B=S.child,B.childLanes=0,B.pendingProps=Ge,S.deletions=null):(B=Kc(_,Ge),B.subtreeFlags=_.subtreeFlags&14680064),Se!==null?N=Kc(Se,N):(N=ef(N,le,j,null),N.flags|=2),N.return=S,B.return=S,B.sibling=N,S.child=B,N}function Fp(_,S,B,N){return N!==null&&M0(N),Dc(S,_.child,null,B),_=fl(S,S.pendingProps.children),_.flags|=2,S.memoizedState=null,_}function Wx(_,S,B){_.lanes|=S;var N=_.alternate;N!==null&&(N.lanes|=S),us(_.return,S,B)}function Wl(_,S,B,N,j){var le=_.memoizedState;le===null?_.memoizedState={isBackwards:S,rendering:null,renderingStartTime:0,last:N,tail:B,tailMode:j}:(le.isBackwards=S,le.rendering=null,le.renderingStartTime=0,le.last=N,le.tail=B,le.tailMode=j)}function Qh(_,S,B){var N=S.pendingProps,j=N.revealOrder,le=N.tail;if(Rr(_,S,N.children,B),N=Er.current,(N&2)!==0)N=N&1|2,S.flags|=128;else{if(_!==null&&(_.flags&128)!==0)e:for(_=S.child;_!==null;){if(_.tag===13)_.memoizedState!==null&&Wx(_,B,S);else if(_.tag===19)Wx(_,B,S);else if(_.child!==null){_.child.return=_,_=_.child;continue}if(_===S)break e;for(;_.sibling===null;){if(_.return===null||_.return===S)break e;_=_.return}_.sibling.return=_.return,_=_.sibling}N&=1}if(Bt(Er,N),(S.mode&1)===0)S.memoizedState=null;else switch(j){case"forwards":for(B=S.child,j=null;B!==null;)_=B.alternate,_!==null&&L0(_)===null&&(j=B),B=B.sibling;B=j,B===null?(j=S.child,S.child=null):(j=B.sibling,B.sibling=null),Wl(S,!1,j,B,le);break;case"backwards":for(B=null,j=S.child,S.child=null;j!==null;){if(_=j.alternate,_!==null&&L0(_)===null){S.child=j;break}_=j.sibling,j.sibling=B,B=j,j=_}Wl(S,!0,B,null,le);break;case"together":Wl(S,!1,null,null,void 0);break;default:S.memoizedState=null}return S.child}function Qo(_,S,B){if(_!==null&&(S.dependencies=_.dependencies),jl|=S.lanes,(B&S.childLanes)===0)return null;if(_!==null&&S.child!==_.child)throw Error(o(153));if(S.child!==null){for(_=S.child,B=Kc(_,_.pendingProps),S.child=B,B.return=S;_.sibling!==null;)_=_.sibling,B=B.sibling=Kc(_,_.pendingProps),B.return=S;B.sibling=null}return S.child}function K0(_,S,B){switch(S.tag){case 3:Bp(S),$f();break;case 5:zx(S);break;case 1:Ei(S.type)&&Bn(S);break;case 4:R0(S,S.stateNode.containerInfo);break;case 10:Rc(S,S.type._context,S.memoizedProps.value);break;case 13:var N=S.memoizedState;if(N!==null)return N.dehydrated!==null?(Bt(Er,Er.current&1),S.flags|=128,null):(B&S.child.childLanes)!==0?ry(_,S,B):(Bt(Er,Er.current&1),_=Qo(_,S,B),_!==null?_.sibling:null);Bt(Er,Er.current&1);break;case 19:if(N=(B&S.childLanes)!==0,(_.flags&128)!==0){if(N)return Qh(_,S,B);S.flags|=128}var j=S.memoizedState;if(j!==null&&(j.rendering=null,j.tail=null,j.lastEffect=null),Bt(Er,Er.current),N)break;return null;case 22:case 23:return S.lanes=0,Hs(_,S,B)}return Qo(_,S,B)}function $0(_,S){switch(HA(S),S.tag){case 1:return Ei(S.type)&&Dn(),_=S.flags,_&65536?(S.flags=_&-65537|128,S):null;case 3:return Jf(),Dt(Sn),Dt(xn),kh(),_=S.flags,(_&65536)!==0&&(_&128)===0?(S.flags=_&-65537|128,S):null;case 5:return WA(S),null;case 13:if(Dt(Er),_=S.memoizedState,_!==null&&_.dehydrated!==null){if(S.alternate===null)throw Error(o(340));$f()}return _=S.flags,_&65536?(S.flags=_&-65537|128,S):null;case 19:return Dt(Er),null;case 4:return Jf(),null;case 10:return Yr(S.type._context),null;case 22:case 23:return jp(),null;case 24:return null;default:return null}}var To=!1,Rs=!1,Vh=typeof WeakSet=="function"?WeakSet:Set,kt=null;function Da(_,S){var B=_.ref;if(B!==null)if(typeof B=="function")try{B(null)}catch(N){Io(_,S,N)}else B.current=null}function zc(_,S,B){try{B()}catch(N){Io(_,S,N)}}var sy=!1;function oy(_,S){for(Q(_.containerInfo),kt=S;kt!==null;)if(_=kt,S=_.child,(_.subtreeFlags&1028)!==0&&S!==null)S.return=_,kt=S;else for(;kt!==null;){_=kt;try{var B=_.alternate;if((_.flags&1024)!==0)switch(_.tag){case 0:case 11:case 15:break;case 1:if(B!==null){var N=B.memoizedProps,j=B.memoizedState,le=_.stateNode,Se=le.getSnapshotBeforeUpdate(_.elementType===_.type?N:ws(_.type,N),j);le.__reactInternalSnapshotBeforeUpdate=Se}break;case 3:pe&&_t(_.stateNode.containerInfo);break;case 5:case 6:case 4:case 17:break;default:throw Error(o(163))}}catch(Ge){Io(_,_.return,Ge)}if(S=_.sibling,S!==null){S.return=_.return,kt=S;break}kt=_.return}return B=sy,sy=!1,B}function Gc(_,S,B){var N=S.updateQueue;if(N=N!==null?N.lastEffect:null,N!==null){var j=N=N.next;do{if((j.tag&_)===_){var le=j.destroy;j.destroy=void 0,le!==void 0&&zc(S,B,le)}j=j.next}while(j!==N)}}function Qs(_,S){if(S=S.updateQueue,S=S!==null?S.lastEffect:null,S!==null){var B=S=S.next;do{if((B.tag&_)===_){var N=B.create;B.destroy=N()}B=B.next}while(B!==S)}}function bo(_){var S=_.ref;if(S!==null){var B=_.stateNode;switch(_.tag){case 5:_=$(B);break;default:_=B}typeof S=="function"?S(_):S.current=_}}function ir(_,S,B){if(ia&&typeof ia.onCommitFiberUnmount=="function")try{ia.onCommitFiberUnmount(Ou,S)}catch{}switch(S.tag){case 0:case 11:case 14:case 15:if(_=S.updateQueue,_!==null&&(_=_.lastEffect,_!==null)){var N=_=_.next;do{var j=N,le=j.destroy;j=j.tag,le!==void 0&&((j&2)!==0||(j&4)!==0)&&zc(S,B,le),N=N.next}while(N!==_)}break;case 1:if(Da(S,B),_=S.stateNode,typeof _.componentWillUnmount=="function")try{_.props=S.memoizedProps,_.state=S.memoizedState,_.componentWillUnmount()}catch(Se){Io(S,B,Se)}break;case 5:Da(S,B);break;case 4:pe?cy(_,S,B):ce&&ce&&(S=S.stateNode.containerInfo,B=bt(S),Nt(S,B))}}function ka(_,S,B){for(var N=S;;)if(ir(_,N,B),N.child===null||pe&&N.tag===4){if(N===S)break;for(;N.sibling===null;){if(N.return===null||N.return===S)return;N=N.return}N.sibling.return=N.return,N=N.sibling}else N.child.return=N,N=N.child}function ay(_){var S=_.alternate;S!==null&&(_.alternate=null,ay(S)),_.child=null,_.deletions=null,_.sibling=null,_.tag===5&&(S=_.stateNode,S!==null&&Le(S)),_.stateNode=null,_.return=null,_.dependencies=null,_.memoizedProps=null,_.memoizedState=null,_.pendingProps=null,_.stateNode=null,_.updateQueue=null}function ly(_){return _.tag===5||_.tag===3||_.tag===4}function Y0(_){e:for(;;){for(;_.sibling===null;){if(_.return===null||ly(_.return))return null;_=_.return}for(_.sibling.return=_.return,_=_.sibling;_.tag!==5&&_.tag!==6&&_.tag!==18;){if(_.flags&2||_.child===null||_.tag===4)continue e;_.child.return=_,_=_.child}if(!(_.flags&2))return _.stateNode}}function X0(_){if(pe){e:{for(var S=_.return;S!==null;){if(ly(S))break e;S=S.return}throw Error(o(160))}var B=S;switch(B.tag){case 5:S=B.stateNode,B.flags&32&&(qe(S),B.flags&=-33),B=Y0(_),sd(_,B,S);break;case 3:case 4:S=B.stateNode.containerInfo,B=Y0(_),q0(_,B,S);break;default:throw Error(o(161))}}}function q0(_,S,B){var N=_.tag;if(N===5||N===6)_=_.stateNode,S?gt(B,_,S):pt(B,_);else if(N!==4&&(_=_.child,_!==null))for(q0(_,S,B),_=_.sibling;_!==null;)q0(_,S,B),_=_.sibling}function sd(_,S,B){var N=_.tag;if(N===5||N===6)_=_.stateNode,S?St(B,_,S):ct(B,_);else if(N!==4&&(_=_.child,_!==null))for(sd(_,S,B),_=_.sibling;_!==null;)sd(_,S,B),_=_.sibling}function cy(_,S,B){for(var N=S,j=!1,le,Se;;){if(!j){j=N.return;e:for(;;){if(j===null)throw Error(o(160));switch(le=j.stateNode,j.tag){case 5:Se=!1;break e;case 3:le=le.containerInfo,Se=!0;break e;case 4:le=le.containerInfo,Se=!0;break e}j=j.return}j=!0}if(N.tag===5||N.tag===6)ka(_,N,B),Se?be(le,N.stateNode):ft(le,N.stateNode);else if(N.tag===18)Se?Me(le,N.stateNode):Pe(le,N.stateNode);else if(N.tag===4){if(N.child!==null){le=N.stateNode.containerInfo,Se=!0,N.child.return=N,N=N.child;continue}}else if(ir(_,N,B),N.child!==null){N.child.return=N,N=N.child;continue}if(N===S)break;for(;N.sibling===null;){if(N.return===null||N.return===S)return;N=N.return,N.tag===4&&(j=!1)}N.sibling.return=N.return,N=N.sibling}}function $u(_,S){if(pe){switch(S.tag){case 0:case 11:case 14:case 15:Gc(3,S,S.return),Qs(3,S),Gc(5,S,S.return);return;case 1:return;case 5:var B=S.stateNode;if(B!=null){var N=S.memoizedProps;_=_!==null?_.memoizedProps:N;var j=S.type,le=S.updateQueue;S.updateQueue=null,le!==null&&Ft(B,le,j,_,N,S)}return;case 6:if(S.stateNode===null)throw Error(o(162));B=S.memoizedProps,We(S.stateNode,_!==null?_.memoizedProps:B,B);return;case 3:we&&_!==null&&_.memoizedState.isDehydrated&&ye(S.stateNode.containerInfo);return;case 12:return;case 13:od(S);return;case 19:od(S);return;case 17:return}throw Error(o(163))}switch(S.tag){case 0:case 11:case 14:case 15:Gc(3,S,S.return),Qs(3,S),Gc(5,S,S.return);return;case 12:return;case 13:od(S);return;case 19:od(S);return;case 3:we&&_!==null&&_.memoizedState.isDehydrated&&ye(S.stateNode.containerInfo);break;case 22:case 23:return}e:if(ce){switch(S.tag){case 1:case 5:case 6:break e;case 3:case 4:S=S.stateNode,Nt(S.containerInfo,S.pendingChildren);break e}throw Error(o(163))}}function od(_){var S=_.updateQueue;if(S!==null){_.updateQueue=null;var B=_.stateNode;B===null&&(B=_.stateNode=new Vh),S.forEach(function(N){var j=Xx.bind(null,_,N);B.has(N)||(B.add(N),N.then(j,j))})}}function aC(_,S){for(kt=S;kt!==null;){S=kt;var B=S.deletions;if(B!==null)for(var N=0;N<B.length;N++){var j=B[N];try{var le=_;pe?cy(le,j,S):ka(le,j,S);var Se=j.alternate;Se!==null&&(Se.return=null),j.return=null}catch(on){Io(j,S,on)}}if(B=S.child,(S.subtreeFlags&12854)!==0&&B!==null)B.return=S,kt=B;else for(;kt!==null;){S=kt;try{var Ge=S.flags;if(Ge&32&&pe&&qe(S.stateNode),Ge&512){var ht=S.alternate;if(ht!==null){var Rt=ht.ref;Rt!==null&&(typeof Rt=="function"?Rt(null):Rt.current=null)}}if(Ge&8192)switch(S.tag){case 13:if(S.memoizedState!==null){var Jt=S.alternate;(Jt===null||Jt.memoizedState===null)&&(Qp=hr())}break;case 22:var Hn=S.memoizedState!==null,wn=S.alternate,Zn=wn!==null&&wn.memoizedState!==null;if(B=S,pe){e:if(N=B,j=Hn,le=null,pe)for(var jt=N;;){if(jt.tag===5){if(le===null){le=jt;var js=jt.stateNode;j?At(js):De(jt.stateNode,jt.memoizedProps)}}else if(jt.tag===6){if(le===null){var fa=jt.stateNode;j?yt(fa):Ce(fa,jt.memoizedProps)}}else if((jt.tag!==22&&jt.tag!==23||jt.memoizedState===null||jt===N)&&jt.child!==null){jt.child.return=jt,jt=jt.child;continue}if(jt===N)break;for(;jt.sibling===null;){if(jt.return===null||jt.return===N)break e;le===jt&&(le=null),jt=jt.return}le===jt&&(le=null),jt.sibling.return=jt.return,jt=jt.sibling}}if(Hn&&!Zn&&(B.mode&1)!==0){kt=B;for(var et=B.child;et!==null;){for(B=kt=et;kt!==null;){N=kt;var Qe=N.child;switch(N.tag){case 0:case 11:case 14:case 15:Gc(4,N,N.return);break;case 1:Da(N,N.return);var at=N.stateNode;if(typeof at.componentWillUnmount=="function"){var Vt=N.return;try{at.props=N.memoizedProps,at.state=N.memoizedState,at.componentWillUnmount()}catch(on){Io(N,Vt,on)}}break;case 5:Da(N,N.return);break;case 22:if(N.memoizedState!==null){hy(B);continue}}Qe!==null?(Qe.return=N,kt=Qe):hy(B)}et=et.sibling}}}switch(Ge&4102){case 2:X0(S),S.flags&=-3;break;case 6:X0(S),S.flags&=-3,$u(S.alternate,S);break;case 4096:S.flags&=-4097;break;case 4100:S.flags&=-4097,$u(S.alternate,S);break;case 4:$u(S.alternate,S)}}catch(on){Io(S,S.return,on)}if(B=S.sibling,B!==null){B.return=S.return,kt=B;break}kt=S.return}}}function Op(_,S,B){kt=_,Np(_)}function Np(_,S,B){for(var N=(_.mode&1)!==0;kt!==null;){var j=kt,le=j.child;if(j.tag===22&&N){var Se=j.memoizedState!==null||To;if(!Se){var Ge=j.alternate,ht=Ge!==null&&Ge.memoizedState!==null||Rs;Ge=To;var Rt=Rs;if(To=Se,(Rs=ht)&&!Rt)for(kt=j;kt!==null;)Se=kt,ht=Se.child,Se.tag===22&&Se.memoizedState!==null?Wh(j):ht!==null?(ht.return=Se,kt=ht):Wh(j);for(;le!==null;)kt=le,Np(le),le=le.sibling;kt=j,To=Ge,Rs=Rt}uy(_)}else(j.subtreeFlags&8772)!==0&&le!==null?(le.return=j,kt=le):uy(_)}}function uy(_){for(;kt!==null;){var S=kt;if((S.flags&8772)!==0){var B=S.alternate;try{if((S.flags&8772)!==0)switch(S.tag){case 0:case 11:case 15:Rs||Qs(5,S);break;case 1:var N=S.stateNode;if(S.flags&4&&!Rs)if(B===null)N.componentDidMount();else{var j=S.elementType===S.type?B.memoizedProps:ws(S.type,B.memoizedProps);N.componentDidUpdate(j,B.memoizedState,N.__reactInternalSnapshotBeforeUpdate)}var le=S.updateQueue;le!==null&&Px(S,le,N);break;case 3:var Se=S.updateQueue;if(Se!==null){if(B=null,S.child!==null)switch(S.child.tag){case 5:B=$(S.child.stateNode);break;case 1:B=S.child.stateNode}Px(S,Se,B)}break;case 5:var Ge=S.stateNode;B===null&&S.flags&4&&Mt(Ge,S.type,S.memoizedProps,S);break;case 6:break;case 4:break;case 12:break;case 13:if(we&&S.memoizedState===null){var ht=S.alternate;if(ht!==null){var Rt=ht.memoizedState;if(Rt!==null){var Jt=Rt.dehydrated;Jt!==null&&_e(Jt)}}}break;case 19:case 17:case 21:case 22:case 23:break;default:throw Error(o(163))}Rs||S.flags&512&&bo(S)}catch(Hn){Io(S,S.return,Hn)}}if(S===_){kt=null;break}if(B=S.sibling,B!==null){B.return=S.return,kt=B;break}kt=S.return}}function hy(_){for(;kt!==null;){var S=kt;if(S===_){kt=null;break}var B=S.sibling;if(B!==null){B.return=S.return,kt=B;break}kt=S.return}}function Wh(_){for(;kt!==null;){var S=kt;try{switch(S.tag){case 0:case 11:case 15:var B=S.return;try{Qs(4,S)}catch(ht){Io(S,B,ht)}break;case 1:var N=S.stateNode;if(typeof N.componentDidMount=="function"){var j=S.return;try{N.componentDidMount()}catch(ht){Io(S,j,ht)}}var le=S.return;try{bo(S)}catch(ht){Io(S,le,ht)}break;case 5:var Se=S.return;try{bo(S)}catch(ht){Io(S,Se,ht)}}}catch(ht){Io(S,S.return,ht)}if(S===_){kt=null;break}var Ge=S.sibling;if(Ge!==null){Ge.return=S.return,kt=Ge;break}kt=S.return}}var Up=0,jh=1,Kh=2,Hc=3,ad=4;if(typeof Symbol=="function"&&Symbol.for){var $h=Symbol.for;Up=$h("selector.component"),jh=$h("selector.has_pseudo_class"),Kh=$h("selector.role"),Hc=$h("selector.test_id"),ad=$h("selector.text")}function zp(_){var S=Ee(_);if(S!=null){if(typeof S.memoizedProps["data-testname"]!="string")throw Error(o(364));return S}if(_=de(_),_===null)throw Error(o(362));return _.stateNode.current}function Gp(_,S){switch(S.$$typeof){case Up:if(_.type===S.value)return!0;break;case jh:e:{S=S.value,_=[_,0];for(var B=0;B<_.length;){var N=_[B++],j=_[B++],le=S[j];if(N.tag!==5||!Fe(N)){for(;le!=null&&Gp(N,le);)j++,le=S[j];if(j===S.length){S=!0;break e}else for(N=N.child;N!==null;)_.push(N,j),N=N.sibling}}S=!1}return S;case Kh:if(_.tag===5&&He(_.stateNode,S.value))return!0;break;case ad:if((_.tag===5||_.tag===6)&&(_=Be(_),_!==null&&0<=_.indexOf(S.value)))return!0;break;case Hc:if(_.tag===5&&(_=_.memoizedProps["data-testname"],typeof _=="string"&&_.toLowerCase()===S.value.toLowerCase()))return!0;break;default:throw Error(o(365))}return!1}function Yu(_){switch(_.$$typeof){case Up:return"<"+(M(_.value)||"Unknown")+">";case jh:return":has("+(Yu(_)||"")+")";case Kh:return'[role="'+_.value+'"]';case ad:return'"'+_.value+'"';case Hc:return'[data-testname="'+_.value+'"]';default:throw Error(o(365))}}function la(_,S){var B=[];_=[_,0];for(var N=0;N<_.length;){var j=_[N++],le=_[N++],Se=S[le];if(j.tag!==5||!Fe(j)){for(;Se!=null&&Gp(j,Se);)le++,Se=S[le];if(le===S.length)B.push(j);else for(j=j.child;j!==null;)_.push(j,le),j=j.sibling}}return B}function Qc(_,S){if(!V)throw Error(o(363));_=zp(_),_=la(_,S),S=[],_=Array.from(_);for(var B=0;B<_.length;){var N=_[B++];if(N.tag===5)Fe(N)||S.push(N.stateNode);else for(N=N.child;N!==null;)_.push(N),N=N.sibling}return S}var fy=Math.ceil,Hp=a.ReactCurrentDispatcher,dl=a.ReactCurrentOwner,Di=a.ReactCurrentBatchConfig,Jn=0,Gr=null,ki=null,dr=0,ho=0,Yh=vn(0),Lr=0,ld=null,jl=0,ca=0,Xh=0,Vc=null,Xr=null,Qp=0,Xu=1/0;function qh(){Xu=hr()+500}var cd=!1,rr=null,pl=null,ud=!1,Kl=null,Jh=0,Zh=0,Wc=null,Xi=-1,Pr=0;function yi(){return(Jn&6)!==0?hr():Xi!==-1?Xi:Xi=hr()}function ml(_){return(_.mode&1)===0?1:(Jn&2)!==0&&dr!==0?dr&-dr:zu.transition!==null?(Pr===0&&(_=ol,ol<<=1,(ol&4194240)===0&&(ol=64),Pr=_),Pr):(_=Fn,_!==0?_:Ae())}function fo(_,S,B){if(50<Zh)throw Zh=0,Wc=null,Error(o(185));var N=qu(_,S);return N===null?null:(ba(N,S,B),((Jn&2)===0||N!==Gr)&&(N===Gr&&((Jn&2)===0&&(ca|=S),Lr===4&&Ws(N,dr)),Vo(N,B),S===1&&Jn===0&&(_.mode&1)===0&&(qh(),Hl&&co())),N)}function qu(_,S){_.lanes|=S;var B=_.alternate;for(B!==null&&(B.lanes|=S),B=_,_=_.return;_!==null;)_.childLanes|=S,B=_.alternate,B!==null&&(B.childLanes|=S),B=_,_=_.return;return B.tag===3?B.stateNode:null}function Vo(_,S){var B=_.callbackNode;Vf(_,S);var N=ku(_,_===Gr?dr:0);if(N===0)B!==null&&Gl(B),_.callbackNode=null,_.callbackPriority=0;else if(S=N&-N,_.callbackPriority!==S){if(B!=null&&Gl(B),S===1)_.tag===0?Uu(ua.bind(null,_)):Rh(ua.bind(null,_)),Te?ne(function(){Jn===0&&co()}):na(ll,co),B=null;else{switch(Ia(N)){case 1:B=ll;break;case 4:B=E0;break;case 16:B=lo;break;case 536870912:B=Fu;break;default:B=lo}B=Z0(B,Vs.bind(null,_))}_.callbackPriority=S,_.callbackNode=B}}function Vs(_,S){if(Xi=-1,Pr=0,(Jn&6)!==0)throw Error(o(327));var B=_.callbackNode;if($l()&&_.callbackNode!==B)return null;var N=ku(_,_===Gr?dr:0);if(N===0)return null;if((N&30)!==0||(N&_.expiredLanes)!==0||S)S=Kp(_,N);else{S=N;var j=Jn;Jn|=2;var le=my();(Gr!==_||dr!==S)&&(qh(),jc(_,S));do try{Kx();break}catch(Ge){py(_,Ge)}while(!0);Cs(),Hp.current=le,Jn=j,ki!==null?S=0:(Gr=null,dr=0,S=Lr)}if(S!==0){if(S===2&&(j=zl(_),j!==0&&(N=j,S=Vp(_,j))),S===1)throw B=ld,jc(_,0),Ws(_,N),Vo(_,hr()),B;if(S===6)Ws(_,N);else{if(j=_.current.alternate,(N&30)===0&&!dy(j)&&(S=Kp(_,N),S===2&&(le=zl(_),le!==0&&(N=le,S=Vp(_,le))),S===1))throw B=ld,jc(_,0),Ws(_,N),Vo(_,hr()),B;switch(_.finishedWork=j,_.finishedLanes=N,S){case 0:case 1:throw Error(o(345));case 2:gl(_,Xr);break;case 3:if(Ws(_,N),(N&130023424)===N&&(S=Qp+500-hr(),10<S)){if(ku(_,0)!==0)break;if(j=_.suspendedLanes,(j&N)!==N){yi(),_.pingedLanes|=_.suspendedLanes&j;break}_.timeoutHandle=re(gl.bind(null,_,Xr),S);break}gl(_,Xr);break;case 4:if(Ws(_,N),(N&4194240)===N)break;for(S=_.eventTimes,j=-1;0<N;){var Se=31-Ri(N);le=1<<Se,Se=S[Se],Se>j&&(j=Se),N&=~le}if(N=j,N=hr()-N,N=(120>N?120:480>N?480:1080>N?1080:1920>N?1920:3e3>N?3e3:4320>N?4320:1960*fy(N/1960))-N,10<N){_.timeoutHandle=re(gl.bind(null,_,Xr),N);break}gl(_,Xr);break;case 5:gl(_,Xr);break;default:throw Error(o(329))}}}return Vo(_,hr()),_.callbackNode===B?Vs.bind(null,_):null}function Vp(_,S){var B=Vc;return _.current.memoizedState.isDehydrated&&(jc(_,S).flags|=256),_=Kp(_,S),_!==2&&(S=Xr,Xr=B,S!==null&&Wp(S)),_}function Wp(_){Xr===null?Xr=_:Xr.push.apply(Xr,_)}function dy(_){for(var S=_;;){if(S.flags&16384){var B=S.updateQueue;if(B!==null&&(B=B.stores,B!==null))for(var N=0;N<B.length;N++){var j=B[N],le=j.getSnapshot;j=j.value;try{if(!_s(le(),j))return!1}catch{return!1}}}if(B=S.child,S.subtreeFlags&16384&&B!==null)B.return=S,S=B;else{if(S===_)break;for(;S.sibling===null;){if(S.return===null||S.return===_)return!0;S=S.return}S.sibling.return=S.return,S=S.sibling}}return!0}function Ws(_,S){for(S&=~Xh,S&=~ca,_.suspendedLanes|=S,_.pingedLanes&=~S,_=_.expirationTimes;0<S;){var B=31-Ri(S),N=1<<B;_[B]=-1,S&=~N}}function ua(_){if((Jn&6)!==0)throw Error(o(327));$l();var S=ku(_,0);if((S&1)===0)return Vo(_,hr()),null;var B=Kp(_,S);if(_.tag!==0&&B===2){var N=zl(_);N!==0&&(S=N,B=Vp(_,N))}if(B===1)throw B=ld,jc(_,0),Ws(_,S),Vo(_,hr()),B;if(B===6)throw Error(o(345));return _.finishedWork=_.current.alternate,_.finishedLanes=S,gl(_,Xr),Vo(_,hr()),null}function hd(_){Kl!==null&&Kl.tag===0&&(Jn&6)===0&&$l();var S=Jn;Jn|=1;var B=Di.transition,N=Fn;try{if(Di.transition=null,Fn=1,_)return _()}finally{Fn=N,Di.transition=B,Jn=S,(Jn&6)===0&&co()}}function jp(){ho=Yh.current,Dt(Yh)}function jc(_,S){_.finishedWork=null,_.finishedLanes=0;var B=_.timeoutHandle;if(B!==ge&&(_.timeoutHandle=ge,se(B)),ki!==null)for(B=ki.return;B!==null;){var N=B;switch(HA(N),N.tag){case 1:N=N.type.childContextTypes,N!=null&&Dn();break;case 3:Jf(),Dt(Sn),Dt(xn),kh();break;case 5:WA(N);break;case 4:Jf();break;case 13:Dt(Er);break;case 19:Dt(Er);break;case 10:Yr(N.type._context);break;case 22:case 23:jp()}B=B.return}if(Gr=_,ki=_=Kc(_.current,null),dr=ho=S,Lr=0,ld=null,Xh=ca=jl=0,Xr=Vc=null,So!==null){for(S=0;S<So.length;S++)if(B=So[S],N=B.interleaved,N!==null){B.interleaved=null;var j=N.next,le=B.pending;if(le!==null){var Se=le.next;le.next=j,N.next=Se}B.pending=N}So=null}return _}function py(_,S){do{var B=ki;try{if(Cs(),wp.current=id,P0){for(var N=_r.memoizedState;N!==null;){var j=N.queue;j!==null&&(j.pending=null),N=N.next}P0=!1}if(Fh=0,bs=Ts=_r=null,Ql=!1,Oh=0,dl.current=null,B===null||B.return===null){Lr=1,ld=S,ki=null;break}e:{var le=_,Se=B.return,Ge=B,ht=S;if(S=dr,Ge.flags|=32768,ht!==null&&typeof ht=="object"&&typeof ht.then=="function"){var Rt=ht,Jt=Ge,Hn=Jt.tag;if((Jt.mode&1)===0&&(Hn===0||Hn===11||Hn===15)){var wn=Jt.alternate;wn?(Jt.updateQueue=wn.updateQueue,Jt.memoizedState=wn.memoizedState,Jt.lanes=wn.lanes):(Jt.updateQueue=null,Jt.memoizedState=null)}var Zn=ty(Se);if(Zn!==null){Zn.flags&=-257,Uh(Zn,Se,Ge,le,S),Zn.mode&1&&Fc(le,Rt,S),S=Zn,ht=Rt;var jt=S.updateQueue;if(jt===null){var js=new Set;js.add(ht),S.updateQueue=js}else jt.add(ht);break e}else{if((S&1)===0){Fc(le,Rt,S),J0();break e}ht=Error(o(426))}}else if(fr&&Ge.mode&1){var fa=ty(Se);if(fa!==null){(fa.flags&65536)===0&&(fa.flags|=256),Uh(fa,Se,Ge,le,S),M0(ht);break e}}le=ht,Lr!==4&&(Lr=2),Vc===null?Vc=[le]:Vc.push(le),ht=ey(ht,Ge),Ge=Se;do{switch(Ge.tag){case 3:Ge.flags|=65536,S&=-S,Ge.lanes|=S;var et=Vx(Ge,ht,S);S0(Ge,et);break e;case 1:le=ht;var Qe=Ge.type,at=Ge.stateNode;if((Ge.flags&128)===0&&(typeof Qe.getDerivedStateFromError=="function"||at!==null&&typeof at.componentDidCatch=="function"&&(pl===null||!pl.has(at)))){Ge.flags|=65536,S&=-S,Ge.lanes|=S;var Vt=H0(Ge,le,S);S0(Ge,Vt);break e}}Ge=Ge.return}while(Ge!==null)}Ay(B)}catch(on){S=on,ki===B&&B!==null&&(ki=B=B.return);continue}break}while(!0)}function my(){var _=Hp.current;return Hp.current=id,_===null?id:_}function J0(){(Lr===0||Lr===3||Lr===2)&&(Lr=4),Gr===null||(jl&268435455)===0&&(ca&268435455)===0||Ws(Gr,dr)}function Kp(_,S){var B=Jn;Jn|=2;var N=my();Gr===_&&dr===S||jc(_,S);do try{jx();break}catch(j){py(_,j)}while(!0);if(Cs(),Jn=B,Hp.current=N,ki!==null)throw Error(o(261));return Gr=null,dr=0,Lr}function jx(){for(;ki!==null;)gy(ki)}function Kx(){for(;ki!==null&&!Ma();)gy(ki)}function gy(_){var S=xy(_.alternate,_,ho);_.memoizedProps=_.pendingProps,S===null?Ay(_):ki=S,dl.current=null}function Ay(_){var S=_;do{var B=S.alternate;if(_=S.return,(S.flags&32768)===0){if(B=W0(B,S,ho),B!==null){ki=B;return}}else{if(B=$0(B,S),B!==null){B.flags&=32767,ki=B;return}if(_!==null)_.flags|=32768,_.subtreeFlags=0,_.deletions=null;else{Lr=6,ki=null;return}}if(S=S.sibling,S!==null){ki=S;return}ki=S=_}while(S!==null);Lr===0&&(Lr=5)}function gl(_,S){var B=Fn,N=Di.transition;try{Di.transition=null,Fn=1,$x(_,S,B)}finally{Di.transition=N,Fn=B}return null}function $x(_,S,B){do $l();while(Kl!==null);if((Jn&6)!==0)throw Error(o(327));var N=_.finishedWork,j=_.finishedLanes;if(N===null)return null;if(_.finishedWork=null,_.finishedLanes=0,N===_.current)throw Error(o(177));_.callbackNode=null,_.callbackPriority=0;var le=N.lanes|N.childLanes;if(al(_,le),_===Gr&&(ki=Gr=null,dr=0),(N.subtreeFlags&2064)===0&&(N.flags&2064)===0||ud||(ud=!0,Z0(lo,function(){return $l(),null})),le=(N.flags&15990)!==0,(N.subtreeFlags&15990)!==0||le){le=Di.transition,Di.transition=null;var Se=Fn;Fn=1;var Ge=Jn;Jn|=4,dl.current=null,oy(_,N),aC(_,N),Y(_.containerInfo),_.current=N,Op(N),x0(),Jn=Ge,Fn=Se,Di.transition=le}else _.current=N;if(ud&&(ud=!1,Kl=_,Jh=j),le=_.pendingLanes,le===0&&(pl=null),Tc(N.stateNode),Vo(_,hr()),S!==null)for(B=_.onRecoverableError,N=0;N<S.length;N++)B(S[N]);if(cd)throw cd=!1,_=rr,rr=null,_;return(Jh&1)!==0&&_.tag!==0&&$l(),le=_.pendingLanes,(le&1)!==0?_===Wc?Zh++:(Zh=0,Wc=_):Zh=0,co(),null}function $l(){if(Kl!==null){var _=Ia(Jh),S=Di.transition,B=Fn;try{if(Di.transition=null,Fn=16>_?16:_,Kl===null)var N=!1;else{if(_=Kl,Kl=null,Jh=0,(Jn&6)!==0)throw Error(o(331));var j=Jn;for(Jn|=4,kt=_.current;kt!==null;){var le=kt,Se=le.child;if((kt.flags&16)!==0){var Ge=le.deletions;if(Ge!==null){for(var ht=0;ht<Ge.length;ht++){var Rt=Ge[ht];for(kt=Rt;kt!==null;){var Jt=kt;switch(Jt.tag){case 0:case 11:case 15:Gc(8,Jt,le)}var Hn=Jt.child;if(Hn!==null)Hn.return=Jt,kt=Hn;else for(;kt!==null;){Jt=kt;var wn=Jt.sibling,Zn=Jt.return;if(ay(Jt),Jt===Rt){kt=null;break}if(wn!==null){wn.return=Zn,kt=wn;break}kt=Zn}}}var jt=le.alternate;if(jt!==null){var js=jt.child;if(js!==null){jt.child=null;do{var fa=js.sibling;js.sibling=null,js=fa}while(js!==null)}}kt=le}}if((le.subtreeFlags&2064)!==0&&Se!==null)Se.return=le,kt=Se;else e:for(;kt!==null;){if(le=kt,(le.flags&2048)!==0)switch(le.tag){case 0:case 11:case 15:Gc(9,le,le.return)}var et=le.sibling;if(et!==null){et.return=le.return,kt=et;break e}kt=le.return}}var Qe=_.current;for(kt=Qe;kt!==null;){Se=kt;var at=Se.child;if((Se.subtreeFlags&2064)!==0&&at!==null)at.return=Se,kt=at;else e:for(Se=Qe;kt!==null;){if(Ge=kt,(Ge.flags&2048)!==0)try{switch(Ge.tag){case 0:case 11:case 15:Qs(9,Ge)}}catch(on){Io(Ge,Ge.return,on)}if(Ge===Se){kt=null;break e}var Vt=Ge.sibling;if(Vt!==null){Vt.return=Ge.return,kt=Vt;break e}kt=Ge.return}}if(Jn=j,co(),ia&&typeof ia.onPostCommitFiberRoot=="function")try{ia.onPostCommitFiberRoot(Ou,_)}catch{}N=!0}return N}finally{Fn=B,Di.transition=S}}return!1}function $p(_,S,B){S=ey(B,S),S=Vx(_,S,1),Gu(_,S),S=yi(),_=qu(_,1),_!==null&&(ba(_,1,S),Vo(_,S))}function Io(_,S,B){if(_.tag===3)$p(_,_,B);else for(;S!==null;){if(S.tag===3){$p(S,_,B);break}else if(S.tag===1){var N=S.stateNode;if(typeof S.type.getDerivedStateFromError=="function"||typeof N.componentDidCatch=="function"&&(pl===null||!pl.has(N))){_=ey(B,_),_=H0(S,_,1),Gu(S,_),_=yi(),S=qu(S,1),S!==null&&(ba(S,1,_),Vo(S,_));break}}S=S.return}}function yy(_,S,B){var N=_.pingCache;N!==null&&N.delete(S),S=yi(),_.pingedLanes|=_.suspendedLanes&B,Gr===_&&(dr&B)===B&&(Lr===4||Lr===3&&(dr&130023424)===dr&&500>hr()-Qp?jc(_,0):Xh|=B),Vo(_,S)}function vy(_,S){S===0&&((_.mode&1)===0?S=1:(S=ri,ri<<=1,(ri&130023424)===0&&(ri=4194304)));var B=yi();_=qu(_,S),_!==null&&(ba(_,S,B),Vo(_,B))}function Yx(_){var S=_.memoizedState,B=0;S!==null&&(B=S.retryLane),vy(_,B)}function Xx(_,S){var B=0;switch(_.tag){case 13:var N=_.stateNode,j=_.memoizedState;j!==null&&(B=j.retryLane);break;case 19:N=_.stateNode;break;default:throw Error(o(314))}N!==null&&N.delete(S),vy(_,B)}var xy;xy=function(_,S,B){if(_!==null)if(_.memoizedProps!==S.pendingProps||Sn.current)Ms=!0;else{if((_.lanes&B)===0&&(S.flags&128)===0)return Ms=!1,K0(_,S,B);Ms=(_.flags&131072)!==0}else Ms=!1,fr&&(S.flags&1048576)!==0&&Fx(S,b0,S.index);switch(S.lanes=0,S.tag){case 2:var N=S.type;_!==null&&(_.alternate=null,S.alternate=null,S.flags|=2),_=S.pendingProps;var j=xi(S,xn.current);Ur(S,B),j=Zf(null,S,N,_,j,B);var le=Wu();return S.flags|=1,typeof j=="object"&&j!==null&&typeof j.render=="function"&&j.$$typeof===void 0?(S.tag=1,S.memoizedState=null,S.updateQueue=null,Ei(N)?(le=!0,Bn(S)):le=!1,S.memoizedState=j.state!==null&&j.state!==void 0?j.state:null,Wf(S),j.updater=C0,S.stateNode=j,j._reactInternals=S,zA(S,N,_,B),S=uo(null,S,N,!0,le,B)):(S.tag=0,fr&&le&&GA(S),Rr(null,S,j,B),S=S.child),S;case 16:N=S.elementType;e:{switch(_!==null&&(_.alternate=null,S.alternate=null,S.flags|=2),_=S.pendingProps,j=N._init,N=j(N._payload),S.type=N,j=S.tag=lC(N),_=ws(N,_),j){case 0:S=Uc(null,S,N,_,B);break e;case 1:S=Gh(null,S,N,_,B);break e;case 11:S=Yi(null,S,N,_,B);break e;case 14:S=Gi(null,S,N,ws(N.type,_),B);break e}throw Error(o(306,N,""))}return S;case 0:return N=S.type,j=S.pendingProps,j=S.elementType===N?j:ws(N,j),Uc(_,S,N,j,B);case 1:return N=S.type,j=S.pendingProps,j=S.elementType===N?j:ws(N,j),Gh(_,S,N,j,B);case 3:e:{if(Bp(S),_===null)throw Error(o(387));N=S.pendingProps,le=S.memoizedState,j=le.element,OA(_,S),w0(S,N,null,B);var Se=S.memoizedState;if(N=Se.element,we&&le.isDehydrated)if(le={element:N,isDehydrated:!1,cache:Se.cache,transitions:Se.transitions},S.updateQueue.baseState=le,S.memoizedState=le,S.flags&256){j=Error(o(423)),S=iy(_,S,N,B,j);break e}else if(N!==j){j=Error(o(424)),S=iy(_,S,N,B,j);break e}else for(we&&(Gs=vr(S.stateNode.containerInfo),wo=S,fr=!0,Ba=null,Kf=!1),B=Ux(S,null,N,B),S.child=B;B;)B.flags=B.flags&-3|4096,B=B.sibling;else{if($f(),N===j){S=Qo(_,S,B);break e}Rr(_,S,N,B)}S=S.child}return S;case 5:return zx(S),_===null&&Qu(S),N=S.type,j=S.pendingProps,le=_!==null?_.memoizedProps:null,Se=j.children,J(N,j)?Se=null:le!==null&&J(N,le)&&(S.flags|=32),Co(_,S),Rr(_,S,Se,B),S.child;case 6:return _===null&&Qu(S),null;case 13:return ry(_,S,B);case 4:return R0(S,S.stateNode.containerInfo),N=S.pendingProps,_===null?S.child=Dc(S,null,N,B):Rr(_,S,N,B),S.child;case 11:return N=S.type,j=S.pendingProps,j=S.elementType===N?j:ws(N,j),Yi(_,S,N,j,B);case 7:return Rr(_,S,S.pendingProps,B),S.child;case 8:return Rr(_,S,S.pendingProps.children,B),S.child;case 12:return Rr(_,S,S.pendingProps.children,B),S.child;case 10:e:{if(N=S.type._context,j=S.pendingProps,le=S.memoizedProps,Se=j.value,Rc(S,N,Se),le!==null)if(_s(le.value,Se)){if(le.children===j.children&&!Sn.current){S=Qo(_,S,B);break e}}else for(le=S.child,le!==null&&(le.return=S);le!==null;){var Ge=le.dependencies;if(Ge!==null){Se=le.child;for(var ht=Ge.firstContext;ht!==null;){if(ht.context===N){if(le.tag===1){ht=Lc(-1,B&-B),ht.tag=2;var Rt=le.updateQueue;if(Rt!==null){Rt=Rt.shared;var Jt=Rt.pending;Jt===null?ht.next=ht:(ht.next=Jt.next,Jt.next=ht),Rt.pending=ht}}le.lanes|=B,ht=le.alternate,ht!==null&&(ht.lanes|=B),us(le.return,B,S),Ge.lanes|=B;break}ht=ht.next}}else if(le.tag===10)Se=le.type===S.type?null:le.child;else if(le.tag===18){if(Se=le.return,Se===null)throw Error(o(341));Se.lanes|=B,Ge=Se.alternate,Ge!==null&&(Ge.lanes|=B),us(Se,B,S),Se=le.sibling}else Se=le.child;if(Se!==null)Se.return=le;else for(Se=le;Se!==null;){if(Se===S){Se=null;break}if(le=Se.sibling,le!==null){le.return=Se.return,Se=le;break}Se=Se.return}le=Se}Rr(_,S,j.children,B),S=S.child}return S;case 9:return j=S.type,N=S.pendingProps.children,Ur(S,B),j=xr(j),N=N(j),S.flags|=1,Rr(_,S,N,B),S.child;case 14:return N=S.type,j=ws(N,S.pendingProps),j=ws(N.type,j),Gi(_,S,N,j,B);case 15:return Nc(_,S,S.type,S.pendingProps,B);case 17:return N=S.type,j=S.pendingProps,j=S.elementType===N?j:ws(N,j),_!==null&&(_.alternate=null,S.alternate=null,S.flags|=2),S.tag=1,Ei(N)?(_=!0,Bn(S)):_=!1,Ur(S,B),Dx(S,N,j),zA(S,N,j,B),uo(null,S,N,!0,_,B);case 19:return Qh(_,S,B);case 22:return Hs(_,S,B)}throw Error(o(156,S.tag))};function Z0(_,S){return na(_,S)}function qx(_,S,B,N){this.tag=_,this.key=B,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=S,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=N,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ha(_,S,B,N){return new qx(_,S,B,N)}function eg(_){return _=_.prototype,!(!_||!_.isReactComponent)}function lC(_){if(typeof _=="function")return eg(_)?1:0;if(_!=null){if(_=_.$$typeof,_===A)return 11;if(_===E)return 14}return 2}function Kc(_,S){var B=_.alternate;return B===null?(B=ha(_.tag,S,_.key,_.mode),B.elementType=_.elementType,B.type=_.type,B.stateNode=_.stateNode,B.alternate=_,_.alternate=B):(B.pendingProps=S,B.type=_.type,B.flags=0,B.subtreeFlags=0,B.deletions=null),B.flags=_.flags&14680064,B.childLanes=_.childLanes,B.lanes=_.lanes,B.child=_.child,B.memoizedProps=_.memoizedProps,B.memoizedState=_.memoizedState,B.updateQueue=_.updateQueue,S=_.dependencies,B.dependencies=S===null?null:{lanes:S.lanes,firstContext:S.firstContext},B.sibling=_.sibling,B.index=_.index,B.ref=_.ref,B}function tg(_,S,B,N,j,le){var Se=2;if(N=_,typeof _=="function")eg(_)&&(Se=1);else if(typeof _=="string")Se=5;else e:switch(_){case u:return ef(B.children,j,le,S);case h:Se=8,j|=8;break;case f:return _=ha(12,B,S,j|2),_.elementType=f,_.lanes=le,_;case g:return _=ha(13,B,S,j),_.elementType=g,_.lanes=le,_;case y:return _=ha(19,B,S,j),_.elementType=y,_.lanes=le,_;case C:return Yp(B,j,le,S);default:if(typeof _=="object"&&_!==null)switch(_.$$typeof){case d:Se=10;break e;case m:Se=9;break e;case A:Se=11;break e;case E:Se=14;break e;case x:Se=16,N=null;break e}throw Error(o(130,_==null?_:typeof _,""))}return S=ha(Se,B,S,j),S.elementType=_,S.type=N,S.lanes=le,S}function ef(_,S,B,N){return _=ha(7,_,N,S),_.lanes=B,_}function Yp(_,S,B,N){return _=ha(22,_,N,S),_.elementType=C,_.lanes=B,_.stateNode={},_}function ng(_,S,B){return _=ha(6,_,null,S),_.lanes=B,_}function ig(_,S,B){return S=ha(4,_.children!==null?_.children:[],_.key,S),S.lanes=B,S.stateNode={containerInfo:_.containerInfo,pendingChildren:null,implementation:_.implementation},S}function rg(_,S,B,N,j){this.tag=S,this.containerInfo=_,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=ge,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Mh(0),this.expirationTimes=Mh(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Mh(0),this.identifierPrefix=N,this.onRecoverableError=j,we&&(this.mutableSourceEagerHydrationData=null)}function Jx(_,S,B,N,j,le,Se,Ge,ht){return _=new rg(_,S,B,Ge,ht),S===1?(S=1,le===!0&&(S|=8)):S=0,le=ha(3,null,null,S),_.current=le,le.stateNode=_,le.memoizedState={element:N,isDehydrated:B,cache:null,transitions:null},Wf(le),_}function Zx(_){if(!_)return yn;_=_._reactInternals;e:{if(R(_)!==_||_.tag!==1)throw Error(o(170));var S=_;do{switch(S.tag){case 3:S=S.stateNode.context;break e;case 1:if(Ei(S.type)){S=S.stateNode.__reactInternalMemoizedMergedChildContext;break e}}S=S.return}while(S!==null);throw Error(o(171))}if(_.tag===1){var B=_.type;if(Ei(B))return zi(_,B,S)}return S}function eE(_){var S=_._reactInternals;if(S===void 0)throw typeof _.render=="function"?Error(o(188)):(_=Object.keys(_).join(","),Error(o(268,_)));return _=k(S),_===null?null:_.stateNode}function Fa(_,S){if(_=_.memoizedState,_!==null&&_.dehydrated!==null){var B=_.retryLane;_.retryLane=B!==0&&B<S?B:S}}function Xp(_,S){Fa(_,S),(_=_.alternate)&&Fa(_,S)}function sg(_){return _=k(_),_===null?null:_.stateNode}function tE(){return null}return t.attemptContinuousHydration=function(_){if(_.tag===13){var S=yi();fo(_,134217728,S),Xp(_,134217728)}},t.attemptHydrationAtCurrentPriority=function(_){if(_.tag===13){var S=yi(),B=ml(_);fo(_,B,S),Xp(_,B)}},t.attemptSynchronousHydration=function(_){switch(_.tag){case 3:var S=_.stateNode;if(S.current.memoizedState.isDehydrated){var B=Ul(S.pendingLanes);B!==0&&(zs(S,B|1),Vo(S,hr()),(Jn&6)===0&&(qh(),co()))}break;case 13:var N=yi();hd(function(){return fo(_,1,N)}),Xp(_,1)}},t.batchedUpdates=function(_,S){var B=Jn;Jn|=1;try{return _(S)}finally{Jn=B,Jn===0&&(qh(),Hl&&co())}},t.createComponentSelector=function(_){return{$$typeof:Up,value:_}},t.createContainer=function(_,S,B,N,j,le,Se){return Jx(_,S,!1,null,B,N,j,le,Se)},t.createHasPseudoClassSelector=function(_){return{$$typeof:jh,value:_}},t.createHydrationContainer=function(_,S,B,N,j,le,Se,Ge,ht){return _=Jx(B,N,!0,_,j,le,Se,Ge,ht),_.context=Zx(null),B=_.current,N=yi(),j=ml(B),le=Lc(N,j),le.callback=S??null,Gu(B,le),_.current.lanes=j,ba(_,j,N),Vo(_,N),_},t.createPortal=function(_,S,B){var N=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:c,key:N==null?null:""+N,children:_,containerInfo:S,implementation:B}},t.createRoleSelector=function(_){return{$$typeof:Kh,value:_}},t.createTestNameSelector=function(_){return{$$typeof:Hc,value:_}},t.createTextSelector=function(_){return{$$typeof:ad,value:_}},t.deferredUpdates=function(_){var S=Fn,B=Di.transition;try{return Di.transition=null,Fn=16,_()}finally{Fn=S,Di.transition=B}},t.discreteUpdates=function(_,S,B,N,j){var le=Fn,Se=Di.transition;try{return Di.transition=null,Fn=1,_(S,B,N,j)}finally{Fn=le,Di.transition=Se,Jn===0&&qh()}},t.findAllNodes=Qc,t.findBoundingRects=function(_,S){if(!V)throw Error(o(363));S=Qc(_,S),_=[];for(var B=0;B<S.length;B++)_.push(Re(S[B]));for(S=_.length-1;0<S;S--){B=_[S];for(var N=B.x,j=N+B.width,le=B.y,Se=le+B.height,Ge=S-1;0<=Ge;Ge--)if(S!==Ge){var ht=_[Ge],Rt=ht.x,Jt=Rt+ht.width,Hn=ht.y,wn=Hn+ht.height;if(N>=Rt&&le>=Hn&&j<=Jt&&Se<=wn){_.splice(S,1);break}else if(N!==Rt||B.width!==ht.width||wn<le||Hn>Se){if(!(le!==Hn||B.height!==ht.height||Jt<N||Rt>j)){Rt>N&&(ht.width+=Rt-N,ht.x=N),Jt<j&&(ht.width=j-Rt),_.splice(S,1);break}}else{Hn>le&&(ht.height+=Hn-le,ht.y=le),wn<Se&&(ht.height=Se-Hn),_.splice(S,1);break}}}return _},t.findHostInstance=eE,t.findHostInstanceWithNoPortals=function(_){return _=F(_),_=_!==null?U(_):null,_===null?null:_.stateNode},t.findHostInstanceWithWarning=function(_){return eE(_)},t.flushControlled=function(_){var S=Jn;Jn|=1;var B=Di.transition,N=Fn;try{Di.transition=null,Fn=1,_()}finally{Fn=N,Di.transition=B,Jn=S,Jn===0&&(qh(),co())}},t.flushPassiveEffects=$l,t.flushSync=hd,t.focusWithin=function(_,S){if(!V)throw Error(o(363));for(_=zp(_),S=la(_,S),S=Array.from(S),_=0;_<S.length;){var B=S[_++];if(!Fe(B)){if(B.tag===5&&it(B.stateNode))return!0;for(B=B.child;B!==null;)S.push(B),B=B.sibling}}return!1},t.getCurrentUpdatePriority=function(){return Fn},t.getFindAllNodesFailureDescription=function(_,S){if(!V)throw Error(o(363));var B=0,N=[];_=[zp(_),0];for(var j=0;j<_.length;){var le=_[j++],Se=_[j++],Ge=S[Se];if((le.tag!==5||!Fe(le))&&(Gp(le,Ge)&&(N.push(Yu(Ge)),Se++,Se>B&&(B=Se)),Se<S.length))for(le=le.child;le!==null;)_.push(le,Se),le=le.sibling}if(B<S.length){for(_=[];B<S.length;B++)_.push(Yu(S[B]));return`findAllNodes was able to match part of the selector:
  `+(N.join(" > ")+`

No matching component was found for:
  `)+_.join(" > ")}return null},t.getPublicRootInstance=function(_){if(_=_.current,!_.child)return null;switch(_.child.tag){case 5:return $(_.child.stateNode);default:return _.child.stateNode}},t.injectIntoDevTools=function(_){if(_={bundleType:_.bundleType,version:_.version,rendererPackageName:_.rendererPackageName,rendererConfig:_.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:a.ReactCurrentDispatcher,findHostInstanceByFiber:sg,findFiberByHostInstance:_.findFiberByHostInstance||tE,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.0.0-fc46dba67-20220329"},typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u")_=!1;else{var S=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(S.isDisabled||!S.supportsFiber)_=!0;else{try{Ou=S.inject(_),ia=S}catch{}_=!!S.checkDCE}}return _},t.isAlreadyRendering=function(){return!1},t.observeVisibleRects=function(_,S,B,N){if(!V)throw Error(o(363));_=Qc(_,S);var j=$e(_,B,N).disconnect;return{disconnect:function(){j()}}},t.registerMutableSourceForHydration=function(_,S){var B=S._getVersion;B=B(S._source),_.mutableSourceEagerHydrationData==null?_.mutableSourceEagerHydrationData=[S,B]:_.mutableSourceEagerHydrationData.push(S,B)},t.runWithPriority=function(_,S){var B=Fn;try{return Fn=_,S()}finally{Fn=B}},t.shouldError=function(){return null},t.shouldSuspend=function(){return!1},t.updateContainer=function(_,S,B,N){var j=S.current,le=yi(),Se=ml(j);return B=Zx(B),S.context===null?S.context=B:S.pendingContext=B,S=Lc(le,Se),S.payload={element:_},N=N===void 0?null:N,N!==null&&(S.callback=N),Gu(j,S),_=fo(j,Se,le),_!==null&&_0(_,j,Se),Se},t}),bT}var OB;function xie(){return OB||(OB=1,wT.exports=vie()),wT.exports}var Eie=xie();const _ie=AA(Eie);var NB=Pz(),Sie=Object.freeze({__proto__:null});const q6={},Or=i=>void Object.assign(q6,i);function wie(i,e){function t(u,{args:h=[],attach:f,...d},m){let A=`${u[0].toUpperCase()}${u.slice(1)}`,g;if(u==="primitive"){if(d.object===void 0)throw new Error("R3F: Primitives without 'object' are invalid!");const y=d.object;g=v1(y,{type:u,root:m,attach:f,primitive:!0})}else{const y=q6[A];if(!y)throw new Error(`R3F: ${A} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(!Array.isArray(h))throw new Error("R3F: The args prop must be an array!");g=v1(new y(...h),{type:u,root:m,attach:f,memoizedProps:{args:h}})}return g.__r3f.attach===void 0&&(g.isBufferGeometry?g.__r3f.attach="geometry":g.isMaterial&&(g.__r3f.attach="material")),A!=="inject"&&RT(g,d),g}function n(u,h){let f=!1;if(h){var d,m;(d=h.__r3f)!=null&&d.attach?MT(u,h,h.__r3f.attach):h.isObject3D&&u.isObject3D&&(u.add(h),f=!0),f||(m=u.__r3f)==null||m.objects.push(h),h.__r3f||v1(h,{}),h.__r3f.parent=u,BM(h),x1(h)}}function r(u,h,f){let d=!1;if(h){var m,A;if((m=h.__r3f)!=null&&m.attach)MT(u,h,h.__r3f.attach);else if(h.isObject3D&&u.isObject3D){h.parent=u,h.dispatchEvent({type:"added"}),u.dispatchEvent({type:"childadded",child:h});const g=u.children.filter(E=>E!==h),y=g.indexOf(f);u.children=[...g.slice(0,y),h,...g.slice(y)],d=!0}d||(A=u.__r3f)==null||A.objects.push(h),h.__r3f||v1(h,{}),h.__r3f.parent=u,BM(h),x1(h)}}function s(u,h,f=!1){u&&[...u].forEach(d=>o(h,d,f))}function o(u,h,f){if(h){var d,m,A;if(h.__r3f&&(h.__r3f.parent=null),(d=u.__r3f)!=null&&d.objects&&(u.__r3f.objects=u.__r3f.objects.filter(C=>C!==h)),(m=h.__r3f)!=null&&m.attach)QB(u,h,h.__r3f.attach);else if(h.isObject3D&&u.isObject3D){var g;u.remove(h),(g=h.__r3f)!=null&&g.root&&Mie(j_(h),h)}const E=(A=h.__r3f)==null?void 0:A.primitive,x=!E&&(f===void 0?h.dispose!==null:f);if(!E){var y;s((y=h.__r3f)==null?void 0:y.objects,h,x),s(h.children,h,x)}if(delete h.__r3f,x&&h.dispose&&h.type!=="Scene"){const C=()=>{try{h.dispose()}catch{}};typeof IS_REACT_ACT_ENVIRONMENT>"u"?NB.unstable_scheduleCallback(NB.unstable_IdlePriority,C):C()}x1(u)}}function a(u,h,f,d){var m;const A=(m=u.__r3f)==null?void 0:m.parent;if(!A)return;const g=t(h,f,u.__r3f.root);if(u.children){for(const y of u.children)y.__r3f&&n(g,y);u.children=u.children.filter(y=>!y.__r3f)}u.__r3f.objects.forEach(y=>n(g,y)),u.__r3f.objects=[],u.__r3f.autoRemovedBeforeAppend||o(A,u),g.parent&&(g.__r3f.autoRemovedBeforeAppend=!0),n(A,g),g.raycast&&g.__r3f.eventCount&&j_(g).getState().internal.interaction.push(g),[d,d.alternate].forEach(y=>{y!==null&&(y.stateNode=g,y.ref&&(typeof y.ref=="function"?y.ref(g):y.ref.current=g))})}const l=()=>{};return{reconciler:_ie({createInstance:t,removeChild:o,appendChild:n,appendInitialChild:n,insertBefore:r,supportsMutation:!0,isPrimaryRenderer:!1,supportsPersistence:!1,supportsHydration:!1,noTimeout:-1,appendChildToContainer:(u,h)=>{if(!h)return;const f=u.getState().scene;f.__r3f&&(f.__r3f.root=u,n(f,h))},removeChildFromContainer:(u,h)=>{h&&o(u.getState().scene,h)},insertInContainerBefore:(u,h,f)=>{if(!h||!f)return;const d=u.getState().scene;d.__r3f&&r(d,h,f)},getRootHostContext:()=>null,getChildHostContext:u=>u,finalizeInitialChildren(u){var h;return!!((h=u==null?void 0:u.__r3f)!=null?h:{}).handlers},prepareUpdate(u,h,f,d){var m;if(((m=u==null?void 0:u.__r3f)!=null?m:{}).primitive&&d.object&&d.object!==u)return[!0];{const{args:g=[],children:y,...E}=d,{args:x=[],children:C,...T}=f;if(!Array.isArray(g))throw new Error("R3F: the args prop must be an array!");if(g.some((M,L)=>M!==x[L]))return[!0];const I=zz(u,E,T,!0);return I.changes.length?[!1,I]:null}},commitUpdate(u,[h,f],d,m,A,g){h?a(u,d,A,g):RT(u,f)},commitMount(u,h,f,d){var m;const A=(m=u.__r3f)!=null?m:{};u.raycast&&A.handlers&&A.eventCount&&j_(u).getState().internal.interaction.push(u)},getPublicInstance:u=>u,prepareForCommit:()=>null,preparePortalMount:u=>v1(u.getState().scene),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance(u){var h;const{attach:f,parent:d}=(h=u.__r3f)!=null?h:{};f&&d&&QB(d,u,f),u.isObject3D&&(u.visible=!1),x1(u)},unhideInstance(u,h){var f;const{attach:d,parent:m}=(f=u.__r3f)!=null?f:{};d&&m&&MT(m,u,d),(u.isObject3D&&h.visible==null||h.visible)&&(u.visible=!0),x1(u)},createTextInstance:l,hideTextInstance:l,unhideTextInstance:l,getCurrentEventPriority:()=>e?e():L1.DefaultEventPriority,beforeActiveInstanceBlur:()=>{},afterActiveInstanceBlur:()=>{},detachDeletedInstance:()=>{},now:typeof performance<"u"&&gr.fun(performance.now)?performance.now:gr.fun(Date.now)?Date.now:()=>0,scheduleTimeout:gr.fun(setTimeout)?setTimeout:void 0,cancelTimeout:gr.fun(clearTimeout)?clearTimeout:void 0}),applyProps:RT}}var UB,zB;const IT=i=>"colorSpace"in i||"outputColorSpace"in i,Bz=()=>{var i;return(i=q6.ColorManagement)!=null?i:null},Dz=i=>i&&i.isOrthographicCamera,Cie=i=>i&&i.hasOwnProperty("current"),wA=typeof window<"u"&&((UB=window.document)!=null&&UB.createElement||((zB=window.navigator)==null?void 0:zB.product)==="ReactNative")?w.useLayoutEffect:w.useEffect;function kz(i){const e=w.useRef(i);return wA(()=>void(e.current=i),[i]),e}function Tie({set:i}){return wA(()=>(i(new Promise(()=>null)),()=>i(!1)),[i]),null}class Fz extends w.Component{constructor(...e){super(...e),this.state={error:!1}}componentDidCatch(e){this.props.set(e)}render(){return this.state.error?null:this.props.children}}Fz.getDerivedStateFromError=()=>({error:!0});const Oz="__default",GB=new Map,bie=i=>i&&!!i.memoized&&!!i.changes;function Nz(i){var e;const t=typeof window<"u"?(e=window.devicePixelRatio)!=null?e:2:1;return Array.isArray(i)?Math.min(Math.max(i[0],t),i[1]):i}const y1=i=>{var e;return(e=i.__r3f)==null?void 0:e.root.getState()};function j_(i){let e=i.__r3f.root;for(;e.getState().previousRoot;)e=e.getState().previousRoot;return e}const gr={obj:i=>i===Object(i)&&!gr.arr(i)&&typeof i!="function",fun:i=>typeof i=="function",str:i=>typeof i=="string",num:i=>typeof i=="number",boo:i=>typeof i=="boolean",und:i=>i===void 0,arr:i=>Array.isArray(i),equ(i,e,{arrays:t="shallow",objects:n="reference",strict:r=!0}={}){if(typeof i!=typeof e||!!i!=!!e)return!1;if(gr.str(i)||gr.num(i)||gr.boo(i))return i===e;const s=gr.obj(i);if(s&&n==="reference")return i===e;const o=gr.arr(i);if(o&&t==="reference")return i===e;if((o||s)&&i===e)return!0;let a;for(a in i)if(!(a in e))return!1;if(s&&t==="shallow"&&n==="shallow"){for(a in r?e:i)if(!gr.equ(i[a],e[a],{strict:r,objects:"reference"}))return!1}else for(a in r?e:i)if(i[a]!==e[a])return!1;if(gr.und(a)){if(o&&i.length===0&&e.length===0||s&&Object.keys(i).length===0&&Object.keys(e).length===0)return!0;if(i!==e)return!1}return!0}};function J6(i){const e={nodes:{},materials:{}};return i&&i.traverse(t=>{t.name&&(e.nodes[t.name]=t),t.material&&!e.materials[t.material.name]&&(e.materials[t.material.name]=t.material)}),e}function Uz(i){i.dispose&&i.type!=="Scene"&&i.dispose();for(const e in i)e.dispose==null||e.dispose(),delete i[e]}function v1(i,e){const t=i;return t.__r3f={type:"",root:null,previousAttach:null,memoizedProps:{},eventCount:0,handlers:{},objects:[],parent:null,...e},i}function PM(i,e){let t=i;if(e.includes("-")){const n=e.split("-"),r=n.pop();return t=n.reduce((s,o)=>s[o],i),{target:t,key:r}}else return{target:t,key:e}}const HB=/-\d+$/;function MT(i,e,t){if(gr.str(t)){if(HB.test(t)){const s=t.replace(HB,""),{target:o,key:a}=PM(i,s);Array.isArray(o[a])||(o[a]=[])}const{target:n,key:r}=PM(i,t);e.__r3f.previousAttach=n[r],n[r]=e}else e.__r3f.previousAttach=t(i,e)}function QB(i,e,t){var n,r;if(gr.str(t)){const{target:s,key:o}=PM(i,t),a=e.__r3f.previousAttach;a===void 0?delete s[o]:s[o]=a}else(n=e.__r3f)==null||n.previousAttach==null||n.previousAttach(i,e);(r=e.__r3f)==null||delete r.previousAttach}function zz(i,{children:e,key:t,ref:n,...r},{children:s,key:o,ref:a,...l}={},c=!1){const u=i.__r3f,h=Object.entries(r),f=[];if(c){const m=Object.keys(l);for(let A=0;A<m.length;A++)r.hasOwnProperty(m[A])||h.unshift([m[A],Oz+"remove"])}h.forEach(([m,A])=>{var g;if((g=i.__r3f)!=null&&g.primitive&&m==="object"||gr.equ(A,l[m]))return;if(/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/.test(m))return f.push([m,A,!0,[]]);let y=[];m.includes("-")&&(y=m.split("-")),f.push([m,A,!1,y]);for(const E in r){const x=r[E];E.startsWith(`${m}-`)&&f.push([E,x,!1,E.split("-")])}});const d={...r};return u!=null&&u.memoizedProps&&u!=null&&u.memoizedProps.args&&(d.args=u.memoizedProps.args),u!=null&&u.memoizedProps&&u!=null&&u.memoizedProps.attach&&(d.attach=u.memoizedProps.attach),{memoized:d,changes:f}}function RT(i,e){var t;const n=i.__r3f,r=n==null?void 0:n.root,s=r==null||r.getState==null?void 0:r.getState(),{memoized:o,changes:a}=bie(e)?e:zz(i,e),l=n==null?void 0:n.eventCount;i.__r3f&&(i.__r3f.memoizedProps=o);for(let f=0;f<a.length;f++){let[d,m,A,g]=a[f];if(IT(i)){const C="srgb",T="srgb-linear";d==="encoding"?(d="colorSpace",m=m===3001?C:T):d==="outputEncoding"&&(d="outputColorSpace",m=m===3001?C:T)}let y=i,E=y[d];if(g.length&&(E=g.reduce((x,C)=>x[C],i),!(E&&E.set))){const[x,...C]=g.reverse();y=C.reverse().reduce((T,I)=>T[I],i),d=x}if(m===Oz+"remove")if(y.constructor){let x=GB.get(y.constructor);x||(x=new y.constructor,GB.set(y.constructor,x)),m=x[d]}else m=0;if(A&&n)m?n.handlers[d]=m:delete n.handlers[d],n.eventCount=Object.keys(n.handlers).length;else if(E&&E.set&&(E.copy||E instanceof zm)){if(Array.isArray(m))E.fromArray?E.fromArray(m):E.set(...m);else if(E.copy&&m&&m.constructor&&E.constructor===m.constructor)E.copy(m);else if(m!==void 0){var c;const x=(c=E)==null?void 0:c.isColor;!x&&E.setScalar?E.setScalar(m):E instanceof zm&&m instanceof zm?E.mask=m.mask:E.set(m),!Bz()&&s&&!s.linear&&x&&E.convertSRGBToLinear()}}else{var u;if(y[d]=m,(u=y[d])!=null&&u.isTexture&&y[d].format===gi&&y[d].type===Zi&&s){const x=y[d];IT(x)&&IT(s.gl)?x.colorSpace=s.gl.outputColorSpace:x.encoding=s.gl.outputEncoding}}x1(i)}if(n&&n.parent&&i.raycast&&l!==n.eventCount){const f=j_(i).getState().internal,d=f.interaction.indexOf(i);d>-1&&f.interaction.splice(d,1),n.eventCount&&f.interaction.push(i)}return!(a.length===1&&a[0][0]==="onUpdate")&&a.length&&(t=i.__r3f)!=null&&t.parent&&BM(i),i}function x1(i){var e,t;const n=(e=i.__r3f)==null||(t=e.root)==null||t.getState==null?void 0:t.getState();n&&n.internal.frames===0&&n.invalidate()}function BM(i){i.onUpdate==null||i.onUpdate(i)}function Gz(i,e){i.manual||(Dz(i)?(i.left=e.width/-2,i.right=e.width/2,i.top=e.height/2,i.bottom=e.height/-2):i.aspect=e.width/e.height,i.updateProjectionMatrix(),i.updateMatrixWorld())}function v3(i){return(i.eventObject||i.object).uuid+"/"+i.index+i.instanceId}function Iie(){var i;const e=typeof self<"u"&&self||typeof window<"u"&&window;if(!e)return L1.DefaultEventPriority;switch((i=e.event)==null?void 0:i.type){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return L1.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return L1.ContinuousEventPriority;default:return L1.DefaultEventPriority}}function Hz(i,e,t,n){const r=t.get(e);r&&(t.delete(e),t.size===0&&(i.delete(n),r.target.releasePointerCapture(n)))}function Mie(i,e){const{internal:t}=i.getState();t.interaction=t.interaction.filter(n=>n!==e),t.initialHits=t.initialHits.filter(n=>n!==e),t.hovered.forEach((n,r)=>{(n.eventObject===e||n.object===e)&&t.hovered.delete(r)}),t.capturedMap.forEach((n,r)=>{Hz(t.capturedMap,e,n,r)})}function Qz(i){function e(l){const{internal:c}=i.getState(),u=l.offsetX-c.initialClick[0],h=l.offsetY-c.initialClick[1];return Math.round(Math.sqrt(u*u+h*h))}function t(l){return l.filter(c=>["Move","Over","Enter","Out","Leave"].some(u=>{var h;return(h=c.__r3f)==null?void 0:h.handlers["onPointer"+u]}))}function n(l,c){const u=i.getState(),h=new Set,f=[],d=c?c(u.internal.interaction):u.internal.interaction;for(let y=0;y<d.length;y++){const E=y1(d[y]);E&&(E.raycaster.camera=void 0)}u.previousRoot||u.events.compute==null||u.events.compute(l,u);function m(y){const E=y1(y);if(!E||!E.events.enabled||E.raycaster.camera===null)return[];if(E.raycaster.camera===void 0){var x;E.events.compute==null||E.events.compute(l,E,(x=E.previousRoot)==null?void 0:x.getState()),E.raycaster.camera===void 0&&(E.raycaster.camera=null)}return E.raycaster.camera?E.raycaster.intersectObject(y,!0):[]}let A=d.flatMap(m).sort((y,E)=>{const x=y1(y.object),C=y1(E.object);return!x||!C?y.distance-E.distance:C.events.priority-x.events.priority||y.distance-E.distance}).filter(y=>{const E=v3(y);return h.has(E)?!1:(h.add(E),!0)});u.events.filter&&(A=u.events.filter(A,u));for(const y of A){let E=y.object;for(;E;){var g;(g=E.__r3f)!=null&&g.eventCount&&f.push({...y,eventObject:E}),E=E.parent}}if("pointerId"in l&&u.internal.capturedMap.has(l.pointerId))for(let y of u.internal.capturedMap.get(l.pointerId).values())h.has(v3(y.intersection))||f.push(y.intersection);return f}function r(l,c,u,h){const f=i.getState();if(l.length){const d={stopped:!1};for(const m of l){const A=y1(m.object)||f,{raycaster:g,pointer:y,camera:E,internal:x}=A,C=new H(y.x,y.y,0).unproject(E),T=P=>{var F,k;return(F=(k=x.capturedMap.get(P))==null?void 0:k.has(m.eventObject))!=null?F:!1},I=P=>{const F={intersection:m,target:c.target};x.capturedMap.has(P)?x.capturedMap.get(P).set(m.eventObject,F):x.capturedMap.set(P,new Map([[m.eventObject,F]])),c.target.setPointerCapture(P)},M=P=>{const F=x.capturedMap.get(P);F&&Hz(x.capturedMap,m.eventObject,F,P)};let L={};for(let P in c){let F=c[P];typeof F!="function"&&(L[P]=F)}let R={...m,...L,pointer:y,intersections:l,stopped:d.stopped,delta:u,unprojectedPoint:C,ray:g.ray,camera:E,stopPropagation(){const P="pointerId"in c&&x.capturedMap.get(c.pointerId);if((!P||P.has(m.eventObject))&&(R.stopped=d.stopped=!0,x.hovered.size&&Array.from(x.hovered.values()).find(F=>F.eventObject===m.eventObject))){const F=l.slice(0,l.indexOf(m));s([...F,m])}},target:{hasPointerCapture:T,setPointerCapture:I,releasePointerCapture:M},currentTarget:{hasPointerCapture:T,setPointerCapture:I,releasePointerCapture:M},nativeEvent:c};if(h(R),d.stopped===!0)break}}return l}function s(l){const{internal:c}=i.getState();for(const u of c.hovered.values())if(!l.length||!l.find(h=>h.object===u.object&&h.index===u.index&&h.instanceId===u.instanceId)){const f=u.eventObject.__r3f,d=f==null?void 0:f.handlers;if(c.hovered.delete(v3(u)),f!=null&&f.eventCount){const m={...u,intersections:l};d.onPointerOut==null||d.onPointerOut(m),d.onPointerLeave==null||d.onPointerLeave(m)}}}function o(l,c){for(let u=0;u<c.length;u++){const h=c[u].__r3f;h==null||h.handlers.onPointerMissed==null||h.handlers.onPointerMissed(l)}}function a(l){switch(l){case"onPointerLeave":case"onPointerCancel":return()=>s([]);case"onLostPointerCapture":return c=>{const{internal:u}=i.getState();"pointerId"in c&&u.capturedMap.has(c.pointerId)&&requestAnimationFrame(()=>{u.capturedMap.has(c.pointerId)&&(u.capturedMap.delete(c.pointerId),s([]))})}}return function(u){const{onPointerMissed:h,internal:f}=i.getState();f.lastEvent.current=u;const d=l==="onPointerMove",m=l==="onClick"||l==="onContextMenu"||l==="onDoubleClick",g=n(u,d?t:void 0),y=m?e(u):0;l==="onPointerDown"&&(f.initialClick=[u.offsetX,u.offsetY],f.initialHits=g.map(x=>x.eventObject)),m&&!g.length&&y<=2&&(o(u,f.interaction),h&&h(u)),d&&s(g);function E(x){const C=x.eventObject,T=C.__r3f,I=T==null?void 0:T.handlers;if(T!=null&&T.eventCount)if(d){if(I.onPointerOver||I.onPointerEnter||I.onPointerOut||I.onPointerLeave){const M=v3(x),L=f.hovered.get(M);L?L.stopped&&x.stopPropagation():(f.hovered.set(M,x),I.onPointerOver==null||I.onPointerOver(x),I.onPointerEnter==null||I.onPointerEnter(x))}I.onPointerMove==null||I.onPointerMove(x)}else{const M=I[l];M?(!m||f.initialHits.includes(C))&&(o(u,f.interaction.filter(L=>!f.initialHits.includes(L))),M(x)):m&&f.initialHits.includes(C)&&o(u,f.interaction.filter(L=>!f.initialHits.includes(L)))}}r(g,u,y,E)}}return{handlePointer:a}}const Rie=["set","get","setSize","setFrameloop","setDpr","events","invalidate","advance","size","viewport"],Vz=i=>!!(i!=null&&i.render),t0=w.createContext(null),Lie=(i,e)=>{const t=Iz((a,l)=>{const c=new H,u=new H,h=new H;function f(y=l().camera,E=u,x=l().size){const{width:C,height:T,top:I,left:M}=x,L=C/T;E.isVector3?h.copy(E):h.set(...E);const R=y.getWorldPosition(c).distanceTo(h);if(Dz(y))return{width:C/y.zoom,height:T/y.zoom,top:I,left:M,factor:1,distance:R,aspect:L};{const P=y.fov*Math.PI/180,F=2*Math.tan(P/2)*R,k=F*(C/T);return{width:k,height:F,top:I,left:M,factor:C/k,distance:R,aspect:L}}}let d;const m=y=>a(E=>({performance:{...E.performance,current:y}})),A=new Ue;return{set:a,get:l,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},xr:null,scene:null,invalidate:(y=1)=>i(l(),y),advance:(y,E)=>e(y,E,l()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new $w,pointer:A,mouse:A,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const y=l();d&&clearTimeout(d),y.performance.current!==y.performance.min&&m(y.performance.min),d=setTimeout(()=>m(l().performance.max),y.performance.debounce)}},size:{width:0,height:0,top:0,left:0,updateStyle:!1},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:f},setEvents:y=>a(E=>({...E,events:{...E.events,...y}})),setSize:(y,E,x,C,T)=>{const I=l().camera,M={width:y,height:E,top:C||0,left:T||0,updateStyle:x};a(L=>({size:M,viewport:{...L.viewport,...f(I,u,M)}}))},setDpr:y=>a(E=>{const x=Nz(y);return{viewport:{...E.viewport,dpr:x,initialDpr:E.viewport.initialDpr||x}}}),setFrameloop:(y="always")=>{const E=l().clock;E.stop(),E.elapsedTime=0,y!=="never"&&(E.start(),E.elapsedTime=0),a(()=>({frameloop:y}))},previousRoot:void 0,internal:{active:!1,priority:0,frames:0,lastEvent:w.createRef(),interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,subscribe:(y,E,x)=>{const C=l().internal;return C.priority=C.priority+(E>0?1:0),C.subscribers.push({ref:y,priority:E,store:x}),C.subscribers=C.subscribers.sort((T,I)=>T.priority-I.priority),()=>{const T=l().internal;T!=null&&T.subscribers&&(T.priority=T.priority-(E>0?1:0),T.subscribers=T.subscribers.filter(I=>I.ref!==y))}}}}}),n=t.getState();let r=n.size,s=n.viewport.dpr,o=n.camera;return t.subscribe(()=>{const{camera:a,size:l,viewport:c,gl:u,set:h}=t.getState();if(l.width!==r.width||l.height!==r.height||c.dpr!==s){var f;r=l,s=c.dpr,Gz(a,l),u.setPixelRatio(c.dpr);const d=(f=l.updateStyle)!=null?f:typeof HTMLCanvasElement<"u"&&u.domElement instanceof HTMLCanvasElement;u.setSize(l.width,l.height,d)}a!==o&&(o=a,h(d=>({viewport:{...d.viewport,...d.viewport.getCurrentViewport(a)}})))}),t.subscribe(a=>i(a)),t};function Z6(i,e){const t={callback:i};return e.add(t),()=>void e.delete(t)}let x3,Wz=new Set,jz=new Set,Kz=new Set;const Yw=i=>Z6(i,Wz),Xw=i=>Z6(i,jz),Pie=i=>Z6(i,Kz);function LT(i,e){if(i.size)for(const{callback:t}of i.values())t(e)}function E1(i,e){switch(i){case"before":return LT(Wz,e);case"after":return LT(jz,e);case"tail":return LT(Kz,e)}}let PT,BT;function DT(i,e,t){let n=e.clock.getDelta();for(e.frameloop==="never"&&typeof i=="number"&&(n=i-e.clock.elapsedTime,e.clock.oldTime=e.clock.elapsedTime,e.clock.elapsedTime=i),PT=e.internal.subscribers,x3=0;x3<PT.length;x3++)BT=PT[x3],BT.ref.current(BT.store.getState(),n,t);return!e.internal.priority&&e.gl.render&&e.gl.render(e.scene,e.camera),e.internal.frames=Math.max(0,e.internal.frames-1),e.frameloop==="always"?1:e.internal.frames}function Bie(i){let e=!1,t=!1,n,r,s;function o(c){r=requestAnimationFrame(o),e=!0,n=0,E1("before",c),t=!0;for(const h of i.values()){var u;s=h.store.getState(),s.internal.active&&(s.frameloop==="always"||s.internal.frames>0)&&!((u=s.gl.xr)!=null&&u.isPresenting)&&(n+=DT(c,s))}if(t=!1,E1("after",c),n===0)return E1("tail",c),e=!1,cancelAnimationFrame(r)}function a(c,u=1){var h;if(!c)return i.forEach(f=>a(f.store.getState(),u));(h=c.gl.xr)!=null&&h.isPresenting||!c.internal.active||c.frameloop==="never"||(u>1?c.internal.frames=Math.min(60,c.internal.frames+u):t?c.internal.frames=2:c.internal.frames=1,e||(e=!0,requestAnimationFrame(o)))}function l(c,u=!0,h,f){if(u&&E1("before",c),h)DT(c,h,f);else for(const d of i.values())DT(c,d.store.getState());u&&E1("after",c)}return{loop:o,invalidate:a,advance:l}}function Die(i){const e=w.useRef(null);return wA(()=>void(e.current=i.current.__r3f),[i]),e}function qw(){const i=w.useContext(t0);if(!i)throw new Error("R3F: Hooks can only be used within the Canvas component!");return i}function Ve(i=t=>t,e){return qw()(i,e)}function Kt(i,e=0){const t=qw(),n=t.getState().internal.subscribe,r=kz(i);return wA(()=>n(r,e,t),[e,n,t]),null}function kie(i){return w.useMemo(()=>J6(i),[i])}const VB=new WeakMap;function $z(i,e){return function(t,...n){let r=VB.get(t);return r||(r=new t,VB.set(t,r)),i&&i(r),Promise.all(n.map(s=>new Promise((o,a)=>r.load(s,l=>{l.scene&&Object.assign(l,J6(l.scene)),o(l)},e,l=>a(new Error(`Could not load ${s}: ${l==null?void 0:l.message}`))))))}}function cr(i,e,t,n){const r=Array.isArray(e)?e:[e],s=Th($z(t,n),[i,...r],{equal:gr.equ});return Array.isArray(e)?s:s[0]}cr.preload=function(i,e,t){const n=Array.isArray(e)?e:[e];return Lz($z(t),[i,...n])};cr.clear=function(i,e){const t=Array.isArray(e)?e:[e];return px([i,...t])};const n0=new Map,{invalidate:DM,advance:kM}=Bie(n0),{reconciler:i0,applyProps:Os}=wie(n0,Iie),Lg={objects:"shallow",strict:!1},Fie=(i,e)=>{const t=typeof i=="function"?i(e):i;return Vz(t)?t:new Iw({powerPreference:"high-performance",canvas:e,antialias:!0,alpha:!0,...i})};function Oie(i,e){const t=typeof HTMLCanvasElement<"u"&&i instanceof HTMLCanvasElement;if(e){const{width:n,height:r,top:s,left:o,updateStyle:a=t}=e;return{width:n,height:r,top:s,left:o,updateStyle:a}}else if(typeof HTMLCanvasElement<"u"&&i instanceof HTMLCanvasElement&&i.parentElement){const{width:n,height:r,top:s,left:o}=i.parentElement.getBoundingClientRect();return{width:n,height:r,top:s,left:o,updateStyle:t}}else if(typeof OffscreenCanvas<"u"&&i instanceof OffscreenCanvas)return{width:i.width,height:i.height,top:0,left:0,updateStyle:t};return{width:0,height:0,top:0,left:0}}function eR(i){const e=n0.get(i),t=e==null?void 0:e.fiber,n=e==null?void 0:e.store;e&&console.warn("R3F.createRoot should only be called once!");const r=typeof reportError=="function"?reportError:console.error,s=n||Lie(DM,kM),o=t||i0.createContainer(s,L1.ConcurrentRoot,null,!1,null,"",r,null);e||n0.set(i,{fiber:o,store:s});let a,l=!1,c;return{configure(u={}){let{gl:h,size:f,scene:d,events:m,onCreated:A,shadows:g=!1,linear:y=!1,flat:E=!1,legacy:x=!1,orthographic:C=!1,frameloop:T="always",dpr:I=[1,2],performance:M,raycaster:L,camera:R,onPointerMissed:P}=u,F=s.getState(),k=F.gl;F.gl||F.set({gl:k=Fie(h,i)});let z=F.raycaster;z||F.set({raycaster:z=new A0});const{params:U,...W}=L||{};if(gr.equ(W,z,Lg)||Os(z,{...W}),gr.equ(U,z.params,Lg)||Os(z,{params:{...z.params,...U}}),!F.camera||F.camera===c&&!gr.equ(c,R,Lg)){c=R;const Y=R instanceof u0,O=Y?R:C?new qi(0,0,0,0,.1,1e3):new Wn(75,0,.1,1e3);Y||(O.position.z=5,R&&(Os(O,R),("aspect"in R||"left"in R||"right"in R||"bottom"in R||"top"in R)&&(O.manual=!0,O.updateProjectionMatrix())),!F.camera&&!(R!=null&&R.rotation)&&O.lookAt(0,0,0)),F.set({camera:O}),z.camera=O}if(!F.scene){let Y;d!=null&&d.isScene?Y=d:(Y=new Mu,d&&Os(Y,d)),F.set({scene:v1(Y)})}if(!F.xr){var $;const Y=(te,q)=>{const J=s.getState();J.frameloop!=="never"&&kM(te,!0,J,q)},O=()=>{const te=s.getState();te.gl.xr.enabled=te.gl.xr.isPresenting,te.gl.xr.setAnimationLoop(te.gl.xr.isPresenting?Y:null),te.gl.xr.isPresenting||DM(te)},K={connect(){const te=s.getState().gl;te.xr.addEventListener("sessionstart",O),te.xr.addEventListener("sessionend",O)},disconnect(){const te=s.getState().gl;te.xr.removeEventListener("sessionstart",O),te.xr.removeEventListener("sessionend",O)}};typeof(($=k.xr)==null?void 0:$.addEventListener)=="function"&&K.connect(),F.set({xr:K})}if(k.shadowMap){const Y=k.shadowMap.enabled,O=k.shadowMap.type;if(k.shadowMap.enabled=!!g,gr.boo(g))k.shadowMap.type=Vv;else if(gr.str(g)){var oe;const K={basic:NN,percentage:dw,soft:Vv,variance:fu};k.shadowMap.type=(oe=K[g])!=null?oe:Vv}else gr.obj(g)&&Object.assign(k.shadowMap,g);(Y!==k.shadowMap.enabled||O!==k.shadowMap.type)&&(k.shadowMap.needsUpdate=!0)}const X=Bz();X&&("enabled"in X?X.enabled=!x:"legacyMode"in X&&(X.legacyMode=x)),l||Os(k,{outputEncoding:y?3e3:3001,toneMapping:E?yu:d6}),F.legacy!==x&&F.set(()=>({legacy:x})),F.linear!==y&&F.set(()=>({linear:y})),F.flat!==E&&F.set(()=>({flat:E})),h&&!gr.fun(h)&&!Vz(h)&&!gr.equ(h,k,Lg)&&Os(k,h),m&&!F.events.handlers&&F.set({events:m(s)});const Q=Oie(i,f);return gr.equ(Q,F.size,Lg)||F.setSize(Q.width,Q.height,Q.updateStyle,Q.top,Q.left),I&&F.viewport.dpr!==Nz(I)&&F.setDpr(I),F.frameloop!==T&&F.setFrameloop(T),F.onPointerMissed||F.set({onPointerMissed:P}),M&&!gr.equ(M,F.performance,Lg)&&F.set(Y=>({performance:{...Y.performance,...M}})),a=A,l=!0,this},render(u){return l||this.configure(),i0.updateContainer(Z.jsx(Uie,{store:s,children:u,onCreated:a,rootElement:i}),o,null,()=>{}),s},unmount(){tR(i)}}}function Nie(i,e,t){console.warn("R3F.render is no longer supported in React 18. Use createRoot instead!");const n=eR(e);return n.configure(t),n.render(i)}function Uie({store:i,children:e,onCreated:t,rootElement:n}){return wA(()=>{const r=i.getState();r.set(s=>({internal:{...s.internal,active:!0}})),t&&t(r),i.getState().events.connected||r.events.connect==null||r.events.connect(n)},[]),Z.jsx(t0.Provider,{value:i,children:e})}function tR(i,e){const t=n0.get(i),n=t==null?void 0:t.fiber;if(n){const r=t==null?void 0:t.store.getState();r&&(r.internal.active=!1),i0.updateContainer(null,n,null,()=>{r&&setTimeout(()=>{try{var s,o,a,l;r.events.disconnect==null||r.events.disconnect(),(s=r.gl)==null||(o=s.renderLists)==null||o.dispose==null||o.dispose(),(a=r.gl)==null||a.forceContextLoss==null||a.forceContextLoss(),(l=r.gl)!=null&&l.xr&&r.xr.disconnect(),Uz(r),n0.delete(i),e&&e(i)}catch{}},500)})}}function vp(i,e,t){return Z.jsx(zie,{children:i,container:e,state:t},e.uuid)}function zie({state:i={},children:e,container:t}){const{events:n,size:r,...s}=i,o=qw(),[a]=w.useState(()=>new A0),[l]=w.useState(()=>new Ue),c=w.useCallback((h,f)=>{const d={...h};Object.keys(h).forEach(A=>{(Rie.includes(A)||h[A]!==f[A]&&f[A])&&delete d[A]});let m;if(f&&r){const A=f.camera;m=h.viewport.getCurrentViewport(A,new H,r),A!==h.camera&&Gz(A,r)}return{...d,scene:t,raycaster:a,pointer:l,mouse:l,previousRoot:o,events:{...h.events,...f==null?void 0:f.events,...n},size:{...h.size,...r},viewport:{...h.viewport,...m},...s}},[i]),[u]=w.useState(()=>{const h=o.getState();return Iz((d,m)=>({...h,scene:t,raycaster:a,pointer:l,mouse:l,previousRoot:o,events:{...h.events,...n},size:{...h.size,...r},...s,set:d,get:m,setEvents:A=>d(g=>({...g,events:{...g.events,...A}}))}))});return w.useEffect(()=>{const h=o.subscribe(f=>u.setState(d=>c(f,d)));return()=>{h()}},[c]),w.useEffect(()=>{u.setState(h=>c(o.getState(),h))},[c]),w.useEffect(()=>()=>{u.destroy()},[]),Z.jsx(Z.Fragment,{children:i0.createPortal(Z.jsx(t0.Provider,{value:u,children:e}),u,null)})}function Gie(i){return i0.flushSync(i,void 0)}i0.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:w.version});const Hie=w.unstable_act,kT={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function FM(i){const{handlePointer:e}=Qz(i);return{priority:1,enabled:!0,compute(t,n,r){n.pointer.set(t.offsetX/n.size.width*2-1,-(t.offsetY/n.size.height)*2+1),n.raycaster.setFromCamera(n.pointer,n.camera)},connected:void 0,handlers:Object.keys(kT).reduce((t,n)=>({...t,[n]:e(n)}),{}),update:()=>{var t;const{events:n,internal:r}=i.getState();(t=r.lastEvent)!=null&&t.current&&n.handlers&&n.handlers.onPointerMove(r.lastEvent.current)},connect:t=>{var n;const{set:r,events:s}=i.getState();s.disconnect==null||s.disconnect(),r(o=>({events:{...o.events,connected:t}})),Object.entries((n=s.handlers)!=null?n:[]).forEach(([o,a])=>{const[l,c]=kT[o];t.addEventListener(l,a,{passive:c})})},disconnect:()=>{const{set:t,events:n}=i.getState();if(n.connected){var r;Object.entries((r=n.handlers)!=null?r:[]).forEach(([s,o])=>{if(n&&n.connected instanceof HTMLElement){const[a]=kT[s];n.connected.removeEventListener(a,o)}}),t(s=>({events:{...s.events,connected:void 0}}))}}}}function WB(i,e){let t;return(...n)=>{window.clearTimeout(t),t=window.setTimeout(()=>i(...n),e)}}function Qie({debounce:i,scroll:e,polyfill:t,offsetSize:n}={debounce:0,scroll:!1,offsetSize:!1}){const r=t||(typeof window>"u"?class{}:window.ResizeObserver);if(!r)throw new Error("This browser does not support ResizeObserver out of the box. See: https://github.com/react-spring/react-use-measure/#resize-observer-polyfills");const[s,o]=w.useState({left:0,top:0,width:0,height:0,bottom:0,right:0,x:0,y:0}),a=w.useRef({element:null,scrollContainers:null,resizeObserver:null,lastBounds:s,orientationHandler:null}),l=i?typeof i=="number"?i:i.scroll:null,c=i?typeof i=="number"?i:i.resize:null,u=w.useRef(!1);w.useEffect(()=>(u.current=!0,()=>void(u.current=!1)));const[h,f,d]=w.useMemo(()=>{const y=()=>{if(!a.current.element)return;const{left:E,top:x,width:C,height:T,bottom:I,right:M,x:L,y:R}=a.current.element.getBoundingClientRect(),P={left:E,top:x,width:C,height:T,bottom:I,right:M,x:L,y:R};a.current.element instanceof HTMLElement&&n&&(P.height=a.current.element.offsetHeight,P.width=a.current.element.offsetWidth),Object.freeze(P),u.current&&!Kie(a.current.lastBounds,P)&&o(a.current.lastBounds=P)};return[y,c?WB(y,c):y,l?WB(y,l):y]},[o,n,l,c]);function m(){a.current.scrollContainers&&(a.current.scrollContainers.forEach(y=>y.removeEventListener("scroll",d,!0)),a.current.scrollContainers=null),a.current.resizeObserver&&(a.current.resizeObserver.disconnect(),a.current.resizeObserver=null),a.current.orientationHandler&&("orientation"in screen&&"removeEventListener"in screen.orientation?screen.orientation.removeEventListener("change",a.current.orientationHandler):"onorientationchange"in window&&window.removeEventListener("orientationchange",a.current.orientationHandler))}function A(){a.current.element&&(a.current.resizeObserver=new r(d),a.current.resizeObserver.observe(a.current.element),e&&a.current.scrollContainers&&a.current.scrollContainers.forEach(y=>y.addEventListener("scroll",d,{capture:!0,passive:!0})),a.current.orientationHandler=()=>{d()},"orientation"in screen&&"addEventListener"in screen.orientation?screen.orientation.addEventListener("change",a.current.orientationHandler):"onorientationchange"in window&&window.addEventListener("orientationchange",a.current.orientationHandler))}const g=y=>{!y||y===a.current.element||(m(),a.current.element=y,a.current.scrollContainers=Yz(y),A())};return Wie(d,!!e),Vie(f),w.useEffect(()=>{m(),A()},[e,d,f]),w.useEffect(()=>m,[]),[g,s,h]}function Vie(i){w.useEffect(()=>{const e=i;return window.addEventListener("resize",e),()=>void window.removeEventListener("resize",e)},[i])}function Wie(i,e){w.useEffect(()=>{if(e){const t=i;return window.addEventListener("scroll",t,{capture:!0,passive:!0}),()=>void window.removeEventListener("scroll",t,!0)}},[i,e])}function Yz(i){const e=[];if(!i||i===document.body)return e;const{overflow:t,overflowX:n,overflowY:r}=window.getComputedStyle(i);return[t,n,r].some(s=>s==="auto"||s==="scroll")&&e.push(i),[...e,...Yz(i.parentElement)]}const jie=["x","y","top","bottom","left","right","width","height"],Kie=(i,e)=>jie.every(t=>i[t]===e[t]);var $ie=Object.defineProperty,Yie=Object.defineProperties,Xie=Object.getOwnPropertyDescriptors,jB=Object.getOwnPropertySymbols,qie=Object.prototype.hasOwnProperty,Jie=Object.prototype.propertyIsEnumerable,KB=(i,e,t)=>e in i?$ie(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,$B=(i,e)=>{for(var t in e||(e={}))qie.call(e,t)&&KB(i,t,e[t]);if(jB)for(var t of jB(e))Jie.call(e,t)&&KB(i,t,e[t]);return i},Zie=(i,e)=>Yie(i,Xie(e)),YB,XB;typeof window<"u"&&((YB=window.document)!=null&&YB.createElement||((XB=window.navigator)==null?void 0:XB.product)==="ReactNative")?w.useLayoutEffect:w.useEffect;function Xz(i,e,t){if(!i)return;if(t(i)===!0)return i;let n=i.child;for(;n;){const r=Xz(n,e,t);if(r)return r;n=n.sibling}}function qz(i){try{return Object.defineProperties(i,{_currentRenderer:{get(){return null},set(){}},_currentRenderer2:{get(){return null},set(){}}})}catch{return i}}const qB=console.error;console.error=function(){const i=[...arguments].join("");if(i!=null&&i.startsWith("Warning:")&&i.includes("useContext")){console.error=qB;return}return qB.apply(this,arguments)};const nR=qz(w.createContext(null));class Jz extends w.Component{render(){return w.createElement(nR.Provider,{value:this._reactInternals},this.props.children)}}function ere(){const i=w.useContext(nR);if(i===null)throw new Error("its-fine: useFiber must be called within a <FiberProvider />!");const e=w.useId();return w.useMemo(()=>{for(const n of[i,i==null?void 0:i.alternate]){if(!n)continue;const r=Xz(n,!1,s=>{let o=s.memoizedState;for(;o;){if(o.memoizedState===e)return!0;o=o.next}});if(r)return r}},[i,e])}function tre(){const i=ere(),[e]=w.useState(()=>new Map);e.clear();let t=i;for(;t;){if(t.type&&typeof t.type=="object"){const r=t.type._context===void 0&&t.type.Provider===t.type?t.type:t.type._context;r&&r!==nR&&!e.has(r)&&e.set(r,w.useContext(qz(r)))}t=t.return}return e}function nre(){const i=tre();return w.useMemo(()=>Array.from(i.keys()).reduce((e,t)=>n=>w.createElement(e,null,w.createElement(t.Provider,Zie($B({},n),{value:i.get(t)}))),e=>w.createElement(Jz,$B({},e))),[i])}const ire=w.forwardRef(function({children:e,fallback:t,resize:n,style:r,gl:s,events:o=FM,eventSource:a,eventPrefix:l,shadows:c,linear:u,flat:h,legacy:f,orthographic:d,frameloop:m,dpr:A,performance:g,raycaster:y,camera:E,scene:x,onPointerMissed:C,onCreated:T,...I},M){w.useMemo(()=>Or(X6),[]);const L=nre(),[R,P]=Qie({scroll:!0,debounce:{scroll:50,resize:0},...n}),F=w.useRef(null),k=w.useRef(null);w.useImperativeHandle(M,()=>F.current);const z=kz(C),[U,W]=w.useState(!1),[$,oe]=w.useState(!1);if(U)throw U;if($)throw $;const X=w.useRef(null);wA(()=>{const Y=F.current;P.width>0&&P.height>0&&Y&&(X.current||(X.current=eR(Y)),X.current.configure({gl:s,events:o,shadows:c,linear:u,flat:h,legacy:f,orthographic:d,frameloop:m,dpr:A,performance:g,raycaster:y,camera:E,scene:x,size:P,onPointerMissed:(...O)=>z.current==null?void 0:z.current(...O),onCreated:O=>{O.events.connect==null||O.events.connect(a?Cie(a)?a.current:a:k.current),l&&O.setEvents({compute:(K,te)=>{const q=K[l+"X"],J=K[l+"Y"];te.pointer.set(q/te.size.width*2-1,-(J/te.size.height)*2+1),te.raycaster.setFromCamera(te.pointer,te.camera)}}),T==null||T(O)}}),X.current.render(Z.jsx(L,{children:Z.jsx(Fz,{set:oe,children:Z.jsx(w.Suspense,{fallback:Z.jsx(Tie,{set:W}),children:e??null})})})))}),w.useEffect(()=>{const Y=F.current;if(Y)return()=>tR(Y)},[]);const Q=a?"none":"auto";return Z.jsx("div",{ref:k,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:Q,...r},...I,children:Z.jsx("div",{ref:R,style:{width:"100%",height:"100%"},children:Z.jsx("canvas",{ref:F,style:{display:"block"},children:t})})})}),Zz=w.forwardRef(function(e,t){return Z.jsx(Jz,{children:Z.jsx(ire,{...e,ref:t})})}),rre=Object.freeze(Object.defineProperty({__proto__:null,Canvas:Zz,ReactThreeFiber:Sie,_roots:n0,act:Hie,addAfterEffect:Xw,addEffect:Yw,addTail:Pie,advance:kM,applyProps:Os,buildGraph:J6,context:t0,createEvents:Qz,createPointerEvents:FM,createPortal:vp,createRoot:eR,dispose:Uz,events:FM,extend:Or,flushGlobalEffects:E1,flushSync:Gie,getRootState:y1,invalidate:DM,reconciler:i0,render:Nie,unmountComponentAtNode:tR,useFrame:Kt,useGraph:kie,useInstanceHandle:Die,useLoader:cr,useStore:qw,useThree:Ve},Symbol.toStringTag,{value:"Module"}));function ot(){return ot=Object.assign?Object.assign.bind():function(i){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)({}).hasOwnProperty.call(t,n)&&(i[n]=t[n])}return i},ot.apply(null,arguments)}const mx=new H,iR=new H,sre=new H,JB=new Ue;function ore(i,e,t){const n=mx.setFromMatrixPosition(i.matrixWorld);n.project(e);const r=t.width/2,s=t.height/2;return[n.x*r+r,-(n.y*s)+s]}function are(i,e){const t=mx.setFromMatrixPosition(i.matrixWorld),n=iR.setFromMatrixPosition(e.matrixWorld),r=t.sub(n),s=e.getWorldDirection(sre);return r.angleTo(s)>Math.PI/2}function lre(i,e,t,n){const r=mx.setFromMatrixPosition(i.matrixWorld),s=r.clone();s.project(e),JB.set(s.x,s.y),t.setFromCamera(JB,e);const o=t.intersectObjects(n,!0);if(o.length){const a=o[0].distance;return r.distanceTo(t.ray.origin)<a}return!0}function cre(i,e){if(e instanceof qi)return e.zoom;if(e instanceof Wn){const t=mx.setFromMatrixPosition(i.matrixWorld),n=iR.setFromMatrixPosition(e.matrixWorld),r=e.fov*Math.PI/180,s=t.distanceTo(n);return 1/(2*Math.tan(r/2)*s)}else return 1}function ure(i,e,t){if(e instanceof Wn||e instanceof qi){const n=mx.setFromMatrixPosition(i.matrixWorld),r=iR.setFromMatrixPosition(e.matrixWorld),s=n.distanceTo(r),o=(t[1]-t[0])/(e.far-e.near),a=t[1]-o*e.far;return Math.round(o*s+a)}}const OM=i=>Math.abs(i)<1e-10?0:i;function eG(i,e,t=""){let n="matrix3d(";for(let r=0;r!==16;r++)n+=OM(e[r]*i.elements[r])+(r!==15?",":")");return t+n}const hre=(i=>e=>eG(e,i))([1,-1,1,1,1,-1,1,1,1,-1,1,1,1,-1,1,1]),fre=(i=>(e,t)=>eG(e,i(t),"translate(-50%,-50%)"))(i=>[1/i,1/i,1/i,1,-1/i,-1/i,-1/i,-1,1/i,1/i,1/i,1,1,1,1,1]);function dre(i){return i&&typeof i=="object"&&"current"in i}const CA=w.forwardRef(({children:i,eps:e=.001,style:t,className:n,prepend:r,center:s,fullscreen:o,portal:a,distanceFactor:l,sprite:c=!1,transform:u=!1,occlude:h,onOcclude:f,castShadow:d,receiveShadow:m,material:A,geometry:g,zIndexRange:y=[16777271,0],calculatePosition:E=ore,as:x="div",wrapperClass:C,pointerEvents:T="auto",...I},M)=>{const{gl:L,camera:R,scene:P,size:F,raycaster:k,events:z,viewport:U}=Ve(),[W]=w.useState(()=>document.createElement(x)),$=w.useRef(),oe=w.useRef(null),X=w.useRef(0),Q=w.useRef([0,0]),Y=w.useRef(null),O=w.useRef(null),K=(a==null?void 0:a.current)||z.connected||L.domElement.parentNode,te=w.useRef(null),q=w.useRef(!1),J=w.useMemo(()=>h&&h!=="blending"||Array.isArray(h)&&h.length&&dre(h[0]),[h]);w.useLayoutEffect(()=>{const xe=L.domElement;h&&h==="blending"?(xe.style.zIndex=`${Math.floor(y[0]/2)}`,xe.style.position="absolute",xe.style.pointerEvents="none"):(xe.style.zIndex=null,xe.style.position=null,xe.style.pointerEvents=null)},[h]),w.useLayoutEffect(()=>{if(oe.current){const xe=$.current=h6.createRoot(W);if(P.updateMatrixWorld(),u)W.style.cssText="position:absolute;top:0;left:0;pointer-events:none;overflow:hidden;";else{const pe=E(oe.current,R,F);W.style.cssText=`position:absolute;top:0;left:0;transform:translate3d(${pe[0]}px,${pe[1]}px,0);transform-origin:0 0;`}return K&&(r?K.prepend(W):K.appendChild(W)),()=>{K&&K.removeChild(W),xe.unmount()}}},[K,u]),w.useLayoutEffect(()=>{C&&(W.className=C)},[C]);const ie=w.useMemo(()=>u?{position:"absolute",top:0,left:0,width:F.width,height:F.height,transformStyle:"preserve-3d",pointerEvents:"none"}:{position:"absolute",transform:s?"translate3d(-50%,-50%,0)":"none",...o&&{top:-F.height/2,left:-F.width/2,width:F.width,height:F.height},...t},[t,s,o,F,u]),re=w.useMemo(()=>({position:"absolute",pointerEvents:T}),[T]);w.useLayoutEffect(()=>{if(q.current=!1,u){var xe;(xe=$.current)==null||xe.render(w.createElement("div",{ref:Y,style:ie},w.createElement("div",{ref:O,style:re},w.createElement("div",{ref:M,className:n,style:t,children:i}))))}else{var pe;(pe=$.current)==null||pe.render(w.createElement("div",{ref:M,style:ie,className:n,children:i}))}});const se=w.useRef(!0);Kt(xe=>{if(oe.current){R.updateMatrixWorld(),oe.current.updateWorldMatrix(!0,!1);const pe=u?Q.current:E(oe.current,R,F);if(u||Math.abs(X.current-R.zoom)>e||Math.abs(Q.current[0]-pe[0])>e||Math.abs(Q.current[1]-pe[1])>e){const ce=are(oe.current,R);let we=!1;J&&(Array.isArray(h)?we=h.map(Le=>Le.current):h!=="blending"&&(we=[P]));const Ee=se.current;if(we){const Le=lre(oe.current,R,k,we);se.current=Le&&!ce}else se.current=!ce;Ee!==se.current&&(f?f(!se.current):W.style.display=se.current?"block":"none");const ve=Math.floor(y[0]/2),Ae=h?J?[y[0],ve]:[ve-1,0]:y;if(W.style.zIndex=`${ure(oe.current,R,Ae)}`,u){const[Le,Te]=[F.width/2,F.height/2],ne=R.projectionMatrix.elements[5]*Te,{isOrthographicCamera:V,top:de,left:Re,bottom:Be,right:Fe}=R,He=hre(R.matrixWorldInverse),it=V?`scale(${ne})translate(${OM(-(Fe+Re)/2)}px,${OM((de+Be)/2)}px)`:`translateZ(${ne}px)`;let $e=oe.current.matrixWorld;c&&($e=R.matrixWorldInverse.clone().transpose().copyPosition($e).scale(oe.current.scale),$e.elements[3]=$e.elements[7]=$e.elements[11]=0,$e.elements[15]=1),W.style.width=F.width+"px",W.style.height=F.height+"px",W.style.perspective=V?"":`${ne}px`,Y.current&&O.current&&(Y.current.style.transform=`${it}${He}translate(${Le}px,${Te}px)`,O.current.style.transform=fre($e,1/((l||10)/400)))}else{const Le=l===void 0?1:cre(oe.current,R)*l;W.style.transform=`translate3d(${pe[0]}px,${pe[1]}px,0) scale(${Le})`}Q.current=pe,X.current=R.zoom}}if(!J&&te.current&&!q.current)if(u){if(Y.current){const pe=Y.current.children[0];if(pe!=null&&pe.clientWidth&&pe!=null&&pe.clientHeight){const{isOrthographicCamera:ce}=R;if(ce||g)I.scale&&(Array.isArray(I.scale)?I.scale instanceof H?te.current.scale.copy(I.scale.clone().divideScalar(1)):te.current.scale.set(1/I.scale[0],1/I.scale[1],1/I.scale[2]):te.current.scale.setScalar(1/I.scale));else{const we=(l||10)/400,Ee=pe.clientWidth*we,ve=pe.clientHeight*we;te.current.scale.set(Ee,ve,1)}q.current=!0}}}else{const pe=W.children[0];if(pe!=null&&pe.clientWidth&&pe!=null&&pe.clientHeight){const ce=1/U.factor,we=pe.clientWidth*ce,Ee=pe.clientHeight*ce;te.current.scale.set(we,Ee,1),q.current=!0}te.current.lookAt(xe.camera.position)}});const ge=w.useMemo(()=>({vertexShader:u?void 0:`
          /*
            This shader is from the THREE's SpriteMaterial.
            We need to turn the backing plane into a Sprite
            (make it always face the camera) if "transfrom"
            is false.
          */
          #include <common>

          void main() {
            vec2 center = vec2(0., 1.);
            float rotation = 0.0;

            // This is somewhat arbitrary, but it seems to work well
            // Need to figure out how to derive this dynamically if it even matters
            float size = 0.03;

            vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
            vec2 scale;
            scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
            scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );

            bool isPerspective = isPerspectiveMatrix( projectionMatrix );
            if ( isPerspective ) scale *= - mvPosition.z;

            vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale * size;
            vec2 rotatedPosition;
            rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
            rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
            mvPosition.xy += rotatedPosition;

            gl_Position = projectionMatrix * mvPosition;
          }
      `,fragmentShader:`
        void main() {
          gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
        }
      `}),[u]);return w.createElement("group",ot({},I,{ref:oe}),h&&!J&&w.createElement("mesh",{castShadow:d,receiveShadow:m,ref:te},g||w.createElement("planeGeometry",null),A||w.createElement("shaderMaterial",{side:Pi,vertexShader:ge.vertexShader,fragmentShader:ge.fragmentShader})))});function pre({onChanged:i,portal:e,preventDefault:t=!0,scroll:n=!0,keyCode:r=9}){const s=w.useRef(0),o=Ve(c=>c.setEvents),a=Ve(c=>c.get),l=Ve(c=>c.gl);return w.useEffect(()=>{var c;let u=[],h;const f=a().events.filter,d=(c=e==null?void 0:e.current)!==null&&c!==void 0?c:l.domElement.parentNode,m=()=>d&&i&&i(u,Math.round(s.current)%u.length);o({filter:(x,C)=>{let T=[...x];(T.length!==u.length||!u.every(I=>T.map(M=>M.object.uuid).includes(I.object.uuid)))&&(s.current=0,u=T,m()),f&&(T=f(T,C));for(let I=0;I<Math.round(s.current)%T.length;I++){const M=T.shift();T=[...T,M]}return T}});const A=x=>{var C,T;s.current=x(s.current),(C=a().events.handlers)==null||C.onPointerCancel(void 0),(T=a().events.handlers)==null||T.onPointerMove(h),m()},g=x=>{(x.keyCode||x.which)===r&&(t&&x.preventDefault(),u.length>1&&A(C=>C+1))},y=x=>{t&&x.preventDefault();let C=0;x||(x=window.event),x.wheelDelta?C=x.wheelDelta/120:x.detail&&(C=-x.detail/3),u.length>1&&A(T=>Math.abs(T-C))},E=x=>h=x;return document.addEventListener("pointermove",E,{passive:!0}),n&&document.addEventListener("wheel",y),r!==void 0&&document.addEventListener("keydown",g),()=>{o({filter:f}),r!==void 0&&document.removeEventListener("keydown",g),n&&document.removeEventListener("wheel",y),document.removeEventListener("pointermove",E)}},[l,a,o,t,n,r]),null}function mre(i,e="pointer",t="auto",n=document.body){w.useEffect(()=>{if(i)return n.style.cursor=e,()=>void(n.style.cursor=t)},[i])}const ZB=i=>{let e;const t=new Set,n=(c,u)=>{const h=typeof c=="function"?c(e):c;if(!Object.is(h,e)){const f=e;e=u??(typeof h!="object"||h===null)?h:Object.assign({},e,h),t.forEach(d=>d(e,f))}},r=()=>e,a={setState:n,getState:r,getInitialState:()=>l,subscribe:c=>(t.add(c),()=>t.delete(c))},l=e=i(n,r,a);return a},gre=(i=>i?ZB(i):ZB),Are=i=>i;function yre(i,e=Are){const t=bl.useSyncExternalStore(i.subscribe,bl.useCallback(()=>e(i.getState()),[i,e]),bl.useCallback(()=>e(i.getInitialState()),[i,e]));return bl.useDebugValue(t),t}const eD=i=>{const e=gre(i),t=n=>yre(e,n);return Object.assign(t,e),t},tG=(i=>i?eD(i):eD);let zy=0;const rR=tG(i=>(R1.onStart=(e,t,n)=>{i({active:!0,item:e,loaded:t,total:n,progress:(t-zy)/(n-zy)*100})},R1.onLoad=()=>{i({active:!1})},R1.onError=e=>i(t=>({errors:[...t.errors,e]})),R1.onProgress=(e,t,n)=>{t===n&&(zy=n),i({active:!0,item:e,loaded:t,total:n,progress:(t-zy)/(n-zy)*100||100})},{errors:[],active:!1,progress:0,item:"",loaded:0,total:0}));function vre({children:i}){const e=rR();return w.createElement(w.Fragment,null,i==null?void 0:i(e))}const xre=i=>`Loading ${i.toFixed(2)}%`;function Ere({containerStyles:i,innerStyles:e,barStyles:t,dataStyles:n,dataInterpolation:r=xre,initialState:s=o=>o}){const{active:o,progress:a}=rR(),l=w.useRef(0),c=w.useRef(0),u=w.useRef(null),[h,f]=w.useState(s(o));w.useEffect(()=>{let m;return o!==h&&(m=setTimeout(()=>f(o),300)),()=>clearTimeout(m)},[h,o]);const d=w.useCallback(()=>{u.current&&(l.current+=(a-l.current)/2,(l.current>.95*a||a===100)&&(l.current=a),u.current.innerText=r(l.current),l.current<a&&(c.current=requestAnimationFrame(d)))},[r,a]);return w.useEffect(()=>(d(),()=>cancelAnimationFrame(c.current)),[d]),h?w.createElement("div",{style:{...E3.container,opacity:o?1:0,...i}},w.createElement("div",null,w.createElement("div",{style:{...E3.inner,...e}},w.createElement("div",{style:{...E3.bar,transform:`scaleX(${a/100})`,...t}}),w.createElement("span",{ref:u,style:{...E3.data,...n}})))):null}const E3={container:{position:"absolute",top:0,left:0,width:"100%",height:"100%",background:"#171717",display:"flex",alignItems:"center",justifyContent:"center",transition:"opacity 300ms ease",zIndex:1e3},inner:{width:100,height:3,background:"#272727",textAlign:"center"},bar:{height:3,width:"100%",background:"white",transition:"transform 200ms",transformOrigin:"left center"},data:{display:"inline-block",position:"relative",fontVariantNumeric:"tabular-nums",marginTop:"0.8em",color:"#f0f0f0",fontSize:"0.6em",fontFamily:'-apple-system, BlinkMacSystemFont, "Inter", "Segoe UI", "Helvetica Neue", Helvetica, Arial, Roboto, Ubuntu, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',whiteSpace:"nowrap"}};function _re(i,e,t){return Math.max(e,Math.min(i,t))}const Tr={toVector(i,e){return i===void 0&&(i=e),Array.isArray(i)?i:[i,i]},add(i,e){return[i[0]+e[0],i[1]+e[1]]},sub(i,e){return[i[0]-e[0],i[1]-e[1]]},addTo(i,e){i[0]+=e[0],i[1]+=e[1]},subTo(i,e){i[0]-=e[0],i[1]-=e[1]}};function tD(i,e,t){return e===0||Math.abs(e)===1/0?Math.pow(i,t*5):i*e*t/(e+t*i)}function nD(i,e,t,n=.15){return n===0?_re(i,e,t):i<e?-tD(e-i,t-e,n)+e:i>t?+tD(i-t,t-e,n)+t:i}function Sre(i,[e,t],[n,r]){const[[s,o],[a,l]]=i;return[nD(e,s,o,n),nD(t,a,l,r)]}function wre(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var n=t.call(i,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}function Cre(i){var e=wre(i,"string");return typeof e=="symbol"?e:String(e)}function Bs(i,e,t){return e=Cre(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function iD(i,e){var t=Object.keys(i);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(i);e&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(i,r).enumerable})),t.push.apply(t,n)}return t}function Kr(i){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?iD(Object(t),!0).forEach(function(n){Bs(i,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(t)):iD(Object(t)).forEach(function(n){Object.defineProperty(i,n,Object.getOwnPropertyDescriptor(t,n))})}return i}const nG={pointer:{start:"down",change:"move",end:"up"},mouse:{start:"down",change:"move",end:"up"},touch:{start:"start",change:"move",end:"end"},gesture:{start:"start",change:"change",end:"end"}};function rD(i){return i?i[0].toUpperCase()+i.slice(1):""}const Tre=["enter","leave"];function bre(i=!1,e){return i&&!Tre.includes(e)}function Ire(i,e="",t=!1){const n=nG[i],r=n&&n[e]||e;return"on"+rD(i)+rD(r)+(bre(t,r)?"Capture":"")}const Mre=["gotpointercapture","lostpointercapture"];function Rre(i){let e=i.substring(2).toLowerCase();const t=!!~e.indexOf("passive");t&&(e=e.replace("passive",""));const n=Mre.includes(e)?"capturecapture":"capture",r=!!~e.indexOf(n);return r&&(e=e.replace("capture","")),{device:e,capture:r,passive:t}}function Lre(i,e=""){const t=nG[i],n=t&&t[e]||e;return i+n}function Jw(i){return"touches"in i}function iG(i){return Jw(i)?"touch":"pointerType"in i?i.pointerType:"mouse"}function Pre(i){return Array.from(i.touches).filter(e=>{var t,n;return e.target===i.currentTarget||((t=i.currentTarget)===null||t===void 0||(n=t.contains)===null||n===void 0?void 0:n.call(t,e.target))})}function Bre(i){return i.type==="touchend"||i.type==="touchcancel"?i.changedTouches:i.targetTouches}function rG(i){return Jw(i)?Bre(i)[0]:i}function NM(i,e){try{const t=e.clientX-i.clientX,n=e.clientY-i.clientY,r=(e.clientX+i.clientX)/2,s=(e.clientY+i.clientY)/2,o=Math.hypot(t,n);return{angle:-(Math.atan2(t,n)*180)/Math.PI,distance:o,origin:[r,s]}}catch{}return null}function Dre(i){return Pre(i).map(e=>e.identifier)}function sD(i,e){const[t,n]=Array.from(i.touches).filter(r=>e.includes(r.identifier));return NM(t,n)}function FT(i){const e=rG(i);return Jw(i)?e.identifier:e.pointerId}function nA(i){const e=rG(i);return[e.clientX,e.clientY]}const oD=40,aD=800;function sG(i){let{deltaX:e,deltaY:t,deltaMode:n}=i;return n===1?(e*=oD,t*=oD):n===2&&(e*=aD,t*=aD),[e,t]}function kre(i){var e,t;const{scrollX:n,scrollY:r,scrollLeft:s,scrollTop:o}=i.currentTarget;return[(e=n??s)!==null&&e!==void 0?e:0,(t=r??o)!==null&&t!==void 0?t:0]}function Fre(i){const e={};if("buttons"in i&&(e.buttons=i.buttons),"shiftKey"in i){const{shiftKey:t,altKey:n,metaKey:r,ctrlKey:s}=i;Object.assign(e,{shiftKey:t,altKey:n,metaKey:r,ctrlKey:s})}return e}function RS(i,...e){return typeof i=="function"?i(...e):i}function Ore(){}function Nre(...i){return i.length===0?Ore:i.length===1?i[0]:function(){let e;for(const t of i)e=t.apply(this,arguments)||e;return e}}function lD(i,e){return Object.assign({},e,i||{})}const Ure=32;class oG{constructor(e,t,n){this.ctrl=e,this.args=t,this.key=n,this.state||(this.state={},this.computeValues([0,0]),this.computeInitial(),this.init&&this.init(),this.reset())}get state(){return this.ctrl.state[this.key]}set state(e){this.ctrl.state[this.key]=e}get shared(){return this.ctrl.state.shared}get eventStore(){return this.ctrl.gestureEventStores[this.key]}get timeoutStore(){return this.ctrl.gestureTimeoutStores[this.key]}get config(){return this.ctrl.config[this.key]}get sharedConfig(){return this.ctrl.config.shared}get handler(){return this.ctrl.handlers[this.key]}reset(){const{state:e,shared:t,ingKey:n,args:r}=this;t[n]=e._active=e.active=e._blocked=e._force=!1,e._step=[!1,!1],e.intentional=!1,e._movement=[0,0],e._distance=[0,0],e._direction=[0,0],e._delta=[0,0],e._bounds=[[-1/0,1/0],[-1/0,1/0]],e.args=r,e.axis=void 0,e.memo=void 0,e.elapsedTime=e.timeDelta=0,e.direction=[0,0],e.distance=[0,0],e.overflow=[0,0],e._movementBound=[!1,!1],e.velocity=[0,0],e.movement=[0,0],e.delta=[0,0],e.timeStamp=0}start(e){const t=this.state,n=this.config;t._active||(this.reset(),this.computeInitial(),t._active=!0,t.target=e.target,t.currentTarget=e.currentTarget,t.lastOffset=n.from?RS(n.from,t):t.offset,t.offset=t.lastOffset,t.startTime=t.timeStamp=e.timeStamp)}computeValues(e){const t=this.state;t._values=e,t.values=this.config.transform(e)}computeInitial(){const e=this.state;e._initial=e._values,e.initial=e.values}compute(e){const{state:t,config:n,shared:r}=this;t.args=this.args;let s=0;if(e&&(t.event=e,n.preventDefault&&e.cancelable&&t.event.preventDefault(),t.type=e.type,r.touches=this.ctrl.pointerIds.size||this.ctrl.touchIds.size,r.locked=!!document.pointerLockElement,Object.assign(r,Fre(e)),r.down=r.pressed=r.buttons%2===1||r.touches>0,s=e.timeStamp-t.timeStamp,t.timeStamp=e.timeStamp,t.elapsedTime=t.timeStamp-t.startTime),t._active){const I=t._delta.map(Math.abs);Tr.addTo(t._distance,I)}this.axisIntent&&this.axisIntent(e);const[o,a]=t._movement,[l,c]=n.threshold,{_step:u,values:h}=t;if(n.hasCustomTransform?(u[0]===!1&&(u[0]=Math.abs(o)>=l&&h[0]),u[1]===!1&&(u[1]=Math.abs(a)>=c&&h[1])):(u[0]===!1&&(u[0]=Math.abs(o)>=l&&Math.sign(o)*l),u[1]===!1&&(u[1]=Math.abs(a)>=c&&Math.sign(a)*c)),t.intentional=u[0]!==!1||u[1]!==!1,!t.intentional)return;const f=[0,0];if(n.hasCustomTransform){const[I,M]=h;f[0]=u[0]!==!1?I-u[0]:0,f[1]=u[1]!==!1?M-u[1]:0}else f[0]=u[0]!==!1?o-u[0]:0,f[1]=u[1]!==!1?a-u[1]:0;this.restrictToAxis&&!t._blocked&&this.restrictToAxis(f);const d=t.offset,m=t._active&&!t._blocked||t.active;m&&(t.first=t._active&&!t.active,t.last=!t._active&&t.active,t.active=r[this.ingKey]=t._active,e&&(t.first&&("bounds"in n&&(t._bounds=RS(n.bounds,t)),this.setup&&this.setup()),t.movement=f,this.computeOffset()));const[A,g]=t.offset,[[y,E],[x,C]]=t._bounds;t.overflow=[A<y?-1:A>E?1:0,g<x?-1:g>C?1:0],t._movementBound[0]=t.overflow[0]?t._movementBound[0]===!1?t._movement[0]:t._movementBound[0]:!1,t._movementBound[1]=t.overflow[1]?t._movementBound[1]===!1?t._movement[1]:t._movementBound[1]:!1;const T=t._active?n.rubberband||[0,0]:[0,0];if(t.offset=Sre(t._bounds,t.offset,T),t.delta=Tr.sub(t.offset,d),this.computeMovement(),m&&(!t.last||s>Ure)){t.delta=Tr.sub(t.offset,d);const I=t.delta.map(Math.abs);Tr.addTo(t.distance,I),t.direction=t.delta.map(Math.sign),t._direction=t._delta.map(Math.sign),!t.first&&s>0&&(t.velocity=[I[0]/s,I[1]/s],t.timeDelta=s)}}emit(){const e=this.state,t=this.shared,n=this.config;if(e._active||this.clean(),(e._blocked||!e.intentional)&&!e._force&&!n.triggerAllEvents)return;const r=this.handler(Kr(Kr(Kr({},t),e),{},{[this.aliasKey]:e.values}));r!==void 0&&(e.memo=r)}clean(){this.eventStore.clean(),this.timeoutStore.clean()}}function zre([i,e],t){const n=Math.abs(i),r=Math.abs(e);if(n>r&&n>t)return"x";if(r>n&&r>t)return"y"}class gx extends oG{constructor(...e){super(...e),Bs(this,"aliasKey","xy")}reset(){super.reset(),this.state.axis=void 0}init(){this.state.offset=[0,0],this.state.lastOffset=[0,0]}computeOffset(){this.state.offset=Tr.add(this.state.lastOffset,this.state.movement)}computeMovement(){this.state.movement=Tr.sub(this.state.offset,this.state.lastOffset)}axisIntent(e){const t=this.state,n=this.config;if(!t.axis&&e){const r=typeof n.axisThreshold=="object"?n.axisThreshold[iG(e)]:n.axisThreshold;t.axis=zre(t._movement,r)}t._blocked=(n.lockDirection||!!n.axis)&&!t.axis||!!n.axis&&n.axis!==t.axis}restrictToAxis(e){if(this.config.axis||this.config.lockDirection)switch(this.state.axis){case"x":e[1]=0;break;case"y":e[0]=0;break}}}const Gre=i=>i,cD=.15,aG={enabled(i=!0){return i},eventOptions(i,e,t){return Kr(Kr({},t.shared.eventOptions),i)},preventDefault(i=!1){return i},triggerAllEvents(i=!1){return i},rubberband(i=0){switch(i){case!0:return[cD,cD];case!1:return[0,0];default:return Tr.toVector(i)}},from(i){if(typeof i=="function")return i;if(i!=null)return Tr.toVector(i)},transform(i,e,t){const n=i||t.shared.transform;return this.hasCustomTransform=!!n,n||Gre},threshold(i){return Tr.toVector(i,0)}},Hre=0,y0=Kr(Kr({},aG),{},{axis(i,e,{axis:t}){if(this.lockDirection=t==="lock",!this.lockDirection)return t},axisThreshold(i=Hre){return i},bounds(i={}){if(typeof i=="function")return s=>y0.bounds(i(s));if("current"in i)return()=>i.current;if(typeof HTMLElement=="function"&&i instanceof HTMLElement)return i;const{left:e=-1/0,right:t=1/0,top:n=-1/0,bottom:r=1/0}=i;return[[e,t],[n,r]]}}),uD={ArrowRight:(i,e=1)=>[i*e,0],ArrowLeft:(i,e=1)=>[-1*i*e,0],ArrowUp:(i,e=1)=>[0,-1*i*e],ArrowDown:(i,e=1)=>[0,i*e]};class Qre extends gx{constructor(...e){super(...e),Bs(this,"ingKey","dragging")}reset(){super.reset();const e=this.state;e._pointerId=void 0,e._pointerActive=!1,e._keyboardActive=!1,e._preventScroll=!1,e._delayed=!1,e.swipe=[0,0],e.tap=!1,e.canceled=!1,e.cancel=this.cancel.bind(this)}setup(){const e=this.state;if(e._bounds instanceof HTMLElement){const t=e._bounds.getBoundingClientRect(),n=e.currentTarget.getBoundingClientRect(),r={left:t.left-n.left+e.offset[0],right:t.right-n.right+e.offset[0],top:t.top-n.top+e.offset[1],bottom:t.bottom-n.bottom+e.offset[1]};e._bounds=y0.bounds(r)}}cancel(){const e=this.state;e.canceled||(e.canceled=!0,e._active=!1,setTimeout(()=>{this.compute(),this.emit()},0))}setActive(){this.state._active=this.state._pointerActive||this.state._keyboardActive}clean(){this.pointerClean(),this.state._pointerActive=!1,this.state._keyboardActive=!1,super.clean()}pointerDown(e){const t=this.config,n=this.state;if(e.buttons!=null&&(Array.isArray(t.pointerButtons)?!t.pointerButtons.includes(e.buttons):t.pointerButtons!==-1&&t.pointerButtons!==e.buttons))return;const r=this.ctrl.setEventIds(e);t.pointerCapture&&e.target.setPointerCapture(e.pointerId),!(r&&r.size>1&&n._pointerActive)&&(this.start(e),this.setupPointer(e),n._pointerId=FT(e),n._pointerActive=!0,this.computeValues(nA(e)),this.computeInitial(),t.preventScrollAxis&&iG(e)!=="mouse"?(n._active=!1,this.setupScrollPrevention(e)):t.delay>0?(this.setupDelayTrigger(e),t.triggerAllEvents&&(this.compute(e),this.emit())):this.startPointerDrag(e))}startPointerDrag(e){const t=this.state;t._active=!0,t._preventScroll=!0,t._delayed=!1,this.compute(e),this.emit()}pointerMove(e){const t=this.state,n=this.config;if(!t._pointerActive)return;const r=FT(e);if(t._pointerId!==void 0&&r!==t._pointerId)return;const s=nA(e);if(document.pointerLockElement===e.target?t._delta=[e.movementX,e.movementY]:(t._delta=Tr.sub(s,t._values),this.computeValues(s)),Tr.addTo(t._movement,t._delta),this.compute(e),t._delayed&&t.intentional){this.timeoutStore.remove("dragDelay"),t.active=!1,this.startPointerDrag(e);return}if(n.preventScrollAxis&&!t._preventScroll)if(t.axis)if(t.axis===n.preventScrollAxis||n.preventScrollAxis==="xy"){t._active=!1,this.clean();return}else{this.timeoutStore.remove("startPointerDrag"),this.startPointerDrag(e);return}else return;this.emit()}pointerUp(e){this.ctrl.setEventIds(e);try{this.config.pointerCapture&&e.target.hasPointerCapture(e.pointerId)&&e.target.releasePointerCapture(e.pointerId)}catch{}const t=this.state,n=this.config;if(!t._active||!t._pointerActive)return;const r=FT(e);if(t._pointerId!==void 0&&r!==t._pointerId)return;this.state._pointerActive=!1,this.setActive(),this.compute(e);const[s,o]=t._distance;if(t.tap=s<=n.tapsThreshold&&o<=n.tapsThreshold,t.tap&&n.filterTaps)t._force=!0;else{const[a,l]=t._delta,[c,u]=t._movement,[h,f]=n.swipe.velocity,[d,m]=n.swipe.distance,A=n.swipe.duration;if(t.elapsedTime<A){const g=Math.abs(a/t.timeDelta),y=Math.abs(l/t.timeDelta);g>h&&Math.abs(c)>d&&(t.swipe[0]=Math.sign(a)),y>f&&Math.abs(u)>m&&(t.swipe[1]=Math.sign(l))}}this.emit()}pointerClick(e){!this.state.tap&&e.detail>0&&(e.preventDefault(),e.stopPropagation())}setupPointer(e){const t=this.config,n=t.device;t.pointerLock&&e.currentTarget.requestPointerLock(),t.pointerCapture||(this.eventStore.add(this.sharedConfig.window,n,"change",this.pointerMove.bind(this)),this.eventStore.add(this.sharedConfig.window,n,"end",this.pointerUp.bind(this)),this.eventStore.add(this.sharedConfig.window,n,"cancel",this.pointerUp.bind(this)))}pointerClean(){this.config.pointerLock&&document.pointerLockElement===this.state.currentTarget&&document.exitPointerLock()}preventScroll(e){this.state._preventScroll&&e.cancelable&&e.preventDefault()}setupScrollPrevention(e){this.state._preventScroll=!1,Vre(e);const t=this.eventStore.add(this.sharedConfig.window,"touch","change",this.preventScroll.bind(this),{passive:!1});this.eventStore.add(this.sharedConfig.window,"touch","end",t),this.eventStore.add(this.sharedConfig.window,"touch","cancel",t),this.timeoutStore.add("startPointerDrag",this.startPointerDrag.bind(this),this.config.preventScrollDelay,e)}setupDelayTrigger(e){this.state._delayed=!0,this.timeoutStore.add("dragDelay",()=>{this.state._step=[0,0],this.startPointerDrag(e)},this.config.delay)}keyDown(e){const t=uD[e.key];if(t){const n=this.state,r=e.shiftKey?10:e.altKey?.1:1;this.start(e),n._delta=t(this.config.keyboardDisplacement,r),n._keyboardActive=!0,Tr.addTo(n._movement,n._delta),this.compute(e),this.emit()}}keyUp(e){e.key in uD&&(this.state._keyboardActive=!1,this.setActive(),this.compute(e),this.emit())}bind(e){const t=this.config.device;e(t,"start",this.pointerDown.bind(this)),this.config.pointerCapture&&(e(t,"change",this.pointerMove.bind(this)),e(t,"end",this.pointerUp.bind(this)),e(t,"cancel",this.pointerUp.bind(this)),e("lostPointerCapture","",this.pointerUp.bind(this))),this.config.keys&&(e("key","down",this.keyDown.bind(this)),e("key","up",this.keyUp.bind(this))),this.config.filterTaps&&e("click","",this.pointerClick.bind(this),{capture:!0,passive:!1})}}function Vre(i){"persist"in i&&typeof i.persist=="function"&&i.persist()}const Ax=typeof window<"u"&&window.document&&window.document.createElement;function lG(){return Ax&&"ontouchstart"in window}function Wre(){return lG()||Ax&&window.navigator.maxTouchPoints>1}function jre(){return Ax&&"onpointerdown"in window}function Kre(){return Ax&&"exitPointerLock"in window.document}function $re(){try{return"constructor"in GestureEvent}catch{return!1}}const ac={isBrowser:Ax,gesture:$re(),touch:lG(),touchscreen:Wre(),pointer:jre(),pointerLock:Kre()},Yre=250,Xre=180,qre=.5,Jre=50,Zre=250,ese=10,hD={mouse:0,touch:0,pen:8},tse=Kr(Kr({},y0),{},{device(i,e,{pointer:{touch:t=!1,lock:n=!1,mouse:r=!1}={}}){return this.pointerLock=n&&ac.pointerLock,ac.touch&&t?"touch":this.pointerLock?"mouse":ac.pointer&&!r?"pointer":ac.touch?"touch":"mouse"},preventScrollAxis(i,e,{preventScroll:t}){if(this.preventScrollDelay=typeof t=="number"?t:t||t===void 0&&i?Yre:void 0,!(!ac.touchscreen||t===!1))return i||(t!==void 0?"y":void 0)},pointerCapture(i,e,{pointer:{capture:t=!0,buttons:n=1,keys:r=!0}={}}){return this.pointerButtons=n,this.keys=r,!this.pointerLock&&this.device==="pointer"&&t},threshold(i,e,{filterTaps:t=!1,tapsThreshold:n=3,axis:r=void 0}){const s=Tr.toVector(i,t?n:r?1:0);return this.filterTaps=t,this.tapsThreshold=n,s},swipe({velocity:i=qre,distance:e=Jre,duration:t=Zre}={}){return{velocity:this.transform(Tr.toVector(i)),distance:this.transform(Tr.toVector(e)),duration:t}},delay(i=0){switch(i){case!0:return Xre;case!1:return 0;default:return i}},axisThreshold(i){return i?Kr(Kr({},hD),i):hD},keyboardDisplacement(i=ese){return i}});function cG(i){const[e,t]=i.overflow,[n,r]=i._delta,[s,o]=i._direction;(e<0&&n>0&&s<0||e>0&&n<0&&s>0)&&(i._movement[0]=i._movementBound[0]),(t<0&&r>0&&o<0||t>0&&r<0&&o>0)&&(i._movement[1]=i._movementBound[1])}const nse=30,ise=100;class rse extends oG{constructor(...e){super(...e),Bs(this,"ingKey","pinching"),Bs(this,"aliasKey","da")}init(){this.state.offset=[1,0],this.state.lastOffset=[1,0],this.state._pointerEvents=new Map}reset(){super.reset();const e=this.state;e._touchIds=[],e.canceled=!1,e.cancel=this.cancel.bind(this),e.turns=0}computeOffset(){const{type:e,movement:t,lastOffset:n}=this.state;e==="wheel"?this.state.offset=Tr.add(t,n):this.state.offset=[(1+t[0])*n[0],t[1]+n[1]]}computeMovement(){const{offset:e,lastOffset:t}=this.state;this.state.movement=[e[0]/t[0],e[1]-t[1]]}axisIntent(){const e=this.state,[t,n]=e._movement;if(!e.axis){const r=Math.abs(t)*nse-Math.abs(n);r<0?e.axis="angle":r>0&&(e.axis="scale")}}restrictToAxis(e){this.config.lockDirection&&(this.state.axis==="scale"?e[1]=0:this.state.axis==="angle"&&(e[0]=0))}cancel(){const e=this.state;e.canceled||setTimeout(()=>{e.canceled=!0,e._active=!1,this.compute(),this.emit()},0)}touchStart(e){this.ctrl.setEventIds(e);const t=this.state,n=this.ctrl.touchIds;if(t._active&&t._touchIds.every(s=>n.has(s))||n.size<2)return;this.start(e),t._touchIds=Array.from(n).slice(0,2);const r=sD(e,t._touchIds);r&&this.pinchStart(e,r)}pointerStart(e){if(e.buttons!=null&&e.buttons%2!==1)return;this.ctrl.setEventIds(e),e.target.setPointerCapture(e.pointerId);const t=this.state,n=t._pointerEvents,r=this.ctrl.pointerIds;if(t._active&&Array.from(n.keys()).every(o=>r.has(o))||(n.size<2&&n.set(e.pointerId,e),t._pointerEvents.size<2))return;this.start(e);const s=NM(...Array.from(n.values()));s&&this.pinchStart(e,s)}pinchStart(e,t){const n=this.state;n.origin=t.origin,this.computeValues([t.distance,t.angle]),this.computeInitial(),this.compute(e),this.emit()}touchMove(e){if(!this.state._active)return;const t=sD(e,this.state._touchIds);t&&this.pinchMove(e,t)}pointerMove(e){const t=this.state._pointerEvents;if(t.has(e.pointerId)&&t.set(e.pointerId,e),!this.state._active)return;const n=NM(...Array.from(t.values()));n&&this.pinchMove(e,n)}pinchMove(e,t){const n=this.state,r=n._values[1],s=t.angle-r;let o=0;Math.abs(s)>270&&(o+=Math.sign(s)),this.computeValues([t.distance,t.angle-360*o]),n.origin=t.origin,n.turns=o,n._movement=[n._values[0]/n._initial[0]-1,n._values[1]-n._initial[1]],this.compute(e),this.emit()}touchEnd(e){this.ctrl.setEventIds(e),this.state._active&&this.state._touchIds.some(t=>!this.ctrl.touchIds.has(t))&&(this.state._active=!1,this.compute(e),this.emit())}pointerEnd(e){const t=this.state;this.ctrl.setEventIds(e);try{e.target.releasePointerCapture(e.pointerId)}catch{}t._pointerEvents.has(e.pointerId)&&t._pointerEvents.delete(e.pointerId),t._active&&t._pointerEvents.size<2&&(t._active=!1,this.compute(e),this.emit())}gestureStart(e){e.cancelable&&e.preventDefault();const t=this.state;t._active||(this.start(e),this.computeValues([e.scale,e.rotation]),t.origin=[e.clientX,e.clientY],this.compute(e),this.emit())}gestureMove(e){if(e.cancelable&&e.preventDefault(),!this.state._active)return;const t=this.state;this.computeValues([e.scale,e.rotation]),t.origin=[e.clientX,e.clientY];const n=t._movement;t._movement=[e.scale-1,e.rotation],t._delta=Tr.sub(t._movement,n),this.compute(e),this.emit()}gestureEnd(e){this.state._active&&(this.state._active=!1,this.compute(e),this.emit())}wheel(e){const t=this.config.modifierKey;t&&(Array.isArray(t)?!t.find(n=>e[n]):!e[t])||(this.state._active?this.wheelChange(e):this.wheelStart(e),this.timeoutStore.add("wheelEnd",this.wheelEnd.bind(this)))}wheelStart(e){this.start(e),this.wheelChange(e)}wheelChange(e){"uv"in e||e.cancelable&&e.preventDefault();const n=this.state;n._delta=[-sG(e)[1]/ise*n.offset[0],0],Tr.addTo(n._movement,n._delta),cG(n),this.state.origin=[e.clientX,e.clientY],this.compute(e),this.emit()}wheelEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(e){const t=this.config.device;t&&(e(t,"start",this[t+"Start"].bind(this)),e(t,"change",this[t+"Move"].bind(this)),e(t,"end",this[t+"End"].bind(this)),e(t,"cancel",this[t+"End"].bind(this)),e("lostPointerCapture","",this[t+"End"].bind(this))),this.config.pinchOnWheel&&e("wheel","",this.wheel.bind(this),{passive:!1})}}const sse=Kr(Kr({},aG),{},{device(i,e,{shared:t,pointer:{touch:n=!1}={}}){if(t.target&&!ac.touch&&ac.gesture)return"gesture";if(ac.touch&&n)return"touch";if(ac.touchscreen){if(ac.pointer)return"pointer";if(ac.touch)return"touch"}},bounds(i,e,{scaleBounds:t={},angleBounds:n={}}){const r=o=>{const a=lD(RS(t,o),{min:-1/0,max:1/0});return[a.min,a.max]},s=o=>{const a=lD(RS(n,o),{min:-1/0,max:1/0});return[a.min,a.max]};return typeof t!="function"&&typeof n!="function"?[r(),s()]:o=>[r(o),s(o)]},threshold(i,e,t){return this.lockDirection=t.axis==="lock",Tr.toVector(i,this.lockDirection?[.1,3]:0)},modifierKey(i){return i===void 0?"ctrlKey":i},pinchOnWheel(i=!0){return i}});class ose extends gx{constructor(...e){super(...e),Bs(this,"ingKey","moving")}move(e){this.config.mouseOnly&&e.pointerType!=="mouse"||(this.state._active?this.moveChange(e):this.moveStart(e),this.timeoutStore.add("moveEnd",this.moveEnd.bind(this)))}moveStart(e){this.start(e),this.computeValues(nA(e)),this.compute(e),this.computeInitial(),this.emit()}moveChange(e){if(!this.state._active)return;const t=nA(e),n=this.state;n._delta=Tr.sub(t,n._values),Tr.addTo(n._movement,n._delta),this.computeValues(t),this.compute(e),this.emit()}moveEnd(e){this.state._active&&(this.state._active=!1,this.compute(e),this.emit())}bind(e){e("pointer","change",this.move.bind(this)),e("pointer","leave",this.moveEnd.bind(this))}}const ase=Kr(Kr({},y0),{},{mouseOnly:(i=!0)=>i});class lse extends gx{constructor(...e){super(...e),Bs(this,"ingKey","scrolling")}scroll(e){this.state._active||this.start(e),this.scrollChange(e),this.timeoutStore.add("scrollEnd",this.scrollEnd.bind(this))}scrollChange(e){e.cancelable&&e.preventDefault();const t=this.state,n=kre(e);t._delta=Tr.sub(n,t._values),Tr.addTo(t._movement,t._delta),this.computeValues(n),this.compute(e),this.emit()}scrollEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(e){e("scroll","",this.scroll.bind(this))}}const cse=y0;class use extends gx{constructor(...e){super(...e),Bs(this,"ingKey","wheeling")}wheel(e){this.state._active||this.start(e),this.wheelChange(e),this.timeoutStore.add("wheelEnd",this.wheelEnd.bind(this))}wheelChange(e){const t=this.state;t._delta=sG(e),Tr.addTo(t._movement,t._delta),cG(t),this.compute(e),this.emit()}wheelEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(e){e("wheel","",this.wheel.bind(this))}}const hse=y0;class fse extends gx{constructor(...e){super(...e),Bs(this,"ingKey","hovering")}enter(e){this.config.mouseOnly&&e.pointerType!=="mouse"||(this.start(e),this.computeValues(nA(e)),this.compute(e),this.emit())}leave(e){if(this.config.mouseOnly&&e.pointerType!=="mouse")return;const t=this.state;if(!t._active)return;t._active=!1;const n=nA(e);t._movement=t._delta=Tr.sub(n,t._values),this.computeValues(n),this.compute(e),t.delta=t.movement,this.emit()}bind(e){e("pointer","enter",this.enter.bind(this)),e("pointer","leave",this.leave.bind(this))}}const dse=Kr(Kr({},y0),{},{mouseOnly:(i=!0)=>i}),sR=new Map,UM=new Map;function pse(i){sR.set(i.key,i.engine),UM.set(i.key,i.resolver)}const mse={key:"drag",engine:Qre,resolver:tse},gse={key:"hover",engine:fse,resolver:dse},Ase={key:"move",engine:ose,resolver:ase},yse={key:"pinch",engine:rse,resolver:sse},vse={key:"scroll",engine:lse,resolver:cse},xse={key:"wheel",engine:use,resolver:hse};function Ese(i,e){if(i==null)return{};var t={},n=Object.keys(i),r,s;for(s=0;s<n.length;s++)r=n[s],!(e.indexOf(r)>=0)&&(t[r]=i[r]);return t}function _se(i,e){if(i==null)return{};var t=Ese(i,e),n,r;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);for(r=0;r<s.length;r++)n=s[r],!(e.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(i,n)&&(t[n]=i[n])}return t}const Sse={target(i){if(i)return()=>"current"in i?i.current:i},enabled(i=!0){return i},window(i=ac.isBrowser?window:void 0){return i},eventOptions({passive:i=!0,capture:e=!1}={}){return{passive:i,capture:e}},transform(i){return i}},wse=["target","eventOptions","window","enabled","transform"];function K_(i={},e){const t={};for(const[n,r]of Object.entries(e))switch(typeof r){case"function":t[n]=r.call(t,i[n],n,i);break;case"object":t[n]=K_(i[n],r);break;case"boolean":r&&(t[n]=i[n]);break}return t}function Cse(i,e,t={}){const n=i,{target:r,eventOptions:s,window:o,enabled:a,transform:l}=n,c=_se(n,wse);if(t.shared=K_({target:r,eventOptions:s,window:o,enabled:a,transform:l},Sse),e){const u=UM.get(e);t[e]=K_(Kr({shared:t.shared},c),u)}else for(const u in c){const h=UM.get(u);h&&(t[u]=K_(Kr({shared:t.shared},c[u]),h))}return t}class uG{constructor(e,t){Bs(this,"_listeners",new Set),this._ctrl=e,this._gestureKey=t}add(e,t,n,r,s){const o=this._listeners,a=Lre(t,n),l=this._gestureKey?this._ctrl.config[this._gestureKey].eventOptions:{},c=Kr(Kr({},l),s);e.addEventListener(a,r,c);const u=()=>{e.removeEventListener(a,r,c),o.delete(u)};return o.add(u),u}clean(){this._listeners.forEach(e=>e()),this._listeners.clear()}}class Tse{constructor(){Bs(this,"_timeouts",new Map)}add(e,t,n=140,...r){this.remove(e),this._timeouts.set(e,window.setTimeout(t,n,...r))}remove(e){const t=this._timeouts.get(e);t&&window.clearTimeout(t)}clean(){this._timeouts.forEach(e=>void window.clearTimeout(e)),this._timeouts.clear()}}let bse=class{constructor(e){Bs(this,"gestures",new Set),Bs(this,"_targetEventStore",new uG(this)),Bs(this,"gestureEventStores",{}),Bs(this,"gestureTimeoutStores",{}),Bs(this,"handlers",{}),Bs(this,"config",{}),Bs(this,"pointerIds",new Set),Bs(this,"touchIds",new Set),Bs(this,"state",{shared:{shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1}}),Ise(this,e)}setEventIds(e){if(Jw(e))return this.touchIds=new Set(Dre(e)),this.touchIds;if("pointerId"in e)return e.type==="pointerup"||e.type==="pointercancel"?this.pointerIds.delete(e.pointerId):e.type==="pointerdown"&&this.pointerIds.add(e.pointerId),this.pointerIds}applyHandlers(e,t){this.handlers=e,this.nativeHandlers=t}applyConfig(e,t){this.config=Cse(e,t,this.config)}clean(){this._targetEventStore.clean();for(const e of this.gestures)this.gestureEventStores[e].clean(),this.gestureTimeoutStores[e].clean()}effect(){return this.config.shared.target&&this.bind(),()=>this._targetEventStore.clean()}bind(...e){const t=this.config.shared,n={};let r;if(!(t.target&&(r=t.target(),!r))){if(t.enabled){for(const o of this.gestures){const a=this.config[o],l=fD(n,a.eventOptions,!!r);if(a.enabled){const c=sR.get(o);new c(this,e,o).bind(l)}}const s=fD(n,t.eventOptions,!!r);for(const o in this.nativeHandlers)s(o,"",a=>this.nativeHandlers[o](Kr(Kr({},this.state.shared),{},{event:a,args:e})),void 0,!0)}for(const s in n)n[s]=Nre(...n[s]);if(!r)return n;for(const s in n){const{device:o,capture:a,passive:l}=Rre(s);this._targetEventStore.add(r,o,"",n[s],{capture:a,passive:l})}}}};function Pg(i,e){i.gestures.add(e),i.gestureEventStores[e]=new uG(i,e),i.gestureTimeoutStores[e]=new Tse}function Ise(i,e){e.drag&&Pg(i,"drag"),e.wheel&&Pg(i,"wheel"),e.scroll&&Pg(i,"scroll"),e.move&&Pg(i,"move"),e.pinch&&Pg(i,"pinch"),e.hover&&Pg(i,"hover")}const fD=(i,e,t)=>(n,r,s,o={},a=!1)=>{var l,c;const u=(l=o.capture)!==null&&l!==void 0?l:e.capture,h=(c=o.passive)!==null&&c!==void 0?c:e.passive;let f=a?n:Ire(n,r,u);t&&h&&(f+="Passive"),i[f]=i[f]||[],i[f].push(s)},Mse=/^on(Drag|Wheel|Scroll|Move|Pinch|Hover)/;function Rse(i){const e={},t={},n=new Set;for(let r in i)Mse.test(r)?(n.add(RegExp.lastMatch),t[r]=i[r]):e[r]=i[r];return[t,e,n]}function Bg(i,e,t,n,r,s){if(!i.has(t)||!sR.has(n))return;const o=t+"Start",a=t+"End",l=c=>{let u;return c.first&&o in e&&e[o](c),t in e&&(u=e[t](c)),c.last&&a in e&&e[a](c),u};r[n]=l,s[n]=s[n]||{}}function Lse(i,e){const[t,n,r]=Rse(i),s={};return Bg(r,t,"onDrag","drag",s,e),Bg(r,t,"onWheel","wheel",s,e),Bg(r,t,"onScroll","scroll",s,e),Bg(r,t,"onPinch","pinch",s,e),Bg(r,t,"onMove","move",s,e),Bg(r,t,"onHover","hover",s,e),{handlers:s,config:e,nativeHandlers:n}}function Pse(i,e={},t,n){const r=bl.useMemo(()=>new bse(i),[]);if(r.applyHandlers(i,n),r.applyConfig(e,t),bl.useEffect(r.effect.bind(r)),bl.useEffect(()=>r.clean.bind(r),[]),e.target===void 0)return r.bind.bind(r)}function Bse(i){return i.forEach(pse),function(t,n){const{handlers:r,nativeHandlers:s,config:o}=Lse(t,n||{});return Pse(r,o,void 0,s)}}function hG(i,e){return Bse([mse,yse,vse,xse,Ase,gse])(i,e||{})}const OT=new H,dD=new Ue,fm=new H,_3=new H,Gy=new H,pD=new vo,Dse=w.forwardRef(({autoTransform:i=!0,matrix:e,axisLock:t,dragLimits:n,onHover:r,onDragStart:s,onDrag:o,onDragEnd:a,children:l,dragConfig:c,...u},h)=>{const f=Ve(x=>x.controls),{camera:d,size:m,raycaster:A,invalidate:g}=Ve(),y=w.useRef(null),E=hG({onHover:({hovering:x})=>r&&r(x??!1),onDragStart:({event:x})=>{f&&(f.enabled=!1);const{point:C}=x;y.current.matrix.decompose(OT,new Xt,new H),fm.copy(C),_3.copy(fm).sub(OT),s&&s(OT),g()},onDrag:({xy:[x,C],intentional:T})=>{if(!T)return;const I=(x-m.left)/m.width*2-1,M=-((C-m.top)/m.height)*2+1;if(dD.set(I,M),A.setFromCamera(dD,d),!t)d.getWorldDirection(Gy).negate();else switch(t){case"x":Gy.set(1,0,0);break;case"y":Gy.set(0,1,0);break;case"z":Gy.set(0,0,1);break}pD.setFromNormalAndCoplanarPoint(Gy,fm),A.ray.intersectPlane(pD,fm);const L=y.current.matrix.clone(),R=y.current.matrixWorld.clone(),P=new H(fm.x-_3.x,fm.y-_3.y,fm.z-_3.z);if(n&&(P.x=n[0]?Math.max(Math.min(P.x,n[0][1]),n[0][0]):P.x,P.y=n[1]?Math.max(Math.min(P.y,n[1][1]),n[1][0]):P.y,P.z=n[2]?Math.max(Math.min(P.z,n[2][1]),n[2][0]):P.z),i){y.current.matrix.setPosition(P);const F=y.current.matrix.clone().multiply(L.invert()),k=y.current.matrix.clone().multiply(R.invert());o&&o(y.current.matrix,F,y.current.matrixWorld,k)}else{const F=new Xe().copy(y.current.matrix);F.setPosition(P);const k=F.clone().multiply(L.invert()),z=F.clone().multiply(R.invert());o&&o(F,k,y.current.matrixWorld,z)}g()},onDragEnd:()=>{f&&(f.enabled=!0),a&&a(),g()}},{drag:{filterTaps:!0,threshold:1,...typeof c=="object"?c:{}}});return w.useImperativeHandle(h,()=>y.current,[]),w.useLayoutEffect(()=>{e&&(y.current.matrix=e)},[e]),w.createElement("group",ot({ref:y},E(),{matrix:e,matrixAutoUpdate:!1},u),l)});function Zv(i,e,t){return e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function zM(i,e){return zM=Object.setPrototypeOf||function(n,r){return n.__proto__=r,n},zM(i,e)}function kse(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function Fse(){for(var i=arguments.length,e=new Array(i),t=0;t<i;t++)e[t]=arguments[t];var n=e[0],r=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=e[8];return n*a*h+r*l*c+s*o*u-s*a*c-r*o*h-n*l*u}function mD(i,e){for(var t=[],n=i.toArray(),r=e.toArray(),s=0;s<n.length;s++)t[s]=n[s]+r[s];return new Tn().fromArray(t)}function Ose(i){if(Array.isArray(i))return i}function Nse(i,e){var t=i==null?null:typeof Symbol<"u"&&i[Symbol.iterator]||i["@@iterator"];if(t!=null){var n=[],r=!0,s=!1,o,a;try{for(t=t.call(i);!(r=(o=t.next()).done)&&(n.push(o.value),!(e&&n.length===e));r=!0);}catch(l){s=!0,a=l}finally{try{!r&&t.return!=null&&t.return()}finally{if(s)throw a}}return n}}function GM(i,e){(e==null||e>i.length)&&(e=i.length);for(var t=0,n=new Array(e);t<e;t++)n[t]=i[t];return n}function fG(i,e){if(i){if(typeof i=="string")return GM(i,e);var t=Object.prototype.toString.call(i).slice(8,-1);if(t==="Object"&&i.constructor&&(t=i.constructor.name),t==="Map"||t==="Set")return Array.from(i);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return GM(i,e)}}function Use(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function yh(i,e){return Ose(i)||Nse(i,e)||fG(i,e)||Use()}function zse(i){if(Array.isArray(i))return GM(i)}function Gse(i){if(typeof Symbol<"u"&&i[Symbol.iterator]!=null||i["@@iterator"]!=null)return Array.from(i)}function Hse(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function LS(i){return zse(i)||Gse(i)||fG(i)||Hse()}function $_(i,e,t){return kse()?$_=Reflect.construct:$_=function(r,s,o){var a=[null];a.push.apply(a,s);var l=Function.bind.apply(r,a),c=new l;return o&&zM(c,o.prototype),c},$_.apply(null,arguments)}function Qse(i){var e=yh(i[0],2),t=e[0],n=e[1],r=yh(i[1],2),s=r[0],o=r[1],a=yh(i[2],2),l=a[0],c=a[1];return Fse(t,n,1,s,o,1,l,c,1)}function Vse(i){return Qse(i)===0}var Wse=new Ue,jse=new Ue;function gD(i){var e=i.map(function(c){return Array.isArray(c)?$_(Ue,LS(c)):c}),t=yh(e,3),n=t[0],r=t[1],s=t[2];if(Vse(i))return!1;var o=Wse.subVectors(r,n),a=jse.subVectors(s,n),l=a.cross(o);return l>0}function dG(i,e,t){return Math.max(e,Math.min(t,i))}function pG(i,e){return dG(i-Math.floor(i/e)*e,0,e)}function mG(i,e){var t=pG(e-i,Math.PI*2);return t>Math.PI&&(t-=Math.PI*2),t}function Kse(i){return i/180*Math.PI}function $se(i){return i*180/Math.PI}function Yse(i,e){for(var t=e.radius,n=t===void 0?1:t,r=i.length/3,s=2/r,o=Math.PI*(3-2.2360679775),a=0;a<i.length;a+=3){var l=a*s-1+s/2,c=Math.sqrt(1-Math.pow(l,2)),u=a%r*o,h=Math.cos(u)*c,f=Math.sin(u)*c;i[a]=h*n,i[a+1]=l*n,i[a+2]=f*n}}function Xse(i,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Number.EPSILON;return Math.abs(i.x-e.x)<t&&Math.abs(i.y-e.y)<t&&Math.abs(i.z-e.z)<t}function gG(i,e){return i.x===e.x?typeof i.z<"u"&&i.y===e.y?i.z-e.z:i.y-e.y:i.x-e.x}function qse(i){for(var e=i.sort(gG),t=[e[0],e[1]],n=2;n<e.length;n++)for(t.push(e[n]);t.length>2&&gD(LS(t.slice(-3)));)t.splice(t.length-2,1);for(var r=[e[e.length-1],e[e.length-2]],s=e.length-3;s>=0;s--)for(r.push(e[s]);r.length>2&&gD(LS(r.slice(-3)));)r.splice(r.length-2,1);r.splice(0,1),r.splice(r.length-1,1);var o=[].concat(t,r);return o}function Jse(i,e,t){var n=yh(e,2),r=n[0],s=n[1],o=yh(t,2),a=o[0],l=o[1];return a+(i-r)*(l-a)/(s-r)}function Zse(i){return i*i*i*(i*(i*6-15)+10)}function eoe(i,e,t){return i*(1-t)+e*t}function AG(i,e,t){return(t-i)/(e-i)}function toe(i,e,t){var n=Math.sqrt(i*i+e*e+t*t);return[i/n,e/n,t/n]}function noe(i,e,t){var n=i*i,r=e*e,s=t*t,o=i*Math.sqrt(1-(r+s)/2+r*s/3),a=e*Math.sqrt(1-(s+n)/2+s*n/3),l=t*Math.sqrt(1-(n+r)/2+n*r/3);return[o,a,l]}function yG(i,e){var t=new H().crossVectors(i,e),n=i.dot(e),r=new Tn().identity(),s=new Tn().set(0,-t.z,t.y,t.z,0,-t.x,-t.y,t.x,0),o=new Tn().multiplyMatrices(s,s).multiplyScalar(1/(1+n)),a=mD(mD(r,s),o);return a}function ioe(i,e,t){var n=Math.asin(e),r=Math.atan2(i,-t);return[n,r]}function roe(i,e){var t=Math.sin(i),n=Math.cos(i),r=Math.sin(e)*n,s=-Math.cos(e)*n;return[r,t,s]}function soe(i,e){var t=yh(e,2),n=t[0],r=t[1],s=yG(i.normal,new H(0,1,0)),o=AG(n.clone().applyMatrix3(s).y,r.clone().applyMatrix3(s).y,0);return new H().lerpVectors(n,r,o)}function ooe(i,e){var t=e.normal.dot(i);return t}function aoe(i,e){var t=yh(i,3),n=t[0],r=t[1],s=t[2],o=yh(e,2),a=o[0],l=o[1];return s*a*l+r*a+n}function loe(i,e){var t=yh(e,2),n=t[0],r=t[1],s=n*r,o=i/s,a=i-s*o,l=a/n,c=a%n;return[c,l,o]}function coe(i,e){return i[0]+e[0]*i[1]}function uoe(i,e){var t=i%e,n=Math.floor(i/e);return[t,n]}var S3=Object.freeze({__proto__:null,clamp:dG,repeat:pG,deltaAngle:mG,degToRad:Kse,radToDeg:$se,fibonacciOnSphere:Yse,vectorEquals:Xse,lexicographic:gG,convexHull:qse,remap:Jse,fade:Zse,lerp:eoe,inverseLerp:AG,normalize:toe,pointOnCubeToPointOnSphere:noe,rotateVectorOnVector:yG,pointToCoordinate:ioe,coordinateToPoint:roe,planeSegmentIntersection:soe,pointToPlaneDistance:ooe,getIndexFrom3D:aoe,get3DFromIndex:loe,getIndexFrom2D:coe,get2DFromIndex:uoe});function vG(i,e){if(!(i instanceof e))throw new TypeError("Cannot call a class as a function")}var Jl=function i(e,t,n){var r=this;vG(this,i),Zv(this,"dot2",function(s,o){return r.x*s+r.y*o}),Zv(this,"dot3",function(s,o,a){return r.x*s+r.y*o+r.z*a}),this.x=e,this.y=t,this.z=n},hoe=[new Jl(1,1,0),new Jl(-1,1,0),new Jl(1,-1,0),new Jl(-1,-1,0),new Jl(1,0,1),new Jl(-1,0,1),new Jl(1,0,-1),new Jl(-1,0,-1),new Jl(0,1,1),new Jl(0,-1,1),new Jl(0,1,-1),new Jl(0,-1,-1)],AD=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],yD=new Array(512),vD=new Array(512),foe=function(e){e>0&&e<1&&(e*=65536),e=Math.floor(e),e<256&&(e|=e<<8);for(var t=0;t<256;t++){var n;t&1?n=AD[t]^e&255:n=AD[t]^e>>8&255,yD[t]=yD[t+256]=n,vD[t]=vD[t+256]=hoe[n%12]}};foe(0);function doe(i){if(typeof i=="number")i=Math.abs(i);else if(typeof i=="string"){var e=i;i=0;for(var t=0;t<e.length;t++)i=(i+(t+1)*(e.charCodeAt(t)%96))%2147483647}return i===0&&(i=311),i}function xD(i){var e=doe(i);return function(){var t=e*48271%2147483647;return e=t,t/2147483647}}var poe=function i(e){var t=this;vG(this,i),Zv(this,"seed",0),Zv(this,"init",function(n){t.seed=n,t.value=xD(n)}),Zv(this,"value",xD(this.seed)),this.init(e)};new poe(Math.random());var moe=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:.01,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1/(2*Math.PI);return n/Math.atan(1/t)*Math.atan(Math.sin(2*Math.PI*e*r)/t)},xG=function(e){return 1/(1+e+.48*e*e+.235*e*e*e)},goe=function(e){return e},Aoe={in:function(e){return 1-Math.cos(e*Math.PI/2)},out:function(e){return Math.sin(e*Math.PI/2)},inOut:function(e){return-(Math.cos(Math.PI*e)-1)/2}},yoe={in:function(e){return e*e*e},out:function(e){return 1-Math.pow(1-e,3)},inOut:function(e){return e<.5?4*e*e*e:1-Math.pow(-2*e+2,3)/2}},voe={in:function(e){return e*e*e*e*e},out:function(e){return 1-Math.pow(1-e,5)},inOut:function(e){return e<.5?16*e*e*e*e*e:1-Math.pow(-2*e+2,5)/2}},xoe={in:function(e){return 1-Math.sqrt(1-Math.pow(e,2))},out:function(e){return Math.sqrt(1-Math.pow(e-1,2))},inOut:function(e){return e<.5?(1-Math.sqrt(1-Math.pow(2*e,2)))/2:(Math.sqrt(1-Math.pow(-2*e+2,2))+1)/2}},Eoe={in:function(e){return e*e*e*e},out:function(e){return 1- --e*e*e*e},inOut:function(e){return e<.5?8*e*e*e*e:1-8*--e*e*e*e}},_oe={in:function(e){return e===0?0:Math.pow(2,10*e-10)},out:function(e){return e===1?1:1-Math.pow(2,-10*e)},inOut:function(e){return e===0?0:e===1?1:e<.5?Math.pow(2,20*e-10)/2:(2-Math.pow(2,-20*e+10))/2}};function io(i,e,t){var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:.25,r=arguments.length>4&&arguments[4]!==void 0?arguments[4]:.01,s=arguments.length>5&&arguments[5]!==void 0?arguments[5]:1/0,o=arguments.length>6&&arguments[6]!==void 0?arguments[6]:xG,a=arguments.length>7&&arguments[7]!==void 0?arguments[7]:.001,l="velocity_"+e;if(i.__damp===void 0&&(i.__damp={}),i.__damp[l]===void 0&&(i.__damp[l]=0),Math.abs(i[e]-t)<=a)return i[e]=t,!1;n=Math.max(1e-4,n);var c=2/n,u=o(c*r),h=i[e]-t,f=t,d=s*n;h=Math.min(Math.max(h,-d),d),t=i[e]-h;var m=(i.__damp[l]+c*h)*r;i.__damp[l]=(i.__damp[l]-c*m)*u;var A=t+(h+m)*u;return f-i[e]>0==A>f&&(A=f,i.__damp[l]=(A-f)/r),i[e]=A,!0}var Soe=function(e){return e&&e.isCamera},woe=function(e){return e&&e.isLight},Hy=new H,ED=new Xt,_D=new Xt,Qy=new Xe,NT=new H;function Coe(i,e,t,n,r,s,o){typeof e=="number"?Hy.setScalar(e):Array.isArray(e)?Hy.set(e[0],e[1],e[2]):Hy.copy(e);var a=i.parent;i.updateWorldMatrix(!0,!1),NT.setFromMatrixPosition(i.matrixWorld),Soe(i)||woe(i)?Qy.lookAt(NT,Hy,i.up):Qy.lookAt(Hy,NT,i.up),PS(i.quaternion,_D.setFromRotationMatrix(Qy),t,n,r,s,o),a&&(Qy.extractRotation(a.matrixWorld),ED.setFromRotationMatrix(Qy),PS(i.quaternion,_D.copy(i.quaternion).premultiply(ED.invert()),t,n,r,s,o))}function N1(i,e,t,n,r,s,o,a){return io(i,e,i[e]+mG(i[e],t),n,r,s,o,a)}var Vy=new Ue,SD,wD;function Toe(i,e,t,n,r,s,o){return typeof e=="number"?Vy.setScalar(e):Array.isArray(e)?Vy.set(e[0],e[1]):Vy.copy(e),SD=io(i,"x",Vy.x,t,n,r,s,o),wD=io(i,"y",Vy.y,t,n,r,s,o),SD||wD}var Dg=new H,CD,TD,bD;function HM(i,e,t,n,r,s,o){return typeof e=="number"?Dg.setScalar(e):Array.isArray(e)?Dg.set(e[0],e[1],e[2]):Dg.copy(e),CD=io(i,"x",Dg.x,t,n,r,s,o),TD=io(i,"y",Dg.y,t,n,r,s,o),bD=io(i,"z",Dg.z,t,n,r,s,o),CD||TD||bD}var dm=new Rn,ID,MD,RD,LD;function boe(i,e,t,n,r,s,o){return typeof e=="number"?dm.setScalar(e):Array.isArray(e)?dm.set(e[0],e[1],e[2],e[3]):dm.copy(e),ID=io(i,"x",dm.x,t,n,r,s,o),MD=io(i,"y",dm.y,t,n,r,s,o),RD=io(i,"z",dm.z,t,n,r,s,o),LD=io(i,"w",dm.w,t,n,r,s,o),ID||MD||RD||LD}var Wy=new Eo,PD,BD,DD;function Ioe(i,e,t,n,r,s,o){return Array.isArray(e)?Wy.set(e[0],e[1],e[2],e[3]):Wy.copy(e),PD=N1(i,"x",Wy.x,t,n,r,s,o),BD=N1(i,"y",Wy.y,t,n,r,s,o),DD=N1(i,"z",Wy.z,t,n,r,s,o),PD||BD||DD}var kg=new ut,kD,FD,OD;function Moe(i,e,t,n,r,s,o){return e instanceof ut?kg.copy(e):Array.isArray(e)?kg.setRGB(e[0],e[1],e[2]):kg.set(e),kD=io(i,"r",kg.r,t,n,r,s,o),FD=io(i,"g",kg.g,t,n,r,s,o),OD=io(i,"b",kg.b,t,n,r,s,o),kD||FD||OD}var tu=new Xt,uf=new Rn,ND=new Rn,jy=new Rn,UD,zD,GD,HD;function PS(i,e,t,n,r,s,o){var a=i;Array.isArray(e)?tu.set(e[0],e[1],e[2],e[3]):tu.copy(e);var l=i.dot(tu)>0?1:-1;return tu.x*=l,tu.y*=l,tu.z*=l,tu.w*=l,UD=io(i,"x",tu.x,t,n,r,s,o),zD=io(i,"y",tu.y,t,n,r,s,o),GD=io(i,"z",tu.z,t,n,r,s,o),HD=io(i,"w",tu.w,t,n,r,s,o),uf.set(i.x,i.y,i.z,i.w).normalize(),ND.set(a.__damp.velocity_x,a.__damp.velocity_y,a.__damp.velocity_z,a.__damp.velocity_w),jy.copy(uf).multiplyScalar(ND.dot(uf)/uf.dot(uf)),a.__damp.velocity_x-=jy.x,a.__damp.velocity_y-=jy.y,a.__damp.velocity_z-=jy.z,a.__damp.velocity_w-=jy.w,i.set(uf.x,uf.y,uf.z,uf.w),UD||zD||GD||HD}var Ky=new e0,QD,VD,WD;function Roe(i,e,t,n,r,s,o){return Array.isArray(e)?Ky.set(e[0],e[1],e[2]):Ky.copy(e),QD=io(i,"radius",Ky.radius,t,n,r,s,o),VD=N1(i,"phi",Ky.phi,t,n,r,s,o),WD=N1(i,"theta",Ky.theta,t,n,r,s,o),QD||VD||WD}var w3=new Xe,jD=new H,KD=new Xt,$D=new H,YD,XD,qD;function Loe(i,e,t,n,r,s,o){var a=i;return a.__damp===void 0&&(a.__damp={position:new H,rotation:new Xt,scale:new H},i.decompose(a.__damp.position,a.__damp.rotation,a.__damp.scale)),Array.isArray(e)?w3.set.apply(w3,LS(e)):w3.copy(e),w3.decompose(jD,KD,$D),YD=HM(a.__damp.position,jD,t,n,r,s,o),XD=PS(a.__damp.rotation,KD,t,n,r,s,o),qD=HM(a.__damp.scale,$D,t,n,r,s,o),i.compose(a.__damp.position,a.__damp.rotation,a.__damp.scale),YD||XD||qD}var iA=Object.freeze({__proto__:null,rsqw:moe,exp:xG,linear:goe,sine:Aoe,cubic:yoe,quint:voe,circ:xoe,quart:Eoe,expo:_oe,damp:io,dampLookAt:Coe,dampAngle:N1,damp2:Toe,damp3:HM,damp4:boe,dampE:Ioe,dampC:Moe,dampQ:PS,dampS:Roe,dampM:Loe});const oR=w.createContext(null);function aR(){return w.useContext(oR)}function Poe({eps:i=1e-5,enabled:e=!0,infinite:t,horizontal:n,pages:r=1,distance:s=1,damping:o=.25,maxSpeed:a=1/0,prepend:l=!1,style:c={},children:u}){const{get:h,setEvents:f,gl:d,size:m,invalidate:A,events:g}=Ve(),[y]=w.useState(()=>document.createElement("div")),[E]=w.useState(()=>document.createElement("div")),[x]=w.useState(()=>document.createElement("div")),C=d.domElement.parentNode,T=w.useRef(0),I=w.useMemo(()=>({el:y,eps:i,fill:E,fixed:x,horizontal:n,damping:o,offset:0,delta:0,scroll:T,pages:r,range(R,P,F=0){const k=R-F,z=k+P+F*2;return this.offset<k?0:this.offset>z?1:(this.offset-k)/(z-k)},curve(R,P,F=0){return Math.sin(this.range(R,P,F)*Math.PI)},visible(R,P,F=0){const k=R-F,z=k+P+F*2;return this.offset>=k&&this.offset<=z}}),[i,o,n,r]);w.useEffect(()=>{y.style.position="absolute",y.style.width="100%",y.style.height="100%",y.style[n?"overflowX":"overflowY"]="auto",y.style[n?"overflowY":"overflowX"]="hidden",y.style.top="0px",y.style.left="0px";for(const P in c)y.style[P]=c[P];x.style.position="sticky",x.style.top="0px",x.style.left="0px",x.style.width="100%",x.style.height="100%",x.style.overflow="hidden",y.appendChild(x),E.style.height=n?"100%":`${r*s*100}%`,E.style.width=n?`${r*s*100}%`:"100%",E.style.pointerEvents="none",y.appendChild(E),l?C.prepend(y):C.appendChild(y),y[n?"scrollLeft":"scrollTop"]=1;const L=g.connected||d.domElement;requestAnimationFrame(()=>g.connect==null?void 0:g.connect(y));const R=h().events.compute;return f({compute(P,F){const{left:k,top:z}=C.getBoundingClientRect(),U=P.clientX-k,W=P.clientY-z;F.pointer.set(U/F.size.width*2-1,-(W/F.size.height)*2+1),F.raycaster.setFromCamera(F.pointer,F.camera)}}),()=>{C.removeChild(y),f({compute:R}),g.connect==null||g.connect(L)}},[r,s,n,y,E,x,C]),w.useEffect(()=>{if(g.connected===y){const L=m[n?"width":"height"],R=y[n?"scrollWidth":"scrollHeight"],P=R-L;let F=0,k=!0,z=!0;const U=()=>{if(!(!e||z)&&(A(),F=y[n?"scrollLeft":"scrollTop"],T.current=F/P,t)){if(!k){if(F>=P){const $=1-I.offset;y[n?"scrollLeft":"scrollTop"]=1,T.current=I.offset=-$,k=!0}else if(F<=0){const $=1+I.offset;y[n?"scrollLeft":"scrollTop"]=R,T.current=I.offset=$,k=!0}}k&&setTimeout(()=>k=!1,40)}};y.addEventListener("scroll",U,{passive:!0}),requestAnimationFrame(()=>z=!1);const W=$=>y.scrollLeft+=$.deltaY/2;return n&&y.addEventListener("wheel",W,{passive:!0}),()=>{y.removeEventListener("scroll",U),n&&y.removeEventListener("wheel",W)}}},[y,g,m,t,I,A,n,e]);let M=0;return Kt((L,R)=>{M=I.offset,iA.damp(I,"offset",T.current,o,R,a,void 0,i),iA.damp(I,"delta",Math.abs(M-I.offset),o,R,a,void 0,i),I.delta>i&&A()}),w.createElement(oR.Provider,{value:I},u)}const Boe=w.forwardRef(({children:i},e)=>{const t=w.useRef(null);w.useImperativeHandle(e,()=>t.current,[]);const n=aR(),{width:r,height:s}=Ve(o=>o.viewport);return Kt(()=>{t.current.position.x=n.horizontal?-r*(n.pages-1)*n.offset:0,t.current.position.y=n.horizontal?0:s*(n.pages-1)*n.offset}),w.createElement("group",{ref:t},i)}),Doe=w.forwardRef(({children:i,style:e,...t},n)=>{const r=aR(),s=w.useRef(null);w.useImperativeHandle(n,()=>s.current,[]);const{width:o,height:a}=Ve(u=>u.size),l=w.useContext(t0),c=w.useMemo(()=>h6.createRoot(r.fixed),[r.fixed]);return Kt(()=>{r.delta>r.eps&&(s.current.style.transform=`translate3d(${r.horizontal?-o*(r.pages-1)*r.offset:0}px,${r.horizontal?0:a*(r.pages-1)*-r.offset}px,0)`)}),c.render(w.createElement("div",ot({ref:s,style:{...e,position:"absolute",top:0,left:0,willChange:"transform"}},t),w.createElement(oR.Provider,{value:r},w.createElement(t0.Provider,{value:l},i)))),null}),koe=w.forwardRef(({html:i,...e},t)=>{const n=i?Doe:Boe;return w.createElement(n,ot({ref:t},e))});var lR=vx(),Xn=i=>yx(i,lR),cR=vx();Xn.write=i=>yx(i,cR);var Zw=vx();Xn.onStart=i=>yx(i,Zw);var uR=vx();Xn.onFrame=i=>yx(i,uR);var hR=vx();Xn.onFinish=i=>yx(i,hR);var U1=[];Xn.setTimeout=(i,e)=>{const t=Xn.now()+e,n=()=>{const s=U1.findIndex(o=>o.cancel==n);~s&&U1.splice(s,1),Vd-=~s?1:0},r={time:t,handler:i,cancel:n};return U1.splice(EG(t),0,r),Vd+=1,_G(),r};var EG=i=>~(~U1.findIndex(e=>e.time>i)||~U1.length);Xn.cancel=i=>{Zw.delete(i),uR.delete(i),hR.delete(i),lR.delete(i),cR.delete(i)};Xn.sync=i=>{QM=!0,Xn.batchedUpdates(i),QM=!1};Xn.throttle=i=>{let e;function t(){try{i(...e)}finally{e=null}}function n(...r){e=r,Xn.onStart(t)}return n.handler=i,n.cancel=()=>{Zw.delete(t),e=null},n};var fR=typeof window<"u"?window.requestAnimationFrame:(()=>{});Xn.use=i=>fR=i;Xn.now=typeof performance<"u"?()=>performance.now():Date.now;Xn.batchedUpdates=i=>i();Xn.catch=console.error;Xn.frameLoop="always";Xn.advance=()=>{Xn.frameLoop!=="demand"?console.warn("Cannot call the manual advancement of rafz whilst frameLoop is not set as demand"):wG()};var Qd=-1,Vd=0,QM=!1;function yx(i,e){QM?(e.delete(i),i(0)):(e.add(i),_G())}function _G(){Qd<0&&(Qd=0,Xn.frameLoop!=="demand"&&fR(SG))}function Foe(){Qd=-1}function SG(){~Qd&&(fR(SG),Xn.batchedUpdates(wG))}function wG(){const i=Qd;Qd=Xn.now();const e=EG(Qd);if(e&&(CG(U1.splice(0,e),t=>t.handler()),Vd-=e),!Vd){Foe();return}Zw.flush(),lR.flush(i?Math.min(64,Qd-i):16.667),uR.flush(),cR.flush(),hR.flush()}function vx(){let i=new Set,e=i;return{add(t){Vd+=e==i&&!i.has(t)?1:0,i.add(t)},delete(t){return Vd-=e==i&&i.has(t)?1:0,i.delete(t)},flush(t){e.size&&(i=new Set,Vd-=e.size,CG(e,n=>n(t)&&i.add(n)),Vd+=i.size,e=i)}}}function CG(i,e){i.forEach(t=>{try{e(t)}catch(n){Xn.catch(n)}})}var Ooe=Object.defineProperty,Noe=(i,e)=>{for(var t in e)Ooe(i,t,{get:e[t],enumerable:!0})},wu={};Noe(wu,{assign:()=>zoe,colors:()=>qd,createStringInterpolator:()=>pR,skipAnimation:()=>bG,to:()=>TG,willAdvance:()=>mR});function VM(){}var Uoe=(i,e,t)=>Object.defineProperty(i,e,{value:t,writable:!0,configurable:!0}),zt={arr:Array.isArray,obj:i=>!!i&&i.constructor.name==="Object",fun:i=>typeof i=="function",str:i=>typeof i=="string",num:i=>typeof i=="number",und:i=>i===void 0};function vf(i,e){if(zt.arr(i)){if(!zt.arr(e)||i.length!==e.length)return!1;for(let t=0;t<i.length;t++)if(i[t]!==e[t])return!1;return!0}return i===e}var Oi=(i,e)=>i.forEach(e);function Nf(i,e,t){if(zt.arr(i)){for(let n=0;n<i.length;n++)e.call(t,i[n],`${n}`);return}for(const n in i)i.hasOwnProperty(n)&&e.call(t,i[n],n)}var fc=i=>zt.und(i)?[]:zt.arr(i)?i:[i];function e2(i,e){if(i.size){const t=Array.from(i);i.clear(),Oi(t,e)}}var kv=(i,...e)=>e2(i,t=>t(...e)),dR=()=>typeof window>"u"||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent),pR,TG,qd=null,bG=!1,mR=VM,zoe=i=>{i.to&&(TG=i.to),i.now&&(Xn.now=i.now),i.colors!==void 0&&(qd=i.colors),i.skipAnimation!=null&&(bG=i.skipAnimation),i.createStringInterpolator&&(pR=i.createStringInterpolator),i.requestAnimationFrame&&Xn.use(i.requestAnimationFrame),i.batchedUpdates&&(Xn.batchedUpdates=i.batchedUpdates),i.willAdvance&&(mR=i.willAdvance),i.frameLoop&&(Xn.frameLoop=i.frameLoop)},t2=new Set,cc=[],UT=[],BS=0,e4={get idle(){return!t2.size&&!cc.length},start(i){BS>i.priority?(t2.add(i),Xn.onStart(Goe)):(IG(i),Xn(WM))},advance:WM,sort(i){if(BS)Xn.onFrame(()=>e4.sort(i));else{const e=cc.indexOf(i);~e&&(cc.splice(e,1),MG(i))}},clear(){cc=[],t2.clear()}};function Goe(){t2.forEach(IG),t2.clear(),Xn(WM)}function IG(i){cc.includes(i)||MG(i)}function MG(i){cc.splice(Hoe(cc,e=>e.priority>i.priority),0,i)}function WM(i){const e=UT;for(let t=0;t<cc.length;t++){const n=cc[t];BS=n.priority,n.idle||(mR(n),n.advance(i),n.idle||e.push(n))}return BS=0,UT=cc,UT.length=0,cc=e,cc.length>0}function Hoe(i,e){const t=i.findIndex(e);return t<0?i.length:t}var Qoe={transparent:0,aliceblue:4042850303,antiquewhite:4209760255,aqua:16777215,aquamarine:2147472639,azure:4043309055,beige:4126530815,bisque:4293182719,black:255,blanchedalmond:4293643775,blue:65535,blueviolet:2318131967,brown:2771004159,burlywood:3736635391,burntsienna:3934150143,cadetblue:1604231423,chartreuse:2147418367,chocolate:3530104575,coral:4286533887,cornflowerblue:1687547391,cornsilk:4294499583,crimson:3692313855,cyan:16777215,darkblue:35839,darkcyan:9145343,darkgoldenrod:3095792639,darkgray:2846468607,darkgreen:6553855,darkgrey:2846468607,darkkhaki:3182914559,darkmagenta:2332068863,darkolivegreen:1433087999,darkorange:4287365375,darkorchid:2570243327,darkred:2332033279,darksalmon:3918953215,darkseagreen:2411499519,darkslateblue:1211993087,darkslategray:793726975,darkslategrey:793726975,darkturquoise:13554175,darkviolet:2483082239,deeppink:4279538687,deepskyblue:12582911,dimgray:1768516095,dimgrey:1768516095,dodgerblue:512819199,firebrick:2988581631,floralwhite:4294635775,forestgreen:579543807,fuchsia:4278255615,gainsboro:3705462015,ghostwhite:4177068031,gold:4292280575,goldenrod:3668254975,gray:2155905279,green:8388863,greenyellow:2919182335,grey:2155905279,honeydew:4043305215,hotpink:4285117695,indianred:3445382399,indigo:1258324735,ivory:4294963455,khaki:4041641215,lavender:3873897215,lavenderblush:4293981695,lawngreen:2096890111,lemonchiffon:4294626815,lightblue:2916673279,lightcoral:4034953471,lightcyan:3774873599,lightgoldenrodyellow:4210742015,lightgray:3553874943,lightgreen:2431553791,lightgrey:3553874943,lightpink:4290167295,lightsalmon:4288707327,lightseagreen:548580095,lightskyblue:2278488831,lightslategray:2005441023,lightslategrey:2005441023,lightsteelblue:2965692159,lightyellow:4294959359,lime:16711935,limegreen:852308735,linen:4210091775,magenta:4278255615,maroon:2147483903,mediumaquamarine:1724754687,mediumblue:52735,mediumorchid:3126187007,mediumpurple:2473647103,mediumseagreen:1018393087,mediumslateblue:2070474495,mediumspringgreen:16423679,mediumturquoise:1221709055,mediumvioletred:3340076543,midnightblue:421097727,mintcream:4127193855,mistyrose:4293190143,moccasin:4293178879,navajowhite:4292783615,navy:33023,oldlace:4260751103,olive:2155872511,olivedrab:1804477439,orange:4289003775,orangered:4282712319,orchid:3664828159,palegoldenrod:4008225535,palegreen:2566625535,paleturquoise:2951671551,palevioletred:3681588223,papayawhip:4293907967,peachpuff:4292524543,peru:3448061951,pink:4290825215,plum:3718307327,powderblue:2967529215,purple:2147516671,rebeccapurple:1714657791,red:4278190335,rosybrown:3163525119,royalblue:1097458175,saddlebrown:2336560127,salmon:4202722047,sandybrown:4104413439,seagreen:780883967,seashell:4294307583,sienna:2689740287,silver:3233857791,skyblue:2278484991,slateblue:1784335871,slategray:1887473919,slategrey:1887473919,snow:4294638335,springgreen:16744447,steelblue:1182971135,tan:3535047935,teal:8421631,thistle:3636451583,tomato:4284696575,turquoise:1088475391,violet:4001558271,wheat:4125012991,white:4294967295,whitesmoke:4126537215,yellow:4294902015,yellowgreen:2597139199},gu="[-+]?\\d*\\.?\\d+",DS=gu+"%";function t4(...i){return"\\(\\s*("+i.join(")\\s*,\\s*(")+")\\s*\\)"}var Voe=new RegExp("rgb"+t4(gu,gu,gu)),Woe=new RegExp("rgba"+t4(gu,gu,gu,gu)),joe=new RegExp("hsl"+t4(gu,DS,DS)),Koe=new RegExp("hsla"+t4(gu,DS,DS,gu)),$oe=/^#([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,Yoe=/^#([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,Xoe=/^#([0-9a-fA-F]{6})$/,qoe=/^#([0-9a-fA-F]{8})$/;function Joe(i){let e;return typeof i=="number"?i>>>0===i&&i>=0&&i<=4294967295?i:null:(e=Xoe.exec(i))?parseInt(e[1]+"ff",16)>>>0:qd&&qd[i]!==void 0?qd[i]:(e=Voe.exec(i))?(Fg(e[1])<<24|Fg(e[2])<<16|Fg(e[3])<<8|255)>>>0:(e=Woe.exec(i))?(Fg(e[1])<<24|Fg(e[2])<<16|Fg(e[3])<<8|e9(e[4]))>>>0:(e=$oe.exec(i))?parseInt(e[1]+e[1]+e[2]+e[2]+e[3]+e[3]+"ff",16)>>>0:(e=qoe.exec(i))?parseInt(e[1],16)>>>0:(e=Yoe.exec(i))?parseInt(e[1]+e[1]+e[2]+e[2]+e[3]+e[3]+e[4]+e[4],16)>>>0:(e=joe.exec(i))?(JD(ZD(e[1]),C3(e[2]),C3(e[3]))|255)>>>0:(e=Koe.exec(i))?(JD(ZD(e[1]),C3(e[2]),C3(e[3]))|e9(e[4]))>>>0:null}function zT(i,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?i+(e-i)*6*t:t<1/2?e:t<2/3?i+(e-i)*(2/3-t)*6:i}function JD(i,e,t){const n=t<.5?t*(1+e):t+e-t*e,r=2*t-n,s=zT(r,n,i+1/3),o=zT(r,n,i),a=zT(r,n,i-1/3);return Math.round(s*255)<<24|Math.round(o*255)<<16|Math.round(a*255)<<8}function Fg(i){const e=parseInt(i,10);return e<0?0:e>255?255:e}function ZD(i){return(parseFloat(i)%360+360)%360/360}function e9(i){const e=parseFloat(i);return e<0?0:e>1?255:Math.round(e*255)}function C3(i){const e=parseFloat(i);return e<0?0:e>100?1:e/100}function t9(i){let e=Joe(i);if(e===null)return i;e=e||0;const t=(e&4278190080)>>>24,n=(e&16711680)>>>16,r=(e&65280)>>>8,s=(e&255)/255;return`rgba(${t}, ${n}, ${r}, ${s})`}var D2=(i,e,t)=>{if(zt.fun(i))return i;if(zt.arr(i))return D2({range:i,output:e,extrapolate:t});if(zt.str(i.output[0]))return pR(i);const n=i,r=n.output,s=n.range||[0,1],o=n.extrapolateLeft||n.extrapolate||"extend",a=n.extrapolateRight||n.extrapolate||"extend",l=n.easing||(c=>c);return c=>{const u=eae(c,s);return Zoe(c,s[u],s[u+1],r[u],r[u+1],l,o,a,n.map)}};function Zoe(i,e,t,n,r,s,o,a,l){let c=l?l(i):i;if(c<e){if(o==="identity")return c;o==="clamp"&&(c=e)}if(c>t){if(a==="identity")return c;a==="clamp"&&(c=t)}return n===r?n:e===t?i<=e?n:r:(e===-1/0?c=-c:t===1/0?c=c-e:c=(c-e)/(t-e),c=s(c),n===-1/0?c=-c:r===1/0?c=c+n:c=c*(r-n)+n,c)}function eae(i,e){for(var t=1;t<e.length-1&&!(e[t]>=i);++t);return t-1}var tae={linear:i=>i},k2=Symbol.for("FluidValue.get"),rA=Symbol.for("FluidValue.observers"),fh=i=>!!(i&&i[k2]),sc=i=>i&&i[k2]?i[k2]():i,n9=i=>i[rA]||null;function nae(i,e){i.eventObserved?i.eventObserved(e):i(e)}function kS(i,e){const t=i[rA];t&&t.forEach(n=>{nae(n,e)})}var iae=class{constructor(i){if(!i&&!(i=this.get))throw Error("Unknown getter");rae(this,i)}},rae=(i,e)=>RG(i,k2,e);function xx(i,e){if(i[k2]){let t=i[rA];t||RG(i,rA,t=new Set),t.has(e)||(t.add(e),i.observerAdded&&i.observerAdded(t.size,e))}return e}function FS(i,e){const t=i[rA];if(t&&t.has(e)){const n=t.size-1;n?t.delete(e):i[rA]=null,i.observerRemoved&&i.observerRemoved(n,e)}}var RG=(i,e,t)=>Object.defineProperty(i,e,{value:t,writable:!0,configurable:!0}),Y_=/[+\-]?(?:0|[1-9]\d*)(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,sae=/(#(?:[0-9a-f]{2}){2,4}|(#[0-9a-f]{3})|(rgb|hsl)a?\((-?\d+%?[,\s]+){2,3}\s*[\d\.]+%?\))/gi,i9=new RegExp(`(${Y_.source})(%|[a-z]+)`,"i"),oae=/rgba\(([0-9\.-]+), ([0-9\.-]+), ([0-9\.-]+), ([0-9\.-]+)\)/gi,n4=/var\((--[a-zA-Z0-9-_]+),? ?([a-zA-Z0-9 ()%#.,-]+)?\)/,LG=i=>{const[e,t]=aae(i);if(!e||dR())return i;const n=window.getComputedStyle(document.documentElement).getPropertyValue(e);if(n)return n.trim();if(t&&t.startsWith("--")){const r=window.getComputedStyle(document.documentElement).getPropertyValue(t);return r||i}else{if(t&&n4.test(t))return LG(t);if(t)return t}return i},aae=i=>{const e=n4.exec(i);if(!e)return[,];const[,t,n]=e;return[t,n]},GT,lae=(i,e,t,n,r)=>`rgba(${Math.round(e)}, ${Math.round(t)}, ${Math.round(n)}, ${r})`,PG=i=>{GT||(GT=qd?new RegExp(`(${Object.keys(qd).join("|")})(?!\\w)`,"g"):/^\b$/);const e=i.output.map(s=>sc(s).replace(n4,LG).replace(sae,t9).replace(GT,t9)),t=e.map(s=>s.match(Y_).map(Number)),r=t[0].map((s,o)=>t.map(a=>{if(!(o in a))throw Error('The arity of each "output" value must be equal');return a[o]})).map(s=>D2({...i,output:s}));return s=>{var l;const o=!i9.test(e[0])&&((l=e.find(c=>i9.test(c)))==null?void 0:l.replace(Y_,""));let a=0;return e[0].replace(Y_,()=>`${r[a++](s)}${o||""}`).replace(oae,lae)}},gR="react-spring: ",BG=i=>{const e=i;let t=!1;if(typeof e!="function")throw new TypeError(`${gR}once requires a function parameter`);return(...n)=>{t||(e(...n),t=!0)}},cae=BG(console.warn);function uae(){cae(`${gR}The "interpolate" function is deprecated in v9 (use "to" instead)`)}var hae=BG(console.warn);function fae(){hae(`${gR}Directly calling start instead of using the api object is deprecated in v9 (use ".start" instead), this will be removed in later 0.X.0 versions`)}function i4(i){return zt.str(i)&&(i[0]=="#"||/\d/.test(i)||!dR()&&n4.test(i)||i in(qd||{}))}var AR=dR()?w.useEffect:w.useLayoutEffect,dae=()=>{const i=w.useRef(!1);return AR(()=>(i.current=!0,()=>{i.current=!1}),[]),i};function DG(){const i=w.useState()[1],e=dae();return()=>{e.current&&i(Math.random())}}function pae(i,e){const[t]=w.useState(()=>({inputs:e,result:i()})),n=w.useRef(),r=n.current;let s=r;return s?e&&s.inputs&&mae(e,s.inputs)||(s={inputs:e,result:i()}):s=t,w.useEffect(()=>{n.current=s,r==t&&(t.inputs=t.result=void 0)},[s]),s.result}function mae(i,e){if(i.length!==e.length)return!1;for(let t=0;t<i.length;t++)if(i[t]!==e[t])return!1;return!0}var kG=i=>w.useEffect(i,gae),gae=[];function r9(i){const e=w.useRef();return w.useEffect(()=>{e.current=i}),e.current}var F2=Symbol.for("Animated:node"),Aae=i=>!!i&&i[F2]===i,uh=i=>i&&i[F2],yR=(i,e)=>Uoe(i,F2,e),r4=i=>i&&i[F2]&&i[F2].getPayload(),FG=class{constructor(){yR(this,this)}getPayload(){return this.payload||[]}},Ex=class extends FG{constructor(i){super(),this._value=i,this.done=!0,this.durationProgress=0,zt.num(this._value)&&(this.lastPosition=this._value)}static create(i){return new Ex(i)}getPayload(){return[this]}getValue(){return this._value}setValue(i,e){return zt.num(i)&&(this.lastPosition=i,e&&(i=Math.round(i/e)*e,this.done&&(this.lastPosition=i))),this._value===i?!1:(this._value=i,!0)}reset(){const{done:i}=this;this.done=!1,zt.num(this._value)&&(this.elapsedTime=0,this.durationProgress=0,this.lastPosition=this._value,i&&(this.lastVelocity=null),this.v0=null)}},O2=class extends Ex{constructor(i){super(0),this._string=null,this._toString=D2({output:[i,i]})}static create(i){return new O2(i)}getValue(){const i=this._string;return i??(this._string=this._toString(this._value))}setValue(i){if(zt.str(i)){if(i==this._string)return!1;this._string=i,this._value=1}else if(super.setValue(i))this._string=null;else return!1;return!0}reset(i){i&&(this._toString=D2({output:[this.getValue(),i]})),this._value=0,super.reset()}},OS={dependencies:null},vR=class extends FG{constructor(i){super(),this.source=i,this.setValue(i)}getValue(i){const e={};return Nf(this.source,(t,n)=>{Aae(t)?e[n]=t.getValue(i):fh(t)?e[n]=sc(t):i||(e[n]=t)}),e}setValue(i){this.source=i,this.payload=this._makePayload(i)}reset(){this.payload&&Oi(this.payload,i=>i.reset())}_makePayload(i){if(i){const e=new Set;return Nf(i,this._addToPayload,e),Array.from(e)}}_addToPayload(i){OS.dependencies&&fh(i)&&OS.dependencies.add(i);const e=r4(i);e&&Oi(e,t=>this.add(t))}},OG=class extends vR{constructor(i){super(i)}static create(i){return new OG(i)}getValue(){return this.source.map(i=>i.getValue())}setValue(i){const e=this.getPayload();return i.length==e.length?e.map((t,n)=>t.setValue(i[n])).some(Boolean):(super.setValue(i.map(yae)),!0)}};function yae(i){return(i4(i)?O2:Ex).create(i)}function jM(i){const e=uh(i);return e?e.constructor:zt.arr(i)?OG:i4(i)?O2:Ex}var s9=(i,e)=>{const t=!zt.fun(i)||i.prototype&&i.prototype.isReactComponent;return w.forwardRef((n,r)=>{const s=w.useRef(null),o=t&&w.useCallback(m=>{s.current=Eae(r,m)},[r]),[a,l]=xae(n,e),c=DG(),u=()=>{const m=s.current;if(t&&!m)return;(m?e.applyAnimatedValues(m,a.getValue(!0)):!1)===!1&&c()},h=new vae(u,l),f=w.useRef();AR(()=>(f.current=h,Oi(l,m=>xx(m,h)),()=>{f.current&&(Oi(f.current.deps,m=>FS(m,f.current)),Xn.cancel(f.current.update))})),w.useEffect(u,[]),kG(()=>()=>{const m=f.current;Oi(m.deps,A=>FS(A,m))});const d=e.getComponentProps(a.getValue());return w.createElement(i,{...d,ref:o})})},vae=class{constructor(i,e){this.update=i,this.deps=e}eventObserved(i){i.type=="change"&&Xn.write(this.update)}};function xae(i,e){const t=new Set;return OS.dependencies=t,i.style&&(i={...i,style:e.createAnimatedStyle(i.style)}),i=new vR(i),OS.dependencies=null,[i,t]}function Eae(i,e){return i&&(zt.fun(i)?i(e):i.current=e),e}var o9=Symbol.for("AnimatedComponent"),_ae=(i,{applyAnimatedValues:e=()=>!1,createAnimatedStyle:t=r=>new vR(r),getComponentProps:n=r=>r}={})=>{const r={applyAnimatedValues:e,createAnimatedStyle:t,getComponentProps:n},s=o=>{const a=a9(o)||"Anonymous";return zt.str(o)?o=s[o]||(s[o]=s9(o,r)):o=o[o9]||(o[o9]=s9(o,r)),o.displayName=`Animated(${a})`,o};return Nf(i,(o,a)=>{zt.arr(i)&&(a=a9(o)),s[a]=s(o)}),{animated:s}},a9=i=>zt.str(i)?i:i&&zt.str(i.displayName)?i.displayName:zt.fun(i)&&i.name||null;function bm(i,...e){return zt.fun(i)?i(...e):i}var n2=(i,e)=>i===!0||!!(e&&i&&(zt.fun(i)?i(e):fc(i).includes(e))),NG=(i,e)=>zt.obj(i)?e&&i[e]:i,UG=(i,e)=>i.default===!0?i[e]:i.default?i.default[e]:void 0,Sae=i=>i,xR=(i,e=Sae)=>{let t=wae;i.default&&i.default!==!0&&(i=i.default,t=Object.keys(i));const n={};for(const r of t){const s=e(i[r],r);zt.und(s)||(n[r]=s)}return n},wae=["config","onProps","onStart","onChange","onPause","onResume","onRest"],Cae={config:1,from:1,to:1,ref:1,loop:1,reset:1,pause:1,cancel:1,reverse:1,immediate:1,default:1,delay:1,onProps:1,onStart:1,onChange:1,onPause:1,onResume:1,onRest:1,onResolve:1,items:1,trail:1,sort:1,expires:1,initial:1,enter:1,update:1,leave:1,children:1,onDestroyed:1,keys:1,callId:1,parentId:1};function Tae(i){const e={};let t=0;if(Nf(i,(n,r)=>{Cae[r]||(e[r]=n,t++)}),t)return e}function zG(i){const e=Tae(i);if(e){const t={to:e};return Nf(i,(n,r)=>r in e||(t[r]=n)),t}return{...i}}function N2(i){return i=sc(i),zt.arr(i)?i.map(N2):i4(i)?wu.createStringInterpolator({range:[0,1],output:[i,i]})(1):i}function bae(i){for(const e in i)return!0;return!1}function KM(i){return zt.fun(i)||zt.arr(i)&&zt.obj(i[0])}function Iae(i,e){var t;(t=i.ref)==null||t.delete(i),e==null||e.delete(i)}function Mae(i,e){var t;e&&i.ref!==e&&((t=i.ref)==null||t.delete(i),e.add(i),i.ref=e)}var Rae={default:{tension:170,friction:26}},$M={...Rae.default,mass:1,damping:1,easing:tae.linear,clamp:!1},Lae=class{constructor(){this.velocity=0,Object.assign(this,$M)}};function Pae(i,e,t){t&&(t={...t},l9(t,e),e={...t,...e}),l9(i,e),Object.assign(i,e);for(const o in $M)i[o]==null&&(i[o]=$M[o]);let{frequency:n,damping:r}=i;const{mass:s}=i;return zt.und(n)||(n<.01&&(n=.01),r<0&&(r=0),i.tension=Math.pow(2*Math.PI/n,2)*s,i.friction=4*Math.PI*r*s/n),i}function l9(i,e){if(!zt.und(e.decay))i.duration=void 0;else{const t=!zt.und(e.tension)||!zt.und(e.friction);(t||!zt.und(e.frequency)||!zt.und(e.damping)||!zt.und(e.mass))&&(i.duration=void 0,i.decay=void 0),t&&(i.frequency=void 0)}}var c9=[],Bae=class{constructor(){this.changed=!1,this.values=c9,this.toValues=null,this.fromValues=c9,this.config=new Lae,this.immediate=!1}};function GG(i,{key:e,props:t,defaultProps:n,state:r,actions:s}){return new Promise((o,a)=>{let l,c,u=n2(t.cancel??(n==null?void 0:n.cancel),e);if(u)d();else{zt.und(t.pause)||(r.paused=n2(t.pause,e));let m=n==null?void 0:n.pause;m!==!0&&(m=r.paused||n2(m,e)),l=bm(t.delay||0,e),m?(r.resumeQueue.add(f),s.pause()):(s.resume(),f())}function h(){r.resumeQueue.add(f),r.timeouts.delete(c),c.cancel(),l=c.time-Xn.now()}function f(){l>0&&!wu.skipAnimation?(r.delayed=!0,c=Xn.setTimeout(d,l),r.pauseQueue.add(h),r.timeouts.add(c)):d()}function d(){r.delayed&&(r.delayed=!1),r.pauseQueue.delete(h),r.timeouts.delete(c),i<=(r.cancelId||0)&&(u=!0);try{s.start({...t,callId:i,cancel:u},o)}catch(m){a(m)}}})}var ER=(i,e)=>e.length==1?e[0]:e.some(t=>t.cancelled)?z1(i.get()):e.every(t=>t.noop)?HG(i.get()):pu(i.get(),e.every(t=>t.finished)),HG=i=>({value:i,noop:!0,finished:!0,cancelled:!1}),pu=(i,e,t=!1)=>({value:i,finished:e,cancelled:t}),z1=i=>({value:i,cancelled:!0,finished:!1});function QG(i,e,t,n){const{callId:r,parentId:s,onRest:o}=e,{asyncTo:a,promise:l}=t;return!s&&i===a&&!e.reset?l:t.promise=(async()=>{t.asyncId=r,t.asyncTo=i;const c=xR(e,(g,y)=>y==="onRest"?void 0:g);let u,h;const f=new Promise((g,y)=>(u=g,h=y)),d=g=>{const y=r<=(t.cancelId||0)&&z1(n)||r!==t.asyncId&&pu(n,!1);if(y)throw g.result=y,h(g),g},m=(g,y)=>{const E=new u9,x=new h9;return(async()=>{if(wu.skipAnimation)throw U2(t),x.result=pu(n,!1),h(x),x;d(E);const C=zt.obj(g)?{...g}:{...y,to:g};C.parentId=r,Nf(c,(I,M)=>{zt.und(C[M])&&(C[M]=I)});const T=await n.start(C);return d(E),t.paused&&await new Promise(I=>{t.resumeQueue.add(I)}),T})()};let A;if(wu.skipAnimation)return U2(t),pu(n,!1);try{let g;zt.arr(i)?g=(async y=>{for(const E of y)await m(E)})(i):g=Promise.resolve(i(m,n.stop.bind(n))),await Promise.all([g.then(u),f]),A=pu(n.get(),!0,!1)}catch(g){if(g instanceof u9)A=g.result;else if(g instanceof h9)A=g.result;else throw g}finally{r==t.asyncId&&(t.asyncId=s,t.asyncTo=s?a:void 0,t.promise=s?l:void 0)}return zt.fun(o)&&Xn.batchedUpdates(()=>{o(A,n,n.item)}),A})()}function U2(i,e){e2(i.timeouts,t=>t.cancel()),i.pauseQueue.clear(),i.resumeQueue.clear(),i.asyncId=i.asyncTo=i.promise=void 0,e&&(i.cancelId=e)}var u9=class extends Error{constructor(){super("An async animation has been interrupted. You see this error because you forgot to use `await` or `.catch(...)` on its returned promise.")}},h9=class extends Error{constructor(){super("SkipAnimationSignal")}},YM=i=>i instanceof _R,Dae=1,_R=class extends iae{constructor(){super(...arguments),this.id=Dae++,this._priority=0}get priority(){return this._priority}set priority(i){this._priority!=i&&(this._priority=i,this._onPriorityChange(i))}get(){const i=uh(this);return i&&i.getValue()}to(...i){return wu.to(this,i)}interpolate(...i){return uae(),wu.to(this,i)}toJSON(){return this.get()}observerAdded(i){i==1&&this._attach()}observerRemoved(i){i==0&&this._detach()}_attach(){}_detach(){}_onChange(i,e=!1){kS(this,{type:"change",parent:this,value:i,idle:e})}_onPriorityChange(i){this.idle||e4.sort(this),kS(this,{type:"priority",parent:this,priority:i})}},r0=Symbol.for("SpringPhase"),VG=1,XM=2,qM=4,HT=i=>(i[r0]&VG)>0,bd=i=>(i[r0]&XM)>0,$y=i=>(i[r0]&qM)>0,f9=(i,e)=>e?i[r0]|=XM|VG:i[r0]&=~XM,d9=(i,e)=>e?i[r0]|=qM:i[r0]&=~qM,kae=class extends _R{constructor(i,e){if(super(),this.animation=new Bae,this.defaultProps={},this._state={paused:!1,delayed:!1,pauseQueue:new Set,resumeQueue:new Set,timeouts:new Set},this._pendingCalls=new Set,this._lastCallId=0,this._lastToId=0,this._memoizedDuration=0,!zt.und(i)||!zt.und(e)){const t=zt.obj(i)?{...i}:{...e,from:i};zt.und(t.default)&&(t.default=!0),this.start(t)}}get idle(){return!(bd(this)||this._state.asyncTo)||$y(this)}get goal(){return sc(this.animation.to)}get velocity(){const i=uh(this);return i instanceof Ex?i.lastVelocity||0:i.getPayload().map(e=>e.lastVelocity||0)}get hasAnimated(){return HT(this)}get isAnimating(){return bd(this)}get isPaused(){return $y(this)}get isDelayed(){return this._state.delayed}advance(i){let e=!0,t=!1;const n=this.animation;let{toValues:r}=n;const{config:s}=n,o=r4(n.to);!o&&fh(n.to)&&(r=fc(sc(n.to))),n.values.forEach((c,u)=>{if(c.done)return;const h=c.constructor==O2?1:o?o[u].lastPosition:r[u];let f=n.immediate,d=h;if(!f){if(d=c.lastPosition,s.tension<=0){c.done=!0;return}let m=c.elapsedTime+=i;const A=n.fromValues[u],g=c.v0!=null?c.v0:c.v0=zt.arr(s.velocity)?s.velocity[u]:s.velocity;let y;const E=s.precision||(A==h?.005:Math.min(1,Math.abs(h-A)*.001));if(zt.und(s.duration))if(s.decay){const x=s.decay===!0?.998:s.decay,C=Math.exp(-(1-x)*m);d=A+g/(1-x)*(1-C),f=Math.abs(c.lastPosition-d)<=E,y=g*C}else{y=c.lastVelocity==null?g:c.lastVelocity;const x=s.restVelocity||E/10,C=s.clamp?0:s.bounce,T=!zt.und(C),I=A==h?c.v0>0:A<h;let M,L=!1;const R=1,P=Math.ceil(i/R);for(let F=0;F<P&&(M=Math.abs(y)>x,!(!M&&(f=Math.abs(h-d)<=E,f)));++F){T&&(L=d==h||d>h==I,L&&(y=-y*C,d=h));const k=-s.tension*1e-6*(d-h),z=-s.friction*.001*y,U=(k+z)/s.mass;y=y+U*R,d=d+y*R}}else{let x=1;s.duration>0&&(this._memoizedDuration!==s.duration&&(this._memoizedDuration=s.duration,c.durationProgress>0&&(c.elapsedTime=s.duration*c.durationProgress,m=c.elapsedTime+=i)),x=(s.progress||0)+m/this._memoizedDuration,x=x>1?1:x<0?0:x,c.durationProgress=x),d=A+s.easing(x)*(h-A),y=(d-c.lastPosition)/i,f=x==1}c.lastVelocity=y,Number.isNaN(d)&&(console.warn("Got NaN while animating:",this),f=!0)}o&&!o[u].done&&(f=!1),f?c.done=!0:e=!1,c.setValue(d,s.round)&&(t=!0)});const a=uh(this),l=a.getValue();if(e){const c=sc(n.to);(l!==c||t)&&!s.decay?(a.setValue(c),this._onChange(c)):t&&s.decay&&this._onChange(l),this._stop()}else t&&this._onChange(l)}set(i){return Xn.batchedUpdates(()=>{this._stop(),this._focus(i),this._set(i)}),this}pause(){this._update({pause:!0})}resume(){this._update({pause:!1})}finish(){if(bd(this)){const{to:i,config:e}=this.animation;Xn.batchedUpdates(()=>{this._onStart(),e.decay||this._set(i,!1),this._stop()})}return this}update(i){return(this.queue||(this.queue=[])).push(i),this}start(i,e){let t;return zt.und(i)?(t=this.queue||[],this.queue=[]):t=[zt.obj(i)?i:{...e,to:i}],Promise.all(t.map(n=>this._update(n))).then(n=>ER(this,n))}stop(i){const{to:e}=this.animation;return this._focus(this.get()),U2(this._state,i&&this._lastCallId),Xn.batchedUpdates(()=>this._stop(e,i)),this}reset(){this._update({reset:!0})}eventObserved(i){i.type=="change"?this._start():i.type=="priority"&&(this.priority=i.priority+1)}_prepareNode(i){const e=this.key||"";let{to:t,from:n}=i;t=zt.obj(t)?t[e]:t,(t==null||KM(t))&&(t=void 0),n=zt.obj(n)?n[e]:n,n==null&&(n=void 0);const r={to:t,from:n};return HT(this)||(i.reverse&&([t,n]=[n,t]),n=sc(n),zt.und(n)?uh(this)||this._set(t):this._set(n)),r}_update({...i},e){const{key:t,defaultProps:n}=this;i.default&&Object.assign(n,xR(i,(o,a)=>/^on/.test(a)?NG(o,t):o)),m9(this,i,"onProps"),Xy(this,"onProps",i,this);const r=this._prepareNode(i);if(Object.isFrozen(this))throw Error("Cannot animate a `SpringValue` object that is frozen. Did you forget to pass your component to `animated(...)` before animating its props?");const s=this._state;return GG(++this._lastCallId,{key:t,props:i,defaultProps:n,state:s,actions:{pause:()=>{$y(this)||(d9(this,!0),kv(s.pauseQueue),Xy(this,"onPause",pu(this,Yy(this,this.animation.to)),this))},resume:()=>{$y(this)&&(d9(this,!1),bd(this)&&this._resume(),kv(s.resumeQueue),Xy(this,"onResume",pu(this,Yy(this,this.animation.to)),this))},start:this._merge.bind(this,r)}}).then(o=>{if(i.loop&&o.finished&&!(e&&o.noop)){const a=WG(i);if(a)return this._update(a,!0)}return o})}_merge(i,e,t){if(e.cancel)return this.stop(!0),t(z1(this));const n=!zt.und(i.to),r=!zt.und(i.from);if(n||r)if(e.callId>this._lastToId)this._lastToId=e.callId;else return t(z1(this));const{key:s,defaultProps:o,animation:a}=this,{to:l,from:c}=a;let{to:u=l,from:h=c}=i;r&&!n&&(!e.default||zt.und(u))&&(u=h),e.reverse&&([u,h]=[h,u]);const f=!vf(h,c);f&&(a.from=h),h=sc(h);const d=!vf(u,l);d&&this._focus(u);const m=KM(e.to),{config:A}=a,{decay:g,velocity:y}=A;(n||r)&&(A.velocity=0),e.config&&!m&&Pae(A,bm(e.config,s),e.config!==o.config?bm(o.config,s):void 0);let E=uh(this);if(!E||zt.und(u))return t(pu(this,!0));const x=zt.und(e.reset)?r&&!e.default:!zt.und(h)&&n2(e.reset,s),C=x?h:this.get(),T=N2(u),I=zt.num(T)||zt.arr(T)||i4(T),M=!m&&(!I||n2(o.immediate||e.immediate,s));if(d){const F=jM(u);if(F!==E.constructor)if(M)E=this._set(T);else throw Error(`Cannot animate between ${E.constructor.name} and ${F.name}, as the "to" prop suggests`)}const L=E.constructor;let R=fh(u),P=!1;if(!R){const F=x||!HT(this)&&f;(d||F)&&(P=vf(N2(C),T),R=!P),(!vf(a.immediate,M)&&!M||!vf(A.decay,g)||!vf(A.velocity,y))&&(R=!0)}if(P&&bd(this)&&(a.changed&&!x?R=!0:R||this._stop(l)),!m&&((R||fh(l))&&(a.values=E.getPayload(),a.toValues=fh(u)?null:L==O2?[1]:fc(T)),a.immediate!=M&&(a.immediate=M,!M&&!x&&this._set(l)),R)){const{onRest:F}=a;Oi(Oae,z=>m9(this,e,z));const k=pu(this,Yy(this,l));kv(this._pendingCalls,k),this._pendingCalls.add(t),a.changed&&Xn.batchedUpdates(()=>{var z;a.changed=!x,F==null||F(k,this),x?bm(o.onRest,k):(z=a.onStart)==null||z.call(a,k,this)})}x&&this._set(C),m?t(QG(e.to,e,this._state,this)):R?this._start():bd(this)&&!d?this._pendingCalls.add(t):t(HG(C))}_focus(i){const e=this.animation;i!==e.to&&(n9(this)&&this._detach(),e.to=i,n9(this)&&this._attach())}_attach(){let i=0;const{to:e}=this.animation;fh(e)&&(xx(e,this),YM(e)&&(i=e.priority+1)),this.priority=i}_detach(){const{to:i}=this.animation;fh(i)&&FS(i,this)}_set(i,e=!0){const t=sc(i);if(!zt.und(t)){const n=uh(this);if(!n||!vf(t,n.getValue())){const r=jM(t);!n||n.constructor!=r?yR(this,r.create(t)):n.setValue(t),n&&Xn.batchedUpdates(()=>{this._onChange(t,e)})}}return uh(this)}_onStart(){const i=this.animation;i.changed||(i.changed=!0,Xy(this,"onStart",pu(this,Yy(this,i.to)),this))}_onChange(i,e){e||(this._onStart(),bm(this.animation.onChange,i,this)),bm(this.defaultProps.onChange,i,this),super._onChange(i,e)}_start(){const i=this.animation;uh(this).reset(sc(i.to)),i.immediate||(i.fromValues=i.values.map(e=>e.lastPosition)),bd(this)||(f9(this,!0),$y(this)||this._resume())}_resume(){wu.skipAnimation?this.finish():e4.start(this)}_stop(i,e){if(bd(this)){f9(this,!1);const t=this.animation;Oi(t.values,r=>{r.done=!0}),t.toValues&&(t.onChange=t.onPause=t.onResume=void 0),kS(this,{type:"idle",parent:this});const n=e?z1(this.get()):pu(this.get(),Yy(this,i??t.to));kv(this._pendingCalls,n),t.changed&&(t.changed=!1,Xy(this,"onRest",n,this))}}};function Yy(i,e){const t=N2(e),n=N2(i.get());return vf(n,t)}function WG(i,e=i.loop,t=i.to){const n=bm(e);if(n){const r=n!==!0&&zG(n),s=(r||i).reverse,o=!r||r.reset;return z2({...i,loop:e,default:!1,pause:void 0,to:!s||KM(t)?t:void 0,from:o?i.from:void 0,reset:o,...r})}}function z2(i){const{to:e,from:t}=i=zG(i),n=new Set;return zt.obj(e)&&p9(e,n),zt.obj(t)&&p9(t,n),i.keys=n.size?Array.from(n):null,i}function Fae(i){const e=z2(i);return zt.und(e.default)&&(e.default=xR(e)),e}function p9(i,e){Nf(i,(t,n)=>t!=null&&e.add(n))}var Oae=["onStart","onRest","onChange","onPause","onResume"];function m9(i,e,t){i.animation[t]=e[t]!==UG(e,t)?NG(e[t],i.key):void 0}function Xy(i,e,...t){var n,r,s,o;(r=(n=i.animation)[e])==null||r.call(n,...t),(o=(s=i.defaultProps)[e])==null||o.call(s,...t)}var Nae=["onStart","onChange","onRest"],Uae=1,zae=class{constructor(i,e){this.id=Uae++,this.springs={},this.queue=[],this._lastAsyncId=0,this._active=new Set,this._changed=new Set,this._started=!1,this._state={paused:!1,pauseQueue:new Set,resumeQueue:new Set,timeouts:new Set},this._events={onStart:new Map,onChange:new Map,onRest:new Map},this._onFrame=this._onFrame.bind(this),e&&(this._flush=e),i&&this.start({default:!0,...i})}get idle(){return!this._state.asyncTo&&Object.values(this.springs).every(i=>i.idle&&!i.isDelayed&&!i.isPaused)}get item(){return this._item}set item(i){this._item=i}get(){const i={};return this.each((e,t)=>i[t]=e.get()),i}set(i){for(const e in i){const t=i[e];zt.und(t)||this.springs[e].set(t)}}update(i){return i&&this.queue.push(z2(i)),this}start(i){let{queue:e}=this;return i?e=fc(i).map(z2):this.queue=[],this._flush?this._flush(this,e):(XG(this,e),JM(this,e))}stop(i,e){if(i!==!!i&&(e=i),e){const t=this.springs;Oi(fc(e),n=>t[n].stop(!!i))}else U2(this._state,this._lastAsyncId),this.each(t=>t.stop(!!i));return this}pause(i){if(zt.und(i))this.start({pause:!0});else{const e=this.springs;Oi(fc(i),t=>e[t].pause())}return this}resume(i){if(zt.und(i))this.start({pause:!1});else{const e=this.springs;Oi(fc(i),t=>e[t].resume())}return this}each(i){Nf(this.springs,i)}_onFrame(){const{onStart:i,onChange:e,onRest:t}=this._events,n=this._active.size>0,r=this._changed.size>0;(n&&!this._started||r&&!this._started)&&(this._started=!0,e2(i,([a,l])=>{l.value=this.get(),a(l,this,this._item)}));const s=!n&&this._started,o=r||s&&t.size?this.get():null;r&&e.size&&e2(e,([a,l])=>{l.value=o,a(l,this,this._item)}),s&&(this._started=!1,e2(t,([a,l])=>{l.value=o,a(l,this,this._item)}))}eventObserved(i){if(i.type=="change")this._changed.add(i.parent),i.idle||this._active.add(i.parent);else if(i.type=="idle")this._active.delete(i.parent);else return;Xn.onFrame(this._onFrame)}};function JM(i,e){return Promise.all(e.map(t=>jG(i,t))).then(t=>ER(i,t))}async function jG(i,e,t){const{keys:n,to:r,from:s,loop:o,onRest:a,onResolve:l}=e,c=zt.obj(e.default)&&e.default;o&&(e.loop=!1),r===!1&&(e.to=null),s===!1&&(e.from=null);const u=zt.arr(r)||zt.fun(r)?r:void 0;u?(e.to=void 0,e.onRest=void 0,c&&(c.onRest=void 0)):Oi(Nae,A=>{const g=e[A];if(zt.fun(g)){const y=i._events[A];e[A]=({finished:E,cancelled:x})=>{const C=y.get(g);C?(E||(C.finished=!1),x&&(C.cancelled=!0)):y.set(g,{value:null,finished:E||!1,cancelled:x||!1})},c&&(c[A]=e[A])}});const h=i._state;e.pause===!h.paused?(h.paused=e.pause,kv(e.pause?h.pauseQueue:h.resumeQueue)):h.paused&&(e.pause=!0);const f=(n||Object.keys(i.springs)).map(A=>i.springs[A].start(e)),d=e.cancel===!0||UG(e,"cancel")===!0;(u||d&&h.asyncId)&&f.push(GG(++i._lastAsyncId,{props:e,state:h,actions:{pause:VM,resume:VM,start(A,g){d?(U2(h,i._lastAsyncId),g(z1(i))):(A.onRest=a,g(QG(u,A,h,i)))}}})),h.paused&&await new Promise(A=>{h.resumeQueue.add(A)});const m=ER(i,await Promise.all(f));if(o&&m.finished&&!(t&&m.noop)){const A=WG(e,o,r);if(A)return XG(i,[A]),jG(i,A,!0)}return l&&Xn.batchedUpdates(()=>l(m,i,i.item)),m}function g9(i,e){const t={...i.springs};return e&&Oi(fc(e),n=>{zt.und(n.keys)&&(n=z2(n)),zt.obj(n.to)||(n={...n,to:void 0}),YG(t,n,r=>$G(r))}),KG(i,t),t}function KG(i,e){Nf(e,(t,n)=>{i.springs[n]||(i.springs[n]=t,xx(t,i))})}function $G(i,e){const t=new kae;return t.key=i,e&&xx(t,e),t}function YG(i,e,t){e.keys&&Oi(e.keys,n=>{(i[n]||(i[n]=t(n)))._prepareNode(e)})}function XG(i,e){Oi(e,t=>{YG(i.springs,t,n=>$G(n,i))})}var s4=({children:i,...e})=>{const t=w.useContext(NS),n=e.pause||!!t.pause,r=e.immediate||!!t.immediate;e=pae(()=>({pause:n,immediate:r}),[n,r]);const{Provider:s}=NS;return w.createElement(s,{value:e},i)},NS=Gae(s4,{});s4.Provider=NS.Provider;s4.Consumer=NS.Consumer;function Gae(i,e){return Object.assign(i,w.createContext(e)),i.Provider._context=i,i.Consumer._context=i,i}var Hae=()=>{const i=[],e=function(n){fae();const r=[];return Oi(i,(s,o)=>{if(zt.und(n))r.push(s.start());else{const a=t(n,s,o);a&&r.push(s.start(a))}}),r};e.current=i,e.add=function(n){i.includes(n)||i.push(n)},e.delete=function(n){const r=i.indexOf(n);~r&&i.splice(r,1)},e.pause=function(){return Oi(i,n=>n.pause(...arguments)),this},e.resume=function(){return Oi(i,n=>n.resume(...arguments)),this},e.set=function(n){Oi(i,(r,s)=>{const o=zt.fun(n)?n(s,r):n;o&&r.set(o)})},e.start=function(n){const r=[];return Oi(i,(s,o)=>{if(zt.und(n))r.push(s.start());else{const a=this._getProps(n,s,o);a&&r.push(s.start(a))}}),r},e.stop=function(){return Oi(i,n=>n.stop(...arguments)),this},e.update=function(n){return Oi(i,(r,s)=>r.update(this._getProps(n,r,s))),this};const t=function(n,r,s){return zt.fun(n)?n(s,r):n};return e._getProps=t,e};function Qae(i,e,t){const n=zt.fun(e)&&e;n&&!t&&(t=[]);const r=w.useMemo(()=>n||arguments.length==3?Hae():void 0,[]),s=w.useRef(0),o=DG(),a=w.useMemo(()=>({ctrls:[],queue:[],flush(y,E){const x=g9(y,E);return s.current>0&&!a.queue.length&&!Object.keys(x).some(T=>!y.springs[T])?JM(y,E):new Promise(T=>{KG(y,x),a.queue.push(()=>{T(JM(y,E))}),o()})}}),[]),l=w.useRef([...a.ctrls]),c=[],u=r9(i)||0;w.useMemo(()=>{Oi(l.current.slice(i,u),y=>{Iae(y,r),y.stop(!0)}),l.current.length=i,h(u,i)},[i]),w.useMemo(()=>{h(0,Math.min(u,i))},t);function h(y,E){for(let x=y;x<E;x++){const C=l.current[x]||(l.current[x]=new zae(null,a.flush)),T=n?n(x,C):e[x];T&&(c[x]=Fae(T))}}const f=l.current.map((y,E)=>g9(y,c[E])),d=w.useContext(s4),m=r9(d),A=d!==m&&bae(d);AR(()=>{s.current++,a.ctrls=l.current;const{queue:y}=a;y.length&&(a.queue=[],Oi(y,E=>E())),Oi(l.current,(E,x)=>{r==null||r.add(E),A&&E.start({default:d});const C=c[x];C&&(Mae(E,C.ref),E.ref?E.queue.push(C):E.start(C))})}),kG(()=>()=>{Oi(a.ctrls,y=>y.stop(!0))});const g=f.map(y=>({...y}));return r?[g,r]:g}function Vae(i,e){const t=zt.fun(i),[[n],r]=Qae(1,t?i:[i],t?[]:e);return t||arguments.length==2?[n,r]:n}var Wae=class extends _R{constructor(i,e){super(),this.source=i,this.idle=!0,this._active=new Set,this.calc=D2(...e);const t=this._get(),n=jM(t);yR(this,n.create(t))}advance(i){const e=this._get(),t=this.get();vf(e,t)||(uh(this).setValue(e),this._onChange(e,this.idle)),!this.idle&&A9(this._active)&&QT(this)}_get(){const i=zt.arr(this.source)?this.source.map(sc):fc(sc(this.source));return this.calc(...i)}_start(){this.idle&&!A9(this._active)&&(this.idle=!1,Oi(r4(this),i=>{i.done=!1}),wu.skipAnimation?(Xn.batchedUpdates(()=>this.advance()),QT(this)):e4.start(this))}_attach(){let i=1;Oi(fc(this.source),e=>{fh(e)&&xx(e,this),YM(e)&&(e.idle||this._active.add(e),i=Math.max(i,e.priority+1))}),this.priority=i,this._start()}_detach(){Oi(fc(this.source),i=>{fh(i)&&FS(i,this)}),this._active.clear(),QT(this)}eventObserved(i){i.type=="change"?i.idle?this.advance():(this._active.add(i.parent),this._start()):i.type=="idle"?this._active.delete(i.parent):i.type=="priority"&&(this.priority=fc(this.source).reduce((e,t)=>Math.max(e,(YM(t)?t.priority:0)+1),0))}};function jae(i){return i.idle!==!1}function A9(i){return!i.size||Array.from(i).every(jae)}function QT(i){i.idle||(i.idle=!0,Oi(r4(i),e=>{e.done=!0}),kS(i,{type:"idle",parent:i}))}wu.assign({createStringInterpolator:PG,to:(i,e)=>new Wae(i,e)});var Kae=["primitive"].concat(Object.keys(X6).filter(i=>/^[A-Z]/.test(i)).map(i=>i[0].toLowerCase()+i.slice(1)));wu.assign({createStringInterpolator:PG,colors:Qoe,frameLoop:"demand"});Yw(()=>{Xn.advance()});var $ae=_ae(Kae,{applyAnimatedValues:Os}),Yae=$ae.animated;function Xae({enabled:i=!0,snap:e,global:t,domElement:n,cursor:r=!0,children:s,speed:o=1,rotation:a=[0,0,0],zoom:l=1,polar:c=[0,Math.PI/2],azimuth:u=[-1/0,1/0],config:h={mass:1,tension:170,friction:26}}){const f=Ve(I=>I.events),d=Ve(I=>I.gl),m=n||f.connected||d.domElement,{size:A}=Ve(),g=w.useMemo(()=>[a[0]+c[0],a[0]+c[1]],[a[0],c[0],c[1]]),y=w.useMemo(()=>[a[1]+u[0],a[1]+u[1]],[a[1],u[0],u[1]]),E=w.useMemo(()=>[un.clamp(a[0],...g),un.clamp(a[1],...y),a[2]],[a[0],a[1],a[2],g,y]),[x,C]=Vae(()=>({scale:1,rotation:E,config:h}));w.useEffect(()=>void C.start({scale:1,rotation:E,config:h}),[E]),w.useEffect(()=>{if(t&&r&&i)return m.style.cursor="grab",d.domElement.style.cursor="",()=>{m.style.cursor="default",d.domElement.style.cursor="default"}},[t,r,m,i]);const T=hG({onHover:({last:I})=>{r&&!t&&i&&(m.style.cursor=I?"auto":"grab")},onDrag:({down:I,delta:[M,L],memo:[R,P]=x.rotation.animation.to||E})=>{if(!i)return[L,M];r&&(m.style.cursor=I?"grabbing":"grab"),M=un.clamp(P+M/A.width*Math.PI*o,...y),L=un.clamp(R+L/A.height*Math.PI*o,...g);const F=e&&!I&&typeof e!="boolean"?e:h;return C.start({scale:I&&L>g[1]/2?l:1,rotation:e&&!I?E:[L,M,0],config:k=>k==="scale"?{...F,friction:F.friction*3}:F}),[L,M]}},{target:t?m:void 0});return w.createElement(Yae.group,ot({},T==null?void 0:T(),x),s)}const qae=i=>(e,t,n)=>{const r=n.subscribe;return n.subscribe=((o,a,l)=>{let c=o;if(a){const u=(l==null?void 0:l.equalityFn)||Object.is;let h=o(n.getState());c=f=>{const d=o(f);if(!u(h,d)){const m=h;a(h=d,m)}},l!=null&&l.fireImmediately&&a(h,h)}return r(c)}),i(e,t,n)},Jae=qae,qG=w.createContext(null);function Zae({map:i,children:e,onChange:t,domElement:n}){const r=i.map(l=>l.name+l.keys).join("-"),s=w.useMemo(()=>tG(Jae(()=>i.reduce((l,c)=>({...l,[c.name]:!1}),{}))),[r]),o=w.useMemo(()=>[s.subscribe,s.getState,s],[r]),a=s.setState;return w.useEffect(()=>{const c=i.map(({name:d,keys:m,up:A})=>({keys:m,up:A,fn:g=>{a({[d]:g}),t&&t(d,g,o[1]())}})).reduce((d,{keys:m,fn:A,up:g=!0})=>(m.forEach(y=>d[y]={fn:A,pressed:!1,up:g}),d),{}),u=({key:d,code:m})=>{const A=c[d]||c[m];if(!A)return;const{fn:g,pressed:y,up:E}=A;A.pressed=!0,(E||!y)&&g(!0)},h=({key:d,code:m})=>{const A=c[d]||c[m];if(!A)return;const{fn:g,up:y}=A;A.pressed=!1,y&&g(!1)},f=n||window;return f.addEventListener("keydown",u,{passive:!0}),f.addEventListener("keyup",h,{passive:!0}),()=>{f.removeEventListener("keydown",u),f.removeEventListener("keyup",h)}},[n,r]),w.createElement(qG.Provider,{value:o,children:e})}function ele(i){const[e,t,n]=w.useContext(qG);return i?n(i):[e,t]}const TA=parseInt(dp.replace(/\D+/g,"")),SR=TA>=125?"uv1":"uv2";var tle=Object.defineProperty,nle=(i,e,t)=>e in i?tle(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,qy=(i,e,t)=>(nle(i,typeof e!="symbol"?e+"":e,t),t);const _1=4,G1=1024,mh=4,ile=(i=1)=>{const e=new Float32Array(G1*mh*i*_1),t=new Sa(e,G1,mh*i,gi,fi);return t.wrapS=_o,t.wrapT=_o,t.magFilter=zn,t.needsUpdate=!0,t},rle=(i,e,t=0)=>{const n=Math.floor(G1*(mh/4));e.arcLengthDivisions=n/2,e.updateArcLengths();const r=e.getSpacedPoints(n),s=e.computeFrenetFrames(n,!0);for(let o=0;o<n;o++){const a=Math.floor(o/G1),l=o%G1;let c=r[o];T3(i,l,c.x,c.y,c.z,0+a+mh*t),c=s.tangents[o],T3(i,l,c.x,c.y,c.z,1+a+mh*t),c=s.normals[o],T3(i,l,c.x,c.y,c.z,2+a+mh*t),c=s.binormals[o],T3(i,l,c.x,c.y,c.z,3+a+mh*t)}i.needsUpdate=!0},T3=(i,e,t,n,r,s)=>{const o=i.image,{data:a}=o,l=_1*G1*s;a[e*_1+l+0]=t,a[e*_1+l+1]=n,a[e*_1+l+2]=r,a[e*_1+l+3]=1},sle=i=>({spineTexture:{value:i},pathOffset:{type:"f",value:0},pathSegment:{type:"f",value:1},spineOffset:{type:"f",value:161},spineLength:{type:"f",value:400},flow:{type:"i",value:1}});function ole(i,e,t=1){i.__ok||(i.__ok=!0,i.onBeforeCompile=n=>{if(n.__modified)return;n.__modified=!0,Object.assign(n.uniforms,e);const r=`
		uniform sampler2D spineTexture;
		uniform float pathOffset;
		uniform float pathSegment;
		uniform float spineOffset;
		uniform float spineLength;
		uniform int flow;

		float textureLayers = ${mh*t}.;
		float textureStacks = ${mh/4}.;

		${n.vertexShader}
		`.replace("#include <beginnormal_vertex>","").replace("#include <defaultnormal_vertex>","").replace("#include <begin_vertex>","").replace(/void\s*main\s*\(\)\s*\{/,`
        void main() {
        #include <beginnormal_vertex>

        vec4 worldPos = modelMatrix * vec4(position, 1.);

        bool bend = flow > 0;
        float xWeight = bend ? 0. : 1.;

        #ifdef USE_INSTANCING
        float pathOffsetFromInstanceMatrix = instanceMatrix[3][2];
        float spineLengthFromInstanceMatrix = instanceMatrix[3][0];
        float spinePortion = bend ? (worldPos.x + spineOffset) / spineLengthFromInstanceMatrix : 0.;
        float mt = (spinePortion * pathSegment + pathOffset + pathOffsetFromInstanceMatrix)*textureStacks;
        #else
        float spinePortion = bend ? (worldPos.x + spineOffset) / spineLength : 0.;
        float mt = (spinePortion * pathSegment + pathOffset)*textureStacks;
        #endif

        mt = mod(mt, textureStacks);
        float rowOffset = floor(mt);

        #ifdef USE_INSTANCING
        rowOffset += instanceMatrix[3][1] * ${mh}.;
        #endif

        vec3 spinePos = texture2D(spineTexture, vec2(mt, (0. + rowOffset + 0.5) / textureLayers)).xyz;
        vec3 a =        texture2D(spineTexture, vec2(mt, (1. + rowOffset + 0.5) / textureLayers)).xyz;
        vec3 b =        texture2D(spineTexture, vec2(mt, (2. + rowOffset + 0.5) / textureLayers)).xyz;
        vec3 c =        texture2D(spineTexture, vec2(mt, (3. + rowOffset + 0.5) / textureLayers)).xyz;
        mat3 basis = mat3(a, b, c);

        vec3 transformed = basis
          * vec3(worldPos.x * xWeight, worldPos.y * 1., worldPos.z * 1.)
          + spinePos;

        vec3 transformedNormal = normalMatrix * (basis * objectNormal);
			`).replace("#include <project_vertex>",`vec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );
				gl_Position = projectionMatrix * mvPosition;`);n.vertexShader=r})}class ale{constructor(e,t=1){qy(this,"curveArray"),qy(this,"curveLengthArray"),qy(this,"object3D"),qy(this,"splineTexure"),qy(this,"uniforms");const n=e.clone(),r=ile(t),s=sle(r);n.traverse(o=>{(o instanceof It||o instanceof ax)&&(o.material=o.material.clone(),ole(o.material,s,t))}),this.curveArray=new Array(t),this.curveLengthArray=new Array(t),this.object3D=n,this.splineTexure=r,this.uniforms=s}updateCurve(e,t){if(e>=this.curveArray.length)throw Error("Index out of range for Flow");const n=t.getLength();this.uniforms.spineLength.value=n,this.curveLengthArray[e]=n,this.curveArray[e]=t,rle(this.splineTexure,t,e)}moveAlongCurve(e){this.uniforms.pathOffset.value+=e}}function lle(i,e=1e-4){e=Math.max(e,Number.EPSILON);const t={},n=i.getIndex(),r=i.getAttribute("position"),s=n?n.count:r.count;let o=0;const a=Object.keys(i.attributes),l={},c={},u=[],h=["getX","getY","getZ","getW"];for(let A=0,g=a.length;A<g;A++){const y=a[A];l[y]=[];const E=i.morphAttributes[y];E&&(c[y]=new Array(E.length).fill(0).map(()=>[]))}const f=Math.log10(1/e),d=Math.pow(10,f);for(let A=0;A<s;A++){const g=n?n.getX(A):A;let y="";for(let E=0,x=a.length;E<x;E++){const C=a[E],T=i.getAttribute(C),I=T.itemSize;for(let M=0;M<I;M++)y+=`${~~(T[h[M]](g)*d)},`}if(y in t)u.push(t[y]);else{for(let E=0,x=a.length;E<x;E++){const C=a[E],T=i.getAttribute(C),I=i.morphAttributes[C],M=T.itemSize,L=l[C],R=c[C];for(let P=0;P<M;P++){const F=h[P];if(L.push(T[F](g)),I)for(let k=0,z=I.length;k<z;k++)R[k].push(I[k][F](g))}}t[y]=o,u.push(o),o++}}const m=i.clone();for(let A=0,g=a.length;A<g;A++){const y=a[A],E=i.getAttribute(y),x=new E.array.constructor(l[y]),C=new mn(x,E.itemSize,E.normalized);if(m.setAttribute(y,C),y in c)for(let T=0;T<c[y].length;T++){const I=i.morphAttributes[y][T],M=new I.array.constructor(c[y][T]),L=new mn(M,I.itemSize,I.normalized);m.morphAttributes[y][T]=L}}return m.setIndex(u),m}function y9(i,e){if(e===EU)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),i;if(e===wS||e===A6){let t=i.getIndex();if(t===null){const o=[],a=i.getAttribute("position");if(a!==void 0){for(let l=0;l<a.count;l++)o.push(l);i.setIndex(o),t=i.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),i}const n=t.count-2,r=[];if(t)if(e===wS)for(let o=1;o<=n;o++)r.push(t.getX(0)),r.push(t.getX(o)),r.push(t.getX(o+1));else for(let o=0;o<n;o++)o%2===0?(r.push(t.getX(o)),r.push(t.getX(o+1)),r.push(t.getX(o+2))):(r.push(t.getX(o+2)),r.push(t.getX(o+1)),r.push(t.getX(o)));r.length/3!==n&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const s=i.clone();return s.setIndex(r),s.clearGroups(),s}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),i}function JG(i,e=Math.PI/3){const t=Math.cos(e),n=(1+1e-10)*100,r=[new H,new H,new H],s=new H,o=new H,a=new H,l=new H;function c(A){const g=~~(A.x*n),y=~~(A.y*n),E=~~(A.z*n);return`${g},${y},${E}`}const u=i.index?i.toNonIndexed():i,h=u.attributes.position,f={};for(let A=0,g=h.count/3;A<g;A++){const y=3*A,E=r[0].fromBufferAttribute(h,y+0),x=r[1].fromBufferAttribute(h,y+1),C=r[2].fromBufferAttribute(h,y+2);s.subVectors(C,x),o.subVectors(E,x);const T=new H().crossVectors(s,o).normalize();for(let I=0;I<3;I++){const M=r[I],L=c(M);L in f||(f[L]=[]),f[L].push(T)}}const d=new Float32Array(h.count*3),m=new mn(d,3,!1);for(let A=0,g=h.count/3;A<g;A++){const y=3*A,E=r[0].fromBufferAttribute(h,y+0),x=r[1].fromBufferAttribute(h,y+1),C=r[2].fromBufferAttribute(h,y+2);s.subVectors(C,x),o.subVectors(E,x),a.crossVectors(s,o).normalize();for(let T=0;T<3;T++){const I=r[T],M=c(I),L=f[M];l.set(0,0,0);for(let R=0,P=L.length;R<P;R++){const F=L[R];a.dot(F)>t&&l.add(F)}l.normalize(),m.setXYZ(y+T,l.x,l.y,l.z)}}return u.setAttribute("normal",m),u}var uc=Uint8Array,Wd=Uint16Array,ZM=Uint32Array,ZG=new uc([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),eH=new uc([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),cle=new uc([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),tH=function(i,e){for(var t=new Wd(31),n=0;n<31;++n)t[n]=e+=1<<i[n-1];for(var r=new ZM(t[30]),n=1;n<30;++n)for(var s=t[n];s<t[n+1];++s)r[s]=s-t[n]<<5|n;return[t,r]},nH=tH(ZG,2),iH=nH[0],ule=nH[1];iH[28]=258,ule[258]=28;var hle=tH(eH,0),fle=hle[0],e5=new Wd(32768);for(var Cr=0;Cr<32768;++Cr){var Id=(Cr&43690)>>>1|(Cr&21845)<<1;Id=(Id&52428)>>>2|(Id&13107)<<2,Id=(Id&61680)>>>4|(Id&3855)<<4,e5[Cr]=((Id&65280)>>>8|(Id&255)<<8)>>>1}var i2=(function(i,e,t){for(var n=i.length,r=0,s=new Wd(e);r<n;++r)++s[i[r]-1];var o=new Wd(e);for(r=0;r<e;++r)o[r]=o[r-1]+s[r-1]<<1;var a;if(t){a=new Wd(1<<e);var l=15-e;for(r=0;r<n;++r)if(i[r])for(var c=r<<4|i[r],u=e-i[r],h=o[i[r]-1]++<<u,f=h|(1<<u)-1;h<=f;++h)a[e5[h]>>>l]=c}else for(a=new Wd(n),r=0;r<n;++r)i[r]&&(a[r]=e5[o[i[r]-1]++]>>>15-i[r]);return a}),_x=new uc(288);for(var Cr=0;Cr<144;++Cr)_x[Cr]=8;for(var Cr=144;Cr<256;++Cr)_x[Cr]=9;for(var Cr=256;Cr<280;++Cr)_x[Cr]=7;for(var Cr=280;Cr<288;++Cr)_x[Cr]=8;var rH=new uc(32);for(var Cr=0;Cr<32;++Cr)rH[Cr]=5;var dle=i2(_x,9,1),ple=i2(rH,5,1),VT=function(i){for(var e=i[0],t=1;t<i.length;++t)i[t]>e&&(e=i[t]);return e},nu=function(i,e,t){var n=e/8|0;return(i[n]|i[n+1]<<8)>>(e&7)&t},WT=function(i,e){var t=e/8|0;return(i[t]|i[t+1]<<8|i[t+2]<<16)>>(e&7)},mle=function(i){return(i/8|0)+(i&7&&1)},gle=function(i,e,t){(t==null||t>i.length)&&(t=i.length);var n=new(i instanceof Wd?Wd:i instanceof ZM?ZM:uc)(t-e);return n.set(i.subarray(e,t)),n},Ale=function(i,e,t){var n=i.length;if(!n||t&&!t.l&&n<5)return e||new uc(0);var r=!e||t,s=!t||t.i;t||(t={}),e||(e=new uc(n*3));var o=function(ie){var re=e.length;if(ie>re){var se=new uc(Math.max(re*2,ie));se.set(e),e=se}},a=t.f||0,l=t.p||0,c=t.b||0,u=t.l,h=t.d,f=t.m,d=t.n,m=n*8;do{if(!u){t.f=a=nu(i,l,1);var A=nu(i,l+1,3);if(l+=3,A)if(A==1)u=dle,h=ple,f=9,d=5;else if(A==2){var x=nu(i,l,31)+257,C=nu(i,l+10,15)+4,T=x+nu(i,l+5,31)+1;l+=14;for(var I=new uc(T),M=new uc(19),L=0;L<C;++L)M[cle[L]]=nu(i,l+L*3,7);l+=C*3;for(var R=VT(M),P=(1<<R)-1,F=i2(M,R,1),L=0;L<T;){var k=F[nu(i,l,P)];l+=k&15;var g=k>>>4;if(g<16)I[L++]=g;else{var z=0,U=0;for(g==16?(U=3+nu(i,l,3),l+=2,z=I[L-1]):g==17?(U=3+nu(i,l,7),l+=3):g==18&&(U=11+nu(i,l,127),l+=7);U--;)I[L++]=z}}var W=I.subarray(0,x),$=I.subarray(x);f=VT(W),d=VT($),u=i2(W,f,1),h=i2($,d,1)}else throw"invalid block type";else{var g=mle(l)+4,y=i[g-4]|i[g-3]<<8,E=g+y;if(E>n){if(s)throw"unexpected EOF";break}r&&o(c+y),e.set(i.subarray(g,E),c),t.b=c+=y,t.p=l=E*8;continue}if(l>m){if(s)throw"unexpected EOF";break}}r&&o(c+131072);for(var oe=(1<<f)-1,X=(1<<d)-1,Q=l;;Q=l){var z=u[WT(i,l)&oe],Y=z>>>4;if(l+=z&15,l>m){if(s)throw"unexpected EOF";break}if(!z)throw"invalid length/literal";if(Y<256)e[c++]=Y;else if(Y==256){Q=l,u=null;break}else{var O=Y-254;if(Y>264){var L=Y-257,K=ZG[L];O=nu(i,l,(1<<K)-1)+iH[L],l+=K}var te=h[WT(i,l)&X],q=te>>>4;if(!te)throw"invalid distance";l+=te&15;var $=fle[q];if(q>3){var K=eH[q];$+=WT(i,l)&(1<<K)-1,l+=K}if(l>m){if(s)throw"unexpected EOF";break}r&&o(c+131072);for(var J=c+O;c<J;c+=4)e[c]=e[c-$],e[c+1]=e[c+1-$],e[c+2]=e[c+2-$],e[c+3]=e[c+3-$];c=J}}t.l=u,t.p=Q,t.b=c,u&&(a=1,t.m=f,t.d=h,t.n=d)}while(!a);return c==e.length?e:gle(e,0,c)},yle=new uc(0),vle=function(i){if((i[0]&15)!=8||i[0]>>>4>7||(i[0]<<8|i[1])%31)throw"invalid zlib data";if(i[1]&32)throw"invalid zlib data: preset dictionaries not supported"};function Fv(i,e){return Ale((vle(i),i.subarray(2,-4)),e)}var xle=typeof TextDecoder<"u"&&new TextDecoder,Ele=0;try{xle.decode(yle,{stream:!0}),Ele=1}catch{}let _le=class extends It{constructor(e,t,n=!1,r=!1,s=1e4){const o=new fn;super(o,t),this.isMarchingCubes=!0;const a=this,l=new Float32Array(36),c=new Float32Array(36),u=new Float32Array(36);this.enableUvs=n,this.enableColors=r,this.init=function(E){this.resolution=E,this.isolation=80,this.size=E,this.size2=this.size*this.size,this.size3=this.size2*this.size,this.halfsize=this.size/2,this.delta=2/this.size,this.yd=this.size,this.zd=this.size2,this.field=new Float32Array(this.size3),this.normal_cache=new Float32Array(this.size3*3),this.palette=new Float32Array(this.size3*3),this.count=0;const x=s*3;this.positionArray=new Float32Array(x*3);const C=new mn(this.positionArray,3);C.setUsage(No),o.setAttribute("position",C),this.normalArray=new Float32Array(x*3);const T=new mn(this.normalArray,3);if(T.setUsage(No),o.setAttribute("normal",T),this.enableUvs){this.uvArray=new Float32Array(x*2);const I=new mn(this.uvArray,2);I.setUsage(No),o.setAttribute("uv",I)}if(this.enableColors){this.colorArray=new Float32Array(x*3);const I=new mn(this.colorArray,3);I.setUsage(No),o.setAttribute("color",I)}o.boundingSphere=new Bi(new H,1)};function h(E,x,C){return E+(x-E)*C}function f(E,x,C,T,I,M,L,R,P,F){const k=(C-L)/(R-L),z=a.normal_cache;l[x+0]=T+k*a.delta,l[x+1]=I,l[x+2]=M,c[x+0]=h(z[E+0],z[E+3],k),c[x+1]=h(z[E+1],z[E+4],k),c[x+2]=h(z[E+2],z[E+5],k),u[x+0]=h(a.palette[P*3+0],a.palette[F*3+0],k),u[x+1]=h(a.palette[P*3+1],a.palette[F*3+1],k),u[x+2]=h(a.palette[P*3+2],a.palette[F*3+2],k)}function d(E,x,C,T,I,M,L,R,P,F){const k=(C-L)/(R-L),z=a.normal_cache;l[x+0]=T,l[x+1]=I+k*a.delta,l[x+2]=M;const U=E+a.yd*3;c[x+0]=h(z[E+0],z[U+0],k),c[x+1]=h(z[E+1],z[U+1],k),c[x+2]=h(z[E+2],z[U+2],k),u[x+0]=h(a.palette[P*3+0],a.palette[F*3+0],k),u[x+1]=h(a.palette[P*3+1],a.palette[F*3+1],k),u[x+2]=h(a.palette[P*3+2],a.palette[F*3+2],k)}function m(E,x,C,T,I,M,L,R,P,F){const k=(C-L)/(R-L),z=a.normal_cache;l[x+0]=T,l[x+1]=I,l[x+2]=M+k*a.delta;const U=E+a.zd*3;c[x+0]=h(z[E+0],z[U+0],k),c[x+1]=h(z[E+1],z[U+1],k),c[x+2]=h(z[E+2],z[U+2],k),u[x+0]=h(a.palette[P*3+0],a.palette[F*3+0],k),u[x+1]=h(a.palette[P*3+1],a.palette[F*3+1],k),u[x+2]=h(a.palette[P*3+2],a.palette[F*3+2],k)}function A(E){const x=E*3;a.normal_cache[x]===0&&(a.normal_cache[x+0]=a.field[E-1]-a.field[E+1],a.normal_cache[x+1]=a.field[E-a.yd]-a.field[E+a.yd],a.normal_cache[x+2]=a.field[E-a.zd]-a.field[E+a.zd])}function g(E,x,C,T,I){const M=T+1,L=T+a.yd,R=T+a.zd,P=M+a.yd,F=M+a.zd,k=T+a.yd+a.zd,z=M+a.yd+a.zd;let U=0;const W=a.field[T],$=a.field[M],oe=a.field[L],X=a.field[P],Q=a.field[R],Y=a.field[F],O=a.field[k],K=a.field[z];W<I&&(U|=1),$<I&&(U|=2),oe<I&&(U|=8),X<I&&(U|=4),Q<I&&(U|=16),Y<I&&(U|=32),O<I&&(U|=128),K<I&&(U|=64);const te=Sle[U];if(te===0)return 0;const q=a.delta,J=E+q,ie=x+q,re=C+q;te&1&&(A(T),A(M),f(T*3,0,I,E,x,C,W,$,T,M)),te&2&&(A(M),A(P),d(M*3,3,I,J,x,C,$,X,M,P)),te&4&&(A(L),A(P),f(L*3,6,I,E,ie,C,oe,X,L,P)),te&8&&(A(T),A(L),d(T*3,9,I,E,x,C,W,oe,T,L)),te&16&&(A(R),A(F),f(R*3,12,I,E,x,re,Q,Y,R,F)),te&32&&(A(F),A(z),d(F*3,15,I,J,x,re,Y,K,F,z)),te&64&&(A(k),A(z),f(k*3,18,I,E,ie,re,O,K,k,z)),te&128&&(A(R),A(k),d(R*3,21,I,E,x,re,Q,O,R,k)),te&256&&(A(T),A(R),m(T*3,24,I,E,x,C,W,Q,T,R)),te&512&&(A(M),A(F),m(M*3,27,I,J,x,C,$,Y,M,F)),te&1024&&(A(P),A(z),m(P*3,30,I,J,ie,C,X,K,P,z)),te&2048&&(A(L),A(k),m(L*3,33,I,E,ie,C,oe,O,L,k)),U<<=4;let se,ge,xe,pe=0,ce=0;for(;b3[U+ce]!=-1;)se=U+ce,ge=se+1,xe=se+2,y(l,c,u,3*b3[se],3*b3[ge],3*b3[xe]),ce+=3,pe++;return pe}function y(E,x,C,T,I,M){const L=a.count*3;if(a.positionArray[L+0]=E[T],a.positionArray[L+1]=E[T+1],a.positionArray[L+2]=E[T+2],a.positionArray[L+3]=E[I],a.positionArray[L+4]=E[I+1],a.positionArray[L+5]=E[I+2],a.positionArray[L+6]=E[M],a.positionArray[L+7]=E[M+1],a.positionArray[L+8]=E[M+2],a.material.flatShading===!0){const R=(x[T+0]+x[I+0]+x[M+0])/3,P=(x[T+1]+x[I+1]+x[M+1])/3,F=(x[T+2]+x[I+2]+x[M+2])/3;a.normalArray[L+0]=R,a.normalArray[L+1]=P,a.normalArray[L+2]=F,a.normalArray[L+3]=R,a.normalArray[L+4]=P,a.normalArray[L+5]=F,a.normalArray[L+6]=R,a.normalArray[L+7]=P,a.normalArray[L+8]=F}else a.normalArray[L+0]=x[T+0],a.normalArray[L+1]=x[T+1],a.normalArray[L+2]=x[T+2],a.normalArray[L+3]=x[I+0],a.normalArray[L+4]=x[I+1],a.normalArray[L+5]=x[I+2],a.normalArray[L+6]=x[M+0],a.normalArray[L+7]=x[M+1],a.normalArray[L+8]=x[M+2];if(a.enableUvs){const R=a.count*2;a.uvArray[R+0]=E[T+0],a.uvArray[R+1]=E[T+2],a.uvArray[R+2]=E[I+0],a.uvArray[R+3]=E[I+2],a.uvArray[R+4]=E[M+0],a.uvArray[R+5]=E[M+2]}a.enableColors&&(a.colorArray[L+0]=C[T+0],a.colorArray[L+1]=C[T+1],a.colorArray[L+2]=C[T+2],a.colorArray[L+3]=C[I+0],a.colorArray[L+4]=C[I+1],a.colorArray[L+5]=C[I+2],a.colorArray[L+6]=C[M+0],a.colorArray[L+7]=C[M+1],a.colorArray[L+8]=C[M+2]),a.count+=3}this.addBall=function(E,x,C,T,I,M){const L=Math.sign(T);T=Math.abs(T);const R=M!=null;let P=new ut(E,x,C);if(R)try{P=M instanceof ut?M:Array.isArray(M)?new ut(Math.min(Math.abs(M[0]),1),Math.min(Math.abs(M[1]),1),Math.min(Math.abs(M[2]),1)):new ut(M)}catch{P=new ut(E,x,C)}const F=this.size*Math.sqrt(T/I),k=C*this.size,z=x*this.size,U=E*this.size;let W=Math.floor(k-F);W<1&&(W=1);let $=Math.floor(k+F);$>this.size-1&&($=this.size-1);let oe=Math.floor(z-F);oe<1&&(oe=1);let X=Math.floor(z+F);X>this.size-1&&(X=this.size-1);let Q=Math.floor(U-F);Q<1&&(Q=1);let Y=Math.floor(U+F);Y>this.size-1&&(Y=this.size-1);let O,K,te,q,J,ie,re,se,ge,xe,pe;for(te=W;te<$;te++)for(J=this.size2*te,se=te/this.size-C,ge=se*se,K=oe;K<X;K++)for(q=J+this.size*K,re=K/this.size-x,xe=re*re,O=Q;O<Y;O++)if(ie=O/this.size-E,pe=T/(1e-6+ie*ie+xe+ge)-I,pe>0){this.field[q+O]+=pe*L;const ce=Math.sqrt((O-U)*(O-U)+(K-z)*(K-z)+(te-k)*(te-k))/F,we=1-ce*ce*ce*(ce*(ce*6-15)+10);this.palette[(q+O)*3+0]+=P.r*we,this.palette[(q+O)*3+1]+=P.g*we,this.palette[(q+O)*3+2]+=P.b*we}},this.addPlaneX=function(E,x){const C=this.size,T=this.yd,I=this.zd,M=this.field;let L,R,P,F,k,z,U,W=C*Math.sqrt(E/x);for(W>C&&(W=C),L=0;L<W;L++)if(z=L/C,F=z*z,k=E/(1e-4+F)-x,k>0)for(R=0;R<C;R++)for(U=L+R*T,P=0;P<C;P++)M[I*P+U]+=k},this.addPlaneY=function(E,x){const C=this.size,T=this.yd,I=this.zd,M=this.field;let L,R,P,F,k,z,U,W,$=C*Math.sqrt(E/x);for($>C&&($=C),R=0;R<$;R++)if(z=R/C,F=z*z,k=E/(1e-4+F)-x,k>0)for(U=R*T,L=0;L<C;L++)for(W=U+L,P=0;P<C;P++)M[I*P+W]+=k},this.addPlaneZ=function(E,x){const C=this.size,T=this.yd,I=this.zd,M=this.field;let L,R,P,F,k,z,U,W,$=C*Math.sqrt(E/x);for($>C&&($=C),P=0;P<$;P++)if(z=P/C,F=z*z,k=E/(1e-4+F)-x,k>0)for(U=I*P,R=0;R<C;R++)for(W=U+R*T,L=0;L<C;L++)M[W+L]+=k},this.setCell=function(E,x,C,T){const I=this.size2*C+this.size*x+E;this.field[I]=T},this.getCell=function(E,x,C){const T=this.size2*C+this.size*x+E;return this.field[T]},this.blur=function(E=1){const x=this.field,C=x.slice(),T=this.size,I=this.size2;for(let M=0;M<T;M++)for(let L=0;L<T;L++)for(let R=0;R<T;R++){const P=I*R+T*L+M;let F=C[P],k=1;for(let z=-1;z<=1;z+=2){const U=z+M;if(!(U<0||U>=T))for(let W=-1;W<=1;W+=2){const $=W+L;if(!($<0||$>=T))for(let oe=-1;oe<=1;oe+=2){const X=oe+R;if(X<0||X>=T)continue;const Q=I*X+T*$+U,Y=C[Q];k++,F+=E*(Y-F)/k}}}x[P]=F}},this.reset=function(){for(let E=0;E<this.size3;E++)this.normal_cache[E*3]=0,this.field[E]=0,this.palette[E*3]=this.palette[E*3+1]=this.palette[E*3+2]=0},this.update=function(){this.count=0;const E=this.size-2;for(let x=1;x<E;x++){const C=this.size2*x,T=(x-this.halfsize)/this.halfsize;for(let I=1;I<E;I++){const M=C+this.size*I,L=(I-this.halfsize)/this.halfsize;for(let R=1;R<E;R++){const P=(R-this.halfsize)/this.halfsize,F=M+R;g(P,L,T,F,this.isolation)}}}this.geometry.setDrawRange(0,this.count),o.getAttribute("position").needsUpdate=!0,o.getAttribute("normal").needsUpdate=!0,this.enableUvs&&(o.getAttribute("uv").needsUpdate=!0),this.enableColors&&(o.getAttribute("color").needsUpdate=!0),this.count/3>s&&console.warn("THREE.MarchingCubes: Geometry buffers too small for rendering. Please create an instance with a higher poly count.")},this.init(e)}};const Sle=new Int32Array([0,265,515,778,1030,1295,1541,1804,2060,2309,2575,2822,3082,3331,3593,3840,400,153,915,666,1430,1183,1941,1692,2460,2197,2975,2710,3482,3219,3993,3728,560,825,51,314,1590,1855,1077,1340,2620,2869,2111,2358,3642,3891,3129,3376,928,681,419,170,1958,1711,1445,1196,2988,2725,2479,2214,4010,3747,3497,3232,1120,1385,1635,1898,102,367,613,876,3180,3429,3695,3942,2154,2403,2665,2912,1520,1273,2035,1786,502,255,1013,764,3580,3317,4095,3830,2554,2291,3065,2800,1616,1881,1107,1370,598,863,85,348,3676,3925,3167,3414,2650,2899,2137,2384,1984,1737,1475,1226,966,719,453,204,4044,3781,3535,3270,3018,2755,2505,2240,2240,2505,2755,3018,3270,3535,3781,4044,204,453,719,966,1226,1475,1737,1984,2384,2137,2899,2650,3414,3167,3925,3676,348,85,863,598,1370,1107,1881,1616,2800,3065,2291,2554,3830,4095,3317,3580,764,1013,255,502,1786,2035,1273,1520,2912,2665,2403,2154,3942,3695,3429,3180,876,613,367,102,1898,1635,1385,1120,3232,3497,3747,4010,2214,2479,2725,2988,1196,1445,1711,1958,170,419,681,928,3376,3129,3891,3642,2358,2111,2869,2620,1340,1077,1855,1590,314,51,825,560,3728,3993,3219,3482,2710,2975,2197,2460,1692,1941,1183,1430,666,915,153,400,3840,3593,3331,3082,2822,2575,2309,2060,1804,1541,1295,1030,778,515,265,0]),b3=new Int32Array([-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,9,8,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,2,10,0,2,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,8,3,2,10,8,10,9,8,-1,-1,-1,-1,-1,-1,-1,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,8,11,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,11,2,1,9,11,9,8,11,-1,-1,-1,-1,-1,-1,-1,3,10,1,11,10,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,10,1,0,8,10,8,11,10,-1,-1,-1,-1,-1,-1,-1,3,9,0,3,11,9,11,10,9,-1,-1,-1,-1,-1,-1,-1,9,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,7,3,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,1,9,4,7,1,7,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,4,7,3,0,4,1,2,10,-1,-1,-1,-1,-1,-1,-1,9,2,10,9,0,2,8,4,7,-1,-1,-1,-1,-1,-1,-1,2,10,9,2,9,7,2,7,3,7,9,4,-1,-1,-1,-1,8,4,7,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,4,7,11,2,4,2,0,4,-1,-1,-1,-1,-1,-1,-1,9,0,1,8,4,7,2,3,11,-1,-1,-1,-1,-1,-1,-1,4,7,11,9,4,11,9,11,2,9,2,1,-1,-1,-1,-1,3,10,1,3,11,10,7,8,4,-1,-1,-1,-1,-1,-1,-1,1,11,10,1,4,11,1,0,4,7,11,4,-1,-1,-1,-1,4,7,8,9,0,11,9,11,10,11,0,3,-1,-1,-1,-1,4,7,11,4,11,9,9,11,10,-1,-1,-1,-1,-1,-1,-1,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,5,4,1,5,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,5,4,8,3,5,3,1,5,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,10,4,9,5,-1,-1,-1,-1,-1,-1,-1,5,2,10,5,4,2,4,0,2,-1,-1,-1,-1,-1,-1,-1,2,10,5,3,2,5,3,5,4,3,4,8,-1,-1,-1,-1,9,5,4,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,0,8,11,4,9,5,-1,-1,-1,-1,-1,-1,-1,0,5,4,0,1,5,2,3,11,-1,-1,-1,-1,-1,-1,-1,2,1,5,2,5,8,2,8,11,4,8,5,-1,-1,-1,-1,10,3,11,10,1,3,9,5,4,-1,-1,-1,-1,-1,-1,-1,4,9,5,0,8,1,8,10,1,8,11,10,-1,-1,-1,-1,5,4,0,5,0,11,5,11,10,11,0,3,-1,-1,-1,-1,5,4,8,5,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,9,7,8,5,7,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,3,0,9,5,3,5,7,3,-1,-1,-1,-1,-1,-1,-1,0,7,8,0,1,7,1,5,7,-1,-1,-1,-1,-1,-1,-1,1,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,7,8,9,5,7,10,1,2,-1,-1,-1,-1,-1,-1,-1,10,1,2,9,5,0,5,3,0,5,7,3,-1,-1,-1,-1,8,0,2,8,2,5,8,5,7,10,5,2,-1,-1,-1,-1,2,10,5,2,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,7,9,5,7,8,9,3,11,2,-1,-1,-1,-1,-1,-1,-1,9,5,7,9,7,2,9,2,0,2,7,11,-1,-1,-1,-1,2,3,11,0,1,8,1,7,8,1,5,7,-1,-1,-1,-1,11,2,1,11,1,7,7,1,5,-1,-1,-1,-1,-1,-1,-1,9,5,8,8,5,7,10,1,3,10,3,11,-1,-1,-1,-1,5,7,0,5,0,9,7,11,0,1,0,10,11,10,0,-1,11,10,0,11,0,3,10,5,0,8,0,7,5,7,0,-1,11,10,5,7,11,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,0,1,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,1,9,8,5,10,6,-1,-1,-1,-1,-1,-1,-1,1,6,5,2,6,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,6,5,1,2,6,3,0,8,-1,-1,-1,-1,-1,-1,-1,9,6,5,9,0,6,0,2,6,-1,-1,-1,-1,-1,-1,-1,5,9,8,5,8,2,5,2,6,3,2,8,-1,-1,-1,-1,2,3,11,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,0,8,11,2,0,10,6,5,-1,-1,-1,-1,-1,-1,-1,0,1,9,2,3,11,5,10,6,-1,-1,-1,-1,-1,-1,-1,5,10,6,1,9,2,9,11,2,9,8,11,-1,-1,-1,-1,6,3,11,6,5,3,5,1,3,-1,-1,-1,-1,-1,-1,-1,0,8,11,0,11,5,0,5,1,5,11,6,-1,-1,-1,-1,3,11,6,0,3,6,0,6,5,0,5,9,-1,-1,-1,-1,6,5,9,6,9,11,11,9,8,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,4,7,3,6,5,10,-1,-1,-1,-1,-1,-1,-1,1,9,0,5,10,6,8,4,7,-1,-1,-1,-1,-1,-1,-1,10,6,5,1,9,7,1,7,3,7,9,4,-1,-1,-1,-1,6,1,2,6,5,1,4,7,8,-1,-1,-1,-1,-1,-1,-1,1,2,5,5,2,6,3,0,4,3,4,7,-1,-1,-1,-1,8,4,7,9,0,5,0,6,5,0,2,6,-1,-1,-1,-1,7,3,9,7,9,4,3,2,9,5,9,6,2,6,9,-1,3,11,2,7,8,4,10,6,5,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,2,4,2,0,2,7,11,-1,-1,-1,-1,0,1,9,4,7,8,2,3,11,5,10,6,-1,-1,-1,-1,9,2,1,9,11,2,9,4,11,7,11,4,5,10,6,-1,8,4,7,3,11,5,3,5,1,5,11,6,-1,-1,-1,-1,5,1,11,5,11,6,1,0,11,7,11,4,0,4,11,-1,0,5,9,0,6,5,0,3,6,11,6,3,8,4,7,-1,6,5,9,6,9,11,4,7,9,7,11,9,-1,-1,-1,-1,10,4,9,6,4,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,10,6,4,9,10,0,8,3,-1,-1,-1,-1,-1,-1,-1,10,0,1,10,6,0,6,4,0,-1,-1,-1,-1,-1,-1,-1,8,3,1,8,1,6,8,6,4,6,1,10,-1,-1,-1,-1,1,4,9,1,2,4,2,6,4,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,9,2,4,9,2,6,4,-1,-1,-1,-1,0,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,2,8,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,10,4,9,10,6,4,11,2,3,-1,-1,-1,-1,-1,-1,-1,0,8,2,2,8,11,4,9,10,4,10,6,-1,-1,-1,-1,3,11,2,0,1,6,0,6,4,6,1,10,-1,-1,-1,-1,6,4,1,6,1,10,4,8,1,2,1,11,8,11,1,-1,9,6,4,9,3,6,9,1,3,11,6,3,-1,-1,-1,-1,8,11,1,8,1,0,11,6,1,9,1,4,6,4,1,-1,3,11,6,3,6,0,0,6,4,-1,-1,-1,-1,-1,-1,-1,6,4,8,11,6,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,10,6,7,8,10,8,9,10,-1,-1,-1,-1,-1,-1,-1,0,7,3,0,10,7,0,9,10,6,7,10,-1,-1,-1,-1,10,6,7,1,10,7,1,7,8,1,8,0,-1,-1,-1,-1,10,6,7,10,7,1,1,7,3,-1,-1,-1,-1,-1,-1,-1,1,2,6,1,6,8,1,8,9,8,6,7,-1,-1,-1,-1,2,6,9,2,9,1,6,7,9,0,9,3,7,3,9,-1,7,8,0,7,0,6,6,0,2,-1,-1,-1,-1,-1,-1,-1,7,3,2,6,7,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,11,10,6,8,10,8,9,8,6,7,-1,-1,-1,-1,2,0,7,2,7,11,0,9,7,6,7,10,9,10,7,-1,1,8,0,1,7,8,1,10,7,6,7,10,2,3,11,-1,11,2,1,11,1,7,10,6,1,6,7,1,-1,-1,-1,-1,8,9,6,8,6,7,9,1,6,11,6,3,1,3,6,-1,0,9,1,11,6,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,8,0,7,0,6,3,11,0,11,6,0,-1,-1,-1,-1,7,11,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,1,9,8,3,1,11,7,6,-1,-1,-1,-1,-1,-1,-1,10,1,2,6,11,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,8,6,11,7,-1,-1,-1,-1,-1,-1,-1,2,9,0,2,10,9,6,11,7,-1,-1,-1,-1,-1,-1,-1,6,11,7,2,10,3,10,8,3,10,9,8,-1,-1,-1,-1,7,2,3,6,2,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,0,8,7,6,0,6,2,0,-1,-1,-1,-1,-1,-1,-1,2,7,6,2,3,7,0,1,9,-1,-1,-1,-1,-1,-1,-1,1,6,2,1,8,6,1,9,8,8,7,6,-1,-1,-1,-1,10,7,6,10,1,7,1,3,7,-1,-1,-1,-1,-1,-1,-1,10,7,6,1,7,10,1,8,7,1,0,8,-1,-1,-1,-1,0,3,7,0,7,10,0,10,9,6,10,7,-1,-1,-1,-1,7,6,10,7,10,8,8,10,9,-1,-1,-1,-1,-1,-1,-1,6,8,4,11,8,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,6,11,3,0,6,0,4,6,-1,-1,-1,-1,-1,-1,-1,8,6,11,8,4,6,9,0,1,-1,-1,-1,-1,-1,-1,-1,9,4,6,9,6,3,9,3,1,11,3,6,-1,-1,-1,-1,6,8,4,6,11,8,2,10,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,11,0,6,11,0,4,6,-1,-1,-1,-1,4,11,8,4,6,11,0,2,9,2,10,9,-1,-1,-1,-1,10,9,3,10,3,2,9,4,3,11,3,6,4,6,3,-1,8,2,3,8,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,0,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,4,2,4,6,4,3,8,-1,-1,-1,-1,1,9,4,1,4,2,2,4,6,-1,-1,-1,-1,-1,-1,-1,8,1,3,8,6,1,8,4,6,6,10,1,-1,-1,-1,-1,10,1,0,10,0,6,6,0,4,-1,-1,-1,-1,-1,-1,-1,4,6,3,4,3,8,6,10,3,0,3,9,10,9,3,-1,10,9,4,6,10,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,5,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,5,11,7,6,-1,-1,-1,-1,-1,-1,-1,5,0,1,5,4,0,7,6,11,-1,-1,-1,-1,-1,-1,-1,11,7,6,8,3,4,3,5,4,3,1,5,-1,-1,-1,-1,9,5,4,10,1,2,7,6,11,-1,-1,-1,-1,-1,-1,-1,6,11,7,1,2,10,0,8,3,4,9,5,-1,-1,-1,-1,7,6,11,5,4,10,4,2,10,4,0,2,-1,-1,-1,-1,3,4,8,3,5,4,3,2,5,10,5,2,11,7,6,-1,7,2,3,7,6,2,5,4,9,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,6,0,6,2,6,8,7,-1,-1,-1,-1,3,6,2,3,7,6,1,5,0,5,4,0,-1,-1,-1,-1,6,2,8,6,8,7,2,1,8,4,8,5,1,5,8,-1,9,5,4,10,1,6,1,7,6,1,3,7,-1,-1,-1,-1,1,6,10,1,7,6,1,0,7,8,7,0,9,5,4,-1,4,0,10,4,10,5,0,3,10,6,10,7,3,7,10,-1,7,6,10,7,10,8,5,4,10,4,8,10,-1,-1,-1,-1,6,9,5,6,11,9,11,8,9,-1,-1,-1,-1,-1,-1,-1,3,6,11,0,6,3,0,5,6,0,9,5,-1,-1,-1,-1,0,11,8,0,5,11,0,1,5,5,6,11,-1,-1,-1,-1,6,11,3,6,3,5,5,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,11,9,11,8,11,5,6,-1,-1,-1,-1,0,11,3,0,6,11,0,9,6,5,6,9,1,2,10,-1,11,8,5,11,5,6,8,0,5,10,5,2,0,2,5,-1,6,11,3,6,3,5,2,10,3,10,5,3,-1,-1,-1,-1,5,8,9,5,2,8,5,6,2,3,8,2,-1,-1,-1,-1,9,5,6,9,6,0,0,6,2,-1,-1,-1,-1,-1,-1,-1,1,5,8,1,8,0,5,6,8,3,8,2,6,2,8,-1,1,5,6,2,1,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,6,1,6,10,3,8,6,5,6,9,8,9,6,-1,10,1,0,10,0,6,9,5,0,5,6,0,-1,-1,-1,-1,0,3,8,5,6,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,5,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,7,5,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,11,7,5,8,3,0,-1,-1,-1,-1,-1,-1,-1,5,11,7,5,10,11,1,9,0,-1,-1,-1,-1,-1,-1,-1,10,7,5,10,11,7,9,8,1,8,3,1,-1,-1,-1,-1,11,1,2,11,7,1,7,5,1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,7,1,7,5,7,2,11,-1,-1,-1,-1,9,7,5,9,2,7,9,0,2,2,11,7,-1,-1,-1,-1,7,5,2,7,2,11,5,9,2,3,2,8,9,8,2,-1,2,5,10,2,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,8,2,0,8,5,2,8,7,5,10,2,5,-1,-1,-1,-1,9,0,1,5,10,3,5,3,7,3,10,2,-1,-1,-1,-1,9,8,2,9,2,1,8,7,2,10,2,5,7,5,2,-1,1,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,7,0,7,1,1,7,5,-1,-1,-1,-1,-1,-1,-1,9,0,3,9,3,5,5,3,7,-1,-1,-1,-1,-1,-1,-1,9,8,7,5,9,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,8,4,5,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,5,0,4,5,11,0,5,10,11,11,3,0,-1,-1,-1,-1,0,1,9,8,4,10,8,10,11,10,4,5,-1,-1,-1,-1,10,11,4,10,4,5,11,3,4,9,4,1,3,1,4,-1,2,5,1,2,8,5,2,11,8,4,5,8,-1,-1,-1,-1,0,4,11,0,11,3,4,5,11,2,11,1,5,1,11,-1,0,2,5,0,5,9,2,11,5,4,5,8,11,8,5,-1,9,4,5,2,11,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,5,10,3,5,2,3,4,5,3,8,4,-1,-1,-1,-1,5,10,2,5,2,4,4,2,0,-1,-1,-1,-1,-1,-1,-1,3,10,2,3,5,10,3,8,5,4,5,8,0,1,9,-1,5,10,2,5,2,4,1,9,2,9,4,2,-1,-1,-1,-1,8,4,5,8,5,3,3,5,1,-1,-1,-1,-1,-1,-1,-1,0,4,5,1,0,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,4,5,8,5,3,9,0,5,0,3,5,-1,-1,-1,-1,9,4,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,11,7,4,9,11,9,10,11,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,7,9,11,7,9,10,11,-1,-1,-1,-1,1,10,11,1,11,4,1,4,0,7,4,11,-1,-1,-1,-1,3,1,4,3,4,8,1,10,4,7,4,11,10,11,4,-1,4,11,7,9,11,4,9,2,11,9,1,2,-1,-1,-1,-1,9,7,4,9,11,7,9,1,11,2,11,1,0,8,3,-1,11,7,4,11,4,2,2,4,0,-1,-1,-1,-1,-1,-1,-1,11,7,4,11,4,2,8,3,4,3,2,4,-1,-1,-1,-1,2,9,10,2,7,9,2,3,7,7,4,9,-1,-1,-1,-1,9,10,7,9,7,4,10,2,7,8,7,0,2,0,7,-1,3,7,10,3,10,2,7,4,10,1,10,0,4,0,10,-1,1,10,2,8,7,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,7,1,3,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,0,8,1,8,7,1,-1,-1,-1,-1,4,0,3,7,4,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,8,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,11,9,10,-1,-1,-1,-1,-1,-1,-1,0,1,10,0,10,8,8,10,11,-1,-1,-1,-1,-1,-1,-1,3,1,10,11,3,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,11,1,11,9,9,11,8,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,1,2,9,2,11,9,-1,-1,-1,-1,0,2,11,8,0,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,2,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,10,8,9,-1,-1,-1,-1,-1,-1,-1,9,10,2,0,9,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,0,1,8,1,10,8,-1,-1,-1,-1,1,10,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,8,9,1,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,9,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,3,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1]);var wle=Object.defineProperty,Cle=(i,e,t)=>e in i?wle(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,iu=(i,e,t)=>(Cle(i,typeof e!="symbol"?e+"":e,t),t);class jT{constructor(e=Math){iu(this,"grad3",[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]]),iu(this,"grad4",[[0,1,1,1],[0,1,1,-1],[0,1,-1,1],[0,1,-1,-1],[0,-1,1,1],[0,-1,1,-1],[0,-1,-1,1],[0,-1,-1,-1],[1,0,1,1],[1,0,1,-1],[1,0,-1,1],[1,0,-1,-1],[-1,0,1,1],[-1,0,1,-1],[-1,0,-1,1],[-1,0,-1,-1],[1,1,0,1],[1,1,0,-1],[1,-1,0,1],[1,-1,0,-1],[-1,1,0,1],[-1,1,0,-1],[-1,-1,0,1],[-1,-1,0,-1],[1,1,1,0],[1,1,-1,0],[1,-1,1,0],[1,-1,-1,0],[-1,1,1,0],[-1,1,-1,0],[-1,-1,1,0],[-1,-1,-1,0]]),iu(this,"p",[]),iu(this,"perm",[]),iu(this,"simplex",[[0,1,2,3],[0,1,3,2],[0,0,0,0],[0,2,3,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,3,0],[0,2,1,3],[0,0,0,0],[0,3,1,2],[0,3,2,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,3,2,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,0,3],[0,0,0,0],[1,3,0,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,3,0,1],[2,3,1,0],[1,0,2,3],[1,0,3,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,3,1],[0,0,0,0],[2,1,3,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,1,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,0,1,2],[3,0,2,1],[0,0,0,0],[3,1,2,0],[2,1,0,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,1,0,2],[0,0,0,0],[3,2,0,1],[3,2,1,0]]),iu(this,"dot",(t,n,r)=>t[0]*n+t[1]*r),iu(this,"dot3",(t,n,r,s)=>t[0]*n+t[1]*r+t[2]*s),iu(this,"dot4",(t,n,r,s,o)=>t[0]*n+t[1]*r+t[2]*s+t[3]*o),iu(this,"noise",(t,n)=>{let r,s,o;const a=.5*(Math.sqrt(3)-1),l=(t+n)*a,c=Math.floor(t+l),u=Math.floor(n+l),h=(3-Math.sqrt(3))/6,f=(c+u)*h,d=c-f,m=u-f,A=t-d,g=n-m;let y=0,E=1;A>g&&(y=1,E=0);const x=A-y+h,C=g-E+h,T=A-1+2*h,I=g-1+2*h,M=c&255,L=u&255,R=this.perm[M+this.perm[L]]%12,P=this.perm[M+y+this.perm[L+E]]%12,F=this.perm[M+1+this.perm[L+1]]%12;let k=.5-A*A-g*g;k<0?r=0:(k*=k,r=k*k*this.dot(this.grad3[R],A,g));let z=.5-x*x-C*C;z<0?s=0:(z*=z,s=z*z*this.dot(this.grad3[P],x,C));let U=.5-T*T-I*I;return U<0?o=0:(U*=U,o=U*U*this.dot(this.grad3[F],T,I)),70*(r+s+o)}),iu(this,"noise3d",(t,n,r)=>{let s,o,a,l;const u=(t+n+r)*.3333333333333333,h=Math.floor(t+u),f=Math.floor(n+u),d=Math.floor(r+u),m=1/6,A=(h+f+d)*m,g=h-A,y=f-A,E=d-A,x=t-g,C=n-y,T=r-E;let I,M,L,R,P,F;x>=C?C>=T?(I=1,M=0,L=0,R=1,P=1,F=0):x>=T?(I=1,M=0,L=0,R=1,P=0,F=1):(I=0,M=0,L=1,R=1,P=0,F=1):C<T?(I=0,M=0,L=1,R=0,P=1,F=1):x<T?(I=0,M=1,L=0,R=0,P=1,F=1):(I=0,M=1,L=0,R=1,P=1,F=0);const k=x-I+m,z=C-M+m,U=T-L+m,W=x-R+2*m,$=C-P+2*m,oe=T-F+2*m,X=x-1+3*m,Q=C-1+3*m,Y=T-1+3*m,O=h&255,K=f&255,te=d&255,q=this.perm[O+this.perm[K+this.perm[te]]]%12,J=this.perm[O+I+this.perm[K+M+this.perm[te+L]]]%12,ie=this.perm[O+R+this.perm[K+P+this.perm[te+F]]]%12,re=this.perm[O+1+this.perm[K+1+this.perm[te+1]]]%12;let se=.6-x*x-C*C-T*T;se<0?s=0:(se*=se,s=se*se*this.dot3(this.grad3[q],x,C,T));let ge=.6-k*k-z*z-U*U;ge<0?o=0:(ge*=ge,o=ge*ge*this.dot3(this.grad3[J],k,z,U));let xe=.6-W*W-$*$-oe*oe;xe<0?a=0:(xe*=xe,a=xe*xe*this.dot3(this.grad3[ie],W,$,oe));let pe=.6-X*X-Q*Q-Y*Y;return pe<0?l=0:(pe*=pe,l=pe*pe*this.dot3(this.grad3[re],X,Q,Y)),32*(s+o+a+l)}),iu(this,"noise4d",(t,n,r,s)=>{const o=this.grad4,a=this.simplex,l=this.perm,c=(Math.sqrt(5)-1)/4,u=(5-Math.sqrt(5))/20;let h,f,d,m,A;const g=(t+n+r+s)*c,y=Math.floor(t+g),E=Math.floor(n+g),x=Math.floor(r+g),C=Math.floor(s+g),T=(y+E+x+C)*u,I=y-T,M=E-T,L=x-T,R=C-T,P=t-I,F=n-M,k=r-L,z=s-R,U=P>F?32:0,W=P>k?16:0,$=F>k?8:0,oe=P>z?4:0,X=F>z?2:0,Q=k>z?1:0,Y=U+W+$+oe+X+Q;let O,K,te,q,J,ie,re,se,ge,xe,pe,ce;O=a[Y][0]>=3?1:0,K=a[Y][1]>=3?1:0,te=a[Y][2]>=3?1:0,q=a[Y][3]>=3?1:0,J=a[Y][0]>=2?1:0,ie=a[Y][1]>=2?1:0,re=a[Y][2]>=2?1:0,se=a[Y][3]>=2?1:0,ge=a[Y][0]>=1?1:0,xe=a[Y][1]>=1?1:0,pe=a[Y][2]>=1?1:0,ce=a[Y][3]>=1?1:0;const we=P-O+u,Ee=F-K+u,ve=k-te+u,Ae=z-q+u,Le=P-J+2*u,Te=F-ie+2*u,ne=k-re+2*u,V=z-se+2*u,de=P-ge+3*u,Re=F-xe+3*u,Be=k-pe+3*u,Fe=z-ce+3*u,He=P-1+4*u,it=F-1+4*u,$e=k-1+4*u,ct=z-1+4*u,pt=y&255,We=E&255,Mt=x&255,Ft=C&255,St=l[pt+l[We+l[Mt+l[Ft]]]]%32,gt=l[pt+O+l[We+K+l[Mt+te+l[Ft+q]]]]%32,ft=l[pt+J+l[We+ie+l[Mt+re+l[Ft+se]]]]%32,be=l[pt+ge+l[We+xe+l[Mt+pe+l[Ft+ce]]]]%32,qe=l[pt+1+l[We+1+l[Mt+1+l[Ft+1]]]]%32;let At=.6-P*P-F*F-k*k-z*z;At<0?h=0:(At*=At,h=At*At*this.dot4(o[St],P,F,k,z));let yt=.6-we*we-Ee*Ee-ve*ve-Ae*Ae;yt<0?f=0:(yt*=yt,f=yt*yt*this.dot4(o[gt],we,Ee,ve,Ae));let De=.6-Le*Le-Te*Te-ne*ne-V*V;De<0?d=0:(De*=De,d=De*De*this.dot4(o[ft],Le,Te,ne,V));let Ce=.6-de*de-Re*Re-Be*Be-Fe*Fe;Ce<0?m=0:(Ce*=Ce,m=Ce*Ce*this.dot4(o[be],de,Re,Be,Fe));let _t=.6-He*He-it*it-$e*$e-ct*ct;return _t<0?A=0:(_t*=_t,A=_t*_t*this.dot4(o[qe],He,it,$e,ct)),27*(h+f+d+m+A)});for(let t=0;t<256;t++)this.p[t]=Math.floor(e.random()*256);for(let t=0;t<512;t++)this.perm[t]=this.p[t&255]}}var Tle=Object.defineProperty,ble=(i,e,t)=>e in i?Tle(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,v9=(i,e,t)=>(ble(i,typeof e!="symbol"?e+"":e,t),t);const Ile=(()=>{const i={uniforms:{turbidity:{value:2},rayleigh:{value:1},mieCoefficient:{value:.005},mieDirectionalG:{value:.8},sunPosition:{value:new H},up:{value:new H(0,1,0)}},vertexShader:`
      uniform vec3 sunPosition;
      uniform float rayleigh;
      uniform float turbidity;
      uniform float mieCoefficient;
      uniform vec3 up;

      varying vec3 vWorldPosition;
      varying vec3 vSunDirection;
      varying float vSunfade;
      varying vec3 vBetaR;
      varying vec3 vBetaM;
      varying float vSunE;

      // constants for atmospheric scattering
      const float e = 2.71828182845904523536028747135266249775724709369995957;
      const float pi = 3.141592653589793238462643383279502884197169;

      // wavelength of used primaries, according to preetham
      const vec3 lambda = vec3( 680E-9, 550E-9, 450E-9 );
      // this pre-calcuation replaces older TotalRayleigh(vec3 lambda) function:
      // (8.0 * pow(pi, 3.0) * pow(pow(n, 2.0) - 1.0, 2.0) * (6.0 + 3.0 * pn)) / (3.0 * N * pow(lambda, vec3(4.0)) * (6.0 - 7.0 * pn))
      const vec3 totalRayleigh = vec3( 5.804542996261093E-6, 1.3562911419845635E-5, 3.0265902468824876E-5 );

      // mie stuff
      // K coefficient for the primaries
      const float v = 4.0;
      const vec3 K = vec3( 0.686, 0.678, 0.666 );
      // MieConst = pi * pow( ( 2.0 * pi ) / lambda, vec3( v - 2.0 ) ) * K
      const vec3 MieConst = vec3( 1.8399918514433978E14, 2.7798023919660528E14, 4.0790479543861094E14 );

      // earth shadow hack
      // cutoffAngle = pi / 1.95;
      const float cutoffAngle = 1.6110731556870734;
      const float steepness = 1.5;
      const float EE = 1000.0;

      float sunIntensity( float zenithAngleCos ) {
        zenithAngleCos = clamp( zenithAngleCos, -1.0, 1.0 );
        return EE * max( 0.0, 1.0 - pow( e, -( ( cutoffAngle - acos( zenithAngleCos ) ) / steepness ) ) );
      }

      vec3 totalMie( float T ) {
        float c = ( 0.2 * T ) * 10E-18;
        return 0.434 * c * MieConst;
      }

      void main() {

        vec4 worldPosition = modelMatrix * vec4( position, 1.0 );
        vWorldPosition = worldPosition.xyz;

        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        gl_Position.z = gl_Position.w; // set z to camera.far

        vSunDirection = normalize( sunPosition );

        vSunE = sunIntensity( dot( vSunDirection, up ) );

        vSunfade = 1.0 - clamp( 1.0 - exp( ( sunPosition.y / 450000.0 ) ), 0.0, 1.0 );

        float rayleighCoefficient = rayleigh - ( 1.0 * ( 1.0 - vSunfade ) );

      // extinction (absorbtion + out scattering)
      // rayleigh coefficients
        vBetaR = totalRayleigh * rayleighCoefficient;

      // mie coefficients
        vBetaM = totalMie( turbidity ) * mieCoefficient;

      }
    `,fragmentShader:`
      varying vec3 vWorldPosition;
      varying vec3 vSunDirection;
      varying float vSunfade;
      varying vec3 vBetaR;
      varying vec3 vBetaM;
      varying float vSunE;

      uniform float mieDirectionalG;
      uniform vec3 up;

      const vec3 cameraPos = vec3( 0.0, 0.0, 0.0 );

      // constants for atmospheric scattering
      const float pi = 3.141592653589793238462643383279502884197169;

      const float n = 1.0003; // refractive index of air
      const float N = 2.545E25; // number of molecules per unit volume for air at 288.15K and 1013mb (sea level -45 celsius)

      // optical length at zenith for molecules
      const float rayleighZenithLength = 8.4E3;
      const float mieZenithLength = 1.25E3;
      // 66 arc seconds -> degrees, and the cosine of that
      const float sunAngularDiameterCos = 0.999956676946448443553574619906976478926848692873900859324;

      // 3.0 / ( 16.0 * pi )
      const float THREE_OVER_SIXTEENPI = 0.05968310365946075;
      // 1.0 / ( 4.0 * pi )
      const float ONE_OVER_FOURPI = 0.07957747154594767;

      float rayleighPhase( float cosTheta ) {
        return THREE_OVER_SIXTEENPI * ( 1.0 + pow( cosTheta, 2.0 ) );
      }

      float hgPhase( float cosTheta, float g ) {
        float g2 = pow( g, 2.0 );
        float inverse = 1.0 / pow( 1.0 - 2.0 * g * cosTheta + g2, 1.5 );
        return ONE_OVER_FOURPI * ( ( 1.0 - g2 ) * inverse );
      }

      void main() {

        vec3 direction = normalize( vWorldPosition - cameraPos );

      // optical length
      // cutoff angle at 90 to avoid singularity in next formula.
        float zenithAngle = acos( max( 0.0, dot( up, direction ) ) );
        float inverse = 1.0 / ( cos( zenithAngle ) + 0.15 * pow( 93.885 - ( ( zenithAngle * 180.0 ) / pi ), -1.253 ) );
        float sR = rayleighZenithLength * inverse;
        float sM = mieZenithLength * inverse;

      // combined extinction factor
        vec3 Fex = exp( -( vBetaR * sR + vBetaM * sM ) );

      // in scattering
        float cosTheta = dot( direction, vSunDirection );

        float rPhase = rayleighPhase( cosTheta * 0.5 + 0.5 );
        vec3 betaRTheta = vBetaR * rPhase;

        float mPhase = hgPhase( cosTheta, mieDirectionalG );
        vec3 betaMTheta = vBetaM * mPhase;

        vec3 Lin = pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * ( 1.0 - Fex ), vec3( 1.5 ) );
        Lin *= mix( vec3( 1.0 ), pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * Fex, vec3( 1.0 / 2.0 ) ), clamp( pow( 1.0 - dot( up, vSunDirection ), 5.0 ), 0.0, 1.0 ) );

      // nightsky
        float theta = acos( direction.y ); // elevation --> y-axis, [-pi/2, pi/2]
        float phi = atan( direction.z, direction.x ); // azimuth --> x-axis [-pi/2, pi/2]
        vec2 uv = vec2( phi, theta ) / vec2( 2.0 * pi, pi ) + vec2( 0.5, 0.0 );
        vec3 L0 = vec3( 0.1 ) * Fex;

      // composition + solar disc
        float sundisk = smoothstep( sunAngularDiameterCos, sunAngularDiameterCos + 0.00002, cosTheta );
        L0 += ( vSunE * 19000.0 * Fex ) * sundisk;

        vec3 texColor = ( Lin + L0 ) * 0.04 + vec3( 0.0, 0.0003, 0.00075 );

        vec3 retColor = pow( texColor, vec3( 1.0 / ( 1.2 + ( 1.2 * vSunfade ) ) ) );

        gl_FragColor = vec4( retColor, 1.0 );

      #include <tonemapping_fragment>
      #include <${TA>=154?"colorspace_fragment":"encodings_fragment"}>

      }
    `},e=new Mi({name:"SkyShader",fragmentShader:i.fragmentShader,vertexShader:i.vertexShader,uniforms:rp.clone(i.uniforms),side:ys,depthWrite:!1});class t extends It{constructor(){super(new ya(1,1,1),e)}}return v9(t,"SkyShader",i),v9(t,"material",e),t})(),Mle=i=>i&&i.isCubeTexture;class Rle extends It{constructor(e,t){var n,r;const s=Mle(e),a=((r=s?(n=e.image[0])==null?void 0:n.width:e.image.width)!=null?r:1024)/4,l=Math.floor(Math.log2(a)),c=Math.pow(2,l),u=3*Math.max(c,112),h=4*c,f=[s?"#define ENVMAP_TYPE_CUBE":"",`#define CUBEUV_TEXEL_WIDTH ${1/u}`,`#define CUBEUV_TEXEL_HEIGHT ${1/h}`,`#define CUBEUV_MAX_MIP ${l}.0`],d=`
        varying vec3 vWorldPosition;
        void main() 
        {
            vec4 worldPosition = ( modelMatrix * vec4( position, 1.0 ) );
            vWorldPosition = worldPosition.xyz;
            
            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        }
        `,m=f.join(`
`)+`
        #define ENVMAP_TYPE_CUBE_UV
        varying vec3 vWorldPosition;
        uniform float radius;
        uniform float height;
        uniform float angle;
        #ifdef ENVMAP_TYPE_CUBE
            uniform samplerCube map;
        #else
            uniform sampler2D map;
        #endif
        // From: https://www.shadertoy.com/view/4tsBD7
        float diskIntersectWithBackFaceCulling( vec3 ro, vec3 rd, vec3 c, vec3 n, float r ) 
        {
            float d = dot ( rd, n );
            
            if( d > 0.0 ) { return 1e6; }
            
            vec3  o = ro - c;
            float t = - dot( n, o ) / d;
            vec3  q = o + rd * t;
            
            return ( dot( q, q ) < r * r ) ? t : 1e6;
        }
        // From: https://www.iquilezles.org/www/articles/intersectors/intersectors.htm
        float sphereIntersect( vec3 ro, vec3 rd, vec3 ce, float ra ) 
        {
            vec3 oc = ro - ce;
            float b = dot( oc, rd );
            float c = dot( oc, oc ) - ra * ra;
            float h = b * b - c;
            
            if( h < 0.0 ) { return -1.0; }
            
            h = sqrt( h );
            
            return - b + h;
        }
        vec3 project() 
        {
            vec3 p = normalize( vWorldPosition );
            vec3 camPos = cameraPosition;
            camPos.y -= height;
            float intersection = sphereIntersect( camPos, p, vec3( 0.0 ), radius );
            if( intersection > 0.0 ) {
                
                vec3 h = vec3( 0.0, - height, 0.0 );
                float intersection2 = diskIntersectWithBackFaceCulling( camPos, p, h, vec3( 0.0, 1.0, 0.0 ), radius );
                p = ( camPos + min( intersection, intersection2 ) * p ) / radius;
            } else {
                p = vec3( 0.0, 1.0, 0.0 );
            }
            return p;
        }
        #include <common>
        #include <cube_uv_reflection_fragment>
        void main() 
        {
            vec3 projectedWorldPosition = project();
            
            #ifdef ENVMAP_TYPE_CUBE
                vec3 outcolor = textureCube( map, projectedWorldPosition ).rgb;
            #else
                vec3 direction = normalize( projectedWorldPosition );
                vec2 uv = equirectUv( direction );
                vec3 outcolor = texture2D( map, uv ).rgb;
            #endif
            gl_FragColor = vec4( outcolor, 1.0 );
            #include <tonemapping_fragment>
            #include <${TA>=154?"colorspace_fragment":"encodings_fragment"}>
        }
        `,A={map:{value:e},height:{value:(t==null?void 0:t.height)||15},radius:{value:(t==null?void 0:t.radius)||100}},g=new hx(1,16),y=new Mi({uniforms:A,fragmentShader:m,vertexShader:d,side:Pi});super(g,y)}set radius(e){this.material.uniforms.radius.value=e}get radius(){return this.material.uniforms.radius.value}set height(e){this.material.uniforms.height.value=e}get height(){return this.material.uniforms.height.value}}function sH(i,e,t={}){const n=new H,r=new Xt,s=new H,o=new Xe,a=new Xe,l=new Xe;t.preserveMatrix=t.preserveMatrix!==void 0?t.preserveMatrix:!0,t.preservePosition=t.preservePosition!==void 0?t.preservePosition:!0,t.preserveHipPosition=t.preserveHipPosition!==void 0?t.preserveHipPosition:!1,t.useTargetMatrix=t.useTargetMatrix!==void 0?t.useTargetMatrix:!1,t.hip=t.hip!==void 0?t.hip:"hip",t.names=t.names||{};const c=e.isObject3D?e.skeleton.bones:US(e),u=i.isObject3D?i.skeleton.bones:US(i);let h,f,d,m,A;if(i.isObject3D?i.skeleton.pose():(t.useTargetMatrix=!0,t.preserveMatrix=!1),t.preservePosition){A=[];for(let g=0;g<u.length;g++)A.push(u[g].position.clone())}if(t.preserveMatrix){i.updateMatrixWorld(),i.matrixWorld.identity();for(let g=0;g<i.children.length;++g)i.children[g].updateMatrixWorld(!0)}if(t.offsets){h=[];for(let g=0;g<u.length;++g)f=u[g],d=t.names[f.name]||f.name,t.offsets[d]&&(f.matrix.multiply(t.offsets[d]),f.matrix.decompose(f.position,f.quaternion,f.scale),f.updateMatrixWorld()),h.push(f.matrixWorld.clone())}for(let g=0;g<u.length;++g){if(f=u[g],d=t.names[f.name]||f.name,m=oH(d,c),l.copy(f.matrixWorld),m){if(m.updateMatrixWorld(),t.useTargetMatrix?a.copy(m.matrixWorld):(a.copy(i.matrixWorld).invert(),a.multiply(m.matrixWorld)),s.setFromMatrixScale(a),a.scale(s.set(1/s.x,1/s.y,1/s.z)),l.makeRotationFromQuaternion(r.setFromRotationMatrix(a)),i.isObject3D){const y=u.indexOf(f),E=h?h[y]:o.copy(i.skeleton.boneInverses[y]).invert();l.multiply(E)}l.copyPosition(a)}f.parent&&f.parent.isBone?(f.matrix.copy(f.parent.matrixWorld).invert(),f.matrix.multiply(l)):f.matrix.copy(l),t.preserveHipPosition&&d===t.hip&&f.matrix.setPosition(n.set(0,f.position.y,0)),f.matrix.decompose(f.position,f.quaternion,f.scale),f.updateMatrixWorld()}if(t.preservePosition)for(let g=0;g<u.length;++g)f=u[g],d=t.names[f.name]||f.name,d!==t.hip&&f.position.copy(A[g]);t.preserveMatrix&&i.updateMatrixWorld(!0)}function Lle(i,e,t,n={}){n.useFirstFramePosition=n.useFirstFramePosition!==void 0?n.useFirstFramePosition:!1,n.fps=n.fps!==void 0?n.fps:30,n.names=n.names||[],e.isObject3D||(e=Ble(e));const r=Math.round(t.duration*(n.fps/1e3)*1e3),s=1/n.fps,o=[],a=new Y6(e),l=US(i.skeleton),c=[];let u,h,f,d,m;a.clipAction(t).play(),a.update(0),e.updateMatrixWorld();for(let A=0;A<r;++A){const g=A*s;sH(i,e,n);for(let y=0;y<l.length;++y)m=n.names[l[y].name]||l[y].name,f=oH(m,e.skeleton),f&&(h=l[y],d=c[y]=c[y]||{bone:h},n.hip===m&&(d.pos||(d.pos={times:new Float32Array(r),values:new Float32Array(r*3)}),n.useFirstFramePosition&&(A===0&&(u=h.position.clone()),h.position.sub(u)),d.pos.times[A]=g,h.position.toArray(d.pos.values,A*3)),d.quat||(d.quat={times:new Float32Array(r),values:new Float32Array(r*4)}),d.quat.times[A]=g,h.quaternion.toArray(d.quat.values,A*4));a.update(s),e.updateMatrixWorld()}for(let A=0;A<c.length;++A)d=c[A],d&&(d.pos&&o.push(new Of(".bones["+d.bone.name+"].position",d.pos.times,d.pos.values)),o.push(new vh(".bones["+d.bone.name+"].quaternion",d.quat.times,d.quat.values)));return a.uncacheAction(t),new op(t.name,-1,o)}function Ple(i){const e=new Map,t=new Map,n=i.clone();return aH(i,n,function(r,s){e.set(s,r),t.set(r,s)}),n.traverse(function(r){if(!r.isSkinnedMesh)return;const s=r,o=e.get(r),a=o.skeleton.bones;s.skeleton=o.skeleton.clone(),s.bindMatrix.copy(o.bindMatrix),s.skeleton.bones=a.map(function(l){return t.get(l)}),s.bind(s.skeleton,s.bindMatrix)}),n}function oH(i,e){for(let t=0,n=US(e);t<n.length;t++)if(i===n[t].name)return n[t]}function US(i){return Array.isArray(i)?i:i.bones}function Ble(i){const e=new wz(i.bones[0]);return e.skeleton=i,e}function aH(i,e,t){t(i,e);for(let n=0;n<i.children.length;n++)aH(i.children[n],e.children[n],t)}const Dle={retarget:sH,retargetClip:Lle,clone:Ple},Lo=new ks,I3=new H;class kle{constructor(e){let t=e.geometry;t.index&&(console.warn("THREE.MeshSurfaceSampler: Converting geometry to non-indexed BufferGeometry."),t=t.toNonIndexed()),this.geometry=t,this.randomFunction=Math.random,this.positionAttribute=this.geometry.getAttribute("position"),this.colorAttribute=this.geometry.getAttribute("color"),this.weightAttribute=null,this.distribution=null}setWeightAttribute(e){return this.weightAttribute=e?this.geometry.getAttribute(e):null,this}build(){const e=this.positionAttribute,t=this.weightAttribute,n=new Float32Array(e.count/3);for(let s=0;s<e.count;s+=3){let o=1;t&&(o=t.getX(s)+t.getX(s+1)+t.getX(s+2)),Lo.a.fromBufferAttribute(e,s),Lo.b.fromBufferAttribute(e,s+1),Lo.c.fromBufferAttribute(e,s+2),o*=Lo.getArea(),n[s/3]=o}this.distribution=new Float32Array(e.count/3);let r=0;for(let s=0;s<n.length;s++)r+=n[s],this.distribution[s]=r;return this}setRandomGenerator(e){return this.randomFunction=e,this}sample(e,t,n){const r=this.sampleFaceIndex();return this.sampleFace(r,e,t,n)}sampleFaceIndex(){const e=this.distribution[this.distribution.length-1];return this.binarySearch(this.randomFunction()*e)}binarySearch(e){const t=this.distribution;let n=0,r=t.length-1,s=-1;for(;n<=r;){const o=Math.ceil((n+r)/2);if(o===0||t[o-1]<=e&&t[o]>e){s=o;break}else e<t[o]?r=o-1:n=o+1}return s}sampleFace(e,t,n,r){let s=this.randomFunction(),o=this.randomFunction();return s+o>1&&(s=1-s,o=1-o),Lo.a.fromBufferAttribute(this.positionAttribute,e*3),Lo.b.fromBufferAttribute(this.positionAttribute,e*3+1),Lo.c.fromBufferAttribute(this.positionAttribute,e*3+2),t.set(0,0,0).addScaledVector(Lo.a,s).addScaledVector(Lo.b,o).addScaledVector(Lo.c,1-(s+o)),n!==void 0&&Lo.getNormal(n),r!==void 0&&this.colorAttribute!==void 0&&(Lo.a.fromBufferAttribute(this.colorAttribute,e*3),Lo.b.fromBufferAttribute(this.colorAttribute,e*3+1),Lo.c.fromBufferAttribute(this.colorAttribute,e*3+2),I3.set(0,0,0).addScaledVector(Lo.a,s).addScaledVector(Lo.b,o).addScaledVector(Lo.c,1-(s+o)),r.r=I3.x,r.g=I3.y,r.b=I3.z),this}}var Fle=Object.defineProperty,Ole=(i,e,t)=>e in i?Fle(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Nle=(i,e,t)=>(Ole(i,e+"",t),t);let v0=class{constructor(){Nle(this,"_listeners")}addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const n=this._listeners;n[e]===void 0&&(n[e]=[]),n[e].indexOf(t)===-1&&n[e].push(t)}hasEventListener(e,t){if(this._listeners===void 0)return!1;const n=this._listeners;return n[e]!==void 0&&n[e].indexOf(t)!==-1}removeEventListener(e,t){if(this._listeners===void 0)return;const r=this._listeners[e];if(r!==void 0){const s=r.indexOf(t);s!==-1&&r.splice(s,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const n=this._listeners[e.type];if(n!==void 0){e.target=this;const r=n.slice(0);for(let s=0,o=r.length;s<o;s++)r[s].call(this,e);e.target=null}}};var Ule=Object.defineProperty,zle=(i,e,t)=>e in i?Ule(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,$n=(i,e,t)=>(zle(i,typeof e!="symbol"?e+"":e,t),t);const x9=new H;let Gle=class extends v0{constructor(e,t){super(),$n(this,"object"),$n(this,"domElement"),$n(this,"enabled",!0),$n(this,"movementSpeed",1),$n(this,"lookSpeed",.005),$n(this,"lookVertical",!0),$n(this,"autoForward",!1),$n(this,"activeLook",!0),$n(this,"heightSpeed",!1),$n(this,"heightCoef",1),$n(this,"heightMin",0),$n(this,"heightMax",1),$n(this,"constrainVertical",!1),$n(this,"verticalMin",0),$n(this,"verticalMax",Math.PI),$n(this,"mouseDragOn",!1),$n(this,"autoSpeedFactor",0),$n(this,"mouseX",0),$n(this,"mouseY",0),$n(this,"moveForward",!1),$n(this,"moveBackward",!1),$n(this,"moveLeft",!1),$n(this,"moveRight",!1),$n(this,"moveUp",!1),$n(this,"moveDown",!1),$n(this,"viewHalfX",0),$n(this,"viewHalfY",0),$n(this,"lat",0),$n(this,"lon",0),$n(this,"lookDirection",new H),$n(this,"spherical",new e0),$n(this,"target",new H),$n(this,"connect",n=>{n.setAttribute("tabindex","-1"),n.style.touchAction="none",n.addEventListener("contextmenu",this.contextmenu),n.addEventListener("mousemove",this.onMouseMove),n.addEventListener("mousedown",this.onMouseDown),n.addEventListener("mouseup",this.onMouseUp),this.domElement=n,window.addEventListener("keydown",this.onKeyDown),window.addEventListener("keyup",this.onKeyUp),this.handleResize()}),$n(this,"dispose",()=>{var n,r,s,o;(n=this.domElement)==null||n.removeEventListener("contextmenu",this.contextmenu),(r=this.domElement)==null||r.removeEventListener("mousedown",this.onMouseDown),(s=this.domElement)==null||s.removeEventListener("mousemove",this.onMouseMove),(o=this.domElement)==null||o.removeEventListener("mouseup",this.onMouseUp),window.removeEventListener("keydown",this.onKeyDown),window.removeEventListener("keyup",this.onKeyUp)}),$n(this,"handleResize",()=>{this.domElement&&(this.viewHalfX=this.domElement.offsetWidth/2,this.viewHalfY=this.domElement.offsetHeight/2)}),$n(this,"onMouseDown",n=>{var r;if((r=this.domElement)==null||r.focus(),this.activeLook)switch(n.button){case 0:this.moveForward=!0;break;case 2:this.moveBackward=!0;break}this.mouseDragOn=!0}),$n(this,"onMouseUp",n=>{if(this.activeLook)switch(n.button){case 0:this.moveForward=!1;break;case 2:this.moveBackward=!1;break}this.mouseDragOn=!1}),$n(this,"onMouseMove",n=>{this.domElement&&(this.mouseX=n.pageX-this.domElement.offsetLeft-this.viewHalfX,this.mouseY=n.pageY-this.domElement.offsetTop-this.viewHalfY)}),$n(this,"onKeyDown",n=>{switch(n.code){case"ArrowUp":case"KeyW":this.moveForward=!0;break;case"ArrowLeft":case"KeyA":this.moveLeft=!0;break;case"ArrowDown":case"KeyS":this.moveBackward=!0;break;case"ArrowRight":case"KeyD":this.moveRight=!0;break;case"KeyR":this.moveUp=!0;break;case"KeyF":this.moveDown=!0;break}}),$n(this,"onKeyUp",n=>{switch(n.code){case"ArrowUp":case"KeyW":this.moveForward=!1;break;case"ArrowLeft":case"KeyA":this.moveLeft=!1;break;case"ArrowDown":case"KeyS":this.moveBackward=!1;break;case"ArrowRight":case"KeyD":this.moveRight=!1;break;case"KeyR":this.moveUp=!1;break;case"KeyF":this.moveDown=!1;break}}),$n(this,"lookAt",(n,r,s)=>(n instanceof H?this.target.copy(n):r&&s&&this.target.set(n,r,s),this.object.lookAt(this.target),this.setOrientation(),this)),$n(this,"update",n=>{if(!this.enabled)return;if(this.heightSpeed){const h=un.clamp(this.object.position.y,this.heightMin,this.heightMax)-this.heightMin;this.autoSpeedFactor=n*(h*this.heightCoef)}else this.autoSpeedFactor=0;const r=n*this.movementSpeed;(this.moveForward||this.autoForward&&!this.moveBackward)&&this.object.translateZ(-(r+this.autoSpeedFactor)),this.moveBackward&&this.object.translateZ(r),this.moveLeft&&this.object.translateX(-r),this.moveRight&&this.object.translateX(r),this.moveUp&&this.object.translateY(r),this.moveDown&&this.object.translateY(-r);let s=n*this.lookSpeed;this.activeLook||(s=0);let o=1;this.constrainVertical&&(o=Math.PI/(this.verticalMax-this.verticalMin)),this.lon-=this.mouseX*s,this.lookVertical&&(this.lat-=this.mouseY*s*o),this.lat=Math.max(-85,Math.min(85,this.lat));let a=un.degToRad(90-this.lat);const l=un.degToRad(this.lon);this.constrainVertical&&(a=un.mapLinear(a,0,Math.PI,this.verticalMin,this.verticalMax));const c=this.object.position;x9.setFromSphericalCoords(1,a,l).add(c),this.object.lookAt(x9)}),$n(this,"contextmenu",n=>n.preventDefault()),$n(this,"setOrientation",()=>{this.lookDirection.set(0,0,-1).applyQuaternion(this.object.quaternion),this.spherical.setFromVector3(this.lookDirection),this.lat=90-un.radToDeg(this.spherical.phi),this.lon=un.radToDeg(this.spherical.theta)}),this.object=e,this.domElement=t,this.setOrientation(),t&&this.connect(t)}};var Hle=Object.defineProperty,Qle=(i,e,t)=>e in i?Hle(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,dt=(i,e,t)=>(Qle(i,typeof e!="symbol"?e+"":e,t),t);let Vle=class extends _n{constructor(e,t){super(),dt(this,"isTransformControls",!0),dt(this,"visible",!1),dt(this,"domElement"),dt(this,"raycaster",new A0),dt(this,"gizmo"),dt(this,"plane"),dt(this,"tempVector",new H),dt(this,"tempVector2",new H),dt(this,"tempQuaternion",new Xt),dt(this,"unit",{X:new H(1,0,0),Y:new H(0,1,0),Z:new H(0,0,1)}),dt(this,"pointStart",new H),dt(this,"pointEnd",new H),dt(this,"offset",new H),dt(this,"rotationAxis",new H),dt(this,"startNorm",new H),dt(this,"endNorm",new H),dt(this,"rotationAngle",0),dt(this,"cameraPosition",new H),dt(this,"cameraQuaternion",new Xt),dt(this,"cameraScale",new H),dt(this,"parentPosition",new H),dt(this,"parentQuaternion",new Xt),dt(this,"parentQuaternionInv",new Xt),dt(this,"parentScale",new H),dt(this,"worldPositionStart",new H),dt(this,"worldQuaternionStart",new Xt),dt(this,"worldScaleStart",new H),dt(this,"worldPosition",new H),dt(this,"worldQuaternion",new Xt),dt(this,"worldQuaternionInv",new Xt),dt(this,"worldScale",new H),dt(this,"eye",new H),dt(this,"positionStart",new H),dt(this,"quaternionStart",new Xt),dt(this,"scaleStart",new H),dt(this,"camera"),dt(this,"object"),dt(this,"enabled",!0),dt(this,"axis",null),dt(this,"mode","translate"),dt(this,"translationSnap",null),dt(this,"rotationSnap",null),dt(this,"scaleSnap",null),dt(this,"space","world"),dt(this,"size",1),dt(this,"dragging",!1),dt(this,"showX",!0),dt(this,"showY",!0),dt(this,"showZ",!0),dt(this,"changeEvent",{type:"change"}),dt(this,"mouseDownEvent",{type:"mouseDown",mode:this.mode}),dt(this,"mouseUpEvent",{type:"mouseUp",mode:this.mode}),dt(this,"objectChangeEvent",{type:"objectChange"}),dt(this,"intersectObjectWithRay",(r,s,o)=>{const a=s.intersectObject(r,!0);for(let l=0;l<a.length;l++)if(a[l].object.visible||o)return a[l];return!1}),dt(this,"attach",r=>(this.object=r,this.visible=!0,this)),dt(this,"detach",()=>(this.object=void 0,this.visible=!1,this.axis=null,this)),dt(this,"reset",()=>this.enabled?(this.dragging&&this.object!==void 0&&(this.object.position.copy(this.positionStart),this.object.quaternion.copy(this.quaternionStart),this.object.scale.copy(this.scaleStart),this.dispatchEvent(this.changeEvent),this.dispatchEvent(this.objectChangeEvent),this.pointStart.copy(this.pointEnd)),this):this),dt(this,"updateMatrixWorld",()=>{this.object!==void 0&&(this.object.updateMatrixWorld(),this.object.parent===null?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):this.object.parent.matrixWorld.decompose(this.parentPosition,this.parentQuaternion,this.parentScale),this.object.matrixWorld.decompose(this.worldPosition,this.worldQuaternion,this.worldScale),this.parentQuaternionInv.copy(this.parentQuaternion).invert(),this.worldQuaternionInv.copy(this.worldQuaternion).invert()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(this.cameraPosition,this.cameraQuaternion,this.cameraScale),this.eye.copy(this.cameraPosition).sub(this.worldPosition).normalize(),super.updateMatrixWorld()}),dt(this,"pointerHover",r=>{if(this.object===void 0||this.dragging===!0)return;this.raycaster.setFromCamera(r,this.camera);const s=this.intersectObjectWithRay(this.gizmo.picker[this.mode],this.raycaster);s?this.axis=s.object.name:this.axis=null}),dt(this,"pointerDown",r=>{if(!(this.object===void 0||this.dragging===!0||r.button!==0)&&this.axis!==null){this.raycaster.setFromCamera(r,this.camera);const s=this.intersectObjectWithRay(this.plane,this.raycaster,!0);if(s){let o=this.space;if(this.mode==="scale"?o="local":(this.axis==="E"||this.axis==="XYZE"||this.axis==="XYZ")&&(o="world"),o==="local"&&this.mode==="rotate"){const a=this.rotationSnap;this.axis==="X"&&a&&(this.object.rotation.x=Math.round(this.object.rotation.x/a)*a),this.axis==="Y"&&a&&(this.object.rotation.y=Math.round(this.object.rotation.y/a)*a),this.axis==="Z"&&a&&(this.object.rotation.z=Math.round(this.object.rotation.z/a)*a)}this.object.updateMatrixWorld(),this.object.parent&&this.object.parent.updateMatrixWorld(),this.positionStart.copy(this.object.position),this.quaternionStart.copy(this.object.quaternion),this.scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this.worldScaleStart),this.pointStart.copy(s.point).sub(this.worldPositionStart)}this.dragging=!0,this.mouseDownEvent.mode=this.mode,this.dispatchEvent(this.mouseDownEvent)}}),dt(this,"pointerMove",r=>{const s=this.axis,o=this.mode,a=this.object;let l=this.space;if(o==="scale"?l="local":(s==="E"||s==="XYZE"||s==="XYZ")&&(l="world"),a===void 0||s===null||this.dragging===!1||r.button!==-1)return;this.raycaster.setFromCamera(r,this.camera);const c=this.intersectObjectWithRay(this.plane,this.raycaster,!0);if(c){if(this.pointEnd.copy(c.point).sub(this.worldPositionStart),o==="translate")this.offset.copy(this.pointEnd).sub(this.pointStart),l==="local"&&s!=="XYZ"&&this.offset.applyQuaternion(this.worldQuaternionInv),s.indexOf("X")===-1&&(this.offset.x=0),s.indexOf("Y")===-1&&(this.offset.y=0),s.indexOf("Z")===-1&&(this.offset.z=0),l==="local"&&s!=="XYZ"?this.offset.applyQuaternion(this.quaternionStart).divide(this.parentScale):this.offset.applyQuaternion(this.parentQuaternionInv).divide(this.parentScale),a.position.copy(this.offset).add(this.positionStart),this.translationSnap&&(l==="local"&&(a.position.applyQuaternion(this.tempQuaternion.copy(this.quaternionStart).invert()),s.search("X")!==-1&&(a.position.x=Math.round(a.position.x/this.translationSnap)*this.translationSnap),s.search("Y")!==-1&&(a.position.y=Math.round(a.position.y/this.translationSnap)*this.translationSnap),s.search("Z")!==-1&&(a.position.z=Math.round(a.position.z/this.translationSnap)*this.translationSnap),a.position.applyQuaternion(this.quaternionStart)),l==="world"&&(a.parent&&a.position.add(this.tempVector.setFromMatrixPosition(a.parent.matrixWorld)),s.search("X")!==-1&&(a.position.x=Math.round(a.position.x/this.translationSnap)*this.translationSnap),s.search("Y")!==-1&&(a.position.y=Math.round(a.position.y/this.translationSnap)*this.translationSnap),s.search("Z")!==-1&&(a.position.z=Math.round(a.position.z/this.translationSnap)*this.translationSnap),a.parent&&a.position.sub(this.tempVector.setFromMatrixPosition(a.parent.matrixWorld))));else if(o==="scale"){if(s.search("XYZ")!==-1){let u=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(u*=-1),this.tempVector2.set(u,u,u)}else this.tempVector.copy(this.pointStart),this.tempVector2.copy(this.pointEnd),this.tempVector.applyQuaternion(this.worldQuaternionInv),this.tempVector2.applyQuaternion(this.worldQuaternionInv),this.tempVector2.divide(this.tempVector),s.search("X")===-1&&(this.tempVector2.x=1),s.search("Y")===-1&&(this.tempVector2.y=1),s.search("Z")===-1&&(this.tempVector2.z=1);a.scale.copy(this.scaleStart).multiply(this.tempVector2),this.scaleSnap&&this.object&&(s.search("X")!==-1&&(this.object.scale.x=Math.round(a.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),s.search("Y")!==-1&&(a.scale.y=Math.round(a.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),s.search("Z")!==-1&&(a.scale.z=Math.round(a.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if(o==="rotate"){this.offset.copy(this.pointEnd).sub(this.pointStart);const u=20/this.worldPosition.distanceTo(this.tempVector.setFromMatrixPosition(this.camera.matrixWorld));s==="E"?(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this.startNorm.copy(this.pointStart).normalize(),this.endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this.endNorm.cross(this.startNorm).dot(this.eye)<0?1:-1):s==="XYZE"?(this.rotationAxis.copy(this.offset).cross(this.eye).normalize(),this.rotationAngle=this.offset.dot(this.tempVector.copy(this.rotationAxis).cross(this.eye))*u):(s==="X"||s==="Y"||s==="Z")&&(this.rotationAxis.copy(this.unit[s]),this.tempVector.copy(this.unit[s]),l==="local"&&this.tempVector.applyQuaternion(this.worldQuaternion),this.rotationAngle=this.offset.dot(this.tempVector.cross(this.eye).normalize())*u),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),l==="local"&&s!=="E"&&s!=="XYZE"?(a.quaternion.copy(this.quaternionStart),a.quaternion.multiply(this.tempQuaternion.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this.parentQuaternionInv),a.quaternion.copy(this.tempQuaternion.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),a.quaternion.multiply(this.quaternionStart).normalize())}this.dispatchEvent(this.changeEvent),this.dispatchEvent(this.objectChangeEvent)}}),dt(this,"pointerUp",r=>{r.button===0&&(this.dragging&&this.axis!==null&&(this.mouseUpEvent.mode=this.mode,this.dispatchEvent(this.mouseUpEvent)),this.dragging=!1,this.axis=null)}),dt(this,"getPointer",r=>{var s;if(this.domElement&&((s=this.domElement.ownerDocument)!=null&&s.pointerLockElement))return{x:0,y:0,button:r.button};{const o=r.changedTouches?r.changedTouches[0]:r,a=this.domElement.getBoundingClientRect();return{x:(o.clientX-a.left)/a.width*2-1,y:-(o.clientY-a.top)/a.height*2+1,button:r.button}}}),dt(this,"onPointerHover",r=>{if(this.enabled)switch(r.pointerType){case"mouse":case"pen":this.pointerHover(this.getPointer(r));break}}),dt(this,"onPointerDown",r=>{!this.enabled||!this.domElement||(this.domElement.style.touchAction="none",this.domElement.ownerDocument.addEventListener("pointermove",this.onPointerMove),this.pointerHover(this.getPointer(r)),this.pointerDown(this.getPointer(r)))}),dt(this,"onPointerMove",r=>{this.enabled&&this.pointerMove(this.getPointer(r))}),dt(this,"onPointerUp",r=>{!this.enabled||!this.domElement||(this.domElement.style.touchAction="",this.domElement.ownerDocument.removeEventListener("pointermove",this.onPointerMove),this.pointerUp(this.getPointer(r)))}),dt(this,"getMode",()=>this.mode),dt(this,"setMode",r=>{this.mode=r}),dt(this,"setTranslationSnap",r=>{this.translationSnap=r}),dt(this,"setRotationSnap",r=>{this.rotationSnap=r}),dt(this,"setScaleSnap",r=>{this.scaleSnap=r}),dt(this,"setSize",r=>{this.size=r}),dt(this,"setSpace",r=>{this.space=r}),dt(this,"update",()=>{console.warn("THREE.TransformControls: update function has no more functionality and therefore has been deprecated.")}),dt(this,"connect",r=>{r===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.domElement=r,this.domElement.addEventListener("pointerdown",this.onPointerDown),this.domElement.addEventListener("pointermove",this.onPointerHover),this.domElement.ownerDocument.addEventListener("pointerup",this.onPointerUp)}),dt(this,"dispose",()=>{var r,s,o,a,l,c;(r=this.domElement)==null||r.removeEventListener("pointerdown",this.onPointerDown),(s=this.domElement)==null||s.removeEventListener("pointermove",this.onPointerHover),(a=(o=this.domElement)==null?void 0:o.ownerDocument)==null||a.removeEventListener("pointermove",this.onPointerMove),(c=(l=this.domElement)==null?void 0:l.ownerDocument)==null||c.removeEventListener("pointerup",this.onPointerUp),this.traverse(u=>{const h=u;h.geometry&&h.geometry.dispose(),h.material&&h.material.dispose()})}),this.domElement=t,this.camera=e,this.gizmo=new Wle,this.add(this.gizmo),this.plane=new jle,this.add(this.plane);const n=(r,s)=>{let o=s;Object.defineProperty(this,r,{get:function(){return o!==void 0?o:s},set:function(a){o!==a&&(o=a,this.plane[r]=a,this.gizmo[r]=a,this.dispatchEvent({type:r+"-changed",value:a}),this.dispatchEvent(this.changeEvent))}}),this[r]=s,this.plane[r]=s,this.gizmo[r]=s};n("camera",this.camera),n("object",this.object),n("enabled",this.enabled),n("axis",this.axis),n("mode",this.mode),n("translationSnap",this.translationSnap),n("rotationSnap",this.rotationSnap),n("scaleSnap",this.scaleSnap),n("space",this.space),n("size",this.size),n("dragging",this.dragging),n("showX",this.showX),n("showY",this.showY),n("showZ",this.showZ),n("worldPosition",this.worldPosition),n("worldPositionStart",this.worldPositionStart),n("worldQuaternion",this.worldQuaternion),n("worldQuaternionStart",this.worldQuaternionStart),n("cameraPosition",this.cameraPosition),n("cameraQuaternion",this.cameraQuaternion),n("pointStart",this.pointStart),n("pointEnd",this.pointEnd),n("rotationAxis",this.rotationAxis),n("rotationAngle",this.rotationAngle),n("eye",this.eye),t!==void 0&&this.connect(t)}};class Wle extends _n{constructor(){super(),dt(this,"isTransformControlsGizmo",!0),dt(this,"type","TransformControlsGizmo"),dt(this,"tempVector",new H(0,0,0)),dt(this,"tempEuler",new Eo),dt(this,"alignVector",new H(0,1,0)),dt(this,"zeroVector",new H(0,0,0)),dt(this,"lookAtMatrix",new Xe),dt(this,"tempQuaternion",new Xt),dt(this,"tempQuaternion2",new Xt),dt(this,"identityQuaternion",new Xt),dt(this,"unitX",new H(1,0,0)),dt(this,"unitY",new H(0,1,0)),dt(this,"unitZ",new H(0,0,1)),dt(this,"gizmo"),dt(this,"picker"),dt(this,"helper"),dt(this,"rotationAxis",new H),dt(this,"cameraPosition",new H),dt(this,"worldPositionStart",new H),dt(this,"worldQuaternionStart",new Xt),dt(this,"worldPosition",new H),dt(this,"worldQuaternion",new Xt),dt(this,"eye",new H),dt(this,"camera",null),dt(this,"enabled",!0),dt(this,"axis",null),dt(this,"mode","translate"),dt(this,"space","world"),dt(this,"size",1),dt(this,"dragging",!1),dt(this,"showX",!0),dt(this,"showY",!0),dt(this,"showZ",!0),dt(this,"updateMatrixWorld",()=>{let Y=this.space;this.mode==="scale"&&(Y="local");const O=Y==="local"?this.worldQuaternion:this.identityQuaternion;this.gizmo.translate.visible=this.mode==="translate",this.gizmo.rotate.visible=this.mode==="rotate",this.gizmo.scale.visible=this.mode==="scale",this.helper.translate.visible=this.mode==="translate",this.helper.rotate.visible=this.mode==="rotate",this.helper.scale.visible=this.mode==="scale";let K=[];K=K.concat(this.picker[this.mode].children),K=K.concat(this.gizmo[this.mode].children),K=K.concat(this.helper[this.mode].children);for(let te=0;te<K.length;te++){const q=K[te];q.visible=!0,q.rotation.set(0,0,0),q.position.copy(this.worldPosition);let J;if(this.camera.isOrthographicCamera?J=(this.camera.top-this.camera.bottom)/this.camera.zoom:J=this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),q.scale.set(1,1,1).multiplyScalar(J*this.size/7),q.tag==="helper"){q.visible=!1,q.name==="AXIS"?(q.position.copy(this.worldPositionStart),q.visible=!!this.axis,this.axis==="X"&&(this.tempQuaternion.setFromEuler(this.tempEuler.set(0,0,0)),q.quaternion.copy(O).multiply(this.tempQuaternion),Math.abs(this.alignVector.copy(this.unitX).applyQuaternion(O).dot(this.eye))>.9&&(q.visible=!1)),this.axis==="Y"&&(this.tempQuaternion.setFromEuler(this.tempEuler.set(0,0,Math.PI/2)),q.quaternion.copy(O).multiply(this.tempQuaternion),Math.abs(this.alignVector.copy(this.unitY).applyQuaternion(O).dot(this.eye))>.9&&(q.visible=!1)),this.axis==="Z"&&(this.tempQuaternion.setFromEuler(this.tempEuler.set(0,Math.PI/2,0)),q.quaternion.copy(O).multiply(this.tempQuaternion),Math.abs(this.alignVector.copy(this.unitZ).applyQuaternion(O).dot(this.eye))>.9&&(q.visible=!1)),this.axis==="XYZE"&&(this.tempQuaternion.setFromEuler(this.tempEuler.set(0,Math.PI/2,0)),this.alignVector.copy(this.rotationAxis),q.quaternion.setFromRotationMatrix(this.lookAtMatrix.lookAt(this.zeroVector,this.alignVector,this.unitY)),q.quaternion.multiply(this.tempQuaternion),q.visible=this.dragging),this.axis==="E"&&(q.visible=!1)):q.name==="START"?(q.position.copy(this.worldPositionStart),q.visible=this.dragging):q.name==="END"?(q.position.copy(this.worldPosition),q.visible=this.dragging):q.name==="DELTA"?(q.position.copy(this.worldPositionStart),q.quaternion.copy(this.worldQuaternionStart),this.tempVector.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),this.tempVector.applyQuaternion(this.worldQuaternionStart.clone().invert()),q.scale.copy(this.tempVector),q.visible=this.dragging):(q.quaternion.copy(O),this.dragging?q.position.copy(this.worldPositionStart):q.position.copy(this.worldPosition),this.axis&&(q.visible=this.axis.search(q.name)!==-1));continue}q.quaternion.copy(O),this.mode==="translate"||this.mode==="scale"?((q.name==="X"||q.name==="XYZX")&&Math.abs(this.alignVector.copy(this.unitX).applyQuaternion(O).dot(this.eye))>.99&&(q.scale.set(1e-10,1e-10,1e-10),q.visible=!1),(q.name==="Y"||q.name==="XYZY")&&Math.abs(this.alignVector.copy(this.unitY).applyQuaternion(O).dot(this.eye))>.99&&(q.scale.set(1e-10,1e-10,1e-10),q.visible=!1),(q.name==="Z"||q.name==="XYZZ")&&Math.abs(this.alignVector.copy(this.unitZ).applyQuaternion(O).dot(this.eye))>.99&&(q.scale.set(1e-10,1e-10,1e-10),q.visible=!1),q.name==="XY"&&Math.abs(this.alignVector.copy(this.unitZ).applyQuaternion(O).dot(this.eye))<.2&&(q.scale.set(1e-10,1e-10,1e-10),q.visible=!1),q.name==="YZ"&&Math.abs(this.alignVector.copy(this.unitX).applyQuaternion(O).dot(this.eye))<.2&&(q.scale.set(1e-10,1e-10,1e-10),q.visible=!1),q.name==="XZ"&&Math.abs(this.alignVector.copy(this.unitY).applyQuaternion(O).dot(this.eye))<.2&&(q.scale.set(1e-10,1e-10,1e-10),q.visible=!1),q.name.search("X")!==-1&&(this.alignVector.copy(this.unitX).applyQuaternion(O).dot(this.eye)<0?q.tag==="fwd"?q.visible=!1:q.scale.x*=-1:q.tag==="bwd"&&(q.visible=!1)),q.name.search("Y")!==-1&&(this.alignVector.copy(this.unitY).applyQuaternion(O).dot(this.eye)<0?q.tag==="fwd"?q.visible=!1:q.scale.y*=-1:q.tag==="bwd"&&(q.visible=!1)),q.name.search("Z")!==-1&&(this.alignVector.copy(this.unitZ).applyQuaternion(O).dot(this.eye)<0?q.tag==="fwd"?q.visible=!1:q.scale.z*=-1:q.tag==="bwd"&&(q.visible=!1))):this.mode==="rotate"&&(this.tempQuaternion2.copy(O),this.alignVector.copy(this.eye).applyQuaternion(this.tempQuaternion.copy(O).invert()),q.name.search("E")!==-1&&q.quaternion.setFromRotationMatrix(this.lookAtMatrix.lookAt(this.eye,this.zeroVector,this.unitY)),q.name==="X"&&(this.tempQuaternion.setFromAxisAngle(this.unitX,Math.atan2(-this.alignVector.y,this.alignVector.z)),this.tempQuaternion.multiplyQuaternions(this.tempQuaternion2,this.tempQuaternion),q.quaternion.copy(this.tempQuaternion)),q.name==="Y"&&(this.tempQuaternion.setFromAxisAngle(this.unitY,Math.atan2(this.alignVector.x,this.alignVector.z)),this.tempQuaternion.multiplyQuaternions(this.tempQuaternion2,this.tempQuaternion),q.quaternion.copy(this.tempQuaternion)),q.name==="Z"&&(this.tempQuaternion.setFromAxisAngle(this.unitZ,Math.atan2(this.alignVector.y,this.alignVector.x)),this.tempQuaternion.multiplyQuaternions(this.tempQuaternion2,this.tempQuaternion),q.quaternion.copy(this.tempQuaternion))),q.visible=q.visible&&(q.name.indexOf("X")===-1||this.showX),q.visible=q.visible&&(q.name.indexOf("Y")===-1||this.showY),q.visible=q.visible&&(q.name.indexOf("Z")===-1||this.showZ),q.visible=q.visible&&(q.name.indexOf("E")===-1||this.showX&&this.showY&&this.showZ),q.material.tempOpacity=q.material.tempOpacity||q.material.opacity,q.material.tempColor=q.material.tempColor||q.material.color.clone(),q.material.color.copy(q.material.tempColor),q.material.opacity=q.material.tempOpacity,this.enabled?this.axis&&(q.name===this.axis?(q.material.opacity=1,q.material.color.lerp(new ut(1,1,1),.5)):this.axis.split("").some(function(ie){return q.name===ie})?(q.material.opacity=1,q.material.color.lerp(new ut(1,1,1),.5)):(q.material.opacity*=.25,q.material.color.lerp(new ut(1,1,1),.5))):(q.material.opacity*=.5,q.material.color.lerp(new ut(1,1,1),.5))}super.updateMatrixWorld()});const e=new no({depthTest:!1,depthWrite:!1,transparent:!0,side:Pi,fog:!1,toneMapped:!1}),t=new vs({depthTest:!1,depthWrite:!1,transparent:!0,linewidth:1,fog:!1,toneMapped:!1}),n=e.clone();n.opacity=.15;const r=e.clone();r.opacity=.33;const s=e.clone();s.color.set(16711680);const o=e.clone();o.color.set(65280);const a=e.clone();a.color.set(255);const l=e.clone();l.opacity=.25;const c=l.clone();c.color.set(16776960);const u=l.clone();u.color.set(65535);const h=l.clone();h.color.set(16711935),e.clone().color.set(16776960);const d=t.clone();d.color.set(16711680);const m=t.clone();m.color.set(65280);const A=t.clone();A.color.set(255);const g=t.clone();g.color.set(65535);const y=t.clone();y.color.set(16711935);const E=t.clone();E.color.set(16776960);const x=t.clone();x.color.set(7895160);const C=E.clone();C.opacity=.25;const T=new yo(0,.05,.2,12,1,!1),I=new ya(.125,.125,.125),M=new fn;M.setAttribute("position",new Gt([0,0,0,1,0,0],3));const L=(Y,O)=>{const K=new fn,te=[];for(let q=0;q<=64*O;++q)te.push(0,Math.cos(q/32*Math.PI)*Y,Math.sin(q/32*Math.PI)*Y);return K.setAttribute("position",new Gt(te,3)),K},R=()=>{const Y=new fn;return Y.setAttribute("position",new Gt([0,0,0,1,1,1],3)),Y},P={X:[[new It(T,s),[1,0,0],[0,0,-Math.PI/2],null,"fwd"],[new It(T,s),[1,0,0],[0,0,Math.PI/2],null,"bwd"],[new Yn(M,d)]],Y:[[new It(T,o),[0,1,0],null,null,"fwd"],[new It(T,o),[0,1,0],[Math.PI,0,0],null,"bwd"],[new Yn(M,m),null,[0,0,Math.PI/2]]],Z:[[new It(T,a),[0,0,1],[Math.PI/2,0,0],null,"fwd"],[new It(T,a),[0,0,1],[-Math.PI/2,0,0],null,"bwd"],[new Yn(M,A),null,[0,-Math.PI/2,0]]],XYZ:[[new It(new rc(.1,0),l.clone()),[0,0,0],[0,0,0]]],XY:[[new It(new Fs(.295,.295),c.clone()),[.15,.15,0]],[new Yn(M,E),[.18,.3,0],null,[.125,1,1]],[new Yn(M,E),[.3,.18,0],[0,0,Math.PI/2],[.125,1,1]]],YZ:[[new It(new Fs(.295,.295),u.clone()),[0,.15,.15],[0,Math.PI/2,0]],[new Yn(M,g),[0,.18,.3],[0,0,Math.PI/2],[.125,1,1]],[new Yn(M,g),[0,.3,.18],[0,-Math.PI/2,0],[.125,1,1]]],XZ:[[new It(new Fs(.295,.295),h.clone()),[.15,0,.15],[-Math.PI/2,0,0]],[new Yn(M,y),[.18,0,.3],null,[.125,1,1]],[new Yn(M,y),[.3,0,.18],[0,-Math.PI/2,0],[.125,1,1]]]},F={X:[[new It(new yo(.2,0,1,4,1,!1),n),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new It(new yo(.2,0,1,4,1,!1),n),[0,.6,0]]],Z:[[new It(new yo(.2,0,1,4,1,!1),n),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new It(new rc(.2,0),n)]],XY:[[new It(new Fs(.4,.4),n),[.2,.2,0]]],YZ:[[new It(new Fs(.4,.4),n),[0,.2,.2],[0,Math.PI/2,0]]],XZ:[[new It(new Fs(.4,.4),n),[.2,0,.2],[-Math.PI/2,0,0]]]},k={START:[[new It(new rc(.01,2),r),null,null,null,"helper"]],END:[[new It(new rc(.01,2),r),null,null,null,"helper"]],DELTA:[[new Yn(R(),r),null,null,null,"helper"]],X:[[new Yn(M,r.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new Yn(M,r.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new Yn(M,r.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},z={X:[[new Yn(L(1,.5),d)],[new It(new rc(.04,0),s),[0,0,.99],null,[1,3,1]]],Y:[[new Yn(L(1,.5),m),null,[0,0,-Math.PI/2]],[new It(new rc(.04,0),o),[0,0,.99],null,[3,1,1]]],Z:[[new Yn(L(1,.5),A),null,[0,Math.PI/2,0]],[new It(new rc(.04,0),a),[.99,0,0],null,[1,3,1]]],E:[[new Yn(L(1.25,1),C),null,[0,Math.PI/2,0]],[new It(new yo(.03,0,.15,4,1,!1),C),[1.17,0,0],[0,0,-Math.PI/2],[1,1,.001]],[new It(new yo(.03,0,.15,4,1,!1),C),[-1.17,0,0],[0,0,Math.PI/2],[1,1,.001]],[new It(new yo(.03,0,.15,4,1,!1),C),[0,-1.17,0],[Math.PI,0,0],[1,1,.001]],[new It(new yo(.03,0,.15,4,1,!1),C),[0,1.17,0],[0,0,0],[1,1,.001]]],XYZE:[[new Yn(L(1,1),x),null,[0,Math.PI/2,0]]]},U={AXIS:[[new Yn(M,r.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},W={X:[[new It(new Hd(1,.1,4,24),n),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new It(new Hd(1,.1,4,24),n),[0,0,0],[Math.PI/2,0,0]]],Z:[[new It(new Hd(1,.1,4,24),n),[0,0,0],[0,0,-Math.PI/2]]],E:[[new It(new Hd(1.25,.1,2,24),n)]],XYZE:[[new It(new d0(.7,10,8),n)]]},$={X:[[new It(I,s),[.8,0,0],[0,0,-Math.PI/2]],[new Yn(M,d),null,null,[.8,1,1]]],Y:[[new It(I,o),[0,.8,0]],[new Yn(M,m),null,[0,0,Math.PI/2],[.8,1,1]]],Z:[[new It(I,a),[0,0,.8],[Math.PI/2,0,0]],[new Yn(M,A),null,[0,-Math.PI/2,0],[.8,1,1]]],XY:[[new It(I,c),[.85,.85,0],null,[2,2,.2]],[new Yn(M,E),[.855,.98,0],null,[.125,1,1]],[new Yn(M,E),[.98,.855,0],[0,0,Math.PI/2],[.125,1,1]]],YZ:[[new It(I,u),[0,.85,.85],null,[.2,2,2]],[new Yn(M,g),[0,.855,.98],[0,0,Math.PI/2],[.125,1,1]],[new Yn(M,g),[0,.98,.855],[0,-Math.PI/2,0],[.125,1,1]]],XZ:[[new It(I,h),[.85,0,.85],null,[2,.2,2]],[new Yn(M,y),[.855,0,.98],null,[.125,1,1]],[new Yn(M,y),[.98,0,.855],[0,-Math.PI/2,0],[.125,1,1]]],XYZX:[[new It(new ya(.125,.125,.125),l.clone()),[1.1,0,0]]],XYZY:[[new It(new ya(.125,.125,.125),l.clone()),[0,1.1,0]]],XYZZ:[[new It(new ya(.125,.125,.125),l.clone()),[0,0,1.1]]]},oe={X:[[new It(new yo(.2,0,.8,4,1,!1),n),[.5,0,0],[0,0,-Math.PI/2]]],Y:[[new It(new yo(.2,0,.8,4,1,!1),n),[0,.5,0]]],Z:[[new It(new yo(.2,0,.8,4,1,!1),n),[0,0,.5],[Math.PI/2,0,0]]],XY:[[new It(I,n),[.85,.85,0],null,[3,3,.2]]],YZ:[[new It(I,n),[0,.85,.85],null,[.2,3,3]]],XZ:[[new It(I,n),[.85,0,.85],null,[3,.2,3]]],XYZX:[[new It(new ya(.2,.2,.2),n),[1.1,0,0]]],XYZY:[[new It(new ya(.2,.2,.2),n),[0,1.1,0]]],XYZZ:[[new It(new ya(.2,.2,.2),n),[0,0,1.1]]]},X={X:[[new Yn(M,r.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new Yn(M,r.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new Yn(M,r.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},Q=Y=>{const O=new _n;for(let K in Y)for(let te=Y[K].length;te--;){const q=Y[K][te][0].clone(),J=Y[K][te][1],ie=Y[K][te][2],re=Y[K][te][3],se=Y[K][te][4];q.name=K,q.tag=se,J&&q.position.set(J[0],J[1],J[2]),ie&&q.rotation.set(ie[0],ie[1],ie[2]),re&&q.scale.set(re[0],re[1],re[2]),q.updateMatrix();const ge=q.geometry.clone();ge.applyMatrix4(q.matrix),q.geometry=ge,q.renderOrder=1/0,q.position.set(0,0,0),q.rotation.set(0,0,0),q.scale.set(1,1,1),O.add(q)}return O};this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=Q(P)),this.add(this.gizmo.rotate=Q(z)),this.add(this.gizmo.scale=Q($)),this.add(this.picker.translate=Q(F)),this.add(this.picker.rotate=Q(W)),this.add(this.picker.scale=Q(oe)),this.add(this.helper.translate=Q(k)),this.add(this.helper.rotate=Q(U)),this.add(this.helper.scale=Q(X)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}}class jle extends It{constructor(){super(new Fs(1e5,1e5,2,2),new no({visible:!1,wireframe:!0,side:Pi,transparent:!0,opacity:.1,toneMapped:!1})),dt(this,"isTransformControlsPlane",!0),dt(this,"type","TransformControlsPlane"),dt(this,"unitX",new H(1,0,0)),dt(this,"unitY",new H(0,1,0)),dt(this,"unitZ",new H(0,0,1)),dt(this,"tempVector",new H),dt(this,"dirVector",new H),dt(this,"alignVector",new H),dt(this,"tempMatrix",new Xe),dt(this,"identityQuaternion",new Xt),dt(this,"cameraQuaternion",new Xt),dt(this,"worldPosition",new H),dt(this,"worldQuaternion",new Xt),dt(this,"eye",new H),dt(this,"axis",null),dt(this,"mode","translate"),dt(this,"space","world"),dt(this,"updateMatrixWorld",()=>{let e=this.space;switch(this.position.copy(this.worldPosition),this.mode==="scale"&&(e="local"),this.unitX.set(1,0,0).applyQuaternion(e==="local"?this.worldQuaternion:this.identityQuaternion),this.unitY.set(0,1,0).applyQuaternion(e==="local"?this.worldQuaternion:this.identityQuaternion),this.unitZ.set(0,0,1).applyQuaternion(e==="local"?this.worldQuaternion:this.identityQuaternion),this.alignVector.copy(this.unitY),this.mode){case"translate":case"scale":switch(this.axis){case"X":this.alignVector.copy(this.eye).cross(this.unitX),this.dirVector.copy(this.unitX).cross(this.alignVector);break;case"Y":this.alignVector.copy(this.eye).cross(this.unitY),this.dirVector.copy(this.unitY).cross(this.alignVector);break;case"Z":this.alignVector.copy(this.eye).cross(this.unitZ),this.dirVector.copy(this.unitZ).cross(this.alignVector);break;case"XY":this.dirVector.copy(this.unitZ);break;case"YZ":this.dirVector.copy(this.unitX);break;case"XZ":this.alignVector.copy(this.unitZ),this.dirVector.copy(this.unitY);break;case"XYZ":case"E":this.dirVector.set(0,0,0);break}break;case"rotate":default:this.dirVector.set(0,0,0)}this.dirVector.length()===0?this.quaternion.copy(this.cameraQuaternion):(this.tempMatrix.lookAt(this.tempVector.set(0,0,0),this.dirVector,this.alignVector),this.quaternion.setFromRotationMatrix(this.tempMatrix)),super.updateMatrixWorld()})}}var Kle=Object.defineProperty,$le=(i,e,t)=>e in i?Kle(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,$s=(i,e,t)=>($le(i,typeof e!="symbol"?e+"":e,t),t);const Og=new Eo(0,0,0,"YXZ"),Ng=new H,Yle={type:"change"},Xle={type:"lock"},qle={type:"unlock"},E9=.002,_9=Math.PI/2;let Jle=class extends v0{constructor(e,t){super(),$s(this,"camera"),$s(this,"domElement"),$s(this,"isLocked"),$s(this,"minPolarAngle"),$s(this,"maxPolarAngle"),$s(this,"pointerSpeed"),$s(this,"onMouseMove",n=>{!this.domElement||this.isLocked===!1||(Og.setFromQuaternion(this.camera.quaternion),Og.y-=n.movementX*E9*this.pointerSpeed,Og.x-=n.movementY*E9*this.pointerSpeed,Og.x=Math.max(_9-this.maxPolarAngle,Math.min(_9-this.minPolarAngle,Og.x)),this.camera.quaternion.setFromEuler(Og),this.dispatchEvent(Yle))}),$s(this,"onPointerlockChange",()=>{this.domElement&&(this.domElement.ownerDocument.pointerLockElement===this.domElement?(this.dispatchEvent(Xle),this.isLocked=!0):(this.dispatchEvent(qle),this.isLocked=!1))}),$s(this,"onPointerlockError",()=>{console.error("THREE.PointerLockControls: Unable to use Pointer Lock API")}),$s(this,"connect",n=>{this.domElement=n||this.domElement,this.domElement&&(this.domElement.ownerDocument.addEventListener("mousemove",this.onMouseMove),this.domElement.ownerDocument.addEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.addEventListener("pointerlockerror",this.onPointerlockError))}),$s(this,"disconnect",()=>{this.domElement&&(this.domElement.ownerDocument.removeEventListener("mousemove",this.onMouseMove),this.domElement.ownerDocument.removeEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.removeEventListener("pointerlockerror",this.onPointerlockError))}),$s(this,"dispose",()=>{this.disconnect()}),$s(this,"getObject",()=>this.camera),$s(this,"direction",new H(0,0,-1)),$s(this,"getDirection",n=>n.copy(this.direction).applyQuaternion(this.camera.quaternion)),$s(this,"moveForward",n=>{Ng.setFromMatrixColumn(this.camera.matrix,0),Ng.crossVectors(this.camera.up,Ng),this.camera.position.addScaledVector(Ng,n)}),$s(this,"moveRight",n=>{Ng.setFromMatrixColumn(this.camera.matrix,0),this.camera.position.addScaledVector(Ng,n)}),$s(this,"lock",()=>{this.domElement&&this.domElement.requestPointerLock()}),$s(this,"unlock",()=>{this.domElement&&this.domElement.ownerDocument.exitPointerLock()}),this.camera=e,this.domElement=t,this.isLocked=!1,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.pointerSpeed=1,t&&this.connect(t)}};var Zle=Object.defineProperty,ece=(i,e,t)=>e in i?Zle(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Ys=(i,e,t)=>(ece(i,typeof e!="symbol"?e+"":e,t),t);let tce=class extends v0{constructor(e){super(),Ys(this,"object"),Ys(this,"changeEvent",{type:"change"}),Ys(this,"EPS",1e-6),Ys(this,"enabled",!0),Ys(this,"deviceOrientation",{alpha:0,beta:0,gamma:0}),Ys(this,"screenOrientation",0),Ys(this,"alphaOffset",0),Ys(this,"onDeviceOrientationChangeEvent",t=>{this.deviceOrientation=t}),Ys(this,"onScreenOrientationChangeEvent",()=>{this.screenOrientation=window.orientation||0}),Ys(this,"zee",new H(0,0,1)),Ys(this,"euler",new Eo),Ys(this,"q0",new Xt),Ys(this,"q1",new Xt(-Math.sqrt(.5),0,0,Math.sqrt(.5))),Ys(this,"setObjectQuaternion",(t,n,r,s,o)=>{this.euler.set(r,n,-s,"YXZ"),t.setFromEuler(this.euler),t.multiply(this.q1),t.multiply(this.q0.setFromAxisAngle(this.zee,-o))}),Ys(this,"connect",()=>{this.onScreenOrientationChangeEvent(),window.DeviceOrientationEvent!==void 0&&typeof window.DeviceOrientationEvent.requestPermission=="function"?window.DeviceOrientationEvent.requestPermission().then(t=>{t=="granted"&&(window.addEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.addEventListener("deviceorientation",this.onDeviceOrientationChangeEvent))}).catch(t=>{console.error("THREE.DeviceOrientationControls: Unable to use DeviceOrientation API:",t)}):(window.addEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.addEventListener("deviceorientation",this.onDeviceOrientationChangeEvent)),this.enabled=!0}),Ys(this,"disconnect",()=>{window.removeEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.removeEventListener("deviceorientation",this.onDeviceOrientationChangeEvent),this.enabled=!1}),Ys(this,"lastQuaternion",new Xt),Ys(this,"update",()=>{if(this.enabled===!1)return;const t=this.deviceOrientation;if(t){const n=t.alpha?un.degToRad(t.alpha)+this.alphaOffset:0,r=t.beta?un.degToRad(t.beta):0,s=t.gamma?un.degToRad(t.gamma):0,o=this.screenOrientation?un.degToRad(this.screenOrientation):0;this.setObjectQuaternion(this.object.quaternion,n,r,s,o),8*(1-this.lastQuaternion.dot(this.object.quaternion))>this.EPS&&(this.lastQuaternion.copy(this.object.quaternion),this.dispatchEvent(this.changeEvent))}}),Ys(this,"dispose",()=>this.disconnect()),this.object=e,this.object.rotation.reorder("YXZ"),this.connect()}};var nce=Object.defineProperty,ice=(i,e,t)=>e in i?nce(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Ut=(i,e,t)=>(ice(i,typeof e!="symbol"?e+"":e,t),t);let rce=class extends v0{constructor(e,t){super(),Ut(this,"enabled",!0),Ut(this,"screen",{left:0,top:0,width:0,height:0}),Ut(this,"rotateSpeed",1),Ut(this,"zoomSpeed",1.2),Ut(this,"panSpeed",.3),Ut(this,"noRotate",!1),Ut(this,"noZoom",!1),Ut(this,"noPan",!1),Ut(this,"staticMoving",!1),Ut(this,"dynamicDampingFactor",.2),Ut(this,"minDistance",0),Ut(this,"maxDistance",1/0),Ut(this,"keys",["KeyA","KeyS","KeyD"]),Ut(this,"mouseButtons",{LEFT:oc.ROTATE,MIDDLE:oc.DOLLY,RIGHT:oc.PAN}),Ut(this,"object"),Ut(this,"domElement"),Ut(this,"cursorZoom",!1),Ut(this,"target",new H),Ut(this,"mousePosition",new Ue),Ut(this,"STATE",{NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4}),Ut(this,"EPS",1e-6),Ut(this,"lastZoom",1),Ut(this,"lastPosition",new H),Ut(this,"cursorVector",new H),Ut(this,"targetVector",new H),Ut(this,"_state",this.STATE.NONE),Ut(this,"_keyState",this.STATE.NONE),Ut(this,"_eye",new H),Ut(this,"_movePrev",new Ue),Ut(this,"_moveCurr",new Ue),Ut(this,"_lastAxis",new H),Ut(this,"_lastAngle",0),Ut(this,"_zoomStart",new Ue),Ut(this,"_zoomEnd",new Ue),Ut(this,"_touchZoomDistanceStart",0),Ut(this,"_touchZoomDistanceEnd",0),Ut(this,"_panStart",new Ue),Ut(this,"_panEnd",new Ue),Ut(this,"target0"),Ut(this,"position0"),Ut(this,"up0"),Ut(this,"zoom0"),Ut(this,"changeEvent",{type:"change"}),Ut(this,"startEvent",{type:"start"}),Ut(this,"endEvent",{type:"end"}),Ut(this,"onScreenVector",new Ue),Ut(this,"getMouseOnScreen",(n,r)=>(this.onScreenVector.set((n-this.screen.left)/this.screen.width,(r-this.screen.top)/this.screen.height),this.onScreenVector)),Ut(this,"onCircleVector",new Ue),Ut(this,"getMouseOnCircle",(n,r)=>(this.onCircleVector.set((n-this.screen.width*.5-this.screen.left)/(this.screen.width*.5),(this.screen.height+2*(this.screen.top-r))/this.screen.width),this.onCircleVector)),Ut(this,"axis",new H),Ut(this,"quaternion",new Xt),Ut(this,"eyeDirection",new H),Ut(this,"objectUpDirection",new H),Ut(this,"objectSidewaysDirection",new H),Ut(this,"moveDirection",new H),Ut(this,"angle",0),Ut(this,"rotateCamera",()=>{this.moveDirection.set(this._moveCurr.x-this._movePrev.x,this._moveCurr.y-this._movePrev.y,0),this.angle=this.moveDirection.length(),this.angle?(this._eye.copy(this.object.position).sub(this.target),this.eyeDirection.copy(this._eye).normalize(),this.objectUpDirection.copy(this.object.up).normalize(),this.objectSidewaysDirection.crossVectors(this.objectUpDirection,this.eyeDirection).normalize(),this.objectUpDirection.setLength(this._moveCurr.y-this._movePrev.y),this.objectSidewaysDirection.setLength(this._moveCurr.x-this._movePrev.x),this.moveDirection.copy(this.objectUpDirection.add(this.objectSidewaysDirection)),this.axis.crossVectors(this.moveDirection,this._eye).normalize(),this.angle*=this.rotateSpeed,this.quaternion.setFromAxisAngle(this.axis,this.angle),this._eye.applyQuaternion(this.quaternion),this.object.up.applyQuaternion(this.quaternion),this._lastAxis.copy(this.axis),this._lastAngle=this.angle):!this.staticMoving&&this._lastAngle&&(this._lastAngle*=Math.sqrt(1-this.dynamicDampingFactor),this._eye.copy(this.object.position).sub(this.target),this.quaternion.setFromAxisAngle(this._lastAxis,this._lastAngle),this._eye.applyQuaternion(this.quaternion),this.object.up.applyQuaternion(this.quaternion)),this._movePrev.copy(this._moveCurr)}),Ut(this,"zoomCamera",()=>{let n;if(this._state===this.STATE.TOUCH_ZOOM_PAN)n=this._touchZoomDistanceStart/this._touchZoomDistanceEnd,this._touchZoomDistanceStart=this._touchZoomDistanceEnd,this.object.isPerspectiveCamera?this._eye.multiplyScalar(n):this.object.isOrthographicCamera?(this.object.zoom/=n,this.object.updateProjectionMatrix()):console.warn("THREE.TrackballControls: Unsupported camera type");else{if(n=1+(this._zoomEnd.y-this._zoomStart.y)*this.zoomSpeed,Math.abs(n-1)>this.EPS&&n>0&&(this.object.isPerspectiveCamera?(n>1&&this._eye.length()>=this.maxDistance-this.EPS&&(n=1),this._eye.multiplyScalar(n)):this.object.isOrthographicCamera?(n>1&&this.object.zoom<this.maxDistance*this.maxDistance&&(n=1),this.object.zoom/=n):console.warn("THREE.TrackballControls: Unsupported camera type")),this.staticMoving?this._zoomStart.copy(this._zoomEnd):this._zoomStart.y+=(this._zoomEnd.y-this._zoomStart.y)*this.dynamicDampingFactor,this.cursorZoom){this.targetVector.copy(this.target).project(this.object);let r=this.cursorVector.set(this.mousePosition.x,this.mousePosition.y,this.targetVector.z).unproject(this.object);this.target.lerpVectors(r,this.target,n)}this.object.isOrthographicCamera&&this.object.updateProjectionMatrix()}}),Ut(this,"mouseChange",new Ue),Ut(this,"objectUp",new H),Ut(this,"pan",new H),Ut(this,"panCamera",()=>{if(this.domElement&&(this.mouseChange.copy(this._panEnd).sub(this._panStart),this.mouseChange.lengthSq()>this.EPS)){if(this.object.isOrthographicCamera){const n=this.object,r=(n.right-n.left)/this.object.zoom,s=(n.top-n.bottom)/this.object.zoom;this.mouseChange.x*=r,this.mouseChange.y*=s}else this.mouseChange.multiplyScalar(this._eye.length()*this.panSpeed);this.pan.copy(this._eye).cross(this.object.up).setLength(this.mouseChange.x),this.pan.add(this.objectUp.copy(this.object.up).setLength(this.mouseChange.y)),this.object.position.add(this.pan),this.target.add(this.pan),this.staticMoving?this._panStart.copy(this._panEnd):this._panStart.add(this.mouseChange.subVectors(this._panEnd,this._panStart).multiplyScalar(this.dynamicDampingFactor))}}),Ut(this,"checkDistances",()=>{(!this.noZoom||!this.noPan)&&(this._eye.lengthSq()>this.maxDistance*this.maxDistance&&(this.object.position.addVectors(this.target,this._eye.setLength(this.maxDistance)),this._zoomStart.copy(this._zoomEnd)),this._eye.lengthSq()<this.minDistance*this.minDistance&&(this.object.position.addVectors(this.target,this._eye.setLength(this.minDistance)),this._zoomStart.copy(this._zoomEnd)))}),Ut(this,"handleResize",()=>{if(!this.domElement)return;const n=this.domElement.getBoundingClientRect(),r=this.domElement.ownerDocument.documentElement;this.screen.left=n.left+window.pageXOffset-r.clientLeft,this.screen.top=n.top+window.pageYOffset-r.clientTop,this.screen.width=n.width,this.screen.height=n.height}),Ut(this,"update",()=>{this._eye.subVectors(this.object.position,this.target),this.noRotate||this.rotateCamera(),this.noZoom||this.zoomCamera(),this.noPan||this.panCamera(),this.object.position.addVectors(this.target,this._eye),this.object.isPerspectiveCamera?(this.checkDistances(),this.object.lookAt(this.target),this.lastPosition.distanceToSquared(this.object.position)>this.EPS&&(this.dispatchEvent(this.changeEvent),this.lastPosition.copy(this.object.position))):this.object.isOrthographicCamera?(this.object.lookAt(this.target),(this.lastPosition.distanceToSquared(this.object.position)>this.EPS||this.lastZoom!==this.object.zoom)&&(this.dispatchEvent(this.changeEvent),this.lastPosition.copy(this.object.position),this.lastZoom=this.object.zoom)):console.warn("THREE.TrackballControls: Unsupported camera type")}),Ut(this,"reset",()=>{this._state=this.STATE.NONE,this._keyState=this.STATE.NONE,this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.up.copy(this.up0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this._eye.subVectors(this.object.position,this.target),this.object.lookAt(this.target),this.dispatchEvent(this.changeEvent),this.lastPosition.copy(this.object.position),this.lastZoom=this.object.zoom}),Ut(this,"keydown",n=>{this.enabled!==!1&&(window.removeEventListener("keydown",this.keydown),this._keyState===this.STATE.NONE&&(n.code===this.keys[this.STATE.ROTATE]&&!this.noRotate?this._keyState=this.STATE.ROTATE:n.code===this.keys[this.STATE.ZOOM]&&!this.noZoom?this._keyState=this.STATE.ZOOM:n.code===this.keys[this.STATE.PAN]&&!this.noPan&&(this._keyState=this.STATE.PAN)))}),Ut(this,"onPointerDown",n=>{if(this.enabled!==!1)switch(n.pointerType){case"mouse":case"pen":this.onMouseDown(n);break}}),Ut(this,"onPointerMove",n=>{if(this.enabled!==!1)switch(n.pointerType){case"mouse":case"pen":this.onMouseMove(n);break}}),Ut(this,"onPointerUp",n=>{if(this.enabled!==!1)switch(n.pointerType){case"mouse":case"pen":this.onMouseUp();break}}),Ut(this,"keyup",()=>{this.enabled!==!1&&(this._keyState=this.STATE.NONE,window.addEventListener("keydown",this.keydown))}),Ut(this,"onMouseDown",n=>{if(!this.domElement)return;if(this._state===this.STATE.NONE)switch(n.button){case this.mouseButtons.LEFT:this._state=this.STATE.ROTATE;break;case this.mouseButtons.MIDDLE:this._state=this.STATE.ZOOM;break;case this.mouseButtons.RIGHT:this._state=this.STATE.PAN;break}const r=this._keyState!==this.STATE.NONE?this._keyState:this._state;r===this.STATE.ROTATE&&!this.noRotate?(this._moveCurr.copy(this.getMouseOnCircle(n.pageX,n.pageY)),this._movePrev.copy(this._moveCurr)):r===this.STATE.ZOOM&&!this.noZoom?(this._zoomStart.copy(this.getMouseOnScreen(n.pageX,n.pageY)),this._zoomEnd.copy(this._zoomStart)):r===this.STATE.PAN&&!this.noPan&&(this._panStart.copy(this.getMouseOnScreen(n.pageX,n.pageY)),this._panEnd.copy(this._panStart)),this.domElement.ownerDocument.addEventListener("pointermove",this.onPointerMove),this.domElement.ownerDocument.addEventListener("pointerup",this.onPointerUp),this.dispatchEvent(this.startEvent)}),Ut(this,"onMouseMove",n=>{if(this.enabled===!1)return;const r=this._keyState!==this.STATE.NONE?this._keyState:this._state;r===this.STATE.ROTATE&&!this.noRotate?(this._movePrev.copy(this._moveCurr),this._moveCurr.copy(this.getMouseOnCircle(n.pageX,n.pageY))):r===this.STATE.ZOOM&&!this.noZoom?this._zoomEnd.copy(this.getMouseOnScreen(n.pageX,n.pageY)):r===this.STATE.PAN&&!this.noPan&&this._panEnd.copy(this.getMouseOnScreen(n.pageX,n.pageY))}),Ut(this,"onMouseUp",()=>{this.domElement&&this.enabled!==!1&&(this._state=this.STATE.NONE,this.domElement.ownerDocument.removeEventListener("pointermove",this.onPointerMove),this.domElement.ownerDocument.removeEventListener("pointerup",this.onPointerUp),this.dispatchEvent(this.endEvent))}),Ut(this,"mousewheel",n=>{if(this.enabled!==!1&&this.noZoom!==!0){switch(n.preventDefault(),n.deltaMode){case 2:this._zoomStart.y-=n.deltaY*.025;break;case 1:this._zoomStart.y-=n.deltaY*.01;break;default:this._zoomStart.y-=n.deltaY*25e-5;break}this.mousePosition.x=n.offsetX/this.screen.width*2-1,this.mousePosition.y=-(n.offsetY/this.screen.height)*2+1,this.dispatchEvent(this.startEvent),this.dispatchEvent(this.endEvent)}}),Ut(this,"touchstart",n=>{if(this.enabled!==!1){switch(n.preventDefault(),n.touches.length){case 1:this._state=this.STATE.TOUCH_ROTATE,this._moveCurr.copy(this.getMouseOnCircle(n.touches[0].pageX,n.touches[0].pageY)),this._movePrev.copy(this._moveCurr);break;default:this._state=this.STATE.TOUCH_ZOOM_PAN;const r=n.touches[0].pageX-n.touches[1].pageX,s=n.touches[0].pageY-n.touches[1].pageY;this._touchZoomDistanceEnd=this._touchZoomDistanceStart=Math.sqrt(r*r+s*s);const o=(n.touches[0].pageX+n.touches[1].pageX)/2,a=(n.touches[0].pageY+n.touches[1].pageY)/2;this._panStart.copy(this.getMouseOnScreen(o,a)),this._panEnd.copy(this._panStart);break}this.dispatchEvent(this.startEvent)}}),Ut(this,"touchmove",n=>{if(this.enabled!==!1)switch(n.preventDefault(),n.touches.length){case 1:this._movePrev.copy(this._moveCurr),this._moveCurr.copy(this.getMouseOnCircle(n.touches[0].pageX,n.touches[0].pageY));break;default:const r=n.touches[0].pageX-n.touches[1].pageX,s=n.touches[0].pageY-n.touches[1].pageY;this._touchZoomDistanceEnd=Math.sqrt(r*r+s*s);const o=(n.touches[0].pageX+n.touches[1].pageX)/2,a=(n.touches[0].pageY+n.touches[1].pageY)/2;this._panEnd.copy(this.getMouseOnScreen(o,a));break}}),Ut(this,"touchend",n=>{if(this.enabled!==!1){switch(n.touches.length){case 0:this._state=this.STATE.NONE;break;case 1:this._state=this.STATE.TOUCH_ROTATE,this._moveCurr.copy(this.getMouseOnCircle(n.touches[0].pageX,n.touches[0].pageY)),this._movePrev.copy(this._moveCurr);break}this.dispatchEvent(this.endEvent)}}),Ut(this,"contextmenu",n=>{this.enabled!==!1&&n.preventDefault()}),Ut(this,"connect",n=>{n===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.domElement=n,this.domElement.addEventListener("contextmenu",this.contextmenu),this.domElement.addEventListener("pointerdown",this.onPointerDown),this.domElement.addEventListener("wheel",this.mousewheel),this.domElement.addEventListener("touchstart",this.touchstart),this.domElement.addEventListener("touchend",this.touchend),this.domElement.addEventListener("touchmove",this.touchmove),this.domElement.ownerDocument.addEventListener("pointermove",this.onPointerMove),this.domElement.ownerDocument.addEventListener("pointerup",this.onPointerUp),window.addEventListener("keydown",this.keydown),window.addEventListener("keyup",this.keyup),this.handleResize()}),Ut(this,"dispose",()=>{this.domElement&&(this.domElement.removeEventListener("contextmenu",this.contextmenu),this.domElement.removeEventListener("pointerdown",this.onPointerDown),this.domElement.removeEventListener("wheel",this.mousewheel),this.domElement.removeEventListener("touchstart",this.touchstart),this.domElement.removeEventListener("touchend",this.touchend),this.domElement.removeEventListener("touchmove",this.touchmove),this.domElement.ownerDocument.removeEventListener("pointermove",this.onPointerMove),this.domElement.ownerDocument.removeEventListener("pointerup",this.onPointerUp),window.removeEventListener("keydown",this.keydown),window.removeEventListener("keyup",this.keyup))}),this.object=e,this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.up0=this.object.up.clone(),this.zoom0=this.object.zoom,t!==void 0&&this.connect(t),this.update()}};var sce=Object.defineProperty,oce=(i,e,t)=>e in i?sce(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Mn=(i,e,t)=>(oce(i,typeof e!="symbol"?e+"":e,t),t);const M3=new vc,S9=new vo,ace=Math.cos(70*(Math.PI/180)),w9=(i,e)=>(i%e+e)%e;let lH=class extends v0{constructor(e,t){super(),Mn(this,"object"),Mn(this,"domElement"),Mn(this,"enabled",!0),Mn(this,"target",new H),Mn(this,"minDistance",0),Mn(this,"maxDistance",1/0),Mn(this,"minZoom",0),Mn(this,"maxZoom",1/0),Mn(this,"minPolarAngle",0),Mn(this,"maxPolarAngle",Math.PI),Mn(this,"minAzimuthAngle",-1/0),Mn(this,"maxAzimuthAngle",1/0),Mn(this,"enableDamping",!1),Mn(this,"dampingFactor",.05),Mn(this,"enableZoom",!0),Mn(this,"zoomSpeed",1),Mn(this,"enableRotate",!0),Mn(this,"rotateSpeed",1),Mn(this,"enablePan",!0),Mn(this,"panSpeed",1),Mn(this,"screenSpacePanning",!0),Mn(this,"keyPanSpeed",7),Mn(this,"zoomToCursor",!1),Mn(this,"autoRotate",!1),Mn(this,"autoRotateSpeed",2),Mn(this,"reverseOrbit",!1),Mn(this,"reverseHorizontalOrbit",!1),Mn(this,"reverseVerticalOrbit",!1),Mn(this,"keys",{LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"}),Mn(this,"mouseButtons",{LEFT:oc.ROTATE,MIDDLE:oc.DOLLY,RIGHT:oc.PAN}),Mn(this,"touches",{ONE:Sf.ROTATE,TWO:Sf.DOLLY_PAN}),Mn(this,"target0"),Mn(this,"position0"),Mn(this,"zoom0"),Mn(this,"_domElementKeyEvents",null),Mn(this,"getPolarAngle"),Mn(this,"getAzimuthalAngle"),Mn(this,"setPolarAngle"),Mn(this,"setAzimuthalAngle"),Mn(this,"getDistance"),Mn(this,"getZoomScale"),Mn(this,"listenToKeyEvents"),Mn(this,"stopListenToKeyEvents"),Mn(this,"saveState"),Mn(this,"reset"),Mn(this,"update"),Mn(this,"connect"),Mn(this,"dispose"),Mn(this,"dollyIn"),Mn(this,"dollyOut"),Mn(this,"getScale"),Mn(this,"setScale"),this.object=e,this.domElement=t,this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=()=>u.phi,this.getAzimuthalAngle=()=>u.theta,this.setPolarAngle=be=>{let qe=w9(be,2*Math.PI),At=u.phi;At<0&&(At+=2*Math.PI),qe<0&&(qe+=2*Math.PI);let yt=Math.abs(qe-At);2*Math.PI-yt<yt&&(qe<At?qe+=2*Math.PI:At+=2*Math.PI),h.phi=qe-At,n.update()},this.setAzimuthalAngle=be=>{let qe=w9(be,2*Math.PI),At=u.theta;At<0&&(At+=2*Math.PI),qe<0&&(qe+=2*Math.PI);let yt=Math.abs(qe-At);2*Math.PI-yt<yt&&(qe<At?qe+=2*Math.PI:At+=2*Math.PI),h.theta=qe-At,n.update()},this.getDistance=()=>n.object.position.distanceTo(n.target),this.listenToKeyEvents=be=>{be.addEventListener("keydown",ct),this._domElementKeyEvents=be},this.stopListenToKeyEvents=()=>{this._domElementKeyEvents.removeEventListener("keydown",ct),this._domElementKeyEvents=null},this.saveState=()=>{n.target0.copy(n.target),n.position0.copy(n.object.position),n.zoom0=n.object.zoom},this.reset=()=>{n.target.copy(n.target0),n.object.position.copy(n.position0),n.object.zoom=n.zoom0,n.object.updateProjectionMatrix(),n.dispatchEvent(r),n.update(),l=a.NONE},this.update=(()=>{const be=new H,qe=new H(0,1,0),At=new Xt().setFromUnitVectors(e.up,qe),yt=At.clone().invert(),De=new H,Ce=new Xt,_t=2*Math.PI;return function(){const bt=n.object.position;At.setFromUnitVectors(e.up,qe),yt.copy(At).invert(),be.copy(bt).sub(n.target),be.applyQuaternion(At),u.setFromVector3(be),n.autoRotate&&l===a.NONE&&U(k()),n.enableDamping?(u.theta+=h.theta*n.dampingFactor,u.phi+=h.phi*n.dampingFactor):(u.theta+=h.theta,u.phi+=h.phi);let Pt=n.minAzimuthAngle,qt=n.maxAzimuthAngle;isFinite(Pt)&&isFinite(qt)&&(Pt<-Math.PI?Pt+=_t:Pt>Math.PI&&(Pt-=_t),qt<-Math.PI?qt+=_t:qt>Math.PI&&(qt-=_t),Pt<=qt?u.theta=Math.max(Pt,Math.min(qt,u.theta)):u.theta=u.theta>(Pt+qt)/2?Math.max(Pt,u.theta):Math.min(qt,u.theta)),u.phi=Math.max(n.minPolarAngle,Math.min(n.maxPolarAngle,u.phi)),u.makeSafe(),n.enableDamping===!0?n.target.addScaledVector(d,n.dampingFactor):n.target.add(d),n.zoomToCursor&&R||n.object.isOrthographicCamera?u.radius=te(u.radius):u.radius=te(u.radius*f),be.setFromSpherical(u),be.applyQuaternion(yt),bt.copy(n.target).add(be),n.object.matrixAutoUpdate||n.object.updateMatrix(),n.object.lookAt(n.target),n.enableDamping===!0?(h.theta*=1-n.dampingFactor,h.phi*=1-n.dampingFactor,d.multiplyScalar(1-n.dampingFactor)):(h.set(0,0,0),d.set(0,0,0));let Nt=!1;if(n.zoomToCursor&&R){let dn=null;if(n.object instanceof Wn&&n.object.isPerspectiveCamera){const Vn=be.length();dn=te(Vn*f);const pn=Vn-dn;n.object.position.addScaledVector(M,pn),n.object.updateMatrixWorld()}else if(n.object.isOrthographicCamera){const Vn=new H(L.x,L.y,0);Vn.unproject(n.object),n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/f)),n.object.updateProjectionMatrix(),Nt=!0;const pn=new H(L.x,L.y,0);pn.unproject(n.object),n.object.position.sub(pn).add(Vn),n.object.updateMatrixWorld(),dn=be.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),n.zoomToCursor=!1;dn!==null&&(n.screenSpacePanning?n.target.set(0,0,-1).transformDirection(n.object.matrix).multiplyScalar(dn).add(n.object.position):(M3.origin.copy(n.object.position),M3.direction.set(0,0,-1).transformDirection(n.object.matrix),Math.abs(n.object.up.dot(M3.direction))<ace?e.lookAt(n.target):(S9.setFromNormalAndCoplanarPoint(n.object.up,n.target),M3.intersectPlane(S9,n.target))))}else n.object instanceof qi&&n.object.isOrthographicCamera&&(Nt=f!==1,Nt&&(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/f)),n.object.updateProjectionMatrix()));return f=1,R=!1,Nt||De.distanceToSquared(n.object.position)>c||8*(1-Ce.dot(n.object.quaternion))>c?(n.dispatchEvent(r),De.copy(n.object.position),Ce.copy(n.object.quaternion),Nt=!1,!0):!1}})(),this.connect=be=>{n.domElement=be,n.domElement.style.touchAction="none",n.domElement.addEventListener("contextmenu",Mt),n.domElement.addEventListener("pointerdown",Re),n.domElement.addEventListener("pointercancel",Fe),n.domElement.addEventListener("wheel",$e)},this.dispose=()=>{var be,qe,At,yt,De,Ce;n.domElement&&(n.domElement.style.touchAction="auto"),(be=n.domElement)==null||be.removeEventListener("contextmenu",Mt),(qe=n.domElement)==null||qe.removeEventListener("pointerdown",Re),(At=n.domElement)==null||At.removeEventListener("pointercancel",Fe),(yt=n.domElement)==null||yt.removeEventListener("wheel",$e),(De=n.domElement)==null||De.ownerDocument.removeEventListener("pointermove",Be),(Ce=n.domElement)==null||Ce.ownerDocument.removeEventListener("pointerup",Fe),n._domElementKeyEvents!==null&&n._domElementKeyEvents.removeEventListener("keydown",ct)};const n=this,r={type:"change"},s={type:"start"},o={type:"end"},a={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let l=a.NONE;const c=1e-6,u=new e0,h=new e0;let f=1;const d=new H,m=new Ue,A=new Ue,g=new Ue,y=new Ue,E=new Ue,x=new Ue,C=new Ue,T=new Ue,I=new Ue,M=new H,L=new Ue;let R=!1;const P=[],F={};function k(){return 2*Math.PI/60/60*n.autoRotateSpeed}function z(){return Math.pow(.95,n.zoomSpeed)}function U(be){n.reverseOrbit||n.reverseHorizontalOrbit?h.theta+=be:h.theta-=be}function W(be){n.reverseOrbit||n.reverseVerticalOrbit?h.phi+=be:h.phi-=be}const $=(()=>{const be=new H;return function(At,yt){be.setFromMatrixColumn(yt,0),be.multiplyScalar(-At),d.add(be)}})(),oe=(()=>{const be=new H;return function(At,yt){n.screenSpacePanning===!0?be.setFromMatrixColumn(yt,1):(be.setFromMatrixColumn(yt,0),be.crossVectors(n.object.up,be)),be.multiplyScalar(At),d.add(be)}})(),X=(()=>{const be=new H;return function(At,yt){const De=n.domElement;if(De&&n.object instanceof Wn&&n.object.isPerspectiveCamera){const Ce=n.object.position;be.copy(Ce).sub(n.target);let _t=be.length();_t*=Math.tan(n.object.fov/2*Math.PI/180),$(2*At*_t/De.clientHeight,n.object.matrix),oe(2*yt*_t/De.clientHeight,n.object.matrix)}else De&&n.object instanceof qi&&n.object.isOrthographicCamera?($(At*(n.object.right-n.object.left)/n.object.zoom/De.clientWidth,n.object.matrix),oe(yt*(n.object.top-n.object.bottom)/n.object.zoom/De.clientHeight,n.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),n.enablePan=!1)}})();function Q(be){n.object instanceof Wn&&n.object.isPerspectiveCamera||n.object instanceof qi&&n.object.isOrthographicCamera?f=be:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function Y(be){Q(f/be)}function O(be){Q(f*be)}function K(be){if(!n.zoomToCursor||!n.domElement)return;R=!0;const qe=n.domElement.getBoundingClientRect(),At=be.clientX-qe.left,yt=be.clientY-qe.top,De=qe.width,Ce=qe.height;L.x=At/De*2-1,L.y=-(yt/Ce)*2+1,M.set(L.x,L.y,1).unproject(n.object).sub(n.object.position).normalize()}function te(be){return Math.max(n.minDistance,Math.min(n.maxDistance,be))}function q(be){m.set(be.clientX,be.clientY)}function J(be){K(be),C.set(be.clientX,be.clientY)}function ie(be){y.set(be.clientX,be.clientY)}function re(be){A.set(be.clientX,be.clientY),g.subVectors(A,m).multiplyScalar(n.rotateSpeed);const qe=n.domElement;qe&&(U(2*Math.PI*g.x/qe.clientHeight),W(2*Math.PI*g.y/qe.clientHeight)),m.copy(A),n.update()}function se(be){T.set(be.clientX,be.clientY),I.subVectors(T,C),I.y>0?Y(z()):I.y<0&&O(z()),C.copy(T),n.update()}function ge(be){E.set(be.clientX,be.clientY),x.subVectors(E,y).multiplyScalar(n.panSpeed),X(x.x,x.y),y.copy(E),n.update()}function xe(be){K(be),be.deltaY<0?O(z()):be.deltaY>0&&Y(z()),n.update()}function pe(be){let qe=!1;switch(be.code){case n.keys.UP:X(0,n.keyPanSpeed),qe=!0;break;case n.keys.BOTTOM:X(0,-n.keyPanSpeed),qe=!0;break;case n.keys.LEFT:X(n.keyPanSpeed,0),qe=!0;break;case n.keys.RIGHT:X(-n.keyPanSpeed,0),qe=!0;break}qe&&(be.preventDefault(),n.update())}function ce(){if(P.length==1)m.set(P[0].pageX,P[0].pageY);else{const be=.5*(P[0].pageX+P[1].pageX),qe=.5*(P[0].pageY+P[1].pageY);m.set(be,qe)}}function we(){if(P.length==1)y.set(P[0].pageX,P[0].pageY);else{const be=.5*(P[0].pageX+P[1].pageX),qe=.5*(P[0].pageY+P[1].pageY);y.set(be,qe)}}function Ee(){const be=P[0].pageX-P[1].pageX,qe=P[0].pageY-P[1].pageY,At=Math.sqrt(be*be+qe*qe);C.set(0,At)}function ve(){n.enableZoom&&Ee(),n.enablePan&&we()}function Ae(){n.enableZoom&&Ee(),n.enableRotate&&ce()}function Le(be){if(P.length==1)A.set(be.pageX,be.pageY);else{const At=ft(be),yt=.5*(be.pageX+At.x),De=.5*(be.pageY+At.y);A.set(yt,De)}g.subVectors(A,m).multiplyScalar(n.rotateSpeed);const qe=n.domElement;qe&&(U(2*Math.PI*g.x/qe.clientHeight),W(2*Math.PI*g.y/qe.clientHeight)),m.copy(A)}function Te(be){if(P.length==1)E.set(be.pageX,be.pageY);else{const qe=ft(be),At=.5*(be.pageX+qe.x),yt=.5*(be.pageY+qe.y);E.set(At,yt)}x.subVectors(E,y).multiplyScalar(n.panSpeed),X(x.x,x.y),y.copy(E)}function ne(be){const qe=ft(be),At=be.pageX-qe.x,yt=be.pageY-qe.y,De=Math.sqrt(At*At+yt*yt);T.set(0,De),I.set(0,Math.pow(T.y/C.y,n.zoomSpeed)),Y(I.y),C.copy(T)}function V(be){n.enableZoom&&ne(be),n.enablePan&&Te(be)}function de(be){n.enableZoom&&ne(be),n.enableRotate&&Le(be)}function Re(be){var qe,At;n.enabled!==!1&&(P.length===0&&((qe=n.domElement)==null||qe.ownerDocument.addEventListener("pointermove",Be),(At=n.domElement)==null||At.ownerDocument.addEventListener("pointerup",Fe)),Ft(be),be.pointerType==="touch"?pt(be):He(be))}function Be(be){n.enabled!==!1&&(be.pointerType==="touch"?We(be):it(be))}function Fe(be){var qe,At,yt;St(be),P.length===0&&((qe=n.domElement)==null||qe.releasePointerCapture(be.pointerId),(At=n.domElement)==null||At.ownerDocument.removeEventListener("pointermove",Be),(yt=n.domElement)==null||yt.ownerDocument.removeEventListener("pointerup",Fe)),n.dispatchEvent(o),l=a.NONE}function He(be){let qe;switch(be.button){case 0:qe=n.mouseButtons.LEFT;break;case 1:qe=n.mouseButtons.MIDDLE;break;case 2:qe=n.mouseButtons.RIGHT;break;default:qe=-1}switch(qe){case oc.DOLLY:if(n.enableZoom===!1)return;J(be),l=a.DOLLY;break;case oc.ROTATE:if(be.ctrlKey||be.metaKey||be.shiftKey){if(n.enablePan===!1)return;ie(be),l=a.PAN}else{if(n.enableRotate===!1)return;q(be),l=a.ROTATE}break;case oc.PAN:if(be.ctrlKey||be.metaKey||be.shiftKey){if(n.enableRotate===!1)return;q(be),l=a.ROTATE}else{if(n.enablePan===!1)return;ie(be),l=a.PAN}break;default:l=a.NONE}l!==a.NONE&&n.dispatchEvent(s)}function it(be){if(n.enabled!==!1)switch(l){case a.ROTATE:if(n.enableRotate===!1)return;re(be);break;case a.DOLLY:if(n.enableZoom===!1)return;se(be);break;case a.PAN:if(n.enablePan===!1)return;ge(be);break}}function $e(be){n.enabled===!1||n.enableZoom===!1||l!==a.NONE&&l!==a.ROTATE||(be.preventDefault(),n.dispatchEvent(s),xe(be),n.dispatchEvent(o))}function ct(be){n.enabled===!1||n.enablePan===!1||pe(be)}function pt(be){switch(gt(be),P.length){case 1:switch(n.touches.ONE){case Sf.ROTATE:if(n.enableRotate===!1)return;ce(),l=a.TOUCH_ROTATE;break;case Sf.PAN:if(n.enablePan===!1)return;we(),l=a.TOUCH_PAN;break;default:l=a.NONE}break;case 2:switch(n.touches.TWO){case Sf.DOLLY_PAN:if(n.enableZoom===!1&&n.enablePan===!1)return;ve(),l=a.TOUCH_DOLLY_PAN;break;case Sf.DOLLY_ROTATE:if(n.enableZoom===!1&&n.enableRotate===!1)return;Ae(),l=a.TOUCH_DOLLY_ROTATE;break;default:l=a.NONE}break;default:l=a.NONE}l!==a.NONE&&n.dispatchEvent(s)}function We(be){switch(gt(be),l){case a.TOUCH_ROTATE:if(n.enableRotate===!1)return;Le(be),n.update();break;case a.TOUCH_PAN:if(n.enablePan===!1)return;Te(be),n.update();break;case a.TOUCH_DOLLY_PAN:if(n.enableZoom===!1&&n.enablePan===!1)return;V(be),n.update();break;case a.TOUCH_DOLLY_ROTATE:if(n.enableZoom===!1&&n.enableRotate===!1)return;de(be),n.update();break;default:l=a.NONE}}function Mt(be){n.enabled!==!1&&be.preventDefault()}function Ft(be){P.push(be)}function St(be){delete F[be.pointerId];for(let qe=0;qe<P.length;qe++)if(P[qe].pointerId==be.pointerId){P.splice(qe,1);return}}function gt(be){let qe=F[be.pointerId];qe===void 0&&(qe=new Ue,F[be.pointerId]=qe),qe.set(be.pageX,be.pageY)}function ft(be){const qe=be.pointerId===P[0].pointerId?P[1]:P[0];return F[qe.pointerId]}this.dollyIn=(be=z())=>{O(be),n.update()},this.dollyOut=(be=z())=>{Y(be),n.update()},this.getScale=()=>f,this.setScale=be=>{Q(be),n.update()},this.getZoomScale=()=>z(),t!==void 0&&this.connect(t),this.update()}},lce=class extends lH{constructor(e,t){super(e,t),this.screenSpacePanning=!1,this.mouseButtons.LEFT=oc.PAN,this.mouseButtons.RIGHT=oc.ROTATE,this.touches.ONE=Sf.PAN,this.touches.TWO=Sf.DOLLY_ROTATE}};var cce=Object.defineProperty,uce=(i,e,t)=>e in i?cce(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,tt=(i,e,t)=>(uce(i,typeof e!="symbol"?e+"":e,t),t);const En={IDLE:Symbol(),ROTATE:Symbol(),PAN:Symbol(),SCALE:Symbol(),FOV:Symbol(),FOCUS:Symbol(),ZROTATE:Symbol(),ANIMATION_FOCUS:Symbol(),ANIMATION_ROTATE:Symbol()},Hi={NONE:Symbol(),ONE_FINGER:Symbol(),ONE_FINGER_SWITCHED:Symbol(),TWO_FINGER:Symbol(),MULT_FINGER:Symbol(),CURSOR:Symbol()},ei={x:0,y:0},xl={camera:new Xe,gizmos:new Xe},Sr={type:"change"},ru={type:"start"},Zl={type:"end"};let hce=class extends v0{constructor(e,t=null,n=null){super(),tt(this,"camera"),tt(this,"domElement"),tt(this,"scene"),tt(this,"mouseActions"),tt(this,"_mouseOp"),tt(this,"_v2_1"),tt(this,"_v3_1"),tt(this,"_v3_2"),tt(this,"_m4_1"),tt(this,"_m4_2"),tt(this,"_quat"),tt(this,"_translationMatrix"),tt(this,"_rotationMatrix"),tt(this,"_scaleMatrix"),tt(this,"_rotationAxis"),tt(this,"_cameraMatrixState"),tt(this,"_cameraProjectionState"),tt(this,"_fovState"),tt(this,"_upState"),tt(this,"_zoomState"),tt(this,"_nearPos"),tt(this,"_farPos"),tt(this,"_gizmoMatrixState"),tt(this,"_up0"),tt(this,"_zoom0"),tt(this,"_fov0"),tt(this,"_initialNear"),tt(this,"_nearPos0"),tt(this,"_initialFar"),tt(this,"_farPos0"),tt(this,"_cameraMatrixState0"),tt(this,"_gizmoMatrixState0"),tt(this,"_button"),tt(this,"_touchStart"),tt(this,"_touchCurrent"),tt(this,"_input"),tt(this,"_switchSensibility"),tt(this,"_startFingerDistance"),tt(this,"_currentFingerDistance"),tt(this,"_startFingerRotation"),tt(this,"_currentFingerRotation"),tt(this,"_devPxRatio"),tt(this,"_downValid"),tt(this,"_nclicks"),tt(this,"_downEvents"),tt(this,"_clickStart"),tt(this,"_maxDownTime"),tt(this,"_maxInterval"),tt(this,"_posThreshold"),tt(this,"_movementThreshold"),tt(this,"_currentCursorPosition"),tt(this,"_startCursorPosition"),tt(this,"_grid"),tt(this,"_gridPosition"),tt(this,"_gizmos"),tt(this,"_curvePts"),tt(this,"_timeStart"),tt(this,"_animationId"),tt(this,"focusAnimationTime"),tt(this,"_timePrev"),tt(this,"_timeCurrent"),tt(this,"_anglePrev"),tt(this,"_angleCurrent"),tt(this,"_cursorPosPrev"),tt(this,"_cursorPosCurr"),tt(this,"_wPrev"),tt(this,"_wCurr"),tt(this,"adjustNearFar"),tt(this,"scaleFactor"),tt(this,"dampingFactor"),tt(this,"wMax"),tt(this,"enableAnimations"),tt(this,"enableGrid"),tt(this,"cursorZoom"),tt(this,"minFov"),tt(this,"maxFov"),tt(this,"enabled"),tt(this,"enablePan"),tt(this,"enableRotate"),tt(this,"enableZoom"),tt(this,"minDistance"),tt(this,"maxDistance"),tt(this,"minZoom"),tt(this,"maxZoom"),tt(this,"target"),tt(this,"_currentTarget"),tt(this,"_tbRadius"),tt(this,"_state"),tt(this,"onWindowResize",()=>{const r=(this._gizmos.scale.x+this._gizmos.scale.y+this._gizmos.scale.z)/3;if(this.camera){const c=this.calculateTbRadius(this.camera);c!==void 0&&(this._tbRadius=c)}const s=this._tbRadius/r,a=new Gm(0,0,s,s).getPoints(this._curvePts),l=new fn().setFromPoints(a);for(const c in this._gizmos.children){const u=this._gizmos.children[c];u.geometry=l}this.dispatchEvent(Sr)}),tt(this,"onContextMenu",r=>{if(this.enabled){for(let s=0;s<this.mouseActions.length;s++)if(this.mouseActions[s].mouse==2){r.preventDefault();break}}}),tt(this,"onPointerCancel",()=>{this._touchStart.splice(0,this._touchStart.length),this._touchCurrent.splice(0,this._touchCurrent.length),this._input=Hi.NONE}),tt(this,"onPointerDown",r=>{if(r.button==0&&r.isPrimary?(this._downValid=!0,this._downEvents.push(r)):this._downValid=!1,r.pointerType=="touch"&&this._input!=Hi.CURSOR)switch(this._touchStart.push(r),this._touchCurrent.push(r),this._input){case Hi.NONE:this._input=Hi.ONE_FINGER,this.onSinglePanStart(r,"ROTATE"),window.addEventListener("pointermove",this.onPointerMove),window.addEventListener("pointerup",this.onPointerUp);break;case Hi.ONE_FINGER:case Hi.ONE_FINGER_SWITCHED:this._input=Hi.TWO_FINGER,this.onRotateStart(),this.onPinchStart(),this.onDoublePanStart();break;case Hi.TWO_FINGER:this._input=Hi.MULT_FINGER,this.onTriplePanStart();break}else if(r.pointerType!="touch"&&this._input==Hi.NONE){let s=null;r.ctrlKey||r.metaKey?s="CTRL":r.shiftKey&&(s="SHIFT"),this._mouseOp=this.getOpFromAction(r.button,s),this._mouseOp&&(window.addEventListener("pointermove",this.onPointerMove),window.addEventListener("pointerup",this.onPointerUp),this._input=Hi.CURSOR,this._button=r.button,this.onSinglePanStart(r,this._mouseOp))}}),tt(this,"onPointerMove",r=>{if(r.pointerType=="touch"&&this._input!=Hi.CURSOR)switch(this._input){case Hi.ONE_FINGER:this.updateTouchEvent(r),this.onSinglePanMove(r,En.ROTATE);break;case Hi.ONE_FINGER_SWITCHED:if(this.calculatePointersDistance(this._touchCurrent[0],r)*this._devPxRatio>=this._switchSensibility){this._input=Hi.ONE_FINGER,this.updateTouchEvent(r),this.onSinglePanStart(r,"ROTATE");break}break;case Hi.TWO_FINGER:this.updateTouchEvent(r),this.onRotateMove(),this.onPinchMove(),this.onDoublePanMove();break;case Hi.MULT_FINGER:this.updateTouchEvent(r),this.onTriplePanMove();break}else if(r.pointerType!="touch"&&this._input==Hi.CURSOR){let s=null;r.ctrlKey||r.metaKey?s="CTRL":r.shiftKey&&(s="SHIFT");const o=this.getOpStateFromAction(this._button,s);o&&this.onSinglePanMove(r,o)}this._downValid&&this.calculatePointersDistance(this._downEvents[this._downEvents.length-1],r)*this._devPxRatio>this._movementThreshold&&(this._downValid=!1)}),tt(this,"onPointerUp",r=>{if(r.pointerType=="touch"&&this._input!=Hi.CURSOR){const s=this._touchCurrent.length;for(let o=0;o<s;o++)if(this._touchCurrent[o].pointerId==r.pointerId){this._touchCurrent.splice(o,1),this._touchStart.splice(o,1);break}switch(this._input){case Hi.ONE_FINGER:case Hi.ONE_FINGER_SWITCHED:window.removeEventListener("pointermove",this.onPointerMove),window.removeEventListener("pointerup",this.onPointerUp),this._input=Hi.NONE,this.onSinglePanEnd();break;case Hi.TWO_FINGER:this.onDoublePanEnd(),this.onPinchEnd(),this.onRotateEnd(),this._input=Hi.ONE_FINGER_SWITCHED;break;case Hi.MULT_FINGER:this._touchCurrent.length==0&&(window.removeEventListener("pointermove",this.onPointerMove),window.removeEventListener("pointerup",this.onPointerUp),this._input=Hi.NONE,this.onTriplePanEnd());break}}else r.pointerType!="touch"&&this._input==Hi.CURSOR&&(window.removeEventListener("pointermove",this.onPointerMove),window.removeEventListener("pointerup",this.onPointerUp),this._input=Hi.NONE,this.onSinglePanEnd(),this._button=-1);if(r.isPrimary)if(this._downValid)if(r.timeStamp-this._downEvents[this._downEvents.length-1].timeStamp<=this._maxDownTime)if(this._nclicks==0)this._nclicks=1,this._clickStart=performance.now();else{const o=r.timeStamp-this._clickStart,a=this.calculatePointersDistance(this._downEvents[1],this._downEvents[0])*this._devPxRatio;o<=this._maxInterval&&a<=this._posThreshold?(this._nclicks=0,this._downEvents.splice(0,this._downEvents.length),this.onDoubleTap(r)):(this._nclicks=1,this._downEvents.shift(),this._clickStart=performance.now())}else this._downValid=!1,this._nclicks=0,this._downEvents.splice(0,this._downEvents.length);else this._nclicks=0,this._downEvents.splice(0,this._downEvents.length)}),tt(this,"onWheel",r=>{var s,o;if(this.enabled&&this.enableZoom&&this.domElement){let a=null;r.ctrlKey||r.metaKey?a="CTRL":r.shiftKey&&(a="SHIFT");const l=this.getOpFromAction("WHEEL",a);if(l){r.preventDefault(),this.dispatchEvent(ru);const c=125;let u=r.deltaY/c,h=1;switch(u>0?h=1/this.scaleFactor:u<0&&(h=this.scaleFactor),l){case"ZOOM":if(this.updateTbState(En.SCALE,!0),u>0?h=1/Math.pow(this.scaleFactor,u):u<0&&(h=Math.pow(this.scaleFactor,-u)),this.cursorZoom&&this.enablePan){let f;this.camera instanceof qi&&(f=(s=this.unprojectOnTbPlane(this.camera,r.clientX,r.clientY,this.domElement))==null?void 0:s.applyQuaternion(this.camera.quaternion).multiplyScalar(1/this.camera.zoom).add(this._gizmos.position)),this.camera instanceof Wn&&(f=(o=this.unprojectOnTbPlane(this.camera,r.clientX,r.clientY,this.domElement))==null?void 0:o.applyQuaternion(this.camera.quaternion).add(this._gizmos.position)),f!==void 0&&this.applyTransformMatrix(this.applyScale(h,f))}else this.applyTransformMatrix(this.applyScale(h,this._gizmos.position));this._grid&&(this.disposeGrid(),this.drawGrid()),this.updateTbState(En.IDLE,!1),this.dispatchEvent(Sr),this.dispatchEvent(Zl);break;case"FOV":if(this.camera instanceof Wn){this.updateTbState(En.FOV,!0),r.deltaX!=0&&(u=r.deltaX/c,h=1,u>0?h=1/Math.pow(this.scaleFactor,u):u<0&&(h=Math.pow(this.scaleFactor,-u))),this._v3_1.setFromMatrixPosition(this._cameraMatrixState);const f=this._v3_1.distanceTo(this._gizmos.position);let d=f/h;d=un.clamp(d,this.minDistance,this.maxDistance);const m=f*Math.tan(un.DEG2RAD*this.camera.fov*.5);let A=un.RAD2DEG*(Math.atan(m/d)*2);A>this.maxFov?A=this.maxFov:A<this.minFov&&(A=this.minFov);const g=m/Math.tan(un.DEG2RAD*(A/2));h=f/g,this.setFov(A),this.applyTransformMatrix(this.applyScale(h,this._gizmos.position,!1))}this._grid&&(this.disposeGrid(),this.drawGrid()),this.updateTbState(En.IDLE,!1),this.dispatchEvent(Sr),this.dispatchEvent(Zl);break}}}}),tt(this,"onSinglePanStart",(r,s)=>{if(this.enabled&&this.domElement)switch(this.dispatchEvent(ru),this.setCenter(r.clientX,r.clientY),s){case"PAN":if(!this.enablePan)return;if(this._animationId!=-1&&(cancelAnimationFrame(this._animationId),this._animationId=-1,this._timeStart=-1,this.activateGizmos(!1),this.dispatchEvent(Sr)),this.camera){this.updateTbState(En.PAN,!0);const o=this.unprojectOnTbPlane(this.camera,ei.x,ei.y,this.domElement);o!==void 0&&this._startCursorPosition.copy(o),this.enableGrid&&(this.drawGrid(),this.dispatchEvent(Sr))}break;case"ROTATE":if(!this.enableRotate)return;if(this._animationId!=-1&&(cancelAnimationFrame(this._animationId),this._animationId=-1,this._timeStart=-1),this.camera){this.updateTbState(En.ROTATE,!0);const o=this.unprojectOnTbSurface(this.camera,ei.x,ei.y,this.domElement,this._tbRadius);o!==void 0&&this._startCursorPosition.copy(o),this.activateGizmos(!0),this.enableAnimations&&(this._timePrev=this._timeCurrent=performance.now(),this._angleCurrent=this._anglePrev=0,this._cursorPosPrev.copy(this._startCursorPosition),this._cursorPosCurr.copy(this._cursorPosPrev),this._wCurr=0,this._wPrev=this._wCurr)}this.dispatchEvent(Sr);break;case"FOV":if(!this.enableZoom)return;this.camera instanceof Wn&&(this._animationId!=-1&&(cancelAnimationFrame(this._animationId),this._animationId=-1,this._timeStart=-1,this.activateGizmos(!1),this.dispatchEvent(Sr)),this.updateTbState(En.FOV,!0),this._startCursorPosition.setY(this.getCursorNDC(ei.x,ei.y,this.domElement).y*.5),this._currentCursorPosition.copy(this._startCursorPosition));break;case"ZOOM":if(!this.enableZoom)return;this._animationId!=-1&&(cancelAnimationFrame(this._animationId),this._animationId=-1,this._timeStart=-1,this.activateGizmos(!1),this.dispatchEvent(Sr)),this.updateTbState(En.SCALE,!0),this._startCursorPosition.setY(this.getCursorNDC(ei.x,ei.y,this.domElement).y*.5),this._currentCursorPosition.copy(this._startCursorPosition);break}}),tt(this,"onSinglePanMove",(r,s)=>{if(this.enabled&&this.domElement){const o=s!=this._state;switch(this.setCenter(r.clientX,r.clientY),s){case En.PAN:if(this.enablePan&&this.camera)if(o){this.dispatchEvent(Zl),this.dispatchEvent(ru),this.updateTbState(s,!0);const a=this.unprojectOnTbPlane(this.camera,ei.x,ei.y,this.domElement);a!==void 0&&this._startCursorPosition.copy(a),this.enableGrid&&this.drawGrid(),this.activateGizmos(!1)}else{const a=this.unprojectOnTbPlane(this.camera,ei.x,ei.y,this.domElement);a!==void 0&&this._currentCursorPosition.copy(a),this.applyTransformMatrix(this.pan(this._startCursorPosition,this._currentCursorPosition))}break;case En.ROTATE:if(this.enableRotate&&this.camera)if(o){this.dispatchEvent(Zl),this.dispatchEvent(ru),this.updateTbState(s,!0);const a=this.unprojectOnTbSurface(this.camera,ei.x,ei.y,this.domElement,this._tbRadius);a!==void 0&&this._startCursorPosition.copy(a),this.enableGrid&&this.disposeGrid(),this.activateGizmos(!0)}else{const a=this.unprojectOnTbSurface(this.camera,ei.x,ei.y,this.domElement,this._tbRadius);a!==void 0&&this._currentCursorPosition.copy(a);const l=this._startCursorPosition.distanceTo(this._currentCursorPosition),c=this._startCursorPosition.angleTo(this._currentCursorPosition),u=Math.max(l/this._tbRadius,c);this.applyTransformMatrix(this.rotate(this.calculateRotationAxis(this._startCursorPosition,this._currentCursorPosition),u)),this.enableAnimations&&(this._timePrev=this._timeCurrent,this._timeCurrent=performance.now(),this._anglePrev=this._angleCurrent,this._angleCurrent=u,this._cursorPosPrev.copy(this._cursorPosCurr),this._cursorPosCurr.copy(this._currentCursorPosition),this._wPrev=this._wCurr,this._wCurr=this.calculateAngularSpeed(this._anglePrev,this._angleCurrent,this._timePrev,this._timeCurrent))}break;case En.SCALE:if(this.enableZoom)if(o)this.dispatchEvent(Zl),this.dispatchEvent(ru),this.updateTbState(s,!0),this._startCursorPosition.setY(this.getCursorNDC(ei.x,ei.y,this.domElement).y*.5),this._currentCursorPosition.copy(this._startCursorPosition),this.enableGrid&&this.disposeGrid(),this.activateGizmos(!1);else{this._currentCursorPosition.setY(this.getCursorNDC(ei.x,ei.y,this.domElement).y*.5);const l=this._currentCursorPosition.y-this._startCursorPosition.y;let c=1;l<0?c=1/Math.pow(this.scaleFactor,-l*8):l>0&&(c=Math.pow(this.scaleFactor,l*8)),this.applyTransformMatrix(this.applyScale(c,this._gizmos.position))}break;case En.FOV:if(this.enableZoom&&this.camera instanceof Wn)if(o)this.dispatchEvent(Zl),this.dispatchEvent(ru),this.updateTbState(s,!0),this._startCursorPosition.setY(this.getCursorNDC(ei.x,ei.y,this.domElement).y*.5),this._currentCursorPosition.copy(this._startCursorPosition),this.enableGrid&&this.disposeGrid(),this.activateGizmos(!1);else{this._currentCursorPosition.setY(this.getCursorNDC(ei.x,ei.y,this.domElement).y*.5);const l=this._currentCursorPosition.y-this._startCursorPosition.y;let c=1;l<0?c=1/Math.pow(this.scaleFactor,-l*8):l>0&&(c=Math.pow(this.scaleFactor,l*8)),this._v3_1.setFromMatrixPosition(this._cameraMatrixState);const u=this._v3_1.distanceTo(this._gizmos.position);let h=u/c;h=un.clamp(h,this.minDistance,this.maxDistance);const f=u*Math.tan(un.DEG2RAD*this._fovState*.5);let d=un.RAD2DEG*(Math.atan(f/h)*2);d=un.clamp(d,this.minFov,this.maxFov);const m=f/Math.tan(un.DEG2RAD*(d/2));c=u/m,this._v3_2.setFromMatrixPosition(this._gizmoMatrixState),this.setFov(d),this.applyTransformMatrix(this.applyScale(c,this._v3_2,!1));const A=this._gizmos.position.clone().sub(this.camera.position).normalize().multiplyScalar(m/u);this._m4_1.makeTranslation(A.x,A.y,A.z)}break}this.dispatchEvent(Sr)}}),tt(this,"onSinglePanEnd",()=>{if(this._state==En.ROTATE){if(!this.enableRotate)return;if(this.enableAnimations)if(performance.now()-this._timeCurrent<120){const s=Math.abs((this._wPrev+this._wCurr)/2),o=this;this._animationId=window.requestAnimationFrame(function(a){o.updateTbState(En.ANIMATION_ROTATE,!0);const l=o.calculateRotationAxis(o._cursorPosPrev,o._cursorPosCurr);o.onRotationAnim(a,l,Math.min(s,o.wMax))})}else this.updateTbState(En.IDLE,!1),this.activateGizmos(!1),this.dispatchEvent(Sr);else this.updateTbState(En.IDLE,!1),this.activateGizmos(!1),this.dispatchEvent(Sr)}else(this._state==En.PAN||this._state==En.IDLE)&&(this.updateTbState(En.IDLE,!1),this.enableGrid&&this.disposeGrid(),this.activateGizmos(!1),this.dispatchEvent(Sr));this.dispatchEvent(Zl)}),tt(this,"onDoubleTap",r=>{if(this.enabled&&this.enablePan&&this.scene&&this.camera&&this.domElement){this.dispatchEvent(ru),this.setCenter(r.clientX,r.clientY);const s=this.unprojectOnObj(this.getCursorNDC(ei.x,ei.y,this.domElement),this.camera);if(s&&this.enableAnimations){const o=this;this._animationId!=-1&&window.cancelAnimationFrame(this._animationId),this._timeStart=-1,this._animationId=window.requestAnimationFrame(function(a){o.updateTbState(En.ANIMATION_FOCUS,!0),o.onFocusAnim(a,s,o._cameraMatrixState,o._gizmoMatrixState)})}else s&&!this.enableAnimations&&(this.updateTbState(En.FOCUS,!0),this.focus(s,this.scaleFactor),this.updateTbState(En.IDLE,!1),this.dispatchEvent(Sr))}this.dispatchEvent(Zl)}),tt(this,"onDoublePanStart",()=>{if(this.enabled&&this.enablePan&&this.camera&&this.domElement){this.dispatchEvent(ru),this.updateTbState(En.PAN,!0),this.setCenter((this._touchCurrent[0].clientX+this._touchCurrent[1].clientX)/2,(this._touchCurrent[0].clientY+this._touchCurrent[1].clientY)/2);const r=this.unprojectOnTbPlane(this.camera,ei.x,ei.y,this.domElement,!0);r!==void 0&&this._startCursorPosition.copy(r),this._currentCursorPosition.copy(this._startCursorPosition),this.activateGizmos(!1)}}),tt(this,"onDoublePanMove",()=>{if(this.enabled&&this.enablePan&&this.camera&&this.domElement){this.setCenter((this._touchCurrent[0].clientX+this._touchCurrent[1].clientX)/2,(this._touchCurrent[0].clientY+this._touchCurrent[1].clientY)/2),this._state!=En.PAN&&(this.updateTbState(En.PAN,!0),this._startCursorPosition.copy(this._currentCursorPosition));const r=this.unprojectOnTbPlane(this.camera,ei.x,ei.y,this.domElement,!0);r!==void 0&&this._currentCursorPosition.copy(r),this.applyTransformMatrix(this.pan(this._startCursorPosition,this._currentCursorPosition,!0)),this.dispatchEvent(Sr)}}),tt(this,"onDoublePanEnd",()=>{this.updateTbState(En.IDLE,!1),this.dispatchEvent(Zl)}),tt(this,"onRotateStart",()=>{var r;this.enabled&&this.enableRotate&&(this.dispatchEvent(ru),this.updateTbState(En.ZROTATE,!0),this._startFingerRotation=this.getAngle(this._touchCurrent[1],this._touchCurrent[0])+this.getAngle(this._touchStart[1],this._touchStart[0]),this._currentFingerRotation=this._startFingerRotation,(r=this.camera)==null||r.getWorldDirection(this._rotationAxis),!this.enablePan&&!this.enableZoom&&this.activateGizmos(!0))}),tt(this,"onRotateMove",()=>{var r;if(this.enabled&&this.enableRotate&&this.camera&&this.domElement){this.setCenter((this._touchCurrent[0].clientX+this._touchCurrent[1].clientX)/2,(this._touchCurrent[0].clientY+this._touchCurrent[1].clientY)/2);let s;this._state!=En.ZROTATE&&(this.updateTbState(En.ZROTATE,!0),this._startFingerRotation=this._currentFingerRotation),this._currentFingerRotation=this.getAngle(this._touchCurrent[1],this._touchCurrent[0])+this.getAngle(this._touchStart[1],this._touchStart[0]),this.enablePan?this.camera&&(this._v3_2.setFromMatrixPosition(this._gizmoMatrixState),s=(r=this.unprojectOnTbPlane(this.camera,ei.x,ei.y,this.domElement))==null?void 0:r.applyQuaternion(this.camera.quaternion).multiplyScalar(1/this.camera.zoom).add(this._v3_2)):s=new H().setFromMatrixPosition(this._gizmoMatrixState);const o=un.DEG2RAD*(this._startFingerRotation-this._currentFingerRotation);s!==void 0&&this.applyTransformMatrix(this.zRotate(s,o)),this.dispatchEvent(Sr)}}),tt(this,"onRotateEnd",()=>{this.updateTbState(En.IDLE,!1),this.activateGizmos(!1),this.dispatchEvent(Zl)}),tt(this,"onPinchStart",()=>{this.enabled&&this.enableZoom&&(this.dispatchEvent(ru),this.updateTbState(En.SCALE,!0),this._startFingerDistance=this.calculatePointersDistance(this._touchCurrent[0],this._touchCurrent[1]),this._currentFingerDistance=this._startFingerDistance,this.activateGizmos(!1))}),tt(this,"onPinchMove",()=>{var r,s;if(this.enabled&&this.enableZoom&&this.domElement){this.setCenter((this._touchCurrent[0].clientX+this._touchCurrent[1].clientX)/2,(this._touchCurrent[0].clientY+this._touchCurrent[1].clientY)/2);const o=12;this._state!=En.SCALE&&(this._startFingerDistance=this._currentFingerDistance,this.updateTbState(En.SCALE,!0)),this._currentFingerDistance=Math.max(this.calculatePointersDistance(this._touchCurrent[0],this._touchCurrent[1]),o*this._devPxRatio);const a=this._currentFingerDistance/this._startFingerDistance;let l;this.enablePan?this.camera instanceof qi?l=(r=this.unprojectOnTbPlane(this.camera,ei.x,ei.y,this.domElement))==null?void 0:r.applyQuaternion(this.camera.quaternion).multiplyScalar(1/this.camera.zoom).add(this._gizmos.position):this.camera instanceof Wn&&(l=(s=this.unprojectOnTbPlane(this.camera,ei.x,ei.y,this.domElement))==null?void 0:s.applyQuaternion(this.camera.quaternion).add(this._gizmos.position)):l=this._gizmos.position,l!==void 0&&this.applyTransformMatrix(this.applyScale(a,l)),this.dispatchEvent(Sr)}}),tt(this,"onPinchEnd",()=>{this.updateTbState(En.IDLE,!1),this.dispatchEvent(Zl)}),tt(this,"onTriplePanStart",()=>{if(this.enabled&&this.enableZoom&&this.domElement){this.dispatchEvent(ru),this.updateTbState(En.SCALE,!0);let r=0,s=0;const o=this._touchCurrent.length;for(let a=0;a<o;a++)r+=this._touchCurrent[a].clientX,s+=this._touchCurrent[a].clientY;this.setCenter(r/o,s/o),this._startCursorPosition.setY(this.getCursorNDC(ei.x,ei.y,this.domElement).y*.5),this._currentCursorPosition.copy(this._startCursorPosition)}}),tt(this,"onTriplePanMove",()=>{if(this.enabled&&this.enableZoom&&this.camera&&this.domElement){let r=0,s=0;const o=this._touchCurrent.length;for(let g=0;g<o;g++)r+=this._touchCurrent[g].clientX,s+=this._touchCurrent[g].clientY;this.setCenter(r/o,s/o);const a=8;this._currentCursorPosition.setY(this.getCursorNDC(ei.x,ei.y,this.domElement).y*.5);const l=this._currentCursorPosition.y-this._startCursorPosition.y;let c=1;l<0?c=1/Math.pow(this.scaleFactor,-l*a):l>0&&(c=Math.pow(this.scaleFactor,l*a)),this._v3_1.setFromMatrixPosition(this._cameraMatrixState);const u=this._v3_1.distanceTo(this._gizmos.position);let h=u/c;h=un.clamp(h,this.minDistance,this.maxDistance);const f=u*Math.tan(un.DEG2RAD*this._fovState*.5);let d=un.RAD2DEG*(Math.atan(f/h)*2);d=un.clamp(d,this.minFov,this.maxFov);const m=f/Math.tan(un.DEG2RAD*(d/2));c=u/m,this._v3_2.setFromMatrixPosition(this._gizmoMatrixState),this.setFov(d),this.applyTransformMatrix(this.applyScale(c,this._v3_2,!1));const A=this._gizmos.position.clone().sub(this.camera.position).normalize().multiplyScalar(m/u);this._m4_1.makeTranslation(A.x,A.y,A.z),this.dispatchEvent(Sr)}}),tt(this,"onTriplePanEnd",()=>{this.updateTbState(En.IDLE,!1),this.dispatchEvent(Zl)}),tt(this,"setCenter",(r,s)=>{ei.x=r,ei.y=s}),tt(this,"initializeMouseActions",()=>{this.setMouseAction("PAN",0,"CTRL"),this.setMouseAction("PAN",2),this.setMouseAction("ROTATE",0),this.setMouseAction("ZOOM","WHEEL"),this.setMouseAction("ZOOM",1),this.setMouseAction("FOV","WHEEL","SHIFT"),this.setMouseAction("FOV",1,"SHIFT")}),tt(this,"setMouseAction",(r,s,o=null)=>{const a=["PAN","ROTATE","ZOOM","FOV"],l=[0,1,2,"WHEEL"],c=["CTRL","SHIFT",null];let u;if(!a.includes(r)||!l.includes(s)||!c.includes(o)||s=="WHEEL"&&r!="ZOOM"&&r!="FOV")return!1;switch(r){case"PAN":u=En.PAN;break;case"ROTATE":u=En.ROTATE;break;case"ZOOM":u=En.SCALE;break;case"FOV":u=En.FOV;break}const h={operation:r,mouse:s,key:o,state:u};for(let f=0;f<this.mouseActions.length;f++)if(this.mouseActions[f].mouse==h.mouse&&this.mouseActions[f].key==h.key)return this.mouseActions.splice(f,1,h),!0;return this.mouseActions.push(h),!0}),tt(this,"getOpFromAction",(r,s)=>{let o;for(let a=0;a<this.mouseActions.length;a++)if(o=this.mouseActions[a],o.mouse==r&&o.key==s)return o.operation;if(s){for(let a=0;a<this.mouseActions.length;a++)if(o=this.mouseActions[a],o.mouse==r&&o.key==null)return o.operation}return null}),tt(this,"getOpStateFromAction",(r,s)=>{let o;for(let a=0;a<this.mouseActions.length;a++)if(o=this.mouseActions[a],o.mouse==r&&o.key==s)return o.state;if(s){for(let a=0;a<this.mouseActions.length;a++)if(o=this.mouseActions[a],o.mouse==r&&o.key==null)return o.state}return null}),tt(this,"getAngle",(r,s)=>Math.atan2(s.clientY-r.clientY,s.clientX-r.clientX)*180/Math.PI),tt(this,"updateTouchEvent",r=>{for(let s=0;s<this._touchCurrent.length;s++)if(this._touchCurrent[s].pointerId==r.pointerId){this._touchCurrent.splice(s,1,r);break}}),tt(this,"calculateAngularSpeed",(r,s,o,a)=>{const l=s-r,c=(a-o)/1e3;return c==0?0:l/c}),tt(this,"calculatePointersDistance",(r,s)=>Math.sqrt(Math.pow(s.clientX-r.clientX,2)+Math.pow(s.clientY-r.clientY,2))),tt(this,"calculateRotationAxis",(r,s)=>(this._rotationMatrix.extractRotation(this._cameraMatrixState),this._quat.setFromRotationMatrix(this._rotationMatrix),this._rotationAxis.crossVectors(r,s).applyQuaternion(this._quat),this._rotationAxis.normalize().clone())),tt(this,"calculateTbRadius",r=>{const o=r.position.distanceTo(this._gizmos.position);if(r instanceof Wn){const a=un.DEG2RAD*r.fov*.5,l=Math.atan(r.aspect*Math.tan(a));return Math.tan(Math.min(a,l))*o*.67}else if(r instanceof qi)return Math.min(r.top,r.right)*.67}),tt(this,"focus",(r,s,o=1)=>{if(this.camera){const a=r.clone();a.sub(this._gizmos.position).multiplyScalar(o),this._translationMatrix.makeTranslation(a.x,a.y,a.z);const l=this._gizmoMatrixState.clone();this._gizmoMatrixState.premultiply(this._translationMatrix),this._gizmoMatrixState.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale);const c=this._cameraMatrixState.clone();this._cameraMatrixState.premultiply(this._translationMatrix),this._cameraMatrixState.decompose(this.camera.position,this.camera.quaternion,this.camera.scale),this.enableZoom&&this.applyTransformMatrix(this.applyScale(s,this._gizmos.position)),this._gizmoMatrixState.copy(l),this._cameraMatrixState.copy(c)}}),tt(this,"drawGrid",()=>{if(this.scene){let o,a,l,c;if(this.camera instanceof qi){const u=this.camera.right-this.camera.left,h=this.camera.bottom-this.camera.top;l=Math.max(u,h),c=l/20,o=l/this.camera.zoom*3,a=o/c*this.camera.zoom}else if(this.camera instanceof Wn){const u=this.camera.position.distanceTo(this._gizmos.position),h=un.DEG2RAD*this.camera.fov*.5,f=Math.atan(this.camera.aspect*Math.tan(h));l=Math.tan(Math.max(h,f))*u*2,c=l/20,o=l*3,a=o/c}this._grid==null&&this.camera&&(this._grid=new Tz(o,a,8947848,8947848),this._grid.position.copy(this._gizmos.position),this._gridPosition.copy(this._grid.position),this._grid.quaternion.copy(this.camera.quaternion),this._grid.rotateX(Math.PI*.5),this.scene.add(this._grid))}}),tt(this,"connect",r=>{r===document&&console.error('THREE.ArcballControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.domElement=r,this.domElement.style.touchAction="none",this.domElement.addEventListener("contextmenu",this.onContextMenu),this.domElement.addEventListener("pointerdown",this.onPointerDown),this.domElement.addEventListener("pointercancel",this.onPointerCancel),this.domElement.addEventListener("wheel",this.onWheel)}),tt(this,"dispose",()=>{var r,s,o,a,l;this._animationId!=-1&&window.cancelAnimationFrame(this._animationId),(r=this.domElement)==null||r.removeEventListener("pointerdown",this.onPointerDown),(s=this.domElement)==null||s.removeEventListener("pointercancel",this.onPointerCancel),(o=this.domElement)==null||o.removeEventListener("wheel",this.onWheel),(a=this.domElement)==null||a.removeEventListener("contextmenu",this.onContextMenu),window.removeEventListener("pointermove",this.onPointerMove),window.removeEventListener("pointerup",this.onPointerUp),window.removeEventListener("resize",this.onWindowResize),(l=this.scene)==null||l.remove(this._gizmos),this.disposeGrid()}),tt(this,"disposeGrid",()=>{this._grid&&this.scene&&(this.scene.remove(this._grid),this._grid=null)}),tt(this,"easeOutCubic",r=>1-Math.pow(1-r,3)),tt(this,"activateGizmos",r=>{for(const s of this._gizmos.children)s.material.setValues({opacity:r?1:.6})}),tt(this,"getCursorNDC",(r,s,o)=>{const a=o.getBoundingClientRect();return this._v2_1.setX((r-a.left)/a.width*2-1),this._v2_1.setY((a.bottom-s)/a.height*2-1),this._v2_1.clone()}),tt(this,"getCursorPosition",(r,s,o)=>(this._v2_1.copy(this.getCursorNDC(r,s,o)),this.camera instanceof qi&&(this._v2_1.x*=(this.camera.right-this.camera.left)*.5,this._v2_1.y*=(this.camera.top-this.camera.bottom)*.5),this._v2_1.clone())),tt(this,"setCamera",r=>{if(r){r.lookAt(this.target),r.updateMatrix(),r instanceof Wn&&(this._fov0=r.fov,this._fovState=r.fov),this._cameraMatrixState0.copy(r.matrix),this._cameraMatrixState.copy(this._cameraMatrixState0),this._cameraProjectionState.copy(r.projectionMatrix),this._zoom0=r.zoom,this._zoomState=this._zoom0,this._initialNear=r.near,this._nearPos0=r.position.distanceTo(this.target)-r.near,this._nearPos=this._initialNear,this._initialFar=r.far,this._farPos0=r.position.distanceTo(this.target)-r.far,this._farPos=this._initialFar,this._up0.copy(r.up),this._upState.copy(r.up),this.camera=r,this.camera.updateProjectionMatrix();const s=this.calculateTbRadius(r);s!==void 0&&(this._tbRadius=s),this.makeGizmos(this.target,this._tbRadius)}}),tt(this,"makeGizmos",(r,s)=>{const a=new Gm(0,0,s,s).getPoints(this._curvePts),l=new fn().setFromPoints(a),c=new vs({color:16744576,fog:!1,transparent:!0,opacity:.6}),u=new vs({color:8454016,fog:!1,transparent:!0,opacity:.6}),h=new vs({color:8421631,fog:!1,transparent:!0,opacity:.6}),f=new Yn(l,c),d=new Yn(l,u),m=new Yn(l,h),A=Math.PI*.5;if(f.rotation.x=A,d.rotation.y=A,this._gizmoMatrixState0.identity().setPosition(r),this._gizmoMatrixState.copy(this._gizmoMatrixState0),this.camera&&this.camera.zoom!=1){const g=1/this.camera.zoom;this._scaleMatrix.makeScale(g,g,g),this._translationMatrix.makeTranslation(-r.x,-r.y,-r.z),this._gizmoMatrixState.premultiply(this._translationMatrix).premultiply(this._scaleMatrix),this._translationMatrix.makeTranslation(r.x,r.y,r.z),this._gizmoMatrixState.premultiply(this._translationMatrix)}this._gizmoMatrixState.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale),this._gizmos.clear(),this._gizmos.add(f),this._gizmos.add(d),this._gizmos.add(m)}),tt(this,"onFocusAnim",(r,s,o,a)=>{if(this._timeStart==-1&&(this._timeStart=r),this._state==En.ANIMATION_FOCUS){const c=(r-this._timeStart)/this.focusAnimationTime;if(this._gizmoMatrixState.copy(a),c>=1)this._gizmoMatrixState.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale),this.focus(s,this.scaleFactor),this._timeStart=-1,this.updateTbState(En.IDLE,!1),this.activateGizmos(!1),this.dispatchEvent(Sr);else{const u=this.easeOutCubic(c),h=1-u+this.scaleFactor*u;this._gizmoMatrixState.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale),this.focus(s,h,u),this.dispatchEvent(Sr);const f=this;this._animationId=window.requestAnimationFrame(function(d){f.onFocusAnim(d,s,o,a.clone())})}}else this._animationId=-1,this._timeStart=-1}),tt(this,"onRotationAnim",(r,s,o)=>{if(this._timeStart==-1&&(this._anglePrev=0,this._angleCurrent=0,this._timeStart=r),this._state==En.ANIMATION_ROTATE){const a=(r-this._timeStart)/1e3;if(o+-this.dampingFactor*a>0){this._angleCurrent=.5*-this.dampingFactor*Math.pow(a,2)+o*a+0,this.applyTransformMatrix(this.rotate(s,this._angleCurrent)),this.dispatchEvent(Sr);const c=this;this._animationId=window.requestAnimationFrame(function(u){c.onRotationAnim(u,s,o)})}else this._animationId=-1,this._timeStart=-1,this.updateTbState(En.IDLE,!1),this.activateGizmos(!1),this.dispatchEvent(Sr)}else this._animationId=-1,this._timeStart=-1,this._state!=En.ROTATE&&(this.activateGizmos(!1),this.dispatchEvent(Sr))}),tt(this,"pan",(r,s,o=!1)=>{if(this.camera){const a=r.clone().sub(s);if(this.camera instanceof qi&&a.multiplyScalar(1/this.camera.zoom),this.camera instanceof Wn&&o){this._v3_1.setFromMatrixPosition(this._cameraMatrixState0),this._v3_2.setFromMatrixPosition(this._gizmoMatrixState0);const l=this._v3_1.distanceTo(this._v3_2)/this.camera.position.distanceTo(this._gizmos.position);a.multiplyScalar(1/l)}this._v3_1.set(a.x,a.y,0).applyQuaternion(this.camera.quaternion),this._m4_1.makeTranslation(this._v3_1.x,this._v3_1.y,this._v3_1.z),this.setTransformationMatrices(this._m4_1,this._m4_1)}return xl}),tt(this,"reset",()=>{if(this.camera){this.camera.zoom=this._zoom0,this.camera instanceof Wn&&(this.camera.fov=this._fov0),this.camera.near=this._nearPos,this.camera.far=this._farPos,this._cameraMatrixState.copy(this._cameraMatrixState0),this._cameraMatrixState.decompose(this.camera.position,this.camera.quaternion,this.camera.scale),this.camera.up.copy(this._up0),this.camera.updateMatrix(),this.camera.updateProjectionMatrix(),this._gizmoMatrixState.copy(this._gizmoMatrixState0),this._gizmoMatrixState0.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale),this._gizmos.updateMatrix();const r=this.calculateTbRadius(this.camera);r!==void 0&&(this._tbRadius=r),this.makeGizmos(this._gizmos.position,this._tbRadius),this.camera.lookAt(this._gizmos.position),this.updateTbState(En.IDLE,!1),this.dispatchEvent(Sr)}}),tt(this,"rotate",(r,s)=>{const o=this._gizmos.position;return this._translationMatrix.makeTranslation(-o.x,-o.y,-o.z),this._rotationMatrix.makeRotationAxis(r,-s),this._m4_1.makeTranslation(o.x,o.y,o.z),this._m4_1.multiply(this._rotationMatrix),this._m4_1.multiply(this._translationMatrix),this.setTransformationMatrices(this._m4_1),xl}),tt(this,"copyState",()=>{if(this.camera){const r=JSON.stringify(this.camera instanceof qi?{arcballState:{cameraFar:this.camera.far,cameraMatrix:this.camera.matrix,cameraNear:this.camera.near,cameraUp:this.camera.up,cameraZoom:this.camera.zoom,gizmoMatrix:this._gizmos.matrix}}:{arcballState:{cameraFar:this.camera.far,cameraFov:this.camera.fov,cameraMatrix:this.camera.matrix,cameraNear:this.camera.near,cameraUp:this.camera.up,cameraZoom:this.camera.zoom,gizmoMatrix:this._gizmos.matrix}});navigator.clipboard.writeText(r)}}),tt(this,"pasteState",()=>{const r=this;navigator.clipboard.readText().then(function(o){r.setStateFromJSON(o)})}),tt(this,"saveState",()=>{this.camera&&(this._cameraMatrixState0.copy(this.camera.matrix),this._gizmoMatrixState0.copy(this._gizmos.matrix),this._nearPos=this.camera.near,this._farPos=this.camera.far,this._zoom0=this.camera.zoom,this._up0.copy(this.camera.up),this.camera instanceof Wn&&(this._fov0=this.camera.fov))}),tt(this,"applyScale",(r,s,o=!0)=>{if(!this.camera)return;const a=s.clone();let l=1/r;if(this.camera instanceof qi){this.camera.zoom=this._zoomState,this.camera.zoom*=r,this.camera.zoom>this.maxZoom?(this.camera.zoom=this.maxZoom,l=this._zoomState/this.maxZoom):this.camera.zoom<this.minZoom&&(this.camera.zoom=this.minZoom,l=this._zoomState/this.minZoom),this.camera.updateProjectionMatrix(),this._v3_1.setFromMatrixPosition(this._gizmoMatrixState),this._scaleMatrix.makeScale(l,l,l),this._translationMatrix.makeTranslation(-this._v3_1.x,-this._v3_1.y,-this._v3_1.z),this._m4_2.makeTranslation(this._v3_1.x,this._v3_1.y,this._v3_1.z).multiply(this._scaleMatrix),this._m4_2.multiply(this._translationMatrix),a.sub(this._v3_1);const c=a.clone().multiplyScalar(l);return a.sub(c),this._m4_1.makeTranslation(a.x,a.y,a.z),this._m4_2.premultiply(this._m4_1),this.setTransformationMatrices(this._m4_1,this._m4_2),xl}if(this.camera instanceof Wn){this._v3_1.setFromMatrixPosition(this._cameraMatrixState),this._v3_2.setFromMatrixPosition(this._gizmoMatrixState);let c=this._v3_1.distanceTo(a),u=c-c*l;const h=c-u;h<this.minDistance?(l=this.minDistance/c,u=c-c*l):h>this.maxDistance&&(l=this.maxDistance/c,u=c-c*l);let f=a.clone().sub(this._v3_1).normalize().multiplyScalar(u);if(this._m4_1.makeTranslation(f.x,f.y,f.z),o){const d=this._v3_2;c=d.distanceTo(a),u=c-c*l,f=a.clone().sub(this._v3_2).normalize().multiplyScalar(u),this._translationMatrix.makeTranslation(d.x,d.y,d.z),this._scaleMatrix.makeScale(l,l,l),this._m4_2.makeTranslation(f.x,f.y,f.z).multiply(this._translationMatrix),this._m4_2.multiply(this._scaleMatrix),this._translationMatrix.makeTranslation(-d.x,-d.y,-d.z),this._m4_2.multiply(this._translationMatrix),this.setTransformationMatrices(this._m4_1,this._m4_2)}else this.setTransformationMatrices(this._m4_1);return xl}}),tt(this,"setFov",r=>{this.camera instanceof Wn&&(this.camera.fov=un.clamp(r,this.minFov,this.maxFov),this.camera.updateProjectionMatrix())}),tt(this,"setTarget",(r,s,o)=>{if(this.camera){this.target.set(r,s,o),this._gizmos.position.set(r,s,o);const a=this.calculateTbRadius(this.camera);a!==void 0&&(this._tbRadius=a),this.makeGizmos(this.target,this._tbRadius),this.camera.lookAt(this.target)}}),tt(this,"zRotate",(r,s)=>(this._rotationMatrix.makeRotationAxis(this._rotationAxis,s),this._translationMatrix.makeTranslation(-r.x,-r.y,-r.z),this._m4_1.makeTranslation(r.x,r.y,r.z),this._m4_1.multiply(this._rotationMatrix),this._m4_1.multiply(this._translationMatrix),this._v3_1.setFromMatrixPosition(this._gizmoMatrixState).sub(r),this._v3_2.copy(this._v3_1).applyAxisAngle(this._rotationAxis,s),this._v3_2.sub(this._v3_1),this._m4_2.makeTranslation(this._v3_2.x,this._v3_2.y,this._v3_2.z),this.setTransformationMatrices(this._m4_1,this._m4_2),xl)),tt(this,"unprojectOnObj",(r,s)=>{if(!this.scene)return null;const o=new A0;o.near=s.near,o.far=s.far,o.setFromCamera(r,s);const a=o.intersectObjects(this.scene.children,!0);for(let l=0;l<a.length;l++)if(a[l].object.uuid!=this._gizmos.uuid&&a[l].face)return a[l].point.clone();return null}),tt(this,"unprojectOnTbSurface",(r,s,o,a,l)=>{if(r instanceof qi){this._v2_1.copy(this.getCursorPosition(s,o,a)),this._v3_1.set(this._v2_1.x,this._v2_1.y,0);const c=Math.pow(this._v2_1.x,2),u=Math.pow(this._v2_1.y,2),h=Math.pow(this._tbRadius,2);return c+u<=h*.5?this._v3_1.setZ(Math.sqrt(h-(c+u))):this._v3_1.setZ(h*.5/Math.sqrt(c+u)),this._v3_1}if(r instanceof Wn){this._v2_1.copy(this.getCursorNDC(s,o,a)),this._v3_1.set(this._v2_1.x,this._v2_1.y,-1),this._v3_1.applyMatrix4(r.projectionMatrixInverse);const c=this._v3_1.clone().normalize(),u=r.position.distanceTo(this._gizmos.position),h=Math.pow(l,2),f=this._v3_1.z,d=Math.sqrt(Math.pow(this._v3_1.x,2)+Math.pow(this._v3_1.y,2));if(d==0)return c.set(this._v3_1.x,this._v3_1.y,l),c;const m=f/d,A=u;let g=Math.pow(m,2)+1,y=2*m*A,E=Math.pow(A,2)-h,x=Math.pow(y,2)-4*g*E;if(x>=0&&(this._v2_1.setX((-y-Math.sqrt(x))/(2*g)),this._v2_1.setY(m*this._v2_1.x+A),un.RAD2DEG*this._v2_1.angle()>=45)){const I=Math.sqrt(Math.pow(this._v2_1.x,2)+Math.pow(u-this._v2_1.y,2));return c.multiplyScalar(I),c.z+=u,c}g=m,y=A,E=-h*.5,x=Math.pow(y,2)-4*g*E,this._v2_1.setX((-y-Math.sqrt(x))/(2*g)),this._v2_1.setY(m*this._v2_1.x+A);const C=Math.sqrt(Math.pow(this._v2_1.x,2)+Math.pow(u-this._v2_1.y,2));return c.multiplyScalar(C),c.z+=u,c}}),tt(this,"unprojectOnTbPlane",(r,s,o,a,l=!1)=>{if(r instanceof qi)return this._v2_1.copy(this.getCursorPosition(s,o,a)),this._v3_1.set(this._v2_1.x,this._v2_1.y,0),this._v3_1.clone();if(r instanceof Wn){this._v2_1.copy(this.getCursorNDC(s,o,a)),this._v3_1.set(this._v2_1.x,this._v2_1.y,-1),this._v3_1.applyMatrix4(r.projectionMatrixInverse);const c=this._v3_1.clone().normalize(),u=this._v3_1.z,h=Math.sqrt(Math.pow(this._v3_1.x,2)+Math.pow(this._v3_1.y,2));let f;if(l?f=this._v3_1.setFromMatrixPosition(this._cameraMatrixState0).distanceTo(this._v3_2.setFromMatrixPosition(this._gizmoMatrixState0)):f=r.position.distanceTo(this._gizmos.position),h==0)return c.set(0,0,0),c;const d=u/h,m=f,A=-m/d,g=Math.sqrt(Math.pow(m,2)+Math.pow(A,2));return c.multiplyScalar(g),c.z=0,c}}),tt(this,"updateMatrixState",()=>{this.camera&&(this._cameraMatrixState.copy(this.camera.matrix),this._gizmoMatrixState.copy(this._gizmos.matrix),this.camera instanceof qi&&(this._cameraProjectionState.copy(this.camera.projectionMatrix),this.camera.updateProjectionMatrix(),this._zoomState=this.camera.zoom),this.camera instanceof Wn&&(this._fovState=this.camera.fov))}),tt(this,"updateTbState",(r,s)=>{this._state=r,s&&this.updateMatrixState()}),tt(this,"update",()=>{if(!this.target.equals(this._currentTarget)&&this.camera){this._gizmos.position.set(this.target.x,this.target.y,this.target.z);const s=this.calculateTbRadius(this.camera);s!==void 0&&(this._tbRadius=s),this.makeGizmos(this.target,this._tbRadius),this._currentTarget.copy(this.target)}if(this.camera){if(this.camera instanceof qi&&(this.camera.zoom>this.maxZoom||this.camera.zoom<this.minZoom)){const s=un.clamp(this.camera.zoom,this.minZoom,this.maxZoom);this.applyTransformMatrix(this.applyScale(s/this.camera.zoom,this._gizmos.position,!0))}if(this.camera instanceof Wn){const s=this.camera.position.distanceTo(this._gizmos.position);if(s>this.maxDistance+1e-6||s<this.minDistance-1e-6){const l=un.clamp(s,this.minDistance,this.maxDistance);this.applyTransformMatrix(this.applyScale(l/s,this._gizmos.position)),this.updateMatrixState()}(this.camera.fov<this.minFov||this.camera.fov>this.maxFov)&&(this.camera.fov=un.clamp(this.camera.fov,this.minFov,this.maxFov),this.camera.updateProjectionMatrix());const o=this._tbRadius,a=this.calculateTbRadius(this.camera);if(a!==void 0&&(this._tbRadius=a),o<this._tbRadius-1e-6||o>this._tbRadius+1e-6){const l=(this._gizmos.scale.x+this._gizmos.scale.y+this._gizmos.scale.z)/3,c=this._tbRadius/l,h=new Gm(0,0,c,c).getPoints(this._curvePts),f=new fn().setFromPoints(h);for(const d in this._gizmos.children){const m=this._gizmos.children[d];m.geometry=f}}}this.camera.lookAt(this._gizmos.position)}}),tt(this,"setStateFromJSON",r=>{const s=JSON.parse(r);if(s.arcballState&&this.camera){this._cameraMatrixState.fromArray(s.arcballState.cameraMatrix.elements),this._cameraMatrixState.decompose(this.camera.position,this.camera.quaternion,this.camera.scale),this.camera.up.copy(s.arcballState.cameraUp),this.camera.near=s.arcballState.cameraNear,this.camera.far=s.arcballState.cameraFar,this.camera.zoom=s.arcballState.cameraZoom,this.camera instanceof Wn&&(this.camera.fov=s.arcballState.cameraFov),this._gizmoMatrixState.fromArray(s.arcballState.gizmoMatrix.elements),this._gizmoMatrixState.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale),this.camera.updateMatrix(),this.camera.updateProjectionMatrix(),this._gizmos.updateMatrix();const o=this.calculateTbRadius(this.camera);o!==void 0&&(this._tbRadius=o);const a=new Xe().copy(this._gizmoMatrixState0);this.makeGizmos(this._gizmos.position,this._tbRadius),this._gizmoMatrixState0.copy(a),this.camera.lookAt(this._gizmos.position),this.updateTbState(En.IDLE,!1),this.dispatchEvent(Sr)}}),this.camera=null,this.domElement=t,this.scene=n,this.mouseActions=[],this._mouseOp=null,this._v2_1=new Ue,this._v3_1=new H,this._v3_2=new H,this._m4_1=new Xe,this._m4_2=new Xe,this._quat=new Xt,this._translationMatrix=new Xe,this._rotationMatrix=new Xe,this._scaleMatrix=new Xe,this._rotationAxis=new H,this._cameraMatrixState=new Xe,this._cameraProjectionState=new Xe,this._fovState=1,this._upState=new H,this._zoomState=1,this._nearPos=0,this._farPos=0,this._gizmoMatrixState=new Xe,this._up0=new H,this._zoom0=1,this._fov0=0,this._initialNear=0,this._nearPos0=0,this._initialFar=0,this._farPos0=0,this._cameraMatrixState0=new Xe,this._gizmoMatrixState0=new Xe,this._button=-1,this._touchStart=[],this._touchCurrent=[],this._input=Hi.NONE,this._switchSensibility=32,this._startFingerDistance=0,this._currentFingerDistance=0,this._startFingerRotation=0,this._currentFingerRotation=0,this._devPxRatio=0,this._downValid=!0,this._nclicks=0,this._downEvents=[],this._clickStart=0,this._maxDownTime=250,this._maxInterval=300,this._posThreshold=24,this._movementThreshold=24,this._currentCursorPosition=new H,this._startCursorPosition=new H,this._grid=null,this._gridPosition=new H,this._gizmos=new xa,this._curvePts=128,this._timeStart=-1,this._animationId=-1,this.focusAnimationTime=500,this._timePrev=0,this._timeCurrent=0,this._anglePrev=0,this._angleCurrent=0,this._cursorPosPrev=new H,this._cursorPosCurr=new H,this._wPrev=0,this._wCurr=0,this.adjustNearFar=!1,this.scaleFactor=1.1,this.dampingFactor=25,this.wMax=20,this.enableAnimations=!0,this.enableGrid=!1,this.cursorZoom=!1,this.minFov=5,this.maxFov=90,this.enabled=!0,this.enablePan=!0,this.enableRotate=!0,this.enableZoom=!0,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.target=new H(0,0,0),this._currentTarget=new H(0,0,0),this._tbRadius=1,this._state=En.IDLE,this.setCamera(e),this.scene&&this.scene.add(this._gizmos),this._devPxRatio=window.devicePixelRatio,this.initializeMouseActions(),this.domElement&&this.connect(this.domElement),window.addEventListener("resize",this.onWindowResize)}applyTransformMatrix(e){if(e!=null&&e.camera&&this.camera&&(this._m4_1.copy(this._cameraMatrixState).premultiply(e.camera),this._m4_1.decompose(this.camera.position,this.camera.quaternion,this.camera.scale),this.camera.updateMatrix(),(this._state==En.ROTATE||this._state==En.ZROTATE||this._state==En.ANIMATION_ROTATE)&&this.camera.up.copy(this._upState).applyQuaternion(this.camera.quaternion)),e!=null&&e.gizmos&&(this._m4_1.copy(this._gizmoMatrixState).premultiply(e.gizmos),this._m4_1.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale),this._gizmos.updateMatrix()),(this._state==En.SCALE||this._state==En.FOCUS||this._state==En.ANIMATION_FOCUS)&&this.camera){const t=this.calculateTbRadius(this.camera);if(t!==void 0&&(this._tbRadius=t),this.adjustNearFar){const n=this.camera.position.distanceTo(this._gizmos.position),r=new ti;r.setFromObject(this._gizmos);const s=new Bi;r.getBoundingSphere(s);const o=Math.max(this._nearPos0,s.radius+s.center.length()),a=n-this._initialNear,l=Math.min(o,a);this.camera.near=n-l;const c=Math.min(this._farPos0,-s.radius+s.center.length()),u=n-this._initialFar,h=Math.min(c,u);this.camera.far=n-h,this.camera.updateProjectionMatrix()}else{let n=!1;this.camera.near!=this._initialNear&&(this.camera.near=this._initialNear,n=!0),this.camera.far!=this._initialFar&&(this.camera.far=this._initialFar,n=!0),n&&this.camera.updateProjectionMatrix()}}}setGizmosVisible(e){this._gizmos.visible=e,this.dispatchEvent(Sr)}setTransformationMatrices(e=null,t=null){e?xl.camera?xl.camera.copy(e):xl.camera=e.clone():xl.camera=null,t?xl.gizmos?xl.gizmos.copy(t):xl.gizmos=t.clone():xl.gizmos=null}};var fce=Object.defineProperty,dce=(i,e,t)=>e in i?fce(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,sr=(i,e,t)=>(dce(i,typeof e!="symbol"?e+"":e,t),t);function C9(i){i.preventDefault()}let pce=class extends v0{constructor(e,t){super(),sr(this,"object"),sr(this,"domElement",null),sr(this,"movementSpeed",1),sr(this,"rollSpeed",.005),sr(this,"dragToLook",!1),sr(this,"autoForward",!1),sr(this,"changeEvent",{type:"change"}),sr(this,"EPS",1e-6),sr(this,"tmpQuaternion",new Xt),sr(this,"mouseStatus",0),sr(this,"movementSpeedMultiplier",1),sr(this,"moveState",{up:0,down:0,left:0,right:0,forward:0,back:0,pitchUp:0,pitchDown:0,yawLeft:0,yawRight:0,rollLeft:0,rollRight:0}),sr(this,"moveVector",new H(0,0,0)),sr(this,"rotationVector",new H(0,0,0)),sr(this,"keydown",n=>{if(!n.altKey){switch(n.code){case"ShiftLeft":case"ShiftRight":this.movementSpeedMultiplier=.1;break;case"KeyW":this.moveState.forward=1;break;case"KeyS":this.moveState.back=1;break;case"KeyA":this.moveState.left=1;break;case"KeyD":this.moveState.right=1;break;case"KeyR":this.moveState.up=1;break;case"KeyF":this.moveState.down=1;break;case"ArrowUp":this.moveState.pitchUp=1;break;case"ArrowDown":this.moveState.pitchDown=1;break;case"ArrowLeft":this.moveState.yawLeft=1;break;case"ArrowRight":this.moveState.yawRight=1;break;case"KeyQ":this.moveState.rollLeft=1;break;case"KeyE":this.moveState.rollRight=1;break}this.updateMovementVector(),this.updateRotationVector()}}),sr(this,"keyup",n=>{switch(n.code){case"ShiftLeft":case"ShiftRight":this.movementSpeedMultiplier=1;break;case"KeyW":this.moveState.forward=0;break;case"KeyS":this.moveState.back=0;break;case"KeyA":this.moveState.left=0;break;case"KeyD":this.moveState.right=0;break;case"KeyR":this.moveState.up=0;break;case"KeyF":this.moveState.down=0;break;case"ArrowUp":this.moveState.pitchUp=0;break;case"ArrowDown":this.moveState.pitchDown=0;break;case"ArrowLeft":this.moveState.yawLeft=0;break;case"ArrowRight":this.moveState.yawRight=0;break;case"KeyQ":this.moveState.rollLeft=0;break;case"KeyE":this.moveState.rollRight=0;break}this.updateMovementVector(),this.updateRotationVector()}),sr(this,"pointerdown",n=>{if(this.dragToLook)this.mouseStatus++;else{switch(n.button){case 0:this.moveState.forward=1;break;case 2:this.moveState.back=1;break}this.updateMovementVector()}}),sr(this,"pointermove",n=>{if(!this.dragToLook||this.mouseStatus>0){const r=this.getContainerDimensions(),s=r.size[0]/2,o=r.size[1]/2;this.moveState.yawLeft=-(n.pageX-r.offset[0]-s)/s,this.moveState.pitchDown=(n.pageY-r.offset[1]-o)/o,this.updateRotationVector()}}),sr(this,"pointerup",n=>{if(this.dragToLook)this.mouseStatus--,this.moveState.yawLeft=this.moveState.pitchDown=0;else{switch(n.button){case 0:this.moveState.forward=0;break;case 2:this.moveState.back=0;break}this.updateMovementVector()}this.updateRotationVector()}),sr(this,"lastQuaternion",new Xt),sr(this,"lastPosition",new H),sr(this,"update",n=>{const r=n*this.movementSpeed,s=n*this.rollSpeed;this.object.translateX(this.moveVector.x*r),this.object.translateY(this.moveVector.y*r),this.object.translateZ(this.moveVector.z*r),this.tmpQuaternion.set(this.rotationVector.x*s,this.rotationVector.y*s,this.rotationVector.z*s,1).normalize(),this.object.quaternion.multiply(this.tmpQuaternion),(this.lastPosition.distanceToSquared(this.object.position)>this.EPS||8*(1-this.lastQuaternion.dot(this.object.quaternion))>this.EPS)&&(this.dispatchEvent(this.changeEvent),this.lastQuaternion.copy(this.object.quaternion),this.lastPosition.copy(this.object.position))}),sr(this,"updateMovementVector",()=>{const n=this.moveState.forward||this.autoForward&&!this.moveState.back?1:0;this.moveVector.x=-this.moveState.left+this.moveState.right,this.moveVector.y=-this.moveState.down+this.moveState.up,this.moveVector.z=-n+this.moveState.back}),sr(this,"updateRotationVector",()=>{this.rotationVector.x=-this.moveState.pitchDown+this.moveState.pitchUp,this.rotationVector.y=-this.moveState.yawRight+this.moveState.yawLeft,this.rotationVector.z=-this.moveState.rollRight+this.moveState.rollLeft}),sr(this,"getContainerDimensions",()=>this.domElement!=document&&!(this.domElement instanceof Document)?{size:[this.domElement.offsetWidth,this.domElement.offsetHeight],offset:[this.domElement.offsetLeft,this.domElement.offsetTop]}:{size:[window.innerWidth,window.innerHeight],offset:[0,0]}),sr(this,"connect",n=>{this.domElement=n,n instanceof Document||n.setAttribute("tabindex",-1),this.domElement.addEventListener("contextmenu",C9),this.domElement.addEventListener("pointermove",this.pointermove),this.domElement.addEventListener("pointerdown",this.pointerdown),this.domElement.addEventListener("pointerup",this.pointerup),window.addEventListener("keydown",this.keydown),window.addEventListener("keyup",this.keyup)}),sr(this,"dispose",()=>{this.domElement.removeEventListener("contextmenu",C9),this.domElement.removeEventListener("pointermove",this.pointermove),this.domElement.removeEventListener("pointerdown",this.pointerdown),this.domElement.removeEventListener("pointerup",this.pointerup),window.removeEventListener("keydown",this.keydown),window.removeEventListener("keyup",this.keyup)}),this.object=e,t!==void 0&&this.connect(t),this.updateMovementVector(),this.updateRotationVector()}};var mce=Object.defineProperty,gce=(i,e,t)=>e in i?mce(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Dm=(i,e,t)=>(gce(i,typeof e!="symbol"?e+"":e,t),t);class o4{constructor(){Dm(this,"enabled",!0),Dm(this,"needsSwap",!0),Dm(this,"clear",!1),Dm(this,"renderToScreen",!1)}setSize(e,t){}render(e,t,n,r,s){console.error("THREE.Pass: .render() must be implemented in derived pass.")}dispose(){}}class Tf{constructor(e){Dm(this,"camera",new qi(-1,1,1,-1,0,1)),Dm(this,"geometry",new Fs(2,2)),Dm(this,"mesh"),this.mesh=new It(this.geometry,e)}get material(){return this.mesh.material}set material(e){this.mesh.material=e}dispose(){this.mesh.geometry.dispose()}render(e){e.render(this.mesh,this.camera)}}var Ace=Object.defineProperty,yce=(i,e,t)=>e in i?Ace(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,R3=(i,e,t)=>(yce(i,typeof e!="symbol"?e+"":e,t),t);class t5 extends o4{constructor(e,t="tDiffuse"){super(),R3(this,"textureID"),R3(this,"uniforms"),R3(this,"material"),R3(this,"fsQuad"),this.textureID=t,e instanceof Mi?(this.uniforms=e.uniforms,this.material=e):(this.uniforms=rp.clone(e.uniforms),this.material=new Mi({defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new Tf(this.material)}render(e,t,n){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=n.texture),this.fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e))}dispose(){this.fsQuad.dispose(),this.material.dispose()}}const T9={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:`
    varying vec2 vUv;

    void main() {

    	vUv = uv;
    	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

    }
  `,fragmentShader:`
    uniform float opacity;

    uniform sampler2D tDiffuse;

    varying vec2 vUv;

    void main() {

    	vec4 texel = texture2D( tDiffuse, vUv );
    	gl_FragColor = opacity * texel;

    }
  `};var vce=Object.defineProperty,xce=(i,e,t)=>e in i?vce(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,KT=(i,e,t)=>(xce(i,typeof e!="symbol"?e+"":e,t),t);class b9 extends o4{constructor(e,t){super(),KT(this,"scene"),KT(this,"camera"),KT(this,"inverse"),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(e,t,n){const r=e.getContext(),s=e.state;s.buffers.color.setMask(!1),s.buffers.depth.setMask(!1),s.buffers.color.setLocked(!0),s.buffers.depth.setLocked(!0);let o,a;this.inverse?(o=0,a=1):(o=1,a=0),s.buffers.stencil.setTest(!0),s.buffers.stencil.setOp(r.REPLACE,r.REPLACE,r.REPLACE),s.buffers.stencil.setFunc(r.ALWAYS,o,4294967295),s.buffers.stencil.setClear(a),s.buffers.stencil.setLocked(!0),e.setRenderTarget(n),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera),s.buffers.color.setLocked(!1),s.buffers.depth.setLocked(!1),s.buffers.stencil.setLocked(!1),s.buffers.stencil.setFunc(r.EQUAL,1,4294967295),s.buffers.stencil.setOp(r.KEEP,r.KEEP,r.KEEP),s.buffers.stencil.setLocked(!0)}}class Ece extends o4{constructor(){super(),this.needsSwap=!1}render(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}}var _ce=Object.defineProperty,Sce=(i,e,t)=>e in i?_ce(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,ec=(i,e,t)=>(Sce(i,typeof e!="symbol"?e+"":e,t),t);class wce{constructor(e,t){if(ec(this,"renderer"),ec(this,"_pixelRatio"),ec(this,"_width"),ec(this,"_height"),ec(this,"renderTarget1"),ec(this,"renderTarget2"),ec(this,"writeBuffer"),ec(this,"readBuffer"),ec(this,"renderToScreen"),ec(this,"passes",[]),ec(this,"copyPass"),ec(this,"clock"),this.renderer=e,t===void 0){const n={minFilter:Pn,magFilter:Pn,format:gi},r=e.getSize(new Ue);this._pixelRatio=e.getPixelRatio(),this._width=r.width,this._height=r.height,t=new Si(this._width*this._pixelRatio,this._height*this._pixelRatio,n),t.texture.name="EffectComposer.rt1"}else this._pixelRatio=1,this._width=t.width,this._height=t.height;this.renderTarget1=t,this.renderTarget2=t.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,T9===void 0&&console.error("THREE.EffectComposer relies on CopyShader"),t5===void 0&&console.error("THREE.EffectComposer relies on ShaderPass"),this.copyPass=new t5(T9),this.copyPass.material.blending=gc,this.clock=new $w}swapBuffers(){const e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}addPass(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(e,t){this.passes.splice(t,0,e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(e){const t=this.passes.indexOf(e);t!==-1&&this.passes.splice(t,1)}isLastEnabledPass(e){for(let t=e+1;t<this.passes.length;t++)if(this.passes[t].enabled)return!1;return!0}render(e){e===void 0&&(e=this.clock.getDelta());const t=this.renderer.getRenderTarget();let n=!1;const r=this.passes.length;for(let s=0;s<r;s++){const o=this.passes[s];if(o.enabled!==!1){if(o.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(s),o.render(this.renderer,this.writeBuffer,this.readBuffer,e,n),o.needsSwap){if(n){const a=this.renderer.getContext(),l=this.renderer.state.buffers.stencil;l.setFunc(a.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),l.setFunc(a.EQUAL,1,4294967295)}this.swapBuffers()}b9!==void 0&&(o instanceof b9?n=!0:o instanceof Ece&&(n=!1))}}this.renderer.setRenderTarget(t)}reset(e){if(e===void 0){const t=this.renderer.getSize(new Ue);this._pixelRatio=this.renderer.getPixelRatio(),this._width=t.width,this._height=t.height,e=this.renderTarget1.clone(),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(e,t){this._width=e,this._height=t;const n=this._width*this._pixelRatio,r=this._height*this._pixelRatio;this.renderTarget1.setSize(n,r),this.renderTarget2.setSize(n,r);for(let s=0;s<this.passes.length;s++)this.passes[s].setSize(n,r)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.copyPass.dispose()}}var Cce=Object.defineProperty,Tce=(i,e,t)=>e in i?Cce(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,pm=(i,e,t)=>(Tce(i,typeof e!="symbol"?e+"":e,t),t);class bce extends o4{constructor(e,t,n,r,s=0){super(),pm(this,"scene"),pm(this,"camera"),pm(this,"overrideMaterial"),pm(this,"clearColor"),pm(this,"clearAlpha"),pm(this,"clearDepth",!1),pm(this,"_oldClearColor",new ut),this.scene=e,this.camera=t,this.overrideMaterial=n,this.clearColor=r,this.clearAlpha=s,this.clear=!0,this.needsSwap=!1}render(e,t,n){let r=e.autoClear;e.autoClear=!1;let s,o=null;this.overrideMaterial!==void 0&&(o=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor&&(e.getClearColor(this._oldClearColor),s=e.getClearAlpha(),e.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:n),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),this.clearColor&&e.setClearColor(this._oldClearColor,s),this.overrideMaterial!==void 0&&(this.scene.overrideMaterial=o),e.autoClear=r}}function sA(i){if(typeof TextDecoder<"u")return new TextDecoder().decode(i);let e="";for(let t=0,n=i.length;t<n;t++)e+=String.fromCharCode(i[t]);try{return decodeURIComponent(escape(e))}catch{return e}}const km="srgb",Bf="srgb-linear",I9=3001,Ice=3e3;class wR extends os{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(t){return new Bce(t)}),this.register(function(t){return new Dce(t)}),this.register(function(t){return new Qce(t)}),this.register(function(t){return new Vce(t)}),this.register(function(t){return new Wce(t)}),this.register(function(t){return new Fce(t)}),this.register(function(t){return new Oce(t)}),this.register(function(t){return new Nce(t)}),this.register(function(t){return new Uce(t)}),this.register(function(t){return new Pce(t)}),this.register(function(t){return new zce(t)}),this.register(function(t){return new kce(t)}),this.register(function(t){return new Hce(t)}),this.register(function(t){return new Gce(t)}),this.register(function(t){return new Rce(t)}),this.register(function(t){return new jce(t)}),this.register(function(t){return new Kce(t)})}load(e,t,n,r){const s=this;let o;if(this.resourcePath!=="")o=this.resourcePath;else if(this.path!==""){const c=Pf.extractUrlBase(e);o=Pf.resolveURL(c,this.path)}else o=Pf.extractUrlBase(e);this.manager.itemStart(e);const a=function(c){r?r(c):console.error(c),s.manager.itemError(e),s.manager.itemEnd(e)},l=new $r(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials),l.load(e,function(c){try{s.parse(c,o,function(u){t(u),s.manager.itemEnd(e)},a)}catch(u){a(u)}},n,a)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,n,r){let s;const o={},a={};if(typeof e=="string")s=JSON.parse(e);else if(e instanceof ArrayBuffer)if(sA(new Uint8Array(e.slice(0,4)))===cH){try{o[ui.KHR_BINARY_GLTF]=new $ce(e)}catch(u){r&&r(u);return}s=JSON.parse(o[ui.KHR_BINARY_GLTF].content)}else s=JSON.parse(sA(new Uint8Array(e)));else s=e;if(s.asset===void 0||s.asset.version[0]<2){r&&r(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const l=new aue(s,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});l.fileLoader.setRequestHeader(this.requestHeader);for(let c=0;c<this.pluginCallbacks.length;c++){const u=this.pluginCallbacks[c](l);u.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),a[u.name]=u,o[u.name]=!0}if(s.extensionsUsed)for(let c=0;c<s.extensionsUsed.length;++c){const u=s.extensionsUsed[c],h=s.extensionsRequired||[];switch(u){case ui.KHR_MATERIALS_UNLIT:o[u]=new Lce;break;case ui.KHR_DRACO_MESH_COMPRESSION:o[u]=new Yce(s,this.dracoLoader);break;case ui.KHR_TEXTURE_TRANSFORM:o[u]=new Xce;break;case ui.KHR_MESH_QUANTIZATION:o[u]=new qce;break;default:h.indexOf(u)>=0&&a[u]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+u+'".')}}l.setExtensions(o),l.setPlugins(a),l.parse(n,r)}parseAsync(e,t){const n=this;return new Promise(function(r,s){n.parse(e,t,r,s)})}}function Mce(){let i={};return{get:function(e){return i[e]},add:function(e,t){i[e]=t},remove:function(e){delete i[e]},removeAll:function(){i={}}}}const ui={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class Rce{constructor(e){this.parser=e,this.name=ui.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let n=0,r=t.length;n<r;n++){const s=t[n];s.extensions&&s.extensions[this.name]&&s.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,s.extensions[this.name].light)}}_loadLight(e){const t=this.parser,n="light:"+e;let r=t.cache.get(n);if(r)return r;const s=t.json,l=((s.extensions&&s.extensions[this.name]||{}).lights||[])[e];let c;const u=new ut(16777215);l.color!==void 0&&u.setRGB(l.color[0],l.color[1],l.color[2],Bf);const h=l.range!==void 0?l.range:0;switch(l.type){case"directional":c=new jw(u),c.target.position.set(0,0,-1),c.add(c.target);break;case"point":c=new B2(u),c.distance=h;break;case"spot":c=new Ww(u),c.distance=h,l.spot=l.spot||{},l.spot.innerConeAngle=l.spot.innerConeAngle!==void 0?l.spot.innerConeAngle:0,l.spot.outerConeAngle=l.spot.outerConeAngle!==void 0?l.spot.outerConeAngle:Math.PI/4,c.angle=l.spot.outerConeAngle,c.penumbra=1-l.spot.innerConeAngle/l.spot.outerConeAngle,c.target.position.set(0,0,-1),c.add(c.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+l.type)}return c.position.set(0,0,0),c.decay=2,xf(c,l),l.intensity!==void 0&&(c.intensity=l.intensity),c.name=t.createUniqueName(l.name||"light_"+e),r=Promise.resolve(c),t.cache.add(n,r),r}getDependency(e,t){if(e==="light")return this._loadLight(t)}createNodeAttachment(e){const t=this,n=this.parser,s=n.json.nodes[e],a=(s.extensions&&s.extensions[this.name]||{}).light;return a===void 0?null:this._loadLight(a).then(function(l){return n._getNodeRef(t.cache,a,l)})}}class Lce{constructor(){this.name=ui.KHR_MATERIALS_UNLIT}getMaterialType(){return no}extendParams(e,t,n){const r=[];e.color=new ut(1,1,1),e.opacity=1;const s=t.pbrMetallicRoughness;if(s){if(Array.isArray(s.baseColorFactor)){const o=s.baseColorFactor;e.color.setRGB(o[0],o[1],o[2],Bf),e.opacity=o[3]}s.baseColorTexture!==void 0&&r.push(n.assignTexture(e,"map",s.baseColorTexture,km))}return Promise.all(r)}}class Pce{constructor(e){this.parser=e,this.name=ui.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=r.extensions[this.name].emissiveStrength;return s!==void 0&&(t.emissiveIntensity=s),Promise.resolve()}}class Bce{constructor(e){this.parser=e,this.name=ui.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:nl}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];if(o.clearcoatFactor!==void 0&&(t.clearcoat=o.clearcoatFactor),o.clearcoatTexture!==void 0&&s.push(n.assignTexture(t,"clearcoatMap",o.clearcoatTexture)),o.clearcoatRoughnessFactor!==void 0&&(t.clearcoatRoughness=o.clearcoatRoughnessFactor),o.clearcoatRoughnessTexture!==void 0&&s.push(n.assignTexture(t,"clearcoatRoughnessMap",o.clearcoatRoughnessTexture)),o.clearcoatNormalTexture!==void 0&&(s.push(n.assignTexture(t,"clearcoatNormalMap",o.clearcoatNormalTexture)),o.clearcoatNormalTexture.scale!==void 0)){const a=o.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new Ue(a,a)}return Promise.all(s)}}class Dce{constructor(e){this.parser=e,this.name=ui.KHR_MATERIALS_DISPERSION}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:nl}extendMaterialParams(e,t){const r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=r.extensions[this.name];return t.dispersion=s.dispersion!==void 0?s.dispersion:0,Promise.resolve()}}class kce{constructor(e){this.parser=e,this.name=ui.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:nl}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];return o.iridescenceFactor!==void 0&&(t.iridescence=o.iridescenceFactor),o.iridescenceTexture!==void 0&&s.push(n.assignTexture(t,"iridescenceMap",o.iridescenceTexture)),o.iridescenceIor!==void 0&&(t.iridescenceIOR=o.iridescenceIor),t.iridescenceThicknessRange===void 0&&(t.iridescenceThicknessRange=[100,400]),o.iridescenceThicknessMinimum!==void 0&&(t.iridescenceThicknessRange[0]=o.iridescenceThicknessMinimum),o.iridescenceThicknessMaximum!==void 0&&(t.iridescenceThicknessRange[1]=o.iridescenceThicknessMaximum),o.iridescenceThicknessTexture!==void 0&&s.push(n.assignTexture(t,"iridescenceThicknessMap",o.iridescenceThicknessTexture)),Promise.all(s)}}class Fce{constructor(e){this.parser=e,this.name=ui.KHR_MATERIALS_SHEEN}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:nl}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[];t.sheenColor=new ut(0,0,0),t.sheenRoughness=0,t.sheen=1;const o=r.extensions[this.name];if(o.sheenColorFactor!==void 0){const a=o.sheenColorFactor;t.sheenColor.setRGB(a[0],a[1],a[2],Bf)}return o.sheenRoughnessFactor!==void 0&&(t.sheenRoughness=o.sheenRoughnessFactor),o.sheenColorTexture!==void 0&&s.push(n.assignTexture(t,"sheenColorMap",o.sheenColorTexture,km)),o.sheenRoughnessTexture!==void 0&&s.push(n.assignTexture(t,"sheenRoughnessMap",o.sheenRoughnessTexture)),Promise.all(s)}}class Oce{constructor(e){this.parser=e,this.name=ui.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:nl}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];return o.transmissionFactor!==void 0&&(t.transmission=o.transmissionFactor),o.transmissionTexture!==void 0&&s.push(n.assignTexture(t,"transmissionMap",o.transmissionTexture)),Promise.all(s)}}class Nce{constructor(e){this.parser=e,this.name=ui.KHR_MATERIALS_VOLUME}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:nl}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];t.thickness=o.thicknessFactor!==void 0?o.thicknessFactor:0,o.thicknessTexture!==void 0&&s.push(n.assignTexture(t,"thicknessMap",o.thicknessTexture)),t.attenuationDistance=o.attenuationDistance||1/0;const a=o.attenuationColor||[1,1,1];return t.attenuationColor=new ut().setRGB(a[0],a[1],a[2],Bf),Promise.all(s)}}class Uce{constructor(e){this.parser=e,this.name=ui.KHR_MATERIALS_IOR}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:nl}extendMaterialParams(e,t){const r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=r.extensions[this.name];return t.ior=s.ior!==void 0?s.ior:1.5,Promise.resolve()}}class zce{constructor(e){this.parser=e,this.name=ui.KHR_MATERIALS_SPECULAR}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:nl}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];t.specularIntensity=o.specularFactor!==void 0?o.specularFactor:1,o.specularTexture!==void 0&&s.push(n.assignTexture(t,"specularIntensityMap",o.specularTexture));const a=o.specularColorFactor||[1,1,1];return t.specularColor=new ut().setRGB(a[0],a[1],a[2],Bf),o.specularColorTexture!==void 0&&s.push(n.assignTexture(t,"specularColorMap",o.specularColorTexture,km)),Promise.all(s)}}class Gce{constructor(e){this.parser=e,this.name=ui.EXT_MATERIALS_BUMP}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:nl}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];return t.bumpScale=o.bumpFactor!==void 0?o.bumpFactor:1,o.bumpTexture!==void 0&&s.push(n.assignTexture(t,"bumpMap",o.bumpTexture)),Promise.all(s)}}class Hce{constructor(e){this.parser=e,this.name=ui.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:nl}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];return o.anisotropyStrength!==void 0&&(t.anisotropy=o.anisotropyStrength),o.anisotropyRotation!==void 0&&(t.anisotropyRotation=o.anisotropyRotation),o.anisotropyTexture!==void 0&&s.push(n.assignTexture(t,"anisotropyMap",o.anisotropyTexture)),Promise.all(s)}}class Qce{constructor(e){this.parser=e,this.name=ui.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,n=t.json,r=n.textures[e];if(!r.extensions||!r.extensions[this.name])return null;const s=r.extensions[this.name],o=t.options.ktx2Loader;if(!o){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,s.source,o)}}class Vce{constructor(e){this.parser=e,this.name=ui.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,n=this.parser,r=n.json,s=r.textures[e];if(!s.extensions||!s.extensions[t])return null;const o=s.extensions[t],a=r.images[o.source];let l=n.textureLoader;if(a.uri){const c=n.options.manager.getHandler(a.uri);c!==null&&(l=c)}return this.detectSupport().then(function(c){if(c)return n.loadTextureImage(e,o.source,l);if(r.extensionsRequired&&r.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return n.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class Wce{constructor(e){this.parser=e,this.name=ui.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const t=this.name,n=this.parser,r=n.json,s=r.textures[e];if(!s.extensions||!s.extensions[t])return null;const o=s.extensions[t],a=r.images[o.source];let l=n.textureLoader;if(a.uri){const c=n.options.manager.getHandler(a.uri);c!==null&&(l=c)}return this.detectSupport().then(function(c){if(c)return n.loadTextureImage(e,o.source,l);if(r.extensionsRequired&&r.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return n.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class jce{constructor(e){this.name=ui.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,n=t.bufferViews[e];if(n.extensions&&n.extensions[this.name]){const r=n.extensions[this.name],s=this.parser.getDependency("buffer",r.buffer),o=this.parser.options.meshoptDecoder;if(!o||!o.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return s.then(function(a){const l=r.byteOffset||0,c=r.byteLength||0,u=r.count,h=r.byteStride,f=new Uint8Array(a,l,c);return o.decodeGltfBufferAsync?o.decodeGltfBufferAsync(u,h,f,r.mode,r.filter).then(function(d){return d.buffer}):o.ready.then(function(){const d=new ArrayBuffer(u*h);return o.decodeGltfBuffer(new Uint8Array(d),u,h,f,r.mode,r.filter),d})})}else return null}}class Kce{constructor(e){this.name=ui.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const t=this.parser.json,n=t.nodes[e];if(!n.extensions||!n.extensions[this.name]||n.mesh===void 0)return null;const r=t.meshes[n.mesh];for(const c of r.primitives)if(c.mode!==ic.TRIANGLES&&c.mode!==ic.TRIANGLE_STRIP&&c.mode!==ic.TRIANGLE_FAN&&c.mode!==void 0)return null;const o=n.extensions[this.name].attributes,a=[],l={};for(const c in o)a.push(this.parser.getDependency("accessor",o[c]).then(u=>(l[c]=u,l[c])));return a.length<1?null:(a.push(this.parser.createNodeMesh(e)),Promise.all(a).then(c=>{const u=c.pop(),h=u.isGroup?u.children:[u],f=c[0].count,d=[];for(const m of h){const A=new Xe,g=new H,y=new Xt,E=new H(1,1,1),x=new ax(m.geometry,m.material,f);for(let C=0;C<f;C++)l.TRANSLATION&&g.fromBufferAttribute(l.TRANSLATION,C),l.ROTATION&&y.fromBufferAttribute(l.ROTATION,C),l.SCALE&&E.fromBufferAttribute(l.SCALE,C),x.setMatrixAt(C,A.compose(g,y,E));for(const C in l)if(C==="_COLOR_0"){const T=l[C];x.instanceColor=new Su(T.array,T.itemSize,T.normalized)}else C!=="TRANSLATION"&&C!=="ROTATION"&&C!=="SCALE"&&m.geometry.setAttribute(C,l[C]);_n.prototype.copy.call(x,m),this.parser.assignFinalMaterial(x),d.push(x)}return u.isGroup?(u.clear(),u.add(...d),u):d[0]}))}}const cH="glTF",Jy=12,M9={JSON:1313821514,BIN:5130562};class $ce{constructor(e){this.name=ui.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,Jy);if(this.header={magic:sA(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==cH)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const n=this.header.length-Jy,r=new DataView(e,Jy);let s=0;for(;s<n;){const o=r.getUint32(s,!0);s+=4;const a=r.getUint32(s,!0);if(s+=4,a===M9.JSON){const l=new Uint8Array(e,Jy+s,o);this.content=sA(l)}else if(a===M9.BIN){const l=Jy+s;this.body=e.slice(l,l+o)}s+=o}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class Yce{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=ui.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const n=this.json,r=this.dracoLoader,s=e.extensions[this.name].bufferView,o=e.extensions[this.name].attributes,a={},l={},c={};for(const u in o){const h=n5[u]||u.toLowerCase();a[h]=o[u]}for(const u in e.attributes){const h=n5[u]||u.toLowerCase();if(o[u]!==void 0){const f=n.accessors[e.attributes[u]],d=H1[f.componentType];c[h]=d.name,l[h]=f.normalized===!0}}return t.getDependency("bufferView",s).then(function(u){return new Promise(function(h,f){r.decodeDracoFile(u,function(d){for(const m in d.attributes){const A=d.attributes[m],g=l[m];g!==void 0&&(A.normalized=g)}h(d)},a,c,Bf,f)})})}}class Xce{constructor(){this.name=ui.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return(t.texCoord===void 0||t.texCoord===e.channel)&&t.offset===void 0&&t.rotation===void 0&&t.scale===void 0||(e=e.clone(),t.texCoord!==void 0&&(e.channel=t.texCoord),t.offset!==void 0&&e.offset.fromArray(t.offset),t.rotation!==void 0&&(e.rotation=t.rotation),t.scale!==void 0&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class qce{constructor(){this.name=ui.KHR_MESH_QUANTIZATION}}class uH extends SA{constructor(e,t,n,r){super(e,t,n,r)}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,r=this.valueSize,s=e*r*3+r;for(let o=0;o!==r;o++)t[o]=n[s+o];return t}interpolate_(e,t,n,r){const s=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=a*2,c=a*3,u=r-t,h=(n-t)/u,f=h*h,d=f*h,m=e*c,A=m-c,g=-2*d+3*f,y=d-f,E=1-g,x=y-f+h;for(let C=0;C!==a;C++){const T=o[A+C+a],I=o[A+C+l]*u,M=o[m+C+a],L=o[m+C]*u;s[C]=E*T+x*I+g*M+y*L}return s}}const Jce=new Xt;class Zce extends uH{interpolate_(e,t,n,r){const s=super.interpolate_(e,t,n,r);return Jce.fromArray(s).normalize().toArray(s),s}}const ic={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},H1={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},R9={9728:zn,9729:Pn,9984:x2,9985:gw,9986:F1,9987:Bl},L9={33071:ji,33648:X1,10497:_o},$T={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},n5={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",...TA>=152?{TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3"}:{TEXCOORD_0:"uv",TEXCOORD_1:"uv2"},COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},Md={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},eue={CUBICSPLINE:void 0,LINEAR:Jm,STEP:q1},YT={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function tue(i){return i.DefaultMaterial===void 0&&(i.DefaultMaterial=new p0({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:tl})),i.DefaultMaterial}function mm(i,e,t){for(const n in t.extensions)i[n]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[n]=t.extensions[n])}function xf(i,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(i.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function nue(i,e,t){let n=!1,r=!1,s=!1;for(let c=0,u=e.length;c<u;c++){const h=e[c];if(h.POSITION!==void 0&&(n=!0),h.NORMAL!==void 0&&(r=!0),h.COLOR_0!==void 0&&(s=!0),n&&r&&s)break}if(!n&&!r&&!s)return Promise.resolve(i);const o=[],a=[],l=[];for(let c=0,u=e.length;c<u;c++){const h=e[c];if(n){const f=h.POSITION!==void 0?t.getDependency("accessor",h.POSITION):i.attributes.position;o.push(f)}if(r){const f=h.NORMAL!==void 0?t.getDependency("accessor",h.NORMAL):i.attributes.normal;a.push(f)}if(s){const f=h.COLOR_0!==void 0?t.getDependency("accessor",h.COLOR_0):i.attributes.color;l.push(f)}}return Promise.all([Promise.all(o),Promise.all(a),Promise.all(l)]).then(function(c){const u=c[0],h=c[1],f=c[2];return n&&(i.morphAttributes.position=u),r&&(i.morphAttributes.normal=h),s&&(i.morphAttributes.color=f),i.morphTargetsRelative=!0,i})}function iue(i,e){if(i.updateMorphTargets(),e.weights!==void 0)for(let t=0,n=e.weights.length;t<n;t++)i.morphTargetInfluences[t]=e.weights[t];if(e.extras&&Array.isArray(e.extras.targetNames)){const t=e.extras.targetNames;if(i.morphTargetInfluences.length===t.length){i.morphTargetDictionary={};for(let n=0,r=t.length;n<r;n++)i.morphTargetDictionary[t[n]]=n}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function rue(i){let e;const t=i.extensions&&i.extensions[ui.KHR_DRACO_MESH_COMPRESSION];if(t?e="draco:"+t.bufferView+":"+t.indices+":"+XT(t.attributes):e=i.indices+":"+XT(i.attributes)+":"+i.mode,i.targets!==void 0)for(let n=0,r=i.targets.length;n<r;n++)e+=":"+XT(i.targets[n]);return e}function XT(i){let e="";const t=Object.keys(i).sort();for(let n=0,r=t.length;n<r;n++)e+=t[n]+":"+i[t[n]]+";";return e}function i5(i){switch(i){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function sue(i){return i.search(/\.jpe?g($|\?)/i)>0||i.search(/^data\:image\/jpeg/)===0?"image/jpeg":i.search(/\.webp($|\?)/i)>0||i.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}const oue=new Xe;class aue{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new Mce,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let n=!1,r=!1,s=-1;typeof navigator<"u"&&typeof navigator.userAgent<"u"&&(n=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,r=navigator.userAgent.indexOf("Firefox")>-1,s=r?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),typeof createImageBitmap>"u"||n||r&&s<98?this.textureLoader=new xh(this.options.manager):this.textureLoader=new Az(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new $r(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const n=this,r=this.json,s=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(o){return o._markDefs&&o._markDefs()}),Promise.all(this._invokeAll(function(o){return o.beforeRoot&&o.beforeRoot()})).then(function(){return Promise.all([n.getDependencies("scene"),n.getDependencies("animation"),n.getDependencies("camera")])}).then(function(o){const a={scene:o[0][r.scene||0],scenes:o[0],animations:o[1],cameras:o[2],asset:r.asset,parser:n,userData:{}};return mm(s,a,r),xf(a,r),Promise.all(n._invokeAll(function(l){return l.afterRoot&&l.afterRoot(a)})).then(function(){for(const l of a.scenes)l.updateMatrixWorld();e(a)})}).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],n=this.json.meshes||[];for(let r=0,s=t.length;r<s;r++){const o=t[r].joints;for(let a=0,l=o.length;a<l;a++)e[o[a]].isBone=!0}for(let r=0,s=e.length;r<s;r++){const o=e[r];o.mesh!==void 0&&(this._addNodeRef(this.meshCache,o.mesh),o.skin!==void 0&&(n[o.mesh].isSkinnedMesh=!0)),o.camera!==void 0&&this._addNodeRef(this.cameraCache,o.camera)}}_addNodeRef(e,t){t!==void 0&&(e.refs[t]===void 0&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,n){if(e.refs[t]<=1)return n;const r=n.clone(),s=(o,a)=>{const l=this.associations.get(o);l!=null&&this.associations.set(a,l);for(const[c,u]of o.children.entries())s(u,a.children[c])};return s(n,r),r.name+="_instance_"+e.uses[t]++,r}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let n=0;n<t.length;n++){const r=e(t[n]);if(r)return r}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const n=[];for(let r=0;r<t.length;r++){const s=e(t[r]);s&&n.push(s)}return n}getDependency(e,t){const n=e+":"+t;let r=this.cache.get(n);if(!r){switch(e){case"scene":r=this.loadScene(t);break;case"node":r=this._invokeOne(function(s){return s.loadNode&&s.loadNode(t)});break;case"mesh":r=this._invokeOne(function(s){return s.loadMesh&&s.loadMesh(t)});break;case"accessor":r=this.loadAccessor(t);break;case"bufferView":r=this._invokeOne(function(s){return s.loadBufferView&&s.loadBufferView(t)});break;case"buffer":r=this.loadBuffer(t);break;case"material":r=this._invokeOne(function(s){return s.loadMaterial&&s.loadMaterial(t)});break;case"texture":r=this._invokeOne(function(s){return s.loadTexture&&s.loadTexture(t)});break;case"skin":r=this.loadSkin(t);break;case"animation":r=this._invokeOne(function(s){return s.loadAnimation&&s.loadAnimation(t)});break;case"camera":r=this.loadCamera(t);break;default:if(r=this._invokeOne(function(s){return s!=this&&s.getDependency&&s.getDependency(e,t)}),!r)throw new Error("Unknown type: "+e);break}this.cache.add(n,r)}return r}getDependencies(e){let t=this.cache.get(e);if(!t){const n=this,r=this.json[e+(e==="mesh"?"es":"s")]||[];t=Promise.all(r.map(function(s,o){return n.getDependency(e,o)})),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],n=this.fileLoader;if(t.type&&t.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(t.uri===void 0&&e===0)return Promise.resolve(this.extensions[ui.KHR_BINARY_GLTF].body);const r=this.options;return new Promise(function(s,o){n.load(Pf.resolveURL(t.uri,r.path),s,void 0,function(){o(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(n){const r=t.byteLength||0,s=t.byteOffset||0;return n.slice(s,s+r)})}loadAccessor(e){const t=this,n=this.json,r=this.json.accessors[e];if(r.bufferView===void 0&&r.sparse===void 0){const o=$T[r.type],a=H1[r.componentType],l=r.normalized===!0,c=new a(r.count*o);return Promise.resolve(new mn(c,o,l))}const s=[];return r.bufferView!==void 0?s.push(this.getDependency("bufferView",r.bufferView)):s.push(null),r.sparse!==void 0&&(s.push(this.getDependency("bufferView",r.sparse.indices.bufferView)),s.push(this.getDependency("bufferView",r.sparse.values.bufferView))),Promise.all(s).then(function(o){const a=o[0],l=$T[r.type],c=H1[r.componentType],u=c.BYTES_PER_ELEMENT,h=u*l,f=r.byteOffset||0,d=r.bufferView!==void 0?n.bufferViews[r.bufferView].byteStride:void 0,m=r.normalized===!0;let A,g;if(d&&d!==h){const y=Math.floor(f/d),E="InterleavedBuffer:"+r.bufferView+":"+r.componentType+":"+y+":"+r.count;let x=t.cache.get(E);x||(A=new c(a,y*d,r.count*d/u),x=new sx(A,d/u),t.cache.add(E,x)),g=new Ja(x,l,f%d/u,m)}else a===null?A=new c(r.count*l):A=new c(a,f,r.count*l),g=new mn(A,l,m);if(r.sparse!==void 0){const y=$T.SCALAR,E=H1[r.sparse.indices.componentType],x=r.sparse.indices.byteOffset||0,C=r.sparse.values.byteOffset||0,T=new E(o[1],x,r.sparse.count*y),I=new c(o[2],C,r.sparse.count*l);a!==null&&(g=new mn(g.array.slice(),g.itemSize,g.normalized));for(let M=0,L=T.length;M<L;M++){const R=T[M];if(g.setX(R,I[M*l]),l>=2&&g.setY(R,I[M*l+1]),l>=3&&g.setZ(R,I[M*l+2]),l>=4&&g.setW(R,I[M*l+3]),l>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return g})}loadTexture(e){const t=this.json,n=this.options,s=t.textures[e].source,o=t.images[s];let a=this.textureLoader;if(o.uri){const l=n.manager.getHandler(o.uri);l!==null&&(a=l)}return this.loadTextureImage(e,s,a)}loadTextureImage(e,t,n){const r=this,s=this.json,o=s.textures[e],a=s.images[t],l=(a.uri||a.bufferView)+":"+o.sampler;if(this.textureCache[l])return this.textureCache[l];const c=this.loadImageSource(t,n).then(function(u){u.flipY=!1,u.name=o.name||a.name||"",u.name===""&&typeof a.uri=="string"&&a.uri.startsWith("data:image/")===!1&&(u.name=a.uri);const f=(s.samplers||{})[o.sampler]||{};return u.magFilter=R9[f.magFilter]||Pn,u.minFilter=R9[f.minFilter]||Bl,u.wrapS=L9[f.wrapS]||_o,u.wrapT=L9[f.wrapT]||_o,r.associations.set(u,{textures:e}),u}).catch(function(){return null});return this.textureCache[l]=c,c}loadImageSource(e,t){const n=this,r=this.json,s=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(h=>h.clone());const o=r.images[e],a=self.URL||self.webkitURL;let l=o.uri||"",c=!1;if(o.bufferView!==void 0)l=n.getDependency("bufferView",o.bufferView).then(function(h){c=!0;const f=new Blob([h],{type:o.mimeType});return l=a.createObjectURL(f),l});else if(o.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const u=Promise.resolve(l).then(function(h){return new Promise(function(f,d){let m=f;t.isImageBitmapLoader===!0&&(m=function(A){const g=new vi(A);g.needsUpdate=!0,f(g)}),t.load(Pf.resolveURL(h,s.path),m,void 0,d)})}).then(function(h){return c===!0&&a.revokeObjectURL(l),xf(h,o),h.userData.mimeType=o.mimeType||sue(o.uri),h}).catch(function(h){throw console.error("THREE.GLTFLoader: Couldn't load texture",l),h});return this.sourceCache[e]=u,u}assignTexture(e,t,n,r){const s=this;return this.getDependency("texture",n.index).then(function(o){if(!o)return null;if(n.texCoord!==void 0&&n.texCoord>0&&(o=o.clone(),o.channel=n.texCoord),s.extensions[ui.KHR_TEXTURE_TRANSFORM]){const a=n.extensions!==void 0?n.extensions[ui.KHR_TEXTURE_TRANSFORM]:void 0;if(a){const l=s.associations.get(o);o=s.extensions[ui.KHR_TEXTURE_TRANSFORM].extendTexture(o,a),s.associations.set(o,l)}}return r!==void 0&&(typeof r=="number"&&(r=r===I9?km:Bf),"colorSpace"in o?o.colorSpace=r:o.encoding=r===km?I9:Ice),e[t]=o,o})}assignFinalMaterial(e){const t=e.geometry;let n=e.material;const r=t.attributes.tangent===void 0,s=t.attributes.color!==void 0,o=t.attributes.normal===void 0;if(e.isPoints){const a="PointsMaterial:"+n.uuid;let l=this.cache.get(a);l||(l=new lx,Us.prototype.copy.call(l,n),l.color.copy(n.color),l.map=n.map,l.sizeAttenuation=!1,this.cache.add(a,l)),n=l}else if(e.isLine){const a="LineBasicMaterial:"+n.uuid;let l=this.cache.get(a);l||(l=new vs,Us.prototype.copy.call(l,n),l.color.copy(n.color),l.map=n.map,this.cache.add(a,l)),n=l}if(r||s||o){let a="ClonedMaterial:"+n.uuid+":";r&&(a+="derivative-tangents:"),s&&(a+="vertex-colors:"),o&&(a+="flat-shading:");let l=this.cache.get(a);l||(l=n.clone(),s&&(l.vertexColors=!0),o&&(l.flatShading=!0),r&&(l.normalScale&&(l.normalScale.y*=-1),l.clearcoatNormalScale&&(l.clearcoatNormalScale.y*=-1)),this.cache.add(a,l),this.associations.set(l,this.associations.get(n))),n=l}e.material=n}getMaterialType(){return p0}loadMaterial(e){const t=this,n=this.json,r=this.extensions,s=n.materials[e];let o;const a={},l=s.extensions||{},c=[];if(l[ui.KHR_MATERIALS_UNLIT]){const h=r[ui.KHR_MATERIALS_UNLIT];o=h.getMaterialType(),c.push(h.extendParams(a,s,t))}else{const h=s.pbrMetallicRoughness||{};if(a.color=new ut(1,1,1),a.opacity=1,Array.isArray(h.baseColorFactor)){const f=h.baseColorFactor;a.color.setRGB(f[0],f[1],f[2],Bf),a.opacity=f[3]}h.baseColorTexture!==void 0&&c.push(t.assignTexture(a,"map",h.baseColorTexture,km)),a.metalness=h.metallicFactor!==void 0?h.metallicFactor:1,a.roughness=h.roughnessFactor!==void 0?h.roughnessFactor:1,h.metallicRoughnessTexture!==void 0&&(c.push(t.assignTexture(a,"metalnessMap",h.metallicRoughnessTexture)),c.push(t.assignTexture(a,"roughnessMap",h.metallicRoughnessTexture))),o=this._invokeOne(function(f){return f.getMaterialType&&f.getMaterialType(e)}),c.push(Promise.all(this._invokeAll(function(f){return f.extendMaterialParams&&f.extendMaterialParams(e,a)})))}s.doubleSided===!0&&(a.side=Pi);const u=s.alphaMode||YT.OPAQUE;if(u===YT.BLEND?(a.transparent=!0,a.depthWrite=!1):(a.transparent=!1,u===YT.MASK&&(a.alphaTest=s.alphaCutoff!==void 0?s.alphaCutoff:.5)),s.normalTexture!==void 0&&o!==no&&(c.push(t.assignTexture(a,"normalMap",s.normalTexture)),a.normalScale=new Ue(1,1),s.normalTexture.scale!==void 0)){const h=s.normalTexture.scale;a.normalScale.set(h,h)}if(s.occlusionTexture!==void 0&&o!==no&&(c.push(t.assignTexture(a,"aoMap",s.occlusionTexture)),s.occlusionTexture.strength!==void 0&&(a.aoMapIntensity=s.occlusionTexture.strength)),s.emissiveFactor!==void 0&&o!==no){const h=s.emissiveFactor;a.emissive=new ut().setRGB(h[0],h[1],h[2],Bf)}return s.emissiveTexture!==void 0&&o!==no&&c.push(t.assignTexture(a,"emissiveMap",s.emissiveTexture,km)),Promise.all(c).then(function(){const h=new o(a);return s.name&&(h.name=s.name),xf(h,s),t.associations.set(h,{materials:e}),s.extensions&&mm(r,h,s),h})}createUniqueName(e){const t=li.sanitizeNodeName(e||"");return t in this.nodeNamesUsed?t+"_"+ ++this.nodeNamesUsed[t]:(this.nodeNamesUsed[t]=0,t)}loadGeometries(e){const t=this,n=this.extensions,r=this.primitiveCache;function s(a){return n[ui.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(a,t).then(function(l){return P9(l,a,t)})}const o=[];for(let a=0,l=e.length;a<l;a++){const c=e[a],u=rue(c),h=r[u];if(h)o.push(h.promise);else{let f;c.extensions&&c.extensions[ui.KHR_DRACO_MESH_COMPRESSION]?f=s(c):f=P9(new fn,c,t),r[u]={primitive:c,promise:f},o.push(f)}}return Promise.all(o)}loadMesh(e){const t=this,n=this.json,r=this.extensions,s=n.meshes[e],o=s.primitives,a=[];for(let l=0,c=o.length;l<c;l++){const u=o[l].material===void 0?tue(this.cache):this.getDependency("material",o[l].material);a.push(u)}return a.push(t.loadGeometries(o)),Promise.all(a).then(function(l){const c=l.slice(0,l.length-1),u=l[l.length-1],h=[];for(let d=0,m=u.length;d<m;d++){const A=u[d],g=o[d];let y;const E=c[d];if(g.mode===ic.TRIANGLES||g.mode===ic.TRIANGLE_STRIP||g.mode===ic.TRIANGLE_FAN||g.mode===void 0)y=s.isSkinnedMesh===!0?new ox(A,E):new It(A,E),y.isSkinnedMesh===!0&&y.normalizeSkinWeights(),g.mode===ic.TRIANGLE_STRIP?y.geometry=y9(y.geometry,A6):g.mode===ic.TRIANGLE_FAN&&(y.geometry=y9(y.geometry,wS));else if(g.mode===ic.LINES)y=new Ru(A,E);else if(g.mode===ic.LINE_STRIP)y=new Yn(A,E);else if(g.mode===ic.LINE_LOOP)y=new b6(A,E);else if(g.mode===ic.POINTS)y=new I6(A,E);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+g.mode);Object.keys(y.geometry.morphAttributes).length>0&&iue(y,s),y.name=t.createUniqueName(s.name||"mesh_"+e),xf(y,s),g.extensions&&mm(r,y,g),t.assignFinalMaterial(y),h.push(y)}for(let d=0,m=h.length;d<m;d++)t.associations.set(h[d],{meshes:e,primitives:d});if(h.length===1)return s.extensions&&mm(r,h[0],s),h[0];const f=new xa;s.extensions&&mm(r,f,s),t.associations.set(f,{meshes:e});for(let d=0,m=h.length;d<m;d++)f.add(h[d]);return f})}loadCamera(e){let t;const n=this.json.cameras[e],r=n[n.type];if(!r){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return n.type==="perspective"?t=new Wn(un.radToDeg(r.yfov),r.aspectRatio||1,r.znear||1,r.zfar||2e6):n.type==="orthographic"&&(t=new qi(-r.xmag,r.xmag,r.ymag,-r.ymag,r.znear,r.zfar)),n.name&&(t.name=this.createUniqueName(n.name)),xf(t,n),Promise.resolve(t)}loadSkin(e){const t=this.json.skins[e],n=[];for(let r=0,s=t.joints.length;r<s;r++)n.push(this._loadNodeShallow(t.joints[r]));return t.inverseBindMatrices!==void 0?n.push(this.getDependency("accessor",t.inverseBindMatrices)):n.push(null),Promise.all(n).then(function(r){const s=r.pop(),o=r,a=[],l=[];for(let c=0,u=o.length;c<u;c++){const h=o[c];if(h){a.push(h);const f=new Xe;s!==null&&f.fromArray(s.array,c*16),l.push(f)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[c])}return new _A(a,l)})}loadAnimation(e){const t=this.json,n=this,r=t.animations[e],s=r.name?r.name:"animation_"+e,o=[],a=[],l=[],c=[],u=[];for(let h=0,f=r.channels.length;h<f;h++){const d=r.channels[h],m=r.samplers[d.sampler],A=d.target,g=A.node,y=r.parameters!==void 0?r.parameters[m.input]:m.input,E=r.parameters!==void 0?r.parameters[m.output]:m.output;A.node!==void 0&&(o.push(this.getDependency("node",g)),a.push(this.getDependency("accessor",y)),l.push(this.getDependency("accessor",E)),c.push(m),u.push(A))}return Promise.all([Promise.all(o),Promise.all(a),Promise.all(l),Promise.all(c),Promise.all(u)]).then(function(h){const f=h[0],d=h[1],m=h[2],A=h[3],g=h[4],y=[];for(let E=0,x=f.length;E<x;E++){const C=f[E],T=d[E],I=m[E],M=A[E],L=g[E];if(C===void 0)continue;C.updateMatrix&&C.updateMatrix();const R=n._createAnimationTracks(C,T,I,M,L);if(R)for(let P=0;P<R.length;P++)y.push(R[P])}return new op(s,void 0,y)})}createNodeMesh(e){const t=this.json,n=this,r=t.nodes[e];return r.mesh===void 0?null:n.getDependency("mesh",r.mesh).then(function(s){const o=n._getNodeRef(n.meshCache,r.mesh,s);return r.weights!==void 0&&o.traverse(function(a){if(a.isMesh)for(let l=0,c=r.weights.length;l<c;l++)a.morphTargetInfluences[l]=r.weights[l]}),o})}loadNode(e){const t=this.json,n=this,r=t.nodes[e],s=n._loadNodeShallow(e),o=[],a=r.children||[];for(let c=0,u=a.length;c<u;c++)o.push(n.getDependency("node",a[c]));const l=r.skin===void 0?Promise.resolve(null):n.getDependency("skin",r.skin);return Promise.all([s,Promise.all(o),l]).then(function(c){const u=c[0],h=c[1],f=c[2];f!==null&&u.traverse(function(d){d.isSkinnedMesh&&d.bind(f,oue)});for(let d=0,m=h.length;d<m;d++)u.add(h[d]);return u})}_loadNodeShallow(e){const t=this.json,n=this.extensions,r=this;if(this.nodeCache[e]!==void 0)return this.nodeCache[e];const s=t.nodes[e],o=s.name?r.createUniqueName(s.name):"",a=[],l=r._invokeOne(function(c){return c.createNodeMesh&&c.createNodeMesh(e)});return l&&a.push(l),s.camera!==void 0&&a.push(r.getDependency("camera",s.camera).then(function(c){return r._getNodeRef(r.cameraCache,s.camera,c)})),r._invokeAll(function(c){return c.createNodeAttachment&&c.createNodeAttachment(e)}).forEach(function(c){a.push(c)}),this.nodeCache[e]=Promise.all(a).then(function(c){let u;if(s.isBone===!0?u=new tA:c.length>1?u=new xa:c.length===1?u=c[0]:u=new _n,u!==c[0])for(let h=0,f=c.length;h<f;h++)u.add(c[h]);if(s.name&&(u.userData.name=s.name,u.name=o),xf(u,s),s.extensions&&mm(n,u,s),s.matrix!==void 0){const h=new Xe;h.fromArray(s.matrix),u.applyMatrix4(h)}else s.translation!==void 0&&u.position.fromArray(s.translation),s.rotation!==void 0&&u.quaternion.fromArray(s.rotation),s.scale!==void 0&&u.scale.fromArray(s.scale);return r.associations.has(u)||r.associations.set(u,{}),r.associations.get(u).nodes=e,u}),this.nodeCache[e]}loadScene(e){const t=this.extensions,n=this.json.scenes[e],r=this,s=new xa;n.name&&(s.name=r.createUniqueName(n.name)),xf(s,n),n.extensions&&mm(t,s,n);const o=n.nodes||[],a=[];for(let l=0,c=o.length;l<c;l++)a.push(r.getDependency("node",o[l]));return Promise.all(a).then(function(l){for(let u=0,h=l.length;u<h;u++)s.add(l[u]);const c=u=>{const h=new Map;for(const[f,d]of r.associations)(f instanceof Us||f instanceof vi)&&h.set(f,d);return u.traverse(f=>{const d=r.associations.get(f);d!=null&&h.set(f,d)}),h};return r.associations=c(s),s})}_createAnimationTracks(e,t,n,r,s){const o=[],a=e.name?e.name:e.uuid,l=[];Md[s.path]===Md.weights?e.traverse(function(f){f.morphTargetInfluences&&l.push(f.name?f.name:f.uuid)}):l.push(a);let c;switch(Md[s.path]){case Md.weights:c=sp;break;case Md.rotation:c=vh;break;case Md.position:case Md.scale:c=Of;break;default:switch(n.itemSize){case 1:c=sp;break;case 2:case 3:default:c=Of;break}break}const u=r.interpolation!==void 0?eue[r.interpolation]:Jm,h=this._getArrayFromAccessor(n);for(let f=0,d=l.length;f<d;f++){const m=new c(l[f]+"."+Md[s.path],t.array,h,u);r.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(m),o.push(m)}return o}_getArrayFromAccessor(e){let t=e.array;if(e.normalized){const n=i5(t.constructor),r=new Float32Array(t.length);for(let s=0,o=t.length;s<o;s++)r[s]=t[s]*n;t=r}return t}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(n){const r=this instanceof vh?Zce:uH;return new r(this.times,this.values,this.getValueSize()/3,n)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function lue(i,e,t){const n=e.attributes,r=new ti;if(n.POSITION!==void 0){const a=t.json.accessors[n.POSITION],l=a.min,c=a.max;if(l!==void 0&&c!==void 0){if(r.set(new H(l[0],l[1],l[2]),new H(c[0],c[1],c[2])),a.normalized){const u=i5(H1[a.componentType]);r.min.multiplyScalar(u),r.max.multiplyScalar(u)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const s=e.targets;if(s!==void 0){const a=new H,l=new H;for(let c=0,u=s.length;c<u;c++){const h=s[c];if(h.POSITION!==void 0){const f=t.json.accessors[h.POSITION],d=f.min,m=f.max;if(d!==void 0&&m!==void 0){if(l.setX(Math.max(Math.abs(d[0]),Math.abs(m[0]))),l.setY(Math.max(Math.abs(d[1]),Math.abs(m[1]))),l.setZ(Math.max(Math.abs(d[2]),Math.abs(m[2]))),f.normalized){const A=i5(H1[f.componentType]);l.multiplyScalar(A)}a.max(l)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}r.expandByVector(a)}i.boundingBox=r;const o=new Bi;r.getCenter(o.center),o.radius=r.min.distanceTo(r.max)/2,i.boundingSphere=o}function P9(i,e,t){const n=e.attributes,r=[];function s(o,a){return t.getDependency("accessor",o).then(function(l){i.setAttribute(a,l)})}for(const o in n){const a=n5[o]||o.toLowerCase();a in i.attributes||r.push(s(n[o],a))}if(e.indices!==void 0&&!i.index){const o=t.getDependency("accessor",e.indices).then(function(a){i.setIndex(a)});r.push(o)}return xf(i,e),lue(i,e,t),Promise.all(r).then(function(){return e.targets!==void 0?nue(i,e.targets,t):i})}class cue extends fn{constructor(e,t,n,r){super();const s=[],o=[],a=[],l=new H,c=new Xe;c.makeRotationFromEuler(n),c.setPosition(t);const u=new Xe;u.copy(c).invert(),h(),this.setAttribute("position",new Gt(s,3)),this.setAttribute("normal",new Gt(o,3)),this.setAttribute("uv",new Gt(a,2));function h(){let A,g=[];const y=new H,E=new H;if(e.geometry.isGeometry===!0){console.error("THREE.DecalGeometry no longer supports THREE.Geometry. Use BufferGeometry instead.");return}const x=e.geometry,C=x.attributes.position,T=x.attributes.normal;if(x.index!==null){const I=x.index;for(A=0;A<I.count;A++)y.fromBufferAttribute(C,I.getX(A)),E.fromBufferAttribute(T,I.getX(A)),f(g,y,E)}else for(A=0;A<C.count;A++)y.fromBufferAttribute(C,A),E.fromBufferAttribute(T,A),f(g,y,E);for(g=d(g,l.set(1,0,0)),g=d(g,l.set(-1,0,0)),g=d(g,l.set(0,1,0)),g=d(g,l.set(0,-1,0)),g=d(g,l.set(0,0,1)),g=d(g,l.set(0,0,-1)),A=0;A<g.length;A++){const I=g[A];a.push(.5+I.position.x/r.x,.5+I.position.y/r.y),I.position.applyMatrix4(c),s.push(I.position.x,I.position.y,I.position.z),o.push(I.normal.x,I.normal.y,I.normal.z)}}function f(A,g,y){g.applyMatrix4(e.matrixWorld),g.applyMatrix4(u),y.transformDirection(e.matrixWorld),A.push(new B9(g.clone(),y.clone()))}function d(A,g){const y=[],E=.5*Math.abs(r.dot(g));for(let x=0;x<A.length;x+=3){let C,T,I,M=0,L,R,P,F;const k=A[x+0].position.dot(g)-E,z=A[x+1].position.dot(g)-E,U=A[x+2].position.dot(g)-E;switch(C=k>0,T=z>0,I=U>0,M=(C?1:0)+(T?1:0)+(I?1:0),M){case 0:{y.push(A[x]),y.push(A[x+1]),y.push(A[x+2]);break}case 1:{if(C&&(L=A[x+1],R=A[x+2],P=m(A[x],L,g,E),F=m(A[x],R,g,E)),T){L=A[x],R=A[x+2],P=m(A[x+1],L,g,E),F=m(A[x+1],R,g,E),y.push(P),y.push(R.clone()),y.push(L.clone()),y.push(R.clone()),y.push(P.clone()),y.push(F);break}I&&(L=A[x],R=A[x+1],P=m(A[x+2],L,g,E),F=m(A[x+2],R,g,E)),y.push(L.clone()),y.push(R.clone()),y.push(P),y.push(F),y.push(P.clone()),y.push(R.clone());break}case 2:{C||(L=A[x].clone(),R=m(L,A[x+1],g,E),P=m(L,A[x+2],g,E),y.push(L),y.push(R),y.push(P)),T||(L=A[x+1].clone(),R=m(L,A[x+2],g,E),P=m(L,A[x],g,E),y.push(L),y.push(R),y.push(P)),I||(L=A[x+2].clone(),R=m(L,A[x],g,E),P=m(L,A[x+1],g,E),y.push(L),y.push(R),y.push(P));break}}}return y}function m(A,g,y,E){const x=A.position.dot(y)-E,C=g.position.dot(y)-E,T=x/(x-C);return new B9(new H(A.position.x+T*(g.position.x-A.position.x),A.position.y+T*(g.position.y-A.position.y),A.position.z+T*(g.position.z-A.position.z)),new H(A.normal.x+T*(g.normal.x-A.normal.x),A.normal.y+T*(g.normal.y-A.normal.y),A.normal.z+T*(g.normal.z-A.normal.z)))}}}class B9{constructor(e,t){this.position=e,this.normal=t}clone(){return new this.constructor(this.position.clone(),this.normal.clone())}}class uue extends ux{constructor(e,t={}){const{bevelEnabled:n=!1,bevelSize:r=8,bevelThickness:s=10,font:o,height:a=50,size:l=100,lineHeight:c=1,letterSpacing:u=0,...h}=t;if(o===void 0)super();else{const f=o.generateShapes(e,l,{lineHeight:c,letterSpacing:u});super(f,{...h,bevelEnabled:n,bevelSize:r,bevelThickness:s,depth:a})}this.type="TextGeometry"}}const hue={uniforms:{tDiffuse:{value:null}},vertexShader:`
    varying vec2 vUv;

    void main() {

    	vUv = uv;
    	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

    }
  `,fragmentShader:`
    uniform sampler2D tDiffuse;

    varying vec2 vUv;

    void main() {

    	vec4 tex = texture2D( tDiffuse, vUv );

    	#ifdef LinearTosRGB
    		gl_FragColor = LinearTosRGB( tex );
    	#else
    		gl_FragColor = sRGBTransferOETF( tex );
    	#endif

    }
  `},fue={uniforms:{tDiffuse:{value:null},h:{value:1/512}},vertexShader:`
      varying vec2 vUv;

      void main() {

        vUv = uv;
        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

      }
  `,fragmentShader:`
    uniform sampler2D tDiffuse;
    uniform float h;

    varying vec2 vUv;

    void main() {

    	vec4 sum = vec4( 0.0 );

    	sum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * h, vUv.y ) ) * 0.051;
    	sum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * h, vUv.y ) ) * 0.0918;
    	sum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * h, vUv.y ) ) * 0.12245;
    	sum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * h, vUv.y ) ) * 0.1531;
    	sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
    	sum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * h, vUv.y ) ) * 0.1531;
    	sum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * h, vUv.y ) ) * 0.12245;
    	sum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * h, vUv.y ) ) * 0.0918;
    	sum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * h, vUv.y ) ) * 0.051;

    	gl_FragColor = sum;

    }
  `},due={uniforms:{tDiffuse:{value:null},v:{value:1/512}},vertexShader:`
    varying vec2 vUv;

    void main() {

      vUv = uv;
      gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

    }
  `,fragmentShader:`

  uniform sampler2D tDiffuse;
  uniform float v;

  varying vec2 vUv;

  void main() {

    vec4 sum = vec4( 0.0 );

    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * v ) ) * 0.051;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * v ) ) * 0.0918;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * v ) ) * 0.12245;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * v ) ) * 0.1531;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * v ) ) * 0.1531;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * v ) ) * 0.12245;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * v ) ) * 0.0918;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * v ) ) * 0.051;

    gl_FragColor = sum;

  }
  `},qT=new h0,JT=new H,Ug=new H,su=new H,hf=new H,Zu=new H,ff=new H,df=new H,Zy=new H,ev=new H,tv=new H,L3=new H,nv=new H,iv=new H,rv=new H;class pue{constructor(e,t,n){this.camera=e,this.scene=t,this.startPoint=new H,this.endPoint=new H,this.collection=[],this.deep=n||Number.MAX_VALUE}select(e,t){return this.startPoint=e||this.startPoint,this.endPoint=t||this.endPoint,this.collection=[],this.updateFrustum(this.startPoint,this.endPoint),this.searchChildInFrustum(qT,this.scene),this.collection}updateFrustum(e,t){if(e=e||this.startPoint,t=t||this.endPoint,e.x===t.x&&(t.x+=Number.EPSILON),e.y===t.y&&(t.y+=Number.EPSILON),this.camera.updateProjectionMatrix(),this.camera.updateMatrixWorld(),this.camera.isPerspectiveCamera){Ug.copy(e),Ug.x=Math.min(e.x,t.x),Ug.y=Math.max(e.y,t.y),t.x=Math.max(e.x,t.x),t.y=Math.min(e.y,t.y),su.setFromMatrixPosition(this.camera.matrixWorld),hf.copy(Ug),Zu.set(t.x,Ug.y,0),ff.copy(t),df.set(Ug.x,t.y,0),hf.unproject(this.camera),Zu.unproject(this.camera),ff.unproject(this.camera),df.unproject(this.camera),nv.copy(hf).sub(su),iv.copy(Zu).sub(su),rv.copy(ff).sub(su),nv.normalize(),iv.normalize(),rv.normalize(),nv.multiplyScalar(this.deep),iv.multiplyScalar(this.deep),rv.multiplyScalar(this.deep),nv.add(su),iv.add(su),rv.add(su);var n=qT.planes;n[0].setFromCoplanarPoints(su,hf,Zu),n[1].setFromCoplanarPoints(su,Zu,ff),n[2].setFromCoplanarPoints(ff,df,su),n[3].setFromCoplanarPoints(df,hf,su),n[4].setFromCoplanarPoints(Zu,ff,df),n[5].setFromCoplanarPoints(rv,iv,nv),n[5].normal.multiplyScalar(-1)}else if(this.camera.isOrthographicCamera){const r=Math.min(e.x,t.x),s=Math.max(e.y,t.y),o=Math.max(e.x,t.x),a=Math.min(e.y,t.y);hf.set(r,s,-1),Zu.set(o,s,-1),ff.set(o,a,-1),df.set(r,a,-1),Zy.set(r,s,1),ev.set(o,s,1),tv.set(o,a,1),L3.set(r,a,1),hf.unproject(this.camera),Zu.unproject(this.camera),ff.unproject(this.camera),df.unproject(this.camera),Zy.unproject(this.camera),ev.unproject(this.camera),tv.unproject(this.camera),L3.unproject(this.camera);var n=qT.planes;n[0].setFromCoplanarPoints(hf,Zy,ev),n[1].setFromCoplanarPoints(Zu,ev,tv),n[2].setFromCoplanarPoints(tv,L3,df),n[3].setFromCoplanarPoints(L3,Zy,hf),n[4].setFromCoplanarPoints(Zu,ff,df),n[5].setFromCoplanarPoints(tv,ev,Zy),n[5].normal.multiplyScalar(-1)}else console.error("THREE.SelectionBox: Unsupported camera type.")}searchChildInFrustum(e,t){if((t.isMesh||t.isLine||t.isPoints)&&t.material!==void 0&&(t.geometry.boundingSphere===null&&t.geometry.computeBoundingSphere(),JT.copy(t.geometry.boundingSphere.center),JT.applyMatrix4(t.matrixWorld),e.containsPoint(JT)&&this.collection.push(t)),t.children.length>0)for(let n=0;n<t.children.length;n++)this.searchChildInFrustum(e,t.children[n])}}class mue{constructor(e,t=" .:-=+*#%@",n={}){const r=n.resolution||.15,s=n.scale||1,o=n.color||!1,a=n.alpha||!1,l=n.block||!1,c=n.invert||!1,u=n.strResolution||"low";let h,f;const d=document.createElement("div");d.style.cursor="default";const m=document.createElement("table");d.appendChild(m);let A,g,y;this.setSize=function(U,W){h=U,f=W,e.setSize(U,W),E()},this.render=function(U,W){e.render(U,W),z(m)},this.domElement=d;function E(){A=Math.floor(h*r),g=Math.floor(f*r),M.width=A,M.height=g,y=e.domElement,y.style.backgroundColor&&(m.rows[0].cells[0].style.backgroundColor=y.style.backgroundColor,m.rows[0].cells[0].style.color=y.style.color),m.cellSpacing=0,m.cellPadding=0;const U=m.style;U.whiteSpace="pre",U.margin="0px",U.padding="0px",U.letterSpacing=k+"px",U.fontFamily=T,U.fontSize=P+"px",U.lineHeight=F+"px",U.textAlign="left",U.textDecoration="none"}const x=" .,:;i1tfLCG08@".split(""),C=" CGO08@".split(""),T="courier new, monospace",I=e.domElement,M=document.createElement("canvas");if(!M.getContext)return;const L=M.getContext("2d");if(!L.getImageData)return;let R=o?C:x;t&&(R=t);const P=2/r*s,F=2/r*s;let k=0;if(u=="low")switch(s){case 1:k=-1;break;case 2:case 3:k=-2.1;break;case 4:k=-3.1;break;case 5:k=-4.15;break}if(u=="medium")switch(s){case 1:k=0;break;case 2:k=-1;break;case 3:k=-1.04;break;case 4:case 5:k=-2.1;break}if(u=="high")switch(s){case 1:case 2:k=0;break;case 3:case 4:case 5:k=-1;break}function z(U){L.clearRect(0,0,A,g),L.drawImage(I,0,0,A,g);const W=L.getImageData(0,0,A,g).data;let $="";for(let oe=0;oe<g;oe+=2){for(let X=0;X<A;X++){const Q=(oe*A+X)*4,Y=W[Q],O=W[Q+1],K=W[Q+2],te=W[Q+3];let q,J;J=(.3*Y+.59*O+.11*K)/255,te==0&&(J=1),q=Math.floor((1-J)*(R.length-1)),c&&(q=R.length-q-1);let ie=R[q];(ie===void 0||ie==" ")&&(ie="&nbsp;"),o?$+="<span style='color:rgb("+Y+","+O+","+K+");"+(l?"background-color:rgb("+Y+","+O+","+K+");":"")+(a?"opacity:"+te/255+";":"")+"'>"+ie+"</span>":$+=ie}$+="<br/>"}U.innerHTML=`<tr><td style="display:block;width:${h}px;height:${f}px;overflow:hidden">${$}</td></tr>`}}}function hH(i,e,t){const n=t.length-i-1;if(e>=t[n])return n-1;if(e<=t[i])return i;let r=i,s=n,o=Math.floor((r+s)/2);for(;e<t[o]||e>=t[o+1];)e<t[o]?s=o:r=o,o=Math.floor((r+s)/2);return o}function gue(i,e,t,n){const r=[],s=[],o=[];r[0]=1;for(let a=1;a<=t;++a){s[a]=e-n[i+1-a],o[a]=n[i+a]-e;let l=0;for(let c=0;c<a;++c){const u=o[c+1],h=s[a-c],f=r[c]/(u+h);r[c]=l+u*f,l=h*f}r[a]=l}return r}function Aue(i,e,t,n){const r=hH(i,n,e),s=gue(r,n,i,e),o=new Rn(0,0,0,0);for(let a=0;a<=i;++a){const l=t[r-i+a],c=s[a],u=l.w*c;o.x+=l.x*u,o.y+=l.y*u,o.z+=l.z*u,o.w+=l.w*c}return o}function yue(i,e,t,n,r){const s=[];for(let h=0;h<=t;++h)s[h]=0;const o=[];for(let h=0;h<=n;++h)o[h]=s.slice(0);const a=[];for(let h=0;h<=t;++h)a[h]=s.slice(0);a[0][0]=1;const l=s.slice(0),c=s.slice(0);for(let h=1;h<=t;++h){l[h]=e-r[i+1-h],c[h]=r[i+h]-e;let f=0;for(let d=0;d<h;++d){const m=c[d+1],A=l[h-d];a[h][d]=m+A;const g=a[d][h-1]/a[h][d];a[d][h]=f+m*g,f=A*g}a[h][h]=f}for(let h=0;h<=t;++h)o[0][h]=a[h][t];for(let h=0;h<=t;++h){let f=0,d=1;const m=[];for(let A=0;A<=t;++A)m[A]=s.slice(0);m[0][0]=1;for(let A=1;A<=n;++A){let g=0;const y=h-A,E=t-A;h>=A&&(m[d][0]=m[f][0]/a[E+1][y],g=m[d][0]*a[y][E]);const x=y>=-1?1:-y,C=h-1<=E?A-1:t-h;for(let I=x;I<=C;++I)m[d][I]=(m[f][I]-m[f][I-1])/a[E+1][y+I],g+=m[d][I]*a[y+I][E];h<=E&&(m[d][A]=-m[f][A-1]/a[E+1][h],g+=m[d][A]*a[h][E]),o[A][h]=g;const T=f;f=d,d=T}}let u=t;for(let h=1;h<=n;++h){for(let f=0;f<=t;++f)o[h][f]*=u;u*=t-h}return o}function vue(i,e,t,n,r){const s=r<i?r:i,o=[],a=hH(i,n,e),l=yue(a,n,i,s,e),c=[];for(let u=0;u<t.length;++u){const h=t[u].clone(),f=h.w;h.x*=f,h.y*=f,h.z*=f,c[u]=h}for(let u=0;u<=s;++u){const h=c[a-i].clone().multiplyScalar(l[u][0]);for(let f=1;f<=i;++f)h.add(c[a-i+f].clone().multiplyScalar(l[u][f]));o[u]=h}for(let u=s+1;u<=r+1;++u)o[u]=new Rn(0,0,0);return o}function xue(i,e){let t=1;for(let r=2;r<=i;++r)t*=r;let n=1;for(let r=2;r<=e;++r)n*=r;for(let r=2;r<=i-e;++r)n*=r;return t/n}function Eue(i){const e=i.length,t=[],n=[];for(let s=0;s<e;++s){const o=i[s];t[s]=new H(o.x,o.y,o.z),n[s]=o.w}const r=[];for(let s=0;s<e;++s){const o=t[s].clone();for(let a=1;a<=s;++a)o.sub(r[s-a].clone().multiplyScalar(xue(s,a)*n[a]));r[s]=o.divideScalar(n[0])}return r}function _ue(i,e,t,n,r){const s=vue(i,e,t,n,r);return Eue(s)}class D9 extends xc{constructor(e,t,n,r,s){super(),this.degree=e,this.knots=t,this.controlPoints=[],this.startKnot=r||0,this.endKnot=s||this.knots.length-1;for(let o=0;o<n.length;++o){const a=n[o];this.controlPoints[o]=new Rn(a.x,a.y,a.z,a.w)}}getPoint(e,t){const n=t||new H,r=this.knots[this.startKnot]+e*(this.knots[this.endKnot]-this.knots[this.startKnot]),s=Aue(this.degree,this.knots,this.controlPoints,r);return s.w!=1&&s.divideScalar(s.w),n.set(s.x,s.y,s.z)}getTangent(e,t){const n=t||new H,r=this.knots[0]+e*(this.knots[this.knots.length-1]-this.knots[0]),s=_ue(this.degree,this.knots,this.controlPoints,r,1);return n.copy(s[1]).normalize(),n}}let ci,ps,Ka;class CR extends os{constructor(e){super(e)}load(e,t,n,r){const s=this,o=s.path===""?Pf.extractUrlBase(e):s.path,a=new $r(this.manager);a.setPath(s.path),a.setResponseType("arraybuffer"),a.setRequestHeader(s.requestHeader),a.setWithCredentials(s.withCredentials),a.load(e,function(l){try{t(s.parse(l,o))}catch(c){r?r(c):console.error(c),s.manager.itemError(e)}},n,r)}parse(e,t){if(Iue(e))ci=new bue().parse(e);else{const r=mH(e);if(!Mue(r))throw new Error("THREE.FBXLoader: Unknown format.");if(F9(r)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+F9(r));ci=new Tue().parse(r)}const n=new xh(this.manager).setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin);return new Sue(n,this.manager).parse(ci)}}class Sue{constructor(e,t){this.textureLoader=e,this.manager=t}parse(){ps=this.parseConnections();const e=this.parseImages(),t=this.parseTextures(e),n=this.parseMaterials(t),r=this.parseDeformers(),s=new wue().parse(r);return this.parseScene(r,s,n),Ka}parseConnections(){const e=new Map;return"Connections"in ci&&ci.Connections.connections.forEach(function(n){const r=n[0],s=n[1],o=n[2];e.has(r)||e.set(r,{parents:[],children:[]});const a={ID:s,relationship:o};e.get(r).parents.push(a),e.has(s)||e.set(s,{parents:[],children:[]});const l={ID:r,relationship:o};e.get(s).children.push(l)}),e}parseImages(){const e={},t={};if("Video"in ci.Objects){const n=ci.Objects.Video;for(const r in n){const s=n[r],o=parseInt(r);if(e[o]=s.RelativeFilename||s.Filename,"Content"in s){const a=s.Content instanceof ArrayBuffer&&s.Content.byteLength>0,l=typeof s.Content=="string"&&s.Content!=="";if(a||l){const c=this.parseImage(n[r]);t[s.RelativeFilename||s.Filename]=c}}}}for(const n in e){const r=e[n];t[r]!==void 0?e[n]=t[r]:e[n]=e[n].split("\\").pop()}return e}parseImage(e){const t=e.Content,n=e.RelativeFilename||e.Filename,r=n.slice(n.lastIndexOf(".")+1).toLowerCase();let s;switch(r){case"bmp":s="image/bmp";break;case"jpg":case"jpeg":s="image/jpeg";break;case"png":s="image/png";break;case"tif":s="image/tiff";break;case"tga":this.manager.getHandler(".tga")===null&&console.warn("FBXLoader: TGA loader not found, skipping ",n),s="image/tga";break;default:console.warn('FBXLoader: Image type "'+r+'" is not supported.');return}if(typeof t=="string")return"data:"+s+";base64,"+t;{const o=new Uint8Array(t);return window.URL.createObjectURL(new Blob([o],{type:s}))}}parseTextures(e){const t=new Map;if("Texture"in ci.Objects){const n=ci.Objects.Texture;for(const r in n){const s=this.parseTexture(n[r],e);t.set(parseInt(r),s)}}return t}parseTexture(e,t){const n=this.loadTexture(e,t);n.ID=e.id,n.name=e.attrName;const r=e.WrapModeU,s=e.WrapModeV,o=r!==void 0?r.value:0,a=s!==void 0?s.value:0;if(n.wrapS=o===0?_o:ji,n.wrapT=a===0?_o:ji,"Scaling"in e){const l=e.Scaling.value;n.repeat.x=l[0],n.repeat.y=l[1]}return n}loadTexture(e,t){let n;const r=this.textureLoader.path,s=ps.get(e.id).children;s!==void 0&&s.length>0&&t[s[0].ID]!==void 0&&(n=t[s[0].ID],(n.indexOf("blob:")===0||n.indexOf("data:")===0)&&this.textureLoader.setPath(void 0));let o;const a=e.FileName.slice(-3).toLowerCase();if(a==="tga"){const l=this.manager.getHandler(".tga");l===null?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",e.RelativeFilename),o=new vi):(l.setPath(this.textureLoader.path),o=l.load(n))}else a==="psd"?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",e.RelativeFilename),o=new vi):o=this.textureLoader.load(n);return this.textureLoader.setPath(r),o}parseMaterials(e){const t=new Map;if("Material"in ci.Objects){const n=ci.Objects.Material;for(const r in n){const s=this.parseMaterial(n[r],e);s!==null&&t.set(parseInt(r),s)}}return t}parseMaterial(e,t){const n=e.id,r=e.attrName;let s=e.ShadingModel;if(typeof s=="object"&&(s=s.value),!ps.has(n))return null;const o=this.parseParameters(e,t,n);let a;switch(s.toLowerCase()){case"phong":a=new Jv;break;case"lambert":a=new fx;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',s),a=new Jv;break}return a.setValues(o),a.name=r,a}parseParameters(e,t,n){const r={};e.BumpFactor&&(r.bumpScale=e.BumpFactor.value),e.Diffuse?r.color=new ut().fromArray(e.Diffuse.value):e.DiffuseColor&&(e.DiffuseColor.type==="Color"||e.DiffuseColor.type==="ColorRGB")&&(r.color=new ut().fromArray(e.DiffuseColor.value)),e.DisplacementFactor&&(r.displacementScale=e.DisplacementFactor.value),e.Emissive?r.emissive=new ut().fromArray(e.Emissive.value):e.EmissiveColor&&(e.EmissiveColor.type==="Color"||e.EmissiveColor.type==="ColorRGB")&&(r.emissive=new ut().fromArray(e.EmissiveColor.value)),e.EmissiveFactor&&(r.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),e.Opacity&&(r.opacity=parseFloat(e.Opacity.value)),r.opacity<1&&(r.transparent=!0),e.ReflectionFactor&&(r.reflectivity=e.ReflectionFactor.value),e.Shininess&&(r.shininess=e.Shininess.value),e.Specular?r.specular=new ut().fromArray(e.Specular.value):e.SpecularColor&&e.SpecularColor.type==="Color"&&(r.specular=new ut().fromArray(e.SpecularColor.value));const s=this;return ps.get(n).children.forEach(function(o){const a=o.relationship;switch(a){case"Bump":r.bumpMap=s.getTexture(t,o.ID);break;case"Maya|TEX_ao_map":r.aoMap=s.getTexture(t,o.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":r.map=s.getTexture(t,o.ID),r.map!==void 0&&("colorSpace"in r.map?r.map.colorSpace="srgb":r.map.encoding=3001);break;case"DisplacementColor":r.displacementMap=s.getTexture(t,o.ID);break;case"EmissiveColor":r.emissiveMap=s.getTexture(t,o.ID),r.emissiveMap!==void 0&&("colorSpace"in r.emissiveMap?r.emissiveMap.colorSpace="srgb":r.emissiveMap.encoding=3001);break;case"NormalMap":case"Maya|TEX_normal_map":r.normalMap=s.getTexture(t,o.ID);break;case"ReflectionColor":r.envMap=s.getTexture(t,o.ID),r.envMap!==void 0&&(r.envMap.mapping=Ym,"colorSpace"in r.envMap?r.envMap.colorSpace="srgb":r.envMap.encoding=3001);break;case"SpecularColor":r.specularMap=s.getTexture(t,o.ID),r.specularMap!==void 0&&("colorSpace"in r.specularMap?r.specularMap.colorSpace="srgb":r.specularMap.encoding=3001);break;case"TransparentColor":case"TransparencyFactor":r.alphaMap=s.getTexture(t,o.ID),r.transparent=!0;break;case"AmbientColor":case"ShininessExponent":case"SpecularFactor":case"VectorDisplacementColor":default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",a);break}}),r}getTexture(e,t){return"LayeredTexture"in ci.Objects&&t in ci.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),t=ps.get(t).children[0].ID),e.get(t)}parseDeformers(){const e={},t={};if("Deformer"in ci.Objects){const n=ci.Objects.Deformer;for(const r in n){const s=n[r],o=ps.get(parseInt(r));if(s.attrType==="Skin"){const a=this.parseSkeleton(o,n);a.ID=r,o.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),a.geometryID=o.parents[0].ID,e[r]=a}else if(s.attrType==="BlendShape"){const a={id:r};a.rawTargets=this.parseMorphTargets(o,n),a.id=r,o.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),t[r]=a}}}return{skeletons:e,morphTargets:t}}parseSkeleton(e,t){const n=[];return e.children.forEach(function(r){const s=t[r.ID];if(s.attrType!=="Cluster")return;const o={ID:r.ID,indices:[],weights:[],transformLink:new Xe().fromArray(s.TransformLink.a)};"Indexes"in s&&(o.indices=s.Indexes.a,o.weights=s.Weights.a),n.push(o)}),{rawBones:n,bones:[]}}parseMorphTargets(e,t){const n=[];for(let r=0;r<e.children.length;r++){const s=e.children[r],o=t[s.ID],a={name:o.attrName,initialWeight:o.DeformPercent,id:o.id,fullWeights:o.FullWeights.a};if(o.attrType!=="BlendShapeChannel")return;a.geoID=ps.get(parseInt(s.ID)).children.filter(function(l){return l.relationship===void 0})[0].ID,n.push(a)}return n}parseScene(e,t,n){Ka=new xa;const r=this.parseModels(e.skeletons,t,n),s=ci.Objects.Model,o=this;r.forEach(function(l){const c=s[l.ID];o.setLookAtProperties(l,c),ps.get(l.ID).parents.forEach(function(h){const f=r.get(h.ID);f!==void 0&&f.add(l)}),l.parent===null&&Ka.add(l)}),this.bindSkeleton(e.skeletons,t,r),this.createAmbientLight(),Ka.traverse(function(l){if(l.userData.transformData){l.parent&&(l.userData.transformData.parentMatrix=l.parent.matrix,l.userData.transformData.parentMatrixWorld=l.parent.matrixWorld);const c=dH(l.userData.transformData);l.applyMatrix4(c),l.updateWorldMatrix()}});const a=new Cue().parse();Ka.children.length===1&&Ka.children[0].isGroup&&(Ka.children[0].animations=a,Ka=Ka.children[0]),Ka.animations=a}parseModels(e,t,n){const r=new Map,s=ci.Objects.Model;for(const o in s){const a=parseInt(o),l=s[o],c=ps.get(a);let u=this.buildSkeleton(c,e,a,l.attrName);if(!u){switch(l.attrType){case"Camera":u=this.createCamera(c);break;case"Light":u=this.createLight(c);break;case"Mesh":u=this.createMesh(c,t,n);break;case"NurbsCurve":u=this.createCurve(c,t);break;case"LimbNode":case"Root":u=new tA;break;case"Null":default:u=new xa;break}u.name=l.attrName?li.sanitizeNodeName(l.attrName):"",u.ID=a}this.getTransformData(u,l),r.set(a,u)}return r}buildSkeleton(e,t,n,r){let s=null;return e.parents.forEach(function(o){for(const a in t){const l=t[a];l.rawBones.forEach(function(c,u){if(c.ID===o.ID){const h=s;s=new tA,s.matrixWorld.copy(c.transformLink),s.name=r?li.sanitizeNodeName(r):"",s.ID=n,l.bones[u]=s,h!==null&&s.add(h)}})}}),s}createCamera(e){let t,n;if(e.children.forEach(function(r){const s=ci.Objects.NodeAttribute[r.ID];s!==void 0&&(n=s)}),n===void 0)t=new _n;else{let r=0;n.CameraProjectionType!==void 0&&n.CameraProjectionType.value===1&&(r=1);let s=1;n.NearPlane!==void 0&&(s=n.NearPlane.value/1e3);let o=1e3;n.FarPlane!==void 0&&(o=n.FarPlane.value/1e3);let a=window.innerWidth,l=window.innerHeight;n.AspectWidth!==void 0&&n.AspectHeight!==void 0&&(a=n.AspectWidth.value,l=n.AspectHeight.value);const c=a/l;let u=45;n.FieldOfView!==void 0&&(u=n.FieldOfView.value);const h=n.FocalLength?n.FocalLength.value:null;switch(r){case 0:t=new Wn(u,c,s,o),h!==null&&t.setFocalLength(h);break;case 1:t=new qi(-a/2,a/2,l/2,-l/2,s,o);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+r+"."),t=new _n;break}}return t}createLight(e){let t,n;if(e.children.forEach(function(r){const s=ci.Objects.NodeAttribute[r.ID];s!==void 0&&(n=s)}),n===void 0)t=new _n;else{let r;n.LightType===void 0?r=0:r=n.LightType.value;let s=16777215;n.Color!==void 0&&(s=new ut().fromArray(n.Color.value));let o=n.Intensity===void 0?1:n.Intensity.value/100;n.CastLightOnObject!==void 0&&n.CastLightOnObject.value===0&&(o=0);let a=0;n.FarAttenuationEnd!==void 0&&(n.EnableFarAttenuation!==void 0&&n.EnableFarAttenuation.value===0?a=0:a=n.FarAttenuationEnd.value);const l=1;switch(r){case 0:t=new B2(s,o,a,l);break;case 1:t=new jw(s,o);break;case 2:let c=Math.PI/3;n.InnerAngle!==void 0&&(c=un.degToRad(n.InnerAngle.value));let u=0;n.OuterAngle!==void 0&&(u=un.degToRad(n.OuterAngle.value),u=Math.max(u,1)),t=new Ww(s,o,a,c,u,l);break;default:console.warn("THREE.FBXLoader: Unknown light type "+n.LightType.value+", defaulting to a PointLight."),t=new B2(s,o);break}n.CastShadows!==void 0&&n.CastShadows.value===1&&(t.castShadow=!0)}return t}createMesh(e,t,n){let r,s=null,o=null;const a=[];return e.children.forEach(function(l){t.has(l.ID)&&(s=t.get(l.ID)),n.has(l.ID)&&a.push(n.get(l.ID))}),a.length>1?o=a:a.length>0?o=a[0]:(o=new Jv({color:13421772}),a.push(o)),"color"in s.attributes&&a.forEach(function(l){l.vertexColors=!0}),s.FBX_Deformer?(r=new ox(s,o),r.normalizeSkinWeights()):r=new It(s,o),r}createCurve(e,t){const n=e.children.reduce(function(s,o){return t.has(o.ID)&&(s=t.get(o.ID)),s},null),r=new vs({color:3342591,linewidth:1});return new Yn(n,r)}getTransformData(e,t){const n={};"InheritType"in t&&(n.inheritType=parseInt(t.InheritType.value)),"RotationOrder"in t?n.eulerOrder=pH(t.RotationOrder.value):n.eulerOrder="ZYX","Lcl_Translation"in t&&(n.translation=t.Lcl_Translation.value),"PreRotation"in t&&(n.preRotation=t.PreRotation.value),"Lcl_Rotation"in t&&(n.rotation=t.Lcl_Rotation.value),"PostRotation"in t&&(n.postRotation=t.PostRotation.value),"Lcl_Scaling"in t&&(n.scale=t.Lcl_Scaling.value),"ScalingOffset"in t&&(n.scalingOffset=t.ScalingOffset.value),"ScalingPivot"in t&&(n.scalingPivot=t.ScalingPivot.value),"RotationOffset"in t&&(n.rotationOffset=t.RotationOffset.value),"RotationPivot"in t&&(n.rotationPivot=t.RotationPivot.value),e.userData.transformData=n}setLookAtProperties(e,t){"LookAtProperty"in t&&ps.get(e.ID).children.forEach(function(r){if(r.relationship==="LookAtProperty"){const s=ci.Objects.Model[r.ID];if("Lcl_Translation"in s){const o=s.Lcl_Translation.value;e.target!==void 0?(e.target.position.fromArray(o),Ka.add(e.target)):e.lookAt(new H().fromArray(o))}}})}bindSkeleton(e,t,n){const r=this.parsePoseNodes();for(const s in e){const o=e[s];ps.get(parseInt(o.ID)).parents.forEach(function(l){if(t.has(l.ID)){const c=l.ID;ps.get(c).parents.forEach(function(h){n.has(h.ID)&&n.get(h.ID).bind(new _A(o.bones),r[h.ID])})}})}}parsePoseNodes(){const e={};if("Pose"in ci.Objects){const t=ci.Objects.Pose;for(const n in t)if(t[n].attrType==="BindPose"&&t[n].NbPoseNodes>0){const r=t[n].PoseNode;Array.isArray(r)?r.forEach(function(s){e[s.Node]=new Xe().fromArray(s.Matrix.a)}):e[r.Node]=new Xe().fromArray(r.Matrix.a)}}return e}createAmbientLight(){if("GlobalSettings"in ci&&"AmbientColor"in ci.GlobalSettings){const e=ci.GlobalSettings.AmbientColor.value,t=e[0],n=e[1],r=e[2];if(t!==0||n!==0||r!==0){const s=new ut(t,n,r);Ka.add(new W6(s,1))}}}}class wue{parse(e){const t=new Map;if("Geometry"in ci.Objects){const n=ci.Objects.Geometry;for(const r in n){const s=ps.get(parseInt(r)),o=this.parseGeometry(s,n[r],e);t.set(parseInt(r),o)}}return t}parseGeometry(e,t,n){switch(t.attrType){case"Mesh":return this.parseMeshGeometry(e,t,n);case"NurbsCurve":return this.parseNurbsGeometry(t)}}parseMeshGeometry(e,t,n){const r=n.skeletons,s=[],o=e.parents.map(function(h){return ci.Objects.Model[h.ID]});if(o.length===0)return;const a=e.children.reduce(function(h,f){return r[f.ID]!==void 0&&(h=r[f.ID]),h},null);e.children.forEach(function(h){n.morphTargets[h.ID]!==void 0&&s.push(n.morphTargets[h.ID])});const l=o[0],c={};"RotationOrder"in l&&(c.eulerOrder=pH(l.RotationOrder.value)),"InheritType"in l&&(c.inheritType=parseInt(l.InheritType.value)),"GeometricTranslation"in l&&(c.translation=l.GeometricTranslation.value),"GeometricRotation"in l&&(c.rotation=l.GeometricRotation.value),"GeometricScaling"in l&&(c.scale=l.GeometricScaling.value);const u=dH(c);return this.genGeometry(t,a,s,u)}genGeometry(e,t,n,r){const s=new fn;e.attrName&&(s.name=e.attrName);const o=this.parseGeoNode(e,t),a=this.genBuffers(o),l=new Gt(a.vertex,3);if(l.applyMatrix4(r),s.setAttribute("position",l),a.colors.length>0&&s.setAttribute("color",new Gt(a.colors,3)),t&&(s.setAttribute("skinIndex",new ww(a.weightsIndices,4)),s.setAttribute("skinWeight",new Gt(a.vertexWeights,4)),s.FBX_Deformer=t),a.normal.length>0){const c=new Tn().getNormalMatrix(r),u=new Gt(a.normal,3);u.applyNormalMatrix(c),s.setAttribute("normal",u)}if(a.uvs.forEach(function(c,u){SR==="uv2"&&u++;const h=u===0?"uv":`uv${u}`;s.setAttribute(h,new Gt(a.uvs[u],2))}),o.material&&o.material.mappingType!=="AllSame"){let c=a.materialIndex[0],u=0;if(a.materialIndex.forEach(function(h,f){h!==c&&(s.addGroup(u,f-u,c),c=h,u=f)}),s.groups.length>0){const h=s.groups[s.groups.length-1],f=h.start+h.count;f!==a.materialIndex.length&&s.addGroup(f,a.materialIndex.length-f,c)}s.groups.length===0&&s.addGroup(0,a.materialIndex.length,a.materialIndex[0])}return this.addMorphTargets(s,e,n,r),s}parseGeoNode(e,t){const n={};if(n.vertexPositions=e.Vertices!==void 0?e.Vertices.a:[],n.vertexIndices=e.PolygonVertexIndex!==void 0?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(n.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(n.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(n.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){n.uv=[];let r=0;for(;e.LayerElementUV[r];)e.LayerElementUV[r].UV&&n.uv.push(this.parseUVs(e.LayerElementUV[r])),r++}return n.weightTable={},t!==null&&(n.skeleton=t,t.rawBones.forEach(function(r,s){r.indices.forEach(function(o,a){n.weightTable[o]===void 0&&(n.weightTable[o]=[]),n.weightTable[o].push({id:s,weight:r.weights[a]})})})),n}genBuffers(e){const t={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]};let n=0,r=0,s=!1,o=[],a=[],l=[],c=[],u=[],h=[];const f=this;return e.vertexIndices.forEach(function(d,m){let A,g=!1;d<0&&(d=d^-1,g=!0);let y=[],E=[];if(o.push(d*3,d*3+1,d*3+2),e.color){const x=P3(m,n,d,e.color);l.push(x[0],x[1],x[2])}if(e.skeleton){if(e.weightTable[d]!==void 0&&e.weightTable[d].forEach(function(x){E.push(x.weight),y.push(x.id)}),E.length>4){s||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),s=!0);const x=[0,0,0,0],C=[0,0,0,0];E.forEach(function(T,I){let M=T,L=y[I];C.forEach(function(R,P,F){if(M>R){F[P]=M,M=R;const k=x[P];x[P]=L,L=k}})}),y=x,E=C}for(;E.length<4;)E.push(0),y.push(0);for(let x=0;x<4;++x)u.push(E[x]),h.push(y[x])}if(e.normal){const x=P3(m,n,d,e.normal);a.push(x[0],x[1],x[2])}e.material&&e.material.mappingType!=="AllSame"&&(A=P3(m,n,d,e.material)[0]),e.uv&&e.uv.forEach(function(x,C){const T=P3(m,n,d,x);c[C]===void 0&&(c[C]=[]),c[C].push(T[0]),c[C].push(T[1])}),r++,g&&(f.genFace(t,e,o,A,a,l,c,u,h,r),n++,r=0,o=[],a=[],l=[],c=[],u=[],h=[])}),t}genFace(e,t,n,r,s,o,a,l,c,u){for(let h=2;h<u;h++)e.vertex.push(t.vertexPositions[n[0]]),e.vertex.push(t.vertexPositions[n[1]]),e.vertex.push(t.vertexPositions[n[2]]),e.vertex.push(t.vertexPositions[n[(h-1)*3]]),e.vertex.push(t.vertexPositions[n[(h-1)*3+1]]),e.vertex.push(t.vertexPositions[n[(h-1)*3+2]]),e.vertex.push(t.vertexPositions[n[h*3]]),e.vertex.push(t.vertexPositions[n[h*3+1]]),e.vertex.push(t.vertexPositions[n[h*3+2]]),t.skeleton&&(e.vertexWeights.push(l[0]),e.vertexWeights.push(l[1]),e.vertexWeights.push(l[2]),e.vertexWeights.push(l[3]),e.vertexWeights.push(l[(h-1)*4]),e.vertexWeights.push(l[(h-1)*4+1]),e.vertexWeights.push(l[(h-1)*4+2]),e.vertexWeights.push(l[(h-1)*4+3]),e.vertexWeights.push(l[h*4]),e.vertexWeights.push(l[h*4+1]),e.vertexWeights.push(l[h*4+2]),e.vertexWeights.push(l[h*4+3]),e.weightsIndices.push(c[0]),e.weightsIndices.push(c[1]),e.weightsIndices.push(c[2]),e.weightsIndices.push(c[3]),e.weightsIndices.push(c[(h-1)*4]),e.weightsIndices.push(c[(h-1)*4+1]),e.weightsIndices.push(c[(h-1)*4+2]),e.weightsIndices.push(c[(h-1)*4+3]),e.weightsIndices.push(c[h*4]),e.weightsIndices.push(c[h*4+1]),e.weightsIndices.push(c[h*4+2]),e.weightsIndices.push(c[h*4+3])),t.color&&(e.colors.push(o[0]),e.colors.push(o[1]),e.colors.push(o[2]),e.colors.push(o[(h-1)*3]),e.colors.push(o[(h-1)*3+1]),e.colors.push(o[(h-1)*3+2]),e.colors.push(o[h*3]),e.colors.push(o[h*3+1]),e.colors.push(o[h*3+2])),t.material&&t.material.mappingType!=="AllSame"&&(e.materialIndex.push(r),e.materialIndex.push(r),e.materialIndex.push(r)),t.normal&&(e.normal.push(s[0]),e.normal.push(s[1]),e.normal.push(s[2]),e.normal.push(s[(h-1)*3]),e.normal.push(s[(h-1)*3+1]),e.normal.push(s[(h-1)*3+2]),e.normal.push(s[h*3]),e.normal.push(s[h*3+1]),e.normal.push(s[h*3+2])),t.uv&&t.uv.forEach(function(f,d){e.uvs[d]===void 0&&(e.uvs[d]=[]),e.uvs[d].push(a[d][0]),e.uvs[d].push(a[d][1]),e.uvs[d].push(a[d][(h-1)*2]),e.uvs[d].push(a[d][(h-1)*2+1]),e.uvs[d].push(a[d][h*2]),e.uvs[d].push(a[d][h*2+1])})}addMorphTargets(e,t,n,r){if(n.length===0)return;e.morphTargetsRelative=!0,e.morphAttributes.position=[];const s=this;n.forEach(function(o){o.rawTargets.forEach(function(a){const l=ci.Objects.Geometry[a.geoID];l!==void 0&&s.genMorphGeometry(e,t,l,r,a.name)})})}genMorphGeometry(e,t,n,r,s){const o=t.PolygonVertexIndex!==void 0?t.PolygonVertexIndex.a:[],a=n.Vertices!==void 0?n.Vertices.a:[],l=n.Indexes!==void 0?n.Indexes.a:[],c=e.attributes.position.count*3,u=new Float32Array(c);for(let m=0;m<l.length;m++){const A=l[m]*3;u[A]=a[m*3],u[A+1]=a[m*3+1],u[A+2]=a[m*3+2]}const h={vertexIndices:o,vertexPositions:u},f=this.genBuffers(h),d=new Gt(f.vertex,3);d.name=s||n.attrName,d.applyMatrix4(r),e.morphAttributes.position.push(d)}parseNormals(e){const t=e.MappingInformationType,n=e.ReferenceInformationType,r=e.Normals.a;let s=[];return n==="IndexToDirect"&&("NormalIndex"in e?s=e.NormalIndex.a:"NormalsIndex"in e&&(s=e.NormalsIndex.a)),{dataSize:3,buffer:r,indices:s,mappingType:t,referenceType:n}}parseUVs(e){const t=e.MappingInformationType,n=e.ReferenceInformationType,r=e.UV.a;let s=[];return n==="IndexToDirect"&&(s=e.UVIndex.a),{dataSize:2,buffer:r,indices:s,mappingType:t,referenceType:n}}parseVertexColors(e){const t=e.MappingInformationType,n=e.ReferenceInformationType,r=e.Colors.a;let s=[];return n==="IndexToDirect"&&(s=e.ColorIndex.a),{dataSize:4,buffer:r,indices:s,mappingType:t,referenceType:n}}parseMaterialIndices(e){const t=e.MappingInformationType,n=e.ReferenceInformationType;if(t==="NoMappingInformation")return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:n};const r=e.Materials.a,s=[];for(let o=0;o<r.length;++o)s.push(o);return{dataSize:1,buffer:r,indices:s,mappingType:t,referenceType:n}}parseNurbsGeometry(e){if(D9===void 0)return console.error("THREE.FBXLoader: The loader relies on NURBSCurve for any nurbs present in the model. Nurbs will show up as empty geometry."),new fn;const t=parseInt(e.Order);if(isNaN(t))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",e.Order,e.id),new fn;const n=t-1,r=e.KnotVector.a,s=[],o=e.Points.a;for(let h=0,f=o.length;h<f;h+=4)s.push(new Rn().fromArray(o,h));let a,l;if(e.Form==="Closed")s.push(s[0]);else if(e.Form==="Periodic"){a=n,l=r.length-1-a;for(let h=0;h<n;++h)s.push(s[h])}const u=new D9(n,r,s,a,l).getPoints(s.length*12);return new fn().setFromPoints(u)}}class Cue{parse(){const e=[],t=this.parseClips();if(t!==void 0)for(const n in t){const r=t[n],s=this.addClip(r);e.push(s)}return e}parseClips(){if(ci.Objects.AnimationCurve===void 0)return;const e=this.parseAnimationCurveNodes();this.parseAnimationCurves(e);const t=this.parseAnimationLayers(e);return this.parseAnimStacks(t)}parseAnimationCurveNodes(){const e=ci.Objects.AnimationCurveNode,t=new Map;for(const n in e){const r=e[n];if(r.attrName.match(/S|R|T|DeformPercent/)!==null){const s={id:r.id,attr:r.attrName,curves:{}};t.set(s.id,s)}}return t}parseAnimationCurves(e){const t=ci.Objects.AnimationCurve;for(const n in t){const r={id:t[n].id,times:t[n].KeyTime.a.map(Rue),values:t[n].KeyValueFloat.a},s=ps.get(r.id);if(s!==void 0){const o=s.parents[0].ID,a=s.parents[0].relationship;a.match(/X/)?e.get(o).curves.x=r:a.match(/Y/)?e.get(o).curves.y=r:a.match(/Z/)?e.get(o).curves.z=r:a.match(/d|DeformPercent/)&&e.has(o)&&(e.get(o).curves.morph=r)}}}parseAnimationLayers(e){const t=ci.Objects.AnimationLayer,n=new Map;for(const r in t){const s=[],o=ps.get(parseInt(r));o!==void 0&&(o.children.forEach(function(l,c){if(e.has(l.ID)){const u=e.get(l.ID);if(u.curves.x!==void 0||u.curves.y!==void 0||u.curves.z!==void 0){if(s[c]===void 0){const h=ps.get(l.ID).parents.filter(function(f){return f.relationship!==void 0})[0].ID;if(h!==void 0){const f=ci.Objects.Model[h.toString()];if(f===void 0){console.warn("THREE.FBXLoader: Encountered a unused curve.",l);return}const d={modelName:f.attrName?li.sanitizeNodeName(f.attrName):"",ID:f.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};Ka.traverse(function(m){m.ID===f.id&&(d.transform=m.matrix,m.userData.transformData&&(d.eulerOrder=m.userData.transformData.eulerOrder))}),d.transform||(d.transform=new Xe),"PreRotation"in f&&(d.preRotation=f.PreRotation.value),"PostRotation"in f&&(d.postRotation=f.PostRotation.value),s[c]=d}}s[c]&&(s[c][u.attr]=u)}else if(u.curves.morph!==void 0){if(s[c]===void 0){const h=ps.get(l.ID).parents.filter(function(y){return y.relationship!==void 0})[0].ID,f=ps.get(h).parents[0].ID,d=ps.get(f).parents[0].ID,m=ps.get(d).parents[0].ID,A=ci.Objects.Model[m],g={modelName:A.attrName?li.sanitizeNodeName(A.attrName):"",morphName:ci.Objects.Deformer[h].attrName};s[c]=g}s[c][u.attr]=u}}}),n.set(parseInt(r),s))}return n}parseAnimStacks(e){const t=ci.Objects.AnimationStack,n={};for(const r in t){const s=ps.get(parseInt(r)).children;s.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");const o=e.get(s[0].ID);n[r]={name:t[r].attrName,layer:o}}return n}addClip(e){let t=[];const n=this;return e.layer.forEach(function(r){t=t.concat(n.generateTracks(r))}),new op(e.name,-1,t)}generateTracks(e){const t=[];let n=new H,r=new Xt,s=new H;if(e.transform&&e.transform.decompose(n,r,s),n=n.toArray(),r=new Eo().setFromQuaternion(r,e.eulerOrder).toArray(),s=s.toArray(),e.T!==void 0&&Object.keys(e.T.curves).length>0){const o=this.generateVectorTrack(e.modelName,e.T.curves,n,"position");o!==void 0&&t.push(o)}if(e.R!==void 0&&Object.keys(e.R.curves).length>0){const o=this.generateRotationTrack(e.modelName,e.R.curves,r,e.preRotation,e.postRotation,e.eulerOrder);o!==void 0&&t.push(o)}if(e.S!==void 0&&Object.keys(e.S.curves).length>0){const o=this.generateVectorTrack(e.modelName,e.S.curves,s,"scale");o!==void 0&&t.push(o)}if(e.DeformPercent!==void 0){const o=this.generateMorphTrack(e);o!==void 0&&t.push(o)}return t}generateVectorTrack(e,t,n,r){const s=this.getTimesForAllAxes(t),o=this.getKeyframeTrackValues(s,t,n);return new Of(e+"."+r,s,o)}generateRotationTrack(e,t,n,r,s,o){t.x!==void 0&&(this.interpolateRotations(t.x),t.x.values=t.x.values.map(un.degToRad)),t.y!==void 0&&(this.interpolateRotations(t.y),t.y.values=t.y.values.map(un.degToRad)),t.z!==void 0&&(this.interpolateRotations(t.z),t.z.values=t.z.values.map(un.degToRad));const a=this.getTimesForAllAxes(t),l=this.getKeyframeTrackValues(a,t,n);r!==void 0&&(r=r.map(un.degToRad),r.push(o),r=new Eo().fromArray(r),r=new Xt().setFromEuler(r)),s!==void 0&&(s=s.map(un.degToRad),s.push(o),s=new Eo().fromArray(s),s=new Xt().setFromEuler(s).invert());const c=new Xt,u=new Eo,h=[];for(let f=0;f<l.length;f+=3)u.set(l[f],l[f+1],l[f+2],o),c.setFromEuler(u),r!==void 0&&c.premultiply(r),s!==void 0&&c.multiply(s),c.toArray(h,f/3*4);return new vh(e+".quaternion",a,h)}generateMorphTrack(e){const t=e.DeformPercent.curves.morph,n=t.values.map(function(s){return s/100}),r=Ka.getObjectByName(e.modelName).morphTargetDictionary[e.morphName];return new sp(e.modelName+".morphTargetInfluences["+r+"]",t.times,n)}getTimesForAllAxes(e){let t=[];if(e.x!==void 0&&(t=t.concat(e.x.times)),e.y!==void 0&&(t=t.concat(e.y.times)),e.z!==void 0&&(t=t.concat(e.z.times)),t=t.sort(function(n,r){return n-r}),t.length>1){let n=1,r=t[0];for(let s=1;s<t.length;s++){const o=t[s];o!==r&&(t[n]=o,r=o,n++)}t=t.slice(0,n)}return t}getKeyframeTrackValues(e,t,n){const r=n,s=[];let o=-1,a=-1,l=-1;return e.forEach(function(c){if(t.x&&(o=t.x.times.indexOf(c)),t.y&&(a=t.y.times.indexOf(c)),t.z&&(l=t.z.times.indexOf(c)),o!==-1){const u=t.x.values[o];s.push(u),r[0]=u}else s.push(r[0]);if(a!==-1){const u=t.y.values[a];s.push(u),r[1]=u}else s.push(r[1]);if(l!==-1){const u=t.z.values[l];s.push(u),r[2]=u}else s.push(r[2])}),s}interpolateRotations(e){for(let t=1;t<e.values.length;t++){const n=e.values[t-1],r=e.values[t]-n,s=Math.abs(r);if(s>=180){const o=s/180,a=r/o;let l=n+a;const c=e.times[t-1],h=(e.times[t]-c)/o;let f=c+h;const d=[],m=[];for(;f<e.times[t];)d.push(f),f+=h,m.push(l),l+=a;e.times=O9(e.times,t,d),e.values=O9(e.values,t,m)}}}}class Tue{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(e){this.nodeStack.push(e),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(e,t){this.currentProp=e,this.currentPropName=t}parse(e){this.currentIndent=0,this.allNodes=new fH,this.nodeStack=[],this.currentProp=[],this.currentPropName="";const t=this,n=e.split(/[\r\n]+/);return n.forEach(function(r,s){const o=r.match(/^[\s\t]*;/),a=r.match(/^[\s\t]*$/);if(o||a)return;const l=r.match("^\\t{"+t.currentIndent+"}(\\w+):(.*){",""),c=r.match("^\\t{"+t.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),u=r.match("^\\t{"+(t.currentIndent-1)+"}}");l?t.parseNodeBegin(r,l):c?t.parseNodeProperty(r,c,n[++s]):u?t.popStack():r.match(/^[^\s\t}]/)&&t.parseNodePropertyContinued(r)}),this.allNodes}parseNodeBegin(e,t){const n=t[1].trim().replace(/^"/,"").replace(/"$/,""),r=t[2].split(",").map(function(l){return l.trim().replace(/^"/,"").replace(/"$/,"")}),s={name:n},o=this.parseNodeAttr(r),a=this.getCurrentNode();this.currentIndent===0?this.allNodes.add(n,s):n in a?(n==="PoseNode"?a.PoseNode.push(s):a[n].id!==void 0&&(a[n]={},a[n][a[n].id]=a[n]),o.id!==""&&(a[n][o.id]=s)):typeof o.id=="number"?(a[n]={},a[n][o.id]=s):n!=="Properties70"&&(n==="PoseNode"?a[n]=[s]:a[n]=s),typeof o.id=="number"&&(s.id=o.id),o.name!==""&&(s.attrName=o.name),o.type!==""&&(s.attrType=o.type),this.pushStack(s)}parseNodeAttr(e){let t=e[0];e[0]!==""&&(t=parseInt(e[0]),isNaN(t)&&(t=e[0]));let n="",r="";return e.length>1&&(n=e[1].replace(/^(\w+)::/,""),r=e[2]),{id:t,name:n,type:r}}parseNodeProperty(e,t,n){let r=t[1].replace(/^"/,"").replace(/"$/,"").trim(),s=t[2].replace(/^"/,"").replace(/"$/,"").trim();r==="Content"&&s===","&&(s=n.replace(/"/g,"").replace(/,$/,"").trim());const o=this.getCurrentNode();if(o.name==="Properties70"){this.parseNodeSpecialProperty(e,r,s);return}if(r==="C"){const l=s.split(",").slice(1),c=parseInt(l[0]),u=parseInt(l[1]);let h=s.split(",").slice(3);h=h.map(function(f){return f.trim().replace(/^"/,"")}),r="connections",s=[c,u],Pue(s,h),o[r]===void 0&&(o[r]=[])}r==="Node"&&(o.id=s),r in o&&Array.isArray(o[r])?o[r].push(s):r!=="a"?o[r]=s:o.a=s,this.setCurrentProp(o,r),r==="a"&&s.slice(-1)!==","&&(o.a=eb(s))}parseNodePropertyContinued(e){const t=this.getCurrentNode();t.a+=e,e.slice(-1)!==","&&(t.a=eb(t.a))}parseNodeSpecialProperty(e,t,n){const r=n.split('",').map(function(u){return u.trim().replace(/^\"/,"").replace(/\s/,"_")}),s=r[0],o=r[1],a=r[2],l=r[3];let c=r[4];switch(o){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":c=parseFloat(c);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":c=eb(c);break}this.getPrevNode()[s]={type:o,type2:a,flag:l,value:c},this.setCurrentProp(this.getPrevNode(),s)}}class bue{parse(e){const t=new k9(e);t.skip(23);const n=t.getUint32();if(n<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+n);const r=new fH;for(;!this.endOfContent(t);){const s=this.parseNode(t,n);s!==null&&r.add(s.name,s)}return r}endOfContent(e){return e.size()%16===0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()}parseNode(e,t){const n={},r=t>=7500?e.getUint64():e.getUint32(),s=t>=7500?e.getUint64():e.getUint32();t>=7500?e.getUint64():e.getUint32();const o=e.getUint8(),a=e.getString(o);if(r===0)return null;const l=[];for(let f=0;f<s;f++)l.push(this.parseProperty(e));const c=l.length>0?l[0]:"",u=l.length>1?l[1]:"",h=l.length>2?l[2]:"";for(n.singleProperty=s===1&&e.getOffset()===r;r>e.getOffset();){const f=this.parseNode(e,t);f!==null&&this.parseSubNode(a,n,f)}return n.propertyList=l,typeof c=="number"&&(n.id=c),u!==""&&(n.attrName=u),h!==""&&(n.attrType=h),a!==""&&(n.name=a),n}parseSubNode(e,t,n){if(n.singleProperty===!0){const r=n.propertyList[0];Array.isArray(r)?(t[n.name]=n,n.a=r):t[n.name]=r}else if(e==="Connections"&&n.name==="C"){const r=[];n.propertyList.forEach(function(s,o){o!==0&&r.push(s)}),t.connections===void 0&&(t.connections=[]),t.connections.push(r)}else if(n.name==="Properties70")Object.keys(n).forEach(function(s){t[s]=n[s]});else if(e==="Properties70"&&n.name==="P"){let r=n.propertyList[0],s=n.propertyList[1];const o=n.propertyList[2],a=n.propertyList[3];let l;r.indexOf("Lcl ")===0&&(r=r.replace("Lcl ","Lcl_")),s.indexOf("Lcl ")===0&&(s=s.replace("Lcl ","Lcl_")),s==="Color"||s==="ColorRGB"||s==="Vector"||s==="Vector3D"||s.indexOf("Lcl_")===0?l=[n.propertyList[4],n.propertyList[5],n.propertyList[6]]:l=n.propertyList[4],t[r]={type:s,type2:o,flag:a,value:l}}else t[n.name]===void 0?typeof n.id=="number"?(t[n.name]={},t[n.name][n.id]=n):t[n.name]=n:n.name==="PoseNode"?(Array.isArray(t[n.name])||(t[n.name]=[t[n.name]]),t[n.name].push(n)):t[n.name][n.id]===void 0&&(t[n.name][n.id]=n)}parseProperty(e){const t=e.getString(1);let n;switch(t){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":return n=e.getUint32(),e.getArrayBuffer(n);case"S":return n=e.getUint32(),e.getString(n);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":const r=e.getUint32(),s=e.getUint32(),o=e.getUint32();if(s===0)switch(t){case"b":case"c":return e.getBooleanArray(r);case"d":return e.getFloat64Array(r);case"f":return e.getFloat32Array(r);case"i":return e.getInt32Array(r);case"l":return e.getInt64Array(r)}const a=Fv(new Uint8Array(e.getArrayBuffer(o))),l=new k9(a.buffer);switch(t){case"b":case"c":return l.getBooleanArray(r);case"d":return l.getFloat64Array(r);case"f":return l.getFloat32Array(r);case"i":return l.getInt32Array(r);case"l":return l.getInt64Array(r)}default:throw new Error("THREE.FBXLoader: Unknown property type "+t)}}}class k9{constructor(e,t){this.dv=new DataView(e),this.offset=0,this.littleEndian=t!==void 0?t:!0}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(e){this.offset+=e}getBoolean(){return(this.getUint8()&1)===1}getBooleanArray(e){const t=[];for(let n=0;n<e;n++)t.push(this.getBoolean());return t}getUint8(){const e=this.dv.getUint8(this.offset);return this.offset+=1,e}getInt16(){const e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}getInt32(){const e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}getInt32Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getInt32());return t}getUint32(){const e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}getInt64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),t&2147483648?(t=~t&4294967295,e=~e&4294967295,e===4294967295&&(t=t+1&4294967295),e=e+1&4294967295,-(t*4294967296+e)):t*4294967296+e}getInt64Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getInt64());return t}getUint64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),t*4294967296+e}getFloat32(){const e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}getFloat32Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getFloat32());return t}getFloat64(){const e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}getFloat64Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getFloat64());return t}getArrayBuffer(e){const t=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t}getString(e){let t=[];for(let r=0;r<e;r++)t[r]=this.getUint8();const n=t.indexOf(0);return n>=0&&(t=t.slice(0,n)),sA(new Uint8Array(t))}}class fH{add(e,t){this[e]=t}}function Iue(i){const e="Kaydara FBX Binary  \0";return i.byteLength>=e.length&&e===mH(i,0,e.length)}function Mue(i){const e=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"];let t=0;function n(r){const s=i[r-1];return i=i.slice(t+r),t++,s}for(let r=0;r<e.length;++r)if(n(1)===e[r])return!1;return!0}function F9(i){const e=/FBXVersion: (\d+)/,t=i.match(e);if(t)return parseInt(t[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function Rue(i){return i/46186158e3}const Lue=[];function P3(i,e,t,n){let r;switch(n.mappingType){case"ByPolygonVertex":r=i;break;case"ByPolygon":r=e;break;case"ByVertice":r=t;break;case"AllSame":r=n.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+n.mappingType)}n.referenceType==="IndexToDirect"&&(r=n.indices[r]);const s=r*n.dataSize,o=s+n.dataSize;return Bue(Lue,n.buffer,s,o)}const ZT=new Eo,zg=new H;function dH(i){const e=new Xe,t=new Xe,n=new Xe,r=new Xe,s=new Xe,o=new Xe,a=new Xe,l=new Xe,c=new Xe,u=new Xe,h=new Xe,f=new Xe,d=i.inheritType?i.inheritType:0;if(i.translation&&e.setPosition(zg.fromArray(i.translation)),i.preRotation){const P=i.preRotation.map(un.degToRad);P.push(i.eulerOrder),t.makeRotationFromEuler(ZT.fromArray(P))}if(i.rotation){const P=i.rotation.map(un.degToRad);P.push(i.eulerOrder),n.makeRotationFromEuler(ZT.fromArray(P))}if(i.postRotation){const P=i.postRotation.map(un.degToRad);P.push(i.eulerOrder),r.makeRotationFromEuler(ZT.fromArray(P)),r.invert()}i.scale&&s.scale(zg.fromArray(i.scale)),i.scalingOffset&&a.setPosition(zg.fromArray(i.scalingOffset)),i.scalingPivot&&o.setPosition(zg.fromArray(i.scalingPivot)),i.rotationOffset&&l.setPosition(zg.fromArray(i.rotationOffset)),i.rotationPivot&&c.setPosition(zg.fromArray(i.rotationPivot)),i.parentMatrixWorld&&(h.copy(i.parentMatrix),u.copy(i.parentMatrixWorld));const m=t.clone().multiply(n).multiply(r),A=new Xe;A.extractRotation(u);const g=new Xe;g.copyPosition(u);const y=g.clone().invert().multiply(u),E=A.clone().invert().multiply(y),x=s,C=new Xe;if(d===0)C.copy(A).multiply(m).multiply(E).multiply(x);else if(d===1)C.copy(A).multiply(E).multiply(m).multiply(x);else{const F=new Xe().scale(new H().setFromMatrixScale(h)).clone().invert(),k=E.clone().multiply(F);C.copy(A).multiply(m).multiply(k).multiply(x)}const T=c.clone().invert(),I=o.clone().invert();let M=e.clone().multiply(l).multiply(c).multiply(t).multiply(n).multiply(r).multiply(T).multiply(a).multiply(o).multiply(s).multiply(I);const L=new Xe().copyPosition(M),R=u.clone().multiply(L);return f.copyPosition(R),M=f.clone().multiply(C),M.premultiply(u.invert()),M}function pH(i){i=i||0;const e=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return i===6?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),e[0]):e[i]}function eb(i){return i.split(",").map(function(t){return parseFloat(t)})}function mH(i,e,t){return e===void 0&&(e=0),t===void 0&&(t=i.byteLength),sA(new Uint8Array(i,e,t))}function Pue(i,e){for(let t=0,n=i.length,r=e.length;t<r;t++,n++)i[n]=e[t]}function Bue(i,e,t,n){for(let r=t,s=0;r<n;r++,s++)i[s]=e[r];return i}function O9(i,e,t){return i.slice(0,e).concat(t).concat(i.slice(e))}var Due=Object.defineProperty,kue=(i,e,t)=>e in i?Due(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,tb=(i,e,t)=>(kue(i,typeof e!="symbol"?e+"":e,t),t);class Fue extends os{constructor(e){super(e)}load(e,t,n,r){const s=new $r(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,o=>{if(typeof o!="string")throw new Error("unsupported data type");const a=JSON.parse(o),l=this.parse(a);t&&t(l)},n,r)}loadAsync(e,t){return super.loadAsync(e,t)}parse(e){return new Oue(e)}}class Oue{constructor(e){tb(this,"data"),tb(this,"isFont",!0),tb(this,"type","Font"),this.data=e}generateShapes(e,t=100,n){const r=[],s={letterSpacing:0,lineHeight:1,...n},o=Nue(e,t,this.data,s);for(let a=0,l=o.length;a<l;a++)Array.prototype.push.apply(r,o[a].toShapes(!1));return r}}function Nue(i,e,t,n){const r=Array.from(i),s=e/t.resolution,o=(t.boundingBox.yMax-t.boundingBox.yMin+t.underlineThickness)*s,a=[];let l=0,c=0;for(let u=0;u<r.length;u++){const h=r[u];if(h===`
`)l=0,c-=o*n.lineHeight;else{const f=Uue(h,s,l,c,t);f&&(l+=f.offsetX+n.letterSpacing,a.push(f.path))}}return a}function Uue(i,e,t,n,r){const s=r.glyphs[i]||r.glyphs["?"];if(!s){console.error('THREE.Font: character "'+i+'" does not exists in font family '+r.familyName+".");return}const o=new yf;let a,l,c,u,h,f,d,m;if(s.o){const A=s._cachedOutline||(s._cachedOutline=s.o.split(" "));for(let g=0,y=A.length;g<y;)switch(A[g++]){case"m":a=parseInt(A[g++])*e+t,l=parseInt(A[g++])*e+n,o.moveTo(a,l);break;case"l":a=parseInt(A[g++])*e+t,l=parseInt(A[g++])*e+n,o.lineTo(a,l);break;case"q":c=parseInt(A[g++])*e+t,u=parseInt(A[g++])*e+n,h=parseInt(A[g++])*e+t,f=parseInt(A[g++])*e+n,o.quadraticCurveTo(h,f,c,u);break;case"b":c=parseInt(A[g++])*e+t,u=parseInt(A[g++])*e+n,h=parseInt(A[g++])*e+t,f=parseInt(A[g++])*e+n,d=parseInt(A[g++])*e+t,m=parseInt(A[g++])*e+n,o.bezierCurveTo(h,f,d,m,c,u);break}}return{offsetX:s.ha*e,path:o}}class zue extends vi{constructor(e=null,t=1,n=1,r=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:n,depth:r},this.magFilter=zn,this.minFilter=zn,this.wrapR=ji,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Gue{constructor(e=4){this.pool=e,this.queue=[],this.workers=[],this.workersResolve=[],this.workerStatus=0}_initWorker(e){if(!this.workers[e]){const t=this.workerCreator();t.addEventListener("message",this._onMessage.bind(this,e)),this.workers[e]=t}}_getIdleWorker(){for(let e=0;e<this.pool;e++)if(!(this.workerStatus&1<<e))return e;return-1}_onMessage(e,t){const n=this.workersResolve[e];if(n&&n(t),this.queue.length){const{resolve:r,msg:s,transfer:o}=this.queue.shift();this.workersResolve[e]=r,this.workers[e].postMessage(s,o)}else this.workerStatus^=1<<e}setWorkerCreator(e){this.workerCreator=e}setWorkerLimit(e){this.pool=e}postMessage(e,t){return new Promise(n=>{const r=this._getIdleWorker();r!==-1?(this._initWorker(r),this.workerStatus|=1<<r,this.workersResolve[r]=n,this.workers[r].postMessage(e,t)):this.queue.push({resolve:n,msg:e,transfer:t})})}dispose(){this.workers.forEach(e=>e.terminate()),this.workersResolve.length=0,this.workers.length=0,this.queue.length=0,this.workerStatus=0}}const gH=0,N9=2,Hue=0,Que=0,Vue=2,Wue=0,jue=0,Kue=1,r5=2,$ue=0,AH=1,Yue=10,Xue=64,yH=0,vH=9,xH=15,EH=16,_H=22,SH=37,wH=43,CH=76,TH=83,bH=97,IH=100,MH=103,RH=109,LH=165,PH=166;class que{constructor(){this.vkFormat=yH,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=gH,this.levels=[],this.dataFormatDescriptor=[{vendorId:Que,descriptorType:Hue,descriptorBlockSize:0,versionNumber:Vue,colorModel:Wue,colorPrimaries:AH,transferFunction:r5,flags:jue,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],this.keyValue={},this.globalData=null}}class sv{constructor(e,t,n,r){this._dataView=void 0,this._littleEndian=void 0,this._offset=void 0,this._dataView=new DataView(e.buffer,e.byteOffset+t,n),this._littleEndian=r,this._offset=0}_nextUint8(){const e=this._dataView.getUint8(this._offset);return this._offset+=1,e}_nextUint16(){const e=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,e}_nextUint32(){const e=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint64(){const e=this._dataView.getUint32(this._offset,this._littleEndian),t=this._dataView.getUint32(this._offset+4,this._littleEndian),n=e+2**32*t;return this._offset+=8,n}_nextInt32(){const e=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint8Array(e){const t=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._offset,e);return this._offset+=e,t}_skip(e){return this._offset+=e,this}_scan(e,t){t===void 0&&(t=0);const n=this._offset;let r=0;for(;this._dataView.getUint8(this._offset)!==t&&r<e;)r++,this._offset++;return r<e&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+n,r)}}const ma=[171,75,84,88,32,50,48,187,13,10,26,10];function U9(i){return typeof TextDecoder<"u"?new TextDecoder().decode(i):Buffer.from(i).toString("utf8")}function Jue(i){const e=new Uint8Array(i.buffer,i.byteOffset,ma.length);if(e[0]!==ma[0]||e[1]!==ma[1]||e[2]!==ma[2]||e[3]!==ma[3]||e[4]!==ma[4]||e[5]!==ma[5]||e[6]!==ma[6]||e[7]!==ma[7]||e[8]!==ma[8]||e[9]!==ma[9]||e[10]!==ma[10]||e[11]!==ma[11])throw new Error("Missing KTX 2.0 identifier.");const t=new que,n=17*Uint32Array.BYTES_PER_ELEMENT,r=new sv(i,ma.length,n,!0);t.vkFormat=r._nextUint32(),t.typeSize=r._nextUint32(),t.pixelWidth=r._nextUint32(),t.pixelHeight=r._nextUint32(),t.pixelDepth=r._nextUint32(),t.layerCount=r._nextUint32(),t.faceCount=r._nextUint32();const s=r._nextUint32();t.supercompressionScheme=r._nextUint32();const o=r._nextUint32(),a=r._nextUint32(),l=r._nextUint32(),c=r._nextUint32(),u=r._nextUint64(),h=r._nextUint64(),f=s*3*8,d=new sv(i,ma.length+n,f,!0);for(let Y=0;Y<s;Y++)t.levels.push({levelData:new Uint8Array(i.buffer,i.byteOffset+d._nextUint64(),d._nextUint64()),uncompressedByteLength:d._nextUint64()});const m=new sv(i,o,a,!0),A={vendorId:m._skip(4)._nextUint16(),descriptorType:m._nextUint16(),versionNumber:m._nextUint16(),descriptorBlockSize:m._nextUint16(),colorModel:m._nextUint8(),colorPrimaries:m._nextUint8(),transferFunction:m._nextUint8(),flags:m._nextUint8(),texelBlockDimension:[m._nextUint8(),m._nextUint8(),m._nextUint8(),m._nextUint8()],bytesPlane:[m._nextUint8(),m._nextUint8(),m._nextUint8(),m._nextUint8(),m._nextUint8(),m._nextUint8(),m._nextUint8(),m._nextUint8()],samples:[]},E=(A.descriptorBlockSize/4-6)/4;for(let Y=0;Y<E;Y++){const O={bitOffset:m._nextUint16(),bitLength:m._nextUint8(),channelType:m._nextUint8(),samplePosition:[m._nextUint8(),m._nextUint8(),m._nextUint8(),m._nextUint8()],sampleLower:-1/0,sampleUpper:1/0};O.channelType&Xue?(O.sampleLower=m._nextInt32(),O.sampleUpper=m._nextInt32()):(O.sampleLower=m._nextUint32(),O.sampleUpper=m._nextUint32()),A.samples[Y]=O}t.dataFormatDescriptor.length=0,t.dataFormatDescriptor.push(A);const x=new sv(i,l,c,!0);for(;x._offset<c;){const Y=x._nextUint32(),O=x._scan(Y),K=U9(O);if(t.keyValue[K]=x._nextUint8Array(Y-O.byteLength-1),K.match(/^ktx/i)){const q=U9(t.keyValue[K]);t.keyValue[K]=q.substring(0,q.lastIndexOf("\0"))}const te=Y%4?4-Y%4:0;x._skip(te)}if(h<=0)return t;const C=new sv(i,u,h,!0),T=C._nextUint16(),I=C._nextUint16(),M=C._nextUint32(),L=C._nextUint32(),R=C._nextUint32(),P=C._nextUint32(),F=[];for(let Y=0;Y<s;Y++)F.push({imageFlags:C._nextUint32(),rgbSliceByteOffset:C._nextUint32(),rgbSliceByteLength:C._nextUint32(),alphaSliceByteOffset:C._nextUint32(),alphaSliceByteLength:C._nextUint32()});const k=u+C._offset,z=k+M,U=z+L,W=U+R,$=new Uint8Array(i.buffer,i.byteOffset+k,M),oe=new Uint8Array(i.buffer,i.byteOffset+z,L),X=new Uint8Array(i.buffer,i.byteOffset+U,R),Q=new Uint8Array(i.buffer,i.byteOffset+W,P);return t.globalData={endpointCount:T,selectorCount:I,imageDescs:F,endpointsData:$,selectorsData:oe,tablesData:X,extendedData:Q},t}let ov,gf,s5;const nb={env:{emscripten_notify_memory_growth:function(i){s5=new Uint8Array(gf.exports.memory.buffer)}}};class Zue{init(){return ov||(typeof fetch<"u"?ov=fetch("data:application/wasm;base64,"+z9).then(e=>e.arrayBuffer()).then(e=>WebAssembly.instantiate(e,nb)).then(this._init):ov=WebAssembly.instantiate(Buffer.from(z9,"base64"),nb).then(this._init),ov)}_init(e){gf=e.instance,nb.env.emscripten_notify_memory_growth(0)}decode(e,t=0){if(!gf)throw new Error("ZSTDDecoder: Await .init() before decoding.");const n=e.byteLength,r=gf.exports.malloc(n);s5.set(e,r),t=t||Number(gf.exports.ZSTD_findDecompressedSize(r,n));const s=gf.exports.malloc(t),o=gf.exports.ZSTD_decompress(s,t,r,n),a=s5.slice(s,s+o);return gf.exports.free(r),gf.exports.free(s),a}}const z9="AGFzbQEAAAABpQEVYAF/AX9gAn9/AGADf39/AX9gBX9/f39/AX9gAX8AYAJ/fwF/YAR/f39/AX9gA39/fwBgBn9/f39/fwF/YAd/f39/f39/AX9gAn9/AX5gAn5+AX5gAABgBX9/f39/AGAGf39/f39/AGAIf39/f39/f38AYAl/f39/f39/f38AYAABf2AIf39/f39/f38Bf2ANf39/f39/f39/f39/fwF/YAF/AX4CJwEDZW52H2Vtc2NyaXB0ZW5fbm90aWZ5X21lbW9yeV9ncm93dGgABANpaAEFAAAFAgEFCwACAQABAgIFBQcAAwABDgsBAQcAEhMHAAUBDAQEAAANBwQCAgYCBAgDAwMDBgEACQkHBgICAAYGAgQUBwYGAwIGAAMCAQgBBwUGCgoEEQAEBAEIAwgDBQgDEA8IAAcABAUBcAECAgUEAQCAAgYJAX8BQaCgwAILB2AHBm1lbW9yeQIABm1hbGxvYwAoBGZyZWUAJgxaU1REX2lzRXJyb3IAaBlaU1REX2ZpbmREZWNvbXByZXNzZWRTaXplAFQPWlNURF9kZWNvbXByZXNzAEoGX3N0YXJ0ACQJBwEAQQELASQKussBaA8AIAAgACgCBCABajYCBAsZACAAKAIAIAAoAgRBH3F0QQAgAWtBH3F2CwgAIABBiH9LC34BBH9BAyEBIAAoAgQiA0EgTQRAIAAoAggiASAAKAIQTwRAIAAQDQ8LIAAoAgwiAiABRgRAQQFBAiADQSBJGw8LIAAgASABIAJrIANBA3YiBCABIARrIAJJIgEbIgJrIgQ2AgggACADIAJBA3RrNgIEIAAgBCgAADYCAAsgAQsUAQF/IAAgARACIQIgACABEAEgAgv3AQECfyACRQRAIABCADcCACAAQQA2AhAgAEIANwIIQbh/DwsgACABNgIMIAAgAUEEajYCECACQQRPBEAgACABIAJqIgFBfGoiAzYCCCAAIAMoAAA2AgAgAUF/ai0AACIBBEAgAEEIIAEQFGs2AgQgAg8LIABBADYCBEF/DwsgACABNgIIIAAgAS0AACIDNgIAIAJBfmoiBEEBTQRAIARBAWtFBEAgACABLQACQRB0IANyIgM2AgALIAAgAS0AAUEIdCADajYCAAsgASACakF/ai0AACIBRQRAIABBADYCBEFsDwsgAEEoIAEQFCACQQN0ams2AgQgAgsWACAAIAEpAAA3AAAgACABKQAINwAICy8BAX8gAUECdEGgHWooAgAgACgCAEEgIAEgACgCBGprQR9xdnEhAiAAIAEQASACCyEAIAFCz9bTvtLHq9lCfiAAfEIfiUKHla+vmLbem55/fgsdAQF/IAAoAgggACgCDEYEfyAAKAIEQSBGBUEACwuCBAEDfyACQYDAAE8EQCAAIAEgAhBnIAAPCyAAIAJqIQMCQCAAIAFzQQNxRQRAAkAgAkEBSARAIAAhAgwBCyAAQQNxRQRAIAAhAgwBCyAAIQIDQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADTw0BIAJBA3ENAAsLAkAgA0F8cSIEQcAASQ0AIAIgBEFAaiIFSw0AA0AgAiABKAIANgIAIAIgASgCBDYCBCACIAEoAgg2AgggAiABKAIMNgIMIAIgASgCEDYCECACIAEoAhQ2AhQgAiABKAIYNgIYIAIgASgCHDYCHCACIAEoAiA2AiAgAiABKAIkNgIkIAIgASgCKDYCKCACIAEoAiw2AiwgAiABKAIwNgIwIAIgASgCNDYCNCACIAEoAjg2AjggAiABKAI8NgI8IAFBQGshASACQUBrIgIgBU0NAAsLIAIgBE8NAQNAIAIgASgCADYCACABQQRqIQEgAkEEaiICIARJDQALDAELIANBBEkEQCAAIQIMAQsgA0F8aiIEIABJBEAgACECDAELIAAhAgNAIAIgAS0AADoAACACIAEtAAE6AAEgAiABLQACOgACIAIgAS0AAzoAAyABQQRqIQEgAkEEaiICIARNDQALCyACIANJBEADQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADRw0ACwsgAAsMACAAIAEpAAA3AAALQQECfyAAKAIIIgEgACgCEEkEQEEDDwsgACAAKAIEIgJBB3E2AgQgACABIAJBA3ZrIgE2AgggACABKAAANgIAQQALDAAgACABKAIANgAAC/cCAQJ/AkAgACABRg0AAkAgASACaiAASwRAIAAgAmoiBCABSw0BCyAAIAEgAhALDwsgACABc0EDcSEDAkACQCAAIAFJBEAgAwRAIAAhAwwDCyAAQQNxRQRAIAAhAwwCCyAAIQMDQCACRQ0EIAMgAS0AADoAACABQQFqIQEgAkF/aiECIANBAWoiA0EDcQ0ACwwBCwJAIAMNACAEQQNxBEADQCACRQ0FIAAgAkF/aiICaiIDIAEgAmotAAA6AAAgA0EDcQ0ACwsgAkEDTQ0AA0AgACACQXxqIgJqIAEgAmooAgA2AgAgAkEDSw0ACwsgAkUNAgNAIAAgAkF/aiICaiABIAJqLQAAOgAAIAINAAsMAgsgAkEDTQ0AIAIhBANAIAMgASgCADYCACABQQRqIQEgA0EEaiEDIARBfGoiBEEDSw0ACyACQQNxIQILIAJFDQADQCADIAEtAAA6AAAgA0EBaiEDIAFBAWohASACQX9qIgINAAsLIAAL8wICAn8BfgJAIAJFDQAgACACaiIDQX9qIAE6AAAgACABOgAAIAJBA0kNACADQX5qIAE6AAAgACABOgABIANBfWogAToAACAAIAE6AAIgAkEHSQ0AIANBfGogAToAACAAIAE6AAMgAkEJSQ0AIABBACAAa0EDcSIEaiIDIAFB/wFxQYGChAhsIgE2AgAgAyACIARrQXxxIgRqIgJBfGogATYCACAEQQlJDQAgAyABNgIIIAMgATYCBCACQXhqIAE2AgAgAkF0aiABNgIAIARBGUkNACADIAE2AhggAyABNgIUIAMgATYCECADIAE2AgwgAkFwaiABNgIAIAJBbGogATYCACACQWhqIAE2AgAgAkFkaiABNgIAIAQgA0EEcUEYciIEayICQSBJDQAgAa0iBUIghiAFhCEFIAMgBGohAQNAIAEgBTcDGCABIAU3AxAgASAFNwMIIAEgBTcDACABQSBqIQEgAkFgaiICQR9LDQALCyAACy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAIajYCACADCy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAFajYCACADCx8AIAAgASACKAIEEAg2AgAgARAEGiAAIAJBCGo2AgQLCAAgAGdBH3MLugUBDX8jAEEQayIKJAACfyAEQQNNBEAgCkEANgIMIApBDGogAyAEEAsaIAAgASACIApBDGpBBBAVIgBBbCAAEAMbIAAgACAESxsMAQsgAEEAIAEoAgBBAXRBAmoQECENQVQgAygAACIGQQ9xIgBBCksNABogAiAAQQVqNgIAIAMgBGoiAkF8aiEMIAJBeWohDiACQXtqIRAgAEEGaiELQQQhBSAGQQR2IQRBICAAdCIAQQFyIQkgASgCACEPQQAhAiADIQYCQANAIAlBAkggAiAPS3JFBEAgAiEHAkAgCARAA0AgBEH//wNxQf//A0YEQCAHQRhqIQcgBiAQSQR/IAZBAmoiBigAACAFdgUgBUEQaiEFIARBEHYLIQQMAQsLA0AgBEEDcSIIQQNGBEAgBUECaiEFIARBAnYhBCAHQQNqIQcMAQsLIAcgCGoiByAPSw0EIAVBAmohBQNAIAIgB0kEQCANIAJBAXRqQQA7AQAgAkEBaiECDAELCyAGIA5LQQAgBiAFQQN1aiIHIAxLG0UEQCAHKAAAIAVBB3EiBXYhBAwCCyAEQQJ2IQQLIAYhBwsCfyALQX9qIAQgAEF/anEiBiAAQQF0QX9qIgggCWsiEUkNABogBCAIcSIEQQAgESAEIABIG2shBiALCyEIIA0gAkEBdGogBkF/aiIEOwEAIAlBASAGayAEIAZBAUgbayEJA0AgCSAASARAIABBAXUhACALQX9qIQsMAQsLAn8gByAOS0EAIAcgBSAIaiIFQQN1aiIGIAxLG0UEQCAFQQdxDAELIAUgDCIGIAdrQQN0awshBSACQQFqIQIgBEUhCCAGKAAAIAVBH3F2IQQMAQsLQWwgCUEBRyAFQSBKcg0BGiABIAJBf2o2AgAgBiAFQQdqQQN1aiADawwBC0FQCyEAIApBEGokACAACwkAQQFBBSAAGwsMACAAIAEoAAA2AAALqgMBCn8jAEHwAGsiCiQAIAJBAWohDiAAQQhqIQtBgIAEIAVBf2p0QRB1IQxBACECQQEhBkEBIAV0IglBf2oiDyEIA0AgAiAORkUEQAJAIAEgAkEBdCINai8BACIHQf//A0YEQCALIAhBA3RqIAI2AgQgCEF/aiEIQQEhBwwBCyAGQQAgDCAHQRB0QRB1ShshBgsgCiANaiAHOwEAIAJBAWohAgwBCwsgACAFNgIEIAAgBjYCACAJQQN2IAlBAXZqQQNqIQxBACEAQQAhBkEAIQIDQCAGIA5GBEADQAJAIAAgCUYNACAKIAsgAEEDdGoiASgCBCIGQQF0aiICIAIvAQAiAkEBajsBACABIAUgAhAUayIIOgADIAEgAiAIQf8BcXQgCWs7AQAgASAEIAZBAnQiAmooAgA6AAIgASACIANqKAIANgIEIABBAWohAAwBCwsFIAEgBkEBdGouAQAhDUEAIQcDQCAHIA1ORQRAIAsgAkEDdGogBjYCBANAIAIgDGogD3EiAiAISw0ACyAHQQFqIQcMAQsLIAZBAWohBgwBCwsgCkHwAGokAAsjAEIAIAEQCSAAhUKHla+vmLbem55/fkLj3MqV/M7y9YV/fAsQACAAQn43AwggACABNgIACyQBAX8gAARAIAEoAgQiAgRAIAEoAgggACACEQEADwsgABAmCwsfACAAIAEgAi8BABAINgIAIAEQBBogACACQQRqNgIEC0oBAX9BoCAoAgAiASAAaiIAQX9MBEBBiCBBMDYCAEF/DwsCQCAAPwBBEHRNDQAgABBmDQBBiCBBMDYCAEF/DwtBoCAgADYCACABC9cBAQh/Qbp/IQoCQCACKAIEIgggAigCACIJaiIOIAEgAGtLDQBBbCEKIAkgBCADKAIAIgtrSw0AIAAgCWoiBCACKAIIIgxrIQ0gACABQWBqIg8gCyAJQQAQKSADIAkgC2o2AgACQAJAIAwgBCAFa00EQCANIQUMAQsgDCAEIAZrSw0CIAcgDSAFayIAaiIBIAhqIAdNBEAgBCABIAgQDxoMAgsgBCABQQAgAGsQDyEBIAIgACAIaiIINgIEIAEgAGshBAsgBCAPIAUgCEEBECkLIA4hCgsgCgubAgEBfyMAQYABayINJAAgDSADNgJ8AkAgAkEDSwRAQX8hCQwBCwJAAkACQAJAIAJBAWsOAwADAgELIAZFBEBBuH8hCQwEC0FsIQkgBS0AACICIANLDQMgACAHIAJBAnQiAmooAgAgAiAIaigCABA7IAEgADYCAEEBIQkMAwsgASAJNgIAQQAhCQwCCyAKRQRAQWwhCQwCC0EAIQkgC0UgDEEZSHINAUEIIAR0QQhqIQBBACECA0AgAiAATw0CIAJBQGshAgwAAAsAC0FsIQkgDSANQfwAaiANQfgAaiAFIAYQFSICEAMNACANKAJ4IgMgBEsNACAAIA0gDSgCfCAHIAggAxAYIAEgADYCACACIQkLIA1BgAFqJAAgCQsLACAAIAEgAhALGgsQACAALwAAIAAtAAJBEHRyCy8AAn9BuH8gAUEISQ0AGkFyIAAoAAQiAEF3Sw0AGkG4fyAAQQhqIgAgACABSxsLCwkAIAAgATsAAAsDAAELigYBBX8gACAAKAIAIgVBfnE2AgBBACAAIAVBAXZqQYQgKAIAIgQgAEYbIQECQAJAIAAoAgQiAkUNACACKAIAIgNBAXENACACQQhqIgUgA0EBdkF4aiIDQQggA0EISxtnQR9zQQJ0QYAfaiIDKAIARgRAIAMgAigCDDYCAAsgAigCCCIDBEAgAyACKAIMNgIECyACKAIMIgMEQCADIAIoAgg2AgALIAIgAigCACAAKAIAQX5xajYCAEGEICEAAkACQCABRQ0AIAEgAjYCBCABKAIAIgNBAXENASADQQF2QXhqIgNBCCADQQhLG2dBH3NBAnRBgB9qIgMoAgAgAUEIakYEQCADIAEoAgw2AgALIAEoAggiAwRAIAMgASgCDDYCBAsgASgCDCIDBEAgAyABKAIINgIAQYQgKAIAIQQLIAIgAigCACABKAIAQX5xajYCACABIARGDQAgASABKAIAQQF2akEEaiEACyAAIAI2AgALIAIoAgBBAXZBeGoiAEEIIABBCEsbZ0Efc0ECdEGAH2oiASgCACEAIAEgBTYCACACIAA2AgwgAkEANgIIIABFDQEgACAFNgIADwsCQCABRQ0AIAEoAgAiAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAigCACABQQhqRgRAIAIgASgCDDYCAAsgASgCCCICBEAgAiABKAIMNgIECyABKAIMIgIEQCACIAEoAgg2AgBBhCAoAgAhBAsgACAAKAIAIAEoAgBBfnFqIgI2AgACQCABIARHBEAgASABKAIAQQF2aiAANgIEIAAoAgAhAgwBC0GEICAANgIACyACQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgIoAgAhASACIABBCGoiAjYCACAAIAE2AgwgAEEANgIIIAFFDQEgASACNgIADwsgBUEBdkF4aiIBQQggAUEISxtnQR9zQQJ0QYAfaiICKAIAIQEgAiAAQQhqIgI2AgAgACABNgIMIABBADYCCCABRQ0AIAEgAjYCAAsLDgAgAARAIABBeGoQJQsLgAIBA38CQCAAQQ9qQXhxQYQgKAIAKAIAQQF2ayICEB1Bf0YNAAJAQYQgKAIAIgAoAgAiAUEBcQ0AIAFBAXZBeGoiAUEIIAFBCEsbZ0Efc0ECdEGAH2oiASgCACAAQQhqRgRAIAEgACgCDDYCAAsgACgCCCIBBEAgASAAKAIMNgIECyAAKAIMIgFFDQAgASAAKAIINgIAC0EBIQEgACAAKAIAIAJBAXRqIgI2AgAgAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAygCACECIAMgAEEIaiIDNgIAIAAgAjYCDCAAQQA2AgggAkUNACACIAM2AgALIAELtwIBA38CQAJAIABBASAAGyICEDgiAA0AAkACQEGEICgCACIARQ0AIAAoAgAiA0EBcQ0AIAAgA0EBcjYCACADQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgAgAEEIakYEQCABIAAoAgw2AgALIAAoAggiAQRAIAEgACgCDDYCBAsgACgCDCIBBEAgASAAKAIINgIACyACECchAkEAIQFBhCAoAgAhACACDQEgACAAKAIAQX5xNgIAQQAPCyACQQ9qQXhxIgMQHSICQX9GDQIgAkEHakF4cSIAIAJHBEAgACACaxAdQX9GDQMLAkBBhCAoAgAiAUUEQEGAICAANgIADAELIAAgATYCBAtBhCAgADYCACAAIANBAXRBAXI2AgAMAQsgAEUNAQsgAEEIaiEBCyABC7kDAQJ/IAAgA2ohBQJAIANBB0wEQANAIAAgBU8NAiAAIAItAAA6AAAgAEEBaiEAIAJBAWohAgwAAAsACyAEQQFGBEACQCAAIAJrIgZBB00EQCAAIAItAAA6AAAgACACLQABOgABIAAgAi0AAjoAAiAAIAItAAM6AAMgAEEEaiACIAZBAnQiBkHAHmooAgBqIgIQFyACIAZB4B5qKAIAayECDAELIAAgAhAMCyACQQhqIQIgAEEIaiEACwJAAkACQAJAIAUgAU0EQCAAIANqIQEgBEEBRyAAIAJrQQ9Kcg0BA0AgACACEAwgAkEIaiECIABBCGoiACABSQ0ACwwFCyAAIAFLBEAgACEBDAQLIARBAUcgACACa0EPSnINASAAIQMgAiEEA0AgAyAEEAwgBEEIaiEEIANBCGoiAyABSQ0ACwwCCwNAIAAgAhAHIAJBEGohAiAAQRBqIgAgAUkNAAsMAwsgACEDIAIhBANAIAMgBBAHIARBEGohBCADQRBqIgMgAUkNAAsLIAIgASAAa2ohAgsDQCABIAVPDQEgASACLQAAOgAAIAFBAWohASACQQFqIQIMAAALAAsLQQECfyAAIAAoArjgASIDNgLE4AEgACgCvOABIQQgACABNgK84AEgACABIAJqNgK44AEgACABIAQgA2tqNgLA4AELpgEBAX8gACAAKALs4QEQFjYCyOABIABCADcD+OABIABCADcDuOABIABBwOABakIANwMAIABBqNAAaiIBQYyAgOAANgIAIABBADYCmOIBIABCADcDiOEBIABCAzcDgOEBIABBrNABakHgEikCADcCACAAQbTQAWpB6BIoAgA2AgAgACABNgIMIAAgAEGYIGo2AgggACAAQaAwajYCBCAAIABBEGo2AgALYQEBf0G4fyEDAkAgAUEDSQ0AIAIgABAhIgFBA3YiADYCCCACIAFBAXE2AgQgAiABQQF2QQNxIgM2AgACQCADQX9qIgFBAksNAAJAIAFBAWsOAgEAAgtBbA8LIAAhAwsgAwsMACAAIAEgAkEAEC4LiAQCA38CfiADEBYhBCAAQQBBKBAQIQAgBCACSwRAIAQPCyABRQRAQX8PCwJAAkAgA0EBRg0AIAEoAAAiBkGo6r5pRg0AQXYhAyAGQXBxQdDUtMIBRw0BQQghAyACQQhJDQEgAEEAQSgQECEAIAEoAAQhASAAQQE2AhQgACABrTcDAEEADwsgASACIAMQLyIDIAJLDQAgACADNgIYQXIhAyABIARqIgVBf2otAAAiAkEIcQ0AIAJBIHEiBkUEQEFwIQMgBS0AACIFQacBSw0BIAVBB3GtQgEgBUEDdkEKaq2GIgdCA4h+IAd8IQggBEEBaiEECyACQQZ2IQMgAkECdiEFAkAgAkEDcUF/aiICQQJLBEBBACECDAELAkACQAJAIAJBAWsOAgECAAsgASAEai0AACECIARBAWohBAwCCyABIARqLwAAIQIgBEECaiEEDAELIAEgBGooAAAhAiAEQQRqIQQLIAVBAXEhBQJ+AkACQAJAIANBf2oiA0ECTQRAIANBAWsOAgIDAQtCfyAGRQ0DGiABIARqMQAADAMLIAEgBGovAACtQoACfAwCCyABIARqKAAArQwBCyABIARqKQAACyEHIAAgBTYCICAAIAI2AhwgACAHNwMAQQAhAyAAQQA2AhQgACAHIAggBhsiBzcDCCAAIAdCgIAIIAdCgIAIVBs+AhALIAMLWwEBf0G4fyEDIAIQFiICIAFNBH8gACACakF/ai0AACIAQQNxQQJ0QaAeaigCACACaiAAQQZ2IgFBAnRBsB5qKAIAaiAAQSBxIgBFaiABRSAAQQV2cWoFQbh/CwsdACAAKAKQ4gEQWiAAQQA2AqDiASAAQgA3A5DiAQu1AwEFfyMAQZACayIKJABBuH8hBgJAIAVFDQAgBCwAACIIQf8BcSEHAkAgCEF/TARAIAdBgn9qQQF2IgggBU8NAkFsIQYgB0GBf2oiBUGAAk8NAiAEQQFqIQdBACEGA0AgBiAFTwRAIAUhBiAIIQcMAwUgACAGaiAHIAZBAXZqIgQtAABBBHY6AAAgACAGQQFyaiAELQAAQQ9xOgAAIAZBAmohBgwBCwAACwALIAcgBU8NASAAIARBAWogByAKEFMiBhADDQELIAYhBEEAIQYgAUEAQTQQECEJQQAhBQNAIAQgBkcEQCAAIAZqIggtAAAiAUELSwRAQWwhBgwDBSAJIAFBAnRqIgEgASgCAEEBajYCACAGQQFqIQZBASAILQAAdEEBdSAFaiEFDAILAAsLQWwhBiAFRQ0AIAUQFEEBaiIBQQxLDQAgAyABNgIAQQFBASABdCAFayIDEBQiAXQgA0cNACAAIARqIAFBAWoiADoAACAJIABBAnRqIgAgACgCAEEBajYCACAJKAIEIgBBAkkgAEEBcXINACACIARBAWo2AgAgB0EBaiEGCyAKQZACaiQAIAYLxhEBDH8jAEHwAGsiBSQAQWwhCwJAIANBCkkNACACLwAAIQogAi8AAiEJIAIvAAQhByAFQQhqIAQQDgJAIAMgByAJIApqakEGaiIMSQ0AIAUtAAohCCAFQdgAaiACQQZqIgIgChAGIgsQAw0BIAVBQGsgAiAKaiICIAkQBiILEAMNASAFQShqIAIgCWoiAiAHEAYiCxADDQEgBUEQaiACIAdqIAMgDGsQBiILEAMNASAAIAFqIg9BfWohECAEQQRqIQZBASELIAAgAUEDakECdiIDaiIMIANqIgIgA2oiDiEDIAIhBCAMIQcDQCALIAMgEElxBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgCS0AAyELIAcgBiAFQUBrIAgQAkECdGoiCS8BADsAACAFQUBrIAktAAIQASAJLQADIQogBCAGIAVBKGogCBACQQJ0aiIJLwEAOwAAIAVBKGogCS0AAhABIAktAAMhCSADIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgDS0AAyENIAAgC2oiCyAGIAVB2ABqIAgQAkECdGoiAC8BADsAACAFQdgAaiAALQACEAEgAC0AAyEAIAcgCmoiCiAGIAVBQGsgCBACQQJ0aiIHLwEAOwAAIAVBQGsgBy0AAhABIActAAMhByAEIAlqIgkgBiAFQShqIAgQAkECdGoiBC8BADsAACAFQShqIAQtAAIQASAELQADIQQgAyANaiIDIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgACALaiEAIAcgCmohByAEIAlqIQQgAyANLQADaiEDIAVB2ABqEA0gBUFAaxANciAFQShqEA1yIAVBEGoQDXJFIQsMAQsLIAQgDksgByACS3INAEFsIQsgACAMSw0BIAxBfWohCQNAQQAgACAJSSAFQdgAahAEGwRAIAAgBiAFQdgAaiAIEAJBAnRqIgovAQA7AAAgBUHYAGogCi0AAhABIAAgCi0AA2oiACAGIAVB2ABqIAgQAkECdGoiCi8BADsAACAFQdgAaiAKLQACEAEgACAKLQADaiEADAEFIAxBfmohCgNAIAVB2ABqEAQgACAKS3JFBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgACAJLQADaiEADAELCwNAIAAgCk0EQCAAIAYgBUHYAGogCBACQQJ0aiIJLwEAOwAAIAVB2ABqIAktAAIQASAAIAktAANqIQAMAQsLAkAgACAMTw0AIAAgBiAFQdgAaiAIEAIiAEECdGoiDC0AADoAACAMLQADQQFGBEAgBUHYAGogDC0AAhABDAELIAUoAlxBH0sNACAFQdgAaiAGIABBAnRqLQACEAEgBSgCXEEhSQ0AIAVBIDYCXAsgAkF9aiEMA0BBACAHIAxJIAVBQGsQBBsEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiIAIAYgBUFAayAIEAJBAnRqIgcvAQA7AAAgBUFAayAHLQACEAEgACAHLQADaiEHDAEFIAJBfmohDANAIAVBQGsQBCAHIAxLckUEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwNAIAcgDE0EQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwJAIAcgAk8NACAHIAYgBUFAayAIEAIiAEECdGoiAi0AADoAACACLQADQQFGBEAgBUFAayACLQACEAEMAQsgBSgCREEfSw0AIAVBQGsgBiAAQQJ0ai0AAhABIAUoAkRBIUkNACAFQSA2AkQLIA5BfWohAgNAQQAgBCACSSAFQShqEAQbBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2oiACAGIAVBKGogCBACQQJ0aiIELwEAOwAAIAVBKGogBC0AAhABIAAgBC0AA2ohBAwBBSAOQX5qIQIDQCAFQShqEAQgBCACS3JFBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsDQCAEIAJNBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsCQCAEIA5PDQAgBCAGIAVBKGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBKGogAi0AAhABDAELIAUoAixBH0sNACAFQShqIAYgAEECdGotAAIQASAFKAIsQSFJDQAgBUEgNgIsCwNAQQAgAyAQSSAFQRBqEAQbBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2oiACAGIAVBEGogCBACQQJ0aiICLwEAOwAAIAVBEGogAi0AAhABIAAgAi0AA2ohAwwBBSAPQX5qIQIDQCAFQRBqEAQgAyACS3JFBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsDQCADIAJNBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsCQCADIA9PDQAgAyAGIAVBEGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBEGogAi0AAhABDAELIAUoAhRBH0sNACAFQRBqIAYgAEECdGotAAIQASAFKAIUQSFJDQAgBUEgNgIUCyABQWwgBUHYAGoQCiAFQUBrEApxIAVBKGoQCnEgBUEQahAKcRshCwwJCwAACwALAAALAAsAAAsACwAACwALQWwhCwsgBUHwAGokACALC7UEAQ5/IwBBEGsiBiQAIAZBBGogABAOQVQhBQJAIARB3AtJDQAgBi0ABCEHIANB8ARqQQBB7AAQECEIIAdBDEsNACADQdwJaiIJIAggBkEIaiAGQQxqIAEgAhAxIhAQA0UEQCAGKAIMIgQgB0sNASADQdwFaiEPIANBpAVqIREgAEEEaiESIANBqAVqIQEgBCEFA0AgBSICQX9qIQUgCCACQQJ0aigCAEUNAAsgAkEBaiEOQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgASALaiAKNgIAIAVBAWohBSAKIAxqIQoMAQsLIAEgCjYCAEEAIQUgBigCCCELA0AgBSALRkUEQCABIAUgCWotAAAiDEECdGoiDSANKAIAIg1BAWo2AgAgDyANQQF0aiINIAw6AAEgDSAFOgAAIAVBAWohBQwBCwtBACEBIANBADYCqAUgBEF/cyAHaiEJQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgAyALaiABNgIAIAwgBSAJanQgAWohASAFQQFqIQUMAQsLIAcgBEEBaiIBIAJrIgRrQQFqIQgDQEEBIQUgBCAIT0UEQANAIAUgDk9FBEAgBUECdCIJIAMgBEE0bGpqIAMgCWooAgAgBHY2AgAgBUEBaiEFDAELCyAEQQFqIQQMAQsLIBIgByAPIAogESADIAIgARBkIAZBAToABSAGIAc6AAYgACAGKAIENgIACyAQIQULIAZBEGokACAFC8ENAQt/IwBB8ABrIgUkAEFsIQkCQCADQQpJDQAgAi8AACEKIAIvAAIhDCACLwAEIQYgBUEIaiAEEA4CQCADIAYgCiAMampBBmoiDUkNACAFLQAKIQcgBUHYAGogAkEGaiICIAoQBiIJEAMNASAFQUBrIAIgCmoiAiAMEAYiCRADDQEgBUEoaiACIAxqIgIgBhAGIgkQAw0BIAVBEGogAiAGaiADIA1rEAYiCRADDQEgACABaiIOQX1qIQ8gBEEEaiEGQQEhCSAAIAFBA2pBAnYiAmoiCiACaiIMIAJqIg0hAyAMIQQgCiECA0AgCSADIA9JcQRAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAACAGIAVBQGsgBxACQQF0aiIILQAAIQsgBUFAayAILQABEAEgAiALOgAAIAYgBUEoaiAHEAJBAXRqIggtAAAhCyAFQShqIAgtAAEQASAEIAs6AAAgBiAFQRBqIAcQAkEBdGoiCC0AACELIAVBEGogCC0AARABIAMgCzoAACAGIAVB2ABqIAcQAkEBdGoiCC0AACELIAVB2ABqIAgtAAEQASAAIAs6AAEgBiAFQUBrIAcQAkEBdGoiCC0AACELIAVBQGsgCC0AARABIAIgCzoAASAGIAVBKGogBxACQQF0aiIILQAAIQsgBUEoaiAILQABEAEgBCALOgABIAYgBUEQaiAHEAJBAXRqIggtAAAhCyAFQRBqIAgtAAEQASADIAs6AAEgA0ECaiEDIARBAmohBCACQQJqIQIgAEECaiEAIAkgBUHYAGoQDUVxIAVBQGsQDUVxIAVBKGoQDUVxIAVBEGoQDUVxIQkMAQsLIAQgDUsgAiAMS3INAEFsIQkgACAKSw0BIApBfWohCQNAIAVB2ABqEAQgACAJT3JFBEAgBiAFQdgAaiAHEAJBAXRqIggtAAAhCyAFQdgAaiAILQABEAEgACALOgAAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAASAAQQJqIQAMAQsLA0AgBUHYAGoQBCAAIApPckUEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCwNAIAAgCkkEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCyAMQX1qIQADQCAFQUBrEAQgAiAAT3JFBEAgBiAFQUBrIAcQAkEBdGoiCi0AACEJIAVBQGsgCi0AARABIAIgCToAACAGIAVBQGsgBxACQQF0aiIKLQAAIQkgBUFAayAKLQABEAEgAiAJOgABIAJBAmohAgwBCwsDQCAFQUBrEAQgAiAMT3JFBEAgBiAFQUBrIAcQAkEBdGoiAC0AACEKIAVBQGsgAC0AARABIAIgCjoAACACQQFqIQIMAQsLA0AgAiAMSQRAIAYgBUFAayAHEAJBAXRqIgAtAAAhCiAFQUBrIAAtAAEQASACIAo6AAAgAkEBaiECDAELCyANQX1qIQADQCAFQShqEAQgBCAAT3JFBEAgBiAFQShqIAcQAkEBdGoiAi0AACEKIAVBKGogAi0AARABIAQgCjoAACAGIAVBKGogBxACQQF0aiICLQAAIQogBUEoaiACLQABEAEgBCAKOgABIARBAmohBAwBCwsDQCAFQShqEAQgBCANT3JFBEAgBiAFQShqIAcQAkEBdGoiAC0AACECIAVBKGogAC0AARABIAQgAjoAACAEQQFqIQQMAQsLA0AgBCANSQRAIAYgBUEoaiAHEAJBAXRqIgAtAAAhAiAFQShqIAAtAAEQASAEIAI6AAAgBEEBaiEEDAELCwNAIAVBEGoQBCADIA9PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIAYgBUEQaiAHEAJBAXRqIgAtAAAhAiAFQRBqIAAtAAEQASADIAI6AAEgA0ECaiEDDAELCwNAIAVBEGoQBCADIA5PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIANBAWohAwwBCwsDQCADIA5JBEAgBiAFQRBqIAcQAkEBdGoiAC0AACECIAVBEGogAC0AARABIAMgAjoAACADQQFqIQMMAQsLIAFBbCAFQdgAahAKIAVBQGsQCnEgBUEoahAKcSAFQRBqEApxGyEJDAELQWwhCQsgBUHwAGokACAJC8oCAQR/IwBBIGsiBSQAIAUgBBAOIAUtAAIhByAFQQhqIAIgAxAGIgIQA0UEQCAEQQRqIQIgACABaiIDQX1qIQQDQCAFQQhqEAQgACAET3JFBEAgAiAFQQhqIAcQAkEBdGoiBi0AACEIIAVBCGogBi0AARABIAAgCDoAACACIAVBCGogBxACQQF0aiIGLQAAIQggBUEIaiAGLQABEAEgACAIOgABIABBAmohAAwBCwsDQCAFQQhqEAQgACADT3JFBEAgAiAFQQhqIAcQAkEBdGoiBC0AACEGIAVBCGogBC0AARABIAAgBjoAACAAQQFqIQAMAQsLA0AgACADT0UEQCACIAVBCGogBxACQQF0aiIELQAAIQYgBUEIaiAELQABEAEgACAGOgAAIABBAWohAAwBCwsgAUFsIAVBCGoQChshAgsgBUEgaiQAIAILtgMBCX8jAEEQayIGJAAgBkEANgIMIAZBADYCCEFUIQQCQAJAIANBQGsiDCADIAZBCGogBkEMaiABIAIQMSICEAMNACAGQQRqIAAQDiAGKAIMIgcgBi0ABEEBaksNASAAQQRqIQogBkEAOgAFIAYgBzoABiAAIAYoAgQ2AgAgB0EBaiEJQQEhBANAIAQgCUkEQCADIARBAnRqIgEoAgAhACABIAU2AgAgACAEQX9qdCAFaiEFIARBAWohBAwBCwsgB0EBaiEHQQAhBSAGKAIIIQkDQCAFIAlGDQEgAyAFIAxqLQAAIgRBAnRqIgBBASAEdEEBdSILIAAoAgAiAWoiADYCACAHIARrIQhBACEEAkAgC0EDTQRAA0AgBCALRg0CIAogASAEakEBdGoiACAIOgABIAAgBToAACAEQQFqIQQMAAALAAsDQCABIABPDQEgCiABQQF0aiIEIAg6AAEgBCAFOgAAIAQgCDoAAyAEIAU6AAIgBCAIOgAFIAQgBToABCAEIAg6AAcgBCAFOgAGIAFBBGohAQwAAAsACyAFQQFqIQUMAAALAAsgAiEECyAGQRBqJAAgBAutAQECfwJAQYQgKAIAIABHIAAoAgBBAXYiAyABa0F4aiICQXhxQQhHcgR/IAIFIAMQJ0UNASACQQhqC0EQSQ0AIAAgACgCACICQQFxIAAgAWpBD2pBeHEiASAAa0EBdHI2AgAgASAANgIEIAEgASgCAEEBcSAAIAJBAXZqIAFrIgJBAXRyNgIAQYQgIAEgAkH/////B3FqQQRqQYQgKAIAIABGGyABNgIAIAEQJQsLygIBBX8CQAJAAkAgAEEIIABBCEsbZ0EfcyAAaUEBR2oiAUEESSAAIAF2cg0AIAFBAnRB/B5qKAIAIgJFDQADQCACQXhqIgMoAgBBAXZBeGoiBSAATwRAIAIgBUEIIAVBCEsbZ0Efc0ECdEGAH2oiASgCAEYEQCABIAIoAgQ2AgALDAMLIARBHksNASAEQQFqIQQgAigCBCICDQALC0EAIQMgAUEgTw0BA0AgAUECdEGAH2ooAgAiAkUEQCABQR5LIQIgAUEBaiEBIAJFDQEMAwsLIAIgAkF4aiIDKAIAQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgBGBEAgASACKAIENgIACwsgAigCACIBBEAgASACKAIENgIECyACKAIEIgEEQCABIAIoAgA2AgALIAMgAygCAEEBcjYCACADIAAQNwsgAwvhCwINfwV+IwBB8ABrIgckACAHIAAoAvDhASIINgJcIAEgAmohDSAIIAAoAoDiAWohDwJAAkAgBUUEQCABIQQMAQsgACgCxOABIRAgACgCwOABIREgACgCvOABIQ4gAEEBNgKM4QFBACEIA0AgCEEDRwRAIAcgCEECdCICaiAAIAJqQazQAWooAgA2AkQgCEEBaiEIDAELC0FsIQwgB0EYaiADIAQQBhADDQEgB0EsaiAHQRhqIAAoAgAQEyAHQTRqIAdBGGogACgCCBATIAdBPGogB0EYaiAAKAIEEBMgDUFgaiESIAEhBEEAIQwDQCAHKAIwIAcoAixBA3RqKQIAIhRCEIinQf8BcSEIIAcoAkAgBygCPEEDdGopAgAiFUIQiKdB/wFxIQsgBygCOCAHKAI0QQN0aikCACIWQiCIpyEJIBVCIIghFyAUQiCIpyECAkAgFkIQiKdB/wFxIgNBAk8EQAJAIAZFIANBGUlyRQRAIAkgB0EYaiADQSAgBygCHGsiCiAKIANLGyIKEAUgAyAKayIDdGohCSAHQRhqEAQaIANFDQEgB0EYaiADEAUgCWohCQwBCyAHQRhqIAMQBSAJaiEJIAdBGGoQBBoLIAcpAkQhGCAHIAk2AkQgByAYNwNIDAELAkAgA0UEQCACBEAgBygCRCEJDAMLIAcoAkghCQwBCwJAAkAgB0EYakEBEAUgCSACRWpqIgNBA0YEQCAHKAJEQX9qIgMgA0VqIQkMAQsgA0ECdCAHaigCRCIJIAlFaiEJIANBAUYNAQsgByAHKAJINgJMCwsgByAHKAJENgJIIAcgCTYCRAsgF6chAyALBEAgB0EYaiALEAUgA2ohAwsgCCALakEUTwRAIAdBGGoQBBoLIAgEQCAHQRhqIAgQBSACaiECCyAHQRhqEAQaIAcgB0EYaiAUQhiIp0H/AXEQCCAUp0H//wNxajYCLCAHIAdBGGogFUIYiKdB/wFxEAggFadB//8DcWo2AjwgB0EYahAEGiAHIAdBGGogFkIYiKdB/wFxEAggFqdB//8DcWo2AjQgByACNgJgIAcoAlwhCiAHIAk2AmggByADNgJkAkACQAJAIAQgAiADaiILaiASSw0AIAIgCmoiEyAPSw0AIA0gBGsgC0Egak8NAQsgByAHKQNoNwMQIAcgBykDYDcDCCAEIA0gB0EIaiAHQdwAaiAPIA4gESAQEB4hCwwBCyACIARqIQggBCAKEAcgAkERTwRAIARBEGohAgNAIAIgCkEQaiIKEAcgAkEQaiICIAhJDQALCyAIIAlrIQIgByATNgJcIAkgCCAOa0sEQCAJIAggEWtLBEBBbCELDAILIBAgAiAOayICaiIKIANqIBBNBEAgCCAKIAMQDxoMAgsgCCAKQQAgAmsQDyEIIAcgAiADaiIDNgJkIAggAmshCCAOIQILIAlBEE8EQCADIAhqIQMDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALDAELAkAgCUEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgCUECdCIDQcAeaigCAGoiAhAXIAIgA0HgHmooAgBrIQIgBygCZCEDDAELIAggAhAMCyADQQlJDQAgAyAIaiEDIAhBCGoiCCACQQhqIgJrQQ9MBEADQCAIIAIQDCACQQhqIQIgCEEIaiIIIANJDQAMAgALAAsDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALCyAHQRhqEAQaIAsgDCALEAMiAhshDCAEIAQgC2ogAhshBCAFQX9qIgUNAAsgDBADDQFBbCEMIAdBGGoQBEECSQ0BQQAhCANAIAhBA0cEQCAAIAhBAnQiAmpBrNABaiACIAdqKAJENgIAIAhBAWohCAwBCwsgBygCXCEIC0G6fyEMIA8gCGsiACANIARrSw0AIAQEfyAEIAggABALIABqBUEACyABayEMCyAHQfAAaiQAIAwLkRcCFn8FfiMAQdABayIHJAAgByAAKALw4QEiCDYCvAEgASACaiESIAggACgCgOIBaiETAkACQCAFRQRAIAEhAwwBCyAAKALE4AEhESAAKALA4AEhFSAAKAK84AEhDyAAQQE2AozhAUEAIQgDQCAIQQNHBEAgByAIQQJ0IgJqIAAgAmpBrNABaigCADYCVCAIQQFqIQgMAQsLIAcgETYCZCAHIA82AmAgByABIA9rNgJoQWwhECAHQShqIAMgBBAGEAMNASAFQQQgBUEESBshFyAHQTxqIAdBKGogACgCABATIAdBxABqIAdBKGogACgCCBATIAdBzABqIAdBKGogACgCBBATQQAhBCAHQeAAaiEMIAdB5ABqIQoDQCAHQShqEARBAksgBCAXTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEJIAcoAkggBygCREEDdGopAgAiH0IgiKchCCAeQiCIISAgHUIgiKchAgJAIB9CEIinQf8BcSIDQQJPBEACQCAGRSADQRlJckUEQCAIIAdBKGogA0EgIAcoAixrIg0gDSADSxsiDRAFIAMgDWsiA3RqIQggB0EoahAEGiADRQ0BIAdBKGogAxAFIAhqIQgMAQsgB0EoaiADEAUgCGohCCAHQShqEAQaCyAHKQJUISEgByAINgJUIAcgITcDWAwBCwJAIANFBEAgAgRAIAcoAlQhCAwDCyAHKAJYIQgMAQsCQAJAIAdBKGpBARAFIAggAkVqaiIDQQNGBEAgBygCVEF/aiIDIANFaiEIDAELIANBAnQgB2ooAlQiCCAIRWohCCADQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAg2AlQLICCnIQMgCQRAIAdBKGogCRAFIANqIQMLIAkgC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgAmohAgsgB0EoahAEGiAHIAcoAmggAmoiCSADajYCaCAKIAwgCCAJSxsoAgAhDSAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogB0EoaiAfQhiIp0H/AXEQCCEOIAdB8ABqIARBBHRqIgsgCSANaiAIazYCDCALIAg2AgggCyADNgIEIAsgAjYCACAHIA4gH6dB//8DcWo2AkQgBEEBaiEEDAELCyAEIBdIDQEgEkFgaiEYIAdB4ABqIRogB0HkAGohGyABIQMDQCAHQShqEARBAksgBCAFTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEIIAcoAkggBygCREEDdGopAgAiH0IgiKchCSAeQiCIISAgHUIgiKchDAJAIB9CEIinQf8BcSICQQJPBEACQCAGRSACQRlJckUEQCAJIAdBKGogAkEgIAcoAixrIgogCiACSxsiChAFIAIgCmsiAnRqIQkgB0EoahAEGiACRQ0BIAdBKGogAhAFIAlqIQkMAQsgB0EoaiACEAUgCWohCSAHQShqEAQaCyAHKQJUISEgByAJNgJUIAcgITcDWAwBCwJAIAJFBEAgDARAIAcoAlQhCQwDCyAHKAJYIQkMAQsCQAJAIAdBKGpBARAFIAkgDEVqaiICQQNGBEAgBygCVEF/aiICIAJFaiEJDAELIAJBAnQgB2ooAlQiCSAJRWohCSACQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAk2AlQLICCnIRQgCARAIAdBKGogCBAFIBRqIRQLIAggC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgDGohDAsgB0EoahAEGiAHIAcoAmggDGoiGSAUajYCaCAbIBogCSAZSxsoAgAhHCAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogByAHQShqIB9CGIinQf8BcRAIIB+nQf//A3FqNgJEIAcgB0HwAGogBEEDcUEEdGoiDSkDCCIdNwPIASAHIA0pAwAiHjcDwAECQAJAAkAgBygCvAEiDiAepyICaiIWIBNLDQAgAyAHKALEASIKIAJqIgtqIBhLDQAgEiADayALQSBqTw0BCyAHIAcpA8gBNwMQIAcgBykDwAE3AwggAyASIAdBCGogB0G8AWogEyAPIBUgERAeIQsMAQsgAiADaiEIIAMgDhAHIAJBEU8EQCADQRBqIQIDQCACIA5BEGoiDhAHIAJBEGoiAiAISQ0ACwsgCCAdpyIOayECIAcgFjYCvAEgDiAIIA9rSwRAIA4gCCAVa0sEQEFsIQsMAgsgESACIA9rIgJqIhYgCmogEU0EQCAIIBYgChAPGgwCCyAIIBZBACACaxAPIQggByACIApqIgo2AsQBIAggAmshCCAPIQILIA5BEE8EQCAIIApqIQoDQCAIIAIQByACQRBqIQIgCEEQaiIIIApJDQALDAELAkAgDkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgDkECdCIKQcAeaigCAGoiAhAXIAIgCkHgHmooAgBrIQIgBygCxAEhCgwBCyAIIAIQDAsgCkEJSQ0AIAggCmohCiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAKSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAKSQ0ACwsgCxADBEAgCyEQDAQFIA0gDDYCACANIBkgHGogCWs2AgwgDSAJNgIIIA0gFDYCBCAEQQFqIQQgAyALaiEDDAILAAsLIAQgBUgNASAEIBdrIQtBACEEA0AgCyAFSARAIAcgB0HwAGogC0EDcUEEdGoiAikDCCIdNwPIASAHIAIpAwAiHjcDwAECQAJAAkAgBygCvAEiDCAepyICaiIKIBNLDQAgAyAHKALEASIJIAJqIhBqIBhLDQAgEiADayAQQSBqTw0BCyAHIAcpA8gBNwMgIAcgBykDwAE3AxggAyASIAdBGGogB0G8AWogEyAPIBUgERAeIRAMAQsgAiADaiEIIAMgDBAHIAJBEU8EQCADQRBqIQIDQCACIAxBEGoiDBAHIAJBEGoiAiAISQ0ACwsgCCAdpyIGayECIAcgCjYCvAEgBiAIIA9rSwRAIAYgCCAVa0sEQEFsIRAMAgsgESACIA9rIgJqIgwgCWogEU0EQCAIIAwgCRAPGgwCCyAIIAxBACACaxAPIQggByACIAlqIgk2AsQBIAggAmshCCAPIQILIAZBEE8EQCAIIAlqIQYDQCAIIAIQByACQRBqIQIgCEEQaiIIIAZJDQALDAELAkAgBkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgBkECdCIGQcAeaigCAGoiAhAXIAIgBkHgHmooAgBrIQIgBygCxAEhCQwBCyAIIAIQDAsgCUEJSQ0AIAggCWohBiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAGSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAGSQ0ACwsgEBADDQMgC0EBaiELIAMgEGohAwwBCwsDQCAEQQNHBEAgACAEQQJ0IgJqQazQAWogAiAHaigCVDYCACAEQQFqIQQMAQsLIAcoArwBIQgLQbp/IRAgEyAIayIAIBIgA2tLDQAgAwR/IAMgCCAAEAsgAGoFQQALIAFrIRALIAdB0AFqJAAgEAslACAAQgA3AgAgAEEAOwEIIABBADoACyAAIAE2AgwgACACOgAKC7QFAQN/IwBBMGsiBCQAIABB/wFqIgVBfWohBgJAIAMvAQIEQCAEQRhqIAEgAhAGIgIQAw0BIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahASOgAAIAMgBEEIaiAEQRhqEBI6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0FIAEgBEEQaiAEQRhqEBI6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBSABIARBCGogBEEYahASOgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEjoAACABIAJqIABrIQIMAwsgAyAEQRBqIARBGGoQEjoAAiADIARBCGogBEEYahASOgADIANBBGohAwwAAAsACyAEQRhqIAEgAhAGIgIQAw0AIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahAROgAAIAMgBEEIaiAEQRhqEBE6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0EIAEgBEEQaiAEQRhqEBE6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBCABIARBCGogBEEYahAROgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEToAACABIAJqIABrIQIMAgsgAyAEQRBqIARBGGoQEToAAiADIARBCGogBEEYahAROgADIANBBGohAwwAAAsACyAEQTBqJAAgAgtpAQF/An8CQAJAIAJBB00NACABKAAAQbfIwuF+Rw0AIAAgASgABDYCmOIBQWIgAEEQaiABIAIQPiIDEAMNAhogAEKBgICAEDcDiOEBIAAgASADaiACIANrECoMAQsgACABIAIQKgtBAAsLrQMBBn8jAEGAAWsiAyQAQWIhCAJAIAJBCUkNACAAQZjQAGogAUEIaiIEIAJBeGogAEGY0AAQMyIFEAMiBg0AIANBHzYCfCADIANB/ABqIANB+ABqIAQgBCAFaiAGGyIEIAEgAmoiAiAEaxAVIgUQAw0AIAMoAnwiBkEfSw0AIAMoAngiB0EJTw0AIABBiCBqIAMgBkGAC0GADCAHEBggA0E0NgJ8IAMgA0H8AGogA0H4AGogBCAFaiIEIAIgBGsQFSIFEAMNACADKAJ8IgZBNEsNACADKAJ4IgdBCk8NACAAQZAwaiADIAZBgA1B4A4gBxAYIANBIzYCfCADIANB/ABqIANB+ABqIAQgBWoiBCACIARrEBUiBRADDQAgAygCfCIGQSNLDQAgAygCeCIHQQpPDQAgACADIAZBwBBB0BEgBxAYIAQgBWoiBEEMaiIFIAJLDQAgAiAFayEFQQAhAgNAIAJBA0cEQCAEKAAAIgZBf2ogBU8NAiAAIAJBAnRqQZzQAWogBjYCACACQQFqIQIgBEEEaiEEDAELCyAEIAFrIQgLIANBgAFqJAAgCAtGAQN/IABBCGohAyAAKAIEIQJBACEAA0AgACACdkUEQCABIAMgAEEDdGotAAJBFktqIQEgAEEBaiEADAELCyABQQggAmt0C4YDAQV/Qbh/IQcCQCADRQ0AIAItAAAiBEUEQCABQQA2AgBBAUG4fyADQQFGGw8LAn8gAkEBaiIFIARBGHRBGHUiBkF/Sg0AGiAGQX9GBEAgA0EDSA0CIAUvAABBgP4BaiEEIAJBA2oMAQsgA0ECSA0BIAItAAEgBEEIdHJBgIB+aiEEIAJBAmoLIQUgASAENgIAIAVBAWoiASACIANqIgNLDQBBbCEHIABBEGogACAFLQAAIgVBBnZBI0EJIAEgAyABa0HAEEHQEUHwEiAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBmCBqIABBCGogBUEEdkEDcUEfQQggASABIAZqIAgbIgEgAyABa0GAC0GADEGAFyAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBoDBqIABBBGogBUECdkEDcUE0QQkgASABIAZqIAgbIgEgAyABa0GADUHgDkGQGSAAKAKM4QEgACgCnOIBIAQQHyIAEAMNACAAIAFqIAJrIQcLIAcLrQMBCn8jAEGABGsiCCQAAn9BUiACQf8BSw0AGkFUIANBDEsNABogAkEBaiELIABBBGohCUGAgAQgA0F/anRBEHUhCkEAIQJBASEEQQEgA3QiB0F/aiIMIQUDQCACIAtGRQRAAkAgASACQQF0Ig1qLwEAIgZB//8DRgRAIAkgBUECdGogAjoAAiAFQX9qIQVBASEGDAELIARBACAKIAZBEHRBEHVKGyEECyAIIA1qIAY7AQAgAkEBaiECDAELCyAAIAQ7AQIgACADOwEAIAdBA3YgB0EBdmpBA2ohBkEAIQRBACECA0AgBCALRkUEQCABIARBAXRqLgEAIQpBACEAA0AgACAKTkUEQCAJIAJBAnRqIAQ6AAIDQCACIAZqIAxxIgIgBUsNAAsgAEEBaiEADAELCyAEQQFqIQQMAQsLQX8gAg0AGkEAIQIDfyACIAdGBH9BAAUgCCAJIAJBAnRqIgAtAAJBAXRqIgEgAS8BACIBQQFqOwEAIAAgAyABEBRrIgU6AAMgACABIAVB/wFxdCAHazsBACACQQFqIQIMAQsLCyEFIAhBgARqJAAgBQvjBgEIf0FsIQcCQCACQQNJDQACQAJAAkACQCABLQAAIgNBA3EiCUEBaw4DAwEAAgsgACgCiOEBDQBBYg8LIAJBBUkNAkEDIQYgASgAACEFAn8CQAJAIANBAnZBA3EiCEF+aiIEQQFNBEAgBEEBaw0BDAILIAVBDnZB/wdxIQQgBUEEdkH/B3EhAyAIRQwCCyAFQRJ2IQRBBCEGIAVBBHZB//8AcSEDQQAMAQsgBUEEdkH//w9xIgNBgIAISw0DIAEtAARBCnQgBUEWdnIhBEEFIQZBAAshBSAEIAZqIgogAksNAgJAIANBgQZJDQAgACgCnOIBRQ0AQQAhAgNAIAJBg4ABSw0BIAJBQGshAgwAAAsACwJ/IAlBA0YEQCABIAZqIQEgAEHw4gFqIQIgACgCDCEGIAUEQCACIAMgASAEIAYQXwwCCyACIAMgASAEIAYQXQwBCyAAQbjQAWohAiABIAZqIQEgAEHw4gFqIQYgAEGo0ABqIQggBQRAIAggBiADIAEgBCACEF4MAQsgCCAGIAMgASAEIAIQXAsQAw0CIAAgAzYCgOIBIABBATYCiOEBIAAgAEHw4gFqNgLw4QEgCUECRgRAIAAgAEGo0ABqNgIMCyAAIANqIgBBiOMBakIANwAAIABBgOMBakIANwAAIABB+OIBakIANwAAIABB8OIBakIANwAAIAoPCwJ/AkACQAJAIANBAnZBA3FBf2oiBEECSw0AIARBAWsOAgACAQtBASEEIANBA3YMAgtBAiEEIAEvAABBBHYMAQtBAyEEIAEQIUEEdgsiAyAEaiIFQSBqIAJLBEAgBSACSw0CIABB8OIBaiABIARqIAMQCyEBIAAgAzYCgOIBIAAgATYC8OEBIAEgA2oiAEIANwAYIABCADcAECAAQgA3AAggAEIANwAAIAUPCyAAIAM2AoDiASAAIAEgBGo2AvDhASAFDwsCfwJAAkACQCADQQJ2QQNxQX9qIgRBAksNACAEQQFrDgIAAgELQQEhByADQQN2DAILQQIhByABLwAAQQR2DAELIAJBBEkgARAhIgJBj4CAAUtyDQFBAyEHIAJBBHYLIQIgAEHw4gFqIAEgB2otAAAgAkEgahAQIQEgACACNgKA4gEgACABNgLw4QEgB0EBaiEHCyAHC0sAIABC+erQ0OfJoeThADcDICAAQgA3AxggAELP1tO+0ser2UI3AxAgAELW64Lu6v2J9eAANwMIIABCADcDACAAQShqQQBBKBAQGgviAgICfwV+IABBKGoiASAAKAJIaiECAn4gACkDACIDQiBaBEAgACkDECIEQgeJIAApAwgiBUIBiXwgACkDGCIGQgyJfCAAKQMgIgdCEol8IAUQGSAEEBkgBhAZIAcQGQwBCyAAKQMYQsXP2bLx5brqJ3wLIAN8IQMDQCABQQhqIgAgAk0EQEIAIAEpAAAQCSADhUIbiUKHla+vmLbem55/fkLj3MqV/M7y9YV/fCEDIAAhAQwBCwsCQCABQQRqIgAgAksEQCABIQAMAQsgASgAAK1Ch5Wvr5i23puef34gA4VCF4lCz9bTvtLHq9lCfkL5893xmfaZqxZ8IQMLA0AgACACSQRAIAAxAABCxc/ZsvHluuonfiADhUILiUKHla+vmLbem55/fiEDIABBAWohAAwBCwsgA0IhiCADhULP1tO+0ser2UJ+IgNCHYggA4VC+fPd8Zn2masWfiIDQiCIIAOFC+8CAgJ/BH4gACAAKQMAIAKtfDcDAAJAAkAgACgCSCIDIAJqIgRBH00EQCABRQ0BIAAgA2pBKGogASACECAgACgCSCACaiEEDAELIAEgAmohAgJ/IAMEQCAAQShqIgQgA2ogAUEgIANrECAgACAAKQMIIAQpAAAQCTcDCCAAIAApAxAgACkAMBAJNwMQIAAgACkDGCAAKQA4EAk3AxggACAAKQMgIABBQGspAAAQCTcDICAAKAJIIQMgAEEANgJIIAEgA2tBIGohAQsgAUEgaiACTQsEQCACQWBqIQMgACkDICEFIAApAxghBiAAKQMQIQcgACkDCCEIA0AgCCABKQAAEAkhCCAHIAEpAAgQCSEHIAYgASkAEBAJIQYgBSABKQAYEAkhBSABQSBqIgEgA00NAAsgACAFNwMgIAAgBjcDGCAAIAc3AxAgACAINwMICyABIAJPDQEgAEEoaiABIAIgAWsiBBAgCyAAIAQ2AkgLCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQEBogAwVBun8LCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQCxogAwVBun8LC6gCAQZ/IwBBEGsiByQAIABB2OABaikDAEKAgIAQViEIQbh/IQUCQCAEQf//B0sNACAAIAMgBBBCIgUQAyIGDQAgACgCnOIBIQkgACAHQQxqIAMgAyAFaiAGGyIKIARBACAFIAYbayIGEEAiAxADBEAgAyEFDAELIAcoAgwhBCABRQRAQbp/IQUgBEEASg0BCyAGIANrIQUgAyAKaiEDAkAgCQRAIABBADYCnOIBDAELAkACQAJAIARBBUgNACAAQdjgAWopAwBCgICACFgNAAwBCyAAQQA2ApziAQwBCyAAKAIIED8hBiAAQQA2ApziASAGQRRPDQELIAAgASACIAMgBSAEIAgQOSEFDAELIAAgASACIAMgBSAEIAgQOiEFCyAHQRBqJAAgBQtnACAAQdDgAWogASACIAAoAuzhARAuIgEQAwRAIAEPC0G4fyECAkAgAQ0AIABB7OABaigCACIBBEBBYCECIAAoApjiASABRw0BC0EAIQIgAEHw4AFqKAIARQ0AIABBkOEBahBDCyACCycBAX8QVyIERQRAQUAPCyAEIAAgASACIAMgBBBLEE8hACAEEFYgAAs/AQF/AkACQAJAIAAoAqDiAUEBaiIBQQJLDQAgAUEBaw4CAAECCyAAEDBBAA8LIABBADYCoOIBCyAAKAKU4gELvAMCB38BfiMAQRBrIgkkAEG4fyEGAkAgBCgCACIIQQVBCSAAKALs4QEiBRtJDQAgAygCACIHQQFBBSAFGyAFEC8iBRADBEAgBSEGDAELIAggBUEDakkNACAAIAcgBRBJIgYQAw0AIAEgAmohCiAAQZDhAWohCyAIIAVrIQIgBSAHaiEHIAEhBQNAIAcgAiAJECwiBhADDQEgAkF9aiICIAZJBEBBuH8hBgwCCyAJKAIAIghBAksEQEFsIQYMAgsgB0EDaiEHAn8CQAJAAkAgCEEBaw4CAgABCyAAIAUgCiAFayAHIAYQSAwCCyAFIAogBWsgByAGEEcMAQsgBSAKIAVrIActAAAgCSgCCBBGCyIIEAMEQCAIIQYMAgsgACgC8OABBEAgCyAFIAgQRQsgAiAGayECIAYgB2ohByAFIAhqIQUgCSgCBEUNAAsgACkD0OABIgxCf1IEQEFsIQYgDCAFIAFrrFINAQsgACgC8OABBEBBaiEGIAJBBEkNASALEEQhDCAHKAAAIAynRw0BIAdBBGohByACQXxqIQILIAMgBzYCACAEIAI2AgAgBSABayEGCyAJQRBqJAAgBgsuACAAECsCf0EAQQAQAw0AGiABRSACRXJFBEBBYiAAIAEgAhA9EAMNARoLQQALCzcAIAEEQCAAIAAoAsTgASABKAIEIAEoAghqRzYCnOIBCyAAECtBABADIAFFckUEQCAAIAEQWwsL0QIBB38jAEEQayIGJAAgBiAENgIIIAYgAzYCDCAFBEAgBSgCBCEKIAUoAgghCQsgASEIAkACQANAIAAoAuzhARAWIQsCQANAIAQgC0kNASADKAAAQXBxQdDUtMIBRgRAIAMgBBAiIgcQAw0EIAQgB2shBCADIAdqIQMMAQsLIAYgAzYCDCAGIAQ2AggCQCAFBEAgACAFEE5BACEHQQAQA0UNAQwFCyAAIAogCRBNIgcQAw0ECyAAIAgQUCAMQQFHQQAgACAIIAIgBkEMaiAGQQhqEEwiByIDa0EAIAMQAxtBCkdyRQRAQbh/IQcMBAsgBxADDQMgAiAHayECIAcgCGohCEEBIQwgBigCDCEDIAYoAgghBAwBCwsgBiADNgIMIAYgBDYCCEG4fyEHIAQNASAIIAFrIQcMAQsgBiADNgIMIAYgBDYCCAsgBkEQaiQAIAcLRgECfyABIAAoArjgASICRwRAIAAgAjYCxOABIAAgATYCuOABIAAoArzgASEDIAAgATYCvOABIAAgASADIAJrajYCwOABCwutAgIEfwF+IwBBQGoiBCQAAkACQCACQQhJDQAgASgAAEFwcUHQ1LTCAUcNACABIAIQIiEBIABCADcDCCAAQQA2AgQgACABNgIADAELIARBGGogASACEC0iAxADBEAgACADEBoMAQsgAwRAIABBuH8QGgwBCyACIAQoAjAiA2shAiABIANqIQMDQAJAIAAgAyACIARBCGoQLCIFEAMEfyAFBSACIAVBA2oiBU8NAUG4fwsQGgwCCyAGQQFqIQYgAiAFayECIAMgBWohAyAEKAIMRQ0ACyAEKAI4BEAgAkEDTQRAIABBuH8QGgwCCyADQQRqIQMLIAQoAighAiAEKQMYIQcgAEEANgIEIAAgAyABazYCACAAIAIgBmytIAcgB0J/URs3AwgLIARBQGskAAslAQF/IwBBEGsiAiQAIAIgACABEFEgAigCACEAIAJBEGokACAAC30BBH8jAEGQBGsiBCQAIARB/wE2AggCQCAEQRBqIARBCGogBEEMaiABIAIQFSIGEAMEQCAGIQUMAQtBVCEFIAQoAgwiB0EGSw0AIAMgBEEQaiAEKAIIIAcQQSIFEAMNACAAIAEgBmogAiAGayADEDwhBQsgBEGQBGokACAFC4cBAgJ/An5BABAWIQMCQANAIAEgA08EQAJAIAAoAABBcHFB0NS0wgFGBEAgACABECIiAhADRQ0BQn4PCyAAIAEQVSIEQn1WDQMgBCAFfCIFIARUIQJCfiEEIAINAyAAIAEQUiICEAMNAwsgASACayEBIAAgAmohAAwBCwtCfiAFIAEbIQQLIAQLPwIBfwF+IwBBMGsiAiQAAn5CfiACQQhqIAAgARAtDQAaQgAgAigCHEEBRg0AGiACKQMICyEDIAJBMGokACADC40BAQJ/IwBBMGsiASQAAkAgAEUNACAAKAKI4gENACABIABB/OEBaigCADYCKCABIAApAvThATcDICAAEDAgACgCqOIBIQIgASABKAIoNgIYIAEgASkDIDcDECACIAFBEGoQGyAAQQA2AqjiASABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALKgECfyMAQRBrIgAkACAAQQA2AgggAEIANwMAIAAQWCEBIABBEGokACABC4cBAQN/IwBBEGsiAiQAAkAgACgCAEUgACgCBEVzDQAgAiAAKAIINgIIIAIgACkCADcDAAJ/IAIoAgAiAQRAIAIoAghBqOMJIAERBQAMAQtBqOMJECgLIgFFDQAgASAAKQIANwL04QEgAUH84QFqIAAoAgg2AgAgARBZIAEhAwsgAkEQaiQAIAMLywEBAn8jAEEgayIBJAAgAEGBgIDAADYCtOIBIABBADYCiOIBIABBADYC7OEBIABCADcDkOIBIABBADYCpOMJIABBADYC3OIBIABCADcCzOIBIABBADYCvOIBIABBADYCxOABIABCADcCnOIBIABBpOIBakIANwIAIABBrOIBakEANgIAIAFCADcCECABQgA3AhggASABKQMYNwMIIAEgASkDEDcDACABKAIIQQh2QQFxIQIgAEEANgLg4gEgACACNgKM4gEgAUEgaiQAC3YBA38jAEEwayIBJAAgAARAIAEgAEHE0AFqIgIoAgA2AiggASAAKQK80AE3AyAgACgCACEDIAEgAigCADYCGCABIAApArzQATcDECADIAFBEGoQGyABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALzAEBAX8gACABKAK00AE2ApjiASAAIAEoAgQiAjYCwOABIAAgAjYCvOABIAAgAiABKAIIaiICNgK44AEgACACNgLE4AEgASgCuNABBEAgAEKBgICAEDcDiOEBIAAgAUGk0ABqNgIMIAAgAUGUIGo2AgggACABQZwwajYCBCAAIAFBDGo2AgAgAEGs0AFqIAFBqNABaigCADYCACAAQbDQAWogAUGs0AFqKAIANgIAIABBtNABaiABQbDQAWooAgA2AgAPCyAAQgA3A4jhAQs7ACACRQRAQbp/DwsgBEUEQEFsDwsgAiAEEGAEQCAAIAEgAiADIAQgBRBhDwsgACABIAIgAyAEIAUQZQtGAQF/IwBBEGsiBSQAIAVBCGogBBAOAn8gBS0ACQRAIAAgASACIAMgBBAyDAELIAAgASACIAMgBBA0CyEAIAVBEGokACAACzQAIAAgAyAEIAUQNiIFEAMEQCAFDwsgBSAESQR/IAEgAiADIAVqIAQgBWsgABA1BUG4fwsLRgEBfyMAQRBrIgUkACAFQQhqIAQQDgJ/IAUtAAkEQCAAIAEgAiADIAQQYgwBCyAAIAEgAiADIAQQNQshACAFQRBqJAAgAAtZAQF/QQ8hAiABIABJBEAgAUEEdCAAbiECCyAAQQh2IgEgAkEYbCIAQYwIaigCAGwgAEGICGooAgBqIgJBA3YgAmogAEGACGooAgAgAEGECGooAgAgAWxqSQs3ACAAIAMgBCAFQYAQEDMiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQMgVBuH8LC78DAQN/IwBBIGsiBSQAIAVBCGogAiADEAYiAhADRQRAIAAgAWoiB0F9aiEGIAUgBBAOIARBBGohAiAFLQACIQMDQEEAIAAgBkkgBUEIahAEGwRAIAAgAiAFQQhqIAMQAkECdGoiBC8BADsAACAFQQhqIAQtAAIQASAAIAQtAANqIgQgAiAFQQhqIAMQAkECdGoiAC8BADsAACAFQQhqIAAtAAIQASAEIAAtAANqIQAMAQUgB0F+aiEEA0AgBUEIahAEIAAgBEtyRQRAIAAgAiAFQQhqIAMQAkECdGoiBi8BADsAACAFQQhqIAYtAAIQASAAIAYtAANqIQAMAQsLA0AgACAES0UEQCAAIAIgBUEIaiADEAJBAnRqIgYvAQA7AAAgBUEIaiAGLQACEAEgACAGLQADaiEADAELCwJAIAAgB08NACAAIAIgBUEIaiADEAIiA0ECdGoiAC0AADoAACAALQADQQFGBEAgBUEIaiAALQACEAEMAQsgBSgCDEEfSw0AIAVBCGogAiADQQJ0ai0AAhABIAUoAgxBIUkNACAFQSA2AgwLIAFBbCAFQQhqEAobIQILCwsgBUEgaiQAIAILkgIBBH8jAEFAaiIJJAAgCSADQTQQCyEDAkAgBEECSA0AIAMgBEECdGooAgAhCSADQTxqIAgQIyADQQE6AD8gAyACOgA+QQAhBCADKAI8IQoDQCAEIAlGDQEgACAEQQJ0aiAKNgEAIARBAWohBAwAAAsAC0EAIQkDQCAGIAlGRQRAIAMgBSAJQQF0aiIKLQABIgtBAnRqIgwoAgAhBCADQTxqIAotAABBCHQgCGpB//8DcRAjIANBAjoAPyADIAcgC2siCiACajoAPiAEQQEgASAKa3RqIQogAygCPCELA0AgACAEQQJ0aiALNgEAIARBAWoiBCAKSQ0ACyAMIAo2AgAgCUEBaiEJDAELCyADQUBrJAALowIBCX8jAEHQAGsiCSQAIAlBEGogBUE0EAsaIAcgBmshDyAHIAFrIRADQAJAIAMgCkcEQEEBIAEgByACIApBAXRqIgYtAAEiDGsiCGsiC3QhDSAGLQAAIQ4gCUEQaiAMQQJ0aiIMKAIAIQYgCyAPTwRAIAAgBkECdGogCyAIIAUgCEE0bGogCCAQaiIIQQEgCEEBShsiCCACIAQgCEECdGooAgAiCEEBdGogAyAIayAHIA4QYyAGIA1qIQgMAgsgCUEMaiAOECMgCUEBOgAPIAkgCDoADiAGIA1qIQggCSgCDCELA0AgBiAITw0CIAAgBkECdGogCzYBACAGQQFqIQYMAAALAAsgCUHQAGokAA8LIAwgCDYCACAKQQFqIQoMAAALAAs0ACAAIAMgBCAFEDYiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQNAVBuH8LCyMAIAA/AEEQdGtB//8DakEQdkAAQX9GBEBBAA8LQQAQAEEBCzsBAX8gAgRAA0AgACABIAJBgCAgAkGAIEkbIgMQCyEAIAFBgCBqIQEgAEGAIGohACACIANrIgINAAsLCwYAIAAQAwsLqBUJAEGICAsNAQAAAAEAAAACAAAAAgBBoAgLswYBAAAAAQAAAAIAAAACAAAAJgAAAIIAAAAhBQAASgAAAGcIAAAmAAAAwAEAAIAAAABJBQAASgAAAL4IAAApAAAALAIAAIAAAABJBQAASgAAAL4IAAAvAAAAygIAAIAAAACKBQAASgAAAIQJAAA1AAAAcwMAAIAAAACdBQAASgAAAKAJAAA9AAAAgQMAAIAAAADrBQAASwAAAD4KAABEAAAAngMAAIAAAABNBgAASwAAAKoKAABLAAAAswMAAIAAAADBBgAATQAAAB8NAABNAAAAUwQAAIAAAAAjCAAAUQAAAKYPAABUAAAAmQQAAIAAAABLCQAAVwAAALESAABYAAAA2gQAAIAAAABvCQAAXQAAACMUAABUAAAARQUAAIAAAABUCgAAagAAAIwUAABqAAAArwUAAIAAAAB2CQAAfAAAAE4QAAB8AAAA0gIAAIAAAABjBwAAkQAAAJAHAACSAAAAAAAAAAEAAAABAAAABQAAAA0AAAAdAAAAPQAAAH0AAAD9AAAA/QEAAP0DAAD9BwAA/Q8AAP0fAAD9PwAA/X8AAP3/AAD9/wEA/f8DAP3/BwD9/w8A/f8fAP3/PwD9/38A/f//AP3//wH9//8D/f//B/3//w/9//8f/f//P/3//38AAAAAAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABEAAAASAAAAEwAAABQAAAAVAAAAFgAAABcAAAAYAAAAGQAAABoAAAAbAAAAHAAAAB0AAAAeAAAAHwAAAAMAAAAEAAAABQAAAAYAAAAHAAAACAAAAAkAAAAKAAAACwAAAAwAAAANAAAADgAAAA8AAAAQAAAAEQAAABIAAAATAAAAFAAAABUAAAAWAAAAFwAAABgAAAAZAAAAGgAAABsAAAAcAAAAHQAAAB4AAAAfAAAAIAAAACEAAAAiAAAAIwAAACUAAAAnAAAAKQAAACsAAAAvAAAAMwAAADsAAABDAAAAUwAAAGMAAACDAAAAAwEAAAMCAAADBAAAAwgAAAMQAAADIAAAA0AAAAOAAAADAAEAQeAPC1EBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAEAAAABQAAAAcAAAAIAAAACQAAAAoAAAALAAAADAAAAA0AAAAOAAAADwAAABAAQcQQC4sBAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABIAAAAUAAAAFgAAABgAAAAcAAAAIAAAACgAAAAwAAAAQAAAAIAAAAAAAQAAAAIAAAAEAAAACAAAABAAAAAgAAAAQAAAAIAAAAAAAQBBkBIL5gQBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAAAEAAAAEAAAACAAAAAAAAAABAAEBBgAAAAAAAAQAAAAAEAAABAAAAAAgAAAFAQAAAAAAAAUDAAAAAAAABQQAAAAAAAAFBgAAAAAAAAUHAAAAAAAABQkAAAAAAAAFCgAAAAAAAAUMAAAAAAAABg4AAAAAAAEFEAAAAAAAAQUUAAAAAAABBRYAAAAAAAIFHAAAAAAAAwUgAAAAAAAEBTAAAAAgAAYFQAAAAAAABwWAAAAAAAAIBgABAAAAAAoGAAQAAAAADAYAEAAAIAAABAAAAAAAAAAEAQAAAAAAAAUCAAAAIAAABQQAAAAAAAAFBQAAACAAAAUHAAAAAAAABQgAAAAgAAAFCgAAAAAAAAULAAAAAAAABg0AAAAgAAEFEAAAAAAAAQUSAAAAIAABBRYAAAAAAAIFGAAAACAAAwUgAAAAAAADBSgAAAAAAAYEQAAAABAABgRAAAAAIAAHBYAAAAAAAAkGAAIAAAAACwYACAAAMAAABAAAAAAQAAAEAQAAACAAAAUCAAAAIAAABQMAAAAgAAAFBQAAACAAAAUGAAAAIAAABQgAAAAgAAAFCQAAACAAAAULAAAAIAAABQwAAAAAAAAGDwAAACAAAQUSAAAAIAABBRQAAAAgAAIFGAAAACAAAgUcAAAAIAADBSgAAAAgAAQFMAAAAAAAEAYAAAEAAAAPBgCAAAAAAA4GAEAAAAAADQYAIABBgBcLhwIBAAEBBQAAAAAAAAUAAAAAAAAGBD0AAAAAAAkF/QEAAAAADwX9fwAAAAAVBf3/HwAAAAMFBQAAAAAABwR9AAAAAAAMBf0PAAAAABIF/f8DAAAAFwX9/38AAAAFBR0AAAAAAAgE/QAAAAAADgX9PwAAAAAUBf3/DwAAAAIFAQAAABAABwR9AAAAAAALBf0HAAAAABEF/f8BAAAAFgX9/z8AAAAEBQ0AAAAQAAgE/QAAAAAADQX9HwAAAAATBf3/BwAAAAEFAQAAABAABgQ9AAAAAAAKBf0DAAAAABAF/f8AAAAAHAX9//8PAAAbBf3//wcAABoF/f//AwAAGQX9//8BAAAYBf3//wBBkBkLhgQBAAEBBgAAAAAAAAYDAAAAAAAABAQAAAAgAAAFBQAAAAAAAAUGAAAAAAAABQgAAAAAAAAFCQAAAAAAAAULAAAAAAAABg0AAAAAAAAGEAAAAAAAAAYTAAAAAAAABhYAAAAAAAAGGQAAAAAAAAYcAAAAAAAABh8AAAAAAAAGIgAAAAAAAQYlAAAAAAABBikAAAAAAAIGLwAAAAAAAwY7AAAAAAAEBlMAAAAAAAcGgwAAAAAACQYDAgAAEAAABAQAAAAAAAAEBQAAACAAAAUGAAAAAAAABQcAAAAgAAAFCQAAAAAAAAUKAAAAAAAABgwAAAAAAAAGDwAAAAAAAAYSAAAAAAAABhUAAAAAAAAGGAAAAAAAAAYbAAAAAAAABh4AAAAAAAAGIQAAAAAAAQYjAAAAAAABBicAAAAAAAIGKwAAAAAAAwYzAAAAAAAEBkMAAAAAAAUGYwAAAAAACAYDAQAAIAAABAQAAAAwAAAEBAAAABAAAAQFAAAAIAAABQcAAAAgAAAFCAAAACAAAAUKAAAAIAAABQsAAAAAAAAGDgAAAAAAAAYRAAAAAAAABhQAAAAAAAAGFwAAAAAAAAYaAAAAAAAABh0AAAAAAAAGIAAAAAAAEAYDAAEAAAAPBgOAAAAAAA4GA0AAAAAADQYDIAAAAAAMBgMQAAAAAAsGAwgAAAAACgYDBABBpB0L2QEBAAAAAwAAAAcAAAAPAAAAHwAAAD8AAAB/AAAA/wAAAP8BAAD/AwAA/wcAAP8PAAD/HwAA/z8AAP9/AAD//wAA//8BAP//AwD//wcA//8PAP//HwD//z8A//9/AP///wD///8B////A////wf///8P////H////z////9/AAAAAAEAAAACAAAABAAAAAAAAAACAAAABAAAAAgAAAAAAAAAAQAAAAIAAAABAAAABAAAAAQAAAAEAAAABAAAAAgAAAAIAAAACAAAAAcAAAAIAAAACQAAAAoAAAALAEGgIAsDwBBQ";class ehe extends gp{constructor(e,t,n){super(void 0,e[0].width,e[0].height,t,n,_u),this.isCompressedCubeTexture=!0,this.isCubeTexture=!0,this.image=e}}class the extends gp{constructor(e,t,n,r,s,o){super(e,t,n,s,o),this.isCompressedArrayTexture=!0,this.image.depth=r,this.wrapR=ji}}var nhe=Object.defineProperty,ihe=(i,e,t)=>e in i?nhe(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,B3=(i,e,t)=>(ihe(i,typeof e!="symbol"?e+"":e,t),t);const BH=3e3,DH=3001,G9="",rhe="display-p3",she="display-p3-linear",ohe="srgb-linear",TR="srgb",ib=new WeakMap;let rb=0,sb;const bR=(()=>{const i=class extends os{constructor(t){super(t),this.transcoderPath="",this.transcoderBinary=null,this.transcoderPending=null,this.workerPool=new Gue,this.workerSourceURL="",this.workerConfig=null,typeof MSC_TRANSCODER<"u"&&console.warn('THREE.KTX2Loader: Please update to latest "basis_transcoder". "msc_basis_transcoder" is no longer supported in three.js r125+.')}setTranscoderPath(t){return this.transcoderPath=t,this}setWorkerLimit(t){return this.workerPool.setWorkerLimit(t),this}detectSupport(t){return this.workerConfig={astcSupported:t.extensions.has("WEBGL_compressed_texture_astc"),etc1Supported:t.extensions.has("WEBGL_compressed_texture_etc1"),etc2Supported:t.extensions.has("WEBGL_compressed_texture_etc"),dxtSupported:t.extensions.has("WEBGL_compressed_texture_s3tc"),bptcSupported:t.extensions.has("EXT_texture_compression_bptc"),pvrtcSupported:t.extensions.has("WEBGL_compressed_texture_pvrtc")||t.extensions.has("WEBKIT_WEBGL_compressed_texture_pvrtc")},t.capabilities.isWebGL2&&(this.workerConfig.etc1Supported=!1),this}init(){if(!this.transcoderPending){const t=new $r(this.manager);t.setPath(this.transcoderPath),t.setWithCredentials(this.withCredentials);const n=t.loadAsync("basis_transcoder.js"),r=new $r(this.manager);r.setPath(this.transcoderPath),r.setResponseType("arraybuffer"),r.setWithCredentials(this.withCredentials);const s=r.loadAsync("basis_transcoder.wasm");this.transcoderPending=Promise.all([n,s]).then(([o,a])=>{const l=i.BasisWorker.toString(),c=["/* constants */","let _EngineFormat = "+JSON.stringify(i.EngineFormat),"let _TranscoderFormat = "+JSON.stringify(i.TranscoderFormat),"let _BasisFormat = "+JSON.stringify(i.BasisFormat),"/* basis_transcoder.js */",o,"/* worker */",l.substring(l.indexOf("{")+1,l.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([c])),this.transcoderBinary=a,this.workerPool.setWorkerCreator(()=>{const u=new Worker(this.workerSourceURL),h=this.transcoderBinary.slice(0);return u.postMessage({type:"init",config:this.workerConfig,transcoderBinary:h},[h]),u})}),rb>0&&console.warn("THREE.KTX2Loader: Multiple active KTX2 loaders may cause performance issues. Use a single KTX2Loader instance, or call .dispose() on old instances."),rb++}return this.transcoderPending}load(t,n,r,s){if(this.workerConfig===null)throw new Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");const o=new $r(this.manager);o.setResponseType("arraybuffer"),o.setWithCredentials(this.withCredentials),o.load(t,a=>{if(ib.has(a))return ib.get(a).promise.then(n).catch(s);this._createTexture(a).then(l=>n?n(l):null).catch(s)},r,s)}_createTextureFrom(t,n){const{faces:r,width:s,height:o,format:a,type:l,error:c,dfdFlags:u}=t;if(l==="error")return Promise.reject(c);let h;if(n.faceCount===6)h=new ehe(r,a,Zi);else{const d=r[0].mipmaps;h=n.layerCount>1?new the(d,s,o,n.layerCount,a,Zi):new gp(d,s,o,a,Zi)}h.minFilter=r[0].mipmaps.length===1?Pn:Bl,h.magFilter=Pn,h.generateMipmaps=!1,h.needsUpdate=!0;const f=kH(n);return"colorSpace"in h?h.colorSpace=f:h.encoding=f===TR?DH:BH,h.premultiplyAlpha=!!(u&Kue),h}async _createTexture(t,n={}){const r=Jue(new Uint8Array(t));if(r.vkFormat!==yH)return lhe(r);const s=n,o=this.init().then(()=>this.workerPool.postMessage({type:"transcode",buffer:t,taskConfig:s},[t])).then(a=>this._createTextureFrom(a.data,r));return ib.set(t,{promise:o}),o}dispose(){return this.workerPool.dispose(),this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),rb--,this}};let e=i;return B3(e,"BasisFormat",{ETC1S:0,UASTC_4x4:1}),B3(e,"TranscoderFormat",{ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16}),B3(e,"EngineFormat",{RGBAFormat:gi,RGBA_ASTC_4x4_Format:SS,RGBA_BPTC_Format:Kv,RGBA_ETC2_EAC_Format:_S,RGBA_PVRTC_4BPPV1_Format:xS,RGBA_S3TC_DXT5_Format:jv,RGB_ETC1_Format:vw,RGB_ETC2_Format:ES,RGB_PVRTC_4BPPV1_Format:vS,RGB_S3TC_DXT1_Format:Wv}),B3(e,"BasisWorker",function(){let t,n,r;const s=_EngineFormat,o=_TranscoderFormat,a=_BasisFormat;self.addEventListener("message",function(g){const y=g.data;switch(y.type){case"init":t=y.config,l(y.transcoderBinary);break;case"transcode":n.then(()=>{try{const{faces:E,buffers:x,width:C,height:T,hasAlpha:I,format:M,dfdFlags:L}=c(y.buffer);self.postMessage({type:"transcode",id:y.id,faces:E,width:C,height:T,hasAlpha:I,format:M,dfdFlags:L},x)}catch(E){console.error(E),self.postMessage({type:"error",id:y.id,error:E.message})}});break}});function l(g){n=new Promise(y=>{r={wasmBinary:g,onRuntimeInitialized:y},BASIS(r)}).then(()=>{r.initializeBasis(),r.KTX2File===void 0&&console.warn("THREE.KTX2Loader: Please update Basis Universal transcoder.")})}function c(g){const y=new r.KTX2File(new Uint8Array(g));function E(){y.close(),y.delete()}if(!y.isValid())throw E(),new Error("THREE.KTX2Loader:	Invalid or unsupported .ktx2 file");const x=y.isUASTC()?a.UASTC_4x4:a.ETC1S,C=y.getWidth(),T=y.getHeight(),I=y.getLayers()||1,M=y.getLevels(),L=y.getFaces(),R=y.getHasAlpha(),P=y.getDFDFlags(),{transcoderFormat:F,engineFormat:k}=d(x,C,T,R);if(!C||!T||!M)throw E(),new Error("THREE.KTX2Loader:	Invalid texture");if(!y.startTranscoding())throw E(),new Error("THREE.KTX2Loader: .startTranscoding failed");const z=[],U=[];for(let W=0;W<L;W++){const $=[];for(let oe=0;oe<M;oe++){const X=[];let Q,Y;for(let K=0;K<I;K++){const te=y.getImageLevelInfo(oe,K,W);W===0&&oe===0&&K===0&&(te.origWidth%4!==0||te.origHeight%4!==0)&&console.warn("THREE.KTX2Loader: ETC1S and UASTC textures should use multiple-of-four dimensions."),M>1?(Q=te.origWidth,Y=te.origHeight):(Q=te.width,Y=te.height);const q=new Uint8Array(y.getImageTranscodedSizeInBytes(oe,K,0,F));if(!y.transcodeImage(q,oe,K,W,F,0,-1,-1))throw E(),new Error("THREE.KTX2Loader: .transcodeImage failed.");X.push(q)}const O=A(X);$.push({data:O,width:Q,height:Y}),U.push(O.buffer)}z.push({mipmaps:$,width:C,height:T,format:k})}return E(),{faces:z,buffers:U,width:C,height:T,hasAlpha:R,format:k,dfdFlags:P}}const u=[{if:"astcSupported",basisFormat:[a.UASTC_4x4],transcoderFormat:[o.ASTC_4x4,o.ASTC_4x4],engineFormat:[s.RGBA_ASTC_4x4_Format,s.RGBA_ASTC_4x4_Format],priorityETC1S:1/0,priorityUASTC:1,needsPowerOfTwo:!1},{if:"bptcSupported",basisFormat:[a.ETC1S,a.UASTC_4x4],transcoderFormat:[o.BC7_M5,o.BC7_M5],engineFormat:[s.RGBA_BPTC_Format,s.RGBA_BPTC_Format],priorityETC1S:3,priorityUASTC:2,needsPowerOfTwo:!1},{if:"dxtSupported",basisFormat:[a.ETC1S,a.UASTC_4x4],transcoderFormat:[o.BC1,o.BC3],engineFormat:[s.RGB_S3TC_DXT1_Format,s.RGBA_S3TC_DXT5_Format],priorityETC1S:4,priorityUASTC:5,needsPowerOfTwo:!1},{if:"etc2Supported",basisFormat:[a.ETC1S,a.UASTC_4x4],transcoderFormat:[o.ETC1,o.ETC2],engineFormat:[s.RGB_ETC2_Format,s.RGBA_ETC2_EAC_Format],priorityETC1S:1,priorityUASTC:3,needsPowerOfTwo:!1},{if:"etc1Supported",basisFormat:[a.ETC1S,a.UASTC_4x4],transcoderFormat:[o.ETC1],engineFormat:[s.RGB_ETC1_Format],priorityETC1S:2,priorityUASTC:4,needsPowerOfTwo:!1},{if:"pvrtcSupported",basisFormat:[a.ETC1S,a.UASTC_4x4],transcoderFormat:[o.PVRTC1_4_RGB,o.PVRTC1_4_RGBA],engineFormat:[s.RGB_PVRTC_4BPPV1_Format,s.RGBA_PVRTC_4BPPV1_Format],priorityETC1S:5,priorityUASTC:6,needsPowerOfTwo:!0}],h=u.sort(function(g,y){return g.priorityETC1S-y.priorityETC1S}),f=u.sort(function(g,y){return g.priorityUASTC-y.priorityUASTC});function d(g,y,E,x){let C,T;const I=g===a.ETC1S?h:f;for(let M=0;M<I.length;M++){const L=I[M];if(t[L.if]&&L.basisFormat.includes(g)&&!(x&&L.transcoderFormat.length<2)&&!(L.needsPowerOfTwo&&!(m(y)&&m(E))))return C=L.transcoderFormat[x?1:0],T=L.engineFormat[x?1:0],{transcoderFormat:C,engineFormat:T}}return console.warn("THREE.KTX2Loader: No suitable compressed texture format found. Decoding to RGBA32."),C=o.RGBA32,T=s.RGBAFormat,{transcoderFormat:C,engineFormat:T}}function m(g){return g<=2?!0:(g&g-1)===0&&g!==0}function A(g){if(g.length===1)return g[0];let y=0;for(let C=0;C<g.length;C++){const T=g[C];y+=T.byteLength}const E=new Uint8Array(y);let x=0;for(let C=0;C<g.length;C++){const T=g[C];E.set(T,x),x+=T.byteLength}return E}}),e})(),ahe=new Set([gi,Gd,hc]),ob={[RH]:gi,[bH]:gi,[SH]:gi,[wH]:gi,[MH]:Gd,[TH]:Gd,[EH]:Gd,[_H]:Gd,[IH]:hc,[CH]:hc,[xH]:hc,[vH]:hc,[PH]:_2,[LH]:_2},ab={[RH]:fi,[bH]:Ni,[SH]:Zi,[wH]:Zi,[MH]:fi,[TH]:Ni,[EH]:Zi,[_H]:Zi,[IH]:fi,[CH]:Ni,[xH]:Zi,[vH]:Zi,[PH]:Zi,[LH]:Zi};async function lhe(i){const{vkFormat:e}=i;if(ob[e]===void 0)throw new Error("THREE.KTX2Loader: Unsupported vkFormat.");let t;i.supercompressionScheme===N9&&(sb||(sb=new Promise(async o=>{const a=new Zue;await a.init(),o(a)})),t=await sb);const n=[];for(let o=0;o<i.levels.length;o++){const a=Math.max(1,i.pixelWidth>>o),l=Math.max(1,i.pixelHeight>>o),c=i.pixelDepth?Math.max(1,i.pixelDepth>>o):0,u=i.levels[o];let h;if(i.supercompressionScheme===gH)h=u.levelData;else if(i.supercompressionScheme===N9)h=t.decode(u.levelData,u.uncompressedByteLength);else throw new Error("THREE.KTX2Loader: Unsupported supercompressionScheme.");let f;ab[e]===fi?f=new Float32Array(h.buffer,h.byteOffset,h.byteLength/Float32Array.BYTES_PER_ELEMENT):ab[e]===Ni?f=new Uint16Array(h.buffer,h.byteOffset,h.byteLength/Uint16Array.BYTES_PER_ELEMENT):f=h,n.push({data:f,width:a,height:l,depth:c})}let r;if(ahe.has(ob[e]))r=i.pixelDepth===0?new Sa(n[0].data,i.pixelWidth,i.pixelHeight):new zue(n[0].data,i.pixelWidth,i.pixelHeight,i.pixelDepth);else{if(i.pixelDepth>0)throw new Error("THREE.KTX2Loader: Unsupported pixelDepth.");r=new gp(n,i.pixelWidth,i.pixelHeight)}r.mipmaps=n,r.type=ab[e],r.format=ob[e],r.needsUpdate=!0;const s=kH(i);return"colorSpace"in r?r.colorSpace=s:r.encoding=s===TR?DH:BH,Promise.resolve(r)}function kH(i){const e=i.dataFormatDescriptor[0];return e.colorPrimaries===AH?e.transferFunction===r5?TR:ohe:e.colorPrimaries===Yue?e.transferFunction===r5?rhe:she:(e.colorPrimaries===$ue||console.warn(`THREE.KTX2Loader: Unsupported color primaries, "${e.colorPrimaries}"`),G9)}class che extends Q6{constructor(e){super(e),this.type=Ni}parse(e){const o=function(L,R){switch(L){case 1:throw new Error("THREE.RGBELoader: Read Error: "+(R||""));case 2:throw new Error("THREE.RGBELoader: Write Error: "+(R||""));case 3:throw new Error("THREE.RGBELoader: Bad File Format: "+(R||""));default:case 4:throw new Error("THREE.RGBELoader: Memory Error: "+(R||""))}},h=function(L,R,P){R=R||1024;let k=L.pos,z=-1,U=0,W="",$=String.fromCharCode.apply(null,new Uint16Array(L.subarray(k,k+128)));for(;0>(z=$.indexOf(`
`))&&U<R&&k<L.byteLength;)W+=$,U+=$.length,k+=128,$+=String.fromCharCode.apply(null,new Uint16Array(L.subarray(k,k+128)));return-1<z?(L.pos+=U+z+1,W+$.slice(0,z)):!1},f=function(L){const R=/^#\?(\S+)/,P=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,F=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,k=/^\s*FORMAT=(\S+)\s*$/,z=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,U={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let W,$;for((L.pos>=L.byteLength||!(W=h(L)))&&o(1,"no header found"),($=W.match(R))||o(3,"bad initial token"),U.valid|=1,U.programtype=$[1],U.string+=W+`
`;W=h(L),W!==!1;){if(U.string+=W+`
`,W.charAt(0)==="#"){U.comments+=W+`
`;continue}if(($=W.match(P))&&(U.gamma=parseFloat($[1])),($=W.match(F))&&(U.exposure=parseFloat($[1])),($=W.match(k))&&(U.valid|=2,U.format=$[1]),($=W.match(z))&&(U.valid|=4,U.height=parseInt($[1],10),U.width=parseInt($[2],10)),U.valid&2&&U.valid&4)break}return U.valid&2||o(3,"missing format specifier"),U.valid&4||o(3,"missing image size specifier"),U},d=function(L,R,P){const F=R;if(F<8||F>32767||L[0]!==2||L[1]!==2||L[2]&128)return new Uint8Array(L);F!==(L[2]<<8|L[3])&&o(3,"wrong scanline width");const k=new Uint8Array(4*R*P);k.length||o(4,"unable to allocate buffer space");let z=0,U=0;const W=4*F,$=new Uint8Array(4),oe=new Uint8Array(W);let X=P;for(;X>0&&U<L.byteLength;){U+4>L.byteLength&&o(1),$[0]=L[U++],$[1]=L[U++],$[2]=L[U++],$[3]=L[U++],($[0]!=2||$[1]!=2||($[2]<<8|$[3])!=F)&&o(3,"bad rgbe scanline format");let Q=0,Y;for(;Q<W&&U<L.byteLength;){Y=L[U++];const K=Y>128;if(K&&(Y-=128),(Y===0||Q+Y>W)&&o(3,"bad scanline data"),K){const te=L[U++];for(let q=0;q<Y;q++)oe[Q++]=te}else oe.set(L.subarray(U,U+Y),Q),Q+=Y,U+=Y}const O=F;for(let K=0;K<O;K++){let te=0;k[z]=oe[K+te],te+=F,k[z+1]=oe[K+te],te+=F,k[z+2]=oe[K+te],te+=F,k[z+3]=oe[K+te],z+=4}X--}return k},m=function(L,R,P,F){const k=L[R+3],z=Math.pow(2,k-128)/255;P[F+0]=L[R+0]*z,P[F+1]=L[R+1]*z,P[F+2]=L[R+2]*z,P[F+3]=1},A=function(L,R,P,F){const k=L[R+3],z=Math.pow(2,k-128)/255;P[F+0]=Lm.toHalfFloat(Math.min(L[R+0]*z,65504)),P[F+1]=Lm.toHalfFloat(Math.min(L[R+1]*z,65504)),P[F+2]=Lm.toHalfFloat(Math.min(L[R+2]*z,65504)),P[F+3]=Lm.toHalfFloat(1)},g=new Uint8Array(e);g.pos=0;const y=f(g),E=y.width,x=y.height,C=d(g.subarray(g.pos),E,x);let T,I,M;switch(this.type){case fi:M=C.length/4;const L=new Float32Array(M*4);for(let P=0;P<M;P++)m(C,P*4,L,P*4);T=L,I=fi;break;case Ni:M=C.length/4;const R=new Uint16Array(M*4);for(let P=0;P<M;P++)A(C,P*4,R,P*4);T=R,I=Ni;break;default:throw new Error("THREE.RGBELoader: Unsupported type: "+this.type)}return{width:E,height:x,data:T,header:y.string,gamma:y.gamma,exposure:y.exposure,type:I}}setDataType(e){return this.type=e,this}load(e,t,n,r){function s(o,a){switch(o.type){case fi:case Ni:"colorSpace"in o?o.colorSpace="srgb-linear":o.encoding=3e3,o.minFilter=Pn,o.magFilter=Pn,o.generateMipmaps=!1,o.flipY=!0;break}t&&t(o,a)}return super.load(e,s,n,r)}}const av=TA>=152;class uhe extends Q6{constructor(e){super(e),this.type=Ni}parse(e){const R=Math.pow(2.7182818,2.2);function P(he,me){for(var ke=0,ue=0;ue<65536;++ue)(ue==0||he[ue>>3]&1<<(ue&7))&&(me[ke++]=ue);for(var ye=ke-1;ke<65536;)me[ke++]=0;return ye}function F(he){for(var me=0;me<16384;me++)he[me]={},he[me].len=0,he[me].lit=0,he[me].p=null}const k={l:0,c:0,lc:0};function z(he,me,ke,ue,ye){for(;ke<he;)me=me<<8|ft(ue,ye),ke+=8;ke-=he,k.l=me>>ke&(1<<he)-1,k.c=me,k.lc=ke}const U=new Array(59);function W(he){for(var me=0;me<=58;++me)U[me]=0;for(var me=0;me<65537;++me)U[he[me]]+=1;for(var ke=0,me=58;me>0;--me){var ue=ke+U[me]>>1;U[me]=ke,ke=ue}for(var me=0;me<65537;++me){var ye=he[me];ye>0&&(he[me]=ye|U[ye]++<<6)}}function $(he,me,ke,ue,ye,_e,Pe){for(var Me=ke,Je=0,st=0;ye<=_e;ye++){if(Me.value-ke.value>ue)return!1;z(6,Je,st,he,Me);var lt=k.l;if(Je=k.c,st=k.lc,Pe[ye]=lt,lt==63){if(Me.value-ke.value>ue)throw"Something wrong with hufUnpackEncTable";z(8,Je,st,he,Me);var Oe=k.l+6;if(Je=k.c,st=k.lc,ye+Oe>_e+1)throw"Something wrong with hufUnpackEncTable";for(;Oe--;)Pe[ye++]=0;ye--}else if(lt>=59){var Oe=lt-59+2;if(ye+Oe>_e+1)throw"Something wrong with hufUnpackEncTable";for(;Oe--;)Pe[ye++]=0;ye--}}W(Pe)}function oe(he){return he&63}function X(he){return he>>6}function Q(he,me,ke,ue){for(;me<=ke;me++){var ye=X(he[me]),_e=oe(he[me]);if(ye>>_e)throw"Invalid table entry";if(_e>14){var Pe=ue[ye>>_e-14];if(Pe.len)throw"Invalid table entry";if(Pe.lit++,Pe.p){var Me=Pe.p;Pe.p=new Array(Pe.lit);for(var Je=0;Je<Pe.lit-1;++Je)Pe.p[Je]=Me[Je]}else Pe.p=new Array(1);Pe.p[Pe.lit-1]=me}else if(_e)for(var st=0,Je=1<<14-_e;Je>0;Je--){var Pe=ue[(ye<<14-_e)+st];if(Pe.len||Pe.p)throw"Invalid table entry";Pe.len=_e,Pe.lit=me,st++}}return!0}const Y={c:0,lc:0};function O(he,me,ke,ue){he=he<<8|ft(ke,ue),me+=8,Y.c=he,Y.lc=me}const K={c:0,lc:0};function te(he,me,ke,ue,ye,_e,Pe,Me,Je,st){if(he==me){ue<8&&(O(ke,ue,ye,Pe),ke=Y.c,ue=Y.lc),ue-=8;var lt=ke>>ue,lt=new Uint8Array([lt])[0];if(Je.value+lt>st)return!1;for(var Oe=Me[Je.value-1];lt-- >0;)Me[Je.value++]=Oe}else if(Je.value<st)Me[Je.value++]=he;else return!1;K.c=ke,K.lc=ue}function q(he){return he&65535}function J(he){var me=q(he);return me>32767?me-65536:me}const ie={a:0,b:0};function re(he,me){var ke=J(he),ue=J(me),ye=ue,_e=ke+(ye&1)+(ye>>1),Pe=_e,Me=_e-ye;ie.a=Pe,ie.b=Me}function se(he,me){var ke=q(he),ue=q(me),ye=ke-(ue>>1)&65535,_e=ue+ye-32768&65535;ie.a=_e,ie.b=ye}function ge(he,me,ke,ue,ye,_e,Pe){for(var Me=Pe<16384,Je=ke>ye?ye:ke,st=1,lt;st<=Je;)st<<=1;for(st>>=1,lt=st,st>>=1;st>=1;){for(var Oe=0,Ht=Oe+_e*(ye-lt),xt=_e*st,Et=_e*lt,Qt=ue*st,sn=ue*lt,ln,vn,Dt,Bt;Oe<=Ht;Oe+=Et){for(var yn=Oe,xn=Oe+ue*(ke-lt);yn<=xn;yn+=sn){var Sn=yn+Qt,Ai=yn+xt,xi=Ai+Qt;Me?(re(he[yn+me],he[Ai+me]),ln=ie.a,Dt=ie.b,re(he[Sn+me],he[xi+me]),vn=ie.a,Bt=ie.b,re(ln,vn),he[yn+me]=ie.a,he[Sn+me]=ie.b,re(Dt,Bt),he[Ai+me]=ie.a,he[xi+me]=ie.b):(se(he[yn+me],he[Ai+me]),ln=ie.a,Dt=ie.b,se(he[Sn+me],he[xi+me]),vn=ie.a,Bt=ie.b,se(ln,vn),he[yn+me]=ie.a,he[Sn+me]=ie.b,se(Dt,Bt),he[Ai+me]=ie.a,he[xi+me]=ie.b)}if(ke&st){var Ai=yn+xt;Me?re(he[yn+me],he[Ai+me]):se(he[yn+me],he[Ai+me]),ln=ie.a,he[Ai+me]=ie.b,he[yn+me]=ln}}if(ye&st)for(var yn=Oe,xn=Oe+ue*(ke-lt);yn<=xn;yn+=sn){var Sn=yn+Qt;Me?re(he[yn+me],he[Sn+me]):se(he[yn+me],he[Sn+me]),ln=ie.a,he[Sn+me]=ie.b,he[yn+me]=ln}lt=st,st>>=1}return Oe}function xe(he,me,ke,ue,ye,_e,Pe,Me,Je,st){for(var lt=0,Oe=0,Ht=Me,xt=Math.trunc(ye.value+(_e+7)/8);ye.value<xt;)for(O(lt,Oe,ke,ye),lt=Y.c,Oe=Y.lc;Oe>=14;){var Et=lt>>Oe-14&16383,Qt=me[Et];if(Qt.len)Oe-=Qt.len,te(Qt.lit,Pe,lt,Oe,ke,ue,ye,Je,st,Ht),lt=K.c,Oe=K.lc;else{if(!Qt.p)throw"hufDecode issues";var sn;for(sn=0;sn<Qt.lit;sn++){for(var ln=oe(he[Qt.p[sn]]);Oe<ln&&ye.value<xt;)O(lt,Oe,ke,ye),lt=Y.c,Oe=Y.lc;if(Oe>=ln&&X(he[Qt.p[sn]])==(lt>>Oe-ln&(1<<ln)-1)){Oe-=ln,te(Qt.p[sn],Pe,lt,Oe,ke,ue,ye,Je,st,Ht),lt=K.c,Oe=K.lc;break}}if(sn==Qt.lit)throw"hufDecode issues"}}var vn=8-_e&7;for(lt>>=vn,Oe-=vn;Oe>0;){var Qt=me[lt<<14-Oe&16383];if(Qt.len)Oe-=Qt.len,te(Qt.lit,Pe,lt,Oe,ke,ue,ye,Je,st,Ht),lt=K.c,Oe=K.lc;else throw"hufDecode issues"}return!0}function pe(he,me,ke,ue,ye,_e){var Pe={value:0},Me=ke.value,Je=gt(me,ke),st=gt(me,ke);ke.value+=4;var lt=gt(me,ke);if(ke.value+=4,Je<0||Je>=65537||st<0||st>=65537)throw"Something wrong with HUF_ENCSIZE";var Oe=new Array(65537),Ht=new Array(16384);F(Ht);var xt=ue-(ke.value-Me);if($(he,me,ke,xt,Je,st,Oe),lt>8*(ue-(ke.value-Me)))throw"Something wrong with hufUncompress";Q(Oe,Je,st,Ht),xe(Oe,Ht,he,me,ke,lt,st,_e,ye,Pe)}function ce(he,me,ke){for(var ue=0;ue<ke;++ue)me[ue]=he[me[ue]]}function we(he){for(var me=1;me<he.length;me++){var ke=he[me-1]+he[me]-128;he[me]=ke}}function Ee(he,me){for(var ke=0,ue=Math.floor((he.length+1)/2),ye=0,_e=he.length-1;!(ye>_e||(me[ye++]=he[ke++],ye>_e));)me[ye++]=he[ue++]}function ve(he){for(var me=he.byteLength,ke=new Array,ue=0,ye=new DataView(he);me>0;){var _e=ye.getInt8(ue++);if(_e<0){var Pe=-_e;me-=Pe+1;for(var Me=0;Me<Pe;Me++)ke.push(ye.getUint8(ue++))}else{var Pe=_e;me-=2;for(var Je=ye.getUint8(ue++),Me=0;Me<Pe+1;Me++)ke.push(Je)}}return ke}function Ae(he,me,ke,ue,ye,_e){var Sn=new DataView(_e.buffer),Pe=ke[he.idx[0]].width,Me=ke[he.idx[0]].height,Je=3,st=Math.floor(Pe/8),lt=Math.ceil(Pe/8),Oe=Math.ceil(Me/8),Ht=Pe-(lt-1)*8,xt=Me-(Oe-1)*8,Et={value:0},Qt=new Array(Je),sn=new Array(Je),ln=new Array(Je),vn=new Array(Je),Dt=new Array(Je);for(let kn=0;kn<Je;++kn)Dt[kn]=me[he.idx[kn]],Qt[kn]=kn<1?0:Qt[kn-1]+lt*Oe,sn[kn]=new Float32Array(64),ln[kn]=new Uint16Array(64),vn[kn]=new Uint16Array(lt*64);for(let kn=0;kn<Oe;++kn){var Bt=8;kn==Oe-1&&(Bt=xt);var yn=8;for(let Bn=0;Bn<lt;++Bn){Bn==lt-1&&(yn=Ht);for(let Ln=0;Ln<Je;++Ln)ln[Ln].fill(0),ln[Ln][0]=ye[Qt[Ln]++],Le(Et,ue,ln[Ln]),Te(ln[Ln],sn[Ln]),ne(sn[Ln]);V(sn);for(let Ln=0;Ln<Je;++Ln)de(sn[Ln],vn[Ln],Bn*64)}let zi=0;for(let Bn=0;Bn<Je;++Bn){const Ln=ke[he.idx[Bn]].type;for(let Ri=8*kn;Ri<8*kn+Bt;++Ri){zi=Dt[Bn][Ri];for(let ls=0;ls<st;++ls){const nr=ls*64+(Ri&7)*8;Sn.setUint16(zi+0*Ln,vn[Bn][nr+0],!0),Sn.setUint16(zi+2*Ln,vn[Bn][nr+1],!0),Sn.setUint16(zi+4*Ln,vn[Bn][nr+2],!0),Sn.setUint16(zi+6*Ln,vn[Bn][nr+3],!0),Sn.setUint16(zi+8*Ln,vn[Bn][nr+4],!0),Sn.setUint16(zi+10*Ln,vn[Bn][nr+5],!0),Sn.setUint16(zi+12*Ln,vn[Bn][nr+6],!0),Sn.setUint16(zi+14*Ln,vn[Bn][nr+7],!0),zi+=16*Ln}}if(st!=lt)for(let Ri=8*kn;Ri<8*kn+Bt;++Ri){const ls=Dt[Bn][Ri]+8*st*2*Ln,nr=st*64+(Ri&7)*8;for(let ta=0;ta<yn;++ta)Sn.setUint16(ls+ta*2*Ln,vn[Bn][nr+ta],!0)}}}for(var xn=new Uint16Array(Pe),Sn=new DataView(_e.buffer),Ai=0;Ai<Je;++Ai){ke[he.idx[Ai]].decoded=!0;var xi=ke[he.idx[Ai]].type;if(ke[Ai].type==2)for(var Ei=0;Ei<Me;++Ei){const kn=Dt[Ai][Ei];for(var Dn=0;Dn<Pe;++Dn)xn[Dn]=Sn.getUint16(kn+Dn*2*xi,!0);for(var Dn=0;Dn<Pe;++Dn)Sn.setFloat32(kn+Dn*2*xi,De(xn[Dn]),!0)}}}function Le(he,me,ke){for(var ue,ye=1;ye<64;)ue=me[he.value],ue==65280?ye=64:ue>>8==255?ye+=ue&255:(ke[ye]=ue,ye++),he.value++}function Te(he,me){me[0]=De(he[0]),me[1]=De(he[1]),me[2]=De(he[5]),me[3]=De(he[6]),me[4]=De(he[14]),me[5]=De(he[15]),me[6]=De(he[27]),me[7]=De(he[28]),me[8]=De(he[2]),me[9]=De(he[4]),me[10]=De(he[7]),me[11]=De(he[13]),me[12]=De(he[16]),me[13]=De(he[26]),me[14]=De(he[29]),me[15]=De(he[42]),me[16]=De(he[3]),me[17]=De(he[8]),me[18]=De(he[12]),me[19]=De(he[17]),me[20]=De(he[25]),me[21]=De(he[30]),me[22]=De(he[41]),me[23]=De(he[43]),me[24]=De(he[9]),me[25]=De(he[11]),me[26]=De(he[18]),me[27]=De(he[24]),me[28]=De(he[31]),me[29]=De(he[40]),me[30]=De(he[44]),me[31]=De(he[53]),me[32]=De(he[10]),me[33]=De(he[19]),me[34]=De(he[23]),me[35]=De(he[32]),me[36]=De(he[39]),me[37]=De(he[45]),me[38]=De(he[52]),me[39]=De(he[54]),me[40]=De(he[20]),me[41]=De(he[22]),me[42]=De(he[33]),me[43]=De(he[38]),me[44]=De(he[46]),me[45]=De(he[51]),me[46]=De(he[55]),me[47]=De(he[60]),me[48]=De(he[21]),me[49]=De(he[34]),me[50]=De(he[37]),me[51]=De(he[47]),me[52]=De(he[50]),me[53]=De(he[56]),me[54]=De(he[59]),me[55]=De(he[61]),me[56]=De(he[35]),me[57]=De(he[36]),me[58]=De(he[48]),me[59]=De(he[49]),me[60]=De(he[57]),me[61]=De(he[58]),me[62]=De(he[62]),me[63]=De(he[63])}function ne(he){const me=.5*Math.cos(.7853975),ke=.5*Math.cos(3.14159/16),ue=.5*Math.cos(3.14159/8),ye=.5*Math.cos(3*3.14159/16),_e=.5*Math.cos(5*3.14159/16),Pe=.5*Math.cos(3*3.14159/8),Me=.5*Math.cos(7*3.14159/16);for(var Je=new Array(4),st=new Array(4),lt=new Array(4),Oe=new Array(4),Ht=0;Ht<8;++Ht){var xt=Ht*8;Je[0]=ue*he[xt+2],Je[1]=Pe*he[xt+2],Je[2]=ue*he[xt+6],Je[3]=Pe*he[xt+6],st[0]=ke*he[xt+1]+ye*he[xt+3]+_e*he[xt+5]+Me*he[xt+7],st[1]=ye*he[xt+1]-Me*he[xt+3]-ke*he[xt+5]-_e*he[xt+7],st[2]=_e*he[xt+1]-ke*he[xt+3]+Me*he[xt+5]+ye*he[xt+7],st[3]=Me*he[xt+1]-_e*he[xt+3]+ye*he[xt+5]-ke*he[xt+7],lt[0]=me*(he[xt+0]+he[xt+4]),lt[3]=me*(he[xt+0]-he[xt+4]),lt[1]=Je[0]+Je[3],lt[2]=Je[1]-Je[2],Oe[0]=lt[0]+lt[1],Oe[1]=lt[3]+lt[2],Oe[2]=lt[3]-lt[2],Oe[3]=lt[0]-lt[1],he[xt+0]=Oe[0]+st[0],he[xt+1]=Oe[1]+st[1],he[xt+2]=Oe[2]+st[2],he[xt+3]=Oe[3]+st[3],he[xt+4]=Oe[3]-st[3],he[xt+5]=Oe[2]-st[2],he[xt+6]=Oe[1]-st[1],he[xt+7]=Oe[0]-st[0]}for(var Et=0;Et<8;++Et)Je[0]=ue*he[16+Et],Je[1]=Pe*he[16+Et],Je[2]=ue*he[48+Et],Je[3]=Pe*he[48+Et],st[0]=ke*he[8+Et]+ye*he[24+Et]+_e*he[40+Et]+Me*he[56+Et],st[1]=ye*he[8+Et]-Me*he[24+Et]-ke*he[40+Et]-_e*he[56+Et],st[2]=_e*he[8+Et]-ke*he[24+Et]+Me*he[40+Et]+ye*he[56+Et],st[3]=Me*he[8+Et]-_e*he[24+Et]+ye*he[40+Et]-ke*he[56+Et],lt[0]=me*(he[Et]+he[32+Et]),lt[3]=me*(he[Et]-he[32+Et]),lt[1]=Je[0]+Je[3],lt[2]=Je[1]-Je[2],Oe[0]=lt[0]+lt[1],Oe[1]=lt[3]+lt[2],Oe[2]=lt[3]-lt[2],Oe[3]=lt[0]-lt[1],he[0+Et]=Oe[0]+st[0],he[8+Et]=Oe[1]+st[1],he[16+Et]=Oe[2]+st[2],he[24+Et]=Oe[3]+st[3],he[32+Et]=Oe[3]-st[3],he[40+Et]=Oe[2]-st[2],he[48+Et]=Oe[1]-st[1],he[56+Et]=Oe[0]-st[0]}function V(he){for(var me=0;me<64;++me){var ke=he[0][me],ue=he[1][me],ye=he[2][me];he[0][me]=ke+1.5747*ye,he[1][me]=ke-.1873*ue-.4682*ye,he[2][me]=ke+1.8556*ue}}function de(he,me,ke){for(var ue=0;ue<64;++ue)me[ke+ue]=Lm.toHalfFloat(Re(he[ue]))}function Re(he){return he<=1?Math.sign(he)*Math.pow(Math.abs(he),2.2):Math.sign(he)*Math.pow(R,Math.abs(he)-1)}function Be(he){return new DataView(he.array.buffer,he.offset.value,he.size)}function Fe(he){var me=he.viewer.buffer.slice(he.offset.value,he.offset.value+he.size),ke=new Uint8Array(ve(me)),ue=new Uint8Array(ke.length);return we(ke),Ee(ke,ue),new DataView(ue.buffer)}function He(he){var me=he.array.slice(he.offset.value,he.offset.value+he.size),ke=Fv(me),ue=new Uint8Array(ke.length);return we(ke),Ee(ke,ue),new DataView(ue.buffer)}function it(he){for(var me=he.viewer,ke={value:he.offset.value},ue=new Uint16Array(he.width*he.scanlineBlockSize*(he.channels*he.type)),ye=new Uint8Array(8192),_e=0,Pe=new Array(he.channels),Me=0;Me<he.channels;Me++)Pe[Me]={},Pe[Me].start=_e,Pe[Me].end=Pe[Me].start,Pe[Me].nx=he.width,Pe[Me].ny=he.lines,Pe[Me].size=he.type,_e+=Pe[Me].nx*Pe[Me].ny*Pe[Me].size;var Je=Ce(me,ke),st=Ce(me,ke);if(st>=8192)throw"Something is wrong with PIZ_COMPRESSION BITMAP_SIZE";if(Je<=st)for(var Me=0;Me<st-Je+1;Me++)ye[Me+Je]=be(me,ke);var lt=new Uint16Array(65536),Oe=P(ye,lt),Ht=gt(me,ke);pe(he.array,me,ke,Ht,ue,_e);for(var Me=0;Me<he.channels;++Me)for(var xt=Pe[Me],Et=0;Et<Pe[Me].size;++Et)ge(ue,xt.start+Et,xt.nx,xt.size,xt.ny,xt.nx*xt.size,Oe);ce(lt,ue,_e);for(var Qt=0,sn=new Uint8Array(ue.buffer.byteLength),ln=0;ln<he.lines;ln++)for(var vn=0;vn<he.channels;vn++){var xt=Pe[vn],Dt=xt.nx*xt.size,Bt=new Uint8Array(ue.buffer,xt.end*2,Dt*2);sn.set(Bt,Qt),Qt+=Dt*2,xt.end+=Dt}return new DataView(sn.buffer)}function $e(he){var me=he.array.slice(he.offset.value,he.offset.value+he.size),ke=Fv(me);const ue=he.lines*he.channels*he.width,ye=he.type==1?new Uint16Array(ue):new Uint32Array(ue);let _e=0,Pe=0;const Me=new Array(4);for(let Je=0;Je<he.lines;Je++)for(let st=0;st<he.channels;st++){let lt=0;switch(he.type){case 1:Me[0]=_e,Me[1]=Me[0]+he.width,_e=Me[1]+he.width;for(let Oe=0;Oe<he.width;++Oe){const Ht=ke[Me[0]++]<<8|ke[Me[1]++];lt+=Ht,ye[Pe]=lt,Pe++}break;case 2:Me[0]=_e,Me[1]=Me[0]+he.width,Me[2]=Me[1]+he.width,_e=Me[2]+he.width;for(let Oe=0;Oe<he.width;++Oe){const Ht=ke[Me[0]++]<<24|ke[Me[1]++]<<16|ke[Me[2]++]<<8;lt+=Ht,ye[Pe]=lt,Pe++}break}}return new DataView(ye.buffer)}function ct(he){var me=he.viewer,ke={value:he.offset.value},ue=new Uint8Array(he.width*he.lines*(he.channels*he.type*2)),ye={version:qe(me,ke),unknownUncompressedSize:qe(me,ke),unknownCompressedSize:qe(me,ke),acCompressedSize:qe(me,ke),dcCompressedSize:qe(me,ke),rleCompressedSize:qe(me,ke),rleUncompressedSize:qe(me,ke),rleRawSize:qe(me,ke),totalAcUncompressedCount:qe(me,ke),totalDcUncompressedCount:qe(me,ke),acCompression:qe(me,ke)};if(ye.version<2)throw"EXRLoader.parse: "+tr.compression+" version "+ye.version+" is unsupported";for(var _e=new Array,Pe=Ce(me,ke)-2;Pe>0;){var Me=pt(me.buffer,ke),Je=be(me,ke),st=Je>>2&3,lt=(Je>>4)-1,Oe=new Int8Array([lt])[0],Ht=be(me,ke);_e.push({name:Me,index:Oe,type:Ht,compression:st}),Pe-=Me.length+3}for(var xt=tr.channels,Et=new Array(he.channels),Qt=0;Qt<he.channels;++Qt){var sn=Et[Qt]={},ln=xt[Qt];sn.name=ln.name,sn.compression=0,sn.decoded=!1,sn.type=ln.pixelType,sn.pLinear=ln.pLinear,sn.width=he.width,sn.height=he.lines}for(var vn={idx:new Array(3)},Dt=0;Dt<he.channels;++Dt)for(var sn=Et[Dt],Qt=0;Qt<_e.length;++Qt){var Bt=_e[Qt];sn.name==Bt.name&&(sn.compression=Bt.compression,Bt.index>=0&&(vn.idx[Bt.index]=Dt),sn.offset=Dt)}if(ye.acCompressedSize>0)switch(ye.acCompression){case 0:var Sn=new Uint16Array(ye.totalAcUncompressedCount);pe(he.array,me,ke,ye.acCompressedSize,Sn,ye.totalAcUncompressedCount);break;case 1:var yn=he.array.slice(ke.value,ke.value+ye.totalAcUncompressedCount),xn=Fv(yn),Sn=new Uint16Array(xn.buffer);ke.value+=ye.totalAcUncompressedCount;break}if(ye.dcCompressedSize>0){var Ai={array:he.array,offset:ke,size:ye.dcCompressedSize},xi=new Uint16Array(He(Ai).buffer);ke.value+=ye.dcCompressedSize}if(ye.rleRawSize>0){var yn=he.array.slice(ke.value,ke.value+ye.rleCompressedSize),xn=Fv(yn),Ei=ve(xn.buffer);ke.value+=ye.rleCompressedSize}for(var Dn=0,kn=new Array(Et.length),Qt=0;Qt<kn.length;++Qt)kn[Qt]=new Array;for(var zi=0;zi<he.lines;++zi)for(var Bn=0;Bn<Et.length;++Bn)kn[Bn].push(Dn),Dn+=Et[Bn].width*he.type*2;Ae(vn,kn,Et,Sn,xi,ue);for(var Qt=0;Qt<Et.length;++Qt){var sn=Et[Qt];if(!sn.decoded)switch(sn.compression){case 2:for(var Ln=0,Ri=0,zi=0;zi<he.lines;++zi){for(var ls=kn[Qt][Ln],nr=0;nr<sn.width;++nr){for(var ta=0;ta<2*sn.type;++ta)ue[ls++]=Ei[Ri+ta*sn.width*sn.height];Ri++}Ln++}break;case 1:default:throw"EXRLoader.parse: unsupported channel compression"}}return new DataView(ue.buffer)}function pt(he,me){for(var ke=new Uint8Array(he),ue=0;ke[me.value+ue]!=0;)ue+=1;var ye=new TextDecoder().decode(ke.slice(me.value,me.value+ue));return me.value=me.value+ue+1,ye}function We(he,me,ke){var ue=new TextDecoder().decode(new Uint8Array(he).slice(me.value,me.value+ke));return me.value=me.value+ke,ue}function Mt(he,me){var ke=St(he,me),ue=gt(he,me);return[ke,ue]}function Ft(he,me){var ke=gt(he,me),ue=gt(he,me);return[ke,ue]}function St(he,me){var ke=he.getInt32(me.value,!0);return me.value=me.value+4,ke}function gt(he,me){var ke=he.getUint32(me.value,!0);return me.value=me.value+4,ke}function ft(he,me){var ke=he[me.value];return me.value=me.value+1,ke}function be(he,me){var ke=he.getUint8(me.value);return me.value=me.value+1,ke}const qe=function(he,me){let ke;return"getBigInt64"in DataView.prototype?ke=Number(he.getBigInt64(me.value,!0)):ke=he.getUint32(me.value+4,!0)+Number(he.getUint32(me.value,!0)<<32),me.value+=8,ke};function At(he,me){var ke=he.getFloat32(me.value,!0);return me.value+=4,ke}function yt(he,me){return Lm.toHalfFloat(At(he,me))}function De(he){var me=(he&31744)>>10,ke=he&1023;return(he>>15?-1:1)*(me?me===31?ke?NaN:1/0:Math.pow(2,me-15)*(1+ke/1024):6103515625e-14*(ke/1024))}function Ce(he,me){var ke=he.getUint16(me.value,!0);return me.value+=2,ke}function _t(he,me){return De(Ce(he,me))}function vt(he,me,ke,ue){for(var ye=ke.value,_e=[];ke.value<ye+ue-1;){var Pe=pt(me,ke),Me=St(he,ke),Je=be(he,ke);ke.value+=3;var st=St(he,ke),lt=St(he,ke);_e.push({name:Pe,pixelType:Me,pLinear:Je,xSampling:st,ySampling:lt})}return ke.value+=1,_e}function bt(he,me){var ke=At(he,me),ue=At(he,me),ye=At(he,me),_e=At(he,me),Pe=At(he,me),Me=At(he,me),Je=At(he,me),st=At(he,me);return{redX:ke,redY:ue,greenX:ye,greenY:_e,blueX:Pe,blueY:Me,whiteX:Je,whiteY:st}}function Pt(he,me){var ke=["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"],ue=be(he,me);return ke[ue]}function qt(he,me){var ke=gt(he,me),ue=gt(he,me),ye=gt(he,me),_e=gt(he,me);return{xMin:ke,yMin:ue,xMax:ye,yMax:_e}}function Nt(he,me){var ke=["INCREASING_Y"],ue=be(he,me);return ke[ue]}function dn(he,me){var ke=At(he,me),ue=At(he,me);return[ke,ue]}function Vn(he,me){var ke=At(he,me),ue=At(he,me),ye=At(he,me);return[ke,ue,ye]}function pn(he,me,ke,ue,ye){if(ue==="string"||ue==="stringvector"||ue==="iccProfile")return We(me,ke,ye);if(ue==="chlist")return vt(he,me,ke,ye);if(ue==="chromaticities")return bt(he,ke);if(ue==="compression")return Pt(he,ke);if(ue==="box2i")return qt(he,ke);if(ue==="lineOrder")return Nt(he,ke);if(ue==="float")return At(he,ke);if(ue==="v2f")return dn(he,ke);if(ue==="v3f")return Vn(he,ke);if(ue==="int")return St(he,ke);if(ue==="rational")return Mt(he,ke);if(ue==="timecode")return Ft(he,ke);if(ue==="preview")return ke.value+=ye,"skipped";ke.value+=ye}function qn(he,me,ke){const ue={};if(he.getUint32(0,!0)!=20000630)throw"THREE.EXRLoader: provided file doesn't appear to be in OpenEXR format.";ue.version=he.getUint8(4);const ye=he.getUint8(5);ue.spec={singleTile:!!(ye&2),longName:!!(ye&4),deepFormat:!!(ye&8),multiPart:!!(ye&16)},ke.value=8;for(var _e=!0;_e;){var Pe=pt(me,ke);if(Pe==0)_e=!1;else{var Me=pt(me,ke),Je=gt(he,ke),st=pn(he,me,ke,Me,Je);st===void 0?console.warn(`EXRLoader.parse: skipped unknown header attribute type '${Me}'.`):ue[Pe]=st}}if((ye&-5)!=0)throw console.error("EXRHeader:",ue),"THREE.EXRLoader: provided file is currently unsupported.";return ue}function Ci(he,me,ke,ue,ye){const _e={size:0,viewer:me,array:ke,offset:ue,width:he.dataWindow.xMax-he.dataWindow.xMin+1,height:he.dataWindow.yMax-he.dataWindow.yMin+1,channels:he.channels.length,bytesPerLine:null,lines:null,inputSize:null,type:he.channels[0].pixelType,uncompress:null,getter:null,format:null,[av?"colorSpace":"encoding"]:null};switch(he.compression){case"NO_COMPRESSION":_e.lines=1,_e.uncompress=Be;break;case"RLE_COMPRESSION":_e.lines=1,_e.uncompress=Fe;break;case"ZIPS_COMPRESSION":_e.lines=1,_e.uncompress=He;break;case"ZIP_COMPRESSION":_e.lines=16,_e.uncompress=He;break;case"PIZ_COMPRESSION":_e.lines=32,_e.uncompress=it;break;case"PXR24_COMPRESSION":_e.lines=16,_e.uncompress=$e;break;case"DWAA_COMPRESSION":_e.lines=32,_e.uncompress=ct;break;case"DWAB_COMPRESSION":_e.lines=256,_e.uncompress=ct;break;default:throw"EXRLoader.parse: "+he.compression+" is unsupported"}if(_e.scanlineBlockSize=_e.lines,_e.type==1)switch(ye){case fi:_e.getter=_t,_e.inputSize=2;break;case Ni:_e.getter=Ce,_e.inputSize=2;break}else if(_e.type==2)switch(ye){case fi:_e.getter=At,_e.inputSize=4;break;case Ni:_e.getter=yt,_e.inputSize=4}else throw"EXRLoader.parse: unsupported pixelType "+_e.type+" for "+he.compression+".";_e.blockCount=(he.dataWindow.yMax+1)/_e.scanlineBlockSize;for(var Pe=0;Pe<_e.blockCount;Pe++)qe(me,ue);_e.outputChannels=_e.channels==3?4:_e.channels;const Me=_e.width*_e.height*_e.outputChannels;switch(ye){case fi:_e.byteArray=new Float32Array(Me),_e.channels<_e.outputChannels&&_e.byteArray.fill(1,0,Me);break;case Ni:_e.byteArray=new Uint16Array(Me),_e.channels<_e.outputChannels&&_e.byteArray.fill(15360,0,Me);break;default:console.error("THREE.EXRLoader: unsupported type: ",ye);break}return _e.bytesPerLine=_e.width*_e.inputSize*_e.channels,_e.outputChannels==4?_e.format=gi:_e.format=hc,av?_e.colorSpace="srgb-linear":_e.encoding=3e3,_e}const as=new DataView(e),Nr=new Uint8Array(e),ur={value:0},tr=qn(as,e,ur),An=Ci(tr,as,Nr,ur,this.type),vr={value:0},Uo={R:0,G:1,B:2,A:3,Y:0};for(let he=0;he<An.height/An.scanlineBlockSize;he++){const me=gt(as,ur);An.size=gt(as,ur),An.lines=me+An.scanlineBlockSize>An.height?An.height-me:An.scanlineBlockSize;const ue=An.size<An.lines*An.bytesPerLine?An.uncompress(An):Be(An);ur.value+=An.size;for(let ye=0;ye<An.scanlineBlockSize;ye++){const _e=ye+he*An.scanlineBlockSize;if(_e>=An.height)break;for(let Pe=0;Pe<An.channels;Pe++){const Me=Uo[tr.channels[Pe].name];for(let Je=0;Je<An.width;Je++){vr.value=(ye*(An.channels*An.width)+Pe*An.width+Je)*An.inputSize;const st=(An.height-1-_e)*(An.width*An.outputChannels)+Je*An.outputChannels+Me;An.byteArray[st]=An.getter(ue,vr)}}}}return{header:tr,width:An.width,height:An.height,data:An.byteArray,format:An.format,[av?"colorSpace":"encoding"]:An[av?"colorSpace":"encoding"],type:this.type}}setDataType(e){return this.type=e,this}load(e,t,n,r){function s(o,a){av?o.colorSpace=a.colorSpace:o.encoding=a.encoding,o.minFilter=Pn,o.magFilter=Pn,o.generateMipmaps=!1,o.flipY=!1,t&&t(o,a)}return super.load(e,s,n,r)}}const hhe="srgb",lb=(()=>{class i extends os{constructor(t){super(t),this.defaultDPI=90,this.defaultUnit="px"}load(t,n,r,s){const o=this,a=new $r(o.manager);a.setPath(o.path),a.setRequestHeader(o.requestHeader),a.setWithCredentials(o.withCredentials),a.load(t,function(l){try{n(o.parse(l))}catch(c){s?s(c):console.error(c),o.manager.itemError(t)}},r,s)}parse(t){const n=this;function r(J,ie){if(J.nodeType!==1)return;const re=T(J);let se=!1,ge=null;switch(J.nodeName){case"svg":ie=A(J,ie);break;case"style":o(J);break;case"g":ie=A(J,ie);break;case"path":ie=A(J,ie),J.hasAttribute("d")&&(ge=s(J));break;case"rect":ie=A(J,ie),ge=c(J);break;case"polygon":ie=A(J,ie),ge=u(J);break;case"polyline":ie=A(J,ie),ge=h(J);break;case"circle":ie=A(J,ie),ge=f(J);break;case"ellipse":ie=A(J,ie),ge=d(J);break;case"line":ie=A(J,ie),ge=m(J);break;case"defs":se=!0;break;case"use":ie=A(J,ie);const ce=(J.getAttributeNS("http://www.w3.org/1999/xlink","href")||"").substring(1),we=J.viewportElement.getElementById(ce);we?r(we,ie):console.warn("SVGLoader: 'use node' references non-existent node id: "+ce);break}ge&&(ie.fill!==void 0&&ie.fill!=="none"&&ge.color.setStyle(ie.fill,hhe),M(ge,K),z.push(ge),ge.userData={node:J,style:ie});const xe=J.childNodes;for(let pe=0;pe<xe.length;pe++){const ce=xe[pe];se&&ce.nodeName!=="style"&&ce.nodeName!=="defs"||r(ce,ie)}re&&(W.pop(),W.length>0?K.copy(W[W.length-1]):K.identity())}function s(J){const ie=new yf,re=new Ue,se=new Ue,ge=new Ue;let xe=!0,pe=!1;const ce=J.getAttribute("d");if(ce===""||ce==="none")return null;const we=ce.match(/[a-df-z][^a-df-z]*/gi);for(let Ee=0,ve=we.length;Ee<ve;Ee++){const Ae=we[Ee],Le=Ae.charAt(0),Te=Ae.slice(1).trim();xe===!0&&(pe=!0,xe=!1);let ne;switch(Le){case"M":ne=y(Te);for(let V=0,de=ne.length;V<de;V+=2)re.x=ne[V+0],re.y=ne[V+1],se.x=re.x,se.y=re.y,V===0?ie.moveTo(re.x,re.y):ie.lineTo(re.x,re.y),V===0&&ge.copy(re);break;case"H":ne=y(Te);for(let V=0,de=ne.length;V<de;V++)re.x=ne[V],se.x=re.x,se.y=re.y,ie.lineTo(re.x,re.y),V===0&&pe===!0&&ge.copy(re);break;case"V":ne=y(Te);for(let V=0,de=ne.length;V<de;V++)re.y=ne[V],se.x=re.x,se.y=re.y,ie.lineTo(re.x,re.y),V===0&&pe===!0&&ge.copy(re);break;case"L":ne=y(Te);for(let V=0,de=ne.length;V<de;V+=2)re.x=ne[V+0],re.y=ne[V+1],se.x=re.x,se.y=re.y,ie.lineTo(re.x,re.y),V===0&&pe===!0&&ge.copy(re);break;case"C":ne=y(Te);for(let V=0,de=ne.length;V<de;V+=6)ie.bezierCurveTo(ne[V+0],ne[V+1],ne[V+2],ne[V+3],ne[V+4],ne[V+5]),se.x=ne[V+2],se.y=ne[V+3],re.x=ne[V+4],re.y=ne[V+5],V===0&&pe===!0&&ge.copy(re);break;case"S":ne=y(Te);for(let V=0,de=ne.length;V<de;V+=4)ie.bezierCurveTo(g(re.x,se.x),g(re.y,se.y),ne[V+0],ne[V+1],ne[V+2],ne[V+3]),se.x=ne[V+0],se.y=ne[V+1],re.x=ne[V+2],re.y=ne[V+3],V===0&&pe===!0&&ge.copy(re);break;case"Q":ne=y(Te);for(let V=0,de=ne.length;V<de;V+=4)ie.quadraticCurveTo(ne[V+0],ne[V+1],ne[V+2],ne[V+3]),se.x=ne[V+0],se.y=ne[V+1],re.x=ne[V+2],re.y=ne[V+3],V===0&&pe===!0&&ge.copy(re);break;case"T":ne=y(Te);for(let V=0,de=ne.length;V<de;V+=2){const Re=g(re.x,se.x),Be=g(re.y,se.y);ie.quadraticCurveTo(Re,Be,ne[V+0],ne[V+1]),se.x=Re,se.y=Be,re.x=ne[V+0],re.y=ne[V+1],V===0&&pe===!0&&ge.copy(re)}break;case"A":ne=y(Te,[3,4],7);for(let V=0,de=ne.length;V<de;V+=7){if(ne[V+5]==re.x&&ne[V+6]==re.y)continue;const Re=re.clone();re.x=ne[V+5],re.y=ne[V+6],se.x=re.x,se.y=re.y,a(ie,ne[V],ne[V+1],ne[V+2],ne[V+3],ne[V+4],Re,re),V===0&&pe===!0&&ge.copy(re)}break;case"m":ne=y(Te);for(let V=0,de=ne.length;V<de;V+=2)re.x+=ne[V+0],re.y+=ne[V+1],se.x=re.x,se.y=re.y,V===0?ie.moveTo(re.x,re.y):ie.lineTo(re.x,re.y),V===0&&ge.copy(re);break;case"h":ne=y(Te);for(let V=0,de=ne.length;V<de;V++)re.x+=ne[V],se.x=re.x,se.y=re.y,ie.lineTo(re.x,re.y),V===0&&pe===!0&&ge.copy(re);break;case"v":ne=y(Te);for(let V=0,de=ne.length;V<de;V++)re.y+=ne[V],se.x=re.x,se.y=re.y,ie.lineTo(re.x,re.y),V===0&&pe===!0&&ge.copy(re);break;case"l":ne=y(Te);for(let V=0,de=ne.length;V<de;V+=2)re.x+=ne[V+0],re.y+=ne[V+1],se.x=re.x,se.y=re.y,ie.lineTo(re.x,re.y),V===0&&pe===!0&&ge.copy(re);break;case"c":ne=y(Te);for(let V=0,de=ne.length;V<de;V+=6)ie.bezierCurveTo(re.x+ne[V+0],re.y+ne[V+1],re.x+ne[V+2],re.y+ne[V+3],re.x+ne[V+4],re.y+ne[V+5]),se.x=re.x+ne[V+2],se.y=re.y+ne[V+3],re.x+=ne[V+4],re.y+=ne[V+5],V===0&&pe===!0&&ge.copy(re);break;case"s":ne=y(Te);for(let V=0,de=ne.length;V<de;V+=4)ie.bezierCurveTo(g(re.x,se.x),g(re.y,se.y),re.x+ne[V+0],re.y+ne[V+1],re.x+ne[V+2],re.y+ne[V+3]),se.x=re.x+ne[V+0],se.y=re.y+ne[V+1],re.x+=ne[V+2],re.y+=ne[V+3],V===0&&pe===!0&&ge.copy(re);break;case"q":ne=y(Te);for(let V=0,de=ne.length;V<de;V+=4)ie.quadraticCurveTo(re.x+ne[V+0],re.y+ne[V+1],re.x+ne[V+2],re.y+ne[V+3]),se.x=re.x+ne[V+0],se.y=re.y+ne[V+1],re.x+=ne[V+2],re.y+=ne[V+3],V===0&&pe===!0&&ge.copy(re);break;case"t":ne=y(Te);for(let V=0,de=ne.length;V<de;V+=2){const Re=g(re.x,se.x),Be=g(re.y,se.y);ie.quadraticCurveTo(Re,Be,re.x+ne[V+0],re.y+ne[V+1]),se.x=Re,se.y=Be,re.x=re.x+ne[V+0],re.y=re.y+ne[V+1],V===0&&pe===!0&&ge.copy(re)}break;case"a":ne=y(Te,[3,4],7);for(let V=0,de=ne.length;V<de;V+=7){if(ne[V+5]==0&&ne[V+6]==0)continue;const Re=re.clone();re.x+=ne[V+5],re.y+=ne[V+6],se.x=re.x,se.y=re.y,a(ie,ne[V],ne[V+1],ne[V+2],ne[V+3],ne[V+4],Re,re),V===0&&pe===!0&&ge.copy(re)}break;case"Z":case"z":ie.currentPath.autoClose=!0,ie.currentPath.curves.length>0&&(re.copy(ge),ie.currentPath.currentPoint.copy(re),xe=!0);break;default:console.warn(Ae)}pe=!1}return ie}function o(J){if(!(!J.sheet||!J.sheet.cssRules||!J.sheet.cssRules.length))for(let ie=0;ie<J.sheet.cssRules.length;ie++){const re=J.sheet.cssRules[ie];if(re.type!==1)continue;const se=re.selectorText.split(/,/gm).filter(Boolean).map(ge=>ge.trim());for(let ge=0;ge<se.length;ge++){const xe=Object.fromEntries(Object.entries(re.style).filter(([,pe])=>pe!==""));U[se[ge]]=Object.assign(U[se[ge]]||{},xe)}}}function a(J,ie,re,se,ge,xe,pe,ce){if(ie==0||re==0){J.lineTo(ce.x,ce.y);return}se=se*Math.PI/180,ie=Math.abs(ie),re=Math.abs(re);const we=(pe.x-ce.x)/2,Ee=(pe.y-ce.y)/2,ve=Math.cos(se)*we+Math.sin(se)*Ee,Ae=-Math.sin(se)*we+Math.cos(se)*Ee;let Le=ie*ie,Te=re*re;const ne=ve*ve,V=Ae*Ae,de=ne/Le+V/Te;if(de>1){const Mt=Math.sqrt(de);ie=Mt*ie,re=Mt*re,Le=ie*ie,Te=re*re}const Re=Le*V+Te*ne,Be=(Le*Te-Re)/Re;let Fe=Math.sqrt(Math.max(0,Be));ge===xe&&(Fe=-Fe);const He=Fe*ie*Ae/re,it=-Fe*re*ve/ie,$e=Math.cos(se)*He-Math.sin(se)*it+(pe.x+ce.x)/2,ct=Math.sin(se)*He+Math.cos(se)*it+(pe.y+ce.y)/2,pt=l(1,0,(ve-He)/ie,(Ae-it)/re),We=l((ve-He)/ie,(Ae-it)/re,(-ve-He)/ie,(-Ae-it)/re)%(Math.PI*2);J.currentPath.absellipse($e,ct,ie,re,pt,pt+We,xe===0,se)}function l(J,ie,re,se){const ge=J*re+ie*se,xe=Math.sqrt(J*J+ie*ie)*Math.sqrt(re*re+se*se);let pe=Math.acos(Math.max(-1,Math.min(1,ge/xe)));return J*se-ie*re<0&&(pe=-pe),pe}function c(J){const ie=C(J.getAttribute("x")||0),re=C(J.getAttribute("y")||0),se=C(J.getAttribute("rx")||J.getAttribute("ry")||0),ge=C(J.getAttribute("ry")||J.getAttribute("rx")||0),xe=C(J.getAttribute("width")),pe=C(J.getAttribute("height")),ce=1-.551915024494,we=new yf;return we.moveTo(ie+se,re),we.lineTo(ie+xe-se,re),(se!==0||ge!==0)&&we.bezierCurveTo(ie+xe-se*ce,re,ie+xe,re+ge*ce,ie+xe,re+ge),we.lineTo(ie+xe,re+pe-ge),(se!==0||ge!==0)&&we.bezierCurveTo(ie+xe,re+pe-ge*ce,ie+xe-se*ce,re+pe,ie+xe-se,re+pe),we.lineTo(ie+se,re+pe),(se!==0||ge!==0)&&we.bezierCurveTo(ie+se*ce,re+pe,ie,re+pe-ge*ce,ie,re+pe-ge),we.lineTo(ie,re+ge),(se!==0||ge!==0)&&we.bezierCurveTo(ie,re+ge*ce,ie+se*ce,re,ie+se,re),we}function u(J){function ie(xe,pe,ce){const we=C(pe),Ee=C(ce);ge===0?se.moveTo(we,Ee):se.lineTo(we,Ee),ge++}const re=/([+-]?\d*\.?\d+(?:e[+-]?\d+)?)(?:,|\s)([+-]?\d*\.?\d+(?:e[+-]?\d+)?)/g,se=new yf;let ge=0;return J.getAttribute("points").replace(re,ie),se.currentPath.autoClose=!0,se}function h(J){function ie(xe,pe,ce){const we=C(pe),Ee=C(ce);ge===0?se.moveTo(we,Ee):se.lineTo(we,Ee),ge++}const re=/([+-]?\d*\.?\d+(?:e[+-]?\d+)?)(?:,|\s)([+-]?\d*\.?\d+(?:e[+-]?\d+)?)/g,se=new yf;let ge=0;return J.getAttribute("points").replace(re,ie),se.currentPath.autoClose=!1,se}function f(J){const ie=C(J.getAttribute("cx")||0),re=C(J.getAttribute("cy")||0),se=C(J.getAttribute("r")||0),ge=new Xd;ge.absarc(ie,re,se,0,Math.PI*2);const xe=new yf;return xe.subPaths.push(ge),xe}function d(J){const ie=C(J.getAttribute("cx")||0),re=C(J.getAttribute("cy")||0),se=C(J.getAttribute("rx")||0),ge=C(J.getAttribute("ry")||0),xe=new Xd;xe.absellipse(ie,re,se,ge,0,Math.PI*2);const pe=new yf;return pe.subPaths.push(xe),pe}function m(J){const ie=C(J.getAttribute("x1")||0),re=C(J.getAttribute("y1")||0),se=C(J.getAttribute("x2")||0),ge=C(J.getAttribute("y2")||0),xe=new yf;return xe.moveTo(ie,re),xe.lineTo(se,ge),xe.currentPath.autoClose=!1,xe}function A(J,ie){ie=Object.assign({},ie);let re={};if(J.hasAttribute("class")){const pe=J.getAttribute("class").split(/\s/).filter(Boolean).map(ce=>ce.trim());for(let ce=0;ce<pe.length;ce++)re=Object.assign(re,U["."+pe[ce]])}J.hasAttribute("id")&&(re=Object.assign(re,U["#"+J.getAttribute("id")]));function se(pe,ce,we){we===void 0&&(we=function(ve){return ve.startsWith("url")&&console.warn("SVGLoader: url access in attributes is not implemented."),ve}),J.hasAttribute(pe)&&(ie[ce]=we(J.getAttribute(pe))),re[pe]&&(ie[ce]=we(re[pe])),J.style&&J.style[pe]!==""&&(ie[ce]=we(J.style[pe]))}function ge(pe){return Math.max(0,Math.min(1,C(pe)))}function xe(pe){return Math.max(0,C(pe))}return se("fill","fill"),se("fill-opacity","fillOpacity",ge),se("fill-rule","fillRule"),se("opacity","opacity",ge),se("stroke","stroke"),se("stroke-opacity","strokeOpacity",ge),se("stroke-width","strokeWidth",xe),se("stroke-linejoin","strokeLineJoin"),se("stroke-linecap","strokeLineCap"),se("stroke-miterlimit","strokeMiterLimit",xe),se("visibility","visibility"),ie}function g(J,ie){return J-(ie-J)}function y(J,ie,re){if(typeof J!="string")throw new TypeError("Invalid input: "+typeof J);const se={WHITESPACE:/[ \t\r\n]/,DIGIT:/[\d]/,SIGN:/[-+]/,POINT:/\./,COMMA:/,/,EXP:/e/i,FLAGS:/[01]/},ge=0,xe=1,pe=2,ce=3;let we=ge,Ee=!0,ve="",Ae="";const Le=[];function Te(Re,Be,Fe){const He=new SyntaxError('Unexpected character "'+Re+'" at index '+Be+".");throw He.partial=Fe,He}function ne(){ve!==""&&(Ae===""?Le.push(Number(ve)):Le.push(Number(ve)*Math.pow(10,Number(Ae)))),ve="",Ae=""}let V;const de=J.length;for(let Re=0;Re<de;Re++){if(V=J[Re],Array.isArray(ie)&&ie.includes(Le.length%re)&&se.FLAGS.test(V)){we=xe,ve=V,ne();continue}if(we===ge){if(se.WHITESPACE.test(V))continue;if(se.DIGIT.test(V)||se.SIGN.test(V)){we=xe,ve=V;continue}if(se.POINT.test(V)){we=pe,ve=V;continue}se.COMMA.test(V)&&(Ee&&Te(V,Re,Le),Ee=!0)}if(we===xe){if(se.DIGIT.test(V)){ve+=V;continue}if(se.POINT.test(V)){ve+=V,we=pe;continue}if(se.EXP.test(V)){we=ce;continue}se.SIGN.test(V)&&ve.length===1&&se.SIGN.test(ve[0])&&Te(V,Re,Le)}if(we===pe){if(se.DIGIT.test(V)){ve+=V;continue}if(se.EXP.test(V)){we=ce;continue}se.POINT.test(V)&&ve[ve.length-1]==="."&&Te(V,Re,Le)}if(we===ce){if(se.DIGIT.test(V)){Ae+=V;continue}if(se.SIGN.test(V)){if(Ae===""){Ae+=V;continue}Ae.length===1&&se.SIGN.test(Ae)&&Te(V,Re,Le)}}se.WHITESPACE.test(V)?(ne(),we=ge,Ee=!1):se.COMMA.test(V)?(ne(),we=ge,Ee=!0):se.SIGN.test(V)?(ne(),we=xe,ve=V):se.POINT.test(V)?(ne(),we=pe,ve=V):Te(V,Re,Le)}return ne(),Le}const E=["mm","cm","in","pt","pc","px"],x={mm:{mm:1,cm:.1,in:1/25.4,pt:72/25.4,pc:6/25.4,px:-1},cm:{mm:10,cm:1,in:1/2.54,pt:72/2.54,pc:6/2.54,px:-1},in:{mm:25.4,cm:2.54,in:1,pt:72,pc:6,px:-1},pt:{mm:25.4/72,cm:2.54/72,in:1/72,pt:1,pc:6/72,px:-1},pc:{mm:25.4/6,cm:2.54/6,in:1/6,pt:72/6,pc:1,px:-1},px:{px:1}};function C(J){let ie="px";if(typeof J=="string"||J instanceof String)for(let se=0,ge=E.length;se<ge;se++){const xe=E[se];if(J.endsWith(xe)){ie=xe,J=J.substring(0,J.length-xe.length);break}}let re;return ie==="px"&&n.defaultUnit!=="px"?re=x.in[n.defaultUnit]/n.defaultDPI:(re=x[ie][n.defaultUnit],re<0&&(re=x[ie].in*n.defaultDPI)),re*parseFloat(J)}function T(J){if(!(J.hasAttribute("transform")||J.nodeName==="use"&&(J.hasAttribute("x")||J.hasAttribute("y"))))return null;const ie=I(J);return W.length>0&&ie.premultiply(W[W.length-1]),K.copy(ie),W.push(ie),ie}function I(J){const ie=new Tn,re=$;if(J.nodeName==="use"&&(J.hasAttribute("x")||J.hasAttribute("y"))){const se=C(J.getAttribute("x")),ge=C(J.getAttribute("y"));ie.translate(se,ge)}if(J.hasAttribute("transform")){const se=J.getAttribute("transform").split(")");for(let ge=se.length-1;ge>=0;ge--){const xe=se[ge].trim();if(xe==="")continue;const pe=xe.indexOf("("),ce=xe.length;if(pe>0&&pe<ce){const we=xe.slice(0,pe),Ee=y(xe.slice(pe+1));switch(re.identity(),we){case"translate":if(Ee.length>=1){const ve=Ee[0];let Ae=0;Ee.length>=2&&(Ae=Ee[1]),re.translate(ve,Ae)}break;case"rotate":if(Ee.length>=1){let ve=0,Ae=0,Le=0;ve=Ee[0]*Math.PI/180,Ee.length>=3&&(Ae=Ee[1],Le=Ee[2]),oe.makeTranslation(-Ae,-Le),X.makeRotation(ve),Q.multiplyMatrices(X,oe),oe.makeTranslation(Ae,Le),re.multiplyMatrices(oe,Q)}break;case"scale":if(Ee.length>=1){const ve=Ee[0];let Ae=ve;Ee.length>=2&&(Ae=Ee[1]),re.scale(ve,Ae)}break;case"skewX":Ee.length===1&&re.set(1,Math.tan(Ee[0]*Math.PI/180),0,0,1,0,0,0,1);break;case"skewY":Ee.length===1&&re.set(1,0,0,Math.tan(Ee[0]*Math.PI/180),1,0,0,0,1);break;case"matrix":Ee.length===6&&re.set(Ee[0],Ee[2],Ee[4],Ee[1],Ee[3],Ee[5],0,0,1);break}}ie.premultiply(re)}}return ie}function M(J,ie){function re(pe){O.set(pe.x,pe.y,1).applyMatrix3(ie),pe.set(O.x,O.y)}function se(pe){const ce=pe.xRadius,we=pe.yRadius,Ee=Math.cos(pe.aRotation),ve=Math.sin(pe.aRotation),Ae=new H(ce*Ee,ce*ve,0),Le=new H(-we*ve,we*Ee,0),Te=Ae.applyMatrix3(ie),ne=Le.applyMatrix3(ie),V=$.set(Te.x,ne.x,0,Te.y,ne.y,0,0,0,1),de=oe.copy(V).invert(),Fe=X.copy(de).transpose().multiply(de).elements,He=k(Fe[0],Fe[1],Fe[4]),it=Math.sqrt(He.rt1),$e=Math.sqrt(He.rt2);if(pe.xRadius=1/it,pe.yRadius=1/$e,pe.aRotation=Math.atan2(He.sn,He.cs),!((pe.aEndAngle-pe.aStartAngle)%(2*Math.PI)<Number.EPSILON)){const pt=oe.set(it,0,0,0,$e,0,0,0,1),We=X.set(He.cs,He.sn,0,-He.sn,He.cs,0,0,0,1),Mt=pt.multiply(We).multiply(V),Ft=St=>{const{x:gt,y:ft}=new H(Math.cos(St),Math.sin(St),0).applyMatrix3(Mt);return Math.atan2(ft,gt)};pe.aStartAngle=Ft(pe.aStartAngle),pe.aEndAngle=Ft(pe.aEndAngle),L(ie)&&(pe.aClockwise=!pe.aClockwise)}}function ge(pe){const ce=P(ie),we=F(ie);pe.xRadius*=ce,pe.yRadius*=we;const Ee=ce>Number.EPSILON?Math.atan2(ie.elements[1],ie.elements[0]):Math.atan2(-ie.elements[3],ie.elements[4]);pe.aRotation+=Ee,L(ie)&&(pe.aStartAngle*=-1,pe.aEndAngle*=-1,pe.aClockwise=!pe.aClockwise)}const xe=J.subPaths;for(let pe=0,ce=xe.length;pe<ce;pe++){const Ee=xe[pe].curves;for(let ve=0;ve<Ee.length;ve++){const Ae=Ee[ve];Ae.isLineCurve?(re(Ae.v1),re(Ae.v2)):Ae.isCubicBezierCurve?(re(Ae.v0),re(Ae.v1),re(Ae.v2),re(Ae.v3)):Ae.isQuadraticBezierCurve?(re(Ae.v0),re(Ae.v1),re(Ae.v2)):Ae.isEllipseCurve&&(Y.set(Ae.aX,Ae.aY),re(Y),Ae.aX=Y.x,Ae.aY=Y.y,R(ie)?se(Ae):ge(Ae))}}}function L(J){const ie=J.elements;return ie[0]*ie[4]-ie[1]*ie[3]<0}function R(J){const ie=J.elements,re=ie[0]*ie[3]+ie[1]*ie[4];if(re===0)return!1;const se=P(J),ge=F(J);return Math.abs(re/(se*ge))>Number.EPSILON}function P(J){const ie=J.elements;return Math.sqrt(ie[0]*ie[0]+ie[1]*ie[1])}function F(J){const ie=J.elements;return Math.sqrt(ie[3]*ie[3]+ie[4]*ie[4])}function k(J,ie,re){let se,ge,xe,pe,ce;const we=J+re,Ee=J-re,ve=Math.sqrt(Ee*Ee+4*ie*ie);return we>0?(se=.5*(we+ve),ce=1/se,ge=J*ce*re-ie*ce*ie):we<0?ge=.5*(we-ve):(se=.5*ve,ge=-.5*ve),Ee>0?xe=Ee+ve:xe=Ee-ve,Math.abs(xe)>2*Math.abs(ie)?(ce=-2*ie/xe,pe=1/Math.sqrt(1+ce*ce),xe=ce*pe):Math.abs(ie)===0?(xe=1,pe=0):(ce=-.5*xe/ie,xe=1/Math.sqrt(1+ce*ce),pe=ce*xe),Ee>0&&(ce=xe,xe=-pe,pe=ce),{rt1:se,rt2:ge,cs:xe,sn:pe}}const z=[],U={},W=[],$=new Tn,oe=new Tn,X=new Tn,Q=new Tn,Y=new Ue,O=new H,K=new Tn,te=new DOMParser().parseFromString(t,"image/svg+xml");return r(te.documentElement,{fill:"#000",fillOpacity:1,strokeOpacity:1,strokeWidth:1,strokeLineJoin:"miter",strokeLineCap:"butt",strokeMiterLimit:4}),{paths:z,xml:te.documentElement}}static createShapes(t){const r={ORIGIN:0,DESTINATION:1,BETWEEN:2,LEFT:3,RIGHT:4,BEHIND:5,BEYOND:6},s={loc:r.ORIGIN,t:0};function o(g,y,E,x){const C=g.x,T=y.x,I=E.x,M=x.x,L=g.y,R=y.y,P=E.y,F=x.y,k=(M-I)*(L-P)-(F-P)*(C-I),z=(T-C)*(L-P)-(R-L)*(C-I),U=(F-P)*(T-C)-(M-I)*(R-L),W=k/U,$=z/U;if(U===0&&k!==0||W<=0||W>=1||$<0||$>1)return null;if(k===0&&U===0){for(let oe=0;oe<2;oe++)if(a(oe===0?E:x,g,y),s.loc==r.ORIGIN){const X=oe===0?E:x;return{x:X.x,y:X.y,t:s.t}}else if(s.loc==r.BETWEEN){const X=+(C+s.t*(T-C)).toPrecision(10),Q=+(L+s.t*(R-L)).toPrecision(10);return{x:X,y:Q,t:s.t}}return null}else{for(let Q=0;Q<2;Q++)if(a(Q===0?E:x,g,y),s.loc==r.ORIGIN){const Y=Q===0?E:x;return{x:Y.x,y:Y.y,t:s.t}}const oe=+(C+W*(T-C)).toPrecision(10),X=+(L+W*(R-L)).toPrecision(10);return{x:oe,y:X,t:W}}}function a(g,y,E){const x=E.x-y.x,C=E.y-y.y,T=g.x-y.x,I=g.y-y.y,M=x*I-T*C;if(g.x===y.x&&g.y===y.y){s.loc=r.ORIGIN,s.t=0;return}if(g.x===E.x&&g.y===E.y){s.loc=r.DESTINATION,s.t=1;return}if(M<-Number.EPSILON){s.loc=r.LEFT;return}if(M>Number.EPSILON){s.loc=r.RIGHT;return}if(x*T<0||C*I<0){s.loc=r.BEHIND;return}if(Math.sqrt(x*x+C*C)<Math.sqrt(T*T+I*I)){s.loc=r.BEYOND;return}let L;x!==0?L=T/x:L=I/C,s.loc=r.BETWEEN,s.t=L}function l(g,y){const E=[],x=[];for(let C=1;C<g.length;C++){const T=g[C-1],I=g[C];for(let M=1;M<y.length;M++){const L=y[M-1],R=y[M],P=o(T,I,L,R);P!==null&&E.find(F=>F.t<=P.t+Number.EPSILON&&F.t>=P.t-Number.EPSILON)===void 0&&(E.push(P),x.push(new Ue(P.x,P.y)))}}return x}function c(g,y,E){const x=new Ue;y.getCenter(x);const C=[];return E.forEach(T=>{T.boundingBox.containsPoint(x)&&l(g,T.points).forEach(M=>{C.push({identifier:T.identifier,isCW:T.isCW,point:M})})}),C.sort((T,I)=>T.point.x-I.point.x),C}function u(g,y,E,x,C){(C==null||C==="")&&(C="nonzero");const T=new Ue;g.boundingBox.getCenter(T);const I=[new Ue(E,T.y),new Ue(x,T.y)],M=c(I,g.boundingBox,y);M.sort((z,U)=>z.point.x-U.point.x);const L=[],R=[];M.forEach(z=>{z.identifier===g.identifier?L.push(z):R.push(z)});const P=L[0].point.x,F=[];let k=0;for(;k<R.length&&R[k].point.x<P;)F.length>0&&F[F.length-1]===R[k].identifier?F.pop():F.push(R[k].identifier),k++;if(F.push(g.identifier),C==="evenodd"){const z=F.length%2===0,U=F[F.length-2];return{identifier:g.identifier,isHole:z,for:U}}else if(C==="nonzero"){let z=!0,U=null,W=null;for(let $=0;$<F.length;$++){const oe=F[$];z?(W=y[oe].isCW,z=!1,U=oe):W!==y[oe].isCW&&(W=y[oe].isCW,z=!0)}return{identifier:g.identifier,isHole:z,for:U}}else console.warn('fill-rule: "'+C+'" is currently not implemented.')}let h=999999999,f=-999999999,d=t.subPaths.map(g=>{const y=g.getPoints();let E=-999999999,x=999999999,C=-999999999,T=999999999;for(let I=0;I<y.length;I++){const M=y[I];M.y>E&&(E=M.y),M.y<x&&(x=M.y),M.x>C&&(C=M.x),M.x<T&&(T=M.x)}return f<=C&&(f=C+1),h>=T&&(h=T-1),{curves:g.curves,points:y,isCW:xu.isClockWise(y),identifier:-1,boundingBox:new Sz(new Ue(T,x),new Ue(C,E))}});d=d.filter(g=>g.points.length>1);for(let g=0;g<d.length;g++)d[g].identifier=g;const m=d.map(g=>u(g,d,h,f,t.userData?t.userData.style.fillRule:void 0)),A=[];return d.forEach(g=>{if(!m[g.identifier].isHole){const E=new Lf;E.curves=g.curves,m.filter(C=>C.isHole&&C.for===g.identifier).forEach(C=>{const T=d[C.identifier],I=new Xd;I.curves=T.curves,E.holes.push(I)}),A.push(E)}}),A}static getStrokeStyle(t,n,r,s,o){return t=t!==void 0?t:1,n=n!==void 0?n:"#000",r=r!==void 0?r:"miter",s=s!==void 0?s:"butt",o=o!==void 0?o:4,{strokeColor:n,strokeWidth:t,strokeLineJoin:r,strokeLineCap:s,strokeMiterLimit:o}}static pointsToStroke(t,n,r,s){const o=[],a=[],l=[];if(i.pointsToStrokeWithBuffers(t,n,r,s,o,a,l)===0)return null;const c=new fn;return c.setAttribute("position",new Gt(o,3)),c.setAttribute("normal",new Gt(a,3)),c.setAttribute("uv",new Gt(l,2)),c}static pointsToStrokeWithBuffers(t,n,r,s,o,a,l,c){const u=new Ue,h=new Ue,f=new Ue,d=new Ue,m=new Ue,A=new Ue,g=new Ue,y=new Ue,E=new Ue,x=new Ue,C=new Ue,T=new Ue,I=new Ue,M=new Ue,L=new Ue,R=new Ue,P=new Ue;r=r!==void 0?r:12,s=s!==void 0?s:.001,c=c!==void 0?c:0,t=Ee(t);const F=t.length;if(F<2)return 0;const k=t[0].equals(t[F-1]);let z,U=t[0],W;const $=n.strokeWidth/2,oe=1/(F-1);let X=0,Q,Y,O,K,te=!1,q=0,J=c*3,ie=c*2;re(t[0],t[1],u).multiplyScalar($),y.copy(t[0]).sub(u),E.copy(t[0]).add(u),x.copy(y),C.copy(E);for(let ve=1;ve<F;ve++){z=t[ve],ve===F-1?k?W=t[1]:W=void 0:W=t[ve+1];const Ae=u;if(re(U,z,Ae),f.copy(Ae).multiplyScalar($),T.copy(z).sub(f),I.copy(z).add(f),Q=X+oe,Y=!1,W!==void 0){re(z,W,h),f.copy(h).multiplyScalar($),M.copy(z).sub(f),L.copy(z).add(f),O=!0,f.subVectors(W,U),Ae.dot(f)<0&&(O=!1),ve===1&&(te=O),f.subVectors(W,z),f.normalize();const Le=Math.abs(Ae.dot(f));if(Le>Number.EPSILON){const Te=$/Le;f.multiplyScalar(-Te),d.subVectors(z,U),m.copy(d).setLength(Te).add(f),R.copy(m).negate();const ne=m.length(),V=d.length();d.divideScalar(V),A.subVectors(W,z);const de=A.length();switch(A.divideScalar(de),d.dot(R)<V&&A.dot(R)<de&&(Y=!0),P.copy(m).add(z),R.add(z),K=!1,Y?O?(L.copy(R),I.copy(R)):(M.copy(R),T.copy(R)):xe(),n.strokeLineJoin){case"bevel":pe(O,Y,Q);break;case"round":ce(O,Y),O?ge(z,T,M,Q,0):ge(z,L,I,Q,1);break;case"miter":case"miter-clip":default:const Re=$*n.strokeMiterLimit/ne;if(Re<1)if(n.strokeLineJoin!=="miter-clip"){pe(O,Y,Q);break}else ce(O,Y),O?(A.subVectors(P,T).multiplyScalar(Re).add(T),g.subVectors(P,M).multiplyScalar(Re).add(M),se(T,Q,0),se(A,Q,0),se(z,Q,.5),se(z,Q,.5),se(A,Q,0),se(g,Q,0),se(z,Q,.5),se(g,Q,0),se(M,Q,0)):(A.subVectors(P,I).multiplyScalar(Re).add(I),g.subVectors(P,L).multiplyScalar(Re).add(L),se(I,Q,1),se(A,Q,1),se(z,Q,.5),se(z,Q,.5),se(A,Q,1),se(g,Q,1),se(z,Q,.5),se(g,Q,1),se(L,Q,1));else Y?(O?(se(E,X,1),se(y,X,0),se(P,Q,0),se(E,X,1),se(P,Q,0),se(R,Q,1)):(se(E,X,1),se(y,X,0),se(P,Q,1),se(y,X,0),se(R,Q,0),se(P,Q,1)),O?M.copy(P):L.copy(P)):O?(se(T,Q,0),se(P,Q,0),se(z,Q,.5),se(z,Q,.5),se(P,Q,0),se(M,Q,0)):(se(I,Q,1),se(P,Q,1),se(z,Q,.5),se(z,Q,.5),se(P,Q,1),se(L,Q,1)),K=!0;break}}else xe()}else xe();!k&&ve===F-1&&we(t[0],x,C,O,!0,X),X=Q,U=z,y.copy(M),E.copy(L)}if(!k)we(z,T,I,O,!1,Q);else if(Y&&o){let ve=P,Ae=R;te!==O&&(ve=R,Ae=P),O?(K||te)&&(Ae.toArray(o,0),Ae.toArray(o,9),K&&ve.toArray(o,3)):(K||!te)&&(Ae.toArray(o,3),Ae.toArray(o,9),K&&ve.toArray(o,0))}return q;function re(ve,Ae,Le){return Le.subVectors(Ae,ve),Le.set(-Le.y,Le.x).normalize()}function se(ve,Ae,Le){o&&(o[J]=ve.x,o[J+1]=ve.y,o[J+2]=0,a&&(a[J]=0,a[J+1]=0,a[J+2]=1),J+=3,l&&(l[ie]=Ae,l[ie+1]=Le,ie+=2)),q+=3}function ge(ve,Ae,Le,Te,ne){u.copy(Ae).sub(ve).normalize(),h.copy(Le).sub(ve).normalize();let V=Math.PI;const de=u.dot(h);Math.abs(de)<1&&(V=Math.abs(Math.acos(de))),V/=r,f.copy(Ae);for(let Re=0,Be=r-1;Re<Be;Re++)d.copy(f).rotateAround(ve,V),se(f,Te,ne),se(d,Te,ne),se(ve,Te,.5),f.copy(d);se(d,Te,ne),se(Le,Te,ne),se(ve,Te,.5)}function xe(){se(E,X,1),se(y,X,0),se(T,Q,0),se(E,X,1),se(T,Q,0),se(I,Q,1)}function pe(ve,Ae,Le){Ae?ve?(se(E,X,1),se(y,X,0),se(T,Q,0),se(E,X,1),se(T,Q,0),se(R,Q,1),se(T,Le,0),se(M,Le,0),se(R,Le,.5)):(se(E,X,1),se(y,X,0),se(I,Q,1),se(y,X,0),se(R,Q,0),se(I,Q,1),se(I,Le,1),se(R,Le,0),se(L,Le,1)):ve?(se(T,Le,0),se(M,Le,0),se(z,Le,.5)):(se(I,Le,1),se(L,Le,0),se(z,Le,.5))}function ce(ve,Ae){Ae&&(ve?(se(E,X,1),se(y,X,0),se(T,Q,0),se(E,X,1),se(T,Q,0),se(R,Q,1),se(T,X,0),se(z,Q,.5),se(R,Q,1),se(z,Q,.5),se(M,X,0),se(R,Q,1)):(se(E,X,1),se(y,X,0),se(I,Q,1),se(y,X,0),se(R,Q,0),se(I,Q,1),se(I,X,1),se(R,Q,0),se(z,Q,.5),se(z,Q,.5),se(R,Q,0),se(L,X,1)))}function we(ve,Ae,Le,Te,ne,V){switch(n.strokeLineCap){case"round":ne?ge(ve,Le,Ae,V,.5):ge(ve,Ae,Le,V,.5);break;case"square":if(ne)u.subVectors(Ae,ve),h.set(u.y,-u.x),f.addVectors(u,h).add(ve),d.subVectors(h,u).add(ve),Te?(f.toArray(o,3),d.toArray(o,0),d.toArray(o,9)):(f.toArray(o,3),l[7]===1?d.toArray(o,9):f.toArray(o,9),d.toArray(o,0));else{u.subVectors(Le,ve),h.set(u.y,-u.x),f.addVectors(u,h).add(ve),d.subVectors(h,u).add(ve);const de=o.length;Te?(f.toArray(o,de-3),d.toArray(o,de-6),d.toArray(o,de-12)):(d.toArray(o,de-6),f.toArray(o,de-3),d.toArray(o,de-12))}break}}function Ee(ve){let Ae=!1;for(let Te=1,ne=ve.length-1;Te<ne;Te++)if(ve[Te].distanceTo(ve[Te+1])<s){Ae=!0;break}if(!Ae)return ve;const Le=[];Le.push(ve[0]);for(let Te=1,ne=ve.length-1;Te<ne;Te++)ve[Te].distanceTo(ve[Te+1])>=s&&Le.push(ve[Te]);return Le.push(ve[ve.length-1]),Le}}}return i})(),cb=new WeakMap;class fhe extends os{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,n,r){const s=new $r(this.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,o=>{const a={attributeIDs:this.defaultAttributeIDs,attributeTypes:this.defaultAttributeTypes,useUniqueIDs:!1};this.decodeGeometry(o,a).then(t).catch(r)},n,r)}decodeDracoFile(e,t,n,r){const s={attributeIDs:n||this.defaultAttributeIDs,attributeTypes:r||this.defaultAttributeTypes,useUniqueIDs:!!n};this.decodeGeometry(e,s).then(t)}decodeGeometry(e,t){for(const l in t.attributeTypes){const c=t.attributeTypes[l];c.BYTES_PER_ELEMENT!==void 0&&(t.attributeTypes[l]=c.name)}const n=JSON.stringify(t);if(cb.has(e)){const l=cb.get(e);if(l.key===n)return l.promise;if(e.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let r;const s=this.workerNextTaskID++,o=e.byteLength,a=this._getWorker(s,o).then(l=>(r=l,new Promise((c,u)=>{r._callbacks[s]={resolve:c,reject:u},r.postMessage({type:"decode",id:s,taskConfig:t,buffer:e},[e])}))).then(l=>this._createGeometry(l.geometry));return a.catch(()=>!0).then(()=>{r&&s&&this._releaseTask(r,s)}),cb.set(e,{key:n,promise:a}),a}_createGeometry(e){const t=new fn;e.index&&t.setIndex(new mn(e.index.array,1));for(let n=0;n<e.attributes.length;n++){const r=e.attributes[n],s=r.name,o=r.array,a=r.itemSize;t.setAttribute(s,new mn(o,a))}return t}_loadLibrary(e,t){const n=new $r(this.manager);return n.setPath(this.decoderPath),n.setResponseType(t),n.setWithCredentials(this.withCredentials),new Promise((r,s)=>{n.load(e,r,void 0,s)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const e=typeof WebAssembly!="object"||this.decoderConfig.type==="js",t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then(n=>{const r=n[0];e||(this.decoderConfig.wasmBinary=n[1]);const s=dhe.toString(),o=["/* draco decoder */",r,"","/* worker */",s.substring(s.indexOf("{")+1,s.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([o]))}),this.decoderPending}_getWorker(e,t){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const r=new Worker(this.workerSourceURL);r._callbacks={},r._taskCosts={},r._taskLoad=0,r.postMessage({type:"init",decoderConfig:this.decoderConfig}),r.onmessage=function(s){const o=s.data;switch(o.type){case"decode":r._callbacks[o.id].resolve(o);break;case"error":r._callbacks[o.id].reject(o);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+o.type+'"')}},this.workerPool.push(r)}else this.workerPool.sort(function(r,s){return r._taskLoad>s._taskLoad?-1:1});const n=this.workerPool[this.workerPool.length-1];return n._taskCosts[e]=t,n._taskLoad+=t,n})}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this}}function dhe(){let i,e;onmessage=function(o){const a=o.data;switch(a.type){case"init":i=a.decoderConfig,e=new Promise(function(u){i.onModuleLoaded=function(h){u({draco:h})},DracoDecoderModule(i)});break;case"decode":const l=a.buffer,c=a.taskConfig;e.then(u=>{const h=u.draco,f=new h.Decoder,d=new h.DecoderBuffer;d.Init(new Int8Array(l),l.byteLength);try{const m=t(h,f,d,c),A=m.attributes.map(g=>g.array.buffer);m.index&&A.push(m.index.array.buffer),self.postMessage({type:"decode",id:a.id,geometry:m},A)}catch(m){console.error(m),self.postMessage({type:"error",id:a.id,error:m.message})}finally{h.destroy(d),h.destroy(f)}});break}};function t(o,a,l,c){const u=c.attributeIDs,h=c.attributeTypes;let f,d;const m=a.GetEncodedGeometryType(l);if(m===o.TRIANGULAR_MESH)f=new o.Mesh,d=a.DecodeBufferToMesh(l,f);else if(m===o.POINT_CLOUD)f=new o.PointCloud,d=a.DecodeBufferToPointCloud(l,f);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!d.ok()||f.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+d.error_msg());const A={index:null,attributes:[]};for(const g in u){const y=self[h[g]];let E,x;if(c.useUniqueIDs)x=u[g],E=a.GetAttributeByUniqueId(f,x);else{if(x=a.GetAttributeId(f,o[u[g]]),x===-1)continue;E=a.GetAttribute(f,x)}A.attributes.push(r(o,a,f,g,y,E))}return m===o.TRIANGULAR_MESH&&(A.index=n(o,a,f)),o.destroy(f),A}function n(o,a,l){const u=l.num_faces()*3,h=u*4,f=o._malloc(h);a.GetTrianglesUInt32Array(l,h,f);const d=new Uint32Array(o.HEAPF32.buffer,f,u).slice();return o._free(f),{array:d,itemSize:1}}function r(o,a,l,c,u,h){const f=h.num_components(),m=l.num_points()*f,A=m*u.BYTES_PER_ELEMENT,g=s(o,u),y=o._malloc(A);a.GetAttributeDataArrayForAllPoints(l,h,g,A,y);const E=new u(o.HEAPF32.buffer,y,m).slice();return o._free(y),{name:c,array:E,itemSize:f}}function s(o,a){switch(a){case Float32Array:return o.DT_FLOAT32;case Int8Array:return o.DT_INT8;case Int16Array:return o.DT_INT16;case Int32Array:return o.DT_INT32;case Uint8Array:return o.DT_UINT8;case Uint16Array:return o.DT_UINT16;case Uint32Array:return o.DT_UINT32}}}const H9=new ti,D3=new H;class a4 extends dx{constructor(){super(),this.isLineSegmentsGeometry=!0,this.type="LineSegmentsGeometry";const e=[-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],t=[-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],n=[0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5];this.setIndex(n),this.setAttribute("position",new Gt(e,3)),this.setAttribute("uv",new Gt(t,2))}applyMatrix4(e){const t=this.attributes.instanceStart,n=this.attributes.instanceEnd;return t!==void 0&&(t.applyMatrix4(e),n.applyMatrix4(e),t.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}setPositions(e){let t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));const n=new MS(t,6,1);return this.setAttribute("instanceStart",new Ja(n,3,0)),this.setAttribute("instanceEnd",new Ja(n,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this}setColors(e,t=3){let n;e instanceof Float32Array?n=e:Array.isArray(e)&&(n=new Float32Array(e));const r=new MS(n,t*2,1);return this.setAttribute("instanceColorStart",new Ja(r,t,0)),this.setAttribute("instanceColorEnd",new Ja(r,t,t)),this}fromWireframeGeometry(e){return this.setPositions(e.attributes.position.array),this}fromEdgesGeometry(e){return this.setPositions(e.attributes.position.array),this}fromMesh(e){return this.fromWireframeGeometry(new N6(e.geometry)),this}fromLineSegments(e){const t=e.geometry;return this.setPositions(t.attributes.position.array),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new ti);const e=this.attributes.instanceStart,t=this.attributes.instanceEnd;e!==void 0&&t!==void 0&&(this.boundingBox.setFromBufferAttribute(e),H9.setFromBufferAttribute(t),this.boundingBox.union(H9))}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Bi),this.boundingBox===null&&this.computeBoundingBox();const e=this.attributes.instanceStart,t=this.attributes.instanceEnd;if(e!==void 0&&t!==void 0){const n=this.boundingSphere.center;this.boundingBox.getCenter(n);let r=0;for(let s=0,o=e.count;s<o;s++)D3.fromBufferAttribute(e,s),r=Math.max(r,n.distanceToSquared(D3)),D3.fromBufferAttribute(t,s),r=Math.max(r,n.distanceToSquared(D3));this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error("THREE.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}toJSON(){}applyMatrix(e){return console.warn("THREE.LineSegmentsGeometry: applyMatrix() has been renamed to applyMatrix4()."),this.applyMatrix4(e)}}class FH extends a4{constructor(){super(),this.isLineGeometry=!0,this.type="LineGeometry"}setPositions(e){const t=e.length-3,n=new Float32Array(2*t);for(let r=0;r<t;r+=3)n[2*r]=e[r],n[2*r+1]=e[r+1],n[2*r+2]=e[r+2],n[2*r+3]=e[r+3],n[2*r+4]=e[r+4],n[2*r+5]=e[r+5];return super.setPositions(n),this}setColors(e,t=3){const n=e.length-t,r=new Float32Array(2*n);if(t===3)for(let s=0;s<n;s+=t)r[2*s]=e[s],r[2*s+1]=e[s+1],r[2*s+2]=e[s+2],r[2*s+3]=e[s+3],r[2*s+4]=e[s+4],r[2*s+5]=e[s+5];else for(let s=0;s<n;s+=t)r[2*s]=e[s],r[2*s+1]=e[s+1],r[2*s+2]=e[s+2],r[2*s+3]=e[s+3],r[2*s+4]=e[s+4],r[2*s+5]=e[s+5],r[2*s+6]=e[s+6],r[2*s+7]=e[s+7];return super.setColors(r,t),this}fromLine(e){const t=e.geometry;return this.setPositions(t.attributes.position.array),this}}class l4 extends Mi{constructor(e){super({type:"LineMaterial",uniforms:rp.clone(rp.merge([Ot.common,Ot.fog,{worldUnits:{value:1},linewidth:{value:1},resolution:{value:new Ue(1,1)},dashOffset:{value:0},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}}])),vertexShader:`
				#include <common>
				#include <fog_pars_vertex>
				#include <logdepthbuf_pars_vertex>
				#include <clipping_planes_pars_vertex>

				uniform float linewidth;
				uniform vec2 resolution;

				attribute vec3 instanceStart;
				attribute vec3 instanceEnd;

				#ifdef USE_COLOR
					#ifdef USE_LINE_COLOR_ALPHA
						varying vec4 vLineColor;
						attribute vec4 instanceColorStart;
						attribute vec4 instanceColorEnd;
					#else
						varying vec3 vLineColor;
						attribute vec3 instanceColorStart;
						attribute vec3 instanceColorEnd;
					#endif
				#endif

				#ifdef WORLD_UNITS

					varying vec4 worldPos;
					varying vec3 worldStart;
					varying vec3 worldEnd;

					#ifdef USE_DASH

						varying vec2 vUv;

					#endif

				#else

					varying vec2 vUv;

				#endif

				#ifdef USE_DASH

					uniform float dashScale;
					attribute float instanceDistanceStart;
					attribute float instanceDistanceEnd;
					varying float vLineDistance;

				#endif

				void trimSegment( const in vec4 start, inout vec4 end ) {

					// trim end segment so it terminates between the camera plane and the near plane

					// conservative estimate of the near plane
					float a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column
					float b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column
					float nearEstimate = - 0.5 * b / a;

					float alpha = ( nearEstimate - start.z ) / ( end.z - start.z );

					end.xyz = mix( start.xyz, end.xyz, alpha );

				}

				void main() {

					#ifdef USE_COLOR

						vLineColor = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;

					#endif

					#ifdef USE_DASH

						vLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;
						vUv = uv;

					#endif

					float aspect = resolution.x / resolution.y;

					// camera space
					vec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );
					vec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );

					#ifdef WORLD_UNITS

						worldStart = start.xyz;
						worldEnd = end.xyz;

					#else

						vUv = uv;

					#endif

					// special case for perspective projection, and segments that terminate either in, or behind, the camera plane
					// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space
					// but we need to perform ndc-space calculations in the shader, so we must address this issue directly
					// perhaps there is a more elegant solution -- WestLangley

					bool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column

					if ( perspective ) {

						if ( start.z < 0.0 && end.z >= 0.0 ) {

							trimSegment( start, end );

						} else if ( end.z < 0.0 && start.z >= 0.0 ) {

							trimSegment( end, start );

						}

					}

					// clip space
					vec4 clipStart = projectionMatrix * start;
					vec4 clipEnd = projectionMatrix * end;

					// ndc space
					vec3 ndcStart = clipStart.xyz / clipStart.w;
					vec3 ndcEnd = clipEnd.xyz / clipEnd.w;

					// direction
					vec2 dir = ndcEnd.xy - ndcStart.xy;

					// account for clip-space aspect ratio
					dir.x *= aspect;
					dir = normalize( dir );

					#ifdef WORLD_UNITS

						// get the offset direction as perpendicular to the view vector
						vec3 worldDir = normalize( end.xyz - start.xyz );
						vec3 offset;
						if ( position.y < 0.5 ) {

							offset = normalize( cross( start.xyz, worldDir ) );

						} else {

							offset = normalize( cross( end.xyz, worldDir ) );

						}

						// sign flip
						if ( position.x < 0.0 ) offset *= - 1.0;

						float forwardOffset = dot( worldDir, vec3( 0.0, 0.0, 1.0 ) );

						// don't extend the line if we're rendering dashes because we
						// won't be rendering the endcaps
						#ifndef USE_DASH

							// extend the line bounds to encompass  endcaps
							start.xyz += - worldDir * linewidth * 0.5;
							end.xyz += worldDir * linewidth * 0.5;

							// shift the position of the quad so it hugs the forward edge of the line
							offset.xy -= dir * forwardOffset;
							offset.z += 0.5;

						#endif

						// endcaps
						if ( position.y > 1.0 || position.y < 0.0 ) {

							offset.xy += dir * 2.0 * forwardOffset;

						}

						// adjust for linewidth
						offset *= linewidth * 0.5;

						// set the world position
						worldPos = ( position.y < 0.5 ) ? start : end;
						worldPos.xyz += offset;

						// project the worldpos
						vec4 clip = projectionMatrix * worldPos;

						// shift the depth of the projected points so the line
						// segments overlap neatly
						vec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;
						clip.z = clipPose.z * clip.w;

					#else

						vec2 offset = vec2( dir.y, - dir.x );
						// undo aspect ratio adjustment
						dir.x /= aspect;
						offset.x /= aspect;

						// sign flip
						if ( position.x < 0.0 ) offset *= - 1.0;

						// endcaps
						if ( position.y < 0.0 ) {

							offset += - dir;

						} else if ( position.y > 1.0 ) {

							offset += dir;

						}

						// adjust for linewidth
						offset *= linewidth;

						// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...
						offset /= resolution.y;

						// select end
						vec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;

						// back to clip space
						offset *= clip.w;

						clip.xy += offset;

					#endif

					gl_Position = clip;

					vec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation

					#include <logdepthbuf_vertex>
					#include <clipping_planes_vertex>
					#include <fog_vertex>

				}
			`,fragmentShader:`
				uniform vec3 diffuse;
				uniform float opacity;
				uniform float linewidth;

				#ifdef USE_DASH

					uniform float dashOffset;
					uniform float dashSize;
					uniform float gapSize;

				#endif

				varying float vLineDistance;

				#ifdef WORLD_UNITS

					varying vec4 worldPos;
					varying vec3 worldStart;
					varying vec3 worldEnd;

					#ifdef USE_DASH

						varying vec2 vUv;

					#endif

				#else

					varying vec2 vUv;

				#endif

				#include <common>
				#include <fog_pars_fragment>
				#include <logdepthbuf_pars_fragment>
				#include <clipping_planes_pars_fragment>

				#ifdef USE_COLOR
					#ifdef USE_LINE_COLOR_ALPHA
						varying vec4 vLineColor;
					#else
						varying vec3 vLineColor;
					#endif
				#endif

				vec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {

					float mua;
					float mub;

					vec3 p13 = p1 - p3;
					vec3 p43 = p4 - p3;

					vec3 p21 = p2 - p1;

					float d1343 = dot( p13, p43 );
					float d4321 = dot( p43, p21 );
					float d1321 = dot( p13, p21 );
					float d4343 = dot( p43, p43 );
					float d2121 = dot( p21, p21 );

					float denom = d2121 * d4343 - d4321 * d4321;

					float numer = d1343 * d4321 - d1321 * d4343;

					mua = numer / denom;
					mua = clamp( mua, 0.0, 1.0 );
					mub = ( d1343 + d4321 * ( mua ) ) / d4343;
					mub = clamp( mub, 0.0, 1.0 );

					return vec2( mua, mub );

				}

				void main() {

					#include <clipping_planes_fragment>

					#ifdef USE_DASH

						if ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps

						if ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX

					#endif

					float alpha = opacity;

					#ifdef WORLD_UNITS

						// Find the closest points on the view ray and the line segment
						vec3 rayEnd = normalize( worldPos.xyz ) * 1e5;
						vec3 lineDir = worldEnd - worldStart;
						vec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );

						vec3 p1 = worldStart + lineDir * params.x;
						vec3 p2 = rayEnd * params.y;
						vec3 delta = p1 - p2;
						float len = length( delta );
						float norm = len / linewidth;

						#ifndef USE_DASH

							#ifdef USE_ALPHA_TO_COVERAGE

								float dnorm = fwidth( norm );
								alpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );

							#else

								if ( norm > 0.5 ) {

									discard;

								}

							#endif

						#endif

					#else

						#ifdef USE_ALPHA_TO_COVERAGE

							// artifacts appear on some hardware if a derivative is taken within a conditional
							float a = vUv.x;
							float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
							float len2 = a * a + b * b;
							float dlen = fwidth( len2 );

							if ( abs( vUv.y ) > 1.0 ) {

								alpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );

							}

						#else

							if ( abs( vUv.y ) > 1.0 ) {

								float a = vUv.x;
								float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
								float len2 = a * a + b * b;

								if ( len2 > 1.0 ) discard;

							}

						#endif

					#endif

					vec4 diffuseColor = vec4( diffuse, alpha );
					#ifdef USE_COLOR
						#ifdef USE_LINE_COLOR_ALPHA
							diffuseColor *= vLineColor;
						#else
							diffuseColor.rgb *= vLineColor;
						#endif
					#endif

					#include <logdepthbuf_fragment>

					gl_FragColor = diffuseColor;

					#include <tonemapping_fragment>
					#include <${TA>=154?"colorspace_fragment":"encodings_fragment"}>
					#include <fog_fragment>
					#include <premultiplied_alpha_fragment>

				}
			`,clipping:!0}),this.isLineMaterial=!0,this.onBeforeCompile=function(){this.transparent?this.defines.USE_LINE_COLOR_ALPHA="1":delete this.defines.USE_LINE_COLOR_ALPHA},Object.defineProperties(this,{color:{enumerable:!0,get:function(){return this.uniforms.diffuse.value},set:function(t){this.uniforms.diffuse.value=t}},worldUnits:{enumerable:!0,get:function(){return"WORLD_UNITS"in this.defines},set:function(t){t===!0?this.defines.WORLD_UNITS="":delete this.defines.WORLD_UNITS}},linewidth:{enumerable:!0,get:function(){return this.uniforms.linewidth.value},set:function(t){this.uniforms.linewidth.value=t}},dashed:{enumerable:!0,get:function(){return"USE_DASH"in this.defines},set(t){!!t!="USE_DASH"in this.defines&&(this.needsUpdate=!0),t===!0?this.defines.USE_DASH="":delete this.defines.USE_DASH}},dashScale:{enumerable:!0,get:function(){return this.uniforms.dashScale.value},set:function(t){this.uniforms.dashScale.value=t}},dashSize:{enumerable:!0,get:function(){return this.uniforms.dashSize.value},set:function(t){this.uniforms.dashSize.value=t}},dashOffset:{enumerable:!0,get:function(){return this.uniforms.dashOffset.value},set:function(t){this.uniforms.dashOffset.value=t}},gapSize:{enumerable:!0,get:function(){return this.uniforms.gapSize.value},set:function(t){this.uniforms.gapSize.value=t}},opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(t){this.uniforms.opacity.value=t}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function(t){this.uniforms.resolution.value.copy(t)}},alphaToCoverage:{enumerable:!0,get:function(){return"USE_ALPHA_TO_COVERAGE"in this.defines},set:function(t){!!t!="USE_ALPHA_TO_COVERAGE"in this.defines&&(this.needsUpdate=!0),t===!0?(this.defines.USE_ALPHA_TO_COVERAGE="",this.extensions.derivatives=!0):(delete this.defines.USE_ALPHA_TO_COVERAGE,this.extensions.derivatives=!1)}}}),this.setValues(e)}}const ub=new Rn,Q9=new H,V9=new H,Po=new Rn,Bo=new Rn,eh=new Rn,hb=new H,fb=new Xe,Fo=new Eu,W9=new H,k3=new ti,F3=new Bi,th=new Rn;let gh,Hm;function j9(i,e,t){return th.set(0,0,-e,1).applyMatrix4(i.projectionMatrix),th.multiplyScalar(1/th.w),th.x=Hm/t.width,th.y=Hm/t.height,th.applyMatrix4(i.projectionMatrixInverse),th.multiplyScalar(1/th.w),Math.abs(Math.max(th.x,th.y))}function phe(i,e){const t=i.matrixWorld,n=i.geometry,r=n.attributes.instanceStart,s=n.attributes.instanceEnd,o=Math.min(n.instanceCount,r.count);for(let a=0,l=o;a<l;a++){Fo.start.fromBufferAttribute(r,a),Fo.end.fromBufferAttribute(s,a),Fo.applyMatrix4(t);const c=new H,u=new H;gh.distanceSqToSegment(Fo.start,Fo.end,u,c),u.distanceTo(c)<Hm*.5&&e.push({point:u,pointOnLine:c,distance:gh.origin.distanceTo(u),object:i,face:null,faceIndex:a,uv:null,[SR]:null})}}function mhe(i,e,t){const n=e.projectionMatrix,s=i.material.resolution,o=i.matrixWorld,a=i.geometry,l=a.attributes.instanceStart,c=a.attributes.instanceEnd,u=Math.min(a.instanceCount,l.count),h=-e.near;gh.at(1,eh),eh.w=1,eh.applyMatrix4(e.matrixWorldInverse),eh.applyMatrix4(n),eh.multiplyScalar(1/eh.w),eh.x*=s.x/2,eh.y*=s.y/2,eh.z=0,hb.copy(eh),fb.multiplyMatrices(e.matrixWorldInverse,o);for(let f=0,d=u;f<d;f++){if(Po.fromBufferAttribute(l,f),Bo.fromBufferAttribute(c,f),Po.w=1,Bo.w=1,Po.applyMatrix4(fb),Bo.applyMatrix4(fb),Po.z>h&&Bo.z>h)continue;if(Po.z>h){const x=Po.z-Bo.z,C=(Po.z-h)/x;Po.lerp(Bo,C)}else if(Bo.z>h){const x=Bo.z-Po.z,C=(Bo.z-h)/x;Bo.lerp(Po,C)}Po.applyMatrix4(n),Bo.applyMatrix4(n),Po.multiplyScalar(1/Po.w),Bo.multiplyScalar(1/Bo.w),Po.x*=s.x/2,Po.y*=s.y/2,Bo.x*=s.x/2,Bo.y*=s.y/2,Fo.start.copy(Po),Fo.start.z=0,Fo.end.copy(Bo),Fo.end.z=0;const A=Fo.closestPointToPointParameter(hb,!0);Fo.at(A,W9);const g=un.lerp(Po.z,Bo.z,A),y=g>=-1&&g<=1,E=hb.distanceTo(W9)<Hm*.5;if(y&&E){Fo.start.fromBufferAttribute(l,f),Fo.end.fromBufferAttribute(c,f),Fo.start.applyMatrix4(o),Fo.end.applyMatrix4(o);const x=new H,C=new H;gh.distanceSqToSegment(Fo.start,Fo.end,C,x),t.push({point:C,pointOnLine:x,distance:gh.origin.distanceTo(C),object:i,face:null,faceIndex:f,uv:null,[SR]:null})}}}class OH extends It{constructor(e=new a4,t=new l4({color:Math.random()*16777215})){super(e,t),this.isLineSegments2=!0,this.type="LineSegments2"}computeLineDistances(){const e=this.geometry,t=e.attributes.instanceStart,n=e.attributes.instanceEnd,r=new Float32Array(2*t.count);for(let o=0,a=0,l=t.count;o<l;o++,a+=2)Q9.fromBufferAttribute(t,o),V9.fromBufferAttribute(n,o),r[a]=a===0?0:r[a-1],r[a+1]=r[a]+Q9.distanceTo(V9);const s=new MS(r,2,1);return e.setAttribute("instanceDistanceStart",new Ja(s,1,0)),e.setAttribute("instanceDistanceEnd",new Ja(s,1,1)),this}raycast(e,t){const n=this.material.worldUnits,r=e.camera;r===null&&!n&&console.error('LineSegments2: "Raycaster.camera" needs to be set in order to raycast against LineSegments2 while worldUnits is set to false.');const s=e.params.Line2!==void 0&&e.params.Line2.threshold||0;gh=e.ray;const o=this.matrixWorld,a=this.geometry,l=this.material;Hm=l.linewidth+s,a.boundingSphere===null&&a.computeBoundingSphere(),F3.copy(a.boundingSphere).applyMatrix4(o);let c;if(n)c=Hm*.5;else{const h=Math.max(r.near,F3.distanceToPoint(gh.origin));c=j9(r,h,l.resolution)}if(F3.radius+=c,gh.intersectsSphere(F3)===!1)return;a.boundingBox===null&&a.computeBoundingBox(),k3.copy(a.boundingBox).applyMatrix4(o);let u;if(n)u=Hm*.5;else{const h=Math.max(r.near,k3.distanceToPoint(gh.origin));u=j9(r,h,l.resolution)}k3.expandByScalar(u),gh.intersectsBox(k3)!==!1&&(n?phe(this,t):mhe(this,r,t))}onBeforeRender(e){const t=this.material.uniforms;t&&t.resolution&&(e.getViewport(ub),this.material.uniforms.resolution.value.set(ub.z,ub.w))}}class NH extends OH{constructor(e=new FH,t=new l4({color:Math.random()*16777215})){super(e,t),this.isLine2=!0,this.type="Line2"}}let O3;const db=()=>{if(O3)return O3;const i="B9h9z9tFBBBF8fL9gBB9gLaaaaaFa9gEaaaB9gFaFa9gEaaaFaEMcBFFFGGGEIIILF9wFFFLEFBFKNFaFCx/IFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBF8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBGy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBEn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBIi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBKI9z9iqlBOc+x8ycGBM/qQFTa8jUUUUBCU/EBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAGTkUUUBRNCUoBAG9uC/wgBZHKCUGAKCUG9JyRVAECFJRICBRcGXEXAcAF9PQFAVAFAclAcAVJAF9JyRMGXGXAG9FQBAMCbJHKC9wZRSAKCIrCEJCGrRQANCUGJRfCBRbAIRTEXGXAOATlAQ9PQBCBRISEMATAQJRIGXAS9FQBCBRtCBREEXGXAOAIlCi9PQBCBRISLMANCU/CBJAEJRKGXGXGXGXGXATAECKrJ2BBAtCKZrCEZfIBFGEBMAKhB83EBAKCNJhB83EBSEMAKAI2BIAI2BBHmCKrHYAYCE6HYy86BBAKCFJAICIJAYJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCGJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCEJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCIJAYAmJHY2BBAI2BFHmCKrHPAPCE6HPy86BBAKCLJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCKJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCOJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCNJAYAmJHY2BBAI2BGHmCKrHPAPCE6HPy86BBAKCVJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCcJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCMJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCSJAYAmJHm2BBAI2BEHICKrHYAYCE6HYy86BBAKCQJAmAYJHm2BBAICIrCEZHYAYCE6HYy86BBAKCfJAmAYJHm2BBAICGrCEZHYAYCE6HYy86BBAKCbJAmAYJHK2BBAICEZHIAICE6HIy86BBAKAIJRISGMAKAI2BNAI2BBHmCIrHYAYCb6HYy86BBAKCFJAICNJAYJHY2BBAmCbZHmAmCb6Hmy86BBAKCGJAYAmJHm2BBAI2BFHYCIrHPAPCb6HPy86BBAKCEJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCIJAmAYJHm2BBAI2BGHYCIrHPAPCb6HPy86BBAKCLJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCKJAmAYJHm2BBAI2BEHYCIrHPAPCb6HPy86BBAKCOJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCNJAmAYJHm2BBAI2BIHYCIrHPAPCb6HPy86BBAKCVJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCcJAmAYJHm2BBAI2BLHYCIrHPAPCb6HPy86BBAKCMJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCSJAmAYJHm2BBAI2BKHYCIrHPAPCb6HPy86BBAKCQJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCfJAmAYJHm2BBAI2BOHICIrHYAYCb6HYy86BBAKCbJAmAYJHK2BBAICbZHIAICb6HIy86BBAKAIJRISFMAKAI8pBB83BBAKCNJAICNJ8pBB83BBAICTJRIMAtCGJRtAECTJHEAS9JQBMMGXAIQBCBRISEMGXAM9FQBANAbJ2BBRtCBRKAfREEXAEANCU/CBJAKJ2BBHTCFrCBATCFZl9zAtJHt86BBAEAGJREAKCFJHKAM9HQBMMAfCFJRfAIRTAbCFJHbAG9HQBMMABAcAG9sJANCUGJAMAG9sTkUUUBpANANCUGJAMCaJAG9sJAGTkUUUBpMAMCBAIyAcJRcAIQBMC9+RKSFMCBC99AOAIlAGCAAGCA9Ly6yRKMALCU/EBJ8kUUUUBAKM+OmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUFT+JUUUBpALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM+lLKFaF99GaG99FaG99GXGXAGCI9HQBAF9FQFEXGXGX9DBBB8/9DBBB+/ABCGJHG1BB+yAB1BBHE+yHI+L+TABCFJHL1BBHK+yHO+L+THN9DBBBB9gHVyAN9DBB/+hANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE86BBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG86BBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG86BBABCIJRBAFCaJHFQBSGMMAF9FQBEXGXGX9DBBB8/9DBBB+/ABCIJHG8uFB+yAB8uFBHE+yHI+L+TABCGJHL8uFBHK+yHO+L+THN9DBBBB9gHVyAN9DB/+g6ANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE87FBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG87FBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG87FBABCNJRBAFCaJHFQBMMM/SEIEaE99EaF99GXAF9FQBCBREABRIEXGXGX9D/zI818/AICKJ8uFBHLCEq+y+VHKAI8uFB+y+UHO9DB/+g6+U9DBBB8/9DBBB+/AO9DBBBB9gy+SHN+L9DBBB9P9d9FQBAN+oRVSFMCUUUU94RVMAICIJ8uFBRcAICGJ8uFBRMABALCFJCEZAEqCFWJAV87FBGXGXAKAM+y+UHN9DB/+g6+U9DBBB8/9DBBB+/AN9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRMSFMCUUUU94RMMABALCGJCEZAEqCFWJAM87FBGXGXAKAc+y+UHK9DB/+g6+U9DBBB8/9DBBB+/AK9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRcSFMCUUUU94RcMABALCaJCEZAEqCFWJAc87FBGXGX9DBBU8/AOAO+U+TANAN+U+TAKAK+U+THO9DBBBBAO9DBBBB9gy+R9DB/+g6+U9DBBB8/+SHO+L9DBBB9P9d9FQBAO+oRcSFMCUUUU94RcMABALCEZAEqCFWJAc87FBAICNJRIAECIJREAFCaJHFQBMMM9JBGXAGCGrAF9sHF9FQBEXABAB8oGBHGCNWCN91+yAGCi91CnWCUUU/8EJ+++U84GBABCIJRBAFCaJHFQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEM/lFFFaGXGXAFABqCEZ9FQBABRESFMGXGXAGCT9PQBABRESFMABREEXAEAF8oGBjGBAECIJAFCIJ8oGBjGBAECNJAFCNJ8oGBjGBAECSJAFCSJ8oGBjGBAECTJREAFCTJRFAGC9wJHGCb9LQBMMAGCI9JQBEXAEAF8oGBjGBAFCIJRFAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF2BB86BBAECFJREAFCFJRFAGCaJHGQBMMABMoFFGaGXGXABCEZ9FQBABRESFMAFCgFZC+BwsN9sRIGXGXAGCT9PQBABRESFMABREEXAEAIjGBAECSJAIjGBAECNJAIjGBAECIJAIjGBAECTJREAGC9wJHGCb9LQBMMAGCI9JQBEXAEAIjGBAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF86BBAECFJREAGCaJHGQBMMABMMMFBCUNMIT9kBB",e="B9h9z9tFBBBFiI9gBB9gLaaaaaFa9gEaaaB9gFaFaEMcBBFBFFGGGEILF9wFFFLEFBFKNFaFCx/aFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBG8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBIy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBKi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBOn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBNI9z9iqlBVc+N9IcIBTEM9+FLa8jUUUUBCTlRBCBRFEXCBRGCBREEXABCNJAGJAECUaAFAGrCFZHIy86BBAEAIJREAGCFJHGCN9HQBMAFCx+YUUBJAE86BBAFCEWCxkUUBJAB8pEN83EBAFCFJHFCUG9HQBMMk8lLbaE97F9+FaL978jUUUUBCU/KBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAG/8cBBCUoBAG9uC/wgBZHKCUGAKCUG9JyRNAECFJRKCBRVGXEXAVAF9PQFANAFAVlAVANJAF9JyRcGXGXAG9FQBAcCbJHIC9wZHMCE9sRSAMCFWRQAICIrCEJCGrRfCBRbEXAKRTCBRtGXEXGXAOATlAf9PQBCBRKSLMALCU/CBJAtAM9sJRmATAfJRKCBREGXAMCoB9JQBAOAKlC/gB9JQBCBRIEXAmAIJREGXGXGXGXGXATAICKrJ2BBHYCEZfIBFGEBMAECBDtDMIBSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAEAKDBBBDMIBAKCTJRKMGXGXGXGXGXAYCGrCEZfIBFGEBMAECBDtDMITSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAEAKDBBBDMITAKCTJRKMGXGXGXGXGXAYCIrCEZfIBFGEBMAECBDtDMIASEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAEAKDBBBDMIAAKCTJRKMGXGXGXGXGXAYCKrfIBFGEBMAECBDtDMI8wSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCIJAeDeBJAYCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCNJAeDeBJAYCx+YUUBJ2BBJRKSFMAEAKDBBBDMI8wAKCTJRKMAICoBJREAICUFJAM9LQFAERIAOAKlC/fB9LQBMMGXAEAM9PQBAECErRIEXGXAOAKlCi9PQBCBRKSOMAmAEJRYGXGXGXGXGXATAECKrJ2BBAICKZrCEZfIBFGEBMAYCBDtDMIBSEMAYAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAYAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAYAKDBBBDMIBAKCTJRKMAICGJRIAECTJHEAM9JQBMMGXAK9FQBAKRTAtCFJHtCI6QGSFMMCBRKSEMGXAM9FQBALCUGJAbJREALAbJDBGBReCBRYEXAEALCU/CBJAYJHIDBIBHdCFD9tAdCFDbHPD9OD9hD9RHdAIAMJDBIBH8ZCFD9tA8ZAPD9OD9hD9RH8ZDQBTFtGmEYIPLdKeOnHpAIAQJDBIBHyCFD9tAyAPD9OD9hD9RHyAIASJDBIBH8cCFD9tA8cAPD9OD9hD9RH8cDQBTFtGmEYIPLdKeOnH8dDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGEAeD9uHeDyBjGBAEAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJHIAeApA8dDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHeDyBjGBAIAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJHIAeAdA8ZDQNiV8ZcpMyS8cQ8df8eb8fHdAyA8cDQNiV8ZcpMyS8cQ8df8eb8fH8ZDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGED9uHeDyBjGBAIAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJHIAeAdA8ZDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHeDyBjGBAIAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJREAYCTJHYAM9JQBMMAbCIJHbAG9JQBMMABAVAG9sJALCUGJAcAG9s/8cBBALALCUGJAcCaJAG9sJAG/8cBBMAcCBAKyAVJRVAKQBMC9+RKSFMCBC99AOAKlAGCAAGCA9Ly6yRKMALCU/KBJ8kUUUUBAKMNBT+BUUUBM+KmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUF/8MBALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM/dLEK97FaF97GXGXAGCI9HQBAF9FQFCBRGEXABABDBBBHECiD+rFCiD+sFD/6FHIAECND+rFCiD+sFD/6FAID/gFAECTD+rFCiD+sFD/6FHLD/gFD/kFD/lFHKCBDtD+2FHOAICUUUU94DtHND9OD9RD/kFHI9DBB/+hDYAIAID/mFAKAKD/mFALAOALAND9OD9RD/kFHIAID/mFD/kFD/kFD/jFD/nFHLD/mF9DBBX9LDYHOD/kFCgFDtD9OAECUUU94DtD9OD9QAIALD/mFAOD/kFCND+rFCU/+EDtD9OD9QAKALD/mFAOD/kFCTD+rFCUU/8ODtD9OD9QDMBBABCTJRBAGCIJHGAF9JQBSGMMAF9FQBCBRGEXABCTJHVAVDBBBHECBDtHOCUU98D8cFCUU98D8cEHND9OABDBBBHKAEDQILKOSQfbPden8c8d8e8fCggFDtD9OD/6FAKAEDQBFGENVcMTtmYi8ZpyHECTD+sFD/6FHID/gFAECTD+rFCTD+sFD/6FHLD/gFD/kFD/lFHE9DB/+g6DYALAEAOD+2FHOALCUUUU94DtHcD9OD9RD/kFHLALD/mFAEAED/mFAIAOAIAcD9OD9RD/kFHEAED/mFD/kFD/kFD/jFD/nFHID/mF9DBBX9LDYHOD/kFCTD+rFALAID/mFAOD/kFCggEDtD9OD9QHLAEAID/mFAOD/kFCaDbCBDnGCBDnECBDnKCBDnOCBDncCBDnMCBDnfCBDnbD9OHEDQNVi8ZcMpySQ8c8dfb8e8fD9QDMBBABAKAND9OALAEDQBFTtGEmYILPdKOenD9QDMBBABCAJRBAGCIJHGAF9JQBMMM/hEIGaF97FaL978jUUUUBCTlREGXAF9FQBCBRIEXAEABDBBBHLABCTJHKDBBBHODQILKOSQfbPden8c8d8e8fHNCTD+sFHVCID+rFDMIBAB9DBBU8/DY9D/zI818/DYAVCEDtD9QD/6FD/nFHVALAODQBFGENVcMTtmYi8ZpyHLCTD+rFCTD+sFD/6FD/mFHOAOD/mFAVALCTD+sFD/6FD/mFHcAcD/mFAVANCTD+rFCTD+sFD/6FD/mFHNAND/mFD/kFD/kFD/lFCBDtD+4FD/jF9DB/+g6DYHVD/mF9DBBX9LDYHLD/kFCggEDtHMD9OAcAVD/mFALD/kFCTD+rFD9QHcANAVD/mFALD/kFCTD+rFAOAVD/mFALD/kFAMD9OD9QHVDQBFTtGEmYILPdKOenHLD8dBAEDBIBDyB+t+J83EBABCNJALD8dFAEDBIBDyF+t+J83EBAKAcAVDQNVi8ZcMpySQ8c8dfb8e8fHVD8dBAEDBIBDyG+t+J83EBABCiJAVD8dFAEDBIBDyE+t+J83EBABCAJRBAICIJHIAF9JQBMMM9jFF97GXAGCGrAF9sHG9FQBCBRFEXABABDBBBHECND+rFCND+sFD/6FAECiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMBBABCTJRBAFCIJHFAG9JQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEMMMFBCUNMIT9tBB",t=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),n=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]);if(typeof WebAssembly!="object")return{supported:!1};let r=i;WebAssembly.validate(t)&&(r=e);let s;const o=WebAssembly.instantiate(a(r),{}).then(h=>{s=h.instance,s.exports.__wasm_call_ctors()});function a(h){const f=new Uint8Array(h.length);for(let m=0;m<h.length;++m){const A=h.charCodeAt(m);f[m]=A>96?A-71:A>64?A-65:A>47?A+4:A>46?63:62}let d=0;for(let m=0;m<h.length;++m)f[d++]=f[m]<60?n[f[m]]:(f[m]-60)*64+f[++m];return f.buffer.slice(0,d)}function l(h,f,d,m,A,g){const y=s.exports.sbrk,E=d+3&-4,x=y(E*m),C=y(A.length),T=new Uint8Array(s.exports.memory.buffer);T.set(A,C);const I=h(x,d,m,C,A.length);if(I===0&&g&&g(x,E,m),f.set(T.subarray(x,x+d*m)),y(x-y(0)),I!==0)throw new Error(`Malformed buffer data: ${I}`)}const c={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},u={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return O3={ready:o,supported:!0,decodeVertexBuffer(h,f,d,m,A){l(s.exports.meshopt_decodeVertexBuffer,h,f,d,m,s.exports[c[A]])},decodeIndexBuffer(h,f,d,m){l(s.exports.meshopt_decodeIndexBuffer,h,f,d,m)},decodeIndexSequence(h,f,d,m){l(s.exports.meshopt_decodeIndexSequence,h,f,d,m)},decodeGltfBuffer(h,f,d,m,A,g){l(s.exports[u[A]],h,f,d,m,s.exports[c[g]])}},O3},K9=i=>Symbol.iterator in i,$9=i=>"entries"in i,Y9=(i,e)=>{const t=i instanceof Map?i:new Map(i.entries()),n=e instanceof Map?e:new Map(e.entries());if(t.size!==n.size)return!1;for(const[r,s]of t)if(!n.has(r)||!Object.is(s,n.get(r)))return!1;return!0},ghe=(i,e)=>{const t=i[Symbol.iterator](),n=e[Symbol.iterator]();let r=t.next(),s=n.next();for(;!r.done&&!s.done;){if(!Object.is(r.value,s.value))return!1;r=t.next(),s=n.next()}return!!r.done&&!!s.done};function Ahe(i,e){return Object.is(i,e)?!0:typeof i!="object"||i===null||typeof e!="object"||e===null||Object.getPrototypeOf(i)!==Object.getPrototypeOf(e)?!1:K9(i)&&K9(e)?$9(i)&&$9(e)?Y9(i,e):ghe(i,e):Y9({entries:()=>Object.entries(i)},{entries:()=>Object.entries(e)})}const UH=w.createContext([]);function yhe({box:i,multiple:e,children:t,onChange:n,onChangePointerUp:r,border:s="1px solid #55aaff",backgroundColor:o="rgba(75, 160, 255, 0.1)",filter:a=c=>c,...l}){const[c,u]=w.useState(!1),{setEvents:h,camera:f,raycaster:d,gl:m,controls:A,size:g,get:y}=Ve(),[E,x]=w.useState(!1),[C,T]=w.useReducer((R,{object:P,shift:F})=>P===void 0?[]:Array.isArray(P)?P:F?R.includes(P)?R.filter(k=>k!==P):[P,...R]:R[0]===P?[]:[P],[]);w.useEffect(()=>{c?n==null||n(C):r==null||r(C)},[C,c]);const I=w.useCallback(R=>{R.stopPropagation(),T({object:a([R.object])[0],shift:e&&R.shiftKey})},[]),M=w.useCallback(R=>!E&&T({}),[E]),L=w.useRef(null);return w.useEffect(()=>{if(!i||!e)return;const R=new pue(f,L.current),P=document.createElement("div");P.style.pointerEvents="none",P.style.border=s,P.style.backgroundColor=o,P.style.position="fixed";const F=new Ue,k=new Ue,z=new Ue,U=y().events.enabled,W=A==null?void 0:A.enabled;let $=!1;function oe(J,ie){const{offsetX:re,offsetY:se}=J,{width:ge,height:xe}=g;ie.set(re/ge*2-1,-(se/xe)*2+1)}function X(J){var ie;A&&(A.enabled=!1),h({enabled:!1}),u($=!0),(ie=m.domElement.parentElement)==null||ie.appendChild(P),P.style.left=`${J.clientX}px`,P.style.top=`${J.clientY}px`,P.style.width="0px",P.style.height="0px",F.x=J.clientX,F.y=J.clientY}function Q(J){z.x=Math.max(F.x,J.clientX),z.y=Math.max(F.y,J.clientY),k.x=Math.min(F.x,J.clientX),k.y=Math.min(F.y,J.clientY),P.style.left=`${k.x}px`,P.style.top=`${k.y}px`,P.style.width=`${z.x-k.x}px`,P.style.height=`${z.y-k.y}px`}function Y(){if($){var J;A&&(A.enabled=W),h({enabled:U}),u($=!1),(J=P.parentElement)==null||J.removeChild(P)}}function O(J){J.shiftKey&&(X(J),oe(J,R.startPoint))}let K=[];function te(J){if($){Q(J),oe(J,R.endPoint);const ie=R.select().sort(re=>re.uuid).filter(re=>re.isMesh);Ahe(ie,K)||(K=ie,T({object:a(ie)}))}}function q(J){$&&Y()}return document.addEventListener("pointerdown",O,{passive:!0}),document.addEventListener("pointermove",te,{passive:!0,capture:!0}),document.addEventListener("pointerup",q,{passive:!0}),()=>{document.removeEventListener("pointerdown",O),document.removeEventListener("pointermove",te,!0),document.removeEventListener("pointerup",q)}},[g.width,g.height,d,f,A,m]),w.createElement("group",ot({ref:L,onClick:I,onPointerOver:()=>x(!0),onPointerOut:()=>x(!1),onPointerMissed:M},l),w.createElement(UH.Provider,{value:C},t))}function vhe(){return w.useContext(UH)}const zH=w.forwardRef(function({children:e,follow:t=!0,lockX:n=!1,lockY:r=!1,lockZ:s=!1,...o},a){const l=w.useRef(null),c=w.useRef(null),u=new Xt;return Kt(({camera:h})=>{if(!t||!c.current)return;const f=l.current.rotation.clone();c.current.updateMatrix(),c.current.updateWorldMatrix(!1,!1),c.current.getWorldQuaternion(u),h.getWorldQuaternion(l.current.quaternion).premultiply(u.invert()),n&&(l.current.rotation.x=f.x),r&&(l.current.rotation.y=f.y),s&&(l.current.rotation.z=f.z)}),w.useImperativeHandle(a,()=>c.current,[]),w.createElement("group",ot({ref:c},o),w.createElement("group",{ref:l},e))}),xhe=w.forwardRef(({children:i,depth:e=-1,...t},n)=>{const r=w.useRef(null);return w.useImperativeHandle(n,()=>r.current,[]),Kt(({camera:s})=>{r.current.quaternion.copy(s.quaternion),r.current.position.copy(s.position)}),w.createElement("group",ot({ref:r},t),w.createElement("group",{"position-z":-e},i))}),Ehe=new H,_he=new H,She=new H,whe=(i,e,t)=>{const n=t.width/2,r=t.height/2;e.updateMatrixWorld(!1);const s=i.project(e);return s.x=s.x*n+n,s.y=-(s.y*r)+r,s},Che=(i,e,t,n=1)=>{const r=Ehe.set(i.x/t.width*2-1,-(i.y/t.height)*2+1,n);return r.unproject(e),r},c4=(i,e,t,n)=>{const r=whe(She.copy(i),t,n);let s=0;for(let o=0;o<2;++o){const a=_he.copy(r).setComponent(o,r.getComponent(o)+e),l=Che(a,t,n,a.z);s=Math.max(s,i.distanceTo(l))}return s},The=new H,bhe=w.forwardRef(({scale:i=1,...e},t)=>{const n=w.useRef(null);return w.useImperativeHandle(t,()=>n.current,[]),Kt(r=>{const s=n.current;if(!s)return;const o=c4(s.getWorldPosition(The),i,r.camera,r.size);s.scale.setScalar(o*i)}),w.createElement("object3D",ot({ref:n},e))}),Cu=w.forwardRef(function({points:e,color:t=16777215,vertexColors:n,linewidth:r,lineWidth:s,segments:o,dashed:a,...l},c){var u,h;const f=Ve(y=>y.size),d=w.useMemo(()=>o?new OH:new NH,[o]),[m]=w.useState(()=>new l4),A=(n==null||(u=n[0])==null?void 0:u.length)===4?4:3,g=w.useMemo(()=>{const y=o?new a4:new FH,E=e.map(x=>{const C=Array.isArray(x);return x instanceof H||x instanceof Rn?[x.x,x.y,x.z]:x instanceof Ue?[x.x,x.y,0]:C&&x.length===3?[x[0],x[1],x[2]]:C&&x.length===2?[x[0],x[1],0]:x});if(y.setPositions(E.flat()),n){t=16777215;const x=n.map(C=>C instanceof ut?C.toArray():C);y.setColors(x.flat(),A)}return y},[e,o,n,A]);return w.useLayoutEffect(()=>{d.computeLineDistances()},[e,d]),w.useLayoutEffect(()=>{a?m.defines.USE_DASH="":delete m.defines.USE_DASH,m.needsUpdate=!0},[a,m]),w.useEffect(()=>()=>{g.dispose(),m.dispose()},[g]),w.createElement("primitive",ot({object:d,ref:c},l),w.createElement("primitive",{object:g,attach:"geometry"}),w.createElement("primitive",ot({object:m,attach:"material",color:t,vertexColors:!!n,resolution:[f.width,f.height],linewidth:(h=r??s)!==null&&h!==void 0?h:1,dashed:a,transparent:A===4},l)))}),Ihe=new H,Mhe=w.forwardRef(function({start:e=[0,0,0],end:t=[0,0,0],mid:n,segments:r=20,...s},o){const a=w.useRef(null);w.useImperativeHandle(o,()=>a.current);const[l]=w.useState(()=>new Pw(void 0,void 0,void 0)),c=w.useCallback((h,f,d,m=20)=>(h instanceof H?l.v0.copy(h):l.v0.set(...h),f instanceof H?l.v2.copy(f):l.v2.set(...f),d instanceof H?l.v1.copy(d):Array.isArray(d)?l.v1.set(...d):l.v1.copy(l.v0.clone().add(l.v2.clone().sub(l.v0)).add(Ihe.set(0,l.v0.y-l.v2.y,0))),l.getPoints(m)),[]);w.useLayoutEffect(()=>{a.current.setPoints=(h,f,d)=>{const m=c(h,f,d);a.current.geometry&&a.current.geometry.setPositions(m.map(A=>A.toArray()).flat())}},[]);const u=w.useMemo(()=>c(e,t,n,r),[e,t,n,r]);return w.createElement(Cu,ot({ref:a,points:u},s))}),Rhe=w.forwardRef(function({start:e,end:t,midA:n,midB:r,segments:s=20,...o},a){const l=w.useMemo(()=>{const c=e instanceof H?e:new H(...e),u=t instanceof H?t:new H(...t),h=n instanceof H?n:new H(...n),f=r instanceof H?r:new H(...r);return new P6(c,h,f,u).getPoints(s)},[e,t,n,r,s]);return w.createElement(Cu,ot({ref:a,points:l},o))}),Lhe=w.forwardRef(function({points:e,closed:t=!1,curveType:n="centripetal",tension:r=.5,segments:s=20,vertexColors:o,...a},l){const c=w.useMemo(()=>{const f=e.map(d=>d instanceof H?d:new H(...d));return new Lw(f,t,n,r)},[e,t,n,r]),u=w.useMemo(()=>c.getPoints(s),[c,s]),h=w.useMemo(()=>{if(!o||o.length<2)return;if(o.length===s+1)return o;const f=o.map(A=>A instanceof ut?A:new ut(...A));t&&f.push(f[0].clone());const d=[f[0]],m=s/(f.length-1);for(let A=1;A<s;A++){const g=A%m/m,y=Math.floor(A/m);d.push(f[y].clone().lerp(f[y+1],g))}return d.push(f[f.length-1]),d},[o,s]);return w.createElement(Cu,ot({ref:l,points:u,vertexColors:h},a))}),Phe=w.forwardRef(({url:i,distance:e=1,loop:t=!0,autoplay:n,...r},s)=>{const o=w.useRef(null);w.useImperativeHandle(s,()=>o.current,[]);const a=Ve(({camera:u})=>u),[l]=w.useState(()=>new vz),c=cr(yz,i);return w.useEffect(()=>{const u=o.current;u&&(u.setBuffer(c),u.setRefDistance(e),u.setLoop(t),n&&!u.isPlaying&&u.play())},[c,a,e,t]),w.useEffect(()=>{const u=o.current;return a.add(l),()=>{a.remove(l),u&&(u.isPlaying&&u.stop(),u.source&&u.source._connected&&u.disconnect())}},[]),w.createElement("positionalAudio",ot({ref:o,args:[l]},r))});function Bhe(){var i=Object.create(null);function e(r,s){var o=r.id,a=r.name,l=r.dependencies;l===void 0&&(l=[]);var c=r.init;c===void 0&&(c=function(){});var u=r.getTransferables;if(u===void 0&&(u=null),!i[o])try{l=l.map(function(f){return f&&f.isWorkerModule&&(e(f,function(d){if(d instanceof Error)throw d}),f=i[f.id].value),f}),c=n("<"+a+">.init",c),u&&(u=n("<"+a+">.getTransferables",u));var h=null;typeof c=="function"?h=c.apply(void 0,l):console.error("worker module init function failed to rehydrate"),i[o]={id:o,value:h,getTransferables:u},s(h)}catch(f){f&&f.noLog||console.error(f),s(f)}}function t(r,s){var o,a=r.id,l=r.args;(!i[a]||typeof i[a].value!="function")&&s(new Error("Worker module "+a+": not found or its 'init' did not return a function"));try{var c=(o=i[a]).value.apply(o,l);c&&typeof c.then=="function"?c.then(u,function(h){return s(h instanceof Error?h:new Error(""+h))}):u(c)}catch(h){s(h)}function u(h){try{var f=i[a].getTransferables&&i[a].getTransferables(h);(!f||!Array.isArray(f)||!f.length)&&(f=void 0),s(h,f)}catch(d){console.error(d),s(d)}}}function n(r,s){var o=void 0;self.troikaDefine=function(l){return o=l};var a=URL.createObjectURL(new Blob(["/** "+r.replace(/\*/g,"")+` **/

troikaDefine(
`+s+`
)`],{type:"application/javascript"}));try{importScripts(a)}catch(l){console.error(l)}return URL.revokeObjectURL(a),delete self.troikaDefine,o}self.addEventListener("message",function(r){var s=r.data,o=s.messageId,a=s.action,l=s.data;try{a==="registerModule"&&e(l,function(c){c instanceof Error?postMessage({messageId:o,success:!1,error:c.message}):postMessage({messageId:o,success:!0,result:{isCallable:typeof c=="function"}})}),a==="callModule"&&t(l,function(c,u){c instanceof Error?postMessage({messageId:o,success:!1,error:c.message}):postMessage({messageId:o,success:!0,result:c},u||void 0)})}catch(c){postMessage({messageId:o,success:!1,error:c.stack})}})}function Dhe(i){var e=function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];return e._getInitResult().then(function(r){if(typeof r=="function")return r.apply(void 0,t);throw new Error("Worker module function was called but `init` did not return a callable function")})};return e._getInitResult=function(){var t=i.dependencies,n=i.init;t=Array.isArray(t)?t.map(function(s){return s&&(s=s.onMainThread||s,s._getInitResult&&(s=s._getInitResult())),s}):[];var r=Promise.all(t).then(function(s){return n.apply(null,s)});return e._getInitResult=function(){return r},r},e}var GH=function(){var i=!1;if(typeof window<"u"&&typeof window.document<"u")try{var e=new Worker(URL.createObjectURL(new Blob([""],{type:"application/javascript"})));e.terminate(),i=!0}catch(t){console.log("Troika createWorkerModule: web workers not allowed; falling back to main thread execution. Cause: ["+t.message+"]")}return GH=function(){return i},i},khe=0,Fhe=0,pb=!1,r2=Object.create(null),s2=Object.create(null),o5=Object.create(null);function bA(i){if((!i||typeof i.init!="function")&&!pb)throw new Error("requires `options.init` function");var e=i.dependencies,t=i.init,n=i.getTransferables,r=i.workerId,s=Dhe(i);r==null&&(r="#default");var o="workerModule"+ ++khe,a=i.name||o,l=null;e=e&&e.map(function(u){return typeof u=="function"&&!u.workerModuleData&&(pb=!0,u=bA({workerId:r,name:"<"+a+"> function dependency: "+u.name,init:`function(){return (
`+X_(u)+`
)}`}),pb=!1),u&&u.workerModuleData&&(u=u.workerModuleData),u});function c(){for(var u=[],h=arguments.length;h--;)u[h]=arguments[h];if(!GH())return s.apply(void 0,u);if(!l){l=X9(r,"registerModule",c.workerModuleData);var f=function(){l=null,s2[r].delete(f)};(s2[r]||(s2[r]=new Set)).add(f)}return l.then(function(d){var m=d.isCallable;if(m)return X9(r,"callModule",{id:o,args:u});throw new Error("Worker module function was called but `init` did not return a callable function")})}return c.workerModuleData={isWorkerModule:!0,id:o,name:a,dependencies:e,init:X_(t),getTransferables:n&&X_(n)},c.onMainThread=s,c}function Ohe(i){s2[i]&&s2[i].forEach(function(e){e()}),r2[i]&&(r2[i].terminate(),delete r2[i])}function X_(i){var e=i.toString();return!/^function/.test(e)&&/^\w+\s*\(/.test(e)&&(e="function "+e),e}function Nhe(i){var e=r2[i];if(!e){var t=X_(Bhe);e=r2[i]=new Worker(URL.createObjectURL(new Blob(["/** Worker Module Bootstrap: "+i.replace(/\*/g,"")+` **/

;(`+t+")()"],{type:"application/javascript"}))),e.onmessage=function(n){var r=n.data,s=r.messageId,o=o5[s];if(!o)throw new Error("WorkerModule response with empty or unknown messageId");delete o5[s],o(r)}}return e}function X9(i,e,t){return new Promise(function(n,r){var s=++Fhe;o5[s]=function(o){o.success?n(o.result):r(new Error("Error in worker "+e+" call: "+o.error))},Nhe(i).postMessage({messageId:s,action:e,data:t})})}function HH(){var i=(function(e){function t(Q,Y,O,K,te,q,J,ie){var re=1-J;ie.x=re*re*Q+2*re*J*O+J*J*te,ie.y=re*re*Y+2*re*J*K+J*J*q}function n(Q,Y,O,K,te,q,J,ie,re,se){var ge=1-re;se.x=ge*ge*ge*Q+3*ge*ge*re*O+3*ge*re*re*te+re*re*re*J,se.y=ge*ge*ge*Y+3*ge*ge*re*K+3*ge*re*re*q+re*re*re*ie}function r(Q,Y){for(var O=/([MLQCZ])([^MLQCZ]*)/g,K,te,q,J,ie;K=O.exec(Q);){var re=K[2].replace(/^\s*|\s*$/g,"").split(/[,\s]+/).map(function(se){return parseFloat(se)});switch(K[1]){case"M":J=te=re[0],ie=q=re[1];break;case"L":(re[0]!==J||re[1]!==ie)&&Y("L",J,ie,J=re[0],ie=re[1]);break;case"Q":{Y("Q",J,ie,J=re[2],ie=re[3],re[0],re[1]);break}case"C":{Y("C",J,ie,J=re[4],ie=re[5],re[0],re[1],re[2],re[3]);break}case"Z":(J!==te||ie!==q)&&Y("L",J,ie,te,q);break}}}function s(Q,Y,O){O===void 0&&(O=16);var K={x:0,y:0};r(Q,function(te,q,J,ie,re,se,ge,xe,pe){switch(te){case"L":Y(q,J,ie,re);break;case"Q":{for(var ce=q,we=J,Ee=1;Ee<O;Ee++)t(q,J,se,ge,ie,re,Ee/(O-1),K),Y(ce,we,K.x,K.y),ce=K.x,we=K.y;break}case"C":{for(var ve=q,Ae=J,Le=1;Le<O;Le++)n(q,J,se,ge,xe,pe,ie,re,Le/(O-1),K),Y(ve,Ae,K.x,K.y),ve=K.x,Ae=K.y;break}}})}var o="precision highp float;attribute vec2 aUV;varying vec2 vUV;void main(){vUV=aUV;gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}",a="precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){gl_FragColor=texture2D(tex,vUV);}",l=new WeakMap,c={premultipliedAlpha:!1,preserveDrawingBuffer:!0,antialias:!1,depth:!1};function u(Q,Y){var O=Q.getContext?Q.getContext("webgl",c):Q,K=l.get(O);if(!K){let ge=function(ve){var Ae=q[ve];if(!Ae&&(Ae=q[ve]=O.getExtension(ve),!Ae))throw new Error(ve+" not supported");return Ae},xe=function(ve,Ae){var Le=O.createShader(Ae);return O.shaderSource(Le,ve),O.compileShader(Le),Le},pe=function(ve,Ae,Le,Te){if(!J[ve]){var ne={},V={},de=O.createProgram();O.attachShader(de,xe(Ae,O.VERTEX_SHADER)),O.attachShader(de,xe(Le,O.FRAGMENT_SHADER)),O.linkProgram(de),J[ve]={program:de,transaction:function(Be){O.useProgram(de),Be({setUniform:function(He,it){for(var $e=[],ct=arguments.length-2;ct-- >0;)$e[ct]=arguments[ct+2];var pt=V[it]||(V[it]=O.getUniformLocation(de,it));O["uniform"+He].apply(O,[pt].concat($e))},setAttribute:function(He,it,$e,ct,pt){var We=ne[He];We||(We=ne[He]={buf:O.createBuffer(),loc:O.getAttribLocation(de,He),data:null}),O.bindBuffer(O.ARRAY_BUFFER,We.buf),O.vertexAttribPointer(We.loc,it,O.FLOAT,!1,0,0),O.enableVertexAttribArray(We.loc),te?O.vertexAttribDivisor(We.loc,ct):ge("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(We.loc,ct),pt!==We.data&&(O.bufferData(O.ARRAY_BUFFER,pt,$e),We.data=pt)}})}}}J[ve].transaction(Te)},ce=function(ve,Ae){re++;try{O.activeTexture(O.TEXTURE0+re);var Le=ie[ve];Le||(Le=ie[ve]=O.createTexture(),O.bindTexture(O.TEXTURE_2D,Le),O.texParameteri(O.TEXTURE_2D,O.TEXTURE_MIN_FILTER,O.NEAREST),O.texParameteri(O.TEXTURE_2D,O.TEXTURE_MAG_FILTER,O.NEAREST)),O.bindTexture(O.TEXTURE_2D,Le),Ae(Le,re)}finally{re--}},we=function(ve,Ae,Le){var Te=O.createFramebuffer();se.push(Te),O.bindFramebuffer(O.FRAMEBUFFER,Te),O.activeTexture(O.TEXTURE0+Ae),O.bindTexture(O.TEXTURE_2D,ve),O.framebufferTexture2D(O.FRAMEBUFFER,O.COLOR_ATTACHMENT0,O.TEXTURE_2D,ve,0);try{Le(Te)}finally{O.deleteFramebuffer(Te),O.bindFramebuffer(O.FRAMEBUFFER,se[--se.length-1]||null)}},Ee=function(){q={},J={},ie={},re=-1,se.length=0};var te=typeof WebGL2RenderingContext<"u"&&O instanceof WebGL2RenderingContext,q={},J={},ie={},re=-1,se=[];O.canvas.addEventListener("webglcontextlost",function(ve){Ee(),ve.preventDefault()},!1),l.set(O,K={gl:O,isWebGL2:te,getExtension:ge,withProgram:pe,withTexture:ce,withTextureFramebuffer:we,handleContextLoss:Ee})}Y(K)}function h(Q,Y,O,K,te,q,J,ie){J===void 0&&(J=15),ie===void 0&&(ie=null),u(Q,function(re){var se=re.gl,ge=re.withProgram,xe=re.withTexture;xe("copy",function(pe,ce){se.texImage2D(se.TEXTURE_2D,0,se.RGBA,te,q,0,se.RGBA,se.UNSIGNED_BYTE,Y),ge("copy",o,a,function(we){var Ee=we.setUniform,ve=we.setAttribute;ve("aUV",2,se.STATIC_DRAW,0,new Float32Array([0,0,2,0,0,2])),Ee("1i","image",ce),se.bindFramebuffer(se.FRAMEBUFFER,ie||null),se.disable(se.BLEND),se.colorMask(J&8,J&4,J&2,J&1),se.viewport(O,K,te,q),se.scissor(O,K,te,q),se.drawArrays(se.TRIANGLES,0,3)})})})}function f(Q,Y,O){var K=Q.width,te=Q.height;u(Q,function(q){var J=q.gl,ie=new Uint8Array(K*te*4);J.readPixels(0,0,K,te,J.RGBA,J.UNSIGNED_BYTE,ie),Q.width=Y,Q.height=O,h(J,ie,0,0,K,te)})}var d=Object.freeze({__proto__:null,withWebGLContext:u,renderImageData:h,resizeWebGLCanvasWithoutClearing:f});function m(Q,Y,O,K,te,q){q===void 0&&(q=1);var J=new Uint8Array(Q*Y),ie=K[2]-K[0],re=K[3]-K[1],se=[];s(O,function(ve,Ae,Le,Te){se.push({x1:ve,y1:Ae,x2:Le,y2:Te,minX:Math.min(ve,Le),minY:Math.min(Ae,Te),maxX:Math.max(ve,Le),maxY:Math.max(Ae,Te)})}),se.sort(function(ve,Ae){return ve.maxX-Ae.maxX});for(var ge=0;ge<Q;ge++)for(var xe=0;xe<Y;xe++){var pe=we(K[0]+ie*(ge+.5)/Q,K[1]+re*(xe+.5)/Y),ce=Math.pow(1-Math.abs(pe)/te,q)/2;pe<0&&(ce=1-ce),ce=Math.max(0,Math.min(255,Math.round(ce*255))),J[xe*Q+ge]=ce}return J;function we(ve,Ae){for(var Le=1/0,Te=1/0,ne=se.length;ne--;){var V=se[ne];if(V.maxX+Te<=ve)break;if(ve+Te>V.minX&&Ae-Te<V.maxY&&Ae+Te>V.minY){var de=y(ve,Ae,V.x1,V.y1,V.x2,V.y2);de<Le&&(Le=de,Te=Math.sqrt(Le))}}return Ee(ve,Ae)&&(Te=-Te),Te}function Ee(ve,Ae){for(var Le=0,Te=se.length;Te--;){var ne=se[Te];if(ne.maxX<=ve)break;var V=ne.y1>Ae!=ne.y2>Ae&&ve<(ne.x2-ne.x1)*(Ae-ne.y1)/(ne.y2-ne.y1)+ne.x1;V&&(Le+=ne.y1<ne.y2?1:-1)}return Le!==0}}function A(Q,Y,O,K,te,q,J,ie,re,se){q===void 0&&(q=1),ie===void 0&&(ie=0),re===void 0&&(re=0),se===void 0&&(se=0),g(Q,Y,O,K,te,q,J,null,ie,re,se)}function g(Q,Y,O,K,te,q,J,ie,re,se,ge){q===void 0&&(q=1),re===void 0&&(re=0),se===void 0&&(se=0),ge===void 0&&(ge=0);for(var xe=m(Q,Y,O,K,te,q),pe=new Uint8Array(xe.length*4),ce=0;ce<xe.length;ce++)pe[ce*4+ge]=xe[ce];h(J,pe,re,se,Q,Y,1<<3-ge,ie)}function y(Q,Y,O,K,te,q){var J=te-O,ie=q-K,re=J*J+ie*ie,se=re?Math.max(0,Math.min(1,((Q-O)*J+(Y-K)*ie)/re)):0,ge=Q-(O+se*J),xe=Y-(K+se*ie);return ge*ge+xe*xe}var E=Object.freeze({__proto__:null,generate:m,generateIntoCanvas:A,generateIntoFramebuffer:g}),x="precision highp float;uniform vec4 uGlyphBounds;attribute vec2 aUV;attribute vec4 aLineSegment;varying vec4 vLineSegment;varying vec2 vGlyphXY;void main(){vLineSegment=aLineSegment;vGlyphXY=mix(uGlyphBounds.xy,uGlyphBounds.zw,aUV);gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}",C="precision highp float;uniform vec4 uGlyphBounds;uniform float uMaxDistance;uniform float uExponent;varying vec4 vLineSegment;varying vec2 vGlyphXY;float absDistToSegment(vec2 point,vec2 lineA,vec2 lineB){vec2 lineDir=lineB-lineA;float lenSq=dot(lineDir,lineDir);float t=lenSq==0.0 ? 0.0 : clamp(dot(point-lineA,lineDir)/lenSq,0.0,1.0);vec2 linePt=lineA+t*lineDir;return distance(point,linePt);}void main(){vec4 seg=vLineSegment;vec2 p=vGlyphXY;float dist=absDistToSegment(p,seg.xy,seg.zw);float val=pow(1.0-clamp(dist/uMaxDistance,0.0,1.0),uExponent)*0.5;bool crossing=(seg.y>p.y!=seg.w>p.y)&&(p.x<(seg.z-seg.x)*(p.y-seg.y)/(seg.w-seg.y)+seg.x);bool crossingUp=crossing&&vLineSegment.y<vLineSegment.w;gl_FragColor=vec4(crossingUp ? 1.0/255.0 : 0.0,crossing&&!crossingUp ? 1.0/255.0 : 0.0,0.0,val);}",T="precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){vec4 color=texture2D(tex,vUV);bool inside=color.r!=color.g;float val=inside ? 1.0-color.a : color.a;gl_FragColor=vec4(val);}",I=new Float32Array([0,0,2,0,0,2]),M=null,L=!1,R={},P=new WeakMap;function F(Q){if(!L&&!W(Q))throw new Error("WebGL generation not supported")}function k(Q,Y,O,K,te,q,J){if(q===void 0&&(q=1),J===void 0&&(J=null),!J&&(J=M,!J)){var ie=typeof OffscreenCanvas=="function"?new OffscreenCanvas(1,1):typeof document<"u"?document.createElement("canvas"):null;if(!ie)throw new Error("OffscreenCanvas or DOM canvas not supported");J=M=ie.getContext("webgl",{depth:!1})}F(J);var re=new Uint8Array(Q*Y*4);u(J,function(pe){var ce=pe.gl,we=pe.withTexture,Ee=pe.withTextureFramebuffer;we("readable",function(ve,Ae){ce.texImage2D(ce.TEXTURE_2D,0,ce.RGBA,Q,Y,0,ce.RGBA,ce.UNSIGNED_BYTE,null),Ee(ve,Ae,function(Le){U(Q,Y,O,K,te,q,ce,Le,0,0,0),ce.readPixels(0,0,Q,Y,ce.RGBA,ce.UNSIGNED_BYTE,re)})})});for(var se=new Uint8Array(Q*Y),ge=0,xe=0;ge<re.length;ge+=4)se[xe++]=re[ge];return se}function z(Q,Y,O,K,te,q,J,ie,re,se){q===void 0&&(q=1),ie===void 0&&(ie=0),re===void 0&&(re=0),se===void 0&&(se=0),U(Q,Y,O,K,te,q,J,null,ie,re,se)}function U(Q,Y,O,K,te,q,J,ie,re,se,ge){q===void 0&&(q=1),re===void 0&&(re=0),se===void 0&&(se=0),ge===void 0&&(ge=0),F(J);var xe=[];s(O,function(pe,ce,we,Ee){xe.push(pe,ce,we,Ee)}),xe=new Float32Array(xe),u(J,function(pe){var ce=pe.gl,we=pe.isWebGL2,Ee=pe.getExtension,ve=pe.withProgram,Ae=pe.withTexture,Le=pe.withTextureFramebuffer,Te=pe.handleContextLoss;if(Ae("rawDistances",function(ne,V){(Q!==ne._lastWidth||Y!==ne._lastHeight)&&ce.texImage2D(ce.TEXTURE_2D,0,ce.RGBA,ne._lastWidth=Q,ne._lastHeight=Y,0,ce.RGBA,ce.UNSIGNED_BYTE,null),ve("main",x,C,function(de){var Re=de.setAttribute,Be=de.setUniform,Fe=!we&&Ee("ANGLE_instanced_arrays"),He=!we&&Ee("EXT_blend_minmax");Re("aUV",2,ce.STATIC_DRAW,0,I),Re("aLineSegment",4,ce.DYNAMIC_DRAW,1,xe),Be.apply(void 0,["4f","uGlyphBounds"].concat(K)),Be("1f","uMaxDistance",te),Be("1f","uExponent",q),Le(ne,V,function(it){ce.enable(ce.BLEND),ce.colorMask(!0,!0,!0,!0),ce.viewport(0,0,Q,Y),ce.scissor(0,0,Q,Y),ce.blendFunc(ce.ONE,ce.ONE),ce.blendEquationSeparate(ce.FUNC_ADD,we?ce.MAX:He.MAX_EXT),ce.clear(ce.COLOR_BUFFER_BIT),we?ce.drawArraysInstanced(ce.TRIANGLES,0,3,xe.length/4):Fe.drawArraysInstancedANGLE(ce.TRIANGLES,0,3,xe.length/4)})}),ve("post",o,T,function(de){de.setAttribute("aUV",2,ce.STATIC_DRAW,0,I),de.setUniform("1i","tex",V),ce.bindFramebuffer(ce.FRAMEBUFFER,ie),ce.disable(ce.BLEND),ce.colorMask(ge===0,ge===1,ge===2,ge===3),ce.viewport(re,se,Q,Y),ce.scissor(re,se,Q,Y),ce.drawArrays(ce.TRIANGLES,0,3)})}),ce.isContextLost())throw Te(),new Error("webgl context lost")})}function W(Q){var Y=!Q||Q===M?R:Q.canvas||Q,O=P.get(Y);if(O===void 0){L=!0;var K=null;try{var te=[97,106,97,61,99,137,118,80,80,118,137,99,61,97,106,97],q=k(4,4,"M8,8L16,8L24,24L16,24Z",[0,0,32,32],24,1,Q);O=q&&te.length===q.length&&q.every(function(J,ie){return J===te[ie]}),O||(K="bad trial run results",console.info(te,q))}catch(J){O=!1,K=J.message}K&&console.warn("WebGL SDF generation not supported:",K),L=!1,P.set(Y,O)}return O}var $=Object.freeze({__proto__:null,generate:k,generateIntoCanvas:z,generateIntoFramebuffer:U,isSupported:W});function oe(Q,Y,O,K,te,q){te===void 0&&(te=Math.max(K[2]-K[0],K[3]-K[1])/2),q===void 0&&(q=1);try{return k.apply($,arguments)}catch(J){return console.info("WebGL SDF generation failed, falling back to JS",J),m.apply(E,arguments)}}function X(Q,Y,O,K,te,q,J,ie,re,se){te===void 0&&(te=Math.max(K[2]-K[0],K[3]-K[1])/2),q===void 0&&(q=1),ie===void 0&&(ie=0),re===void 0&&(re=0),se===void 0&&(se=0);try{return z.apply($,arguments)}catch(ge){return console.info("WebGL SDF generation failed, falling back to JS",ge),A.apply(E,arguments)}}return e.forEachPathCommand=r,e.generate=oe,e.generateIntoCanvas=X,e.javascript=E,e.pathToLineSegments=s,e.webgl=$,e.webglUtils=d,Object.defineProperty(e,"__esModule",{value:!0}),e})({});return i}function Uhe(){var i=(function(e){var t={R:"13k,1a,2,3,3,2+1j,ch+16,a+1,5+2,2+n,5,a,4,6+16,4+3,h+1b,4mo,179q,2+9,2+11,2i9+7y,2+68,4,3+4,5+13,4+3,2+4k,3+29,8+cf,1t+7z,w+17,3+3m,1t+3z,16o1+5r,8+30,8+mc,29+1r,29+4v,75+73",EN:"1c+9,3d+1,6,187+9,513,4+5,7+9,sf+j,175h+9,qw+q,161f+1d,4xt+a,25i+9",ES:"17,2,6dp+1,f+1,av,16vr,mx+1,4o,2",ET:"z+2,3h+3,b+1,ym,3e+1,2o,p4+1,8,6u,7c,g6,1wc,1n9+4,30+1b,2n,6d,qhx+1,h0m,a+1,49+2,63+1,4+1,6bb+3,12jj",AN:"16o+5,2j+9,2+1,35,ed,1ff2+9,87+u",CS:"18,2+1,b,2u,12k,55v,l,17v0,2,3,53,2+1,b",B:"a,3,f+2,2v,690",S:"9,2,k",WS:"c,k,4f4,1vk+a,u,1j,335",ON:"x+1,4+4,h+5,r+5,r+3,z,5+3,2+1,2+1,5,2+2,3+4,o,w,ci+1,8+d,3+d,6+8,2+g,39+1,9,6+1,2,33,b8,3+1,3c+1,7+1,5r,b,7h+3,sa+5,2,3i+6,jg+3,ur+9,2v,ij+1,9g+9,7+a,8m,4+1,49+x,14u,2+2,c+2,e+2,e+2,e+1,i+n,e+e,2+p,u+2,e+2,36+1,2+3,2+1,b,2+2,6+5,2,2,2,h+1,5+4,6+3,3+f,16+2,5+3l,3+81,1y+p,2+40,q+a,m+13,2r+ch,2+9e,75+hf,3+v,2+2w,6e+5,f+6,75+2a,1a+p,2+2g,d+5x,r+b,6+3,4+o,g,6+1,6+2,2k+1,4,2j,5h+z,1m+1,1e+f,t+2,1f+e,d+3,4o+3,2s+1,w,535+1r,h3l+1i,93+2,2s,b+1,3l+x,2v,4g+3,21+3,kz+1,g5v+1,5a,j+9,n+v,2,3,2+8,2+1,3+2,2,3,46+1,4+4,h+5,r+5,r+a,3h+2,4+6,b+4,78,1r+24,4+c,4,1hb,ey+6,103+j,16j+c,1ux+7,5+g,fsh,jdq+1t,4,57+2e,p1,1m,1m,1m,1m,4kt+1,7j+17,5+2r,d+e,3+e,2+e,2+10,m+4,w,1n+5,1q,4z+5,4b+rb,9+c,4+c,4+37,d+2g,8+b,l+b,5+1j,9+9,7+13,9+t,3+1,27+3c,2+29,2+3q,d+d,3+4,4+2,6+6,a+o,8+6,a+2,e+6,16+42,2+1i",BN:"0+8,6+d,2s+5,2+p,e,4m9,1kt+2,2b+5,5+5,17q9+v,7k,6p+8,6+1,119d+3,440+7,96s+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+75,6p+2rz,1ben+1,1ekf+1,1ekf+1",NSM:"lc+33,7o+6,7c+18,2,2+1,2+1,2,21+a,1d+k,h,2u+6,3+5,3+1,2+3,10,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,g+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+g,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,k1+w,2db+2,3y,2p+v,ff+3,30+1,n9x+3,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,r2,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+5,3+1,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2d+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,f0c+4,1o+6,t5,1s+3,2a,f5l+1,43t+2,i+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,gzhy+6n",AL:"16w,3,2,e+1b,z+2,2+2s,g+1,8+1,b+m,2+t,s+2i,c+e,4h+f,1d+1e,1bwe+dp,3+3z,x+c,2+1,35+3y,2rm+z,5+7,b+5,dt+l,c+u,17nl+27,1t+27,4x+6n,3+d",LRO:"6ct",RLO:"6cu",LRE:"6cq",RLE:"6cr",PDF:"6cs",LRI:"6ee",RLI:"6ef",FSI:"6eg",PDI:"6eh"},n={},r={};n.L=1,r[1]="L",Object.keys(t).forEach(function(Te,ne){n[Te]=1<<ne+1,r[n[Te]]=Te}),Object.freeze(n);var s=n.LRI|n.RLI|n.FSI,o=n.L|n.R|n.AL,a=n.B|n.S|n.WS|n.ON|n.FSI|n.LRI|n.RLI|n.PDI,l=n.BN|n.RLE|n.LRE|n.RLO|n.LRO|n.PDF,c=n.S|n.WS|n.B|s|n.PDI|l,u=null;function h(){if(!u){u=new Map;var Te=function(V){if(t.hasOwnProperty(V)){var de=0;t[V].split(",").forEach(function(Re){var Be=Re.split("+"),Fe=Be[0],He=Be[1];Fe=parseInt(Fe,36),He=He?parseInt(He,36):0,u.set(de+=Fe,n[V]);for(var it=0;it<He;it++)u.set(++de,n[V])})}};for(var ne in t)Te(ne)}}function f(Te){return h(),u.get(Te.codePointAt(0))||n.L}function d(Te){return r[f(Te)]}var m={pairs:"14>1,1e>2,u>2,2wt>1,1>1,1ge>1,1wp>1,1j>1,f>1,hm>1,1>1,u>1,u6>1,1>1,+5,28>1,w>1,1>1,+3,b8>1,1>1,+3,1>3,-1>-1,3>1,1>1,+2,1s>1,1>1,x>1,th>1,1>1,+2,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,4q>1,1e>2,u>2,2>1,+1",canonical:"6f1>-6dx,6dy>-6dx,6ec>-6ed,6ee>-6ed,6ww>2jj,-2ji>2jj,14r4>-1e7l,1e7m>-1e7l,1e7m>-1e5c,1e5d>-1e5b,1e5c>-14qx,14qy>-14qx,14vn>-1ecg,1ech>-1ecg,1edu>-1ecg,1eci>-1ecg,1eda>-1ecg,1eci>-1ecg,1eci>-168q,168r>-168q,168s>-14ye,14yf>-14ye"};function A(Te,ne){var V=36,de=0,Re=new Map,Be=ne&&new Map,Fe;return Te.split(",").forEach(function He(it){if(it.indexOf("+")!==-1)for(var $e=+it;$e--;)He(Fe);else{Fe=it;var ct=it.split(">"),pt=ct[0],We=ct[1];pt=String.fromCodePoint(de+=parseInt(pt,V)),We=String.fromCodePoint(de+=parseInt(We,V)),Re.set(pt,We),ne&&Be.set(We,pt)}}),{map:Re,reverseMap:Be}}var g,y,E;function x(){if(!g){var Te=A(m.pairs,!0),ne=Te.map,V=Te.reverseMap;g=ne,y=V,E=A(m.canonical,!1).map}}function C(Te){return x(),g.get(Te)||null}function T(Te){return x(),y.get(Te)||null}function I(Te){return x(),E.get(Te)||null}var M=n.L,L=n.R,R=n.EN,P=n.ES,F=n.ET,k=n.AN,z=n.CS,U=n.B,W=n.S,$=n.ON,oe=n.BN,X=n.NSM,Q=n.AL,Y=n.LRO,O=n.RLO,K=n.LRE,te=n.RLE,q=n.PDF,J=n.LRI,ie=n.RLI,re=n.FSI,se=n.PDI;function ge(Te,ne){for(var V=125,de=new Uint32Array(Te.length),Re=0;Re<Te.length;Re++)de[Re]=f(Te[Re]);var Be=new Map;function Fe(Yr,us){var Ur=de[Yr];de[Yr]=us,Be.set(Ur,Be.get(Ur)-1),Ur&a&&Be.set(a,Be.get(a)-1),Be.set(us,(Be.get(us)||0)+1),us&a&&Be.set(a,(Be.get(a)||0)+1)}for(var He=new Uint8Array(Te.length),it=new Map,$e=[],ct=null,pt=0;pt<Te.length;pt++)ct||$e.push(ct={start:pt,end:Te.length-1,level:ne==="rtl"?1:ne==="ltr"?0:Cs(pt,!1)}),de[pt]&U&&(ct.end=pt,ct=null);for(var We=te|K|O|Y|s|se|q|U,Mt=function(Yr){return Yr+(Yr&1?1:2)},Ft=function(Yr){return Yr+(Yr&1?2:1)},St=0;St<$e.length;St++){ct=$e[St];var gt=[{_level:ct.level,_override:0,_isolate:0}],ft=void 0,be=0,qe=0,At=0;Be.clear();for(var yt=ct.start;yt<=ct.end;yt++){var De=de[yt];if(ft=gt[gt.length-1],Be.set(De,(Be.get(De)||0)+1),De&a&&Be.set(a,(Be.get(a)||0)+1),De&We)if(De&(te|K)){He[yt]=ft._level;var Ce=(De===te?Ft:Mt)(ft._level);Ce<=V&&!be&&!qe?gt.push({_level:Ce,_override:0,_isolate:0}):be||qe++}else if(De&(O|Y)){He[yt]=ft._level;var _t=(De===O?Ft:Mt)(ft._level);_t<=V&&!be&&!qe?gt.push({_level:_t,_override:De&O?L:M,_isolate:0}):be||qe++}else if(De&s){De&re&&(De=Cs(yt+1,!0)===1?ie:J),He[yt]=ft._level,ft._override&&Fe(yt,ft._override);var vt=(De===ie?Ft:Mt)(ft._level);vt<=V&&be===0&&qe===0?(At++,gt.push({_level:vt,_override:0,_isolate:1,_isolInitIndex:yt})):be++}else if(De&se){if(be>0)be--;else if(At>0){for(qe=0;!gt[gt.length-1]._isolate;)gt.pop();var bt=gt[gt.length-1]._isolInitIndex;bt!=null&&(it.set(bt,yt),it.set(yt,bt)),gt.pop(),At--}ft=gt[gt.length-1],He[yt]=ft._level,ft._override&&Fe(yt,ft._override)}else De&q?(be===0&&(qe>0?qe--:!ft._isolate&&gt.length>1&&(gt.pop(),ft=gt[gt.length-1])),He[yt]=ft._level):De&U&&(He[yt]=ct.level);else He[yt]=ft._level,ft._override&&De!==oe&&Fe(yt,ft._override)}for(var Pt=[],qt=null,Nt=ct.start;Nt<=ct.end;Nt++){var dn=de[Nt];if(!(dn&l)){var Vn=He[Nt],pn=dn&s,qn=dn===se;qt&&Vn===qt._level?(qt._end=Nt,qt._endsWithIsolInit=pn):Pt.push(qt={_start:Nt,_end:Nt,_level:Vn,_startsWithPDI:qn,_endsWithIsolInit:pn})}}for(var Ci=[],as=0;as<Pt.length;as++){var Nr=Pt[as];if(!Nr._startsWithPDI||Nr._startsWithPDI&&!it.has(Nr._start)){for(var ur=[qt=Nr],tr=void 0;qt&&qt._endsWithIsolInit&&(tr=it.get(qt._end))!=null;)for(var An=as+1;An<Pt.length;An++)if(Pt[An]._start===tr){ur.push(qt=Pt[An]);break}for(var vr=[],Uo=0;Uo<ur.length;Uo++)for(var he=ur[Uo],me=he._start;me<=he._end;me++)vr.push(me);for(var ke=He[vr[0]],ue=ct.level,ye=vr[0]-1;ye>=0;ye--)if(!(de[ye]&l)){ue=He[ye];break}var _e=vr[vr.length-1],Pe=He[_e],Me=ct.level;if(!(de[_e]&s)){for(var Je=_e+1;Je<=ct.end;Je++)if(!(de[Je]&l)){Me=He[Je];break}}Ci.push({_seqIndices:vr,_sosType:Math.max(ue,ke)%2?L:M,_eosType:Math.max(Me,Pe)%2?L:M})}}for(var st=0;st<Ci.length;st++){var lt=Ci[st],Oe=lt._seqIndices,Ht=lt._sosType,xt=lt._eosType,Et=He[Oe[0]]&1?L:M;if(Be.get(X))for(var Qt=0;Qt<Oe.length;Qt++){var sn=Oe[Qt];if(de[sn]&X){for(var ln=Ht,vn=Qt-1;vn>=0;vn--)if(!(de[Oe[vn]]&l)){ln=de[Oe[vn]];break}Fe(sn,ln&(s|se)?$:ln)}}if(Be.get(R))for(var Dt=0;Dt<Oe.length;Dt++){var Bt=Oe[Dt];if(de[Bt]&R)for(var yn=Dt-1;yn>=-1;yn--){var xn=yn===-1?Ht:de[Oe[yn]];if(xn&o){xn===Q&&Fe(Bt,k);break}}}if(Be.get(Q))for(var Sn=0;Sn<Oe.length;Sn++){var Ai=Oe[Sn];de[Ai]&Q&&Fe(Ai,L)}if(Be.get(P)||Be.get(z))for(var xi=1;xi<Oe.length-1;xi++){var Ei=Oe[xi];if(de[Ei]&(P|z)){for(var Dn=0,kn=0,zi=xi-1;zi>=0&&(Dn=de[Oe[zi]],!!(Dn&l));zi--);for(var Bn=xi+1;Bn<Oe.length&&(kn=de[Oe[Bn]],!!(kn&l));Bn++);Dn===kn&&(de[Ei]===P?Dn===R:Dn&(R|k))&&Fe(Ei,Dn)}}if(Be.get(R))for(var Ln=0;Ln<Oe.length;Ln++){var Ri=Oe[Ln];if(de[Ri]&R){for(var ls=Ln-1;ls>=0&&de[Oe[ls]]&(F|l);ls--)Fe(Oe[ls],R);for(Ln++;Ln<Oe.length&&de[Oe[Ln]]&(F|l|R);Ln++)de[Oe[Ln]]!==R&&Fe(Oe[Ln],R)}}if(Be.get(F)||Be.get(P)||Be.get(z))for(var nr=0;nr<Oe.length;nr++){var ta=Oe[nr];if(de[ta]&(F|P|z)){Fe(ta,$);for(var ol=nr-1;ol>=0&&de[Oe[ol]]&l;ol--)Fe(Oe[ol],$);for(var ri=nr+1;ri<Oe.length&&de[Oe[ri]]&l;ri++)Fe(Oe[ri],$)}}if(Be.get(R))for(var Ul=0,ku=Ht;Ul<Oe.length;Ul++){var Qf=Oe[Ul],Vf=de[Qf];Vf&R?ku===M&&Fe(Qf,M):Vf&o&&(ku=Vf)}if(Be.get(a)){var zl=L|R|k,Mh=zl|M,ba=[];{for(var al=[],zs=0;zs<Oe.length;zs++)if(de[Oe[zs]]&a){var Fn=Te[Oe[zs]],Ia=void 0;if(C(Fn)!==null)if(al.length<63)al.push({char:Fn,seqIndex:zs});else break;else if((Ia=T(Fn))!==null)for(var na=al.length-1;na>=0;na--){var Gl=al[na].char;if(Gl===Ia||Gl===T(I(Fn))||C(I(Gl))===Fn){ba.push([al[na].seqIndex,zs]),al.length=na;break}}}ba.sort(function(Yr,us){return Yr[0]-us[0]})}for(var Ma=0;Ma<ba.length;Ma++){for(var x0=ba[Ma],hr=x0[0],ll=x0[1],E0=!1,lo=0,Fu=hr+1;Fu<ll;Fu++){var Ou=Oe[Fu];if(de[Ou]&Mh){E0=!0;var ia=de[Ou]&zl?L:M;if(ia===Et){lo=ia;break}}}if(E0&&!lo){lo=Ht;for(var Tc=hr-1;Tc>=0;Tc--){var Nu=Oe[Tc];if(de[Nu]&Mh){var _s=de[Nu]&zl?L:M;_s!==Et?lo=_s:lo=Et;break}}}if(lo){if(de[Oe[hr]]=de[Oe[ll]]=lo,lo!==Et){for(var Ss=hr+1;Ss<Oe.length;Ss++)if(!(de[Oe[Ss]]&l)){f(Te[Oe[Ss]])&X&&(de[Oe[Ss]]=lo);break}}if(lo!==Et){for(var Hl=ll+1;Hl<Oe.length;Hl++)if(!(de[Oe[Hl]]&l)){f(Te[Oe[Hl]])&X&&(de[Oe[Hl]]=lo);break}}}}for(var Ra=0;Ra<Oe.length;Ra++)if(de[Oe[Ra]]&a){for(var Rh=Ra,Uu=Ra,co=Ht,zu=Ra-1;zu>=0;zu--)if(de[Oe[zu]]&l)Rh=zu;else{co=de[Oe[zu]]&zl?L:M;break}for(var zo=xt,bc=Ra+1;bc<Oe.length;bc++)if(de[Oe[bc]]&(a|l))Uu=bc;else{zo=de[Oe[bc]]&zl?L:M;break}for(var ws=Rh;ws<=Uu;ws++)de[Oe[ws]]=co===zo?co:Et;Ra=Uu}}}for(var cs=ct.start;cs<=ct.end;cs++){var Ic=He[cs],Go=de[cs];if(Ic&1?Go&(M|R|k)&&He[cs]++:Go&L?He[cs]++:Go&(k|R)&&(He[cs]+=2),Go&l&&(He[cs]=cs===0?ct.level:He[cs-1]),cs===ct.end||f(Te[cs])&(W|U))for(var Mc=cs;Mc>=0&&f(Te[Mc])&c;Mc--)He[Mc]=ct.level}}return{levels:He,paragraphs:$e};function Cs(Yr,us){for(var Ur=Yr;Ur<Te.length;Ur++){var xr=de[Ur];if(xr&(L|Q))return 1;if(xr&(U|M)||us&&xr===se)return 0;if(xr&s){var So=Rc(Ur);Ur=So===-1?Te.length:So}}return 0}function Rc(Yr){for(var us=1,Ur=Yr+1;Ur<Te.length;Ur++){var xr=de[Ur];if(xr&U)break;if(xr&se){if(--us===0)return Ur}else xr&s&&us++}return-1}}var xe="14>1,j>2,t>2,u>2,1a>g,2v3>1,1>1,1ge>1,1wd>1,b>1,1j>1,f>1,ai>3,-2>3,+1,8>1k0,-1jq>1y7,-1y6>1hf,-1he>1h6,-1h5>1ha,-1h8>1qi,-1pu>1,6>3u,-3s>7,6>1,1>1,f>1,1>1,+2,3>1,1>1,+13,4>1,1>1,6>1eo,-1ee>1,3>1mg,-1me>1mk,-1mj>1mi,-1mg>1mi,-1md>1,1>1,+2,1>10k,-103>1,1>1,4>1,5>1,1>1,+10,3>1,1>8,-7>8,+1,-6>7,+1,a>1,1>1,u>1,u6>1,1>1,+5,26>1,1>1,2>1,2>2,8>1,7>1,4>1,1>1,+5,b8>1,1>1,+3,1>3,-2>1,2>1,1>1,+2,c>1,3>1,1>1,+2,h>1,3>1,a>1,1>1,2>1,3>1,1>1,d>1,f>1,3>1,1a>1,1>1,6>1,7>1,13>1,k>1,1>1,+19,4>1,1>1,+2,2>1,1>1,+18,m>1,a>1,1>1,lk>1,1>1,4>1,2>1,f>1,3>1,1>1,+3,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,6>1,4j>1,j>2,t>2,u>2,2>1,+1",pe;function ce(){if(!pe){var Te=A(xe,!0),ne=Te.map,V=Te.reverseMap;V.forEach(function(de,Re){ne.set(Re,de)}),pe=ne}}function we(Te){return ce(),pe.get(Te)||null}function Ee(Te,ne,V,de){var Re=Te.length;V=Math.max(0,V==null?0:+V),de=Math.min(Re-1,de==null?Re-1:+de);for(var Be=new Map,Fe=V;Fe<=de;Fe++)if(ne[Fe]&1){var He=we(Te[Fe]);He!==null&&Be.set(Fe,He)}return Be}function ve(Te,ne,V,de){var Re=Te.length;V=Math.max(0,V==null?0:+V),de=Math.min(Re-1,de==null?Re-1:+de);var Be=[];return ne.paragraphs.forEach(function(Fe){var He=Math.max(V,Fe.start),it=Math.min(de,Fe.end);if(He<it){for(var $e=ne.levels.slice(He,it+1),ct=it;ct>=He&&f(Te[ct])&c;ct--)$e[ct]=Fe.level;for(var pt=Fe.level,We=1/0,Mt=0;Mt<$e.length;Mt++){var Ft=$e[Mt];Ft>pt&&(pt=Ft),Ft<We&&(We=Ft|1)}for(var St=pt;St>=We;St--)for(var gt=0;gt<$e.length;gt++)if($e[gt]>=St){for(var ft=gt;gt+1<$e.length&&$e[gt+1]>=St;)gt++;gt>ft&&Be.push([ft+He,gt+He])}}}),Be}function Ae(Te,ne,V,de){var Re=Le(Te,ne,V,de),Be=[].concat(Te);return Re.forEach(function(Fe,He){Be[He]=(ne.levels[Fe]&1?we(Te[Fe]):null)||Te[Fe]}),Be.join("")}function Le(Te,ne,V,de){for(var Re=ve(Te,ne,V,de),Be=[],Fe=0;Fe<Te.length;Fe++)Be[Fe]=Fe;return Re.forEach(function(He){for(var it=He[0],$e=He[1],ct=Be.slice(it,$e+1),pt=ct.length;pt--;)Be[$e-pt]=ct[pt]}),Be}return e.closingToOpeningBracket=T,e.getBidiCharType=f,e.getBidiCharTypeName=d,e.getCanonicalBracket=I,e.getEmbeddingLevels=ge,e.getMirroredCharacter=we,e.getMirroredCharactersMap=Ee,e.getReorderSegments=ve,e.getReorderedIndices=Le,e.getReorderedString=Ae,e.openingToClosingBracket=C,Object.defineProperty(e,"__esModule",{value:!0}),e})({});return i}const QH=/\bvoid\s+main\s*\(\s*\)\s*{/g;function a5(i){const e=/^[ \t]*#include +<([\w\d./]+)>/gm;function t(n,r){let s=Un[r];return s?a5(s):n}return i.replace(e,t)}const ko=[];for(let i=0;i<256;i++)ko[i]=(i<16?"0":"")+i.toString(16);function zhe(){const i=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,n=Math.random()*4294967295|0;return(ko[i&255]+ko[i>>8&255]+ko[i>>16&255]+ko[i>>24&255]+"-"+ko[e&255]+ko[e>>8&255]+"-"+ko[e>>16&15|64]+ko[e>>24&255]+"-"+ko[t&63|128]+ko[t>>8&255]+"-"+ko[t>>16&255]+ko[t>>24&255]+ko[n&255]+ko[n>>8&255]+ko[n>>16&255]+ko[n>>24&255]).toUpperCase()}const gm=Object.assign||function(){let i=arguments[0];for(let e=1,t=arguments.length;e<t;e++){let n=arguments[e];if(n)for(let r in n)Object.prototype.hasOwnProperty.call(n,r)&&(i[r]=n[r])}return i},Ghe=Date.now(),q9=new WeakMap,J9=new Map;let Hhe=1e10;function l5(i,e){const t=jhe(e);let n=q9.get(i);if(n||q9.set(i,n=Object.create(null)),n[t])return new n[t];const r=`_onBeforeCompile${t}`,s=function(c,u){i.onBeforeCompile.call(this,c,u);const h=this.customProgramCacheKey()+"|"+c.vertexShader+"|"+c.fragmentShader;let f=J9[h];if(!f){const d=Qhe(this,c,e,t);f=J9[h]=d}c.vertexShader=f.vertexShader,c.fragmentShader=f.fragmentShader,gm(c.uniforms,this.uniforms),e.timeUniform&&(c.uniforms[e.timeUniform]={get value(){return Date.now()-Ghe}}),this[r]&&this[r](c)},o=function(){return a(e.chained?i:i.clone())},a=function(c){const u=Object.create(c,l);return Object.defineProperty(u,"baseMaterial",{value:i}),Object.defineProperty(u,"id",{value:Hhe++}),u.uuid=zhe(),u.uniforms=gm({},c.uniforms,e.uniforms),u.defines=gm({},c.defines,e.defines),u.defines[`TROIKA_DERIVED_MATERIAL_${t}`]="",u.extensions=gm({},c.extensions,e.extensions),u._listeners=void 0,u},l={constructor:{value:o},isDerivedMaterial:{value:!0},type:{get:()=>i.type,set:c=>{i.type=c}},isDerivedFrom:{writable:!0,configurable:!0,value:function(c){const u=this.baseMaterial;return c===u||u.isDerivedMaterial&&u.isDerivedFrom(c)||!1}},customProgramCacheKey:{writable:!0,configurable:!0,value:function(){return i.customProgramCacheKey()+"|"+t}},onBeforeCompile:{get(){return s},set(c){this[r]=c}},copy:{writable:!0,configurable:!0,value:function(c){return i.copy.call(this,c),!i.isShaderMaterial&&!i.isDerivedMaterial&&(gm(this.extensions,c.extensions),gm(this.defines,c.defines),gm(this.uniforms,rp.clone(c.uniforms))),this}},clone:{writable:!0,configurable:!0,value:function(){const c=new i.constructor;return a(c).copy(this)}},getDepthMaterial:{writable:!0,configurable:!0,value:function(){let c=this._depthMaterial;return c||(c=this._depthMaterial=l5(i.isDerivedMaterial?i.getDepthMaterial():new rx({depthPacking:Ew}),e),c.defines.IS_DEPTH_MATERIAL="",c.uniforms=this.uniforms),c}},getDistanceMaterial:{writable:!0,configurable:!0,value:function(){let c=this._distanceMaterial;return c||(c=this._distanceMaterial=l5(i.isDerivedMaterial?i.getDistanceMaterial():new bw,e),c.defines.IS_DISTANCE_MATERIAL="",c.uniforms=this.uniforms),c}},dispose:{writable:!0,configurable:!0,value(){const{_depthMaterial:c,_distanceMaterial:u}=this;c&&c.dispose(),u&&u.dispose(),i.dispose.call(this)}}};return n[t]=o,new o}function Qhe(i,{vertexShader:e,fragmentShader:t},n,r){let{vertexDefs:s,vertexMainIntro:o,vertexMainOutro:a,vertexTransform:l,fragmentDefs:c,fragmentMainIntro:u,fragmentMainOutro:h,fragmentColorTransform:f,customRewriter:d,timeUniform:m}=n;if(s=s||"",o=o||"",a=a||"",c=c||"",u=u||"",h=h||"",(l||d)&&(e=a5(e)),(f||d)&&(t=t.replace(/^[ \t]*#include <((?:tonemapping|encodings|colorspace|fog|premultiplied_alpha|dithering)_fragment)>/gm,`
//!BEGIN_POST_CHUNK $1
$&
//!END_POST_CHUNK
`),t=a5(t)),d){let A=d({vertexShader:e,fragmentShader:t});e=A.vertexShader,t=A.fragmentShader}if(f){let A=[];t=t.replace(/^\/\/!BEGIN_POST_CHUNK[^]+?^\/\/!END_POST_CHUNK/gm,g=>(A.push(g),"")),h=`${f}
${A.join(`
`)}
${h}`}if(m){const A=`
uniform float ${m};
`;s=A+s,c=A+c}return l&&(e=`vec3 troika_position_${r};
vec3 troika_normal_${r};
vec2 troika_uv_${r};
${e}
`,s=`${s}
void troikaVertexTransform${r}(inout vec3 position, inout vec3 normal, inout vec2 uv) {
  ${l}
}
`,o=`
troika_position_${r} = vec3(position);
troika_normal_${r} = vec3(normal);
troika_uv_${r} = vec2(uv);
troikaVertexTransform${r}(troika_position_${r}, troika_normal_${r}, troika_uv_${r});
${o}
`,e=e.replace(/\b(position|normal|uv)\b/g,(A,g,y,E)=>/\battribute\s+vec[23]\s+$/.test(E.substr(0,y))?g:`troika_${g}_${r}`),i.map&&i.map.channel>0||(e=e.replace(/\bMAP_UV\b/g,`troika_uv_${r}`))),e=Z9(e,r,s,o,a),t=Z9(t,r,c,u,h),{vertexShader:e,fragmentShader:t}}function Z9(i,e,t,n,r){return(n||r||t)&&(i=i.replace(QH,`
${t}
void troikaOrigMain${e}() {`),i+=`
void main() {
  ${n}
  troikaOrigMain${e}();
  ${r}
}`),i}function Vhe(i,e){return i==="uniforms"?void 0:typeof e=="function"?e.toString():e}let Whe=0;const e7=new Map;function jhe(i){const e=JSON.stringify(i,Vhe);let t=e7.get(e);return t==null&&e7.set(e,t=++Whe),t}/*!
Custom build of Typr.ts (https://github.com/fredli74/Typr.ts) for use in Troika text rendering.
Original MIT license applies: https://github.com/fredli74/Typr.ts/blob/master/LICENSE
*/function Khe(){return typeof window>"u"&&(self.window=self),(function(i){var e={parse:function(r){var s=e._bin,o=new Uint8Array(r);if(s.readASCII(o,0,4)=="ttcf"){var a=4;s.readUshort(o,a),a+=2,s.readUshort(o,a),a+=2;var l=s.readUint(o,a);a+=4;for(var c=[],u=0;u<l;u++){var h=s.readUint(o,a);a+=4,c.push(e._readFont(o,h))}return c}return[e._readFont(o,0)]},_readFont:function(r,s){var o=e._bin,a=s;o.readFixed(r,s),s+=4;var l=o.readUshort(r,s);s+=2,o.readUshort(r,s),s+=2,o.readUshort(r,s),s+=2,o.readUshort(r,s),s+=2;for(var c=["cmap","head","hhea","maxp","hmtx","name","OS/2","post","loca","glyf","kern","CFF ","GDEF","GPOS","GSUB","SVG "],u={_data:r,_offset:a},h={},f=0;f<l;f++){var d=o.readASCII(r,s,4);s+=4,o.readUint(r,s),s+=4;var m=o.readUint(r,s);s+=4;var A=o.readUint(r,s);s+=4,h[d]={offset:m,length:A}}for(f=0;f<c.length;f++){var g=c[f];h[g]&&(u[g.trim()]=e[g.trim()].parse(r,h[g].offset,h[g].length,u))}return u},_tabOffset:function(r,s,o){for(var a=e._bin,l=a.readUshort(r,o+4),c=o+12,u=0;u<l;u++){var h=a.readASCII(r,c,4);c+=4,a.readUint(r,c),c+=4;var f=a.readUint(r,c);if(c+=4,a.readUint(r,c),c+=4,h==s)return f}return 0}};e._bin={readFixed:function(r,s){return(r[s]<<8|r[s+1])+(r[s+2]<<8|r[s+3])/65540},readF2dot14:function(r,s){return e._bin.readShort(r,s)/16384},readInt:function(r,s){return e._bin._view(r).getInt32(s)},readInt8:function(r,s){return e._bin._view(r).getInt8(s)},readShort:function(r,s){return e._bin._view(r).getInt16(s)},readUshort:function(r,s){return e._bin._view(r).getUint16(s)},readUshorts:function(r,s,o){for(var a=[],l=0;l<o;l++)a.push(e._bin.readUshort(r,s+2*l));return a},readUint:function(r,s){return e._bin._view(r).getUint32(s)},readUint64:function(r,s){return 4294967296*e._bin.readUint(r,s)+e._bin.readUint(r,s+4)},readASCII:function(r,s,o){for(var a="",l=0;l<o;l++)a+=String.fromCharCode(r[s+l]);return a},readUnicode:function(r,s,o){for(var a="",l=0;l<o;l++){var c=r[s++]<<8|r[s++];a+=String.fromCharCode(c)}return a},_tdec:typeof window<"u"&&window.TextDecoder?new window.TextDecoder:null,readUTF8:function(r,s,o){var a=e._bin._tdec;return a&&s==0&&o==r.length?a.decode(r):e._bin.readASCII(r,s,o)},readBytes:function(r,s,o){for(var a=[],l=0;l<o;l++)a.push(r[s+l]);return a},readASCIIArray:function(r,s,o){for(var a=[],l=0;l<o;l++)a.push(String.fromCharCode(r[s+l]));return a},_view:function(r){return r._dataView||(r._dataView=r.buffer?new DataView(r.buffer,r.byteOffset,r.byteLength):new DataView(new Uint8Array(r).buffer))}},e._lctf={},e._lctf.parse=function(r,s,o,a,l){var c=e._bin,u={},h=s;c.readFixed(r,s),s+=4;var f=c.readUshort(r,s);s+=2;var d=c.readUshort(r,s);s+=2;var m=c.readUshort(r,s);return s+=2,u.scriptList=e._lctf.readScriptList(r,h+f),u.featureList=e._lctf.readFeatureList(r,h+d),u.lookupList=e._lctf.readLookupList(r,h+m,l),u},e._lctf.readLookupList=function(r,s,o){var a=e._bin,l=s,c=[],u=a.readUshort(r,s);s+=2;for(var h=0;h<u;h++){var f=a.readUshort(r,s);s+=2;var d=e._lctf.readLookupTable(r,l+f,o);c.push(d)}return c},e._lctf.readLookupTable=function(r,s,o){var a=e._bin,l=s,c={tabs:[]};c.ltype=a.readUshort(r,s),s+=2,c.flag=a.readUshort(r,s),s+=2;var u=a.readUshort(r,s);s+=2;for(var h=c.ltype,f=0;f<u;f++){var d=a.readUshort(r,s);s+=2;var m=o(r,h,l+d,c);c.tabs.push(m)}return c},e._lctf.numOfOnes=function(r){for(var s=0,o=0;o<32;o++)(r>>>o&1)!=0&&s++;return s},e._lctf.readClassDef=function(r,s){var o=e._bin,a=[],l=o.readUshort(r,s);if(s+=2,l==1){var c=o.readUshort(r,s);s+=2;var u=o.readUshort(r,s);s+=2;for(var h=0;h<u;h++)a.push(c+h),a.push(c+h),a.push(o.readUshort(r,s)),s+=2}if(l==2){var f=o.readUshort(r,s);for(s+=2,h=0;h<f;h++)a.push(o.readUshort(r,s)),s+=2,a.push(o.readUshort(r,s)),s+=2,a.push(o.readUshort(r,s)),s+=2}return a},e._lctf.getInterval=function(r,s){for(var o=0;o<r.length;o+=3){var a=r[o],l=r[o+1];if(r[o+2],a<=s&&s<=l)return o}return-1},e._lctf.readCoverage=function(r,s){var o=e._bin,a={};a.fmt=o.readUshort(r,s),s+=2;var l=o.readUshort(r,s);return s+=2,a.fmt==1&&(a.tab=o.readUshorts(r,s,l)),a.fmt==2&&(a.tab=o.readUshorts(r,s,3*l)),a},e._lctf.coverageIndex=function(r,s){var o=r.tab;if(r.fmt==1)return o.indexOf(s);if(r.fmt==2){var a=e._lctf.getInterval(o,s);if(a!=-1)return o[a+2]+(s-o[a])}return-1},e._lctf.readFeatureList=function(r,s){var o=e._bin,a=s,l=[],c=o.readUshort(r,s);s+=2;for(var u=0;u<c;u++){var h=o.readASCII(r,s,4);s+=4;var f=o.readUshort(r,s);s+=2;var d=e._lctf.readFeatureTable(r,a+f);d.tag=h.trim(),l.push(d)}return l},e._lctf.readFeatureTable=function(r,s){var o=e._bin,a=s,l={},c=o.readUshort(r,s);s+=2,c>0&&(l.featureParams=a+c);var u=o.readUshort(r,s);s+=2,l.tab=[];for(var h=0;h<u;h++)l.tab.push(o.readUshort(r,s+2*h));return l},e._lctf.readScriptList=function(r,s){var o=e._bin,a=s,l={},c=o.readUshort(r,s);s+=2;for(var u=0;u<c;u++){var h=o.readASCII(r,s,4);s+=4;var f=o.readUshort(r,s);s+=2,l[h.trim()]=e._lctf.readScriptTable(r,a+f)}return l},e._lctf.readScriptTable=function(r,s){var o=e._bin,a=s,l={},c=o.readUshort(r,s);s+=2,c>0&&(l.default=e._lctf.readLangSysTable(r,a+c));var u=o.readUshort(r,s);s+=2;for(var h=0;h<u;h++){var f=o.readASCII(r,s,4);s+=4;var d=o.readUshort(r,s);s+=2,l[f.trim()]=e._lctf.readLangSysTable(r,a+d)}return l},e._lctf.readLangSysTable=function(r,s){var o=e._bin,a={};o.readUshort(r,s),s+=2,a.reqFeature=o.readUshort(r,s),s+=2;var l=o.readUshort(r,s);return s+=2,a.features=o.readUshorts(r,s,l),a},e.CFF={},e.CFF.parse=function(r,s,o){var a=e._bin;(r=new Uint8Array(r.buffer,s,o))[s=0],r[++s],r[++s],r[++s],s++;var l=[];s=e.CFF.readIndex(r,s,l);for(var c=[],u=0;u<l.length-1;u++)c.push(a.readASCII(r,s+l[u],l[u+1]-l[u]));s+=l[l.length-1];var h=[];s=e.CFF.readIndex(r,s,h);var f=[];for(u=0;u<h.length-1;u++)f.push(e.CFF.readDict(r,s+h[u],s+h[u+1]));s+=h[h.length-1];var d=f[0],m=[];s=e.CFF.readIndex(r,s,m);var A=[];for(u=0;u<m.length-1;u++)A.push(a.readASCII(r,s+m[u],m[u+1]-m[u]));if(s+=m[m.length-1],e.CFF.readSubrs(r,s,d),d.CharStrings){s=d.CharStrings,m=[],s=e.CFF.readIndex(r,s,m);var g=[];for(u=0;u<m.length-1;u++)g.push(a.readBytes(r,s+m[u],m[u+1]-m[u]));d.CharStrings=g}if(d.ROS){s=d.FDArray;var y=[];for(s=e.CFF.readIndex(r,s,y),d.FDArray=[],u=0;u<y.length-1;u++){var E=e.CFF.readDict(r,s+y[u],s+y[u+1]);e.CFF._readFDict(r,E,A),d.FDArray.push(E)}s+=y[y.length-1],s=d.FDSelect,d.FDSelect=[];var x=r[s];if(s++,x!=3)throw x;var C=a.readUshort(r,s);for(s+=2,u=0;u<C+1;u++)d.FDSelect.push(a.readUshort(r,s),r[s+2]),s+=3}return d.Encoding&&(d.Encoding=e.CFF.readEncoding(r,d.Encoding,d.CharStrings.length)),d.charset&&(d.charset=e.CFF.readCharset(r,d.charset,d.CharStrings.length)),e.CFF._readFDict(r,d,A),d},e.CFF._readFDict=function(r,s,o){var a;for(var l in s.Private&&(a=s.Private[1],s.Private=e.CFF.readDict(r,a,a+s.Private[0]),s.Private.Subrs&&e.CFF.readSubrs(r,a+s.Private.Subrs,s.Private)),s)["FamilyName","FontName","FullName","Notice","version","Copyright"].indexOf(l)!=-1&&(s[l]=o[s[l]-426+35])},e.CFF.readSubrs=function(r,s,o){var a=e._bin,l=[];s=e.CFF.readIndex(r,s,l);var c,u=l.length;c=u<1240?107:u<33900?1131:32768,o.Bias=c,o.Subrs=[];for(var h=0;h<l.length-1;h++)o.Subrs.push(a.readBytes(r,s+l[h],l[h+1]-l[h]))},e.CFF.tableSE=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,0,111,112,113,114,0,115,116,117,118,119,120,121,122,0,123,0,124,125,126,127,128,129,130,131,0,132,133,0,134,135,136,137,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,138,0,139,0,0,0,0,140,141,142,143,0,0,0,0,0,144,0,0,0,145,0,0,146,147,148,149,0,0,0,0],e.CFF.glyphByUnicode=function(r,s){for(var o=0;o<r.charset.length;o++)if(r.charset[o]==s)return o;return-1},e.CFF.glyphBySE=function(r,s){return s<0||s>255?-1:e.CFF.glyphByUnicode(r,e.CFF.tableSE[s])},e.CFF.readEncoding=function(r,s,o){e._bin;var a=[".notdef"],l=r[s];if(s++,l!=0)throw"error: unknown encoding format: "+l;var c=r[s];s++;for(var u=0;u<c;u++)a.push(r[s+u]);return a},e.CFF.readCharset=function(r,s,o){var a=e._bin,l=[".notdef"],c=r[s];if(s++,c==0)for(var u=0;u<o;u++){var h=a.readUshort(r,s);s+=2,l.push(h)}else{if(c!=1&&c!=2)throw"error: format: "+c;for(;l.length<o;){h=a.readUshort(r,s),s+=2;var f=0;for(c==1?(f=r[s],s++):(f=a.readUshort(r,s),s+=2),u=0;u<=f;u++)l.push(h),h++}}return l},e.CFF.readIndex=function(r,s,o){var a=e._bin,l=a.readUshort(r,s)+1,c=r[s+=2];if(s++,c==1)for(var u=0;u<l;u++)o.push(r[s+u]);else if(c==2)for(u=0;u<l;u++)o.push(a.readUshort(r,s+2*u));else if(c==3)for(u=0;u<l;u++)o.push(16777215&a.readUint(r,s+3*u-1));else if(l!=1)throw"unsupported offset size: "+c+", count: "+l;return(s+=l*c)-1},e.CFF.getCharString=function(r,s,o){var a=e._bin,l=r[s],c=r[s+1];r[s+2],r[s+3],r[s+4];var u=1,h=null,f=null;l<=20&&(h=l,u=1),l==12&&(h=100*l+c,u=2),21<=l&&l<=27&&(h=l,u=1),l==28&&(f=a.readShort(r,s+1),u=3),29<=l&&l<=31&&(h=l,u=1),32<=l&&l<=246&&(f=l-139,u=1),247<=l&&l<=250&&(f=256*(l-247)+c+108,u=2),251<=l&&l<=254&&(f=256*-(l-251)-c-108,u=2),l==255&&(f=a.readInt(r,s+1)/65535,u=5),o.val=f??"o"+h,o.size=u},e.CFF.readCharString=function(r,s,o){for(var a=s+o,l=e._bin,c=[];s<a;){var u=r[s],h=r[s+1];r[s+2],r[s+3],r[s+4];var f=1,d=null,m=null;u<=20&&(d=u,f=1),u==12&&(d=100*u+h,f=2),u!=19&&u!=20||(d=u,f=2),21<=u&&u<=27&&(d=u,f=1),u==28&&(m=l.readShort(r,s+1),f=3),29<=u&&u<=31&&(d=u,f=1),32<=u&&u<=246&&(m=u-139,f=1),247<=u&&u<=250&&(m=256*(u-247)+h+108,f=2),251<=u&&u<=254&&(m=256*-(u-251)-h-108,f=2),u==255&&(m=l.readInt(r,s+1)/65535,f=5),c.push(m??"o"+d),s+=f}return c},e.CFF.readDict=function(r,s,o){for(var a=e._bin,l={},c=[];s<o;){var u=r[s],h=r[s+1];r[s+2],r[s+3],r[s+4];var f=1,d=null,m=null;if(u==28&&(m=a.readShort(r,s+1),f=3),u==29&&(m=a.readInt(r,s+1),f=5),32<=u&&u<=246&&(m=u-139,f=1),247<=u&&u<=250&&(m=256*(u-247)+h+108,f=2),251<=u&&u<=254&&(m=256*-(u-251)-h-108,f=2),u==255)throw m=a.readInt(r,s+1)/65535,f=5,"unknown number";if(u==30){var A=[];for(f=1;;){var g=r[s+f];f++;var y=g>>4,E=15&g;if(y!=15&&A.push(y),E!=15&&A.push(E),E==15)break}for(var x="",C=[0,1,2,3,4,5,6,7,8,9,".","e","e-","reserved","-","endOfNumber"],T=0;T<A.length;T++)x+=C[A[T]];m=parseFloat(x)}u<=21&&(d=["version","Notice","FullName","FamilyName","Weight","FontBBox","BlueValues","OtherBlues","FamilyBlues","FamilyOtherBlues","StdHW","StdVW","escape","UniqueID","XUID","charset","Encoding","CharStrings","Private","Subrs","defaultWidthX","nominalWidthX"][u],f=1,u==12&&(d=["Copyright","isFixedPitch","ItalicAngle","UnderlinePosition","UnderlineThickness","PaintType","CharstringType","FontMatrix","StrokeWidth","BlueScale","BlueShift","BlueFuzz","StemSnapH","StemSnapV","ForceBold",0,0,"LanguageGroup","ExpansionFactor","initialRandomSeed","SyntheticBase","PostScript","BaseFontName","BaseFontBlend",0,0,0,0,0,0,"ROS","CIDFontVersion","CIDFontRevision","CIDFontType","CIDCount","UIDBase","FDArray","FDSelect","FontName"][h],f=2)),d!=null?(l[d]=c.length==1?c[0]:c,c=[]):c.push(m),s+=f}return l},e.cmap={},e.cmap.parse=function(r,s,o){r=new Uint8Array(r.buffer,s,o),s=0;var a=e._bin,l={};a.readUshort(r,s),s+=2;var c=a.readUshort(r,s);s+=2;var u=[];l.tables=[];for(var h=0;h<c;h++){var f=a.readUshort(r,s);s+=2;var d=a.readUshort(r,s);s+=2;var m=a.readUint(r,s);s+=4;var A="p"+f+"e"+d,g=u.indexOf(m);if(g==-1){var y;g=l.tables.length,u.push(m);var E=a.readUshort(r,m);E==0?y=e.cmap.parse0(r,m):E==4?y=e.cmap.parse4(r,m):E==6?y=e.cmap.parse6(r,m):E==12?y=e.cmap.parse12(r,m):console.debug("unknown format: "+E,f,d,m),l.tables.push(y)}if(l[A]!=null)throw"multiple tables for one platform+encoding";l[A]=g}return l},e.cmap.parse0=function(r,s){var o=e._bin,a={};a.format=o.readUshort(r,s),s+=2;var l=o.readUshort(r,s);s+=2,o.readUshort(r,s),s+=2,a.map=[];for(var c=0;c<l-6;c++)a.map.push(r[s+c]);return a},e.cmap.parse4=function(r,s){var o=e._bin,a=s,l={};l.format=o.readUshort(r,s),s+=2;var c=o.readUshort(r,s);s+=2,o.readUshort(r,s),s+=2;var u=o.readUshort(r,s);s+=2;var h=u/2;l.searchRange=o.readUshort(r,s),s+=2,l.entrySelector=o.readUshort(r,s),s+=2,l.rangeShift=o.readUshort(r,s),s+=2,l.endCount=o.readUshorts(r,s,h),s+=2*h,s+=2,l.startCount=o.readUshorts(r,s,h),s+=2*h,l.idDelta=[];for(var f=0;f<h;f++)l.idDelta.push(o.readShort(r,s)),s+=2;for(l.idRangeOffset=o.readUshorts(r,s,h),s+=2*h,l.glyphIdArray=[];s<a+c;)l.glyphIdArray.push(o.readUshort(r,s)),s+=2;return l},e.cmap.parse6=function(r,s){var o=e._bin,a={};a.format=o.readUshort(r,s),s+=2,o.readUshort(r,s),s+=2,o.readUshort(r,s),s+=2,a.firstCode=o.readUshort(r,s),s+=2;var l=o.readUshort(r,s);s+=2,a.glyphIdArray=[];for(var c=0;c<l;c++)a.glyphIdArray.push(o.readUshort(r,s)),s+=2;return a},e.cmap.parse12=function(r,s){var o=e._bin,a={};a.format=o.readUshort(r,s),s+=2,s+=2,o.readUint(r,s),s+=4,o.readUint(r,s),s+=4;var l=o.readUint(r,s);s+=4,a.groups=[];for(var c=0;c<l;c++){var u=s+12*c,h=o.readUint(r,u+0),f=o.readUint(r,u+4),d=o.readUint(r,u+8);a.groups.push([h,f,d])}return a},e.glyf={},e.glyf.parse=function(r,s,o,a){for(var l=[],c=0;c<a.maxp.numGlyphs;c++)l.push(null);return l},e.glyf._parseGlyf=function(r,s){var o=e._bin,a=r._data,l=e._tabOffset(a,"glyf",r._offset)+r.loca[s];if(r.loca[s]==r.loca[s+1])return null;var c={};if(c.noc=o.readShort(a,l),l+=2,c.xMin=o.readShort(a,l),l+=2,c.yMin=o.readShort(a,l),l+=2,c.xMax=o.readShort(a,l),l+=2,c.yMax=o.readShort(a,l),l+=2,c.xMin>=c.xMax||c.yMin>=c.yMax)return null;if(c.noc>0){c.endPts=[];for(var u=0;u<c.noc;u++)c.endPts.push(o.readUshort(a,l)),l+=2;var h=o.readUshort(a,l);if(l+=2,a.length-l<h)return null;c.instructions=o.readBytes(a,l,h),l+=h;var f=c.endPts[c.noc-1]+1;for(c.flags=[],u=0;u<f;u++){var d=a[l];if(l++,c.flags.push(d),(8&d)!=0){var m=a[l];l++;for(var A=0;A<m;A++)c.flags.push(d),u++}}for(c.xs=[],u=0;u<f;u++){var g=(2&c.flags[u])!=0,y=(16&c.flags[u])!=0;g?(c.xs.push(y?a[l]:-a[l]),l++):y?c.xs.push(0):(c.xs.push(o.readShort(a,l)),l+=2)}for(c.ys=[],u=0;u<f;u++)g=(4&c.flags[u])!=0,y=(32&c.flags[u])!=0,g?(c.ys.push(y?a[l]:-a[l]),l++):y?c.ys.push(0):(c.ys.push(o.readShort(a,l)),l+=2);var E=0,x=0;for(u=0;u<f;u++)E+=c.xs[u],x+=c.ys[u],c.xs[u]=E,c.ys[u]=x}else{var C;c.parts=[];do{C=o.readUshort(a,l),l+=2;var T={m:{a:1,b:0,c:0,d:1,tx:0,ty:0},p1:-1,p2:-1};if(c.parts.push(T),T.glyphIndex=o.readUshort(a,l),l+=2,1&C){var I=o.readShort(a,l);l+=2;var M=o.readShort(a,l);l+=2}else I=o.readInt8(a,l),l++,M=o.readInt8(a,l),l++;2&C?(T.m.tx=I,T.m.ty=M):(T.p1=I,T.p2=M),8&C?(T.m.a=T.m.d=o.readF2dot14(a,l),l+=2):64&C?(T.m.a=o.readF2dot14(a,l),l+=2,T.m.d=o.readF2dot14(a,l),l+=2):128&C&&(T.m.a=o.readF2dot14(a,l),l+=2,T.m.b=o.readF2dot14(a,l),l+=2,T.m.c=o.readF2dot14(a,l),l+=2,T.m.d=o.readF2dot14(a,l),l+=2)}while(32&C);if(256&C){var L=o.readUshort(a,l);for(l+=2,c.instr=[],u=0;u<L;u++)c.instr.push(a[l]),l++}}return c},e.GDEF={},e.GDEF.parse=function(r,s,o,a){var l=s;s+=4;var c=e._bin.readUshort(r,s);return{glyphClassDef:c===0?null:e._lctf.readClassDef(r,l+c)}},e.GPOS={},e.GPOS.parse=function(r,s,o,a){return e._lctf.parse(r,s,o,a,e.GPOS.subt)},e.GPOS.subt=function(r,s,o,a){var l=e._bin,c=o,u={};if(u.fmt=l.readUshort(r,o),o+=2,s==1||s==2||s==3||s==7||s==8&&u.fmt<=2){var h=l.readUshort(r,o);o+=2,u.coverage=e._lctf.readCoverage(r,h+c)}if(s==1&&u.fmt==1){var f=l.readUshort(r,o);o+=2,f!=0&&(u.pos=e.GPOS.readValueRecord(r,o,f))}else if(s==2&&u.fmt>=1&&u.fmt<=2){f=l.readUshort(r,o),o+=2;var d=l.readUshort(r,o);o+=2;var m=e._lctf.numOfOnes(f),A=e._lctf.numOfOnes(d);if(u.fmt==1){u.pairsets=[];var g=l.readUshort(r,o);o+=2;for(var y=0;y<g;y++){var E=c+l.readUshort(r,o);o+=2;var x=l.readUshort(r,E);E+=2;for(var C=[],T=0;T<x;T++){var I=l.readUshort(r,E);E+=2,f!=0&&(k=e.GPOS.readValueRecord(r,E,f),E+=2*m),d!=0&&(z=e.GPOS.readValueRecord(r,E,d),E+=2*A),C.push({gid2:I,val1:k,val2:z})}u.pairsets.push(C)}}if(u.fmt==2){var M=l.readUshort(r,o);o+=2;var L=l.readUshort(r,o);o+=2;var R=l.readUshort(r,o);o+=2;var P=l.readUshort(r,o);for(o+=2,u.classDef1=e._lctf.readClassDef(r,c+M),u.classDef2=e._lctf.readClassDef(r,c+L),u.matrix=[],y=0;y<R;y++){var F=[];for(T=0;T<P;T++){var k=null,z=null;f!=0&&(k=e.GPOS.readValueRecord(r,o,f),o+=2*m),d!=0&&(z=e.GPOS.readValueRecord(r,o,d),o+=2*A),F.push({val1:k,val2:z})}u.matrix.push(F)}}}else if(s==4&&u.fmt==1)u.markCoverage=e._lctf.readCoverage(r,l.readUshort(r,o)+c),u.baseCoverage=e._lctf.readCoverage(r,l.readUshort(r,o+2)+c),u.markClassCount=l.readUshort(r,o+4),u.markArray=e.GPOS.readMarkArray(r,l.readUshort(r,o+6)+c),u.baseArray=e.GPOS.readBaseArray(r,l.readUshort(r,o+8)+c,u.markClassCount);else if(s==6&&u.fmt==1)u.mark1Coverage=e._lctf.readCoverage(r,l.readUshort(r,o)+c),u.mark2Coverage=e._lctf.readCoverage(r,l.readUshort(r,o+2)+c),u.markClassCount=l.readUshort(r,o+4),u.mark1Array=e.GPOS.readMarkArray(r,l.readUshort(r,o+6)+c),u.mark2Array=e.GPOS.readBaseArray(r,l.readUshort(r,o+8)+c,u.markClassCount);else{if(s==9&&u.fmt==1){var U=l.readUshort(r,o);o+=2;var W=l.readUint(r,o);if(o+=4,a.ltype==9)a.ltype=U;else if(a.ltype!=U)throw"invalid extension substitution";return e.GPOS.subt(r,a.ltype,c+W)}console.debug("unsupported GPOS table LookupType",s,"format",u.fmt)}return u},e.GPOS.readValueRecord=function(r,s,o){var a=e._bin,l=[];return l.push(1&o?a.readShort(r,s):0),s+=1&o?2:0,l.push(2&o?a.readShort(r,s):0),s+=2&o?2:0,l.push(4&o?a.readShort(r,s):0),s+=4&o?2:0,l.push(8&o?a.readShort(r,s):0),s+=8&o?2:0,l},e.GPOS.readBaseArray=function(r,s,o){var a=e._bin,l=[],c=s,u=a.readUshort(r,s);s+=2;for(var h=0;h<u;h++){for(var f=[],d=0;d<o;d++)f.push(e.GPOS.readAnchorRecord(r,c+a.readUshort(r,s))),s+=2;l.push(f)}return l},e.GPOS.readMarkArray=function(r,s){var o=e._bin,a=[],l=s,c=o.readUshort(r,s);s+=2;for(var u=0;u<c;u++){var h=e.GPOS.readAnchorRecord(r,o.readUshort(r,s+2)+l);h.markClass=o.readUshort(r,s),a.push(h),s+=4}return a},e.GPOS.readAnchorRecord=function(r,s){var o=e._bin,a={};return a.fmt=o.readUshort(r,s),a.x=o.readShort(r,s+2),a.y=o.readShort(r,s+4),a},e.GSUB={},e.GSUB.parse=function(r,s,o,a){return e._lctf.parse(r,s,o,a,e.GSUB.subt)},e.GSUB.subt=function(r,s,o,a){var l=e._bin,c=o,u={};if(u.fmt=l.readUshort(r,o),o+=2,s!=1&&s!=2&&s!=4&&s!=5&&s!=6)return null;if(s==1||s==2||s==4||s==5&&u.fmt<=2||s==6&&u.fmt<=2){var h=l.readUshort(r,o);o+=2,u.coverage=e._lctf.readCoverage(r,c+h)}if(s==1&&u.fmt>=1&&u.fmt<=2){if(u.fmt==1)u.delta=l.readShort(r,o),o+=2;else if(u.fmt==2){var f=l.readUshort(r,o);o+=2,u.newg=l.readUshorts(r,o,f),o+=2*u.newg.length}}else if(s==2&&u.fmt==1){f=l.readUshort(r,o),o+=2,u.seqs=[];for(var d=0;d<f;d++){var m=l.readUshort(r,o)+c;o+=2;var A=l.readUshort(r,m);u.seqs.push(l.readUshorts(r,m+2,A))}}else if(s==4)for(u.vals=[],f=l.readUshort(r,o),o+=2,d=0;d<f;d++){var g=l.readUshort(r,o);o+=2,u.vals.push(e.GSUB.readLigatureSet(r,c+g))}else if(s==5&&u.fmt==2){if(u.fmt==2){var y=l.readUshort(r,o);o+=2,u.cDef=e._lctf.readClassDef(r,c+y),u.scset=[];var E=l.readUshort(r,o);for(o+=2,d=0;d<E;d++){var x=l.readUshort(r,o);o+=2,u.scset.push(x==0?null:e.GSUB.readSubClassSet(r,c+x))}}}else if(s==6&&u.fmt==3){if(u.fmt==3){for(d=0;d<3;d++){f=l.readUshort(r,o),o+=2;for(var C=[],T=0;T<f;T++)C.push(e._lctf.readCoverage(r,c+l.readUshort(r,o+2*T)));o+=2*f,d==0&&(u.backCvg=C),d==1&&(u.inptCvg=C),d==2&&(u.ahedCvg=C)}f=l.readUshort(r,o),o+=2,u.lookupRec=e.GSUB.readSubstLookupRecords(r,o,f)}}else{if(s==7&&u.fmt==1){var I=l.readUshort(r,o);o+=2;var M=l.readUint(r,o);if(o+=4,a.ltype==9)a.ltype=I;else if(a.ltype!=I)throw"invalid extension substitution";return e.GSUB.subt(r,a.ltype,c+M)}console.debug("unsupported GSUB table LookupType",s,"format",u.fmt)}return u},e.GSUB.readSubClassSet=function(r,s){var o=e._bin.readUshort,a=s,l=[],c=o(r,s);s+=2;for(var u=0;u<c;u++){var h=o(r,s);s+=2,l.push(e.GSUB.readSubClassRule(r,a+h))}return l},e.GSUB.readSubClassRule=function(r,s){var o=e._bin.readUshort,a={},l=o(r,s),c=o(r,s+=2);s+=2,a.input=[];for(var u=0;u<l-1;u++)a.input.push(o(r,s)),s+=2;return a.substLookupRecords=e.GSUB.readSubstLookupRecords(r,s,c),a},e.GSUB.readSubstLookupRecords=function(r,s,o){for(var a=e._bin.readUshort,l=[],c=0;c<o;c++)l.push(a(r,s),a(r,s+2)),s+=4;return l},e.GSUB.readChainSubClassSet=function(r,s){var o=e._bin,a=s,l=[],c=o.readUshort(r,s);s+=2;for(var u=0;u<c;u++){var h=o.readUshort(r,s);s+=2,l.push(e.GSUB.readChainSubClassRule(r,a+h))}return l},e.GSUB.readChainSubClassRule=function(r,s){for(var o=e._bin,a={},l=["backtrack","input","lookahead"],c=0;c<l.length;c++){var u=o.readUshort(r,s);s+=2,c==1&&u--,a[l[c]]=o.readUshorts(r,s,u),s+=2*a[l[c]].length}return u=o.readUshort(r,s),s+=2,a.subst=o.readUshorts(r,s,2*u),s+=2*a.subst.length,a},e.GSUB.readLigatureSet=function(r,s){var o=e._bin,a=s,l=[],c=o.readUshort(r,s);s+=2;for(var u=0;u<c;u++){var h=o.readUshort(r,s);s+=2,l.push(e.GSUB.readLigature(r,a+h))}return l},e.GSUB.readLigature=function(r,s){var o=e._bin,a={chain:[]};a.nglyph=o.readUshort(r,s),s+=2;var l=o.readUshort(r,s);s+=2;for(var c=0;c<l-1;c++)a.chain.push(o.readUshort(r,s)),s+=2;return a},e.head={},e.head.parse=function(r,s,o){var a=e._bin,l={};return a.readFixed(r,s),s+=4,l.fontRevision=a.readFixed(r,s),s+=4,a.readUint(r,s),s+=4,a.readUint(r,s),s+=4,l.flags=a.readUshort(r,s),s+=2,l.unitsPerEm=a.readUshort(r,s),s+=2,l.created=a.readUint64(r,s),s+=8,l.modified=a.readUint64(r,s),s+=8,l.xMin=a.readShort(r,s),s+=2,l.yMin=a.readShort(r,s),s+=2,l.xMax=a.readShort(r,s),s+=2,l.yMax=a.readShort(r,s),s+=2,l.macStyle=a.readUshort(r,s),s+=2,l.lowestRecPPEM=a.readUshort(r,s),s+=2,l.fontDirectionHint=a.readShort(r,s),s+=2,l.indexToLocFormat=a.readShort(r,s),s+=2,l.glyphDataFormat=a.readShort(r,s),s+=2,l},e.hhea={},e.hhea.parse=function(r,s,o){var a=e._bin,l={};return a.readFixed(r,s),s+=4,l.ascender=a.readShort(r,s),s+=2,l.descender=a.readShort(r,s),s+=2,l.lineGap=a.readShort(r,s),s+=2,l.advanceWidthMax=a.readUshort(r,s),s+=2,l.minLeftSideBearing=a.readShort(r,s),s+=2,l.minRightSideBearing=a.readShort(r,s),s+=2,l.xMaxExtent=a.readShort(r,s),s+=2,l.caretSlopeRise=a.readShort(r,s),s+=2,l.caretSlopeRun=a.readShort(r,s),s+=2,l.caretOffset=a.readShort(r,s),s+=2,s+=8,l.metricDataFormat=a.readShort(r,s),s+=2,l.numberOfHMetrics=a.readUshort(r,s),s+=2,l},e.hmtx={},e.hmtx.parse=function(r,s,o,a){for(var l=e._bin,c={aWidth:[],lsBearing:[]},u=0,h=0,f=0;f<a.maxp.numGlyphs;f++)f<a.hhea.numberOfHMetrics&&(u=l.readUshort(r,s),s+=2,h=l.readShort(r,s),s+=2),c.aWidth.push(u),c.lsBearing.push(h);return c},e.kern={},e.kern.parse=function(r,s,o,a){var l=e._bin,c=l.readUshort(r,s);if(s+=2,c==1)return e.kern.parseV1(r,s-2,o,a);var u=l.readUshort(r,s);s+=2;for(var h={glyph1:[],rval:[]},f=0;f<u;f++){s+=2,o=l.readUshort(r,s),s+=2;var d=l.readUshort(r,s);s+=2;var m=d>>>8;if((m&=15)!=0)throw"unknown kern table format: "+m;s=e.kern.readFormat0(r,s,h)}return h},e.kern.parseV1=function(r,s,o,a){var l=e._bin;l.readFixed(r,s),s+=4;var c=l.readUint(r,s);s+=4;for(var u={glyph1:[],rval:[]},h=0;h<c;h++){l.readUint(r,s),s+=4;var f=l.readUshort(r,s);s+=2,l.readUshort(r,s),s+=2;var d=f>>>8;if((d&=15)!=0)throw"unknown kern table format: "+d;s=e.kern.readFormat0(r,s,u)}return u},e.kern.readFormat0=function(r,s,o){var a=e._bin,l=-1,c=a.readUshort(r,s);s+=2,a.readUshort(r,s),s+=2,a.readUshort(r,s),s+=2,a.readUshort(r,s),s+=2;for(var u=0;u<c;u++){var h=a.readUshort(r,s);s+=2;var f=a.readUshort(r,s);s+=2;var d=a.readShort(r,s);s+=2,h!=l&&(o.glyph1.push(h),o.rval.push({glyph2:[],vals:[]}));var m=o.rval[o.rval.length-1];m.glyph2.push(f),m.vals.push(d),l=h}return s},e.loca={},e.loca.parse=function(r,s,o,a){var l=e._bin,c=[],u=a.head.indexToLocFormat,h=a.maxp.numGlyphs+1;if(u==0)for(var f=0;f<h;f++)c.push(l.readUshort(r,s+(f<<1))<<1);if(u==1)for(f=0;f<h;f++)c.push(l.readUint(r,s+(f<<2)));return c},e.maxp={},e.maxp.parse=function(r,s,o){var a=e._bin,l={},c=a.readUint(r,s);return s+=4,l.numGlyphs=a.readUshort(r,s),s+=2,c==65536&&(l.maxPoints=a.readUshort(r,s),s+=2,l.maxContours=a.readUshort(r,s),s+=2,l.maxCompositePoints=a.readUshort(r,s),s+=2,l.maxCompositeContours=a.readUshort(r,s),s+=2,l.maxZones=a.readUshort(r,s),s+=2,l.maxTwilightPoints=a.readUshort(r,s),s+=2,l.maxStorage=a.readUshort(r,s),s+=2,l.maxFunctionDefs=a.readUshort(r,s),s+=2,l.maxInstructionDefs=a.readUshort(r,s),s+=2,l.maxStackElements=a.readUshort(r,s),s+=2,l.maxSizeOfInstructions=a.readUshort(r,s),s+=2,l.maxComponentElements=a.readUshort(r,s),s+=2,l.maxComponentDepth=a.readUshort(r,s),s+=2),l},e.name={},e.name.parse=function(r,s,o){var a=e._bin,l={};a.readUshort(r,s),s+=2;var c=a.readUshort(r,s);s+=2,a.readUshort(r,s);for(var u,h=["copyright","fontFamily","fontSubfamily","ID","fullName","version","postScriptName","trademark","manufacturer","designer","description","urlVendor","urlDesigner","licence","licenceURL","---","typoFamilyName","typoSubfamilyName","compatibleFull","sampleText","postScriptCID","wwsFamilyName","wwsSubfamilyName","lightPalette","darkPalette"],f=s+=2,d=0;d<c;d++){var m=a.readUshort(r,s);s+=2;var A=a.readUshort(r,s);s+=2;var g=a.readUshort(r,s);s+=2;var y=a.readUshort(r,s);s+=2;var E=a.readUshort(r,s);s+=2;var x=a.readUshort(r,s);s+=2;var C,T=h[y],I=f+12*c+x;if(m==0)C=a.readUnicode(r,I,E/2);else if(m==3&&A==0)C=a.readUnicode(r,I,E/2);else if(A==0)C=a.readASCII(r,I,E);else if(A==1)C=a.readUnicode(r,I,E/2);else if(A==3)C=a.readUnicode(r,I,E/2);else{if(m!=1)throw"unknown encoding "+A+", platformID: "+m;C=a.readASCII(r,I,E),console.debug("reading unknown MAC encoding "+A+" as ASCII")}var M="p"+m+","+g.toString(16);l[M]==null&&(l[M]={}),l[M][T!==void 0?T:y]=C,l[M]._lang=g}for(var L in l)if(l[L].postScriptName!=null&&l[L]._lang==1033)return l[L];for(var L in l)if(l[L].postScriptName!=null&&l[L]._lang==0)return l[L];for(var L in l)if(l[L].postScriptName!=null&&l[L]._lang==3084)return l[L];for(var L in l)if(l[L].postScriptName!=null)return l[L];for(var L in l){u=L;break}return console.debug("returning name table with languageID "+l[u]._lang),l[u]},e["OS/2"]={},e["OS/2"].parse=function(r,s,o){var a=e._bin.readUshort(r,s);s+=2;var l={};if(a==0)e["OS/2"].version0(r,s,l);else if(a==1)e["OS/2"].version1(r,s,l);else if(a==2||a==3||a==4)e["OS/2"].version2(r,s,l);else{if(a!=5)throw"unknown OS/2 table version: "+a;e["OS/2"].version5(r,s,l)}return l},e["OS/2"].version0=function(r,s,o){var a=e._bin;return o.xAvgCharWidth=a.readShort(r,s),s+=2,o.usWeightClass=a.readUshort(r,s),s+=2,o.usWidthClass=a.readUshort(r,s),s+=2,o.fsType=a.readUshort(r,s),s+=2,o.ySubscriptXSize=a.readShort(r,s),s+=2,o.ySubscriptYSize=a.readShort(r,s),s+=2,o.ySubscriptXOffset=a.readShort(r,s),s+=2,o.ySubscriptYOffset=a.readShort(r,s),s+=2,o.ySuperscriptXSize=a.readShort(r,s),s+=2,o.ySuperscriptYSize=a.readShort(r,s),s+=2,o.ySuperscriptXOffset=a.readShort(r,s),s+=2,o.ySuperscriptYOffset=a.readShort(r,s),s+=2,o.yStrikeoutSize=a.readShort(r,s),s+=2,o.yStrikeoutPosition=a.readShort(r,s),s+=2,o.sFamilyClass=a.readShort(r,s),s+=2,o.panose=a.readBytes(r,s,10),s+=10,o.ulUnicodeRange1=a.readUint(r,s),s+=4,o.ulUnicodeRange2=a.readUint(r,s),s+=4,o.ulUnicodeRange3=a.readUint(r,s),s+=4,o.ulUnicodeRange4=a.readUint(r,s),s+=4,o.achVendID=[a.readInt8(r,s),a.readInt8(r,s+1),a.readInt8(r,s+2),a.readInt8(r,s+3)],s+=4,o.fsSelection=a.readUshort(r,s),s+=2,o.usFirstCharIndex=a.readUshort(r,s),s+=2,o.usLastCharIndex=a.readUshort(r,s),s+=2,o.sTypoAscender=a.readShort(r,s),s+=2,o.sTypoDescender=a.readShort(r,s),s+=2,o.sTypoLineGap=a.readShort(r,s),s+=2,o.usWinAscent=a.readUshort(r,s),s+=2,o.usWinDescent=a.readUshort(r,s),s+=2},e["OS/2"].version1=function(r,s,o){var a=e._bin;return s=e["OS/2"].version0(r,s,o),o.ulCodePageRange1=a.readUint(r,s),s+=4,o.ulCodePageRange2=a.readUint(r,s),s+=4},e["OS/2"].version2=function(r,s,o){var a=e._bin;return s=e["OS/2"].version1(r,s,o),o.sxHeight=a.readShort(r,s),s+=2,o.sCapHeight=a.readShort(r,s),s+=2,o.usDefault=a.readUshort(r,s),s+=2,o.usBreak=a.readUshort(r,s),s+=2,o.usMaxContext=a.readUshort(r,s),s+=2},e["OS/2"].version5=function(r,s,o){var a=e._bin;return s=e["OS/2"].version2(r,s,o),o.usLowerOpticalPointSize=a.readUshort(r,s),s+=2,o.usUpperOpticalPointSize=a.readUshort(r,s),s+=2},e.post={},e.post.parse=function(r,s,o){var a=e._bin,l={};return l.version=a.readFixed(r,s),s+=4,l.italicAngle=a.readFixed(r,s),s+=4,l.underlinePosition=a.readShort(r,s),s+=2,l.underlineThickness=a.readShort(r,s),s+=2,l},e==null&&(e={}),e.U==null&&(e.U={}),e.U.codeToGlyph=function(r,s){var o=r.cmap,a=-1;if(o.p0e4!=null?a=o.p0e4:o.p3e1!=null?a=o.p3e1:o.p1e0!=null?a=o.p1e0:o.p0e3!=null&&(a=o.p0e3),a==-1)throw"no familiar platform and encoding!";var l=o.tables[a];if(l.format==0)return s>=l.map.length?0:l.map[s];if(l.format==4){for(var c=-1,u=0;u<l.endCount.length;u++)if(s<=l.endCount[u]){c=u;break}return c==-1||l.startCount[c]>s?0:65535&(l.idRangeOffset[c]!=0?l.glyphIdArray[s-l.startCount[c]+(l.idRangeOffset[c]>>1)-(l.idRangeOffset.length-c)]:s+l.idDelta[c])}if(l.format==12){if(s>l.groups[l.groups.length-1][1])return 0;for(u=0;u<l.groups.length;u++){var h=l.groups[u];if(h[0]<=s&&s<=h[1])return h[2]+(s-h[0])}return 0}throw"unknown cmap table format "+l.format},e.U.glyphToPath=function(r,s){var o={cmds:[],crds:[]};if(r.SVG&&r.SVG.entries[s]){var a=r.SVG.entries[s];return a==null?o:(typeof a=="string"&&(a=e.SVG.toPath(a),r.SVG.entries[s]=a),a)}if(r.CFF){var l={x:0,y:0,stack:[],nStems:0,haveWidth:!1,width:r.CFF.Private?r.CFF.Private.defaultWidthX:0,open:!1},c=r.CFF,u=r.CFF.Private;if(c.ROS){for(var h=0;c.FDSelect[h+2]<=s;)h+=2;u=c.FDArray[c.FDSelect[h+1]].Private}e.U._drawCFF(r.CFF.CharStrings[s],l,c,u,o)}else r.glyf&&e.U._drawGlyf(s,r,o);return o},e.U._drawGlyf=function(r,s,o){var a=s.glyf[r];a==null&&(a=s.glyf[r]=e.glyf._parseGlyf(s,r)),a!=null&&(a.noc>-1?e.U._simpleGlyph(a,o):e.U._compoGlyph(a,s,o))},e.U._simpleGlyph=function(r,s){for(var o=0;o<r.noc;o++){for(var a=o==0?0:r.endPts[o-1]+1,l=r.endPts[o],c=a;c<=l;c++){var u=c==a?l:c-1,h=c==l?a:c+1,f=1&r.flags[c],d=1&r.flags[u],m=1&r.flags[h],A=r.xs[c],g=r.ys[c];if(c==a)if(f){if(!d){e.U.P.moveTo(s,A,g);continue}e.U.P.moveTo(s,r.xs[u],r.ys[u])}else d?e.U.P.moveTo(s,r.xs[u],r.ys[u]):e.U.P.moveTo(s,(r.xs[u]+A)/2,(r.ys[u]+g)/2);f?d&&e.U.P.lineTo(s,A,g):m?e.U.P.qcurveTo(s,A,g,r.xs[h],r.ys[h]):e.U.P.qcurveTo(s,A,g,(A+r.xs[h])/2,(g+r.ys[h])/2)}e.U.P.closePath(s)}},e.U._compoGlyph=function(r,s,o){for(var a=0;a<r.parts.length;a++){var l={cmds:[],crds:[]},c=r.parts[a];e.U._drawGlyf(c.glyphIndex,s,l);for(var u=c.m,h=0;h<l.crds.length;h+=2){var f=l.crds[h],d=l.crds[h+1];o.crds.push(f*u.a+d*u.b+u.tx),o.crds.push(f*u.c+d*u.d+u.ty)}for(h=0;h<l.cmds.length;h++)o.cmds.push(l.cmds[h])}},e.U._getGlyphClass=function(r,s){var o=e._lctf.getInterval(s,r);return o==-1?0:s[o+2]},e.U._applySubs=function(r,s,o,a){for(var l=r.length-s-1,c=0;c<o.tabs.length;c++)if(o.tabs[c]!=null){var u,h=o.tabs[c];if(!h.coverage||(u=e._lctf.coverageIndex(h.coverage,r[s]))!=-1){if(o.ltype==1)r[s],h.fmt==1?r[s]=r[s]+h.delta:r[s]=h.newg[u];else if(o.ltype==4)for(var f=h.vals[u],d=0;d<f.length;d++){var m=f[d],A=m.chain.length;if(!(A>l)){for(var g=!0,y=0,E=0;E<A;E++){for(;r[s+y+(1+E)]==-1;)y++;m.chain[E]!=r[s+y+(1+E)]&&(g=!1)}if(g){for(r[s]=m.nglyph,E=0;E<A+y;E++)r[s+E+1]=-1;break}}}else if(o.ltype==5&&h.fmt==2)for(var x=e._lctf.getInterval(h.cDef,r[s]),C=h.cDef[x+2],T=h.scset[C],I=0;I<T.length;I++){var M=T[I],L=M.input;if(!(L.length>l)){for(g=!0,E=0;E<L.length;E++){var R=e._lctf.getInterval(h.cDef,r[s+1+E]);if(x==-1&&h.cDef[R+2]!=L[E]){g=!1;break}}if(g){var P=M.substLookupRecords;for(d=0;d<P.length;d+=2)P[d],P[d+1]}}}else if(o.ltype==6&&h.fmt==3){if(!e.U._glsCovered(r,h.backCvg,s-h.backCvg.length)||!e.U._glsCovered(r,h.inptCvg,s)||!e.U._glsCovered(r,h.ahedCvg,s+h.inptCvg.length))continue;var F=h.lookupRec;for(I=0;I<F.length;I+=2){x=F[I];var k=a[F[I+1]];e.U._applySubs(r,s+x,k,a)}}}}},e.U._glsCovered=function(r,s,o){for(var a=0;a<s.length;a++)if(e._lctf.coverageIndex(s[a],r[o+a])==-1)return!1;return!0},e.U.glyphsToPath=function(r,s,o){for(var a={cmds:[],crds:[]},l=0,c=0;c<s.length;c++){var u=s[c];if(u!=-1){for(var h=c<s.length-1&&s[c+1]!=-1?s[c+1]:0,f=e.U.glyphToPath(r,u),d=0;d<f.crds.length;d+=2)a.crds.push(f.crds[d]+l),a.crds.push(f.crds[d+1]);for(o&&a.cmds.push(o),d=0;d<f.cmds.length;d++)a.cmds.push(f.cmds[d]);o&&a.cmds.push("X"),l+=r.hmtx.aWidth[u],c<s.length-1&&(l+=e.U.getPairAdjustment(r,u,h))}}return a},e.U.P={},e.U.P.moveTo=function(r,s,o){r.cmds.push("M"),r.crds.push(s,o)},e.U.P.lineTo=function(r,s,o){r.cmds.push("L"),r.crds.push(s,o)},e.U.P.curveTo=function(r,s,o,a,l,c,u){r.cmds.push("C"),r.crds.push(s,o,a,l,c,u)},e.U.P.qcurveTo=function(r,s,o,a,l){r.cmds.push("Q"),r.crds.push(s,o,a,l)},e.U.P.closePath=function(r){r.cmds.push("Z")},e.U._drawCFF=function(r,s,o,a,l){for(var c=s.stack,u=s.nStems,h=s.haveWidth,f=s.width,d=s.open,m=0,A=s.x,g=s.y,y=0,E=0,x=0,C=0,T=0,I=0,M=0,L=0,R=0,P=0,F={val:0,size:0};m<r.length;){e.CFF.getCharString(r,m,F);var k=F.val;if(m+=F.size,k=="o1"||k=="o18")c.length%2!=0&&!h&&(f=c.shift()+a.nominalWidthX),u+=c.length>>1,c.length=0,h=!0;else if(k=="o3"||k=="o23")c.length%2!=0&&!h&&(f=c.shift()+a.nominalWidthX),u+=c.length>>1,c.length=0,h=!0;else if(k=="o4")c.length>1&&!h&&(f=c.shift()+a.nominalWidthX,h=!0),d&&e.U.P.closePath(l),g+=c.pop(),e.U.P.moveTo(l,A,g),d=!0;else if(k=="o5")for(;c.length>0;)A+=c.shift(),g+=c.shift(),e.U.P.lineTo(l,A,g);else if(k=="o6"||k=="o7")for(var z=c.length,U=k=="o6",W=0;W<z;W++){var $=c.shift();U?A+=$:g+=$,U=!U,e.U.P.lineTo(l,A,g)}else if(k=="o8"||k=="o24"){z=c.length;for(var oe=0;oe+6<=z;)y=A+c.shift(),E=g+c.shift(),x=y+c.shift(),C=E+c.shift(),A=x+c.shift(),g=C+c.shift(),e.U.P.curveTo(l,y,E,x,C,A,g),oe+=6;k=="o24"&&(A+=c.shift(),g+=c.shift(),e.U.P.lineTo(l,A,g))}else{if(k=="o11")break;if(k=="o1234"||k=="o1235"||k=="o1236"||k=="o1237")k=="o1234"&&(E=g,x=(y=A+c.shift())+c.shift(),P=C=E+c.shift(),I=C,L=g,A=(M=(T=(R=x+c.shift())+c.shift())+c.shift())+c.shift(),e.U.P.curveTo(l,y,E,x,C,R,P),e.U.P.curveTo(l,T,I,M,L,A,g)),k=="o1235"&&(y=A+c.shift(),E=g+c.shift(),x=y+c.shift(),C=E+c.shift(),R=x+c.shift(),P=C+c.shift(),T=R+c.shift(),I=P+c.shift(),M=T+c.shift(),L=I+c.shift(),A=M+c.shift(),g=L+c.shift(),c.shift(),e.U.P.curveTo(l,y,E,x,C,R,P),e.U.P.curveTo(l,T,I,M,L,A,g)),k=="o1236"&&(y=A+c.shift(),E=g+c.shift(),x=y+c.shift(),P=C=E+c.shift(),I=C,M=(T=(R=x+c.shift())+c.shift())+c.shift(),L=I+c.shift(),A=M+c.shift(),e.U.P.curveTo(l,y,E,x,C,R,P),e.U.P.curveTo(l,T,I,M,L,A,g)),k=="o1237"&&(y=A+c.shift(),E=g+c.shift(),x=y+c.shift(),C=E+c.shift(),R=x+c.shift(),P=C+c.shift(),T=R+c.shift(),I=P+c.shift(),M=T+c.shift(),L=I+c.shift(),Math.abs(M-A)>Math.abs(L-g)?A=M+c.shift():g=L+c.shift(),e.U.P.curveTo(l,y,E,x,C,R,P),e.U.P.curveTo(l,T,I,M,L,A,g));else if(k=="o14"){if(c.length>0&&!h&&(f=c.shift()+o.nominalWidthX,h=!0),c.length==4){var X=c.shift(),Q=c.shift(),Y=c.shift(),O=c.shift(),K=e.CFF.glyphBySE(o,Y),te=e.CFF.glyphBySE(o,O);e.U._drawCFF(o.CharStrings[K],s,o,a,l),s.x=X,s.y=Q,e.U._drawCFF(o.CharStrings[te],s,o,a,l)}d&&(e.U.P.closePath(l),d=!1)}else if(k=="o19"||k=="o20")c.length%2!=0&&!h&&(f=c.shift()+a.nominalWidthX),u+=c.length>>1,c.length=0,h=!0,m+=u+7>>3;else if(k=="o21")c.length>2&&!h&&(f=c.shift()+a.nominalWidthX,h=!0),g+=c.pop(),A+=c.pop(),d&&e.U.P.closePath(l),e.U.P.moveTo(l,A,g),d=!0;else if(k=="o22")c.length>1&&!h&&(f=c.shift()+a.nominalWidthX,h=!0),A+=c.pop(),d&&e.U.P.closePath(l),e.U.P.moveTo(l,A,g),d=!0;else if(k=="o25"){for(;c.length>6;)A+=c.shift(),g+=c.shift(),e.U.P.lineTo(l,A,g);y=A+c.shift(),E=g+c.shift(),x=y+c.shift(),C=E+c.shift(),A=x+c.shift(),g=C+c.shift(),e.U.P.curveTo(l,y,E,x,C,A,g)}else if(k=="o26")for(c.length%2&&(A+=c.shift());c.length>0;)y=A,E=g+c.shift(),A=x=y+c.shift(),g=(C=E+c.shift())+c.shift(),e.U.P.curveTo(l,y,E,x,C,A,g);else if(k=="o27")for(c.length%2&&(g+=c.shift());c.length>0;)E=g,x=(y=A+c.shift())+c.shift(),C=E+c.shift(),A=x+c.shift(),g=C,e.U.P.curveTo(l,y,E,x,C,A,g);else if(k=="o10"||k=="o29"){var q=k=="o10"?a:o;if(c.length==0)console.debug("error: empty stack");else{var J=c.pop(),ie=q.Subrs[J+q.Bias];s.x=A,s.y=g,s.nStems=u,s.haveWidth=h,s.width=f,s.open=d,e.U._drawCFF(ie,s,o,a,l),A=s.x,g=s.y,u=s.nStems,h=s.haveWidth,f=s.width,d=s.open}}else if(k=="o30"||k=="o31"){var re=c.length,se=(oe=0,k=="o31");for(oe+=re-(z=-3&re);oe<z;)se?(E=g,x=(y=A+c.shift())+c.shift(),g=(C=E+c.shift())+c.shift(),z-oe==5?(A=x+c.shift(),oe++):A=x,se=!1):(y=A,E=g+c.shift(),x=y+c.shift(),C=E+c.shift(),A=x+c.shift(),z-oe==5?(g=C+c.shift(),oe++):g=C,se=!0),e.U.P.curveTo(l,y,E,x,C,A,g),oe+=4}else{if((k+"").charAt(0)=="o")throw console.debug("Unknown operation: "+k,r),k;c.push(k)}}}s.x=A,s.y=g,s.nStems=u,s.haveWidth=h,s.width=f,s.open=d};var t=e,n={Typr:t};return i.Typr=t,i.default=n,Object.defineProperty(i,"__esModule",{value:!0}),i})({}).Typr}/*!
Custom bundle of woff2otf (https://github.com/arty-name/woff2otf) with fflate
(https://github.com/101arrowz/fflate) for use in Troika text rendering. 
Original licenses apply: 
- fflate: https://github.com/101arrowz/fflate/blob/master/LICENSE (MIT)
- woff2otf.js: https://github.com/arty-name/woff2otf/blob/master/woff2otf.js (Apache2)
*/function $he(){return(function(i){var e=Uint8Array,t=Uint16Array,n=Uint32Array,r=new e([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),s=new e([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),o=new e([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),a=function(k,z){for(var U=new t(31),W=0;W<31;++W)U[W]=z+=1<<k[W-1];var $=new n(U[30]);for(W=1;W<30;++W)for(var oe=U[W];oe<U[W+1];++oe)$[oe]=oe-U[W]<<5|W;return[U,$]},l=a(r,2),c=l[0],u=l[1];c[28]=258,u[258]=28;for(var h=a(s,0)[0],f=new t(32768),d=0;d<32768;++d){var m=(43690&d)>>>1|(21845&d)<<1;m=(61680&(m=(52428&m)>>>2|(13107&m)<<2))>>>4|(3855&m)<<4,f[d]=((65280&m)>>>8|(255&m)<<8)>>>1}var A=function(k,z,U){for(var W=k.length,$=0,oe=new t(z);$<W;++$)++oe[k[$]-1];var X,Q=new t(z);for($=0;$<z;++$)Q[$]=Q[$-1]+oe[$-1]<<1;{X=new t(1<<z);var Y=15-z;for($=0;$<W;++$)if(k[$])for(var O=$<<4|k[$],K=z-k[$],te=Q[k[$]-1]++<<K,q=te|(1<<K)-1;te<=q;++te)X[f[te]>>>Y]=O}return X},g=new e(288);for(d=0;d<144;++d)g[d]=8;for(d=144;d<256;++d)g[d]=9;for(d=256;d<280;++d)g[d]=7;for(d=280;d<288;++d)g[d]=8;var y=new e(32);for(d=0;d<32;++d)y[d]=5;var E=A(g,9),x=A(y,5),C=function(k){for(var z=k[0],U=1;U<k.length;++U)k[U]>z&&(z=k[U]);return z},T=function(k,z,U){var W=z/8|0;return(k[W]|k[W+1]<<8)>>(7&z)&U},I=function(k,z){var U=z/8|0;return(k[U]|k[U+1]<<8|k[U+2]<<16)>>(7&z)},M=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],L=function(k,z,U){var W=new Error(z||M[k]);if(W.code=k,Error.captureStackTrace&&Error.captureStackTrace(W,L),!U)throw W;return W},R=function(k,z,U){var W=k.length;if(!W||U&&!U.l&&W<5)return z||new e(0);var $=!z||U,oe=!U||U.i;U||(U={}),z||(z=new e(3*W));var X,Q=function(ft){var be=z.length;if(ft>be){var qe=new e(Math.max(2*be,ft));qe.set(z),z=qe}},Y=U.f||0,O=U.p||0,K=U.b||0,te=U.l,q=U.d,J=U.m,ie=U.n,re=8*W;do{if(!te){U.f=Y=T(k,O,1);var se=T(k,O+1,3);if(O+=3,!se){var ge=k[(V=((X=O)/8|0)+(7&X&&1)+4)-4]|k[V-3]<<8,xe=V+ge;if(xe>W){oe&&L(0);break}$&&Q(K+ge),z.set(k.subarray(V,xe),K),U.b=K+=ge,U.p=O=8*xe;continue}if(se==1)te=E,q=x,J=9,ie=5;else if(se==2){var pe=T(k,O,31)+257,ce=T(k,O+10,15)+4,we=pe+T(k,O+5,31)+1;O+=14;for(var Ee=new e(we),ve=new e(19),Ae=0;Ae<ce;++Ae)ve[o[Ae]]=T(k,O+3*Ae,7);O+=3*ce;var Le=C(ve),Te=(1<<Le)-1,ne=A(ve,Le);for(Ae=0;Ae<we;){var V,de=ne[T(k,O,Te)];if(O+=15&de,(V=de>>>4)<16)Ee[Ae++]=V;else{var Re=0,Be=0;for(V==16?(Be=3+T(k,O,3),O+=2,Re=Ee[Ae-1]):V==17?(Be=3+T(k,O,7),O+=3):V==18&&(Be=11+T(k,O,127),O+=7);Be--;)Ee[Ae++]=Re}}var Fe=Ee.subarray(0,pe),He=Ee.subarray(pe);J=C(Fe),ie=C(He),te=A(Fe,J),q=A(He,ie)}else L(1);if(O>re){oe&&L(0);break}}$&&Q(K+131072);for(var it=(1<<J)-1,$e=(1<<ie)-1,ct=O;;ct=O){var pt=(Re=te[I(k,O)&it])>>>4;if((O+=15&Re)>re){oe&&L(0);break}if(Re||L(2),pt<256)z[K++]=pt;else{if(pt==256){ct=O,te=null;break}var We=pt-254;if(pt>264){var Mt=r[Ae=pt-257];We=T(k,O,(1<<Mt)-1)+c[Ae],O+=Mt}var Ft=q[I(k,O)&$e],St=Ft>>>4;if(Ft||L(3),O+=15&Ft,He=h[St],St>3&&(Mt=s[St],He+=I(k,O)&(1<<Mt)-1,O+=Mt),O>re){oe&&L(0);break}$&&Q(K+131072);for(var gt=K+We;K<gt;K+=4)z[K]=z[K-He],z[K+1]=z[K+1-He],z[K+2]=z[K+2-He],z[K+3]=z[K+3-He];K=gt}}U.l=te,U.p=ct,U.b=K,te&&(Y=1,U.m=J,U.d=q,U.n=ie)}while(!Y);return K==z.length?z:(function(ft,be,qe){(qe==null||qe>ft.length)&&(qe=ft.length);var At=new(ft instanceof t?t:ft instanceof n?n:e)(qe-be);return At.set(ft.subarray(be,qe)),At})(z,0,K)},P=new e(0),F=typeof TextDecoder<"u"&&new TextDecoder;try{F.decode(P,{stream:!0})}catch{}return i.convert_streams=function(k){var z=new DataView(k),U=0;function W(){var pe=z.getUint16(U);return U+=2,pe}function $(){var pe=z.getUint32(U);return U+=4,pe}function oe(pe){ge.setUint16(xe,pe),xe+=2}function X(pe){ge.setUint32(xe,pe),xe+=4}for(var Q={signature:$(),flavor:$(),length:$(),numTables:W(),reserved:W(),totalSfntSize:$(),majorVersion:W(),minorVersion:W(),metaOffset:$(),metaLength:$(),metaOrigLength:$(),privOffset:$(),privLength:$()},Y=0;Math.pow(2,Y)<=Q.numTables;)Y++;Y--;for(var O=16*Math.pow(2,Y),K=16*Q.numTables-O,te=12,q=[],J=0;J<Q.numTables;J++)q.push({tag:$(),offset:$(),compLength:$(),origLength:$(),origChecksum:$()}),te+=16;var ie,re=new Uint8Array(12+16*q.length+q.reduce((function(pe,ce){return pe+ce.origLength+4}),0)),se=re.buffer,ge=new DataView(se),xe=0;return X(Q.flavor),oe(Q.numTables),oe(O),oe(Y),oe(K),q.forEach((function(pe){X(pe.tag),X(pe.origChecksum),X(te),X(pe.origLength),pe.outOffset=te,(te+=pe.origLength)%4!=0&&(te+=4-te%4)})),q.forEach((function(pe){var ce,we=k.slice(pe.offset,pe.offset+pe.compLength);if(pe.compLength!=pe.origLength){var Ee=new Uint8Array(pe.origLength);ce=new Uint8Array(we,2),R(ce,Ee)}else Ee=new Uint8Array(we);re.set(Ee,pe.outOffset);var ve=0;(te=pe.outOffset+pe.origLength)%4!=0&&(ve=4-te%4),re.set(new Uint8Array(ve).buffer,pe.outOffset+pe.origLength),ie=te+ve})),se.slice(0,ie)},Object.defineProperty(i,"__esModule",{value:!0}),i})({}).convert_streams}function Yhe(i,e){const t={M:2,L:2,Q:4,C:6,Z:0},n={C:"18g,ca,368,1kz",D:"17k,6,2,2+4,5+c,2+6,2+1,10+1,9+f,j+11,2+1,a,2,2+1,15+2,3,j+2,6+3,2+8,2,2,2+1,w+a,4+e,3+3,2,3+2,3+5,23+w,2f+4,3,2+9,2,b,2+3,3,1k+9,6+1,3+1,2+2,2+d,30g,p+y,1,1+1g,f+x,2,sd2+1d,jf3+4,f+3,2+4,2+2,b+3,42,2,4+2,2+1,2,3,t+1,9f+w,2,el+2,2+g,d+2,2l,2+1,5,3+1,2+1,2,3,6,16wm+1v",R:"17m+3,2,2,6+3,m,15+2,2+2,h+h,13,3+8,2,2,3+1,2,p+1,x,5+4,5,a,2,2,3,u,c+2,g+1,5,2+1,4+1,5j,6+1,2,b,2+2,f,2+1,1s+2,2,3+1,7,1ez0,2,2+1,4+4,b,4,3,b,42,2+2,4,3,2+1,2,o+3,ae,ep,x,2o+2,3+1,3,5+1,6",L:"x9u,jff,a,fd,jv",T:"4t,gj+33,7o+4,1+1,7c+18,2,2+1,2+1,2,21+a,2,1b+k,h,2u+6,3+5,3+1,2+3,y,2,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,3,7,6+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+d,1,1+1,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,ek,3+1,r+4,1e+4,6+5,2p+c,1+3,1,1+2,1+b,2db+2,3y,2p+v,ff+3,30+1,n9x,1+2,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,5s,6y+2,ea,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+9,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2,2b+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,470+8,at4+4,1o+6,t5,1s+3,2a,f5l+1,2+3,43o+2,a+7,1+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,1,gzau,v+2n,3l+6n"},r=1,s=2,o=4,a=8,l=16,c=32;let u;function h(M){if(!u){const L={R:s,L:r,D:o,C:l,U:c,T:a};u=new Map;for(let R in n){let P=0;n[R].split(",").forEach(F=>{let[k,z]=F.split("+");k=parseInt(k,36),z=z?parseInt(z,36):0,u.set(P+=k,L[R]);for(let U=z;U--;)u.set(++P,L[R])})}}return u.get(M)||c}const f=1,d=2,m=3,A=4,g=[null,"isol","init","fina","medi"];function y(M){const L=new Uint8Array(M.length);let R=c,P=f,F=-1;for(let k=0;k<M.length;k++){const z=M.codePointAt(k);let U=h(z)|0,W=f;U&a||(R&(r|o|l)?U&(s|o|l)?(W=m,(P===f||P===m)&&L[F]++):U&(r|c)&&(P===d||P===A)&&L[F]--:R&(s|c)&&(P===d||P===A)&&L[F]--,P=L[k]=W,R=U,F=k,z>65535&&k++)}return L}function E(M,L){const R=[];for(let F=0;F<L.length;F++){const k=L.codePointAt(F);k>65535&&F++,R.push(i.U.codeToGlyph(M,k))}const P=M.GSUB;if(P){const{lookupList:F,featureList:k}=P;let z;const U=/^(rlig|liga|mset|isol|init|fina|medi|half|pres|blws|ccmp)$/,W=[];k.forEach($=>{if(U.test($.tag))for(let oe=0;oe<$.tab.length;oe++){if(W[$.tab[oe]])continue;W[$.tab[oe]]=!0;const X=F[$.tab[oe]],Q=/^(isol|init|fina|medi)$/.test($.tag);Q&&!z&&(z=y(L));for(let Y=0;Y<R.length;Y++)(!z||!Q||g[z[Y]]===$.tag)&&i.U._applySubs(R,Y,X,F)}})}return R}function x(M,L){const R=new Int16Array(L.length*3);let P=0;for(;P<L.length;P++){const U=L[P];if(U===-1)continue;R[P*3+2]=M.hmtx.aWidth[U];const W=M.GPOS;if(W){const $=W.lookupList;for(let oe=0;oe<$.length;oe++){const X=$[oe];for(let Q=0;Q<X.tabs.length;Q++){const Y=X.tabs[Q];if(X.ltype===1){if(i._lctf.coverageIndex(Y.coverage,U)!==-1&&Y.pos){z(Y.pos,P);break}}else if(X.ltype===2){let O=null,K=F();if(K!==-1){const te=i._lctf.coverageIndex(Y.coverage,L[K]);if(te!==-1){if(Y.fmt===1){const q=Y.pairsets[te];for(let J=0;J<q.length;J++)q[J].gid2===U&&(O=q[J])}else if(Y.fmt===2){const q=i.U._getGlyphClass(L[K],Y.classDef1),J=i.U._getGlyphClass(U,Y.classDef2);O=Y.matrix[q][J]}if(O){O.val1&&z(O.val1,K),O.val2&&z(O.val2,P);break}}}}else if(X.ltype===4){const O=i._lctf.coverageIndex(Y.markCoverage,U);if(O!==-1){const K=F(k),te=K===-1?-1:i._lctf.coverageIndex(Y.baseCoverage,L[K]);if(te!==-1){const q=Y.markArray[O],J=Y.baseArray[te][q.markClass];R[P*3]=J.x-q.x+R[K*3]-R[K*3+2],R[P*3+1]=J.y-q.y+R[K*3+1];break}}}else if(X.ltype===6){const O=i._lctf.coverageIndex(Y.mark1Coverage,U);if(O!==-1){const K=F();if(K!==-1){const te=L[K];if(C(M,te)===3){const q=i._lctf.coverageIndex(Y.mark2Coverage,te);if(q!==-1){const J=Y.mark1Array[O],ie=Y.mark2Array[q][J.markClass];R[P*3]=ie.x-J.x+R[K*3]-R[K*3+2],R[P*3+1]=ie.y-J.y+R[K*3+1];break}}}}}}}}else if(M.kern&&!M.cff){const $=F();if($!==-1){const oe=M.kern.glyph1.indexOf(L[$]);if(oe!==-1){const X=M.kern.rval[oe].glyph2.indexOf(U);X!==-1&&(R[$*3+2]+=M.kern.rval[oe].vals[X])}}}}return R;function F(U){for(let W=P-1;W>=0;W--)if(L[W]!==-1&&(!U||U(L[W])))return W;return-1}function k(U){return C(M,U)===1}function z(U,W){for(let $=0;$<3;$++)R[W*3+$]+=U[$]||0}}function C(M,L){const R=M.GDEF&&M.GDEF.glyphClassDef;return R?i.U._getGlyphClass(L,R):0}function T(...M){for(let L=0;L<M.length;L++)if(typeof M[L]=="number")return M[L]}function I(M){const L=Object.create(null),R=M["OS/2"],P=M.hhea,F=M.head.unitsPerEm,k=T(R&&R.sTypoAscender,P&&P.ascender,F),z={unitsPerEm:F,ascender:k,descender:T(R&&R.sTypoDescender,P&&P.descender,0),capHeight:T(R&&R.sCapHeight,k),xHeight:T(R&&R.sxHeight,k),lineGap:T(R&&R.sTypoLineGap,P&&P.lineGap),supportsCodePoint(U){return i.U.codeToGlyph(M,U)>0},forEachGlyph(U,W,$,oe){let X=0;const Q=1/z.unitsPerEm*W,Y=E(M,U);let O=0;const K=x(M,Y);return Y.forEach((te,q)=>{if(te!==-1){let J=L[te];if(!J){const{cmds:ie,crds:re}=i.U.glyphToPath(M,te);let se="",ge=0;for(let Ee=0,ve=ie.length;Ee<ve;Ee++){const Ae=t[ie[Ee]];se+=ie[Ee];for(let Le=1;Le<=Ae;Le++)se+=(Le>1?",":"")+re[ge++]}let xe,pe,ce,we;if(re.length){xe=pe=1/0,ce=we=-1/0;for(let Ee=0,ve=re.length;Ee<ve;Ee+=2){let Ae=re[Ee],Le=re[Ee+1];Ae<xe&&(xe=Ae),Le<pe&&(pe=Le),Ae>ce&&(ce=Ae),Le>we&&(we=Le)}}else xe=ce=pe=we=0;J=L[te]={index:te,advanceWidth:M.hmtx.aWidth[te],xMin:xe,yMin:pe,xMax:ce,yMax:we,path:se}}oe.call(null,J,X+K[q*3]*Q,K[q*3+1]*Q,O),X+=K[q*3+2]*Q,$&&(X+=$*W)}O+=U.codePointAt(O)>65535?2:1}),X}};return z}return function(L){const R=new Uint8Array(L,0,4),P=i._bin.readASCII(R,0,4);if(P==="wOFF")L=e(L);else if(P==="wOF2")throw new Error("woff2 fonts not supported");return I(i.parse(L)[0])}}const Xhe=bA({name:"Typr Font Parser",dependencies:[Khe,$he,Yhe],init(i,e,t){const n=i(),r=e();return t(n,r)}});/*!
Custom bundle of @unicode-font-resolver/client v1.0.2 (https://github.com/lojjic/unicode-font-resolver)
for use in Troika text rendering. 
Original MIT license applies
*/function qhe(){return(function(i){var e=function(){this.buckets=new Map};e.prototype.add=function(x){var C=x>>5;this.buckets.set(C,(this.buckets.get(C)||0)|1<<(31&x))},e.prototype.has=function(x){var C=this.buckets.get(x>>5);return C!==void 0&&(C&1<<(31&x))!=0},e.prototype.serialize=function(){var x=[];return this.buckets.forEach((function(C,T){x.push((+T).toString(36)+":"+C.toString(36))})),x.join(",")},e.prototype.deserialize=function(x){var C=this;this.buckets.clear(),x.split(",").forEach((function(T){var I=T.split(":");C.buckets.set(parseInt(I[0],36),parseInt(I[1],36))}))};var t=Math.pow(2,8),n=t-1,r=~n;function s(x){var C=(function(I){return I&r})(x).toString(16),T=(function(I){return(I&r)+t-1})(x).toString(16);return"codepoint-index/plane"+(x>>16)+"/"+C+"-"+T+".json"}function o(x,C){var T=x&n,I=C.codePointAt(T/6|0);return((I=(I||48)-48)&1<<T%6)!=0}function a(x,C){var T;(T=x,T.replace(/U\+/gi,"").replace(/^,+|,+$/g,"").split(/,+/).map((function(I){return I.split("-").map((function(M){return parseInt(M.trim(),16)}))}))).forEach((function(I){var M=I[0],L=I[1];L===void 0&&(L=M),C(M,L)}))}function l(x,C){a(x,(function(T,I){for(var M=T;M<=I;M++)C(M)}))}var c={},u={},h=new WeakMap,f="https://cdn.jsdelivr.net/gh/lojjic/unicode-font-resolver@v1.0.1/packages/data";function d(x){var C=h.get(x);return C||(C=new e,l(x.ranges,(function(T){return C.add(T)})),h.set(x,C)),C}var m,A=new Map;function g(x,C,T){return x[C]?C:x[T]?T:(function(I){for(var M in I)return M})(x)}function y(x,C){var T=C;if(!x.includes(T)){T=1/0;for(var I=0;I<x.length;I++)Math.abs(x[I]-C)<Math.abs(T-C)&&(T=x[I])}return T}function E(x){return m||(m=new Set,l("9-D,20,85,A0,1680,2000-200A,2028-202F,205F,3000",(function(C){m.add(C)}))),m.has(x)}return i.CodePointSet=e,i.clearCache=function(){c={},u={}},i.getFontsForString=function(x,C){C===void 0&&(C={});var T,I=C.lang;I===void 0&&(I=new RegExp("\\p{Script=Hangul}","u").test(T=x)?"ko":new RegExp("\\p{Script=Hiragana}|\\p{Script=Katakana}","u").test(T)?"ja":"en");var M=C.category;M===void 0&&(M="sans-serif");var L=C.style;L===void 0&&(L="normal");var R=C.weight;R===void 0&&(R=400);var P=(C.dataUrl||f).replace(/\/$/g,""),F=new Map,k=new Uint8Array(x.length),z={},U={},W=new Array(x.length),$=new Map,oe=!1;function X(O){var K=A.get(O);return K||(K=fetch(P+"/"+O).then((function(te){if(!te.ok)throw new Error(te.statusText);return te.json().then((function(q){if(!Array.isArray(q)||q[0]!==1)throw new Error("Incorrect schema version; need 1, got "+q[0]);return q[1]}))})).catch((function(te){if(P!==f)return oe||(console.error('unicode-font-resolver: Failed loading from dataUrl "'+P+'", trying default CDN. '+te.message),oe=!0),P=f,A.delete(O),X(O);throw te})),A.set(O,K)),K}for(var Q=function(O){var K=x.codePointAt(O),te=s(K);W[O]=te,c[te]||$.has(te)||$.set(te,X(te).then((function(q){c[te]=q}))),K>65535&&(O++,Y=O)},Y=0;Y<x.length;Y++)Q(Y);return Promise.all($.values()).then((function(){$.clear();for(var O=function(te){var q=x.codePointAt(te),J=null,ie=c[W[te]],re=void 0;for(var se in ie){var ge=U[se];if(ge===void 0&&(ge=U[se]=new RegExp(se).test(I||"en")),ge){for(var xe in re=se,ie[se])if(o(q,ie[se][xe])){J=xe;break}break}}if(!J){e:for(var pe in ie)if(pe!==re){for(var ce in ie[pe])if(o(q,ie[pe][ce])){J=ce;break e}}}J||(console.debug("No font coverage for U+"+q.toString(16)),J="latin"),W[te]=J,u[J]||$.has(J)||$.set(J,X("font-meta/"+J+".json").then((function(we){u[J]=we}))),q>65535&&(te++,K=te)},K=0;K<x.length;K++)O(K);return Promise.all($.values())})).then((function(){for(var O,K=null,te=0;te<x.length;te++){var q=x.codePointAt(te);if(K&&(E(q)||d(K).has(q)))k[te]=k[te-1];else{K=u[W[te]];var J=z[K.id];if(!J){var ie=K.typeforms,re=g(ie,M,"sans-serif"),se=g(ie[re],L,"normal"),ge=y((O=ie[re])===null||O===void 0?void 0:O[se],R);J=z[K.id]=P+"/font-files/"+K.id+"/"+re+"."+se+"."+ge+".woff"}var xe=F.get(J);xe==null&&(xe=F.size,F.set(J,xe)),k[te]=xe}q>65535&&(te++,k[te]=k[te-1])}return{fontUrls:Array.from(F.keys()),chars:k}}))},Object.defineProperty(i,"__esModule",{value:!0}),i})({})}function Jhe(i,e){const t=Object.create(null),n=Object.create(null);function r(o,a){const l=c=>{console.error(`Failure loading font ${o}`,c)};try{const c=new XMLHttpRequest;c.open("get",o,!0),c.responseType="arraybuffer",c.onload=function(){if(c.status>=400)l(new Error(c.statusText));else if(c.status>0)try{const u=i(c.response);u.src=o,a(u)}catch(u){l(u)}},c.onerror=l,c.send()}catch(c){l(c)}}function s(o,a){let l=t[o];l?a(l):n[o]?n[o].push(a):(n[o]=[a],r(o,c=>{c.src=o,t[o]=c,n[o].forEach(u=>u(c)),delete n[o]}))}return function(o,a,{lang:l,fonts:c=[],style:u="normal",weight:h="normal",unicodeFontsURL:f}={}){const d=new Uint8Array(o.length),m=[];o.length||E();const A=new Map,g=[];if(u!=="italic"&&(u="normal"),typeof h!="number"&&(h=h==="bold"?700:400),c&&!Array.isArray(c)&&(c=[c]),c=c.slice().filter(C=>!C.lang||C.lang.test(l)).reverse(),c.length){let M=0;(function L(R=0){for(let P=R,F=o.length;P<F;P++){const k=o.codePointAt(P);if(M===1&&m[d[P-1]].supportsCodePoint(k)||P>0&&/\s/.test(o[P]))d[P]=d[P-1],M===2&&(g[g.length-1][1]=P);else for(let z=d[P],U=c.length;z<=U;z++)if(z===U){const W=M===2?g[g.length-1]:g[g.length]=[P,P];W[1]=P,M=2}else{d[P]=z;const{src:W,unicodeRange:$}=c[z];if(!$||x(k,$)){const oe=t[W];if(!oe){s(W,()=>{L(P)});return}if(oe.supportsCodePoint(k)){let X=A.get(oe);typeof X!="number"&&(X=m.length,m.push(oe),A.set(oe,X)),d[P]=X,M=1;break}}}k>65535&&P+1<F&&(d[P+1]=d[P],P++,M===2&&(g[g.length-1][1]=P))}y()})()}else g.push([0,o.length-1]),y();function y(){if(g.length){const C=g.map(T=>o.substring(T[0],T[1]+1)).join(`
`);e.getFontsForString(C,{lang:l||void 0,style:u,weight:h,dataUrl:f}).then(({fontUrls:T,chars:I})=>{const M=m.length;let L=0;g.forEach(P=>{for(let F=0,k=P[1]-P[0];F<=k;F++)d[P[0]+F]=I[L++]+M;L++});let R=0;T.forEach((P,F)=>{s(P,k=>{m[F+M]=k,++R===T.length&&E()})})})}else E()}function E(){a({chars:d,fonts:m})}function x(C,T){for(let I=0;I<T.length;I++){const[M,L=M]=T[I];if(M<=C&&C<=L)return!0}return!1}}}const Zhe=bA({name:"FontResolver",dependencies:[Jhe,Xhe,qhe],init(i,e,t){return i(e,t())}});function efe(i,e){const n=/[\u00AD\u034F\u061C\u115F-\u1160\u17B4-\u17B5\u180B-\u180E\u200B-\u200F\u202A-\u202E\u2060-\u206F\u3164\uFE00-\uFE0F\uFEFF\uFFA0\uFFF0-\uFFF8]/,r="[^\\S\\u00A0]",s=new RegExp(`${r}|[\\-\\u007C\\u00AD\\u2010\\u2012-\\u2014\\u2027\\u2056\\u2E17\\u2E40]`);function o({text:m,lang:A,fonts:g,style:y,weight:E,preResolvedFonts:x,unicodeFontsURL:C},T){const I=({chars:M,fonts:L})=>{let R,P;const F=[];for(let k=0;k<M.length;k++)M[k]!==P?(P=M[k],F.push(R={start:k,end:k,fontObj:L[M[k]]})):R.end=k;T(F)};x?I(x):i(m,I,{lang:A,fonts:g,style:y,weight:E,unicodeFontsURL:C})}function a({text:m="",font:A,lang:g,sdfGlyphSize:y=64,fontSize:E=400,fontWeight:x=1,fontStyle:C="normal",letterSpacing:T=0,lineHeight:I="normal",maxWidth:M=1/0,direction:L,textAlign:R="left",textIndent:P=0,whiteSpace:F="normal",overflowWrap:k="normal",anchorX:z=0,anchorY:U=0,metricsOnly:W=!1,unicodeFontsURL:$,preResolvedFonts:oe=null,includeCaretPositions:X=!1,chunkedBoundsSize:Q=8192,colorRanges:Y=null},O){const K=h(),te={fontLoad:0,typesetting:0};m.indexOf("\r")>-1&&(console.info("Typesetter: got text with \\r chars; normalizing to \\n"),m=m.replace(/\r\n/g,`
`).replace(/\r/g,`
`)),E=+E,T=+T,M=+M,I=I||"normal",P=+P,o({text:m,lang:g,style:C,weight:x,fonts:typeof A=="string"?[{src:A}]:A,unicodeFontsURL:$,preResolvedFonts:oe},q=>{te.fontLoad=h()-K;const J=isFinite(M);let ie=null,re=null,se=null,ge=null,xe=null,pe=null,ce=null,we=null,Ee=0,ve=0,Ae=F!=="nowrap";const Le=new Map,Te=h();let ne=P,V=0,de=new f;const Re=[de];q.forEach($e=>{const{fontObj:ct}=$e,{ascender:pt,descender:We,unitsPerEm:Mt,lineGap:Ft,capHeight:St,xHeight:gt}=ct;let ft=Le.get(ct);if(!ft){const De=E/Mt,Ce=I==="normal"?(pt-We+Ft)*De:I*E,_t=(Ce-(pt-We)*De)/2,vt=Math.min(Ce,(pt-We)*De),bt=(pt+We)/2*De+vt/2;ft={index:Le.size,src:ct.src,fontObj:ct,fontSizeMult:De,unitsPerEm:Mt,ascender:pt*De,descender:We*De,capHeight:St*De,xHeight:gt*De,lineHeight:Ce,baseline:-_t-pt*De,caretTop:bt,caretBottom:bt-vt},Le.set(ct,ft)}const{fontSizeMult:be}=ft,qe=m.slice($e.start,$e.end+1);let At,yt;ct.forEachGlyph(qe,E,T,(De,Ce,_t,vt)=>{Ce+=V,vt+=$e.start,At=Ce,yt=De;const bt=m.charAt(vt),Pt=De.advanceWidth*be,qt=de.count;let Nt;if("isEmpty"in De||(De.isWhitespace=!!bt&&new RegExp(r).test(bt),De.canBreakAfter=!!bt&&s.test(bt),De.isEmpty=De.xMin===De.xMax||De.yMin===De.yMax||n.test(bt)),!De.isWhitespace&&!De.isEmpty&&ve++,Ae&&J&&!De.isWhitespace&&Ce+Pt+ne>M&&qt){if(de.glyphAt(qt-1).glyphObj.canBreakAfter)Nt=new f,ne=-Ce;else for(let Vn=qt;Vn--;)if(Vn===0&&k==="break-word"){Nt=new f,ne=-Ce;break}else if(de.glyphAt(Vn).glyphObj.canBreakAfter){Nt=de.splitAt(Vn+1);const pn=Nt.glyphAt(0).x;ne-=pn;for(let qn=Nt.count;qn--;)Nt.glyphAt(qn).x-=pn;break}Nt&&(de.isSoftWrapped=!0,de=Nt,Re.push(de),Ee=M)}let dn=de.glyphAt(de.count);dn.glyphObj=De,dn.x=Ce+ne,dn.y=_t,dn.width=Pt,dn.charIndex=vt,dn.fontData=ft,bt===`
`&&(de=new f,Re.push(de),ne=-(Ce+Pt+T*E)+P)}),V=At+yt.advanceWidth*be+T*E});let Be=0;Re.forEach($e=>{let ct=!0;for(let pt=$e.count;pt--;){const We=$e.glyphAt(pt);ct&&!We.glyphObj.isWhitespace&&($e.width=We.x+We.width,$e.width>Ee&&(Ee=$e.width),ct=!1);let{lineHeight:Mt,capHeight:Ft,xHeight:St,baseline:gt}=We.fontData;Mt>$e.lineHeight&&($e.lineHeight=Mt);const ft=gt-$e.baseline;ft<0&&($e.baseline+=ft,$e.cap+=ft,$e.ex+=ft),$e.cap=Math.max($e.cap,$e.baseline+Ft),$e.ex=Math.max($e.ex,$e.baseline+St)}$e.baseline-=Be,$e.cap-=Be,$e.ex-=Be,Be+=$e.lineHeight});let Fe=0,He=0;if(z&&(typeof z=="number"?Fe=-z:typeof z=="string"&&(Fe=-Ee*(z==="left"?0:z==="center"?.5:z==="right"?1:c(z)))),U&&(typeof U=="number"?He=-U:typeof U=="string"&&(He=U==="top"?0:U==="top-baseline"?-Re[0].baseline:U==="top-cap"?-Re[0].cap:U==="top-ex"?-Re[0].ex:U==="middle"?Be/2:U==="bottom"?Be:U==="bottom-baseline"?-Re[Re.length-1].baseline:c(U)*Be)),!W){const $e=e.getEmbeddingLevels(m,L);ie=new Uint16Array(ve),re=new Uint8Array(ve),se=new Float32Array(ve*2),ge={},ce=[1/0,1/0,-1/0,-1/0],we=[],X&&(pe=new Float32Array(m.length*4)),Y&&(xe=new Uint8Array(ve*3));let ct=0,pt=-1,We=-1,Mt,Ft;if(Re.forEach((St,gt)=>{let{count:ft,width:be}=St;if(ft>0){let qe=0;for(let vt=ft;vt--&&St.glyphAt(vt).glyphObj.isWhitespace;)qe++;let At=0,yt=0;if(R==="center")At=(Ee-be)/2;else if(R==="right")At=Ee-be;else if(R==="justify"&&St.isSoftWrapped){let vt=0;for(let bt=ft-qe;bt--;)St.glyphAt(bt).glyphObj.isWhitespace&&vt++;yt=(Ee-be)/vt}if(yt||At){let vt=0;for(let bt=0;bt<ft;bt++){let Pt=St.glyphAt(bt);const qt=Pt.glyphObj;Pt.x+=At+vt,yt!==0&&qt.isWhitespace&&bt<ft-qe&&(vt+=yt,Pt.width+=yt)}}const De=e.getReorderSegments(m,$e,St.glyphAt(0).charIndex,St.glyphAt(St.count-1).charIndex);for(let vt=0;vt<De.length;vt++){const[bt,Pt]=De[vt];let qt=1/0,Nt=-1/0;for(let dn=0;dn<ft;dn++)if(St.glyphAt(dn).charIndex>=bt){let Vn=dn,pn=dn;for(;pn<ft;pn++){let qn=St.glyphAt(pn);if(qn.charIndex>Pt)break;pn<ft-qe&&(qt=Math.min(qt,qn.x),Nt=Math.max(Nt,qn.x+qn.width))}for(let qn=Vn;qn<pn;qn++){const Ci=St.glyphAt(qn);Ci.x=Nt-(Ci.x+Ci.width-qt)}break}}let Ce;const _t=vt=>Ce=vt;for(let vt=0;vt<ft;vt++){const bt=St.glyphAt(vt);Ce=bt.glyphObj;const Pt=Ce.index,qt=$e.levels[bt.charIndex]&1;if(qt){const Nt=e.getMirroredCharacter(m[bt.charIndex]);Nt&&bt.fontData.fontObj.forEachGlyph(Nt,0,0,_t)}if(X){const{charIndex:Nt,fontData:dn}=bt,Vn=bt.x+Fe,pn=bt.x+bt.width+Fe;pe[Nt*4]=qt?pn:Vn,pe[Nt*4+1]=qt?Vn:pn,pe[Nt*4+2]=St.baseline+dn.caretBottom+He,pe[Nt*4+3]=St.baseline+dn.caretTop+He;const qn=Nt-pt;qn>1&&u(pe,pt,qn),pt=Nt}if(Y){const{charIndex:Nt}=bt;for(;Nt>We;)We++,Y.hasOwnProperty(We)&&(Ft=Y[We])}if(!Ce.isWhitespace&&!Ce.isEmpty){const Nt=ct++,{fontSizeMult:dn,src:Vn,index:pn}=bt.fontData,qn=ge[Vn]||(ge[Vn]={});qn[Pt]||(qn[Pt]={path:Ce.path,pathBounds:[Ce.xMin,Ce.yMin,Ce.xMax,Ce.yMax]});const Ci=bt.x+Fe,as=bt.y+St.baseline+He;se[Nt*2]=Ci,se[Nt*2+1]=as;const Nr=Ci+Ce.xMin*dn,ur=as+Ce.yMin*dn,tr=Ci+Ce.xMax*dn,An=as+Ce.yMax*dn;Nr<ce[0]&&(ce[0]=Nr),ur<ce[1]&&(ce[1]=ur),tr>ce[2]&&(ce[2]=tr),An>ce[3]&&(ce[3]=An),Nt%Q===0&&(Mt={start:Nt,end:Nt,rect:[1/0,1/0,-1/0,-1/0]},we.push(Mt)),Mt.end++;const vr=Mt.rect;if(Nr<vr[0]&&(vr[0]=Nr),ur<vr[1]&&(vr[1]=ur),tr>vr[2]&&(vr[2]=tr),An>vr[3]&&(vr[3]=An),ie[Nt]=Pt,re[Nt]=pn,Y){const Uo=Nt*3;xe[Uo]=Ft>>16&255,xe[Uo+1]=Ft>>8&255,xe[Uo+2]=Ft&255}}}}}),pe){const St=m.length-pt;St>1&&u(pe,pt,St)}}const it=[];Le.forEach(({index:$e,src:ct,unitsPerEm:pt,ascender:We,descender:Mt,lineHeight:Ft,capHeight:St,xHeight:gt})=>{it[$e]={src:ct,unitsPerEm:pt,ascender:We,descender:Mt,lineHeight:Ft,capHeight:St,xHeight:gt}}),te.typesetting=h()-Te,O({glyphIds:ie,glyphFontIndices:re,glyphPositions:se,glyphData:ge,fontData:it,caretPositions:pe,glyphColors:xe,chunkedBounds:we,fontSize:E,topBaseline:He+Re[0].baseline,blockBounds:[Fe,He-Be,Fe+Ee,He],visibleBounds:ce,timings:te})})}function l(m,A){a({...m,metricsOnly:!0},g=>{const[y,E,x,C]=g.blockBounds;A({width:x-y,height:C-E})})}function c(m){let A=m.match(/^([\d.]+)%$/),g=A?parseFloat(A[1]):NaN;return isNaN(g)?0:g/100}function u(m,A,g){const y=m[A*4],E=m[A*4+1],x=m[A*4+2],C=m[A*4+3],T=(E-y)/g;for(let I=0;I<g;I++){const M=(A+I)*4;m[M]=y+T*I,m[M+1]=y+T*(I+1),m[M+2]=x,m[M+3]=C}}function h(){return(self.performance||Date).now()}function f(){this.data=[]}const d=["glyphObj","x","y","width","charIndex","fontData"];return f.prototype={width:0,lineHeight:0,baseline:0,cap:0,ex:0,isSoftWrapped:!1,get count(){return Math.ceil(this.data.length/d.length)},glyphAt(m){let A=f.flyweight;return A.data=this.data,A.index=m,A},splitAt(m){let A=new f;return A.data=this.data.splice(m*d.length),A}},f.flyweight=d.reduce((m,A,g,y)=>(Object.defineProperty(m,A,{get(){return this.data[this.index*d.length+g]},set(E){this.data[this.index*d.length+g]=E}}),m),{data:null,index:0}),{typeset:a,measure:l}}const Qm=()=>(self.performance||Date).now(),u4=HH();let t7;function tfe(i,e,t,n,r,s,o,a,l,c,u=!0){return u?ife(i,e,t,n,r,s,o,a,l,c).then(null,h=>(t7||(console.warn("WebGL SDF generation failed, falling back to JS",h),t7=!0),i7(i,e,t,n,r,s,o,a,l,c))):i7(i,e,t,n,r,s,o,a,l,c)}const q_=[],nfe=5;let c5=0;function VH(){const i=Qm();for(;q_.length&&Qm()-i<nfe;)q_.shift()();c5=q_.length?setTimeout(VH,0):0}const ife=(...i)=>new Promise((e,t)=>{q_.push(()=>{const n=Qm();try{u4.webgl.generateIntoCanvas(...i),e({timing:Qm()-n})}catch(r){t(r)}}),c5||(c5=setTimeout(VH,0))}),rfe=4,sfe=2e3,n7={};let ofe=0;function i7(i,e,t,n,r,s,o,a,l,c){const u="TroikaTextSDFGenerator_JS_"+ofe++%rfe;let h=n7[u];return h||(h=n7[u]={workerModule:bA({name:u,workerId:u,dependencies:[HH,Qm],init(f,d){const m=f().javascript.generate;return function(...A){const g=d();return{textureData:m(...A),timing:d()-g}}},getTransferables(f){return[f.textureData.buffer]}}),requests:0,idleTimer:null}),h.requests++,clearTimeout(h.idleTimer),h.workerModule(i,e,t,n,r,s).then(({textureData:f,timing:d})=>{const m=Qm(),A=new Uint8Array(f.length*4);for(let g=0;g<f.length;g++)A[g*4+c]=f[g];return u4.webglUtils.renderImageData(o,A,a,l,i,e,1<<3-c),d+=Qm()-m,--h.requests===0&&(h.idleTimer=setTimeout(()=>{Ohe(u)},sfe)),{timing:d}})}function afe(i){i._warm||(u4.webgl.isSupported(i),i._warm=!0)}const lfe=u4.webglUtils.resizeWebGLCanvasWithoutClearing,Ov={unicodeFontsURL:null,sdfGlyphSize:64,sdfMargin:1/16,sdfExponent:9,textureWidth:2048},cfe=new ut;function Gg(){return(self.performance||Date).now()}const r7=Object.create(null);function WH(i,e){i=ffe({},i);const t=Gg(),n=[];if(i.font&&n.push({label:"user",src:dfe(i.font)}),i.font=n,i.text=""+i.text,i.sdfGlyphSize=i.sdfGlyphSize||Ov.sdfGlyphSize,i.unicodeFontsURL=i.unicodeFontsURL||Ov.unicodeFontsURL,i.colorRanges!=null){let f={};for(let d in i.colorRanges)if(i.colorRanges.hasOwnProperty(d)){let m=i.colorRanges[d];typeof m!="number"&&(m=cfe.set(m).getHex()),f[d]=m}i.colorRanges=f}Object.freeze(i);const{textureWidth:r,sdfExponent:s}=Ov,{sdfGlyphSize:o}=i,a=r/o*4;let l=r7[o];if(!l){const f=document.createElement("canvas");f.width=r,f.height=o*256/a,l=r7[o]={glyphCount:0,sdfGlyphSize:o,sdfCanvas:f,sdfTexture:new vi(f,void 0,void 0,void 0,Pn,Pn),contextLost:!1,glyphsByFont:new Map},l.sdfTexture.generateMipmaps=!1,ufe(l)}const{sdfTexture:c,sdfCanvas:u}=l;$H(i).then(f=>{const{glyphIds:d,glyphFontIndices:m,fontData:A,glyphPositions:g,fontSize:y,timings:E}=f,x=[],C=new Float32Array(d.length*4);let T=0,I=0;const M=Gg(),L=A.map(z=>{let U=l.glyphsByFont.get(z.src);return U||l.glyphsByFont.set(z.src,U=new Map),U});d.forEach((z,U)=>{const W=m[U],{src:$,unitsPerEm:oe}=A[W];let X=L[W].get(z);if(!X){const{path:te,pathBounds:q}=f.glyphData[$][z],J=Math.max(q[2]-q[0],q[3]-q[1])/o*(Ov.sdfMargin*o+.5),ie=l.glyphCount++,re=[q[0]-J,q[1]-J,q[2]+J,q[3]+J];L[W].set(z,X={path:te,atlasIndex:ie,sdfViewBox:re}),x.push(X)}const{sdfViewBox:Q}=X,Y=g[I++],O=g[I++],K=y/oe;C[T++]=Y+Q[0]*K,C[T++]=O+Q[1]*K,C[T++]=Y+Q[2]*K,C[T++]=O+Q[3]*K,d[U]=X.atlasIndex}),E.quads=(E.quads||0)+(Gg()-M);const R=Gg();E.sdf={};const P=u.height,F=Math.ceil(l.glyphCount/a),k=Math.pow(2,Math.ceil(Math.log2(F*o)));k>P&&(console.info(`Increasing SDF texture size ${P}->${k}`),lfe(u,r,k),c.dispose()),Promise.all(x.map(z=>jH(z,l,i.gpuAccelerateSDF).then(({timing:U})=>{E.sdf[z.atlasIndex]=U}))).then(()=>{x.length&&!l.contextLost&&(KH(l),c.needsUpdate=!0),E.sdfTotal=Gg()-R,E.total=Gg()-t,e(Object.freeze({parameters:i,sdfTexture:c,sdfGlyphSize:o,sdfExponent:s,glyphBounds:C,glyphAtlasIndices:d,glyphColors:f.glyphColors,caretPositions:f.caretPositions,chunkedBounds:f.chunkedBounds,ascender:f.ascender,descender:f.descender,lineHeight:f.lineHeight,capHeight:f.capHeight,xHeight:f.xHeight,topBaseline:f.topBaseline,blockBounds:f.blockBounds,visibleBounds:f.visibleBounds,timings:f.timings}))})}),Promise.resolve().then(()=>{l.contextLost||afe(u)})}function jH({path:i,atlasIndex:e,sdfViewBox:t},{sdfGlyphSize:n,sdfCanvas:r,contextLost:s},o){if(s)return Promise.resolve({timing:-1});const{textureWidth:a,sdfExponent:l}=Ov,c=Math.max(t[2]-t[0],t[3]-t[1]),u=Math.floor(e/4),h=u%(a/n)*n,f=Math.floor(u/(a/n))*n,d=e%4;return tfe(n,n,i,t,c,l,r,h,f,d,o)}function ufe(i){const e=i.sdfCanvas;e.addEventListener("webglcontextlost",t=>{console.log("Context Lost",t),t.preventDefault(),i.contextLost=!0}),e.addEventListener("webglcontextrestored",t=>{console.log("Context Restored",t),i.contextLost=!1;const n=[];i.glyphsByFont.forEach(r=>{r.forEach(s=>{n.push(jH(s,i,!0))})}),Promise.all(n).then(()=>{KH(i),i.sdfTexture.needsUpdate=!0})})}function hfe({font:i,characters:e,sdfGlyphSize:t},n){let r=Array.isArray(e)?e.join(`
`):""+e;WH({font:i,sdfGlyphSize:t,text:r},n)}function ffe(i,e){for(let t in e)e.hasOwnProperty(t)&&(i[t]=e[t]);return i}let N3;function dfe(i){return N3||(N3=typeof document>"u"?{}:document.createElement("a")),N3.href=i,N3.href}function KH(i){if(typeof createImageBitmap!="function"){console.info("Safari<15: applying SDF canvas workaround");const{sdfCanvas:e,sdfTexture:t}=i,{width:n,height:r}=e,s=i.sdfCanvas.getContext("webgl");let o=t.image.data;(!o||o.length!==n*r*4)&&(o=new Uint8Array(n*r*4),t.image={width:n,height:r,data:o},t.flipY=!1,t.isDataTexture=!0),s.readPixels(0,0,n,r,s.RGBA,s.UNSIGNED_BYTE,o)}}const pfe=bA({name:"Typesetter",dependencies:[efe,Zhe,Uhe],init(i,e,t){return i(e,t())}}),$H=bA({name:"Typesetter",dependencies:[pfe],init(i){return function(e){return new Promise(t=>{i.typeset(e,t)})}},getTransferables(i){const e=[];for(let t in i)i[t]&&i[t].buffer&&e.push(i[t].buffer);return e}});$H.onMainThread;const s7={};function mfe(i){let e=s7[i];return e||(e=s7[i]=new Fs(1,1,i,i).translate(.5,.5,0)),e}const gfe="aTroikaGlyphBounds",o7="aTroikaGlyphIndex",Afe="aTroikaGlyphColor";class yfe extends dx{constructor(){super(),this.detail=1,this.curveRadius=0,this.groups=[{start:0,count:1/0,materialIndex:0},{start:0,count:1/0,materialIndex:1}],this.boundingSphere=new Bi,this.boundingBox=new ti}computeBoundingSphere(){}computeBoundingBox(){}set detail(e){if(e!==this._detail){this._detail=e,(typeof e!="number"||e<1)&&(e=1);let t=mfe(e);["position","normal","uv"].forEach(n=>{this.attributes[n]=t.attributes[n].clone()}),this.setIndex(t.getIndex().clone())}}get detail(){return this._detail}set curveRadius(e){e!==this._curveRadius&&(this._curveRadius=e,this._updateBounds())}get curveRadius(){return this._curveRadius}updateGlyphs(e,t,n,r,s){this.updateAttributeData(gfe,e,4),this.updateAttributeData(o7,t,1),this.updateAttributeData(Afe,s,3),this._blockBounds=n,this._chunkedBounds=r,this.instanceCount=t.length,this._updateBounds()}_updateBounds(){const e=this._blockBounds;if(e){const{curveRadius:t,boundingBox:n}=this;if(t){const{PI:r,floor:s,min:o,max:a,sin:l,cos:c}=Math,u=r/2,h=r*2,f=Math.abs(t),d=e[0]/f,m=e[2]/f,A=s((d+u)/h)!==s((m+u)/h)?-f:o(l(d)*f,l(m)*f),g=s((d-u)/h)!==s((m-u)/h)?f:a(l(d)*f,l(m)*f),y=s((d+r)/h)!==s((m+r)/h)?f*2:a(f-c(d)*f,f-c(m)*f);n.min.set(A,e[1],t<0?-y:0),n.max.set(g,e[3],t<0?0:y)}else n.min.set(e[0],e[1],0),n.max.set(e[2],e[3],0);n.getBoundingSphere(this.boundingSphere)}}applyClipRect(e){let t=this.getAttribute(o7).count,n=this._chunkedBounds;if(n)for(let r=n.length;r--;){t=n[r].end;let s=n[r].rect;if(s[1]<e.w&&s[3]>e.y&&s[0]<e.z&&s[2]>e.x)break}this.instanceCount=t}updateAttributeData(e,t,n){const r=this.getAttribute(e);t?r&&r.array.length===t.length?(r.array.set(t),r.needsUpdate=!0):(this.setAttribute(e,new Su(t,n)),delete this._maxInstanceCount,this.dispose()):r&&this.deleteAttribute(e)}}const vfe=`
uniform vec2 uTroikaSDFTextureSize;
uniform float uTroikaSDFGlyphSize;
uniform vec4 uTroikaTotalBounds;
uniform vec4 uTroikaClipRect;
uniform mat3 uTroikaOrient;
uniform bool uTroikaUseGlyphColors;
uniform float uTroikaEdgeOffset;
uniform float uTroikaBlurRadius;
uniform vec2 uTroikaPositionOffset;
uniform float uTroikaCurveRadius;
attribute vec4 aTroikaGlyphBounds;
attribute float aTroikaGlyphIndex;
attribute vec3 aTroikaGlyphColor;
varying vec2 vTroikaGlyphUV;
varying vec4 vTroikaTextureUVBounds;
varying float vTroikaTextureChannel;
varying vec3 vTroikaGlyphColor;
varying vec2 vTroikaGlyphDimensions;
`,xfe=`
vec4 bounds = aTroikaGlyphBounds;
bounds.xz += uTroikaPositionOffset.x;
bounds.yw -= uTroikaPositionOffset.y;

vec4 outlineBounds = vec4(
  bounds.xy - uTroikaEdgeOffset - uTroikaBlurRadius,
  bounds.zw + uTroikaEdgeOffset + uTroikaBlurRadius
);
vec4 clippedBounds = vec4(
  clamp(outlineBounds.xy, uTroikaClipRect.xy, uTroikaClipRect.zw),
  clamp(outlineBounds.zw, uTroikaClipRect.xy, uTroikaClipRect.zw)
);

vec2 clippedXY = (mix(clippedBounds.xy, clippedBounds.zw, position.xy) - bounds.xy) / (bounds.zw - bounds.xy);

position.xy = mix(bounds.xy, bounds.zw, clippedXY);

uv = (position.xy - uTroikaTotalBounds.xy) / (uTroikaTotalBounds.zw - uTroikaTotalBounds.xy);

float rad = uTroikaCurveRadius;
if (rad != 0.0) {
  float angle = position.x / rad;
  position.xz = vec2(sin(angle) * rad, rad - cos(angle) * rad);
  normal.xz = vec2(sin(angle), cos(angle));
}
  
position = uTroikaOrient * position;
normal = uTroikaOrient * normal;

vTroikaGlyphUV = clippedXY.xy;
vTroikaGlyphDimensions = vec2(bounds[2] - bounds[0], bounds[3] - bounds[1]);


float txCols = uTroikaSDFTextureSize.x / uTroikaSDFGlyphSize;
vec2 txUvPerSquare = uTroikaSDFGlyphSize / uTroikaSDFTextureSize;
vec2 txStartUV = txUvPerSquare * vec2(
  mod(floor(aTroikaGlyphIndex / 4.0), txCols),
  floor(floor(aTroikaGlyphIndex / 4.0) / txCols)
);
vTroikaTextureUVBounds = vec4(txStartUV, vec2(txStartUV) + txUvPerSquare);
vTroikaTextureChannel = mod(aTroikaGlyphIndex, 4.0);
`,Efe=`
uniform sampler2D uTroikaSDFTexture;
uniform vec2 uTroikaSDFTextureSize;
uniform float uTroikaSDFGlyphSize;
uniform float uTroikaSDFExponent;
uniform float uTroikaEdgeOffset;
uniform float uTroikaFillOpacity;
uniform float uTroikaBlurRadius;
uniform vec3 uTroikaStrokeColor;
uniform float uTroikaStrokeWidth;
uniform float uTroikaStrokeOpacity;
uniform bool uTroikaSDFDebug;
varying vec2 vTroikaGlyphUV;
varying vec4 vTroikaTextureUVBounds;
varying float vTroikaTextureChannel;
varying vec2 vTroikaGlyphDimensions;

float troikaSdfValueToSignedDistance(float alpha) {
  // Inverse of exponential encoding in webgl-sdf-generator
  
  float maxDimension = max(vTroikaGlyphDimensions.x, vTroikaGlyphDimensions.y);
  float absDist = (1.0 - pow(2.0 * (alpha > 0.5 ? 1.0 - alpha : alpha), 1.0 / uTroikaSDFExponent)) * maxDimension;
  float signedDist = absDist * (alpha > 0.5 ? -1.0 : 1.0);
  return signedDist;
}

float troikaGlyphUvToSdfValue(vec2 glyphUV) {
  vec2 textureUV = mix(vTroikaTextureUVBounds.xy, vTroikaTextureUVBounds.zw, glyphUV);
  vec4 rgba = texture2D(uTroikaSDFTexture, textureUV);
  float ch = floor(vTroikaTextureChannel + 0.5); //NOTE: can't use round() in WebGL1
  return ch == 0.0 ? rgba.r : ch == 1.0 ? rgba.g : ch == 2.0 ? rgba.b : rgba.a;
}

float troikaGlyphUvToDistance(vec2 uv) {
  return troikaSdfValueToSignedDistance(troikaGlyphUvToSdfValue(uv));
}

float troikaGetAADist() {
  
  #if defined(GL_OES_standard_derivatives) || __VERSION__ >= 300
  return length(fwidth(vTroikaGlyphUV * vTroikaGlyphDimensions)) * 0.5;
  #else
  return vTroikaGlyphDimensions.x / 64.0;
  #endif
}

float troikaGetFragDistValue() {
  vec2 clampedGlyphUV = clamp(vTroikaGlyphUV, 0.5 / uTroikaSDFGlyphSize, 1.0 - 0.5 / uTroikaSDFGlyphSize);
  float distance = troikaGlyphUvToDistance(clampedGlyphUV);
 
  // Extrapolate distance when outside bounds:
  distance += clampedGlyphUV == vTroikaGlyphUV ? 0.0 : 
    length((vTroikaGlyphUV - clampedGlyphUV) * vTroikaGlyphDimensions);

  

  return distance;
}

float troikaGetEdgeAlpha(float distance, float distanceOffset, float aaDist) {
  #if defined(IS_DEPTH_MATERIAL) || defined(IS_DISTANCE_MATERIAL)
  float alpha = step(-distanceOffset, -distance);
  #else

  float alpha = smoothstep(
    distanceOffset + aaDist,
    distanceOffset - aaDist,
    distance
  );
  #endif

  return alpha;
}
`,_fe=`
float aaDist = troikaGetAADist();
float fragDistance = troikaGetFragDistValue();
float edgeAlpha = uTroikaSDFDebug ?
  troikaGlyphUvToSdfValue(vTroikaGlyphUV) :
  troikaGetEdgeAlpha(fragDistance, uTroikaEdgeOffset, max(aaDist, uTroikaBlurRadius));

#if !defined(IS_DEPTH_MATERIAL) && !defined(IS_DISTANCE_MATERIAL)
vec4 fillRGBA = gl_FragColor;
fillRGBA.a *= uTroikaFillOpacity;
vec4 strokeRGBA = uTroikaStrokeWidth == 0.0 ? fillRGBA : vec4(uTroikaStrokeColor, uTroikaStrokeOpacity);
if (fillRGBA.a == 0.0) fillRGBA.rgb = strokeRGBA.rgb;
gl_FragColor = mix(fillRGBA, strokeRGBA, smoothstep(
  -uTroikaStrokeWidth - aaDist,
  -uTroikaStrokeWidth + aaDist,
  fragDistance
));
gl_FragColor.a *= edgeAlpha;
#endif

if (edgeAlpha == 0.0) {
  discard;
}
`;function Sfe(i){const e=l5(i,{chained:!0,extensions:{derivatives:!0},uniforms:{uTroikaSDFTexture:{value:null},uTroikaSDFTextureSize:{value:new Ue},uTroikaSDFGlyphSize:{value:0},uTroikaSDFExponent:{value:0},uTroikaTotalBounds:{value:new Rn(0,0,0,0)},uTroikaClipRect:{value:new Rn(0,0,0,0)},uTroikaEdgeOffset:{value:0},uTroikaFillOpacity:{value:1},uTroikaPositionOffset:{value:new Ue},uTroikaCurveRadius:{value:0},uTroikaBlurRadius:{value:0},uTroikaStrokeWidth:{value:0},uTroikaStrokeColor:{value:new ut},uTroikaStrokeOpacity:{value:1},uTroikaOrient:{value:new Tn},uTroikaUseGlyphColors:{value:!0},uTroikaSDFDebug:{value:!1}},vertexDefs:vfe,vertexTransform:xfe,fragmentDefs:Efe,fragmentColorTransform:_fe,customRewriter({vertexShader:t,fragmentShader:n}){let r=/\buniform\s+vec3\s+diffuse\b/;return r.test(n)&&(n=n.replace(r,"varying vec3 vTroikaGlyphColor").replace(/\bdiffuse\b/g,"vTroikaGlyphColor"),r.test(t)||(t=t.replace(QH,`uniform vec3 diffuse;
$&
vTroikaGlyphColor = uTroikaUseGlyphColors ? aTroikaGlyphColor / 255.0 : diffuse;
`))),{vertexShader:t,fragmentShader:n}}});return e.transparent=!0,e.forceSinglePass=!0,Object.defineProperties(e,{isTroikaTextMaterial:{value:!0},shadowSide:{get(){return this.side},set(){}}}),e}const IR=new no({color:16777215,side:Pi,transparent:!0}),a7=8421504,l7=new Xe,U3=new H,mb=new H,lv=[],wfe=new H,gb="+x+y";function c7(i){return Array.isArray(i)?i[0]:i}let YH=()=>{const i=new It(new Fs(1,1),IR);return YH=()=>i,i},XH=()=>{const i=new It(new Fs(1,1,32,1),IR);return XH=()=>i,i};const Cfe={type:"syncstart"},Tfe={type:"synccomplete"},qH=["font","fontSize","fontStyle","fontWeight","lang","letterSpacing","lineHeight","maxWidth","overflowWrap","text","direction","textAlign","textIndent","whiteSpace","anchorX","anchorY","colorRanges","sdfGlyphSize"],bfe=qH.concat("material","color","depthOffset","clipRect","curveRadius","orientation","glyphGeometryDetail");let JH=class extends It{constructor(){const e=new yfe;super(e,null),this.text="",this.anchorX=0,this.anchorY=0,this.curveRadius=0,this.direction="auto",this.font=null,this.unicodeFontsURL=null,this.fontSize=.1,this.fontWeight="normal",this.fontStyle="normal",this.lang=null,this.letterSpacing=0,this.lineHeight="normal",this.maxWidth=1/0,this.overflowWrap="normal",this.textAlign="left",this.textIndent=0,this.whiteSpace="normal",this.material=null,this.color=null,this.colorRanges=null,this.outlineWidth=0,this.outlineColor=0,this.outlineOpacity=1,this.outlineBlur=0,this.outlineOffsetX=0,this.outlineOffsetY=0,this.strokeWidth=0,this.strokeColor=a7,this.strokeOpacity=1,this.fillOpacity=1,this.depthOffset=0,this.clipRect=null,this.orientation=gb,this.glyphGeometryDetail=1,this.sdfGlyphSize=null,this.gpuAccelerateSDF=!0,this.debugSDF=!1}sync(e){this._needsSync&&(this._needsSync=!1,this._isSyncing?(this._queuedSyncs||(this._queuedSyncs=[])).push(e):(this._isSyncing=!0,this.dispatchEvent(Cfe),WH({text:this.text,font:this.font,lang:this.lang,fontSize:this.fontSize||.1,fontWeight:this.fontWeight||"normal",fontStyle:this.fontStyle||"normal",letterSpacing:this.letterSpacing||0,lineHeight:this.lineHeight||"normal",maxWidth:this.maxWidth,direction:this.direction||"auto",textAlign:this.textAlign,textIndent:this.textIndent,whiteSpace:this.whiteSpace,overflowWrap:this.overflowWrap,anchorX:this.anchorX,anchorY:this.anchorY,colorRanges:this.colorRanges,includeCaretPositions:!0,sdfGlyphSize:this.sdfGlyphSize,gpuAccelerateSDF:this.gpuAccelerateSDF,unicodeFontsURL:this.unicodeFontsURL},t=>{this._isSyncing=!1,this._textRenderInfo=t,this.geometry.updateGlyphs(t.glyphBounds,t.glyphAtlasIndices,t.blockBounds,t.chunkedBounds,t.glyphColors);const n=this._queuedSyncs;n&&(this._queuedSyncs=null,this._needsSync=!0,this.sync(()=>{n.forEach(r=>r&&r())})),this.dispatchEvent(Tfe),e&&e()})))}onBeforeRender(e,t,n,r,s,o){this.sync(),s.isTroikaTextMaterial&&this._prepareForRender(s)}dispose(){this.geometry.dispose()}get textRenderInfo(){return this._textRenderInfo||null}createDerivedMaterial(e){return Sfe(e)}get material(){let e=this._derivedMaterial;const t=this._baseMaterial||this._defaultMaterial||(this._defaultMaterial=IR.clone());if((!e||!e.isDerivedFrom(t))&&(e=this._derivedMaterial=this.createDerivedMaterial(t),t.addEventListener("dispose",function n(){t.removeEventListener("dispose",n),e.dispose()})),this.hasOutline()){let n=e._outlineMtl;return n||(n=e._outlineMtl=Object.create(e,{id:{value:e.id+.1}}),n.isTextOutlineMaterial=!0,n.depthWrite=!1,n.map=null,e.addEventListener("dispose",function r(){e.removeEventListener("dispose",r),n.dispose()})),[n,e]}else return e}set material(e){e&&e.isTroikaTextMaterial?(this._derivedMaterial=e,this._baseMaterial=e.baseMaterial):this._baseMaterial=e}hasOutline(){return!!(this.outlineWidth||this.outlineBlur||this.outlineOffsetX||this.outlineOffsetY)}get glyphGeometryDetail(){return this.geometry.detail}set glyphGeometryDetail(e){this.geometry.detail=e}get curveRadius(){return this.geometry.curveRadius}set curveRadius(e){this.geometry.curveRadius=e}get customDepthMaterial(){return c7(this.material).getDepthMaterial()}set customDepthMaterial(e){}get customDistanceMaterial(){return c7(this.material).getDistanceMaterial()}set customDistanceMaterial(e){}_prepareForRender(e){const t=e.isTextOutlineMaterial,n=e.uniforms,r=this.textRenderInfo;if(r){const{sdfTexture:a,blockBounds:l}=r;n.uTroikaSDFTexture.value=a,n.uTroikaSDFTextureSize.value.set(a.image.width,a.image.height),n.uTroikaSDFGlyphSize.value=r.sdfGlyphSize,n.uTroikaSDFExponent.value=r.sdfExponent,n.uTroikaTotalBounds.value.fromArray(l),n.uTroikaUseGlyphColors.value=!t&&!!r.glyphColors;let c=0,u=0,h=0,f,d,m,A=0,g=0;if(t){let{outlineWidth:E,outlineOffsetX:x,outlineOffsetY:C,outlineBlur:T,outlineOpacity:I}=this;c=this._parsePercent(E)||0,u=Math.max(0,this._parsePercent(T)||0),f=I,A=this._parsePercent(x)||0,g=this._parsePercent(C)||0}else h=Math.max(0,this._parsePercent(this.strokeWidth)||0),h&&(m=this.strokeColor,n.uTroikaStrokeColor.value.set(m??a7),d=this.strokeOpacity,d==null&&(d=1)),f=this.fillOpacity;n.uTroikaEdgeOffset.value=c,n.uTroikaPositionOffset.value.set(A,g),n.uTroikaBlurRadius.value=u,n.uTroikaStrokeWidth.value=h,n.uTroikaStrokeOpacity.value=d,n.uTroikaFillOpacity.value=f??1,n.uTroikaCurveRadius.value=this.curveRadius||0;let y=this.clipRect;if(y&&Array.isArray(y)&&y.length===4)n.uTroikaClipRect.value.fromArray(y);else{const E=(this.fontSize||.1)*100;n.uTroikaClipRect.value.set(l[0]-E,l[1]-E,l[2]+E,l[3]+E)}this.geometry.applyClipRect(n.uTroikaClipRect.value)}n.uTroikaSDFDebug.value=!!this.debugSDF,e.polygonOffset=!!this.depthOffset,e.polygonOffsetFactor=e.polygonOffsetUnits=this.depthOffset||0;const s=t?this.outlineColor||0:this.color;if(s==null)delete e.color;else{const a=e.hasOwnProperty("color")?e.color:e.color=new ut;(s!==a._input||typeof s=="object")&&a.set(a._input=s)}let o=this.orientation||gb;if(o!==e._orientation){let a=n.uTroikaOrient.value;o=o.replace(/[^-+xyz]/g,"");let l=o!==gb&&o.match(/^([-+])([xyz])([-+])([xyz])$/);if(l){let[,c,u,h,f]=l;U3.set(0,0,0)[u]=c==="-"?1:-1,mb.set(0,0,0)[f]=h==="-"?-1:1,l7.lookAt(wfe,U3.cross(mb),mb),a.setFromMatrix4(l7)}else a.identity();e._orientation=o}}_parsePercent(e){if(typeof e=="string"){let t=e.match(/^(-?[\d.]+)%$/),n=t?parseFloat(t[1]):NaN;e=(isNaN(n)?0:n/100)*this.fontSize}return e}localPositionToTextCoords(e,t=new Ue){t.copy(e);const n=this.curveRadius;return n&&(t.x=Math.atan2(e.x,Math.abs(n)-Math.abs(e.z))*Math.abs(n)),t}worldPositionToTextCoords(e,t=new Ue){return U3.copy(e),this.localPositionToTextCoords(this.worldToLocal(U3),t)}raycast(e,t){const{textRenderInfo:n,curveRadius:r}=this;if(n){const s=n.blockBounds,o=r?XH():YH(),a=o.geometry,{position:l,uv:c}=a.attributes;for(let u=0;u<c.count;u++){let h=s[0]+c.getX(u)*(s[2]-s[0]);const f=s[1]+c.getY(u)*(s[3]-s[1]);let d=0;r&&(d=r-Math.cos(h/r)*r,h=Math.sin(h/r)*r),l.setXYZ(u,h,f,d)}a.boundingSphere=this.geometry.boundingSphere,a.boundingBox=this.geometry.boundingBox,o.matrixWorld=this.matrixWorld,o.material.side=this.material.side,lv.length=0,o.raycast(e,lv);for(let u=0;u<lv.length;u++)lv[u].object=this,t.push(lv[u])}}copy(e){const t=this.geometry;return super.copy(e),this.geometry=t,bfe.forEach(n=>{this[n]=e[n]}),this}clone(){return new this.constructor().copy(this)}};qH.forEach(i=>{const e="_private_"+i;Object.defineProperty(JH.prototype,i,{get(){return this[e]},set(t){t!==this[e]&&(this[e]=t,this._needsSync=!0)}})});new ti;new ut;const ZH=w.forwardRef(({sdfGlyphSize:i=64,anchorX:e="center",anchorY:t="middle",font:n,fontSize:r=1,children:s,characters:o,onSync:a,...l},c)=>{const u=Ve(({invalidate:m})=>m),[h]=w.useState(()=>new JH),[f,d]=w.useMemo(()=>{const m=[];let A="";return w.Children.forEach(s,g=>{typeof g=="string"||typeof g=="number"?A+=g:m.push(g)}),[m,A]},[s]);return Th(()=>new Promise(m=>hfe({font:n,characters:o},m)),["troika-text",n,o]),w.useLayoutEffect(()=>void h.sync(()=>{u(),a&&a(h)})),w.useEffect(()=>()=>h.dispose(),[h]),w.createElement("primitive",ot({object:h,ref:c,font:n,text:d,anchorX:e,anchorY:t,fontSize:r,sdfGlyphSize:i},l),f)});let Ab=null;async function Ife(i){return typeof i=="string"?await(await fetch(i)).json():i}function Mfe(i){return Ab||(Ab=new Fue),Ab.parse(i)}async function eQ(i){const e=await Ife(i);return Mfe(e)}function h4(i){return Th(eQ,[i])}h4.preload=i=>Lz(eQ,[i]);h4.clear=i=>px([i]);const Rfe=["string","number"],Lfe=i=>{let e="";const t=[];return w.Children.forEach(i,n=>{Rfe.includes(typeof n)?e+=n+"":t.push(n)}),[e,...t]},tQ=w.forwardRef(({font:i,letterSpacing:e=0,lineHeight:t=1,size:n=1,height:r=.2,bevelThickness:s=.1,bevelSize:o=.01,bevelEnabled:a=!1,bevelOffset:l=0,bevelSegments:c=4,curveSegments:u=8,smooth:h,children:f,...d},m)=>{w.useMemo(()=>Or({RenamedTextGeometry:uue}),[]);const A=w.useRef(null),g=h4(i),y=w.useMemo(()=>({font:g,size:n,height:r,bevelThickness:s,bevelSize:o,bevelEnabled:a,bevelSegments:c,bevelOffset:l,curveSegments:u,letterSpacing:e,lineHeight:t}),[g,n,r,s,o,a,c,l,u,e,t]),[E,...x]=w.useMemo(()=>Lfe(f),[f]),C=w.useMemo(()=>[E,y],[E,y]);return w.useLayoutEffect(()=>{h&&(A.current.geometry=lle(A.current.geometry,h),A.current.geometry.computeVertexNormals())},[C,h]),w.useImperativeHandle(m,()=>A.current,[]),w.createElement("mesh",ot({},d,{ref:A}),w.createElement("renamedTextGeometry",{args:C}),x)}),Pfe=()=>{try{var i=document.createElement("canvas");return!!(window.WebGL2RenderingContext&&i.getContext("webgl2"))}catch{return!1}},Bfe=w.forwardRef(({children:i,multisamping:e=8,renderIndex:t=1,disableRender:n,disableGamma:r,disableRenderPass:s,depthBuffer:o=!0,stencilBuffer:a=!1,anisotropy:l=1,encoding:c,type:u,...h},f)=>{w.useMemo(()=>Or({EffectComposer:wce,RenderPass:bce,ShaderPass:t5}),[]);const d=w.useRef(null);w.useImperativeHandle(f,()=>d.current,[]);const{scene:m,camera:A,gl:g,size:y,viewport:E}=Ve(),[x]=w.useState(()=>{const T=new Si(y.width,y.height,{type:u||Ni,format:gi,depthBuffer:o,stencilBuffer:a,anisotropy:l});return u===Zi&&c!=null&&("colorSpace"in T?T.texture.colorSpace=c:T.texture.encoding=c),T.samples=e,T});w.useEffect(()=>{var T,I;(T=d.current)==null||T.setSize(y.width,y.height),(I=d.current)==null||I.setPixelRatio(E.dpr)},[g,y,E.dpr]),Kt(()=>{var T;n||(T=d.current)==null||T.render()},t);const C=[];return s||C.push(w.createElement("renderPass",{key:"renderpass",attach:`passes-${C.length}`,args:[m,A]})),r||C.push(w.createElement("shaderPass",{attach:`passes-${C.length}`,key:"gammapass",args:[hue]})),w.Children.forEach(i,T=>{T&&C.push(w.cloneElement(T,{key:C.length,attach:`passes-${C.length}`}))}),w.createElement("effectComposer",ot({ref:d,args:[g,x]},h),C)});let u5=(function(i){return i.Linear="linear",i.Radial="radial",i})({});function Dfe({stops:i,colors:e,size:t=1024,width:n=16,type:r=u5.Linear,innerCircleRadius:s=0,outerCircleRadius:o="auto",...a}){const l=Ve(u=>u.gl),c=w.useMemo(()=>{const u=document.createElement("canvas"),h=u.getContext("2d");u.width=n,u.height=t;let f;if(r===u5.Linear)f=h.createLinearGradient(0,0,0,t);else{const A=u.width/2,g=u.height/2,y=o!=="auto"?Math.abs(Number(o)):Math.sqrt(A**2+g**2);f=h.createRadialGradient(A,g,Math.abs(s),A,g,y)}const d=new ut;let m=i.length;for(;m--;)f.addColorStop(i[m],d.set(e[m]).getStyle());return h.save(),h.fillStyle=f,h.fillRect(0,0,n,t),h.restore(),u},[i]);return w.createElement("canvasTexture",ot({colorSpace:l.outputColorSpace,args:[c],attach:"map"},a))}function Ec(i,e,t,n){const r=class extends Mi{constructor(o={}){const a=Object.entries(i);super({uniforms:a.reduce((l,[c,u])=>{const h=rp.clone({[c]:{value:u}});return{...l,...h}},{}),vertexShader:e,fragmentShader:t}),this.key="",a.forEach(([l])=>Object.defineProperty(this,l,{get:()=>this.uniforms[l].value,set:c=>this.uniforms[l].value=c})),Object.assign(this,o),n&&n(this)}};return r.key=un.generateUUID(),r}const Q1=i=>i===Object(i)&&!Array.isArray(i)&&typeof i!="function";function xp(i,e){const t=Ve(s=>s.gl),n=cr(xh,Q1(i)?Object.values(i):i);return w.useLayoutEffect(()=>{e==null||e(n)},[e]),w.useEffect(()=>{if("initTexture"in t){let s=[];Array.isArray(n)?s=n:n instanceof vi?s=[n]:Q1(n)&&(s=Object.values(n)),s.forEach(o=>{o instanceof vi&&t.initTexture(o)})}},[t,n]),w.useMemo(()=>{if(Q1(i)){const s={};let o=0;for(const a in i)s[a]=n[o++];return s}else return n},[i,n])}xp.preload=i=>cr.preload(xh,i);xp.clear=i=>cr.clear(xh,i);const kfe=({children:i,input:e,onLoad:t})=>{const n=xp(e,t);return w.createElement(w.Fragment,null,i==null?void 0:i(n))},Ffe=()=>parseInt(dp.replace(/\D+/g,"")),ea=Ffe(),u7=Ec({color:new ut("white"),scale:new Ue(1,1),imageBounds:new Ue(1,1),resolution:1024,map:null,zoom:1,radius:0,grayscale:0,opacity:1},`
  varying vec2 vUv;
  varying vec2 vPos;
  void main() {
    gl_Position = projectionMatrix * viewMatrix * modelMatrix * vec4(position, 1.);
    vUv = uv;
    vPos = position.xy;
  }
`,`
  // mostly from https://gist.github.com/statico/df64c5d167362ecf7b34fca0b1459a44
  varying vec2 vUv;
  varying vec2 vPos;
  uniform vec2 scale;
  uniform vec2 imageBounds;
  uniform float resolution;
  uniform vec3 color;
  uniform sampler2D map;
  uniform float radius;
  uniform float zoom;
  uniform float grayscale;
  uniform float opacity;
  const vec3 luma = vec3(.299, 0.587, 0.114);
  vec4 toGrayscale(vec4 color, float intensity) {
    return vec4(mix(color.rgb, vec3(dot(color.rgb, luma)), intensity), color.a);
  }
  vec2 aspect(vec2 size) {
    return size / min(size.x, size.y);
  }
  
  const float PI = 3.14159265;
    
  // from https://iquilezles.org/articles/distfunctions
  float udRoundBox( vec2 p, vec2 b, float r ) {
    return length(max(abs(p)-b+r,0.0))-r;
  }

  void main() {
    vec2 s = aspect(scale);
    vec2 i = aspect(imageBounds);
    float rs = s.x / s.y;
    float ri = i.x / i.y;
    vec2 new = rs < ri ? vec2(i.x * s.y / i.y, s.y) : vec2(s.x, i.y * s.x / i.x);
    vec2 offset = (rs < ri ? vec2((new.x - s.x) / 2.0, 0.0) : vec2(0.0, (new.y - s.y) / 2.0)) / new;
    vec2 uv = vUv * s / new + offset;
    vec2 zUv = (uv - vec2(0.5, 0.5)) / zoom + vec2(0.5, 0.5);

    vec2 res = vec2(scale * resolution);
    vec2 halfRes = 0.5 * res;
    float b = udRoundBox(vUv.xy * res - halfRes, halfRes, resolution * radius);    
	  vec3 a = mix(vec3(1.0,0.0,0.0), vec3(0.0,0.0,0.0), smoothstep(0.0, 1.0, b));
    gl_FragColor = toGrayscale(texture2D(map, zUv) * vec4(color, opacity * a), grayscale);
    
    #include <tonemapping_fragment>
    #include <${ea>=154?"colorspace_fragment":"encodings_fragment"}>
  }
`),nQ=w.forwardRef(({children:i,color:e,segments:t=1,scale:n=1,zoom:r=1,grayscale:s=0,opacity:o=1,radius:a=0,texture:l,toneMapped:c,transparent:u,side:h,...f},d)=>{Or({ImageMaterial:u7});const m=w.useRef(null),A=Ve(x=>x.size),g=Array.isArray(n)?[n[0],n[1]]:[n,n],y=[l.image.width,l.image.height],E=Math.max(A.width,A.height);return w.useImperativeHandle(d,()=>m.current,[]),w.useLayoutEffect(()=>{m.current.geometry.parameters&&m.current.material.scale.set(g[0]*m.current.geometry.parameters.width,g[1]*m.current.geometry.parameters.height)},[g[0],g[1]]),w.createElement("mesh",ot({ref:m,scale:Array.isArray(n)?[...n,1]:n},f),w.createElement("planeGeometry",{args:[1,1,t,t]}),w.createElement("imageMaterial",{color:e,map:l,zoom:r,grayscale:s,opacity:o,scale:g,imageBounds:y,resolution:E,radius:a,toneMapped:c,transparent:u,side:h,key:u7.key}),i)}),Ofe=w.forwardRef(({url:i,...e},t)=>{const n=xp(i);return w.createElement(nQ,ot({},e,{texture:n,ref:t}))}),Nfe=w.forwardRef(({url:i,...e},t)=>w.createElement(nQ,ot({},e,{ref:t}))),Ufe=w.forwardRef((i,e)=>{if(i.url)return w.createElement(Ofe,ot({},i,{ref:e}));if(i.texture)return w.createElement(Nfe,ot({},i,{ref:e}));throw new Error("<Image /> requires a url or texture")}),iQ=w.forwardRef(({threshold:i=15,geometry:e,...t},n)=>{const r=w.useRef(null);w.useImperativeHandle(n,()=>r.current,[]);const s=w.useMemo(()=>[0,0,0,1,0,0],[]),o=w.useRef(),a=w.useRef();return w.useLayoutEffect(()=>{const l=r.current.parent,c=e??(l==null?void 0:l.geometry);if(!c||o.current===c&&a.current===i)return;o.current=c,a.current=i;const h=new O6(c,i).attributes.position.array;r.current.geometry.setPositions(h),r.current.geometry.attributes.instanceStart.needsUpdate=!0,r.current.geometry.attributes.instanceEnd.needsUpdate=!0,r.current.computeLineDistances()}),w.createElement(Cu,ot({segments:!0,points:s,ref:r,raycast:()=>null},t))}),h7=Ec({screenspace:!1,color:new ut("black"),opacity:1,thickness:.05,size:new Ue},`#include <common>
   #include <morphtarget_pars_vertex>
   #include <skinning_pars_vertex>
   #include <clipping_planes_pars_vertex>
   uniform float thickness;
   uniform bool screenspace;
   uniform vec2 size;
   void main() {
     #if defined (USE_SKINNING)
	     #include <beginnormal_vertex>
       #include <morphnormal_vertex>
       #include <skinbase_vertex>
       #include <skinnormal_vertex>
       #include <defaultnormal_vertex>
     #endif
     #include <begin_vertex>
	   #include <morphtarget_vertex>
	   #include <skinning_vertex>
     #include <project_vertex>
     #include <clipping_planes_vertex>
     vec4 tNormal = vec4(normal, 0.0);
     vec4 tPosition = vec4(transformed, 1.0);
     #ifdef USE_INSTANCING
       tNormal = instanceMatrix * tNormal;
       tPosition = instanceMatrix * tPosition;
     #endif
     if (screenspace) {
       vec3 newPosition = tPosition.xyz + tNormal.xyz * thickness;
       gl_Position = projectionMatrix * modelViewMatrix * vec4(newPosition, 1.0); 
     } else {
       vec4 clipPosition = projectionMatrix * modelViewMatrix * tPosition;
       vec4 clipNormal = projectionMatrix * modelViewMatrix * tNormal;
       vec2 offset = normalize(clipNormal.xy) * thickness / size * clipPosition.w * 2.0;
       clipPosition.xy += offset;
       gl_Position = clipPosition;
     }
   }`,`uniform vec3 color;
   uniform float opacity;
   #include <clipping_planes_pars_fragment>
   void main(){
     #include <clipping_planes_fragment>
     gl_FragColor = vec4(color, opacity);
     #include <tonemapping_fragment>
     #include <${ea>=154?"colorspace_fragment":"encodings_fragment"}>
   }`);function zfe({color:i="black",opacity:e=1,transparent:t=!1,screenspace:n=!1,toneMapped:r=!0,polygonOffset:s=!1,polygonOffsetFactor:o=0,renderOrder:a=0,thickness:l=.05,angle:c=Math.PI,clippingPlanes:u,...h}){const f=w.useRef(),[d]=w.useState(()=>new h7({side:ys})),{gl:m}=Ve(),A=m.getDrawingBufferSize(new Ue);w.useMemo(()=>Or({OutlinesMaterial:h7}),[]);const g=w.useRef(0),y=w.useRef();return w.useLayoutEffect(()=>{const E=f.current;if(!E)return;const x=E.parent;if(x&&x.geometry&&(g.current!==c||y.current!==x.geometry)){var C;g.current=c,y.current=x.geometry;let T=(C=E.children)==null?void 0:C[0];T&&(c&&T.geometry.dispose(),E.remove(T)),x.skeleton?(T=new ox,T.material=d,T.bind(x.skeleton,x.bindMatrix),E.add(T)):x.isInstancedMesh?(T=new ax(x.geometry,d,x.count),T.instanceMatrix=x.instanceMatrix,E.add(T)):(T=new It,T.material=d,E.add(T)),T.geometry=c?JG(x.geometry,c):x.geometry,T.morphTargetInfluences=x.morphTargetInfluences,T.morphTargetDictionary=x.morphTargetDictionary}}),w.useLayoutEffect(()=>{const E=f.current;if(!E)return;const x=E.children[0];if(x){x.renderOrder=a;const C=E.parent;Os(x,{morphTargetInfluences:C.morphTargetInfluences,morphTargetDictionary:C.morphTargetDictionary}),Os(x.material,{transparent:t,thickness:l,color:i,opacity:e,size:A,screenspace:n,toneMapped:r,polygonOffset:s,polygonOffsetFactor:o,clippingPlanes:u,clipping:u&&u.length>0})}}),w.useEffect(()=>()=>{const E=f.current;if(!E)return;const x=E.children[0];x&&(c&&x.geometry.dispose(),E.remove(x))},[]),w.createElement("group",ot({ref:f},h))}var Gfe=Object.defineProperty,Hfe=(i,e,t)=>e in i?Gfe(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Li=(i,e,t)=>(Hfe(i,typeof e!="symbol"?e+"":e,t),t);function yb(i,e,t,n,r){let s;if(i=i.subarray||i.slice?i:i.buffer,t=t.subarray||t.slice?t:t.buffer,i=e?i.subarray?i.subarray(e,r&&e+r):i.slice(e,r&&e+r):i,t.set)t.set(i,n);else for(s=0;s<i.length;s++)t[s+n]=i[s];return t}function Qfe(i){return i instanceof Float32Array?i:i instanceof fn?i.getAttribute("position").array:i.map(e=>{const t=Array.isArray(e);return e instanceof H?[e.x,e.y,e.z]:e instanceof Ue?[e.x,e.y,0]:t&&e.length===3?[e[0],e[1],e[2]]:t&&e.length===2?[e[0],e[1],0]:e}).flat()}class Vfe extends fn{constructor(){super(),Li(this,"type","MeshLine"),Li(this,"isMeshLine",!0),Li(this,"positions",[]),Li(this,"previous",[]),Li(this,"next",[]),Li(this,"side",[]),Li(this,"width",[]),Li(this,"indices_array",[]),Li(this,"uvs",[]),Li(this,"counters",[]),Li(this,"widthCallback",null),Li(this,"_attributes"),Li(this,"_points",[]),Li(this,"points"),Li(this,"matrixWorld",new Xe),Object.defineProperties(this,{points:{enumerable:!0,get(){return this._points},set(e){this.setPoints(e,this.widthCallback)}}})}setMatrixWorld(e){this.matrixWorld=e}setPoints(e,t){if(e=Qfe(e),this._points=e,this.widthCallback=t??null,this.positions=[],this.counters=[],e.length&&e[0]instanceof H)for(let n=0;n<e.length;n++){const r=e[n],s=n/(e.length-1);this.positions.push(r.x,r.y,r.z),this.positions.push(r.x,r.y,r.z),this.counters.push(s),this.counters.push(s)}else for(let n=0;n<e.length;n+=3){const r=n/(e.length-1);this.positions.push(e[n],e[n+1],e[n+2]),this.positions.push(e[n],e[n+1],e[n+2]),this.counters.push(r),this.counters.push(r)}this.process()}compareV3(e,t){const n=e*6,r=t*6;return this.positions[n]===this.positions[r]&&this.positions[n+1]===this.positions[r+1]&&this.positions[n+2]===this.positions[r+2]}copyV3(e){const t=e*6;return[this.positions[t],this.positions[t+1],this.positions[t+2]]}process(){const e=this.positions.length/6;this.previous=[],this.next=[],this.side=[],this.width=[],this.indices_array=[],this.uvs=[];let t,n;this.compareV3(0,e-1)?n=this.copyV3(e-2):n=this.copyV3(0),this.previous.push(n[0],n[1],n[2]),this.previous.push(n[0],n[1],n[2]);for(let r=0;r<e;r++){if(this.side.push(1),this.side.push(-1),this.widthCallback?t=this.widthCallback(r/(e-1)):t=1,this.width.push(t),this.width.push(t),this.uvs.push(r/(e-1),0),this.uvs.push(r/(e-1),1),r<e-1){n=this.copyV3(r),this.previous.push(n[0],n[1],n[2]),this.previous.push(n[0],n[1],n[2]);const s=r*2;this.indices_array.push(s,s+1,s+2),this.indices_array.push(s+2,s+1,s+3)}r>0&&(n=this.copyV3(r),this.next.push(n[0],n[1],n[2]),this.next.push(n[0],n[1],n[2]))}this.compareV3(e-1,0)?n=this.copyV3(1):n=this.copyV3(e-1),this.next.push(n[0],n[1],n[2]),this.next.push(n[0],n[1],n[2]),!this._attributes||this._attributes.position.count!==this.counters.length?this._attributes={position:new mn(new Float32Array(this.positions),3),previous:new mn(new Float32Array(this.previous),3),next:new mn(new Float32Array(this.next),3),side:new mn(new Float32Array(this.side),1),width:new mn(new Float32Array(this.width),1),uv:new mn(new Float32Array(this.uvs),2),index:new mn(new Uint16Array(this.indices_array),1),counters:new mn(new Float32Array(this.counters),1)}:(this._attributes.position.copyArray(new Float32Array(this.positions)),this._attributes.position.needsUpdate=!0,this._attributes.previous.copyArray(new Float32Array(this.previous)),this._attributes.previous.needsUpdate=!0,this._attributes.next.copyArray(new Float32Array(this.next)),this._attributes.next.needsUpdate=!0,this._attributes.side.copyArray(new Float32Array(this.side)),this._attributes.side.needsUpdate=!0,this._attributes.width.copyArray(new Float32Array(this.width)),this._attributes.width.needsUpdate=!0,this._attributes.uv.copyArray(new Float32Array(this.uvs)),this._attributes.uv.needsUpdate=!0,this._attributes.index.copyArray(new Uint16Array(this.indices_array)),this._attributes.index.needsUpdate=!0),this.setAttribute("position",this._attributes.position),this.setAttribute("previous",this._attributes.previous),this.setAttribute("next",this._attributes.next),this.setAttribute("side",this._attributes.side),this.setAttribute("width",this._attributes.width),this.setAttribute("uv",this._attributes.uv),this.setAttribute("counters",this._attributes.counters),this.setAttribute("position",this._attributes.position),this.setAttribute("previous",this._attributes.previous),this.setAttribute("next",this._attributes.next),this.setAttribute("side",this._attributes.side),this.setAttribute("width",this._attributes.width),this.setAttribute("uv",this._attributes.uv),this.setAttribute("counters",this._attributes.counters),this.setIndex(this._attributes.index),this.computeBoundingSphere(),this.computeBoundingBox()}advance({x:e,y:t,z:n}){const r=this._attributes.position.array,s=this._attributes.previous.array,o=this._attributes.next.array,a=r.length;yb(r,0,s,0,a),yb(r,6,r,0,a-6),r[a-6]=e,r[a-5]=t,r[a-4]=n,r[a-3]=e,r[a-2]=t,r[a-1]=n,yb(r,6,o,0,a-6),o[a-6]=e,o[a-5]=t,o[a-4]=n,o[a-3]=e,o[a-2]=t,o[a-1]=n,this._attributes.position.needsUpdate=!0,this._attributes.previous.needsUpdate=!0,this._attributes.next.needsUpdate=!0}}const Wfe=`
  #include <common>
  #include <logdepthbuf_pars_vertex>
  #include <fog_pars_vertex>
  #include <clipping_planes_pars_vertex>

  attribute vec3 previous;
  attribute vec3 next;
  attribute float side;
  attribute float width;
  attribute float counters;
  
  uniform vec2 resolution;
  uniform float lineWidth;
  uniform vec3 color;
  uniform float opacity;
  uniform float sizeAttenuation;
  
  varying vec2 vUV;
  varying vec4 vColor;
  varying float vCounters;
  
  vec2 fix(vec4 i, float aspect) {
    vec2 res = i.xy / i.w;
    res.x *= aspect;
    return res;
  }
  
  void main() {
    float aspect = resolution.x / resolution.y;
    vColor = vec4(color, opacity);
    vUV = uv;
    vCounters = counters;
  
    mat4 m = projectionMatrix * modelViewMatrix;
    vec4 finalPosition = m * vec4(position, 1.0) * aspect;
    vec4 prevPos = m * vec4(previous, 1.0);
    vec4 nextPos = m * vec4(next, 1.0);
  
    vec2 currentP = fix(finalPosition, aspect);
    vec2 prevP = fix(prevPos, aspect);
    vec2 nextP = fix(nextPos, aspect);
  
    float w = lineWidth * width;
  
    vec2 dir;
    if (nextP == currentP) dir = normalize(currentP - prevP);
    else if (prevP == currentP) dir = normalize(nextP - currentP);
    else {
      vec2 dir1 = normalize(currentP - prevP);
      vec2 dir2 = normalize(nextP - currentP);
      dir = normalize(dir1 + dir2);
  
      vec2 perp = vec2(-dir1.y, dir1.x);
      vec2 miter = vec2(-dir.y, dir.x);
      //w = clamp(w / dot(miter, perp), 0., 4. * lineWidth * width);
    }
  
    //vec2 normal = (cross(vec3(dir, 0.), vec3(0., 0., 1.))).xy;
    vec4 normal = vec4(-dir.y, dir.x, 0., 1.);
    normal.xy *= .5 * w;
    //normal *= projectionMatrix;
    if (sizeAttenuation == 0.) {
      normal.xy *= finalPosition.w;
      normal.xy /= (vec4(resolution, 0., 1.) * projectionMatrix).xy * aspect;
    }
  
    finalPosition.xy += normal.xy * side;
    gl_Position = finalPosition;
    #include <logdepthbuf_vertex>
    #include <fog_vertex>
    vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);
    #include <clipping_planes_vertex>
    #include <fog_vertex>
  }
`,jfe=parseInt(dp.replace(/\D+/g,"")),Kfe=jfe>=154?"colorspace_fragment":"encodings_fragment",$fe=`
  #include <fog_pars_fragment>
  #include <logdepthbuf_pars_fragment>
  #include <clipping_planes_pars_fragment>
  
  uniform sampler2D map;
  uniform sampler2D alphaMap;
  uniform float useGradient;
  uniform float useMap;
  uniform float useAlphaMap;
  uniform float useDash;
  uniform float dashArray;
  uniform float dashOffset;
  uniform float dashRatio;
  uniform float visibility;
  uniform float alphaTest;
  uniform vec2 repeat;
  uniform vec3 gradient[2];
  
  varying vec2 vUV;
  varying vec4 vColor;
  varying float vCounters;
  
  void main() {
    #include <logdepthbuf_fragment>
    vec4 diffuseColor = vColor;
    if (useGradient == 1.) diffuseColor = vec4(mix(gradient[0], gradient[1], vCounters), 1.0);
    if (useMap == 1.) diffuseColor *= texture2D(map, vUV * repeat);
    if (useAlphaMap == 1.) diffuseColor.a *= texture2D(alphaMap, vUV * repeat).a;
    if (diffuseColor.a < alphaTest) discard;
    if (useDash == 1.) diffuseColor.a *= ceil(mod(vCounters + dashOffset, dashArray) - (dashArray * dashRatio));
    diffuseColor.a *= step(vCounters, visibility);
    #include <clipping_planes_fragment>
    gl_FragColor = diffuseColor;     
    #include <fog_fragment>
    #include <tonemapping_fragment>
    #include <${Kfe}>
  }
`;class Yfe extends Mi{constructor(e){super({uniforms:{...Ot.fog,lineWidth:{value:1},map:{value:null},useMap:{value:0},alphaMap:{value:null},useAlphaMap:{value:0},color:{value:new ut(16777215)},gradient:{value:[new ut(16711680),new ut(65280)]},opacity:{value:1},resolution:{value:new Ue(1,1)},sizeAttenuation:{value:1},dashArray:{value:0},dashOffset:{value:0},dashRatio:{value:.5},useDash:{value:0},useGradient:{value:0},visibility:{value:1},alphaTest:{value:0},repeat:{value:new Ue(1,1)}},vertexShader:Wfe,fragmentShader:$fe}),Li(this,"lineWidth"),Li(this,"map"),Li(this,"useMap"),Li(this,"alphaMap"),Li(this,"useAlphaMap"),Li(this,"color"),Li(this,"gradient"),Li(this,"resolution"),Li(this,"sizeAttenuation"),Li(this,"dashArray"),Li(this,"dashOffset"),Li(this,"dashRatio"),Li(this,"useDash"),Li(this,"useGradient"),Li(this,"visibility"),Li(this,"repeat"),this.type="MeshLineMaterial",Object.defineProperties(this,{lineWidth:{enumerable:!0,get(){return this.uniforms.lineWidth.value},set(t){this.uniforms.lineWidth.value=t}},map:{enumerable:!0,get(){return this.uniforms.map.value},set(t){this.uniforms.map.value=t}},useMap:{enumerable:!0,get(){return this.uniforms.useMap.value},set(t){this.uniforms.useMap.value=t}},alphaMap:{enumerable:!0,get(){return this.uniforms.alphaMap.value},set(t){this.uniforms.alphaMap.value=t}},useAlphaMap:{enumerable:!0,get(){return this.uniforms.useAlphaMap.value},set(t){this.uniforms.useAlphaMap.value=t}},color:{enumerable:!0,get(){return this.uniforms.color.value},set(t){this.uniforms.color.value=t}},gradient:{enumerable:!0,get(){return this.uniforms.gradient.value},set(t){this.uniforms.gradient.value=t}},opacity:{enumerable:!0,get(){return this.uniforms.opacity.value},set(t){this.uniforms.opacity.value=t}},resolution:{enumerable:!0,get(){return this.uniforms.resolution.value},set(t){this.uniforms.resolution.value.copy(t)}},sizeAttenuation:{enumerable:!0,get(){return this.uniforms.sizeAttenuation.value},set(t){this.uniforms.sizeAttenuation.value=t}},dashArray:{enumerable:!0,get(){return this.uniforms.dashArray.value},set(t){this.uniforms.dashArray.value=t,this.useDash=t!==0?1:0}},dashOffset:{enumerable:!0,get(){return this.uniforms.dashOffset.value},set(t){this.uniforms.dashOffset.value=t}},dashRatio:{enumerable:!0,get(){return this.uniforms.dashRatio.value},set(t){this.uniforms.dashRatio.value=t}},useDash:{enumerable:!0,get(){return this.uniforms.useDash.value},set(t){this.uniforms.useDash.value=t}},useGradient:{enumerable:!0,get(){return this.uniforms.useGradient.value},set(t){this.uniforms.useGradient.value=t}},visibility:{enumerable:!0,get(){return this.uniforms.visibility.value},set(t){this.uniforms.visibility.value=t}},alphaTest:{enumerable:!0,get(){return this.uniforms.alphaTest.value},set(t){this.uniforms.alphaTest.value=t}},repeat:{enumerable:!0,get(){return this.uniforms.repeat.value},set(t){this.uniforms.repeat.value.copy(t)}}}),this.setValues(e)}copy(e){return super.copy(e),this.lineWidth=e.lineWidth,this.map=e.map,this.useMap=e.useMap,this.alphaMap=e.alphaMap,this.useAlphaMap=e.useAlphaMap,this.color.copy(e.color),this.gradient=e.gradient,this.opacity=e.opacity,this.resolution.copy(e.resolution),this.sizeAttenuation=e.sizeAttenuation,this.dashArray=e.dashArray,this.dashOffset=e.dashOffset,this.dashRatio=e.dashRatio,this.useDash=e.useDash,this.useGradient=e.useGradient,this.visibility=e.visibility,this.alphaTest=e.alphaTest,this.repeat.copy(e.repeat),this}}const rQ={width:.2,length:1,decay:1,local:!1,stride:0,interval:1},Xfe=(i,e=1)=>(i.set(i.subarray(e)),i.fill(-1/0,-e),i);function sQ(i,e){const{length:t,local:n,decay:r,interval:s,stride:o}={...rQ,...e},a=w.useRef(),[l]=w.useState(()=>new H);w.useLayoutEffect(()=>{i&&(a.current=Float32Array.from({length:t*10*3},(h,f)=>i.position.getComponent(f%3)))},[t,i]);const c=w.useRef(new H),u=w.useRef(0);return Kt(()=>{if(i&&a.current){if(u.current===0){let h;n?h=i.position:(i.getWorldPosition(l),h=l);const f=1*r;for(let d=0;d<f;d++)h.distanceTo(c.current)<o||(Xfe(a.current,3),a.current.set(h.toArray(),a.current.length-3));c.current.copy(h)}u.current++,u.current=u.current%s}}),a}const qfe=w.forwardRef((i,e)=>{const{children:t}=i,{width:n,length:r,decay:s,local:o,stride:a,interval:l}={...rQ,...i},{color:c="hotpink",attenuation:u,target:h}=i,f=Ve(C=>C.size),d=Ve(C=>C.scene),m=w.useRef(null),[A,g]=w.useState(null),y=sQ(A,{length:r,decay:s,local:o,stride:a,interval:l});w.useEffect(()=>{const C=(h==null?void 0:h.current)||m.current.children.find(T=>T instanceof _n);C&&g(C)},[y,h]);const E=w.useMemo(()=>new Vfe,[]),x=w.useMemo(()=>{var C;const T=new Yfe({lineWidth:.1*n,color:c,sizeAttenuation:1,resolution:new Ue(f.width,f.height)});let I;if(t)if(Array.isArray(t))I=t.find(M=>{const L=M;return typeof L.type=="string"&&L.type==="meshLineMaterial"});else{const M=t;typeof M.type=="string"&&M.type==="meshLineMaterial"&&(I=M)}return typeof((C=I)==null?void 0:C.props)=="object"&&T.setValues(I.props),T},[n,c,f,t]);return w.useEffect(()=>{x.uniforms.resolution.value.set(f.width,f.height)},[f]),Kt(()=>{y.current&&E.setPoints(y.current,u)}),w.createElement("group",null,vp(w.createElement("mesh",{ref:e,geometry:E,material:x}),d),w.createElement("group",{ref:m},t))});function oQ(i,e=16,t,n,r){const[s,o]=w.useState(()=>{const a=Array.from({length:e},()=>[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]).flat();return new Su(Float32Array.from(a),16)});return w.useLayoutEffect(()=>{if(typeof i.current>"u")return;const a=new kle(i.current);n&&a.setWeightAttribute(n),a.build();const l=new H,c=new H,u=new ut,h=new _n;i.current.updateMatrixWorld(!0);for(let f=0;f<e;f++)a.sample(l,c,u),typeof t=="function"?t({dummy:h,sampledMesh:i.current,position:l,normal:c,color:u},f):h.position.copy(l),h.updateMatrix(),r!=null&&r.current&&r.current.setMatrixAt(f,h.matrix),h.matrix.toArray(s.array,f*16);r!=null&&r.current&&(r.current.instanceMatrix.needsUpdate=!0),s.needsUpdate=!0,o(new Su(s.array,s.itemSize).copy(s))},[i,r,n,e,t]),s}function Jfe({children:i,weight:e,transform:t,instances:n,mesh:r,count:s=16,...o}){const a=w.useRef(null),l=w.useRef(null),c=w.useRef(null);return w.useLayoutEffect(()=>{var u,h;l.current=(u=n==null?void 0:n.current)!==null&&u!==void 0?u:a.current.children.find(f=>f.hasOwnProperty("instanceMatrix")),c.current=(h=r==null?void 0:r.current)!==null&&h!==void 0?h:a.current.children.find(f=>f.type==="Mesh")},[i,r==null?void 0:r.current,n==null?void 0:n.current]),oQ(c,s,t,e,l),w.createElement("group",ot({ref:a},o),i)}const Zfe=({compute:i,name:e,...t})=>{const[n]=w.useState(()=>new mn(new Float32Array(0),1)),r=w.useRef(null);return w.useLayoutEffect(()=>{if(r.current){var s;const o=(s=r.current.parent)!==null&&s!==void 0?s:r.current.__r3f.parent,a=i(o);r.current.copy(a)}},[i]),w.createElement("primitive",ot({ref:r,object:n,attach:`attributes-${e}`},t))};function ede(i,{keys:e=["near","far","color","distance","decay","penumbra","angle","intensity","skeleton","visible","castShadow","receiveShadow","morphTargetDictionary","morphTargetInfluences","name","geometry","material","position","rotation","scale","up","userData","bindMode","bindMatrix","bindMatrixInverse","skeleton"],deep:t,inject:n,castShadow:r,receiveShadow:s}){let o={};for(const a of e)o[a]=i[a];return t&&(o.geometry&&t!=="materialsOnly"&&(o.geometry=o.geometry.clone()),o.material&&t!=="geometriesOnly"&&(o.material=o.material.clone())),n&&(typeof n=="function"?o={...o,children:n(i)}:w.isValidElement(n)?o={...o,children:n}:o={...o,...n}),i instanceof It&&(r&&(o.castShadow=!0),s&&(o.receiveShadow=!0)),o}const G2=w.forwardRef(({isChild:i=!1,object:e,children:t,deep:n,castShadow:r,receiveShadow:s,inject:o,keys:a,...l},c)=>{const u={keys:a,deep:n,inject:o,castShadow:r,receiveShadow:s};if(e=w.useMemo(()=>{if(i===!1&&!Array.isArray(e)){let m=!1;if(e.traverse(A=>{A.isSkinnedMesh&&(m=!0)}),m)return Dle.clone(e)}return e},[e,i]),Array.isArray(e))return w.createElement("group",ot({},l,{ref:c}),e.map(m=>w.createElement(G2,ot({key:m.uuid,object:m},u))),t);const{children:h,...f}=ede(e,u),d=e.type[0].toLowerCase()+e.type.slice(1);return w.createElement(d,ot({},f,l,{ref:c}),e.children.map(m=>m.type==="Bone"?w.createElement("primitive",ot({key:m.uuid,object:m},u)):w.createElement(G2,ot({key:m.uuid,object:m},u,{isChild:!0}))),t,h)}),MR=w.createContext(null),tde=w.forwardRef(({resolution:i=28,maxPolyCount:e=1e4,enableUvs:t=!1,enableColors:n=!1,children:r,...s},o)=>{const a=w.useRef(null);w.useImperativeHandle(o,()=>a.current,[]);const l=w.useMemo(()=>new _le(i,null,t,n,e),[i,e,t,n]),c=w.useMemo(()=>({getParent:()=>a}),[]);return Kt(()=>{l.update(),l.reset()},-1),w.createElement(w.Fragment,null,w.createElement("primitive",ot({object:l,ref:a},s),w.createElement(MR.Provider,{value:c},r)))}),nde=w.forwardRef(({strength:i=.5,subtract:e=12,color:t,...n},r)=>{const{getParent:s}=w.useContext(MR),o=w.useMemo(()=>s(),[s]),a=w.useRef(null);w.useImperativeHandle(r,()=>a.current,[]);const l=new H;return Kt(c=>{!o.current||!a.current||(a.current.getWorldPosition(l),o.current.addBall(.5+l.x*.5,.5+l.y*.5,.5+l.z*.5,i,e,t))}),w.createElement("group",ot({ref:a},n))}),ide=w.forwardRef(({planeType:i="x",strength:e=.5,subtract:t=12,...n},r)=>{const{getParent:s}=w.useContext(MR),o=w.useMemo(()=>s(),[s]),a=w.useRef(null);w.useImperativeHandle(r,()=>a.current,[]);const l=w.useMemo(()=>i==="x"?"addPlaneX":i==="y"?"addPlaneY":"addPlaneZ",[i]);return Kt(()=>{!o.current||!a.current||o.current[l](e,t)}),w.createElement("group",ot({ref:a},n))});function rde(i){return Array.isArray(i)}function vb(i=[0,0,0]){return rde(i)?i:i instanceof H||i instanceof Eo?[i.x,i.y,i.z]:[i,i,i]}const sde=w.forwardRef(function({debug:e,depthTest:t=!1,polygonOffsetFactor:n=-10,map:r,mesh:s,children:o,position:a,rotation:l,scale:c,...u},h){const f=w.useRef(null);w.useImperativeHandle(h,()=>f.current);const d=w.useRef(null),m=w.useRef({position:new H,rotation:new Eo,scale:new H(1,1,1)});return w.useLayoutEffect(()=>{const A=(s==null?void 0:s.current)||f.current.parent,g=f.current;if(!(A instanceof It))throw new Error('Decal must have a Mesh as parent or specify its "mesh" prop');if(A){Os(m.current,{position:a,scale:c});const y=A.matrixWorld.clone();if(A.matrixWorld.identity(),!l||typeof l=="number"){const E=new _n;E.position.copy(m.current.position);const x=A.geometry.attributes.position.array;A.geometry.attributes.normal===void 0&&A.geometry.computeVertexNormals();const C=A.geometry.attributes.normal.array;let T=1/0;new H;let I=new H;const M=E.position.x,L=E.position.y,R=E.position.z,P=x.length;let F=-1;for(let k=0;k<P;k+=3){const z=x[k],U=x[k+1],W=x[k+2],$=z-M,oe=U-L,X=W-R,Q=$*$+oe*oe+X*X;Q<T&&(T=Q,F=k)}I.fromArray(C,F),E.lookAt(E.position.clone().add(I)),E.rotateZ(Math.PI),E.rotateY(Math.PI),typeof l=="number"&&E.rotateZ(l),Os(m.current,{rotation:E.rotation})}else Os(m.current,{rotation:l});return g.geometry=new cue(A,m.current.position,m.current.rotation,m.current.scale),A.matrixWorld=y,()=>{g.geometry.dispose()}}},[s,...vb(a),...vb(c),...vb(l)]),w.useLayoutEffect(()=>{d.current&&(Os(d.current,m.current),d.current.traverse(A=>A.raycast=()=>null))},[e]),w.createElement("mesh",ot({ref:f,"material-transparent":!0,"material-polygonOffset":!0,"material-polygonOffsetFactor":n,"material-depthTest":t,"material-map":r},u),o,e&&w.createElement("mesh",{ref:d},w.createElement("boxGeometry",null),w.createElement("meshNormalMaterial",{wireframe:!0}),w.createElement("axesHelper",null)))}),ode=w.forwardRef(function({src:e,skipFill:t,skipStrokes:n,fillMaterial:r,strokeMaterial:s,fillMeshProps:o,strokeMeshProps:a,...l},c){const u=cr(lb,e.startsWith("<svg")?`data:image/svg+xml;utf8,${e}`:e),h=w.useMemo(()=>n?[]:u.paths.map(d=>{var m;return((m=d.userData)==null?void 0:m.style.stroke)===void 0||d.userData.style.stroke==="none"?null:d.subPaths.map(A=>lb.pointsToStroke(A.getPoints(),d.userData.style))}),[u,n]);w.useEffect(()=>()=>h.forEach(d=>d&&d.map(m=>m.dispose())),[h]);let f=0;return w.createElement("object3D",ot({ref:c},l),w.createElement("object3D",{scale:[1,-1,1]},u.paths.map((d,m)=>{var A,g;return w.createElement(w.Fragment,{key:m},!t&&((A=d.userData)==null?void 0:A.style.fill)!==void 0&&d.userData.style.fill!=="none"&&lb.createShapes(d).map((y,E)=>w.createElement("mesh",ot({key:E},o,{renderOrder:f++}),w.createElement("shapeGeometry",{args:[y]}),w.createElement("meshBasicMaterial",ot({color:d.userData.style.fill,opacity:d.userData.style.fillOpacity,transparent:!0,side:Pi,depthWrite:!1},r)))),!n&&((g=d.userData)==null?void 0:g.style.stroke)!==void 0&&d.userData.style.stroke!=="none"&&d.subPaths.map((y,E)=>w.createElement("mesh",ot({key:E,geometry:h[m][E]},a,{renderOrder:f++}),w.createElement("meshBasicMaterial",ot({color:d.userData.style.stroke,opacity:d.userData.style.strokeOpacity,transparent:!0,side:Pi,depthWrite:!1},s)))))})))});let z3=null,aQ="https://www.gstatic.com/draco/versioned/decoders/1.5.5/";function lQ(i=!0,e=!0,t){return n=>{t&&t(n),i&&(z3||(z3=new fhe),z3.setDecoderPath(typeof i=="string"?i:aQ),n.setDRACOLoader(z3)),e&&n.setMeshoptDecoder(typeof db=="function"?db():db)}}const Sx=(i,e,t,n)=>cr(wR,i,lQ(e,t,n));Sx.preload=(i,e,t,n)=>cr.preload(wR,i,lQ(e,t,n));Sx.clear=i=>cr.clear(wR,i);Sx.setDecoderPath=i=>{aQ=i};const ade=w.forwardRef(({src:i,useDraco:e,useMeshOpt:t,extendLoader:n,...r},s)=>{const{scene:o}=Sx(i,e,t,n);return w.createElement(G2,ot({ref:s},r,{object:o}))});function lde({renderIndex:i=1,bgColor:e="black",fgColor:t="white",characters:n=" .:-+*=%@#",invert:r=!0,color:s=!1,resolution:o=.15}){const{size:a,gl:l,scene:c,camera:u}=Ve(),h=w.useMemo(()=>{const f=new mue(l,n,{invert:r,color:s,resolution:o});return f.domElement.style.position="absolute",f.domElement.style.top="0px",f.domElement.style.left="0px",f.domElement.style.pointerEvents="none",f},[n,r,s,o]);return w.useLayoutEffect(()=>{h.domElement.style.color=t,h.domElement.style.backgroundColor=e},[t,e]),w.useEffect(()=>(l.domElement.style.opacity="0",l.domElement.parentNode.appendChild(h.domElement),()=>{l.domElement.style.opacity="1",l.domElement.parentNode.removeChild(h.domElement)}),[h]),w.useEffect(()=>{h.setSize(a.width,a.height)},[h,a]),Kt(f=>{h.render(c,u)},i),w.createElement(w.Fragment,null)}const f7=Ec({alphaTest:0,viewport:new Ue(1980,1080),focal:1e3,centerAndScaleTexture:null,covAndColorTexture:null},`
    precision highp sampler2D;
    precision highp usampler2D;
    out vec4 vColor;
    out vec3 vPosition;
    uniform vec2 resolution;
    uniform vec2 viewport;
    uniform float focal;
    attribute uint splatIndex;
    uniform sampler2D centerAndScaleTexture;
    uniform usampler2D covAndColorTexture;    

    vec2 unpackInt16(in uint value) {
      int v = int(value);
      int v0 = v >> 16;
      int v1 = (v & 0xFFFF);
      if((v & 0x8000) != 0)
        v1 |= 0xFFFF0000;
      return vec2(float(v1), float(v0));
    }

    void main () {
      ivec2 texSize = textureSize(centerAndScaleTexture, 0);
      ivec2 texPos = ivec2(splatIndex%uint(texSize.x), splatIndex/uint(texSize.x));
      vec4 centerAndScaleData = texelFetch(centerAndScaleTexture, texPos, 0);
      vec4 center = vec4(centerAndScaleData.xyz, 1);
      vec4 camspace = modelViewMatrix * center;
      vec4 pos2d = projectionMatrix * camspace;

      float bounds = 1.2 * pos2d.w;
      if (pos2d.z < -pos2d.w || pos2d.x < -bounds || pos2d.x > bounds
        || pos2d.y < -bounds || pos2d.y > bounds) {
        gl_Position = vec4(0.0, 0.0, 2.0, 1.0);
        return;
      }

      uvec4 covAndColorData = texelFetch(covAndColorTexture, texPos, 0);
      vec2 cov3D_M11_M12 = unpackInt16(covAndColorData.x) * centerAndScaleData.w;
      vec2 cov3D_M13_M22 = unpackInt16(covAndColorData.y) * centerAndScaleData.w;
      vec2 cov3D_M23_M33 = unpackInt16(covAndColorData.z) * centerAndScaleData.w;
      mat3 Vrk = mat3(
        cov3D_M11_M12.x, cov3D_M11_M12.y, cov3D_M13_M22.x,
        cov3D_M11_M12.y, cov3D_M13_M22.y, cov3D_M23_M33.x,
        cov3D_M13_M22.x, cov3D_M23_M33.x, cov3D_M23_M33.y
      );

      mat3 J = mat3(
        focal / camspace.z, 0., -(focal * camspace.x) / (camspace.z * camspace.z),
        0., focal / camspace.z, -(focal * camspace.y) / (camspace.z * camspace.z),
        0., 0., 0.
      );

      mat3 W = transpose(mat3(modelViewMatrix));
      mat3 T = W * J;
      mat3 cov = transpose(T) * Vrk * T;
      vec2 vCenter = vec2(pos2d) / pos2d.w;
      float diagonal1 = cov[0][0] + 0.3;
      float offDiagonal = cov[0][1];
      float diagonal2 = cov[1][1] + 0.3;
      float mid = 0.5 * (diagonal1 + diagonal2);
      float radius = length(vec2((diagonal1 - diagonal2) / 2.0, offDiagonal));
      float lambda1 = mid + radius;
      float lambda2 = max(mid - radius, 0.1);
      vec2 diagonalVector = normalize(vec2(offDiagonal, lambda1 - diagonal1));
      vec2 v1 = min(sqrt(2.0 * lambda1), 1024.0) * diagonalVector;
      vec2 v2 = min(sqrt(2.0 * lambda2), 1024.0) * vec2(diagonalVector.y, -diagonalVector.x);
      uint colorUint = covAndColorData.w;
      vColor = vec4(
        float(colorUint & uint(0xFF)) / 255.0,
        float((colorUint >> uint(8)) & uint(0xFF)) / 255.0,
        float((colorUint >> uint(16)) & uint(0xFF)) / 255.0,
        float(colorUint >> uint(24)) / 255.0
      );
      vPosition = position;

      gl_Position = vec4(
        vCenter 
          + position.x * v2 / viewport * 2.0 
          + position.y * v1 / viewport * 2.0, pos2d.z / pos2d.w, 1.0);
    }
    `,`
    #include <alphatest_pars_fragment>
    #include <alphahash_pars_fragment>
    in vec4 vColor;
    in vec3 vPosition;
    void main () {
      float A = -dot(vPosition.xy, vPosition.xy);
      if (A < -4.0) discard;
      float B = exp(A) * vColor.a;
      vec4 diffuseColor = vec4(vColor.rgb, B);
      #include <alphatest_fragment>
      #include <alphahash_fragment>
      gl_FragColor = diffuseColor;
      #include <tonemapping_fragment>
      #include <${ea>=154?"colorspace_fragment":"encodings_fragment"}>
    }
  `);function cde(i){let e=null,t=0;function n(r,s=!1){const o=e.length/16,a=-1e-4;let l=-1/0,c=1/0;const u=new Float32Array(o),h=new Int32Array(u.buffer),f=new Int32Array(o);let d=0;for(let E=0;E<o;E++){const x=r[0]*e[E*16+12]+r[1]*e[E*16+13]+r[2]*e[E*16+14]+r[3];(s||x<0&&e[E*16+15]>a*x)&&(u[d]=x,f[d]=E,d++,x>l&&(l=x),x<c&&(c=x))}const m=(256*256-1)/(l-c),A=new Uint32Array(256*256);for(let E=0;E<d;E++)h[E]=(u[E]-c)*m|0,A[h[E]]++;const g=new Uint32Array(256*256);for(let E=1;E<256*256;E++)g[E]=g[E-1]+A[E-1];const y=new Uint32Array(d);for(let E=0;E<d;E++)y[g[h[E]]++]=f[E];return y}i.onmessage=r=>{if(r.data.method=="push"){t===0&&(e=new Float32Array(r.data.length));const s=new Float32Array(r.data.matrices);e.set(s,t),t+=s.length}else if(r.data.method=="sort"&&e!==null){const s=n(new Float32Array(r.data.view),r.data.hashed);i.postMessage({indices:s,key:r.data.key},[s.buffer])}}}class ude extends os{constructor(...e){super(...e),this.gl=null,this.chunkSize=25e3}load(e,t,n,r){const s={gl:this.gl,url:this.manager.resolveURL(e),worker:new Worker(URL.createObjectURL(new Blob(["(",cde.toString(),")(self)"],{type:"application/javascript"}))),manager:this.manager,update:(o,a,l)=>dde(a,s,o,l),connect:o=>pde(s,o),loading:!1,loaded:!1,loadedVertexCount:0,chunkSize:this.chunkSize,totalDownloadBytes:0,numVertices:0,rowLength:32,maxVertexes:0,bufferTextureWidth:0,bufferTextureHeight:0,stream:null,centerAndScaleData:null,covAndColorData:null,covAndColorTexture:null,centerAndScaleTexture:null,onProgress:n};hde(s).then(t).catch(o=>{r==null||r(o),s.manager.itemError(s.url)})}}async function hde(i){i.manager.itemStart(i.url);const e=await fetch(i.url);if(e.body===null)throw"Failed to fetch file";let t=e.headers.get("Content-Length");const n=t?parseInt(t):void 0;if(n==null)throw"Failed to get content length";i.stream=e.body.getReader(),i.totalDownloadBytes=n,i.numVertices=Math.floor(i.totalDownloadBytes/i.rowLength);const r=i.gl.getContext();let s=r.getParameter(r.MAX_TEXTURE_SIZE);return i.maxVertexes=s*s,i.numVertices>i.maxVertexes&&(i.numVertices=i.maxVertexes),i.bufferTextureWidth=s,i.bufferTextureHeight=Math.floor((i.numVertices-1)/s)+1,i.centerAndScaleData=new Float32Array(i.bufferTextureWidth*i.bufferTextureHeight*4),i.covAndColorData=new Uint32Array(i.bufferTextureWidth*i.bufferTextureHeight*4),i.centerAndScaleTexture=new Sa(i.centerAndScaleData,i.bufferTextureWidth,i.bufferTextureHeight,gi,fi),i.centerAndScaleTexture.needsUpdate=!0,i.covAndColorTexture=new Sa(i.covAndColorData,i.bufferTextureWidth,i.bufferTextureHeight,qm,Zo),i.covAndColorTexture.internalFormat="RGBA32UI",i.covAndColorTexture.needsUpdate=!0,i}async function fde(i){i.loading=!0;let e=0,t=0;const n=[];let r=0;const s=i.totalDownloadBytes!==0;for(;;)try{const{value:o,done:a}=await i.stream.read();if(a)break;if(e+=o.length,i.totalDownloadBytes!=null){const c=e/i.totalDownloadBytes*100;if(i.onProgress&&c-r>1){const u=new ProgressEvent("progress",{lengthComputable:s,loaded:e,total:i.totalDownloadBytes});i.onProgress(u),r=c}}n.push(o);const l=e-t;if(i.totalDownloadBytes!=null&&l>i.rowLength*i.chunkSize){let c=Math.floor(l/i.rowLength);const u=new Uint8Array(l);let h=0;for(const m of n)u.set(m,h),h+=m.length;if(n.length=0,l>c*i.rowLength){const m=new Uint8Array(l-c*i.rowLength);m.set(u.subarray(l-m.length,l),0),n.push(m)}const f=new Uint8Array(c*i.rowLength);f.set(u.subarray(0,f.byteLength),0);const d=d7(i,f.buffer,c);if(i.worker.postMessage({method:"push",src:i.url,length:i.numVertices*16,matrices:d.buffer},[d.buffer]),t+=c*i.rowLength,i.onProgress){const m=new ProgressEvent("progress",{lengthComputable:s,loaded:i.totalDownloadBytes,total:i.totalDownloadBytes});i.onProgress(m)}}}catch(o){console.error(o);break}if(e-t>0){let o=new Uint8Array(n.reduce((u,h)=>u+h.length,0)),a=0;for(const u of n)o.set(u,a),a+=u.length;let l=Math.floor(o.byteLength/i.rowLength);const c=d7(i,o.buffer,l);i.worker.postMessage({method:"push",src:i.url,length:l*16,matrices:c.buffer},[c.buffer])}i.loaded=!0,i.manager.itemEnd(i.url)}function dde(i,e,t,n){if(i.updateMatrixWorld(),e.gl.getCurrentViewport(t.viewport),t.material.viewport.x=t.viewport.z,t.material.viewport.y=t.viewport.w,t.material.focal=t.viewport.w/2*Math.abs(i.projectionMatrix.elements[5]),t.ready){if(n&&t.sorted)return;t.ready=!1;const r=new Float32Array([t.modelViewMatrix.elements[2],-t.modelViewMatrix.elements[6],t.modelViewMatrix.elements[10],t.modelViewMatrix.elements[14]]);e.worker.postMessage({method:"sort",src:e.url,key:t.uuid,view:r.buffer,hashed:n},[r.buffer]),n&&e.loaded&&(t.sorted=!0)}}function pde(i,e){i.loading||fde(i),e.ready=!1,e.pm=new Xe,e.vm1=new Xe,e.vm2=new Xe,e.viewport=new Rn;let t=new Uint32Array(i.bufferTextureWidth*i.bufferTextureHeight);const n=new Su(t,1,!1);n.setUsage(No);const r=e.geometry=new dx,s=new Float32Array(18),o=new mn(s,3);r.setAttribute("position",o),o.setXYZ(2,-2,2,0),o.setXYZ(1,2,2,0),o.setXYZ(0,-2,-2,0),o.setXYZ(5,-2,-2,0),o.setXYZ(4,2,2,0),o.setXYZ(3,2,-2,0),o.needsUpdate=!0,r.setAttribute("splatIndex",n),r.instanceCount=1;function a(c){if(e&&c.data.key===e.uuid){let u=new Uint32Array(c.data.indices);r.attributes.splatIndex.set(u),r.attributes.splatIndex.needsUpdate=!0,r.instanceCount=u.length,e.ready=!0}}i.worker.addEventListener("message",a);async function l(){for(;;){const c=i.gl.properties.get(i.centerAndScaleTexture),u=i.gl.properties.get(i.covAndColorTexture);if(c!=null&&c.__webglTexture&&u!=null&&u.__webglTexture&&i.loadedVertexCount>0)break;await new Promise(h=>setTimeout(h,10))}e.ready=!0}return l(),()=>i.worker.removeEventListener("message",a)}function d7(i,e,t){const n=i.gl.getContext();if(i.loadedVertexCount+t>i.maxVertexes&&(t=i.maxVertexes-i.loadedVertexCount),t<=0)throw"Failed to parse file";const r=new Uint8Array(e),s=new Float32Array(e),o=new Float32Array(t*16),a=new Uint8Array(i.covAndColorData.buffer),l=new Int16Array(i.covAndColorData.buffer);for(let c=0;c<t;c++){const u=new Xt(-(r[32*c+28+1]-128)/128,(r[32*c+28+2]-128)/128,(r[32*c+28+3]-128)/128,-(r[32*c+28+0]-128)/128);u.invert();const h=new H(s[8*c+0],s[8*c+1],-s[8*c+2]),f=new H(s[8*c+3+0],s[8*c+3+1],s[8*c+3+2]),d=new Xe;d.makeRotationFromQuaternion(u),d.transpose(),d.scale(f);const m=d.clone();d.transpose(),d.premultiply(m),d.setPosition(h);const A=[0,1,2,5,6,10];let g=0;for(let x=0;x<A.length;x++)Math.abs(d.elements[A[x]])>g&&(g=Math.abs(d.elements[A[x]]));let y=i.loadedVertexCount*4+c*4;i.centerAndScaleData[y+0]=h.x,i.centerAndScaleData[y+1]=-h.y,i.centerAndScaleData[y+2]=h.z,i.centerAndScaleData[y+3]=g/32767,y=i.loadedVertexCount*8+c*4*2;for(let x=0;x<A.length;x++)l[y+x]=d.elements[A[x]]*32767/g;y=i.loadedVertexCount*16+(c*4+3)*4;const E=new ut(r[32*c+24+0]/255,r[32*c+24+1]/255,r[32*c+24+2]/255);E.convertSRGBToLinear(),a[y+0]=E.r*255,a[y+1]=E.g*255,a[y+2]=E.b*255,a[y+3]=r[32*c+24+3],d.elements[15]=Math.max(f.x,f.y,f.z)*r[32*c+24+3]/255;for(let x=0;x<16;x++)o[c*16+x]=d.elements[x]}for(;t>0;){let c=0,u=0;const h=i.loadedVertexCount%i.bufferTextureWidth,f=Math.floor(i.loadedVertexCount/i.bufferTextureWidth);i.loadedVertexCount%i.bufferTextureWidth!=0?(c=Math.min(i.bufferTextureWidth,h+t)-h,u=1):Math.floor(t/i.bufferTextureWidth)>0?(c=i.bufferTextureWidth,u=Math.floor(t/i.bufferTextureWidth)):(c=t%i.bufferTextureWidth,u=1);const d=i.gl.properties.get(i.centerAndScaleTexture);n.bindTexture(n.TEXTURE_2D,d.__webglTexture),n.texSubImage2D(n.TEXTURE_2D,0,h,f,c,u,n.RGBA,n.FLOAT,i.centerAndScaleData,i.loadedVertexCount*4);const m=i.gl.properties.get(i.covAndColorTexture);n.bindTexture(n.TEXTURE_2D,m.__webglTexture),n.texSubImage2D(n.TEXTURE_2D,0,h,f,c,u,n.RGBA_INTEGER,n.UNSIGNED_INT,i.covAndColorData,i.loadedVertexCount*4),i.gl.resetState(),i.loadedVertexCount+=c*u,t-=c*u}return o}function mde({src:i,toneMapped:e=!1,alphaTest:t=0,alphaHash:n=!1,chunkSize:r=25e3,...s}){Or({SplatMaterial:f7});const o=w.useRef(null),a=Ve(u=>u.gl),l=Ve(u=>u.camera),c=cr(ude,i,u=>{u.gl=a,u.chunkSize=r});return w.useLayoutEffect(()=>c.connect(o.current),[i]),Kt(()=>c.update(o.current,l,n)),w.createElement("mesh",ot({ref:o,frustumCulled:!1},s),w.createElement("splatMaterial",{key:`${i}/${t}/${n}${f7.key}`,transparent:!n,depthTest:!0,alphaTest:n?0:t,centerAndScaleTexture:c.centerAndScaleTexture,covAndColorTexture:c.covAndColorTexture,depthWrite:n?!0:t>0,blending:n?Kd:pw,blendSrcAlpha:mw,alphaHash:!!n,toneMapped:e}))}function Ea(i,e,t){const n=Ve(f=>f.size),r=Ve(f=>f.viewport),s=typeof i=="number"?i:n.width*r.dpr,o=typeof e=="number"?e:n.height*r.dpr,a=(typeof i=="number"?t:i)||{},{samples:l=0,depth:c,...u}=a,h=w.useMemo(()=>{const f=new Si(s,o,{minFilter:Pn,magFilter:Pn,type:Ni,...u});return c&&(f.depthTexture=new f0(s,o,fi)),f.samples=l,f},[]);return w.useLayoutEffect(()=>{h.setSize(s,o),l&&(h.samples=l)},[l,h,s,o]),w.useEffect(()=>()=>h.dispose(),[]),h}const gde=({children:i,width:e,height:t,...n})=>{const r=Ea(e,t,n);return w.createElement(w.Fragment,null,i==null?void 0:i(r))},Ade=i=>typeof i=="function",cQ=w.forwardRef(({envMap:i,resolution:e=256,frames:t=1/0,children:n,makeDefault:r,...s},o)=>{const a=Ve(({set:g})=>g),l=Ve(({camera:g})=>g),c=Ve(({size:g})=>g),u=w.useRef(null);w.useImperativeHandle(o,()=>u.current,[]);const h=w.useRef(null),f=Ea(e);w.useLayoutEffect(()=>{s.manual||u.current.updateProjectionMatrix()},[c,s]),w.useLayoutEffect(()=>{u.current.updateProjectionMatrix()}),w.useLayoutEffect(()=>{if(r){const g=l;return a(()=>({camera:u.current})),()=>a(()=>({camera:g}))}},[u,r,a]);let d=0,m=null;const A=Ade(n);return Kt(g=>{A&&(t===1/0||d<t)&&(h.current.visible=!1,g.gl.setRenderTarget(f),m=g.scene.background,i&&(g.scene.background=i),g.gl.render(g.scene,u.current),g.scene.background=m,g.gl.setRenderTarget(null),h.current.visible=!0,d++)}),w.createElement(w.Fragment,null,w.createElement("orthographicCamera",ot({left:c.width/-2,right:c.width/2,top:c.height/2,bottom:c.height/-2,ref:u},s),!A&&n),w.createElement("group",{ref:h},A&&n(f.texture)))}),yde=i=>typeof i=="function",vde=w.forwardRef(({envMap:i,resolution:e=256,frames:t=1/0,makeDefault:n,children:r,...s},o)=>{const a=Ve(({set:g})=>g),l=Ve(({camera:g})=>g),c=Ve(({size:g})=>g),u=w.useRef(null);w.useImperativeHandle(o,()=>u.current,[]);const h=w.useRef(null),f=Ea(e);w.useLayoutEffect(()=>{s.manual||(u.current.aspect=c.width/c.height)},[c,s]),w.useLayoutEffect(()=>{u.current.updateProjectionMatrix()});let d=0,m=null;const A=yde(r);return Kt(g=>{A&&(t===1/0||d<t)&&(h.current.visible=!1,g.gl.setRenderTarget(f),m=g.scene.background,i&&(g.scene.background=i),g.gl.render(g.scene,u.current),g.scene.background=m,g.gl.setRenderTarget(null),h.current.visible=!0,d++)}),w.useLayoutEffect(()=>{if(n){const g=l;return a(()=>({camera:u.current})),()=>a(()=>({camera:g}))}},[u,n,a]),w.createElement(w.Fragment,null,w.createElement("perspectiveCamera",ot({ref:u},s),!A&&r),w.createElement("group",{ref:h},A&&r(f.texture)))});function uQ({resolution:i=256,near:e=.1,far:t=1e3,envMap:n,fog:r}={}){const s=Ve(({gl:f})=>f),o=Ve(({scene:f})=>f),a=w.useMemo(()=>{const f=new xA(i);return f.texture.type=Ni,f},[i]);w.useEffect(()=>()=>{a.dispose()},[a]);const l=w.useMemo(()=>new Cw(e,t,a),[e,t,a]);let c,u;const h=w.useCallback(()=>{c=o.fog,u=o.background,o.background=n||u,o.fog=r||c,l.update(s,o),o.fog=c,o.background=u},[s,o,l]);return{fbo:a,camera:l,update:h}}function xde({children:i,frames:e=1/0,resolution:t,near:n,far:r,envMap:s,fog:o,...a}){const l=w.useRef(null),{fbo:c,camera:u,update:h}=uQ({resolution:t,near:n,far:r,envMap:s,fog:o});let f=0;return Kt(()=>{l.current&&(e===1/0||f<e)&&(l.current.visible=!1,h(),l.current.visible=!0,f++)}),w.createElement("group",a,w.createElement("primitive",{object:u}),w.createElement("group",{ref:l},i==null?void 0:i(c.texture)))}const Ede=w.forwardRef((i,e)=>{const{camera:t,onChange:n,makeDefault:r,...s}=i,o=Ve(f=>f.camera),a=Ve(f=>f.invalidate),l=Ve(f=>f.get),c=Ve(f=>f.set),u=t||o,h=w.useMemo(()=>new tce(u),[u]);return w.useEffect(()=>{const f=d=>{a(),n&&n(d)};return h==null||h.addEventListener==null||h.addEventListener("change",f),()=>h==null||h.removeEventListener==null?void 0:h.removeEventListener("change",f)},[n,h,a]),Kt(()=>h==null?void 0:h.update(),-1),w.useEffect(()=>{const f=h;return f==null||f.connect(),()=>f==null?void 0:f.dispose()},[h]),w.useEffect(()=>{if(r){const f=l().controls;return c({controls:h}),()=>c({controls:f})}},[r,h]),h?w.createElement("primitive",ot({ref:e,object:h},s)):null}),_de=w.forwardRef(({domElement:i,...e},t)=>{const{onChange:n,makeDefault:r,...s}=e,o=Ve(m=>m.invalidate),a=Ve(m=>m.camera),l=Ve(m=>m.gl),c=Ve(m=>m.events),u=Ve(m=>m.get),h=Ve(m=>m.set),f=i||c.connected||l.domElement,d=w.useMemo(()=>new pce(a),[a]);return w.useEffect(()=>(d.connect(f),()=>void d.dispose()),[f,d,o]),w.useEffect(()=>{const m=A=>{o(),n&&n(A)};return d.addEventListener==null||d.addEventListener("change",m),()=>d.removeEventListener==null?void 0:d.removeEventListener("change",m)},[n,o]),w.useEffect(()=>{if(r){const m=u().controls;return h({controls:d}),()=>h({controls:m})}},[r,d]),Kt((m,A)=>d.update(A)),w.createElement("primitive",ot({ref:t,object:d,args:[a,f]},s))}),Sde=w.forwardRef((i={enableDamping:!0},e)=>{const{domElement:t,camera:n,makeDefault:r,onChange:s,onStart:o,onEnd:a,...l}=i,c=Ve(E=>E.invalidate),u=Ve(E=>E.camera),h=Ve(E=>E.gl),f=Ve(E=>E.events),d=Ve(E=>E.set),m=Ve(E=>E.get),A=t||f.connected||h.domElement,g=n||u,y=w.useMemo(()=>new lce(g),[g]);return w.useEffect(()=>{y.connect(A);const E=x=>{c(),s&&s(x)};return y.addEventListener("change",E),o&&y.addEventListener("start",o),a&&y.addEventListener("end",a),()=>{y.dispose(),y.removeEventListener("change",E),o&&y.removeEventListener("start",o),a&&y.removeEventListener("end",a)}},[s,o,a,y,c,A]),w.useEffect(()=>{if(r){const E=m().controls;return d({controls:y}),()=>d({controls:E})}},[r,y]),Kt(()=>y.update(),-1),w.createElement("primitive",ot({ref:e,object:y,enableDamping:!0},l))}),hQ=w.forwardRef(({makeDefault:i,camera:e,regress:t,domElement:n,enableDamping:r=!0,keyEvents:s=!1,onChange:o,onStart:a,onEnd:l,...c},u)=>{const h=Ve(I=>I.invalidate),f=Ve(I=>I.camera),d=Ve(I=>I.gl),m=Ve(I=>I.events),A=Ve(I=>I.setEvents),g=Ve(I=>I.set),y=Ve(I=>I.get),E=Ve(I=>I.performance),x=e||f,C=n||m.connected||d.domElement,T=w.useMemo(()=>new lH(x),[x]);return Kt(()=>{T.enabled&&T.update()},-1),w.useEffect(()=>(s&&T.connect(s===!0?C:s),T.connect(C),()=>void T.dispose()),[s,C,t,T,h]),w.useEffect(()=>{const I=R=>{h(),t&&E.regress(),o&&o(R)},M=R=>{a&&a(R)},L=R=>{l&&l(R)};return T.addEventListener("change",I),T.addEventListener("start",M),T.addEventListener("end",L),()=>{T.removeEventListener("start",M),T.removeEventListener("end",L),T.removeEventListener("change",I)}},[o,a,l,T,h,A]),w.useEffect(()=>{if(i){const I=y().controls;return g({controls:T}),()=>g({controls:I})}},[i,T]),w.createElement("primitive",ot({ref:u,object:T,enableDamping:r},c))}),wde=w.forwardRef(({makeDefault:i,camera:e,domElement:t,regress:n,onChange:r,onStart:s,onEnd:o,...a},l)=>{const{invalidate:c,camera:u,gl:h,events:f,set:d,get:m,performance:A,viewport:g}=Ve(),y=e||u,E=t||f.connected||h.domElement,x=w.useMemo(()=>new rce(y),[y]);return Kt(()=>{x.enabled&&x.update()},-1),w.useEffect(()=>(x.connect(E),()=>void x.dispose()),[E,n,x,c]),w.useEffect(()=>{const C=T=>{c(),n&&A.regress(),r&&r(T)};return x.addEventListener("change",C),s&&x.addEventListener("start",s),o&&x.addEventListener("end",o),()=>{s&&x.removeEventListener("start",s),o&&x.removeEventListener("end",o),x.removeEventListener("change",C)}},[r,s,o,x,c]),w.useEffect(()=>{x.handleResize()},[g]),w.useEffect(()=>{if(i){const C=m().controls;return d({controls:x}),()=>d({controls:C})}},[i,x]),w.createElement("primitive",ot({ref:l,object:x},a))}),Cde=w.forwardRef(({camera:i,makeDefault:e,regress:t,domElement:n,onChange:r,onStart:s,onEnd:o,...a},l)=>{const c=Ve(x=>x.invalidate),u=Ve(x=>x.camera),h=Ve(x=>x.gl),f=Ve(x=>x.events),d=Ve(x=>x.set),m=Ve(x=>x.get),A=Ve(x=>x.performance),g=i||u,y=n||f.connected||h.domElement,E=w.useMemo(()=>new hce(g),[g]);return Kt(()=>{E.enabled&&E.update()},-1),w.useEffect(()=>(E.connect(y),()=>void E.dispose()),[y,t,E,c]),w.useEffect(()=>{const x=C=>{c(),t&&A.regress(),r&&r(C)};return E.addEventListener("change",x),s&&E.addEventListener("start",s),o&&E.addEventListener("end",o),()=>{E.removeEventListener("change",x),s&&E.removeEventListener("start",s),o&&E.removeEventListener("end",o)}},[r,s,o]),w.useEffect(()=>{if(e){const x=m().controls;return d({controls:E}),()=>d({controls:x})}},[e,E]),w.createElement("primitive",ot({ref:l,object:E},a))}),Tde=w.forwardRef(({children:i,domElement:e,onChange:t,onMouseDown:n,onMouseUp:r,onObjectChange:s,object:o,makeDefault:a,camera:l,enabled:c,axis:u,mode:h,translationSnap:f,rotationSnap:d,scaleSnap:m,space:A,size:g,showX:y,showY:E,showZ:x,...C},T)=>{const I=Ve(O=>O.controls),M=Ve(O=>O.gl),L=Ve(O=>O.events),R=Ve(O=>O.camera),P=Ve(O=>O.invalidate),F=Ve(O=>O.get),k=Ve(O=>O.set),z=l||R,U=e||L.connected||M.domElement,W=w.useMemo(()=>new Vle(z,U),[z,U]),$=w.useRef(null);w.useLayoutEffect(()=>(o?W.attach(o instanceof _n?o:o.current):$.current instanceof _n&&W.attach($.current),()=>void W.detach()),[o,i,W]),w.useEffect(()=>{if(I){const O=K=>I.enabled=!K.value;return W.addEventListener("dragging-changed",O),()=>W.removeEventListener("dragging-changed",O)}},[W,I]);const oe=w.useRef(),X=w.useRef(),Q=w.useRef(),Y=w.useRef();return w.useLayoutEffect(()=>void(oe.current=t),[t]),w.useLayoutEffect(()=>void(X.current=n),[n]),w.useLayoutEffect(()=>void(Q.current=r),[r]),w.useLayoutEffect(()=>void(Y.current=s),[s]),w.useEffect(()=>{const O=J=>{P(),oe.current==null||oe.current(J)},K=J=>X.current==null?void 0:X.current(J),te=J=>Q.current==null?void 0:Q.current(J),q=J=>Y.current==null?void 0:Y.current(J);return W.addEventListener("change",O),W.addEventListener("mouseDown",K),W.addEventListener("mouseUp",te),W.addEventListener("objectChange",q),()=>{W.removeEventListener("change",O),W.removeEventListener("mouseDown",K),W.removeEventListener("mouseUp",te),W.removeEventListener("objectChange",q)}},[P,W]),w.useEffect(()=>{if(a){const O=F().controls;return k({controls:W}),()=>k({controls:O})}},[a,W]),w.createElement(w.Fragment,null,w.createElement("primitive",{ref:T,object:W,enabled:c,axis:u,mode:h,translationSnap:f,rotationSnap:d,scaleSnap:m,space:A,size:g,showX:y,showY:E,showZ:x}),w.createElement("group",ot({ref:$},C),i))}),bde=w.forwardRef(({domElement:i,selector:e,onChange:t,onLock:n,onUnlock:r,enabled:s=!0,makeDefault:o,...a},l)=>{const{camera:c,...u}=a,h=Ve(T=>T.setEvents),f=Ve(T=>T.gl),d=Ve(T=>T.camera),m=Ve(T=>T.invalidate),A=Ve(T=>T.events),g=Ve(T=>T.get),y=Ve(T=>T.set),E=c||d,x=i||A.connected||f.domElement,C=w.useMemo(()=>new Jle(E),[E]);return w.useEffect(()=>{if(s){C.connect(x);const T=g().events.compute;return h({compute(I,M){const L=M.size.width/2,R=M.size.height/2;M.pointer.set(L/M.size.width*2-1,-(R/M.size.height)*2+1),M.raycaster.setFromCamera(M.pointer,M.camera)}}),()=>{C.disconnect(),h({compute:T})}}},[s,C]),w.useEffect(()=>{const T=L=>{m(),t&&t(L)};C.addEventListener("change",T),n&&C.addEventListener("lock",n),r&&C.addEventListener("unlock",r);const I=()=>C.lock(),M=e?Array.from(document.querySelectorAll(e)):[document];return M.forEach(L=>L&&L.addEventListener("click",I)),()=>{C.removeEventListener("change",T),n&&C.removeEventListener("lock",n),r&&C.removeEventListener("unlock",r),M.forEach(L=>L?L.removeEventListener("click",I):void 0)}},[t,n,r,e,C,m]),w.useEffect(()=>{if(o){const T=g().controls;return y({controls:C}),()=>y({controls:T})}},[o,C]),w.createElement("primitive",ot({ref:l,object:C},u))}),Ide=w.forwardRef(({domElement:i,makeDefault:e,...t},n)=>{const r=Ve(h=>h.camera),s=Ve(h=>h.gl),o=Ve(h=>h.events),a=Ve(h=>h.get),l=Ve(h=>h.set),c=i||o.connected||s.domElement,[u]=w.useState(()=>new Gle(r,c));return w.useEffect(()=>{if(e){const h=a().controls;return l({controls:u}),()=>l({controls:h})}},[e,u]),Kt((h,f)=>{u.update(f)},-1),u?w.createElement("primitive",ot({ref:n,object:u},t)):null});/*!
 * camera-controls
 * https://github.com/yomotsu/camera-controls
 * (c) 2017 @yomotsu
 * Released under the MIT License.
 */const Hr={LEFT:1,RIGHT:2,MIDDLE:4},nt=Object.freeze({NONE:0,ROTATE:1,TRUCK:2,SCREEN_PAN:4,OFFSET:8,DOLLY:16,ZOOM:32,TOUCH_ROTATE:64,TOUCH_TRUCK:128,TOUCH_SCREEN_PAN:256,TOUCH_OFFSET:512,TOUCH_DOLLY:1024,TOUCH_ZOOM:2048,TOUCH_DOLLY_TRUCK:4096,TOUCH_DOLLY_SCREEN_PAN:8192,TOUCH_DOLLY_OFFSET:16384,TOUCH_DOLLY_ROTATE:32768,TOUCH_ZOOM_TRUCK:65536,TOUCH_ZOOM_OFFSET:131072,TOUCH_ZOOM_SCREEN_PAN:262144,TOUCH_ZOOM_ROTATE:524288}),Hg={NONE:0,IN:1,OUT:-1};function Am(i){return i.isPerspectiveCamera}function Dd(i){return i.isOrthographicCamera}const Qg=Math.PI*2,p7=Math.PI/2,fQ=1e-5,cv=Math.PI/180;function au(i,e,t){return Math.max(e,Math.min(t,i))}function pr(i,e=fQ){return Math.abs(i)<e}function Fi(i,e,t=fQ){return pr(i-e,t)}function m7(i,e){return Math.round(i/e)*e}function uv(i){return isFinite(i)?i:i<0?-Number.MAX_VALUE:Number.MAX_VALUE}function hv(i){return Math.abs(i)<Number.MAX_VALUE?i:i*(1/0)}function G3(i,e,t,n,r=1/0,s){n=Math.max(1e-4,n);const o=2/n,a=o*s,l=1/(1+a+.48*a*a+.235*a*a*a);let c=i-e;const u=e,h=r*n;c=au(c,-h,h),e=i-c;const f=(t.value+o*c)*s;t.value=(t.value-o*f)*l;let d=e+(c+f)*l;return u-i>0==d>u&&(d=u,t.value=(d-u)/s),d}function g7(i,e,t,n,r=1/0,s,o){n=Math.max(1e-4,n);const a=2/n,l=a*s,c=1/(1+l+.48*l*l+.235*l*l*l);let u=e.x,h=e.y,f=e.z,d=i.x-u,m=i.y-h,A=i.z-f;const g=u,y=h,E=f,x=r*n,C=x*x,T=d*d+m*m+A*A;if(T>C){const W=Math.sqrt(T);d=d/W*x,m=m/W*x,A=A/W*x}u=i.x-d,h=i.y-m,f=i.z-A;const I=(t.x+a*d)*s,M=(t.y+a*m)*s,L=(t.z+a*A)*s;t.x=(t.x-a*I)*c,t.y=(t.y-a*M)*c,t.z=(t.z-a*L)*c,o.x=u+(d+I)*c,o.y=h+(m+M)*c,o.z=f+(A+L)*c;const R=g-i.x,P=y-i.y,F=E-i.z,k=o.x-g,z=o.y-y,U=o.z-E;return R*k+P*z+F*U>0&&(o.x=g,o.y=y,o.z=E,t.x=(o.x-g)/s,t.y=(o.y-y)/s,t.z=(o.z-E)/s),o}function xb(i,e){e.set(0,0),i.forEach(t=>{e.x+=t.clientX,e.y+=t.clientY}),e.x/=i.length,e.y/=i.length}function Eb(i,e){return Dd(i)?(console.warn(`${e} is not supported in OrthographicCamera`),!0):!1}class Mde{constructor(){this._listeners={}}addEventListener(e,t){const n=this._listeners;n[e]===void 0&&(n[e]=[]),n[e].indexOf(t)===-1&&n[e].push(t)}hasEventListener(e,t){const n=this._listeners;return n[e]!==void 0&&n[e].indexOf(t)!==-1}removeEventListener(e,t){const r=this._listeners[e];if(r!==void 0){const s=r.indexOf(t);s!==-1&&r.splice(s,1)}}removeAllEventListeners(e){if(!e){this._listeners={};return}Array.isArray(this._listeners[e])&&(this._listeners[e].length=0)}dispatchEvent(e){const n=this._listeners[e.type];if(n!==void 0){e.target=this;const r=n.slice(0);for(let s=0,o=r.length;s<o;s++)r[s].call(this,e)}}}var _b;const Rde="2.10.1",H3=1/8,Lde=/Mac/.test((_b=globalThis==null?void 0:globalThis.navigator)===null||_b===void 0?void 0:_b.platform);let Nn,A7,Q3,Sb,za,ni,bi,Vg,fv,nh,ih,ym,y7,v7,tc,dv,Wg,x7,wb,E7,Cb,Tb,V3,bb=class h5 extends Mde{static install(e){Nn=e.THREE,A7=Object.freeze(new Nn.Vector3(0,0,0)),Q3=Object.freeze(new Nn.Vector3(0,1,0)),Sb=Object.freeze(new Nn.Vector3(0,0,1)),za=new Nn.Vector2,ni=new Nn.Vector3,bi=new Nn.Vector3,Vg=new Nn.Vector3,fv=new Nn.Vector3,nh=new Nn.Vector3,ih=new Nn.Vector3,ym=new Nn.Vector3,y7=new Nn.Vector3,v7=new Nn.Vector3,tc=new Nn.Spherical,dv=new Nn.Spherical,Wg=new Nn.Box3,x7=new Nn.Box3,wb=new Nn.Sphere,E7=new Nn.Quaternion,Cb=new Nn.Quaternion,Tb=new Nn.Matrix4,V3=new Nn.Raycaster}static get ACTION(){return nt}set verticalDragToForward(e){console.warn("camera-controls: `verticalDragToForward` was removed. Use `mouseButtons.left = CameraControls.ACTION.SCREEN_PAN` instead.")}constructor(e,t){super(),this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.minDistance=Number.EPSILON,this.maxDistance=1/0,this.infinityDolly=!1,this.minZoom=.01,this.maxZoom=1/0,this.smoothTime=.25,this.draggingSmoothTime=.125,this.maxSpeed=1/0,this.azimuthRotateSpeed=1,this.polarRotateSpeed=1,this.dollySpeed=1,this.dollyDragInverted=!1,this.truckSpeed=2,this.dollyToCursor=!1,this.dragToOffset=!1,this.boundaryFriction=0,this.restThreshold=.01,this.colliderMeshes=[],this.cancel=()=>{},this._enabled=!0,this._state=nt.NONE,this._viewport=null,this._changedDolly=0,this._changedZoom=0,this._hasRested=!0,this._boundaryEnclosesCamera=!1,this._needsUpdate=!0,this._updatedLastTime=!1,this._elementRect=new DOMRect,this._isDragging=!1,this._dragNeedsUpdate=!0,this._activePointers=[],this._lockedPointer=null,this._interactiveArea=new DOMRect(0,0,1,1),this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._isUserControllingOffset=!1,this._isUserControllingZoom=!1,this._lastDollyDirection=Hg.NONE,this._thetaVelocity={value:0},this._phiVelocity={value:0},this._radiusVelocity={value:0},this._targetVelocity=new Nn.Vector3,this._focalOffsetVelocity=new Nn.Vector3,this._zoomVelocity={value:0},this._truckInternal=(y,E,x,C)=>{let T,I;if(Am(this._camera)){const M=ni.copy(this._camera.position).sub(this._target),L=this._camera.getEffectiveFOV()*cv,R=M.length()*Math.tan(L*.5);T=this.truckSpeed*y*R/this._elementRect.height,I=this.truckSpeed*E*R/this._elementRect.height}else if(Dd(this._camera)){const M=this._camera;T=this.truckSpeed*y*(M.right-M.left)/M.zoom/this._elementRect.width,I=this.truckSpeed*E*(M.top-M.bottom)/M.zoom/this._elementRect.height}else return;C?(x?this.setFocalOffset(this._focalOffsetEnd.x+T,this._focalOffsetEnd.y,this._focalOffsetEnd.z,!0):this.truck(T,0,!0),this.forward(-I,!0)):x?this.setFocalOffset(this._focalOffsetEnd.x+T,this._focalOffsetEnd.y+I,this._focalOffsetEnd.z,!0):this.truck(T,I,!0)},this._rotateInternal=(y,E)=>{const x=Qg*this.azimuthRotateSpeed*y/this._elementRect.height,C=Qg*this.polarRotateSpeed*E/this._elementRect.height;this.rotate(x,C,!0)},this._dollyInternal=(y,E,x)=>{const C=Math.pow(.95,-y*this.dollySpeed),T=this._sphericalEnd.radius,I=this._sphericalEnd.radius*C,M=au(I,this.minDistance,this.maxDistance),L=M-I;this.infinityDolly&&this.dollyToCursor?this._dollyToNoClamp(I,!0):this.infinityDolly&&!this.dollyToCursor?(this.dollyInFixed(L,!0),this._dollyToNoClamp(M,!0)):this._dollyToNoClamp(M,!0),this.dollyToCursor&&(this._changedDolly+=(this.infinityDolly?I:M)-T,this._dollyControlCoord.set(E,x)),this._lastDollyDirection=Math.sign(-y)},this._zoomInternal=(y,E,x)=>{const C=Math.pow(.95,y*this.dollySpeed),T=this._zoom,I=this._zoom*C;this.zoomTo(I,!0),this.dollyToCursor&&(this._changedZoom+=I-T,this._dollyControlCoord.set(E,x))},typeof Nn>"u"&&console.error("camera-controls: `THREE` is undefined. You must first run `CameraControls.install( { THREE: THREE } )`. Check the docs for further information."),this._camera=e,this._yAxisUpSpace=new Nn.Quaternion().setFromUnitVectors(this._camera.up,Q3),this._yAxisUpSpaceInverse=this._yAxisUpSpace.clone().invert(),this._state=nt.NONE,this._target=new Nn.Vector3,this._targetEnd=this._target.clone(),this._focalOffset=new Nn.Vector3,this._focalOffsetEnd=this._focalOffset.clone(),this._spherical=new Nn.Spherical().setFromVector3(ni.copy(this._camera.position).applyQuaternion(this._yAxisUpSpace)),this._sphericalEnd=this._spherical.clone(),this._lastDistance=this._spherical.radius,this._zoom=this._camera.zoom,this._zoomEnd=this._zoom,this._lastZoom=this._zoom,this._nearPlaneCorners=[new Nn.Vector3,new Nn.Vector3,new Nn.Vector3,new Nn.Vector3],this._updateNearPlaneCorners(),this._boundary=new Nn.Box3(new Nn.Vector3(-1/0,-1/0,-1/0),new Nn.Vector3(1/0,1/0,1/0)),this._cameraUp0=this._camera.up.clone(),this._target0=this._target.clone(),this._position0=this._camera.position.clone(),this._zoom0=this._zoom,this._focalOffset0=this._focalOffset.clone(),this._dollyControlCoord=new Nn.Vector2,this.mouseButtons={left:nt.ROTATE,middle:nt.DOLLY,right:nt.TRUCK,wheel:Am(this._camera)?nt.DOLLY:Dd(this._camera)?nt.ZOOM:nt.NONE},this.touches={one:nt.TOUCH_ROTATE,two:Am(this._camera)?nt.TOUCH_DOLLY_TRUCK:Dd(this._camera)?nt.TOUCH_ZOOM_TRUCK:nt.NONE,three:nt.TOUCH_TRUCK};const n=new Nn.Vector2,r=new Nn.Vector2,s=new Nn.Vector2,o=y=>{if(!this._enabled||!this._domElement)return;if(this._interactiveArea.left!==0||this._interactiveArea.top!==0||this._interactiveArea.width!==1||this._interactiveArea.height!==1){const C=this._domElement.getBoundingClientRect(),T=y.clientX/C.width,I=y.clientY/C.height;if(T<this._interactiveArea.left||T>this._interactiveArea.right||I<this._interactiveArea.top||I>this._interactiveArea.bottom)return}const E=y.pointerType!=="mouse"?null:(y.buttons&Hr.LEFT)===Hr.LEFT?Hr.LEFT:(y.buttons&Hr.MIDDLE)===Hr.MIDDLE?Hr.MIDDLE:(y.buttons&Hr.RIGHT)===Hr.RIGHT?Hr.RIGHT:null;if(E!==null){const C=this._findPointerByMouseButton(E);C&&this._disposePointer(C)}if((y.buttons&Hr.LEFT)===Hr.LEFT&&this._lockedPointer)return;const x={pointerId:y.pointerId,clientX:y.clientX,clientY:y.clientY,deltaX:0,deltaY:0,mouseButton:E};this._activePointers.push(x),this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",l),this._domElement.ownerDocument.addEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",l),this._isDragging=!0,f(y)},a=y=>{y.cancelable&&y.preventDefault();const E=y.pointerId,x=this._lockedPointer||this._findPointerById(E);if(x){if(x.clientX=y.clientX,x.clientY=y.clientY,x.deltaX=y.movementX,x.deltaY=y.movementY,this._state=0,y.pointerType==="touch")switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else(!this._isDragging&&this._lockedPointer||this._isDragging&&(y.buttons&Hr.LEFT)===Hr.LEFT)&&(this._state=this._state|this.mouseButtons.left),this._isDragging&&(y.buttons&Hr.MIDDLE)===Hr.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),this._isDragging&&(y.buttons&Hr.RIGHT)===Hr.RIGHT&&(this._state=this._state|this.mouseButtons.right);d()}},l=y=>{const E=this._findPointerById(y.pointerId);if(!(E&&E===this._lockedPointer)){if(E&&this._disposePointer(E),y.pointerType==="touch")switch(this._activePointers.length){case 0:this._state=nt.NONE;break;case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else this._state=nt.NONE;m()}};let c=-1;const u=y=>{if(!this._domElement||!this._enabled||this.mouseButtons.wheel===nt.NONE)return;if(this._interactiveArea.left!==0||this._interactiveArea.top!==0||this._interactiveArea.width!==1||this._interactiveArea.height!==1){const I=this._domElement.getBoundingClientRect(),M=y.clientX/I.width,L=y.clientY/I.height;if(M<this._interactiveArea.left||M>this._interactiveArea.right||L<this._interactiveArea.top||L>this._interactiveArea.bottom)return}if(y.preventDefault(),this.dollyToCursor||this.mouseButtons.wheel===nt.ROTATE||this.mouseButtons.wheel===nt.TRUCK){const I=performance.now();c-I<1e3&&this._getClientRect(this._elementRect),c=I}const E=Lde?-1:-3,x=y.deltaMode===1||y.ctrlKey?y.deltaY/E:y.deltaY/(E*10),C=this.dollyToCursor?(y.clientX-this._elementRect.x)/this._elementRect.width*2-1:0,T=this.dollyToCursor?(y.clientY-this._elementRect.y)/this._elementRect.height*-2+1:0;switch(this.mouseButtons.wheel){case nt.ROTATE:{this._rotateInternal(y.deltaX,y.deltaY),this._isUserControllingRotate=!0;break}case nt.TRUCK:{this._truckInternal(y.deltaX,y.deltaY,!1,!1),this._isUserControllingTruck=!0;break}case nt.SCREEN_PAN:{this._truckInternal(y.deltaX,y.deltaY,!1,!0),this._isUserControllingTruck=!0;break}case nt.OFFSET:{this._truckInternal(y.deltaX,y.deltaY,!0,!1),this._isUserControllingOffset=!0;break}case nt.DOLLY:{this._dollyInternal(-x,C,T),this._isUserControllingDolly=!0;break}case nt.ZOOM:{this._zoomInternal(-x,C,T),this._isUserControllingZoom=!0;break}}this.dispatchEvent({type:"control"})},h=y=>{if(!(!this._domElement||!this._enabled)){if(this.mouseButtons.right===h5.ACTION.NONE){const E=y instanceof PointerEvent?y.pointerId:0,x=this._findPointerById(E);x&&this._disposePointer(x),this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",l);return}y.preventDefault()}},f=y=>{if(!this._enabled)return;if(xb(this._activePointers,za),this._getClientRect(this._elementRect),n.copy(za),r.copy(za),this._activePointers.length>=2){const x=za.x-this._activePointers[1].clientX,C=za.y-this._activePointers[1].clientY,T=Math.sqrt(x*x+C*C);s.set(0,T);const I=(this._activePointers[0].clientX+this._activePointers[1].clientX)*.5,M=(this._activePointers[0].clientY+this._activePointers[1].clientY)*.5;r.set(I,M)}if(this._state=0,!y)this._lockedPointer&&(this._state=this._state|this.mouseButtons.left);else if("pointerType"in y&&y.pointerType==="touch")switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else!this._lockedPointer&&(y.buttons&Hr.LEFT)===Hr.LEFT&&(this._state=this._state|this.mouseButtons.left),(y.buttons&Hr.MIDDLE)===Hr.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),(y.buttons&Hr.RIGHT)===Hr.RIGHT&&(this._state=this._state|this.mouseButtons.right);((this._state&nt.ROTATE)===nt.ROTATE||(this._state&nt.TOUCH_ROTATE)===nt.TOUCH_ROTATE||(this._state&nt.TOUCH_DOLLY_ROTATE)===nt.TOUCH_DOLLY_ROTATE||(this._state&nt.TOUCH_ZOOM_ROTATE)===nt.TOUCH_ZOOM_ROTATE)&&(this._sphericalEnd.theta=this._spherical.theta,this._sphericalEnd.phi=this._spherical.phi,this._thetaVelocity.value=0,this._phiVelocity.value=0),((this._state&nt.TRUCK)===nt.TRUCK||(this._state&nt.SCREEN_PAN)===nt.SCREEN_PAN||(this._state&nt.TOUCH_TRUCK)===nt.TOUCH_TRUCK||(this._state&nt.TOUCH_SCREEN_PAN)===nt.TOUCH_SCREEN_PAN||(this._state&nt.TOUCH_DOLLY_TRUCK)===nt.TOUCH_DOLLY_TRUCK||(this._state&nt.TOUCH_DOLLY_SCREEN_PAN)===nt.TOUCH_DOLLY_SCREEN_PAN||(this._state&nt.TOUCH_ZOOM_TRUCK)===nt.TOUCH_ZOOM_TRUCK||(this._state&nt.TOUCH_ZOOM_SCREEN_PAN)===nt.TOUCH_DOLLY_SCREEN_PAN)&&(this._targetEnd.copy(this._target),this._targetVelocity.set(0,0,0)),((this._state&nt.DOLLY)===nt.DOLLY||(this._state&nt.TOUCH_DOLLY)===nt.TOUCH_DOLLY||(this._state&nt.TOUCH_DOLLY_TRUCK)===nt.TOUCH_DOLLY_TRUCK||(this._state&nt.TOUCH_DOLLY_SCREEN_PAN)===nt.TOUCH_DOLLY_SCREEN_PAN||(this._state&nt.TOUCH_DOLLY_OFFSET)===nt.TOUCH_DOLLY_OFFSET||(this._state&nt.TOUCH_DOLLY_ROTATE)===nt.TOUCH_DOLLY_ROTATE)&&(this._sphericalEnd.radius=this._spherical.radius,this._radiusVelocity.value=0),((this._state&nt.ZOOM)===nt.ZOOM||(this._state&nt.TOUCH_ZOOM)===nt.TOUCH_ZOOM||(this._state&nt.TOUCH_ZOOM_TRUCK)===nt.TOUCH_ZOOM_TRUCK||(this._state&nt.TOUCH_ZOOM_SCREEN_PAN)===nt.TOUCH_ZOOM_SCREEN_PAN||(this._state&nt.TOUCH_ZOOM_OFFSET)===nt.TOUCH_ZOOM_OFFSET||(this._state&nt.TOUCH_ZOOM_ROTATE)===nt.TOUCH_ZOOM_ROTATE)&&(this._zoomEnd=this._zoom,this._zoomVelocity.value=0),((this._state&nt.OFFSET)===nt.OFFSET||(this._state&nt.TOUCH_OFFSET)===nt.TOUCH_OFFSET||(this._state&nt.TOUCH_DOLLY_OFFSET)===nt.TOUCH_DOLLY_OFFSET||(this._state&nt.TOUCH_ZOOM_OFFSET)===nt.TOUCH_ZOOM_OFFSET)&&(this._focalOffsetEnd.copy(this._focalOffset),this._focalOffsetVelocity.set(0,0,0)),this.dispatchEvent({type:"controlstart"})},d=()=>{if(!this._enabled||!this._dragNeedsUpdate)return;this._dragNeedsUpdate=!1,xb(this._activePointers,za);const E=this._domElement&&this._domElement.ownerDocument.pointerLockElement===this._domElement?this._lockedPointer||this._activePointers[0]:null,x=E?-E.deltaX:r.x-za.x,C=E?-E.deltaY:r.y-za.y;if(r.copy(za),((this._state&nt.ROTATE)===nt.ROTATE||(this._state&nt.TOUCH_ROTATE)===nt.TOUCH_ROTATE||(this._state&nt.TOUCH_DOLLY_ROTATE)===nt.TOUCH_DOLLY_ROTATE||(this._state&nt.TOUCH_ZOOM_ROTATE)===nt.TOUCH_ZOOM_ROTATE)&&(this._rotateInternal(x,C),this._isUserControllingRotate=!0),(this._state&nt.DOLLY)===nt.DOLLY||(this._state&nt.ZOOM)===nt.ZOOM){const T=this.dollyToCursor?(n.x-this._elementRect.x)/this._elementRect.width*2-1:0,I=this.dollyToCursor?(n.y-this._elementRect.y)/this._elementRect.height*-2+1:0,M=this.dollyDragInverted?-1:1;(this._state&nt.DOLLY)===nt.DOLLY?(this._dollyInternal(M*C*H3,T,I),this._isUserControllingDolly=!0):(this._zoomInternal(M*C*H3,T,I),this._isUserControllingZoom=!0)}if((this._state&nt.TOUCH_DOLLY)===nt.TOUCH_DOLLY||(this._state&nt.TOUCH_ZOOM)===nt.TOUCH_ZOOM||(this._state&nt.TOUCH_DOLLY_TRUCK)===nt.TOUCH_DOLLY_TRUCK||(this._state&nt.TOUCH_ZOOM_TRUCK)===nt.TOUCH_ZOOM_TRUCK||(this._state&nt.TOUCH_DOLLY_SCREEN_PAN)===nt.TOUCH_DOLLY_SCREEN_PAN||(this._state&nt.TOUCH_ZOOM_SCREEN_PAN)===nt.TOUCH_ZOOM_SCREEN_PAN||(this._state&nt.TOUCH_DOLLY_OFFSET)===nt.TOUCH_DOLLY_OFFSET||(this._state&nt.TOUCH_ZOOM_OFFSET)===nt.TOUCH_ZOOM_OFFSET||(this._state&nt.TOUCH_DOLLY_ROTATE)===nt.TOUCH_DOLLY_ROTATE||(this._state&nt.TOUCH_ZOOM_ROTATE)===nt.TOUCH_ZOOM_ROTATE){const T=za.x-this._activePointers[1].clientX,I=za.y-this._activePointers[1].clientY,M=Math.sqrt(T*T+I*I),L=s.y-M;s.set(0,M);const R=this.dollyToCursor?(r.x-this._elementRect.x)/this._elementRect.width*2-1:0,P=this.dollyToCursor?(r.y-this._elementRect.y)/this._elementRect.height*-2+1:0;(this._state&nt.TOUCH_DOLLY)===nt.TOUCH_DOLLY||(this._state&nt.TOUCH_DOLLY_ROTATE)===nt.TOUCH_DOLLY_ROTATE||(this._state&nt.TOUCH_DOLLY_TRUCK)===nt.TOUCH_DOLLY_TRUCK||(this._state&nt.TOUCH_DOLLY_SCREEN_PAN)===nt.TOUCH_DOLLY_SCREEN_PAN||(this._state&nt.TOUCH_DOLLY_OFFSET)===nt.TOUCH_DOLLY_OFFSET?(this._dollyInternal(L*H3,R,P),this._isUserControllingDolly=!0):(this._zoomInternal(L*H3,R,P),this._isUserControllingZoom=!0)}((this._state&nt.TRUCK)===nt.TRUCK||(this._state&nt.TOUCH_TRUCK)===nt.TOUCH_TRUCK||(this._state&nt.TOUCH_DOLLY_TRUCK)===nt.TOUCH_DOLLY_TRUCK||(this._state&nt.TOUCH_ZOOM_TRUCK)===nt.TOUCH_ZOOM_TRUCK)&&(this._truckInternal(x,C,!1,!1),this._isUserControllingTruck=!0),((this._state&nt.SCREEN_PAN)===nt.SCREEN_PAN||(this._state&nt.TOUCH_SCREEN_PAN)===nt.TOUCH_SCREEN_PAN||(this._state&nt.TOUCH_DOLLY_SCREEN_PAN)===nt.TOUCH_DOLLY_SCREEN_PAN||(this._state&nt.TOUCH_ZOOM_SCREEN_PAN)===nt.TOUCH_ZOOM_SCREEN_PAN)&&(this._truckInternal(x,C,!1,!0),this._isUserControllingTruck=!0),((this._state&nt.OFFSET)===nt.OFFSET||(this._state&nt.TOUCH_OFFSET)===nt.TOUCH_OFFSET||(this._state&nt.TOUCH_DOLLY_OFFSET)===nt.TOUCH_DOLLY_OFFSET||(this._state&nt.TOUCH_ZOOM_OFFSET)===nt.TOUCH_ZOOM_OFFSET)&&(this._truckInternal(x,C,!0,!1),this._isUserControllingOffset=!0),this.dispatchEvent({type:"control"})},m=()=>{xb(this._activePointers,za),r.copy(za),this._dragNeedsUpdate=!1,(this._activePointers.length===0||this._activePointers.length===1&&this._activePointers[0]===this._lockedPointer)&&(this._isDragging=!1),this._activePointers.length===0&&this._domElement&&(this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",l),this.dispatchEvent({type:"controlend"}))};this.lockPointer=()=>{!this._enabled||!this._domElement||(this.cancel(),this._lockedPointer={pointerId:-1,clientX:0,clientY:0,deltaX:0,deltaY:0,mouseButton:null},this._activePointers.push(this._lockedPointer),this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",l),this._domElement.requestPointerLock(),this._domElement.ownerDocument.addEventListener("pointerlockchange",A),this._domElement.ownerDocument.addEventListener("pointerlockerror",g),this._domElement.ownerDocument.addEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",l),f())},this.unlockPointer=()=>{var y,E,x;this._lockedPointer!==null&&(this._disposePointer(this._lockedPointer),this._lockedPointer=null),(y=this._domElement)===null||y===void 0||y.ownerDocument.exitPointerLock(),(E=this._domElement)===null||E===void 0||E.ownerDocument.removeEventListener("pointerlockchange",A),(x=this._domElement)===null||x===void 0||x.ownerDocument.removeEventListener("pointerlockerror",g),this.cancel()};const A=()=>{this._domElement&&this._domElement.ownerDocument.pointerLockElement===this._domElement||this.unlockPointer()},g=()=>{this.unlockPointer()};this._addAllEventListeners=y=>{this._domElement=y,this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none",this._domElement.addEventListener("pointerdown",o),this._domElement.addEventListener("pointercancel",l),this._domElement.addEventListener("wheel",u,{passive:!1}),this._domElement.addEventListener("contextmenu",h)},this._removeAllEventListeners=()=>{this._domElement&&(this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect="",this._domElement.removeEventListener("pointerdown",o),this._domElement.removeEventListener("pointercancel",l),this._domElement.removeEventListener("wheel",u,{passive:!1}),this._domElement.removeEventListener("contextmenu",h),this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",l),this._domElement.ownerDocument.removeEventListener("pointerlockchange",A),this._domElement.ownerDocument.removeEventListener("pointerlockerror",g))},this.cancel=()=>{this._state!==nt.NONE&&(this._state=nt.NONE,this._activePointers.length=0,m())},t&&this.connect(t),this.update(0)}get camera(){return this._camera}set camera(e){this._camera=e,this.updateCameraUp(),this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0}get enabled(){return this._enabled}set enabled(e){this._enabled=e,this._domElement&&(e?(this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none"):(this.cancel(),this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect=""))}get active(){return!this._hasRested}get currentAction(){return this._state}get distance(){return this._spherical.radius}set distance(e){this._spherical.radius===e&&this._sphericalEnd.radius===e||(this._spherical.radius=e,this._sphericalEnd.radius=e,this._needsUpdate=!0)}get azimuthAngle(){return this._spherical.theta}set azimuthAngle(e){this._spherical.theta===e&&this._sphericalEnd.theta===e||(this._spherical.theta=e,this._sphericalEnd.theta=e,this._needsUpdate=!0)}get polarAngle(){return this._spherical.phi}set polarAngle(e){this._spherical.phi===e&&this._sphericalEnd.phi===e||(this._spherical.phi=e,this._sphericalEnd.phi=e,this._needsUpdate=!0)}get boundaryEnclosesCamera(){return this._boundaryEnclosesCamera}set boundaryEnclosesCamera(e){this._boundaryEnclosesCamera=e,this._needsUpdate=!0}set interactiveArea(e){this._interactiveArea.width=au(e.width,0,1),this._interactiveArea.height=au(e.height,0,1),this._interactiveArea.x=au(e.x,0,1-this._interactiveArea.width),this._interactiveArea.y=au(e.y,0,1-this._interactiveArea.height)}addEventListener(e,t){super.addEventListener(e,t)}removeEventListener(e,t){super.removeEventListener(e,t)}rotate(e,t,n=!1){return this.rotateTo(this._sphericalEnd.theta+e,this._sphericalEnd.phi+t,n)}rotateAzimuthTo(e,t=!1){return this.rotateTo(e,this._sphericalEnd.phi,t)}rotatePolarTo(e,t=!1){return this.rotateTo(this._sphericalEnd.theta,e,t)}rotateTo(e,t,n=!1){this._isUserControllingRotate=!1;const r=au(e,this.minAzimuthAngle,this.maxAzimuthAngle),s=au(t,this.minPolarAngle,this.maxPolarAngle);this._sphericalEnd.theta=r,this._sphericalEnd.phi=s,this._sphericalEnd.makeSafe(),this._needsUpdate=!0,n||(this._spherical.theta=this._sphericalEnd.theta,this._spherical.phi=this._sphericalEnd.phi);const o=!n||Fi(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&Fi(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold);return this._createOnRestPromise(o)}dolly(e,t=!1){return this.dollyTo(this._sphericalEnd.radius-e,t)}dollyTo(e,t=!1){return this._isUserControllingDolly=!1,this._lastDollyDirection=Hg.NONE,this._changedDolly=0,this._dollyToNoClamp(au(e,this.minDistance,this.maxDistance),t)}_dollyToNoClamp(e,t=!1){const n=this._sphericalEnd.radius;if(this.colliderMeshes.length>=1){const o=this._collisionTest(),a=Fi(o,this._spherical.radius);if(!(n>e)&&a)return Promise.resolve();this._sphericalEnd.radius=Math.min(e,o)}else this._sphericalEnd.radius=e;this._needsUpdate=!0,t||(this._spherical.radius=this._sphericalEnd.radius);const s=!t||Fi(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(s)}dollyInFixed(e,t=!1){this._targetEnd.add(this._getCameraDirection(fv).multiplyScalar(e)),t||this._target.copy(this._targetEnd);const n=!t||Fi(this._target.x,this._targetEnd.x,this.restThreshold)&&Fi(this._target.y,this._targetEnd.y,this.restThreshold)&&Fi(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(n)}zoom(e,t=!1){return this.zoomTo(this._zoomEnd+e,t)}zoomTo(e,t=!1){this._isUserControllingZoom=!1,this._zoomEnd=au(e,this.minZoom,this.maxZoom),this._needsUpdate=!0,t||(this._zoom=this._zoomEnd);const n=!t||Fi(this._zoom,this._zoomEnd,this.restThreshold);return this._changedZoom=0,this._createOnRestPromise(n)}pan(e,t,n=!1){return console.warn("`pan` has been renamed to `truck`"),this.truck(e,t,n)}truck(e,t,n=!1){this._camera.updateMatrix(),nh.setFromMatrixColumn(this._camera.matrix,0),ih.setFromMatrixColumn(this._camera.matrix,1),nh.multiplyScalar(e),ih.multiplyScalar(-t);const r=ni.copy(nh).add(ih),s=bi.copy(this._targetEnd).add(r);return this.moveTo(s.x,s.y,s.z,n)}forward(e,t=!1){ni.setFromMatrixColumn(this._camera.matrix,0),ni.crossVectors(this._camera.up,ni),ni.multiplyScalar(e);const n=bi.copy(this._targetEnd).add(ni);return this.moveTo(n.x,n.y,n.z,t)}elevate(e,t=!1){return ni.copy(this._camera.up).multiplyScalar(e),this.moveTo(this._targetEnd.x+ni.x,this._targetEnd.y+ni.y,this._targetEnd.z+ni.z,t)}moveTo(e,t,n,r=!1){this._isUserControllingTruck=!1;const s=ni.set(e,t,n).sub(this._targetEnd);this._encloseToBoundary(this._targetEnd,s,this.boundaryFriction),this._needsUpdate=!0,r||this._target.copy(this._targetEnd);const o=!r||Fi(this._target.x,this._targetEnd.x,this.restThreshold)&&Fi(this._target.y,this._targetEnd.y,this.restThreshold)&&Fi(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(o)}lookInDirectionOf(e,t,n,r=!1){const a=ni.set(e,t,n).sub(this._targetEnd).normalize().multiplyScalar(-this._sphericalEnd.radius).add(this._targetEnd);return this.setPosition(a.x,a.y,a.z,r)}fitToBox(e,t,{cover:n=!1,paddingLeft:r=0,paddingRight:s=0,paddingBottom:o=0,paddingTop:a=0}={}){const l=[],c=e.isBox3?Wg.copy(e):Wg.setFromObject(e);c.isEmpty()&&(console.warn("camera-controls: fitTo() cannot be used with an empty box. Aborting"),Promise.resolve());const u=m7(this._sphericalEnd.theta,p7),h=m7(this._sphericalEnd.phi,p7);l.push(this.rotateTo(u,h,t));const f=ni.setFromSpherical(this._sphericalEnd).normalize(),d=E7.setFromUnitVectors(f,Sb),m=Fi(Math.abs(f.y),1);m&&d.multiply(Cb.setFromAxisAngle(Q3,u)),d.multiply(this._yAxisUpSpaceInverse);const A=x7.makeEmpty();bi.copy(c.min).applyQuaternion(d),A.expandByPoint(bi),bi.copy(c.min).setX(c.max.x).applyQuaternion(d),A.expandByPoint(bi),bi.copy(c.min).setY(c.max.y).applyQuaternion(d),A.expandByPoint(bi),bi.copy(c.max).setZ(c.min.z).applyQuaternion(d),A.expandByPoint(bi),bi.copy(c.min).setZ(c.max.z).applyQuaternion(d),A.expandByPoint(bi),bi.copy(c.max).setY(c.min.y).applyQuaternion(d),A.expandByPoint(bi),bi.copy(c.max).setX(c.min.x).applyQuaternion(d),A.expandByPoint(bi),bi.copy(c.max).applyQuaternion(d),A.expandByPoint(bi),A.min.x-=r,A.min.y-=o,A.max.x+=s,A.max.y+=a,d.setFromUnitVectors(Sb,f),m&&d.premultiply(Cb.invert()),d.premultiply(this._yAxisUpSpace);const g=A.getSize(ni),y=A.getCenter(bi).applyQuaternion(d);if(Am(this._camera)){const E=this.getDistanceToFitBox(g.x,g.y,g.z,n);l.push(this.moveTo(y.x,y.y,y.z,t)),l.push(this.dollyTo(E,t)),l.push(this.setFocalOffset(0,0,0,t))}else if(Dd(this._camera)){const E=this._camera,x=E.right-E.left,C=E.top-E.bottom,T=n?Math.max(x/g.x,C/g.y):Math.min(x/g.x,C/g.y);l.push(this.moveTo(y.x,y.y,y.z,t)),l.push(this.zoomTo(T,t)),l.push(this.setFocalOffset(0,0,0,t))}return Promise.all(l)}fitToSphere(e,t){const n=[],s="isObject3D"in e?h5.createBoundingSphere(e,wb):wb.copy(e);if(n.push(this.moveTo(s.center.x,s.center.y,s.center.z,t)),Am(this._camera)){const o=this.getDistanceToFitSphere(s.radius);n.push(this.dollyTo(o,t))}else if(Dd(this._camera)){const o=this._camera.right-this._camera.left,a=this._camera.top-this._camera.bottom,l=2*s.radius,c=Math.min(o/l,a/l);n.push(this.zoomTo(c,t))}return n.push(this.setFocalOffset(0,0,0,t)),Promise.all(n)}setLookAt(e,t,n,r,s,o,a=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._lastDollyDirection=Hg.NONE,this._changedDolly=0;const l=bi.set(r,s,o),c=ni.set(e,t,n);this._targetEnd.copy(l),this._sphericalEnd.setFromVector3(c.sub(l).applyQuaternion(this._yAxisUpSpace)),this.normalizeRotations(),this._needsUpdate=!0,a||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));const u=!a||Fi(this._target.x,this._targetEnd.x,this.restThreshold)&&Fi(this._target.y,this._targetEnd.y,this.restThreshold)&&Fi(this._target.z,this._targetEnd.z,this.restThreshold)&&Fi(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&Fi(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&Fi(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(u)}lerpLookAt(e,t,n,r,s,o,a,l,c,u,h,f,d,m=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._lastDollyDirection=Hg.NONE,this._changedDolly=0;const A=ni.set(r,s,o),g=bi.set(e,t,n);tc.setFromVector3(g.sub(A).applyQuaternion(this._yAxisUpSpace));const y=Vg.set(u,h,f),E=bi.set(a,l,c);dv.setFromVector3(E.sub(y).applyQuaternion(this._yAxisUpSpace)),this._targetEnd.copy(A.lerp(y,d));const x=dv.theta-tc.theta,C=dv.phi-tc.phi,T=dv.radius-tc.radius;this._sphericalEnd.set(tc.radius+T*d,tc.phi+C*d,tc.theta+x*d),this.normalizeRotations(),this._needsUpdate=!0,m||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));const I=!m||Fi(this._target.x,this._targetEnd.x,this.restThreshold)&&Fi(this._target.y,this._targetEnd.y,this.restThreshold)&&Fi(this._target.z,this._targetEnd.z,this.restThreshold)&&Fi(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&Fi(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&Fi(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(I)}setPosition(e,t,n,r=!1){return this.setLookAt(e,t,n,this._targetEnd.x,this._targetEnd.y,this._targetEnd.z,r)}setTarget(e,t,n,r=!1){const s=this.getPosition(ni),o=this.setLookAt(s.x,s.y,s.z,e,t,n,r);return this._sphericalEnd.phi=au(this._sphericalEnd.phi,this.minPolarAngle,this.maxPolarAngle),o}setFocalOffset(e,t,n,r=!1){this._isUserControllingOffset=!1,this._focalOffsetEnd.set(e,t,n),this._needsUpdate=!0,r||this._focalOffset.copy(this._focalOffsetEnd);const s=!r||Fi(this._focalOffset.x,this._focalOffsetEnd.x,this.restThreshold)&&Fi(this._focalOffset.y,this._focalOffsetEnd.y,this.restThreshold)&&Fi(this._focalOffset.z,this._focalOffsetEnd.z,this.restThreshold);return this._createOnRestPromise(s)}setOrbitPoint(e,t,n){this._camera.updateMatrixWorld(),nh.setFromMatrixColumn(this._camera.matrixWorldInverse,0),ih.setFromMatrixColumn(this._camera.matrixWorldInverse,1),ym.setFromMatrixColumn(this._camera.matrixWorldInverse,2);const r=ni.set(e,t,n),s=r.distanceTo(this._camera.position),o=r.sub(this._camera.position);nh.multiplyScalar(o.x),ih.multiplyScalar(o.y),ym.multiplyScalar(o.z),ni.copy(nh).add(ih).add(ym),ni.z=ni.z+s,this.dollyTo(s,!1),this.setFocalOffset(-ni.x,ni.y,-ni.z,!1),this.moveTo(e,t,n,!1)}setBoundary(e){if(!e){this._boundary.min.set(-1/0,-1/0,-1/0),this._boundary.max.set(1/0,1/0,1/0),this._needsUpdate=!0;return}this._boundary.copy(e),this._boundary.clampPoint(this._targetEnd,this._targetEnd),this._needsUpdate=!0}setViewport(e,t,n,r){if(e===null){this._viewport=null;return}this._viewport=this._viewport||new Nn.Vector4,typeof e=="number"?this._viewport.set(e,t,n,r):this._viewport.copy(e)}getDistanceToFitBox(e,t,n,r=!1){if(Eb(this._camera,"getDistanceToFitBox"))return this._spherical.radius;const s=e/t,o=this._camera.getEffectiveFOV()*cv,a=this._camera.aspect;return((r?s>a:s<a)?t:e/a)*.5/Math.tan(o*.5)+n*.5}getDistanceToFitSphere(e){if(Eb(this._camera,"getDistanceToFitSphere"))return this._spherical.radius;const t=this._camera.getEffectiveFOV()*cv,n=Math.atan(Math.tan(t*.5)*this._camera.aspect)*2,r=1<this._camera.aspect?t:n;return e/Math.sin(r*.5)}getTarget(e,t=!0){return(e&&e.isVector3?e:new Nn.Vector3).copy(t?this._targetEnd:this._target)}getPosition(e,t=!0){return(e&&e.isVector3?e:new Nn.Vector3).setFromSpherical(t?this._sphericalEnd:this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(t?this._targetEnd:this._target)}getSpherical(e,t=!0){return(e||new Nn.Spherical).copy(t?this._sphericalEnd:this._spherical)}getFocalOffset(e,t=!0){return(e&&e.isVector3?e:new Nn.Vector3).copy(t?this._focalOffsetEnd:this._focalOffset)}normalizeRotations(){this._sphericalEnd.theta=this._sphericalEnd.theta%Qg,this._sphericalEnd.theta<0&&(this._sphericalEnd.theta+=Qg),this._spherical.theta+=Qg*Math.round((this._sphericalEnd.theta-this._spherical.theta)/Qg)}stop(){this._focalOffset.copy(this._focalOffsetEnd),this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd),this._zoom=this._zoomEnd}reset(e=!1){if(!Fi(this._camera.up.x,this._cameraUp0.x)||!Fi(this._camera.up.y,this._cameraUp0.y)||!Fi(this._camera.up.z,this._cameraUp0.z)){this._camera.up.copy(this._cameraUp0);const n=this.getPosition(ni);this.updateCameraUp(),this.setPosition(n.x,n.y,n.z)}const t=[this.setLookAt(this._position0.x,this._position0.y,this._position0.z,this._target0.x,this._target0.y,this._target0.z,e),this.setFocalOffset(this._focalOffset0.x,this._focalOffset0.y,this._focalOffset0.z,e),this.zoomTo(this._zoom0,e)];return Promise.all(t)}saveState(){this._cameraUp0.copy(this._camera.up),this.getTarget(this._target0),this.getPosition(this._position0),this._zoom0=this._zoom,this._focalOffset0.copy(this._focalOffset)}updateCameraUp(){this._yAxisUpSpace.setFromUnitVectors(this._camera.up,Q3),this._yAxisUpSpaceInverse.copy(this._yAxisUpSpace).invert()}applyCameraUp(){const e=ni.subVectors(this._target,this._camera.position).normalize(),t=bi.crossVectors(e,this._camera.up);this._camera.up.crossVectors(t,e).normalize(),this._camera.updateMatrixWorld();const n=this.getPosition(ni);this.updateCameraUp(),this.setPosition(n.x,n.y,n.z)}update(e){const t=this._sphericalEnd.theta-this._spherical.theta,n=this._sphericalEnd.phi-this._spherical.phi,r=this._sphericalEnd.radius-this._spherical.radius,s=y7.subVectors(this._targetEnd,this._target),o=v7.subVectors(this._focalOffsetEnd,this._focalOffset),a=this._zoomEnd-this._zoom;if(pr(t))this._thetaVelocity.value=0,this._spherical.theta=this._sphericalEnd.theta;else{const h=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.theta=G3(this._spherical.theta,this._sphericalEnd.theta,this._thetaVelocity,h,1/0,e),this._needsUpdate=!0}if(pr(n))this._phiVelocity.value=0,this._spherical.phi=this._sphericalEnd.phi;else{const h=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.phi=G3(this._spherical.phi,this._sphericalEnd.phi,this._phiVelocity,h,1/0,e),this._needsUpdate=!0}if(pr(r))this._radiusVelocity.value=0,this._spherical.radius=this._sphericalEnd.radius;else{const h=this._isUserControllingDolly?this.draggingSmoothTime:this.smoothTime;this._spherical.radius=G3(this._spherical.radius,this._sphericalEnd.radius,this._radiusVelocity,h,this.maxSpeed,e),this._needsUpdate=!0}if(pr(s.x)&&pr(s.y)&&pr(s.z))this._targetVelocity.set(0,0,0),this._target.copy(this._targetEnd);else{const h=this._isUserControllingTruck?this.draggingSmoothTime:this.smoothTime;g7(this._target,this._targetEnd,this._targetVelocity,h,this.maxSpeed,e,this._target),this._needsUpdate=!0}if(pr(o.x)&&pr(o.y)&&pr(o.z))this._focalOffsetVelocity.set(0,0,0),this._focalOffset.copy(this._focalOffsetEnd);else{const h=this._isUserControllingOffset?this.draggingSmoothTime:this.smoothTime;g7(this._focalOffset,this._focalOffsetEnd,this._focalOffsetVelocity,h,this.maxSpeed,e,this._focalOffset),this._needsUpdate=!0}if(pr(a))this._zoomVelocity.value=0,this._zoom=this._zoomEnd;else{const h=this._isUserControllingZoom?this.draggingSmoothTime:this.smoothTime;this._zoom=G3(this._zoom,this._zoomEnd,this._zoomVelocity,h,1/0,e)}if(this.dollyToCursor){if(Am(this._camera)&&this._changedDolly!==0){const h=this._spherical.radius-this._lastDistance,f=this._camera,d=this._getCameraDirection(fv),m=ni.copy(d).cross(f.up).normalize();m.lengthSq()===0&&(m.x=1);const A=bi.crossVectors(m,d),g=this._sphericalEnd.radius*Math.tan(f.getEffectiveFOV()*cv*.5),E=(this._sphericalEnd.radius-h-this._sphericalEnd.radius)/this._sphericalEnd.radius,x=Vg.copy(this._targetEnd).add(m.multiplyScalar(this._dollyControlCoord.x*g*f.aspect)).add(A.multiplyScalar(this._dollyControlCoord.y*g)),C=ni.copy(this._targetEnd).lerp(x,E),T=this._lastDollyDirection===Hg.IN&&this._spherical.radius<=this.minDistance,I=this._lastDollyDirection===Hg.OUT&&this.maxDistance<=this._spherical.radius;if(this.infinityDolly&&(T||I)){this._sphericalEnd.radius-=h,this._spherical.radius-=h;const L=bi.copy(d).multiplyScalar(-h);C.add(L)}this._boundary.clampPoint(C,C);const M=bi.subVectors(C,this._targetEnd);this._targetEnd.copy(C),this._target.add(M),this._changedDolly-=h,pr(this._changedDolly)&&(this._changedDolly=0)}else if(Dd(this._camera)&&this._changedZoom!==0){const h=this._zoom-this._lastZoom,f=this._camera,d=ni.set(this._dollyControlCoord.x,this._dollyControlCoord.y,(f.near+f.far)/(f.near-f.far)).unproject(f),m=bi.set(0,0,-1).applyQuaternion(f.quaternion),A=Vg.copy(d).add(m.multiplyScalar(-d.dot(f.up))),y=-(this._zoom-h-this._zoom)/this._zoom,E=this._getCameraDirection(fv),x=this._targetEnd.dot(E),C=ni.copy(this._targetEnd).lerp(A,y),T=C.dot(E),I=E.multiplyScalar(T-x);C.sub(I),this._boundary.clampPoint(C,C);const M=bi.subVectors(C,this._targetEnd);this._targetEnd.copy(C),this._target.add(M),this._changedZoom-=h,pr(this._changedZoom)&&(this._changedZoom=0)}}this._camera.zoom!==this._zoom&&(this._camera.zoom=this._zoom,this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0),this._dragNeedsUpdate=!0;const l=this._collisionTest();this._spherical.radius=Math.min(this._spherical.radius,l),this._spherical.makeSafe(),this._camera.position.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(this._target),this._camera.lookAt(this._target),(!pr(this._focalOffset.x)||!pr(this._focalOffset.y)||!pr(this._focalOffset.z))&&(nh.setFromMatrixColumn(this._camera.matrix,0),ih.setFromMatrixColumn(this._camera.matrix,1),ym.setFromMatrixColumn(this._camera.matrix,2),nh.multiplyScalar(this._focalOffset.x),ih.multiplyScalar(-this._focalOffset.y),ym.multiplyScalar(this._focalOffset.z),ni.copy(nh).add(ih).add(ym),this._camera.position.add(ni),this._camera.updateMatrixWorld()),this._boundaryEnclosesCamera&&this._encloseToBoundary(this._camera.position.copy(this._target),ni.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse),1);const u=this._needsUpdate;return u&&!this._updatedLastTime?(this._hasRested=!1,this.dispatchEvent({type:"wake"}),this.dispatchEvent({type:"update"})):u?(this.dispatchEvent({type:"update"}),pr(t,this.restThreshold)&&pr(n,this.restThreshold)&&pr(r,this.restThreshold)&&pr(s.x,this.restThreshold)&&pr(s.y,this.restThreshold)&&pr(s.z,this.restThreshold)&&pr(o.x,this.restThreshold)&&pr(o.y,this.restThreshold)&&pr(o.z,this.restThreshold)&&pr(a,this.restThreshold)&&!this._hasRested&&(this._hasRested=!0,this.dispatchEvent({type:"rest"}))):!u&&this._updatedLastTime&&this.dispatchEvent({type:"sleep"}),this._lastDistance=this._spherical.radius,this._lastZoom=this._zoom,this._updatedLastTime=u,this._needsUpdate=!1,u}toJSON(){return JSON.stringify({enabled:this._enabled,minDistance:this.minDistance,maxDistance:uv(this.maxDistance),minZoom:this.minZoom,maxZoom:uv(this.maxZoom),minPolarAngle:this.minPolarAngle,maxPolarAngle:uv(this.maxPolarAngle),minAzimuthAngle:uv(this.minAzimuthAngle),maxAzimuthAngle:uv(this.maxAzimuthAngle),smoothTime:this.smoothTime,draggingSmoothTime:this.draggingSmoothTime,dollySpeed:this.dollySpeed,truckSpeed:this.truckSpeed,dollyToCursor:this.dollyToCursor,target:this._targetEnd.toArray(),position:ni.setFromSpherical(this._sphericalEnd).add(this._targetEnd).toArray(),zoom:this._zoomEnd,focalOffset:this._focalOffsetEnd.toArray(),target0:this._target0.toArray(),position0:this._position0.toArray(),zoom0:this._zoom0,focalOffset0:this._focalOffset0.toArray()})}fromJSON(e,t=!1){const n=JSON.parse(e);this.enabled=n.enabled,this.minDistance=n.minDistance,this.maxDistance=hv(n.maxDistance),this.minZoom=n.minZoom,this.maxZoom=hv(n.maxZoom),this.minPolarAngle=n.minPolarAngle,this.maxPolarAngle=hv(n.maxPolarAngle),this.minAzimuthAngle=hv(n.minAzimuthAngle),this.maxAzimuthAngle=hv(n.maxAzimuthAngle),this.smoothTime=n.smoothTime,this.draggingSmoothTime=n.draggingSmoothTime,this.dollySpeed=n.dollySpeed,this.truckSpeed=n.truckSpeed,this.dollyToCursor=n.dollyToCursor,this._target0.fromArray(n.target0),this._position0.fromArray(n.position0),this._zoom0=n.zoom0,this._focalOffset0.fromArray(n.focalOffset0),this.moveTo(n.target[0],n.target[1],n.target[2],t),tc.setFromVector3(ni.fromArray(n.position).sub(this._targetEnd).applyQuaternion(this._yAxisUpSpace)),this.rotateTo(tc.theta,tc.phi,t),this.dollyTo(tc.radius,t),this.zoomTo(n.zoom,t),this.setFocalOffset(n.focalOffset[0],n.focalOffset[1],n.focalOffset[2],t),this._needsUpdate=!0}connect(e){if(this._domElement){console.warn("camera-controls is already connected.");return}e.setAttribute("data-camera-controls-version",Rde),this._addAllEventListeners(e),this._getClientRect(this._elementRect)}disconnect(){this.cancel(),this._removeAllEventListeners(),this._domElement&&(this._domElement.removeAttribute("data-camera-controls-version"),this._domElement=void 0)}dispose(){this.removeAllEventListeners(),this.disconnect()}_getTargetDirection(e){return e.setFromSpherical(this._spherical).divideScalar(this._spherical.radius).applyQuaternion(this._yAxisUpSpaceInverse)}_getCameraDirection(e){return this._getTargetDirection(e).negate()}_findPointerById(e){return this._activePointers.find(t=>t.pointerId===e)}_findPointerByMouseButton(e){return this._activePointers.find(t=>t.mouseButton===e)}_disposePointer(e){this._activePointers.splice(this._activePointers.indexOf(e),1)}_encloseToBoundary(e,t,n){const r=t.lengthSq();if(r===0)return e;const s=bi.copy(t).add(e),a=this._boundary.clampPoint(s,Vg).sub(s),l=a.lengthSq();if(l===0)return e.add(t);if(l===r)return e;if(n===0)return e.add(t).add(a);{const c=1+n*l/t.dot(a);return e.add(bi.copy(t).multiplyScalar(c)).add(a.multiplyScalar(1-n))}}_updateNearPlaneCorners(){if(Am(this._camera)){const e=this._camera,t=e.near,n=e.getEffectiveFOV()*cv,r=Math.tan(n*.5)*t,s=r*e.aspect;this._nearPlaneCorners[0].set(-s,-r,0),this._nearPlaneCorners[1].set(s,-r,0),this._nearPlaneCorners[2].set(s,r,0),this._nearPlaneCorners[3].set(-s,r,0)}else if(Dd(this._camera)){const e=this._camera,t=1/e.zoom,n=e.left*t,r=e.right*t,s=e.top*t,o=e.bottom*t;this._nearPlaneCorners[0].set(n,s,0),this._nearPlaneCorners[1].set(r,s,0),this._nearPlaneCorners[2].set(r,o,0),this._nearPlaneCorners[3].set(n,o,0)}}_collisionTest(){let e=1/0;if(!(this.colliderMeshes.length>=1)||Eb(this._camera,"_collisionTest"))return e;const n=this._getTargetDirection(fv);Tb.lookAt(A7,n,this._camera.up);for(let r=0;r<4;r++){const s=bi.copy(this._nearPlaneCorners[r]);s.applyMatrix4(Tb);const o=Vg.addVectors(this._target,s);V3.set(o,n),V3.far=this._spherical.radius+1;const a=V3.intersectObjects(this.colliderMeshes);a.length!==0&&a[0].distance<e&&(e=a[0].distance)}return e}_getClientRect(e){if(!this._domElement)return;const t=this._domElement.getBoundingClientRect();return e.x=t.left,e.y=t.top,this._viewport?(e.x+=this._viewport.x,e.y+=t.height-this._viewport.w-this._viewport.y,e.width=this._viewport.z,e.height=this._viewport.w):(e.width=t.width,e.height=t.height),e}_createOnRestPromise(e){return e?Promise.resolve():(this._hasRested=!1,this.dispatchEvent({type:"transitionstart"}),new Promise(t=>{const n=()=>{this.removeEventListener("rest",n),t()};this.addEventListener("rest",n)}))}_addAllEventListeners(e){}_removeAllEventListeners(){}get dampingFactor(){return console.warn(".dampingFactor has been deprecated. use smoothTime (in seconds) instead."),0}set dampingFactor(e){console.warn(".dampingFactor has been deprecated. use smoothTime (in seconds) instead.")}get draggingDampingFactor(){return console.warn(".draggingDampingFactor has been deprecated. use draggingSmoothTime (in seconds) instead."),0}set draggingDampingFactor(e){console.warn(".draggingDampingFactor has been deprecated. use draggingSmoothTime (in seconds) instead.")}static createBoundingSphere(e,t=new Nn.Sphere){const n=t,r=n.center;Wg.makeEmpty(),e.traverseVisible(o=>{o.isMesh&&Wg.expandByObject(o)}),Wg.getCenter(r);let s=0;return e.traverseVisible(o=>{if(!o.isMesh)return;const a=o;if(!a.geometry)return;const l=a.geometry.clone();l.applyMatrix4(a.matrixWorld);const u=l.attributes.position;for(let h=0,f=u.count;h<f;h++)ni.fromBufferAttribute(u,h),s=Math.max(s,r.distanceToSquared(ni))}),n.radius=Math.sqrt(s),n}};const Pde=w.forwardRef((i,e)=>{w.useMemo(()=>{const T={Box3:ti,MathUtils:{clamp:un.clamp},Matrix4:Xe,Quaternion:Xt,Raycaster:A0,Sphere:Bi,Spherical:e0,Vector2:Ue,Vector3:H,Vector4:Rn};bb.install({THREE:T}),Or({CameraControlsImpl:bb})},[]);const{camera:t,domElement:n,makeDefault:r,onStart:s,onEnd:o,onChange:a,regress:l,...c}=i,u=Ve(T=>T.camera),h=Ve(T=>T.gl),f=Ve(T=>T.invalidate),d=Ve(T=>T.events),m=Ve(T=>T.setEvents),A=Ve(T=>T.set),g=Ve(T=>T.get),y=Ve(T=>T.performance),E=t||u,x=n||d.connected||h.domElement,C=w.useMemo(()=>new bb(E),[E]);return Kt((T,I)=>{C.enabled&&C.update(I)},-1),w.useEffect(()=>(C.connect(x),()=>void C.disconnect()),[x,C]),w.useEffect(()=>{const T=L=>{f(),l&&y.regress(),a&&a(L)},I=L=>{s&&s(L)},M=L=>{o&&o(L)};return C.addEventListener("update",T),C.addEventListener("controlstart",I),C.addEventListener("controlend",M),C.addEventListener("control",T),C.addEventListener("transitionstart",T),C.addEventListener("wake",T),()=>{C.removeEventListener("update",T),C.removeEventListener("controlstart",I),C.removeEventListener("controlend",M),C.removeEventListener("control",T),C.removeEventListener("transitionstart",T),C.removeEventListener("wake",T)}},[C,s,o,f,m,l,a]),w.useEffect(()=>{if(r){const T=g().controls;return A({controls:C}),()=>A({controls:T})}},[r,C]),w.createElement("primitive",ot({ref:e,object:C},c))}),Bde=i=>(i==null?void 0:i.current)instanceof _n,dQ=w.createContext(null);function pQ(){const i=w.useContext(dQ);if(!i)throw new Error("useMotion hook must be used in a MotionPathControls component.");return i}function Dde({points:i=50,color:e="black"}){const{path:t}=pQ(),[n,r]=w.useState([]),s=w.useMemo(()=>new no({color:e}),[e]),o=w.useMemo(()=>new d0(.025,16,16),[]),a=w.useRef([]);return w.useEffect(()=>{t.curves!==a.current&&(r(t.getPoints(i)),a.current=t.curves)}),n.map((l,c)=>w.createElement("mesh",{key:c,material:s,geometry:o,position:[l.x,l.y,l.z]}))}const kde=w.forwardRef(({children:i,curves:e=[],debug:t=!1,debugColor:n="black",object:r,focus:s,loop:o=!0,offset:a=void 0,smooth:l=!1,eps:c=1e-5,damping:u=.1,focusDamping:h=.1,maxSpeed:f=1/0,...d},m)=>{const{camera:A}=Ve(),g=w.useRef(null),y=w.useRef(a??0),E=w.useMemo(()=>new F6,[]),x=w.useMemo(()=>({focus:s,object:(r==null?void 0:r.current)instanceof _n?r:{current:A},path:E,current:y.current,offset:y.current,point:new H,tangent:new H,next:new H}),[s,r]);w.useLayoutEffect(()=>{var T,I;E.curves=[];const M=e.length>0?e:(T=(I=g.current)==null||(I=I.__r3f)==null?void 0:I.objects)!==null&&T!==void 0?T:[];for(let L=0;L<M.length;L++)E.add(M[L]);if(l){const L=E.getPoints(typeof l=="number"?l:1),R=new Lw(L);E.curves=[R]}E.updateArcLengths()}),w.useImperativeHandle(m,()=>Object.assign(g.current,{motion:x}),[x]),w.useLayoutEffect(()=>{y.current=S3.repeat(y.current,1)},[a]);const C=w.useMemo(()=>new H,[]);return Kt((T,I)=>{const M=x.offset;if(iA.damp(y,"current",a!==void 0?a:x.current,u,I,f,void 0,c),x.offset=o?S3.repeat(y.current,1):S3.clamp(y.current,0,1),E.getCurveLengths().length>0){E.getPointAt(x.offset,x.point),E.getTangentAt(x.offset,x.tangent).normalize(),E.getPointAt(S3.repeat(y.current-(M-x.offset),1),x.next);const L=(r==null?void 0:r.current)instanceof _n?r.current:A;L.position.copy(x.point),s&&iA.dampLookAt(L,Bde(s)?s.current.getWorldPosition(C):s,h,I,f,void 0,c)}}),w.createElement("group",ot({ref:g},d),w.createElement(dQ.Provider,{value:x},i,t&&w.createElement(Dde,{color:n})))});function Fde({defaultScene:i,defaultCamera:e,renderPriority:t=1}){const{gl:n,scene:r,camera:s}=Ve();let o;return Kt(()=>{o=n.autoClear,t===1&&(n.autoClear=!0,n.render(i,e)),n.autoClear=!1,n.clearDepth(),n.render(r,s),n.autoClear=o},t),w.createElement("group",{onPointerOver:()=>null})}function mQ({children:i,renderPriority:e=1}){const{scene:t,camera:n}=Ve(),[r]=w.useState(()=>new Mu);return w.createElement(w.Fragment,null,vp(w.createElement(w.Fragment,null,i,w.createElement(Fde,{defaultScene:t,defaultCamera:n,renderPriority:e})),r,{events:{priority:e+1}}))}const gQ=w.createContext({}),f4=()=>w.useContext(gQ),Ode=2*Math.PI,Ib=new _n,_7=new Xe,[jg,Mb]=[new Xt,new Xt],S7=new H,w7=new H,Nde=i=>"minPolarAngle"in i,C7=i=>"getTarget"in i,Ude=({alignment:i="bottom-right",margin:e=[80,80],renderPriority:t=1,onUpdate:n,onTarget:r,children:s})=>{const o=Ve(I=>I.size),a=Ve(I=>I.camera),l=Ve(I=>I.controls),c=Ve(I=>I.invalidate),u=w.useRef(null),h=w.useRef(null),f=w.useRef(!1),d=w.useRef(0),m=w.useRef(new H(0,0,0)),A=w.useRef(new H(0,0,0));w.useEffect(()=>{A.current.copy(a.up),Ib.up.copy(a.up)},[a]);const g=w.useCallback(I=>{f.current=!0,(l||r)&&(m.current=(r==null?void 0:r())||(C7(l)?l.getTarget(m.current):l==null?void 0:l.target)),d.current=a.position.distanceTo(S7),jg.copy(a.quaternion),w7.copy(I).multiplyScalar(d.current).add(S7),Ib.lookAt(w7),Mb.copy(Ib.quaternion),c()},[l,a,r,c]);Kt((I,M)=>{if(h.current&&u.current){var L;if(f.current)if(jg.angleTo(Mb)<.01)f.current=!1,Nde(l)&&a.up.copy(A.current);else{const R=M*Ode;jg.rotateTowards(Mb,R),a.position.set(0,0,1).applyQuaternion(jg).multiplyScalar(d.current).add(m.current),a.up.set(0,1,0).applyQuaternion(jg).normalize(),a.quaternion.copy(jg),C7(l)&&l.setPosition(a.position.x,a.position.y,a.position.z),n?n():l&&l.update(M),c()}_7.copy(a.matrix).invert(),(L=u.current)==null||L.quaternion.setFromRotationMatrix(_7)}});const y=w.useMemo(()=>({tweenCamera:g}),[g]),[E,x]=e,C=i.endsWith("-center")?0:i.endsWith("-left")?-o.width/2+E:o.width/2-E,T=i.startsWith("center-")?0:i.startsWith("top-")?o.height/2-x:-o.height/2+x;return w.createElement(mQ,{renderPriority:t},w.createElement(gQ.Provider,{value:y},w.createElement(cQ,{makeDefault:!0,ref:h,position:[0,0,200]}),w.createElement("group",{ref:u,position:[C,T,0]},s)))},Nv={bg:"#f0f0f0",hover:"#999",text:"black",stroke:"black"},zde=["Right","Left","Top","Bottom","Front","Back"],AQ=i=>new H(...i).multiplyScalar(.38),Gde=[[1,1,1],[1,1,-1],[1,-1,1],[1,-1,-1],[-1,1,1],[-1,1,-1],[-1,-1,1],[-1,-1,-1]].map(AQ),Hde=[.25,.25,.25],yQ=[[1,1,0],[1,0,1],[1,0,-1],[1,-1,0],[0,1,1],[0,1,-1],[0,-1,1],[0,-1,-1],[-1,1,0],[-1,0,1],[-1,0,-1],[-1,-1,0]].map(AQ),Qde=yQ.map(i=>i.toArray().map(e=>e==0?.5:.25)),Vde=({hover:i,index:e,font:t="20px Inter var, Arial, sans-serif",faces:n=zde,color:r=Nv.bg,hoverColor:s=Nv.hover,textColor:o=Nv.text,strokeColor:a=Nv.stroke,opacity:l=1})=>{const c=Ve(h=>h.gl),u=w.useMemo(()=>{const h=document.createElement("canvas");h.width=128,h.height=128;const f=h.getContext("2d");return f.fillStyle=r,f.fillRect(0,0,h.width,h.height),f.strokeStyle=a,f.strokeRect(0,0,h.width,h.height),f.font=t,f.textAlign="center",f.fillStyle=o,f.fillText(n[e].toUpperCase(),64,76),new M6(h)},[e,n,t,r,o,a]);return w.createElement("meshBasicMaterial",{map:u,"map-anisotropy":c.capabilities.getMaxAnisotropy()||1,attach:`material-${e}`,color:i?s:"white",transparent:!0,opacity:l})},Wde=i=>{const{tweenCamera:e}=f4(),[t,n]=w.useState(null),r=a=>{a.stopPropagation(),n(null)},s=a=>{a.stopPropagation(),e(a.face.normal)},o=a=>{a.stopPropagation(),n(Math.floor(a.faceIndex/2))};return w.createElement("mesh",{onPointerOut:r,onPointerMove:o,onClick:i.onClick||s},[...Array(6)].map((a,l)=>w.createElement(Vde,ot({key:l,index:l,hover:t===l},i))),w.createElement("boxGeometry",null))},T7=({onClick:i,dimensions:e,position:t,hoverColor:n=Nv.hover})=>{const{tweenCamera:r}=f4(),[s,o]=w.useState(!1),a=u=>{u.stopPropagation(),o(!1)},l=u=>{u.stopPropagation(),o(!0)},c=u=>{u.stopPropagation(),r(t)};return w.createElement("mesh",{scale:1.01,position:t,onPointerOver:l,onPointerOut:a,onClick:i||c},w.createElement("meshBasicMaterial",{color:s?n:"white",transparent:!0,opacity:.6,visible:s}),w.createElement("boxGeometry",{args:e}))},jde=i=>w.createElement("group",{scale:[60,60,60]},w.createElement(Wde,i),yQ.map((e,t)=>w.createElement(T7,ot({key:t,position:e,dimensions:Qde[t]},i))),Gde.map((e,t)=>w.createElement(T7,ot({key:t,position:e,dimensions:Hde},i))));function Rb({scale:i=[.8,.05,.05],color:e,rotation:t}){return w.createElement("group",{rotation:t},w.createElement("mesh",{position:[.4,0,0]},w.createElement("boxGeometry",{args:i}),w.createElement("meshBasicMaterial",{color:e,toneMapped:!1})))}function Kg({onClick:i,font:e,disabled:t,arcStyle:n,label:r,labelColor:s,axisHeadScale:o=1,...a}){const l=Ve(A=>A.gl),c=w.useMemo(()=>{const A=document.createElement("canvas");A.width=64,A.height=64;const g=A.getContext("2d");return g.beginPath(),g.arc(32,32,16,0,2*Math.PI),g.closePath(),g.fillStyle=n,g.fill(),r&&(g.font=e,g.textAlign="center",g.fillStyle=s,g.fillText(r,32,41)),new M6(A)},[n,r,s,e]),[u,h]=w.useState(!1),f=(r?1:.75)*(u?1.2:1)*o,d=A=>{A.stopPropagation(),h(!0)},m=A=>{A.stopPropagation(),h(!1)};return w.createElement("sprite",ot({scale:f,onPointerOver:t?void 0:d,onPointerOut:t?void 0:i||m},a),w.createElement("spriteMaterial",{map:c,"map-anisotropy":l.capabilities.getMaxAnisotropy()||1,alphaTest:.3,opacity:r?1:.75,toneMapped:!1}))}const Kde=({hideNegativeAxes:i,hideAxisHeads:e,disabled:t,font:n="18px Inter var, Arial, sans-serif",axisColors:r=["#ff2060","#20df80","#2080ff"],axisHeadScale:s=1,axisScale:o,labels:a=["X","Y","Z"],labelColor:l="#000",onClick:c,...u})=>{const[h,f,d]=r,{tweenCamera:m}=f4(),A={font:n,disabled:t,labelColor:l,onClick:c,axisHeadScale:s,onPointerDown:t?void 0:g=>{m(g.object.position),g.stopPropagation()}};return w.createElement("group",ot({scale:40},u),w.createElement(Rb,{color:h,rotation:[0,0,0],scale:o}),w.createElement(Rb,{color:f,rotation:[0,0,Math.PI/2],scale:o}),w.createElement(Rb,{color:d,rotation:[0,-Math.PI/2,0],scale:o}),!e&&w.createElement(w.Fragment,null,w.createElement(Kg,ot({arcStyle:h,position:[1,0,0],label:a[0]},A)),w.createElement(Kg,ot({arcStyle:f,position:[0,1,0],label:a[1]},A)),w.createElement(Kg,ot({arcStyle:d,position:[0,0,1],label:a[2]},A)),!i&&w.createElement(w.Fragment,null,w.createElement(Kg,ot({arcStyle:h,position:[-1,0,0]},A)),w.createElement(Kg,ot({arcStyle:f,position:[0,-1,0]},A)),w.createElement(Kg,ot({arcStyle:d,position:[0,0,-1]},A)))))},$de=Ec({cellSize:.5,sectionSize:1,fadeDistance:100,fadeStrength:1,fadeFrom:1,cellThickness:.5,sectionThickness:1,cellColor:new ut,sectionColor:new ut,infiniteGrid:!1,followCamera:!1,worldCamProjPosition:new H,worldPlanePosition:new H},`
    varying vec3 localPosition;
    varying vec4 worldPosition;

    uniform vec3 worldCamProjPosition;
    uniform vec3 worldPlanePosition;
    uniform float fadeDistance;
    uniform bool infiniteGrid;
    uniform bool followCamera;

    void main() {
      localPosition = position.xzy;
      if (infiniteGrid) localPosition *= 1.0 + fadeDistance;
      
      worldPosition = modelMatrix * vec4(localPosition, 1.0);
      if (followCamera) {
        worldPosition.xyz += (worldCamProjPosition - worldPlanePosition);
        localPosition = (inverse(modelMatrix) * worldPosition).xyz;
      }

      gl_Position = projectionMatrix * viewMatrix * worldPosition;
    }
  `,`
    varying vec3 localPosition;
    varying vec4 worldPosition;

    uniform vec3 worldCamProjPosition;
    uniform float cellSize;
    uniform float sectionSize;
    uniform vec3 cellColor;
    uniform vec3 sectionColor;
    uniform float fadeDistance;
    uniform float fadeStrength;
    uniform float fadeFrom;
    uniform float cellThickness;
    uniform float sectionThickness;

    float getGrid(float size, float thickness) {
      vec2 r = localPosition.xz / size;
      vec2 grid = abs(fract(r - 0.5) - 0.5) / fwidth(r);
      float line = min(grid.x, grid.y) + 1.0 - thickness;
      return 1.0 - min(line, 1.0);
    }

    void main() {
      float g1 = getGrid(cellSize, cellThickness);
      float g2 = getGrid(sectionSize, sectionThickness);

      vec3 from = worldCamProjPosition*vec3(fadeFrom);
      float dist = distance(from, worldPosition.xyz);
      float d = 1.0 - min(dist / fadeDistance, 1.0);
      vec3 color = mix(cellColor, sectionColor, min(1.0, sectionThickness * g2));

      gl_FragColor = vec4(color, (g1 + g2) * pow(d, fadeStrength));
      gl_FragColor.a = mix(0.75 * gl_FragColor.a, gl_FragColor.a, g2);
      if (gl_FragColor.a <= 0.0) discard;

      #include <tonemapping_fragment>
      #include <${ea>=154?"colorspace_fragment":"encodings_fragment"}>
    }
  `),Yde=w.forwardRef(({args:i,cellColor:e="#000000",sectionColor:t="#2080ff",cellSize:n=.5,sectionSize:r=1,followCamera:s=!1,infiniteGrid:o=!1,fadeDistance:a=100,fadeStrength:l=1,fadeFrom:c=1,cellThickness:u=.5,sectionThickness:h=1,side:f=ys,...d},m)=>{Or({GridMaterial:$de});const A=w.useRef(null);w.useImperativeHandle(m,()=>A.current,[]);const g=new vo,y=new H(0,1,0),E=new H(0,0,0);Kt(T=>{g.setFromNormalAndCoplanarPoint(y,E).applyMatrix4(A.current.matrixWorld);const I=A.current.material,M=I.uniforms.worldCamProjPosition,L=I.uniforms.worldPlanePosition;g.projectPoint(T.camera.position,M.value),L.value.set(0,0,0).applyMatrix4(A.current.matrixWorld)});const x={cellSize:n,sectionSize:r,cellColor:e,sectionColor:t,cellThickness:u,sectionThickness:h},C={fadeDistance:a,fadeStrength:l,fadeFrom:c,infiniteGrid:o,followCamera:s};return w.createElement("mesh",ot({ref:A,frustumCulled:!1},d),w.createElement("gridMaterial",ot({transparent:!0,"extensions-derivatives":!0,side:f},x,C)),w.createElement("planeGeometry",{args:i}))});function RR(i,{path:e}){const[t]=cr(Vw,[i],n=>n.setPath(e));return t}RR.preload=(i,{path:e})=>cr.preload(Vw,[i],t=>t.setPath(e));function Xde({children:i,files:e,...t}){const n=RR(e,{...t});return w.createElement(w.Fragment,null,i==null?void 0:i(n))}function d4(i){return cr(CR,i)}d4.preload=i=>cr.preload(CR,i);d4.clear=i=>cr.clear(CR,i);function qde({path:i,...e}){const n=d4(i).children[0];return w.createElement(G2,ot({},e,{object:n}))}const vQ="https://cdn.jsdelivr.net/gh/pmndrs/drei-assets@master";function p4(i,e=`${vQ}/basis/`){const t=Ve(r=>r.gl),n=cr(bR,Q1(i)?Object.values(i):i,r=>{r.detectSupport(t),r.setTranscoderPath(e)});if(w.useEffect(()=>{(Array.isArray(n)?n:[n]).forEach(t.initTexture)},[t,n]),Q1(i)){const r=Object.keys(i),s={};return r.forEach(o=>Object.assign(s,{[o]:n[r.indexOf(o)]})),s}else return n}p4.preload=(i,e=`${vQ}/basis/`)=>cr.preload(bR,i,t=>{t.setTranscoderPath(e)});p4.clear=i=>cr.clear(bR,i);const Jde=({children:i,input:e,basisPath:t})=>{const n=p4(e,t);return w.createElement(w.Fragment,null,i==null?void 0:i(n))},Wt=Number.isFinite||function(i){return typeof i=="number"&&isFinite(i)},Zde=Number.isSafeInteger||function(i){return typeof i=="number"&&Math.abs(i)<=epe},epe=Number.MAX_SAFE_INTEGER||9007199254740991;let rn=(function(i){return i.NETWORK_ERROR="networkError",i.MEDIA_ERROR="mediaError",i.KEY_SYSTEM_ERROR="keySystemError",i.MUX_ERROR="muxError",i.OTHER_ERROR="otherError",i})({}),Ke=(function(i){return i.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",i.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",i.KEY_SYSTEM_NO_SESSION="keySystemNoSession",i.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",i.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",i.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",i.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",i.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",i.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",i.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",i.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR="keySystemDestroyMediaKeysError",i.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR="keySystemDestroyCloseSessionError",i.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR="keySystemDestroyRemoveSessionError",i.MANIFEST_LOAD_ERROR="manifestLoadError",i.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",i.MANIFEST_PARSING_ERROR="manifestParsingError",i.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",i.LEVEL_EMPTY_ERROR="levelEmptyError",i.LEVEL_LOAD_ERROR="levelLoadError",i.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",i.LEVEL_PARSING_ERROR="levelParsingError",i.LEVEL_SWITCH_ERROR="levelSwitchError",i.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",i.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",i.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",i.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",i.FRAG_LOAD_ERROR="fragLoadError",i.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",i.FRAG_DECRYPT_ERROR="fragDecryptError",i.FRAG_PARSING_ERROR="fragParsingError",i.FRAG_GAP="fragGap",i.REMUX_ALLOC_ERROR="remuxAllocError",i.KEY_LOAD_ERROR="keyLoadError",i.KEY_LOAD_TIMEOUT="keyLoadTimeOut",i.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",i.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",i.BUFFER_APPEND_ERROR="bufferAppendError",i.BUFFER_APPENDING_ERROR="bufferAppendingError",i.BUFFER_STALLED_ERROR="bufferStalledError",i.BUFFER_FULL_ERROR="bufferFullError",i.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",i.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",i.ASSET_LIST_LOAD_ERROR="assetListLoadError",i.ASSET_LIST_LOAD_TIMEOUT="assetListLoadTimeout",i.ASSET_LIST_PARSING_ERROR="assetListParsingError",i.INTERSTITIAL_ASSET_ITEM_ERROR="interstitialAssetItemError",i.INTERNAL_EXCEPTION="internalException",i.INTERNAL_ABORTED="aborted",i.ATTACH_MEDIA_ERROR="attachMediaError",i.UNKNOWN="unknown",i})({}),ae=(function(i){return i.MEDIA_ATTACHING="hlsMediaAttaching",i.MEDIA_ATTACHED="hlsMediaAttached",i.MEDIA_DETACHING="hlsMediaDetaching",i.MEDIA_DETACHED="hlsMediaDetached",i.MEDIA_ENDED="hlsMediaEnded",i.STALL_RESOLVED="hlsStallResolved",i.BUFFER_RESET="hlsBufferReset",i.BUFFER_CODECS="hlsBufferCodecs",i.BUFFER_CREATED="hlsBufferCreated",i.BUFFER_APPENDING="hlsBufferAppending",i.BUFFER_APPENDED="hlsBufferAppended",i.BUFFER_EOS="hlsBufferEos",i.BUFFERED_TO_END="hlsBufferedToEnd",i.BUFFER_FLUSHING="hlsBufferFlushing",i.BUFFER_FLUSHED="hlsBufferFlushed",i.MANIFEST_LOADING="hlsManifestLoading",i.MANIFEST_LOADED="hlsManifestLoaded",i.MANIFEST_PARSED="hlsManifestParsed",i.LEVEL_SWITCHING="hlsLevelSwitching",i.LEVEL_SWITCHED="hlsLevelSwitched",i.LEVEL_LOADING="hlsLevelLoading",i.LEVEL_LOADED="hlsLevelLoaded",i.LEVEL_UPDATED="hlsLevelUpdated",i.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",i.LEVELS_UPDATED="hlsLevelsUpdated",i.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",i.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",i.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",i.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",i.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",i.AUDIO_TRACK_UPDATED="hlsAudioTrackUpdated",i.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",i.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",i.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",i.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",i.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",i.SUBTITLE_TRACK_UPDATED="hlsSubtitleTrackUpdated",i.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",i.CUES_PARSED="hlsCuesParsed",i.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",i.INIT_PTS_FOUND="hlsInitPtsFound",i.FRAG_LOADING="hlsFragLoading",i.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",i.FRAG_LOADED="hlsFragLoaded",i.FRAG_DECRYPTED="hlsFragDecrypted",i.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",i.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",i.FRAG_PARSING_METADATA="hlsFragParsingMetadata",i.FRAG_PARSED="hlsFragParsed",i.FRAG_BUFFERED="hlsFragBuffered",i.FRAG_CHANGED="hlsFragChanged",i.FPS_DROP="hlsFpsDrop",i.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",i.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",i.ERROR="hlsError",i.DESTROYING="hlsDestroying",i.KEY_LOADING="hlsKeyLoading",i.KEY_LOADED="hlsKeyLoaded",i.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",i.BACK_BUFFER_REACHED="hlsBackBufferReached",i.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",i.ASSET_LIST_LOADING="hlsAssetListLoading",i.ASSET_LIST_LOADED="hlsAssetListLoaded",i.INTERSTITIALS_UPDATED="hlsInterstitialsUpdated",i.INTERSTITIALS_BUFFERED_TO_BOUNDARY="hlsInterstitialsBufferedToBoundary",i.INTERSTITIAL_ASSET_PLAYER_CREATED="hlsInterstitialAssetPlayerCreated",i.INTERSTITIAL_STARTED="hlsInterstitialStarted",i.INTERSTITIAL_ASSET_STARTED="hlsInterstitialAssetStarted",i.INTERSTITIAL_ASSET_ENDED="hlsInterstitialAssetEnded",i.INTERSTITIAL_ASSET_ERROR="hlsInterstitialAssetError",i.INTERSTITIAL_ENDED="hlsInterstitialEnded",i.INTERSTITIALS_PRIMARY_RESUMED="hlsInterstitialsPrimaryResumed",i.PLAYOUT_LIMIT_REACHED="hlsPlayoutLimitReached",i.EVENT_CUE_ENTER="hlsEventCueEnter",i})({});var ai={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},Yt={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};class $g{constructor(e,t=0,n=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=n}sample(e,t){const n=Math.pow(this.alpha_,e);this.estimate_=t*(1-n)+n*this.estimate_,this.totalWeight_+=e}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_}}class tpe{constructor(e,t,n,r=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=n,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new $g(e),this.fast_=new $g(t),this.defaultTTFB_=r,this.ttfb_=new $g(e)}update(e,t){const{slow_:n,fast_:r,ttfb_:s}=this;n.halfLife!==e&&(this.slow_=new $g(e,n.getEstimate(),n.getTotalWeight())),r.halfLife!==t&&(this.fast_=new $g(t,r.getEstimate(),r.getTotalWeight())),s.halfLife!==e&&(this.ttfb_=new $g(e,s.getEstimate(),s.getTotalWeight()))}sample(e,t){e=Math.max(e,this.minDelayMs_);const n=8*t,r=e/1e3,s=n/r;this.fast_.sample(r,s),this.slow_.sample(r,s)}sampleTTFB(e){const t=e/1e3,n=Math.sqrt(2)*Math.exp(-Math.pow(t,2)/2);this.ttfb_.sample(n,Math.max(e,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}get defaultEstimate(){return this.defaultEstimate_}destroy(){}}function npe(i,e,t){return(e=rpe(e))in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function er(){return er=Object.assign?Object.assign.bind():function(i){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)({}).hasOwnProperty.call(t,n)&&(i[n]=t[n])}return i},er.apply(null,arguments)}function b7(i,e){var t=Object.keys(i);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(i);e&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(i,r).enumerable})),t.push.apply(t,n)}return t}function Qi(i){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?b7(Object(t),!0).forEach(function(n){npe(i,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(t)):b7(Object(t)).forEach(function(n){Object.defineProperty(i,n,Object.getOwnPropertyDescriptor(t,n))})}return i}function ipe(i,e){if(typeof i!="object"||!i)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var n=t.call(i,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}function rpe(i){var e=ipe(i,"string");return typeof e=="symbol"?e:e+""}class _c{constructor(e,t){this.trace=void 0,this.debug=void 0,this.log=void 0,this.warn=void 0,this.info=void 0,this.error=void 0;const n=`[${e}]:`;this.trace=kd,this.debug=t.debug.bind(null,n),this.log=t.log.bind(null,n),this.warn=t.warn.bind(null,n),this.info=t.info.bind(null,n),this.error=t.error.bind(null,n)}}const kd=function(){},spe={trace:kd,debug:kd,log:kd,warn:kd,info:kd,error:kd};function f5(){return er({},spe)}function ope(i,e){const t=self.console[i];return t?t.bind(self.console,`${e?"["+e+"] ":""}[${i}] >`):kd}function I7(i,e,t){return e[i]?e[i].bind(e):ope(i,t)}const d5=f5();function ape(i,e,t){const n=f5();if(typeof console=="object"&&i===!0||typeof i=="object"){const r=["debug","log","info","warn","error"];r.forEach(s=>{n[s]=I7(s,i,t)});try{n.log(`Debug logs enabled for "${e}" in hls.js version 1.6.15`)}catch{return f5()}r.forEach(s=>{d5[s]=I7(s,i)})}else er(d5,n);return n}const Ki=d5;function Uf(i=!0){return typeof self>"u"?void 0:(i||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}function lpe(i){return typeof self<"u"&&i===self.ManagedMediaSource}function xQ(i,e){const t=Object.keys(i),n=Object.keys(e),r=t.length,s=n.length;return!r||!s||r===s&&!t.some(o=>n.indexOf(o)===-1)}function Pl(i,e=!1){if(typeof TextDecoder<"u"){const c=new TextDecoder("utf-8").decode(i);if(e){const u=c.indexOf("\0");return u!==-1?c.substring(0,u):c}return c.replace(/\0/g,"")}const t=i.length;let n,r,s,o="",a=0;for(;a<t;){if(n=i[a++],n===0&&e)return o;if(n===0||n===3)continue;switch(n>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:o+=String.fromCharCode(n);break;case 12:case 13:r=i[a++],o+=String.fromCharCode((n&31)<<6|r&63);break;case 14:r=i[a++],s=i[a++],o+=String.fromCharCode((n&15)<<12|(r&63)<<6|(s&63)<<0);break}}return o}function Oo(i){let e="";for(let t=0;t<i.length;t++){let n=i[t].toString(16);n.length<2&&(n="0"+n),e+=n}return e}function EQ(i){return Uint8Array.from(i.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}function cpe(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var Lb={exports:{}},M7;function upe(){return M7||(M7=1,(function(i,e){(function(t){var n=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,r=/^(?=([^\/?#]*))\1([^]*)$/,s=/(?:\/|^)\.(?=\/)/g,o=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,a={buildAbsoluteURL:function(l,c,u){if(u=u||{},l=l.trim(),c=c.trim(),!c){if(!u.alwaysNormalize)return l;var h=a.parseURL(l);if(!h)throw new Error("Error trying to parse base URL.");return h.path=a.normalizePath(h.path),a.buildURLFromParts(h)}var f=a.parseURL(c);if(!f)throw new Error("Error trying to parse relative URL.");if(f.scheme)return u.alwaysNormalize?(f.path=a.normalizePath(f.path),a.buildURLFromParts(f)):c;var d=a.parseURL(l);if(!d)throw new Error("Error trying to parse base URL.");if(!d.netLoc&&d.path&&d.path[0]!=="/"){var m=r.exec(d.path);d.netLoc=m[1],d.path=m[2]}d.netLoc&&!d.path&&(d.path="/");var A={scheme:d.scheme,netLoc:f.netLoc,path:null,params:f.params,query:f.query,fragment:f.fragment};if(!f.netLoc&&(A.netLoc=d.netLoc,f.path[0]!=="/"))if(!f.path)A.path=d.path,f.params||(A.params=d.params,f.query||(A.query=d.query));else{var g=d.path,y=g.substring(0,g.lastIndexOf("/")+1)+f.path;A.path=a.normalizePath(y)}return A.path===null&&(A.path=u.alwaysNormalize?a.normalizePath(f.path):f.path),a.buildURLFromParts(A)},parseURL:function(l){var c=n.exec(l);return c?{scheme:c[1]||"",netLoc:c[2]||"",path:c[3]||"",params:c[4]||"",query:c[5]||"",fragment:c[6]||""}:null},normalizePath:function(l){for(l=l.split("").reverse().join("").replace(s,"");l.length!==(l=l.replace(o,"")).length;);return l.split("").reverse().join("")},buildURLFromParts:function(l){return l.scheme+l.netLoc+l.path+l.params+l.query+l.fragment}};i.exports=a})()})(Lb)),Lb.exports}var LR=upe();class m4{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var ar={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"};class PR{constructor(e){this._byteRange=null,this._url=null,this._stats=null,this._streams=null,this.base=void 0,this.relurl=void 0,typeof e=="string"&&(e={url:e}),this.base=e,hpe(this,"stats")}setByteRange(e,t){const n=e.split("@",2);let r;n.length===1?r=(t==null?void 0:t.byteRangeEndOffset)||0:r=parseInt(n[1]),this._byteRange=[r,parseInt(n[0])+r]}get baseurl(){return this.base.url}get byteRange(){return this._byteRange===null?[]:this._byteRange}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get elementaryStreams(){return this._streams===null&&(this._streams={[ar.AUDIO]:null,[ar.VIDEO]:null,[ar.AUDIOVIDEO]:null}),this._streams}set elementaryStreams(e){this._streams=e}get hasStats(){return this._stats!==null}get hasStreams(){return this._streams!==null}get stats(){return this._stats===null&&(this._stats=new m4),this._stats}set stats(e){this._stats=e}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=LR.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(e){this._url=e}clearElementaryStreamInfo(){const{elementaryStreams:e}=this;e[ar.AUDIO]=null,e[ar.VIDEO]=null,e[ar.AUDIOVIDEO]=null}}function As(i){return i.sn!=="initSegment"}class J_ extends PR{constructor(e,t){super(t),this._decryptdata=null,this._programDateTime=null,this._ref=null,this._bitrate=void 0,this.rawProgramDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.playlistOffset=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.urlId=0,this.type=e}get byteLength(){if(this.hasStats){const e=this.stats.total;if(e)return e}if(this.byteRange.length){const e=this.byteRange[0],t=this.byteRange[1];if(Wt(e)&&Wt(t))return t-e}return null}get bitrate(){return this.byteLength?this.byteLength*8/this.duration:this._bitrate?this._bitrate:null}set bitrate(e){this._bitrate=e}get decryptdata(){var e;const{levelkeys:t}=this;if(!t||t.NONE)return null;if(t.identity)this._decryptdata||(this._decryptdata=t.identity.getDecryptData(this.sn));else if(!((e=this._decryptdata)!=null&&e.keyId)){const n=Object.keys(t);if(n.length===1){const r=this._decryptdata=t[n[0]]||null;r&&(this._decryptdata=r.getDecryptData(this.sn,t))}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(this.programDateTime===null)return null;const e=Wt(this.duration)?this.duration:0;return this.programDateTime+e*1e3}get encrypted(){var e;if((e=this._decryptdata)!=null&&e.encrypted)return!0;if(this.levelkeys){var t;const n=Object.keys(this.levelkeys),r=n.length;if(r>1||r===1&&(t=this.levelkeys[n[0]])!=null&&t.encrypted)return!0}return!1}get programDateTime(){return this._programDateTime===null&&this.rawProgramDateTime&&(this.programDateTime=Date.parse(this.rawProgramDateTime)),this._programDateTime}set programDateTime(e){if(!Wt(e)){this._programDateTime=this.rawProgramDateTime=null;return}this._programDateTime=e}get ref(){return As(this)?(this._ref||(this._ref={base:this.base,start:this.start,duration:this.duration,sn:this.sn,programDateTime:this.programDateTime}),this._ref):null}addStart(e){this.setStart(this.start+e)}setStart(e){this.start=e,this._ref&&(this._ref.start=e)}setDuration(e){this.duration=e,this._ref&&(this._ref.duration=e)}setKeyFormat(e){const t=this.levelkeys;if(t){var n;const r=t[e];r&&!((n=this._decryptdata)!=null&&n.keyId)&&(this._decryptdata=r.getDecryptData(this.sn,t))}}abortRequests(){var e,t;(e=this.loader)==null||e.abort(),(t=this.keyLoader)==null||t.abort()}setElementaryStreamInfo(e,t,n,r,s,o=!1){const{elementaryStreams:a}=this,l=a[e];if(!l){a[e]={startPTS:t,endPTS:n,startDTS:r,endDTS:s,partial:o};return}l.startPTS=Math.min(l.startPTS,t),l.endPTS=Math.max(l.endPTS,n),l.startDTS=Math.min(l.startDTS,r),l.endDTS=Math.max(l.endDTS,s)}}class _Q extends PR{constructor(e,t,n,r,s){super(n),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.duration=e.decimalFloatingPoint("DURATION"),this.gap=e.bool("GAP"),this.independent=e.bool("INDEPENDENT"),this.relurl=e.enumeratedString("URI"),this.fragment=t,this.index=r;const o=e.enumeratedString("BYTERANGE");o&&this.setByteRange(o,s),s&&(this.fragOffset=s.fragOffset+s.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:e}=this;return!!(e.audio||e.video||e.audiovideo)}}function SQ(i,e){const t=Object.getPrototypeOf(i);if(t){const n=Object.getOwnPropertyDescriptor(t,e);return n||SQ(t,e)}}function hpe(i,e){const t=SQ(i,e);t&&(t.enumerable=!0,Object.defineProperty(i,e,t))}const R7=Math.pow(2,32)-1,fpe=[].push,wQ={video:1,audio:2,id3:3,text:4};function Js(i){return String.fromCharCode.apply(null,i)}function CQ(i,e){const t=i[e]<<8|i[e+1];return t<0?65536+t:t}function Gn(i,e){const t=TQ(i,e);return t<0?4294967296+t:t}function L7(i,e){let t=Gn(i,e);return t*=Math.pow(2,32),t+=Gn(i,e+4),t}function TQ(i,e){return i[e]<<24|i[e+1]<<16|i[e+2]<<8|i[e+3]}function dpe(i){const e=i.byteLength;for(let t=0;t<e;){const n=Gn(i,t);if(n>8&&i[t+4]===109&&i[t+5]===111&&i[t+6]===111&&i[t+7]===102)return!0;t=n>1?t+n:e}return!1}function si(i,e){const t=[];if(!e.length)return t;const n=i.byteLength;for(let r=0;r<n;){const s=Gn(i,r),o=Js(i.subarray(r+4,r+8)),a=s>1?r+s:n;if(o===e[0])if(e.length===1)t.push(i.subarray(r+8,a));else{const l=si(i.subarray(r+8,a),e.slice(1));l.length&&fpe.apply(t,l)}r=a}return t}function ppe(i){const e=[],t=i[0];let n=8;const r=Gn(i,n);n+=4;let s=0,o=0;t===0?(s=Gn(i,n),o=Gn(i,n+4),n+=8):(s=L7(i,n),o=L7(i,n+8),n+=16),n+=2;let a=i.length+o;const l=CQ(i,n);n+=2;for(let c=0;c<l;c++){let u=n;const h=Gn(i,u);u+=4;const f=h&2147483647;if((h&2147483648)>>>31===1)return Ki.warn("SIDX has hierarchical references (not supported)"),null;const m=Gn(i,u);u+=4,e.push({referenceSize:f,subsegmentDuration:m,info:{duration:m/r,start:a,end:a+f-1}}),a+=f,u+=4,n=u}return{earliestPresentationTime:s,timescale:r,version:t,referencesCount:l,references:e}}function bQ(i){const e=[],t=si(i,["moov","trak"]);for(let r=0;r<t.length;r++){const s=t[r],o=si(s,["tkhd"])[0];if(o){let a=o[0];const l=Gn(o,a===0?12:20),c=si(s,["mdia","mdhd"])[0];if(c){a=c[0];const u=Gn(c,a===0?12:20),h=si(s,["mdia","hdlr"])[0];if(h){const f=Js(h.subarray(8,12)),d={soun:ar.AUDIO,vide:ar.VIDEO}[f],m=si(s,["mdia","minf","stbl","stsd"])[0],A=mpe(m);d?(e[l]={timescale:u,type:d,stsd:A},e[d]=Qi({timescale:u,id:l},A)):e[l]={timescale:u,type:f,stsd:A}}}}}return si(i,["moov","mvex","trex"]).forEach(r=>{const s=Gn(r,4),o=e[s];o&&(o.default={duration:Gn(r,12),flags:Gn(r,20)})}),e}function mpe(i){const e=i.subarray(8),t=e.subarray(86),n=Js(e.subarray(4,8));let r=n,s;const o=n==="enca"||n==="encv";if(o){const c=si(e,[n])[0].subarray(n==="enca"?28:78);si(c,["sinf"]).forEach(h=>{const f=si(h,["schm"])[0];if(f){const d=Js(f.subarray(4,8));if(d==="cbcs"||d==="cenc"){const m=si(h,["frma"])[0];m&&(r=Js(m))}}})}const a=r;switch(r){case"avc1":case"avc2":case"avc3":case"avc4":{const l=si(t,["avcC"])[0];l&&l.length>3&&(r+="."+j3(l[1])+j3(l[2])+j3(l[3]),s=W3(a==="avc1"?"dva1":"dvav",t));break}case"mp4a":{const l=si(e,[n])[0],c=si(l.subarray(28),["esds"])[0];if(c&&c.length>7){let u=4;if(c[u++]!==3)break;u=Pb(c,u),u+=2;const h=c[u++];if(h&128&&(u+=2),h&64&&(u+=c[u++]),c[u++]!==4)break;u=Pb(c,u);const f=c[u++];if(f===64)r+="."+j3(f);else break;if(u+=12,c[u++]!==5)break;u=Pb(c,u);const d=c[u++];let m=(d&248)>>3;m===31&&(m+=1+((d&7)<<3)+((c[u]&224)>>5)),r+="."+m}break}case"hvc1":case"hev1":{const l=si(t,["hvcC"])[0];if(l&&l.length>12){const c=l[1],u=["","A","B","C"][c>>6],h=c&31,f=Gn(l,2),d=(c&32)>>5?"H":"L",m=l[12],A=l.subarray(6,12);r+="."+u+h,r+="."+gpe(f).toString(16).toUpperCase(),r+="."+d+m;let g="";for(let y=A.length;y--;){const E=A[y];(E||g)&&(g="."+E.toString(16).toUpperCase()+g)}r+=g}s=W3(a=="hev1"?"dvhe":"dvh1",t);break}case"dvh1":case"dvhe":case"dvav":case"dva1":case"dav1":{r=W3(r,t)||r;break}case"vp09":{const l=si(t,["vpcC"])[0];if(l&&l.length>6){const c=l[4],u=l[5],h=l[6]>>4&15;r+="."+lh(c)+"."+lh(u)+"."+lh(h)}break}case"av01":{const l=si(t,["av1C"])[0];if(l&&l.length>2){const c=l[1]>>>5,u=l[1]&31,h=l[2]>>>7?"H":"M",f=(l[2]&64)>>6,d=(l[2]&32)>>5,m=c===2&&f?d?12:10:f?10:8,A=(l[2]&16)>>4,g=(l[2]&8)>>3,y=(l[2]&4)>>2,E=l[2]&3;r+="."+c+"."+lh(u)+h+"."+lh(m)+"."+A+"."+g+y+E+"."+lh(1)+"."+lh(1)+"."+lh(1)+"."+0,s=W3("dav1",t)}break}}return{codec:r,encrypted:o,supplemental:s}}function W3(i,e){const t=si(e,["dvvC"]),n=t.length?t[0]:si(e,["dvcC"])[0];if(n){const r=n[2]>>1&127,s=n[2]<<5&32|n[3]>>3&31;return i+"."+lh(r)+"."+lh(s)}}function gpe(i){let e=0;for(let t=0;t<32;t++)e|=(i>>t&1)<<31-t;return e>>>0}function Pb(i,e){const t=e+5;for(;i[e++]&128&&e<t;);return e}function j3(i){return("0"+i.toString(16).toUpperCase()).slice(-2)}function lh(i){return(i<10?"0":"")+i}function Ape(i,e){if(!i||!e)return;const t=e.keyId;t&&e.isCommonEncryption&&IQ(i,(n,r)=>{const s=n.subarray(8,24);s.some(o=>o!==0)||(Ki.log(`[eme] Patching keyId in 'enc${r?"a":"v"}>sinf>>tenc' box: ${Oo(s)} -> ${Oo(t)}`),n.set(t,8))})}function ype(i){const e=[];return IQ(i,t=>e.push(t.subarray(8,24))),e}function IQ(i,e){si(i,["moov","trak"]).forEach(n=>{const r=si(n,["mdia","minf","stbl","stsd"])[0];if(!r)return;const s=r.subarray(8);let o=si(s,["enca"]);const a=o.length>0;a||(o=si(s,["encv"])),o.forEach(l=>{const c=a?l.subarray(28):l.subarray(78);si(c,["sinf"]).forEach(h=>{const f=MQ(h);f&&e(f,a)})})})}function MQ(i){const e=si(i,["schm"])[0];if(e){const t=Js(e.subarray(4,8));if(t==="cbcs"||t==="cenc"){const n=si(i,["schi","tenc"])[0];if(n)return n}}}function vpe(i,e,t){const n={},r=si(i,["moof","traf"]);for(let s=0;s<r.length;s++){const o=r[s],a=si(o,["tfhd"])[0],l=Gn(a,4),c=e[l];if(!c)continue;n[l]||(n[l]={start:NaN,duration:0,sampleCount:0,timescale:c.timescale,type:c.type});const u=n[l],h=si(o,["tfdt"])[0];if(h){const x=h[0];let C=Gn(h,4);x===1&&(C===R7?t.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"):(C*=R7+1,C+=Gn(h,8))),Wt(C)&&(!Wt(u.start)||C<u.start)&&(u.start=C)}const f=c.default,d=Gn(a,0)|(f==null?void 0:f.flags);let m=(f==null?void 0:f.duration)||0;d&8&&(d&2?m=Gn(a,12):m=Gn(a,8));const A=si(o,["trun"]);let g=u.start||0,y=0,E=m;for(let x=0;x<A.length;x++){const C=A[x],T=Gn(C,4),I=u.sampleCount;u.sampleCount+=T;const M=C[3]&1,L=C[3]&4,R=C[2]&1,P=C[2]&2,F=C[2]&4,k=C[2]&8;let z=8,U=T;for(M&&(z+=4),L&&T&&(!(C[z+1]&1)&&u.keyFrameIndex===void 0&&(u.keyFrameIndex=I),z+=4,R?(E=Gn(C,z),z+=4):E=m,P&&(z+=4),k&&(z+=4),g+=E,y+=E,U--);U--;)R?(E=Gn(C,z),z+=4):E=m,P&&(z+=4),F&&(C[z+1]&1||u.keyFrameIndex===void 0&&(u.keyFrameIndex=u.sampleCount-(U+1),u.keyFrameStart=g),z+=4),k&&(z+=4),g+=E,y+=E;!y&&m&&(y+=m*T)}u.duration+=y}if(!Object.keys(n).some(s=>n[s].duration)){let s=1/0,o=0;const a=si(i,["sidx"]);for(let l=0;l<a.length;l++){const c=ppe(a[l]);if(c!=null&&c.references){s=Math.min(s,c.earliestPresentationTime/c.timescale);const u=c.references.reduce((h,f)=>h+f.info.duration||0,0);o=Math.max(o,u+c.earliestPresentationTime/c.timescale)}}o&&Wt(o)&&Object.keys(n).forEach(l=>{n[l].duration||(n[l].duration=o*n[l].timescale-n[l].start)})}return n}function xpe(i){const e={valid:null,remainder:null},t=si(i,["moof"]);if(t.length<2)return e.remainder=i,e;const n=t[t.length-1];return e.valid=i.slice(0,n.byteOffset-8),e.remainder=i.slice(n.byteOffset-8),e}function Ac(i,e){const t=new Uint8Array(i.length+e.length);return t.set(i),t.set(e,i.length),t}function P7(i,e){const t=[],n=e.samples,r=e.timescale,s=e.id;let o=!1;return si(n,["moof"]).map(l=>{const c=l.byteOffset-8;si(l,["traf"]).map(h=>{const f=si(h,["tfdt"]).map(d=>{const m=d[0];let A=Gn(d,4);return m===1&&(A*=Math.pow(2,32),A+=Gn(d,8)),A/r})[0];return f!==void 0&&(i=f),si(h,["tfhd"]).map(d=>{const m=Gn(d,4),A=Gn(d,0)&16777215,g=(A&1)!==0,y=(A&2)!==0,E=(A&8)!==0;let x=0;const C=(A&16)!==0;let T=0;const I=(A&32)!==0;let M=8;m===s&&(g&&(M+=8),y&&(M+=4),E&&(x=Gn(d,M),M+=4),C&&(T=Gn(d,M),M+=4),I&&(M+=4),e.type==="video"&&(o=g4(e.codec)),si(h,["trun"]).map(L=>{const R=L[0],P=Gn(L,0)&16777215,F=(P&1)!==0;let k=0;const z=(P&4)!==0,U=(P&256)!==0;let W=0;const $=(P&512)!==0;let oe=0;const X=(P&1024)!==0,Q=(P&2048)!==0;let Y=0;const O=Gn(L,4);let K=8;F&&(k=Gn(L,K),K+=4),z&&(K+=4);let te=k+c;for(let q=0;q<O;q++){if(U?(W=Gn(L,K),K+=4):W=x,$?(oe=Gn(L,K),K+=4):oe=T,X&&(K+=4),Q&&(R===0?Y=Gn(L,K):Y=TQ(L,K),K+=4),e.type===ar.VIDEO){let J=0;for(;J<oe;){const ie=Gn(n,te);if(te+=4,Epe(o,n[te])){const re=n.subarray(te,te+ie);BR(re,o?2:1,i+Y/r,t)}te+=ie,J+=ie+4}}i+=W/r}}))})})}),t}function g4(i){if(!i)return!1;const e=i.substring(0,4);return e==="hvc1"||e==="hev1"||e==="dvh1"||e==="dvhe"}function Epe(i,e){if(i){const t=e>>1&63;return t===39||t===40}else return(e&31)===6}function BR(i,e,t,n){const r=RQ(i);let s=0;s+=e;let o=0,a=0,l=0;for(;s<r.length;){o=0;do{if(s>=r.length)break;l=r[s++],o+=l}while(l===255);a=0;do{if(s>=r.length)break;l=r[s++],a+=l}while(l===255);const c=r.length-s;let u=s;if(a<c)s+=a;else if(a>c){Ki.error(`Malformed SEI payload. ${a} is too small, only ${c} bytes left to parse.`);break}if(o===4){if(r[u++]===181){const f=CQ(r,u);if(u+=2,f===49){const d=Gn(r,u);if(u+=4,d===1195456820){const m=r[u++];if(m===3){const A=r[u++],g=31&A,y=64&A,E=y?2+g*3:0,x=new Uint8Array(E);if(y){x[0]=A;for(let C=1;C<E;C++)x[C]=r[u++]}n.push({type:m,payloadType:o,pts:t,bytes:x})}}}}}else if(o===5&&a>16){const h=[];for(let m=0;m<16;m++){const A=r[u++].toString(16);h.push(A.length==1?"0"+A:A),(m===3||m===5||m===7||m===9)&&h.push("-")}const f=a-16,d=new Uint8Array(f);for(let m=0;m<f;m++)d[m]=r[u++];n.push({payloadType:o,pts:t,uuid:h.join(""),userData:Pl(d),userDataBytes:d})}}}function RQ(i){const e=i.byteLength,t=[];let n=1;for(;n<e-2;)i[n]===0&&i[n+1]===0&&i[n+2]===3?(t.push(n+2),n+=2):n++;if(t.length===0)return i;const r=e-t.length,s=new Uint8Array(r);let o=0;for(n=0;n<r;o++,n++)o===t[0]&&(o++,t.shift()),s[n]=i[o];return s}function _pe(i){const e=i[0];let t="",n="",r=0,s=0,o=0,a=0,l=0,c=0;if(e===0){for(;Js(i.subarray(c,c+1))!=="\0";)t+=Js(i.subarray(c,c+1)),c+=1;for(t+=Js(i.subarray(c,c+1)),c+=1;Js(i.subarray(c,c+1))!=="\0";)n+=Js(i.subarray(c,c+1)),c+=1;n+=Js(i.subarray(c,c+1)),c+=1,r=Gn(i,12),s=Gn(i,16),a=Gn(i,20),l=Gn(i,24),c=28}else if(e===1){c+=4,r=Gn(i,c),c+=4;const h=Gn(i,c);c+=4;const f=Gn(i,c);for(c+=4,o=2**32*h+f,Zde(o)||(o=Number.MAX_SAFE_INTEGER,Ki.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),a=Gn(i,c),c+=4,l=Gn(i,c),c+=4;Js(i.subarray(c,c+1))!=="\0";)t+=Js(i.subarray(c,c+1)),c+=1;for(t+=Js(i.subarray(c,c+1)),c+=1;Js(i.subarray(c,c+1))!=="\0";)n+=Js(i.subarray(c,c+1)),c+=1;n+=Js(i.subarray(c,c+1)),c+=1}const u=i.subarray(c,i.byteLength);return{schemeIdUri:t,value:n,timeScale:r,presentationTime:o,presentationTimeDelta:s,eventDuration:a,id:l,payload:u}}function Spe(i,...e){const t=e.length;let n=8,r=t;for(;r--;)n+=e[r].byteLength;const s=new Uint8Array(n);for(s[0]=n>>24&255,s[1]=n>>16&255,s[2]=n>>8&255,s[3]=n&255,s.set(i,4),r=0,n=8;r<t;r++)s.set(e[r],n),n+=e[r].byteLength;return s}function wpe(i,e,t){if(i.byteLength!==16)throw new RangeError("Invalid system id");let n,r;n=0,r=new Uint8Array;let s;n>0?(s=new Uint8Array(4),e.length>0&&new DataView(s.buffer).setUint32(0,e.length,!1)):s=new Uint8Array;const o=new Uint8Array(4);return t.byteLength>0&&new DataView(o.buffer).setUint32(0,t.byteLength,!1),Spe([112,115,115,104],new Uint8Array([n,0,0,0]),i,s,r,o,t)}function Cpe(i){const e=[];if(i instanceof ArrayBuffer){const t=i.byteLength;let n=0;for(;n+32<t;){const r=new DataView(i,n),s=Tpe(r);e.push(s),n+=s.size}}return e}function Tpe(i){const e=i.getUint32(0),t=i.byteOffset,n=i.byteLength;if(n<e)return{offset:t,size:n};if(i.getUint32(4)!==1886614376)return{offset:t,size:e};const s=i.getUint32(8)>>>24;if(s!==0&&s!==1)return{offset:t,size:e};const o=i.buffer,a=Oo(new Uint8Array(o,t+12,16));let l=null,c=null,u=0;if(s===0)u=28;else{const f=i.getUint32(28);if(!f||n<32+f*16)return{offset:t,size:e};l=[];for(let d=0;d<f;d++)l.push(new Uint8Array(o,t+32+d*16,16));u=32+f*16}if(!u)return{offset:t,size:e};const h=i.getUint32(u);return e-32<h?{offset:t,size:e}:(c=new Uint8Array(o,t+u+4,h),{version:s,systemId:a,kids:l,data:c,offset:t,size:e})}const LQ=()=>/\(Windows.+Firefox\//i.test(navigator.userAgent),oA={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,dav1:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function DR(i,e){const t=oA[e];return!!t&&!!t[i.slice(0,4)]}function H2(i,e,t=!0){return!i.split(",").some(n=>!kR(n,e,t))}function kR(i,e,t=!0){var n;const r=Uf(t);return(n=r==null?void 0:r.isTypeSupported(Q2(i,e)))!=null?n:!1}function Q2(i,e){return`${e}/mp4;codecs=${i}`}function B7(i){if(i){const e=i.substring(0,4);return oA.video[e]}return 2}function zS(i){const e=LQ();return i.split(",").reduce((t,n)=>{const s=e&&g4(n)?9:oA.video[n];return s?(s*2+t)/(t?3:2):(oA.audio[n]+t)/(t?2:1)},0)}const Bb={};function bpe(i,e=!0){if(Bb[i])return Bb[i];const t={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"],"mp4a.40.34":["mp3"]}[i];for(let r=0;r<t.length;r++){var n;if(kR(t[r],"audio",e))return Bb[i]=t[r],t[r];if(t[r]==="mp3"&&(n=Uf(e))!=null&&n.isTypeSupported("audio/mpeg"))return""}return i}const Ipe=/flac|opus|mp4a\.40\.34/i;function GS(i,e=!0){return i.replace(Ipe,t=>bpe(t.toLowerCase(),e))}function Mpe(i,e){const t=[];if(i){const n=i.split(",");for(let r=0;r<n.length;r++)DR(n[r],"video")||t.push(n[r])}return e&&t.push(e),t.join(",")}function Z_(i,e){if(i&&(i.length>4||["ac-3","ec-3","alac","fLaC","Opus"].indexOf(i)!==-1)&&(D7(i,"audio")||D7(i,"video")))return i;if(e){const t=e.split(",");if(t.length>1){if(i){for(let n=t.length;n--;)if(t[n].substring(0,4)===i.substring(0,4))return t[n]}return t[0]}}return e||i}function D7(i,e){return DR(i,e)&&kR(i,e)}function Rpe(i){const e=i.split(",");for(let t=0;t<e.length;t++){const n=e[t].split(".");n.length>2&&n[0]==="avc1"&&(e[t]=`avc1.${parseInt(n[1]).toString(16)}${("000"+parseInt(n[2]).toString(16)).slice(-4)}`)}return e.join(",")}function Lpe(i){if(i.startsWith("av01.")){const e=i.split("."),t=["0","111","01","01","01","0"];for(let n=e.length;n>4&&n<10;n++)e[n]=t[n-4];return e.join(".")}return i}function k7(i){const e=Uf(i)||{isTypeSupported:()=>!1};return{mpeg:e.isTypeSupported("audio/mpeg"),mp3:e.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:e.isTypeSupported('audio/mp4; codecs="ac-3"')}}function p5(i){return i.replace(/^.+codecs=["']?([^"']+).*$/,"$1")}const Ppe={supported:!0,powerEfficient:!0,smooth:!0},Bpe={supported:!1,smooth:!1,powerEfficient:!1},PQ={supported:!0,configurations:[],decodingInfoResults:[Ppe]};function BQ(i,e){return{supported:!1,configurations:e,decodingInfoResults:[Bpe],error:i}}function Dpe(i,e,t,n,r,s){const o=i.videoCodec,a=i.audioCodec?i.audioGroups:null,l=s==null?void 0:s.audioCodec,c=s==null?void 0:s.channels,u=c?parseInt(c):l?1/0:2;let h=null;if(a!=null&&a.length)try{a.length===1&&a[0]?h=e.groups[a[0]].channels:h=a.reduce((f,d)=>{if(d){const m=e.groups[d];if(!m)throw new Error(`Audio track group ${d} not found`);Object.keys(m.channels).forEach(A=>{f[A]=(f[A]||0)+m.channels[A]})}return f},{2:0})}catch{return!0}return o!==void 0&&(o.split(",").some(f=>g4(f))||i.width>1920&&i.height>1088||i.height>1920&&i.width>1088||i.frameRate>Math.max(n,30)||i.videoRange!=="SDR"&&i.videoRange!==t||i.bitrate>Math.max(r,8e6))||!!h&&Wt(u)&&Object.keys(h).some(f=>parseInt(f)>u)}function DQ(i,e,t,n={}){const r=i.videoCodec;if(!r&&!i.audioCodec||!t)return Promise.resolve(PQ);const s=[],o=kpe(i),a=o.length,l=Fpe(i,e,a>0),c=l.length;for(let u=a||1*c||1;u--;){const h={type:"media-source"};if(a&&(h.video=o[u%a]),c){h.audio=l[u%c];const f=h.audio.bitrate;h.video&&f&&(h.video.bitrate-=f)}s.push(h)}if(r){const u=navigator.userAgent;if(r.split(",").some(h=>g4(h))&&LQ())return Promise.resolve(BQ(new Error(`Overriding Windows Firefox HEVC MediaCapabilities result based on user-agent string: (${u})`),s))}return Promise.all(s.map(u=>{const h=Npe(u);return n[h]||(n[h]=t.decodingInfo(u))})).then(u=>({supported:!u.some(h=>!h.supported),configurations:s,decodingInfoResults:u})).catch(u=>({supported:!1,configurations:s,decodingInfoResults:[],error:u}))}function kpe(i){var e;const t=(e=i.videoCodec)==null?void 0:e.split(","),n=kQ(i),r=i.width||640,s=i.height||480,o=i.frameRate||30,a=i.videoRange.toLowerCase();return t?t.map(l=>{const c={contentType:Q2(Lpe(l),"video"),width:r,height:s,bitrate:n,framerate:o};return a!=="sdr"&&(c.transferFunction=a),c}):[]}function Fpe(i,e,t){var n;const r=(n=i.audioCodec)==null?void 0:n.split(","),s=kQ(i);return r&&i.audioGroups?i.audioGroups.reduce((o,a)=>{var l;const c=a?(l=e.groups[a])==null?void 0:l.tracks:null;return c?c.reduce((u,h)=>{if(h.groupId===a){const f=parseFloat(h.channels||"");r.forEach(d=>{const m={contentType:Q2(d,"audio"),bitrate:t?Ope(d,s):s};f&&(m.channels=""+f),u.push(m)})}return u},o):o},[]):[]}function Ope(i,e){if(e<=1)return 1;let t=128e3;return i==="ec-3"?t=768e3:i==="ac-3"&&(t=64e4),Math.min(e/2,t)}function kQ(i){return Math.ceil(Math.max(i.bitrate*.9,i.averageBitrate)/1e3)*1e3||1}function Npe(i){let e="";const{audio:t,video:n}=i;if(n){const r=p5(n.contentType);e+=`${r}_r${n.height}x${n.width}f${Math.ceil(n.framerate)}${n.transferFunction||"sd"}_${Math.ceil(n.bitrate/1e5)}`}if(t){const r=p5(t.contentType);e+=`${n?"_":""}${r}_c${t.channels}`}return e}const m5=["NONE","TYPE-0","TYPE-1",null];function Upe(i){return m5.indexOf(i)>-1}const HS=["SDR","PQ","HLG"];function zpe(i){return!!i&&HS.indexOf(i)>-1}var o2={No:"",Yes:"YES",v2:"v2"};function F7(i){const{canSkipUntil:e,canSkipDateRanges:t,age:n}=i,r=n<e/2;return e&&r?t?o2.v2:o2.Yes:o2.No}class g5{constructor(e,t,n){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=t,this.skip=n}addDirectives(e){const t=new self.URL(e);return this.msn!==void 0&&t.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href}}class aA{constructor(e){if(this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.supplemental=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[e.url],this._attrs=[e.attrs],this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.frameRate=e.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=e.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.codecSet=[e.videoCodec,e.audioCodec].filter(n=>!!n).map(n=>n.substring(0,4)).join(","),"supplemental"in e){var t;this.supplemental=e.supplemental;const n=(t=e.supplemental)==null?void 0:t.videoCodec;n&&n!==e.videoCodec&&(this.codecSet+=`,${n.substring(0,4)}`)}this.addGroupId("audio",e.attrs.AUDIO),this.addGroupId("text",e.attrs.SUBTITLES)}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get averageBitrate(){return this._avgBitrate||this.realBitrate||this.bitrate}get attrs(){return this._attrs[0]}get codecs(){return this.attrs.CODECS||""}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get videoRange(){return this.attrs["VIDEO-RANGE"]||"SDR"}get score(){return this.attrs.optionalFloat("SCORE",0)}get uri(){return this.url[0]||""}hasAudioGroup(e){return O7(this._audioGroups,e)}hasSubtitleGroup(e){return O7(this._subtitleGroups,e)}get audioGroups(){return this._audioGroups}get subtitleGroups(){return this._subtitleGroups}addGroupId(e,t){if(t){if(e==="audio"){let n=this._audioGroups;n||(n=this._audioGroups=[]),n.indexOf(t)===-1&&n.push(t)}else if(e==="text"){let n=this._subtitleGroups;n||(n=this._subtitleGroups=[]),n.indexOf(t)===-1&&n.push(t)}}}get urlId(){return 0}set urlId(e){}get audioGroupIds(){return this.audioGroups?[this.audioGroupId]:void 0}get textGroupIds(){return this.subtitleGroups?[this.textGroupId]:void 0}get audioGroupId(){var e;return(e=this.audioGroups)==null?void 0:e[0]}get textGroupId(){var e;return(e=this.subtitleGroups)==null?void 0:e[0]}addFallback(){}}function O7(i,e){return!e||!i?!1:i.indexOf(e)!==-1}function Gpe(){if(typeof matchMedia=="function"){const i=matchMedia("(dynamic-range: high)"),e=matchMedia("bad query");if(i.media!==e.media)return i.matches===!0}return!1}function Hpe(i,e){let t=!1,n=[];if(i&&(t=i!=="SDR",n=[i]),e){n=e.allowedVideoRanges||HS.slice(0);const r=n.join("")!=="SDR"&&!e.videoCodec;t=e.preferHDR!==void 0?e.preferHDR:r&&Gpe(),t||(n=["SDR"])}return{preferHDR:t,allowedVideoRanges:n}}const Qpe=i=>{const e=new WeakSet;return(t,n)=>{if(i&&(n=i(t,n)),typeof n=="object"&&n!==null){if(e.has(n))return;e.add(n)}return n}},lr=(i,e)=>JSON.stringify(i,Qpe(e));function Vpe(i,e,t,n,r){const s=Object.keys(i),o=n==null?void 0:n.channels,a=n==null?void 0:n.audioCodec,l=r==null?void 0:r.videoCodec,c=o&&parseInt(o)===2;let u=!1,h=!1,f=1/0,d=1/0,m=1/0,A=1/0,g=0,y=[];const{preferHDR:E,allowedVideoRanges:x}=Hpe(e,r);for(let L=s.length;L--;){const R=i[s[L]];u||(u=R.channels[2]>0),f=Math.min(f,R.minHeight),d=Math.min(d,R.minFramerate),m=Math.min(m,R.minBitrate),x.filter(F=>R.videoRanges[F]>0).length>0&&(h=!0)}f=Wt(f)?f:0,d=Wt(d)?d:0;const C=Math.max(1080,f),T=Math.max(30,d);m=Wt(m)?m:t,t=Math.max(m,t),h||(e=void 0);const I=s.length>1;return{codecSet:s.reduce((L,R)=>{const P=i[R];if(R===L)return L;if(y=h?x.filter(F=>P.videoRanges[F]>0):[],I){if(P.minBitrate>t)return rh(R,`min bitrate of ${P.minBitrate} > current estimate of ${t}`),L;if(!P.hasDefaultAudio)return rh(R,"no renditions with default or auto-select sound found"),L;if(a&&R.indexOf(a.substring(0,4))%5!==0)return rh(R,`audio codec preference "${a}" not found`),L;if(o&&!c){if(!P.channels[o])return rh(R,`no renditions with ${o} channel sound found (channels options: ${Object.keys(P.channels)})`),L}else if((!a||c)&&u&&P.channels[2]===0)return rh(R,"no renditions with stereo sound found"),L;if(P.minHeight>C)return rh(R,`min resolution of ${P.minHeight} > maximum of ${C}`),L;if(P.minFramerate>T)return rh(R,`min framerate of ${P.minFramerate} > maximum of ${T}`),L;if(!y.some(F=>P.videoRanges[F]>0))return rh(R,`no variants with VIDEO-RANGE of ${lr(y)} found`),L;if(l&&R.indexOf(l.substring(0,4))%5!==0)return rh(R,`video codec preference "${l}" not found`),L;if(P.maxScore<g)return rh(R,`max score of ${P.maxScore} < selected max of ${g}`),L}return L&&(zS(R)>=zS(L)||P.fragmentError>i[L].fragmentError)?L:(A=P.minIndex,g=P.maxScore,R)},void 0),videoRanges:y,preferHDR:E,minFramerate:d,minBitrate:m,minIndex:A}}function rh(i,e){Ki.log(`[abr] start candidates with "${i}" ignored because ${e}`)}function FQ(i){return i.reduce((e,t)=>{let n=e.groups[t.groupId];n||(n=e.groups[t.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),n.tracks.push(t);const r=t.channels||"2";return n.channels[r]=(n.channels[r]||0)+1,n.hasDefault=n.hasDefault||t.default,n.hasAutoSelect=n.hasAutoSelect||t.autoselect,n.hasDefault&&(e.hasDefaultAudio=!0),n.hasAutoSelect&&(e.hasAutoSelectAudio=!0),e},{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function Wpe(i,e,t,n){return i.slice(t,n+1).reduce((r,s,o)=>{if(!s.codecSet)return r;const a=s.audioGroups;let l=r[s.codecSet];l||(r[s.codecSet]=l={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,minIndex:o,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!a,fragmentError:0}),l.minBitrate=Math.min(l.minBitrate,s.bitrate);const c=Math.min(s.height,s.width);return l.minHeight=Math.min(l.minHeight,c),l.minFramerate=Math.min(l.minFramerate,s.frameRate),l.minIndex=Math.min(l.minIndex,o),l.maxScore=Math.max(l.maxScore,s.score),l.fragmentError+=s.fragmentError,l.videoRanges[s.videoRange]=(l.videoRanges[s.videoRange]||0)+1,a&&a.forEach(u=>{if(!u)return;const h=e.groups[u];h&&(l.hasDefaultAudio=l.hasDefaultAudio||e.hasDefaultAudio?h.hasDefault:h.hasAutoSelect||!e.hasDefaultAudio&&!e.hasAutoSelectAudio,Object.keys(h.channels).forEach(f=>{l.channels[f]=(l.channels[f]||0)+h.channels[f]}))}),r},{})}function N7(i){if(!i)return i;const{lang:e,assocLang:t,characteristics:n,channels:r,audioCodec:s}=i;return{lang:e,assocLang:t,characteristics:n,channels:r,audioCodec:s}}function Ah(i,e,t){if("attrs"in i){const n=e.indexOf(i);if(n!==-1)return n}for(let n=0;n<e.length;n++){const r=e[n];if(Vm(i,r,t))return n}return-1}function Vm(i,e,t){const{groupId:n,name:r,lang:s,assocLang:o,default:a}=i,l=i.forced;return(n===void 0||e.groupId===n)&&(r===void 0||e.name===r)&&(s===void 0||jpe(s,e.lang))&&(s===void 0||e.assocLang===o)&&(a===void 0||e.default===a)&&(l===void 0||e.forced===l)&&(!("characteristics"in i)||Kpe(i.characteristics||"",e.characteristics))&&(t===void 0||t(i,e))}function jpe(i,e="--"){return i.length===e.length?i===e:i.startsWith(e)||e.startsWith(i)}function Kpe(i,e=""){const t=i.split(","),n=e.split(",");return t.length===n.length&&!t.some(r=>n.indexOf(r)===-1)}function wm(i,e){const{audioCodec:t,channels:n}=i;return(t===void 0||(e.audioCodec||"").substring(0,4)===t.substring(0,4))&&(n===void 0||n===(e.channels||"2"))}function $pe(i,e,t,n,r){const s=e[n],a=e.reduce((f,d,m)=>{const A=d.uri;return(f[A]||(f[A]=[])).push(m),f},{})[s.uri];a.length>1&&(n=Math.max.apply(Math,a));const l=s.videoRange,c=s.frameRate,u=s.codecSet.substring(0,4),h=U7(e,n,f=>{if(f.videoRange!==l||f.frameRate!==c||f.codecSet.substring(0,4)!==u)return!1;const d=f.audioGroups,m=t.filter(A=>!d||d.indexOf(A.groupId)!==-1);return Ah(i,m,r)>-1});return h>-1?h:U7(e,n,f=>{const d=f.audioGroups,m=t.filter(A=>!d||d.indexOf(A.groupId)!==-1);return Ah(i,m,r)>-1})}function U7(i,e,t){for(let n=e;n>-1;n--)if(t(i[n]))return n;for(let n=e+1;n<i.length;n++)if(t(i[n]))return n;return-1}function QS(i,e){var t;return!!i&&i!==((t=e.loadLevelObj)==null?void 0:t.uri)}class OQ extends _c{constructor(e){super("abr",e.logger),this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.rebufferNotice=-1,this.supportedCache={},this.bwEstimator=void 0,this._abandonRulesCheck=t=>{var n;const{fragCurrent:r,partCurrent:s,hls:o}=this,{autoLevelEnabled:a,media:l}=o;if(!r||!l)return;const c=performance.now(),u=s?s.stats:r.stats,h=s?s.duration:r.duration,f=c-u.loading.start,d=o.minAutoLevel,m=r.level,A=this._nextAutoLevel;if(u.aborted||u.loaded&&u.loaded===u.total||m<=d){this.clearTimer(),this._nextAutoLevel=-1;return}if(!a)return;const g=A>-1&&A!==m,y=!!t||g;if(!y&&(l.paused||!l.playbackRate||!l.readyState))return;const E=o.mainForwardBufferInfo;if(!y&&E===null)return;const x=this.bwEstimator.getEstimateTTFB(),C=Math.abs(l.playbackRate);if(f<=Math.max(x,1e3*(h/(C*2))))return;const T=E?E.len/C:0,I=u.loading.first?u.loading.first-u.loading.start:-1,M=u.loaded&&I>-1,L=this.getBwEstimate(),R=o.levels,P=R[m],F=Math.max(u.loaded,Math.round(h*(r.bitrate||P.averageBitrate)/8));let k=M?f-I:f;k<1&&M&&(k=Math.min(f,u.loaded*8/L));const z=M?u.loaded*1e3/k:0,U=x/1e3,W=z?(F-u.loaded)/z:F*8/L+U;if(W<=T)return;const $=z?z*8:L,oe=((n=(t==null?void 0:t.details)||this.hls.latestLevelDetails)==null?void 0:n.live)===!0,X=this.hls.config.abrBandWidthUpFactor;let Q=Number.POSITIVE_INFINITY,Y;for(Y=m-1;Y>d;Y--){const q=R[Y].maxBitrate,J=!R[Y].details||oe;if(Q=this.getTimeToLoadFrag(U,$,h*q,J),Q<Math.min(T,h+U))break}if(Q>=W||Q>h*10)return;M?this.bwEstimator.sample(f-Math.min(x,I),u.loaded):this.bwEstimator.sampleTTFB(f);const O=R[Y].maxBitrate;this.getBwEstimate()*X>O&&this.resetEstimator(O);const K=this.findBestLevel(O,d,Y,0,T,1,1);K>-1&&(Y=K),this.warn(`Fragment ${r.sn}${s?" part "+s.index:""} of level ${m} is loading too slowly;
      Fragment duration: ${r.duration.toFixed(3)}
      Time to underbuffer: ${T.toFixed(3)} s
      Estimated load time for current fragment: ${W.toFixed(3)} s
      Estimated load time for down switch fragment: ${Q.toFixed(3)} s
      TTFB estimate: ${I|0} ms
      Current BW estimate: ${Wt(L)?L|0:"Unknown"} bps
      New BW estimate: ${this.getBwEstimate()|0} bps
      Switching to level ${Y} @ ${O|0} bps`),o.nextLoadLevel=o.nextAutoLevel=Y,this.clearTimer();const te=()=>{if(this.clearTimer(),this.fragCurrent===r&&this.hls.loadLevel===Y&&Y>0){const q=this.getStarvationDelay();if(this.warn(`Aborting inflight request ${Y>0?"and switching down":""}
      Fragment duration: ${r.duration.toFixed(3)} s
      Time to underbuffer: ${q.toFixed(3)} s`),r.abortRequests(),this.fragCurrent=this.partCurrent=null,Y>d){let J=this.findBestLevel(this.hls.levels[d].bitrate,d,Y,0,q,1,1);J===-1&&(J=d),this.hls.nextLoadLevel=this.hls.nextAutoLevel=J,this.resetEstimator(this.hls.levels[J].bitrate)}}};g||W>Q*2?te():this.timer=self.setInterval(te,Q*1e3),o.trigger(ae.FRAG_LOAD_EMERGENCY_ABORTED,{frag:r,part:s,stats:u})},this.hls=e,this.bwEstimator=this.initEstimator(),this.registerListeners()}resetEstimator(e){e&&(this.log(`setting initial bwe to ${e}`),this.hls.config.abrEwmaDefaultEstimate=e),this.firstSelection=-1,this.bwEstimator=this.initEstimator()}initEstimator(){const e=this.hls.config;return new tpe(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate)}registerListeners(){const{hls:e}=this;e.on(ae.MANIFEST_LOADING,this.onManifestLoading,this),e.on(ae.FRAG_LOADING,this.onFragLoading,this),e.on(ae.FRAG_LOADED,this.onFragLoaded,this),e.on(ae.FRAG_BUFFERED,this.onFragBuffered,this),e.on(ae.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(ae.LEVEL_LOADED,this.onLevelLoaded,this),e.on(ae.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(ae.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.on(ae.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e&&(e.off(ae.MANIFEST_LOADING,this.onManifestLoading,this),e.off(ae.FRAG_LOADING,this.onFragLoading,this),e.off(ae.FRAG_LOADED,this.onFragLoaded,this),e.off(ae.FRAG_BUFFERED,this.onFragBuffered,this),e.off(ae.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(ae.LEVEL_LOADED,this.onLevelLoaded,this),e.off(ae.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(ae.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.off(ae.ERROR,this.onError,this))}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=this.supportedCache=null,this.fragCurrent=this.partCurrent=null}onManifestLoading(e,t){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.supportedCache={},this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()}onLevelsUpdated(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null}onMaxAutoLevelUpdated(){this.firstSelection=-1,this.nextAutoLevelKey=""}onFragLoading(e,t){const n=t.frag;if(!this.ignoreFragment(n)){if(!n.bitrateTest){var r;this.fragCurrent=n,this.partCurrent=(r=t.part)!=null?r:null}this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}}onLevelSwitching(e,t){this.clearTimer()}onError(e,t){if(!t.fatal)switch(t.details){case Ke.BUFFER_ADD_CODEC_ERROR:case Ke.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case Ke.FRAG_LOAD_TIMEOUT:{const n=t.frag,{fragCurrent:r,partCurrent:s}=this;if(n&&r&&n.sn===r.sn&&n.level===r.level){const o=performance.now(),a=s?s.stats:n.stats,l=o-a.loading.start,c=a.loading.first?a.loading.first-a.loading.start:-1;if(a.loaded&&c>-1){const h=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(l-Math.min(h,c),a.loaded)}else this.bwEstimator.sampleTTFB(l)}break}}}getTimeToLoadFrag(e,t,n,r){const s=e+n/t,o=r?e+this.lastLevelLoadSec:0;return s+o}onLevelLoaded(e,t){const n=this.hls.config,{loading:r}=t.stats,s=r.end-r.first;Wt(s)&&(this.lastLevelLoadSec=s/1e3),t.details.live?this.bwEstimator.update(n.abrEwmaSlowLive,n.abrEwmaFastLive):this.bwEstimator.update(n.abrEwmaSlowVoD,n.abrEwmaFastVoD),this.timer>-1&&this._abandonRulesCheck(t.levelInfo)}onFragLoaded(e,{frag:t,part:n}){const r=n?n.stats:t.stats;if(t.type===Yt.MAIN&&this.bwEstimator.sampleTTFB(r.loading.first-r.loading.start),!this.ignoreFragment(t)){if(this.clearTimer(),t.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){const s=n?n.duration:t.duration,o=this.hls.levels[t.level],a=(o.loaded?o.loaded.bytes:0)+r.loaded,l=(o.loaded?o.loaded.duration:0)+s;o.loaded={bytes:a,duration:l},o.realBitrate=Math.round(8*a/l)}if(t.bitrateTest){const s={stats:r,frag:t,part:n,id:t.type};this.onFragBuffered(ae.FRAG_BUFFERED,s),t.bitrateTest=!1}else this.lastLoadedFragLevel=t.level}}onFragBuffered(e,t){const{frag:n,part:r}=t,s=r!=null&&r.stats.loaded?r.stats:n.stats;if(s.aborted||this.ignoreFragment(n))return;const o=s.parsing.end-s.loading.start-Math.min(s.loading.first-s.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(o,s.loaded),s.bwEstimate=this.getBwEstimate(),n.bitrateTest?this.bitrateTestDelay=o/1e3:this.bitrateTestDelay=0}ignoreFragment(e){return e.type!==Yt.MAIN||e.sn==="initSegment"}clearTimer(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)}get firstAutoLevel(){const{maxAutoLevel:e,minAutoLevel:t}=this.hls,n=this.getBwEstimate(),r=this.hls.config.maxStarvationDelay,s=this.findBestLevel(n,t,e,0,r,1,1);if(s>-1)return s;const o=this.hls.firstLevel,a=Math.min(Math.max(o,t),e);return this.warn(`Could not find best starting auto level. Defaulting to first in playlist ${o} clamped to ${a}`),a}get forcedAutoLevel(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}get nextAutoLevel(){const e=this.forcedAutoLevel,n=this.bwEstimator.canEstimate(),r=this.lastLoadedFragLevel>-1;if(e!==-1&&(!n||!r||this.nextAutoLevelKey===this.getAutoLevelKey()))return e;const s=n&&r?this.getNextABRAutoLevel():this.firstAutoLevel;if(e!==-1){const o=this.hls.levels;if(o.length>Math.max(e,s)&&o[e].loadError<=o[s].loadError)return e}return this._nextAutoLevel=s,this.nextAutoLevelKey=this.getAutoLevelKey(),s}getAutoLevelKey(){return`${this.getBwEstimate()}_${this.getStarvationDelay().toFixed(2)}`}getNextABRAutoLevel(){const{fragCurrent:e,partCurrent:t,hls:n}=this;if(n.levels.length<=1)return n.loadLevel;const{maxAutoLevel:r,config:s,minAutoLevel:o}=n,a=t?t.duration:e?e.duration:0,l=this.getBwEstimate(),c=this.getStarvationDelay();let u=s.abrBandWidthFactor,h=s.abrBandWidthUpFactor;if(c){const g=this.findBestLevel(l,o,r,c,0,u,h);if(g>=0)return this.rebufferNotice=-1,g}let f=a?Math.min(a,s.maxStarvationDelay):s.maxStarvationDelay;if(!c){const g=this.bitrateTestDelay;g&&(f=(a?Math.min(a,s.maxLoadingDelay):s.maxLoadingDelay)-g,this.info(`bitrate test took ${Math.round(1e3*g)}ms, set first fragment max fetchDuration to ${Math.round(1e3*f)} ms`),u=h=1)}const d=this.findBestLevel(l,o,r,c,f,u,h);if(this.rebufferNotice!==d&&(this.rebufferNotice=d,this.info(`${c?"rebuffering expected":"buffer is empty"}, optimal quality level ${d}`)),d>-1)return d;const m=n.levels[o],A=n.loadLevelObj;return A&&(m==null?void 0:m.bitrate)<A.bitrate?o:n.loadLevel}getStarvationDelay(){const e=this.hls,t=e.media;if(!t)return 1/0;const n=t&&t.playbackRate!==0?Math.abs(t.playbackRate):1,r=e.mainForwardBufferInfo;return(r?r.len:0)/n}getBwEstimate(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate}findBestLevel(e,t,n,r,s,o,a){var l;const c=r+s,u=this.lastLoadedFragLevel,h=u===-1?this.hls.firstLevel:u,{fragCurrent:f,partCurrent:d}=this,{levels:m,allAudioTracks:A,loadLevel:g,config:y}=this.hls;if(m.length===1)return 0;const E=m[h],x=!!((l=this.hls.latestLevelDetails)!=null&&l.live),C=g===-1||u===-1;let T,I="SDR",M=(E==null?void 0:E.frameRate)||0;const{audioPreference:L,videoPreference:R}=y,P=this.audioTracksByGroup||(this.audioTracksByGroup=FQ(A));let F=-1;if(C){if(this.firstSelection!==-1)return this.firstSelection;const $=this.codecTiers||(this.codecTiers=Wpe(m,P,t,n)),oe=Vpe($,I,e,L,R),{codecSet:X,videoRanges:Q,minFramerate:Y,minBitrate:O,minIndex:K,preferHDR:te}=oe;F=K,T=X,I=te?Q[Q.length-1]:Q[0],M=Y,e=Math.max(e,O),this.log(`picked start tier ${lr(oe)}`)}else T=E==null?void 0:E.codecSet,I=E==null?void 0:E.videoRange;const k=d?d.duration:f?f.duration:0,z=this.bwEstimator.getEstimateTTFB()/1e3,U=[];for(let $=n;$>=t;$--){var W;const oe=m[$],X=$>h;if(!oe)continue;if(y.useMediaCapabilities&&!oe.supportedResult&&!oe.supportedPromise){const J=navigator.mediaCapabilities;typeof(J==null?void 0:J.decodingInfo)=="function"&&Dpe(oe,P,I,M,e,L)?(oe.supportedPromise=DQ(oe,P,J,this.supportedCache),oe.supportedPromise.then(ie=>{if(!this.hls)return;oe.supportedResult=ie;const re=this.hls.levels,se=re.indexOf(oe);ie.error?this.warn(`MediaCapabilities decodingInfo error: "${ie.error}" for level ${se} ${lr(ie)}`):ie.supported?ie.decodingInfoResults.some(ge=>ge.smooth===!1||ge.powerEfficient===!1)&&this.log(`MediaCapabilities decodingInfo for level ${se} not smooth or powerEfficient: ${lr(ie)}`):(this.warn(`Unsupported MediaCapabilities decodingInfo result for level ${se} ${lr(ie)}`),se>-1&&re.length>1&&(this.log(`Removing unsupported level ${se}`),this.hls.removeLevel(se),this.hls.loadLevel===-1&&(this.hls.nextLoadLevel=0)))}).catch(ie=>{this.warn(`Error handling MediaCapabilities decodingInfo: ${ie}`)})):oe.supportedResult=PQ}if((T&&oe.codecSet!==T||I&&oe.videoRange!==I||X&&M>oe.frameRate||!X&&M>0&&M<oe.frameRate||(W=oe.supportedResult)!=null&&(W=W.decodingInfoResults)!=null&&W.some(J=>J.smooth===!1))&&(!C||$!==F)){U.push($);continue}const Q=oe.details,Y=(d?Q==null?void 0:Q.partTarget:Q==null?void 0:Q.averagetargetduration)||k;let O;X?O=a*e:O=o*e;const K=k&&r>=k*2&&s===0?oe.averageBitrate:oe.maxBitrate,te=this.getTimeToLoadFrag(z,O,K*Y,Q===void 0);if(O>=K&&($===u||oe.loadError===0&&oe.fragmentError===0)&&(te<=z||!Wt(te)||x&&!this.bitrateTestDelay||te<c)){const J=this.forcedAutoLevel;return $!==g&&(J===-1||J!==g)&&(U.length&&this.trace(`Skipped level(s) ${U.join(",")} of ${n} max with CODECS and VIDEO-RANGE:"${m[U[0]].codecs}" ${m[U[0]].videoRange}; not compatible with "${T}" ${I}`),this.info(`switch candidate:${h}->${$} adjustedbw(${Math.round(O)})-bitrate=${Math.round(O-K)} ttfb:${z.toFixed(1)} avgDuration:${Y.toFixed(1)} maxFetchDuration:${c.toFixed(1)} fetchDuration:${te.toFixed(1)} firstSelection:${C} codecSet:${oe.codecSet} videoRange:${oe.videoRange} hls.loadLevel:${g}`)),C&&(this.firstSelection=$),$}}return-1}set nextAutoLevel(e){const t=this.deriveNextAutoLevel(e);this._nextAutoLevel!==t&&(this.nextAutoLevelKey="",this._nextAutoLevel=t)}deriveNextAutoLevel(e){const{maxAutoLevel:t,minAutoLevel:n}=this.hls;return Math.min(Math.max(e,n),t)}}const NQ={search:function(i,e){let t=0,n=i.length-1,r=null,s=null;for(;t<=n;){r=(t+n)/2|0,s=i[r];const o=e(s);if(o>0)t=r+1;else if(o<0)n=r-1;else return s}return null}};function Ype(i,e,t){if(e===null||!Array.isArray(i)||!i.length||!Wt(e))return null;const n=i[0].programDateTime;if(e<(n||0))return null;const r=i[i.length-1].endProgramDateTime;if(e>=(r||0))return null;for(let s=0;s<i.length;++s){const o=i[s];if(qpe(e,t,o))return o}return null}function s0(i,e,t=0,n=0,r=.005){let s=null;if(i){s=e[1+i.sn-e[0].sn]||null;const a=i.endDTS-t;a>0&&a<15e-7&&(t+=15e-7),s&&i.level!==s.level&&s.end<=i.end&&(s=e[2+i.sn-e[0].sn]||null)}else t===0&&e[0].start===0&&(s=e[0]);if(s&&((!i||i.level===s.level)&&z7(t,n,s)===0||Xpe(s,i,Math.min(r,n))))return s;const o=NQ.search(e,z7.bind(null,t,n));return o&&(o!==i||!s)?o:s}function Xpe(i,e,t){if(e&&e.start===0&&e.level<i.level&&(e.endPTS||0)>0){const n=e.tagList.reduce((r,s)=>(s[0]==="INF"&&(r+=parseFloat(s[1])),r),t);return i.start<=n}return!1}function z7(i=0,e=0,t){if(t.start<=i&&t.start+t.duration>i)return 0;const n=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0));return t.start+t.duration-n<=i?1:t.start-n>i&&t.start?-1:0}function qpe(i,e,t){const n=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0))*1e3;return(t.endProgramDateTime||0)-n>i}function UQ(i,e,t){if(i&&i.startCC<=e&&i.endCC>=e){let n=i.fragments;const{fragmentHint:r}=i;r&&(n=n.concat(r));let s;return NQ.search(n,o=>o.cc<e?1:o.cc>e?-1:(s=o,o.end<=t?1:o.start>t?-1:0)),s||null}return null}function VS(i){switch(i.details){case Ke.FRAG_LOAD_TIMEOUT:case Ke.KEY_LOAD_TIMEOUT:case Ke.LEVEL_LOAD_TIMEOUT:case Ke.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function zQ(i){return i.details.startsWith("key")}function GQ(i){return zQ(i)&&!!i.frag&&!i.frag.decryptdata}function G7(i,e){const t=VS(e);return i.default[`${t?"timeout":"error"}Retry`]}function FR(i,e){const t=i.backoff==="linear"?1:Math.pow(2,e);return Math.min(t*i.retryDelayMs,i.maxRetryDelayMs)}function H7(i){return Qi(Qi({},i),{errorRetry:null,timeoutRetry:null})}function WS(i,e,t,n){if(!i)return!1;const r=n==null?void 0:n.code,s=e<i.maxNumRetry&&(Jpe(r)||!!t);return i.shouldRetry?i.shouldRetry(i,e,t,n,s):s}function Jpe(i){return A5(i)||!!i&&(i<400||i>499)}function A5(i){return i===0&&navigator.onLine===!1}var Zs={DoNothing:0,SendEndCallback:1,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,InsertDiscontinuity:4,RetryRequest:5},$a={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2,MoveAllAlternatesMatchingKey:4,SwitchToSDR:8};class HQ extends _c{constructor(e){super("error-controller",e.logger),this.hls=void 0,this.playlistError=0,this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(ae.ERROR,this.onError,this),e.on(ae.MANIFEST_LOADING,this.onManifestLoading,this),e.on(ae.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const e=this.hls;e&&(e.off(ae.ERROR,this.onError,this),e.off(ae.ERROR,this.onErrorOut,this),e.off(ae.MANIFEST_LOADING,this.onManifestLoading,this),e.off(ae.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null}startLoad(e){}stopLoad(){this.playlistError=0}getVariantLevelIndex(e){return(e==null?void 0:e.type)===Yt.MAIN?e.level:this.getVariantIndex()}getVariantIndex(){var e;const t=this.hls,n=t.currentLevel;return(e=t.loadLevelObj)!=null&&e.details||n===-1?t.loadLevel:n}variantHasKey(e,t){if(e){var n;if((n=e.details)!=null&&n.hasKey(t))return!0;const r=e.audioGroups;if(r)return this.hls.allAudioTracks.filter(o=>r.indexOf(o.groupId)>=0).some(o=>{var a;return(a=o.details)==null?void 0:a.hasKey(t)})}return!1}onManifestLoading(){this.playlistError=0}onLevelUpdated(){this.playlistError=0}onError(e,t){var n;if(t.fatal)return;const r=this.hls,s=t.context;switch(t.details){case Ke.FRAG_LOAD_ERROR:case Ke.FRAG_LOAD_TIMEOUT:case Ke.KEY_LOAD_ERROR:case Ke.KEY_LOAD_TIMEOUT:t.errorAction=this.getFragRetryOrSwitchAction(t);return;case Ke.FRAG_PARSING_ERROR:if((n=t.frag)!=null&&n.gap){t.errorAction=V1();return}case Ke.FRAG_GAP:case Ke.FRAG_DECRYPT_ERROR:{t.errorAction=this.getFragRetryOrSwitchAction(t),t.errorAction.action=Zs.SendAlternateToPenaltyBox;return}case Ke.LEVEL_EMPTY_ERROR:case Ke.LEVEL_PARSING_ERROR:{var o;const l=t.parent===Yt.MAIN?t.level:r.loadLevel;t.details===Ke.LEVEL_EMPTY_ERROR&&((o=t.context)!=null&&(o=o.levelDetails)!=null&&o.live)?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,l):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,l))}return;case Ke.LEVEL_LOAD_ERROR:case Ke.LEVEL_LOAD_TIMEOUT:typeof(s==null?void 0:s.level)=="number"&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,s.level));return;case Ke.AUDIO_TRACK_LOAD_ERROR:case Ke.AUDIO_TRACK_LOAD_TIMEOUT:case Ke.SUBTITLE_LOAD_ERROR:case Ke.SUBTITLE_TRACK_LOAD_TIMEOUT:if(s){const l=r.loadLevelObj;if(l&&(s.type===ai.AUDIO_TRACK&&l.hasAudioGroup(s.groupId)||s.type===ai.SUBTITLE_TRACK&&l.hasSubtitleGroup(s.groupId))){t.errorAction=this.getPlaylistRetryOrSwitchAction(t,r.loadLevel),t.errorAction.action=Zs.SendAlternateToPenaltyBox,t.errorAction.flags=$a.MoveAllAlternatesMatchingHost;return}}return;case Ke.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:t.errorAction={action:Zs.SendAlternateToPenaltyBox,flags:$a.MoveAllAlternatesMatchingHDCP};return;case Ke.KEY_SYSTEM_SESSION_UPDATE_FAILED:case Ke.KEY_SYSTEM_STATUS_INTERNAL_ERROR:case Ke.KEY_SYSTEM_NO_SESSION:t.errorAction={action:Zs.SendAlternateToPenaltyBox,flags:$a.MoveAllAlternatesMatchingKey};return;case Ke.BUFFER_ADD_CODEC_ERROR:case Ke.REMUX_ALLOC_ERROR:case Ke.BUFFER_APPEND_ERROR:if(!t.errorAction){var a;t.errorAction=this.getLevelSwitchAction(t,(a=t.level)!=null?a:r.loadLevel)}return;case Ke.INTERNAL_EXCEPTION:case Ke.BUFFER_APPENDING_ERROR:case Ke.BUFFER_FULL_ERROR:case Ke.LEVEL_SWITCH_ERROR:case Ke.BUFFER_STALLED_ERROR:case Ke.BUFFER_SEEK_OVER_HOLE:case Ke.BUFFER_NUDGE_ON_STALL:t.errorAction=V1();return}t.type===rn.KEY_SYSTEM_ERROR&&(t.levelRetry=!1,t.errorAction=V1())}getPlaylistRetryOrSwitchAction(e,t){const n=this.hls,r=G7(n.config.playlistLoadPolicy,e),s=this.playlistError++;if(WS(r,s,VS(e),e.response))return{action:Zs.RetryRequest,flags:$a.None,retryConfig:r,retryCount:s};const a=this.getLevelSwitchAction(e,t);return r&&(a.retryConfig=r,a.retryCount=s),a}getFragRetryOrSwitchAction(e){const t=this.hls,n=this.getVariantLevelIndex(e.frag),r=t.levels[n],{fragLoadPolicy:s,keyLoadPolicy:o}=t.config,a=G7(zQ(e)?o:s,e),l=t.levels.reduce((u,h)=>u+h.fragmentError,0);if(r&&(e.details!==Ke.FRAG_GAP&&r.fragmentError++,!GQ(e)&&WS(a,l,VS(e),e.response)))return{action:Zs.RetryRequest,flags:$a.None,retryConfig:a,retryCount:l};const c=this.getLevelSwitchAction(e,n);return a&&(c.retryConfig=a,c.retryCount=l),c}getLevelSwitchAction(e,t){const n=this.hls;t==null&&(t=n.loadLevel);const r=this.hls.levels[t];if(r){var s,o;const c=e.details;r.loadError++,c===Ke.BUFFER_APPEND_ERROR&&r.fragmentError++;let u=-1;const{levels:h,loadLevel:f,minAutoLevel:d,maxAutoLevel:m}=n;!n.autoLevelEnabled&&!n.config.preserveManualLevelOnError&&(n.loadLevel=-1);const A=(s=e.frag)==null?void 0:s.type,y=(A===Yt.AUDIO&&c===Ke.FRAG_PARSING_ERROR||e.sourceBufferName==="audio"&&(c===Ke.BUFFER_ADD_CODEC_ERROR||c===Ke.BUFFER_APPEND_ERROR))&&h.some(({audioCodec:I})=>r.audioCodec!==I),x=e.sourceBufferName==="video"&&(c===Ke.BUFFER_ADD_CODEC_ERROR||c===Ke.BUFFER_APPEND_ERROR)&&h.some(({codecSet:I,audioCodec:M})=>r.codecSet!==I&&r.audioCodec===M),{type:C,groupId:T}=(o=e.context)!=null?o:{};for(let I=h.length;I--;){const M=(I+f)%h.length;if(M!==f&&M>=d&&M<=m&&h[M].loadError===0){var a,l;const L=h[M];if(c===Ke.FRAG_GAP&&A===Yt.MAIN&&e.frag){const R=h[M].details;if(R){const P=s0(e.frag,R.fragments,e.frag.start);if(P!=null&&P.gap)continue}}else{if(C===ai.AUDIO_TRACK&&L.hasAudioGroup(T)||C===ai.SUBTITLE_TRACK&&L.hasSubtitleGroup(T))continue;if(A===Yt.AUDIO&&(a=r.audioGroups)!=null&&a.some(R=>L.hasAudioGroup(R))||A===Yt.SUBTITLE&&(l=r.subtitleGroups)!=null&&l.some(R=>L.hasSubtitleGroup(R))||y&&r.audioCodec===L.audioCodec||x&&r.codecSet===L.codecSet||!y&&r.codecSet!==L.codecSet)continue}u=M;break}}if(u>-1&&n.loadLevel!==u)return e.levelRetry=!0,this.playlistError=0,{action:Zs.SendAlternateToPenaltyBox,flags:$a.None,nextAutoLevel:u}}return{action:Zs.SendAlternateToPenaltyBox,flags:$a.MoveAllAlternatesMatchingHost}}onErrorOut(e,t){var n;switch((n=t.errorAction)==null?void 0:n.action){case Zs.DoNothing:break;case Zs.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(t),!t.errorAction.resolved&&t.details!==Ke.FRAG_GAP?t.fatal=!0:/MediaSource readyState: ended/.test(t.error.message)&&(this.warn(`MediaSource ended after "${t.sourceBufferName}" sourceBuffer append error. Attempting to recover from media error.`),this.hls.recoverMediaError());break;case Zs.RetryRequest:break}if(t.fatal){this.hls.stopLoad();return}}sendAlternateToPenaltyBox(e){const t=this.hls,n=e.errorAction;if(!n)return;const{flags:r}=n,s=n.nextAutoLevel;switch(r){case $a.None:this.switchLevel(e,s);break;case $a.MoveAllAlternatesMatchingHDCP:{const l=this.getVariantLevelIndex(e.frag),c=t.levels[l],u=c==null?void 0:c.attrs["HDCP-LEVEL"];if(n.hdcpLevel=u,u==="NONE")this.warn("HDCP policy resticted output with HDCP-LEVEL=NONE");else if(u){t.maxHdcpLevel=m5[m5.indexOf(u)-1],n.resolved=!0,this.warn(`Restricting playback to HDCP-LEVEL of "${t.maxHdcpLevel}" or lower`);break}}case $a.MoveAllAlternatesMatchingKey:{const l=e.decryptdata;if(l){const c=this.hls.levels,u=c.length;for(let f=u;f--;)if(this.variantHasKey(c[f],l)){var o,a;this.log(`Banned key found in level ${f} (${c[f].bitrate}bps) or audio group "${(o=c[f].audioGroups)==null?void 0:o.join(",")}" (${(a=e.frag)==null?void 0:a.type} fragment) ${Oo(l.keyId||[])}`),c[f].fragmentError++,c[f].loadError++,this.log(`Removing level ${f} with key error (${e.error})`),this.hls.removeLevel(f)}const h=e.frag;if(this.hls.levels.length<u)n.resolved=!0;else if(h&&h.type!==Yt.MAIN){const f=h.decryptdata;f&&!l.matches(f)&&(n.resolved=!0)}}break}}n.resolved||this.switchLevel(e,s)}switchLevel(e,t){if(t!==void 0&&e.errorAction&&(this.warn(`switching to level ${t} after ${e.details}`),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel,e.details===Ke.BUFFER_ADD_CODEC_ERROR&&e.mimeType&&e.sourceBufferName!=="audiovideo")){const n=p5(e.mimeType),r=this.hls.levels;for(let s=r.length;s--;)r[s][`${e.sourceBufferName}Codec`]===n&&(this.log(`Removing level ${s} for ${e.details} ("${n}" not supported)`),this.hls.removeLevel(s))}}}function V1(i){const e={action:Zs.DoNothing,flags:$a.None};return i&&(e.resolved=!0),e}var eo={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"};class Zpe{constructor(e){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}_registerListeners(){const{hls:e}=this;e&&(e.on(ae.MANIFEST_LOADING,this.onManifestLoading,this),e.on(ae.BUFFER_APPENDED,this.onBufferAppended,this),e.on(ae.FRAG_BUFFERED,this.onFragBuffered,this),e.on(ae.FRAG_LOADED,this.onFragLoaded,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(ae.MANIFEST_LOADING,this.onManifestLoading,this),e.off(ae.BUFFER_APPENDED,this.onBufferAppended,this),e.off(ae.FRAG_BUFFERED,this.onFragBuffered,this),e.off(ae.FRAG_LOADED,this.onFragLoaded,this))}destroy(){this._unregisterListeners(),this.hls=this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(e,t){const n=this.activePartLists[t];if(n)for(let r=n.length;r--;){const s=n[r];if(!s)break;if(s.start<=e&&e<=s.end&&s.loaded)return s}return this.getBufferedFrag(e,t)}getBufferedFrag(e,t){return this.getFragAtPos(e,t,!0)}getFragAtPos(e,t,n){const{fragments:r}=this,s=Object.keys(r);for(let o=s.length;o--;){const a=r[s[o]];if((a==null?void 0:a.body.type)===t&&(!n||a.buffered)){const l=a.body;if(l.start<=e&&e<=l.end)return l}}return null}detectEvictedFragments(e,t,n,r,s){this.timeRanges&&(this.timeRanges[e]=t);const o=(r==null?void 0:r.fragment.sn)||-1;Object.keys(this.fragments).forEach(a=>{const l=this.fragments[a];if(!l||o>=l.body.sn)return;if(!l.buffered&&(!l.loaded||s)){l.body.type===n&&this.removeFragment(l.body);return}const c=l.range[e];if(c){if(c.time.length===0){this.removeFragment(l.body);return}c.time.some(u=>{const h=!this.isTimeBuffered(u.startPTS,u.endPTS,t);return h&&this.removeFragment(l.body),h})}})}detectPartialFragments(e){const t=this.timeRanges;if(!t||e.frag.sn==="initSegment")return;const n=e.frag,r=Yg(n),s=this.fragments[r];if(!s||s.buffered&&n.gap)return;const o=!n.relurl;Object.keys(t).forEach(a=>{const l=n.elementaryStreams[a];if(!l)return;const c=t[a],u=o||l.partial===!0;s.range[a]=this.getBufferedTimes(n,e.part,u,c)}),s.loaded=null,Object.keys(s.range).length?(this.bufferedEnd(s,n),K3(s)||this.removeParts(n.sn-1,n.type)):this.removeFragment(s.body)}bufferedEnd(e,t){e.buffered=!0,(e.body.endList=t.endList||e.body.endList)&&(this.endListFragments[e.body.type]=e)}removeParts(e,t){const n=this.activePartLists[t];n&&(this.activePartLists[t]=Q7(n,r=>r.fragment.sn>=e))}fragBuffered(e,t){const n=Yg(e);let r=this.fragments[n];!r&&t&&(r=this.fragments[n]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),r&&(r.loaded=null,this.bufferedEnd(r,e))}getBufferedTimes(e,t,n,r){const s={time:[],partial:n},o=e.start,a=e.end,l=e.minEndPTS||a,c=e.maxStartPTS||o;for(let u=0;u<r.length;u++){const h=r.start(u)-this.bufferPadding,f=r.end(u)+this.bufferPadding;if(c>=h&&l<=f){s.time.push({startPTS:Math.max(o,r.start(u)),endPTS:Math.min(a,r.end(u))});break}else if(o<f&&a>h){const d=Math.max(o,r.start(u)),m=Math.min(a,r.end(u));m>d&&(s.partial=!0,s.time.push({startPTS:d,endPTS:m}))}else if(a<=h)break}return s}getPartialFragment(e){let t=null,n,r,s,o=0;const{bufferPadding:a,fragments:l}=this;return Object.keys(l).forEach(c=>{const u=l[c];u&&K3(u)&&(r=u.body.start-a,s=u.body.end+a,e>=r&&e<=s&&(n=Math.min(e-r,s-e),o<=n&&(t=u.body,o=n)))}),t}isEndListAppended(e){const t=this.endListFragments[e];return t!==void 0&&(t.buffered||K3(t))}getState(e){const t=Yg(e),n=this.fragments[t];return n?n.buffered?K3(n)?eo.PARTIAL:eo.OK:eo.APPENDING:eo.NOT_LOADED}isTimeBuffered(e,t,n){let r,s;for(let o=0;o<n.length;o++){if(r=n.start(o)-this.bufferPadding,s=n.end(o)+this.bufferPadding,e>=r&&t<=s)return!0;if(t<=r)return!1}return!1}onManifestLoading(){this.removeAllFragments()}onFragLoaded(e,t){if(t.frag.sn==="initSegment"||t.frag.bitrateTest)return;const n=t.frag,r=t.part?null:t,s=Yg(n);this.fragments[s]={body:n,appendedPTS:null,loaded:r,buffered:!1,range:Object.create(null)}}onBufferAppended(e,t){const{frag:n,part:r,timeRanges:s,type:o}=t;if(n.sn==="initSegment")return;const a=n.type;if(r){let c=this.activePartLists[a];c||(this.activePartLists[a]=c=[]),c.push(r)}this.timeRanges=s;const l=s[o];this.detectEvictedFragments(o,l,a,r)}onFragBuffered(e,t){this.detectPartialFragments(t)}hasFragment(e){const t=Yg(e);return!!this.fragments[t]}hasFragments(e){const{fragments:t}=this,n=Object.keys(t);if(!e)return n.length>0;for(let r=n.length;r--;){const s=t[n[r]];if((s==null?void 0:s.body.type)===e)return!0}return!1}hasParts(e){var t;return!!((t=this.activePartLists[e])!=null&&t.length)}removeFragmentsInRange(e,t,n,r,s){r&&!this.hasGaps||Object.keys(this.fragments).forEach(o=>{const a=this.fragments[o];if(!a)return;const l=a.body;l.type!==n||r&&!l.gap||l.start<t&&l.end>e&&(a.buffered||s)&&this.removeFragment(l)})}removeFragment(e){const t=Yg(e);e.clearElementaryStreamInfo();const n=this.activePartLists[e.type];if(n){const r=e.sn;this.activePartLists[e.type]=Q7(n,s=>s.fragment.sn!==r)}delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]}removeAllFragments(){var e;this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1;const t=(e=this.hls)==null||(e=e.latestLevelDetails)==null?void 0:e.partList;t&&t.forEach(n=>n.clearElementaryStreamInfo())}}function K3(i){var e,t,n;return i.buffered&&!!(i.body.gap||(e=i.range.video)!=null&&e.partial||(t=i.range.audio)!=null&&t.partial||(n=i.range.audiovideo)!=null&&n.partial)}function Yg(i){return`${i.type}_${i.level}_${i.sn}`}function Q7(i,e){return i.filter(t=>{const n=e(t);return n||t.clearElementaryStreamInfo(),n})}var ap={cbc:0,ctr:1};class eme{constructor(e,t,n){this.subtle=void 0,this.aesIV=void 0,this.aesMode=void 0,this.subtle=e,this.aesIV=t,this.aesMode=n}decrypt(e,t){switch(this.aesMode){case ap.cbc:return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e);case ap.ctr:return this.subtle.decrypt({name:"AES-CTR",counter:this.aesIV,length:64},t,e);default:throw new Error(`[AESCrypto] invalid aes mode ${this.aesMode}`)}}}function tme(i){const e=i.byteLength,t=e&&new DataView(i.buffer).getUint8(e-1);return t?i.slice(0,e-t):i}class nme{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(e){const t=new DataView(e),n=new Uint32Array(4);for(let r=0;r<4;r++)n[r]=t.getUint32(r*4);return n}initTable(){const e=this.sBox,t=this.invSBox,n=this.subMix,r=n[0],s=n[1],o=n[2],a=n[3],l=this.invSubMix,c=l[0],u=l[1],h=l[2],f=l[3],d=new Uint32Array(256);let m=0,A=0,g=0;for(g=0;g<256;g++)g<128?d[g]=g<<1:d[g]=g<<1^283;for(g=0;g<256;g++){let y=A^A<<1^A<<2^A<<3^A<<4;y=y>>>8^y&255^99,e[m]=y,t[y]=m;const E=d[m],x=d[E],C=d[x];let T=d[y]*257^y*16843008;r[m]=T<<24|T>>>8,s[m]=T<<16|T>>>16,o[m]=T<<8|T>>>24,a[m]=T,T=C*16843009^x*65537^E*257^m*16843008,c[y]=T<<24|T>>>8,u[y]=T<<16|T>>>16,h[y]=T<<8|T>>>24,f[y]=T,m?(m=E^d[d[d[C^E]]],A^=d[d[A]]):m=A=1}}expandKey(e){const t=this.uint8ArrayToUint32Array_(e);let n=!0,r=0;for(;r<t.length&&n;)n=t[r]===this.key[r],r++;if(n)return;this.key=t;const s=this.keySize=t.length;if(s!==4&&s!==6&&s!==8)throw new Error("Invalid aes key size="+s);const o=this.ksRows=(s+6+1)*4;let a,l;const c=this.keySchedule=new Uint32Array(o),u=this.invKeySchedule=new Uint32Array(o),h=this.sBox,f=this.rcon,d=this.invSubMix,m=d[0],A=d[1],g=d[2],y=d[3];let E,x;for(a=0;a<o;a++){if(a<s){E=c[a]=t[a];continue}x=E,a%s===0?(x=x<<8|x>>>24,x=h[x>>>24]<<24|h[x>>>16&255]<<16|h[x>>>8&255]<<8|h[x&255],x^=f[a/s|0]<<24):s>6&&a%s===4&&(x=h[x>>>24]<<24|h[x>>>16&255]<<16|h[x>>>8&255]<<8|h[x&255]),c[a]=E=(c[a-s]^x)>>>0}for(l=0;l<o;l++)a=o-l,l&3?x=c[a]:x=c[a-4],l<4||a<=4?u[l]=x:u[l]=m[h[x>>>24]]^A[h[x>>>16&255]]^g[h[x>>>8&255]]^y[h[x&255]],u[l]=u[l]>>>0}networkToHostOrderSwap(e){return e<<24|(e&65280)<<8|(e&16711680)>>8|e>>>24}decrypt(e,t,n){const r=this.keySize+6,s=this.invKeySchedule,o=this.invSBox,a=this.invSubMix,l=a[0],c=a[1],u=a[2],h=a[3],f=this.uint8ArrayToUint32Array_(n);let d=f[0],m=f[1],A=f[2],g=f[3];const y=new Int32Array(e),E=new Int32Array(y.length);let x,C,T,I,M,L,R,P,F,k,z,U,W,$;const oe=this.networkToHostOrderSwap;for(;t<y.length;){for(F=oe(y[t]),k=oe(y[t+1]),z=oe(y[t+2]),U=oe(y[t+3]),M=F^s[0],L=U^s[1],R=z^s[2],P=k^s[3],W=4,$=1;$<r;$++)x=l[M>>>24]^c[L>>16&255]^u[R>>8&255]^h[P&255]^s[W],C=l[L>>>24]^c[R>>16&255]^u[P>>8&255]^h[M&255]^s[W+1],T=l[R>>>24]^c[P>>16&255]^u[M>>8&255]^h[L&255]^s[W+2],I=l[P>>>24]^c[M>>16&255]^u[L>>8&255]^h[R&255]^s[W+3],M=x,L=C,R=T,P=I,W=W+4;x=o[M>>>24]<<24^o[L>>16&255]<<16^o[R>>8&255]<<8^o[P&255]^s[W],C=o[L>>>24]<<24^o[R>>16&255]<<16^o[P>>8&255]<<8^o[M&255]^s[W+1],T=o[R>>>24]<<24^o[P>>16&255]<<16^o[M>>8&255]<<8^o[L&255]^s[W+2],I=o[P>>>24]<<24^o[M>>16&255]<<16^o[L>>8&255]<<8^o[R&255]^s[W+3],E[t]=oe(x^d),E[t+1]=oe(I^m),E[t+2]=oe(T^A),E[t+3]=oe(C^g),d=F,m=k,A=z,g=U,t=t+4}return E.buffer}}class ime{constructor(e,t,n){this.subtle=void 0,this.key=void 0,this.aesMode=void 0,this.subtle=e,this.key=t,this.aesMode=n}expandKey(){const e=rme(this.aesMode);return this.subtle.importKey("raw",this.key,{name:e},!1,["encrypt","decrypt"])}}function rme(i){switch(i){case ap.cbc:return"AES-CBC";case ap.ctr:return"AES-CTR";default:throw new Error(`[FastAESKey] invalid aes mode ${i}`)}}const sme=16;class OR{constructor(e,{removePKCS7Padding:t=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.enableSoftwareAES=void 0,this.enableSoftwareAES=e.enableSoftwareAES,this.removePKCS7Padding=t,t)try{const n=self.crypto;n&&(this.subtle=n.subtle||n.webkitSubtle)}catch{}this.useSoftware=!this.subtle}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:e,remainderData:t}=this;if(!e||t)return this.reset(),null;const n=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?tme(n):n}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(e,t,n,r){return this.useSoftware?new Promise((s,o)=>{const a=ArrayBuffer.isView(e)?e:new Uint8Array(e);this.softwareDecrypt(a,t,n,r);const l=this.flush();l?s(l.buffer):o(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(e),t,n,r)}softwareDecrypt(e,t,n,r){const{currentIV:s,currentResult:o,remainderData:a}=this;if(r!==ap.cbc||t.byteLength!==16)return Ki.warn("SoftwareDecrypt: can only handle AES-128-CBC"),null;this.logOnce("JS AES decrypt"),a&&(e=Ac(a,e),this.remainderData=null);const l=this.getValidChunk(e);if(!l.length)return null;s&&(n=s);let c=this.softwareDecrypter;c||(c=this.softwareDecrypter=new nme),c.expandKey(t);const u=o;return this.currentResult=c.decrypt(l.buffer,0,n),this.currentIV=l.slice(-16).buffer,u||null}webCryptoDecrypt(e,t,n,r){if(this.key!==t||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(e,t,n,r));this.key=t,this.fastAesKey=new ime(this.subtle,t,r)}return this.fastAesKey.expandKey().then(s=>this.subtle?(this.logOnce("WebCrypto AES decrypt"),new eme(this.subtle,new Uint8Array(n),r).decrypt(e.buffer,s)):Promise.reject(new Error("web crypto not initialized"))).catch(s=>(Ki.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${s.name}: ${s.message}`),this.onWebCryptoError(e,t,n,r)))}onWebCryptoError(e,t,n,r){const s=this.enableSoftwareAES;if(s){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,n,r);const o=this.flush();if(o)return o.buffer}throw new Error("WebCrypto"+(s?" and softwareDecrypt":"")+": failed to decrypt data")}getValidChunk(e){let t=e;const n=e.length-e.length%sme;return n!==e.length&&(t=e.slice(0,n),this.remainderData=e.slice(n)),t}logOnce(e){this.logEnabled&&(Ki.log(`[decrypter]: ${e}`),this.logEnabled=!1)}}const V7=Math.pow(2,17);class ome{constructor(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(e,t){const n=e.url;if(!n)return Promise.reject(new Ef({type:rn.NETWORK_ERROR,details:Ke.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error(`Fragment does not have a ${n?"part list":"url"}`),networkDetails:null}));this.abort();const r=this.config,s=r.fLoader,o=r.loader;return new Promise((a,l)=>{if(this.loader&&this.loader.destroy(),e.gap)if(e.tagList.some(m=>m[0]==="GAP")){l(j7(e));return}else e.gap=!1;const c=this.loader=s?new s(r):new o(r),u=W7(e);e.loader=c;const h=H7(r.fragLoadPolicy.default),f={loadPolicy:h,timeout:h.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:e.sn==="initSegment"?1/0:V7};e.stats=c.stats;const d={onSuccess:(m,A,g,y)=>{this.resetLoader(e,c);let E=m.data;g.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(E.slice(0,16)),E=E.slice(16)),a({frag:e,part:null,payload:E,networkDetails:y})},onError:(m,A,g,y)=>{this.resetLoader(e,c),l(new Ef({type:rn.NETWORK_ERROR,details:Ke.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:Qi({url:n,data:void 0},m),error:new Error(`HTTP Error ${m.code} ${m.text}`),networkDetails:g,stats:y}))},onAbort:(m,A,g)=>{this.resetLoader(e,c),l(new Ef({type:rn.NETWORK_ERROR,details:Ke.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:g,stats:m}))},onTimeout:(m,A,g)=>{this.resetLoader(e,c),l(new Ef({type:rn.NETWORK_ERROR,details:Ke.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error(`Timeout after ${f.timeout}ms`),networkDetails:g,stats:m}))}};t&&(d.onProgress=(m,A,g,y)=>t({frag:e,part:null,payload:g,networkDetails:y})),c.load(u,f,d)})}loadPart(e,t,n){this.abort();const r=this.config,s=r.fLoader,o=r.loader;return new Promise((a,l)=>{if(this.loader&&this.loader.destroy(),e.gap||t.gap){l(j7(e,t));return}const c=this.loader=s?new s(r):new o(r),u=W7(e,t);e.loader=c;const h=H7(r.fragLoadPolicy.default),f={loadPolicy:h,timeout:h.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:V7};t.stats=c.stats,c.load(u,f,{onSuccess:(d,m,A,g)=>{this.resetLoader(e,c),this.updateStatsFromPart(e,t);const y={frag:e,part:t,payload:d.data,networkDetails:g};n(y),a(y)},onError:(d,m,A,g)=>{this.resetLoader(e,c),l(new Ef({type:rn.NETWORK_ERROR,details:Ke.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:Qi({url:u.url,data:void 0},d),error:new Error(`HTTP Error ${d.code} ${d.text}`),networkDetails:A,stats:g}))},onAbort:(d,m,A)=>{e.stats.aborted=t.stats.aborted,this.resetLoader(e,c),l(new Ef({type:rn.NETWORK_ERROR,details:Ke.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,error:new Error("Aborted"),networkDetails:A,stats:d}))},onTimeout:(d,m,A)=>{this.resetLoader(e,c),l(new Ef({type:rn.NETWORK_ERROR,details:Ke.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,error:new Error(`Timeout after ${f.timeout}ms`),networkDetails:A,stats:d}))}})})}updateStatsFromPart(e,t){const n=e.stats,r=t.stats,s=r.total;if(n.loaded+=r.loaded,s){const l=Math.round(e.duration/t.duration),c=Math.min(Math.round(n.loaded/s),l),h=(l-c)*Math.round(n.loaded/c);n.total=n.loaded+h}else n.total=Math.max(n.loaded,n.total);const o=n.loading,a=r.loading;o.start?o.first+=a.first-a.start:(o.start=a.start,o.first=a.first),o.end=a.end}resetLoader(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()}}function W7(i,e=null){const t=e||i,n={frag:i,part:e,responseType:"arraybuffer",url:t.url,headers:{},rangeStart:0,rangeEnd:0},r=t.byteRangeStartOffset,s=t.byteRangeEndOffset;if(Wt(r)&&Wt(s)){var o;let a=r,l=s;if(i.sn==="initSegment"&&ame((o=i.decryptdata)==null?void 0:o.method)){const c=s-r;c%16&&(l=s+(16-c%16)),r!==0&&(n.resetIV=!0,a=r-16)}n.rangeStart=a,n.rangeEnd=l}return n}function j7(i,e){const t=new Error(`GAP ${i.gap?"tag":"attribute"} found`),n={type:rn.MEDIA_ERROR,details:Ke.FRAG_GAP,fatal:!1,frag:i,error:t,networkDetails:null};return e&&(n.part=e),(e||i).stats.aborted=!0,new Ef(n)}function ame(i){return i==="AES-128"||i==="AES-256"}class Ef extends Error{constructor(e){super(e.error.message),this.data=void 0,this.data=e}}class QQ extends _c{constructor(e,t){super(e,t),this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(e){return this._tickInterval?!1:(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)}clearInterval(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1}clearNextTick(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1}tick(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}class A4{constructor(e,t,n,r=0,s=-1,o=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=$3(),this.buffering={audio:$3(),video:$3(),audiovideo:$3()},this.level=e,this.sn=t,this.id=n,this.size=r,this.part=s,this.partial=o}}function $3(){return{start:0,executeStart:0,executeEnd:0,end:0}}const K7={length:0,start:()=>0,end:()=>0};class jn{static isBuffered(e,t){if(e){const n=jn.getBuffered(e);for(let r=n.length;r--;)if(t>=n.start(r)&&t<=n.end(r))return!0}return!1}static bufferedRanges(e){if(e){const t=jn.getBuffered(e);return jn.timeRangesToArray(t)}return[]}static timeRangesToArray(e){const t=[];for(let n=0;n<e.length;n++)t.push({start:e.start(n),end:e.end(n)});return t}static bufferInfo(e,t,n){if(e){const r=jn.bufferedRanges(e);if(r.length)return jn.bufferedInfo(r,t,n)}return{len:0,start:t,end:t,bufferedIndex:-1}}static bufferedInfo(e,t,n){t=Math.max(0,t),e.length>1&&e.sort((u,h)=>u.start-h.start||h.end-u.end);let r=-1,s=[];if(n)for(let u=0;u<e.length;u++){t>=e[u].start&&t<=e[u].end&&(r=u);const h=s.length;if(h){const f=s[h-1].end;e[u].start-f<n?e[u].end>f&&(s[h-1].end=e[u].end):s.push(e[u])}else s.push(e[u])}else s=e;let o=0,a,l=t,c=t;for(let u=0;u<s.length;u++){const h=s[u].start,f=s[u].end;if(r===-1&&t>=h&&t<=f&&(r=u),t+n>=h&&t<f)l=h,c=f,o=c-t;else if(t+n<h){a=h;break}}return{len:o,start:l||0,end:c||0,nextStart:a,buffered:e,bufferedIndex:r}}static getBuffered(e){try{return e.buffered||K7}catch(t){return Ki.log("failed to get media.buffered",t),K7}}}const VQ=/\{\$([a-zA-Z0-9-_]+)\}/g;function $7(i){return VQ.test(i)}function y5(i,e){if(i.variableList!==null||i.hasVariableRefs){const t=i.variableList;return e.replace(VQ,n=>{const r=n.substring(2,n.length-1),s=t==null?void 0:t[r];return s===void 0?(i.playlistParsingError||(i.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${r}"`)),n):s})}return e}function Y7(i,e,t){let n=i.variableList;n||(i.variableList=n={});let r,s;if("QUERYPARAM"in e){r=e.QUERYPARAM;try{const o=new self.URL(t).searchParams;if(o.has(r))s=o.get(r);else throw new Error(`"${r}" does not match any query parameter in URI: "${t}"`)}catch(o){i.playlistParsingError||(i.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${o.message}`))}}else r=e.NAME,s=e.VALUE;r in n?i.playlistParsingError||(i.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${r}"`)):n[r]=s||""}function lme(i,e,t){const n=e.IMPORT;if(t&&n in t){let r=i.variableList;r||(i.variableList=r={}),r[n]=t[n]}else i.playlistParsingError||(i.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${n}"`))}const cme=/^(\d+)x(\d+)$/,X7=/(.+?)=(".*?"|.*?)(?:,|$)/g;class Br{constructor(e,t){typeof e=="string"&&(e=Br.parseAttrList(e,t)),er(this,e)}get clientAttrs(){return Object.keys(this).filter(e=>e.substring(0,2)==="X-")}decimalInteger(e){const t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}hexadecimalInteger(e){if(this[e]){let t=(this[e]||"0x").slice(2);t=(t.length&1?"0":"")+t;const n=new Uint8Array(t.length/2);for(let r=0;r<t.length/2;r++)n[r]=parseInt(t.slice(r*2,r*2+2),16);return n}return null}hexadecimalIntegerAsNumber(e){const t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}decimalFloatingPoint(e){return parseFloat(this[e])}optionalFloat(e,t){const n=this[e];return n?parseFloat(n):t}enumeratedString(e){return this[e]}enumeratedStringList(e,t){const n=this[e];return(n?n.split(/[ ,]+/):[]).reduce((r,s)=>(r[s.toLowerCase()]=!0,r),t)}bool(e){return this[e]==="YES"}decimalResolution(e){const t=cme.exec(this[e]);if(t!==null)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}static parseAttrList(e,t){let n;const r={};for(X7.lastIndex=0;(n=X7.exec(e))!==null;){const o=n[1].trim();let a=n[2];const l=a.indexOf('"')===0&&a.lastIndexOf('"')===a.length-1;let c=!1;if(l)a=a.slice(1,-1);else switch(o){case"IV":case"SCTE35-CMD":case"SCTE35-IN":case"SCTE35-OUT":c=!0}if(t&&(l||c))a=y5(t,a);else if(!c&&!l)switch(o){case"CLOSED-CAPTIONS":if(a==="NONE")break;case"ALLOWED-CPC":case"CLASS":case"ASSOC-LANGUAGE":case"AUDIO":case"BYTERANGE":case"CHANNELS":case"CHARACTERISTICS":case"CODECS":case"DATA-ID":case"END-DATE":case"GROUP-ID":case"ID":case"IMPORT":case"INSTREAM-ID":case"KEYFORMAT":case"KEYFORMATVERSIONS":case"LANGUAGE":case"NAME":case"PATHWAY-ID":case"QUERYPARAM":case"RECENTLY-REMOVED-DATERANGES":case"SERVER-URI":case"STABLE-RENDITION-ID":case"STABLE-VARIANT-ID":case"START-DATE":case"SUBTITLES":case"SUPPLEMENTAL-CODECS":case"URI":case"VALUE":case"VIDEO":case"X-ASSET-LIST":case"X-ASSET-URI":Ki.warn(`${e}: attribute ${o} is missing quotes`)}r[o]=a}return r}}const ume="com.apple.hls.interstitial";function hme(i){return i!=="ID"&&i!=="CLASS"&&i!=="CUE"&&i!=="START-DATE"&&i!=="DURATION"&&i!=="END-DATE"&&i!=="END-ON-NEXT"}function fme(i){return i==="SCTE35-OUT"||i==="SCTE35-IN"||i==="SCTE35-CMD"}class NR{constructor(e,t,n=0){var r;if(this.attr=void 0,this.tagAnchor=void 0,this.tagOrder=void 0,this._startDate=void 0,this._endDate=void 0,this._dateAtEnd=void 0,this._cue=void 0,this._badValueForSameId=void 0,this.tagAnchor=(t==null?void 0:t.tagAnchor)||null,this.tagOrder=(r=t==null?void 0:t.tagOrder)!=null?r:n,t){const s=t.attr;for(const o in s)if(Object.prototype.hasOwnProperty.call(e,o)&&e[o]!==s[o]){Ki.warn(`DATERANGE tag attribute: "${o}" does not match for tags with ID: "${e.ID}"`),this._badValueForSameId=o;break}e=er(new Br({}),s,e)}if(this.attr=e,t?(this._startDate=t._startDate,this._cue=t._cue,this._endDate=t._endDate,this._dateAtEnd=t._dateAtEnd):this._startDate=new Date(e["START-DATE"]),"END-DATE"in this.attr){const s=(t==null?void 0:t.endDate)||new Date(this.attr["END-DATE"]);Wt(s.getTime())&&(this._endDate=s)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get cue(){const e=this._cue;return e===void 0?this._cue=this.attr.enumeratedStringList(this.attr.CUE?"CUE":"X-CUE",{pre:!1,post:!1,once:!1}):e}get startTime(){const{tagAnchor:e}=this;return e===null||e.programDateTime===null?(Ki.warn(`Expected tagAnchor Fragment with PDT set for DateRange "${this.id}": ${e}`),NaN):e.start+(this.startDate.getTime()-e.programDateTime)/1e3}get startDate(){return this._startDate}get endDate(){const e=this._endDate||this._dateAtEnd;if(e)return e;const t=this.duration;return t!==null?this._dateAtEnd=new Date(this._startDate.getTime()+t*1e3):null}get duration(){if("DURATION"in this.attr){const e=this.attr.decimalFloatingPoint("DURATION");if(Wt(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isInterstitial(){return this.class===ume}get isValid(){return!!this.id&&!this._badValueForSameId&&Wt(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)&&(!this.attr.CUE||!this.cue.pre&&!this.cue.post||this.cue.pre!==this.cue.post)&&(!this.isInterstitial||"X-ASSET-URI"in this.attr||"X-ASSET-LIST"in this.attr)}}const dme=10;class WQ{constructor(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.dateRangeTagCount=0,this.live=!0,this.requestScheduled=-1,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.appliedTimelineOffset=void 0,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}reloaded(e){if(!e){this.advanced=!0,this.updated=!0;return}const t=this.lastPartSn-e.lastPartSn,n=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!n||!!t||!this.live,this.advanced=this.endSN>e.endSN||t>0||t===0&&n>0,this.updated||this.advanced?this.misses=Math.floor(e.misses*.6):this.misses=e.misses+1}hasKey(e){return this.encryptedFragments.some(t=>{let n=t.decryptdata;return n||(t.setKeyFormat(e.keyFormat),n=t.decryptdata),!!n&&e.matches(n)})}get hasProgramDateTime(){return this.fragments.length?Wt(this.fragments[this.fragments.length-1].programDateTime):!1}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||dme}get drift(){const e=this.driftEndTime-this.driftStartTime;return e>0?(this.driftEnd-this.driftStart)*1e3/e:1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){return this.fragments.length?this.fragments[this.fragments.length-1].end:0}get fragmentStart(){return this.fragments.length?this.fragments[0].start:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].index:-1}get maxPartIndex(){const e=this.partList;if(e){const t=this.lastPartIndex;if(t!==-1){for(let n=e.length;n--;)if(e[n].index>t)return e[n].index;return t}}return 0}get lastPartSn(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}get expired(){if(this.live&&this.age&&this.misses<3){const e=this.partEnd-this.fragmentStart;return this.age>Math.max(e,this.totalduration)+this.levelTargetDuration}return!1}}function jS(i,e){return i.length===e.length?!i.some((t,n)=>t!==e[n]):!1}function q7(i,e){return!i&&!e?!0:!i||!e?!1:jS(i,e)}function W1(i){return i==="AES-128"||i==="AES-256"||i==="AES-256-CTR"}function UR(i){switch(i){case"AES-128":case"AES-256":return ap.cbc;case"AES-256-CTR":return ap.ctr;default:throw new Error(`invalid full segment method ${i}`)}}function zR(i){return Uint8Array.from(atob(i),e=>e.charCodeAt(0))}function v5(i){return Uint8Array.from(unescape(encodeURIComponent(i)),e=>e.charCodeAt(0))}function pme(i){const e=v5(i).subarray(0,16),t=new Uint8Array(16);return t.set(e,16-e.length),t}function jQ(i){const e=function(n,r,s){const o=n[r];n[r]=n[s],n[s]=o};e(i,0,3),e(i,1,2),e(i,4,5),e(i,6,7)}function KQ(i){const e=i.split(":");let t=null;if(e[0]==="data"&&e.length===2){const n=e[1].split(";"),r=n[n.length-1].split(",");if(r.length===2){const s=r[0]==="base64",o=r[1];s?(n.splice(-1,1),t=zR(o)):t=pme(o)}}return t}const KS=typeof self<"u"?self:void 0;var Dr={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},xo={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function eS(i){switch(i){case xo.FAIRPLAY:return Dr.FAIRPLAY;case xo.PLAYREADY:return Dr.PLAYREADY;case xo.WIDEVINE:return Dr.WIDEVINE;case xo.CLEARKEY:return Dr.CLEARKEY}}function Db(i){switch(i){case Dr.FAIRPLAY:return xo.FAIRPLAY;case Dr.PLAYREADY:return xo.PLAYREADY;case Dr.WIDEVINE:return xo.WIDEVINE;case Dr.CLEARKEY:return xo.CLEARKEY}}function Uv(i){const{drmSystems:e,widevineLicenseUrl:t}=i,n=e?[Dr.FAIRPLAY,Dr.WIDEVINE,Dr.PLAYREADY,Dr.CLEARKEY].filter(r=>!!e[r]):[];return!n[Dr.WIDEVINE]&&t&&n.push(Dr.WIDEVINE),n}const GR=(function(i){return KS!=null&&(i=KS.navigator)!=null&&i.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null})();function mme(i,e,t,n){let r;switch(i){case Dr.FAIRPLAY:r=["cenc","sinf"];break;case Dr.WIDEVINE:case Dr.PLAYREADY:r=["cenc"];break;case Dr.CLEARKEY:r=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${i}`)}return gme(r,e,t,n)}function gme(i,e,t,n){return[{initDataTypes:i,persistentState:n.persistentState||"optional",distinctiveIdentifier:n.distinctiveIdentifier||"optional",sessionTypes:n.sessionTypes||[n.sessionType||"temporary"],audioCapabilities:e.map(s=>({contentType:`audio/mp4; codecs=${s}`,robustness:n.audioRobustness||"",encryptionScheme:n.audioEncryptionScheme||null})),videoCapabilities:t.map(s=>({contentType:`video/mp4; codecs=${s}`,robustness:n.videoRobustness||"",encryptionScheme:n.videoEncryptionScheme||null}))}]}function Ame(i){var e;return!!i&&(i.sessionType==="persistent-license"||!!((e=i.sessionTypes)!=null&&e.some(t=>t==="persistent-license")))}function $Q(i){const e=new Uint16Array(i.buffer,i.byteOffset,i.byteLength/2),t=String.fromCharCode.apply(null,Array.from(e)),n=t.substring(t.indexOf("<"),t.length),o=new DOMParser().parseFromString(n,"text/xml").getElementsByTagName("KID")[0];if(o){const a=o.childNodes[0]?o.childNodes[0].nodeValue:o.getAttribute("VALUE");if(a){const l=zR(a).subarray(0,16);return jQ(l),l}}return null}let Xg={};class Df{static clearKeyUriToKeyIdMap(){Xg={}}static setKeyIdForUri(e,t){Xg[e]=t}static addKeyIdForUri(e){const t=Object.keys(Xg).length%Number.MAX_SAFE_INTEGER,n=new Uint8Array(16);return new DataView(n.buffer,12,4).setUint32(0,t),Xg[e]=n,n}constructor(e,t,n,r=[1],s=null,o){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=t,this.keyFormat=n,this.keyFormatVersions=r,this.iv=s,this.encrypted=e?e!=="NONE":!1,this.isCommonEncryption=this.encrypted&&!W1(e),o!=null&&o.startsWith("0x")&&(this.keyId=new Uint8Array(EQ(o)))}matches(e){return e.uri===this.uri&&e.method===this.method&&e.encrypted===this.encrypted&&e.keyFormat===this.keyFormat&&jS(e.keyFormatVersions,this.keyFormatVersions)&&q7(e.iv,this.iv)&&q7(e.keyId,this.keyId)}isSupported(){if(this.method){if(W1(this.method)||this.method==="NONE")return!0;if(this.keyFormat==="identity")return this.method==="SAMPLE-AES";switch(this.keyFormat){case xo.FAIRPLAY:case xo.WIDEVINE:case xo.PLAYREADY:case xo.CLEARKEY:return["SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1}getDecryptData(e,t){if(!this.encrypted||!this.uri)return null;if(W1(this.method)){let s=this.iv;return s||(typeof e!="number"&&(Ki.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),e=0),s=vme(e)),new Df(this.method,this.uri,"identity",this.keyFormatVersions,s)}if(this.keyId){const s=Xg[this.uri];if(s&&!jS(this.keyId,s)&&Df.setKeyIdForUri(this.uri,this.keyId),this.pssh)return this}const n=KQ(this.uri);if(n)switch(this.keyFormat){case xo.WIDEVINE:if(this.pssh=n,!this.keyId){const s=Cpe(n.buffer);if(s.length){var r;const o=s[0];this.keyId=(r=o.kids)!=null&&r.length?o.kids[0]:null}}this.keyId||(this.keyId=J7(t));break;case xo.PLAYREADY:{const s=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=wpe(s,null,n),this.keyId=$Q(n);break}default:{let s=n.subarray(0,16);if(s.length!==16){const o=new Uint8Array(16);o.set(s,16-s.length),s=o}this.keyId=s;break}}if(!this.keyId||this.keyId.byteLength!==16){let s;s=yme(t),s||(s=J7(t),s||(s=Xg[this.uri])),s&&(this.keyId=s,Df.setKeyIdForUri(this.uri,s))}return this}}function yme(i){const e=i==null?void 0:i[xo.WIDEVINE];return e?e.keyId:null}function J7(i){const e=i==null?void 0:i[xo.PLAYREADY];if(e){const t=KQ(e.uri);if(t)return $Q(t)}return null}function vme(i){const e=new Uint8Array(16);for(let t=12;t<16;t++)e[t]=i>>8*(15-t)&255;return e}const Z7=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,ek=/#EXT-X-MEDIA:(.*)/g,xme=/^#EXT(?:INF|-X-TARGETDURATION):/m,kb=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#.*/.source].join("|"),"g"),Eme=new RegExp([/#EXT-X-(PROGRAM-DATE-TIME|BYTERANGE|DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class Au{static findGroup(e,t){for(let n=0;n<e.length;n++){const r=e[n];if(r.id===t)return r}}static resolve(e,t){return LR.buildAbsoluteURL(t,e,{alwaysNormalize:!0})}static isMediaPlaylist(e){return xme.test(e)}static parseMasterPlaylist(e,t){const n=$7(e),r={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:n},s=[];if(Z7.lastIndex=0,!e.startsWith("#EXTM3U"))return r.playlistParsingError=new Error("no EXTM3U delimiter"),r;let o;for(;(o=Z7.exec(e))!=null;)if(o[1]){var a;const c=new Br(o[1],r),u=y5(r,o[2]),h={attrs:c,bitrate:c.decimalInteger("BANDWIDTH")||c.decimalInteger("AVERAGE-BANDWIDTH"),name:c.NAME,url:Au.resolve(u,t)},f=c.decimalResolution("RESOLUTION");f&&(h.width=f.width,h.height=f.height),ik(c.CODECS,h);const d=c["SUPPLEMENTAL-CODECS"];d&&(h.supplemental={},ik(d,h.supplemental)),(a=h.unknownCodecs)!=null&&a.length||s.push(h),r.levels.push(h)}else if(o[3]){const c=o[3],u=o[4];switch(c){case"SESSION-DATA":{const h=new Br(u,r),f=h["DATA-ID"];f&&(r.sessionData===null&&(r.sessionData={}),r.sessionData[f]=h);break}case"SESSION-KEY":{const h=tk(u,t,r);h.encrypted&&h.isSupported()?(r.sessionKeys===null&&(r.sessionKeys=[]),r.sessionKeys.push(h)):Ki.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${u}"`);break}case"DEFINE":{{const h=new Br(u,r);Y7(r,h,t)}break}case"CONTENT-STEERING":{const h=new Br(u,r);r.contentSteering={uri:Au.resolve(h["SERVER-URI"],t),pathwayId:h["PATHWAY-ID"]||"."};break}case"START":{r.startTimeOffset=nk(u);break}}}const l=s.length>0&&s.length<r.levels.length;return r.levels=l?s:r.levels,r.levels.length===0&&(r.playlistParsingError=new Error("no levels found in manifest")),r}static parseMasterPlaylistMedia(e,t,n){let r;const s={},o=n.levels,a={AUDIO:o.map(c=>({id:c.attrs.AUDIO,audioCodec:c.audioCodec})),SUBTITLES:o.map(c=>({id:c.attrs.SUBTITLES,textCodec:c.textCodec})),"CLOSED-CAPTIONS":[]};let l=0;for(ek.lastIndex=0;(r=ek.exec(e))!==null;){const c=new Br(r[1],n),u=c.TYPE;if(u){const h=a[u],f=s[u]||[];s[u]=f;const d=c.LANGUAGE,m=c["ASSOC-LANGUAGE"],A=c.CHANNELS,g=c.CHARACTERISTICS,y=c["INSTREAM-ID"],E={attrs:c,bitrate:0,id:l++,groupId:c["GROUP-ID"]||"",name:c.NAME||d||"",type:u,default:c.bool("DEFAULT"),autoselect:c.bool("AUTOSELECT"),forced:c.bool("FORCED"),lang:d,url:c.URI?Au.resolve(c.URI,t):""};if(m&&(E.assocLang=m),A&&(E.channels=A),g&&(E.characteristics=g),y&&(E.instreamId=y),h!=null&&h.length){const x=Au.findGroup(h,E.groupId)||h[0];rk(E,x,"audioCodec"),rk(E,x,"textCodec")}f.push(E)}}return s}static parseLevelPlaylist(e,t,n,r,s,o){var a;const l={url:t},c=new WQ(t),u=c.fragments,h=[];let f=null,d=0,m=0,A=0,g=0,y=0,E=null,x=new J_(r,l),C,T,I,M=-1,L=!1,R=null,P;if(kb.lastIndex=0,c.m3u8=e,c.hasVariableRefs=$7(e),((a=kb.exec(e))==null?void 0:a[0])!=="#EXTM3U")return c.playlistParsingError=new Error("Missing format identifier #EXTM3U"),c;for(;(C=kb.exec(e))!==null;){L&&(L=!1,x=new J_(r,l),x.playlistOffset=A,x.setStart(A),x.sn=d,x.cc=g,y&&(x.bitrate=y),x.level=n,f&&(x.initSegment=f,f.rawProgramDateTime&&(x.rawProgramDateTime=f.rawProgramDateTime,f.rawProgramDateTime=null),R&&(x.setByteRange(R),R=null)));const U=C[1];if(U){x.duration=parseFloat(U);const W=(" "+C[2]).slice(1);x.title=W||null,x.tagList.push(W?["INF",U,W]:["INF",U])}else if(C[3]){if(Wt(x.duration)){x.playlistOffset=A,x.setStart(A),I&&ok(x,I,c),x.sn=d,x.level=n,x.cc=g,u.push(x);const W=(" "+C[3]).slice(1);x.relurl=y5(c,W),x5(x,E,h),E=x,A+=x.duration,d++,m=0,L=!0}}else{if(C=C[0].match(Eme),!C){Ki.warn("No matches on slow regex match for level playlist!");continue}for(T=1;T<C.length&&C[T]===void 0;T++);const W=(" "+C[T]).slice(1),$=(" "+C[T+1]).slice(1),oe=C[T+2]?(" "+C[T+2]).slice(1):null;switch(W){case"BYTERANGE":E?x.setByteRange($,E):x.setByteRange($);break;case"PROGRAM-DATE-TIME":x.rawProgramDateTime=$,x.tagList.push(["PROGRAM-DATE-TIME",$]),M===-1&&(M=u.length);break;case"PLAYLIST-TYPE":c.type&&pf(c,W,C),c.type=$.toUpperCase();break;case"MEDIA-SEQUENCE":c.startSN!==0?pf(c,W,C):u.length>0&&ak(c,W,C),d=c.startSN=parseInt($);break;case"SKIP":{c.skippedSegments&&pf(c,W,C);const X=new Br($,c),Q=X.decimalInteger("SKIPPED-SEGMENTS");if(Wt(Q)){c.skippedSegments+=Q;for(let O=Q;O--;)u.push(null);d+=Q}const Y=X.enumeratedString("RECENTLY-REMOVED-DATERANGES");Y&&(c.recentlyRemovedDateranges=(c.recentlyRemovedDateranges||[]).concat(Y.split("	")));break}case"TARGETDURATION":c.targetduration!==0&&pf(c,W,C),c.targetduration=Math.max(parseInt($),1);break;case"VERSION":c.version!==null&&pf(c,W,C),c.version=parseInt($);break;case"INDEPENDENT-SEGMENTS":break;case"ENDLIST":c.live||pf(c,W,C),c.live=!1;break;case"#":($||oe)&&x.tagList.push(oe?[$,oe]:[$]);break;case"DISCONTINUITY":g++,x.tagList.push(["DIS"]);break;case"GAP":x.gap=!0,x.tagList.push([W]);break;case"BITRATE":x.tagList.push([W,$]),y=parseInt($)*1e3,Wt(y)?x.bitrate=y:y=0;break;case"DATERANGE":{const X=new Br($,c),Q=new NR(X,c.dateRanges[X.ID],c.dateRangeTagCount);c.dateRangeTagCount++,Q.isValid||c.skippedSegments?c.dateRanges[Q.id]=Q:Ki.warn(`Ignoring invalid DATERANGE tag: "${$}"`),x.tagList.push(["EXT-X-DATERANGE",$]);break}case"DEFINE":{{const X=new Br($,c);"IMPORT"in X?lme(c,X,o):Y7(c,X,t)}break}case"DISCONTINUITY-SEQUENCE":c.startCC!==0?pf(c,W,C):u.length>0&&ak(c,W,C),c.startCC=g=parseInt($);break;case"KEY":{const X=tk($,t,c);if(X.isSupported()){if(X.method==="NONE"){I=void 0;break}I||(I={});const Q=I[X.keyFormat];Q!=null&&Q.matches(X)||(Q&&(I=er({},I)),I[X.keyFormat]=X)}else Ki.warn(`[Keys] Ignoring unsupported EXT-X-KEY tag: "${$}"`);break}case"START":c.startTimeOffset=nk($);break;case"MAP":{const X=new Br($,c);if(x.duration){const Q=new J_(r,l);sk(Q,X,n,I),f=Q,x.initSegment=f,f.rawProgramDateTime&&!x.rawProgramDateTime&&(x.rawProgramDateTime=f.rawProgramDateTime)}else{const Q=x.byteRangeEndOffset;if(Q){const Y=x.byteRangeStartOffset;R=`${Q-Y}@${Y}`}else R=null;sk(x,X,n,I),f=x,L=!0}f.cc=g;break}case"SERVER-CONTROL":{P&&pf(c,W,C),P=new Br($),c.canBlockReload=P.bool("CAN-BLOCK-RELOAD"),c.canSkipUntil=P.optionalFloat("CAN-SKIP-UNTIL",0),c.canSkipDateRanges=c.canSkipUntil>0&&P.bool("CAN-SKIP-DATERANGES"),c.partHoldBack=P.optionalFloat("PART-HOLD-BACK",0),c.holdBack=P.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{c.partTarget&&pf(c,W,C);const X=new Br($);c.partTarget=X.decimalFloatingPoint("PART-TARGET");break}case"PART":{let X=c.partList;X||(X=c.partList=[]);const Q=m>0?X[X.length-1]:void 0,Y=m++,O=new Br($,c),K=new _Q(O,x,l,Y,Q);X.push(K),x.duration+=K.duration;break}case"PRELOAD-HINT":{const X=new Br($,c);c.preloadHint=X;break}case"RENDITION-REPORT":{const X=new Br($,c);c.renditionReports=c.renditionReports||[],c.renditionReports.push(X);break}default:Ki.warn(`line parsed but not handled: ${C}`);break}}}E&&!E.relurl?(u.pop(),A-=E.duration,c.partList&&(c.fragmentHint=E)):c.partList&&(x5(x,E,h),x.cc=g,c.fragmentHint=x,I&&ok(x,I,c)),c.targetduration||(c.playlistParsingError=new Error("Missing Target Duration"));const F=u.length,k=u[0],z=u[F-1];if(A+=c.skippedSegments*c.targetduration,A>0&&F&&z){c.averagetargetduration=A/F;const U=z.sn;c.endSN=U!=="initSegment"?U:0,c.live||(z.endList=!0),M>0&&(Sme(u,M),k&&h.unshift(k))}return c.fragmentHint&&(A+=c.fragmentHint.duration),c.totalduration=A,h.length&&c.dateRangeTagCount&&k&&YQ(h,c),c.endCC=g,c}}function YQ(i,e){let t=i.length;if(!t)if(e.hasProgramDateTime){const a=e.fragments[e.fragments.length-1];i.push(a),t++}else return;const n=i[t-1],r=e.live?1/0:e.totalduration,s=Object.keys(e.dateRanges);for(let a=s.length;a--;){const l=e.dateRanges[s[a]],c=l.startDate.getTime();l.tagAnchor=n.ref;for(let u=t;u--;){var o;if(((o=i[u])==null?void 0:o.sn)<e.startSN)break;const h=_me(e,c,i,u,r);if(h!==-1){l.tagAnchor=e.fragments[h].ref;break}}}}function _me(i,e,t,n,r){const s=t[n];if(s){const a=s.programDateTime;if(e>=a||n===0){var o;const l=(((o=t[n+1])==null?void 0:o.start)||r)-s.start;if(e<=a+l*1e3){const c=t[n].sn-i.startSN;if(c<0)return-1;const u=i.fragments;if(u.length>t.length){const f=(t[n+1]||u[u.length-1]).sn-i.startSN;for(let d=f;d>c;d--){const m=u[d].programDateTime;if(e>=m&&e<m+u[d].duration*1e3)return d}}return c}}}return-1}function tk(i,e,t){var n,r;const s=new Br(i,t),o=(n=s.METHOD)!=null?n:"",a=s.URI,l=s.hexadecimalInteger("IV"),c=s.KEYFORMATVERSIONS,u=(r=s.KEYFORMAT)!=null?r:"identity";a&&s.IV&&!l&&Ki.error(`Invalid IV: ${s.IV}`);const h=a?Au.resolve(a,e):"",f=(c||"1").split("/").map(Number).filter(Number.isFinite);return new Df(o,h,u,f,l,s.KEYID)}function nk(i){const t=new Br(i).decimalFloatingPoint("TIME-OFFSET");return Wt(t)?t:null}function ik(i,e){let t=(i||"").split(/[ ,]+/).filter(n=>n);["video","audio","text"].forEach(n=>{const r=t.filter(s=>DR(s,n));r.length&&(e[`${n}Codec`]=r.map(s=>s.split("/")[0]).join(","),t=t.filter(s=>r.indexOf(s)===-1))}),e.unknownCodecs=t}function rk(i,e,t){const n=e[t];n&&(i[t]=n)}function Sme(i,e){let t=i[e];for(let n=e;n--;){const r=i[n];if(!r)return;r.programDateTime=t.programDateTime-r.duration*1e3,t=r}}function x5(i,e,t){i.rawProgramDateTime?t.push(i):e!=null&&e.programDateTime&&(i.programDateTime=e.endProgramDateTime)}function sk(i,e,t,n){i.relurl=e.URI,e.BYTERANGE&&i.setByteRange(e.BYTERANGE),i.level=t,i.sn="initSegment",n&&(i.levelkeys=n),i.initSegment=null}function ok(i,e,t){i.levelkeys=e;const{encryptedFragments:n}=t;(!n.length||n[n.length-1].levelkeys!==e)&&Object.keys(e).some(r=>e[r].isCommonEncryption)&&n.push(i)}function pf(i,e,t){i.playlistParsingError=new Error(`#EXT-X-${e} must not appear more than once (${t[0]})`)}function ak(i,e,t){i.playlistParsingError=new Error(`#EXT-X-${e} must appear before the first Media Segment (${t[0]})`)}function Fb(i,e){const t=e.startPTS;if(Wt(t)){let n=0,r;e.sn>i.sn?(n=t-i.start,r=i):(n=i.start-t,r=e),r.duration!==n&&r.setDuration(n)}else e.sn>i.sn?i.cc===e.cc&&i.minEndPTS?e.setStart(i.start+(i.minEndPTS-i.start)):e.setStart(i.start+i.duration):e.setStart(Math.max(i.start-e.duration,0))}function XQ(i,e,t,n,r,s,o){n-t<=0&&(o.warn("Fragment should have a positive duration",e),n=t+e.duration,s=r+e.duration);let l=t,c=n;const u=e.startPTS,h=e.endPTS;if(Wt(u)){const y=Math.abs(u-t);i&&y>i.totalduration?o.warn(`media timestamps and playlist times differ by ${y}s for level ${e.level} ${i.url}`):Wt(e.deltaPTS)?e.deltaPTS=Math.max(y,e.deltaPTS):e.deltaPTS=y,l=Math.max(t,u),t=Math.min(t,u),r=e.startDTS!==void 0?Math.min(r,e.startDTS):r,c=Math.min(n,h),n=Math.max(n,h),s=e.endDTS!==void 0?Math.max(s,e.endDTS):s}const f=t-e.start;e.start!==0&&e.setStart(t),e.setDuration(n-e.start),e.startPTS=t,e.maxStartPTS=l,e.startDTS=r,e.endPTS=n,e.minEndPTS=c,e.endDTS=s;const d=e.sn;if(!i||d<i.startSN||d>i.endSN)return 0;let m;const A=d-i.startSN,g=i.fragments;for(g[A]=e,m=A;m>0;m--)Fb(g[m],g[m-1]);for(m=A;m<g.length-1;m++)Fb(g[m],g[m+1]);return i.fragmentHint&&Fb(g[g.length-1],i.fragmentHint),i.PTSKnown=i.alignedSliding=!0,f}function wme(i,e,t){if(i===e)return;let n=null;const r=i.fragments;for(let u=r.length-1;u>=0;u--){const h=r[u].initSegment;if(h){n=h;break}}i.fragmentHint&&delete i.fragmentHint.endPTS;let s;bme(i,e,(u,h,f,d)=>{if((!e.startCC||e.skippedSegments)&&h.cc!==u.cc){const m=u.cc-h.cc;for(let A=f;A<d.length;A++)d[A].cc+=m;e.endCC=d[d.length-1].cc}Wt(u.startPTS)&&Wt(u.endPTS)&&(h.setStart(h.startPTS=u.startPTS),h.startDTS=u.startDTS,h.maxStartPTS=u.maxStartPTS,h.endPTS=u.endPTS,h.endDTS=u.endDTS,h.minEndPTS=u.minEndPTS,h.setDuration(u.endPTS-u.startPTS),h.duration&&(s=h),e.PTSKnown=e.alignedSliding=!0),u.hasStreams&&(h.elementaryStreams=u.elementaryStreams),h.loader=u.loader,u.hasStats&&(h.stats=u.stats),u.initSegment&&(h.initSegment=u.initSegment,n=u.initSegment)});const o=e.fragments,a=e.fragmentHint?o.concat(e.fragmentHint):o;if(n&&a.forEach(u=>{var h;u&&(!u.initSegment||u.initSegment.relurl===((h=n)==null?void 0:h.relurl))&&(u.initSegment=n)}),e.skippedSegments){if(e.deltaUpdateFailed=o.some(u=>!u),e.deltaUpdateFailed){t.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let u=e.skippedSegments;u--;)o.shift();e.startSN=o[0].sn}else{e.canSkipDateRanges&&(e.dateRanges=Cme(i.dateRanges,e,t));const u=i.fragments.filter(h=>h.rawProgramDateTime);if(i.hasProgramDateTime&&!e.hasProgramDateTime)for(let h=1;h<a.length;h++)a[h].programDateTime===null&&x5(a[h],a[h-1],u);YQ(u,e)}e.endCC=o[o.length-1].cc}if(!e.startCC){var l;const u=ZQ(i,e.startSN-1);e.startCC=(l=u==null?void 0:u.cc)!=null?l:o[0].cc}Tme(i.partList,e.partList,(u,h)=>{h.elementaryStreams=u.elementaryStreams,h.stats=u.stats}),s?XQ(e,s,s.startPTS,s.endPTS,s.startDTS,s.endDTS,t):qQ(i,e),o.length&&(e.totalduration=e.edge-o[0].start),e.driftStartTime=i.driftStartTime,e.driftStart=i.driftStart;const c=e.advancedDateTime;if(e.advanced&&c){const u=e.edge;e.driftStart||(e.driftStartTime=c,e.driftStart=u),e.driftEndTime=c,e.driftEnd=u}else e.driftEndTime=i.driftEndTime,e.driftEnd=i.driftEnd,e.advancedDateTime=i.advancedDateTime;e.requestScheduled===-1&&(e.requestScheduled=i.requestScheduled)}function Cme(i,e,t){const{dateRanges:n,recentlyRemovedDateranges:r}=e,s=er({},i);r&&r.forEach(l=>{delete s[l]});const a=Object.keys(s).length;return a?(Object.keys(n).forEach(l=>{const c=s[l],u=new NR(n[l].attr,c);u.isValid?(s[l]=u,c||(u.tagOrder+=a)):t.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${lr(n[l].attr)}"`)}),s):n}function Tme(i,e,t){if(i&&e){let n=0;for(let r=0,s=i.length;r<=s;r++){const o=i[r],a=e[r+n];o&&a&&o.index===a.index&&o.fragment.sn===a.fragment.sn?t(o,a):n--}}}function bme(i,e,t){const n=e.skippedSegments,r=Math.max(i.startSN,e.startSN)-e.startSN,s=(i.fragmentHint?1:0)+(n?e.endSN:Math.min(i.endSN,e.endSN))-e.startSN,o=e.startSN-i.startSN,a=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,l=i.fragmentHint?i.fragments.concat(i.fragmentHint):i.fragments;for(let c=r;c<=s;c++){const u=l[o+c];let h=a[c];if(n&&!h&&u&&(h=e.fragments[c]=u),u&&h){t(u,h,c,a);const f=u.relurl,d=h.relurl;if(f&&Ime(f,d)){e.playlistParsingError=lk(`media sequence mismatch ${h.sn}:`,i,e,u,h);return}else if(u.cc!==h.cc){e.playlistParsingError=lk(`discontinuity sequence mismatch (${u.cc}!=${h.cc})`,i,e,u,h);return}}}}function lk(i,e,t,n,r){return new Error(`${i} ${r.url}
Playlist starting @${e.startSN}
${e.m3u8}

Playlist starting @${t.startSN}
${t.m3u8}`)}function qQ(i,e,t=!0){const n=e.startSN+e.skippedSegments-i.startSN,r=i.fragments,s=n>=0;let o=0;if(s&&n<r.length)o=r[n].start;else if(s&&e.startSN===i.endSN+1)o=i.fragmentEnd;else if(s&&t)o=i.fragmentStart+n*e.levelTargetDuration;else if(!e.skippedSegments&&e.fragmentStart===0)o=i.fragmentStart;else return;E5(e,o)}function E5(i,e){if(e){const t=i.fragments;for(let n=i.skippedSegments;n<t.length;n++)t[n].addStart(e);i.fragmentHint&&i.fragmentHint.addStart(e)}}function JQ(i,e=1/0){let t=1e3*i.targetduration;if(i.updated){const n=i.fragments;if(n.length&&t*4>e){const s=n[n.length-1].duration*1e3;s<t&&(t=s)}}else t/=2;return Math.round(t)}function ZQ(i,e,t){if(!i)return null;let n=i.fragments[e-i.startSN];return n||(n=i.fragmentHint,n&&n.sn===e)?n:e<i.startSN&&t&&t.sn===e?t:null}function ck(i,e,t){return i?eV(i.partList,e,t):null}function eV(i,e,t){if(i)for(let n=i.length;n--;){const r=i[n];if(r.index===t&&r.fragment.sn===e)return r}return null}function tV(i){i.forEach((e,t)=>{var n;(n=e.details)==null||n.fragments.forEach(r=>{r.level=t,r.initSegment&&(r.initSegment.level=t)})})}function Ime(i,e){return i!==e&&e?uk(i)!==uk(e):!1}function uk(i){return i.replace(/\?[^?]*$/,"")}function a2(i,e){for(let n=0,r=i.length;n<r;n++){var t;if(((t=i[n])==null?void 0:t.cc)===e)return i[n]}return null}function Mme(i,e){return!!(i&&e.startCC<i.endCC&&e.endCC>i.startCC)}function hk(i,e){const t=i.start+e;i.startPTS=t,i.setStart(t),i.endPTS=t+i.duration}function nV(i,e){const t=e.fragments;for(let n=0,r=t.length;n<r;n++)hk(t[n],i);e.fragmentHint&&hk(e.fragmentHint,i),e.alignedSliding=!0}function Rme(i,e){i&&(iV(e,i),e.alignedSliding||$S(e,i),!e.alignedSliding&&!e.skippedSegments&&qQ(i,e,!1))}function iV(i,e){if(!Mme(e,i))return;const t=Math.min(e.endCC,i.endCC),n=a2(e.fragments,t),r=a2(i.fragments,t);if(!n||!r)return;Ki.log(`Aligning playlist at start of dicontinuity sequence ${t}`);const s=n.start-r.start;nV(s,i)}function $S(i,e){if(!i.hasProgramDateTime||!e.hasProgramDateTime)return;const t=i.fragments,n=e.fragments;if(!t.length||!n.length)return;let r,s;const o=Math.min(e.endCC,i.endCC);e.startCC<o&&i.startCC<o&&(r=a2(n,o),s=a2(t,o)),(!r||!s)&&(r=n[Math.floor(n.length/2)],s=a2(t,r.cc)||t[Math.floor(t.length/2)]);const a=r.programDateTime,l=s.programDateTime;if(!a||!l)return;const c=(l-a)/1e3-(s.start-r.start);nV(c,i)}function _a(i,e,t){Za(i,e,t),i.addEventListener(e,t)}function Za(i,e,t){i.removeEventListener(e,t)}const Lme={toString:function(i){let e="";const t=i.length;for(let n=0;n<t;n++)e+=`[${i.start(n).toFixed(3)}-${i.end(n).toFixed(3)}]`;return e}},mt={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"};class y4 extends QQ{constructor(e,t,n,r,s){super(r,e.logger),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=mt.STOPPED,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.buffering=!0,this.loadingParts=!1,this.loopSn=void 0,this.onMediaSeeking=()=>{const{config:o,fragCurrent:a,media:l,mediaBuffer:c,state:u}=this,h=l?l.currentTime:0,f=jn.bufferInfo(c||l,h,o.maxBufferHole),d=!f.len;if(this.log(`Media seeking to ${Wt(h)?h.toFixed(3):h}, state: ${u}, ${d?"out of":"in"} buffer`),this.state===mt.ENDED)this.resetLoadingState();else if(a){const m=o.maxFragLookUpTolerance,A=a.start-m,g=a.start+a.duration+m;if(d||g<f.start||A>f.end){const y=h>g;(h<A||y)&&(y&&a.loader&&(this.log(`Cancelling fragment load for seek (sn: ${a.sn})`),a.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}if(l){this.fragmentTracker.removeFragmentsInRange(h,1/0,this.playlistType,!0);const m=this.lastCurrentTime;if(h>m&&(this.lastCurrentTime=h),!this.loadingParts){const A=Math.max(f.end,h),g=this.shouldLoadParts(this.getLevelDetails(),A);g&&(this.log(`LL-Part loading ON after seeking to ${h.toFixed(2)} with buffer @${A.toFixed(2)}`),this.loadingParts=g)}}this.hls.hasEnoughToStart||(this.log(`Setting ${d?"startPosition":"nextLoadPosition"} to ${h} for seek without enough to start`),this.nextLoadPosition=h,d&&(this.startPosition=h)),d&&this.state===mt.IDLE&&this.tickImmediate()},this.onMediaEnded=()=>{this.log("setting startPosition to 0 because media ended"),this.startPosition=this.lastCurrentTime=0},this.playlistType=s,this.hls=e,this.fragmentLoader=new ome(e.config),this.keyLoader=n,this.fragmentTracker=t,this.config=e.config,this.decrypter=new OR(e.config)}registerListeners(){const{hls:e}=this;e.on(ae.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(ae.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(ae.MANIFEST_LOADING,this.onManifestLoading,this),e.on(ae.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(ae.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(ae.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(ae.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(ae.MANIFEST_LOADING,this.onManifestLoading,this),e.off(ae.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(ae.ERROR,this.onError,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(e){}stopLoad(){if(this.state===mt.STOPPED)return;this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const e=this.fragCurrent;e!=null&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=mt.STOPPED}get startPositionValue(){const{nextLoadPosition:e,startPosition:t}=this;return t===-1&&e?e:t}get bufferingEnabled(){return this.buffering}pauseBuffering(){this.buffering=!1}resumeBuffering(){this.buffering=!0}get inFlightFrag(){return{frag:this.fragCurrent,state:this.state}}_streamEnded(e,t){if(t.live||!this.media)return!1;const n=e.end||0,r=this.config.timelineOffset||0;if(n<=r)return!1;const s=e.buffered;this.config.maxBufferHole&&s&&s.length>1&&(e=jn.bufferedInfo(s,e.start,0));const o=e.nextStart;if(o&&o>r&&o<t.edge||this.media.currentTime<e.start)return!1;const l=t.partList;if(l!=null&&l.length){const u=l[l.length-1];return jn.isBuffered(this.media,u.start+u.duration/2)}const c=t.fragments[t.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(c)}getLevelDetails(){if(this.levels&&this.levelLastLoaded!==null)return this.levelLastLoaded.details}get timelineOffset(){const e=this.config.timelineOffset;if(e){var t;return((t=this.getLevelDetails())==null?void 0:t.appliedTimelineOffset)||e}return 0}onMediaAttached(e,t){const n=this.media=this.mediaBuffer=t.media;_a(n,"seeking",this.onMediaSeeking),_a(n,"ended",this.onMediaEnded);const r=this.config;this.levels&&r.autoStartLoad&&this.state===mt.STOPPED&&this.startLoad(r.startPosition)}onMediaDetaching(e,t){const n=!!t.transferMedia,r=this.media;if(r!==null){if(r.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),Za(r,"seeking",this.onMediaSeeking),Za(r,"ended",this.onMediaEnded),this.keyLoader&&!n&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loopSn=void 0,n){this.resetLoadingState(),this.resetTransmuxer();return}this.loadingParts=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}}onManifestLoading(){this.initPTS=[],this.levels=this.levelLastLoaded=this.fragCurrent=null,this.lastCurrentTime=this.startPosition=0,this.startFragRequested=!1}onError(e,t){}onManifestLoaded(e,t){this.startTimeOffset=t.startTimeOffset}onHandlerDestroying(){this.stopLoad(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),super.onHandlerDestroying(),this.hls=this.onMediaSeeking=this.onMediaEnded=null}onHandlerDestroyed(){this.state=mt.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(e,t,n){this.startFragRequested=!0,this._loadFragForPlayback(e,t,n)}_loadFragForPlayback(e,t,n){const r=s=>{const o=s.frag;if(this.fragContextChanged(o)){this.warn(`${o.type} sn: ${o.sn}${s.part?" part: "+s.part.index:""} of ${this.fragInfo(o,!1,s.part)}) was dropped during download.`),this.fragmentTracker.removeFragment(o);return}o.stats.chunkCount++,this._handleFragmentLoadProgress(s)};this._doFragLoad(e,t,n,r).then(s=>{if(!s)return;const o=this.state,a=s.frag;if(this.fragContextChanged(a)){(o===mt.FRAG_LOADING||!this.fragCurrent&&o===mt.PARSING)&&(this.fragmentTracker.removeFragment(a),this.state=mt.IDLE);return}"payload"in s&&(this.log(`Loaded ${a.type} sn: ${a.sn} of ${this.playlistLabel()} ${a.level}`),this.hls.trigger(ae.FRAG_LOADED,s)),this._handleFragmentLoadComplete(s)}).catch(s=>{this.state===mt.STOPPED||this.state===mt.ERROR||(this.warn(`Frag error: ${(s==null?void 0:s.message)||s}`),this.resetFragmentLoading(e))})}clearTrackerIfNeeded(e){var t;const{fragmentTracker:n}=this;if(n.getState(e)===eo.APPENDING){const s=e.type,o=this.getFwdBufferInfo(this.mediaBuffer,s),a=Math.max(e.duration,o?o.len:this.config.maxBufferLength),l=this.backtrackFragment;((l?e.sn-l.sn:0)===1||this.reduceMaxBufferLength(a,e.duration))&&n.removeFragment(e)}else((t=this.mediaBuffer)==null?void 0:t.buffered.length)===0?n.removeAllFragments():n.hasParts(e.type)&&(n.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),n.getState(e)===eo.PARTIAL&&n.removeFragment(e))}checkLiveUpdate(e){if(e.updated&&!e.live){const t=e.fragments[e.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type})}e.fragments[0]||(e.deltaUpdateFailed=!0)}waitForLive(e){const t=e.details;return(t==null?void 0:t.live)&&t.type!=="EVENT"&&(this.levelLastLoaded!==e||t.expired)}flushMainBuffer(e,t,n=null){if(!(e-t))return;const r={startOffset:e,endOffset:t,type:n};this.hls.trigger(ae.BUFFER_FLUSHING,r)}_loadInitSegment(e,t){this._doFragLoad(e,t).then(n=>{const r=n==null?void 0:n.frag;if(!r||this.fragContextChanged(r)||!this.levels)throw new Error("init load aborted");return n}).then(n=>{const{hls:r}=this,{frag:s,payload:o}=n,a=s.decryptdata;if(o&&o.byteLength>0&&a!=null&&a.key&&a.iv&&W1(a.method)){const l=self.performance.now();return this.decrypter.decrypt(new Uint8Array(o),a.key.buffer,a.iv.buffer,UR(a.method)).catch(c=>{throw r.trigger(ae.ERROR,{type:rn.MEDIA_ERROR,details:Ke.FRAG_DECRYPT_ERROR,fatal:!1,error:c,reason:c.message,frag:s}),c}).then(c=>{const u=self.performance.now();return r.trigger(ae.FRAG_DECRYPTED,{frag:s,payload:c,stats:{tstart:l,tdecrypt:u}}),n.payload=c,this.completeInitSegmentLoad(n)})}return this.completeInitSegmentLoad(n)}).catch(n=>{this.state===mt.STOPPED||this.state===mt.ERROR||(this.warn(n),this.resetFragmentLoading(e))})}completeInitSegmentLoad(e){const{levels:t}=this;if(!t)throw new Error("init load aborted, missing levels");const n=e.frag.stats;this.state!==mt.STOPPED&&(this.state=mt.IDLE),e.frag.data=new Uint8Array(e.payload),n.parsing.start=n.buffering.start=self.performance.now(),n.parsing.end=n.buffering.end=self.performance.now(),this.tick()}unhandledEncryptionError(e,t){var n,r;const s=e.tracks;if(s&&!t.encrypted&&((n=s.audio)!=null&&n.encrypted||(r=s.video)!=null&&r.encrypted)&&(!this.config.emeEnabled||!this.keyLoader.emeController)){const o=this.media,a=new Error(`Encrypted track with no key in ${this.fragInfo(t)} (media ${o?"attached mediaKeys: "+o.mediaKeys:"detached"})`);return this.warn(a.message),!o||o.mediaKeys?!1:(this.hls.trigger(ae.ERROR,{type:rn.KEY_SYSTEM_ERROR,details:Ke.KEY_SYSTEM_NO_KEYS,fatal:!1,error:a,frag:t}),this.resetTransmuxer(),!0)}return!1}fragContextChanged(e){const{fragCurrent:t}=this;return!e||!t||e.sn!==t.sn||e.level!==t.level}fragBufferedComplete(e,t){const n=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log(`Buffered ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)} > buffer:${n?Lme.toString(jn.getBuffered(n)):"(detached)"})`),As(e)){var r;if(e.type!==Yt.SUBTITLE){const o=e.elementaryStreams;if(!Object.keys(o).some(a=>!!o[a])){this.state=mt.IDLE;return}}const s=(r=this.levels)==null?void 0:r[e.level];s!=null&&s.fragmentError&&(this.log(`Resetting level fragment error count of ${s.fragmentError} on frag buffered`),s.fragmentError=0)}this.state=mt.IDLE}_handleFragmentLoadComplete(e){const{transmuxer:t}=this;if(!t)return;const{frag:n,part:r,partsLoaded:s}=e,o=!s||s.length===0||s.some(l=>!l),a=new A4(n.level,n.sn,n.stats.chunkCount+1,0,r?r.index:-1,!o);t.flush(a)}_handleFragmentLoadProgress(e){}_doFragLoad(e,t,n=null,r){var s;this.fragCurrent=e;const o=t.details;if(!this.levels||!o)throw new Error(`frag load aborted, missing level${o?"":" detail"}s`);let a=null;if(e.encrypted&&!((s=e.decryptdata)!=null&&s.key)){if(this.log(`Loading key for ${e.sn} of [${o.startSN}-${o.endSN}], ${this.playlistLabel()} ${e.level}`),this.state=mt.KEY_LOADING,this.fragCurrent=e,a=this.keyLoader.load(e).then(f=>{if(!this.fragContextChanged(f.frag))return this.hls.trigger(ae.KEY_LOADED,f),this.state===mt.KEY_LOADING&&(this.state=mt.IDLE),f}),this.hls.trigger(ae.KEY_LOADING,{frag:e}),this.fragCurrent===null)return this.log("context changed in KEY_LOADING"),Promise.resolve(null)}else e.encrypted||(a=this.keyLoader.loadClear(e,o.encryptedFragments,this.startFragRequested),a&&this.log("[eme] blocking frag load until media-keys acquired"));const l=this.fragPrevious;if(As(e)&&(!l||e.sn!==l.sn)){const f=this.shouldLoadParts(t.details,e.end);f!==this.loadingParts&&(this.log(`LL-Part loading ${f?"ON":"OFF"} loading sn ${l==null?void 0:l.sn}->${e.sn}`),this.loadingParts=f)}if(n=Math.max(e.start,n||0),this.loadingParts&&As(e)){const f=o.partList;if(f&&r){n>o.fragmentEnd&&o.fragmentHint&&(e=o.fragmentHint);const d=this.getNextPart(f,e,n);if(d>-1){const m=f[d];e=this.fragCurrent=m.fragment,this.log(`Loading ${e.type} sn: ${e.sn} part: ${m.index} (${d}/${f.length-1}) of ${this.fragInfo(e,!1,m)}) cc: ${e.cc} [${o.startSN}-${o.endSN}], target: ${parseFloat(n.toFixed(3))}`),this.nextLoadPosition=m.start+m.duration,this.state=mt.FRAG_LOADING;let A;return a?A=a.then(g=>!g||this.fragContextChanged(g.frag)?null:this.doFragPartsLoad(e,m,t,r)).catch(g=>this.handleFragLoadError(g)):A=this.doFragPartsLoad(e,m,t,r).catch(g=>this.handleFragLoadError(g)),this.hls.trigger(ae.FRAG_LOADING,{frag:e,part:m,targetBufferTime:n}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):A}else if(!e.url||this.loadedEndOfParts(f,n))return Promise.resolve(null)}}if(As(e)&&this.loadingParts){var c;this.log(`LL-Part loading OFF after next part miss @${n.toFixed(2)} Check buffer at sn: ${e.sn} loaded parts: ${(c=o.partList)==null?void 0:c.filter(f=>f.loaded).map(f=>`[${f.start}-${f.end}]`)}`),this.loadingParts=!1}else if(!e.url)return Promise.resolve(null);this.log(`Loading ${e.type} sn: ${e.sn} of ${this.fragInfo(e,!1)}) cc: ${e.cc} ${"["+o.startSN+"-"+o.endSN+"]"}, target: ${parseFloat(n.toFixed(3))}`),Wt(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=mt.FRAG_LOADING;const u=this.config.progressive&&e.type!==Yt.SUBTITLE;let h;return u&&a?h=a.then(f=>!f||this.fragContextChanged(f.frag)?null:this.fragmentLoader.load(e,r)).catch(f=>this.handleFragLoadError(f)):h=Promise.all([this.fragmentLoader.load(e,u?r:void 0),a]).then(([f])=>(!u&&r&&r(f),f)).catch(f=>this.handleFragLoadError(f)),this.hls.trigger(ae.FRAG_LOADING,{frag:e,targetBufferTime:n}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):h}doFragPartsLoad(e,t,n,r){return new Promise((s,o)=>{var a;const l=[],c=(a=n.details)==null?void 0:a.partList,u=h=>{this.fragmentLoader.loadPart(e,h,r).then(f=>{l[h.index]=f;const d=f.part;this.hls.trigger(ae.FRAG_LOADED,f);const m=ck(n.details,e.sn,h.index+1)||eV(c,e.sn,h.index+1);if(m)u(m);else return s({frag:e,part:d,partsLoaded:l})}).catch(o)};u(t)})}handleFragLoadError(e){if("data"in e){const t=e.data;t.frag&&t.details===Ke.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):t.frag&&t.type===rn.KEY_SYSTEM_ERROR?(t.frag.abortRequests(),this.resetStartWhenNotLoaded(),this.resetFragmentLoading(t.frag)):this.hls.trigger(ae.ERROR,t)}else this.hls.trigger(ae.ERROR,{type:rn.OTHER_ERROR,details:Ke.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null}_handleTransmuxerFlush(e){const t=this.getCurrentContext(e);if(!t||this.state!==mt.PARSING){!this.fragCurrent&&this.state!==mt.STOPPED&&this.state!==mt.ERROR&&(this.state=mt.IDLE);return}const{frag:n,part:r,level:s}=t,o=self.performance.now();n.stats.parsing.end=o,r&&(r.stats.parsing.end=o);const a=this.getLevelDetails(),c=a&&n.sn>a.endSN||this.shouldLoadParts(a,n.end);c!==this.loadingParts&&(this.log(`LL-Part loading ${c?"ON":"OFF"} after parsing segment ending @${n.end.toFixed(2)}`),this.loadingParts=c),this.updateLevelTiming(n,r,s,e.partial)}shouldLoadParts(e,t){if(this.config.lowLatencyMode){if(!e)return this.loadingParts;if(e.partList){var n;const s=e.partList[0];if(s.fragment.type===Yt.SUBTITLE)return!1;const o=s.end+(((n=e.fragmentHint)==null?void 0:n.duration)||0);if(t>=o){var r;if((this.hls.hasEnoughToStart?((r=this.media)==null?void 0:r.currentTime)||this.lastCurrentTime:this.getLoadPosition())>s.start-s.fragment.duration)return!0}}}return!1}getCurrentContext(e){const{levels:t,fragCurrent:n}=this,{level:r,sn:s,part:o}=e;if(!(t!=null&&t[r]))return this.warn(`Levels object was unset while buffering fragment ${s} of ${this.playlistLabel()} ${r}. The current chunk will not be buffered.`),null;const a=t[r],l=a.details,c=o>-1?ck(l,s,o):null,u=c?c.fragment:ZQ(l,s,n);return u?(n&&n!==u&&(u.stats=n.stats),{frag:u,part:c,level:a}):null}bufferFragmentData(e,t,n,r,s){if(this.state!==mt.PARSING)return;const{data1:o,data2:a}=e;let l=o;if(a&&(l=Ac(o,a)),!l.length)return;const c=this.initPTS[t.cc],u=c?-c.baseTime/c.timescale:void 0,h={type:e.type,frag:t,part:n,chunkMeta:r,offset:u,parent:t.type,data:l};if(this.hls.trigger(ae.BUFFER_APPENDING,h),e.dropped&&e.independent&&!n){if(s)return;this.flushBufferGap(t)}}flushBufferGap(e){const t=this.media;if(!t)return;if(!jn.isBuffered(t,t.currentTime)){this.flushMainBuffer(0,e.start);return}const n=t.currentTime,r=jn.bufferInfo(t,n,0),s=e.duration,o=Math.min(this.config.maxFragLookUpTolerance*2,s*.25),a=Math.max(Math.min(e.start-o,r.end-o),n+o);e.start-a>o&&this.flushMainBuffer(a,e.start)}getFwdBufferInfo(e,t){var n;const r=this.getLoadPosition();if(!Wt(r))return null;const o=this.lastCurrentTime>r||(n=this.media)!=null&&n.paused?0:this.config.maxBufferHole;return this.getFwdBufferInfoAtPos(e,r,t,o)}getFwdBufferInfoAtPos(e,t,n,r){const s=jn.bufferInfo(e,t,r);if(s.len===0&&s.nextStart!==void 0){const o=this.fragmentTracker.getBufferedFrag(t,n);if(o&&(s.nextStart<=o.end||o.gap)){const a=Math.max(Math.min(s.nextStart,o.end)-t,r);return jn.bufferInfo(e,t,a)}}return s}getMaxBufferLength(e){const{config:t}=this;let n;return e?n=Math.max(8*t.maxBufferSize/e,t.maxBufferLength):n=t.maxBufferLength,Math.min(n,t.maxMaxBufferLength)}reduceMaxBufferLength(e,t){const n=this.config,r=Math.max(Math.min(e-t,n.maxBufferLength),t),s=Math.max(e-t*3,n.maxMaxBufferLength/2,r);return s>=r?(n.maxMaxBufferLength=s,this.warn(`Reduce max buffer length to ${s}s`),!0):!1}getAppendedFrag(e,t=Yt.MAIN){const n=this.fragmentTracker?this.fragmentTracker.getAppendedFrag(e,t):null;return n&&"fragment"in n?n.fragment:n}getNextFragment(e,t){const n=t.fragments,r=n.length;if(!r)return null;const{config:s}=this,o=n[0].start,a=s.lowLatencyMode&&!!t.partList;let l=null;if(t.live){const h=s.initialLiveManifestSize;if(r<h)return this.warn(`Not enough fragments to start playback (have: ${r}, need: ${h})`),null;if(!t.PTSKnown&&!this.startFragRequested&&this.startPosition===-1||e<o){var c;a&&!this.loadingParts&&(this.log("LL-Part loading ON for initial live fragment"),this.loadingParts=!0),l=this.getInitialLiveFragment(t);const f=this.hls.startPosition,d=this.hls.liveSyncPosition,m=l?(f!==-1&&f>=o?f:d)||l.start:e;this.log(`Setting startPosition to ${m} to match start frag at live edge. mainStart: ${f} liveSyncPosition: ${d} frag.start: ${(c=l)==null?void 0:c.start}`),this.startPosition=this.nextLoadPosition=m}}else e<=o&&(l=n[0]);if(!l){const h=this.loadingParts?t.partEnd:t.fragmentEnd;l=this.getFragmentAtPosition(e,h,t)}let u=this.filterReplacedPrimary(l,t);if(!u&&l){const h=l.sn-t.startSN;u=this.filterReplacedPrimary(n[h+1]||null,t)}return this.mapToInitFragWhenRequired(u)}isLoopLoading(e,t){const n=this.fragmentTracker.getState(e);return(n===eo.OK||n===eo.PARTIAL&&!!e.gap)&&this.nextLoadPosition>t}getNextFragmentLoopLoading(e,t,n,r,s){let o=null;if(e.gap&&(o=this.getNextFragment(this.nextLoadPosition,t),o&&!o.gap&&n.nextStart)){const a=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,n.nextStart,r,0);if(a!==null&&n.len+a.len>=s){const l=o.sn;return this.loopSn!==l&&(this.log(`buffer full after gaps in "${r}" playlist starting at sn: ${l}`),this.loopSn=l),null}}return this.loopSn=void 0,o}get primaryPrefetch(){if(fk(this.config)){var e;if((e=this.hls.interstitialsManager)==null||(e=e.playingItem)==null?void 0:e.event)return!0}return!1}filterReplacedPrimary(e,t){if(!e)return e;if(fk(this.config)&&e.type!==Yt.SUBTITLE){const n=this.hls.interstitialsManager,r=n==null?void 0:n.bufferingItem;if(r){const o=r.event;if(o){if(o.appendInPlace||Math.abs(e.start-r.start)>1||r.start===0)return null}else if(e.end<=r.start&&(t==null?void 0:t.live)===!1||e.start>r.end&&r.nextEvent&&(r.nextEvent.appendInPlace||e.start-r.end>1))return null}const s=n==null?void 0:n.playerQueue;if(s)for(let o=s.length;o--;){const a=s[o].interstitial;if(a.appendInPlace&&e.start>=a.startTime&&e.end<=a.resumeTime)return null}}return e}mapToInitFragWhenRequired(e){return e!=null&&e.initSegment&&!e.initSegment.data&&!this.bitrateTest?e.initSegment:e}getNextPart(e,t,n){let r=-1,s=!1,o=!0;for(let a=0,l=e.length;a<l;a++){const c=e[a];if(o=o&&!c.independent,r>-1&&n<c.start)break;const u=c.loaded;u?r=-1:(s||(c.independent||o)&&c.fragment===t)&&(c.fragment!==t&&this.warn(`Need buffer at ${n} but next unloaded part starts at ${c.start}`),r=a),s=u}return r}loadedEndOfParts(e,t){let n;for(let r=e.length;r--;){if(n=e[r],!n.loaded)return!1;if(t>n.start)return!0}return!1}getInitialLiveFragment(e){const t=e.fragments,n=this.fragPrevious;let r=null;if(n){if(e.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${n.programDateTime}`),r=Ype(t,n.endProgramDateTime,this.config.maxFragLookUpTolerance)),!r){const s=n.sn+1;if(s>=e.startSN&&s<=e.endSN){const o=t[s-e.startSN];n.cc===o.cc&&(r=o,this.log(`Live playlist, switching playlist, load frag with next SN: ${r.sn}`))}r||(r=UQ(e,n.cc,n.end),r&&this.log(`Live playlist, switching playlist, load frag with same CC: ${r.sn}`))}}else{const s=this.hls.liveSyncPosition;s!==null&&(r=this.getFragmentAtPosition(s,this.bitrateTest?e.fragmentEnd:e.edge,e))}return r}getFragmentAtPosition(e,t,n){const{config:r}=this;let{fragPrevious:s}=this,{fragments:o,endSN:a}=n;const{fragmentHint:l}=n,{maxFragLookUpTolerance:c}=r,u=n.partList,h=!!(this.loadingParts&&u!=null&&u.length&&l);h&&!this.bitrateTest&&u[u.length-1].fragment.sn===l.sn&&(o=o.concat(l),a=l.sn);let f;if(e<t){var d;const A=e<this.lastCurrentTime||e>t-c||(d=this.media)!=null&&d.paused||!this.startFragRequested?0:c;f=s0(s,o,e,A)}else f=o[o.length-1];if(f){const m=f.sn-n.startSN,A=this.fragmentTracker.getState(f);if((A===eo.OK||A===eo.PARTIAL&&f.gap)&&(s=f),s&&f.sn===s.sn&&(!h||u[0].fragment.sn>f.sn||!n.live)&&f.level===s.level){const y=o[m+1];f.sn<a&&this.fragmentTracker.getState(y)!==eo.OK?f=y:f=null}}return f}alignPlaylists(e,t,n){const r=e.fragments.length;if(!r)return this.warn("No fragments in live playlist"),0;const s=e.fragmentStart,o=!t,a=e.alignedSliding&&Wt(s);if(o||!a&&!s){Rme(n,e);const l=e.fragmentStart;return this.log(`Live playlist sliding: ${l.toFixed(2)} start-sn: ${t?t.startSN:"na"}->${e.startSN} fragments: ${r}`),l}return s}waitForCdnTuneIn(e){return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,e.partTarget*3)}setStartPosition(e,t){let n=this.startPosition;n<t&&(n=-1);const r=this.timelineOffset;if(n===-1){const s=this.startTimeOffset!==null,o=s?this.startTimeOffset:e.startTimeOffset;o!==null&&Wt(o)?(n=t+o,o<0&&(n+=e.edge),n=Math.min(Math.max(t,n),t+e.totalduration),this.log(`Setting startPosition to ${n} for start time offset ${o} found in ${s?"multivariant":"media"} playlist`),this.startPosition=n):e.live?(n=this.hls.liveSyncPosition||t,this.log(`Setting startPosition to -1 to start at live edge ${n}`),this.startPosition=-1):(this.log("setting startPosition to 0 by default"),this.startPosition=n=0),this.lastCurrentTime=n+r}this.nextLoadPosition=n+r}getLoadPosition(){var e;const{media:t}=this;let n=0;return(e=this.hls)!=null&&e.hasEnoughToStart&&t?n=t.currentTime:this.nextLoadPosition>=0&&(n=this.nextLoadPosition),n}handleFragLoadAborted(e,t){this.transmuxer&&e.type===this.playlistType&&As(e)&&e.stats.aborted&&(this.log(`Fragment ${e.sn}${t?" part "+t.index:""} of ${this.playlistLabel()} ${e.level} was aborted`),this.resetFragmentLoading(e))}resetFragmentLoading(e){(!this.fragCurrent||!this.fragContextChanged(e)&&this.state!==mt.FRAG_LOADING_WAITING_RETRY)&&(this.state=mt.IDLE)}onFragmentOrKeyLoadError(e,t){var n;if(t.chunkMeta&&!t.frag){const y=this.getCurrentContext(t.chunkMeta);y&&(t.frag=y.frag)}const r=t.frag;if(!r||r.type!==e||!this.levels)return;if(this.fragContextChanged(r)){var s;this.warn(`Frag load error must match current frag to retry ${r.url} > ${(s=this.fragCurrent)==null?void 0:s.url}`);return}const o=t.details===Ke.FRAG_GAP;o&&this.fragmentTracker.fragBuffered(r,!0);const a=t.errorAction;if(!a){this.state=mt.ERROR;return}const{action:l,flags:c,retryCount:u=0,retryConfig:h}=a,f=!!h,d=f&&l===Zs.RetryRequest,m=f&&!a.resolved&&c===$a.MoveAllAlternatesMatchingHost,A=(n=this.hls.latestLevelDetails)==null?void 0:n.live;if(!d&&m&&As(r)&&!r.endList&&A&&!GQ(t))this.resetFragmentErrors(e),this.treatAsGap(r),a.resolved=!0;else if((d||m)&&u<h.maxNumRetry){var g;const y=A5((g=t.response)==null?void 0:g.code),E=FR(h,u);if(this.resetStartWhenNotLoaded(),this.retryDate=self.performance.now()+E,this.state=mt.FRAG_LOADING_WAITING_RETRY,a.resolved=!0,y){this.log("Waiting for connection (offline)"),this.retryDate=1/0,t.reason="offline";return}this.warn(`Fragment ${r.sn} of ${e} ${r.level} errored with ${t.details}, retrying loading ${u+1}/${h.maxNumRetry} in ${E}ms`)}else if(h)if(this.resetFragmentErrors(e),u<h.maxNumRetry)!o&&l!==Zs.RemoveAlternatePermanently&&(a.resolved=!0);else{this.warn(`${t.details} reached or exceeded max retry (${u})`);return}else l===Zs.SendAlternateToPenaltyBox?this.state=mt.WAITING_LEVEL:this.state=mt.ERROR;this.tickImmediate()}checkRetryDate(){const e=self.performance.now(),t=this.retryDate,n=t===1/0;(!t||e>=t||n&&!A5(0))&&(n&&this.log("Connection restored (online)"),this.resetStartWhenNotLoaded(),this.state=mt.IDLE)}reduceLengthAndFlushBuffer(e){if(this.state===mt.PARSING||this.state===mt.PARSED){const t=e.frag,n=e.parent,r=this.getFwdBufferInfo(this.mediaBuffer,n),s=r&&r.len>.5;s&&this.reduceMaxBufferLength(r.len,(t==null?void 0:t.duration)||10);const o=!s;return o&&this.warn(`Buffer full error while media.currentTime (${this.getLoadPosition()}) is not buffered, flush ${n} buffer`),t&&(this.fragmentTracker.removeFragment(t),this.nextLoadPosition=t.start),this.resetLoadingState(),o}return!1}resetFragmentErrors(e){e===Yt.AUDIO&&(this.fragCurrent=null),this.hls.hasEnoughToStart||(this.startFragRequested=!1),this.state!==mt.STOPPED&&(this.state=mt.IDLE)}afterBufferFlushed(e,t,n){if(!e)return;const r=jn.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,r,n),this.state===mt.ENDED&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state!==mt.STOPPED&&(this.state=mt.IDLE)}resetStartWhenNotLoaded(){if(!this.hls.hasEnoughToStart){this.startFragRequested=!1;const e=this.levelLastLoaded,t=e?e.details:null;t!=null&&t.live?(this.log("resetting startPosition for live start"),this.startPosition=-1,this.setStartPosition(t,t.fragmentStart),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(e){this.log(`Loading context changed while buffering sn ${e.sn} of ${this.playlistLabel()} ${e.level===-1?"<removed>":e.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(),this.resetLoadingState()}removeUnbufferedFrags(e=0){this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)}updateLevelTiming(e,t,n,r){const s=n.details;if(!s){this.warn("level.details undefined");return}if(!Object.keys(e.elementaryStreams).reduce((l,c)=>{const u=e.elementaryStreams[c];if(u){const h=u.endPTS-u.startPTS;if(h<=0)return this.warn(`Could not parse fragment ${e.sn} ${c} duration reliably (${h})`),l||!1;const f=r?0:XQ(s,e,u.startPTS,u.endPTS,u.startDTS,u.endDTS,this);return this.hls.trigger(ae.LEVEL_PTS_UPDATED,{details:s,level:n,drift:f,type:c,frag:e,start:u.startPTS,end:u.endPTS}),!0}return l},!1)){var a;const l=((a=this.transmuxer)==null?void 0:a.error)===null;if((n.fragmentError===0||l&&(n.fragmentError<2||e.endList))&&this.treatAsGap(e,n),l){const c=new Error(`Found no media in fragment ${e.sn} of ${this.playlistLabel()} ${e.level} resetting transmuxer to fallback to playlist timing`);if(this.warn(c.message),this.hls.trigger(ae.ERROR,{type:rn.MEDIA_ERROR,details:Ke.FRAG_PARSING_ERROR,fatal:!1,error:c,frag:e,reason:`Found no media in msn ${e.sn} of ${this.playlistLabel()} "${n.url}"`}),!this.hls)return;this.resetTransmuxer()}}this.state=mt.PARSED,this.log(`Parsed ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)})`),this.hls.trigger(ae.FRAG_PARSED,{frag:e,part:t})}playlistLabel(){return this.playlistType===Yt.MAIN?"level":"track"}fragInfo(e,t=!0,n){var r,s;return`${this.playlistLabel()} ${e.level} (${n?"part":"frag"}:[${((r=t&&!n?e.startPTS:(n||e).start)!=null?r:NaN).toFixed(3)}-${((s=t&&!n?e.endPTS:(n||e).end)!=null?s:NaN).toFixed(3)}]${n&&e.type==="main"?"INDEPENDENT="+(n.independent?"YES":"NO"):""}`}treatAsGap(e,t){t&&t.fragmentError++,e.gap=!0,this.fragmentTracker.removeFragment(e),this.fragmentTracker.fragBuffered(e,!0)}resetTransmuxer(){var e;(e=this.transmuxer)==null||e.reset()}recoverWorkerError(e){e.event==="demuxerWorker"&&(this.fragmentTracker.removeAllFragments(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),this.resetStartWhenNotLoaded(),this.resetLoadingState())}set state(e){const t=this._state;t!==e&&(this._state=e,this.log(`${t}->${e}`))}get state(){return this._state}}function fk(i){return!!i.interstitialsController&&i.enableInterstitialPlayback!==!1}class rV{constructor(){this.chunks=[],this.dataLength=0}push(e){this.chunks.push(e),this.dataLength+=e.length}flush(){const{chunks:e,dataLength:t}=this;let n;if(e.length)e.length===1?n=e[0]:n=Pme(e,t);else return new Uint8Array(0);return this.reset(),n}reset(){this.chunks.length=0,this.dataLength=0}}function Pme(i,e){const t=new Uint8Array(e);let n=0;for(let r=0;r<i.length;r++){const s=i[r];t.set(s,n),n+=s.length}return t}var Ob={exports:{}},dk;function Bme(){return dk||(dk=1,(function(i){var e=Object.prototype.hasOwnProperty,t="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(t=!1));function r(l,c,u){this.fn=l,this.context=c,this.once=u||!1}function s(l,c,u,h,f){if(typeof u!="function")throw new TypeError("The listener must be a function");var d=new r(u,h||l,f),m=t?t+c:c;return l._events[m]?l._events[m].fn?l._events[m]=[l._events[m],d]:l._events[m].push(d):(l._events[m]=d,l._eventsCount++),l}function o(l,c){--l._eventsCount===0?l._events=new n:delete l._events[c]}function a(){this._events=new n,this._eventsCount=0}a.prototype.eventNames=function(){var c=[],u,h;if(this._eventsCount===0)return c;for(h in u=this._events)e.call(u,h)&&c.push(t?h.slice(1):h);return Object.getOwnPropertySymbols?c.concat(Object.getOwnPropertySymbols(u)):c},a.prototype.listeners=function(c){var u=t?t+c:c,h=this._events[u];if(!h)return[];if(h.fn)return[h.fn];for(var f=0,d=h.length,m=new Array(d);f<d;f++)m[f]=h[f].fn;return m},a.prototype.listenerCount=function(c){var u=t?t+c:c,h=this._events[u];return h?h.fn?1:h.length:0},a.prototype.emit=function(c,u,h,f,d,m){var A=t?t+c:c;if(!this._events[A])return!1;var g=this._events[A],y=arguments.length,E,x;if(g.fn){switch(g.once&&this.removeListener(c,g.fn,void 0,!0),y){case 1:return g.fn.call(g.context),!0;case 2:return g.fn.call(g.context,u),!0;case 3:return g.fn.call(g.context,u,h),!0;case 4:return g.fn.call(g.context,u,h,f),!0;case 5:return g.fn.call(g.context,u,h,f,d),!0;case 6:return g.fn.call(g.context,u,h,f,d,m),!0}for(x=1,E=new Array(y-1);x<y;x++)E[x-1]=arguments[x];g.fn.apply(g.context,E)}else{var C=g.length,T;for(x=0;x<C;x++)switch(g[x].once&&this.removeListener(c,g[x].fn,void 0,!0),y){case 1:g[x].fn.call(g[x].context);break;case 2:g[x].fn.call(g[x].context,u);break;case 3:g[x].fn.call(g[x].context,u,h);break;case 4:g[x].fn.call(g[x].context,u,h,f);break;default:if(!E)for(T=1,E=new Array(y-1);T<y;T++)E[T-1]=arguments[T];g[x].fn.apply(g[x].context,E)}}return!0},a.prototype.on=function(c,u,h){return s(this,c,u,h,!1)},a.prototype.once=function(c,u,h){return s(this,c,u,h,!0)},a.prototype.removeListener=function(c,u,h,f){var d=t?t+c:c;if(!this._events[d])return this;if(!u)return o(this,d),this;var m=this._events[d];if(m.fn)m.fn===u&&(!f||m.once)&&(!h||m.context===h)&&o(this,d);else{for(var A=0,g=[],y=m.length;A<y;A++)(m[A].fn!==u||f&&!m[A].once||h&&m[A].context!==h)&&g.push(m[A]);g.length?this._events[d]=g.length===1?g[0]:g:o(this,d)}return this},a.prototype.removeAllListeners=function(c){var u;return c?(u=t?t+c:c,this._events[u]&&o(this,u)):(this._events=new n,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=t,a.EventEmitter=a,i.exports=a})(Ob)),Ob.exports}var Dme=Bme(),HR=cpe(Dme);const V2="1.6.15",lA={};function kme(){return typeof __HLS_WORKER_BUNDLE__=="function"}function Fme(){const i=lA[V2];if(i)return i.clientCount++,i;const e=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),t=self.URL.createObjectURL(e),r={worker:new self.Worker(t),objectURL:t,clientCount:1};return lA[V2]=r,r}function Ome(i){const e=lA[i];if(e)return e.clientCount++,e;const t=new self.URL(i,self.location.href).href,r={worker:new self.Worker(t),scriptURL:t,clientCount:1};return lA[i]=r,r}function Nme(i){const e=lA[i||V2];if(e&&e.clientCount--===1){const{worker:n,objectURL:r}=e;delete lA[i||V2],r&&self.URL.revokeObjectURL(r),n.terminate()}}function sV(i,e){return e+10<=i.length&&i[e]===51&&i[e+1]===68&&i[e+2]===73&&i[e+3]<255&&i[e+4]<255&&i[e+6]<128&&i[e+7]<128&&i[e+8]<128&&i[e+9]<128}function QR(i,e){return e+10<=i.length&&i[e]===73&&i[e+1]===68&&i[e+2]===51&&i[e+3]<255&&i[e+4]<255&&i[e+6]<128&&i[e+7]<128&&i[e+8]<128&&i[e+9]<128}function v4(i,e){let t=0;return t=(i[e]&127)<<21,t|=(i[e+1]&127)<<14,t|=(i[e+2]&127)<<7,t|=i[e+3]&127,t}function W2(i,e){const t=e;let n=0;for(;QR(i,e);){n+=10;const r=v4(i,e+6);n+=r,sV(i,e+10)&&(n+=10),e+=n}if(n>0)return i.subarray(t,t+n)}function Ume(i,e,t,n){const r=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],s=e[t+2],o=s>>2&15;if(o>12){const d=new Error(`invalid ADTS sampling index:${o}`);i.emit(ae.ERROR,ae.ERROR,{type:rn.MEDIA_ERROR,details:Ke.FRAG_PARSING_ERROR,fatal:!0,error:d,reason:d.message});return}const a=(s>>6&3)+1,l=e[t+3]>>6&3|(s&1)<<2,c="mp4a.40."+a,u=r[o];let h=o;(a===5||a===29)&&(h-=3);const f=[a<<3|(h&14)>>1,(h&1)<<7|l<<3];return Ki.log(`manifest codec:${n}, parsed codec:${c}, channels:${l}, rate:${u} (ADTS object type:${a} sampling index:${o})`),{config:f,samplerate:u,channelCount:l,codec:c,parsedCodec:c,manifestCodec:n}}function oV(i,e){return i[e]===255&&(i[e+1]&246)===240}function aV(i,e){return i[e+1]&1?7:9}function VR(i,e){return(i[e+3]&3)<<11|i[e+4]<<3|(i[e+5]&224)>>>5}function zme(i,e){return e+5<i.length}function YS(i,e){return e+1<i.length&&oV(i,e)}function Gme(i,e){return zme(i,e)&&oV(i,e)&&VR(i,e)<=i.length-e}function Hme(i,e){if(YS(i,e)){const t=aV(i,e);if(e+t>=i.length)return!1;const n=VR(i,e);if(n<=t)return!1;const r=e+n;return r===i.length||YS(i,r)}return!1}function lV(i,e,t,n,r){if(!i.samplerate){const s=Ume(e,t,n,r);if(!s)return;er(i,s)}}function cV(i){return 1024*9e4/i}function Qme(i,e){const t=aV(i,e);if(e+t<=i.length){const n=VR(i,e)-t;if(n>0)return{headerLength:t,frameLength:n}}}function uV(i,e,t,n,r){const s=cV(i.samplerate),o=n+r*s,a=Qme(e,t);let l;if(a){const{frameLength:h,headerLength:f}=a,d=f+h,m=Math.max(0,t+d-e.length);m?(l=new Uint8Array(d-f),l.set(e.subarray(t+f,e.length),0)):l=e.subarray(t+f,t+d);const A={unit:l,pts:o};return m||i.samples.push(A),{sample:A,length:d,missing:m}}const c=e.length-t;return l=new Uint8Array(c),l.set(e.subarray(t,e.length),0),{sample:{unit:l,pts:o},length:c,missing:-1}}function Vme(i,e){return QR(i,e)&&v4(i,e+6)+10<=i.length-e}function Wme(i){return i instanceof ArrayBuffer?i:i.byteOffset==0&&i.byteLength==i.buffer.byteLength?i.buffer:new Uint8Array(i).buffer}function Nb(i,e=0,t=1/0){return jme(i,e,t,Uint8Array)}function jme(i,e,t,n){const r=Kme(i);let s=1;"BYTES_PER_ELEMENT"in n&&(s=n.BYTES_PER_ELEMENT);const o=$me(i)?i.byteOffset:0,a=(o+i.byteLength)/s,l=(o+e)/s,c=Math.floor(Math.max(0,Math.min(l,a))),u=Math.floor(Math.min(c+Math.max(t,0),a));return new n(r,c,u-c)}function Kme(i){return i instanceof ArrayBuffer?i:i.buffer}function $me(i){return i&&i.buffer instanceof ArrayBuffer&&i.byteLength!==void 0&&i.byteOffset!==void 0}function Yme(i){const e={key:i.type,description:"",data:"",mimeType:null,pictureType:null},t=3;if(i.size<2)return;if(i.data[0]!==t){console.log("Ignore frame with unrecognized character encoding");return}const n=i.data.subarray(1).indexOf(0);if(n===-1)return;const r=Pl(Nb(i.data,1,n)),s=i.data[2+n],o=i.data.subarray(3+n).indexOf(0);if(o===-1)return;const a=Pl(Nb(i.data,3+n,o));let l;return r==="-->"?l=Pl(Nb(i.data,4+n+o)):l=Wme(i.data.subarray(4+n+o)),e.mimeType=r,e.pictureType=s,e.description=a,e.data=l,e}function Xme(i){if(i.size<2)return;const e=Pl(i.data,!0),t=new Uint8Array(i.data.subarray(e.length+1));return{key:i.type,info:e,data:t.buffer}}function qme(i){if(i.size<2)return;if(i.type==="TXXX"){let t=1;const n=Pl(i.data.subarray(t),!0);t+=n.length+1;const r=Pl(i.data.subarray(t));return{key:i.type,info:n,data:r}}const e=Pl(i.data.subarray(1));return{key:i.type,info:"",data:e}}function Jme(i){if(i.type==="WXXX"){if(i.size<2)return;let t=1;const n=Pl(i.data.subarray(t),!0);t+=n.length+1;const r=Pl(i.data.subarray(t));return{key:i.type,info:n,data:r}}const e=Pl(i.data);return{key:i.type,info:"",data:e}}function Zme(i){return i.type==="PRIV"?Xme(i):i.type[0]==="W"?Jme(i):i.type==="APIC"?Yme(i):qme(i)}function e0e(i){const e=String.fromCharCode(i[0],i[1],i[2],i[3]),t=v4(i,4),n=10;return{type:e,size:t,data:i.subarray(n,n+t)}}const Y3=10,t0e=10;function hV(i){let e=0;const t=[];for(;QR(i,e);){const n=v4(i,e+6);i[e+5]>>6&1&&(e+=Y3),e+=Y3;const r=e+n;for(;e+t0e<r;){const s=e0e(i.subarray(e)),o=Zme(s);o&&t.push(o),e+=s.size+Y3}sV(i,e)&&(e+=Y3)}return t}function fV(i){return i&&i.key==="PRIV"&&i.info==="com.apple.streaming.transportStreamTimestamp"}function n0e(i){if(i.data.byteLength===8){const e=new Uint8Array(i.data),t=e[3]&1;let n=(e[4]<<23)+(e[5]<<15)+(e[6]<<7)+e[7];return n/=45,t&&(n+=4772185884e-2),Math.round(n)}}function WR(i){const e=hV(i);for(let t=0;t<e.length;t++){const n=e[t];if(fV(n))return n0e(n)}}let Xa=(function(i){return i.audioId3="org.id3",i.dateRange="com.apple.quicktime.HLS",i.emsg="https://aomedia.org/emsg/ID3",i.misbklv="urn:misb:KLV:bin:1910.1",i})({});function dh(i="",e=9e4){return{type:i,id:-1,pid:-1,inputTimeScale:e,sequenceNumber:-1,samples:[],dropped:0}}class jR{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(e,t,n,r){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(e){this.initPTS=e,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(e,t){return!1}appendFrame(e,t,n){}demux(e,t){this.cachedData&&(e=Ac(this.cachedData,e),this.cachedData=null);let n=W2(e,0),r=n?n.length:0,s;const o=this._audioTrack,a=this._id3Track,l=n?WR(n):void 0,c=e.length;for((this.basePTS===null||this.frameIndex===0&&Wt(l))&&(this.basePTS=i0e(l,t,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),n&&n.length>0&&a.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:n,type:Xa.audioId3,duration:Number.POSITIVE_INFINITY});r<c;){if(this.canParse(e,r)){const u=this.appendFrame(o,e,r);u?(this.frameIndex++,this.lastPTS=u.sample.pts,r+=u.length,s=r):r=c}else Vme(e,r)?(n=W2(e,r),a.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:n,type:Xa.audioId3,duration:Number.POSITIVE_INFINITY}),r+=n.length,s=r):r++;if(r===c&&s!==c){const u=e.slice(s);this.cachedData?this.cachedData=Ac(this.cachedData,u):this.cachedData=u}}return{audioTrack:o,videoTrack:dh(),id3Track:a,textTrack:dh()}}demuxSampleAes(e,t,n){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(e){const t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:dh(),id3Track:this._id3Track,textTrack:dh()}}destroy(){this.cachedData=null,this._audioTrack=this._id3Track=void 0}}const i0e=(i,e,t)=>{if(Wt(i))return i*90;const n=t?t.baseTime*9e4/t.timescale:0;return e*9e4+n};let X3=null;const r0e=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],s0e=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],o0e=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],a0e=[0,1,1,4];function dV(i,e,t,n,r){if(t+24>e.length)return;const s=pV(e,t);if(s&&t+s.frameLength<=e.length){const o=s.samplesPerFrame*9e4/s.sampleRate,a=n+r*o,l={unit:e.subarray(t,t+s.frameLength),pts:a,dts:a};return i.config=[],i.channelCount=s.channelCount,i.samplerate=s.sampleRate,i.samples.push(l),{sample:l,length:s.frameLength,missing:0}}}function pV(i,e){const t=i[e+1]>>3&3,n=i[e+1]>>1&3,r=i[e+2]>>4&15,s=i[e+2]>>2&3;if(t!==1&&r!==0&&r!==15&&s!==3){const o=i[e+2]>>1&1,a=i[e+3]>>6,l=t===3?3-n:n===3?3:4,c=r0e[l*14+r-1]*1e3,h=s0e[(t===3?0:t===2?1:2)*3+s],f=a===3?1:2,d=o0e[t][n],m=a0e[n],A=d*8*m,g=Math.floor(d*c/h+o)*m;if(X3===null){const x=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);X3=x?parseInt(x[1]):0}return!!X3&&X3<=87&&n===2&&c>=224e3&&a===0&&(i[e+3]=i[e+3]|128),{sampleRate:h,channelCount:f,frameLength:g,samplesPerFrame:A}}}function KR(i,e){return i[e]===255&&(i[e+1]&224)===224&&(i[e+1]&6)!==0}function mV(i,e){return e+1<i.length&&KR(i,e)}function l0e(i,e){return KR(i,e)&&4<=i.length-e}function gV(i,e){if(e+1<i.length&&KR(i,e)){const n=pV(i,e);let r=4;n!=null&&n.frameLength&&(r=n.frameLength);const s=e+r;return s===i.length||mV(i,s)}return!1}class c0e extends jR{constructor(e,t){super(),this.observer=void 0,this.config=void 0,this.observer=e,this.config=t}resetInitSegment(e,t,n,r){super.resetInitSegment(e,t,n,r),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:t,duration:r,inputTimeScale:9e4,dropped:0}}static probe(e,t){if(!e)return!1;const n=W2(e,0);let r=(n==null?void 0:n.length)||0;if(gV(e,r))return!1;for(let s=e.length;r<s;r++)if(Hme(e,r))return t.log("ADTS sync word found !"),!0;return!1}canParse(e,t){return Gme(e,t)}appendFrame(e,t,n){lV(e,this.observer,t,n,e.manifestCodec);const r=uV(e,t,n,this.basePTS,this.frameIndex);if(r&&r.missing===0)return r}}const AV=(i,e)=>{let t=0,n=5;e+=n;const r=new Uint32Array(1),s=new Uint32Array(1),o=new Uint8Array(1);for(;n>0;){o[0]=i[e];const a=Math.min(n,8),l=8-a;s[0]=4278190080>>>24+l<<l,r[0]=(o[0]&s[0])>>l,t=t?t<<a|r[0]:r[0],e+=1,n-=a}return t};class u0e extends jR{constructor(e){super(),this.observer=void 0,this.observer=e}resetInitSegment(e,t,n,r){super.resetInitSegment(e,t,n,r),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:t,duration:r,inputTimeScale:9e4,dropped:0}}canParse(e,t){return t+64<e.length}appendFrame(e,t,n){const r=yV(e,t,n,this.basePTS,this.frameIndex);if(r!==-1)return{sample:e.samples[e.samples.length-1],length:r,missing:0}}static probe(e){if(!e)return!1;const t=W2(e,0);if(!t)return!1;const n=t.length;return e[n]===11&&e[n+1]===119&&WR(t)!==void 0&&AV(e,n)<16}}function yV(i,e,t,n,r){if(t+8>e.length||e[t]!==11||e[t+1]!==119)return-1;const s=e[t+4]>>6;if(s>=3)return-1;const a=[48e3,44100,32e3][s],l=e[t+4]&63,u=[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][l*3+s]*2;if(t+u>e.length)return-1;const h=e[t+6]>>5;let f=0;h===2?f+=2:(h&1&&h!==1&&(f+=2),h&4&&(f+=2));const d=(e[t+6]<<8|e[t+7])>>12-f&1,A=[2,1,2,3,3,4,4,5][h]+d,g=e[t+5]>>3,y=e[t+5]&7,E=new Uint8Array([s<<6|g<<1|y>>2,(y&3)<<6|h<<3|d<<2|l>>4,l<<4&224]),x=1536/a*9e4,C=n+r*x,T=e.subarray(t,t+u);return i.config=E,i.channelCount=A,i.samplerate=a,i.samples.push({unit:T,pts:C}),u}class h0e extends jR{resetInitSegment(e,t,n,r){super.resetInitSegment(e,t,n,r),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:t,duration:r,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;const t=W2(e,0);let n=(t==null?void 0:t.length)||0;if(t&&e[n]===11&&e[n+1]===119&&WR(t)!==void 0&&AV(e,n)<=16)return!1;for(let r=e.length;n<r;n++)if(gV(e,n))return Ki.log("MPEG Audio sync word found !"),!0;return!1}canParse(e,t){return l0e(e,t)}appendFrame(e,t,n){if(this.basePTS!==null)return dV(e,t,n,this.basePTS,this.frameIndex)}}const f0e=/\/emsg[-/]ID3/i;class d0e{constructor(e,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}resetTimeStamp(){}resetInitSegment(e,t,n,r){const s=this.videoTrack=dh("video",1),o=this.audioTrack=dh("audio",1),a=this.txtTrack=dh("text",1);if(this.id3Track=dh("id3",1),this.timeOffset=0,!(e!=null&&e.byteLength))return;const l=bQ(e);if(l.video){const{id:c,timescale:u,codec:h,supplemental:f}=l.video;s.id=c,s.timescale=a.timescale=u,s.codec=h,s.supplemental=f}if(l.audio){const{id:c,timescale:u,codec:h}=l.audio;o.id=c,o.timescale=u,o.codec=h}a.id=wQ.text,s.sampleDuration=0,s.duration=o.duration=r}resetContiguity(){this.remainderData=null}static probe(e){return dpe(e)}demux(e,t){this.timeOffset=t;let n=e;const r=this.videoTrack,s=this.txtTrack;if(this.config.progressive){this.remainderData&&(n=Ac(this.remainderData,e));const a=xpe(n);this.remainderData=a.remainder,r.samples=a.valid||new Uint8Array}else r.samples=n;const o=this.extractID3Track(r,t);return s.samples=P7(t,r),{videoTrack:r,audioTrack:this.audioTrack,id3Track:o,textTrack:this.txtTrack}}flush(){const e=this.timeOffset,t=this.videoTrack,n=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;const r=this.extractID3Track(t,this.timeOffset);return n.samples=P7(e,t),{videoTrack:t,audioTrack:dh(),id3Track:r,textTrack:dh()}}extractID3Track(e,t){const n=this.id3Track;if(e.samples.length){const r=si(e.samples,["emsg"]);r&&r.forEach(s=>{const o=_pe(s);if(f0e.test(o.schemeIdUri)){const a=pk(o,t);let l=o.eventDuration===4294967295?Number.POSITIVE_INFINITY:o.eventDuration/o.timeScale;l<=.001&&(l=Number.POSITIVE_INFINITY);const c=o.payload;n.samples.push({data:c,len:c.byteLength,dts:a,pts:a,type:Xa.emsg,duration:l})}else if(this.config.enableEmsgKLVMetadata&&o.schemeIdUri.startsWith("urn:misb:KLV:bin:1910.1")){const a=pk(o,t);n.samples.push({data:o.payload,len:o.payload.byteLength,dts:a,pts:a,type:Xa.misbklv,duration:Number.POSITIVE_INFINITY})}})}return n}demuxSampleAes(e,t,n){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){this.config=null,this.remainderData=null,this.videoTrack=this.audioTrack=this.id3Track=this.txtTrack=void 0}}function pk(i,e){return Wt(i.presentationTime)?i.presentationTime/i.timeScale:e+i.presentationTimeDelta/i.timeScale}class p0e{constructor(e,t,n){this.keyData=void 0,this.decrypter=void 0,this.keyData=n,this.decrypter=new OR(t,{removePKCS7Padding:!1})}decryptBuffer(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer,ap.cbc)}decryptAacSample(e,t,n){const r=e[t].unit;if(r.length<=16)return;const s=r.subarray(16,r.length-r.length%16),o=s.buffer.slice(s.byteOffset,s.byteOffset+s.length);this.decryptBuffer(o).then(a=>{const l=new Uint8Array(a);r.set(l,16),this.decrypter.isSync()||this.decryptAacSamples(e,t+1,n)}).catch(n)}decryptAacSamples(e,t,n){for(;;t++){if(t>=e.length){n();return}if(!(e[t].unit.length<32)&&(this.decryptAacSample(e,t,n),!this.decrypter.isSync()))return}}getAvcEncryptedData(e){const t=Math.floor((e.length-48)/160)*16+16,n=new Int8Array(t);let r=0;for(let s=32;s<e.length-16;s+=160,r+=16)n.set(e.subarray(s,s+16),r);return n}getAvcDecryptedUnit(e,t){const n=new Uint8Array(t);let r=0;for(let s=32;s<e.length-16;s+=160,r+=16)e.set(n.subarray(r,r+16),s);return e}decryptAvcSample(e,t,n,r,s){const o=RQ(s.data),a=this.getAvcEncryptedData(o);this.decryptBuffer(a.buffer).then(l=>{s.data=this.getAvcDecryptedUnit(o,l),this.decrypter.isSync()||this.decryptAvcSamples(e,t,n+1,r)}).catch(r)}decryptAvcSamples(e,t,n,r){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,n=0){if(t>=e.length){r();return}const s=e[t].units;for(;!(n>=s.length);n++){const o=s[n];if(!(o.data.length<=48||o.type!==1&&o.type!==5)&&(this.decryptAvcSample(e,t,n,r,o),!this.decrypter.isSync()))return}}}}class vV{constructor(){this.VideoSample=null}createVideoSample(e,t,n){return{key:e,frame:!1,pts:t,dts:n,units:[],length:0}}getLastNalUnit(e){var t;let n=this.VideoSample,r;if((!n||n.units.length===0)&&(n=e[e.length-1]),(t=n)!=null&&t.units){const s=n.units;r=s[s.length-1]}return r}pushAccessUnit(e,t){if(e.units.length&&e.frame){if(e.pts===void 0){const n=t.samples,r=n.length;if(r){const s=n[r-1];e.pts=s.pts,e.dts=s.dts}else{t.dropped++;return}}t.samples.push(e)}}parseNALu(e,t,n){const r=t.byteLength;let s=e.naluState||0;const o=s,a=[];let l=0,c,u,h,f=-1,d=0;for(s===-1&&(f=0,d=this.getNALuType(t,0),s=0,l=1);l<r;){if(c=t[l++],!s){s=c?0:1;continue}if(s===1){s=c?0:2;continue}if(!c)s=3;else if(c===1){if(u=l-s-1,f>=0){const m={data:t.subarray(f,u),type:d};a.push(m)}else{const m=this.getLastNalUnit(e.samples);m&&(o&&l<=4-o&&m.state&&(m.data=m.data.subarray(0,m.data.byteLength-o)),u>0&&(m.data=Ac(m.data,t.subarray(0,u)),m.state=0))}l<r?(h=this.getNALuType(t,l),f=l,d=h,s=0):s=-1}else s=0}if(f>=0&&s>=0){const m={data:t.subarray(f,r),type:d,state:s};a.push(m)}if(a.length===0){const m=this.getLastNalUnit(e.samples);m&&(m.data=Ac(m.data,t))}return e.naluState=s,a}}class l2{constructor(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const e=this.data,t=this.bytesAvailable,n=e.byteLength-t,r=new Uint8Array(4),s=Math.min(4,t);if(s===0)throw new Error("no bytes available");r.set(e.subarray(n,n+s)),this.word=new DataView(r.buffer).getUint32(0),this.bitsAvailable=s*8,this.bytesAvailable-=s}skipBits(e){let t;e=Math.min(e,this.bytesAvailable*8+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,t=e>>3,e-=t<<3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}readBits(e){let t=Math.min(this.bitsAvailable,e);const n=this.word>>>32-t;if(e>32&&Ki.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else if(this.bytesAvailable>0)this.loadWord();else throw new Error("no bits available");return t=e-t,t>0&&this.bitsAvailable?n<<t|this.readBits(t):n}skipLZ(){let e;for(e=0;e<this.bitsAvailable;++e)if((this.word&2147483648>>>e)!==0)return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const e=this.skipLZ();return this.readBits(e+1)-1}readEG(){const e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}readBoolean(){return this.readBits(1)===1}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}}class m0e extends vV{parsePES(e,t,n,r){const s=this.parseNALu(e,n.data,r);let o=this.VideoSample,a,l=!1;n.data=null,o&&s.length&&!e.audFound&&(this.pushAccessUnit(o,e),o=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts)),s.forEach(c=>{var u,h;switch(c.type){case 1:{let A=!1;a=!0;const g=c.data;if(l&&g.length>4){const y=this.readSliceType(g);(y===2||y===4||y===7||y===9)&&(A=!0)}if(A){var f;(f=o)!=null&&f.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null)}o||(o=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),o.frame=!0,o.key=A;break}case 5:a=!0,(u=o)!=null&&u.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null),o||(o=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),o.key=!0,o.frame=!0;break;case 6:{a=!0,BR(c.data,1,n.pts,t.samples);break}case 7:{var d,m;a=!0,l=!0;const A=c.data,g=this.readSPS(A);if(!e.sps||e.width!==g.width||e.height!==g.height||((d=e.pixelRatio)==null?void 0:d[0])!==g.pixelRatio[0]||((m=e.pixelRatio)==null?void 0:m[1])!==g.pixelRatio[1]){e.width=g.width,e.height=g.height,e.pixelRatio=g.pixelRatio,e.sps=[A];const y=A.subarray(1,4);let E="avc1.";for(let x=0;x<3;x++){let C=y[x].toString(16);C.length<2&&(C="0"+C),E+=C}e.codec=E}break}case 8:a=!0,e.pps=[c.data];break;case 9:a=!0,e.audFound=!0,(h=o)!=null&&h.frame&&(this.pushAccessUnit(o,e),o=null),o||(o=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts));break;case 12:a=!0;break;default:a=!1;break}o&&a&&o.units.push(c)}),r&&o&&(this.pushAccessUnit(o,e),this.VideoSample=null)}getNALuType(e,t){return e[t]&31}readSliceType(e){const t=new l2(e);return t.readUByte(),t.readUEG(),t.readUEG()}skipScalingList(e,t){let n=8,r=8,s;for(let o=0;o<e;o++)r!==0&&(s=t.readEG(),r=(n+s+256)%256),n=r===0?n:r}readSPS(e){const t=new l2(e);let n=0,r=0,s=0,o=0,a,l,c;const u=t.readUByte.bind(t),h=t.readBits.bind(t),f=t.readUEG.bind(t),d=t.readBoolean.bind(t),m=t.skipBits.bind(t),A=t.skipEG.bind(t),g=t.skipUEG.bind(t),y=this.skipScalingList.bind(this);u();const E=u();if(h(5),m(3),u(),g(),E===100||E===110||E===122||E===244||E===44||E===83||E===86||E===118||E===128){const L=f();if(L===3&&m(1),g(),g(),m(1),d())for(l=L!==3?8:12,c=0;c<l;c++)d()&&(c<6?y(16,t):y(64,t))}g();const x=f();if(x===0)f();else if(x===1)for(m(1),A(),A(),a=f(),c=0;c<a;c++)A();g(),m(1);const C=f(),T=f(),I=h(1);I===0&&m(1),m(1),d()&&(n=f(),r=f(),s=f(),o=f());let M=[1,1];if(d()&&d())switch(u()){case 1:M=[1,1];break;case 2:M=[12,11];break;case 3:M=[10,11];break;case 4:M=[16,11];break;case 5:M=[40,33];break;case 6:M=[24,11];break;case 7:M=[20,11];break;case 8:M=[32,11];break;case 9:M=[80,33];break;case 10:M=[18,11];break;case 11:M=[15,11];break;case 12:M=[64,33];break;case 13:M=[160,99];break;case 14:M=[4,3];break;case 15:M=[3,2];break;case 16:M=[2,1];break;case 255:{M=[u()<<8|u(),u()<<8|u()];break}}return{width:Math.ceil((C+1)*16-n*2-r*2),height:(2-I)*(T+1)*16-(I?2:4)*(s+o),pixelRatio:M}}}class g0e extends vV{constructor(...e){super(...e),this.initVPS=null}parsePES(e,t,n,r){const s=this.parseNALu(e,n.data,r);let o=this.VideoSample,a,l=!1;n.data=null,o&&s.length&&!e.audFound&&(this.pushAccessUnit(o,e),o=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts)),s.forEach(c=>{var u,h;switch(c.type){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:o||(o=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts)),o.frame=!0,a=!0;break;case 16:case 17:case 18:case 21:if(a=!0,l){var f;(f=o)!=null&&f.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null)}o||(o=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),o.key=!0,o.frame=!0;break;case 19:case 20:a=!0,(u=o)!=null&&u.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null),o||(o=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),o.key=!0,o.frame=!0;break;case 39:a=!0,BR(c.data,2,n.pts,t.samples);break;case 32:a=!0,e.vps||(typeof e.params!="object"&&(e.params={}),e.params=er(e.params,this.readVPS(c.data)),this.initVPS=c.data),e.vps=[c.data];break;case 33:if(a=!0,l=!0,e.vps!==void 0&&e.vps[0]!==this.initVPS&&e.sps!==void 0&&!this.matchSPS(e.sps[0],c.data)&&(this.initVPS=e.vps[0],e.sps=e.pps=void 0),!e.sps){const d=this.readSPS(c.data);e.width=d.width,e.height=d.height,e.pixelRatio=d.pixelRatio,e.codec=d.codecString,e.sps=[],typeof e.params!="object"&&(e.params={});for(const m in d.params)e.params[m]=d.params[m]}this.pushParameterSet(e.sps,c.data,e.vps),o||(o=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),o.key=!0;break;case 34:if(a=!0,typeof e.params=="object"){if(!e.pps){e.pps=[];const d=this.readPPS(c.data);for(const m in d)e.params[m]=d[m]}this.pushParameterSet(e.pps,c.data,e.vps)}break;case 35:a=!0,e.audFound=!0,(h=o)!=null&&h.frame&&(this.pushAccessUnit(o,e),o=null),o||(o=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts));break;default:a=!1;break}o&&a&&o.units.push(c)}),r&&o&&(this.pushAccessUnit(o,e),this.VideoSample=null)}pushParameterSet(e,t,n){(n&&n[0]===this.initVPS||!n&&!e.length)&&e.push(t)}getNALuType(e,t){return(e[t]&126)>>>1}ebsp2rbsp(e){const t=new Uint8Array(e.byteLength);let n=0;for(let r=0;r<e.byteLength;r++)r>=2&&e[r]===3&&e[r-1]===0&&e[r-2]===0||(t[n]=e[r],n++);return new Uint8Array(t.buffer,0,n)}pushAccessUnit(e,t){super.pushAccessUnit(e,t),this.initVPS&&(this.initVPS=null)}readVPS(e){const t=new l2(e);t.readUByte(),t.readUByte(),t.readBits(4),t.skipBits(2),t.readBits(6);const n=t.readBits(3),r=t.readBoolean();return{numTemporalLayers:n+1,temporalIdNested:r}}readSPS(e){const t=new l2(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.readBits(4);const n=t.readBits(3);t.readBoolean();const r=t.readBits(2),s=t.readBoolean(),o=t.readBits(5),a=t.readUByte(),l=t.readUByte(),c=t.readUByte(),u=t.readUByte(),h=t.readUByte(),f=t.readUByte(),d=t.readUByte(),m=t.readUByte(),A=t.readUByte(),g=t.readUByte(),y=t.readUByte(),E=[],x=[];for(let Ae=0;Ae<n;Ae++)E.push(t.readBoolean()),x.push(t.readBoolean());if(n>0)for(let Ae=n;Ae<8;Ae++)t.readBits(2);for(let Ae=0;Ae<n;Ae++)E[Ae]&&(t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte()),x[Ae]&&t.readUByte();t.readUEG();const C=t.readUEG();C==3&&t.skipBits(1);const T=t.readUEG(),I=t.readUEG(),M=t.readBoolean();let L=0,R=0,P=0,F=0;M&&(L+=t.readUEG(),R+=t.readUEG(),P+=t.readUEG(),F+=t.readUEG());const k=t.readUEG(),z=t.readUEG(),U=t.readUEG(),W=t.readBoolean();for(let Ae=W?0:n;Ae<=n;Ae++)t.skipUEG(),t.skipUEG(),t.skipUEG();if(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.readBoolean()&&t.readBoolean())for(let Le=0;Le<4;Le++)for(let Te=0;Te<(Le===3?2:6);Te++)if(!t.readBoolean())t.readUEG();else{const V=Math.min(64,1<<4+(Le<<1));Le>1&&t.readEG();for(let de=0;de<V;de++)t.readEG()}t.readBoolean(),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.skipUEG(),t.skipUEG(),t.readBoolean());const X=t.readUEG();let Q=0;for(let Ae=0;Ae<X;Ae++){let Le=!1;if(Ae!==0&&(Le=t.readBoolean()),Le){Ae===X&&t.readUEG(),t.readBoolean(),t.readUEG();let Te=0;for(let ne=0;ne<=Q;ne++){const V=t.readBoolean();let de=!1;V||(de=t.readBoolean()),(V||de)&&Te++}Q=Te}else{const Te=t.readUEG(),ne=t.readUEG();Q=Te+ne;for(let V=0;V<Te;V++)t.readUEG(),t.readBoolean();for(let V=0;V<ne;V++)t.readUEG(),t.readBoolean()}}if(t.readBoolean()){const Ae=t.readUEG();for(let Le=0;Le<Ae;Le++){for(let Te=0;Te<U+4;Te++)t.readBits(1);t.readBits(1)}}let O=0,K=1,te=1,q=!0,J=1,ie=0;t.readBoolean(),t.readBoolean();let re=!1;if(t.readBoolean()){if(t.readBoolean()){const Re=t.readUByte(),Be=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],Fe=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];Re>0&&Re<16?(K=Be[Re-1],te=Fe[Re-1]):Re===255&&(K=t.readBits(16),te=t.readBits(16))}if(t.readBoolean()&&t.readBoolean(),t.readBoolean()&&(t.readBits(3),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.readUByte(),t.readUByte())),t.readBoolean()&&(t.readUEG(),t.readUEG()),t.readBoolean(),t.readBoolean(),t.readBoolean(),re=t.readBoolean(),re&&(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG()),t.readBoolean()&&(J=t.readBits(32),ie=t.readBits(32),t.readBoolean()&&t.readUEG(),t.readBoolean())){const Fe=t.readBoolean(),He=t.readBoolean();let it=!1;(Fe||He)&&(it=t.readBoolean(),it&&(t.readUByte(),t.readBits(5),t.readBoolean(),t.readBits(5)),t.readBits(4),t.readBits(4),it&&t.readBits(4),t.readBits(5),t.readBits(5),t.readBits(5));for(let $e=0;$e<=n;$e++){q=t.readBoolean();const ct=q||t.readBoolean();let pt=!1;ct?t.readEG():pt=t.readBoolean();const We=pt?1:t.readUEG()+1;if(Fe)for(let Mt=0;Mt<We;Mt++)t.readUEG(),t.readUEG(),it&&(t.readUEG(),t.readUEG()),t.skipBits(1);if(He)for(let Mt=0;Mt<We;Mt++)t.readUEG(),t.readUEG(),it&&(t.readUEG(),t.readUEG()),t.skipBits(1)}}t.readBoolean()&&(t.readBoolean(),t.readBoolean(),t.readBoolean(),O=t.readUEG())}let ge=T,xe=I;if(M){let Ae=1,Le=1;C===1?Ae=Le=2:C==2&&(Ae=2),ge=T-Ae*R-Ae*L,xe=I-Le*F-Le*P}const pe=r?["A","B","C"][r]:"",ce=a<<24|l<<16|c<<8|u;let we=0;for(let Ae=0;Ae<32;Ae++)we=(we|(ce>>Ae&1)<<31-Ae)>>>0;let Ee=we.toString(16);return o===1&&Ee==="2"&&(Ee="6"),{codecString:`hvc1.${pe}${o}.${Ee}.${s?"H":"L"}${y}.B0`,params:{general_tier_flag:s,general_profile_idc:o,general_profile_space:r,general_profile_compatibility_flags:[a,l,c,u],general_constraint_indicator_flags:[h,f,d,m,A,g],general_level_idc:y,bit_depth:k+8,bit_depth_luma_minus8:k,bit_depth_chroma_minus8:z,min_spatial_segmentation_idc:O,chroma_format_idc:C,frame_rate:{fixed:q,fps:ie/J}},width:ge,height:xe,pixelRatio:[K,te]}}readPPS(e){const t=new l2(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.skipUEG(),t.skipUEG(),t.skipBits(2),t.skipBits(3),t.skipBits(2),t.skipUEG(),t.skipUEG(),t.skipEG(),t.skipBits(2),t.readBoolean()&&t.skipUEG(),t.skipEG(),t.skipEG(),t.skipBits(4);const r=t.readBoolean(),s=t.readBoolean();let o=1;return s&&r?o=0:s?o=3:r&&(o=2),{parallelismType:o}}matchSPS(e,t){return String.fromCharCode.apply(null,e).substr(3)===String.fromCharCode.apply(null,t).substr(3)}}const Ao=188;class Fd{constructor(e,t,n,r){this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=e,this.config=t,this.typeSupported=n,this.logger=r,this.videoParser=null}static probe(e,t){const n=Fd.syncOffset(e);return n>0&&t.warn(`MPEG2-TS detected but first sync word found @ offset ${n}`),n!==-1}static syncOffset(e){const t=e.length;let n=Math.min(Ao*5,t-Ao)+1,r=0;for(;r<n;){let s=!1,o=-1,a=0;for(let l=r;l<t;l+=Ao)if(e[l]===71&&(t-l===Ao||e[l+Ao]===71)){if(a++,o===-1&&(o=l,o!==0&&(n=Math.min(o+Ao*99,e.length-Ao)+1)),s||(s=_5(e,l)===0),s&&a>1&&(o===0&&a>2||l+Ao>n))return o}else{if(a)return-1;break}r++}return-1}static createTrack(e,t){return{container:e==="video"||e==="audio"?"video/mp2t":void 0,type:e,id:wQ[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:e==="audio"?t:void 0}}resetInitSegment(e,t,n,r){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=Fd.createTrack("video"),this._videoTrack.duration=r,this._audioTrack=Fd.createTrack("audio",r),this._id3Track=Fd.createTrack("id3"),this._txtTrack=Fd.createTrack("text"),this._audioTrack.segmentCodec="aac",this.videoParser=null,this.aacOverFlow=null,this.remainderData=null,this.audioCodec=t,this.videoCodec=n}resetTimeStamp(){}resetContiguity(){const{_audioTrack:e,_videoTrack:t,_id3Track:n}=this;e&&(e.pesData=null),t&&(t.pesData=null),n&&(n.pesData=null),this.aacOverFlow=null,this.remainderData=null}demux(e,t,n=!1,r=!1){n||(this.sampleAes=null);let s;const o=this._videoTrack,a=this._audioTrack,l=this._id3Track,c=this._txtTrack;let u=o.pid,h=o.pesData,f=a.pid,d=l.pid,m=a.pesData,A=l.pesData,g=null,y=this.pmtParsed,E=this._pmtId,x=e.length;if(this.remainderData&&(e=Ac(this.remainderData,e),x=e.length,this.remainderData=null),x<Ao&&!r)return this.remainderData=e,{audioTrack:a,videoTrack:o,id3Track:l,textTrack:c};const C=Math.max(0,Fd.syncOffset(e));x-=(x-C)%Ao,x<e.byteLength&&!r&&(this.remainderData=new Uint8Array(e.buffer,x,e.buffer.byteLength-x));let T=0;for(let M=C;M<x;M+=Ao)if(e[M]===71){const L=!!(e[M+1]&64),R=_5(e,M),P=(e[M+3]&48)>>4;let F;if(P>1){if(F=M+5+e[M+4],F===M+Ao)continue}else F=M+4;switch(R){case u:L&&(h&&(s=qg(h,this.logger))&&(this.readyVideoParser(o.segmentCodec),this.videoParser!==null&&this.videoParser.parsePES(o,c,s,!1)),h={data:[],size:0}),h&&(h.data.push(e.subarray(F,M+Ao)),h.size+=M+Ao-F);break;case f:if(L){if(m&&(s=qg(m,this.logger)))switch(a.segmentCodec){case"aac":this.parseAACPES(a,s);break;case"mp3":this.parseMPEGPES(a,s);break;case"ac3":this.parseAC3PES(a,s);break}m={data:[],size:0}}m&&(m.data.push(e.subarray(F,M+Ao)),m.size+=M+Ao-F);break;case d:L&&(A&&(s=qg(A,this.logger))&&this.parseID3PES(l,s),A={data:[],size:0}),A&&(A.data.push(e.subarray(F,M+Ao)),A.size+=M+Ao-F);break;case 0:L&&(F+=e[F]+1),E=this._pmtId=A0e(e,F);break;case E:{L&&(F+=e[F]+1);const k=y0e(e,F,this.typeSupported,n,this.observer,this.logger);u=k.videoPid,u>0&&(o.pid=u,o.segmentCodec=k.segmentVideoCodec),f=k.audioPid,f>0&&(a.pid=f,a.segmentCodec=k.segmentAudioCodec),d=k.id3Pid,d>0&&(l.pid=d),g!==null&&!y&&(this.logger.warn(`MPEG-TS PMT found at ${M} after unknown PID '${g}'. Backtracking to sync byte @${C} to parse all TS packets.`),g=null,M=C-188),y=this.pmtParsed=!0;break}case 17:case 8191:break;default:g=R;break}}else T++;T>0&&S5(this.observer,new Error(`Found ${T} TS packet/s that do not start with 0x47`),void 0,this.logger),o.pesData=h,a.pesData=m,l.pesData=A;const I={audioTrack:a,videoTrack:o,id3Track:l,textTrack:c};return r&&this.extractRemainingSamples(I),I}flush(){const{remainderData:e}=this;this.remainderData=null;let t;return e?t=this.demux(e,-1,!1,!0):t={videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(t),this.sampleAes?this.decrypt(t,this.sampleAes):t}extractRemainingSamples(e){const{audioTrack:t,videoTrack:n,id3Track:r,textTrack:s}=e,o=n.pesData,a=t.pesData,l=r.pesData;let c;if(o&&(c=qg(o,this.logger))?(this.readyVideoParser(n.segmentCodec),this.videoParser!==null&&(this.videoParser.parsePES(n,s,c,!0),n.pesData=null)):n.pesData=o,a&&(c=qg(a,this.logger))){switch(t.segmentCodec){case"aac":this.parseAACPES(t,c);break;case"mp3":this.parseMPEGPES(t,c);break;case"ac3":this.parseAC3PES(t,c);break}t.pesData=null}else a!=null&&a.size&&this.logger.log("last AAC PES packet truncated,might overlap between fragments"),t.pesData=a;l&&(c=qg(l,this.logger))?(this.parseID3PES(r,c),r.pesData=null):r.pesData=l}demuxSampleAes(e,t,n){const r=this.demux(e,n,!0,!this.config.progressive),s=this.sampleAes=new p0e(this.observer,this.config,t);return this.decrypt(r,s)}readyVideoParser(e){this.videoParser===null&&(e==="avc"?this.videoParser=new m0e:e==="hevc"&&(this.videoParser=new g0e))}decrypt(e,t){return new Promise(n=>{const{audioTrack:r,videoTrack:s}=e;r.samples&&r.segmentCodec==="aac"?t.decryptAacSamples(r.samples,0,()=>{s.samples?t.decryptAvcSamples(s.samples,0,0,()=>{n(e)}):n(e)}):s.samples&&t.decryptAvcSamples(s.samples,0,0,()=>{n(e)})})}destroy(){this.observer&&this.observer.removeAllListeners(),this.config=this.logger=this.observer=null,this.aacOverFlow=this.videoParser=this.remainderData=this.sampleAes=null,this._videoTrack=this._audioTrack=this._id3Track=this._txtTrack=void 0}parseAACPES(e,t){let n=0;const r=this.aacOverFlow;let s=t.data;if(r){this.aacOverFlow=null;const h=r.missing,f=r.sample.unit.byteLength;if(h===-1)s=Ac(r.sample.unit,s);else{const d=f-h;r.sample.unit.set(s.subarray(0,h),d),e.samples.push(r.sample),n=r.missing}}let o,a;for(o=n,a=s.length;o<a-1&&!YS(s,o);o++);if(o!==n){let h;const f=o<a-1;if(f?h=`AAC PES did not start with ADTS header,offset:${o}`:h="No ADTS header found in AAC PES",S5(this.observer,new Error(h),f,this.logger),!f)return}lV(e,this.observer,s,o,this.audioCodec);let l;if(t.pts!==void 0)l=t.pts;else if(r){const h=cV(e.samplerate);l=r.sample.pts+h}else{this.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}let c=0,u;for(;o<a;)if(u=uV(e,s,o,l,c),o+=u.length,u.missing){this.aacOverFlow=u;break}else for(c++;o<a-1&&!YS(s,o);o++);}parseMPEGPES(e,t){const n=t.data,r=n.length;let s=0,o=0;const a=t.pts;if(a===void 0){this.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;o<r;)if(mV(n,o)){const l=dV(e,n,o,a,s);if(l)o+=l.length,s++;else break}else o++}parseAC3PES(e,t){{const n=t.data,r=t.pts;if(r===void 0){this.logger.warn("[tsdemuxer]: AC3 PES unknown PTS");return}const s=n.length;let o=0,a=0,l;for(;a<s&&(l=yV(e,n,a,r,o++))>0;)a+=l}}parseID3PES(e,t){if(t.pts===void 0){this.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}const n=er({},t,{type:this._videoTrack?Xa.emsg:Xa.audioId3,duration:Number.POSITIVE_INFINITY});e.samples.push(n)}}function _5(i,e){return((i[e+1]&31)<<8)+i[e+2]}function A0e(i,e){return(i[e+10]&31)<<8|i[e+11]}function y0e(i,e,t,n,r,s){const o={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},a=(i[e+1]&15)<<8|i[e+2],l=e+3+a-4,c=(i[e+10]&15)<<8|i[e+11];for(e+=12+c;e<l;){const u=_5(i,e),h=(i[e+3]&15)<<8|i[e+4];switch(i[e]){case 207:if(!n){Ub("ADTS AAC",s);break}case 15:o.audioPid===-1&&(o.audioPid=u);break;case 21:o.id3Pid===-1&&(o.id3Pid=u);break;case 219:if(!n){Ub("H.264",s);break}case 27:o.videoPid===-1&&(o.videoPid=u);break;case 3:case 4:!t.mpeg&&!t.mp3?s.log("MPEG audio found, not supported in this browser"):o.audioPid===-1&&(o.audioPid=u,o.segmentAudioCodec="mp3");break;case 193:if(!n){Ub("AC-3",s);break}case 129:t.ac3?o.audioPid===-1&&(o.audioPid=u,o.segmentAudioCodec="ac3"):s.log("AC-3 audio found, not supported in this browser");break;case 6:if(o.audioPid===-1&&h>0){let f=e+5,d=h;for(;d>2;){switch(i[f]){case 106:t.ac3!==!0?s.log("AC-3 audio found, not supported in this browser for now"):(o.audioPid=u,o.segmentAudioCodec="ac3");break}const A=i[f+1]+2;f+=A,d-=A}}break;case 194:case 135:return S5(r,new Error("Unsupported EC-3 in M2TS found"),void 0,s),o;case 36:o.videoPid===-1&&(o.videoPid=u,o.segmentVideoCodec="hevc",s.log("HEVC in M2TS found"));break}e+=h+5}return o}function S5(i,e,t,n){n.warn(`parsing error: ${e.message}`),i.emit(ae.ERROR,ae.ERROR,{type:rn.MEDIA_ERROR,details:Ke.FRAG_PARSING_ERROR,fatal:!1,levelRetry:t,error:e,reason:e.message})}function Ub(i,e){e.log(`${i} with AES-128-CBC encryption found in unencrypted stream`)}function qg(i,e){let t=0,n,r,s,o,a;const l=i.data;if(!i||i.size===0)return null;for(;l[0].length<19&&l.length>1;)l[0]=Ac(l[0],l[1]),l.splice(1,1);if(n=l[0],(n[0]<<16)+(n[1]<<8)+n[2]===1){if(r=(n[4]<<8)+n[5],r&&r>i.size-6)return null;const u=n[7];u&192&&(o=(n[9]&14)*536870912+(n[10]&255)*4194304+(n[11]&254)*16384+(n[12]&255)*128+(n[13]&254)/2,u&64?(a=(n[14]&14)*536870912+(n[15]&255)*4194304+(n[16]&254)*16384+(n[17]&255)*128+(n[18]&254)/2,o-a>60*9e4&&(e.warn(`${Math.round((o-a)/9e4)}s delta between PTS and DTS, align them`),o=a)):a=o),s=n[8];let h=s+9;if(i.size<=h)return null;i.size-=h;const f=new Uint8Array(i.size);for(let d=0,m=l.length;d<m;d++){n=l[d];let A=n.byteLength;if(h)if(h>A){h-=A;continue}else n=n.subarray(h),A-=h,h=0;f.set(n,t),t+=A}return r&&(r-=s+3),{data:f,pts:o,dts:a,len:r}}return null}class v0e{static getSilentFrame(e,t){switch(e){case"mp4a.40.2":if(t===1)return new Uint8Array([0,200,0,128,35,128]);if(t===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(t===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(t===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(t===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(t===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(t===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}}}const Rd=Math.pow(2,32)-1;class je{static init(){je.types={avc1:[],avcC:[],hvc1:[],hvcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};let e;for(e in je.types)je.types.hasOwnProperty(e)&&(je.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);const t=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),n=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);je.HDLR_TYPES={video:t,audio:n};const r=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),s=new Uint8Array([0,0,0,0,0,0,0,0]);je.STTS=je.STSC=je.STCO=s,je.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),je.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),je.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),je.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const o=new Uint8Array([105,115,111,109]),a=new Uint8Array([97,118,99,49]),l=new Uint8Array([0,0,0,1]);je.FTYP=je.box(je.types.ftyp,o,l,o,a),je.DINF=je.box(je.types.dinf,je.box(je.types.dref,r))}static box(e,...t){let n=8,r=t.length;const s=r;for(;r--;)n+=t[r].byteLength;const o=new Uint8Array(n);for(o[0]=n>>24&255,o[1]=n>>16&255,o[2]=n>>8&255,o[3]=n&255,o.set(e,4),r=0,n=8;r<s;r++)o.set(t[r],n),n+=t[r].byteLength;return o}static hdlr(e){return je.box(je.types.hdlr,je.HDLR_TYPES[e])}static mdat(e){return je.box(je.types.mdat,e)}static mdhd(e,t){t*=e;const n=Math.floor(t/(Rd+1)),r=Math.floor(t%(Rd+1));return je.box(je.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,n>>24,n>>16&255,n>>8&255,n&255,r>>24,r>>16&255,r>>8&255,r&255,85,196,0,0]))}static mdia(e){return je.box(je.types.mdia,je.mdhd(e.timescale||0,e.duration||0),je.hdlr(e.type),je.minf(e))}static mfhd(e){return je.box(je.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,e&255]))}static minf(e){return e.type==="audio"?je.box(je.types.minf,je.box(je.types.smhd,je.SMHD),je.DINF,je.stbl(e)):je.box(je.types.minf,je.box(je.types.vmhd,je.VMHD),je.DINF,je.stbl(e))}static moof(e,t,n){return je.box(je.types.moof,je.mfhd(e),je.traf(n,t))}static moov(e){let t=e.length;const n=[];for(;t--;)n[t]=je.trak(e[t]);return je.box.apply(null,[je.types.moov,je.mvhd(e[0].timescale||0,e[0].duration||0)].concat(n).concat(je.mvex(e)))}static mvex(e){let t=e.length;const n=[];for(;t--;)n[t]=je.trex(e[t]);return je.box.apply(null,[je.types.mvex,...n])}static mvhd(e,t){t*=e;const n=Math.floor(t/(Rd+1)),r=Math.floor(t%(Rd+1)),s=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,n>>24,n>>16&255,n>>8&255,n&255,r>>24,r>>16&255,r>>8&255,r&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return je.box(je.types.mvhd,s)}static sdtp(e){const t=e.samples||[],n=new Uint8Array(4+t.length);let r,s;for(r=0;r<t.length;r++)s=t[r].flags,n[r+4]=s.dependsOn<<4|s.isDependedOn<<2|s.hasRedundancy;return je.box(je.types.sdtp,n)}static stbl(e){return je.box(je.types.stbl,je.stsd(e),je.box(je.types.stts,je.STTS),je.box(je.types.stsc,je.STSC),je.box(je.types.stsz,je.STSZ),je.box(je.types.stco,je.STCO))}static avc1(e){let t=[],n=[],r,s,o;for(r=0;r<e.sps.length;r++)s=e.sps[r],o=s.byteLength,t.push(o>>>8&255),t.push(o&255),t=t.concat(Array.prototype.slice.call(s));for(r=0;r<e.pps.length;r++)s=e.pps[r],o=s.byteLength,n.push(o>>>8&255),n.push(o&255),n=n.concat(Array.prototype.slice.call(s));const a=je.box(je.types.avcC,new Uint8Array([1,t[3],t[4],t[5],255,224|e.sps.length].concat(t).concat([e.pps.length]).concat(n))),l=e.width,c=e.height,u=e.pixelRatio[0],h=e.pixelRatio[1];return je.box(je.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,l>>8&255,l&255,c>>8&255,c&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),a,je.box(je.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),je.box(je.types.pasp,new Uint8Array([u>>24,u>>16&255,u>>8&255,u&255,h>>24,h>>16&255,h>>8&255,h&255])))}static esds(e){const t=e.config;return new Uint8Array([0,0,0,0,3,25,0,1,0,4,17,64,21,0,0,0,0,0,0,0,0,0,0,0,5,2,...t,6,1,2])}static audioStsd(e){const t=e.samplerate||0;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount||0,0,16,0,0,0,0,t>>8&255,t&255,0,0])}static mp4a(e){return je.box(je.types.mp4a,je.audioStsd(e),je.box(je.types.esds,je.esds(e)))}static mp3(e){return je.box(je.types[".mp3"],je.audioStsd(e))}static ac3(e){return je.box(je.types["ac-3"],je.audioStsd(e),je.box(je.types.dac3,e.config))}static stsd(e){const{segmentCodec:t}=e;if(e.type==="audio"){if(t==="aac")return je.box(je.types.stsd,je.STSD,je.mp4a(e));if(t==="ac3"&&e.config)return je.box(je.types.stsd,je.STSD,je.ac3(e));if(t==="mp3"&&e.codec==="mp3")return je.box(je.types.stsd,je.STSD,je.mp3(e))}else if(e.pps&&e.sps){if(t==="avc")return je.box(je.types.stsd,je.STSD,je.avc1(e));if(t==="hevc"&&e.vps)return je.box(je.types.stsd,je.STSD,je.hvc1(e))}else throw new Error("video track missing pps or sps");throw new Error(`unsupported ${e.type} segment codec (${t}/${e.codec})`)}static tkhd(e){const t=e.id,n=(e.duration||0)*(e.timescale||0),r=e.width||0,s=e.height||0,o=Math.floor(n/(Rd+1)),a=Math.floor(n%(Rd+1));return je.box(je.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,t&255,0,0,0,0,o>>24,o>>16&255,o>>8&255,o&255,a>>24,a>>16&255,a>>8&255,a&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,r>>8&255,r&255,0,0,s>>8&255,s&255,0,0]))}static traf(e,t){const n=je.sdtp(e),r=e.id,s=Math.floor(t/(Rd+1)),o=Math.floor(t%(Rd+1));return je.box(je.types.traf,je.box(je.types.tfhd,new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,r&255])),je.box(je.types.tfdt,new Uint8Array([1,0,0,0,s>>24,s>>16&255,s>>8&255,s&255,o>>24,o>>16&255,o>>8&255,o&255])),je.trun(e,n.length+16+20+8+16+8+8),n)}static trak(e){return e.duration=e.duration||4294967295,je.box(je.types.trak,je.tkhd(e),je.mdia(e))}static trex(e){const t=e.id;return je.box(je.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(e,t){const n=e.samples||[],r=n.length,s=12+16*r,o=new Uint8Array(s);let a,l,c,u,h,f;for(t+=8+s,o.set([e.type==="video"?1:0,0,15,1,r>>>24&255,r>>>16&255,r>>>8&255,r&255,t>>>24&255,t>>>16&255,t>>>8&255,t&255],0),a=0;a<r;a++)l=n[a],c=l.duration,u=l.size,h=l.flags,f=l.cts,o.set([c>>>24&255,c>>>16&255,c>>>8&255,c&255,u>>>24&255,u>>>16&255,u>>>8&255,u&255,h.isLeading<<2|h.dependsOn,h.isDependedOn<<6|h.hasRedundancy<<4|h.paddingValue<<1|h.isNonSync,h.degradPrio&61440,h.degradPrio&15,f>>>24&255,f>>>16&255,f>>>8&255,f&255],12+16*a);return je.box(je.types.trun,o)}static initSegment(e){je.types||je.init();const t=je.moov(e);return Ac(je.FTYP,t)}static hvc1(e){const t=e.params,n=[e.vps,e.sps,e.pps],r=4,s=new Uint8Array([1,t.general_profile_space<<6|(t.general_tier_flag?32:0)|t.general_profile_idc,t.general_profile_compatibility_flags[0],t.general_profile_compatibility_flags[1],t.general_profile_compatibility_flags[2],t.general_profile_compatibility_flags[3],t.general_constraint_indicator_flags[0],t.general_constraint_indicator_flags[1],t.general_constraint_indicator_flags[2],t.general_constraint_indicator_flags[3],t.general_constraint_indicator_flags[4],t.general_constraint_indicator_flags[5],t.general_level_idc,240|t.min_spatial_segmentation_idc>>8,255&t.min_spatial_segmentation_idc,252|t.parallelismType,252|t.chroma_format_idc,248|t.bit_depth_luma_minus8,248|t.bit_depth_chroma_minus8,0,parseInt(t.frame_rate.fps),r-1|t.temporal_id_nested<<2|t.num_temporal_layers<<3|(t.frame_rate.fixed?64:0),n.length]);let o=s.length;for(let m=0;m<n.length;m+=1){o+=3;for(let A=0;A<n[m].length;A+=1)o+=2+n[m][A].length}const a=new Uint8Array(o);a.set(s,0),o=s.length;const l=n.length-1;for(let m=0;m<n.length;m+=1){a.set(new Uint8Array([32+m|(m===l?128:0),0,n[m].length]),o),o+=3;for(let A=0;A<n[m].length;A+=1)a.set(new Uint8Array([n[m][A].length>>8,n[m][A].length&255]),o),o+=2,a.set(n[m][A],o),o+=n[m][A].length}const c=je.box(je.types.hvcC,a),u=e.width,h=e.height,f=e.pixelRatio[0],d=e.pixelRatio[1];return je.box(je.types.hvc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,u>>8&255,u&255,h>>8&255,h&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),c,je.box(je.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),je.box(je.types.pasp,new Uint8Array([f>>24,f>>16&255,f>>8&255,f&255,d>>24,d>>16&255,d>>8&255,d&255])))}}je.types=void 0;je.HDLR_TYPES=void 0;je.STTS=void 0;je.STSC=void 0;je.STCO=void 0;je.STSZ=void 0;je.VMHD=void 0;je.SMHD=void 0;je.STSD=void 0;je.FTYP=void 0;je.DINF=void 0;const xV=9e4;function $R(i,e,t=1,n=!1){const r=i*e*t;return n?Math.round(r):r}function x0e(i,e,t=1,n=!1){return $R(i,e,1/t,n)}function pv(i,e=!1){return $R(i,1e3,1/xV,e)}function E0e(i,e=1){return $R(i,xV,1/e)}function mk(i){const{baseTime:e,timescale:t,trackId:n}=i;return`${e/t} (${e}/${t}) trackId: ${n}`}const _0e=10*1e3,S0e=1024,w0e=1152,C0e=1536;let Jg=null,zb=null;function gk(i,e,t,n){return{duration:e,size:t,cts:n,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:i?2:1,isNonSync:i?0:1}}}class tS extends _c{constructor(e,t,n,r){if(super("mp4-remuxer",r),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextVideoTs=null,this.nextAudioTs=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=e,this.config=t,this.typeSupported=n,this.ISGenerated=!1,Jg===null){const o=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Jg=o?parseInt(o[1]):0}if(zb===null){const s=navigator.userAgent.match(/Safari\/(\d+)/i);zb=s?parseInt(s[1]):0}}destroy(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null}resetTimeStamp(e){const t=this._initPTS;(!t||!e||e.trackId!==t.trackId||e.baseTime!==t.baseTime||e.timescale!==t.timescale)&&this.log(`Reset initPTS: ${t&&mk(t)} > ${e&&mk(e)}`),this._initPTS=this._initDTS=e}resetNextTimestamp(){this.log("reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){this.log("ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0}getVideoStartPts(e){let t=!1;const n=e[0].pts,r=e.reduce((s,o)=>{let a=o.pts,l=a-s;return l<-4294967296&&(t=!0,a=Cl(a,n),l=a-s),l>0?s:a},n);return t&&this.debug("PTS rollover detected"),r}remux(e,t,n,r,s,o,a,l){let c,u,h,f,d,m,A=s,g=s;const y=e.pid>-1,E=t.pid>-1,x=t.samples.length,C=e.samples.length>0,T=a&&x>0||x>1;if((!y||C)&&(!E||T)||this.ISGenerated||a){if(this.ISGenerated){var M,L,R,P;const U=this.videoTrackConfig;(U&&(t.width!==U.width||t.height!==U.height||((M=t.pixelRatio)==null?void 0:M[0])!==((L=U.pixelRatio)==null?void 0:L[0])||((R=t.pixelRatio)==null?void 0:R[1])!==((P=U.pixelRatio)==null?void 0:P[1]))||!U&&T||this.nextAudioTs===null&&C)&&this.resetInitSegment()}this.ISGenerated||(h=this.generateIS(e,t,s,o));const F=this.isVideoContiguous;let k=-1,z;if(T&&(k=T0e(t.samples),!F&&this.config.forceKeyFrameOnDiscontinuity))if(m=!0,k>0){this.warn(`Dropped ${k} out of ${x} video samples due to a missing keyframe`);const U=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(k),t.dropped+=k,g+=(t.samples[0].pts-U)/t.inputTimeScale,z=g}else k===-1&&(this.warn(`No keyframe found out of ${x} video samples`),m=!1);if(this.ISGenerated){if(C&&T){const U=this.getVideoStartPts(t.samples),$=(Cl(e.samples[0].pts,U)-U)/t.inputTimeScale;A+=Math.max(0,$),g+=Math.max(0,-$)}if(C){if(e.samplerate||(this.warn("regenerate InitSegment as audio detected"),h=this.generateIS(e,t,s,o)),u=this.remuxAudio(e,A,this.isAudioContiguous,o,E||T||l===Yt.AUDIO?g:void 0),T){const U=u?u.endPTS-u.startPTS:0;t.inputTimeScale||(this.warn("regenerate InitSegment as video detected"),h=this.generateIS(e,t,s,o)),c=this.remuxVideo(t,g,F,U)}}else T&&(c=this.remuxVideo(t,g,F,0));c&&(c.firstKeyFrame=k,c.independent=k!==-1,c.firstKeyFramePTS=z)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(n.samples.length&&(d=EV(n,s,this._initPTS,this._initDTS)),r.samples.length&&(f=_V(r,s,this._initPTS))),{audio:u,video:c,initSegment:h,independent:m,text:f,id3:d}}computeInitPts(e,t,n,r){const s=Math.round(n*t);let o=Cl(e,s);if(o<s+t)for(this.log(`Adjusting PTS for rollover in timeline near ${(s-o)/t} ${r}`);o<s+t;)o+=8589934592;return o-s}generateIS(e,t,n,r){const s=e.samples,o=t.samples,a=this.typeSupported,l={},c=this._initPTS;let u=!c||r,h="audio/mp4",f,d,m,A=-1;if(u&&(f=d=1/0),e.config&&s.length){switch(e.timescale=e.samplerate,e.segmentCodec){case"mp3":a.mpeg?(h="audio/mpeg",e.codec=""):a.mp3&&(e.codec="mp3");break;case"ac3":e.codec="ac-3";break}l.audio={id:"audio",container:h,codec:e.codec,initSegment:e.segmentCodec==="mp3"&&a.mpeg?new Uint8Array(0):je.initSegment([e]),metadata:{channelCount:e.channelCount}},u&&(A=e.id,m=e.inputTimeScale,!c||m!==c.timescale?f=d=this.computeInitPts(s[0].pts,m,n,"audio"):u=!1)}if(t.sps&&t.pps&&o.length){if(t.timescale=t.inputTimeScale,l.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:je.initSegment([t]),metadata:{width:t.width,height:t.height}},u)if(A=t.id,m=t.inputTimeScale,!c||m!==c.timescale){const g=this.getVideoStartPts(o),y=Cl(o[0].dts,g),E=this.computeInitPts(y,m,n,"video"),x=this.computeInitPts(g,m,n,"video");d=Math.min(d,E),f=Math.min(f,x)}else u=!1;this.videoTrackConfig={width:t.width,height:t.height,pixelRatio:t.pixelRatio}}if(Object.keys(l).length)return this.ISGenerated=!0,u?(c&&this.warn(`Timestamps at playlist time: ${r?"":"~"}${n} ${f/m} != initPTS: ${c.baseTime/c.timescale} (${c.baseTime}/${c.timescale}) trackId: ${c.trackId}`),this.log(`Found initPTS at playlist time: ${n} offset: ${f/m} (${f}/${m}) trackId: ${A}`),this._initPTS={baseTime:f,timescale:m,trackId:A},this._initDTS={baseTime:d,timescale:m,trackId:A}):f=m=void 0,{tracks:l,initPTS:f,timescale:m,trackId:A}}remuxVideo(e,t,n,r){const s=e.inputTimeScale,o=e.samples,a=[],l=o.length,c=this._initPTS,u=c.baseTime*s/c.timescale;let h=this.nextVideoTs,f=8,d=this.videoSampleDuration,m,A,g=Number.POSITIVE_INFINITY,y=Number.NEGATIVE_INFINITY,E=!1;if(!n||h===null){const O=u+t*s,K=o[0].pts-Cl(o[0].dts,o[0].pts);Jg&&h!==null&&Math.abs(O-K-(h+u))<15e3?n=!0:h=O-K-u}const x=h+u;for(let O=0;O<l;O++){const K=o[O];K.pts=Cl(K.pts,x),K.dts=Cl(K.dts,x),K.dts<o[O>0?O-1:O].dts&&(E=!0)}E&&o.sort(function(O,K){const te=O.dts-K.dts,q=O.pts-K.pts;return te||q}),m=o[0].dts,A=o[o.length-1].dts;const C=A-m,T=C?Math.round(C/(l-1)):d||e.inputTimeScale/30;if(n){const O=m-x,K=O>T,te=O<-1;if((K||te)&&(K?this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${pv(O,!0)} ms (${O}dts) hole between fragments detected at ${t.toFixed(3)}`):this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${pv(-O,!0)} ms (${O}dts) overlapping between fragments detected at ${t.toFixed(3)}`),!te||x>=o[0].pts||Jg)){m=x;const q=o[0].pts-O;if(K)o[0].dts=m,o[0].pts=q;else{let J=!0;for(let ie=0;ie<o.length&&!(o[ie].dts>q&&J);ie++){const re=o[ie].pts;if(o[ie].dts-=O,o[ie].pts-=O,ie<o.length-1){const se=o[ie+1].pts,ge=o[ie].pts,xe=se<=ge,pe=se<=re;J=xe==pe}}}this.log(`Video: Initial PTS/DTS adjusted: ${pv(q,!0)}/${pv(m,!0)}, delta: ${pv(O,!0)} ms`)}}m=Math.max(0,m);let I=0,M=0,L=m;for(let O=0;O<l;O++){const K=o[O],te=K.units,q=te.length;let J=0;for(let ie=0;ie<q;ie++)J+=te[ie].data.length;M+=J,I+=q,K.length=J,K.dts<L?(K.dts=L,L+=T/4|0||1):L=K.dts,g=Math.min(K.pts,g),y=Math.max(K.pts,y)}A=o[l-1].dts;const R=M+4*I+8;let P;try{P=new Uint8Array(R)}catch(O){this.observer.emit(ae.ERROR,ae.ERROR,{type:rn.MUX_ERROR,details:Ke.REMUX_ALLOC_ERROR,fatal:!1,error:O,bytes:R,reason:`fail allocating video mdat ${R}`});return}const F=new DataView(P.buffer);F.setUint32(0,R),P.set(je.types.mdat,4);let k=!1,z=Number.POSITIVE_INFINITY,U=Number.POSITIVE_INFINITY,W=Number.NEGATIVE_INFINITY,$=Number.NEGATIVE_INFINITY;for(let O=0;O<l;O++){const K=o[O],te=K.units;let q=0;for(let re=0,se=te.length;re<se;re++){const ge=te[re],xe=ge.data,pe=ge.data.byteLength;F.setUint32(f,pe),f+=4,P.set(xe,f),f+=pe,q+=4+pe}let J;if(O<l-1)d=o[O+1].dts-K.dts,J=o[O+1].pts-K.pts;else{const re=this.config,se=O>0?K.dts-o[O-1].dts:T;if(J=O>0?K.pts-o[O-1].pts:T,re.stretchShortVideoTrack&&this.nextAudioTs!==null){const ge=Math.floor(re.maxBufferHole*s),xe=(r?g+r*s:this.nextAudioTs+u)-K.pts;xe>ge?(d=xe-se,d<0?d=se:k=!0,this.log(`It is approximately ${xe/90} ms to the next segment; using duration ${d/90} ms for the last video frame.`)):d=se}else d=se}const ie=Math.round(K.pts-K.dts);z=Math.min(z,d),W=Math.max(W,d),U=Math.min(U,J),$=Math.max($,J),a.push(gk(K.key,d,q,ie))}if(a.length){if(Jg){if(Jg<70){const O=a[0].flags;O.dependsOn=2,O.isNonSync=0}}else if(zb&&$-U<W-z&&T/W<.025&&a[0].cts===0){this.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let O=m;for(let K=0,te=a.length;K<te;K++){const q=O+a[K].duration,J=O+a[K].cts;if(K<te-1){const ie=q+a[K+1].cts;a[K].duration=ie-J}else a[K].duration=K?a[K-1].duration:T;a[K].cts=0,O=q}}}d=k||!d?T:d;const oe=A+d;this.nextVideoTs=h=oe-u,this.videoSampleDuration=d,this.isVideoContiguous=!0;const Y={data1:je.moof(e.sequenceNumber++,m,er(e,{samples:a})),data2:P,startPTS:(g-u)/s,endPTS:(y+d-u)/s,startDTS:(m-u)/s,endDTS:h/s,type:"video",hasAudio:!1,hasVideo:!0,nb:a.length,dropped:e.dropped};return e.samples=[],e.dropped=0,Y}getSamplesPerFrame(e){switch(e.segmentCodec){case"mp3":return w0e;case"ac3":return C0e;default:return S0e}}remuxAudio(e,t,n,r,s){const o=e.inputTimeScale,a=e.samplerate?e.samplerate:o,l=o/a,c=this.getSamplesPerFrame(e),u=c*l,h=this._initPTS,f=e.segmentCodec==="mp3"&&this.typeSupported.mpeg,d=[],m=s!==void 0;let A=e.samples,g=f?0:8,y=this.nextAudioTs||-1;const E=h.baseTime*o/h.timescale,x=E+t*o;if(this.isAudioContiguous=n=n||A.length&&y>0&&(r&&Math.abs(x-(y+E))<9e3||Math.abs(Cl(A[0].pts,x)-(y+E))<20*u),A.forEach(function($){$.pts=Cl($.pts,x)}),!n||y<0){const $=A.length;if(A=A.filter(oe=>oe.pts>=0),$!==A.length&&this.warn(`Removed ${A.length-$} of ${$} samples (initPTS ${E} / ${o})`),!A.length)return;s===0?y=0:r&&!m?y=Math.max(0,x-E):y=A[0].pts-E}if(e.segmentCodec==="aac"){const $=this.config.maxAudioFramesDrift;for(let oe=0,X=y+E;oe<A.length;oe++){const Q=A[oe],Y=Q.pts,O=Y-X,K=Math.abs(1e3*O/o);if(O<=-$*u&&m)oe===0&&(this.warn(`Audio frame @ ${(Y/o).toFixed(3)}s overlaps marker by ${Math.round(1e3*O/o)} ms.`),this.nextAudioTs=y=Y-E,X=Y);else if(O>=$*u&&K<_0e&&m){let te=Math.round(O/u);for(X=Y-te*u;X<0&&te&&u;)te--,X+=u;oe===0&&(this.nextAudioTs=y=X-E),this.warn(`Injecting ${te} audio frames @ ${((X-E)/o).toFixed(3)}s due to ${Math.round(1e3*O/o)} ms gap.`);for(let q=0;q<te;q++){let J=v0e.getSilentFrame(e.parsedCodec||e.manifestCodec||e.codec,e.channelCount);J||(this.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),J=Q.unit.subarray()),A.splice(oe,0,{unit:J,pts:X}),X+=u,oe++}}Q.pts=X,X+=u}}let C=null,T=null,I,M=0,L=A.length;for(;L--;)M+=A[L].unit.byteLength;for(let $=0,oe=A.length;$<oe;$++){const X=A[$],Q=X.unit;let Y=X.pts;if(T!==null){const K=d[$-1];K.duration=Math.round((Y-T)/l)}else if(n&&e.segmentCodec==="aac"&&(Y=y+E),C=Y,M>0){M+=g;try{I=new Uint8Array(M)}catch(K){this.observer.emit(ae.ERROR,ae.ERROR,{type:rn.MUX_ERROR,details:Ke.REMUX_ALLOC_ERROR,fatal:!1,error:K,bytes:M,reason:`fail allocating audio mdat ${M}`});return}f||(new DataView(I.buffer).setUint32(0,M),I.set(je.types.mdat,4))}else return;I.set(Q,g);const O=Q.byteLength;g+=O,d.push(gk(!0,c,O,0)),T=Y}const R=d.length;if(!R)return;const P=d[d.length-1];y=T-E,this.nextAudioTs=y+l*P.duration;const F=f?new Uint8Array(0):je.moof(e.sequenceNumber++,C/l,er({},e,{samples:d}));e.samples=[];const k=(C-E)/o,z=this.nextAudioTs/o,W={data1:F,data2:I,startPTS:k,endPTS:z,startDTS:k,endDTS:z,type:"audio",hasAudio:!0,hasVideo:!1,nb:R};return this.isAudioContiguous=!0,W}}function Cl(i,e){let t;if(e===null)return i;for(e<i?t=-8589934592:t=8589934592;Math.abs(i-e)>4294967296;)i+=t;return i}function T0e(i){for(let e=0;e<i.length;e++)if(i[e].key)return e;return-1}function EV(i,e,t,n){const r=i.samples.length;if(!r)return;const s=i.inputTimeScale;for(let a=0;a<r;a++){const l=i.samples[a];l.pts=Cl(l.pts-t.baseTime*s/t.timescale,e*s)/s,l.dts=Cl(l.dts-n.baseTime*s/n.timescale,e*s)/s}const o=i.samples;return i.samples=[],{samples:o}}function _V(i,e,t){const n=i.samples.length;if(!n)return;const r=i.inputTimeScale;for(let o=0;o<n;o++){const a=i.samples[o];a.pts=Cl(a.pts-t.baseTime*r/t.timescale,e*r)/r}i.samples.sort((o,a)=>o.pts-a.pts);const s=i.samples;return i.samples=[],{samples:s}}class b0e extends _c{constructor(e,t,n,r){super("passthrough-remuxer",r),this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null,this.isVideoContiguous=!1}destroy(){}resetTimeStamp(e){this.lastEndTime=null;const t=this.initPTS;t&&e&&t.baseTime===e.baseTime&&t.timescale===e.timescale||(this.initPTS=e)}resetNextTimestamp(){this.isVideoContiguous=!1,this.lastEndTime=null}resetInitSegment(e,t,n,r){this.audioCodec=t,this.videoCodec=n,this.generateInitSegment(e,r),this.emitInitSegment=!0}generateInitSegment(e,t){let{audioCodec:n,videoCodec:r}=this;if(!(e!=null&&e.byteLength)){this.initTracks=void 0,this.initData=void 0;return}const{audio:s,video:o}=this.initData=bQ(e);if(t)Ape(e,t);else{const l=s||o;l!=null&&l.encrypted&&this.warn(`Init segment with encrypted track with has no key ("${l.codec}")!`)}s&&(n=Ak(s,ar.AUDIO,this)),o&&(r=Ak(o,ar.VIDEO,this));const a={};s&&o?a.audiovideo={container:"video/mp4",codec:n+","+r,supplemental:o.supplemental,encrypted:o.encrypted,initSegment:e,id:"main"}:s?a.audio={container:"audio/mp4",codec:n,encrypted:s.encrypted,initSegment:e,id:"audio"}:o?a.video={container:"video/mp4",codec:r,supplemental:o.supplemental,encrypted:o.encrypted,initSegment:e,id:"main"}:this.warn("initSegment does not contain moov or trak boxes."),this.initTracks=a}remux(e,t,n,r,s,o){var a,l;let{initPTS:c,lastEndTime:u}=this;const h={audio:void 0,video:void 0,text:r,id3:n,initSegment:void 0};Wt(u)||(u=this.lastEndTime=s||0);const f=t.samples;if(!f.length)return h;const d={initPTS:void 0,timescale:void 0,trackId:void 0};let m=this.initData;if((a=m)!=null&&a.length||(this.generateInitSegment(f),m=this.initData),!((l=m)!=null&&l.length))return this.warn("Failed to generate initSegment."),h;this.emitInitSegment&&(d.tracks=this.initTracks,this.emitInitSegment=!1);const A=vpe(f,m,this),g=m.audio?A[m.audio.id]:null,y=m.video?A[m.video.id]:null,E=q3(y,1/0),x=q3(g,1/0),C=q3(y,0,!0),T=q3(g,0,!0);let I=s,M=0;const L=g&&(!y||!c&&x<E||c&&c.trackId===m.audio.id),R=L?g:y;if(R){const X=R.timescale,Q=R.start-s*X,Y=L?m.audio.id:m.video.id;I=R.start/X,M=L?T-x:C-E,(o||!c)&&(I0e(c,I,s,M)||X!==c.timescale)&&(c&&this.warn(`Timestamps at playlist time: ${o?"":"~"}${s} ${Q/X} != initPTS: ${c.baseTime/c.timescale} (${c.baseTime}/${c.timescale}) trackId: ${c.trackId}`),this.log(`Found initPTS at playlist time: ${s} offset: ${I-s} (${Q}/${X}) trackId: ${Y}`),c=null,d.initPTS=Q,d.timescale=X,d.trackId=Y)}else this.warn(`No audio or video samples found for initPTS at playlist time: ${s}`);c?(d.initPTS=c.baseTime,d.timescale=c.timescale,d.trackId=c.trackId):((!d.timescale||d.trackId===void 0||d.initPTS===void 0)&&(this.warn("Could not set initPTS"),d.initPTS=I,d.timescale=1,d.trackId=-1),this.initPTS=c={baseTime:d.initPTS,timescale:d.timescale,trackId:d.trackId});const P=I-c.baseTime/c.timescale,F=P+M;M>0?this.lastEndTime=F:(this.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const k=!!m.audio,z=!!m.video;let U="";k&&(U+="audio"),z&&(U+="video");const W=(m.audio?m.audio.encrypted:!1)||(m.video?m.video.encrypted:!1),$={data1:f,startPTS:P,startDTS:P,endPTS:F,endDTS:F,type:U,hasAudio:k,hasVideo:z,nb:1,dropped:0,encrypted:W};h.audio=k&&!z?$:void 0,h.video=z?$:void 0;const oe=y==null?void 0:y.sampleCount;if(oe){const X=y.keyFrameIndex,Q=X!==-1;$.nb=oe,$.dropped=X===0||this.isVideoContiguous?0:Q?X:oe,$.independent=Q,$.firstKeyFrame=X,Q&&y.keyFrameStart&&($.firstKeyFramePTS=(y.keyFrameStart-c.baseTime)/c.timescale),this.isVideoContiguous||(h.independent=Q),this.isVideoContiguous||(this.isVideoContiguous=Q),$.dropped&&this.warn(`fmp4 does not start with IDR: firstIDR ${X}/${oe} dropped: ${$.dropped} start: ${$.firstKeyFramePTS||"NA"}`)}return h.initSegment=d,h.id3=EV(n,s,c,c),r.samples.length&&(h.text=_V(r,s,c)),h}}function q3(i,e,t=!1){return(i==null?void 0:i.start)!==void 0?(i.start+(t?i.duration:0))/i.timescale:e}function I0e(i,e,t,n){if(i===null)return!0;const r=Math.max(n,1),s=e-i.baseTime/i.timescale;return Math.abs(s-t)>r}function Ak(i,e,t){const n=i.codec;return n&&n.length>4?n:e===ar.AUDIO?n==="ec-3"||n==="ac-3"||n==="alac"?n:n==="fLaC"||n==="Opus"?GS(n,!1):(t.warn(`Unhandled audio codec "${n}" in mp4 MAP`),n||"mp4a"):(t.warn(`Unhandled video codec "${n}" in mp4 MAP`),n||"avc1")}let _f;try{_f=self.performance.now.bind(self.performance)}catch{_f=Date.now}const nS=[{demux:d0e,remux:b0e},{demux:Fd,remux:tS},{demux:c0e,remux:tS},{demux:h0e,remux:tS}];nS.splice(2,0,{demux:u0e,remux:tS});class yk{constructor(e,t,n,r,s,o){this.asyncResult=!1,this.logger=void 0,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=t,this.config=n,this.id=s,this.logger=o}configure(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()}push(e,t,n,r){const s=n.transmuxing;s.executeStart=_f();let o=new Uint8Array(e);const{currentTransmuxState:a,transmuxConfig:l}=this;r&&(this.currentTransmuxState=r);const{contiguous:c,discontinuity:u,trackSwitch:h,accurateTimeOffset:f,timeOffset:d,initSegmentChange:m}=r||a,{audioCodec:A,videoCodec:g,defaultInitPts:y,duration:E,initSegmentData:x}=l,C=M0e(o,t);if(C&&W1(C.method)){const L=this.getDecrypter(),R=UR(C.method);if(L.isSync()){let P=L.softwareDecrypt(o,C.key.buffer,C.iv.buffer,R);if(n.part>-1){const k=L.flush();P=k&&k.buffer}if(!P)return s.executeEnd=_f(),Gb(n);o=new Uint8Array(P)}else return this.asyncResult=!0,this.decryptionPromise=L.webCryptoDecrypt(o,C.key.buffer,C.iv.buffer,R).then(P=>{const F=this.push(P,null,n);return this.decryptionPromise=null,F}),this.decryptionPromise}const T=this.needsProbing(u,h);if(T){const L=this.configureTransmuxer(o);if(L)return this.logger.warn(`[transmuxer] ${L.message}`),this.observer.emit(ae.ERROR,ae.ERROR,{type:rn.MEDIA_ERROR,details:Ke.FRAG_PARSING_ERROR,fatal:!1,error:L,reason:L.message}),s.executeEnd=_f(),Gb(n)}(u||h||m||T)&&this.resetInitSegment(x,A,g,E,t),(u||m||T)&&this.resetInitialTimestamp(y),c||this.resetContiguity();const I=this.transmux(o,C,d,f,n);this.asyncResult=j2(I);const M=this.currentTransmuxState;return M.contiguous=!0,M.discontinuity=!1,M.trackSwitch=!1,s.executeEnd=_f(),I}flush(e){const t=e.transmuxing;t.executeStart=_f();const{decrypter:n,currentTransmuxState:r,decryptionPromise:s}=this;if(s)return this.asyncResult=!0,s.then(()=>this.flush(e));const o=[],{timeOffset:a}=r;if(n){const h=n.flush();h&&o.push(this.push(h.buffer,null,e))}const{demuxer:l,remuxer:c}=this;if(!l||!c){t.executeEnd=_f();const h=[Gb(e)];return this.asyncResult?Promise.resolve(h):h}const u=l.flush(a);return j2(u)?(this.asyncResult=!0,u.then(h=>(this.flushRemux(o,h,e),o))):(this.flushRemux(o,u,e),this.asyncResult?Promise.resolve(o):o)}flushRemux(e,t,n){const{audioTrack:r,videoTrack:s,id3Track:o,textTrack:a}=t,{accurateTimeOffset:l,timeOffset:c}=this.currentTransmuxState;this.logger.log(`[transmuxer.ts]: Flushed ${this.id} sn: ${n.sn}${n.part>-1?" part: "+n.part:""} of ${this.id===Yt.MAIN?"level":"track"} ${n.level}`);const u=this.remuxer.remux(r,s,o,a,c,l,!0,this.id);e.push({remuxResult:u,chunkMeta:n}),n.transmuxing.executeEnd=_f()}resetInitialTimestamp(e){const{demuxer:t,remuxer:n}=this;!t||!n||(t.resetTimeStamp(e),n.resetTimeStamp(e))}resetContiguity(){const{demuxer:e,remuxer:t}=this;!e||!t||(e.resetContiguity(),t.resetNextTimestamp())}resetInitSegment(e,t,n,r,s){const{demuxer:o,remuxer:a}=this;!o||!a||(o.resetInitSegment(e,t,n,r),a.resetInitSegment(e,t,n,s))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(e,t,n,r,s){let o;return t&&t.method==="SAMPLE-AES"?o=this.transmuxSampleAes(e,t,n,r,s):o=this.transmuxUnencrypted(e,n,r,s),o}transmuxUnencrypted(e,t,n,r){const{audioTrack:s,videoTrack:o,id3Track:a,textTrack:l}=this.demuxer.demux(e,t,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(s,o,a,l,t,n,!1,this.id),chunkMeta:r}}transmuxSampleAes(e,t,n,r,s){return this.demuxer.demuxSampleAes(e,t,n).then(o=>({remuxResult:this.remuxer.remux(o.audioTrack,o.videoTrack,o.id3Track,o.textTrack,n,r,!1,this.id),chunkMeta:s}))}configureTransmuxer(e){const{config:t,observer:n,typeSupported:r}=this;let s;for(let h=0,f=nS.length;h<f;h++){var o;if((o=nS[h].demux)!=null&&o.probe(e,this.logger)){s=nS[h];break}}if(!s)return new Error("Failed to find demuxer by probing fragment data");const a=this.demuxer,l=this.remuxer,c=s.remux,u=s.demux;(!l||!(l instanceof c))&&(this.remuxer=new c(n,t,r,this.logger)),(!a||!(a instanceof u))&&(this.demuxer=new u(n,t,r,this.logger),this.probe=u.probe)}needsProbing(e,t){return!this.demuxer||!this.remuxer||e||t}getDecrypter(){let e=this.decrypter;return e||(e=this.decrypter=new OR(this.config)),e}}function M0e(i,e){let t=null;return i.byteLength>0&&(e==null?void 0:e.key)!=null&&e.iv!==null&&e.method!=null&&(t=e),t}const Gb=i=>({remuxResult:{},chunkMeta:i});function j2(i){return"then"in i&&i.then instanceof Function}class R0e{constructor(e,t,n,r,s){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=t,this.initSegmentData=n,this.duration=r,this.defaultInitPts=s||null}}class L0e{constructor(e,t,n,r,s,o){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=t,this.accurateTimeOffset=n,this.trackSwitch=r,this.timeOffset=s,this.initSegmentChange=o}}let vk=0;class SV{constructor(e,t,n,r){this.error=null,this.hls=void 0,this.id=void 0,this.instanceNo=vk++,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.onWorkerMessage=l=>{const c=l.data,u=this.hls;if(!(!u||!(c!=null&&c.event)||c.instanceNo!==this.instanceNo))switch(c.event){case"init":{var h;const f=(h=this.workerContext)==null?void 0:h.objectURL;f&&self.URL.revokeObjectURL(f);break}case"transmuxComplete":{this.handleTransmuxComplete(c.data);break}case"flush":{this.onFlush(c.data);break}case"workerLog":{u.logger[c.data.logType]&&u.logger[c.data.logType](c.data.message);break}default:{c.data=c.data||{},c.data.frag=this.frag,c.data.part=this.part,c.data.id=this.id,u.trigger(c.event,c.data);break}}},this.onWorkerError=l=>{if(!this.hls)return;const c=new Error(`${l.message}  (${l.filename}:${l.lineno})`);this.hls.config.enableWorker=!1,this.hls.logger.warn(`Error in "${this.id}" Web Worker, fallback to inline`),this.hls.trigger(ae.ERROR,{type:rn.OTHER_ERROR,details:Ke.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:c})};const s=e.config;this.hls=e,this.id=t,this.useWorker=!!s.enableWorker,this.onTransmuxComplete=n,this.onFlush=r;const o=(l,c)=>{c=c||{},c.frag=this.frag||void 0,l===ae.ERROR&&(c=c,c.parent=this.id,c.part=this.part,this.error=c.error),this.hls.trigger(l,c)};this.observer=new HR,this.observer.on(ae.FRAG_DECRYPTED,o),this.observer.on(ae.ERROR,o);const a=k7(s.preferManagedMediaSource);if(this.useWorker&&typeof Worker<"u"){const l=this.hls.logger;if(s.workerPath||kme()){try{s.workerPath?(l.log(`loading Web Worker ${s.workerPath} for "${t}"`),this.workerContext=Ome(s.workerPath)):(l.log(`injecting Web Worker for "${t}"`),this.workerContext=Fme());const{worker:u}=this.workerContext;u.addEventListener("message",this.onWorkerMessage),u.addEventListener("error",this.onWorkerError),u.postMessage({instanceNo:this.instanceNo,cmd:"init",typeSupported:a,id:t,config:lr(s)})}catch(u){l.warn(`Error setting up "${t}" Web Worker, fallback to inline`,u),this.terminateWorker(),this.error=null,this.transmuxer=new yk(this.observer,a,s,"",t,e.logger)}return}}this.transmuxer=new yk(this.observer,a,s,"",t,e.logger)}reset(){if(this.frag=null,this.part=null,this.workerContext){const e=this.instanceNo;this.instanceNo=vk++;const t=this.hls.config,n=k7(t.preferManagedMediaSource);this.workerContext.worker.postMessage({instanceNo:this.instanceNo,cmd:"reset",resetNo:e,typeSupported:n,id:this.id,config:lr(t)})}}terminateWorker(){if(this.workerContext){const{worker:e}=this.workerContext;this.workerContext=null,e.removeEventListener("message",this.onWorkerMessage),e.removeEventListener("error",this.onWorkerError),Nme(this.hls.config.workerPath)}}destroy(){if(this.workerContext)this.terminateWorker(),this.onWorkerMessage=this.onWorkerError=null;else{const t=this.transmuxer;t&&(t.destroy(),this.transmuxer=null)}const e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.part=null,this.observer=null,this.hls=null}push(e,t,n,r,s,o,a,l,c,u){var h,f;c.transmuxing.start=self.performance.now();const{instanceNo:d,transmuxer:m}=this,A=o?o.start:s.start,g=s.decryptdata,y=this.frag,E=!(y&&s.cc===y.cc),x=!(y&&c.level===y.level),C=y?c.sn-y.sn:-1,T=this.part?c.part-this.part.index:-1,I=C===0&&c.id>1&&c.id===(y==null?void 0:y.stats.chunkCount),M=!x&&(C===1||C===0&&(T===1||I&&T<=0)),L=self.performance.now();(x||C||s.stats.parsing.start===0)&&(s.stats.parsing.start=L),o&&(T||!M)&&(o.stats.parsing.start=L);const R=!(y&&((h=s.initSegment)==null?void 0:h.url)===((f=y.initSegment)==null?void 0:f.url)),P=new L0e(E,M,l,x,A,R);if(!M||E||R){this.hls.logger.log(`[transmuxer-interface]: Starting new transmux session for ${s.type} sn: ${c.sn}${c.part>-1?" part: "+c.part:""} ${this.id===Yt.MAIN?"level":"track"}: ${c.level} id: ${c.id}
        discontinuity: ${E}
        trackSwitch: ${x}
        contiguous: ${M}
        accurateTimeOffset: ${l}
        timeOffset: ${A}
        initSegmentChange: ${R}`);const F=new R0e(n,r,t,a,u);this.configureTransmuxer(F)}if(this.frag=s,this.part=o,this.workerContext)this.workerContext.worker.postMessage({instanceNo:d,cmd:"demux",data:e,decryptdata:g,chunkMeta:c,state:P},e instanceof ArrayBuffer?[e]:[]);else if(m){const F=m.push(e,g,c,P);j2(F)?F.then(k=>{this.handleTransmuxComplete(k)}).catch(k=>{this.transmuxerError(k,c,"transmuxer-interface push error")}):this.handleTransmuxComplete(F)}}flush(e){e.transmuxing.start=self.performance.now();const{instanceNo:t,transmuxer:n}=this;if(this.workerContext)this.workerContext.worker.postMessage({instanceNo:t,cmd:"flush",chunkMeta:e});else if(n){const r=n.flush(e);j2(r)?r.then(s=>{this.handleFlushResult(s,e)}).catch(s=>{this.transmuxerError(s,e,"transmuxer-interface flush error")}):this.handleFlushResult(r,e)}}transmuxerError(e,t,n){this.hls&&(this.error=e,this.hls.trigger(ae.ERROR,{type:rn.MEDIA_ERROR,details:Ke.FRAG_PARSING_ERROR,chunkMeta:t,frag:this.frag||void 0,part:this.part||void 0,fatal:!1,error:e,err:e,reason:n}))}handleFlushResult(e,t){e.forEach(n=>{this.handleTransmuxComplete(n)}),this.onFlush(t)}configureTransmuxer(e){const{instanceNo:t,transmuxer:n}=this;this.workerContext?this.workerContext.worker.postMessage({instanceNo:t,cmd:"configure",config:e}):n&&n.configure(e)}handleTransmuxComplete(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)}}const xk=100;class wV extends y4{constructor(e,t,n){super(e,t,n,"audio-stream-controller",Yt.AUDIO),this.mainAnchor=null,this.mainFragLoading=null,this.audioOnly=!1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.flushing=!1,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.resetItem()}resetItem(){this.mainDetails=this.mainAnchor=this.mainFragLoading=this.bufferedTrack=this.switchingTrack=this.waitingData=this.cachedTrackLoadedData=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(ae.LEVEL_LOADED,this.onLevelLoaded,this),e.on(ae.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(ae.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(ae.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(ae.BUFFER_RESET,this.onBufferReset,this),e.on(ae.BUFFER_CREATED,this.onBufferCreated,this),e.on(ae.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(ae.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(ae.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(ae.FRAG_LOADING,this.onFragLoading,this),e.on(ae.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){const{hls:e}=this;e&&(super.unregisterListeners(),e.off(ae.LEVEL_LOADED,this.onLevelLoaded,this),e.off(ae.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(ae.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(ae.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(ae.BUFFER_RESET,this.onBufferReset,this),e.off(ae.BUFFER_CREATED,this.onBufferCreated,this),e.off(ae.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(ae.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(ae.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(ae.FRAG_LOADING,this.onFragLoading,this),e.off(ae.FRAG_BUFFERED,this.onFragBuffered,this))}onInitPtsFound(e,{frag:t,id:n,initPTS:r,timescale:s,trackId:o}){if(n===Yt.MAIN){const a=t.cc,l=this.fragCurrent;if(this.initPTS[a]={baseTime:r,timescale:s,trackId:o},this.log(`InitPTS for cc: ${a} found from main: ${r/s} (${r}/${s}) trackId: ${o}`),this.mainAnchor=t,this.state===mt.WAITING_INIT_PTS){const c=this.waitingData;(!c&&!this.loadingParts||c&&c.frag.cc!==a)&&this.syncWithAnchor(t,c==null?void 0:c.frag)}else!this.hls.hasEnoughToStart&&l&&l.cc!==a?(l.abortRequests(),this.syncWithAnchor(t,l)):this.state===mt.IDLE&&this.tick()}}getLoadPosition(){return!this.startFragRequested&&this.nextLoadPosition>=0?this.nextLoadPosition:super.getLoadPosition()}syncWithAnchor(e,t){var n;const r=((n=this.mainFragLoading)==null?void 0:n.frag)||null;if(t&&(r==null?void 0:r.cc)===t.cc)return;const s=(r||e).cc,o=this.getLevelDetails(),a=this.getLoadPosition(),l=UQ(o,s,a);l&&(this.log(`Syncing with main frag at ${l.start} cc ${l.cc}`),this.startFragRequested=!1,this.nextLoadPosition=l.start,this.resetLoadingState(),this.state===mt.IDLE&&this.doTickIdle())}startLoad(e,t){if(!this.levels){this.startPosition=e,this.state=mt.STOPPED;return}const n=this.lastCurrentTime;this.stopLoad(),this.setInterval(xk),n>0&&e===-1?(this.log(`Override startPosition with lastCurrentTime @${n.toFixed(3)}`),e=n,this.state=mt.IDLE):this.state=mt.WAITING_TRACK,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}doTick(){switch(this.state){case mt.IDLE:this.doTickIdle();break;case mt.WAITING_TRACK:{const{levels:e,trackId:t}=this,n=e==null?void 0:e[t],r=n==null?void 0:n.details;if(r&&!this.waitForLive(n)){if(this.waitForCdnTuneIn(r))break;this.state=mt.WAITING_INIT_PTS}break}case mt.FRAG_LOADING_WAITING_RETRY:{this.checkRetryDate();break}case mt.WAITING_INIT_PTS:{const e=this.waitingData;if(e){const{frag:t,part:n,cache:r,complete:s}=e,o=this.mainAnchor;if(this.initPTS[t.cc]!==void 0){this.waitingData=null,this.state=mt.FRAG_LOADING;const a=r.flush().buffer,l={frag:t,part:n,payload:a,networkDetails:null};this._handleFragmentLoadProgress(l),s&&super._handleFragmentLoadComplete(l)}else o&&o.cc!==e.frag.cc&&this.syncWithAnchor(o,e.frag)}else this.state=mt.IDLE}}this.onTickEnd()}resetLoadingState(){const e=this.waitingData;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingData=null),super.resetLoadingState()}onTickEnd(){const{media:e}=this;e!=null&&e.readyState&&(this.lastCurrentTime=e.currentTime)}doTickIdle(){var e;const{hls:t,levels:n,media:r,trackId:s}=this,o=t.config;if(!this.buffering||!r&&!this.primaryPrefetch&&(this.startFragRequested||!o.startFragPrefetch)||!(n!=null&&n[s]))return;const a=n[s],l=a.details;if(!l||this.waitForLive(a)||this.waitForCdnTuneIn(l)){this.state=mt.WAITING_TRACK,this.startFragRequested=!1;return}const c=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&c&&(this.bufferFlushed=!1,this.afterBufferFlushed(c,ar.AUDIO,Yt.AUDIO));const u=this.getFwdBufferInfo(c,Yt.AUDIO);if(u===null)return;if(!this.switchingTrack&&this._streamEnded(u,l)){t.trigger(ae.BUFFER_EOS,{type:"audio"}),this.state=mt.ENDED;return}const h=u.len,f=t.maxBufferLength,d=l.fragments,m=d[0].start,A=this.getLoadPosition(),g=this.flushing?A:u.end;if(this.switchingTrack&&r){const x=A;l.PTSKnown&&x<m&&(u.end>m||u.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),r.currentTime=m+.05)}if(h>=f&&!this.switchingTrack&&g<d[d.length-1].start)return;let y=this.getNextFragment(g,l);if(y&&this.isLoopLoading(y,g)&&(y=this.getNextFragmentLoopLoading(y,l,u,Yt.MAIN,f)),!y){this.bufferFlushed=!0;return}let E=((e=this.mainFragLoading)==null?void 0:e.frag)||null;if(!this.audioOnly&&this.startFragRequested&&E&&As(y)&&!y.endList&&(!l.live||!this.loadingParts&&g<this.hls.liveSyncPosition)&&(this.fragmentTracker.getState(E)===eo.OK&&(this.mainFragLoading=E=null),E&&As(E))){if(y.start>E.end){const C=this.fragmentTracker.getFragAtPos(g,Yt.MAIN);C&&C.end>E.end&&(E=C,this.mainFragLoading={frag:C,targetBufferTime:null})}if(y.start>E.end)return}this.loadFragment(y,a,g)}onMediaDetaching(e,t){this.bufferFlushed=this.flushing=!1,super.onMediaDetaching(e,t)}onAudioTracksUpdated(e,{audioTracks:t}){this.resetTransmuxer(),this.levels=t.map(n=>new aA(n))}onAudioTrackSwitching(e,t){const n=!!t.url;this.trackId=t.id;const{fragCurrent:r}=this;r&&(r.abortRequests(),this.removeUnbufferedFrags(r.start)),this.resetLoadingState(),n?(this.switchingTrack=t,this.flushAudioIfNeeded(t),this.state!==mt.STOPPED&&(this.setInterval(xk),this.state=mt.IDLE,this.tick())):(this.resetTransmuxer(),this.switchingTrack=null,this.bufferedTrack=t,this.clearInterval())}onManifestLoading(){super.onManifestLoading(),this.bufferFlushed=this.flushing=this.audioOnly=!1,this.resetItem(),this.trackId=-1}onLevelLoaded(e,t){this.mainDetails=t.details;const n=this.cachedTrackLoadedData;n&&(this.cachedTrackLoadedData=null,this.onAudioTrackLoaded(ae.AUDIO_TRACK_LOADED,n))}onAudioTrackLoaded(e,t){var n;const{levels:r}=this,{details:s,id:o,groupId:a,track:l}=t;if(!r){this.warn(`Audio tracks reset while loading track ${o} "${l.name}" of "${a}"`);return}const c=this.mainDetails;if(!c||s.endCC>c.endCC||c.expired){this.cachedTrackLoadedData=t,this.state!==mt.STOPPED&&(this.state=mt.WAITING_TRACK);return}this.cachedTrackLoadedData=null,this.log(`Audio track ${o} "${l.name}" of "${a}" loaded [${s.startSN},${s.endSN}]${s.lastPartSn?`[part-${s.lastPartSn}-${s.lastPartIndex}]`:""},duration:${s.totalduration}`);const u=r[o];let h=0;if(s.live||(n=u.details)!=null&&n.live){if(this.checkLiveUpdate(s),s.deltaUpdateFailed)return;if(u.details){var f;h=this.alignPlaylists(s,u.details,(f=this.levelLastLoaded)==null?void 0:f.details)}s.alignedSliding||(iV(s,c),s.alignedSliding||$S(s,c),h=s.fragmentStart)}u.details=s,this.levelLastLoaded=u,this.startFragRequested||this.setStartPosition(c,h),this.hls.trigger(ae.AUDIO_TRACK_UPDATED,{details:s,id:o,groupId:t.groupId}),this.state===mt.WAITING_TRACK&&!this.waitForCdnTuneIn(s)&&(this.state=mt.IDLE),this.tick()}_handleFragmentLoadProgress(e){var t;const n=e.frag,{part:r,payload:s}=e,{config:o,trackId:a,levels:l}=this;if(!l){this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${n.sn} of level ${n.level} will not be buffered`);return}const c=l[a];if(!c){this.warn("Audio track is undefined on fragment load progress");return}const u=c.details;if(!u){this.warn("Audio track details undefined on fragment load progress"),this.removeUnbufferedFrags(n.start);return}const h=o.defaultAudioCodec||c.audioCodec||"mp4a.40.2";let f=this.transmuxer;f||(f=this.transmuxer=new SV(this.hls,Yt.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const d=this.initPTS[n.cc],m=(t=n.initSegment)==null?void 0:t.data;if(d!==void 0){const g=r?r.index:-1,y=g!==-1,E=new A4(n.level,n.sn,n.stats.chunkCount,s.byteLength,g,y);f.push(s,m,h,"",n,r,u.totalduration,!1,E,d)}else{this.log(`Unknown video PTS for cc ${n.cc}, waiting for video PTS before demuxing audio frag ${n.sn} of [${u.startSN} ,${u.endSN}],track ${a}`);const{cache:A}=this.waitingData=this.waitingData||{frag:n,part:r,cache:new rV,complete:!1};A.push(new Uint8Array(s)),this.state!==mt.STOPPED&&(this.state=mt.WAITING_INIT_PTS)}}_handleFragmentLoadComplete(e){if(this.waitingData){this.waitingData.complete=!0;return}super._handleFragmentLoadComplete(e)}onBufferReset(){this.mediaBuffer=null}onBufferCreated(e,t){this.bufferFlushed=this.flushing=!1;const n=t.tracks.audio;n&&(this.mediaBuffer=n.buffer||null)}onFragLoading(e,t){!this.audioOnly&&t.frag.type===Yt.MAIN&&As(t.frag)&&(this.mainFragLoading=t,this.state===mt.IDLE&&this.tick())}onFragBuffered(e,t){const{frag:n,part:r}=t;if(n.type!==Yt.AUDIO){!this.audioOnly&&n.type===Yt.MAIN&&!n.elementaryStreams.video&&!n.elementaryStreams.audiovideo&&(this.audioOnly=!0,this.mainFragLoading=null);return}if(this.fragContextChanged(n)){this.warn(`Fragment ${n.sn}${r?" p: "+r.index:""} of level ${n.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);return}if(As(n)){this.fragPrevious=n;const s=this.switchingTrack;s&&(this.bufferedTrack=s,this.switchingTrack=null,this.hls.trigger(ae.AUDIO_TRACK_SWITCHED,Qi({},s)))}this.fragBufferedComplete(n,r),this.media&&this.tick()}onError(e,t){var n;if(t.fatal){this.state=mt.ERROR;return}switch(t.details){case Ke.FRAG_GAP:case Ke.FRAG_PARSING_ERROR:case Ke.FRAG_DECRYPT_ERROR:case Ke.FRAG_LOAD_ERROR:case Ke.FRAG_LOAD_TIMEOUT:case Ke.KEY_LOAD_ERROR:case Ke.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(Yt.AUDIO,t);break;case Ke.AUDIO_TRACK_LOAD_ERROR:case Ke.AUDIO_TRACK_LOAD_TIMEOUT:case Ke.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===mt.WAITING_TRACK&&((n=t.context)==null?void 0:n.type)===ai.AUDIO_TRACK&&(this.state=mt.IDLE);break;case Ke.BUFFER_ADD_CODEC_ERROR:case Ke.BUFFER_APPEND_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)||this.resetLoadingState();break;case Ke.BUFFER_FULL_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case Ke.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onBufferFlushing(e,{type:t}){t!==ar.VIDEO&&(this.flushing=!0)}onBufferFlushed(e,{type:t}){if(t!==ar.VIDEO){this.flushing=!1,this.bufferFlushed=!0,this.state===mt.ENDED&&(this.state=mt.IDLE);const n=this.mediaBuffer||this.media;n&&(this.afterBufferFlushed(n,t,Yt.AUDIO),this.tick())}}_handleTransmuxComplete(e){var t;const n="audio",{hls:r}=this,{remuxResult:s,chunkMeta:o}=e,a=this.getCurrentContext(o);if(!a){this.resetWhenMissingContext(o);return}const{frag:l,part:c,level:u}=a,{details:h}=u,{audio:f,text:d,id3:m,initSegment:A}=s;if(this.fragContextChanged(l)||!h){this.fragmentTracker.removeFragment(l);return}if(this.state=mt.PARSING,this.switchingTrack&&f&&this.completeAudioSwitch(this.switchingTrack),A!=null&&A.tracks){const g=l.initSegment||l;if(this.unhandledEncryptionError(A,l))return;this._bufferInitSegment(u,A.tracks,g,o),r.trigger(ae.FRAG_PARSING_INIT_SEGMENT,{frag:g,id:n,tracks:A.tracks})}if(f){const{startPTS:g,endPTS:y,startDTS:E,endDTS:x}=f;c&&(c.elementaryStreams[ar.AUDIO]={startPTS:g,endPTS:y,startDTS:E,endDTS:x}),l.setElementaryStreamInfo(ar.AUDIO,g,y,E,x),this.bufferFragmentData(f,l,c,o)}if(m!=null&&(t=m.samples)!=null&&t.length){const g=er({id:n,frag:l,details:h},m);r.trigger(ae.FRAG_PARSING_METADATA,g)}if(d){const g=er({id:n,frag:l,details:h},d);r.trigger(ae.FRAG_PARSING_USERDATA,g)}}_bufferInitSegment(e,t,n,r){if(this.state!==mt.PARSING||(t.video&&delete t.video,t.audiovideo&&delete t.audiovideo,!t.audio))return;const s=t.audio;s.id=Yt.AUDIO;const o=e.audioCodec;this.log(`Init audio buffer, container:${s.container}, codecs[level/parsed]=[${o}/${s.codec}]`),o&&o.split(",").length===1&&(s.levelCodec=o),this.hls.trigger(ae.BUFFER_CODECS,t);const a=s.initSegment;if(a!=null&&a.byteLength){const l={type:"audio",frag:n,part:null,chunkMeta:r,parent:n.type,data:a};this.hls.trigger(ae.BUFFER_APPENDING,l)}this.tickImmediate()}loadFragment(e,t,n){const r=this.fragmentTracker.getState(e);if(this.switchingTrack||r===eo.NOT_LOADED||r===eo.PARTIAL){var s;if(!As(e))this._loadInitSegment(e,t);else if((s=t.details)!=null&&s.live&&!this.initPTS[e.cc]){this.log(`Waiting for video PTS in continuity counter ${e.cc} of live stream before loading audio fragment ${e.sn} of level ${this.trackId}`),this.state=mt.WAITING_INIT_PTS;const o=this.mainDetails;o&&o.fragmentStart!==t.details.fragmentStart&&$S(t.details,o)}else super.loadFragment(e,t,n)}else this.clearTrackerIfNeeded(e)}flushAudioIfNeeded(e){if(this.media&&this.bufferedTrack){const{name:t,lang:n,assocLang:r,characteristics:s,audioCodec:o,channels:a}=this.bufferedTrack;Vm({name:t,lang:n,assocLang:r,characteristics:s,audioCodec:o,channels:a},e,wm)||(QS(e.url,this.hls)?(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null):this.bufferedTrack=e)}}completeAudioSwitch(e){const{hls:t}=this;this.flushAudioIfNeeded(e),this.bufferedTrack=e,this.switchingTrack=null,t.trigger(ae.AUDIO_TRACK_SWITCHED,Qi({},e))}}class x4 extends _c{constructor(e,t){super(t,e.logger),this.hls=void 0,this.canLoad=!1,this.timer=-1,this.hls=e}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){this.timer!==-1&&(self.clearTimeout(this.timer),this.timer=-1)}startLoad(){this.canLoad=!0,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(e,t,n){const r=t==null?void 0:t.renditionReports;if(r){let s=-1;for(let o=0;o<r.length;o++){const a=r[o];let l;try{l=new self.URL(a.URI,t.url).href}catch(c){this.warn(`Could not construct new URL for Rendition Report: ${c}`),l=a.URI||""}if(l===e){s=o;break}else l===e.substring(0,l.length)&&(s=o)}if(s!==-1){const o=r[s],a=parseInt(o["LAST-MSN"])||t.lastPartSn;let l=parseInt(o["LAST-PART"])||t.lastPartIndex;if(this.hls.config.lowLatencyMode){const u=Math.min(t.age-t.partTarget,t.targetduration);l>=0&&u>t.partTarget&&(l+=1)}const c=n&&F7(n);return new g5(a,l>=0?l:void 0,c)}}}loadPlaylist(e){this.clearTimer()}loadingPlaylist(e,t){this.clearTimer()}shouldLoadPlaylist(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)}getUrlWithDirectives(e,t){if(t)try{return t.addDirectives(e)}catch(n){this.warn(`Could not construct new URL with HLS Delivery Directives: ${n}`)}return e}playlistLoaded(e,t,n){const{details:r,stats:s}=t,o=self.performance.now(),a=s.loading.first?Math.max(0,o-s.loading.first):0;r.advancedDateTime=Date.now()-a;const l=this.hls.config.timelineOffset;if(l!==r.appliedTimelineOffset){const u=Math.max(l||0,0);r.appliedTimelineOffset=u,r.fragments.forEach(h=>{h.setStart(h.playlistOffset+u)})}if(r.live||n!=null&&n.live){const u="levelInfo"in t?t.levelInfo:t.track;if(r.reloaded(n),n&&r.fragments.length>0){wme(n,r,this);const E=r.playlistParsingError;if(E){this.warn(E);const x=this.hls;if(!x.config.ignorePlaylistParsingErrors){var c;const{networkDetails:C}=t;x.trigger(ae.ERROR,{type:rn.NETWORK_ERROR,details:Ke.LEVEL_PARSING_ERROR,fatal:!1,url:r.url,error:E,reason:E.message,level:t.level||void 0,parent:(c=r.fragments[0])==null?void 0:c.type,networkDetails:C,stats:s});return}r.playlistParsingError=null}}r.requestScheduled===-1&&(r.requestScheduled=s.loading.start);const h=this.hls.mainForwardBufferInfo,f=h?h.end-h.len:0,d=(r.edge-f)*1e3,m=JQ(r,d);if(r.requestScheduled+m<o?r.requestScheduled=o:r.requestScheduled+=m,this.log(`live playlist ${e} ${r.advanced?"REFRESHED "+r.lastPartSn+"-"+r.lastPartIndex:r.updated?"UPDATED":"MISSED"}`),!this.canLoad||!r.live)return;let A,g,y;if(r.canBlockReload&&r.endSN&&r.advanced){const E=this.hls.config.lowLatencyMode,x=r.lastPartSn,C=r.endSN,T=r.lastPartIndex,I=T!==-1,M=x===C;I?M?(g=C+1,y=E?0:T):(g=x,y=E?T+1:r.maxPartIndex):g=C+1;const L=r.age,R=L+r.ageHeader;let P=Math.min(R-r.partTarget,r.targetduration*1.5);if(P>0){if(R>r.targetduration*3)this.log(`Playlist last advanced ${L.toFixed(2)}s ago. Omitting segment and part directives.`),g=void 0,y=void 0;else if(n!=null&&n.tuneInGoal&&R-r.partTarget>n.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${n.tuneInGoal} to: ${P} with playlist age: ${r.age}`),P=0;else{const F=Math.floor(P/r.targetduration);if(g+=F,y!==void 0){const k=Math.round(P%r.targetduration/r.partTarget);y+=k}this.log(`CDN Tune-in age: ${r.ageHeader}s last advanced ${L.toFixed(2)}s goal: ${P} skip sn ${F} to part ${y}`)}r.tuneInGoal=P}if(A=this.getDeliveryDirectives(r,t.deliveryDirectives,g,y),E||!M){r.requestScheduled=o,this.loadingPlaylist(u,A);return}}else(r.canBlockReload||r.canSkipUntil)&&(A=this.getDeliveryDirectives(r,t.deliveryDirectives,g,y));A&&g!==void 0&&r.canBlockReload&&(r.requestScheduled=s.loading.first+Math.max(m-a*2,m/2)),this.scheduleLoading(u,A,r)}else this.clearTimer()}scheduleLoading(e,t,n){const r=n||e.details;if(!r){this.loadingPlaylist(e,t);return}const s=self.performance.now(),o=r.requestScheduled;if(s>=o){this.loadingPlaylist(e,t);return}const a=o-s;this.log(`reload live playlist ${e.name||e.bitrate+"bps"} in ${Math.round(a)} ms`),this.clearTimer(),this.timer=self.setTimeout(()=>this.loadingPlaylist(e,t),a)}getDeliveryDirectives(e,t,n,r){let s=F7(e);return t!=null&&t.skip&&e.deltaUpdateFailed&&(n=t.msn,r=t.part,s=o2.No),new g5(n,r,s)}checkRetry(e){const t=e.details,n=VS(e),r=e.errorAction,{action:s,retryCount:o=0,retryConfig:a}=r||{},l=!!r&&!!a&&(s===Zs.RetryRequest||!r.resolved&&s===Zs.SendAlternateToPenaltyBox);if(l){var c;if(o>=a.maxNumRetry)return!1;if(n&&(c=e.context)!=null&&c.deliveryDirectives)this.warn(`Retrying playlist loading ${o+1}/${a.maxNumRetry} after "${t}" without delivery-directives`),this.loadPlaylist();else{const u=FR(a,o);this.clearTimer(),this.timer=self.setTimeout(()=>this.loadPlaylist(),u),this.warn(`Retrying playlist loading ${o+1}/${a.maxNumRetry} after "${t}" in ${u}ms`)}e.levelRetry=!0,r.resolved=!0}return l}}function CV(i,e){if(i.length!==e.length)return!1;for(let t=0;t<i.length;t++)if(!K2(i[t].attrs,e[t].attrs))return!1;return!0}function K2(i,e,t){const n=i["STABLE-RENDITION-ID"];return n&&!t?n===e["STABLE-RENDITION-ID"]:!(t||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some(r=>i[r]!==e[r])}function w5(i,e){return e.label.toLowerCase()===i.name.toLowerCase()&&(!e.language||e.language.toLowerCase()===(i.lang||"").toLowerCase())}class TV extends x4{constructor(e){super(e,"audio-track-controller"),this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:e}=this;e.on(ae.MANIFEST_LOADING,this.onManifestLoading,this),e.on(ae.MANIFEST_PARSED,this.onManifestParsed,this),e.on(ae.LEVEL_LOADING,this.onLevelLoading,this),e.on(ae.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(ae.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(ae.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(ae.MANIFEST_LOADING,this.onManifestLoading,this),e.off(ae.MANIFEST_PARSED,this.onManifestParsed,this),e.off(ae.LEVEL_LOADING,this.onLevelLoading,this),e.off(ae.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(ae.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(ae.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.audioTracks||[]}onAudioTrackLoaded(e,t){const{id:n,groupId:r,details:s}=t,o=this.tracksInGroup[n];if(!o||o.groupId!==r){this.warn(`Audio track with id:${n} and group:${r} not found in active group ${o==null?void 0:o.groupId}`);return}const a=o.details;o.details=t.details,this.log(`Audio track ${n} "${o.name}" lang:${o.lang} group:${r} loaded [${s.startSN}-${s.endSN}]`),n===this.trackId&&this.playlistLoaded(n,t,a)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const n=t.audioGroups||null,r=this.groupIds;let s=this.currentTrack;if(!n||(r==null?void 0:r.length)!==(n==null?void 0:n.length)||n!=null&&n.some(a=>(r==null?void 0:r.indexOf(a))===-1)){this.groupIds=n,this.trackId=-1,this.currentTrack=null;const a=this.tracks.filter(f=>!n||n.indexOf(f.groupId)!==-1);if(a.length)this.selectDefaultTrack&&!a.some(f=>f.default)&&(this.selectDefaultTrack=!1),a.forEach((f,d)=>{f.id=d});else if(!s&&!this.tracksInGroup.length)return;this.tracksInGroup=a;const l=this.hls.config.audioPreference;if(!s&&l){const f=Ah(l,a,wm);if(f>-1)s=a[f];else{const d=Ah(l,this.tracks);s=this.tracks[d]}}let c=this.findTrackId(s);c===-1&&s&&(c=this.findTrackId(null));const u={audioTracks:a};this.log(`Updating audio tracks, ${a.length} track(s) found in group(s): ${n==null?void 0:n.join(",")}`),this.hls.trigger(ae.AUDIO_TRACKS_UPDATED,u);const h=this.trackId;if(c!==-1&&h===-1)this.setAudioTrack(c);else if(a.length&&h===-1){var o;const f=new Error(`No audio track selected for current audio group-ID(s): ${(o=this.groupIds)==null?void 0:o.join(",")} track count: ${a.length}`);this.warn(f.message),this.hls.trigger(ae.ERROR,{type:rn.MEDIA_ERROR,details:Ke.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:f})}}}onError(e,t){t.fatal||!t.context||t.context.type===ai.AUDIO_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allAudioTracks(){return this.tracks}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}setAudioOption(e){const t=this.hls;if(t.config.audioPreference=e,e){const n=this.allAudioTracks;if(this.selectDefaultTrack=!1,n.length){const r=this.currentTrack;if(r&&Vm(e,r,wm))return r;const s=Ah(e,this.tracksInGroup,wm);if(s>-1){const o=this.tracksInGroup[s];return this.setAudioTrack(s),o}else if(r){let o=t.loadLevel;o===-1&&(o=t.firstAutoLevel);const a=$pe(e,t.levels,n,o,wm);if(a===-1)return null;t.nextLoadLevel=a}if(e.channels||e.audioCodec){const o=Ah(e,n);if(o>-1)return n[o]}}}return null}setAudioTrack(e){const t=this.tracksInGroup;if(e<0||e>=t.length){this.warn(`Invalid audio track id: ${e}`);return}this.selectDefaultTrack=!1;const n=this.currentTrack,r=t[e],s=r.details&&!r.details.live;if(e===this.trackId&&r===n&&s||(this.log(`Switching to audio-track ${e} "${r.name}" lang:${r.lang} group:${r.groupId} channels:${r.channels}`),this.trackId=e,this.currentTrack=r,this.hls.trigger(ae.AUDIO_TRACK_SWITCHING,Qi({},r)),s))return;const o=this.switchParams(r.url,n==null?void 0:n.details,r.details);this.loadPlaylist(o)}findTrackId(e){const t=this.tracksInGroup;for(let n=0;n<t.length;n++){const r=t[n];if(!(this.selectDefaultTrack&&!r.default)&&(!e||Vm(e,r,wm)))return n}if(e){const{name:n,lang:r,assocLang:s,characteristics:o,audioCodec:a,channels:l}=e;for(let c=0;c<t.length;c++){const u=t[c];if(Vm({name:n,lang:r,assocLang:s,characteristics:o,audioCodec:a,channels:l},u,wm))return c}for(let c=0;c<t.length;c++){const u=t[c];if(K2(e.attrs,u.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return c}for(let c=0;c<t.length;c++){const u=t[c];if(K2(e.attrs,u.attrs,["LANGUAGE"]))return c}}return-1}loadPlaylist(e){super.loadPlaylist();const t=this.currentTrack;this.shouldLoadPlaylist(t)&&QS(t.url,this.hls)&&this.scheduleLoading(t,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const n=e.id,r=e.groupId,s=this.getUrlWithDirectives(e.url,t),o=e.details,a=o==null?void 0:o.age;this.log(`Loading audio-track ${n} "${e.name}" lang:${e.lang} group:${r}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${a&&o.live?" age "+a.toFixed(1)+(o.type&&" "+o.type||""):""} ${s}`),this.hls.trigger(ae.AUDIO_TRACK_LOADING,{url:s,id:n,groupId:r,deliveryDirectives:t||null,track:e})}}class P0e{constructor(e){this.tracks=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.tracks=e}destroy(){this.tracks=this.queues=null}append(e,t,n){if(this.queues===null||this.tracks===null)return;const r=this.queues[t];r.push(e),r.length===1&&!n&&this.executeNext(t)}appendBlocker(e){return new Promise(t=>{const n={label:"async-blocker",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.append(n,e)})}prependBlocker(e){return new Promise(t=>{if(this.queues){const n={label:"async-blocker-prepend",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.queues[e].unshift(n)}})}removeBlockers(){this.queues!==null&&[this.queues.video,this.queues.audio,this.queues.audiovideo].forEach(e=>{var t;const n=(t=e[0])==null?void 0:t.label;(n==="async-blocker"||n==="async-blocker-prepend")&&(e[0].execute(),e.splice(0,1))})}unblockAudio(e){if(this.queues===null)return;this.queues.audio[0]===e&&this.shiftAndExecuteNext("audio")}executeNext(e){if(this.queues===null||this.tracks===null)return;const t=this.queues[e];if(t.length){const r=t[0];try{r.execute()}catch(s){var n;if(r.onError(s),this.queues===null||this.tracks===null)return;const o=(n=this.tracks[e])==null?void 0:n.buffer;o!=null&&o.updating||this.shiftAndExecuteNext(e)}}}shiftAndExecuteNext(e){this.queues!==null&&(this.queues[e].shift(),this.executeNext(e))}current(e){var t;return((t=this.queues)==null?void 0:t[e][0])||null}toString(){const{queues:e,tracks:t}=this;return e===null||t===null?"<destroyed>":`
${this.list("video")}
${this.list("audio")}
${this.list("audiovideo")}}`}list(e){var t,n;return(t=this.queues)!=null&&t[e]||(n=this.tracks)!=null&&n[e]?`${e}: (${this.listSbInfo(e)}) ${this.listOps(e)}`:""}listSbInfo(e){var t;const n=(t=this.tracks)==null?void 0:t[e],r=n==null?void 0:n.buffer;return r?`SourceBuffer${r.updating?" updating":""}${n.ended?" ended":""}${n.ending?" ending":""}`:"none"}listOps(e){var t;return((t=this.queues)==null?void 0:t[e].map(n=>n.label).join(", "))||""}}const Ek=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/,bV="HlsJsTrackRemovedError";class B0e extends Error{constructor(e){super(e),this.name=bV}}class IV extends _c{constructor(e,t){super("buffer-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.details=null,this._objectUrl=null,this.operationQueue=null,this.bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.blockedAudioAppend=null,this.lastVideoAppendEnd=0,this.appendSource=void 0,this.transferData=void 0,this.overrides=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.sourceBuffers=[[null,null],[null,null]],this._onEndStreaming=n=>{var r;this.hls&&((r=this.mediaSource)==null?void 0:r.readyState)==="open"&&this.hls.pauseBuffering()},this._onStartStreaming=n=>{this.hls&&this.hls.resumeBuffering()},this._onMediaSourceOpen=n=>{const{media:r,mediaSource:s}=this;n&&this.log("Media source opened"),!(!r||!s)&&(s.removeEventListener("sourceopen",this._onMediaSourceOpen),r.removeEventListener("emptied",this._onMediaEmptied),this.updateDuration(),this.hls.trigger(ae.MEDIA_ATTACHED,{media:r,mediaSource:s}),this.mediaSource!==null&&this.checkPendingTracks())},this._onMediaSourceClose=()=>{this.log("Media source closed")},this._onMediaSourceEnded=()=>{this.log("Media source ended")},this._onMediaEmptied=()=>{const{mediaSrc:n,_objectUrl:r}=this;n!==r&&this.error(`Media element src was set while attaching MediaSource (${r} > ${n})`)},this.hls=e,this.fragmentTracker=t,this.appendSource=lpe(Uf(e.config.preferManagedMediaSource)),this.initTracks(),this.registerListeners()}hasSourceTypes(){return Object.keys(this.tracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.transferData=this.overrides=void 0,this.operationQueue&&(this.operationQueue.destroy(),this.operationQueue=null),this.hls=this.fragmentTracker=null,this._onMediaSourceOpen=this._onMediaSourceClose=null,this._onMediaSourceEnded=null,this._onStartStreaming=this._onEndStreaming=null}registerListeners(){const{hls:e}=this;e.on(ae.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(ae.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(ae.MANIFEST_LOADING,this.onManifestLoading,this),e.on(ae.MANIFEST_PARSED,this.onManifestParsed,this),e.on(ae.BUFFER_RESET,this.onBufferReset,this),e.on(ae.BUFFER_APPENDING,this.onBufferAppending,this),e.on(ae.BUFFER_CODECS,this.onBufferCodecs,this),e.on(ae.BUFFER_EOS,this.onBufferEos,this),e.on(ae.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(ae.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(ae.FRAG_PARSED,this.onFragParsed,this),e.on(ae.FRAG_CHANGED,this.onFragChanged,this),e.on(ae.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(ae.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(ae.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(ae.MANIFEST_LOADING,this.onManifestLoading,this),e.off(ae.MANIFEST_PARSED,this.onManifestParsed,this),e.off(ae.BUFFER_RESET,this.onBufferReset,this),e.off(ae.BUFFER_APPENDING,this.onBufferAppending,this),e.off(ae.BUFFER_CODECS,this.onBufferCodecs,this),e.off(ae.BUFFER_EOS,this.onBufferEos,this),e.off(ae.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(ae.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(ae.FRAG_PARSED,this.onFragParsed,this),e.off(ae.FRAG_CHANGED,this.onFragChanged,this),e.off(ae.ERROR,this.onError,this)}transferMedia(){const{media:e,mediaSource:t}=this;if(!e)return null;const n={};if(this.operationQueue){const s=this.isUpdating();s||this.operationQueue.removeBlockers();const o=this.isQueued();(s||o)&&this.warn(`Transfering MediaSource with${o?" operations in queue":""}${s?" updating SourceBuffer(s)":""} ${this.operationQueue}`),this.operationQueue.destroy()}const r=this.transferData;return!this.sourceBufferCount&&r&&r.mediaSource===t?er(n,r.tracks):this.sourceBuffers.forEach(s=>{const[o]=s;o&&(n[o]=er({},this.tracks[o]),this.removeBuffer(o)),s[0]=s[1]=null}),{media:e,mediaSource:t,tracks:n}}initTracks(){const e={};this.sourceBuffers=[[null,null],[null,null]],this.tracks=e,this.resetQueue(),this.resetAppendErrors(),this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.lastVideoAppendEnd=0}onManifestLoading(){this.bufferCodecEventsTotal=0,this.details=null}onManifestParsed(e,t){var n;let r=2;(t.audio&&!t.video||!t.altAudio)&&(r=1),this.bufferCodecEventsTotal=r,this.log(`${r} bufferCodec event(s) expected.`),(n=this.transferData)!=null&&n.mediaSource&&this.sourceBufferCount&&r&&this.bufferCreated()}onMediaAttaching(e,t){const n=this.media=t.media;this.transferData=this.overrides=void 0;const r=Uf(this.appendSource);if(r){const s=!!t.mediaSource;(s||t.overrides)&&(this.transferData=t,this.overrides=t.overrides);const o=this.mediaSource=t.mediaSource||new r;if(this.assignMediaSource(o),s)this._objectUrl=n.src,this.attachTransferred();else{const a=this._objectUrl=self.URL.createObjectURL(o);if(this.appendSource)try{n.removeAttribute("src");const l=self.ManagedMediaSource;n.disableRemotePlayback=n.disableRemotePlayback||l&&o instanceof l,_k(n),D0e(n,a),n.load()}catch{n.src=a}else n.src=a}n.addEventListener("emptied",this._onMediaEmptied)}}assignMediaSource(e){var t,n;this.log(`${((t=this.transferData)==null?void 0:t.mediaSource)===e?"transferred":"created"} media source: ${(n=e.constructor)==null?void 0:n.name}`),e.addEventListener("sourceopen",this._onMediaSourceOpen),e.addEventListener("sourceended",this._onMediaSourceEnded),e.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(e.addEventListener("startstreaming",this._onStartStreaming),e.addEventListener("endstreaming",this._onEndStreaming))}attachTransferred(){const e=this.media,t=this.transferData;if(!t||!e)return;const n=this.tracks,r=t.tracks,s=r?Object.keys(r):null,o=s?s.length:0,a=()=>{Promise.resolve().then(()=>{this.media&&this.mediaSourceOpenOrEnded&&this._onMediaSourceOpen()})};if(r&&s&&o){if(!this.tracksReady){this.hls.config.startFragPrefetch=!0,this.log("attachTransferred: waiting for SourceBuffer track info");return}if(this.log(`attachTransferred: (bufferCodecEventsTotal ${this.bufferCodecEventsTotal})
required tracks: ${lr(n,(l,c)=>l==="initSegment"?void 0:c)};
transfer tracks: ${lr(r,(l,c)=>l==="initSegment"?void 0:c)}}`),!xQ(r,n)){t.mediaSource=null,t.tracks=void 0;const l=e.currentTime,c=this.details,u=Math.max(l,(c==null?void 0:c.fragments[0].start)||0);if(u-l>1){this.log(`attachTransferred: waiting for playback to reach new tracks start time ${l} -> ${u}`);return}this.warn(`attachTransferred: resetting MediaSource for incompatible tracks ("${Object.keys(r)}"->"${Object.keys(n)}") start time: ${u} currentTime: ${l}`),this.onMediaDetaching(ae.MEDIA_DETACHING,{}),this.onMediaAttaching(ae.MEDIA_ATTACHING,t),e.currentTime=u;return}this.transferData=void 0,s.forEach(l=>{const c=l,u=r[c];if(u){const h=u.buffer;if(h){const f=this.fragmentTracker,d=u.id;if(f.hasFragments(d)||f.hasParts(d)){const g=jn.getBuffered(h);f.detectEvictedFragments(c,g,d,null,!0)}const m=Hb(c),A=[c,h];this.sourceBuffers[m]=A,h.updating&&this.operationQueue&&this.operationQueue.prependBlocker(c),this.trackSourceBuffer(c,u)}}}),a(),this.bufferCreated()}else this.log("attachTransferred: MediaSource w/o SourceBuffers"),a()}get mediaSourceOpenOrEnded(){var e;const t=(e=this.mediaSource)==null?void 0:e.readyState;return t==="open"||t==="ended"}onMediaDetaching(e,t){const n=!!t.transferMedia;this.transferData=this.overrides=void 0;const{media:r,mediaSource:s,_objectUrl:o}=this;if(s){if(this.log(`media source ${n?"transferring":"detaching"}`),n)this.sourceBuffers.forEach(([a])=>{a&&this.removeBuffer(a)}),this.resetQueue();else{if(this.mediaSourceOpenOrEnded){const a=s.readyState==="open";try{const l=s.sourceBuffers;for(let c=l.length;c--;)a&&l[c].abort(),s.removeSourceBuffer(l[c]);a&&s.endOfStream()}catch(l){this.warn(`onMediaDetaching: ${l.message} while calling endOfStream`)}}this.sourceBufferCount&&this.onBufferReset()}s.removeEventListener("sourceopen",this._onMediaSourceOpen),s.removeEventListener("sourceended",this._onMediaSourceEnded),s.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(s.removeEventListener("startstreaming",this._onStartStreaming),s.removeEventListener("endstreaming",this._onEndStreaming)),this.mediaSource=null,this._objectUrl=null}r&&(r.removeEventListener("emptied",this._onMediaEmptied),n||(o&&self.URL.revokeObjectURL(o),this.mediaSrc===o?(r.removeAttribute("src"),this.appendSource&&_k(r),r.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.media=null),this.hls.trigger(ae.MEDIA_DETACHED,t)}onBufferReset(){this.sourceBuffers.forEach(([e])=>{e&&this.resetBuffer(e)}),this.initTracks()}resetBuffer(e){var t;const n=(t=this.tracks[e])==null?void 0:t.buffer;if(this.removeBuffer(e),n)try{var r;(r=this.mediaSource)!=null&&r.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(n)}catch(s){this.warn(`onBufferReset ${e}`,s)}delete this.tracks[e]}removeBuffer(e){this.removeBufferListeners(e),this.sourceBuffers[Hb(e)]=[null,null];const t=this.tracks[e];t&&(t.buffer=void 0)}resetQueue(){this.operationQueue&&this.operationQueue.destroy(),this.operationQueue=new P0e(this.tracks)}onBufferCodecs(e,t){var n;const r=this.tracks,s=Object.keys(t);this.log(`BUFFER_CODECS: "${s}" (current SB count ${this.sourceBufferCount})`);const o="audiovideo"in t&&(r.audio||r.video)||r.audiovideo&&("audio"in t||"video"in t),a=!o&&this.sourceBufferCount&&this.media&&s.some(l=>!r[l]);if(o||a){this.warn(`Unsupported transition between "${Object.keys(r)}" and "${s}" SourceBuffers`);return}s.forEach(l=>{var c,u;const h=t[l],{id:f,codec:d,levelCodec:m,container:A,metadata:g,supplemental:y}=h;let E=r[l];const x=(c=this.transferData)==null||(c=c.tracks)==null?void 0:c[l],C=x!=null&&x.buffer?x:E,T=(C==null?void 0:C.pendingCodec)||(C==null?void 0:C.codec),I=C==null?void 0:C.levelCodec;E||(E=r[l]={buffer:void 0,listeners:[],codec:d,supplemental:y,container:A,levelCodec:m,metadata:g,id:f});const M=Z_(T,I),L=M==null?void 0:M.replace(Ek,"$1");let R=Z_(d,m);const P=(u=R)==null?void 0:u.replace(Ek,"$1");R&&M&&L!==P&&(l.slice(0,5)==="audio"&&(R=GS(R,this.appendSource)),this.log(`switching codec ${T} to ${R}`),R!==(E.pendingCodec||E.codec)&&(E.pendingCodec=R),E.container=A,this.appendChangeType(l,A,R))}),(this.tracksReady||this.sourceBufferCount)&&(t.tracks=this.sourceBufferTracks),!this.sourceBufferCount&&(this.bufferCodecEventsTotal>1&&!this.tracks.video&&!t.video&&((n=t.audio)==null?void 0:n.id)==="main"&&(this.log("Main audio-only"),this.bufferCodecEventsTotal=1),this.mediaSourceOpenOrEnded&&this.checkPendingTracks())}get sourceBufferTracks(){return Object.keys(this.tracks).reduce((e,t)=>{const n=this.tracks[t];return e[t]={id:n.id,container:n.container,codec:n.codec,levelCodec:n.levelCodec},e},{})}appendChangeType(e,t,n){const r=`${t};codecs=${n}`,s={label:`change-type=${r}`,execute:()=>{const o=this.tracks[e];if(o){const a=o.buffer;a!=null&&a.changeType&&(this.log(`changing ${e} sourceBuffer type to ${r}`),a.changeType(r),o.codec=n,o.container=t)}this.shiftAndExecuteNext(e)},onStart:()=>{},onComplete:()=>{},onError:o=>{this.warn(`Failed to change ${e} SourceBuffer type`,o)}};this.append(s,e,this.isPending(this.tracks[e]))}blockAudio(e){var t;const n=e.start,r=n+e.duration*.05;if(((t=this.fragmentTracker.getAppendedFrag(n,Yt.MAIN))==null?void 0:t.gap)===!0)return;const o={label:"block-audio",execute:()=>{var a;const l=this.tracks.video;(this.lastVideoAppendEnd>r||l!=null&&l.buffer&&jn.isBuffered(l.buffer,r)||((a=this.fragmentTracker.getAppendedFrag(r,Yt.MAIN))==null?void 0:a.gap)===!0)&&(this.blockedAudioAppend=null,this.shiftAndExecuteNext("audio"))},onStart:()=>{},onComplete:()=>{},onError:a=>{this.warn("Error executing block-audio operation",a)}};this.blockedAudioAppend={op:o,frag:e},this.append(o,"audio",!0)}unblockAudio(){const{blockedAudioAppend:e,operationQueue:t}=this;e&&t&&(this.blockedAudioAppend=null,t.unblockAudio(e.op))}onBufferAppending(e,t){const{tracks:n}=this,{data:r,type:s,parent:o,frag:a,part:l,chunkMeta:c,offset:u}=t,h=c.buffering[s],{sn:f,cc:d}=a,m=self.performance.now();h.start=m;const A=a.stats.buffering,g=l?l.stats.buffering:null;A.start===0&&(A.start=m),g&&g.start===0&&(g.start=m);const y=n.audio;let E=!1;s==="audio"&&(y==null?void 0:y.container)==="audio/mpeg"&&(E=!this.lastMpegAudioChunk||c.id===1||this.lastMpegAudioChunk.sn!==c.sn,this.lastMpegAudioChunk=c);const x=n.video,C=x==null?void 0:x.buffer;if(C&&f!=="initSegment"){const M=l||a,L=this.blockedAudioAppend;if(s==="audio"&&o!=="main"&&!this.blockedAudioAppend&&!(x.ending||x.ended)){const P=M.start+M.duration*.05,F=C.buffered,k=this.currentOp("video");!F.length&&!k?this.blockAudio(M):!k&&!jn.isBuffered(C,P)&&this.lastVideoAppendEnd<P&&this.blockAudio(M)}else if(s==="video"){const R=M.end;if(L){const P=L.frag.start;(R>P||R<this.lastVideoAppendEnd||jn.isBuffered(C,P))&&this.unblockAudio()}this.lastVideoAppendEnd=R}}const T=(l||a).start,I={label:`append-${s}`,execute:()=>{var M;h.executeStart=self.performance.now();const L=(M=this.tracks[s])==null?void 0:M.buffer;L&&(E?this.updateTimestampOffset(L,T,.1,s,f,d):u!==void 0&&Wt(u)&&this.updateTimestampOffset(L,u,1e-6,s,f,d)),this.appendExecutor(r,s)},onStart:()=>{},onComplete:()=>{const M=self.performance.now();h.executeEnd=h.end=M,A.first===0&&(A.first=M),g&&g.first===0&&(g.first=M);const L={};this.sourceBuffers.forEach(([R,P])=>{R&&(L[R]=jn.getBuffered(P))}),this.appendErrors[s]=0,s==="audio"||s==="video"?this.appendErrors.audiovideo=0:(this.appendErrors.audio=0,this.appendErrors.video=0),this.hls.trigger(ae.BUFFER_APPENDED,{type:s,frag:a,part:l,chunkMeta:c,parent:a.type,timeRanges:L})},onError:M=>{var L;const R={type:rn.MEDIA_ERROR,parent:a.type,details:Ke.BUFFER_APPEND_ERROR,sourceBufferName:s,frag:a,part:l,chunkMeta:c,error:M,err:M,fatal:!1},P=(L=this.media)==null?void 0:L.error;if(M.code===DOMException.QUOTA_EXCEEDED_ERR||M.name=="QuotaExceededError"||"quota"in M)R.details=Ke.BUFFER_FULL_ERROR;else if(M.code===DOMException.INVALID_STATE_ERR&&this.mediaSourceOpenOrEnded&&!P)R.errorAction=V1(!0);else if(M.name===bV&&this.sourceBufferCount===0)R.errorAction=V1(!0);else{const F=++this.appendErrors[s];this.warn(`Failed ${F}/${this.hls.config.appendErrorMaxRetry} times to append segment in "${s}" sourceBuffer (${P||"no media error"})`),(F>=this.hls.config.appendErrorMaxRetry||P)&&(R.fatal=!0)}this.hls.trigger(ae.ERROR,R)}};this.log(`queuing "${s}" append sn: ${f}${l?" p: "+l.index:""} of ${a.type===Yt.MAIN?"level":"track"} ${a.level} cc: ${d}`),this.append(I,s,this.isPending(this.tracks[s]))}getFlushOp(e,t,n){return this.log(`queuing "${e}" remove ${t}-${n}`),{label:"remove",execute:()=>{this.removeExecutor(e,t,n)},onStart:()=>{},onComplete:()=>{this.hls.trigger(ae.BUFFER_FLUSHED,{type:e})},onError:r=>{this.warn(`Failed to remove ${t}-${n} from "${e}" SourceBuffer`,r)}}}onBufferFlushing(e,t){const{type:n,startOffset:r,endOffset:s}=t;n?this.append(this.getFlushOp(n,r,s),n):this.sourceBuffers.forEach(([o])=>{o&&this.append(this.getFlushOp(o,r,s),o)})}onFragParsed(e,t){const{frag:n,part:r}=t,s=[],o=r?r.elementaryStreams:n.elementaryStreams;o[ar.AUDIOVIDEO]?s.push("audiovideo"):(o[ar.AUDIO]&&s.push("audio"),o[ar.VIDEO]&&s.push("video"));const a=()=>{const l=self.performance.now();n.stats.buffering.end=l,r&&(r.stats.buffering.end=l);const c=r?r.stats:n.stats;this.hls.trigger(ae.FRAG_BUFFERED,{frag:n,part:r,stats:c,id:n.type})};s.length===0&&this.warn(`Fragments must have at least one ElementaryStreamType set. type: ${n.type} level: ${n.level} sn: ${n.sn}`),this.blockBuffers(a,s).catch(l=>{this.warn(`Fragment buffered callback ${l}`),this.stepOperationQueue(this.sourceBufferTypes)})}onFragChanged(e,t){this.trimBuffers()}get bufferedToEnd(){return this.sourceBufferCount>0&&!this.sourceBuffers.some(([e])=>{if(e){const t=this.tracks[e];if(t)return!t.ended||t.ending}return!1})}onBufferEos(e,t){var n;this.sourceBuffers.forEach(([o])=>{if(o){const a=this.tracks[o];(!t.type||t.type===o)&&(a.ending=!0,a.ended||(a.ended=!0,this.log(`${o} buffer reached EOS`)))}});const r=((n=this.overrides)==null?void 0:n.endOfStream)!==!1;this.sourceBufferCount>0&&!this.sourceBuffers.some(([o])=>{var a;return o&&!((a=this.tracks[o])!=null&&a.ended)})?r?(this.log("Queueing EOS"),this.blockUntilOpen(()=>{this.tracksEnded();const{mediaSource:o}=this;if(!o||o.readyState!=="open"){o&&this.log(`Could not call mediaSource.endOfStream(). mediaSource.readyState: ${o.readyState}`);return}this.log("Calling mediaSource.endOfStream()"),o.endOfStream(),this.hls.trigger(ae.BUFFERED_TO_END,void 0)})):(this.tracksEnded(),this.hls.trigger(ae.BUFFERED_TO_END,void 0)):t.type==="video"&&this.unblockAudio()}tracksEnded(){this.sourceBuffers.forEach(([e])=>{if(e!==null){const t=this.tracks[e];t&&(t.ending=!1)}})}onLevelUpdated(e,{details:t}){t.fragments.length&&(this.details=t,this.updateDuration())}updateDuration(){this.blockUntilOpen(()=>{const e=this.getDurationAndRange();e&&this.updateMediaSource(e)})}onError(e,t){if(t.details===Ke.BUFFER_APPEND_ERROR&&t.frag){var n;const r=(n=t.errorAction)==null?void 0:n.nextAutoLevel;Wt(r)&&r!==t.frag.level&&this.resetAppendErrors()}}resetAppendErrors(){this.appendErrors={audio:0,video:0,audiovideo:0}}trimBuffers(){const{hls:e,details:t,media:n}=this;if(!n||t===null||!this.sourceBufferCount)return;const r=e.config,s=n.currentTime,o=t.levelTargetDuration,a=t.live&&r.liveBackBufferLength!==null?r.liveBackBufferLength:r.backBufferLength;if(Wt(a)&&a>=0){const c=Math.max(a,o),u=Math.floor(s/o)*o-c;this.flushBackBuffer(s,o,u)}const l=r.frontBufferFlushThreshold;if(Wt(l)&&l>0){const c=Math.max(r.maxBufferLength,l),u=Math.max(c,o),h=Math.floor(s/o)*o+u;this.flushFrontBuffer(s,o,h)}}flushBackBuffer(e,t,n){this.sourceBuffers.forEach(([r,s])=>{if(s){const a=jn.getBuffered(s);if(a.length>0&&n>a.start(0)){var o;this.hls.trigger(ae.BACK_BUFFER_REACHED,{bufferEnd:n});const l=this.tracks[r];if((o=this.details)!=null&&o.live)this.hls.trigger(ae.LIVE_BACK_BUFFER_REACHED,{bufferEnd:n});else if(l!=null&&l.ended){this.log(`Cannot flush ${r} back buffer while SourceBuffer is in ended state`);return}this.hls.trigger(ae.BUFFER_FLUSHING,{startOffset:0,endOffset:n,type:r})}}})}flushFrontBuffer(e,t,n){this.sourceBuffers.forEach(([r,s])=>{if(s){const o=jn.getBuffered(s),a=o.length;if(a<2)return;const l=o.start(a-1),c=o.end(a-1);if(n>l||e>=l&&e<=c)return;this.hls.trigger(ae.BUFFER_FLUSHING,{startOffset:l,endOffset:1/0,type:r})}})}getDurationAndRange(){var e;const{details:t,mediaSource:n}=this;if(!t||!this.media||(n==null?void 0:n.readyState)!=="open")return null;const r=t.edge;if(t.live&&this.hls.config.liveDurationInfinity){if(t.fragments.length&&n.setLiveSeekableRange){const c=Math.max(0,t.fragmentStart),u=Math.max(c,r);return{duration:1/0,start:c,end:u}}return{duration:1/0}}const s=(e=this.overrides)==null?void 0:e.duration;if(s)return Wt(s)?{duration:s}:null;const o=this.media.duration,a=Wt(n.duration)?n.duration:0;return r>a&&r>o||!Wt(o)?{duration:r}:null}updateMediaSource({duration:e,start:t,end:n}){const r=this.mediaSource;!this.media||!r||r.readyState!=="open"||(r.duration!==e&&(Wt(e)&&this.log(`Updating MediaSource duration to ${e.toFixed(3)}`),r.duration=e),t!==void 0&&n!==void 0&&(this.log(`MediaSource duration is set to ${r.duration}. Setting seekable range to ${t}-${n}.`),r.setLiveSeekableRange(t,n)))}get tracksReady(){const e=this.pendingTrackCount;return e>0&&(e>=this.bufferCodecEventsTotal||this.isPending(this.tracks.audiovideo))}checkPendingTracks(){const{bufferCodecEventsTotal:e,pendingTrackCount:t,tracks:n}=this;if(this.log(`checkPendingTracks (pending: ${t} codec events expected: ${e}) ${lr(n)}`),this.tracksReady){var r;const s=(r=this.transferData)==null?void 0:r.tracks;s&&Object.keys(s).length?this.attachTransferred():this.createSourceBuffers()}}bufferCreated(){if(this.sourceBufferCount){const e={};this.sourceBuffers.forEach(([t,n])=>{if(t){const r=this.tracks[t];e[t]={buffer:n,container:r.container,codec:r.codec,supplemental:r.supplemental,levelCodec:r.levelCodec,id:r.id,metadata:r.metadata}}}),this.hls.trigger(ae.BUFFER_CREATED,{tracks:e}),this.log(`SourceBuffers created. Running queue: ${this.operationQueue}`),this.sourceBuffers.forEach(([t])=>{this.executeNext(t)})}else{const e=new Error("could not create source buffer for media codec(s)");this.hls.trigger(ae.ERROR,{type:rn.MEDIA_ERROR,details:Ke.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:e,reason:e.message})}}createSourceBuffers(){const{tracks:e,sourceBuffers:t,mediaSource:n}=this;if(!n)throw new Error("createSourceBuffers called when mediaSource was null");for(const s in e){const o=s,a=e[o];if(this.isPending(a)){const l=this.getTrackCodec(a,o),c=`${a.container};codecs=${l}`;a.codec=l,this.log(`creating sourceBuffer(${c})${this.currentOp(o)?" Queued":""} ${lr(a)}`);try{const u=n.addSourceBuffer(c),h=Hb(o),f=[o,u];t[h]=f,a.buffer=u}catch(u){var r;this.error(`error while trying to add sourceBuffer: ${u.message}`),this.shiftAndExecuteNext(o),(r=this.operationQueue)==null||r.removeBlockers(),delete this.tracks[o],this.hls.trigger(ae.ERROR,{type:rn.MEDIA_ERROR,details:Ke.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:u,sourceBufferName:o,mimeType:c,parent:a.id});return}this.trackSourceBuffer(o,a)}}this.bufferCreated()}getTrackCodec(e,t){const n=e.supplemental;let r=e.codec;n&&(t==="video"||t==="audiovideo")&&H2(n,"video")&&(r=Mpe(r,n));const s=Z_(r,e.levelCodec);return s?t.slice(0,5)==="audio"?GS(s,this.appendSource):s:""}trackSourceBuffer(e,t){const n=t.buffer;if(!n)return;const r=this.getTrackCodec(t,e);this.tracks[e]={buffer:n,codec:r,container:t.container,levelCodec:t.levelCodec,supplemental:t.supplemental,metadata:t.metadata,id:t.id,listeners:[]},this.removeBufferListeners(e),this.addBufferListener(e,"updatestart",this.onSBUpdateStart),this.addBufferListener(e,"updateend",this.onSBUpdateEnd),this.addBufferListener(e,"error",this.onSBUpdateError),this.appendSource&&this.addBufferListener(e,"bufferedchange",(s,o)=>{const a=o.removedRanges;a!=null&&a.length&&this.hls.trigger(ae.BUFFER_FLUSHED,{type:s})})}get mediaSrc(){var e,t;const n=((e=this.media)==null||(t=e.querySelector)==null?void 0:t.call(e,"source"))||this.media;return n==null?void 0:n.src}onSBUpdateStart(e){const t=this.currentOp(e);t&&t.onStart()}onSBUpdateEnd(e){var t;if(((t=this.mediaSource)==null?void 0:t.readyState)==="closed"){this.resetBuffer(e);return}const n=this.currentOp(e);n&&(n.onComplete(),this.shiftAndExecuteNext(e))}onSBUpdateError(e,t){var n;const r=new Error(`${e} SourceBuffer error. MediaSource readyState: ${(n=this.mediaSource)==null?void 0:n.readyState}`);this.error(`${r}`,t),this.hls.trigger(ae.ERROR,{type:rn.MEDIA_ERROR,details:Ke.BUFFER_APPENDING_ERROR,sourceBufferName:e,error:r,fatal:!1});const s=this.currentOp(e);s&&s.onError(r)}updateTimestampOffset(e,t,n,r,s,o){const a=t-e.timestampOffset;Math.abs(a)>=n&&(this.log(`Updating ${r} SourceBuffer timestampOffset to ${t} (sn: ${s} cc: ${o})`),e.timestampOffset=t)}removeExecutor(e,t,n){const{media:r,mediaSource:s}=this,o=this.tracks[e],a=o==null?void 0:o.buffer;if(!r||!s||!a){this.warn(`Attempting to remove from the ${e} SourceBuffer, but it does not exist`),this.shiftAndExecuteNext(e);return}const l=Wt(r.duration)?r.duration:1/0,c=Wt(s.duration)?s.duration:1/0,u=Math.max(0,t),h=Math.min(n,l,c);h>u&&(!o.ending||o.ended)?(o.ended=!1,this.log(`Removing [${u},${h}] from the ${e} SourceBuffer`),a.remove(u,h)):this.shiftAndExecuteNext(e)}appendExecutor(e,t){const n=this.tracks[t],r=n==null?void 0:n.buffer;if(!r)throw new B0e(`Attempting to append to the ${t} SourceBuffer, but it does not exist`);n.ending=!1,n.ended=!1,r.appendBuffer(e)}blockUntilOpen(e){if(this.isUpdating()||this.isQueued())this.blockBuffers(e).catch(t=>{this.warn(`SourceBuffer blocked callback ${t}`),this.stepOperationQueue(this.sourceBufferTypes)});else try{e()}catch(t){this.warn(`Callback run without blocking ${this.operationQueue} ${t}`)}}isUpdating(){return this.sourceBuffers.some(([e,t])=>e&&t.updating)}isQueued(){return this.sourceBuffers.some(([e])=>e&&!!this.currentOp(e))}isPending(e){return!!e&&!e.buffer}blockBuffers(e,t=this.sourceBufferTypes){if(!t.length)return this.log("Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(e);const{operationQueue:n}=this,r=t.map(o=>this.appendBlocker(o));return t.length>1&&!!this.blockedAudioAppend&&this.unblockAudio(),Promise.all(r).then(o=>{n===this.operationQueue&&(e(),this.stepOperationQueue(this.sourceBufferTypes))})}stepOperationQueue(e){e.forEach(t=>{var n;const r=(n=this.tracks[t])==null?void 0:n.buffer;!r||r.updating||this.shiftAndExecuteNext(t)})}append(e,t,n){this.operationQueue&&this.operationQueue.append(e,t,n)}appendBlocker(e){if(this.operationQueue)return this.operationQueue.appendBlocker(e)}currentOp(e){return this.operationQueue?this.operationQueue.current(e):null}executeNext(e){e&&this.operationQueue&&this.operationQueue.executeNext(e)}shiftAndExecuteNext(e){this.operationQueue&&this.operationQueue.shiftAndExecuteNext(e)}get pendingTrackCount(){return Object.keys(this.tracks).reduce((e,t)=>e+(this.isPending(this.tracks[t])?1:0),0)}get sourceBufferCount(){return this.sourceBuffers.reduce((e,[t])=>e+(t?1:0),0)}get sourceBufferTypes(){return this.sourceBuffers.map(([e])=>e).filter(e=>!!e)}addBufferListener(e,t,n){const r=this.tracks[e];if(!r)return;const s=r.buffer;if(!s)return;const o=n.bind(this,e);r.listeners.push({event:t,listener:o}),s.addEventListener(t,o)}removeBufferListeners(e){const t=this.tracks[e];if(!t)return;const n=t.buffer;n&&(t.listeners.forEach(r=>{n.removeEventListener(r.event,r.listener)}),t.listeners.length=0)}}function _k(i){const e=i.querySelectorAll("source");[].slice.call(e).forEach(t=>{i.removeChild(t)})}function D0e(i,e){const t=self.document.createElement("source");t.type="video/mp4",t.src=e,i.appendChild(t)}function Hb(i){return i==="audio"?1:0}class E4{constructor(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(e){this.streamController=e}destroy(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:e}=this;e.on(ae.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(ae.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(ae.MANIFEST_PARSED,this.onManifestParsed,this),e.on(ae.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(ae.BUFFER_CODECS,this.onBufferCodecs,this),e.on(ae.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:e}=this;e.off(ae.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(ae.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(ae.MANIFEST_PARSED,this.onManifestParsed,this),e.off(ae.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(ae.BUFFER_CODECS,this.onBufferCodecs,this),e.off(ae.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(e,t){const n=this.hls.levels[t.droppedLevel];this.isLevelAllowed(n)&&this.restrictedLevels.push({bitrate:n.bitrate,height:n.height,width:n.width})}onMediaAttaching(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()}onManifestParsed(e,t){const n=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,n.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onLevelsUpdated(e,t){this.timer&&Wt(this.autoLevelCapping)&&this.detectPlayerSize()}onBufferCodecs(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onMediaDetaching(){this.stopCapping(),this.media=null}detectPlayerSize(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0){this.clientRect=null;return}const e=this.hls.levels;if(e.length){const t=this.hls,n=this.getMaxLevel(e.length-1);n!==this.autoLevelCapping&&t.logger.log(`Setting autoLevelCapping to ${n}: ${e[n].height}p@${e[n].bitrate} for media ${this.mediaWidth}x${this.mediaHeight}`),t.autoLevelCapping=n,t.autoLevelEnabled&&t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}getMaxLevel(e){const t=this.hls.levels;if(!t.length)return-1;const n=t.filter((r,s)=>this.isLevelAllowed(r)&&s<=e);return this.clientRect=null,E4.getMaxLevelByMediaSize(n,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const e=this.media,t={width:0,height:0};if(e){const n=e.getBoundingClientRect();t.width=n.width,t.height=n.height,!t.width&&!t.height&&(t.width=n.right-n.left||e.width||0,t.height=n.bottom-n.top||e.height||0)}return this.clientRect=t,t}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch{}return Math.min(e,this.hls.config.maxDevicePixelRatio)}isLevelAllowed(e){return!this.restrictedLevels.some(n=>e.bitrate===n.bitrate&&e.width===n.width&&e.height===n.height)}static getMaxLevelByMediaSize(e,t,n){if(!(e!=null&&e.length))return-1;const r=(a,l)=>l?a.width!==l.width||a.height!==l.height:!0;let s=e.length-1;const o=Math.max(t,n);for(let a=0;a<e.length;a+=1){const l=e[a];if((l.width>=o||l.height>=o)&&r(l,e[a+1])){s=a;break}}return s}}const k0e={MANIFEST:"m",AUDIO:"a",VIDEO:"v",MUXED:"av",INIT:"i",CAPTION:"c",TIMED_TEXT:"tt",KEY:"k",OTHER:"o"},Ga=k0e,F0e={HLS:"h"},O0e=F0e;class Eh{constructor(e,t){Array.isArray(e)&&(e=e.map(n=>n instanceof Eh?n:new Eh(n))),this.value=e,this.params=t}}const N0e="Dict";function U0e(i){return Array.isArray(i)?JSON.stringify(i):i instanceof Map?"Map{}":i instanceof Set?"Set{}":typeof i=="object"?JSON.stringify(i):String(i)}function z0e(i,e,t,n){return new Error(`failed to ${i} "${U0e(e)}" as ${t}`,{cause:n})}function _h(i,e,t){return z0e("serialize",i,e,t)}class MV{constructor(e){this.description=e}}const Sk="Bare Item",G0e="Boolean";function H0e(i){if(typeof i!="boolean")throw _h(i,G0e);return i?"?1":"?0"}function Q0e(i){return btoa(String.fromCharCode(...i))}const V0e="Byte Sequence";function W0e(i){if(ArrayBuffer.isView(i)===!1)throw _h(i,V0e);return`:${Q0e(i)}:`}const j0e="Integer";function K0e(i){return i<-999999999999999||999999999999999<i}function RV(i){if(K0e(i))throw _h(i,j0e);return i.toString()}function $0e(i){return`@${RV(i.getTime()/1e3)}`}function LV(i,e){if(i<0)return-LV(-i,e);const t=Math.pow(10,e);if(Math.abs(i*t%1-.5)<Number.EPSILON){const r=Math.floor(i*t);return(r%2===0?r:r+1)/t}else return Math.round(i*t)/t}const Y0e="Decimal";function X0e(i){const e=LV(i,3);if(Math.floor(Math.abs(e)).toString().length>12)throw _h(i,Y0e);const t=e.toString();return t.includes(".")?t:`${t}.0`}const q0e="String",J0e=/[\x00-\x1f\x7f]+/;function Z0e(i){if(J0e.test(i))throw _h(i,q0e);return`"${i.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`}function ege(i){return i.description||i.toString().slice(7,-1)}const tge="Token";function wk(i){const e=ege(i);if(/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(e)===!1)throw _h(e,tge);return e}function C5(i){switch(typeof i){case"number":if(!Wt(i))throw _h(i,Sk);return Number.isInteger(i)?RV(i):X0e(i);case"string":return Z0e(i);case"symbol":return wk(i);case"boolean":return H0e(i);case"object":if(i instanceof Date)return $0e(i);if(i instanceof Uint8Array)return W0e(i);if(i instanceof MV)return wk(i);default:throw _h(i,Sk)}}const nge="Key";function T5(i){if(/^[a-z*][a-z0-9\-_.*]*$/.test(i)===!1)throw _h(i,nge);return i}function YR(i){return i==null?"":Object.entries(i).map(([e,t])=>t===!0?`;${T5(e)}`:`;${T5(e)}=${C5(t)}`).join("")}function PV(i){return i instanceof Eh?`${C5(i.value)}${YR(i.params)}`:C5(i)}function ige(i){return`(${i.value.map(PV).join(" ")})${YR(i.params)}`}function rge(i,e={whitespace:!0}){if(typeof i!="object"||i==null)throw _h(i,N0e);const t=i instanceof Map?i.entries():Object.entries(i),n=e!=null&&e.whitespace?" ":"";return Array.from(t).map(([r,s])=>{s instanceof Eh||(s=new Eh(s));let o=T5(r);return s.value===!0?o+=YR(s.params):(o+="=",Array.isArray(s.value)?o+=ige(s):o+=PV(s)),o}).join(`,${n}`)}function BV(i,e){return rge(i,e)}const sh="CMCD-Object",ts="CMCD-Request",vm="CMCD-Session",Ld="CMCD-Status",sge={br:sh,ab:sh,d:sh,ot:sh,tb:sh,tpb:sh,lb:sh,tab:sh,lab:sh,url:sh,pb:ts,bl:ts,tbl:ts,dl:ts,ltc:ts,mtp:ts,nor:ts,nrr:ts,rc:ts,sn:ts,sta:ts,su:ts,ttfb:ts,ttfbb:ts,ttlb:ts,cmsdd:ts,cmsds:ts,smrt:ts,df:ts,cs:ts,ts,cid:vm,pr:vm,sf:vm,sid:vm,st:vm,v:vm,msd:vm,bs:Ld,bsd:Ld,cdn:Ld,rtp:Ld,bg:Ld,pt:Ld,ec:Ld,e:Ld},oge={REQUEST:ts};function age(i){return Object.keys(i).reduce((e,t)=>{var n;return(n=i[t])===null||n===void 0||n.forEach(r=>e[r]=t),e},{})}function lge(i,e){const t={};if(!i)return t;const n=Object.keys(i),r=e?age(e):{};return n.reduce((s,o)=>{var a;const l=sge[o]||r[o]||oge.REQUEST,c=(a=s[l])!==null&&a!==void 0?a:s[l]={};return c[o]=i[o],s},t)}function cge(i){return["ot","sf","st","e","sta"].includes(i)}function uge(i){return typeof i=="number"?Wt(i):i!=null&&i!==""&&i!==!1}const DV="event";function hge(i,e){const t=new URL(i),n=new URL(e);if(t.origin!==n.origin)return i;const r=t.pathname.split("/").slice(1),s=n.pathname.split("/").slice(1,-1);for(;r[0]===s[0];)r.shift(),s.shift();for(;s.length;)s.shift(),r.unshift("..");return r.join("/")+t.search+t.hash}const iS=i=>Math.round(i),b5=(i,e)=>Array.isArray(i)?i.map(t=>b5(t,e)):i instanceof Eh&&typeof i.value=="string"?new Eh(b5(i.value,e),i.params):(e.baseUrl&&(i=hge(i,e.baseUrl)),e.version===1?encodeURIComponent(i):i),J3=i=>iS(i/100)*100,fge=(i,e)=>{let t=i;return e.version>=2&&(i instanceof Eh&&typeof i.value=="string"?t=new Eh([i]):typeof i=="string"&&(t=[i])),b5(t,e)},dge={br:iS,d:iS,bl:J3,dl:J3,mtp:J3,nor:fge,rtp:J3,tb:iS},kV="request",FV="response",XR=["ab","bg","bl","br","bs","bsd","cdn","cid","cs","df","ec","lab","lb","ltc","msd","mtp","pb","pr","pt","sf","sid","sn","st","sta","tab","tb","tbl","tpb","ts","v"],pge=["e"],mge=/^[a-zA-Z0-9-.]+-[a-zA-Z0-9-.]+$/;function _4(i){return mge.test(i)}function gge(i){return XR.includes(i)||pge.includes(i)||_4(i)}const OV=["d","dl","nor","ot","rtp","su"];function Age(i){return XR.includes(i)||OV.includes(i)||_4(i)}const yge=["cmsdd","cmsds","rc","smrt","ttfb","ttfbb","ttlb","url"];function vge(i){return XR.includes(i)||OV.includes(i)||yge.includes(i)||_4(i)}const xge=["bl","br","bs","cid","d","dl","mtp","nor","nrr","ot","pr","rtp","sf","sid","st","su","tb","v"];function Ege(i){return xge.includes(i)||_4(i)}const _ge={[FV]:vge,[DV]:gge,[kV]:Age};function NV(i,e={}){const t={};if(i==null||typeof i!="object")return t;const n=e.version||i.v||1,r=e.reportingMode||kV,s=n===1?Ege:_ge[r];let o=Object.keys(i).filter(s);const a=e.filter;typeof a=="function"&&(o=o.filter(a));const l=r===FV||r===DV;l&&!o.includes("ts")&&o.push("ts"),n>1&&!o.includes("v")&&o.push("v");const c=er({},dge,e.formatters),u={version:n,reportingMode:r,baseUrl:e.baseUrl};return o.sort().forEach(h=>{let f=i[h];const d=c[h];if(typeof d=="function"&&(f=d(f,u)),h==="v"){if(n===1)return;f=n}h=="pr"&&f===1||(l&&h==="ts"&&!Wt(f)&&(f=Date.now()),uge(f)&&(cge(h)&&typeof f=="string"&&(f=new MV(f)),t[h]=f))}),t}function Sge(i,e={}){const t={};if(!i)return t;const n=NV(i,e),r=lge(n,e==null?void 0:e.customHeaderMap);return Object.entries(r).reduce((s,[o,a])=>{const l=BV(a,{whitespace:!1});return l&&(s[o]=l),s},t)}function wge(i,e,t){return er(i,Sge(e,t))}const Cge="CMCD";function Tge(i,e={}){return i?BV(NV(i,e),{whitespace:!1}):""}function bge(i,e={}){if(!i)return"";const t=Tge(i,e);return encodeURIComponent(t)}function Ige(i,e={}){if(!i)return"";const t=bge(i,e);return`${Cge}=${t}`}const Ck=/CMCD=[^&#]+/;function Mge(i,e,t){const n=Ige(e,t);if(!n)return i;if(Ck.test(i))return i.replace(Ck,n);const r=i.includes("?")?"&":"?";return`${i}${r}${n}`}class UV{constructor(e){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=r=>{try{this.apply(r,{ot:Ga.MANIFEST,su:!this.initialized})}catch(s){this.hls.logger.warn("Could not generate manifest CMCD data.",s)}},this.applyFragmentData=r=>{try{const{frag:s,part:o}=r,a=this.hls.levels[s.level],l=this.getObjectType(s),c={d:(o||s).duration*1e3,ot:l};(l===Ga.VIDEO||l===Ga.AUDIO||l==Ga.MUXED)&&(c.br=a.bitrate/1e3,c.tb=this.getTopBandwidth(l)/1e3,c.bl=this.getBufferLength(l));const u=o?this.getNextPart(o):this.getNextFrag(s);u!=null&&u.url&&u.url!==s.url&&(c.nor=u.url),this.apply(r,c)}catch(s){this.hls.logger.warn("Could not generate segment CMCD data.",s)}},this.hls=e;const t=this.config=e.config,{cmcd:n}=t;n!=null&&(t.pLoader=this.createPlaylistLoader(),t.fLoader=this.createFragmentLoader(),this.sid=n.sessionId||e.sessionId,this.cid=n.contentId,this.useHeaders=n.useHeaders===!0,this.includeKeys=n.includeKeys,this.registerListeners())}registerListeners(){const e=this.hls;e.on(ae.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(ae.MEDIA_DETACHED,this.onMediaDetached,this),e.on(ae.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const e=this.hls;e.off(ae.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(ae.MEDIA_DETACHED,this.onMediaDetached,this),e.off(ae.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=this.media=null}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(e,t){var n,r;this.audioBuffer=(n=t.tracks.audio)==null?void 0:n.buffer,this.videoBuffer=(r=t.tracks.video)==null?void 0:r.buffer}createData(){var e;return{v:1,sf:O0e.HLS,sid:this.sid,cid:this.cid,pr:(e=this.media)==null?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(e,t={}){er(t,this.createData());const n=t.ot===Ga.INIT||t.ot===Ga.VIDEO||t.ot===Ga.MUXED;this.starved&&n&&(t.bs=!0,t.su=!0,this.starved=!1),t.su==null&&(t.su=this.buffering);const{includeKeys:r}=this;r&&(t=Object.keys(t).reduce((o,a)=>(r.includes(a)&&(o[a]=t[a]),o),{}));const s={baseUrl:e.url};this.useHeaders?(e.headers||(e.headers={}),wge(e.headers,t,s)):e.url=Mge(e.url,t,s)}getNextFrag(e){var t;const n=(t=this.hls.levels[e.level])==null?void 0:t.details;if(n){const r=e.sn-n.startSN;return n.fragments[r+1]}}getNextPart(e){var t;const{index:n,fragment:r}=e,s=(t=this.hls.levels[r.level])==null||(t=t.details)==null?void 0:t.partList;if(s){const{sn:o}=r;for(let a=s.length-1;a>=0;a--){const l=s[a];if(l.index===n&&l.fragment.sn===o)return s[a+1]}}}getObjectType(e){const{type:t}=e;if(t==="subtitle")return Ga.TIMED_TEXT;if(e.sn==="initSegment")return Ga.INIT;if(t==="audio")return Ga.AUDIO;if(t==="main")return this.hls.audioTracks.length?Ga.VIDEO:Ga.MUXED}getTopBandwidth(e){let t=0,n;const r=this.hls;if(e===Ga.AUDIO)n=r.audioTracks;else{const s=r.maxAutoLevel,o=s>-1?s+1:r.levels.length;n=r.levels.slice(0,o)}return n.forEach(s=>{s.bitrate>t&&(t=s.bitrate)}),t>0?t:NaN}getBufferLength(e){const t=this.media,n=e===Ga.AUDIO?this.audioBuffer:this.videoBuffer;return!n||!t?NaN:jn.bufferInfo(n,t.currentTime,this.config.maxBufferHole).len*1e3}createPlaylistLoader(){const{pLoader:e}=this.config,t=this.applyPlaylistData,n=e||this.config.loader;return class{constructor(s){this.loader=void 0,this.loader=new n(s)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(s,o,a){t(s),this.loader.load(s,o,a)}}}createFragmentLoader(){const{fLoader:e}=this.config,t=this.applyFragmentData,n=e||this.config.loader;return class{constructor(s){this.loader=void 0,this.loader=new n(s)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(s,o,a){t(s),this.loader.load(s,o,a)}}}}const Rge=3e5;class zV extends _c{constructor(e){super("content-steering",e.logger),this.hls=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this._pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(ae.MANIFEST_LOADING,this.onManifestLoading,this),e.on(ae.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(ae.MANIFEST_PARSED,this.onManifestParsed,this),e.on(ae.ERROR,this.onError,this)}unregisterListeners(){const e=this.hls;e&&(e.off(ae.MANIFEST_LOADING,this.onManifestLoading,this),e.off(ae.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(ae.MANIFEST_PARSED,this.onManifestParsed,this),e.off(ae.ERROR,this.onError,this))}pathways(){return(this.levels||[]).reduce((e,t)=>(e.indexOf(t.pathwayId)===-1&&e.push(t.pathwayId),e),[])}get pathwayPriority(){return this._pathwayPriority}set pathwayPriority(e){this.updatePathwayPriority(e)}startLoad(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){const e=this.timeToLoad*1e3-(performance.now()-this.updated);if(e>0){this.scheduleRefresh(this.uri,e);return}}this.loadSteeringManifest(this.uri)}}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()}clearTimeout(){this.reloadTimer!==-1&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(e){const t=this.levels;t&&(this.levels=t.filter(n=>n!==e))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(e,t){const{contentSteering:n}=t;n!==null&&(this.pathwayId=n.pathwayId,this.uri=n.uri,this.started&&this.startLoad())}onManifestParsed(e,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks}onError(e,t){const{errorAction:n}=t;if((n==null?void 0:n.action)===Zs.SendAlternateToPenaltyBox&&n.flags===$a.MoveAllAlternatesMatchingHost){const r=this.levels;let s=this._pathwayPriority,o=this.pathwayId;if(t.context){const{groupId:a,pathwayId:l,type:c}=t.context;a&&r?o=this.getPathwayForGroupId(a,c,o):l&&(o=l)}o in this.penalizedPathways||(this.penalizedPathways[o]=performance.now()),!s&&r&&(s=this.pathways()),s&&s.length>1&&(this.updatePathwayPriority(s),n.resolved=this.pathwayId!==o),t.details===Ke.BUFFER_APPEND_ERROR&&!t.fatal?n.resolved=!0:n.resolved||this.warn(`Could not resolve ${t.details} ("${t.error.message}") with content-steering for Pathway: ${o} levels: ${r&&r.length} priorities: ${lr(s)} penalized: ${lr(this.penalizedPathways)}`)}}filterParsedLevels(e){this.levels=e;let t=this.getLevelsForPathway(this.pathwayId);if(t.length===0){const n=e[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${n}"`),t=this.getLevelsForPathway(n),this.pathwayId=n}return t.length!==e.length&&this.log(`Found ${t.length}/${e.length} levels in Pathway "${this.pathwayId}"`),t}getLevelsForPathway(e){return this.levels===null?[]:this.levels.filter(t=>e===t.pathwayId)}updatePathwayPriority(e){this._pathwayPriority=e;let t;const n=this.penalizedPathways,r=performance.now();Object.keys(n).forEach(s=>{r-n[s]>Rge&&delete n[s]});for(let s=0;s<e.length;s++){const o=e[s];if(o in n)continue;if(o===this.pathwayId)return;const a=this.hls.nextLoadLevel,l=this.hls.levels[a];if(t=this.getLevelsForPathway(o),t.length>0){this.log(`Setting Pathway to "${o}"`),this.pathwayId=o,tV(t),this.hls.trigger(ae.LEVELS_UPDATED,{levels:t});const c=this.hls.levels[a];l&&c&&this.levels&&(c.attrs["STABLE-VARIANT-ID"]!==l.attrs["STABLE-VARIANT-ID"]&&c.bitrate!==l.bitrate&&this.log(`Unstable Pathways change from bitrate ${l.bitrate} to ${c.bitrate}`),this.hls.nextLoadLevel=a);break}}}getPathwayForGroupId(e,t,n){const r=this.getLevelsForPathway(n).concat(this.levels||[]);for(let s=0;s<r.length;s++)if(t===ai.AUDIO_TRACK&&r[s].hasAudioGroup(e)||t===ai.SUBTITLE_TRACK&&r[s].hasSubtitleGroup(e))return r[s].pathwayId;return n}clonePathways(e){const t=this.levels;if(!t)return;const n={},r={};e.forEach(s=>{const{ID:o,"BASE-ID":a,"URI-REPLACEMENT":l}=s;if(t.some(u=>u.pathwayId===o))return;const c=this.getLevelsForPathway(a).map(u=>{const h=new Br(u.attrs);h["PATHWAY-ID"]=o;const f=h.AUDIO&&`${h.AUDIO}_clone_${o}`,d=h.SUBTITLES&&`${h.SUBTITLES}_clone_${o}`;f&&(n[h.AUDIO]=f,h.AUDIO=f),d&&(r[h.SUBTITLES]=d,h.SUBTITLES=d);const m=GV(u.uri,h["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",l),A=new aA({attrs:h,audioCodec:u.audioCodec,bitrate:u.bitrate,height:u.height,name:u.name,url:m,videoCodec:u.videoCodec,width:u.width});if(u.audioGroups)for(let g=1;g<u.audioGroups.length;g++)A.addGroupId("audio",`${u.audioGroups[g]}_clone_${o}`);if(u.subtitleGroups)for(let g=1;g<u.subtitleGroups.length;g++)A.addGroupId("text",`${u.subtitleGroups[g]}_clone_${o}`);return A});t.push(...c),Tk(this.audioTracks,n,l,o),Tk(this.subtitleTracks,r,l,o)})}loadSteeringManifest(e){const t=this.hls.config,n=t.loader;this.loader&&this.loader.destroy(),this.loader=new n(t);let r;try{r=new self.URL(e)}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest URI: ${e}`);return}if(r.protocol!=="data:"){const u=(this.hls.bandwidthEstimate||t.abrEwmaDefaultEstimate)|0;r.searchParams.set("_HLS_pathway",this.pathwayId),r.searchParams.set("_HLS_throughput",""+u)}const s={responseType:"json",url:r.href},o=t.steeringManifestLoadPolicy.default,a=o.errorRetry||o.timeoutRetry||{},l={loadPolicy:o,timeout:o.maxLoadTimeMs,maxRetry:a.maxNumRetry||0,retryDelay:a.retryDelayMs||0,maxRetryDelay:a.maxRetryDelayMs||0},c={onSuccess:(u,h,f,d)=>{this.log(`Loaded steering manifest: "${r}"`);const m=u.data;if((m==null?void 0:m.VERSION)!==1){this.log(`Steering VERSION ${m.VERSION} not supported!`);return}this.updated=performance.now(),this.timeToLoad=m.TTL;const{"RELOAD-URI":A,"PATHWAY-CLONES":g,"PATHWAY-PRIORITY":y}=m;if(A)try{this.uri=new self.URL(A,r).href}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest RELOAD-URI: ${A}`);return}this.scheduleRefresh(this.uri||f.url),g&&this.clonePathways(g);const E={steeringManifest:m,url:r.toString()};this.hls.trigger(ae.STEERING_MANIFEST_LOADED,E),y&&this.updatePathwayPriority(y)},onError:(u,h,f,d)=>{if(this.log(`Error loading steering manifest: ${u.code} ${u.text} (${h.url})`),this.stopLoad(),u.code===410){this.enabled=!1,this.log(`Steering manifest ${h.url} no longer available`);return}let m=this.timeToLoad*1e3;if(u.code===429){const A=this.loader;if(typeof(A==null?void 0:A.getResponseHeader)=="function"){const g=A.getResponseHeader("Retry-After");g&&(m=parseFloat(g)*1e3)}this.log(`Steering manifest ${h.url} rate limited`);return}this.scheduleRefresh(this.uri||h.url,m)},onTimeout:(u,h,f)=>{this.log(`Timeout loading steering manifest (${h.url})`),this.scheduleRefresh(this.uri||h.url)}};this.log(`Requesting steering manifest: ${r}`),this.loader.load(s,l,c)}scheduleRefresh(e,t=this.timeToLoad*1e3){this.clearTimeout(),this.reloadTimer=self.setTimeout(()=>{var n;const r=(n=this.hls)==null?void 0:n.media;if(r&&!r.ended){this.loadSteeringManifest(e);return}this.scheduleRefresh(e,this.timeToLoad*1e3)},t)}}function Tk(i,e,t,n){i&&Object.keys(e).forEach(r=>{const s=i.filter(o=>o.groupId===r).map(o=>{const a=er({},o);return a.details=void 0,a.attrs=new Br(a.attrs),a.url=a.attrs.URI=GV(o.url,o.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",t),a.groupId=a.attrs["GROUP-ID"]=e[r],a.attrs["PATHWAY-ID"]=n,a});i.push(...s)})}function GV(i,e,t,n){const{HOST:r,PARAMS:s,[t]:o}=n;let a;e&&(a=o==null?void 0:o[e],a&&(i=a));const l=new self.URL(i);return r&&!a&&(l.host=r),s&&Object.keys(s).sort().forEach(c=>{c&&l.searchParams.set(c,s[c])}),l.href}class Wm extends _c{constructor(e){super("eme",e.logger),this.hls=void 0,this.config=void 0,this.media=null,this.mediaResolved=void 0,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.mediaKeys=null,this.setMediaKeysQueue=Wm.CDMCleanupPromise?[Wm.CDMCleanupPromise]:[],this.bannedKeyIds={},this.onMediaEncrypted=t=>{const{initDataType:n,initData:r}=t,s=`"${t.type}" event: init data type: "${n}"`;if(this.debug(s),r!==null){if(!this.keyFormatPromise){let o=Object.keys(this.keySystemAccessPromises);o.length||(o=Uv(this.config));const a=o.map(Db).filter(l=>!!l);this.keyFormatPromise=this.getKeyFormatPromise(a)}this.keyFormatPromise.then(o=>{const a=eS(o);if(n!=="sinf"||a!==Dr.FAIRPLAY){this.log(`Ignoring "${t.type}" event with init data type: "${n}" for selected key-system ${a}`);return}let l;try{const d=Js(new Uint8Array(r)),m=zR(JSON.parse(d).sinf),A=MQ(m);if(!A)throw new Error("'schm' box missing or not cbcs/cenc with schi > tenc");l=new Uint8Array(A.subarray(8,24))}catch(d){this.warn(`${s} Failed to parse sinf: ${d}`);return}const c=Oo(l),{keyIdToKeySessionPromise:u,mediaKeySessions:h}=this;let f=u[c];for(let d=0;d<h.length;d++){const m=h[d],A=m.decryptdata;if(!A.keyId)continue;const g=Oo(A.keyId);if(jS(l,A.keyId)||A.uri.replace(/-/g,"").indexOf(c)!==-1){if(f=u[g],!f)continue;if(A.pssh)break;delete u[g],A.pssh=new Uint8Array(r),A.keyId=l,f=u[c]=f.then(()=>this.generateRequestWithPreferredKeySession(m,n,r,"encrypted-event-key-match")),f.catch(y=>this.handleError(y));break}}f||this.handleError(new Error(`Key ID ${c} not encountered in playlist. Key-system sessions ${h.length}.`))}).catch(o=>this.handleError(o))}},this.onWaitingForKey=t=>{this.log(`"${t.type}" event`)},this.hls=e,this.config=e.config,this.registerListeners()}destroy(){this.onDestroying(),this.onMediaDetached();const e=this.config;e.requestMediaKeySystemAccessFunc=null,e.licenseXhrSetup=e.licenseResponseCallback=void 0,e.drmSystems=e.drmSystemOptions={},this.hls=this.config=this.keyIdToKeySessionPromise=null,this.onMediaEncrypted=this.onWaitingForKey=null}registerListeners(){this.hls.on(ae.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(ae.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(ae.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(ae.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.on(ae.DESTROYING,this.onDestroying,this)}unregisterListeners(){this.hls.off(ae.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(ae.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(ae.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(ae.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.off(ae.DESTROYING,this.onDestroying,this)}getLicenseServerUrl(e){const{drmSystems:t,widevineLicenseUrl:n}=this.config,r=t==null?void 0:t[e];if(r)return r.licenseUrl;if(e===Dr.WIDEVINE&&n)return n}getLicenseServerUrlOrThrow(e){const t=this.getLicenseServerUrl(e);if(t===void 0)throw new Error(`no license server URL configured for key-system "${e}"`);return t}getServerCertificateUrl(e){const{drmSystems:t}=this.config,n=t==null?void 0:t[e];if(n)return n.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${e}"]`)}attemptKeySystemAccess(e){const t=this.hls.levels,n=(o,a,l)=>!!o&&l.indexOf(o)===a,r=t.map(o=>o.audioCodec).filter(n),s=t.map(o=>o.videoCodec).filter(n);return r.length+s.length===0&&s.push("avc1.42e01e"),new Promise((o,a)=>{const l=c=>{const u=c.shift();this.getMediaKeysPromise(u,r,s).then(h=>o({keySystem:u,mediaKeys:h})).catch(h=>{c.length?l(c):h instanceof El?a(h):a(new El({type:rn.KEY_SYSTEM_ERROR,details:Ke.KEY_SYSTEM_NO_ACCESS,error:h,fatal:!0},h.message))})};l(e)})}requestMediaKeySystemAccess(e,t){const{requestMediaKeySystemAccessFunc:n}=this.config;if(typeof n!="function"){let r=`Configured requestMediaKeySystemAccess is not a function ${n}`;return GR===null&&self.location.protocol==="http:"&&(r=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(r))}return n(e,t)}getMediaKeysPromise(e,t,n){var r;const s=mme(e,t,n,this.config.drmSystemOptions||{});let o=this.keySystemAccessPromises[e],a=(r=o)==null?void 0:r.keySystemAccess;if(!a){this.log(`Requesting encrypted media "${e}" key-system access with config: ${lr(s)}`),a=this.requestMediaKeySystemAccess(e,s);const l=o=this.keySystemAccessPromises[e]={keySystemAccess:a};return a.catch(c=>{this.log(`Failed to obtain access to key-system "${e}": ${c}`)}),a.then(c=>{this.log(`Access for key-system "${c.keySystem}" obtained`);const u=this.fetchServerCertificate(e);this.log(`Create media-keys for "${e}"`);const h=l.mediaKeys=c.createMediaKeys().then(f=>(this.log(`Media-keys created for "${e}"`),l.hasMediaKeys=!0,u.then(d=>d?this.setMediaKeysServerCertificate(f,e,d):f)));return h.catch(f=>{this.error(`Failed to create media-keys for "${e}"}: ${f}`)}),h})}return a.then(()=>o.mediaKeys)}createMediaKeySessionContext({decryptdata:e,keySystem:t,mediaKeys:n}){this.log(`Creating key-system session "${t}" keyId: ${Oo(e.keyId||[])} keyUri: ${e.uri}`);const r=n.createSession(),s={decryptdata:e,keySystem:t,mediaKeys:n,mediaKeysSession:r,keyStatus:"status-pending"};return this.mediaKeySessions.push(s),s}renewKeySession(e){const t=e.decryptdata;if(t.pssh){const n=this.createMediaKeySessionContext(e),r=Z3(t),s="cenc";this.keyIdToKeySessionPromise[r]=this.generateRequestWithPreferredKeySession(n,s,t.pssh.buffer,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)}updateKeySession(e,t){const n=e.mediaKeysSession;return this.log(`Updating key-session "${n.sessionId}" for keyId ${Oo(e.decryptdata.keyId||[])}
      } (data length: ${t.byteLength})`),n.update(t)}getSelectedKeySystemFormats(){return Object.keys(this.keySystemAccessPromises).map(e=>({keySystem:e,hasMediaKeys:this.keySystemAccessPromises[e].hasMediaKeys})).filter(({hasMediaKeys:e})=>!!e).map(({keySystem:e})=>Db(e)).filter(e=>!!e)}getKeySystemAccess(e){return this.getKeySystemSelectionPromise(e).then(({keySystem:t,mediaKeys:n})=>this.attemptSetMediaKeys(t,n))}selectKeySystem(e){return new Promise((t,n)=>{this.getKeySystemSelectionPromise(e).then(({keySystem:r})=>{const s=Db(r);s?t(s):n(new Error(`Unable to find format for key-system "${r}"`))}).catch(n)})}selectKeySystemFormat(e){const t=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${e.sn} ${e.type}: ${e.level}) key formats ${t.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(t)),this.keyFormatPromise}getKeyFormatPromise(e){const t=Uv(this.config),n=e.map(eS).filter(r=>!!r&&t.indexOf(r)!==-1);return this.selectKeySystem(n)}getKeyStatus(e){const{mediaKeySessions:t}=this;for(let n=0;n<t.length;n++){const r=Lge(e,t[n]);if(r)return r}}loadKey(e){const t=e.keyInfo.decryptdata,n=Z3(t),r=this.bannedKeyIds[n];if(r||this.getKeyStatus(t)==="internal-error"){const a=bk(r||"internal-error",t);return this.handleError(a,e.frag),Promise.reject(a)}const s=`(keyId: ${n} format: "${t.keyFormat}" method: ${t.method} uri: ${t.uri})`;this.log(`Starting session for key ${s}`);const o=this.keyIdToKeySessionPromise[n];if(!o){const a=this.getKeySystemForKeyPromise(t).then(({keySystem:l,mediaKeys:c})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${e.frag.sn} ${e.frag.type}: ${e.frag.level} using key ${s}`),this.attemptSetMediaKeys(l,c).then(()=>(this.throwIfDestroyed(),this.createMediaKeySessionContext({keySystem:l,mediaKeys:c,decryptdata:t}))))).then(l=>{const c="cenc",u=t.pssh?t.pssh.buffer:null;return this.generateRequestWithPreferredKeySession(l,c,u,"playlist-key")});return a.catch(l=>this.handleError(l,e.frag)),this.keyIdToKeySessionPromise[n]=a,a}return o.catch(a=>{if(a instanceof El){const l=Qi({},a.data);this.getKeyStatus(t)==="internal-error"&&(l.decryptdata=t);const c=new El(l,a.message);this.handleError(c,e.frag)}}),o}throwIfDestroyed(e="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(e,t){if(this.hls)if(e instanceof El){t&&(e.data.frag=t);const n=e.data.decryptdata;this.error(`${e.message}${n?` (${Oo(n.keyId||[])})`:""}`),this.hls.trigger(ae.ERROR,e.data)}else this.error(e.message),this.hls.trigger(ae.ERROR,{type:rn.KEY_SYSTEM_ERROR,details:Ke.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0})}getKeySystemForKeyPromise(e){const t=Z3(e),n=this.keyIdToKeySessionPromise[t];if(!n){const r=eS(e.keyFormat),s=r?[r]:Uv(this.config);return this.attemptKeySystemAccess(s)}return n}getKeySystemSelectionPromise(e){if(e.length||(e=Uv(this.config)),e.length===0)throw new El({type:rn.KEY_SYSTEM_ERROR,details:Ke.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${lr({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(e)}attemptSetMediaKeys(e,t){if(this.mediaResolved=void 0,this.mediaKeys===t)return Promise.resolve();const n=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${e}"`);const r=Promise.all(n).then(()=>this.media?this.media.setMediaKeys(t):new Promise((s,o)=>{this.mediaResolved=()=>{if(this.mediaResolved=void 0,!this.media)return o(new Error("Attempted to set mediaKeys without media element attached"));this.mediaKeys=t,this.media.setMediaKeys(t).then(s).catch(o)}}));return this.mediaKeys=t,this.setMediaKeysQueue.push(r),r.then(()=>{this.log(`Media-keys set for "${e}"`),n.push(r),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(s=>n.indexOf(s)===-1)})}generateRequestWithPreferredKeySession(e,t,n,r){var s;const o=(s=this.config.drmSystems)==null||(s=s[e.keySystem])==null?void 0:s.generateRequest;if(o)try{const m=o.call(this.hls,t,n,e);if(!m)throw new Error("Invalid response from configured generateRequest filter");t=m.initDataType,n=m.initData?m.initData:null,e.decryptdata.pssh=n?new Uint8Array(n):null}catch(m){if(this.warn(m.message),this.hls&&this.hls.config.debug)throw m}if(n===null)return this.log(`Skipping key-session request for "${r}" (no initData)`),Promise.resolve(e);const a=Z3(e.decryptdata),l=e.decryptdata.uri;this.log(`Generating key-session request for "${r}" keyId: ${a} URI: ${l} (init data type: ${t} length: ${n.byteLength})`);const c=new HR,u=e._onmessage=m=>{const A=e.mediaKeysSession;if(!A){c.emit("error",new Error("invalid state"));return}const{messageType:g,message:y}=m;this.log(`"${g}" message event for session "${A.sessionId}" message size: ${y.byteLength}`),g==="license-request"||g==="license-renewal"?this.renewLicense(e,y).catch(E=>{c.eventNames().length?c.emit("error",E):this.handleError(E)}):g==="license-release"?e.keySystem===Dr.FAIRPLAY&&this.updateKeySession(e,v5("acknowledged")).then(()=>this.removeSession(e)).catch(E=>this.handleError(E)):this.warn(`unhandled media key message type "${g}"`)},h=(m,A)=>{A.keyStatus=m;let g;m.startsWith("usable")?c.emit("resolved"):m==="internal-error"||m==="output-restricted"||m==="output-downscaled"?g=bk(m,A.decryptdata):m==="expired"?g=new Error(`key expired (keyId: ${a})`):m==="released"?g=new Error("key released"):m==="status-pending"||this.warn(`unhandled key status change "${m}" (keyId: ${a})`),g&&(c.eventNames().length?c.emit("error",g):this.handleError(g))},f=e._onkeystatuseschange=m=>{if(!e.mediaKeysSession){c.emit("error",new Error("invalid state"));return}const g=this.getKeyStatuses(e);if(!Object.keys(g).some(C=>g[C]!=="status-pending"))return;if(g[a]==="expired"){this.log(`Expired key ${lr(g)} in key-session "${e.mediaKeysSession.sessionId}"`),this.renewKeySession(e);return}let E=g[a];if(E)h(E,e);else{var x;e.keyStatusTimeouts||(e.keyStatusTimeouts={}),(x=e.keyStatusTimeouts)[a]||(x[a]=self.setTimeout(()=>{if(!e.mediaKeysSession||!this.mediaKeys)return;const T=this.getKeyStatus(e.decryptdata);if(T&&T!=="status-pending")return this.log(`No status for keyId ${a} in key-session "${e.mediaKeysSession.sessionId}". Using session key-status ${T} from other session.`),h(T,e);this.log(`key status for ${a} in key-session "${e.mediaKeysSession.sessionId}" timed out after 1000ms`),E="internal-error",h(E,e)},1e3)),this.log(`No status for keyId ${a} (${lr(g)}).`)}};_a(e.mediaKeysSession,"message",u),_a(e.mediaKeysSession,"keystatuseschange",f);const d=new Promise((m,A)=>{c.on("error",A),c.on("resolved",m)});return e.mediaKeysSession.generateRequest(t,n).then(()=>{this.log(`Request generated for key-session "${e.mediaKeysSession.sessionId}" keyId: ${a} URI: ${l}`)}).catch(m=>{throw new El({type:rn.KEY_SYSTEM_ERROR,details:Ke.KEY_SYSTEM_NO_SESSION,error:m,decryptdata:e.decryptdata,fatal:!1},`Error generating key-session request: ${m}`)}).then(()=>d).catch(m=>(c.removeAllListeners(),this.removeSession(e).then(()=>{throw m}))).then(()=>(c.removeAllListeners(),e))}getKeyStatuses(e){const t={};return e.mediaKeysSession.keyStatuses.forEach((n,r)=>{if(typeof r=="string"&&typeof n=="object"){const a=r;r=n,n=a}const s="buffer"in r?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):new Uint8Array(r);if(e.keySystem===Dr.PLAYREADY&&s.length===16){const a=Oo(s);t[a]=n,jQ(s)}const o=Oo(s);n==="internal-error"&&(this.bannedKeyIds[o]=n),this.log(`key status change "${n}" for keyStatuses keyId: ${o} key-session "${e.mediaKeysSession.sessionId}"`),t[o]=n}),t}fetchServerCertificate(e){const t=this.config,n=t.loader,r=new n(t),s=this.getServerCertificateUrl(e);return s?(this.log(`Fetching server certificate for "${e}"`),new Promise((o,a)=>{const l={responseType:"arraybuffer",url:s},c=t.certLoadPolicy.default,u={loadPolicy:c,timeout:c.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},h={onSuccess:(f,d,m,A)=>{o(f.data)},onError:(f,d,m,A)=>{a(new El({type:rn.KEY_SYSTEM_ERROR,details:Ke.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:m,response:Qi({url:l.url,data:void 0},f)},`"${e}" certificate request failed (${s}). Status: ${f.code} (${f.text})`))},onTimeout:(f,d,m)=>{a(new El({type:rn.KEY_SYSTEM_ERROR,details:Ke.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:m,response:{url:l.url,data:void 0}},`"${e}" certificate request timed out (${s})`))},onAbort:(f,d,m)=>{a(new Error("aborted"))}};r.load(l,u,h)})):Promise.resolve()}setMediaKeysServerCertificate(e,t,n){return new Promise((r,s)=>{e.setServerCertificate(n).then(o=>{this.log(`setServerCertificate ${o?"success":"not supported by CDM"} (${n.byteLength}) on "${t}"`),r(e)}).catch(o=>{s(new El({type:rn.KEY_SYSTEM_ERROR,details:Ke.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:o,fatal:!0},o.message))})})}renewLicense(e,t){return this.requestLicense(e,new Uint8Array(t)).then(n=>this.updateKeySession(e,new Uint8Array(n)).catch(r=>{throw new El({type:rn.KEY_SYSTEM_ERROR,details:Ke.KEY_SYSTEM_SESSION_UPDATE_FAILED,decryptdata:e.decryptdata,error:r,fatal:!1},r.message)}))}unpackPlayReadyKeyMessage(e,t){const n=String.fromCharCode.apply(null,new Uint16Array(t.buffer));if(!n.includes("PlayReadyKeyMessage"))return e.setRequestHeader("Content-Type","text/xml; charset=utf-8"),t;const r=new DOMParser().parseFromString(n,"application/xml"),s=r.querySelectorAll("HttpHeader");if(s.length>0){let u;for(let h=0,f=s.length;h<f;h++){var o,a;u=s[h];const d=(o=u.querySelector("name"))==null?void 0:o.textContent,m=(a=u.querySelector("value"))==null?void 0:a.textContent;d&&m&&e.setRequestHeader(d,m)}}const l=r.querySelector("Challenge"),c=l==null?void 0:l.textContent;if(!c)throw new Error("Cannot find <Challenge> in key message");return v5(atob(c))}setupLicenseXHR(e,t,n,r){const s=this.config.licenseXhrSetup;return s?Promise.resolve().then(()=>{if(!n.decryptdata)throw new Error("Key removed");return s.call(this.hls,e,t,n,r)}).catch(o=>{if(!n.decryptdata)throw o;return e.open("POST",t,!0),s.call(this.hls,e,t,n,r)}).then(o=>(e.readyState||e.open("POST",t,!0),{xhr:e,licenseChallenge:o||r})):(e.open("POST",t,!0),Promise.resolve({xhr:e,licenseChallenge:r}))}requestLicense(e,t){const n=this.config.keyLoadPolicy.default;return new Promise((r,s)=>{const o=this.getLicenseServerUrlOrThrow(e.keySystem);this.log(`Sending license request to URL: ${o}`);const a=new XMLHttpRequest;a.responseType="arraybuffer",a.onreadystatechange=()=>{if(!this.hls||!e.mediaKeysSession)return s(new Error("invalid state"));if(a.readyState===4)if(a.status===200){this._requestLicenseFailureCount=0;let l=a.response;this.log(`License received ${l instanceof ArrayBuffer?l.byteLength:l}`);const c=this.config.licenseResponseCallback;if(c)try{l=c.call(this.hls,a,o,e)}catch(u){this.error(u)}r(l)}else{const l=n.errorRetry,c=l?l.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>c||a.status>=400&&a.status<500)s(new El({type:rn.KEY_SYSTEM_ERROR,details:Ke.KEY_SYSTEM_LICENSE_REQUEST_FAILED,decryptdata:e.decryptdata,fatal:!0,networkDetails:a,response:{url:o,data:void 0,code:a.status,text:a.statusText}},`License Request XHR failed (${o}). Status: ${a.status} (${a.statusText})`));else{const u=c-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${u} attempts left`),this.requestLicense(e,t).then(r,s)}}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=a,this.setupLicenseXHR(a,o,e,t).then(({xhr:l,licenseChallenge:c})=>{e.keySystem==Dr.PLAYREADY&&(c=this.unpackPlayReadyKeyMessage(l,c)),l.send(c)}).catch(s)})}onDestroying(){this.unregisterListeners(),this._clear()}onMediaAttached(e,t){if(!this.config.emeEnabled)return;const n=t.media;this.media=n,_a(n,"encrypted",this.onMediaEncrypted),_a(n,"waitingforkey",this.onWaitingForKey);const r=this.mediaResolved;r?r():this.mediaKeys=n.mediaKeys}onMediaDetached(){const e=this.media;e&&(Za(e,"encrypted",this.onMediaEncrypted),Za(e,"waitingforkey",this.onWaitingForKey),this.media=null,this.mediaKeys=null)}_clear(){var e;this._requestLicenseFailureCount=0,this.keyIdToKeySessionPromise={},this.bannedKeyIds={};const t=this.mediaResolved;if(t&&t(),!this.mediaKeys&&!this.mediaKeySessions.length)return;const n=this.media,r=this.mediaKeySessions.slice();this.mediaKeySessions=[],this.mediaKeys=null,Df.clearKeyUriToKeyIdMap();const s=r.length;Wm.CDMCleanupPromise=Promise.all(r.map(o=>this.removeSession(o)).concat((n==null||(e=n.setMediaKeys(null))==null?void 0:e.catch(o=>{this.log(`Could not clear media keys: ${o}`),this.hls&&this.hls.trigger(ae.ERROR,{type:rn.OTHER_ERROR,details:Ke.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR,fatal:!1,error:new Error(`Could not clear media keys: ${o}`)})}))||Promise.resolve())).catch(o=>{this.log(`Could not close sessions and clear media keys: ${o}`),this.hls&&this.hls.trigger(ae.ERROR,{type:rn.OTHER_ERROR,details:Ke.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close sessions and clear media keys: ${o}`)})}).then(()=>{s&&this.log("finished closing key sessions and clearing media keys")})}onManifestLoading(){this._clear()}onManifestLoaded(e,{sessionKeys:t}){if(!(!t||!this.config.emeEnabled)&&!this.keyFormatPromise){const n=t.reduce((r,s)=>(r.indexOf(s.keyFormat)===-1&&r.push(s.keyFormat),r),[]);this.log(`Selecting key-system from session-keys ${n.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(n)}}removeSession(e){const{mediaKeysSession:t,licenseXhr:n,decryptdata:r}=e;if(t){this.log(`Remove licenses and keys and close session "${t.sessionId}" keyId: ${Oo((r==null?void 0:r.keyId)||[])}`),e._onmessage&&(t.removeEventListener("message",e._onmessage),e._onmessage=void 0),e._onkeystatuseschange&&(t.removeEventListener("keystatuseschange",e._onkeystatuseschange),e._onkeystatuseschange=void 0),n&&n.readyState!==XMLHttpRequest.DONE&&n.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;const s=this.mediaKeySessions.indexOf(e);s>-1&&this.mediaKeySessions.splice(s,1);const{keyStatusTimeouts:o}=e;o&&Object.keys(o).forEach(c=>self.clearTimeout(o[c]));const{drmSystemOptions:a}=this.config;return(Ame(a)?new Promise((c,u)=>{self.setTimeout(()=>u(new Error("MediaKeySession.remove() timeout")),8e3),t.remove().then(c).catch(u)}):Promise.resolve()).catch(c=>{this.log(`Could not remove session: ${c}`),this.hls&&this.hls.trigger(ae.ERROR,{type:rn.OTHER_ERROR,details:Ke.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR,fatal:!1,error:new Error(`Could not remove session: ${c}`)})}).then(()=>t.close()).catch(c=>{this.log(`Could not close session: ${c}`),this.hls&&this.hls.trigger(ae.ERROR,{type:rn.OTHER_ERROR,details:Ke.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close session: ${c}`)})})}return Promise.resolve()}}Wm.CDMCleanupPromise=void 0;function Z3(i){if(!i)throw new Error("Could not read keyId of undefined decryptdata");if(i.keyId===null)throw new Error("keyId is null");return Oo(i.keyId)}function Lge(i,e){if(i.keyId&&e.mediaKeysSession.keyStatuses.has(i.keyId))return e.mediaKeysSession.keyStatuses.get(i.keyId);if(i.matches(e.decryptdata))return e.keyStatus}class El extends Error{constructor(e,t){super(t),this.data=void 0,e.error||(e.error=new Error(t)),this.data=e,e.err=e.error}}function bk(i,e){const t=i==="output-restricted",n=t?Ke.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:Ke.KEY_SYSTEM_STATUS_INTERNAL_ERROR;return new El({type:rn.KEY_SYSTEM_ERROR,details:n,fatal:!1,decryptdata:e},t?"HDCP level output restricted":`key status changed to "${i}"`)}class HV{constructor(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}setStreamController(e){this.streamController=e}registerListeners(){this.hls.on(ae.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.on(ae.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListeners(){this.hls.off(ae.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.off(ae.MEDIA_DETACHING,this.onMediaDetaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(e,t){const n=this.hls.config;if(n.capLevelOnFPSDrop){const r=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=r,r&&typeof r.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),n.fpsDroppedMonitoringPeriod)}}onMediaDetaching(){this.media=null}checkFPS(e,t,n){const r=performance.now();if(t){if(this.lastTime){const s=r-this.lastTime,o=n-this.lastDroppedFrames,a=t-this.lastDecodedFrames,l=1e3*o/s,c=this.hls;if(c.trigger(ae.FPS_DROP,{currentDropped:o,currentDecoded:a,totalDroppedFrames:n}),l>0&&o>c.config.fpsDroppedMonitoringThreshold*a){let u=c.currentLevel;c.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+u),u>0&&(c.autoLevelCapping===-1||c.autoLevelCapping>=u)&&(u=u-1,c.trigger(ae.FPS_DROP_LEVEL_CAPPING,{level:u,droppedLevel:c.currentLevel}),c.autoLevelCapping=u,this.streamController.nextLevelSwitch())}}this.lastTime=r,this.lastDroppedFrames=n,this.lastDecodedFrames=t}}checkFPSInterval(){const e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){const t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}}function QV(i,e){let t;try{t=new Event("addtrack")}catch{t=document.createEvent("Event"),t.initEvent("addtrack",!1,!1)}t.track=i,e.dispatchEvent(t)}function VV(i,e){const t=i.mode;if(t==="disabled"&&(i.mode="hidden"),i.cues&&!i.cues.getCueById(e.id))try{if(i.addCue(e),!i.cues.getCueById(e.id))throw new Error(`addCue is failed for: ${e}`)}catch(n){Ki.debug(`[texttrack-utils]: ${n}`);try{const r=new self.TextTrackCue(e.startTime,e.endTime,e.text);r.id=e.id,i.addCue(r)}catch(r){Ki.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${r}`)}}t==="disabled"&&(i.mode=t)}function P1(i,e){const t=i.mode;if(t==="disabled"&&(i.mode="hidden"),i.cues)for(let n=i.cues.length;n--;)e&&i.cues[n].removeEventListener("enter",e),i.removeCue(i.cues[n]);t==="disabled"&&(i.mode=t)}function I5(i,e,t,n){const r=i.mode;if(r==="disabled"&&(i.mode="hidden"),i.cues&&i.cues.length>0){const s=Bge(i.cues,e,t);for(let o=0;o<s.length;o++)(!n||n(s[o]))&&i.removeCue(s[o])}r==="disabled"&&(i.mode=r)}function Pge(i,e){if(e<=i[0].startTime)return 0;const t=i.length-1;if(e>i[t].endTime)return-1;let n=0,r=t,s;for(;n<=r;)if(s=Math.floor((r+n)/2),e<i[s].startTime)r=s-1;else if(e>i[s].startTime&&n<t)n=s+1;else return s;return i[n].startTime-e<e-i[r].startTime?n:r}function Bge(i,e,t){const n=[],r=Pge(i,e);if(r>-1)for(let s=r,o=i.length;s<o;s++){const a=i[s];if(a.startTime>=e&&a.endTime<=t)n.push(a);else if(a.startTime>t)return n}return n}function rS(i){const e=[];for(let t=0;t<i.length;t++){const n=i[t];(n.kind==="subtitles"||n.kind==="captions")&&n.label&&e.push(i[t])}return e}class WV extends x4{constructor(e){super(e,"subtitle-track-controller"),this.media=null,this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.onTextTracksChanged=()=>{if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let t=null;const n=rS(this.media.textTracks);for(let s=0;s<n.length;s++)if(n[s].mode==="hidden")t=n[s];else if(n[s].mode==="showing"){t=n[s];break}const r=this.findTrackForTextTrack(t);this.subtitleTrack!==r&&this.setSubtitleTrack(r)},this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes()}registerListeners(){const{hls:e}=this;e.on(ae.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(ae.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(ae.MANIFEST_LOADING,this.onManifestLoading,this),e.on(ae.MANIFEST_PARSED,this.onManifestParsed,this),e.on(ae.LEVEL_LOADING,this.onLevelLoading,this),e.on(ae.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(ae.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(ae.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(ae.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(ae.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(ae.MANIFEST_LOADING,this.onManifestLoading,this),e.off(ae.MANIFEST_PARSED,this.onManifestParsed,this),e.off(ae.LEVEL_LOADING,this.onLevelLoading,this),e.off(ae.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(ae.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(ae.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,e)}onMediaDetaching(e,t){const n=this.media;if(!n)return;const r=!!t.transferMedia;if(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||n.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),this.subtitleTrack=-1,this.media=null,r)return;rS(n.textTracks).forEach(o=>{P1(o)})}onManifestLoading(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.subtitleTracks}onSubtitleTrackLoaded(e,t){const{id:n,groupId:r,details:s}=t,o=this.tracksInGroup[n];if(!o||o.groupId!==r){this.warn(`Subtitle track with id:${n} and group:${r} not found in active group ${o==null?void 0:o.groupId}`);return}const a=o.details;o.details=t.details,this.log(`Subtitle track ${n} "${o.name}" lang:${o.lang} group:${r} loaded [${s.startSN}-${s.endSN}]`),n===this.trackId&&this.playlistLoaded(n,t,a)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const n=t.subtitleGroups||null,r=this.groupIds;let s=this.currentTrack;if(!n||(r==null?void 0:r.length)!==(n==null?void 0:n.length)||n!=null&&n.some(o=>(r==null?void 0:r.indexOf(o))===-1)){this.groupIds=n,this.trackId=-1,this.currentTrack=null;const o=this.tracks.filter(u=>!n||n.indexOf(u.groupId)!==-1);if(o.length)this.selectDefaultTrack&&!o.some(u=>u.default)&&(this.selectDefaultTrack=!1),o.forEach((u,h)=>{u.id=h});else if(!s&&!this.tracksInGroup.length)return;this.tracksInGroup=o;const a=this.hls.config.subtitlePreference;if(!s&&a){this.selectDefaultTrack=!1;const u=Ah(a,o);if(u>-1)s=o[u];else{const h=Ah(a,this.tracks);s=this.tracks[h]}}let l=this.findTrackId(s);l===-1&&s&&(l=this.findTrackId(null));const c={subtitleTracks:o};this.log(`Updating subtitle tracks, ${o.length} track(s) found in "${n==null?void 0:n.join(",")}" group-id`),this.hls.trigger(ae.SUBTITLE_TRACKS_UPDATED,c),l!==-1&&this.trackId===-1&&this.setSubtitleTrack(l)}}findTrackId(e){const t=this.tracksInGroup,n=this.selectDefaultTrack;for(let r=0;r<t.length;r++){const s=t[r];if(!(n&&!s.default||!n&&!e)&&(!e||Vm(s,e)))return r}if(e){for(let r=0;r<t.length;r++){const s=t[r];if(K2(e.attrs,s.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return r}for(let r=0;r<t.length;r++){const s=t[r];if(K2(e.attrs,s.attrs,["LANGUAGE"]))return r}}return-1}findTrackForTextTrack(e){if(e){const t=this.tracksInGroup;for(let n=0;n<t.length;n++){const r=t[n];if(w5(r,e))return n}}return-1}onError(e,t){t.fatal||!t.context||t.context.type===ai.SUBTITLE_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allSubtitleTracks(){return this.tracks}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(e){this.selectDefaultTrack=!1,this.setSubtitleTrack(e)}setSubtitleOption(e){if(this.hls.config.subtitlePreference=e,e){if(e.id===-1)return this.setSubtitleTrack(-1),null;const t=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,t.length){const n=this.currentTrack;if(n&&Vm(e,n))return n;const r=Ah(e,this.tracksInGroup);if(r>-1){const s=this.tracksInGroup[r];return this.setSubtitleTrack(r),s}else{if(n)return null;{const s=Ah(e,t);if(s>-1)return t[s]}}}}return null}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentTrack)&&this.scheduleLoading(this.currentTrack,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const n=e.id,r=e.groupId,s=this.getUrlWithDirectives(e.url,t),o=e.details,a=o==null?void 0:o.age;this.log(`Loading subtitle ${n} "${e.name}" lang:${e.lang} group:${r}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${a&&o.live?" age "+a.toFixed(1)+(o.type&&" "+o.type||""):""} ${s}`),this.hls.trigger(ae.SUBTITLE_TRACK_LOADING,{url:s,id:n,groupId:r,deliveryDirectives:t||null,track:e})}toggleTrackModes(){const{media:e}=this;if(!e)return;const t=rS(e.textTracks),n=this.currentTrack;let r;if(n&&(r=t.filter(s=>w5(n,s))[0],r||this.warn(`Unable to find subtitle TextTrack with name "${n.name}" and language "${n.lang}"`)),[].slice.call(t).forEach(s=>{s.mode!=="disabled"&&s!==r&&(s.mode="disabled")}),r){const s=this.subtitleDisplay?"showing":"hidden";r.mode!==s&&(r.mode=s)}}setSubtitleTrack(e){const t=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=e;return}if(e<-1||e>=t.length||!Wt(e)){this.warn(`Invalid subtitle track id: ${e}`);return}this.selectDefaultTrack=!1;const n=this.currentTrack,r=t[e]||null;if(this.trackId=e,this.currentTrack=r,this.toggleTrackModes(),!r){this.hls.trigger(ae.SUBTITLE_TRACK_SWITCH,{id:e});return}const s=!!r.details&&!r.details.live;if(e===this.trackId&&r===n&&s)return;this.log(`Switching to subtitle-track ${e}`+(r?` "${r.name}" lang:${r.lang} group:${r.groupId}`:""));const{id:o,groupId:a="",name:l,type:c,url:u}=r;this.hls.trigger(ae.SUBTITLE_TRACK_SWITCH,{id:o,groupId:a,name:l,type:c,url:u});const h=this.switchParams(r.url,n==null?void 0:n.details,r.details);this.loadPlaylist(h)}}function Dge(){try{return crypto.randomUUID()}catch{try{const e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)}catch{let t=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,r=>{const s=(t+Math.random()*16)%16|0;return t=Math.floor(t/16),(r=="x"?s:s&3|8).toString(16)})}}}function c2(i){let e=5381,t=i.length;for(;t;)e=e*33^i.charCodeAt(--t);return(e>>>0).toString()}const j1=.025;let XS=(function(i){return i[i.Point=0]="Point",i[i.Range=1]="Range",i})({});function kge(i,e,t){return`${i.identifier}-${t+1}-${c2(e)}`}class Fge{constructor(e,t){this.base=void 0,this._duration=null,this._timelineStart=null,this.appendInPlaceDisabled=void 0,this.appendInPlaceStarted=void 0,this.dateRange=void 0,this.hasPlayed=!1,this.cumulativeDuration=0,this.resumeOffset=NaN,this.playoutLimit=NaN,this.restrictions={skip:!1,jump:!1},this.snapOptions={out:!1,in:!1},this.assetList=[],this.assetListLoader=void 0,this.assetListResponse=null,this.resumeAnchor=void 0,this.error=void 0,this.resetOnResume=void 0,this.base=t,this.dateRange=e,this.setDateRange(e)}setDateRange(e){this.dateRange=e,this.resumeOffset=e.attr.optionalFloat("X-RESUME-OFFSET",this.resumeOffset),this.playoutLimit=e.attr.optionalFloat("X-PLAYOUT-LIMIT",this.playoutLimit),this.restrictions=e.attr.enumeratedStringList("X-RESTRICT",this.restrictions),this.snapOptions=e.attr.enumeratedStringList("X-SNAP",this.snapOptions)}reset(){var e;this.appendInPlaceStarted=!1,(e=this.assetListLoader)==null||e.destroy(),this.assetListLoader=void 0,this.supplementsPrimary||(this.assetListResponse=null,this.assetList=[],this._duration=null)}isAssetPastPlayoutLimit(e){var t;if(e>0&&e>=this.assetList.length)return!0;const n=this.playoutLimit;return e<=0||isNaN(n)?!1:n===0?!0:(((t=this.assetList[e])==null?void 0:t.startOffset)||0)>n}findAssetIndex(e){return this.assetList.indexOf(e)}get identifier(){return this.dateRange.id}get startDate(){return this.dateRange.startDate}get startTime(){const e=this.dateRange.startTime;if(this.snapOptions.out){const t=this.dateRange.tagAnchor;if(t)return Qb(e,t)}return e}get startOffset(){return this.cue.pre?0:this.startTime}get startIsAligned(){if(this.startTime===0||this.snapOptions.out)return!0;const e=this.dateRange.tagAnchor;if(e){const t=this.dateRange.startTime,n=Qb(t,e);return t-n<.1}return!1}get resumptionOffset(){const e=this.resumeOffset,t=Wt(e)?e:this.duration;return this.cumulativeDuration+t}get resumeTime(){const e=this.startOffset+this.resumptionOffset;if(this.snapOptions.in){const t=this.resumeAnchor;if(t)return Qb(e,t)}return e}get appendInPlace(){return this.appendInPlaceStarted?!0:this.appendInPlaceDisabled?!1:!!(!this.cue.once&&!this.cue.pre&&this.startIsAligned&&(isNaN(this.playoutLimit)&&isNaN(this.resumeOffset)||this.resumeOffset&&this.duration&&Math.abs(this.resumeOffset-this.duration)<j1))}set appendInPlace(e){if(this.appendInPlaceStarted){this.resetOnResume=!e;return}this.appendInPlaceDisabled=!e}get timelineStart(){return this._timelineStart!==null?this._timelineStart:this.startTime}set timelineStart(e){this._timelineStart=e}get duration(){const e=this.playoutLimit;let t;return this._duration!==null?t=this._duration:this.dateRange.duration?t=this.dateRange.duration:t=this.dateRange.plannedDuration||0,!isNaN(e)&&e<t&&(t=e),t}set duration(e){this._duration=e}get cue(){return this.dateRange.cue}get timelineOccupancy(){return this.dateRange.attr["X-TIMELINE-OCCUPIES"]==="RANGE"?XS.Range:XS.Point}get supplementsPrimary(){return this.dateRange.attr["X-TIMELINE-STYLE"]==="PRIMARY"}get contentMayVary(){return this.dateRange.attr["X-CONTENT-MAY-VARY"]!=="NO"}get assetUrl(){return this.dateRange.attr["X-ASSET-URI"]}get assetListUrl(){return this.dateRange.attr["X-ASSET-LIST"]}get baseUrl(){return this.base.url}get assetListLoaded(){return this.assetList.length>0||this.assetListResponse!==null}toString(){return Oge(this)}}function Qb(i,e){return i-e.start<e.duration/2&&!(Math.abs(i-(e.start+e.duration))<j1)?e.start:e.start+e.duration}function jV(i,e,t){const n=new self.URL(i,t);return n.protocol!=="data:"&&n.searchParams.set("_HLS_primary_id",e),n}function Vb(i,e){for(;(t=i.assetList[++e])!=null&&t.error;)var t;return e}function Oge(i){return`["${i.identifier}" ${i.cue.pre?"<pre>":i.cue.post?"<post>":""}${i.timelineStart.toFixed(2)}-${i.resumeTime.toFixed(2)}]`}function S1(i){const e=i.timelineStart,t=i.duration||0;return`["${i.identifier}" ${e.toFixed(2)}-${(e+t).toFixed(2)}]`}class Nge{constructor(e,t,n,r){this.hls=void 0,this.interstitial=void 0,this.assetItem=void 0,this.tracks=null,this.hasDetails=!1,this.mediaAttached=null,this._currentTime=void 0,this._bufferedEosTime=void 0,this.checkPlayout=()=>{this.reachedPlayout(this.currentTime)&&this.hls&&this.hls.trigger(ae.PLAYOUT_LIMIT_REACHED,{})};const s=this.hls=new e(t);this.interstitial=n,this.assetItem=r;const o=()=>{this.hasDetails=!0};s.once(ae.LEVEL_LOADED,o),s.once(ae.AUDIO_TRACK_LOADED,o),s.once(ae.SUBTITLE_TRACK_LOADED,o),s.on(ae.MEDIA_ATTACHING,(a,{media:l})=>{this.removeMediaListeners(),this.mediaAttached=l,this.interstitial.playoutLimit&&(l.addEventListener("timeupdate",this.checkPlayout),this.appendInPlace&&s.on(ae.BUFFER_APPENDED,()=>{const u=this.bufferedEnd;this.reachedPlayout(u)&&(this._bufferedEosTime=u,s.trigger(ae.BUFFERED_TO_END,void 0))}))})}get appendInPlace(){return this.interstitial.appendInPlace}loadSource(){const e=this.hls;if(e)if(e.url)e.levels.length&&!e.started&&e.startLoad(-1,!0);else{let t=this.assetItem.uri;try{t=jV(t,e.config.primarySessionId||"").href}catch{}e.loadSource(t)}}bufferedInPlaceToEnd(e){var t;if(!this.appendInPlace)return!1;if((t=this.hls)!=null&&t.bufferedToEnd)return!0;if(!e)return!1;const n=Math.min(this._bufferedEosTime||1/0,this.duration),r=this.timelineOffset,s=jn.bufferInfo(e,r,0);return this.getAssetTime(s.end)>=n-.02}reachedPlayout(e){const n=this.interstitial.playoutLimit;return this.startOffset+e>=n}get destroyed(){var e;return!((e=this.hls)!=null&&e.userConfig)}get assetId(){return this.assetItem.identifier}get interstitialId(){return this.assetItem.parentIdentifier}get media(){var e;return((e=this.hls)==null?void 0:e.media)||null}get bufferedEnd(){const e=this.media||this.mediaAttached;if(!e)return this._bufferedEosTime?this._bufferedEosTime:this.currentTime;const t=jn.bufferInfo(e,e.currentTime,.001);return this.getAssetTime(t.end)}get currentTime(){const e=this.media||this.mediaAttached;return e?this.getAssetTime(e.currentTime):this._currentTime||0}get duration(){const e=this.assetItem.duration;if(!e)return 0;const t=this.interstitial.playoutLimit;if(t){const n=t-this.startOffset;if(n>0&&n<e)return n}return e}get remaining(){const e=this.duration;return e?Math.max(0,e-this.currentTime):0}get startOffset(){return this.assetItem.startOffset}get timelineOffset(){var e;return((e=this.hls)==null?void 0:e.config.timelineOffset)||0}set timelineOffset(e){const t=this.timelineOffset;if(e!==t){const n=e-t;if(Math.abs(n)>1/9e4&&this.hls){if(this.hasDetails)throw new Error("Cannot set timelineOffset after playlists are loaded");this.hls.config.timelineOffset=e}}}getAssetTime(e){const t=this.timelineOffset,n=this.duration;return Math.min(Math.max(0,e-t),n)}removeMediaListeners(){const e=this.mediaAttached;e&&(this._currentTime=e.currentTime,this.bufferSnapShot(),e.removeEventListener("timeupdate",this.checkPlayout))}bufferSnapShot(){if(this.mediaAttached){var e;(e=this.hls)!=null&&e.bufferedToEnd&&(this._bufferedEosTime=this.bufferedEnd)}}destroy(){this.removeMediaListeners(),this.hls&&this.hls.destroy(),this.hls=null,this.tracks=this.mediaAttached=this.checkPlayout=null}attachMedia(e){var t;this.loadSource(),(t=this.hls)==null||t.attachMedia(e)}detachMedia(){var e;this.removeMediaListeners(),this.mediaAttached=null,(e=this.hls)==null||e.detachMedia()}resumeBuffering(){var e;(e=this.hls)==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.hls)==null||e.pauseBuffering()}transferMedia(){var e;return this.bufferSnapShot(),((e=this.hls)==null?void 0:e.transferMedia())||null}resetDetails(){const e=this.hls;if(e&&this.hasDetails){e.stopLoad();const t=n=>delete n.details;e.levels.forEach(t),e.allAudioTracks.forEach(t),e.allSubtitleTracks.forEach(t),this.hasDetails=!1}}on(e,t,n){var r;(r=this.hls)==null||r.on(e,t)}once(e,t,n){var r;(r=this.hls)==null||r.once(e,t)}off(e,t,n){var r;(r=this.hls)==null||r.off(e,t)}toString(){var e;return`HlsAssetPlayer: ${S1(this.assetItem)} ${(e=this.hls)==null?void 0:e.sessionId} ${this.appendInPlace?"append-in-place":""}`}}const Ik=.033;class Uge extends _c{constructor(e,t){super("interstitials-sched",t),this.onScheduleUpdate=void 0,this.eventMap={},this.events=null,this.items=null,this.durations={primary:0,playout:0,integrated:0},this.onScheduleUpdate=e}destroy(){this.reset(),this.onScheduleUpdate=null}reset(){this.eventMap={},this.setDurations(0,0,0),this.events&&this.events.forEach(e=>e.reset()),this.events=this.items=null}resetErrorsInRange(e,t){return this.events?this.events.reduce((n,r)=>e<=r.startOffset&&t>r.startOffset?(delete r.error,n+1):n,0):0}get duration(){const e=this.items;return e?e[e.length-1].end:0}get length(){return this.items?this.items.length:0}getEvent(e){return e&&this.eventMap[e]||null}hasEvent(e){return e in this.eventMap}findItemIndex(e,t){if(e.event)return this.findEventIndex(e.event.identifier);let n=-1;e.nextEvent?n=this.findEventIndex(e.nextEvent.identifier)-1:e.previousEvent&&(n=this.findEventIndex(e.previousEvent.identifier)+1);const r=this.items;if(r)for(r[n]||(t===void 0&&(t=e.start),n=this.findItemIndexAtTime(t));n>=0&&(s=r[n])!=null&&s.event;){var s;n--}return n}findItemIndexAtTime(e,t){const n=this.items;if(n)for(let r=0;r<n.length;r++){let s=n[r];if(t&&t!=="primary"&&(s=s[t]),e===s.start||e>s.start&&e<s.end)return r}return-1}findJumpRestrictedIndex(e,t){const n=this.items;if(n)for(let r=e;r<=t&&n[r];r++){const s=n[r].event;if(s!=null&&s.restrictions.jump&&!s.appendInPlace)return r}return-1}findEventIndex(e){const t=this.items;if(t)for(let r=t.length;r--;){var n;if(((n=t[r].event)==null?void 0:n.identifier)===e)return r}return-1}findAssetIndex(e,t){const n=e.assetList,r=n.length;if(r>1)for(let s=0;s<r;s++){const o=n[s];if(!o.error){const a=o.timelineStart;if(t===a||t>a&&(t<a+(o.duration||0)||s===r-1))return s}}return 0}get assetIdAtEnd(){var e;const t=(e=this.items)==null||(e=e[this.length-1])==null?void 0:e.event;if(t){const n=t.assetList,r=n[n.length-1];if(r)return r.identifier}return null}parseInterstitialDateRanges(e,t){const n=e.main.details,{dateRanges:r}=n,s=this.events,o=this.parseDateRanges(r,{url:n.url},t),a=Object.keys(r),l=s?s.filter(c=>!a.includes(c.identifier)):[];o.length&&o.sort((c,u)=>{const h=c.cue.pre,f=c.cue.post,d=u.cue.pre,m=u.cue.post;if(h&&!d)return-1;if(d&&!h||f&&!m)return 1;if(m&&!f)return-1;if(!h&&!d&&!f&&!m){const A=c.startTime,g=u.startTime;if(A!==g)return A-g}return c.dateRange.tagOrder-u.dateRange.tagOrder}),this.events=o,l.forEach(c=>{this.removeEvent(c)}),this.updateSchedule(e,l)}updateSchedule(e,t=[],n=!1){const r=this.events||[];if(r.length||t.length||this.length<2){const s=this.items,o=this.parseSchedule(r,e);(n||t.length||(s==null?void 0:s.length)!==o.length||o.some((l,c)=>Math.abs(l.playout.start-s[c].playout.start)>.005||Math.abs(l.playout.end-s[c].playout.end)>.005))&&(this.items=o,this.onScheduleUpdate(t,s))}}parseDateRanges(e,t,n){const r=[],s=Object.keys(e);for(let o=0;o<s.length;o++){const a=s[o],l=e[a];if(l.isInterstitial){let c=this.eventMap[a];c?c.setDateRange(l):(c=new Fge(l,t),this.eventMap[a]=c,n===!1&&(c.appendInPlace=n)),r.push(c)}}return r}parseSchedule(e,t){const n=[],r=t.main.details,s=r.live?1/0:r.edge;let o=0;if(e=e.filter(l=>!l.error&&!(l.cue.once&&l.hasPlayed)),e.length){this.resolveOffsets(e,t);let l=0,c=0;if(e.forEach((u,h)=>{const f=u.cue.pre,d=u.cue.post,m=e[h-1]||null,A=u.appendInPlace,g=d?s:u.startOffset,y=u.duration,E=u.timelineOccupancy===XS.Range?y:0,x=u.resumptionOffset,C=(m==null?void 0:m.startTime)===g,T=g+u.cumulativeDuration;let I=A?T+y:g+x;if(f||!d&&g<=0){const L=c;c+=E,u.timelineStart=T;const R=o;o+=y,n.push({event:u,start:T,end:I,playout:{start:R,end:o},integrated:{start:L,end:c}})}else if(g<=s){if(!C){const P=g-l;if(P>Ik){const F=l,k=c;c+=P;const z=o;o+=P;const U={previousEvent:e[h-1]||null,nextEvent:u,start:F,end:F+P,playout:{start:z,end:o},integrated:{start:k,end:c}};n.push(U)}else P>0&&m&&(m.cumulativeDuration+=P,n[n.length-1].end=g)}d&&(I=T),u.timelineStart=T;const L=c;c+=E;const R=o;o+=y,n.push({event:u,start:T,end:I,playout:{start:R,end:o},integrated:{start:L,end:c}})}else return;const M=u.resumeTime;d||M>s?l=s:l=M}),l<s){var a;const u=l,h=c,f=s-l;c+=f;const d=o;o+=f,n.push({previousEvent:((a=n[n.length-1])==null?void 0:a.event)||null,nextEvent:null,start:l,end:u+f,playout:{start:d,end:o},integrated:{start:h,end:c}})}this.setDurations(s,o,c)}else n.push({previousEvent:null,nextEvent:null,start:0,end:s,playout:{start:0,end:s},integrated:{start:0,end:s}}),this.setDurations(s,s,s);return n}setDurations(e,t,n){this.durations={primary:e,playout:t,integrated:n}}resolveOffsets(e,t){const n=t.main.details,r=n.live?1/0:n.edge;let s=0,o=-1;e.forEach((a,l)=>{const c=a.cue.pre,u=a.cue.post,h=c?0:u?r:a.startTime;this.updateAssetDurations(a),o===h?a.cumulativeDuration=s:(s=0,o=h),!u&&a.snapOptions.in&&(a.resumeAnchor=s0(null,n.fragments,a.startOffset+a.resumptionOffset,0,0)||void 0),a.appendInPlace&&!a.appendInPlaceStarted&&(this.primaryCanResumeInPlaceAt(a,t)||(a.appendInPlace=!1)),!a.appendInPlace&&l+1<e.length&&e[l+1].startTime-e[l].resumeTime<Ik&&(e[l+1].appendInPlace=!1,e[l+1].appendInPlace&&this.warn(`Could not change append strategy for abutting event ${a}`));const d=Wt(a.resumeOffset)?a.resumeOffset:a.duration;s+=d})}primaryCanResumeInPlaceAt(e,t){const n=e.resumeTime,r=e.startTime+e.resumptionOffset;return Math.abs(n-r)>j1?(this.log(`"${e.identifier}" resumption ${n} not aligned with estimated timeline end ${r}`),!1):!Object.keys(t).some(o=>{const a=t[o].details,l=a.edge;if(n>=l)return this.log(`"${e.identifier}" resumption ${n} past ${o} playlist end ${l}`),!1;const c=s0(null,a.fragments,n);if(!c)return this.log(`"${e.identifier}" resumption ${n} does not align with any fragments in ${o} playlist (${a.fragStart}-${a.fragmentEnd})`),!0;const u=o==="audio"?.175:0;return Math.abs(c.start-n)<j1+u||Math.abs(c.end-n)<j1+u?!1:(this.log(`"${e.identifier}" resumption ${n} not aligned with ${o} fragment bounds (${c.start}-${c.end} sn: ${c.sn} cc: ${c.cc})`),!0)})}updateAssetDurations(e){if(!e.assetListLoaded)return;const t=e.timelineStart;let n=0,r=!1,s=!1;for(let o=0;o<e.assetList.length;o++){const a=e.assetList[o],l=t+n;a.startOffset=n,a.timelineStart=l,r||(r=a.duration===null),s||(s=!!a.error);const c=a.error?0:a.duration||0;n+=c}r&&!s?e.duration=Math.max(n,e.duration):e.duration=n}removeEvent(e){e.reset(),delete this.eventMap[e.identifier]}}function ou(i){return`[${i.event?'"'+i.event.identifier+'"':"primary"}: ${i.start.toFixed(2)}-${i.end.toFixed(2)}]`}class zge{constructor(e){this.hls=void 0,this.hls=e}destroy(){this.hls=null}loadAssetList(e,t){const n=e.assetListUrl;let r;try{r=jV(n,this.hls.sessionId,e.baseUrl)}catch(f){const d=this.assignAssetListError(e,Ke.ASSET_LIST_LOAD_ERROR,f,n);this.hls.trigger(ae.ERROR,d);return}t&&r.protocol!=="data:"&&r.searchParams.set("_HLS_start_offset",""+t);const s=this.hls.config,o=s.loader,a=new o(s),l={responseType:"json",url:r.href},c=s.interstitialAssetListLoadPolicy.default,u={loadPolicy:c,timeout:c.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},h={onSuccess:(f,d,m,A)=>{const g=f.data,y=g==null?void 0:g.ASSETS;if(!Array.isArray(y)){const E=this.assignAssetListError(e,Ke.ASSET_LIST_PARSING_ERROR,new Error("Invalid interstitial asset list"),m.url,d,A);this.hls.trigger(ae.ERROR,E);return}e.assetListResponse=g,this.hls.trigger(ae.ASSET_LIST_LOADED,{event:e,assetListResponse:g,networkDetails:A})},onError:(f,d,m,A)=>{const g=this.assignAssetListError(e,Ke.ASSET_LIST_LOAD_ERROR,new Error(`Error loading X-ASSET-LIST: HTTP status ${f.code} ${f.text} (${d.url})`),d.url,A,m);this.hls.trigger(ae.ERROR,g)},onTimeout:(f,d,m)=>{const A=this.assignAssetListError(e,Ke.ASSET_LIST_LOAD_TIMEOUT,new Error(`Timeout loading X-ASSET-LIST (${d.url})`),d.url,f,m);this.hls.trigger(ae.ERROR,A)}};return a.load(l,u,h),this.hls.trigger(ae.ASSET_LIST_LOADING,{event:e}),a}assignAssetListError(e,t,n,r,s,o){return e.error=n,{type:rn.NETWORK_ERROR,details:t,fatal:!1,interstitial:e,url:r,error:n,networkDetails:o,stats:s}}}function Mk(i){var e;i==null||(e=i.play())==null||e.catch(()=>{})}function e_(i,e){return`[${i}] Advancing timeline position to ${e}`}class Gge extends _c{constructor(e,t){super("interstitials",e.logger),this.HlsPlayerClass=void 0,this.hls=void 0,this.assetListLoader=void 0,this.mediaSelection=null,this.altSelection=null,this.media=null,this.detachedData=null,this.requiredTracks=null,this.manager=null,this.playerQueue=[],this.bufferedPos=-1,this.timelinePos=-1,this.schedule=void 0,this.playingItem=null,this.bufferingItem=null,this.waitingItem=null,this.endedItem=null,this.playingAsset=null,this.endedAsset=null,this.bufferingAsset=null,this.shouldPlay=!1,this.onPlay=()=>{this.shouldPlay=!0},this.onPause=()=>{this.shouldPlay=!1},this.onSeeking=()=>{const n=this.currentTime;if(n===void 0||this.playbackDisabled||!this.schedule)return;const r=n-this.timelinePos;if(Math.abs(r)<1/7056e5)return;const o=r<=-.01;this.timelinePos=n,this.bufferedPos=n;const a=this.playingItem;if(!a){this.checkBuffer();return}if(o&&this.schedule.resetErrorsInRange(n,n-r)&&this.updateSchedule(!0),this.checkBuffer(),o&&n<a.start||n>=a.end){var l;const d=this.findItemIndex(a);let m=this.schedule.findItemIndexAtTime(n);if(m===-1&&(m=d+(o?-1:1),this.log(`seeked ${o?"back ":""}to position not covered by schedule ${n} (resolving from ${d} to ${m})`)),!this.isInterstitial(a)&&(l=this.media)!=null&&l.paused&&(this.shouldPlay=!1),!o&&m>d){const A=this.schedule.findJumpRestrictedIndex(d+1,m);if(A>d){this.setSchedulePosition(A);return}}this.setSchedulePosition(m);return}const c=this.playingAsset;if(!c){if(this.playingLastItem&&this.isInterstitial(a)){const d=a.event.assetList[0];d&&(this.endedItem=this.playingItem,this.playingItem=null,this.setScheduleToAssetAtTime(n,d))}return}const u=c.timelineStart,h=c.duration||0;if(o&&n<u||n>=u+h){var f;(f=a.event)!=null&&f.appendInPlace&&(this.clearAssetPlayers(a.event,a),this.flushFrontBuffer(n)),this.setScheduleToAssetAtTime(n,c)}},this.onTimeupdate=()=>{const n=this.currentTime;if(n===void 0||this.playbackDisabled)return;if(n>this.timelinePos)this.timelinePos=n,n>this.bufferedPos&&this.checkBuffer();else return;const r=this.playingItem;if(!r||this.playingLastItem)return;if(n>=r.end){this.timelinePos=r.end;const a=this.findItemIndex(r);this.setSchedulePosition(a+1)}const s=this.playingAsset;if(!s)return;const o=s.timelineStart+(s.duration||0);n>=o&&this.setScheduleToAssetAtTime(n,s)},this.onScheduleUpdate=(n,r)=>{const s=this.schedule;if(!s)return;const o=this.playingItem,a=s.events||[],l=s.items||[],c=s.durations,u=n.map(A=>A.identifier),h=!!(a.length||u.length);(h||r)&&this.log(`INTERSTITIALS_UPDATED (${a.length}): ${a}
Schedule: ${l.map(A=>ou(A))} pos: ${this.timelinePos}`),u.length&&this.log(`Removed events ${u}`);let f=null,d=null;o&&(f=this.updateItem(o,this.timelinePos),this.itemsMatch(o,f)?this.playingItem=f:this.waitingItem=this.endedItem=null),this.waitingItem=this.updateItem(this.waitingItem),this.endedItem=this.updateItem(this.endedItem);const m=this.bufferingItem;if(m&&(d=this.updateItem(m,this.bufferedPos),this.itemsMatch(m,d)?this.bufferingItem=d:m.event&&(this.bufferingItem=this.playingItem,this.clearInterstitial(m.event,null))),n.forEach(A=>{A.assetList.forEach(g=>{this.clearAssetPlayer(g.identifier,null)})}),this.playerQueue.forEach(A=>{if(A.interstitial.appendInPlace){const g=A.assetItem.timelineStart,y=A.timelineOffset-g;if(y)try{A.timelineOffset=g}catch(E){Math.abs(y)>j1&&this.warn(`${E} ("${A.assetId}" ${A.timelineOffset}->${g})`)}}}),h||r){if(this.hls.trigger(ae.INTERSTITIALS_UPDATED,{events:a.slice(0),schedule:l.slice(0),durations:c,removedIds:u}),this.isInterstitial(o)&&u.includes(o.event.identifier)){this.warn(`Interstitial "${o.event.identifier}" removed while playing`),this.primaryFallback(o.event);return}o&&this.trimInPlace(f,o),m&&d!==f&&this.trimInPlace(d,m),this.checkBuffer()}},this.hls=e,this.HlsPlayerClass=t,this.assetListLoader=new zge(e),this.schedule=new Uge(this.onScheduleUpdate,e.logger),this.registerListeners()}registerListeners(){const e=this.hls;e&&(e.on(ae.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(ae.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(ae.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(ae.MANIFEST_LOADING,this.onManifestLoading,this),e.on(ae.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(ae.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(ae.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.on(ae.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(ae.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.on(ae.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.on(ae.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.on(ae.BUFFER_APPENDED,this.onBufferAppended,this),e.on(ae.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(ae.BUFFERED_TO_END,this.onBufferedToEnd,this),e.on(ae.MEDIA_ENDED,this.onMediaEnded,this),e.on(ae.ERROR,this.onError,this),e.on(ae.DESTROYING,this.onDestroying,this))}unregisterListeners(){const e=this.hls;e&&(e.off(ae.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(ae.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(ae.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(ae.MANIFEST_LOADING,this.onManifestLoading,this),e.off(ae.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(ae.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(ae.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.off(ae.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(ae.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.off(ae.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.off(ae.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.off(ae.BUFFER_CODECS,this.onBufferCodecs,this),e.off(ae.BUFFER_APPENDED,this.onBufferAppended,this),e.off(ae.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(ae.BUFFERED_TO_END,this.onBufferedToEnd,this),e.off(ae.MEDIA_ENDED,this.onMediaEnded,this),e.off(ae.ERROR,this.onError,this),e.off(ae.DESTROYING,this.onDestroying,this))}startLoad(){this.resumeBuffering()}stopLoad(){this.pauseBuffering()}resumeBuffering(){var e;(e=this.getBufferingPlayer())==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.getBufferingPlayer())==null||e.pauseBuffering()}destroy(){this.unregisterListeners(),this.stopLoad(),this.assetListLoader&&this.assetListLoader.destroy(),this.emptyPlayerQueue(),this.clearScheduleState(),this.schedule&&this.schedule.destroy(),this.media=this.detachedData=this.mediaSelection=this.requiredTracks=this.altSelection=this.schedule=this.manager=null,this.hls=this.HlsPlayerClass=this.log=null,this.assetListLoader=null,this.onPlay=this.onPause=this.onSeeking=this.onTimeupdate=null,this.onScheduleUpdate=null}onDestroying(){const e=this.primaryMedia||this.media;e&&this.removeMediaListeners(e)}removeMediaListeners(e){Za(e,"play",this.onPlay),Za(e,"pause",this.onPause),Za(e,"seeking",this.onSeeking),Za(e,"timeupdate",this.onTimeupdate)}onMediaAttaching(e,t){const n=this.media=t.media;_a(n,"seeking",this.onSeeking),_a(n,"timeupdate",this.onTimeupdate),_a(n,"play",this.onPlay),_a(n,"pause",this.onPause)}onMediaAttached(e,t){const n=this.effectivePlayingItem,r=this.detachedData;if(this.detachedData=null,n===null)this.checkStart();else if(!r){this.clearScheduleState();const s=this.findItemIndex(n);this.setSchedulePosition(s)}}clearScheduleState(){this.log("clear schedule state"),this.playingItem=this.bufferingItem=this.waitingItem=this.endedItem=this.playingAsset=this.endedAsset=this.bufferingAsset=null}onMediaDetaching(e,t){const n=!!t.transferMedia,r=this.media;if(this.media=null,!n&&(r&&this.removeMediaListeners(r),this.detachedData)){const s=this.getBufferingPlayer();s&&(this.log(`Removing schedule state for detachedData and ${s}`),this.playingAsset=this.endedAsset=this.bufferingAsset=this.bufferingItem=this.waitingItem=this.detachedData=null,s.detachMedia()),this.shouldPlay=!1}}get interstitialsManager(){if(!this.hls)return null;if(this.manager)return this.manager;const e=this,t=()=>e.bufferingItem||e.waitingItem,n=h=>h&&e.getAssetPlayer(h.identifier),r=(h,f,d,m,A)=>{if(h){let g=h[f].start;const y=h.event;if(y){if(f==="playout"||y.timelineOccupancy!==XS.Point){const E=n(d);(E==null?void 0:E.interstitial)===y&&(g+=E.assetItem.startOffset+E[A])}}else{const E=m==="bufferedPos"?o():e[m];g+=E-h.start}return g}return 0},s=(h,f)=>{var d;if(h!==0&&f!=="primary"&&(d=e.schedule)!=null&&d.length){var m;const A=e.schedule.findItemIndexAtTime(h),g=(m=e.schedule.items)==null?void 0:m[A];if(g){const y=g[f].start-g.start;return h+y}}return h},o=()=>{const h=e.bufferedPos;return h===Number.MAX_VALUE?a("primary"):Math.max(h,0)},a=h=>{var f,d;return(f=e.primaryDetails)!=null&&f.live?e.primaryDetails.edge:((d=e.schedule)==null?void 0:d.durations[h])||0},l=(h,f)=>{var d,m;const A=e.effectivePlayingItem;if(A!=null&&(d=A.event)!=null&&d.restrictions.skip||!e.schedule)return;e.log(`seek to ${h} "${f}"`);const g=e.effectivePlayingItem,y=e.schedule.findItemIndexAtTime(h,f),E=(m=e.schedule.items)==null?void 0:m[y],x=e.getBufferingPlayer(),C=x==null?void 0:x.interstitial,T=C==null?void 0:C.appendInPlace,I=g&&e.itemsMatch(g,E);if(g&&(T||I)){const M=n(e.playingAsset),L=(M==null?void 0:M.media)||e.primaryMedia;if(L){const R=f==="primary"?L.currentTime:r(g,f,e.playingAsset,"timelinePos","currentTime"),P=h-R,F=(T?R:L.currentTime)+P;if(F>=0&&(!M||T||F<=M.duration)){L.currentTime=F;return}}}if(E){let M=h;if(f!=="primary"){const R=E[f].start,P=h-R;M=E.start+P}const L=!e.isInterstitial(E);if((!e.isInterstitial(g)||g.event.appendInPlace)&&(L||E.event.appendInPlace)){const R=e.media||(T?x==null?void 0:x.media:null);R&&(R.currentTime=M)}else if(g){const R=e.findItemIndex(g);if(y>R){const F=e.schedule.findJumpRestrictedIndex(R+1,y);if(F>R){e.setSchedulePosition(F);return}}let P=0;if(L)e.timelinePos=M,e.checkBuffer();else{const F=E.event.assetList,k=h-(E[f]||E).start;for(let z=F.length;z--;){const U=F[z];if(U.duration&&k>=U.startOffset&&k<U.startOffset+U.duration){P=z;break}}}e.setSchedulePosition(y,P)}}},c=()=>{const h=e.effectivePlayingItem;if(e.isInterstitial(h))return h;const f=t();return e.isInterstitial(f)?f:null},u={get bufferedEnd(){const h=t(),f=e.bufferingItem;if(f&&f===h){var d;return r(f,"playout",e.bufferingAsset,"bufferedPos","bufferedEnd")-f.playout.start||((d=e.bufferingAsset)==null?void 0:d.startOffset)||0}return 0},get currentTime(){const h=c(),f=e.effectivePlayingItem;return f&&f===h?r(f,"playout",e.effectivePlayingAsset,"timelinePos","currentTime")-f.playout.start:0},set currentTime(h){const f=c(),d=e.effectivePlayingItem;d&&d===f&&l(h+d.playout.start,"playout")},get duration(){const h=c();return h?h.playout.end-h.playout.start:0},get assetPlayers(){var h;const f=(h=c())==null?void 0:h.event.assetList;return f?f.map(d=>e.getAssetPlayer(d.identifier)):[]},get playingIndex(){var h;const f=(h=c())==null?void 0:h.event;return f&&e.effectivePlayingAsset?f.findAssetIndex(e.effectivePlayingAsset):-1},get scheduleItem(){return c()}};return this.manager={get events(){var h;return((h=e.schedule)==null||(h=h.events)==null?void 0:h.slice(0))||[]},get schedule(){var h;return((h=e.schedule)==null||(h=h.items)==null?void 0:h.slice(0))||[]},get interstitialPlayer(){return c()?u:null},get playerQueue(){return e.playerQueue.slice(0)},get bufferingAsset(){return e.bufferingAsset},get bufferingItem(){return t()},get bufferingIndex(){const h=t();return e.findItemIndex(h)},get playingAsset(){return e.effectivePlayingAsset},get playingItem(){return e.effectivePlayingItem},get playingIndex(){const h=e.effectivePlayingItem;return e.findItemIndex(h)},primary:{get bufferedEnd(){return o()},get currentTime(){const h=e.timelinePos;return h>0?h:0},set currentTime(h){l(h,"primary")},get duration(){return a("primary")},get seekableStart(){var h;return((h=e.primaryDetails)==null?void 0:h.fragmentStart)||0}},integrated:{get bufferedEnd(){return r(t(),"integrated",e.bufferingAsset,"bufferedPos","bufferedEnd")},get currentTime(){return r(e.effectivePlayingItem,"integrated",e.effectivePlayingAsset,"timelinePos","currentTime")},set currentTime(h){l(h,"integrated")},get duration(){return a("integrated")},get seekableStart(){var h;return s(((h=e.primaryDetails)==null?void 0:h.fragmentStart)||0,"integrated")}},skip:()=>{const h=e.effectivePlayingItem,f=h==null?void 0:h.event;if(f&&!f.restrictions.skip){const d=e.findItemIndex(h);if(f.appendInPlace){const m=h.playout.start+h.event.duration;l(m+.001,"playout")}else e.advanceAfterAssetEnded(f,d,1/0)}}}}get effectivePlayingItem(){return this.waitingItem||this.playingItem||this.endedItem}get effectivePlayingAsset(){return this.playingAsset||this.endedAsset}get playingLastItem(){var e;const t=this.playingItem,n=(e=this.schedule)==null?void 0:e.items;return!this.playbackStarted||!t||!n?!1:this.findItemIndex(t)===n.length-1}get playbackStarted(){return this.effectivePlayingItem!==null}get currentTime(){var e,t;if(this.mediaSelection===null)return;const n=this.waitingItem||this.playingItem;if(this.isInterstitial(n)&&!n.event.appendInPlace)return;let r=this.media;!r&&(e=this.bufferingItem)!=null&&(e=e.event)!=null&&e.appendInPlace&&(r=this.primaryMedia);const s=(t=r)==null?void 0:t.currentTime;if(!(s===void 0||!Wt(s)))return s}get primaryMedia(){var e;return this.media||((e=this.detachedData)==null?void 0:e.media)||null}isInterstitial(e){return!!(e!=null&&e.event)}retreiveMediaSource(e,t){const n=this.getAssetPlayer(e);n&&this.transferMediaFromPlayer(n,t)}transferMediaFromPlayer(e,t){const n=e.interstitial.appendInPlace,r=e.media;if(n&&r===this.primaryMedia){if(this.bufferingAsset=null,(!t||this.isInterstitial(t)&&!t.event.appendInPlace)&&t&&r){this.detachedData={media:r};return}const s=e.transferMedia();this.log(`transfer MediaSource from ${e} ${lr(s)}`),this.detachedData=s}else t&&r&&(this.shouldPlay||(this.shouldPlay=!r.paused))}transferMediaTo(e,t){var n,r;if(e.media===t)return;let s=null;const o=this.hls,a=e!==o,l=a&&e.interstitial.appendInPlace,c=(n=this.detachedData)==null?void 0:n.mediaSource;let u;if(o.media)l&&(s=o.transferMedia(),this.detachedData=s),u="Primary";else if(c){const m=this.getBufferingPlayer();m?(s=m.transferMedia(),u=`${m}`):u="detached MediaSource"}else u="detached media";if(!s){if(c)s=this.detachedData,this.log(`using detachedData: MediaSource ${lr(s)}`);else if(!this.detachedData||o.media===t){const m=this.playerQueue;m.length>1&&m.forEach(A=>{if(a&&A.interstitial.appendInPlace!==l){const g=A.interstitial;this.clearInterstitial(A.interstitial,null),g.appendInPlace=!1,g.appendInPlace&&this.warn(`Could not change append strategy for queued assets ${g}`)}}),this.hls.detachMedia(),this.detachedData={media:t}}}const h=s&&"mediaSource"in s&&((r=s.mediaSource)==null?void 0:r.readyState)!=="closed",f=h&&s?s:t;this.log(`${h?"transfering MediaSource":"attaching media"} to ${a?e:"Primary"} from ${u} (media.currentTime: ${t.currentTime})`);const d=this.schedule;if(f===s&&d){const m=a&&e.assetId===d.assetIdAtEnd;f.overrides={duration:d.duration,endOfStream:!a||m,cueRemoval:!a}}e.attachMedia(f)}onInterstitialCueEnter(){this.onTimeupdate()}checkStart(){const e=this.schedule,t=e==null?void 0:e.events;if(!t||this.playbackDisabled||!this.media)return;this.bufferedPos===-1&&(this.bufferedPos=0);const n=this.timelinePos,r=this.effectivePlayingItem;if(n===-1){const s=this.hls.startPosition;if(this.log(e_("checkStart",s)),this.timelinePos=s,t.length&&t[0].cue.pre){const o=e.findEventIndex(t[0].identifier);this.setSchedulePosition(o)}else if(s>=0||!this.primaryLive){const o=this.timelinePos=s>0?s:0,a=e.findItemIndexAtTime(o);this.setSchedulePosition(a)}}else if(r&&!this.playingItem){const s=e.findItemIndex(r);this.setSchedulePosition(s)}}advanceAssetBuffering(e,t){const n=e.event,r=n.findAssetIndex(t),s=Vb(n,r);if(!n.isAssetPastPlayoutLimit(s))this.bufferedToEvent(e,s);else if(this.schedule){var o;const a=(o=this.schedule.items)==null?void 0:o[this.findItemIndex(e)+1];a&&this.bufferedToItem(a)}}advanceAfterAssetEnded(e,t,n){const r=Vb(e,n);if(e.isAssetPastPlayoutLimit(r)){if(this.schedule){const s=this.schedule.items;if(s){const o=t+1,a=s.length;if(o>=a){this.setSchedulePosition(-1);return}const l=e.resumeTime;this.timelinePos<l&&(this.log(e_("advanceAfterAssetEnded",l)),this.timelinePos=l,e.appendInPlace&&this.advanceInPlace(l),this.checkBuffer(this.bufferedPos<l)),this.setSchedulePosition(o)}}}else{if(e.appendInPlace){const s=e.assetList[r];s&&this.advanceInPlace(s.timelineStart)}this.setSchedulePosition(t,r)}}setScheduleToAssetAtTime(e,t){const n=this.schedule;if(!n)return;const r=t.parentIdentifier,s=n.getEvent(r);if(s){const o=n.findEventIndex(r),a=n.findAssetIndex(s,e);this.advanceAfterAssetEnded(s,o,a-1)}}setSchedulePosition(e,t){var n;const r=(n=this.schedule)==null?void 0:n.items;if(!r||this.playbackDisabled)return;const s=e>=0?r[e]:null;this.log(`setSchedulePosition ${e}, ${t} (${s&&ou(s)}) pos: ${this.timelinePos}`);const o=this.waitingItem||this.playingItem,a=this.playingLastItem;if(this.isInterstitial(o)){const u=o.event,h=this.playingAsset,f=h==null?void 0:h.identifier,d=f?this.getAssetPlayer(f):null;if(d&&f&&(!this.eventItemsMatch(o,s)||t!==void 0&&f!==u.assetList[t].identifier)){var l;const m=u.findAssetIndex(h);if(this.log(`INTERSTITIAL_ASSET_ENDED ${m+1}/${u.assetList.length} ${S1(h)}`),this.endedAsset=h,this.playingAsset=null,this.hls.trigger(ae.INTERSTITIAL_ASSET_ENDED,{asset:h,assetListIndex:m,event:u,schedule:r.slice(0),scheduleIndex:e,player:d}),o!==this.playingItem){this.itemsMatch(o,this.playingItem)&&!this.playingAsset&&this.advanceAfterAssetEnded(u,this.findItemIndex(this.playingItem),m);return}this.retreiveMediaSource(f,s),d.media&&!((l=this.detachedData)!=null&&l.mediaSource)&&d.detachMedia()}if(!this.eventItemsMatch(o,s)&&(this.endedItem=o,this.playingItem=null,this.log(`INTERSTITIAL_ENDED ${u} ${ou(o)}`),u.hasPlayed=!0,this.hls.trigger(ae.INTERSTITIAL_ENDED,{event:u,schedule:r.slice(0),scheduleIndex:e}),u.cue.once)){var c;this.updateSchedule();const m=(c=this.schedule)==null?void 0:c.items;if(s&&m){const A=this.findItemIndex(s);this.advanceSchedule(A,m,t,o,a)}return}}this.advanceSchedule(e,r,t,o,a)}advanceSchedule(e,t,n,r,s){const o=this.schedule;if(!o)return;const a=t[e]||null,l=this.primaryMedia,c=this.playerQueue;if(c.length&&c.forEach(u=>{const h=u.interstitial,f=o.findEventIndex(h.identifier);(f<e||f>e+1)&&this.clearInterstitial(h,a)}),this.isInterstitial(a)){this.timelinePos=Math.min(Math.max(this.timelinePos,a.start),a.end);const u=a.event;if(n===void 0){n=o.findAssetIndex(u,this.timelinePos);const m=Vb(u,n-1);if(u.isAssetPastPlayoutLimit(m)||u.appendInPlace&&this.timelinePos===a.end){this.advanceAfterAssetEnded(u,e,n);return}n=m}const h=this.waitingItem;this.assetsBuffered(a,l)||this.setBufferingItem(a);let f=this.preloadAssets(u,n);if(this.eventItemsMatch(a,h||r)||(this.waitingItem=a,this.log(`INTERSTITIAL_STARTED ${ou(a)} ${u.appendInPlace?"append in place":""}`),this.hls.trigger(ae.INTERSTITIAL_STARTED,{event:u,schedule:t.slice(0),scheduleIndex:e})),!u.assetListLoaded){this.log(`Waiting for ASSET-LIST to complete loading ${u}`);return}if(u.assetListLoader&&(u.assetListLoader.destroy(),u.assetListLoader=void 0),!l){this.log(`Waiting for attachMedia to start Interstitial ${u}`);return}this.waitingItem=this.endedItem=null,this.playingItem=a;const d=u.assetList[n];if(!d){this.advanceAfterAssetEnded(u,e,n||0);return}if(f||(f=this.getAssetPlayer(d.identifier)),f===null||f.destroyed){const m=u.assetList.length;this.warn(`asset ${n+1}/${m} player destroyed ${u}`),f=this.createAssetPlayer(u,d,n),f.loadSource()}if(!this.eventItemsMatch(a,this.bufferingItem)&&u.appendInPlace&&this.isAssetBuffered(d))return;this.startAssetPlayer(f,n,t,e,l),this.shouldPlay&&Mk(f.media)}else a?(this.resumePrimary(a,e,r),this.shouldPlay&&Mk(this.hls.media)):s&&this.isInterstitial(r)&&(this.endedItem=null,this.playingItem=r,r.event.appendInPlace||this.attachPrimary(o.durations.primary,null))}get playbackDisabled(){return this.hls.config.enableInterstitialPlayback===!1}get primaryDetails(){var e;return(e=this.mediaSelection)==null?void 0:e.main.details}get primaryLive(){var e;return!!((e=this.primaryDetails)!=null&&e.live)}resumePrimary(e,t,n){var r,s;if(this.playingItem=e,this.playingAsset=this.endedAsset=null,this.waitingItem=this.endedItem=null,this.bufferedToItem(e),this.log(`resuming ${ou(e)}`),!((r=this.detachedData)!=null&&r.mediaSource)){let a=this.timelinePos;(a<e.start||a>=e.end)&&(a=this.getPrimaryResumption(e,t),this.log(e_("resumePrimary",a)),this.timelinePos=a),this.attachPrimary(a,e)}if(!n)return;const o=(s=this.schedule)==null?void 0:s.items;o&&(this.log(`INTERSTITIALS_PRIMARY_RESUMED ${ou(e)}`),this.hls.trigger(ae.INTERSTITIALS_PRIMARY_RESUMED,{schedule:o.slice(0),scheduleIndex:t}),this.checkBuffer())}getPrimaryResumption(e,t){const n=e.start;if(this.primaryLive){const r=this.primaryDetails;if(t===0)return this.hls.startPosition;if(r&&(n<r.fragmentStart||n>r.edge))return this.hls.liveSyncPosition||-1}return n}isAssetBuffered(e){const t=this.getAssetPlayer(e.identifier);return t!=null&&t.hls?t.hls.bufferedToEnd:jn.bufferInfo(this.primaryMedia,this.timelinePos,0).end+1>=e.timelineStart+(e.duration||0)}attachPrimary(e,t,n){t?this.setBufferingItem(t):this.bufferingItem=this.playingItem,this.bufferingAsset=null;const r=this.primaryMedia;if(!r)return;const s=this.hls;s.media?this.checkBuffer():(this.transferMediaTo(s,r),n&&this.startLoadingPrimaryAt(e,n)),n||(this.log(e_("attachPrimary",e)),this.timelinePos=e,this.startLoadingPrimaryAt(e,n))}startLoadingPrimaryAt(e,t){var n;const r=this.hls;!r.loadingEnabled||!r.media||Math.abs((((n=r.mainForwardBufferInfo)==null?void 0:n.start)||r.media.currentTime)-e)>.5?r.startLoad(e,t):r.bufferingEnabled||r.resumeBuffering()}onManifestLoading(){var e;this.stopLoad(),(e=this.schedule)==null||e.reset(),this.emptyPlayerQueue(),this.clearScheduleState(),this.shouldPlay=!1,this.bufferedPos=this.timelinePos=-1,this.mediaSelection=this.altSelection=this.manager=this.requiredTracks=null,this.hls.off(ae.BUFFER_CODECS,this.onBufferCodecs,this),this.hls.on(ae.BUFFER_CODECS,this.onBufferCodecs,this)}onLevelUpdated(e,t){if(t.level===-1||!this.schedule)return;const n=this.hls.levels[t.level];if(!n.details)return;const r=Qi(Qi({},this.mediaSelection||this.altSelection),{},{main:n});this.mediaSelection=r,this.schedule.parseInterstitialDateRanges(r,this.hls.config.interstitialAppendInPlace),!this.effectivePlayingItem&&this.schedule.items&&this.checkStart()}onAudioTrackUpdated(e,t){const n=this.hls.audioTracks[t.id],r=this.mediaSelection;if(!r){this.altSelection=Qi(Qi({},this.altSelection),{},{audio:n});return}const s=Qi(Qi({},r),{},{audio:n});this.mediaSelection=s}onSubtitleTrackUpdated(e,t){const n=this.hls.subtitleTracks[t.id],r=this.mediaSelection;if(!r){this.altSelection=Qi(Qi({},this.altSelection),{},{subtitles:n});return}const s=Qi(Qi({},r),{},{subtitles:n});this.mediaSelection=s}onAudioTrackSwitching(e,t){const n=N7(t);this.playerQueue.forEach(({hls:r})=>r&&(r.setAudioOption(t)||r.setAudioOption(n)))}onSubtitleTrackSwitch(e,t){const n=N7(t);this.playerQueue.forEach(({hls:r})=>r&&(r.setSubtitleOption(t)||t.id!==-1&&r.setSubtitleOption(n)))}onBufferCodecs(e,t){const n=t.tracks;n&&(this.requiredTracks=n)}onBufferAppended(e,t){this.checkBuffer()}onBufferFlushed(e,t){const n=this.playingItem;if(n&&!this.itemsMatch(n,this.bufferingItem)&&!this.isInterstitial(n)){const r=this.timelinePos;this.bufferedPos=r,this.checkBuffer()}}onBufferedToEnd(e){if(!this.schedule)return;const t=this.schedule.events;if(this.bufferedPos<Number.MAX_VALUE&&t){for(let r=0;r<t.length;r++){const s=t[r];if(s.cue.post){var n;const o=this.schedule.findEventIndex(s.identifier),a=(n=this.schedule.items)==null?void 0:n[o];this.isInterstitial(a)&&this.eventItemsMatch(a,this.bufferingItem)&&this.bufferedToItem(a,0);break}}this.bufferedPos=Number.MAX_VALUE}}onMediaEnded(e){const t=this.playingItem;if(!this.playingLastItem&&t){const n=this.findItemIndex(t);this.setSchedulePosition(n+1)}else this.shouldPlay=!1}updateItem(e,t){var n;const r=(n=this.schedule)==null?void 0:n.items;if(e&&r){const s=this.findItemIndex(e,t);return r[s]||null}return null}trimInPlace(e,t){if(this.isInterstitial(e)&&e.event.appendInPlace&&t.end-e.end>.25){e.event.assetList.forEach((s,o)=>{e.event.isAssetPastPlayoutLimit(o)&&this.clearAssetPlayer(s.identifier,null)});const n=e.end+.25,r=jn.bufferInfo(this.primaryMedia,n,0);(r.end>n||(r.nextStart||0)>n)&&(this.log(`trim buffered interstitial ${ou(e)} (was ${ou(t)})`),this.attachPrimary(n,null,!0),this.flushFrontBuffer(n))}}itemsMatch(e,t){return!!t&&(e===t||e.event&&t.event&&this.eventItemsMatch(e,t)||!e.event&&!t.event&&this.findItemIndex(e)===this.findItemIndex(t))}eventItemsMatch(e,t){var n;return!!t&&(e===t||e.event.identifier===((n=t.event)==null?void 0:n.identifier))}findItemIndex(e,t){return e&&this.schedule?this.schedule.findItemIndex(e,t):-1}updateSchedule(e=!1){var t;const n=this.mediaSelection;n&&((t=this.schedule)==null||t.updateSchedule(n,[],e))}checkBuffer(e){var t;const n=(t=this.schedule)==null?void 0:t.items;if(!n)return;const r=jn.bufferInfo(this.primaryMedia,this.timelinePos,0);e&&(this.bufferedPos=this.timelinePos),e||(e=r.len<1),this.updateBufferedPos(r.end,n,e)}updateBufferedPos(e,t,n){const r=this.schedule,s=this.bufferingItem;if(this.bufferedPos>e||!r)return;if(t.length===1&&this.itemsMatch(t[0],s)){this.bufferedPos=e;return}const o=this.playingItem,a=this.findItemIndex(o);let l=r.findItemIndexAtTime(e);if(this.bufferedPos<e){var c;const u=this.findItemIndex(s),h=Math.min(u+1,t.length-1),f=t[h];if((l===-1&&s&&e>=s.end||(c=f.event)!=null&&c.appendInPlace&&e+.01>=f.start)&&(l=h),this.isInterstitial(s)){const d=s.event;if(h-a>1&&d.appendInPlace===!1||d.assetList.length===0&&d.assetListLoader)return}if(this.bufferedPos=e,l>u&&l>a)this.bufferedToItem(f);else{const d=this.primaryDetails;this.primaryLive&&d&&e>d.edge-d.targetduration&&f.start<d.edge+this.hls.config.interstitialLiveLookAhead&&this.isInterstitial(f)&&this.preloadAssets(f.event,0)}}else n&&o&&!this.itemsMatch(o,s)&&(l===a?this.bufferedToItem(o):l===a+1&&this.bufferedToItem(t[l]))}assetsBuffered(e,t){return e.event.assetList.length===0?!1:!e.event.assetList.some(r=>{const s=this.getAssetPlayer(r.identifier);return!(s!=null&&s.bufferedInPlaceToEnd(t))})}setBufferingItem(e){const t=this.bufferingItem,n=this.schedule;if(!this.itemsMatch(e,t)&&n){const{items:r,events:s}=n;if(!r||!s)return t;const o=this.isInterstitial(e),a=this.getBufferingPlayer();this.bufferingItem=e,this.bufferedPos=Math.max(e.start,Math.min(e.end,this.timelinePos));const l=a?a.remaining:t?t.end-this.timelinePos:0;if(this.log(`INTERSTITIALS_BUFFERED_TO_BOUNDARY ${ou(e)}`+(t?` (${l.toFixed(2)} remaining)`:"")),!this.playbackDisabled)if(o){const c=n.findAssetIndex(e.event,this.bufferedPos);e.event.assetList.forEach((u,h)=>{const f=this.getAssetPlayer(u.identifier);f&&(h===c&&f.loadSource(),f.resumeBuffering())})}else this.hls.resumeBuffering(),this.playerQueue.forEach(c=>c.pauseBuffering());this.hls.trigger(ae.INTERSTITIALS_BUFFERED_TO_BOUNDARY,{events:s.slice(0),schedule:r.slice(0),bufferingIndex:this.findItemIndex(e),playingIndex:this.findItemIndex(this.playingItem)})}else this.bufferingItem!==e&&(this.bufferingItem=e);return t}bufferedToItem(e,t=0){const n=this.setBufferingItem(e);if(!this.playbackDisabled){if(this.isInterstitial(e))this.bufferedToEvent(e,t);else if(n!==null){this.bufferingAsset=null;const r=this.detachedData;r?r.mediaSource?this.attachPrimary(e.start,e,!0):this.preloadPrimary(e):this.preloadPrimary(e)}}}preloadPrimary(e){const t=this.findItemIndex(e),n=this.getPrimaryResumption(e,t);this.startLoadingPrimaryAt(n)}bufferedToEvent(e,t){const n=e.event,r=n.assetList.length===0&&!n.assetListLoader,s=n.cue.once;if(r||!s){const o=this.preloadAssets(n,t);if(o!=null&&o.interstitial.appendInPlace){const a=this.primaryMedia;a&&this.bufferAssetPlayer(o,a)}}}preloadAssets(e,t){const n=e.assetUrl,r=e.assetList.length,s=r===0&&!e.assetListLoader,o=e.cue.once;if(s){const l=e.timelineStart;if(e.appendInPlace){var a;const f=this.playingItem;!this.isInterstitial(f)&&(f==null||(a=f.nextEvent)==null?void 0:a.identifier)===e.identifier&&this.flushFrontBuffer(l+.25)}let c,u=0;if(!this.playingItem&&this.primaryLive&&(u=this.hls.startPosition,u===-1&&(u=this.hls.liveSyncPosition||0)),u&&!(e.cue.pre||e.cue.post)){const f=u-l;f>0&&(c=Math.round(f*1e3)/1e3)}if(this.log(`Load interstitial asset ${t+1}/${n?1:r} ${e}${c?` live-start: ${u} start-offset: ${c}`:""}`),n)return this.createAsset(e,0,0,l,e.duration,n);const h=this.assetListLoader.loadAssetList(e,c);h&&(e.assetListLoader=h)}else if(!o&&r){for(let c=t;c<r;c++){const u=e.assetList[c],h=this.getAssetPlayerQueueIndex(u.identifier);(h===-1||this.playerQueue[h].destroyed)&&!u.error&&this.createAssetPlayer(e,u,c)}const l=e.assetList[t];if(l){const c=this.getAssetPlayer(l.identifier);return c&&c.loadSource(),c}}return null}flushFrontBuffer(e){const t=this.requiredTracks;if(!t)return;this.log(`Removing front buffer starting at ${e}`),Object.keys(t).forEach(r=>{this.hls.trigger(ae.BUFFER_FLUSHING,{startOffset:e,endOffset:1/0,type:r})})}getAssetPlayerQueueIndex(e){const t=this.playerQueue;for(let n=0;n<t.length;n++)if(e===t[n].assetId)return n;return-1}getAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);return this.playerQueue[t]||null}getBufferingPlayer(){const{playerQueue:e,primaryMedia:t}=this;if(t){for(let n=0;n<e.length;n++)if(e[n].media===t)return e[n]}return null}createAsset(e,t,n,r,s,o){const a={parentIdentifier:e.identifier,identifier:kge(e,o,t),duration:s,startOffset:n,timelineStart:r,uri:o};return this.createAssetPlayer(e,a,t)}createAssetPlayer(e,t,n){const r=this.hls,s=r.userConfig;let o=s.videoPreference;const a=r.loadLevelObj||r.levels[r.currentLevel];(o||a)&&(o=er({},o),a.videoCodec&&(o.videoCodec=a.videoCodec),a.videoRange&&(o.allowedVideoRanges=[a.videoRange]));const l=r.audioTracks[r.audioTrack],c=r.subtitleTracks[r.subtitleTrack];let u=0;if(this.primaryLive||e.appendInPlace){const C=this.timelinePos-t.timelineStart;if(C>1){const T=t.duration;T&&C<T&&(u=C)}}const h=t.identifier,f=Qi(Qi({},s),{},{maxMaxBufferLength:Math.min(180,r.config.maxMaxBufferLength),autoStartLoad:!0,startFragPrefetch:!0,primarySessionId:r.sessionId,assetPlayerId:h,abrEwmaDefaultEstimate:r.bandwidthEstimate,interstitialsController:void 0,startPosition:u,liveDurationInfinity:!1,testBandwidth:!1,videoPreference:o,audioPreference:l||s.audioPreference,subtitlePreference:c||s.subtitlePreference});e.appendInPlace&&(e.appendInPlaceStarted=!0,t.timelineStart&&(f.timelineOffset=t.timelineStart));const d=f.cmcd;d!=null&&d.sessionId&&d.contentId&&(f.cmcd=er({},d,{contentId:c2(t.uri)})),this.getAssetPlayer(h)&&this.warn(`Duplicate date range identifier ${e} and asset ${h}`);const m=new Nge(this.HlsPlayerClass,f,e,t);this.playerQueue.push(m),e.assetList[n]=t;let A=!0;const g=C=>{if(C.live){var T;const L=new Error(`Interstitials MUST be VOD assets ${e}`),R={fatal:!0,type:rn.OTHER_ERROR,details:Ke.INTERSTITIAL_ASSET_ITEM_ERROR,error:L},P=((T=this.schedule)==null?void 0:T.findEventIndex(e.identifier))||-1;this.handleAssetItemError(R,e,P,n,L.message);return}const I=C.edge-C.fragmentStart,M=t.duration;(A||M===null||I>M)&&(A=!1,this.log(`Interstitial asset "${h}" duration change ${M} > ${I}`),t.duration=I,this.updateSchedule())};m.on(ae.LEVEL_UPDATED,(C,{details:T})=>g(T)),m.on(ae.LEVEL_PTS_UPDATED,(C,{details:T})=>g(T)),m.on(ae.EVENT_CUE_ENTER,()=>this.onInterstitialCueEnter());const y=(C,T)=>{const I=this.getAssetPlayer(h);if(I&&T.tracks){I.off(ae.BUFFER_CODECS,y),I.tracks=T.tracks;const M=this.primaryMedia;this.bufferingAsset===I.assetItem&&M&&!I.media&&this.bufferAssetPlayer(I,M)}};m.on(ae.BUFFER_CODECS,y);const E=()=>{var C;const T=this.getAssetPlayer(h);if(this.log(`buffered to end of asset ${T}`),!T||!this.schedule)return;const I=this.schedule.findEventIndex(e.identifier),M=(C=this.schedule.items)==null?void 0:C[I];this.isInterstitial(M)&&this.advanceAssetBuffering(M,t)};m.on(ae.BUFFERED_TO_END,E);const x=C=>()=>{if(!this.getAssetPlayer(h)||!this.schedule)return;this.shouldPlay=!0;const I=this.schedule.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,I,C)};return m.once(ae.MEDIA_ENDED,x(n)),m.once(ae.PLAYOUT_LIMIT_REACHED,x(1/0)),m.on(ae.ERROR,(C,T)=>{if(!this.schedule)return;const I=this.getAssetPlayer(h);if(T.details===Ke.BUFFER_STALLED_ERROR){if(I!=null&&I.appendInPlace){this.handleInPlaceStall(e);return}this.onTimeupdate(),this.checkBuffer(!0);return}this.handleAssetItemError(T,e,this.schedule.findEventIndex(e.identifier),n,`Asset player error ${T.error} ${e}`)}),m.on(ae.DESTROYING,()=>{if(!this.getAssetPlayer(h)||!this.schedule)return;const T=new Error(`Asset player destroyed unexpectedly ${h}`),I={fatal:!0,type:rn.OTHER_ERROR,details:Ke.INTERSTITIAL_ASSET_ITEM_ERROR,error:T};this.handleAssetItemError(I,e,this.schedule.findEventIndex(e.identifier),n,T.message)}),this.log(`INTERSTITIAL_ASSET_PLAYER_CREATED ${S1(t)}`),this.hls.trigger(ae.INTERSTITIAL_ASSET_PLAYER_CREATED,{asset:t,assetListIndex:n,event:e,player:m}),m}clearInterstitial(e,t){this.clearAssetPlayers(e,t),e.reset()}clearAssetPlayers(e,t){e.assetList.forEach(n=>{this.clearAssetPlayer(n.identifier,t)})}resetAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);if(t!==-1){this.log(`reset asset player "${e}" after error`);const n=this.playerQueue[t];this.transferMediaFromPlayer(n,null),n.resetDetails()}}clearAssetPlayer(e,t){const n=this.getAssetPlayerQueueIndex(e);if(n!==-1){const r=this.playerQueue[n];this.log(`clear ${r} toSegment: ${t&&ou(t)}`),this.transferMediaFromPlayer(r,t),this.playerQueue.splice(n,1),r.destroy()}}emptyPlayerQueue(){let e;for(;e=this.playerQueue.pop();)e.destroy();this.playerQueue=[]}startAssetPlayer(e,t,n,r,s){const{interstitial:o,assetItem:a,assetId:l}=e,c=o.assetList.length,u=this.playingAsset;this.endedAsset=null,this.playingAsset=a,(!u||u.identifier!==l)&&(u&&(this.clearAssetPlayer(u.identifier,n[r]),delete u.error),this.log(`INTERSTITIAL_ASSET_STARTED ${t+1}/${c} ${S1(a)}`),this.hls.trigger(ae.INTERSTITIAL_ASSET_STARTED,{asset:a,assetListIndex:t,event:o,schedule:n.slice(0),scheduleIndex:r,player:e})),this.bufferAssetPlayer(e,s)}bufferAssetPlayer(e,t){var n,r;if(!this.schedule)return;const{interstitial:s,assetItem:o}=e,a=this.schedule.findEventIndex(s.identifier),l=(n=this.schedule.items)==null?void 0:n[a];if(!l)return;e.loadSource(),this.setBufferingItem(l),this.bufferingAsset=o;const c=this.getBufferingPlayer();if(c===e)return;const u=s.appendInPlace;if(u&&(c==null?void 0:c.interstitial.appendInPlace)===!1)return;const h=(c==null?void 0:c.tracks)||((r=this.detachedData)==null?void 0:r.tracks)||this.requiredTracks;if(u&&o!==this.playingAsset){if(!e.tracks){this.log(`Waiting for track info before buffering ${e}`);return}if(h&&!xQ(h,e.tracks)){const f=new Error(`Asset ${S1(o)} SourceBuffer tracks ('${Object.keys(e.tracks)}') are not compatible with primary content tracks ('${Object.keys(h)}')`),d={fatal:!0,type:rn.OTHER_ERROR,details:Ke.INTERSTITIAL_ASSET_ITEM_ERROR,error:f},m=s.findAssetIndex(o);this.handleAssetItemError(d,s,a,m,f.message);return}}this.transferMediaTo(e,t)}handleInPlaceStall(e){const t=this.schedule,n=this.primaryMedia;if(!t||!n)return;const r=n.currentTime,s=t.findAssetIndex(e,r),o=e.assetList[s];if(o){const a=this.getAssetPlayer(o.identifier);if(a){const l=a.currentTime||r-o.timelineStart,c=a.duration-l;if(this.warn(`Stalled at ${l} of ${l+c} in ${a} ${e} (media.currentTime: ${r})`),l&&(c/n.playbackRate<.5||a.bufferedInPlaceToEnd(n))&&a.hls){const u=t.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,u,s)}}}}advanceInPlace(e){const t=this.primaryMedia;t&&t.currentTime<e&&(t.currentTime=e)}handleAssetItemError(e,t,n,r,s){if(e.details===Ke.BUFFER_STALLED_ERROR)return;const o=t.assetList[r]||null;if(this.warn(`INTERSTITIAL_ASSET_ERROR ${o&&S1(o)} ${e.error}`),!this.schedule)return;const a=(o==null?void 0:o.identifier)||"",l=this.getAssetPlayerQueueIndex(a),c=this.playerQueue[l]||null,u=this.schedule.items,h=er({},e,{fatal:!1,errorAction:V1(!0),asset:o,assetListIndex:r,event:t,schedule:u,scheduleIndex:n,player:c});if(this.hls.trigger(ae.INTERSTITIAL_ASSET_ERROR,h),!e.fatal)return;const f=this.playingAsset,d=this.bufferingAsset,m=new Error(s);if(o&&(this.clearAssetPlayer(a,null),o.error=m),!t.assetList.some(A=>!A.error))t.error=m;else for(let A=r;A<t.assetList.length;A++)this.resetAssetPlayer(t.assetList[A].identifier);this.updateSchedule(!0),t.error?this.primaryFallback(t):f&&f.identifier===a?this.advanceAfterAssetEnded(t,n,r):d&&d.identifier===a&&this.isInterstitial(this.bufferingItem)&&this.advanceAssetBuffering(this.bufferingItem,d)}primaryFallback(e){const t=e.timelineStart,n=this.effectivePlayingItem;let r=this.timelinePos;if(n){this.log(`Fallback to primary from event "${e.identifier}" start: ${t} pos: ${r} playing: ${ou(n)} error: ${e.error}`),r===-1&&(r=this.hls.startPosition);const o=this.updateItem(n,r);this.itemsMatch(n,o)&&this.clearInterstitial(e,null),e.appendInPlace&&(this.attachPrimary(t,null),this.flushFrontBuffer(t))}else if(r===-1){this.checkStart();return}if(!this.schedule)return;const s=this.schedule.findItemIndexAtTime(r);this.setSchedulePosition(s)}onAssetListLoaded(e,t){var n,r;const s=t.event,o=s.identifier,a=t.assetListResponse.ASSETS;if(!((n=this.schedule)!=null&&n.hasEvent(o)))return;const l=s.timelineStart,c=s.duration;let u=0;a.forEach((A,g)=>{const y=parseFloat(A.DURATION);this.createAsset(s,g,u,l+u,y,A.URI),u+=y}),s.duration=u,this.log(`Loaded asset-list with duration: ${u} (was: ${c}) ${s}`);const h=this.waitingItem,f=(h==null?void 0:h.event.identifier)===o;this.updateSchedule();const d=(r=this.bufferingItem)==null?void 0:r.event;if(f){var m;const A=this.schedule.findEventIndex(o),g=(m=this.schedule.items)==null?void 0:m[A];if(g){if(!this.playingItem&&this.timelinePos>g.end&&this.schedule.findItemIndexAtTime(this.timelinePos)!==A){s.error=new Error(`Interstitial ${a.length?"no longer within playback range":"asset-list is empty"} ${this.timelinePos} ${s}`),this.log(s.error.message),this.updateSchedule(!0),this.primaryFallback(s);return}this.setBufferingItem(g)}this.setSchedulePosition(A)}else if((d==null?void 0:d.identifier)===o){const A=s.assetList[0];if(A){const g=this.getAssetPlayer(A.identifier);if(d.appendInPlace){const y=this.primaryMedia;g&&y&&this.bufferAssetPlayer(g,y)}else g&&g.loadSource()}}}onError(e,t){if(this.schedule)switch(t.details){case Ke.ASSET_LIST_PARSING_ERROR:case Ke.ASSET_LIST_LOAD_ERROR:case Ke.ASSET_LIST_LOAD_TIMEOUT:{const n=t.interstitial;n&&(this.updateSchedule(!0),this.primaryFallback(n));break}case Ke.BUFFER_STALLED_ERROR:{const n=this.endedItem||this.waitingItem||this.playingItem;if(this.isInterstitial(n)&&n.event.appendInPlace){this.handleInPlaceStall(n.event);return}this.log(`Primary player stall @${this.timelinePos} bufferedPos: ${this.bufferedPos}`),this.onTimeupdate(),this.checkBuffer(!0);break}}}}const Rk=500;class KV extends y4{constructor(e,t,n){super(e,t,n,"subtitle-stream-controller",Yt.SUBTITLE),this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(ae.LEVEL_LOADED,this.onLevelLoaded,this),e.on(ae.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(ae.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(ae.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(ae.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(ae.BUFFER_FLUSHING,this.onBufferFlushing,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(ae.LEVEL_LOADED,this.onLevelLoaded,this),e.off(ae.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(ae.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(ae.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(ae.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(ae.BUFFER_FLUSHING,this.onBufferFlushing,this)}startLoad(e,t){this.stopLoad(),this.state=mt.IDLE,this.setInterval(Rk),this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}onManifestLoading(){super.onManifestLoading(),this.mainDetails=null}onMediaDetaching(e,t){this.tracksBuffered=[],super.onMediaDetaching(e,t)}onLevelLoaded(e,t){this.mainDetails=t.details}onSubtitleFragProcessed(e,t){const{frag:n,success:r}=t;if(this.fragContextChanged(n)||(As(n)&&(this.fragPrevious=n),this.state=mt.IDLE),!r)return;const s=this.tracksBuffered[this.currentTrackId];if(!s)return;let o;const a=n.start;for(let c=0;c<s.length;c++)if(a>=s[c].start&&a<=s[c].end){o=s[c];break}const l=n.start+n.duration;o?o.end=l:(o={start:a,end:l},s.push(o)),this.fragmentTracker.fragBuffered(n),this.fragBufferedComplete(n,null),this.media&&this.tick()}onBufferFlushing(e,t){const{startOffset:n,endOffset:r}=t;if(n===0&&r!==Number.POSITIVE_INFINITY){const s=r-1;if(s<=0)return;t.endOffsetSubtitles=Math.max(0,s),this.tracksBuffered.forEach(o=>{for(let a=0;a<o.length;){if(o[a].end<=s){o.shift();continue}else if(o[a].start<s)o[a].start=s;else break;a++}}),this.fragmentTracker.removeFragmentsInRange(n,s,Yt.SUBTITLE)}}onError(e,t){const n=t.frag;(n==null?void 0:n.type)===Yt.SUBTITLE&&(t.details===Ke.FRAG_GAP&&this.fragmentTracker.fragBuffered(n,!0),this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==mt.STOPPED&&(this.state=mt.IDLE))}onSubtitleTracksUpdated(e,{subtitleTracks:t}){if(this.levels&&CV(this.levels,t)){this.levels=t.map(n=>new aA(n));return}this.tracksBuffered=[],this.levels=t.map(n=>{const r=new aA(n);return this.tracksBuffered[r.id]=[],r}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,Yt.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null}onSubtitleTrackSwitch(e,t){var n;if(this.currentTrackId=t.id,!((n=this.levels)!=null&&n.length)||this.currentTrackId===-1){this.clearInterval();return}const r=this.levels[this.currentTrackId];r!=null&&r.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,r&&this.state!==mt.STOPPED&&this.setInterval(Rk)}onSubtitleTrackLoaded(e,t){var n;const{currentTrackId:r,levels:s}=this,{details:o,id:a}=t;if(!s){this.warn(`Subtitle tracks were reset while loading level ${a}`);return}const l=s[a];if(a>=s.length||!l)return;this.log(`Subtitle track ${a} loaded [${o.startSN},${o.endSN}]${o.lastPartSn?`[part-${o.lastPartSn}-${o.lastPartIndex}]`:""},duration:${o.totalduration}`),this.mediaBuffer=this.mediaBufferTimeRanges;let c=0;if(o.live||(n=l.details)!=null&&n.live){if(o.deltaUpdateFailed)return;const h=this.mainDetails;if(!h){this.startFragRequested=!1;return}const f=h.fragments[0];if(!l.details)o.hasProgramDateTime&&h.hasProgramDateTime?($S(o,h),c=o.fragmentStart):f&&(c=f.start,E5(o,c));else{var u;c=this.alignPlaylists(o,l.details,(u=this.levelLastLoaded)==null?void 0:u.details),c===0&&f&&(c=f.start,E5(o,c))}h&&!this.startFragRequested&&this.setStartPosition(h,c)}l.details=o,this.levelLastLoaded=l,a===r&&(this.hls.trigger(ae.SUBTITLE_TRACK_UPDATED,{details:o,id:a,groupId:t.groupId}),this.tick(),o.live&&!this.fragCurrent&&this.media&&this.state===mt.IDLE&&(s0(null,o.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),l.details=void 0)))}_handleFragmentLoadComplete(e){const{frag:t,payload:n}=e,r=t.decryptdata,s=this.hls;if(!this.fragContextChanged(t)&&n&&n.byteLength>0&&r!=null&&r.key&&r.iv&&W1(r.method)){const o=performance.now();this.decrypter.decrypt(new Uint8Array(n),r.key.buffer,r.iv.buffer,UR(r.method)).catch(a=>{throw s.trigger(ae.ERROR,{type:rn.MEDIA_ERROR,details:Ke.FRAG_DECRYPT_ERROR,fatal:!1,error:a,reason:a.message,frag:t}),a}).then(a=>{const l=performance.now();s.trigger(ae.FRAG_DECRYPTED,{frag:t,payload:a,stats:{tstart:o,tdecrypt:l}})}).catch(a=>{this.warn(`${a.name}: ${a.message}`),this.state=mt.IDLE})}}doTick(){if(!this.media){this.state=mt.IDLE;return}if(this.state===mt.IDLE){const{currentTrackId:e,levels:t}=this,n=t==null?void 0:t[e];if(!n||!t.length||!n.details||this.waitForLive(n))return;const{config:r}=this,s=this.getLoadPosition(),o=jn.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],s,r.maxBufferHole),{end:a,len:l}=o,c=n.details,u=this.hls.maxBufferLength+c.levelTargetDuration;if(l>u)return;const h=c.fragments,f=h.length,d=c.edge;let m=null;const A=this.fragPrevious;if(a<d){const E=r.maxFragLookUpTolerance,x=a>d-E?0:E;m=s0(A,h,Math.max(h[0].start,a),x),!m&&A&&A.start<h[0].start&&(m=h[0])}else m=h[f-1];if(m=this.filterReplacedPrimary(m,n.details),!m)return;const g=m.sn-c.startSN,y=h[g-1];if(y&&y.cc===m.cc&&this.fragmentTracker.getState(y)===eo.NOT_LOADED&&(m=y),this.fragmentTracker.getState(m)===eo.NOT_LOADED){const E=this.mapToInitFragWhenRequired(m);E&&this.loadFragment(E,n,a)}}}loadFragment(e,t,n){As(e)?super.loadFragment(e,t,n):this._loadInitSegment(e,t)}get mediaBufferTimeRanges(){return new Hge(this.tracksBuffered[this.currentTrackId]||[])}}class Hge{constructor(e){this.buffered=void 0;const t=(n,r,s)=>{if(r=r>>>0,r>s-1)throw new DOMException(`Failed to execute '${n}' on 'TimeRanges': The index provided (${r}) is greater than the maximum bound (${s})`);return e[r][n]};this.buffered={get length(){return e.length},end(n){return t("end",n,e.length)},start(n){return t("start",n,e.length)}}}}const Qge={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},$V=i=>String.fromCharCode(Qge[i]||i),hu=15,mf=100,Vge={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},Wge={17:2,18:4,21:6,22:8,23:10,19:13,20:15},jge={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},Kge={25:2,26:4,29:6,30:8,31:10,27:13,28:15},$ge=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class Yge{constructor(){this.time=null,this.verboseLevel=0}log(e,t){if(this.verboseLevel>=e){const n=typeof t=="function"?t():t;Ki.log(`${this.time} [${e}] ${n}`)}}}const xm=function(e){const t=[];for(let n=0;n<e.length;n++)t.push(e[n].toString(16));return t};class YV{constructor(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(e){const t=["foreground","underline","italics","background","flash"];for(let n=0;n<t.length;n++){const r=t[n];e.hasOwnProperty(r)&&(this[r]=e[r])}}isDefault(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash}equals(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}copy(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class Xge{constructor(){this.uchar=" ",this.penState=new YV}reset(){this.uchar=" ",this.penState.reset()}setChar(e,t){this.uchar=e,this.penState.copy(t)}setPenState(e){this.penState.copy(e)}equals(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}copy(e){this.uchar=e.uchar,this.penState.copy(e.penState)}isEmpty(){return this.uchar===" "&&this.penState.isDefault()}}class qge{constructor(e){this.chars=[],this.pos=0,this.currPenState=new YV,this.cueStartTime=null,this.logger=void 0;for(let t=0;t<mf;t++)this.chars.push(new Xge);this.logger=e}equals(e){for(let t=0;t<mf;t++)if(!this.chars[t].equals(e.chars[t]))return!1;return!0}copy(e){for(let t=0;t<mf;t++)this.chars[t].copy(e.chars[t])}isEmpty(){let e=!0;for(let t=0;t<mf;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}setCursor(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>mf&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=mf)}moveCursor(e){const t=this.pos+e;if(e>1)for(let n=this.pos+1;n<t+1;n++)this.chars[n].setPenState(this.currPenState);this.setCursor(t)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(e){e>=144&&this.backSpace();const t=$V(e);if(this.pos>=mf){this.logger.log(0,()=>"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1)}clearFromPos(e){let t;for(t=e;t<mf;t++)this.chars[t].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const e=[];let t=!0;for(let n=0;n<mf;n++){const r=this.chars[n].uchar;r!==" "&&(t=!1),e.push(r)}return t?"":e.join("")}setPenStyles(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)}}class Wb{constructor(e){this.rows=[],this.currRow=hu-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(let t=0;t<hu;t++)this.rows.push(new qge(e));this.logger=e}reset(){for(let e=0;e<hu;e++)this.rows[e].clear();this.currRow=hu-1}equals(e){let t=!0;for(let n=0;n<hu;n++)if(!this.rows[n].equals(e.rows[n])){t=!1;break}return t}copy(e){for(let t=0;t<hu;t++)this.rows[t].copy(e.rows[t])}isEmpty(){let e=!0;for(let t=0;t<hu;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(e){this.rows[this.currRow].insertChar(e)}setPen(e){this.rows[this.currRow].setPenStyles(e)}moveCursor(e){this.rows[this.currRow].moveCursor(e)}setCursor(e){this.logger.log(2,"setCursor: "+e),this.rows[this.currRow].setCursor(e)}setPAC(e){this.logger.log(2,()=>"pacData = "+lr(e));let t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(let a=0;a<hu;a++)this.rows[a].clear();const s=this.currRow+1-this.nrRollUpRows,o=this.lastOutputScreen;if(o){const a=o.rows[s].cueStartTime,l=this.logger.time;if(a!==null&&l!==null&&a<l)for(let c=0;c<this.nrRollUpRows;c++)this.rows[t-this.nrRollUpRows+c+1].copy(o.rows[s+c])}}this.currRow=t;const n=this.rows[this.currRow];if(e.indent!==null){const s=e.indent,o=Math.max(s-1,0);n.setCursor(e.indent),e.color=n.chars[o].penState.foreground}const r={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(r)}setBkgData(e){this.logger.log(2,()=>"bkgData = "+lr(e)),this.backSpace(),this.setPen(e),this.insertChar(32)}setRollUpRows(e){this.nrRollUpRows=e}rollUp(){if(this.nrRollUpRows===null){this.logger.log(3,"roll_up but nrRollUpRows not set yet");return}this.logger.log(1,()=>this.getDisplayText());const e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(2,"Rolling up")}getDisplayText(e){e=e||!1;const t=[];let n="",r=-1;for(let s=0;s<hu;s++){const o=this.rows[s].getTextString();o&&(r=s+1,e?t.push("Row "+r+": '"+o+"'"):t.push(o.trim()))}return t.length>0&&(e?n="["+t.join(" | ")+"]":n=t.join(`
`)),n}getTextAndFormat(){return this.rows}}class Lk{constructor(e,t,n){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new Wb(n),this.nonDisplayedMemory=new Wb(n),this.lastOutputScreen=new Wb(n),this.currRollUpRow=this.displayedMemory.rows[hu-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=n}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[hu-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(e){this.outputFilter=e}setPAC(e){this.writeScreen.setPAC(e)}setBkgData(e){this.writeScreen.setBkgData(e)}setMode(e){e!==this.mode&&(this.mode=e,this.logger.log(2,()=>"MODE="+e),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}insertChars(e){for(let n=0;n<e.length;n++)this.writeScreen.insertChar(e[n]);const t=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>t+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){const e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}ccMIDROW(e){const t={flash:!1};if(t.underline=e%2===1,t.italics=e>=46,t.italics)t.foreground="white";else{const n=Math.floor(e/2)-16,r=["white","green","blue","cyan","red","yellow","magenta"];t.foreground=r[n]}this.logger.log(2,"MIDROW: "+lr(t)),this.writeScreen.setPen(t)}outputDataUpdate(e=!1){const t=this.logger.time;t!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=t:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t),this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}}class Pk{constructor(e,t,n){this.channels=void 0,this.currentChannel=0,this.cmdHistory=Zge(),this.logger=void 0;const r=this.logger=new Yge;this.channels=[null,new Lk(e,t,r),new Lk(e+1,n,r)]}getHandler(e){return this.channels[e].getHandler()}setHandler(e,t){this.channels[e].setHandler(t)}addData(e,t){this.logger.time=e;for(let n=0;n<t.length;n+=2){const r=t[n]&127,s=t[n+1]&127;let o=!1,a=null;if(r===0&&s===0)continue;this.logger.log(3,()=>"["+xm([t[n],t[n+1]])+"] -> ("+xm([r,s])+")");const l=this.cmdHistory;if(r>=16&&r<=31){if(Jge(r,s,l)){t_(null,null,l),this.logger.log(3,()=>"Repeated command ("+xm([r,s])+") is dropped");continue}t_(r,s,this.cmdHistory),o=this.parseCmd(r,s),o||(o=this.parseMidrow(r,s)),o||(o=this.parsePAC(r,s)),o||(o=this.parseBackgroundAttributes(r,s))}else t_(null,null,l);if(!o&&(a=this.parseChars(r,s),a)){const u=this.currentChannel;u&&u>0?this.channels[u].insertChars(a):this.logger.log(2,"No channel found yet. TEXT-MODE?")}!o&&!a&&this.logger.log(2,()=>"Couldn't parse cleaned data "+xm([r,s])+" orig: "+xm([t[n],t[n+1]]))}}parseCmd(e,t){const n=(e===20||e===28||e===21||e===29)&&t>=32&&t<=47,r=(e===23||e===31)&&t>=33&&t<=35;if(!(n||r))return!1;const s=e===20||e===21||e===23?1:2,o=this.channels[s];return e===20||e===21||e===28||e===29?t===32?o.ccRCL():t===33?o.ccBS():t===34?o.ccAOF():t===35?o.ccAON():t===36?o.ccDER():t===37?o.ccRU(2):t===38?o.ccRU(3):t===39?o.ccRU(4):t===40?o.ccFON():t===41?o.ccRDC():t===42?o.ccTR():t===43?o.ccRTD():t===44?o.ccEDM():t===45?o.ccCR():t===46?o.ccENM():t===47&&o.ccEOC():o.ccTO(t-32),this.currentChannel=s,!0}parseMidrow(e,t){let n=0;if((e===17||e===25)&&t>=32&&t<=47){if(e===17?n=1:n=2,n!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const r=this.channels[n];return r?(r.ccMIDROW(t),this.logger.log(3,()=>"MIDROW ("+xm([e,t])+")"),!0):!1}return!1}parsePAC(e,t){let n;const r=(e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127,s=(e===16||e===24)&&t>=64&&t<=95;if(!(r||s))return!1;const o=e<=23?1:2;t>=64&&t<=95?n=o===1?Vge[e]:jge[e]:n=o===1?Wge[e]:Kge[e];const a=this.channels[o];return a?(a.setPAC(this.interpretPAC(n,t)),this.currentChannel=o,!0):!1}interpretPAC(e,t){let n;const r={color:null,italics:!1,indent:null,underline:!1,row:e};return t>95?n=t-96:n=t-64,r.underline=(n&1)===1,n<=13?r.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(n/2)]:n<=15?(r.italics=!0,r.color="white"):r.indent=Math.floor((n-16)/2)*4,r}parseChars(e,t){let n,r=null,s=null;if(e>=25?(n=2,s=e-8):(n=1,s=e),s>=17&&s<=19){let o;s===17?o=t+80:s===18?o=t+112:o=t+144,this.logger.log(2,()=>"Special char '"+$V(o)+"' in channel "+n),r=[o]}else e>=32&&e<=127&&(r=t===0?[e]:[e,t]);return r&&this.logger.log(3,()=>"Char codes =  "+xm(r).join(",")),r}parseBackgroundAttributes(e,t){const n=(e===16||e===24)&&t>=32&&t<=47,r=(e===23||e===31)&&t>=45&&t<=47;if(!(n||r))return!1;let s;const o={};e===16||e===24?(s=Math.floor((t-32)/2),o.background=$ge[s],t%2===1&&(o.background=o.background+"_semi")):t===45?o.background="transparent":(o.foreground="black",t===47&&(o.underline=!0));const a=e<=23?1:2;return this.channels[a].setBkgData(o),!0}reset(){for(let e=0;e<Object.keys(this.channels).length;e++){const t=this.channels[e];t&&t.reset()}t_(null,null,this.cmdHistory)}cueSplitAtTime(e){for(let t=0;t<this.channels.length;t++){const n=this.channels[t];n&&n.cueSplitAtTime(e)}}}function t_(i,e,t){t.a=i,t.b=e}function Jge(i,e,t){return t.a===i&&t.b===e}function Zge(){return{a:null,b:null}}var qR=(function(){if(KS!=null&&KS.VTTCue)return self.VTTCue;const i=["","lr","rl"],e=["start","middle","end","left","right"];function t(a,l){if(typeof l!="string"||!Array.isArray(a))return!1;const c=l.toLowerCase();return~a.indexOf(c)?c:!1}function n(a){return t(i,a)}function r(a){return t(e,a)}function s(a,...l){let c=1;for(;c<arguments.length;c++){const u=arguments[c];for(const h in u)a[h]=u[h]}return a}function o(a,l,c){const u=this,h={enumerable:!0};u.hasBeenReset=!1;let f="",d=!1,m=a,A=l,g=c,y=null,E="",x=!0,C="auto",T="start",I=50,M="middle",L=50,R="middle";Object.defineProperty(u,"id",s({},h,{get:function(){return f},set:function(P){f=""+P}})),Object.defineProperty(u,"pauseOnExit",s({},h,{get:function(){return d},set:function(P){d=!!P}})),Object.defineProperty(u,"startTime",s({},h,{get:function(){return m},set:function(P){if(typeof P!="number")throw new TypeError("Start time must be set to a number.");m=P,this.hasBeenReset=!0}})),Object.defineProperty(u,"endTime",s({},h,{get:function(){return A},set:function(P){if(typeof P!="number")throw new TypeError("End time must be set to a number.");A=P,this.hasBeenReset=!0}})),Object.defineProperty(u,"text",s({},h,{get:function(){return g},set:function(P){g=""+P,this.hasBeenReset=!0}})),Object.defineProperty(u,"region",s({},h,{get:function(){return y},set:function(P){y=P,this.hasBeenReset=!0}})),Object.defineProperty(u,"vertical",s({},h,{get:function(){return E},set:function(P){const F=n(P);if(F===!1)throw new SyntaxError("An invalid or illegal string was specified.");E=F,this.hasBeenReset=!0}})),Object.defineProperty(u,"snapToLines",s({},h,{get:function(){return x},set:function(P){x=!!P,this.hasBeenReset=!0}})),Object.defineProperty(u,"line",s({},h,{get:function(){return C},set:function(P){if(typeof P!="number"&&P!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");C=P,this.hasBeenReset=!0}})),Object.defineProperty(u,"lineAlign",s({},h,{get:function(){return T},set:function(P){const F=r(P);if(!F)throw new SyntaxError("An invalid or illegal string was specified.");T=F,this.hasBeenReset=!0}})),Object.defineProperty(u,"position",s({},h,{get:function(){return I},set:function(P){if(P<0||P>100)throw new Error("Position must be between 0 and 100.");I=P,this.hasBeenReset=!0}})),Object.defineProperty(u,"positionAlign",s({},h,{get:function(){return M},set:function(P){const F=r(P);if(!F)throw new SyntaxError("An invalid or illegal string was specified.");M=F,this.hasBeenReset=!0}})),Object.defineProperty(u,"size",s({},h,{get:function(){return L},set:function(P){if(P<0||P>100)throw new Error("Size must be between 0 and 100.");L=P,this.hasBeenReset=!0}})),Object.defineProperty(u,"align",s({},h,{get:function(){return R},set:function(P){const F=r(P);if(!F)throw new SyntaxError("An invalid or illegal string was specified.");R=F,this.hasBeenReset=!0}})),u.displayState=void 0}return o.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},o})();class e1e{decode(e,t){if(!e)return"";if(typeof e!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}function XV(i){function e(n,r,s,o){return(n|0)*3600+(r|0)*60+(s|0)+parseFloat(o||0)}const t=i.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return t?parseFloat(t[2])>59?e(t[2],t[3],0,t[4]):e(t[1],t[2],t[3],t[4]):null}class t1e{constructor(){this.values=Object.create(null)}set(e,t){!this.get(e)&&t!==""&&(this.values[e]=t)}get(e,t,n){return n?this.has(e)?this.values[e]:t[n]:this.has(e)?this.values[e]:t}has(e){return e in this.values}alt(e,t,n){for(let r=0;r<n.length;++r)if(t===n[r]){this.set(e,t);break}}integer(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))}percent(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){const n=parseFloat(t);if(n>=0&&n<=100)return this.set(e,n),!0}return!1}}function qV(i,e,t,n){const r=n?i.split(n):[i];for(const s in r){if(typeof r[s]!="string")continue;const o=r[s].split(t);if(o.length!==2)continue;const a=o[0],l=o[1];e(a,l)}}const M5=new qR(0,0,""),n_=M5.align==="middle"?"middle":"center";function n1e(i,e,t){const n=i;function r(){const a=XV(i);if(a===null)throw new Error("Malformed timestamp: "+n);return i=i.replace(/^[^\sa-zA-Z-]+/,""),a}function s(a,l){const c=new t1e;qV(a,function(f,d){let m;switch(f){case"region":for(let A=t.length-1;A>=0;A--)if(t[A].id===d){c.set(f,t[A].region);break}break;case"vertical":c.alt(f,d,["rl","lr"]);break;case"line":m=d.split(","),c.integer(f,m[0]),c.percent(f,m[0])&&c.set("snapToLines",!1),c.alt(f,m[0],["auto"]),m.length===2&&c.alt("lineAlign",m[1],["start",n_,"end"]);break;case"position":m=d.split(","),c.percent(f,m[0]),m.length===2&&c.alt("positionAlign",m[1],["start",n_,"end","line-left","line-right","auto"]);break;case"size":c.percent(f,d);break;case"align":c.alt(f,d,["start",n_,"end","left","right"]);break}},/:/,/\s/),l.region=c.get("region",null),l.vertical=c.get("vertical","");let u=c.get("line","auto");u==="auto"&&M5.line===-1&&(u=-1),l.line=u,l.lineAlign=c.get("lineAlign","start"),l.snapToLines=c.get("snapToLines",!0),l.size=c.get("size",100),l.align=c.get("align",n_);let h=c.get("position","auto");h==="auto"&&M5.position===50&&(h=l.align==="start"||l.align==="left"?0:l.align==="end"||l.align==="right"?100:50),l.position=h}function o(){i=i.replace(/^\s+/,"")}if(o(),e.startTime=r(),o(),i.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+n);i=i.slice(3),o(),e.endTime=r(),o(),s(i,e)}function JV(i){return i.replace(/<br(?: \/)?>/gi,`
`)}class i1e{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new e1e,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(e){const t=this;e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));function n(){let s=t.buffer,o=0;for(s=JV(s);o<s.length&&s[o]!=="\r"&&s[o]!==`
`;)++o;const a=s.slice(0,o);return s[o]==="\r"&&++o,s[o]===`
`&&++o,t.buffer=s.slice(o),a}function r(s){qV(s,function(o,a){},/:/)}try{let s="";if(t.state==="INITIAL"){if(!/\r\n|\n/.test(t.buffer))return this;s=n();const a=s.match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(!(a!=null&&a[0]))throw new Error("Malformed WebVTT signature.");t.state="HEADER"}let o=!1;for(;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(o?o=!1:s=n(),t.state){case"HEADER":/:/.test(s)?r(s):s||(t.state="ID");continue;case"NOTE":s||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(s)){t.state="NOTE";break}if(!s)continue;if(t.cue=new qR(0,0,""),t.state="CUE",s.indexOf("-->")===-1){t.cue.id=s;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{n1e(s,t.cue,t.regionList)}catch{t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":{const a=s.indexOf("-->")!==-1;if(!s||a&&(o=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(t.cue===null)continue;t.cue.text&&(t.cue.text+=`
`),t.cue.text+=s}continue;case"BADCUE":s||(t.state="ID")}}}catch{t.state==="CUETEXT"&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state=t.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this}flush(){const e=this;try{if((e.cue||e.state==="HEADER")&&(e.buffer+=`

`,e.parse()),e.state==="INITIAL"||e.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(t){e.onparsingerror&&e.onparsingerror(t)}return e.onflush&&e.onflush(),this}}const r1e=/\r\n|\n\r|\n|\r/g,jb=function(e,t,n=0){return e.slice(n,n+t.length)===t},s1e=function(e){let t=parseInt(e.slice(-3));const n=parseInt(e.slice(-6,-4)),r=parseInt(e.slice(-9,-7)),s=e.length>9?parseInt(e.substring(0,e.indexOf(":"))):0;if(!Wt(t)||!Wt(n)||!Wt(r)||!Wt(s))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${e}`);return t+=1e3*n,t+=60*1e3*r,t+=3600*1e3*s,t};function JR(i,e,t){return c2(i.toString())+c2(e.toString())+c2(t)}const o1e=function(e,t,n){let r=e[t],s=e[r.prevCC];if(!s||!s.new&&r.new){e.ccOffset=e.presentationOffset=r.start,r.new=!1;return}for(;(o=s)!=null&&o.new;){var o;e.ccOffset+=r.start-s.start,r.new=!1,r=s,s=e[r.prevCC]}e.presentationOffset=n};function a1e(i,e,t,n,r,s,o){const a=new i1e,l=Pl(new Uint8Array(i)).trim().replace(r1e,`
`).split(`
`),c=[],u=e?E0e(e.baseTime,e.timescale):0;let h="00:00.000",f=0,d=0,m,A=!0;a.oncue=function(g){const y=t[n];let E=t.ccOffset;const x=(f-u)/9e4;if(y!=null&&y.new&&(d!==void 0?E=t.ccOffset=y.start:o1e(t,n,x)),x){if(!e){m=new Error("Missing initPTS for VTT MPEGTS");return}E=x-t.presentationOffset}const C=g.endTime-g.startTime,T=Cl((g.startTime+E-d)*9e4,r*9e4)/9e4;g.startTime=Math.max(T,0),g.endTime=Math.max(T+C,0);const I=g.text.trim();g.text=decodeURIComponent(encodeURIComponent(I)),g.id||(g.id=JR(g.startTime,g.endTime,I)),g.endTime>0&&c.push(g)},a.onparsingerror=function(g){m=g},a.onflush=function(){if(m){o(m);return}s(c)},l.forEach(g=>{if(A)if(jb(g,"X-TIMESTAMP-MAP=")){A=!1,g.slice(16).split(",").forEach(y=>{jb(y,"LOCAL:")?h=y.slice(6):jb(y,"MPEGTS:")&&(f=parseInt(y.slice(7)))});try{d=s1e(h)/1e3}catch(y){m=y}return}else g===""&&(A=!1);a.parse(g+`
`)}),a.flush()}const Kb="stpp.ttml.im1t",ZV=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,eW=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,l1e={left:"start",center:"center",right:"end",start:"start",end:"end"};function Bk(i,e,t,n){const r=si(new Uint8Array(i),["mdat"]);if(r.length===0){n(new Error("Could not parse IMSC1 mdat"));return}const s=r.map(a=>Pl(a)),o=x0e(e.baseTime,1,e.timescale);try{s.forEach(a=>t(c1e(a,o)))}catch(a){n(a)}}function c1e(i,e){const r=new DOMParser().parseFromString(i,"text/xml").getElementsByTagName("tt")[0];if(!r)throw new Error("Invalid ttml");const s={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},o=Object.keys(s).reduce((h,f)=>(h[f]=r.getAttribute(`ttp:${f}`)||s[f],h),{}),a=r.getAttribute("xml:space")!=="preserve",l=Dk($b(r,"styling","style")),c=Dk($b(r,"layout","region")),u=$b(r,"body","[begin]");return[].map.call(u,h=>{const f=tW(h,a);if(!f||!h.hasAttribute("begin"))return null;const d=Xb(h.getAttribute("begin"),o),m=Xb(h.getAttribute("dur"),o);let A=Xb(h.getAttribute("end"),o);if(d===null)throw kk(h);if(A===null){if(m===null)throw kk(h);A=d+m}const g=new qR(d-e,A-e,f);g.id=JR(g.startTime,g.endTime,g.text);const y=c[h.getAttribute("region")],E=l[h.getAttribute("style")],x=u1e(y,E,l),{textAlign:C}=x;if(C){const T=l1e[C];T&&(g.lineAlign=T),g.align=C}return er(g,x),g}).filter(h=>h!==null)}function $b(i,e,t){const n=i.getElementsByTagName(e)[0];return n?[].slice.call(n.querySelectorAll(t)):[]}function Dk(i){return i.reduce((e,t)=>{const n=t.getAttribute("xml:id");return n&&(e[n]=t),e},{})}function tW(i,e){return[].slice.call(i.childNodes).reduce((t,n,r)=>{var s;return n.nodeName==="br"&&r?t+`
`:(s=n.childNodes)!=null&&s.length?tW(n,e):e?t+n.textContent.trim().replace(/\s+/g," "):t+n.textContent},"")}function u1e(i,e,t){const n="http://www.w3.org/ns/ttml#styling";let r=null;const s=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],o=i!=null&&i.hasAttribute("style")?i.getAttribute("style"):null;return o&&t.hasOwnProperty(o)&&(r=t[o]),s.reduce((a,l)=>{const c=Yb(e,n,l)||Yb(i,n,l)||Yb(r,n,l);return c&&(a[l]=c),a},{})}function Yb(i,e,t){return i&&i.hasAttributeNS(e,t)?i.getAttributeNS(e,t):null}function kk(i){return new Error(`Could not parse ttml timestamp ${i}`)}function Xb(i,e){if(!i)return null;let t=XV(i);return t===null&&(ZV.test(i)?t=h1e(i,e):eW.test(i)&&(t=f1e(i,e))),t}function h1e(i,e){const t=ZV.exec(i),n=(t[4]|0)+(t[5]|0)/e.subFrameRate;return(t[1]|0)*3600+(t[2]|0)*60+(t[3]|0)+n/e.frameRate}function f1e(i,e){const t=eW.exec(i),n=Number(t[1]);switch(t[2]){case"h":return n*3600;case"m":return n*60;case"ms":return n*1e3;case"f":return n/e.frameRate;case"t":return n/e.tickRate}return n}class i_{constructor(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}dispatchCue(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(e,t,n){(this.startTime===null||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=n,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}class nW{constructor(e){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=Ok(),this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},e.on(ae.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(ae.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(ae.MANIFEST_LOADING,this.onManifestLoading,this),e.on(ae.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(ae.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(ae.FRAG_LOADING,this.onFragLoading,this),e.on(ae.FRAG_LOADED,this.onFragLoaded,this),e.on(ae.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(ae.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(ae.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(ae.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(ae.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:e}=this;e.off(ae.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(ae.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(ae.MANIFEST_LOADING,this.onManifestLoading,this),e.off(ae.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(ae.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(ae.FRAG_LOADING,this.onFragLoading,this),e.off(ae.FRAG_LOADED,this.onFragLoaded,this),e.off(ae.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(ae.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(ae.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(ae.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(ae.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.media=null,this.cea608Parser1=this.cea608Parser2=void 0}initCea608Parsers(){const e=new i_(this,"textTrack1"),t=new i_(this,"textTrack2"),n=new i_(this,"textTrack3"),r=new i_(this,"textTrack4");this.cea608Parser1=new Pk(1,e,t),this.cea608Parser2=new Pk(3,n,r)}addCues(e,t,n,r,s){let o=!1;for(let a=s.length;a--;){const l=s[a],c=d1e(l[0],l[1],t,n);if(c>=0&&(l[0]=Math.min(l[0],t),l[1]=Math.max(l[1],n),o=!0,c/(n-t)>.5))return}if(o||s.push([t,n]),this.config.renderTextTracksNatively){const a=this.captionsTracks[e];this.Cues.newCue(a,t,n,r)}else{const a=this.Cues.newCue(null,t,n,r);this.hls.trigger(ae.CUES_PARSED,{type:"captions",cues:a,track:e})}}onInitPtsFound(e,{frag:t,id:n,initPTS:r,timescale:s,trackId:o}){const{unparsedVttFrags:a}=this;n===Yt.MAIN&&(this.initPTS[t.cc]={baseTime:r,timescale:s,trackId:o}),a.length&&(this.unparsedVttFrags=[],a.forEach(l=>{this.initPTS[l.frag.cc]?this.onFragLoaded(ae.FRAG_LOADED,l):this.hls.trigger(ae.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:l.frag,error:new Error("Subtitle discontinuity domain does not match main")})}))}getExistingTrack(e,t){const{media:n}=this;if(n)for(let r=0;r<n.textTracks.length;r++){const s=n.textTracks[r];if(Fk(s,{name:e,lang:t,characteristics:"transcribes-spoken-dialog,describes-music-and-sound"}))return s}return null}createCaptionsTrack(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)}createNativeTrack(e){if(this.captionsTracks[e])return;const{captionsProperties:t,captionsTracks:n,media:r}=this,{label:s,languageCode:o}=t[e],a=this.getExistingTrack(s,o);if(a)n[e]=a,P1(n[e]),QV(n[e],r);else{const l=this.createTextTrack("captions",s,o);l&&(l[e]=!0,n[e]=l)}}createNonNativeTrack(e){if(this.nonNativeCaptionsTracks[e])return;const t=this.captionsProperties[e];if(!t)return;const n=t.label,r={_id:e,label:n,kind:"captions",default:t.media?!!t.media.default:!1,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=r,this.hls.trigger(ae.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[r]})}createTextTrack(e,t,n){const r=this.media;if(r)return r.addTextTrack(e,t,n)}onMediaAttaching(e,t){this.media=t.media,t.mediaSource||this._cleanTracks()}onMediaDetaching(e,t){const n=!!t.transferMedia;if(this.media=null,n)return;const{captionsTracks:r}=this;Object.keys(r).forEach(s=>{P1(r[s]),delete r[s]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=Ok(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:e}=this;if(!e)return;const t=e.textTracks;if(t)for(let n=0;n<t.length;n++)P1(t[n])}onSubtitleTracksUpdated(e,t){const n=t.subtitleTracks||[],r=n.some(s=>s.textCodec===Kb);if(this.config.enableWebVTT||r&&this.config.enableIMSC1){if(CV(this.tracks,n)){this.tracks=n;return}if(this.textTracks=[],this.tracks=n,this.config.renderTextTracksNatively){const o=this.media,a=o?rS(o.textTracks):null;if(this.tracks.forEach((l,c)=>{let u;if(a){let h=null;for(let f=0;f<a.length;f++)if(a[f]&&Fk(a[f],l)){h=a[f],a[f]=null;break}h&&(u=h)}if(u)P1(u);else{const h=iW(l);u=this.createTextTrack(h,l.name,l.lang),u&&(u.mode="disabled")}u&&this.textTracks.push(u)}),a!=null&&a.length){const l=a.filter(c=>c!==null).map(c=>c.label);l.length&&this.hls.logger.warn(`Media element contains unused subtitle tracks: ${l.join(", ")}. Replace media element for each source to clear TextTracks and captions menu.`)}}else if(this.tracks.length){const o=this.tracks.map(a=>({label:a.name,kind:a.type.toLowerCase(),default:a.default,subtitleTrack:a}));this.hls.trigger(ae.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:o})}}}onManifestLoaded(e,t){this.config.enableCEA708Captions&&t.captions&&t.captions.forEach(n=>{const r=/(?:CC|SERVICE)([1-4])/.exec(n.instreamId);if(!r)return;const s=`textTrack${r[1]}`,o=this.captionsProperties[s];o&&(o.label=n.name,n.lang&&(o.languageCode=n.lang),o.media=n)})}closedCaptionsForLevel(e){const t=this.hls.levels[e.level];return t==null?void 0:t.attrs["CLOSED-CAPTIONS"]}onFragLoading(e,t){if(this.enabled&&t.frag.type===Yt.MAIN){var n,r;const{cea608Parser1:s,cea608Parser2:o,lastSn:a}=this,{cc:l,sn:c}=t.frag,u=(n=(r=t.part)==null?void 0:r.index)!=null?n:-1;s&&o&&(c!==a+1||c===a&&u!==this.lastPartIndex+1||l!==this.lastCc)&&(s.reset(),o.reset()),this.lastCc=l,this.lastSn=c,this.lastPartIndex=u}}onFragLoaded(e,t){const{frag:n,payload:r}=t;if(n.type===Yt.SUBTITLE)if(r.byteLength){const s=n.decryptdata,o="stats"in t;if(s==null||!s.encrypted||o){const a=this.tracks[n.level],l=this.vttCCs;l[n.cc]||(l[n.cc]={start:n.start,prevCC:this.prevCC,new:!0},this.prevCC=n.cc),a&&a.textCodec===Kb?this._parseIMSC1(n,r):this._parseVTTs(t)}}else this.hls.trigger(ae.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:n,error:new Error("Empty subtitle payload")})}_parseIMSC1(e,t){const n=this.hls;Bk(t,this.initPTS[e.cc],r=>{this._appendCues(r,e.level),n.trigger(ae.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},r=>{n.logger.log(`Failed to parse IMSC1: ${r}`),n.trigger(ae.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:r})})}_parseVTTs(e){var t;const{frag:n,payload:r}=e,{initPTS:s,unparsedVttFrags:o}=this,a=s.length-1;if(!s[n.cc]&&a===-1){o.push(e);return}const l=this.hls,c=(t=n.initSegment)!=null&&t.data?Ac(n.initSegment.data,new Uint8Array(r)).buffer:r;a1e(c,this.initPTS[n.cc],this.vttCCs,n.cc,n.start,u=>{this._appendCues(u,n.level),l.trigger(ae.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:n})},u=>{const h=u.message==="Missing initPTS for VTT MPEGTS";h?o.push(e):this._fallbackToIMSC1(n,r),l.logger.log(`Failed to parse VTT cue: ${u}`),!(h&&a>n.cc)&&l.trigger(ae.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:n,error:u})})}_fallbackToIMSC1(e,t){const n=this.tracks[e.level];n.textCodec||Bk(t,this.initPTS[e.cc],()=>{n.textCodec=Kb,this._parseIMSC1(e,t)},()=>{n.textCodec="wvtt"})}_appendCues(e,t){const n=this.hls;if(this.config.renderTextTracksNatively){const r=this.textTracks[t];if(!r||r.mode==="disabled")return;e.forEach(s=>VV(r,s))}else{const r=this.tracks[t];if(!r)return;const s=r.default?"default":"subtitles"+t;n.trigger(ae.CUES_PARSED,{type:"subtitles",cues:e,track:s})}}onFragDecrypted(e,t){const{frag:n}=t;n.type===Yt.SUBTITLE&&this.onFragLoaded(ae.FRAG_LOADED,t)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(e,t){if(!this.enabled||!this.config.enableCEA708Captions)return;const{frag:n,samples:r}=t;if(!(n.type===Yt.MAIN&&this.closedCaptionsForLevel(n)==="NONE"))for(let s=0;s<r.length;s++){const o=r[s].bytes;if(o){this.cea608Parser1||this.initCea608Parsers();const a=this.extractCea608Data(o);this.cea608Parser1.addData(r[s].pts,a[0]),this.cea608Parser2.addData(r[s].pts,a[1])}}}onBufferFlushing(e,{startOffset:t,endOffset:n,endOffsetSubtitles:r,type:s}){const{media:o}=this;if(!(!o||o.currentTime<n)){if(!s||s==="video"){const{captionsTracks:a}=this;Object.keys(a).forEach(l=>I5(a[l],t,n))}if(this.config.renderTextTracksNatively&&t===0&&r!==void 0){const{textTracks:a}=this;Object.keys(a).forEach(l=>I5(a[l],t,r))}}}extractCea608Data(e){const t=[[],[]],n=e[0]&31;let r=2;for(let s=0;s<n;s++){const o=e[r++],a=127&e[r++],l=127&e[r++];if(a===0&&l===0)continue;if((4&o)!==0){const u=3&o;(u===0||u===1)&&(t[u].push(a),t[u].push(l))}}return t}}function iW(i){return i.characteristics&&/transcribes-spoken-dialog/gi.test(i.characteristics)&&/describes-music-and-sound/gi.test(i.characteristics)?"captions":"subtitles"}function Fk(i,e){return!!i&&i.kind===iW(e)&&w5(e,i)}function d1e(i,e,t,n){return Math.min(e,n)-Math.max(i,t)}function Ok(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}const p1e=/\s/,rW={newCue(i,e,t,n){const r=[];let s,o,a,l,c;const u=self.VTTCue||self.TextTrackCue;for(let f=0;f<n.rows.length;f++)if(s=n.rows[f],a=!0,l=0,c="",!s.isEmpty()){var h;for(let A=0;A<s.chars.length;A++)p1e.test(s.chars[A].uchar)&&a?l++:(c+=s.chars[A].uchar,a=!1);s.cueStartTime=e,e===t&&(t+=1e-4),l>=16?l--:l++;const d=JV(c.trim()),m=JR(e,t,d);i!=null&&(h=i.cues)!=null&&h.getCueById(m)||(o=new u(e,t,d),o.id=m,o.line=f+1,o.align="left",o.position=10+Math.min(80,Math.floor(l*8/32)*10),r.push(o))}return i&&r.length&&(r.sort((f,d)=>f.line==="auto"||d.line==="auto"?0:f.line>8&&d.line>8?d.line-f.line:f.line-d.line),r.forEach(f=>VV(i,f))),r}};function sW(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}const m1e=/(\d+)-(\d+)\/(\d+)/;class R5{constructor(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||v1e,this.controller=new self.AbortController,this.stats=new m4}destroy(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null}abortInternal(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(e,t,n){const r=this.stats;if(r.loading.start)throw new Error("Loader can only be used once.");r.loading.start=self.performance.now();const s=g1e(e,this.controller.signal),o=e.responseType==="arraybuffer",a=o?"byteLength":"length",{maxTimeToFirstByteMs:l,maxLoadTimeMs:c}=t.loadPolicy;this.context=e,this.config=t,this.callbacks=n,this.request=this.fetchSetup(e,s),self.clearTimeout(this.requestTimeout),t.timeout=l&&Wt(l)?l:c,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(r,e,this.response))},t.timeout),(j2(this.request)?this.request.then(self.fetch):self.fetch(this.request)).then(h=>{var f;this.response=this.loader=h;const d=Math.max(self.performance.now(),r.loading.start);if(self.clearTimeout(this.requestTimeout),t.timeout=c,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(r,e,this.response))},c-(d-r.loading.start)),!h.ok){const{status:A,statusText:g}=h;throw new x1e(g||"fetch, bad network response",A,h)}r.loading.first=d,r.total=y1e(h.headers)||r.total;const m=(f=this.callbacks)==null?void 0:f.onProgress;return m&&Wt(t.highWaterMark)?this.loadProgressively(h,r,e,t.highWaterMark,m):o?h.arrayBuffer():e.responseType==="json"?h.json():h.text()}).then(h=>{var f,d;const m=this.response;if(!m)throw new Error("loader destroyed");self.clearTimeout(this.requestTimeout),r.loading.end=Math.max(self.performance.now(),r.loading.first);const A=h[a];A&&(r.loaded=r.total=A);const g={url:m.url,data:h,code:m.status},y=(f=this.callbacks)==null?void 0:f.onProgress;y&&!Wt(t.highWaterMark)&&y(r,e,h,m),(d=this.callbacks)==null||d.onSuccess(g,r,e,m)}).catch(h=>{var f;if(self.clearTimeout(this.requestTimeout),r.aborted)return;const d=h&&h.code||0,m=h?h.message:null;(f=this.callbacks)==null||f.onError({code:d,text:m},e,h?h.details:null,r)})}getCacheAge(){let e=null;if(this.response){const t=this.response.headers.get("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.response?this.response.headers.get(e):null}loadProgressively(e,t,n,r=0,s){const o=new rV,a=e.body.getReader(),l=()=>a.read().then(c=>{if(c.done)return o.dataLength&&s(t,n,o.flush().buffer,e),Promise.resolve(new ArrayBuffer(0));const u=c.value,h=u.length;return t.loaded+=h,h<r||o.dataLength?(o.push(u),o.dataLength>=r&&s(t,n,o.flush().buffer,e)):s(t,n,u.buffer,e),l()}).catch(()=>Promise.reject());return l()}}function g1e(i,e){const t={method:"GET",mode:"cors",credentials:"same-origin",signal:e,headers:new self.Headers(er({},i.headers))};return i.rangeEnd&&t.headers.set("Range","bytes="+i.rangeStart+"-"+String(i.rangeEnd-1)),t}function A1e(i){const e=m1e.exec(i);if(e)return parseInt(e[2])-parseInt(e[1])+1}function y1e(i){const e=i.get("Content-Range");if(e){const n=A1e(e);if(Wt(n))return n}const t=i.get("Content-Length");if(t)return parseInt(t)}function v1e(i,e){return new self.Request(i.url,e)}class x1e extends Error{constructor(e,t,n){super(e),this.code=void 0,this.details=void 0,this.code=t,this.details=n}}const E1e=/^age:\s*[\d.]+\s*$/im;class ZR{constructor(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new m4,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null}abortInternal(){const e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,e.readyState!==4&&(this.stats.aborted=!0,e.abort()))}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(e,t,n){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=n,this.loadInternal()}loadInternal(){const{config:e,context:t}=this;if(!e||!t)return;const n=this.loader=new self.XMLHttpRequest,r=this.stats;r.loading.first=0,r.loaded=0,r.aborted=!1;const s=this.xhrSetup;s?Promise.resolve().then(()=>{if(!(this.loader!==n||this.stats.aborted))return s(n,t.url)}).catch(o=>{if(!(this.loader!==n||this.stats.aborted))return n.open("GET",t.url,!0),s(n,t.url)}).then(()=>{this.loader!==n||this.stats.aborted||this.openAndSendXhr(n,t,e)}).catch(o=>{var a;(a=this.callbacks)==null||a.onError({code:n.status,text:o.message},t,n,r)}):this.openAndSendXhr(n,t,e)}openAndSendXhr(e,t,n){e.readyState||e.open("GET",t.url,!0);const r=t.headers,{maxTimeToFirstByteMs:s,maxLoadTimeMs:o}=n.loadPolicy;if(r)for(const a in r)e.setRequestHeader(a,r[a]);t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,self.clearTimeout(this.requestTimeout),n.timeout=s&&Wt(s)?s:o,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),n.timeout),e.send()}readystatechange(){const{context:e,loader:t,stats:n}=this;if(!e||!t)return;const r=t.readyState,s=this.config;if(!n.aborted&&r>=2&&(n.loading.first===0&&(n.loading.first=Math.max(self.performance.now(),n.loading.start),s.timeout!==s.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),s.timeout=s.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),s.loadPolicy.maxLoadTimeMs-(n.loading.first-n.loading.start)))),r===4)){self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;const c=t.status,u=t.responseType==="text"?t.responseText:null;if(c>=200&&c<300){const m=u??t.response;if(m!=null){var o,a;n.loading.end=Math.max(self.performance.now(),n.loading.first);const A=t.responseType==="arraybuffer"?m.byteLength:m.length;n.loaded=n.total=A,n.bwEstimate=n.total*8e3/(n.loading.end-n.loading.first);const g=(o=this.callbacks)==null?void 0:o.onProgress;g&&g(n,e,m,t);const y={url:t.responseURL,data:m,code:c};(a=this.callbacks)==null||a.onSuccess(y,n,e,t);return}}const h=s.loadPolicy.errorRetry,f=n.retry,d={url:e.url,data:void 0,code:c};if(WS(h,f,!1,d))this.retry(h);else{var l;Ki.error(`${c} while loading ${e.url}`),(l=this.callbacks)==null||l.onError({code:c,text:t.statusText},e,t,n)}}}loadtimeout(){if(!this.config)return;const e=this.config.loadPolicy.timeoutRetry,t=this.stats.retry;if(WS(e,t,!0))this.retry(e);else{var n;Ki.warn(`timeout while loading ${(n=this.context)==null?void 0:n.url}`);const r=this.callbacks;r&&(this.abortInternal(),r.onTimeout(this.stats,this.context,this.loader))}}retry(e){const{context:t,stats:n}=this;this.retryDelay=FR(e,n.retry),n.retry++,Ki.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${t==null?void 0:t.url}, retrying ${n.retry}/${e.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(e){const t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)}getCacheAge(){let e=null;if(this.loader&&E1e.test(this.loader.getAllResponseHeaders())){const t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.loader&&new RegExp(`^${e}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null}}const _1e={maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null},S1e=Qi(Qi({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,maxDevicePixelRatio:Number.POSITIVE_INFINITY,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,startOnSegmentBoundary:!1,maxBufferSize:60*1e3*1e3,maxFragLookUpTolerance:.25,maxBufferHole:.1,detectStallWithCurrentTimeMs:1250,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,nudgeOnVideoHole:!0,liveSyncMode:"edge",liveSyncDurationCount:3,liveSyncOnStallIncrease:1,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,ignorePlaylistParsingErrors:!1,loader:ZR,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:OQ,bufferController:IV,capLevelController:E4,errorController:HQ,fpsController:HV,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:GR,requireKeySystemAccessOnStart:!1,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableEmsgKLVMetadata:!1,enableID3MetadataCues:!0,enableInterstitialPlayback:!0,interstitialAppendInPlace:!0,interstitialLiveLookAhead:10,useMediaCapabilities:!0,preserveManualLevelOnError:!1,certLoadPolicy:{default:_1e},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},interstitialAssetListLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:3e4,timeoutRetry:{maxNumRetry:0,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:0,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},w1e()),{},{subtitleStreamController:KV,subtitleTrackController:WV,timelineController:nW,audioStreamController:wV,audioTrackController:TV,emeController:Wm,cmcdController:UV,contentSteeringController:zV,interstitialsController:Gge});function w1e(){return{cueHandler:rW,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function C1e(i,e,t){if((e.liveSyncDurationCount||e.liveMaxLatencyDurationCount)&&(e.liveSyncDuration||e.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(e.liveMaxLatencyDurationCount!==void 0&&(e.liveSyncDurationCount===void 0||e.liveMaxLatencyDurationCount<=e.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(e.liveMaxLatencyDuration!==void 0&&(e.liveSyncDuration===void 0||e.liveMaxLatencyDuration<=e.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const n=L5(i),r=["manifest","level","frag"],s=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return r.forEach(o=>{const a=`${o==="level"?"playlist":o}LoadPolicy`,l=e[a]===void 0,c=[];s.forEach(u=>{const h=`${o}Loading${u}`,f=e[h];if(f!==void 0&&l){c.push(h);const d=n[a].default;switch(e[a]={default:d},u){case"TimeOut":d.maxLoadTimeMs=f,d.maxTimeToFirstByteMs=f;break;case"MaxRetry":d.errorRetry.maxNumRetry=f,d.timeoutRetry.maxNumRetry=f;break;case"RetryDelay":d.errorRetry.retryDelayMs=f,d.timeoutRetry.retryDelayMs=f;break;case"MaxRetryTimeout":d.errorRetry.maxRetryDelayMs=f,d.timeoutRetry.maxRetryDelayMs=f;break}}}),c.length&&t.warn(`hls.js config: "${c.join('", "')}" setting(s) are deprecated, use "${a}": ${lr(e[a])}`)}),Qi(Qi({},n),e)}function L5(i){return i&&typeof i=="object"?Array.isArray(i)?i.map(L5):Object.keys(i).reduce((e,t)=>(e[t]=L5(i[t]),e),{}):i}function T1e(i,e){const t=i.loader;t!==R5&&t!==ZR?(e.log("[config]: Custom loader detected, cannot enable progressive streaming"),i.progressive=!1):sW()&&(i.loader=R5,i.progressive=!0,i.enableSoftwareAES=!0,e.log("[config]: Progressive streaming enabled, using FetchLoader"))}const sS=2,b1e=.1,I1e=.05,M1e=100;class R1e extends QQ{constructor(e,t){super("gap-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.media=null,this.mediaSource=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.buffered={},this.lastCurrentTime=0,this.ended=0,this.waiting=0,this.onMediaPlaying=()=>{this.ended=0,this.waiting=0},this.onMediaWaiting=()=>{var n;(n=this.media)!=null&&n.seeking||(this.waiting=self.performance.now(),this.tick())},this.onMediaEnded=()=>{if(this.hls){var n;this.ended=((n=this.media)==null?void 0:n.currentTime)||1,this.hls.trigger(ae.MEDIA_ENDED,{stalled:!1})}},this.hls=e,this.fragmentTracker=t,this.registerListeners()}registerListeners(){const{hls:e}=this;e&&(e.on(ae.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(ae.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(ae.BUFFER_APPENDED,this.onBufferAppended,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(ae.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(ae.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(ae.BUFFER_APPENDED,this.onBufferAppended,this))}destroy(){super.destroy(),this.unregisterListeners(),this.media=this.hls=this.fragmentTracker=null,this.mediaSource=void 0}onMediaAttached(e,t){this.setInterval(M1e),this.mediaSource=t.mediaSource;const n=this.media=t.media;_a(n,"playing",this.onMediaPlaying),_a(n,"waiting",this.onMediaWaiting),_a(n,"ended",this.onMediaEnded)}onMediaDetaching(e,t){this.clearInterval();const{media:n}=this;n&&(Za(n,"playing",this.onMediaPlaying),Za(n,"waiting",this.onMediaWaiting),Za(n,"ended",this.onMediaEnded),this.media=null),this.mediaSource=void 0}onBufferAppended(e,t){this.buffered=t.timeRanges}get hasBuffered(){return Object.keys(this.buffered).length>0}tick(){var e;if(!((e=this.media)!=null&&e.readyState)||!this.hasBuffered)return;const t=this.media.currentTime;this.poll(t,this.lastCurrentTime),this.lastCurrentTime=t}poll(e,t){var n,r;const s=(n=this.hls)==null?void 0:n.config;if(!s)return;const o=this.media;if(!o)return;const{seeking:a}=o,l=this.seeking&&!a,c=!this.seeking&&a,u=o.paused&&!a||o.ended||o.playbackRate===0;if(this.seeking=a,e!==t){t&&(this.ended=0),this.moved=!0,a||(this.nudgeRetry=0,s.nudgeOnVideoHole&&!u&&e>t&&this.nudgeOnVideoHole(e,t)),this.waiting===0&&this.stallResolved(e);return}if(c||l){l&&this.stallResolved(e);return}if(u){this.nudgeRetry=0,this.stallResolved(e),!this.ended&&o.ended&&this.hls&&(this.ended=e||1,this.hls.trigger(ae.MEDIA_ENDED,{stalled:!1}));return}if(!jn.getBuffered(o).length){this.nudgeRetry=0;return}const h=jn.bufferInfo(o,e,0),f=h.nextStart||0,d=this.fragmentTracker;if(a&&d&&this.hls){const I=Nk(this.hls.inFlightFragments,e),M=h.len>sS,L=!f||I||f-e>sS&&!d.getPartialFragment(e);if(M||L)return;this.moved=!1}const m=(r=this.hls)==null?void 0:r.latestLevelDetails;if(!this.moved&&this.stalled!==null&&d){if(!(h.len>0)&&!f)return;const M=Math.max(f,h.start||0)-e,R=!!(m!=null&&m.live)?m.targetduration*2:sS,P=r_(e,d);if(M>0&&(M<=R||P)){o.paused||this._trySkipBufferHole(P);return}}const A=s.detectStallWithCurrentTimeMs,g=self.performance.now(),y=this.waiting;let E=this.stalled;if(E===null)if(y>0&&g-y<A)E=this.stalled=y;else{this.stalled=g;return}const x=g-E;if(!a&&(x>=A||y)&&this.hls){var C;if(((C=this.mediaSource)==null?void 0:C.readyState)==="ended"&&!(m!=null&&m.live)&&Math.abs(e-((m==null?void 0:m.edge)||0))<1){if(this.ended)return;this.ended=e||1,this.hls.trigger(ae.MEDIA_ENDED,{stalled:!0});return}if(this._reportStall(h),!this.media||!this.hls)return}const T=jn.bufferInfo(o,e,s.maxBufferHole);this._tryFixBufferStall(T,x,e)}stallResolved(e){const t=this.stalled;if(t&&this.hls&&(this.stalled=null,this.stallReported)){const n=self.performance.now()-t;this.log(`playback not stuck anymore @${e}, after ${Math.round(n)}ms`),this.stallReported=!1,this.waiting=0,this.hls.trigger(ae.STALL_RESOLVED,{})}}nudgeOnVideoHole(e,t){var n;const r=this.buffered.video;if(this.hls&&this.media&&this.fragmentTracker&&(n=this.buffered.audio)!=null&&n.length&&r&&r.length>1&&e>r.end(0)){const s=jn.bufferedInfo(jn.timeRangesToArray(this.buffered.audio),e,0);if(s.len>1&&t>=s.start){const o=jn.timeRangesToArray(r),a=jn.bufferedInfo(o,t,0).bufferedIndex;if(a>-1&&a<o.length-1){const l=jn.bufferedInfo(o,e,0).bufferedIndex,c=o[a].end,u=o[a+1].start;if((l===-1||l>a)&&u-c<1&&e-c<2){const h=new Error(`nudging playhead to flush pipeline after video hole. currentTime: ${e} hole: ${c} -> ${u} buffered index: ${l}`);this.warn(h.message),this.media.currentTime+=1e-6;let f=r_(e,this.fragmentTracker);f&&"fragment"in f?f=f.fragment:f||(f=void 0);const d=jn.bufferInfo(this.media,e,0);this.hls.trigger(ae.ERROR,{type:rn.MEDIA_ERROR,details:Ke.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:h,reason:h.message,frag:f,buffer:d.len,bufferInfo:d})}}}}}_tryFixBufferStall(e,t,n){var r,s;const{fragmentTracker:o,media:a}=this,l=(r=this.hls)==null?void 0:r.config;if(!a||!o||!l)return;const c=(s=this.hls)==null?void 0:s.latestLevelDetails,u=r_(n,o);if((u||c!=null&&c.live&&n<c.fragmentStart)&&(this._trySkipBufferHole(u)||!this.media))return;const h=e.buffered,f=this.adjacentTraversal(e,n);(h&&h.length>1&&e.len>l.maxBufferHole||e.nextStart&&(e.nextStart-n<l.maxBufferHole||f))&&(t>l.highBufferWatchdogPeriod*1e3||this.waiting)&&(this.warn("Trying to nudge playhead over buffer-hole"),this._tryNudgeBuffer(e))}adjacentTraversal(e,t){const n=this.fragmentTracker,r=e.nextStart;if(n&&r){const s=n.getFragAtPos(t,Yt.MAIN),o=n.getFragAtPos(r,Yt.MAIN);if(s&&o)return o.sn-s.sn<2}return!1}_reportStall(e){const{hls:t,media:n,stallReported:r,stalled:s}=this;if(!r&&s!==null&&n&&t){this.stallReported=!0;const o=new Error(`Playback stalling at @${n.currentTime} due to low buffer (${lr(e)})`);this.warn(o.message),t.trigger(ae.ERROR,{type:rn.MEDIA_ERROR,details:Ke.BUFFER_STALLED_ERROR,fatal:!1,error:o,buffer:e.len,bufferInfo:e,stalled:{start:s}})}}_trySkipBufferHole(e){var t;const{fragmentTracker:n,media:r}=this,s=(t=this.hls)==null?void 0:t.config;if(!r||!n||!s)return 0;const o=r.currentTime,a=jn.bufferInfo(r,o,0),l=o<a.start?a.start:a.nextStart;if(l&&this.hls){const u=a.len<=s.maxBufferHole,h=a.len>0&&a.len<1&&r.readyState<3,f=l-o;if(f>0&&(u||h)){if(f>s.maxBufferHole){let m=!1;if(o===0){const A=n.getAppendedFrag(0,Yt.MAIN);A&&l<A.end&&(m=!0)}if(!m&&e){var c;if(!((c=this.hls.loadLevelObj)!=null&&c.details)||Nk(this.hls.inFlightFragments,l))return 0;let g=!1,y=e.end;for(;y<l;){const E=r_(y,n);if(E)y+=E.duration;else{g=!0;break}}if(g)return 0}}const d=Math.max(l+I1e,o+b1e);if(this.warn(`skipping hole, adjusting currentTime from ${o} to ${d}`),this.moved=!0,r.currentTime=d,!(e!=null&&e.gap)){const m=new Error(`fragment loaded with buffer holes, seeking from ${o} to ${d}`),A={type:rn.MEDIA_ERROR,details:Ke.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:m,reason:m.message,buffer:a.len,bufferInfo:a};e&&("fragment"in e?A.part=e:A.frag=e),this.hls.trigger(ae.ERROR,A)}return d}}return 0}_tryNudgeBuffer(e){const{hls:t,media:n,nudgeRetry:r}=this,s=t==null?void 0:t.config;if(!n||!s)return 0;const o=n.currentTime;if(this.nudgeRetry++,r<s.nudgeMaxRetry){const a=o+(r+1)*s.nudgeOffset,l=new Error(`Nudging 'currentTime' from ${o} to ${a}`);this.warn(l.message),n.currentTime=a,t.trigger(ae.ERROR,{type:rn.MEDIA_ERROR,details:Ke.BUFFER_NUDGE_ON_STALL,error:l,fatal:!1,buffer:e.len,bufferInfo:e})}else{const a=new Error(`Playhead still not moving while enough data buffered @${o} after ${s.nudgeMaxRetry} nudges`);this.error(a.message),t.trigger(ae.ERROR,{type:rn.MEDIA_ERROR,details:Ke.BUFFER_STALLED_ERROR,error:a,fatal:!0,buffer:e.len,bufferInfo:e})}}}function Nk(i,e){const t=Uk(i.main);if(t&&t.start<=e)return t;const n=Uk(i.audio);return n&&n.start<=e?n:null}function Uk(i){if(!i)return null;switch(i.state){case mt.IDLE:case mt.STOPPED:case mt.ENDED:case mt.ERROR:return null}return i.frag}function r_(i,e){return e.getAppendedFrag(i,Yt.MAIN)||e.getPartialFragment(i)}const L1e=.25;function P5(){if(!(typeof self>"u"))return self.VTTCue||self.TextTrackCue}function qb(i,e,t,n,r){let s=new i(e,t,"");try{s.value=n,r&&(s.type=r)}catch{s=new i(e,t,lr(r?Qi({type:r},n):n))}return s}const s_=(()=>{const i=P5();try{i&&new i(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();class P1e{constructor(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.removeCues=!0,this.assetCue=void 0,this.onEventCueEnter=()=>{this.hls&&this.hls.trigger(ae.EVENT_CUE_ENTER,{})},this.hls=e,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=this.onEventCueEnter=null}_registerListeners(){const{hls:e}=this;e&&(e.on(ae.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(ae.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(ae.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(ae.MANIFEST_LOADING,this.onManifestLoading,this),e.on(ae.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(ae.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(ae.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(ae.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(ae.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(ae.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(ae.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(ae.MANIFEST_LOADING,this.onManifestLoading,this),e.off(ae.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(ae.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(ae.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(ae.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}onMediaAttaching(e,t){var n;this.media=t.media,((n=t.overrides)==null?void 0:n.cueRemoval)===!1&&(this.removeCues=!1)}onMediaAttached(){var e;const t=(e=this.hls)==null?void 0:e.latestLevelDetails;t&&this.updateDateRangeCues(t)}onMediaDetaching(e,t){this.media=null,!t.transferMedia&&(this.id3Track&&(this.removeCues&&P1(this.id3Track,this.onEventCueEnter),this.id3Track=null),this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(e){const t=this.getID3Track(e.textTracks);return t.mode="hidden",t}getID3Track(e){if(this.media){for(let t=0;t<e.length;t++){const n=e[t];if(n.kind==="metadata"&&n.label==="id3")return QV(n,this.media),n}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(e,t){if(!this.media||!this.hls)return;const{enableEmsgMetadataCues:n,enableID3MetadataCues:r}=this.hls.config;if(!n&&!r)return;const{samples:s}=t;this.id3Track||(this.id3Track=this.createTrack(this.media));const o=P5();if(o)for(let a=0;a<s.length;a++){const l=s[a].type;if(l===Xa.emsg&&!n||!r)continue;const c=hV(s[a].data),u=s[a].pts;let h=u+s[a].duration;h>s_&&(h=s_),h-u<=0&&(h=u+L1e);for(let d=0;d<c.length;d++){const m=c[d];if(!fV(m)){this.updateId3CueEnds(u,l);const A=qb(o,u,h,m,l);A&&this.id3Track.addCue(A)}}}}updateId3CueEnds(e,t){var n;const r=(n=this.id3Track)==null?void 0:n.cues;if(r)for(let s=r.length;s--;){const o=r[s];o.type===t&&o.startTime<e&&o.endTime===s_&&(o.endTime=e)}}onBufferFlushing(e,{startOffset:t,endOffset:n,type:r}){const{id3Track:s,hls:o}=this;if(!o)return;const{config:{enableEmsgMetadataCues:a,enableID3MetadataCues:l}}=o;if(s&&(a||l)){let c;r==="audio"?c=u=>u.type===Xa.audioId3&&l:r==="video"?c=u=>u.type===Xa.emsg&&a:c=u=>u.type===Xa.audioId3&&l||u.type===Xa.emsg&&a,I5(s,t,n,c)}}onLevelUpdated(e,{details:t}){this.updateDateRangeCues(t,!0)}onLevelPtsUpdated(e,t){Math.abs(t.drift)>.01&&this.updateDateRangeCues(t.details)}updateDateRangeCues(e,t){if(!this.hls||!this.media)return;const{assetPlayerId:n,timelineOffset:r,enableDateRangeMetadataCues:s,interstitialsController:o}=this.hls.config;if(!s)return;const a=P5();if(n&&r&&!o){const{fragmentStart:A,fragmentEnd:g}=e;let y=this.assetCue;y?(y.startTime=A,y.endTime=g):a&&(y=this.assetCue=qb(a,A,g,{assetPlayerId:this.hls.config.assetPlayerId},"hlsjs.interstitial.asset"),y&&(y.id=n,this.id3Track||(this.id3Track=this.createTrack(this.media)),this.id3Track.addCue(y),y.addEventListener("enter",this.onEventCueEnter)))}if(!e.hasProgramDateTime)return;const{id3Track:l}=this,{dateRanges:c}=e,u=Object.keys(c);let h=this.dateRangeCuesAppended;if(l&&t){var f;if((f=l.cues)!=null&&f.length){const A=Object.keys(h).filter(g=>!u.includes(g));for(let g=A.length;g--;){var d;const y=A[g],E=(d=h[y])==null?void 0:d.cues;delete h[y],E&&Object.keys(E).forEach(x=>{const C=E[x];if(C){C.removeEventListener("enter",this.onEventCueEnter);try{l.removeCue(C)}catch{}}})}}else h=this.dateRangeCuesAppended={}}const m=e.fragments[e.fragments.length-1];if(!(u.length===0||!Wt(m==null?void 0:m.programDateTime))){this.id3Track||(this.id3Track=this.createTrack(this.media));for(let A=0;A<u.length;A++){const g=u[A],y=c[g],E=y.startTime,x=h[g],C=(x==null?void 0:x.cues)||{};let T=(x==null?void 0:x.durationKnown)||!1,I=s_;const{duration:M,endDate:L}=y;if(L&&M!==null)I=E+M,T=!0;else if(y.endOnNext&&!T){const P=u.reduce((F,k)=>{if(k!==y.id){const z=c[k];if(z.class===y.class&&z.startDate>y.startDate&&(!F||y.startDate<F.startDate))return z}return F},null);P&&(I=P.startTime,T=!0)}const R=Object.keys(y.attr);for(let P=0;P<R.length;P++){const F=R[P];if(!hme(F))continue;const k=C[F];if(k)T&&!(x!=null&&x.durationKnown)?k.endTime=I:Math.abs(k.startTime-E)>.01&&(k.startTime=E,k.endTime=I);else if(a){let z=y.attr[F];fme(F)&&(z=EQ(z));const W=qb(a,E,I,{key:F,data:z},Xa.dateRange);W&&(W.id=g,this.id3Track.addCue(W),C[F]=W,o&&(F==="X-ASSET-LIST"||F==="X-ASSET-URL")&&W.addEventListener("enter",this.onEventCueEnter))}}h[g]={cues:C,dateRange:y,durationKnown:T}}}}}class B1e{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.currentTime=0,this.stallCount=0,this._latency=null,this._targetLatencyUpdated=!1,this.onTimeupdate=()=>{const{media:t}=this,n=this.levelDetails;if(!t||!n)return;this.currentTime=t.currentTime;const r=this.computeLatency();if(r===null)return;this._latency=r;const{lowLatencyMode:s,maxLiveSyncPlaybackRate:o}=this.config;if(!s||o===1||!n.live)return;const a=this.targetLatency;if(a===null)return;const l=r-a,c=Math.min(this.maxLatency,a+n.targetduration);if(l<c&&l>.05&&this.forwardBufferLength>1){const h=Math.min(2,Math.max(1,o)),f=Math.round(2/(1+Math.exp(-.75*l-this.edgeStalled))*20)/20,d=Math.min(h,Math.max(1,f));this.changeMediaPlaybackRate(t,d)}else t.playbackRate!==1&&t.playbackRate!==0&&this.changeMediaPlaybackRate(t,1)},this.hls=e,this.config=e.config,this.registerListeners()}get levelDetails(){var e;return((e=this.hls)==null?void 0:e.latestLevelDetails)||null}get latency(){return this._latency||0}get maxLatency(){const{config:e}=this;if(e.liveMaxLatencyDuration!==void 0)return e.liveMaxLatencyDuration;const t=this.levelDetails;return t?e.liveMaxLatencyDurationCount*t.targetduration:0}get targetLatency(){const e=this.levelDetails;if(e===null||this.hls===null)return null;const{holdBack:t,partHoldBack:n,targetduration:r}=e,{liveSyncDuration:s,liveSyncDurationCount:o,lowLatencyMode:a}=this.config,l=this.hls.userConfig;let c=a&&n||t;(this._targetLatencyUpdated||l.liveSyncDuration||l.liveSyncDurationCount||c===0)&&(c=s!==void 0?s:o*r);const u=r;return c+Math.min(this.stallCount*this.config.liveSyncOnStallIncrease,u)}set targetLatency(e){this.stallCount=0,this.config.liveSyncDuration=e,this._targetLatencyUpdated=!0}get liveSyncPosition(){const e=this.estimateLiveEdge(),t=this.targetLatency;if(e===null||t===null)return null;const n=this.levelDetails;if(n===null)return null;const r=n.edge,s=e-t-this.edgeStalled,o=r-n.totalduration,a=r-(this.config.lowLatencyMode&&n.partTarget||n.targetduration);return Math.min(Math.max(o,s),a)}get drift(){const e=this.levelDetails;return e===null?1:e.drift}get edgeStalled(){const e=this.levelDetails;if(e===null)return 0;const t=(this.config.lowLatencyMode&&e.partTarget||e.targetduration)*3;return Math.max(e.age-t,0)}get forwardBufferLength(){const{media:e}=this,t=this.levelDetails;if(!e||!t)return 0;const n=e.buffered.length;return(n?e.buffered.end(n-1):t.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.hls=null}registerListeners(){const{hls:e}=this;e&&(e.on(ae.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(ae.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(ae.MANIFEST_LOADING,this.onManifestLoading,this),e.on(ae.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(ae.ERROR,this.onError,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(ae.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(ae.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(ae.MANIFEST_LOADING,this.onManifestLoading,this),e.off(ae.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(ae.ERROR,this.onError,this))}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.onTimeupdate)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.onTimeupdate),this.media=null)}onManifestLoading(){this._latency=null,this.stallCount=0}onLevelUpdated(e,{details:t}){t.advanced&&this.onTimeupdate(),!t.live&&this.media&&this.media.removeEventListener("timeupdate",this.onTimeupdate)}onError(e,t){var n;t.details===Ke.BUFFER_STALLED_ERROR&&(this.stallCount++,this.hls&&(n=this.levelDetails)!=null&&n.live&&this.hls.logger.warn("[latency-controller]: Stall detected, adjusting target latency"))}changeMediaPlaybackRate(e,t){var n,r;e.playbackRate!==t&&((n=this.hls)==null||n.logger.debug(`[latency-controller]: latency=${this.latency.toFixed(3)}, targetLatency=${(r=this.targetLatency)==null?void 0:r.toFixed(3)}, forwardBufferLength=${this.forwardBufferLength.toFixed(3)}: adjusting playback rate from ${e.playbackRate} to ${t}`),e.playbackRate=t)}estimateLiveEdge(){const e=this.levelDetails;return e===null?null:e.edge+e.age}computeLatency(){const e=this.estimateLiveEdge();return e===null?null:e-this.currentTime}}class D1e extends x4{constructor(e,t){super(e,"level-controller"),this._levels=[],this._firstLevel=-1,this._maxAutoLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=t,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(ae.MANIFEST_LOADING,this.onManifestLoading,this),e.on(ae.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(ae.LEVEL_LOADED,this.onLevelLoaded,this),e.on(ae.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(ae.FRAG_BUFFERED,this.onFragBuffered,this),e.on(ae.ERROR,this.onError,this)}_unregisterListeners(){const{hls:e}=this;e.off(ae.MANIFEST_LOADING,this.onManifestLoading,this),e.off(ae.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(ae.LEVEL_LOADED,this.onLevelLoaded,this),e.off(ae.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(ae.FRAG_BUFFERED,this.onFragBuffered,this),e.off(ae.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}stopLoad(){this._levels.forEach(t=>{t.loadError=0,t.fragmentError=0}),super.stopLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1}onManifestLoading(e,t){this.resetLevels()}onManifestLoaded(e,t){const n=this.hls.config.preferManagedMediaSource,r=[],s={},o={};let a=!1,l=!1,c=!1;t.levels.forEach(u=>{const h=u.attrs;let{audioCodec:f,videoCodec:d}=u;f&&(u.audioCodec=f=GS(f,n)||void 0),d&&(d=u.videoCodec=Rpe(d));const{width:m,height:A,unknownCodecs:g}=u,y=(g==null?void 0:g.length)||0;if(a||(a=!!(m&&A)),l||(l=!!d),c||(c=!!f),y||f&&!this.isAudioSupported(f)||d&&!this.isVideoSupported(d)){this.log(`Some or all CODECS not supported "${h.CODECS}"`);return}const{CODECS:E,"FRAME-RATE":x,"HDCP-LEVEL":C,"PATHWAY-ID":T,RESOLUTION:I,"VIDEO-RANGE":M}=h,R=`${`${T||"."}-`}${u.bitrate}-${I}-${x}-${E}-${M}-${C}`;if(s[R])if(s[R].uri!==u.url&&!u.attrs["PATHWAY-ID"]){const P=o[R]+=1;u.attrs["PATHWAY-ID"]=new Array(P+1).join(".");const F=this.createLevel(u);s[R]=F,r.push(F)}else s[R].addGroupId("audio",h.AUDIO),s[R].addGroupId("text",h.SUBTITLES);else{const P=this.createLevel(u);s[R]=P,o[R]=1,r.push(P)}}),this.filterAndSortMediaOptions(r,t,a,l,c)}createLevel(e){const t=new aA(e),n=e.supplemental;if(n!=null&&n.videoCodec&&!this.isVideoSupported(n.videoCodec)){const r=new Error(`SUPPLEMENTAL-CODECS not supported "${n.videoCodec}"`);this.log(r.message),t.supportedResult=BQ(r,[])}return t}isAudioSupported(e){return H2(e,"audio",this.hls.config.preferManagedMediaSource)}isVideoSupported(e){return H2(e,"video",this.hls.config.preferManagedMediaSource)}filterAndSortMediaOptions(e,t,n,r,s){var o;let a=[],l=[],c=e;const u=((o=t.stats)==null?void 0:o.parsing)||{};if((n||r)&&s&&(c=c.filter(({videoCodec:E,videoRange:x,width:C,height:T})=>(!!E||!!(C&&T))&&zpe(x))),c.length===0){Promise.resolve().then(()=>{if(this.hls){let E="no level with compatible codecs found in manifest",x=E;t.levels.length&&(x=`one or more CODECS in variant not supported: ${lr(t.levels.map(T=>T.attrs.CODECS).filter((T,I,M)=>M.indexOf(T)===I))}`,this.warn(x),E+=` (${x})`);const C=new Error(E);this.hls.trigger(ae.ERROR,{type:rn.MEDIA_ERROR,details:Ke.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,error:C,reason:x})}}),u.end=performance.now();return}t.audioTracks&&(a=t.audioTracks.filter(E=>!E.audioCodec||this.isAudioSupported(E.audioCodec)),zk(a)),t.subtitles&&(l=t.subtitles,zk(l));const h=c.slice(0);c.sort((E,x)=>{if(E.attrs["HDCP-LEVEL"]!==x.attrs["HDCP-LEVEL"])return(E.attrs["HDCP-LEVEL"]||"")>(x.attrs["HDCP-LEVEL"]||"")?1:-1;if(n&&E.height!==x.height)return E.height-x.height;if(E.frameRate!==x.frameRate)return E.frameRate-x.frameRate;if(E.videoRange!==x.videoRange)return HS.indexOf(E.videoRange)-HS.indexOf(x.videoRange);if(E.videoCodec!==x.videoCodec){const C=B7(E.videoCodec),T=B7(x.videoCodec);if(C!==T)return T-C}if(E.uri===x.uri&&E.codecSet!==x.codecSet){const C=zS(E.codecSet),T=zS(x.codecSet);if(C!==T)return T-C}return E.averageBitrate!==x.averageBitrate?E.averageBitrate-x.averageBitrate:0});let f=h[0];if(this.steering&&(c=this.steering.filterParsedLevels(c),c.length!==h.length)){for(let E=0;E<h.length;E++)if(h[E].pathwayId===c[0].pathwayId){f=h[E];break}}this._levels=c;for(let E=0;E<c.length;E++)if(c[E]===f){var d;this._firstLevel=E;const x=f.bitrate,C=this.hls.bandwidthEstimate;if(this.log(`manifest loaded, ${c.length} level(s) found, first bitrate: ${x}`),((d=this.hls.userConfig)==null?void 0:d.abrEwmaDefaultEstimate)===void 0){const T=Math.min(x,this.hls.config.abrEwmaDefaultEstimateMax);T>C&&C===this.hls.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=T)}break}const m=s&&!r,A=this.hls.config,g=!!(A.audioStreamController&&A.audioTrackController),y={levels:c,audioTracks:a,subtitleTracks:l,sessionData:t.sessionData,sessionKeys:t.sessionKeys,firstLevel:this._firstLevel,stats:t.stats,audio:s,video:r,altAudio:g&&!m&&a.some(E=>!!E.url)};u.end=performance.now(),this.hls.trigger(ae.MANIFEST_PARSED,y)}get levels(){return this._levels.length===0?null:this._levels}get loadLevelObj(){return this.currentLevel}get level(){return this.currentLevelIndex}set level(e){const t=this._levels;if(t.length===0)return;if(e<0||e>=t.length){const u=new Error("invalid level idx"),h=e<0;if(this.hls.trigger(ae.ERROR,{type:rn.OTHER_ERROR,details:Ke.LEVEL_SWITCH_ERROR,level:e,fatal:h,error:u,reason:u.message}),h)return;e=Math.min(e,t.length-1)}const n=this.currentLevelIndex,r=this.currentLevel,s=r?r.attrs["PATHWAY-ID"]:void 0,o=t[e],a=o.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=o,n===e&&r&&s===a)return;this.log(`Switching to level ${e} (${o.height?o.height+"p ":""}${o.videoRange?o.videoRange+" ":""}${o.codecSet?o.codecSet+" ":""}@${o.bitrate})${a?" with Pathway "+a:""} from level ${n}${s?" with Pathway "+s:""}`);const l={level:e,attrs:o.attrs,details:o.details,bitrate:o.bitrate,averageBitrate:o.averageBitrate,maxBitrate:o.maxBitrate,realBitrate:o.realBitrate,width:o.width,height:o.height,codecSet:o.codecSet,audioCodec:o.audioCodec,videoCodec:o.videoCodec,audioGroups:o.audioGroups,subtitleGroups:o.subtitleGroups,loaded:o.loaded,loadError:o.loadError,fragmentError:o.fragmentError,name:o.name,id:o.id,uri:o.uri,url:o.url,urlId:0,audioGroupIds:o.audioGroupIds,textGroupIds:o.textGroupIds};this.hls.trigger(ae.LEVEL_SWITCHING,l);const c=o.details;if(!c||c.live){const u=this.switchParams(o.uri,r==null?void 0:r.details,c);this.loadPlaylist(u)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(e){this.manualLevelIndex=e,this._startLevel===void 0&&(this._startLevel=e),e!==-1&&(this.level=e)}get firstLevel(){return this._firstLevel}set firstLevel(e){this._firstLevel=e}get startLevel(){if(this._startLevel===void 0){const e=this.hls.config.startLevel;return e!==void 0?e:this.hls.firstAutoLevel}return this._startLevel}set startLevel(e){this._startLevel=e}get pathways(){return this.steering?this.steering.pathways():[]}get pathwayPriority(){return this.steering?this.steering.pathwayPriority:null}set pathwayPriority(e){if(this.steering){const t=this.steering.pathways(),n=e.filter(r=>t.indexOf(r)!==-1);if(e.length<1){this.warn(`pathwayPriority ${e} should contain at least one pathway from list: ${t}`);return}this.steering.pathwayPriority=n}}onError(e,t){t.fatal||!t.context||t.context.type===ai.LEVEL&&t.context.level===this.level&&this.checkRetry(t)}onFragBuffered(e,{frag:t}){if(t!==void 0&&t.type===Yt.MAIN){const n=t.elementaryStreams;if(!Object.keys(n).some(s=>!!n[s]))return;const r=this._levels[t.level];r!=null&&r.loadError&&(this.log(`Resetting level error count of ${r.loadError} on frag buffered`),r.loadError=0)}}onLevelLoaded(e,t){var n;const{level:r,details:s}=t,o=t.levelInfo;if(!o){var a;this.warn(`Invalid level index ${r}`),(a=t.deliveryDirectives)!=null&&a.skip&&(s.deltaUpdateFailed=!0);return}if(o===this.currentLevel||t.withoutMultiVariant){o.fragmentError===0&&(o.loadError=0);let l=o.details;l===t.details&&l.advanced&&(l=void 0),this.playlistLoaded(r,t,l)}else(n=t.deliveryDirectives)!=null&&n.skip&&(s.deltaUpdateFailed=!0)}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentLevel)&&this.scheduleLoading(this.currentLevel,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const n=this.getUrlWithDirectives(e.uri,t),r=this.currentLevelIndex,s=e.attrs["PATHWAY-ID"],o=e.details,a=o==null?void 0:o.age;this.log(`Loading level index ${r}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${s?" Pathway "+s:""}${a&&o.live?" age "+a.toFixed(1)+(o.type&&" "+o.type||""):""} ${n}`),this.hls.trigger(ae.LEVEL_LOADING,{url:n,level:r,levelInfo:e,pathwayId:e.attrs["PATHWAY-ID"],id:0,deliveryDirectives:t||null})}get nextLoadLevel(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(e){this.level=e,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=e)}removeLevel(e){var t;if(this._levels.length===1)return;const n=this._levels.filter((s,o)=>o!==e?!0:(this.steering&&this.steering.removeLevel(s),s===this.currentLevel&&(this.currentLevel=null,this.currentLevelIndex=-1,s.details&&s.details.fragments.forEach(a=>a.level=-1)),!1));tV(n),this._levels=n,this.currentLevelIndex>-1&&(t=this.currentLevel)!=null&&t.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.manualLevelIndex>-1&&(this.manualLevelIndex=this.currentLevelIndex);const r=n.length-1;this._firstLevel=Math.min(this._firstLevel,r),this._startLevel&&(this._startLevel=Math.min(this._startLevel,r)),this.hls.trigger(ae.LEVELS_UPDATED,{levels:n})}onLevelsUpdated(e,{levels:t}){this._levels=t}checkMaxAutoUpdated(){const{autoLevelCapping:e,maxAutoLevel:t,maxHdcpLevel:n}=this.hls;this._maxAutoLevel!==t&&(this._maxAutoLevel=t,this.hls.trigger(ae.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:e,levels:this.levels,maxAutoLevel:t,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:n}))}}function zk(i){const e={};i.forEach(t=>{const n=t.groupId||"";t.id=e[n]=e[n]||0,e[n]++})}function oW(){return self.SourceBuffer||self.WebKitSourceBuffer}function e8(){if(!Uf())return!1;const e=oW();return!e||e.prototype&&typeof e.prototype.appendBuffer=="function"&&typeof e.prototype.remove=="function"}function aW(){if(!e8())return!1;const i=Uf();return typeof(i==null?void 0:i.isTypeSupported)=="function"&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some(e=>i.isTypeSupported(Q2(e,"video")))||["mp4a.40.2","fLaC"].some(e=>i.isTypeSupported(Q2(e,"audio"))))}function k1e(){var i;const e=oW();return typeof(e==null||(i=e.prototype)==null?void 0:i.changeType)=="function"}const F1e=100;class O1e extends y4{constructor(e,t,n){super(e,t,n,"stream-controller",Yt.MAIN),this.audioCodecSwap=!1,this.level=-1,this._forceStartLoad=!1,this._hasEnoughToStart=!1,this.altAudio=0,this.audioOnly=!1,this.fragPlaying=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this.onMediaPlaying=()=>{this.tick()},this.onMediaSeeked=()=>{const r=this.media,s=r?r.currentTime:null;if(s===null||!Wt(s)||(this.log(`Media seeked to ${s.toFixed(3)}`),!this.getBufferedFrag(s)))return;const o=this.getFwdBufferInfoAtPos(r,s,Yt.MAIN,0);if(o===null||o.len===0){this.warn(`Main forward buffer length at ${s} on "seeked" event ${o?o.len:"empty"})`);return}this.tick()},this.registerListeners()}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(ae.MANIFEST_PARSED,this.onManifestParsed,this),e.on(ae.LEVEL_LOADING,this.onLevelLoading,this),e.on(ae.LEVEL_LOADED,this.onLevelLoaded,this),e.on(ae.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(ae.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(ae.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(ae.BUFFER_CREATED,this.onBufferCreated,this),e.on(ae.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(ae.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(ae.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(ae.MANIFEST_PARSED,this.onManifestParsed,this),e.off(ae.LEVEL_LOADED,this.onLevelLoaded,this),e.off(ae.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(ae.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(ae.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(ae.BUFFER_CREATED,this.onBufferCreated,this),e.off(ae.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(ae.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(ae.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this.onMediaPlaying=this.onMediaSeeked=null,this.unregisterListeners(),super.onHandlerDestroying()}startLoad(e,t){if(this.levels){const{lastCurrentTime:n,hls:r}=this;if(this.stopLoad(),this.setInterval(F1e),this.level=-1,!this.startFragRequested){let s=r.startLevel;s===-1&&(r.config.testBandwidth&&this.levels.length>1?(s=0,this.bitrateTest=!0):s=r.firstAutoLevel),r.nextLoadLevel=s,this.level=r.loadLevel,this._hasEnoughToStart=!!t}n>0&&e===-1&&!t&&(this.log(`Override startPosition with lastCurrentTime @${n.toFixed(3)}`),e=n),this.state=mt.IDLE,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}else this._forceStartLoad=!0,this.state=mt.STOPPED}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case mt.WAITING_LEVEL:{const{levels:e,level:t}=this,n=e==null?void 0:e[t],r=n==null?void 0:n.details;if(r&&(!r.live||this.levelLastLoaded===n&&!this.waitForLive(n))){if(this.waitForCdnTuneIn(r))break;this.state=mt.IDLE;break}else if(this.hls.nextLoadLevel!==this.level){this.state=mt.IDLE;break}break}case mt.FRAG_LOADING_WAITING_RETRY:this.checkRetryDate();break}this.state===mt.IDLE&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){var e;super.onTickEnd(),(e=this.media)!=null&&e.readyState&&this.media.seeking===!1&&(this.lastCurrentTime=this.media.currentTime),this.checkFragmentChanged()}doTickIdle(){const{hls:e,levelLastLoaded:t,levels:n,media:r}=this;if(t===null||!r&&!this.primaryPrefetch&&(this.startFragRequested||!e.config.startFragPrefetch)||this.altAudio&&this.audioOnly)return;const s=this.buffering?e.nextLoadLevel:e.loadLevel;if(!(n!=null&&n[s]))return;const o=n[s],a=this.getMainFwdBufferInfo();if(a===null)return;const l=this.getLevelDetails();if(l&&this._streamEnded(a,l)){const A={};this.altAudio===2&&(A.type="video"),this.hls.trigger(ae.BUFFER_EOS,A),this.state=mt.ENDED;return}if(!this.buffering)return;e.loadLevel!==s&&e.manualLevel===-1&&this.log(`Adapting to level ${s} from level ${this.level}`),this.level=e.nextLoadLevel=s;const c=o.details;if(!c||this.state===mt.WAITING_LEVEL||this.waitForLive(o)){this.level=s,this.state=mt.WAITING_LEVEL,this.startFragRequested=!1;return}const u=a.len,h=this.getMaxBufferLength(o.maxBitrate);if(u>=h)return;this.backtrackFragment&&this.backtrackFragment.start>a.end&&(this.backtrackFragment=null);const f=this.backtrackFragment?this.backtrackFragment.start:a.end;let d=this.getNextFragment(f,c);if(this.couldBacktrack&&!this.fragPrevious&&d&&As(d)&&this.fragmentTracker.getState(d)!==eo.OK){var m;const g=((m=this.backtrackFragment)!=null?m:d).sn-c.startSN,y=c.fragments[g-1];y&&d.cc===y.cc&&(d=y,this.fragmentTracker.removeFragment(y))}else this.backtrackFragment&&a.len&&(this.backtrackFragment=null);if(d&&this.isLoopLoading(d,f)){if(!d.gap){const g=this.audioOnly&&!this.altAudio?ar.AUDIO:ar.VIDEO,y=(g===ar.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;y&&this.afterBufferFlushed(y,g,Yt.MAIN)}d=this.getNextFragmentLoopLoading(d,c,a,Yt.MAIN,h)}d&&(d.initSegment&&!d.initSegment.data&&!this.bitrateTest&&(d=d.initSegment),this.loadFragment(d,o,f))}loadFragment(e,t,n){const r=this.fragmentTracker.getState(e);r===eo.NOT_LOADED||r===eo.PARTIAL?As(e)?this.bitrateTest?(this.log(`Fragment ${e.sn} of level ${e.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(e,t)):super.loadFragment(e,t,n):this._loadInitSegment(e,t):this.clearTrackerIfNeeded(e)}getBufferedFrag(e){return this.fragmentTracker.getBufferedFrag(e,Yt.MAIN)}followingBufferedFrag(e){return e?this.getBufferedFrag(e.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:e,media:t}=this;if(t!=null&&t.readyState){let n;const r=this.getAppendedFrag(t.currentTime);r&&r.start>1&&this.flushMainBuffer(0,r.start-1);const s=this.getLevelDetails();if(s!=null&&s.live){const a=this.getMainFwdBufferInfo();if(!a||a.len<s.targetduration*2)return}if(!t.paused&&e){const a=this.hls.nextLoadLevel,l=e[a],c=this.fragLastKbps;c&&this.fragCurrent?n=this.fragCurrent.duration*l.maxBitrate/(1e3*c)+1:n=0}else n=0;const o=this.getBufferedFrag(t.currentTime+n);if(o){const a=this.followingBufferedFrag(o);if(a){this.abortCurrentFrag();const l=a.maxStartPTS?a.maxStartPTS:a.start,c=a.duration,u=Math.max(o.end,l+Math.min(Math.max(c-this.config.maxFragLookUpTolerance,c*(this.couldBacktrack?.5:.125)),c*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(u,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case mt.KEY_LOADING:case mt.FRAG_LOADING:case mt.FRAG_LOADING_WAITING_RETRY:case mt.PARSING:case mt.PARSED:this.state=mt.IDLE;break}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(e,t){super.flushMainBuffer(e,t,this.altAudio===2?"video":null)}onMediaAttached(e,t){super.onMediaAttached(e,t);const n=t.media;_a(n,"playing",this.onMediaPlaying),_a(n,"seeked",this.onMediaSeeked)}onMediaDetaching(e,t){const{media:n}=this;n&&(Za(n,"playing",this.onMediaPlaying),Za(n,"seeked",this.onMediaSeeked)),this.videoBuffer=null,this.fragPlaying=null,super.onMediaDetaching(e,t),!t.transferMedia&&(this._hasEnoughToStart=!1)}onManifestLoading(){super.onManifestLoading(),this.log("Trigger BUFFER_RESET"),this.hls.trigger(ae.BUFFER_RESET,void 0),this.couldBacktrack=!1,this.fragLastKbps=0,this.fragPlaying=this.backtrackFragment=null,this.altAudio=0,this.audioOnly=!1}onManifestParsed(e,t){let n=!1,r=!1;for(let s=0;s<t.levels.length;s++){const o=t.levels[s].audioCodec;o&&(n=n||o.indexOf("mp4a.40.2")!==-1,r=r||o.indexOf("mp4a.40.5")!==-1)}this.audioCodecSwitch=n&&r&&!k1e(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1}onLevelLoading(e,t){const{levels:n}=this;if(!n||this.state!==mt.IDLE)return;const r=t.levelInfo;(!r.details||r.details.live&&(this.levelLastLoaded!==r||r.details.expired)||this.waitForCdnTuneIn(r.details))&&(this.state=mt.WAITING_LEVEL)}onLevelLoaded(e,t){var n;const{levels:r,startFragRequested:s}=this,o=t.level,a=t.details,l=a.totalduration;if(!r){this.warn(`Levels were reset while loading level ${o}`);return}this.log(`Level ${o} loaded [${a.startSN},${a.endSN}]${a.lastPartSn?`[part-${a.lastPartSn}-${a.lastPartIndex}]`:""}, cc [${a.startCC}, ${a.endCC}] duration:${l}`);const c=t.levelInfo,u=this.fragCurrent;u&&(this.state===mt.FRAG_LOADING||this.state===mt.FRAG_LOADING_WAITING_RETRY)&&u.level!==t.level&&u.loader&&this.abortCurrentFrag();let h=0;if(a.live||(n=c.details)!=null&&n.live){var f;if(this.checkLiveUpdate(a),a.deltaUpdateFailed)return;h=this.alignPlaylists(a,c.details,(f=this.levelLastLoaded)==null?void 0:f.details)}if(c.details=a,this.levelLastLoaded=c,s||this.setStartPosition(a,h),this.hls.trigger(ae.LEVEL_UPDATED,{details:a,level:o}),this.state===mt.WAITING_LEVEL){if(this.waitForCdnTuneIn(a))return;this.state=mt.IDLE}s&&a.live&&this.synchronizeToLiveEdge(a),this.tick()}synchronizeToLiveEdge(e){const{config:t,media:n}=this;if(!n)return;const r=this.hls.liveSyncPosition,s=this.getLoadPosition(),o=e.fragmentStart,a=e.edge,l=s>=o-t.maxFragLookUpTolerance&&s<=a;if(r!==null&&n.duration>r&&(s<r||!l)){const u=t.liveMaxLatencyDuration!==void 0?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;if((!l&&n.readyState<4||s<a-u)&&(this._hasEnoughToStart||(this.nextLoadPosition=r),n.readyState))if(this.warn(`Playback: ${s.toFixed(3)} is located too far from the end of live sliding playlist: ${a}, reset currentTime to : ${r.toFixed(3)}`),this.config.liveSyncMode==="buffered"){var c;const h=jn.bufferInfo(n,r,0);if(!((c=h.buffered)!=null&&c.length)){n.currentTime=r;return}if(h.start<=s){n.currentTime=r;return}const{nextStart:d}=jn.bufferedInfo(h.buffered,s,0);d&&(n.currentTime=d)}else n.currentTime=r}}_handleFragmentLoadProgress(e){var t;const n=e.frag,{part:r,payload:s}=e,{levels:o}=this;if(!o){this.warn(`Levels were reset while fragment load was in progress. Fragment ${n.sn} of level ${n.level} will not be buffered`);return}const a=o[n.level];if(!a){this.warn(`Level ${n.level} not found on progress`);return}const l=a.details;if(!l){this.warn(`Dropping fragment ${n.sn} of level ${n.level} after level details were reset`),this.fragmentTracker.removeFragment(n);return}const c=a.videoCodec,u=l.PTSKnown||!l.live,h=(t=n.initSegment)==null?void 0:t.data,f=this._getAudioCodec(a),d=this.transmuxer=this.transmuxer||new SV(this.hls,Yt.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),m=r?r.index:-1,A=m!==-1,g=new A4(n.level,n.sn,n.stats.chunkCount,s.byteLength,m,A),y=this.initPTS[n.cc];d.push(s,h,f,c,n,r,l.totalduration,u,g,y)}onAudioTrackSwitching(e,t){const n=this.hls,r=this.altAudio!==0;if(QS(t.url,n))this.altAudio=1;else{if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const o=this.fragCurrent;o&&(this.log("Switching to main audio track, cancel main fragment load"),o.abortRequests(),this.fragmentTracker.removeFragment(o)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();if(r){this.altAudio=0,this.fragmentTracker.removeAllFragments(),n.once(ae.BUFFER_FLUSHED,()=>{this.hls&&this.hls.trigger(ae.AUDIO_TRACK_SWITCHED,t)}),n.trigger(ae.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null});return}n.trigger(ae.AUDIO_TRACK_SWITCHED,t)}}onAudioTrackSwitched(e,t){const n=QS(t.url,this.hls);if(n){const r=this.videoBuffer;r&&this.mediaBuffer!==r&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=r)}this.altAudio=n?2:0,this.tick()}onBufferCreated(e,t){const n=t.tracks;let r,s,o=!1;for(const a in n){const l=n[a];if(l.id==="main"){if(s=a,r=l,a==="video"){const c=n[a];c&&(this.videoBuffer=c.buffer)}}else o=!0}o&&r?(this.log(`Alternate track found, use ${s}.buffered to schedule main fragment loading`),this.mediaBuffer=r.buffer):this.mediaBuffer=this.media}onFragBuffered(e,t){const{frag:n,part:r}=t,s=n.type===Yt.MAIN;if(s){if(this.fragContextChanged(n)){this.warn(`Fragment ${n.sn}${r?" p: "+r.index:""} of level ${n.level} finished buffering, but was aborted. state: ${this.state}`),this.state===mt.PARSED&&(this.state=mt.IDLE);return}const a=r?r.stats:n.stats;this.fragLastKbps=Math.round(8*a.total/(a.buffering.end-a.loading.first)),As(n)&&(this.fragPrevious=n),this.fragBufferedComplete(n,r)}const o=this.media;o&&(!this._hasEnoughToStart&&jn.getBuffered(o).length&&(this._hasEnoughToStart=!0,this.seekToStartPos()),s&&this.tick())}get hasEnoughToStart(){return this._hasEnoughToStart}onError(e,t){var n;if(t.fatal){this.state=mt.ERROR;return}switch(t.details){case Ke.FRAG_GAP:case Ke.FRAG_PARSING_ERROR:case Ke.FRAG_DECRYPT_ERROR:case Ke.FRAG_LOAD_ERROR:case Ke.FRAG_LOAD_TIMEOUT:case Ke.KEY_LOAD_ERROR:case Ke.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(Yt.MAIN,t);break;case Ke.LEVEL_LOAD_ERROR:case Ke.LEVEL_LOAD_TIMEOUT:case Ke.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===mt.WAITING_LEVEL&&((n=t.context)==null?void 0:n.type)===ai.LEVEL&&(this.state=mt.IDLE);break;case Ke.BUFFER_ADD_CODEC_ERROR:case Ke.BUFFER_APPEND_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&this.resetLoadingState();break;case Ke.BUFFER_FULL_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&(!this.config.interstitialsController&&this.config.assetPlayerId?this._hasEnoughToStart=!0:this.flushMainBuffer(0,Number.POSITIVE_INFINITY));break;case Ke.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onFragLoadEmergencyAborted(){this.state=mt.IDLE,this._hasEnoughToStart||(this.startFragRequested=!1,this.nextLoadPosition=this.lastCurrentTime),this.tickImmediate()}onBufferFlushed(e,{type:t}){if(t!==ar.AUDIO||!this.altAudio){const n=(t===ar.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;n&&(this.afterBufferFlushed(n,t,Yt.MAIN),this.tick())}}onLevelsUpdated(e,t){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level,this.level===-1&&this.resetWhenMissingContext(this.fragCurrent)),this.levels=t.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:e}=this;if(!e)return;const t=e.currentTime;let n=this.startPosition;if(n>=0&&t<n){if(e.seeking){this.log(`could not seek to ${n}, already seeking at ${t}`);return}const r=this.timelineOffset;r&&n&&(n+=r);const s=this.getLevelDetails(),o=jn.getBuffered(e),a=o.length?o.start(0):0,l=a-n,c=Math.max(this.config.maxBufferHole,this.config.maxFragLookUpTolerance);(this.config.startOnSegmentBoundary||l>0&&(l<c||this.loadingParts&&l<2*((s==null?void 0:s.partTarget)||0)))&&(this.log(`adjusting start position by ${l} to match buffer start`),n+=l,this.startPosition=n),t<n&&(this.log(`seek to target start position ${n} from current time ${t} buffer start ${a}`),e.currentTime=n)}}_getAudioCodec(e){let t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t.indexOf("mp4a.40.5")!==-1?t="mp4a.40.2":t="mp4a.40.5"),t}_loadBitrateTestFrag(e,t){e.bitrateTest=!0,this._doFragLoad(e,t).then(n=>{const{hls:r}=this,s=n==null?void 0:n.frag;if(!s||this.fragContextChanged(s))return;t.fragmentError=0,this.state=mt.IDLE,this.startFragRequested=!1,this.bitrateTest=!1;const o=s.stats;o.parsing.start=o.parsing.end=o.buffering.start=o.buffering.end=self.performance.now(),r.trigger(ae.FRAG_LOADED,n),s.bitrateTest=!1}).catch(n=>{this.state===mt.STOPPED||this.state===mt.ERROR||(this.warn(n),this.resetFragmentLoading(e))})}_handleTransmuxComplete(e){const t=this.playlistType,{hls:n}=this,{remuxResult:r,chunkMeta:s}=e,o=this.getCurrentContext(s);if(!o){this.resetWhenMissingContext(s);return}const{frag:a,part:l,level:c}=o,{video:u,text:h,id3:f,initSegment:d}=r,{details:m}=c,A=this.altAudio?void 0:r.audio;if(this.fragContextChanged(a)){this.fragmentTracker.removeFragment(a);return}if(this.state=mt.PARSING,d){const g=d.tracks;if(g){const C=a.initSegment||a;if(this.unhandledEncryptionError(d,a))return;this._bufferInitSegment(c,g,C,s),n.trigger(ae.FRAG_PARSING_INIT_SEGMENT,{frag:C,id:t,tracks:g})}const y=d.initPTS,E=d.timescale,x=this.initPTS[a.cc];if(Wt(y)&&(!x||x.baseTime!==y||x.timescale!==E)){const C=d.trackId;this.initPTS[a.cc]={baseTime:y,timescale:E,trackId:C},n.trigger(ae.INIT_PTS_FOUND,{frag:a,id:t,initPTS:y,timescale:E,trackId:C})}}if(u&&m){A&&u.type==="audiovideo"&&this.logMuxedErr(a);const g=m.fragments[a.sn-1-m.startSN],y=a.sn===m.startSN,E=!g||a.cc>g.cc;if(r.independent!==!1){const{startPTS:x,endPTS:C,startDTS:T,endDTS:I}=u;if(l)l.elementaryStreams[u.type]={startPTS:x,endPTS:C,startDTS:T,endDTS:I};else if(u.firstKeyFrame&&u.independent&&s.id===1&&!E&&(this.couldBacktrack=!0),u.dropped&&u.independent){const M=this.getMainFwdBufferInfo(),L=(M?M.end:this.getLoadPosition())+this.config.maxBufferHole,R=u.firstKeyFramePTS?u.firstKeyFramePTS:x;if(!y&&L<R-this.config.maxBufferHole&&!E){this.backtrack(a);return}else E&&(a.gap=!0);a.setElementaryStreamInfo(u.type,a.start,C,a.start,I,!0)}else y&&x-(m.appliedTimelineOffset||0)>sS&&(a.gap=!0);a.setElementaryStreamInfo(u.type,x,C,T,I),this.backtrackFragment&&(this.backtrackFragment=a),this.bufferFragmentData(u,a,l,s,y||E)}else if(y||E)a.gap=!0;else{this.backtrack(a);return}}if(A){const{startPTS:g,endPTS:y,startDTS:E,endDTS:x}=A;l&&(l.elementaryStreams[ar.AUDIO]={startPTS:g,endPTS:y,startDTS:E,endDTS:x}),a.setElementaryStreamInfo(ar.AUDIO,g,y,E,x),this.bufferFragmentData(A,a,l,s)}if(m&&f!=null&&f.samples.length){const g={id:t,frag:a,details:m,samples:f.samples};n.trigger(ae.FRAG_PARSING_METADATA,g)}if(m&&h){const g={id:t,frag:a,details:m,samples:h.samples};n.trigger(ae.FRAG_PARSING_USERDATA,g)}}logMuxedErr(e){this.warn(`${As(e)?"Media":"Init"} segment with muxed audiovideo where only video expected: ${e.url}`)}_bufferInitSegment(e,t,n,r){if(this.state!==mt.PARSING)return;this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&(delete t.audio,t.audiovideo&&this.logMuxedErr(n));const{audio:s,video:o,audiovideo:a}=t;if(s){const c=e.audioCodec;let u=Z_(s.codec,c);u==="mp4a"&&(u="mp4a.40.5");const h=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){u&&(u.indexOf("mp4a.40.5")!==-1?u="mp4a.40.2":u="mp4a.40.5");const f=s.metadata;f&&"channelCount"in f&&(f.channelCount||1)!==1&&h.indexOf("firefox")===-1&&(u="mp4a.40.5")}u&&u.indexOf("mp4a.40.5")!==-1&&h.indexOf("android")!==-1&&s.container!=="audio/mpeg"&&(u="mp4a.40.2",this.log(`Android: force audio codec to ${u}`)),c&&c!==u&&this.log(`Swapping manifest audio codec "${c}" for "${u}"`),s.levelCodec=u,s.id=Yt.MAIN,this.log(`Init audio buffer, container:${s.container}, codecs[selected/level/parsed]=[${u||""}/${c||""}/${s.codec}]`),delete t.audiovideo}if(o){o.levelCodec=e.videoCodec,o.id=Yt.MAIN;const c=o.codec;if((c==null?void 0:c.length)===4)switch(c){case"hvc1":case"hev1":o.codec="hvc1.1.6.L120.90";break;case"av01":o.codec="av01.0.04M.08";break;case"avc1":o.codec="avc1.42e01e";break}this.log(`Init video buffer, container:${o.container}, codecs[level/parsed]=[${e.videoCodec||""}/${c}]${o.codec!==c?" parsed-corrected="+o.codec:""}${o.supplemental?" supplemental="+o.supplemental:""}`),delete t.audiovideo}a&&(this.log(`Init audiovideo buffer, container:${a.container}, codecs[level/parsed]=[${e.codecs}/${a.codec}]`),delete t.video,delete t.audio);const l=Object.keys(t);if(l.length){if(this.hls.trigger(ae.BUFFER_CODECS,t),!this.hls)return;l.forEach(c=>{const h=t[c].initSegment;h!=null&&h.byteLength&&this.hls.trigger(ae.BUFFER_APPENDING,{type:c,data:h,frag:n,part:null,chunkMeta:r,parent:n.type})})}this.tickImmediate()}getMainFwdBufferInfo(){const e=this.mediaBuffer&&this.altAudio===2?this.mediaBuffer:this.media;return this.getFwdBufferInfo(e,Yt.MAIN)}get maxBufferLength(){const{levels:e,level:t}=this,n=e==null?void 0:e[t];return n?this.getMaxBufferLength(n.maxBitrate):this.config.maxBufferLength}backtrack(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=mt.IDLE}checkFragmentChanged(){const e=this.media;let t=null;if(e&&e.readyState>1&&e.seeking===!1){const n=e.currentTime;if(jn.isBuffered(e,n)?t=this.getAppendedFrag(n):jn.isBuffered(e,n+.1)&&(t=this.getAppendedFrag(n+.1)),t){this.backtrackFragment=null;const r=this.fragPlaying,s=t.level;(!r||t.sn!==r.sn||r.level!==s)&&(this.fragPlaying=t,this.hls.trigger(ae.FRAG_CHANGED,{frag:t}),(!r||r.level!==s)&&this.hls.trigger(ae.LEVEL_SWITCHED,{level:s}))}}}get nextLevel(){const e=this.nextBufferedFrag;return e?e.level:-1}get currentFrag(){var e;if(this.fragPlaying)return this.fragPlaying;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;return Wt(t)?this.getAppendedFrag(t):null}get currentProgramDateTime(){var e;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;if(Wt(t)){const n=this.getLevelDetails(),r=this.currentFrag||(n?s0(null,n.fragments,t):null);if(r){const s=r.programDateTime;if(s!==null){const o=s+(t-r.start)*1e3;return new Date(o)}}}return null}get currentLevel(){const e=this.currentFrag;return e?e.level:-1}get nextBufferedFrag(){const e=this.currentFrag;return e?this.followingBufferedFrag(e):null}get forceStartLoad(){return this._forceStartLoad}}class N1e extends _c{constructor(e,t){super("key-loader",t),this.config=void 0,this.keyIdToKeyInfo={},this.emeController=null,this.config=e}abort(e){for(const n in this.keyIdToKeyInfo){const r=this.keyIdToKeyInfo[n].loader;if(r){var t;if(e&&e!==((t=r.context)==null?void 0:t.frag.type))return;r.abort()}}}detach(){for(const e in this.keyIdToKeyInfo){const t=this.keyIdToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyIdToKeyInfo[e]}}destroy(){this.detach();for(const e in this.keyIdToKeyInfo){const t=this.keyIdToKeyInfo[e].loader;t&&t.destroy()}this.keyIdToKeyInfo={}}createKeyLoadError(e,t=Ke.KEY_LOAD_ERROR,n,r,s){return new Ef({type:rn.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:s,error:n,networkDetails:r})}loadClear(e,t,n){if(this.emeController&&this.config.emeEnabled&&!this.emeController.getSelectedKeySystemFormats().length){if(t.length)for(let r=0,s=t.length;r<s;r++){const o=t[r];if(e.cc<=o.cc&&(!As(e)||!As(o)||e.sn<o.sn)||!n&&r==s-1)return this.emeController.selectKeySystemFormat(o).then(a=>{if(!this.emeController)return;o.setKeyFormat(a);const l=eS(a);if(l)return this.emeController.getKeySystemAccess([l])})}if(this.config.requireKeySystemAccessOnStart){const r=Uv(this.config);if(r.length)return this.emeController.getKeySystemAccess(r)}}return null}load(e){return!e.decryptdata&&e.encrypted&&this.emeController&&this.config.emeEnabled?this.emeController.selectKeySystemFormat(e).then(t=>this.loadInternal(e,t)):this.loadInternal(e)}loadInternal(e,t){var n,r;t&&e.setKeyFormat(t);const s=e.decryptdata;if(!s){const c=new Error(t?`Expected frag.decryptdata to be defined after setting format ${t}`:`Missing decryption data on fragment in onKeyLoading (emeEnabled with controller: ${this.emeController&&this.config.emeEnabled})`);return Promise.reject(this.createKeyLoadError(e,Ke.KEY_LOAD_ERROR,c))}const o=s.uri;if(!o)return Promise.reject(this.createKeyLoadError(e,Ke.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${o}"`)));const a=Jb(s);let l=this.keyIdToKeyInfo[a];if((n=l)!=null&&n.decryptdata.key)return s.key=l.decryptdata.key,Promise.resolve({frag:e,keyInfo:l});if(this.emeController&&(r=l)!=null&&r.keyLoadPromise)switch(this.emeController.getKeyStatus(l.decryptdata)){case"usable":case"usable-in-future":return l.keyLoadPromise.then(u=>{const{keyInfo:h}=u;return s.key=h.decryptdata.key,{frag:e,keyInfo:h}})}switch(this.log(`${this.keyIdToKeyInfo[a]?"Rel":"L"}oading${s.keyId?" keyId: "+Oo(s.keyId):""} URI: ${s.uri} from ${e.type} ${e.level}`),l=this.keyIdToKeyInfo[a]={decryptdata:s,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},s.method){case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return s.keyFormat==="identity"?this.loadKeyHTTP(l,e):this.loadKeyEME(l,e);case"AES-128":case"AES-256":case"AES-256-CTR":return this.loadKeyHTTP(l,e);default:return Promise.reject(this.createKeyLoadError(e,Ke.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${s.method}"`)))}}loadKeyEME(e,t){const n={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){var r;if(!e.decryptdata.keyId&&(r=t.initSegment)!=null&&r.data){const o=ype(t.initSegment.data);if(o.length){let a=o[0];a.some(l=>l!==0)?(this.log(`Using keyId found in init segment ${Oo(a)}`),Df.setKeyIdForUri(e.decryptdata.uri,a)):(a=Df.addKeyIdForUri(e.decryptdata.uri),this.log(`Generating keyId to patch media ${Oo(a)}`)),e.decryptdata.keyId=a}}if(!e.decryptdata.keyId&&!As(t))return Promise.resolve(n);const s=this.emeController.loadKey(n);return(e.keyLoadPromise=s.then(o=>(e.mediaKeySessionContext=o,n))).catch(o=>{throw e.keyLoadPromise=null,"data"in o&&(o.data.frag=t),o})}return Promise.resolve(n)}loadKeyHTTP(e,t){const n=this.config,r=n.loader,s=new r(n);return t.keyLoader=e.loader=s,e.keyLoadPromise=new Promise((o,a)=>{const l={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},c=n.keyLoadPolicy.default,u={loadPolicy:c,timeout:c.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},h={onSuccess:(f,d,m,A)=>{const{frag:g,keyInfo:y}=m,E=Jb(y.decryptdata);if(!g.decryptdata||y!==this.keyIdToKeyInfo[E])return a(this.createKeyLoadError(g,Ke.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),A));y.decryptdata.key=g.decryptdata.key=new Uint8Array(f.data),g.keyLoader=null,y.loader=null,o({frag:g,keyInfo:y})},onError:(f,d,m,A)=>{this.resetLoader(d),a(this.createKeyLoadError(t,Ke.KEY_LOAD_ERROR,new Error(`HTTP Error ${f.code} loading key ${f.text}`),m,Qi({url:l.url,data:void 0},f)))},onTimeout:(f,d,m)=>{this.resetLoader(d),a(this.createKeyLoadError(t,Ke.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),m))},onAbort:(f,d,m)=>{this.resetLoader(d),a(this.createKeyLoadError(t,Ke.INTERNAL_ABORTED,new Error("key loading aborted"),m))}};s.load(l,u,h)})}resetLoader(e){const{frag:t,keyInfo:n,url:r}=e,s=n.loader;t.keyLoader===s&&(t.keyLoader=null,n.loader=null);const o=Jb(n.decryptdata)||r;delete this.keyIdToKeyInfo[o],s&&s.destroy()}}function Jb(i){if(i.keyFormat!==xo.FAIRPLAY){const e=i.keyId;if(e)return Oo(e)}return i.uri}function Gk(i){const{type:e}=i;switch(e){case ai.AUDIO_TRACK:return Yt.AUDIO;case ai.SUBTITLE_TRACK:return Yt.SUBTITLE;default:return Yt.MAIN}}function Zb(i,e){let t=i.url;return(t===void 0||t.indexOf("data:")===0)&&(t=e.url),t}class U1e{constructor(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.onManifestLoaded=this.checkAutostartLoad,this.hls=e,this.registerListeners()}startLoad(e){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:e}=this;e.on(ae.MANIFEST_LOADING,this.onManifestLoading,this),e.on(ae.LEVEL_LOADING,this.onLevelLoading,this),e.on(ae.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(ae.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.on(ae.LEVELS_UPDATED,this.onLevelsUpdated,this)}unregisterListeners(){const{hls:e}=this;e.off(ae.MANIFEST_LOADING,this.onManifestLoading,this),e.off(ae.LEVEL_LOADING,this.onLevelLoading,this),e.off(ae.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(ae.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.off(ae.LEVELS_UPDATED,this.onLevelsUpdated,this)}createInternalLoader(e){const t=this.hls.config,n=t.pLoader,r=t.loader,s=n||r,o=new s(t);return this.loaders[e.type]=o,o}getInternalLoader(e){return this.loaders[e.type]}resetInternalLoader(e){this.loaders[e]&&delete this.loaders[e]}destroyInternalLoaders(){for(const e in this.loaders){const t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(e,t){const{url:n}=t;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:ai.MANIFEST,url:n,deliveryDirectives:null,levelOrTrack:null})}onLevelLoading(e,t){const{id:n,level:r,pathwayId:s,url:o,deliveryDirectives:a,levelInfo:l}=t;this.load({id:n,level:r,pathwayId:s,responseType:"text",type:ai.LEVEL,url:o,deliveryDirectives:a,levelOrTrack:l})}onAudioTrackLoading(e,t){const{id:n,groupId:r,url:s,deliveryDirectives:o,track:a}=t;this.load({id:n,groupId:r,level:null,responseType:"text",type:ai.AUDIO_TRACK,url:s,deliveryDirectives:o,levelOrTrack:a})}onSubtitleTrackLoading(e,t){const{id:n,groupId:r,url:s,deliveryDirectives:o,track:a}=t;this.load({id:n,groupId:r,level:null,responseType:"text",type:ai.SUBTITLE_TRACK,url:s,deliveryDirectives:o,levelOrTrack:a})}onLevelsUpdated(e,t){const n=this.loaders[ai.LEVEL];if(n){const r=n.context;r&&!t.levels.some(s=>s===r.levelOrTrack)&&(n.abort(),delete this.loaders[ai.LEVEL])}}load(e){var t;const n=this.hls.config;let r=this.getInternalLoader(e);if(r){const c=this.hls.logger,u=r.context;if(u&&u.levelOrTrack===e.levelOrTrack&&(u.url===e.url||u.deliveryDirectives&&!e.deliveryDirectives)){u.url===e.url?c.log(`[playlist-loader]: ignore ${e.url} ongoing request`):c.log(`[playlist-loader]: ignore ${e.url} in favor of ${u.url}`);return}c.log(`[playlist-loader]: aborting previous loader for type: ${e.type}`),r.abort()}let s;if(e.type===ai.MANIFEST?s=n.manifestLoadPolicy.default:s=er({},n.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),r=this.createInternalLoader(e),Wt((t=e.deliveryDirectives)==null?void 0:t.part)){let c;if(e.type===ai.LEVEL&&e.level!==null?c=this.hls.levels[e.level].details:e.type===ai.AUDIO_TRACK&&e.id!==null?c=this.hls.audioTracks[e.id].details:e.type===ai.SUBTITLE_TRACK&&e.id!==null&&(c=this.hls.subtitleTracks[e.id].details),c){const u=c.partTarget,h=c.targetduration;if(u&&h){const f=Math.max(u*3,h*.8)*1e3;s=er({},s,{maxTimeToFirstByteMs:Math.min(f,s.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(f,s.maxTimeToFirstByteMs)})}}}const o=s.errorRetry||s.timeoutRetry||{},a={loadPolicy:s,timeout:s.maxLoadTimeMs,maxRetry:o.maxNumRetry||0,retryDelay:o.retryDelayMs||0,maxRetryDelay:o.maxRetryDelayMs||0},l={onSuccess:(c,u,h,f)=>{const d=this.getInternalLoader(h);this.resetInternalLoader(h.type);const m=c.data;u.parsing.start=performance.now(),Au.isMediaPlaylist(m)||h.type!==ai.MANIFEST?this.handleTrackOrLevelPlaylist(c,u,h,f||null,d):this.handleMasterPlaylist(c,u,h,f)},onError:(c,u,h,f)=>{this.handleNetworkError(u,h,!1,c,f)},onTimeout:(c,u,h)=>{this.handleNetworkError(u,h,!0,void 0,c)}};r.load(e,a,l)}checkAutostartLoad(){if(!this.hls)return;const{config:{autoStartLoad:e,startPosition:t},forceStartLoad:n}=this.hls;(e||n)&&(this.hls.logger.log(`${e?"auto":"force"} startLoad with configured startPosition ${t}`),this.hls.startLoad(t))}handleMasterPlaylist(e,t,n,r){const s=this.hls,o=e.data,a=Zb(e,n),l=Au.parseMasterPlaylist(o,a);if(l.playlistParsingError){t.parsing.end=performance.now(),this.handleManifestParsingError(e,n,l.playlistParsingError,r,t);return}const{contentSteering:c,levels:u,sessionData:h,sessionKeys:f,startTimeOffset:d,variableList:m}=l;this.variableList=m,u.forEach(E=>{const{unknownCodecs:x}=E;if(x){const{preferManagedMediaSource:C}=this.hls.config;let{audioCodec:T,videoCodec:I}=E;for(let M=x.length;M--;){const L=x[M];H2(L,"audio",C)?(E.audioCodec=T=T?`${T},${L}`:L,oA.audio[T.substring(0,4)]=2,x.splice(M,1)):H2(L,"video",C)&&(E.videoCodec=I=I?`${I},${L}`:L,oA.video[I.substring(0,4)]=2,x.splice(M,1))}}});const{AUDIO:A=[],SUBTITLES:g,"CLOSED-CAPTIONS":y}=Au.parseMasterPlaylistMedia(o,a,l);A.length&&!A.some(x=>!x.url)&&u[0].audioCodec&&!u[0].attrs.AUDIO&&(this.hls.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),A.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new Br({}),bitrate:0,url:""})),s.trigger(ae.MANIFEST_LOADED,{levels:u,audioTracks:A,subtitles:g,captions:y,contentSteering:c,url:a,stats:t,networkDetails:r,sessionData:h,sessionKeys:f,startTimeOffset:d,variableList:m})}handleTrackOrLevelPlaylist(e,t,n,r,s){const o=this.hls,{id:a,level:l,type:c}=n,u=Zb(e,n),h=Wt(l)?l:Wt(a)?a:0,f=Gk(n),d=Au.parseLevelPlaylist(e.data,u,h,f,0,this.variableList);if(c===ai.MANIFEST){const m={attrs:new Br({}),bitrate:0,details:d,name:"",url:u};d.requestScheduled=t.loading.start+JQ(d,0),o.trigger(ae.MANIFEST_LOADED,{levels:[m],audioTracks:[],url:u,stats:t,networkDetails:r,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),n.levelDetails=d,this.handlePlaylistLoaded(d,e,t,n,r,s)}handleManifestParsingError(e,t,n,r,s){this.hls.trigger(ae.ERROR,{type:rn.NETWORK_ERROR,details:Ke.MANIFEST_PARSING_ERROR,fatal:t.type===ai.MANIFEST,url:e.url,err:n,error:n,reason:n.message,response:e,context:t,networkDetails:r,stats:s})}handleNetworkError(e,t,n=!1,r,s){let o=`A network ${n?"timeout":"error"+(r?" (status "+r.code+")":"")} occurred while loading ${e.type}`;e.type===ai.LEVEL?o+=`: ${e.level} id: ${e.id}`:(e.type===ai.AUDIO_TRACK||e.type===ai.SUBTITLE_TRACK)&&(o+=` id: ${e.id} group-id: "${e.groupId}"`);const a=new Error(o);this.hls.logger.warn(`[playlist-loader]: ${o}`);let l=Ke.UNKNOWN,c=!1;const u=this.getInternalLoader(e);switch(e.type){case ai.MANIFEST:l=n?Ke.MANIFEST_LOAD_TIMEOUT:Ke.MANIFEST_LOAD_ERROR,c=!0;break;case ai.LEVEL:l=n?Ke.LEVEL_LOAD_TIMEOUT:Ke.LEVEL_LOAD_ERROR,c=!1;break;case ai.AUDIO_TRACK:l=n?Ke.AUDIO_TRACK_LOAD_TIMEOUT:Ke.AUDIO_TRACK_LOAD_ERROR,c=!1;break;case ai.SUBTITLE_TRACK:l=n?Ke.SUBTITLE_TRACK_LOAD_TIMEOUT:Ke.SUBTITLE_LOAD_ERROR,c=!1;break}u&&this.resetInternalLoader(e.type);const h={type:rn.NETWORK_ERROR,details:l,fatal:c,url:e.url,loader:u,context:e,error:a,networkDetails:t,stats:s};if(r){const f=(t==null?void 0:t.url)||e.url;h.response=Qi({url:f,data:void 0},r)}this.hls.trigger(ae.ERROR,h)}handlePlaylistLoaded(e,t,n,r,s,o){const a=this.hls,{type:l,level:c,levelOrTrack:u,id:h,groupId:f,deliveryDirectives:d}=r,m=Zb(t,r),A=Gk(r);let g=typeof r.level=="number"&&A===Yt.MAIN?c:void 0;const y=e.playlistParsingError;if(y){if(this.hls.logger.warn(`${y} ${e.url}`),!a.config.ignorePlaylistParsingErrors){a.trigger(ae.ERROR,{type:rn.NETWORK_ERROR,details:Ke.LEVEL_PARSING_ERROR,fatal:!1,url:m,error:y,reason:y.message,response:t,context:r,level:g,parent:A,networkDetails:s,stats:n});return}e.playlistParsingError=null}if(!e.fragments.length){const E=e.playlistParsingError=new Error("No Segments found in Playlist");a.trigger(ae.ERROR,{type:rn.NETWORK_ERROR,details:Ke.LEVEL_EMPTY_ERROR,fatal:!1,url:m,error:E,reason:E.message,response:t,context:r,level:g,parent:A,networkDetails:s,stats:n});return}switch(e.live&&o&&(o.getCacheAge&&(e.ageHeader=o.getCacheAge()||0),(!o.getCacheAge||isNaN(e.ageHeader))&&(e.ageHeader=0)),l){case ai.MANIFEST:case ai.LEVEL:if(g){if(!u)g=0;else if(u!==a.levels[g]){const E=a.levels.indexOf(u);E>-1&&(g=E)}}a.trigger(ae.LEVEL_LOADED,{details:e,levelInfo:u||a.levels[0],level:g||0,id:h||0,stats:n,networkDetails:s,deliveryDirectives:d,withoutMultiVariant:l===ai.MANIFEST});break;case ai.AUDIO_TRACK:a.trigger(ae.AUDIO_TRACK_LOADED,{details:e,track:u,id:h||0,groupId:f||"",stats:n,networkDetails:s,deliveryDirectives:d});break;case ai.SUBTITLE_TRACK:a.trigger(ae.SUBTITLE_TRACK_LOADED,{details:e,track:u,id:h||0,groupId:f||"",stats:n,networkDetails:s,deliveryDirectives:d});break}}}class bf{static get version(){return V2}static isMSESupported(){return e8()}static isSupported(){return aW()}static getMediaSource(){return Uf()}static get Events(){return ae}static get MetadataSchema(){return Xa}static get ErrorTypes(){return rn}static get ErrorDetails(){return Ke}static get DefaultConfig(){return bf.defaultConfig?bf.defaultConfig:S1e}static set DefaultConfig(e){bf.defaultConfig=e}constructor(e={}){this.config=void 0,this.userConfig=void 0,this.logger=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new HR,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioStreamController=void 0,this.subtititleStreamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.interstitialsController=void 0,this.gapController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this._url=null,this._sessionId=void 0,this.triggeringException=void 0,this.started=!1;const t=this.logger=ape(e.debug||!1,"Hls instance",e.assetPlayerId),n=this.config=C1e(bf.DefaultConfig,e,t);this.userConfig=e,n.progressive&&T1e(n,t);const{abrController:r,bufferController:s,capLevelController:o,errorController:a,fpsController:l}=n,c=new a(this),u=this.abrController=new r(this),h=new Zpe(this),f=n.interstitialsController,d=f?this.interstitialsController=new f(this,bf):null,m=this.bufferController=new s(this,h),A=this.capLevelController=new o(this),g=new l(this),y=new U1e(this),E=n.contentSteeringController,x=E?new E(this):null,C=this.levelController=new D1e(this,x),T=new P1e(this),I=new N1e(this.config,this.logger),M=this.streamController=new O1e(this,h,I),L=this.gapController=new R1e(this,h);A.setStreamController(M),g.setStreamController(M);const R=[y,C,M];d&&R.splice(1,0,d),x&&R.splice(1,0,x),this.networkControllers=R;const P=[u,m,L,A,g,T,h];this.audioTrackController=this.createController(n.audioTrackController,R);const F=n.audioStreamController;F&&R.push(this.audioStreamController=new F(this,h,I)),this.subtitleTrackController=this.createController(n.subtitleTrackController,R);const k=n.subtitleStreamController;k&&R.push(this.subtititleStreamController=new k(this,h,I)),this.createController(n.timelineController,P),I.emeController=this.emeController=this.createController(n.emeController,P),this.cmcdController=this.createController(n.cmcdController,P),this.latencyController=this.createController(B1e,P),this.coreComponents=P,R.push(c);const z=c.onErrorOut;typeof z=="function"&&this.on(ae.ERROR,z,c),this.on(ae.MANIFEST_LOADED,y.onManifestLoaded,y)}createController(e,t){if(e){const n=new e(this);return t&&t.push(n),n}return null}on(e,t,n=this){this._emitter.on(e,t,n)}once(e,t,n=this){this._emitter.once(e,t,n)}removeAllListeners(e){this._emitter.removeAllListeners(e)}off(e,t,n=this,r){this._emitter.off(e,t,n,r)}listeners(e){return this._emitter.listeners(e)}emit(e,t,n){return this._emitter.emit(e,t,n)}trigger(e,t){if(this.config.debug)return this.emit(e,e,t);try{return this.emit(e,e,t)}catch(n){if(this.logger.error("An internal error happened while handling event "+e+'. Error message: "'+n.message+'". Here is a stacktrace:',n),!this.triggeringException){this.triggeringException=!0;const r=e===ae.ERROR;this.trigger(ae.ERROR,{type:rn.OTHER_ERROR,details:Ke.INTERNAL_EXCEPTION,fatal:r,event:e,error:n}),this.triggeringException=!1}}return!1}listenerCount(e){return this._emitter.listenerCount(e)}destroy(){this.logger.log("destroy"),this.trigger(ae.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this._url=null,this.networkControllers.forEach(t=>t.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(t=>t.destroy()),this.coreComponents.length=0;const e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null}attachMedia(e){if(!e||"media"in e&&!e.media){const s=new Error(`attachMedia failed: invalid argument (${e})`);this.trigger(ae.ERROR,{type:rn.OTHER_ERROR,details:Ke.ATTACH_MEDIA_ERROR,fatal:!0,error:s});return}this.logger.log("attachMedia"),this._media&&(this.logger.warn("media must be detached before attaching"),this.detachMedia());const t="media"in e,n=t?e.media:e,r=t?e:{media:n};this._media=n,this.trigger(ae.MEDIA_ATTACHING,r)}detachMedia(){this.logger.log("detachMedia"),this.trigger(ae.MEDIA_DETACHING,{}),this._media=null}transferMedia(){this._media=null;const e=this.bufferController.transferMedia();return this.trigger(ae.MEDIA_DETACHING,{transferMedia:e}),e}loadSource(e){this.stopLoad();const t=this.media,n=this._url,r=this._url=LR.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.logger.log(`loadSource:${r}`),t&&n&&(n!==r||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(t)),this.trigger(ae.MANIFEST_LOADING,{url:e})}get url(){return this._url}get hasEnoughToStart(){return this.streamController.hasEnoughToStart}get startPosition(){return this.streamController.startPositionValue}startLoad(e=-1,t){this.logger.log(`startLoad(${e+(t?", <skip seek to start>":"")})`),this.started=!0,this.resumeBuffering();for(let n=0;n<this.networkControllers.length&&(this.networkControllers[n].startLoad(e,t),!(!this.started||!this.networkControllers));n++);}stopLoad(){this.logger.log("stopLoad"),this.started=!1;for(let e=0;e<this.networkControllers.length&&(this.networkControllers[e].stopLoad(),!(this.started||!this.networkControllers));e++);}get loadingEnabled(){return this.started}get bufferingEnabled(){return this.streamController.bufferingEnabled}resumeBuffering(){this.bufferingEnabled||(this.logger.log("resume buffering"),this.networkControllers.forEach(e=>{e.resumeBuffering&&e.resumeBuffering()}))}pauseBuffering(){this.bufferingEnabled&&(this.logger.log("pause buffering"),this.networkControllers.forEach(e=>{e.pauseBuffering&&e.pauseBuffering()}))}get inFlightFragments(){const e={[Yt.MAIN]:this.streamController.inFlightFrag};return this.audioStreamController&&(e[Yt.AUDIO]=this.audioStreamController.inFlightFrag),this.subtititleStreamController&&(e[Yt.SUBTITLE]=this.subtititleStreamController.inFlightFrag),e}swapAudioCodec(){this.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){this.logger.log("recoverMediaError");const e=this._media,t=e==null?void 0:e.currentTime;this.detachMedia(),e&&(this.attachMedia(e),t&&this.startLoad(t))}removeLevel(e){this.levelController.removeLevel(e)}get sessionId(){let e=this._sessionId;return e||(e=this._sessionId=Dge()),e}get levels(){const e=this.levelController.levels;return e||[]}get latestLevelDetails(){return this.streamController.getLevelDetails()||null}get loadLevelObj(){return this.levelController.loadLevelObj}get currentLevel(){return this.streamController.currentLevel}set currentLevel(e){this.logger.log(`set currentLevel:${e}`),this.levelController.manualLevel=e,this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(e){this.logger.log(`set nextLevel:${e}`),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(e){this.logger.log(`set loadLevel:${e}`),this.levelController.manualLevel=e}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(e){this.levelController.nextLoadLevel=e}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(e){this.logger.log(`set firstLevel:${e}`),this.levelController.firstLevel=e}get startLevel(){const e=this.levelController.startLevel;return e===-1&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:e}set startLevel(e){this.logger.log(`set startLevel:${e}`),e!==-1&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(e){const t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimate():NaN}set bandwidthEstimate(e){this.abrController.resetEstimator(e)}get abrEwmaDefaultEstimate(){const{bwEstimator:e}=this.abrController;return e?e.defaultEstimate:NaN}get ttfbEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimateTTFB():NaN}set autoLevelCapping(e){this._autoLevelCapping!==e&&(this.logger.log(`set autoLevelCapping:${e}`),this._autoLevelCapping=e,this.levelController.checkMaxAutoUpdated())}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(e){Upe(e)&&this._maxHdcpLevel!==e&&(this._maxHdcpLevel=e,this.levelController.checkMaxAutoUpdated())}get autoLevelEnabled(){return this.levelController.manualLevel===-1}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:e,config:{minAutoBitrate:t}}=this;if(!e)return 0;const n=e.length;for(let r=0;r<n;r++)if(e[r].maxBitrate>=t)return r;return 0}get maxAutoLevel(){const{levels:e,autoLevelCapping:t,maxHdcpLevel:n}=this;let r;if(t===-1&&e!=null&&e.length?r=e.length-1:r=t,n)for(let s=r;s--;){const o=e[s].attrs["HDCP-LEVEL"];if(o&&o<=n)return s}return r}get firstAutoLevel(){return this.abrController.firstAutoLevel}get nextAutoLevel(){return this.abrController.nextAutoLevel}set nextAutoLevel(e){this.abrController.nextAutoLevel=e}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}get maxBufferLength(){return this.streamController.maxBufferLength}setAudioOption(e){var t;return((t=this.audioTrackController)==null?void 0:t.setAudioOption(e))||null}setSubtitleOption(e){var t;return((t=this.subtitleTrackController)==null?void 0:t.setSubtitleOption(e))||null}get allAudioTracks(){const e=this.audioTrackController;return e?e.allAudioTracks:[]}get audioTracks(){const e=this.audioTrackController;return e?e.audioTracks:[]}get audioTrack(){const e=this.audioTrackController;return e?e.audioTrack:-1}set audioTrack(e){const t=this.audioTrackController;t&&(t.audioTrack=e)}get allSubtitleTracks(){const e=this.subtitleTrackController;return e?e.allSubtitleTracks:[]}get subtitleTracks(){const e=this.subtitleTrackController;return e?e.subtitleTracks:[]}get subtitleTrack(){const e=this.subtitleTrackController;return e?e.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(e){const t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}get subtitleDisplay(){const e=this.subtitleTrackController;return e?e.subtitleDisplay:!1}set subtitleDisplay(e){const t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(e){this.config.lowLatencyMode=e}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}set targetLatency(e){this.latencyController.targetLatency=e}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}get pathways(){return this.levelController.pathways}get pathwayPriority(){return this.levelController.pathwayPriority}set pathwayPriority(e){this.levelController.pathwayPriority=e}get bufferedToEnd(){var e;return!!((e=this.bufferController)!=null&&e.bufferedToEnd)}get interstitialsManager(){var e;return((e=this.interstitialsController)==null?void 0:e.interstitialsManager)||null}getMediaDecodingInfo(e,t=this.allAudioTracks){const n=FQ(t);return DQ(e,n,navigator.mediaCapabilities)}}bf.defaultConfig=void 0;const z1e=Object.freeze(Object.defineProperty({__proto__:null,AbrController:OQ,AttrList:Br,AudioStreamController:wV,AudioTrackController:TV,BasePlaylistController:x4,BaseSegment:PR,BaseStreamController:y4,BufferController:IV,CMCDController:UV,CapLevelController:E4,ChunkMetadata:A4,ContentSteeringController:zV,Cues:rW,DateRange:NR,EMEController:Wm,ErrorActionFlags:$a,ErrorController:HQ,ErrorDetails:Ke,ErrorTypes:rn,Events:ae,FPSController:HV,FetchLoader:R5,Fragment:J_,Hls:bf,HlsSkip:o2,HlsUrlParameters:g5,KeySystemFormats:xo,KeySystems:Dr,Level:aA,LevelDetails:WQ,LevelKey:Df,LoadStats:m4,M3U8Parser:Au,MetadataSchema:Xa,NetworkErrorAction:Zs,Part:_Q,PlaylistLevelType:Yt,SubtitleStreamController:KV,SubtitleTrackController:WV,TimelineController:nW,XhrLoader:ZR,default:bf,fetchSupported:sW,getMediaSource:Uf,isMSESupported:e8,isSupported:aW,requestMediaKeySystemAccess:GR},Symbol.toStringTag,{value:"Module"})),G1e=((i,e)=>typeof window<"u"&&typeof((i=window.document)==null?void 0:i.createElement)=="function"&&typeof((e=window.navigator)==null?void 0:e.userAgent)=="string")();let eI=null;async function H1e(...i){var e;(e=eI)!==null&&e!==void 0||(eI=await k1(()=>Promise.resolve().then(()=>z1e),void 0,import.meta.url));const t=eI.default;return t.isSupported()?new t(...i):null}function lW(i,{unsuspend:e="loadedmetadata",start:t=!0,hls:n={},crossOrigin:r="anonymous",muted:s=!0,loop:o=!0,playsInline:a=!0,onVideoFrame:l,...c}={}){const u=Ve(m=>m.gl),h=w.useRef(null),f=Th(()=>new Promise(async m=>{let A,g;typeof i=="string"?A=i:g=i;const y=Object.assign(document.createElement("video"),{src:A,srcObject:g,crossOrigin:r,loop:o,muted:s,playsInline:a,...c});if(A&&G1e&&A.endsWith(".m3u8")){const x=h.current=await H1e(n);x&&(x.on(ae.MEDIA_ATTACHED,()=>void x.loadSource(A)),x.attachMedia(y))}const E=new XU(y);"colorSpace"in E?E.colorSpace=u.outputColorSpace:E.encoding=u.outputEncoding,y.addEventListener(e,()=>m(E))}),[i]),d=f.source.data;return Q1e(d,l),w.useEffect(()=>(t&&f.image.play(),()=>{h.current&&(h.current.destroy(),h.current=null)}),[f,t]),f}const S4=w.forwardRef(({children:i,src:e,...t},n)=>{const r=lW(e,t);return w.useEffect(()=>()=>void r.dispose(),[r]),w.useImperativeHandle(n,()=>r,[r]),w.createElement(w.Fragment,null,i==null?void 0:i(r))}),Q1e=(i,e)=>{w.useEffect(()=>{if(!e||!i.requestVideoFrameCallback)return;let t;const n=(...r)=>{e(...r),t=i.requestVideoFrameCallback(n)};return i.requestVideoFrameCallback(n),()=>i.cancelVideoFrameCallback(t)},[i,e])},u2=(i,e)=>{if(Array.isArray(i))return i[0];{const t=e??Object.keys(i)[0];return i[t][0]}},cW=i=>{for(let e=3;e<i.length;e+=4)if(i[e]!==0)return!1;return!0};function w4(i,e,t,n,r,s){const o=w.useRef(Ve(k=>k.viewport)),a=w.useRef(null),l=w.useRef(0),c=.1,u=w.useRef(i),h=w.useRef(e),f=w.useRef(t),[d,m]=w.useState(null),[A,g]=w.useState(new vi),y=w.useMemo(()=>new xh,[]),[E,x]=w.useState(null),C=w.useCallback((k,z,U)=>{const W=z*(o.current.aspect>k/z?o.current.width/k:o.current.height/z),oe=k*(o.current.aspect>k/z?o.current.width/k:o.current.height/z)*U,X=W*U,Q=1;let Y=Math.min(Q,oe),O=Math.min(Q,X);return oe>Q&&(Y=Q,O=X/oe*Q),new H(Y,O,1)},[]),T=w.useCallback((k,z)=>{if(k.image){const U=document.createElement("canvas"),W=U.getContext("2d",s);if(!W)throw new Error("Failed to get 2d context");U.width=k.image.width,U.height=k.image.height,W.drawImage(k.image,0,0);const $=k.image.width,oe=k.image.height,X=Math.round(Math.sqrt(z*($/oe))),Q=Math.round(z/X),Y=$/X,O=oe/Q,K=[];for(let te=0;te<Q;te++)for(let q=0;q<X;q++){if(te*X+q>=z){K.push({row:te,col:q});continue}const ie=W.getImageData(q*Y,te*O,Y,O).data;cW(ie)&&K.push({row:te,col:q})}return{rows:Q,columns:X,frameWidth:Y,frameHeight:O,emptyFrames:K}}else return{rows:0,columns:0,frameWidth:0,frameHeight:0,emptyFrames:[]}},[s]),I=w.useCallback(k=>{const z=U=>{let W=null;for(const oe of U){const{w:X,h:Q}=oe.frame,Y=X*Q;(!W||Y>W.area)&&(W={w:X,h:Q,area:Y})}return U.map(oe=>{const{w:X,h:Q}=oe.frame,Y=X*Q,O=W?Y===W.area?1:Math.sqrt(Y/W.area):1;return{...oe,scaleRatio:O}})};if(Array.isArray(k))return z(k);{const U={};for(const W in k)U[W]=z(k[W]);return U}},[]),M=w.useCallback(()=>{const k={},z=a.current,U=f.current;if(z)if(U&&Array.isArray(z.frames)){for(let W=0;W<U.length;W++){k[U[W]]=[];for(const $ of z.frames){const oe=$.frame,X=$.sourceSize.w,Q=$.sourceSize.h;typeof $.filename=="string"&&$.filename.toLowerCase().indexOf(U[W].toLowerCase())!==-1&&k[U[W]].push({...$,frame:oe,sourceSize:{w:X,h:Q}})}}for(const W in k){const $=I(k[W]);Array.isArray($)&&(k[W]=$)}return k}else if(U&&typeof z.frames=="object"){for(let W=0;W<U.length;W++){k[U[W]]=[];for(const $ in z.frames){const oe=z.frames[$],X=oe.frame,Q=oe.sourceSize.w,Y=oe.sourceSize.h;typeof $=="string"&&$.toLowerCase().indexOf(U[W].toLowerCase())!==-1&&k[U[W]].push({...oe,frame:X,sourceSize:{w:Q,h:Y}})}}for(const W in k){const $=I(k[W]);Array.isArray($)&&(k[W]=$)}return k}else{let W=[];return z!=null&&z.frames&&(Array.isArray(z.frames)?W=z.frames.map($=>({...$,x:$.frame.x,y:$.frame.y,w:$.frame.w,h:$.frame.h})):W=Object.values(z.frames).flat().map($=>({...$,x:$.frame.x,y:$.frame.y,w:$.frame.w,h:$.frame.h}))),I(W)}return[]},[I,a]),L=w.useCallback((k,z)=>{let U=new H(1,1,1);if(k===null){if(z&&n){const W=z.image.width,$=z.image.height;l.current=n;const{rows:oe,columns:X,frameWidth:Q,frameHeight:Y,emptyFrames:O}=T(z,n),K={frames:[],meta:{version:"1.0",size:{w:W,h:$},rows:oe,columns:X,frameWidth:Q,frameHeight:Y,scale:"1"}};for(let te=0;te<oe;te++)for(let q=0;q<X;q++)(O??[]).some(ie=>ie.row===te&&ie.col===q)||Array.isArray(K.frames)&&K.frames.push({frame:{x:q*Q,y:te*Y,w:Q,h:Y},scaleRatio:1,rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:Q,h:Y},sourceSize:{w:Q,h:Y}});U=C(Q,Y,c),a.current=K}a.current&&a.current.frames&&(a.current.frames=I(a.current.frames))}else if(z){a.current=k,a.current.frames=M(),l.current=Array.isArray(k.frames)?k.frames.length:Object.keys(k.frames).length;const{w:W,h:$}=u2(k.frames).sourceSize;U=C(W,$,c)}m(a.current),"encoding"in z?z.encoding=3001:"colorSpace"in z&&(z.colorSpace=gs),g(z),x({spriteTexture:z,spriteData:a.current,aspect:U})},[T,n,M,C,I]),R=w.useCallback((k,z,U)=>{const W=fetch(k).then(oe=>oe.json()),$=new Promise(oe=>{y.load(z,oe)});Promise.all([W,$]).then(oe=>{U(oe[0],oe[1])})},[y]),P=w.useCallback(k=>{if(!k&&!u.current)throw new Error("Either textureUrl or input must be provided");const z=k??u.current;if(!z)throw new Error("A valid texture URL must be provided");y.load(z,U=>L(null,U))},[y,L]),F=w.useCallback((k,z)=>{z&&k?R(z,k,L):P(k)},[R,P,L]);return w.useLayoutEffect(()=>{h.current&&u.current?R(h.current,u.current,L):u.current&&P();const k=u.current;return()=>{k&&cr.clear(xh,k)}},[R,P,L]),w.useLayoutEffect(()=>{r==null||r(A,d??null)},[A,d,r]),{spriteObj:E,loadJsonAndTexture:F}}w4.preload=i=>cr.preload(xh,i);w4.clear=i=>cr.clear(xh,i);function t8(i,e,...t){const n=w.useRef(),r=Ve(s=>s.scene);return w.useLayoutEffect(()=>{let s;if(i&&i!=null&&i.current&&e&&(n.current=s=new e(i.current,...t)),s)return s.traverse(o=>o.raycast=()=>null),r.add(s),()=>{n.current=void 0,r.remove(s),s.dispose==null||s.dispose()}},[r,e,i,...t]),Kt(()=>{var s;return void((s=n.current)==null||s.update==null?void 0:s.update())}),n}const V1e=({type:i,args:e=[]})=>{const t=w.useRef(null),n=w.useRef(null);return w.useLayoutEffect(()=>{n.current=t.current.parent}),t8(n,i,...e),w.createElement("object3D",{ref:t})};var oS={exports:{}},W1e=oS.exports,Hk;function j1e(){return Hk||(Hk=1,(function(i,e){(function(t,n){i.exports=n()})(W1e,function(){var t=function(){function n(d){return o.appendChild(d.dom),d}function r(d){for(var m=0;m<o.children.length;m++)o.children[m].style.display=m===d?"block":"none";s=d}var s=0,o=document.createElement("div");o.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",o.addEventListener("click",function(d){d.preventDefault(),r(++s%o.children.length)},!1);var a=(performance||Date).now(),l=a,c=0,u=n(new t.Panel("FPS","#0ff","#002")),h=n(new t.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var f=n(new t.Panel("MB","#f08","#201"));return r(0),{REVISION:16,dom:o,addPanel:n,showPanel:r,begin:function(){a=(performance||Date).now()},end:function(){c++;var d=(performance||Date).now();if(h.update(d-a,200),d>l+1e3&&(u.update(1e3*c/(d-l),100),l=d,c=0,f)){var m=performance.memory;f.update(m.usedJSHeapSize/1048576,m.jsHeapSizeLimit/1048576)}return d},update:function(){a=this.end()},domElement:o,setMode:r}};return t.Panel=function(n,r,s){var o=1/0,a=0,l=Math.round,c=l(window.devicePixelRatio||1),u=80*c,h=48*c,f=3*c,d=2*c,m=3*c,A=15*c,g=74*c,y=30*c,E=document.createElement("canvas");E.width=u,E.height=h,E.style.cssText="width:80px;height:48px";var x=E.getContext("2d");return x.font="bold "+9*c+"px Helvetica,Arial,sans-serif",x.textBaseline="top",x.fillStyle=s,x.fillRect(0,0,u,h),x.fillStyle=r,x.fillText(n,f,d),x.fillRect(m,A,g,y),x.fillStyle=s,x.globalAlpha=.9,x.fillRect(m,A,g,y),{dom:E,update:function(C,T){o=Math.min(o,C),a=Math.max(a,C),x.fillStyle=s,x.globalAlpha=1,x.fillRect(0,0,u,A),x.fillStyle=r,x.fillText(l(C)+" "+n+" ("+l(o)+"-"+l(a)+")",f,d),x.drawImage(E,m+c,A,g-c,y,m,A,g-c,y),x.fillRect(m+g-c,A,c,y),x.fillStyle=s,x.globalAlpha=.9,x.fillRect(m+g-c,A,c,l((1-C/T)*y))}}},t})})(oS)),oS.exports}var K1e=j1e();const $1e=AA(K1e);function Y1e(i,e=[],t){const[n,r]=w.useState();return w.useLayoutEffect(()=>{const s=i();return r(s),()=>void 0},e),n}function X1e({showPanel:i=0,className:e,parent:t}){const n=Y1e(()=>new $1e,[]);return w.useEffect(()=>{if(n){const r=t&&t.current||document.body;n.showPanel(i),r==null||r.appendChild(n.dom);const s=(e??"").split(" ").filter(l=>l);s.length&&n.dom.classList.add(...s);const o=Yw(()=>n.begin()),a=Xw(()=>n.end());return()=>{s.length&&n.dom.classList.remove(...s),r==null||r.removeChild(n.dom),o(),a()}}},[t,n,e,i]),null}class q1e{constructor(e,t,n){this.name=e,this.fg=t,this.bg=n,this.gradient=null,this.PR=Math.round(window.devicePixelRatio||1),this.WIDTH=90*this.PR,this.HEIGHT=48*this.PR,this.TEXT_X=3*this.PR,this.TEXT_Y=2*this.PR,this.GRAPH_X=3*this.PR,this.GRAPH_Y=15*this.PR,this.GRAPH_WIDTH=84*this.PR,this.GRAPH_HEIGHT=30*this.PR,this.canvas=document.createElement("canvas"),this.canvas.width=this.WIDTH,this.canvas.height=this.HEIGHT,this.canvas.style.width="90px",this.canvas.style.height="48px",this.canvas.style.position="absolute",this.canvas.style.cssText="width:90px;height:48px",this.context=this.canvas.getContext("2d"),this.initializeCanvas()}createGradient(){if(!this.context)throw new Error("No context");const e=this.context.createLinearGradient(0,this.GRAPH_Y,0,this.GRAPH_Y+this.GRAPH_HEIGHT);let t;const n=this.fg;switch(this.fg.toLowerCase()){case"#0ff":t="#006666";break;case"#0f0":t="#006600";break;case"#ff0":t="#666600";break;case"#e1e1e1":t="#666666";break;default:t=this.bg;break}return e.addColorStop(0,t),e.addColorStop(1,n),e}initializeCanvas(){this.context&&(this.context.font="bold "+9*this.PR+"px Helvetica,Arial,sans-serif",this.context.textBaseline="top",this.gradient=this.createGradient(),this.context.fillStyle=this.bg,this.context.fillRect(0,0,this.WIDTH,this.HEIGHT),this.context.fillStyle=this.fg,this.context.fillText(this.name,this.TEXT_X,this.TEXT_Y),this.context.fillStyle=this.fg,this.context.fillRect(this.GRAPH_X,this.GRAPH_Y,this.GRAPH_WIDTH,this.GRAPH_HEIGHT),this.context.fillStyle=this.bg,this.context.globalAlpha=.9,this.context.fillRect(this.GRAPH_X,this.GRAPH_Y,this.GRAPH_WIDTH,this.GRAPH_HEIGHT))}update(e,t,n,r,s=0){if(!this.context||!this.gradient)return;const o=Math.min(1/0,e),a=Math.max(n,e);r=Math.max(r,t),this.context.globalAlpha=1,this.context.fillStyle=this.bg,this.context.fillRect(0,0,this.WIDTH,this.GRAPH_Y),this.context.fillStyle=this.fg,this.context.fillText(`${e.toFixed(s)} ${this.name} (${o.toFixed(s)}-${parseFloat(a.toFixed(s))})`,this.TEXT_X,this.TEXT_Y),this.context.drawImage(this.canvas,this.GRAPH_X+this.PR,this.GRAPH_Y,this.GRAPH_WIDTH-this.PR,this.GRAPH_HEIGHT,this.GRAPH_X,this.GRAPH_Y,this.GRAPH_WIDTH-this.PR,this.GRAPH_HEIGHT);const l=this.GRAPH_HEIGHT-(1-t/r)*this.GRAPH_HEIGHT;l>0&&(this.context.globalAlpha=1,this.context.fillStyle=this.gradient,this.context.fillRect(this.GRAPH_X+this.GRAPH_WIDTH-this.PR,this.GRAPH_Y+this.GRAPH_HEIGHT-l,this.PR,l))}}const uW=class w1{constructor({trackGPU:e=!1,logsPerSecond:t=30,samplesLog:n=60,samplesGraph:r=10,precision:s=2,minimal:o=!1,horizontal:a=!0,mode:l=0}={}){this.gl=null,this.ext=null,this.activeQuery=null,this.gpuQueries=[],this.threeRendererPatched=!1,this.frames=0,this.renderCount=0,this.isRunningCPUProfiling=!1,this.totalCpuDuration=0,this.totalGpuDuration=0,this.totalGpuDurationCompute=0,this.totalFps=0,this.gpuPanel=null,this.gpuPanelCompute=null,this.averageFps={logs:[],graph:[]},this.averageCpu={logs:[],graph:[]},this.averageGpu={logs:[],graph:[]},this.averageGpuCompute={logs:[],graph:[]},this.handleClick=c=>{c.preventDefault(),this.showPanel(++this.mode%this.dom.children.length)},this.handleResize=()=>{this.resizePanel(this.fpsPanel,0),this.resizePanel(this.msPanel,1),this.gpuPanel&&this.resizePanel(this.gpuPanel,2),this.gpuPanelCompute&&this.resizePanel(this.gpuPanelCompute,3)},this.mode=l,this.horizontal=a,this.minimal=o,this.trackGPU=e,this.samplesLog=n,this.samplesGraph=r,this.precision=s,this.logsPerSecond=t,this.dom=document.createElement("div"),this.initializeDOM(),this.beginTime=performance.now(),this.prevTime=this.beginTime,this.prevCpuTime=this.beginTime,this.fpsPanel=this.addPanel(new w1.Panel("FPS","#0ff","#002"),0),this.msPanel=this.addPanel(new w1.Panel("CPU","#0f0","#020"),1),this.setupEventListeners()}initializeDOM(){this.dom.style.cssText=`
      position: fixed;
      top: 0;
      left: 0;
      opacity: 0.9;
      z-index: 10000;
      ${this.minimal?"cursor: pointer;":""}
    `}setupEventListeners(){this.minimal?(this.dom.addEventListener("click",this.handleClick),this.showPanel(this.mode)):window.addEventListener("resize",this.handleResize)}async init(e){if(!e){console.error('Stats: The "canvas" parameter is undefined.');return}this.handleThreeRenderer(e)||await this.handleWebGPURenderer(e)||this.initializeWebGL(e)}handleThreeRenderer(e){return e.isWebGLRenderer&&!this.threeRendererPatched?(this.patchThreeRenderer(e),this.gl=e.getContext(),this.trackGPU&&this.initializeGPUTracking(),!0):!1}async handleWebGPURenderer(e){return e.isWebGPURenderer?(this.trackGPU&&(e.backend.trackTimestamp=!0,await e.hasFeatureAsync("timestamp-query")&&this.initializeWebGPUPanels()),this.info=e.info,!0):!1}initializeWebGPUPanels(){this.gpuPanel=this.addPanel(new w1.Panel("GPU","#ff0","#220"),2),this.gpuPanelCompute=this.addPanel(new w1.Panel("CPT","#e1e1e1","#212121"),3)}initializeWebGL(e){if(e instanceof WebGL2RenderingContext)this.gl=e;else if(e instanceof HTMLCanvasElement||e instanceof OffscreenCanvas){if(this.gl=e.getContext("webgl2"),!this.gl)return console.error("Stats: Unable to obtain WebGL2 context."),!1}else return console.error("Stats: Invalid input type. Expected WebGL2RenderingContext, HTMLCanvasElement, or OffscreenCanvas."),!1;return!0}initializeGPUTracking(){this.gl&&(this.ext=this.gl.getExtension("EXT_disjoint_timer_query_webgl2"),this.ext&&(this.gpuPanel=this.addPanel(new w1.Panel("GPU","#ff0","#220"),2)))}begin(){this.isRunningCPUProfiling||this.beginProfiling("cpu-started"),!(!this.gl||!this.ext)&&(this.activeQuery&&this.gl.endQuery(this.ext.TIME_ELAPSED_EXT),this.activeQuery=this.gl.createQuery(),this.activeQuery&&this.gl.beginQuery(this.ext.TIME_ELAPSED_EXT,this.activeQuery))}end(){this.renderCount++,this.gl&&this.ext&&this.activeQuery&&(this.gl.endQuery(this.ext.TIME_ELAPSED_EXT),this.gpuQueries.push({query:this.activeQuery}),this.activeQuery=null)}update(){this.info?this.processWebGPUTimestamps():this.processGpuQueries(),this.endProfiling("cpu-started","cpu-finished","cpu-duration"),this.updateAverages(),this.resetCounters()}processWebGPUTimestamps(){this.totalGpuDuration=this.info.render.timestamp,this.totalGpuDurationCompute=this.info.compute.timestamp,this.addToAverage(this.totalGpuDurationCompute,this.averageGpuCompute)}updateAverages(){this.addToAverage(this.totalCpuDuration,this.averageCpu),this.addToAverage(this.totalGpuDuration,this.averageGpu)}resetCounters(){this.renderCount=0,this.totalCpuDuration===0&&this.beginProfiling("cpu-started"),this.totalCpuDuration=0,this.totalFps=0,this.beginTime=this.endInternal()}resizePanel(e,t){e.canvas.style.position="absolute",this.minimal?e.canvas.style.display="none":(e.canvas.style.display="block",this.horizontal?(e.canvas.style.top="0px",e.canvas.style.left=t*e.WIDTH/e.PR+"px"):(e.canvas.style.left="0px",e.canvas.style.top=t*e.HEIGHT/e.PR+"px"))}addPanel(e,t){return e.canvas&&(this.dom.appendChild(e.canvas),this.resizePanel(e,t)),e}showPanel(e){for(let t=0;t<this.dom.children.length;t++){const n=this.dom.children[t];n.style.display=t===e?"block":"none"}this.mode=e}processGpuQueries(){!this.gl||!this.ext||(this.totalGpuDuration=0,this.gpuQueries.forEach((e,t)=>{if(this.gl){const n=this.gl.getQueryParameter(e.query,this.gl.QUERY_RESULT_AVAILABLE),r=this.gl.getParameter(this.ext.GPU_DISJOINT_EXT);if(n&&!r){const o=this.gl.getQueryParameter(e.query,this.gl.QUERY_RESULT)*1e-6;this.totalGpuDuration+=o,this.gl.deleteQuery(e.query),this.gpuQueries.splice(t,1)}}}))}endInternal(){this.frames++;const e=(performance||Date).now(),t=e-this.prevTime;if(e>=this.prevCpuTime+1e3/this.logsPerSecond){const n=Math.round(this.frames*1e3/t);this.addToAverage(n,this.averageFps),this.updatePanel(this.fpsPanel,this.averageFps,0),this.updatePanel(this.msPanel,this.averageCpu,this.precision),this.updatePanel(this.gpuPanel,this.averageGpu,this.precision),this.gpuPanelCompute&&this.updatePanel(this.gpuPanelCompute,this.averageGpuCompute),this.frames=0,this.prevCpuTime=e,this.prevTime=e}return e}addToAverage(e,t){t.logs.push(e),t.logs.length>this.samplesLog&&t.logs.shift(),t.graph.push(e),t.graph.length>this.samplesGraph&&t.graph.shift()}beginProfiling(e){window.performance&&(window.performance.mark(e),this.isRunningCPUProfiling=!0)}endProfiling(e,t,n){if(window.performance&&t&&this.isRunningCPUProfiling){window.performance.mark(t);const r=performance.measure(n,e,t);this.totalCpuDuration+=r.duration,this.isRunningCPUProfiling=!1}}updatePanel(e,t,n=2){if(t.logs.length>0){let r=0,s=.01;for(let l=0;l<t.logs.length;l++)r+=t.logs[l],t.logs[l]>s&&(s=t.logs[l]);let o=0,a=.01;for(let l=0;l<t.graph.length;l++)o+=t.graph[l],t.graph[l]>a&&(a=t.graph[l]);e&&e.update(r/Math.min(t.logs.length,this.samplesLog),o/Math.min(t.graph.length,this.samplesGraph),s,a,n)}}get domElement(){return this.dom}patchThreeRenderer(e){const t=e.render,n=this;e.render=function(r,s){n.begin(),t.call(this,r,s),n.end()},this.threeRendererPatched=!0}};uW.Panel=q1e;let J1e=uW;const Z1e=w.forwardRef(function({className:e,parent:t,id:n,clearStatsGlStyle:r,...s},o){const a=Ve(c=>c.gl),l=w.useMemo(()=>{const c=new J1e({...s});return c.init(a),c},[a]);return w.useImperativeHandle(o,()=>l.domElement,[l]),w.useEffect(()=>{if(l){const c=t&&t.current||document.body;c==null||c.appendChild(l.domElement),l.domElement.querySelectorAll("canvas").forEach(f=>{f.style.removeProperty("position")}),n&&(l.domElement.id=n),r&&l.domElement.removeAttribute("style"),l.domElement.removeAttribute("style");const u=(e??"").split(" ").filter(f=>f);u.length&&l.domElement.classList.add(...u);const h=Xw(()=>l.update());return()=>{u.length&&l.domElement.classList.remove(...u),c==null||c.removeChild(l.domElement),h()}}},[t,l,e,n,r]),null});function eAe({size:i=256,frames:e=1/0}={}){const t=Ve(u=>u.viewport.dpr),{width:n,height:r}=Ve(u=>u.size),s=i||n*t,o=i||r*t,a=w.useMemo(()=>{const u=new f0(s,o);return u.format=vu,u.type=pp,{depthTexture:u}},[s,o]);let l=0;const c=Ea(s,o,a);return Kt(u=>{(e===1/0||l<e)&&(u.gl.setRenderTarget(c),u.gl.render(u.scene,u.camera),u.gl.setRenderTarget(null),l++)}),c.depthTexture}function tAe(i,e,t=1){const n=Ve(o=>o.viewport),r=e*(n.aspect>i/e?n.width/i:n.height/e);return[i*(n.aspect>i/e?n.width/i:n.height/e)*t,r*t,1]}function nAe(i,e){const t=Ve(r=>r.pointer),[n]=w.useState(()=>{const r=new A0;return e&&Os(r,e,{}),function(s,o){r.setFromCamera(t,i instanceof u0?i:i.current);const a=this.constructor.prototype.raycast.bind(this);a&&a(r,o)}});return n}function tI(i,e,t,n){return new(t||(t=Promise))((function(r,s){function o(c){try{l(n.next(c))}catch(u){s(u)}}function a(c){try{l(n.throw(c))}catch(u){s(u)}}function l(c){var u;c.done?r(c.value):(u=c.value,u instanceof t?u:new t((function(h){h(u)}))).then(o,a)}l((n=n.apply(i,[])).next())}))}const iAe=["geforce 320m","geforce 8600","geforce 8600m gt","geforce 8800 gs","geforce 8800 gt","geforce 9400","geforce 9400m g","geforce 9400m","geforce 9600m gt","geforce 9600m","geforce fx go5200","geforce gt 120","geforce gt 130","geforce gt 330m","geforce gtx 285","google swiftshader","intel g41","intel g45","intel gma 4500mhd","intel gma x3100","intel hd 3000","intel q45","legacy","mali-2","mali-3","mali-4","quadro fx 1500","quadro fx 4","quadro fx 5","radeon hd 2400","radeon hd 2600","radeon hd 4670","radeon hd 4850","radeon hd 4870","radeon hd 5670","radeon hd 5750","radeon hd 6290","radeon hd 6300","radeon hd 6310","radeon hd 6320","radeon hd 6490m","radeon hd 6630m","radeon hd 6750m","radeon hd 6770m","radeon hd 6970m","sgx 543","sgx543"];function Qk(i){return i=i.toLowerCase().replace(/.*angle ?\((.+)\)(?: on vulkan [0-9.]+)?$/i,"$1").replace(/\s(\d{1,2}gb|direct3d.+$)|\(r\)| \([^)]+\)$/g,"").replace(/(?:vulkan|opengl) \d+\.\d+(?:\.\d+)?(?: \((.*)\))?/,"$1")}const hW=typeof window>"u",ch=(()=>{if(hW)return;const{userAgent:i,platform:e,maxTouchPoints:t}=window.navigator,n=/(iphone|ipod|ipad)/i.test(i),r=e==="iPad"||e==="MacIntel"&&t>0&&!window.MSStream;return{isIpad:r,isMobile:/android/i.test(i)||n||r,isSafari12:/Version\/12.+Safari/.test(i),isFirefox:/Firefox/.test(i)}})();function rAe(i,e,t){if(!t)return[e];const n=(function(c){const u=`
    precision highp float;
    attribute vec3 aPosition;
    varying float vvv;
    void main() {
      vvv = 0.31622776601683794;
      gl_Position = vec4(aPosition, 1.0);
    }
  `,h=`
    precision highp float;
    varying float vvv;
    void main() {
      vec4 enc = vec4(1.0, 255.0, 65025.0, 16581375.0) * vvv;
      enc = fract(enc);
      enc -= enc.yzww * vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0, 0.0);
      gl_FragColor = enc;
    }
  `,f=c.createShader(35633),d=c.createShader(35632),m=c.createProgram();if(!(d&&f&&m))return;c.shaderSource(f,u),c.shaderSource(d,h),c.compileShader(f),c.compileShader(d),c.attachShader(m,f),c.attachShader(m,d),c.linkProgram(m),c.detachShader(m,f),c.detachShader(m,d),c.deleteShader(f),c.deleteShader(d),c.useProgram(m);const A=c.createBuffer();c.bindBuffer(34962,A),c.bufferData(34962,new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),35044);const g=c.getAttribLocation(m,"aPosition");c.vertexAttribPointer(g,3,5126,!1,0,0),c.enableVertexAttribArray(g),c.clearColor(1,1,1,1),c.clear(16384),c.viewport(0,0,1,1),c.drawArrays(4,0,3);const y=new Uint8Array(4);return c.readPixels(0,0,1,1,6408,5121,y),c.deleteProgram(m),c.deleteBuffer(A),y.join("")})(i),r="801621810",s="8016218135",o="80162181161",a=ch!=null&&ch.isIpad?[["a7",o,12],["a8",s,15],["a8x",s,15],["a9",s,15],["a9x",s,15],["a10",s,15],["a10x",s,15],["a12",r,15],["a12x",r,15],["a12z",r,15],["a14",r,15],["a15",r,15],["m1",r,15],["m2",r,15]]:[["a7",o,12],["a8",s,12],["a9",s,15],["a10",s,15],["a11",r,15],["a12",r,15],["a13",r,15],["a14",r,15],["a15",r,15],["a16",r,15],["a17",r,15]];let l;return n==="80162181255"?l=a.filter((([,,c])=>c>=14)):(l=a.filter((([,c])=>c===n)),l.length||(l=a)),l.map((([c])=>`apple ${c} gpu`))}let Vk=class extends Error{constructor(e){super(e),Object.setPrototypeOf(this,new.target.prototype)}};const nI=[],Wk=[];function sAe(i,e){if(i===e)return 0;const t=i;i.length>e.length&&(i=e,e=t);let n=i.length,r=e.length;for(;n>0&&i.charCodeAt(~-n)===e.charCodeAt(~-r);)n--,r--;let s,o=0;for(;o<n&&i.charCodeAt(o)===e.charCodeAt(o);)o++;if(n-=o,r-=o,n===0)return r;let a,l,c=0,u=0,h=0;for(;u<n;)Wk[u]=i.charCodeAt(o+u),nI[u]=++u;for(;h<r;)for(s=e.charCodeAt(o+h),a=h++,c=h,u=0;u<n;u++)l=s===Wk[u]?a:a+1,a=nI[u],c=nI[u]=a>c?l>c?c+1:l:l>a?a+1:l;return c}function oAe(i){return i!=null}const aAe=({mobileTiers:i=[0,15,30,60],desktopTiers:e=[0,15,30,60],override:t={},glContext:n,failIfMajorPerformanceCaveat:r=!1,benchmarksURL:s="https://unpkg.com/detect-gpu@5.0.70/dist/benchmarks"}={})=>tI(void 0,void 0,void 0,(function*(){const o={};if(hW)return{tier:0,type:"SSR"};const{isIpad:a=!!(ch!=null&&ch.isIpad),isMobile:l=!!(ch!=null&&ch.isMobile),screenSize:c=window.screen,loadBenchmarks:u=(T=>tI(void 0,void 0,void 0,(function*(){const I=yield fetch(`${s}/${T}`).then((M=>M.json()));if(parseInt(I.shift().split(".")[0],10)<4)throw new Vk("Detect GPU benchmark data is out of date. Please update to version 4x");return I})))}=t;let{renderer:h}=t;const f=(T,I,M,L,R)=>({device:R,fps:L,gpu:M,isMobile:l,tier:T,type:I});let d,m="";if(h)h=Qk(h),d=[h];else{const T=n||(function(M,L=!1){const R={alpha:!1,antialias:!1,depth:!1,failIfMajorPerformanceCaveat:L,powerPreference:"high-performance",stencil:!1};M&&delete R.powerPreference;const P=window.document.createElement("canvas"),F=P.getContext("webgl",R)||P.getContext("experimental-webgl",R);return F??void 0})(ch==null?void 0:ch.isSafari12,r);if(!T)return f(0,"WEBGL_UNSUPPORTED");const I=ch!=null&&ch.isFirefox?null:T.getExtension("WEBGL_debug_renderer_info");if(h=I?T.getParameter(I.UNMASKED_RENDERER_WEBGL):T.getParameter(T.RENDERER),!h)return f(1,"FALLBACK");m=h,h=Qk(h),d=(function(M,L,R){return L==="apple gpu"?rAe(M,L,R):[L]})(T,h,l)}const A=(yield Promise.all(d.map((function(T){var I;return tI(this,void 0,void 0,(function*(){const M=(te=>{const q=l?["adreno","apple","mali-t","mali","nvidia","powervr","samsung"]:["intel","apple","amd","radeon","nvidia","geforce","adreno"];for(const J of q)if(te.includes(J))return J})(T);if(!M)return;const L=`${l?"m":"d"}-${M}${a?"-ipad":""}.json`,R=o[L]=(I=o[L])!==null&&I!==void 0?I:u(L);let P;try{P=yield R}catch(te){if(te instanceof Vk)throw te;return}const F=(function(te){var q;const J=(te=te.replace(/\([^)]+\)/,"")).match(/\d+/)||te.match(/(\W|^)([A-Za-z]{1,3})(\W|$)/g);return(q=J==null?void 0:J.join("").replace(/\W|amd/g,""))!==null&&q!==void 0?q:""})(T);let k=P.filter((([,te])=>te===F));k.length||(k=P.filter((([te])=>te.includes(T))));const z=k.length;if(z===0)return;const U=T.split(/[.,()\[\]/\s]/g).sort().filter(((te,q,J)=>q===0||te!==J[q-1])).join(" ");let W,[$,,,,oe]=z>1?k.map((te=>[te,sAe(U,te[2])])).sort((([,te],[,q])=>te-q))[0][0]:k[0],X=Number.MAX_VALUE;const{devicePixelRatio:Q}=window,Y=c.width*Q*c.height*Q;for(const te of oe){const[q,J]=te,ie=q*J,re=Math.abs(Y-ie);re<X&&(X=re,W=te)}if(!W)return;const[,,O,K]=W;return[X,O,$,K]}))})))).filter(oAe).sort((([T=Number.MAX_VALUE,I],[M=Number.MAX_VALUE,L])=>T===M?I-L:T-M));if(!A.length){const T=iAe.find((I=>h.includes(I)));return T?f(0,"BLOCKLISTED",T):f(1,"FALLBACK",`${h} (${m})`)}const[,g,y,E]=A[0];if(g===-1)return f(0,"BLOCKLISTED",y,g,E);const x=l?i:e;let C=0;for(let T=0;T<x.length;T++)g>=x[T]&&(C=T);return f(C,"BENCHMARK",y,g,E)})),fW=i=>Th(()=>aAe(i),["useDetectGPU"]);function lAe({children:i,...e}){const t=fW(e);return w.createElement(w.Fragment,null,i==null?void 0:i(t))}const dW=0,cAe=1,C4=2,jk=2,iI=1.25,Kk=1,Jd=32,T4=65535,uAe=Math.pow(2,-24),rI=Symbol("SKIP_GENERATION");function pW(i){return i.index?i.index.count:i.attributes.position.count}function IA(i){return pW(i)/3}function mW(i,e=ArrayBuffer){return i>65535?new Uint32Array(new e(4*i)):new Uint16Array(new e(2*i))}function hAe(i,e){if(!i.index){const t=i.attributes.position.count,n=e.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer,r=mW(t,n);i.setIndex(new mn(r,1));for(let s=0;s<t;s++)r[s]=s}}function gW(i,e){const t=IA(i),n=e||i.drawRange,r=n.start/3,s=(n.start+n.count)/3,o=Math.max(0,r),a=Math.min(t,s)-o;return[{offset:Math.floor(o),count:Math.floor(a)}]}function AW(i,e){if(!i.groups||!i.groups.length)return gW(i,e);const t=[],n=new Set,r=e||i.drawRange,s=r.start/3,o=(r.start+r.count)/3;for(const l of i.groups){const c=l.start/3,u=(l.start+l.count)/3;n.add(Math.max(s,c)),n.add(Math.min(o,u))}const a=Array.from(n.values()).sort((l,c)=>l-c);for(let l=0;l<a.length-1;l++){const c=a[l],u=a[l+1];t.push({offset:Math.floor(c),count:Math.floor(u-c)})}return t}function fAe(i,e){const t=IA(i),n=AW(i,e).sort((o,a)=>o.offset-a.offset),r=n[n.length-1];r.count=Math.min(t-r.offset,r.count);let s=0;return n.forEach(({count:o})=>s+=o),t!==s}function sI(i,e,t,n,r){let s=1/0,o=1/0,a=1/0,l=-1/0,c=-1/0,u=-1/0,h=1/0,f=1/0,d=1/0,m=-1/0,A=-1/0,g=-1/0;for(let y=e*6,E=(e+t)*6;y<E;y+=6){const x=i[y+0],C=i[y+1],T=x-C,I=x+C;T<s&&(s=T),I>l&&(l=I),x<h&&(h=x),x>m&&(m=x);const M=i[y+2],L=i[y+3],R=M-L,P=M+L;R<o&&(o=R),P>c&&(c=P),M<f&&(f=M),M>A&&(A=M);const F=i[y+4],k=i[y+5],z=F-k,U=F+k;z<a&&(a=z),U>u&&(u=U),F<d&&(d=F),F>g&&(g=F)}n[0]=s,n[1]=o,n[2]=a,n[3]=l,n[4]=c,n[5]=u,r[0]=h,r[1]=f,r[2]=d,r[3]=m,r[4]=A,r[5]=g}function dAe(i,e=null,t=null,n=null){const r=i.attributes.position,s=i.index?i.index.array:null,o=IA(i),a=r.normalized;let l;e===null?(l=new Float32Array(o*6*4),t=0,n=o):(l=e,t=t||0,n=n||o);const c=r.array,u=r.offset||0;let h=3;r.isInterleavedBufferAttribute&&(h=r.data.stride);const f=["getX","getY","getZ"];for(let d=t;d<t+n;d++){const m=d*3,A=d*6;let g=m+0,y=m+1,E=m+2;s&&(g=s[g],y=s[y],E=s[E]),a||(g=g*h+u,y=y*h+u,E=E*h+u);for(let x=0;x<3;x++){let C,T,I;a?(C=r[f[x]](g),T=r[f[x]](y),I=r[f[x]](E)):(C=c[g+x],T=c[y+x],I=c[E+x]);let M=C;T<M&&(M=T),I<M&&(M=I);let L=C;T>L&&(L=T),I>L&&(L=I);const R=(L-M)/2,P=x*2;l[A+P+0]=M+R,l[A+P+1]=R+(Math.abs(M)+R)*uAe}}return l}function ns(i,e,t){return t.min.x=e[i],t.min.y=e[i+1],t.min.z=e[i+2],t.max.x=e[i+3],t.max.y=e[i+4],t.max.z=e[i+5],t}function $k(i){let e=-1,t=-1/0;for(let n=0;n<3;n++){const r=i[n+3]-i[n];r>t&&(t=r,e=n)}return e}function Yk(i,e){e.set(i)}function Xk(i,e,t){let n,r;for(let s=0;s<3;s++){const o=s+3;n=i[s],r=e[s],t[s]=n<r?n:r,n=i[o],r=e[o],t[o]=n>r?n:r}}function o_(i,e,t){for(let n=0;n<3;n++){const r=e[i+2*n],s=e[i+2*n+1],o=r-s,a=r+s;o<t[n]&&(t[n]=o),a>t[n+3]&&(t[n+3]=a)}}function mv(i){const e=i[3]-i[0],t=i[4]-i[1],n=i[5]-i[2];return 2*(e*t+t*n+n*e)}const Af=32,pAe=(i,e)=>i.candidate-e.candidate,Pd=new Array(Af).fill().map(()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0})),a_=new Float32Array(6);function mAe(i,e,t,n,r,s){let o=-1,a=0;if(s===dW)o=$k(e),o!==-1&&(a=(e[o]+e[o+3])/2);else if(s===cAe)o=$k(i),o!==-1&&(a=gAe(t,n,r,o));else if(s===C4){const l=mv(i);let c=iI*r;const u=n*6,h=(n+r)*6;for(let f=0;f<3;f++){const d=e[f],g=(e[f+3]-d)/Af;if(r<Af/4){const y=[...Pd];y.length=r;let E=0;for(let C=u;C<h;C+=6,E++){const T=y[E];T.candidate=t[C+2*f],T.count=0;const{bounds:I,leftCacheBounds:M,rightCacheBounds:L}=T;for(let R=0;R<3;R++)L[R]=1/0,L[R+3]=-1/0,M[R]=1/0,M[R+3]=-1/0,I[R]=1/0,I[R+3]=-1/0;o_(C,t,I)}y.sort(pAe);let x=r;for(let C=0;C<x;C++){const T=y[C];for(;C+1<x&&y[C+1].candidate===T.candidate;)y.splice(C+1,1),x--}for(let C=u;C<h;C+=6){const T=t[C+2*f];for(let I=0;I<x;I++){const M=y[I];T>=M.candidate?o_(C,t,M.rightCacheBounds):(o_(C,t,M.leftCacheBounds),M.count++)}}for(let C=0;C<x;C++){const T=y[C],I=T.count,M=r-T.count,L=T.leftCacheBounds,R=T.rightCacheBounds;let P=0;I!==0&&(P=mv(L)/l);let F=0;M!==0&&(F=mv(R)/l);const k=Kk+iI*(P*I+F*M);k<c&&(o=f,c=k,a=T.candidate)}}else{for(let x=0;x<Af;x++){const C=Pd[x];C.count=0,C.candidate=d+g+x*g;const T=C.bounds;for(let I=0;I<3;I++)T[I]=1/0,T[I+3]=-1/0}for(let x=u;x<h;x+=6){let I=~~((t[x+2*f]-d)/g);I>=Af&&(I=Af-1);const M=Pd[I];M.count++,o_(x,t,M.bounds)}const y=Pd[Af-1];Yk(y.bounds,y.rightCacheBounds);for(let x=Af-2;x>=0;x--){const C=Pd[x],T=Pd[x+1];Xk(C.bounds,T.rightCacheBounds,C.rightCacheBounds)}let E=0;for(let x=0;x<Af-1;x++){const C=Pd[x],T=C.count,I=C.bounds,L=Pd[x+1].rightCacheBounds;T!==0&&(E===0?Yk(I,a_):Xk(I,a_,a_)),E+=T;let R=0,P=0;E!==0&&(R=mv(a_)/l);const F=r-E;F!==0&&(P=mv(L)/l);const k=Kk+iI*(R*E+P*F);k<c&&(o=f,c=k,a=C.candidate)}}}}else console.warn(`MeshBVH: Invalid build strategy value ${s} used.`);return{axis:o,pos:a}}function gAe(i,e,t,n){let r=0;for(let s=e,o=e+t;s<o;s++)r+=i[s*6+n*2];return r/t}class oI{constructor(){this.boundingData=new Float32Array(6)}}function AAe(i,e,t,n,r,s){let o=n,a=n+r-1;const l=s.pos,c=s.axis*2;for(;;){for(;o<=a&&t[o*6+c]<l;)o++;for(;o<=a&&t[a*6+c]>=l;)a--;if(o<a){for(let u=0;u<3;u++){let h=e[o*3+u];e[o*3+u]=e[a*3+u],e[a*3+u]=h}for(let u=0;u<6;u++){let h=t[o*6+u];t[o*6+u]=t[a*6+u],t[a*6+u]=h}o++,a--}else return o}}function yAe(i,e,t,n,r,s){let o=n,a=n+r-1;const l=s.pos,c=s.axis*2;for(;;){for(;o<=a&&t[o*6+c]<l;)o++;for(;o<=a&&t[a*6+c]>=l;)a--;if(o<a){let u=i[o];i[o]=i[a],i[a]=u;for(let h=0;h<6;h++){let f=t[o*6+h];t[o*6+h]=t[a*6+h],t[a*6+h]=f}o++,a--}else return o}}function va(i,e){return e[i+15]===65535}function el(i,e){return e[i+6]}function Il(i,e){return e[i+14]}function dc(i){return i+8}function Ml(i,e){return e[i+6]}function n8(i,e){return e[i+7]}let yW,zv,aS,vW;const vAe=Math.pow(2,32);function B5(i){return"count"in i?1:1+B5(i.left)+B5(i.right)}function xAe(i,e,t){return yW=new Float32Array(t),zv=new Uint32Array(t),aS=new Uint16Array(t),vW=new Uint8Array(t),D5(i,e)}function D5(i,e){const t=i/4,n=i/2,r="count"in e,s=e.boundingData;for(let o=0;o<6;o++)yW[t+o]=s[o];if(r)if(e.buffer){const o=e.buffer;vW.set(new Uint8Array(o),i);for(let a=i,l=i+o.byteLength;a<l;a+=Jd){const c=a/2;va(c,aS)||(zv[a/4+6]+=t)}return i+o.byteLength}else{const o=e.offset,a=e.count;return zv[t+6]=o,aS[n+14]=a,aS[n+15]=T4,i+Jd}else{const o=e.left,a=e.right,l=e.splitAxis;let c;if(c=D5(i+Jd,o),c/4>vAe)throw new Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return zv[t+6]=c/4,c=D5(c,a),zv[t+7]=l,c}}function EAe(i,e){const t=(i.index?i.index.count:i.attributes.position.count)/3,n=t>2**16,r=n?4:2,s=e?new SharedArrayBuffer(t*r):new ArrayBuffer(t*r),o=n?new Uint32Array(s):new Uint16Array(s);for(let a=0,l=o.length;a<l;a++)o[a]=a;return o}function _Ae(i,e,t,n,r){const{maxDepth:s,verbose:o,maxLeafTris:a,strategy:l,onProgress:c,indirect:u}=r,h=i._indirectBuffer,f=i.geometry,d=f.index?f.index.array:null,m=u?yAe:AAe,A=IA(f),g=new Float32Array(6);let y=!1;const E=new oI;return sI(e,t,n,E.boundingData,g),C(E,t,n,g),E;function x(T){c&&c(T/A)}function C(T,I,M,L=null,R=0){if(!y&&R>=s&&(y=!0,o&&(console.warn(`MeshBVH: Max depth of ${s} reached when generating BVH. Consider increasing maxDepth.`),console.warn(f))),M<=a||R>=s)return x(I+M),T.offset=I,T.count=M,T;const P=mAe(T.boundingData,L,e,I,M,l);if(P.axis===-1)return x(I+M),T.offset=I,T.count=M,T;const F=m(h,d,e,I,M,P);if(F===I||F===I+M)x(I+M),T.offset=I,T.count=M;else{T.splitAxis=P.axis;const k=new oI,z=I,U=F-I;T.left=k,sI(e,z,U,k.boundingData,g),C(k,z,U,g,R+1);const W=new oI,$=F,oe=M-U;T.right=W,sI(e,$,oe,W.boundingData,g),C(W,$,oe,g,R+1)}return T}}function SAe(i,e){const t=i.geometry;e.indirect&&(i._indirectBuffer=EAe(t,e.useSharedArrayBuffer),fAe(t,e.range)&&!e.verbose&&console.warn('MeshBVH: Provided geometry contains groups or a range that do not fully span the vertex contents while using the "indirect" option. BVH may incorrectly report intersections on unrendered portions of the geometry.')),i._indirectBuffer||hAe(t,e);const n=e.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer,r=dAe(t),s=e.indirect?gW(t,e.range):AW(t,e.range);i._roots=s.map(o=>{const a=_Ae(i,r,o.offset,o.count,e),l=B5(a),c=new n(Jd*l);return xAe(0,a,c),c})}class zf{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(e,t){let n=1/0,r=-1/0;for(let s=0,o=e.length;s<o;s++){const l=e[s][t];n=l<n?l:n,r=l>r?l:r}this.min=n,this.max=r}setFromPoints(e,t){let n=1/0,r=-1/0;for(let s=0,o=t.length;s<o;s++){const a=t[s],l=e.dot(a);n=l<n?l:n,r=l>r?l:r}this.min=n,this.max=r}isSeparated(e){return this.min>e.max||e.min>this.max}}zf.prototype.setFromBox=(function(){const i=new H;return function(t,n){const r=n.min,s=n.max;let o=1/0,a=-1/0;for(let l=0;l<=1;l++)for(let c=0;c<=1;c++)for(let u=0;u<=1;u++){i.x=r.x*l+s.x*(1-l),i.y=r.y*c+s.y*(1-c),i.z=r.z*u+s.z*(1-u);const h=t.dot(i);o=Math.min(h,o),a=Math.max(h,a)}this.min=o,this.max=a}})();const wAe=(function(){const i=new H,e=new H,t=new H;return function(r,s,o){const a=r.start,l=i,c=s.start,u=e;t.subVectors(a,c),i.subVectors(r.end,r.start),e.subVectors(s.end,s.start);const h=t.dot(u),f=u.dot(l),d=u.dot(u),m=t.dot(l),g=l.dot(l)*d-f*f;let y,E;g!==0?y=(h*f-m*d)/g:y=0,E=(h+y*f)/d,o.x=y,o.y=E}})(),i8=(function(){const i=new Ue,e=new H,t=new H;return function(r,s,o,a){wAe(r,s,i);let l=i.x,c=i.y;if(l>=0&&l<=1&&c>=0&&c<=1){r.at(l,o),s.at(c,a);return}else if(l>=0&&l<=1){c<0?s.at(0,a):s.at(1,a),r.closestPointToPoint(a,!0,o);return}else if(c>=0&&c<=1){l<0?r.at(0,o):r.at(1,o),s.closestPointToPoint(o,!0,a);return}else{let u;l<0?u=r.start:u=r.end;let h;c<0?h=s.start:h=s.end;const f=e,d=t;if(r.closestPointToPoint(h,!0,e),s.closestPointToPoint(u,!0,t),f.distanceToSquared(h)<=d.distanceToSquared(u)){o.copy(f),a.copy(h);return}else{o.copy(u),a.copy(d);return}}}})(),CAe=(function(){const i=new H,e=new H,t=new vo,n=new Eu;return function(s,o){const{radius:a,center:l}=s,{a:c,b:u,c:h}=o;if(n.start=c,n.end=u,n.closestPointToPoint(l,!0,i).distanceTo(l)<=a||(n.start=c,n.end=h,n.closestPointToPoint(l,!0,i).distanceTo(l)<=a)||(n.start=u,n.end=h,n.closestPointToPoint(l,!0,i).distanceTo(l)<=a))return!0;const A=o.getPlane(t);if(Math.abs(A.distanceToPoint(l))<=a){const y=A.projectPoint(l,e);if(o.containsPoint(y))return!0}return!1}})(),TAe=1e-15;function aI(i){return Math.abs(i)<TAe}class Tu extends ks{constructor(...e){super(...e),this.isExtendedTriangle=!0,this.satAxes=new Array(4).fill().map(()=>new H),this.satBounds=new Array(4).fill().map(()=>new zf),this.points=[this.a,this.b,this.c],this.sphere=new Bi,this.plane=new vo,this.needsUpdate=!0}intersectsSphere(e){return CAe(e,this)}update(){const e=this.a,t=this.b,n=this.c,r=this.points,s=this.satAxes,o=this.satBounds,a=s[0],l=o[0];this.getNormal(a),l.setFromPoints(a,r);const c=s[1],u=o[1];c.subVectors(e,t),u.setFromPoints(c,r);const h=s[2],f=o[2];h.subVectors(t,n),f.setFromPoints(h,r);const d=s[3],m=o[3];d.subVectors(n,e),m.setFromPoints(d,r),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(a,e),this.needsUpdate=!1}}Tu.prototype.closestPointToSegment=(function(){const i=new H,e=new H,t=new Eu;return function(r,s=null,o=null){const{start:a,end:l}=r,c=this.points;let u,h=1/0;for(let f=0;f<3;f++){const d=(f+1)%3;t.start.copy(c[f]),t.end.copy(c[d]),i8(t,r,i,e),u=i.distanceToSquared(e),u<h&&(h=u,s&&s.copy(i),o&&o.copy(e))}return this.closestPointToPoint(a,i),u=a.distanceToSquared(i),u<h&&(h=u,s&&s.copy(i),o&&o.copy(a)),this.closestPointToPoint(l,i),u=l.distanceToSquared(i),u<h&&(h=u,s&&s.copy(i),o&&o.copy(l)),Math.sqrt(h)}})();Tu.prototype.intersectsTriangle=(function(){const i=new Tu,e=new Array(3),t=new Array(3),n=new zf,r=new zf,s=new H,o=new H,a=new H,l=new H,c=new H,u=new Eu,h=new Eu,f=new Eu,d=new H;function m(A,g,y){const E=A.points;let x=0,C=-1;for(let T=0;T<3;T++){const{start:I,end:M}=u;I.copy(E[T]),M.copy(E[(T+1)%3]),u.delta(o);const L=aI(g.distanceToPoint(I));if(aI(g.normal.dot(o))&&L){y.copy(u),x=2;break}const R=g.intersectLine(u,d);if(!R&&L&&d.copy(I),(R||L)&&!aI(d.distanceTo(M))){if(x<=1)(x===1?y.start:y.end).copy(d),L&&(C=x);else if(x>=2){(C===1?y.start:y.end).copy(d),x=2;break}if(x++,x===2&&C===-1)break}}return x}return function(g,y=null,E=!1){this.needsUpdate&&this.update(),g.isExtendedTriangle?g.needsUpdate&&g.update():(i.copy(g),i.update(),g=i);const x=this.plane,C=g.plane;if(Math.abs(x.normal.dot(C.normal))>1-1e-10){const T=this.satBounds,I=this.satAxes;t[0]=g.a,t[1]=g.b,t[2]=g.c;for(let R=0;R<4;R++){const P=T[R],F=I[R];if(n.setFromPoints(F,t),P.isSeparated(n))return!1}const M=g.satBounds,L=g.satAxes;e[0]=this.a,e[1]=this.b,e[2]=this.c;for(let R=0;R<4;R++){const P=M[R],F=L[R];if(n.setFromPoints(F,e),P.isSeparated(n))return!1}for(let R=0;R<4;R++){const P=I[R];for(let F=0;F<4;F++){const k=L[F];if(s.crossVectors(P,k),n.setFromPoints(s,e),r.setFromPoints(s,t),n.isSeparated(r))return!1}}return y&&(E||console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),y.start.set(0,0,0),y.end.set(0,0,0)),!0}else{const T=m(this,C,h);if(T===1&&g.containsPoint(h.end))return y&&(y.start.copy(h.end),y.end.copy(h.end)),!0;if(T!==2)return!1;const I=m(g,x,f);if(I===1&&this.containsPoint(f.end))return y&&(y.start.copy(f.end),y.end.copy(f.end)),!0;if(I!==2)return!1;if(h.delta(a),f.delta(l),a.dot(l)<0){let z=f.start;f.start=f.end,f.end=z}const M=h.start.dot(a),L=h.end.dot(a),R=f.start.dot(a),P=f.end.dot(a),F=L<R,k=M<P;return M!==P&&R!==L&&F===k?!1:(y&&(c.subVectors(h.start,f.start),c.dot(a)>0?y.start.copy(h.start):y.start.copy(f.start),c.subVectors(h.end,f.end),c.dot(a)<0?y.end.copy(h.end):y.end.copy(f.end)),!0)}}})();Tu.prototype.distanceToPoint=(function(){const i=new H;return function(t){return this.closestPointToPoint(t,i),t.distanceTo(i)}})();Tu.prototype.distanceToTriangle=(function(){const i=new H,e=new H,t=["a","b","c"],n=new Eu,r=new Eu;return function(o,a=null,l=null){const c=a||l?n:null;if(this.intersectsTriangle(o,c))return(a||l)&&(a&&c.getCenter(a),l&&c.getCenter(l)),0;let u=1/0;for(let h=0;h<3;h++){let f;const d=t[h],m=o[d];this.closestPointToPoint(m,i),f=m.distanceToSquared(i),f<u&&(u=f,a&&a.copy(i),l&&l.copy(m));const A=this[d];o.closestPointToPoint(A,i),f=A.distanceToSquared(i),f<u&&(u=f,a&&a.copy(A),l&&l.copy(i))}for(let h=0;h<3;h++){const f=t[h],d=t[(h+1)%3];n.set(this[f],this[d]);for(let m=0;m<3;m++){const A=t[m],g=t[(m+1)%3];r.set(o[A],o[g]),i8(n,r,i,e);const y=i.distanceToSquared(e);y<u&&(u=y,a&&a.copy(i),l&&l.copy(e))}}return Math.sqrt(u)}})();class Ta{constructor(e,t,n){this.isOrientedBox=!0,this.min=new H,this.max=new H,this.matrix=new Xe,this.invMatrix=new Xe,this.points=new Array(8).fill().map(()=>new H),this.satAxes=new Array(3).fill().map(()=>new H),this.satBounds=new Array(3).fill().map(()=>new zf),this.alignedSatBounds=new Array(3).fill().map(()=>new zf),this.needsUpdate=!1,e&&this.min.copy(e),t&&this.max.copy(t),n&&this.matrix.copy(n)}set(e,t,n){this.min.copy(e),this.max.copy(t),this.matrix.copy(n),this.needsUpdate=!0}copy(e){this.min.copy(e.min),this.max.copy(e.max),this.matrix.copy(e.matrix),this.needsUpdate=!0}}Ta.prototype.update=(function(){return function(){const e=this.matrix,t=this.min,n=this.max,r=this.points;for(let c=0;c<=1;c++)for(let u=0;u<=1;u++)for(let h=0;h<=1;h++){const f=1*c|2*u|4*h,d=r[f];d.x=c?n.x:t.x,d.y=u?n.y:t.y,d.z=h?n.z:t.z,d.applyMatrix4(e)}const s=this.satBounds,o=this.satAxes,a=r[0];for(let c=0;c<3;c++){const u=o[c],h=s[c],f=1<<c,d=r[f];u.subVectors(a,d),h.setFromPoints(u,r)}const l=this.alignedSatBounds;l[0].setFromPointsField(r,"x"),l[1].setFromPointsField(r,"y"),l[2].setFromPointsField(r,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1}})();Ta.prototype.intersectsBox=(function(){const i=new zf;return function(t){this.needsUpdate&&this.update();const n=t.min,r=t.max,s=this.satBounds,o=this.satAxes,a=this.alignedSatBounds;if(i.min=n.x,i.max=r.x,a[0].isSeparated(i)||(i.min=n.y,i.max=r.y,a[1].isSeparated(i))||(i.min=n.z,i.max=r.z,a[2].isSeparated(i)))return!1;for(let l=0;l<3;l++){const c=o[l],u=s[l];if(i.setFromBox(c,t),u.isSeparated(i))return!1}return!0}})();Ta.prototype.intersectsTriangle=(function(){const i=new Tu,e=new Array(3),t=new zf,n=new zf,r=new H;return function(o){this.needsUpdate&&this.update(),o.isExtendedTriangle?o.needsUpdate&&o.update():(i.copy(o),i.update(),o=i);const a=this.satBounds,l=this.satAxes;e[0]=o.a,e[1]=o.b,e[2]=o.c;for(let f=0;f<3;f++){const d=a[f],m=l[f];if(t.setFromPoints(m,e),d.isSeparated(t))return!1}const c=o.satBounds,u=o.satAxes,h=this.points;for(let f=0;f<3;f++){const d=c[f],m=u[f];if(t.setFromPoints(m,h),d.isSeparated(t))return!1}for(let f=0;f<3;f++){const d=l[f];for(let m=0;m<4;m++){const A=u[m];if(r.crossVectors(d,A),t.setFromPoints(r,e),n.setFromPoints(r,h),t.isSeparated(n))return!1}}return!0}})();Ta.prototype.closestPointToPoint=(function(){return function(e,t){return this.needsUpdate&&this.update(),t.copy(e).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),t}})();Ta.prototype.distanceToPoint=(function(){const i=new H;return function(t){return this.closestPointToPoint(t,i),t.distanceTo(i)}})();Ta.prototype.distanceToBox=(function(){const i=["x","y","z"],e=new Array(12).fill().map(()=>new Eu),t=new Array(12).fill().map(()=>new Eu),n=new H,r=new H;return function(o,a=0,l=null,c=null){if(this.needsUpdate&&this.update(),this.intersectsBox(o))return(l||c)&&(o.getCenter(r),this.closestPointToPoint(r,n),o.closestPointToPoint(n,r),l&&l.copy(n),c&&c.copy(r)),0;const u=a*a,h=o.min,f=o.max,d=this.points;let m=1/0;for(let g=0;g<8;g++){const y=d[g];r.copy(y).clamp(h,f);const E=y.distanceToSquared(r);if(E<m&&(m=E,l&&l.copy(y),c&&c.copy(r),E<u))return Math.sqrt(E)}let A=0;for(let g=0;g<3;g++)for(let y=0;y<=1;y++)for(let E=0;E<=1;E++){const x=(g+1)%3,C=(g+2)%3,T=y<<x|E<<C,I=1<<g|y<<x|E<<C,M=d[T],L=d[I];e[A].set(M,L);const P=i[g],F=i[x],k=i[C],z=t[A],U=z.start,W=z.end;U[P]=h[P],U[F]=y?h[F]:f[F],U[k]=E?h[k]:f[F],W[P]=f[P],W[F]=y?h[F]:f[F],W[k]=E?h[k]:f[F],A++}for(let g=0;g<=1;g++)for(let y=0;y<=1;y++)for(let E=0;E<=1;E++){r.x=g?f.x:h.x,r.y=y?f.y:h.y,r.z=E?f.z:h.z,this.closestPointToPoint(r,n);const x=r.distanceToSquared(n);if(x<m&&(m=x,l&&l.copy(n),c&&c.copy(r),x<u))return Math.sqrt(x)}for(let g=0;g<12;g++){const y=e[g];for(let E=0;E<12;E++){const x=t[E];i8(y,x,n,r);const C=n.distanceToSquared(r);if(C<m&&(m=C,l&&l.copy(n),c&&c.copy(r),C<u))return Math.sqrt(C)}}return Math.sqrt(m)}})();class r8{constructor(e){this._getNewPrimitive=e,this._primitives=[]}getPrimitive(){const e=this._primitives;return e.length===0?this._getNewPrimitive():e.pop()}releasePrimitive(e){this._primitives.push(e)}}class bAe extends r8{constructor(){super(()=>new Tu)}}const pc=new bAe;class IAe{constructor(){this.float32Array=null,this.uint16Array=null,this.uint32Array=null;const e=[];let t=null;this.setBuffer=n=>{t&&e.push(t),t=n,this.float32Array=new Float32Array(n),this.uint16Array=new Uint16Array(n),this.uint32Array=new Uint32Array(n)},this.clearBuffer=()=>{t=null,this.float32Array=null,this.uint16Array=null,this.uint32Array=null,e.length!==0&&this.setBuffer(e.pop())}}}const br=new IAe;let jd,B1;const Zg=[],l_=new r8(()=>new ti);function MAe(i,e,t,n,r,s){jd=l_.getPrimitive(),B1=l_.getPrimitive(),Zg.push(jd,B1),br.setBuffer(i._roots[e]);const o=k5(0,i.geometry,t,n,r,s);br.clearBuffer(),l_.releasePrimitive(jd),l_.releasePrimitive(B1),Zg.pop(),Zg.pop();const a=Zg.length;return a>0&&(B1=Zg[a-1],jd=Zg[a-2]),o}function k5(i,e,t,n,r=null,s=0,o=0){const{float32Array:a,uint16Array:l,uint32Array:c}=br;let u=i*2;if(va(u,l)){const f=el(i,c),d=Il(u,l);return ns(i,a,jd),n(f,d,!1,o,s+i,jd)}else{let P=function(k){const{uint16Array:z,uint32Array:U}=br;let W=k*2;for(;!va(W,z);)k=dc(k),W=k*2;return el(k,U)},F=function(k){const{uint16Array:z,uint32Array:U}=br;let W=k*2;for(;!va(W,z);)k=Ml(k,U),W=k*2;return el(k,U)+Il(W,z)};const f=dc(i),d=Ml(i,c);let m=f,A=d,g,y,E,x;if(r&&(E=jd,x=B1,ns(m,a,E),ns(A,a,x),g=r(E),y=r(x),y<g)){m=d,A=f;const k=g;g=y,y=k,E=x}E||(E=jd,ns(m,a,E));const C=va(m*2,l),T=t(E,C,g,o+1,s+m);let I;if(T===jk){const k=P(m),U=F(m)-k;I=n(k,U,!0,o+1,s+m,E)}else I=T&&k5(m,e,t,n,r,s,o+1);if(I)return!0;x=B1,ns(A,a,x);const M=va(A*2,l),L=t(x,M,y,o+1,s+A);let R;if(L===jk){const k=P(A),U=F(A)-k;R=n(k,U,!0,o+1,s+A,x)}else R=L&&k5(A,e,t,n,r,s,o+1);return!!R}}const gv=new H,lI=new H;function RAe(i,e,t={},n=0,r=1/0){const s=n*n,o=r*r;let a=1/0,l=null;if(i.shapecast({boundsTraverseOrder:u=>(gv.copy(e).clamp(u.min,u.max),gv.distanceToSquared(e)),intersectsBounds:(u,h,f)=>f<a&&f<o,intersectsTriangle:(u,h)=>{u.closestPointToPoint(e,gv);const f=e.distanceToSquared(gv);return f<a&&(lI.copy(gv),a=f,l=h),f<s}}),a===1/0)return null;const c=Math.sqrt(a);return t.point?t.point.copy(lI):t.point=lI.clone(),t.distance=c,t.faceIndex=l,t}const e1=new H,t1=new H,n1=new H,c_=new Ue,u_=new Ue,h_=new Ue,qk=new H,Jk=new H,Zk=new H,f_=new H;function LAe(i,e,t,n,r,s,o,a){let l;if(s===ys?l=i.intersectTriangle(n,t,e,!0,r):l=i.intersectTriangle(e,t,n,s!==Pi,r),l===null)return null;const c=i.origin.distanceTo(r);return c<o||c>a?null:{distance:c,point:r.clone()}}function PAe(i,e,t,n,r,s,o,a,l,c,u){e1.fromBufferAttribute(e,s),t1.fromBufferAttribute(e,o),n1.fromBufferAttribute(e,a);const h=LAe(i,e1,t1,n1,f_,l,c,u);if(h){n&&(c_.fromBufferAttribute(n,s),u_.fromBufferAttribute(n,o),h_.fromBufferAttribute(n,a),h.uv=ks.getInterpolation(f_,e1,t1,n1,c_,u_,h_,new Ue)),r&&(c_.fromBufferAttribute(r,s),u_.fromBufferAttribute(r,o),h_.fromBufferAttribute(r,a),h.uv1=ks.getInterpolation(f_,e1,t1,n1,c_,u_,h_,new Ue)),t&&(qk.fromBufferAttribute(t,s),Jk.fromBufferAttribute(t,o),Zk.fromBufferAttribute(t,a),h.normal=ks.getInterpolation(f_,e1,t1,n1,qk,Jk,Zk,new H),h.normal.dot(i.direction)>0&&h.normal.multiplyScalar(-1));const f={a:s,b:o,c:a,normal:new H,materialIndex:0};ks.getNormal(e1,t1,n1,f.normal),h.face=f,h.faceIndex=s}return h}function b4(i,e,t,n,r,s,o){const a=n*3;let l=a+0,c=a+1,u=a+2;const h=i.index;i.index&&(l=h.getX(l),c=h.getX(c),u=h.getX(u));const{position:f,normal:d,uv:m,uv1:A}=i.attributes,g=PAe(t,f,d,m,A,l,c,u,e,s,o);return g?(g.faceIndex=n,r&&r.push(g),g):null}function Ns(i,e,t,n){const r=i.a,s=i.b,o=i.c;let a=e,l=e+1,c=e+2;t&&(a=t.getX(a),l=t.getX(l),c=t.getX(c)),r.x=n.getX(a),r.y=n.getY(a),r.z=n.getZ(a),s.x=n.getX(l),s.y=n.getY(l),s.z=n.getZ(l),o.x=n.getX(c),o.y=n.getY(c),o.z=n.getZ(c)}function BAe(i,e,t,n,r,s,o,a){const{geometry:l,_indirectBuffer:c}=i;for(let u=n,h=n+r;u<h;u++)b4(l,e,t,u,s,o,a)}function DAe(i,e,t,n,r,s,o){const{geometry:a,_indirectBuffer:l}=i;let c=1/0,u=null;for(let h=n,f=n+r;h<f;h++){let d;d=b4(a,e,t,h,null,s,o),d&&d.distance<c&&(u=d,c=d.distance)}return u}function kAe(i,e,t,n,r,s,o){const{geometry:a}=t,{index:l}=a,c=a.attributes.position;for(let u=i,h=e+i;u<h;u++){let f;if(f=u,Ns(o,f*3,l,c),o.needsUpdate=!0,n(o,f,r,s))return!0}return!1}function FAe(i,e=null){e&&Array.isArray(e)&&(e=new Set(e));const t=i.geometry,n=t.index?t.index.array:null,r=t.attributes.position;let s,o,a,l,c=0;const u=i._roots;for(let f=0,d=u.length;f<d;f++)s=u[f],o=new Uint32Array(s),a=new Uint16Array(s),l=new Float32Array(s),h(0,c),c+=s.byteLength;function h(f,d,m=!1){const A=f*2;if(a[A+15]===T4){const y=o[f+6],E=a[A+14];let x=1/0,C=1/0,T=1/0,I=-1/0,M=-1/0,L=-1/0;for(let R=3*y,P=3*(y+E);R<P;R++){let F=n[R];const k=r.getX(F),z=r.getY(F),U=r.getZ(F);k<x&&(x=k),k>I&&(I=k),z<C&&(C=z),z>M&&(M=z),U<T&&(T=U),U>L&&(L=U)}return l[f+0]!==x||l[f+1]!==C||l[f+2]!==T||l[f+3]!==I||l[f+4]!==M||l[f+5]!==L?(l[f+0]=x,l[f+1]=C,l[f+2]=T,l[f+3]=I,l[f+4]=M,l[f+5]=L,!0):!1}else{const y=f+8,E=o[f+6],x=y+d,C=E+d;let T=m,I=!1,M=!1;e?T||(I=e.has(x),M=e.has(C),T=!I&&!M):(I=!0,M=!0);const L=T||I,R=T||M;let P=!1;L&&(P=h(y,d,T));let F=!1;R&&(F=h(E,d,T));const k=P||F;if(k)for(let z=0;z<3;z++){const U=y+z,W=E+z,$=l[U],oe=l[U+3],X=l[W],Q=l[W+3];l[f+z]=$<X?$:X,l[f+z+3]=oe>Q?oe:Q}return k}}}function lp(i,e,t,n,r){let s,o,a,l,c,u;const h=1/t.direction.x,f=1/t.direction.y,d=1/t.direction.z,m=t.origin.x,A=t.origin.y,g=t.origin.z;let y=e[i],E=e[i+3],x=e[i+1],C=e[i+3+1],T=e[i+2],I=e[i+3+2];return h>=0?(s=(y-m)*h,o=(E-m)*h):(s=(E-m)*h,o=(y-m)*h),f>=0?(a=(x-A)*f,l=(C-A)*f):(a=(C-A)*f,l=(x-A)*f),s>l||a>o||((a>s||isNaN(s))&&(s=a),(l<o||isNaN(o))&&(o=l),d>=0?(c=(T-g)*d,u=(I-g)*d):(c=(I-g)*d,u=(T-g)*d),s>u||c>o)?!1:((c>s||s!==s)&&(s=c),(u<o||o!==o)&&(o=u),s<=r&&o>=n)}function OAe(i,e,t,n,r,s,o,a){const{geometry:l,_indirectBuffer:c}=i;for(let u=n,h=n+r;u<h;u++){let f=c?c[u]:u;b4(l,e,t,f,s,o,a)}}function NAe(i,e,t,n,r,s,o){const{geometry:a,_indirectBuffer:l}=i;let c=1/0,u=null;for(let h=n,f=n+r;h<f;h++){let d;d=b4(a,e,t,l?l[h]:h,null,s,o),d&&d.distance<c&&(u=d,c=d.distance)}return u}function UAe(i,e,t,n,r,s,o){const{geometry:a}=t,{index:l}=a,c=a.attributes.position;for(let u=i,h=e+i;u<h;u++){let f;if(f=t.resolveTriangleIndex(u),Ns(o,f*3,l,c),o.needsUpdate=!0,n(o,f,r,s))return!0}return!1}function zAe(i,e,t,n,r,s,o){br.setBuffer(i._roots[e]),F5(0,i,t,n,r,s,o),br.clearBuffer()}function F5(i,e,t,n,r,s,o){const{float32Array:a,uint16Array:l,uint32Array:c}=br,u=i*2;if(va(u,l)){const f=el(i,c),d=Il(u,l);BAe(e,t,n,f,d,r,s,o)}else{const f=dc(i);lp(f,a,n,s,o)&&F5(f,e,t,n,r,s,o);const d=Ml(i,c);lp(d,a,n,s,o)&&F5(d,e,t,n,r,s,o)}}const GAe=["x","y","z"];function HAe(i,e,t,n,r,s){br.setBuffer(i._roots[e]);const o=O5(0,i,t,n,r,s);return br.clearBuffer(),o}function O5(i,e,t,n,r,s){const{float32Array:o,uint16Array:a,uint32Array:l}=br;let c=i*2;if(va(c,a)){const h=el(i,l),f=Il(c,a);return DAe(e,t,n,h,f,r,s)}else{const h=n8(i,l),f=GAe[h],m=n.direction[f]>=0;let A,g;m?(A=dc(i),g=Ml(i,l)):(A=Ml(i,l),g=dc(i));const E=lp(A,o,n,r,s)?O5(A,e,t,n,r,s):null;if(E){const T=E.point[f];if(m?T<=o[g+h]:T>=o[g+h+3])return E}const C=lp(g,o,n,r,s)?O5(g,e,t,n,r,s):null;return E&&C?E.distance<=C.distance?E:C:E||C||null}}const d_=new ti,i1=new Tu,r1=new Tu,Av=new Xe,eF=new Ta,p_=new Ta;function QAe(i,e,t,n){br.setBuffer(i._roots[e]);const r=N5(0,i,t,n);return br.clearBuffer(),r}function N5(i,e,t,n,r=null){const{float32Array:s,uint16Array:o,uint32Array:a}=br;let l=i*2;if(r===null&&(t.boundingBox||t.computeBoundingBox(),eF.set(t.boundingBox.min,t.boundingBox.max,n),r=eF),va(l,o)){const u=e.geometry,h=u.index,f=u.attributes.position,d=t.index,m=t.attributes.position,A=el(i,a),g=Il(l,o);if(Av.copy(n).invert(),t.boundsTree)return ns(i,s,p_),p_.matrix.copy(Av),p_.needsUpdate=!0,t.boundsTree.shapecast({intersectsBounds:E=>p_.intersectsBox(E),intersectsTriangle:E=>{E.a.applyMatrix4(n),E.b.applyMatrix4(n),E.c.applyMatrix4(n),E.needsUpdate=!0;for(let x=A*3,C=(g+A)*3;x<C;x+=3)if(Ns(r1,x,h,f),r1.needsUpdate=!0,E.intersectsTriangle(r1))return!0;return!1}});for(let y=A*3,E=(g+A)*3;y<E;y+=3){Ns(i1,y,h,f),i1.a.applyMatrix4(Av),i1.b.applyMatrix4(Av),i1.c.applyMatrix4(Av),i1.needsUpdate=!0;for(let x=0,C=d.count;x<C;x+=3)if(Ns(r1,x,d,m),r1.needsUpdate=!0,i1.intersectsTriangle(r1))return!0}}else{const u=i+8,h=a[i+6];return ns(u,s,d_),!!(r.intersectsBox(d_)&&N5(u,e,t,n,r)||(ns(h,s,d_),r.intersectsBox(d_)&&N5(h,e,t,n,r)))}}const m_=new Xe,cI=new Ta,yv=new Ta,VAe=new H,WAe=new H,jAe=new H,KAe=new H;function $Ae(i,e,t,n={},r={},s=0,o=1/0){e.boundingBox||e.computeBoundingBox(),cI.set(e.boundingBox.min,e.boundingBox.max,t),cI.needsUpdate=!0;const a=i.geometry,l=a.attributes.position,c=a.index,u=e.attributes.position,h=e.index,f=pc.getPrimitive(),d=pc.getPrimitive();let m=VAe,A=WAe,g=null,y=null;r&&(g=jAe,y=KAe);let E=1/0,x=null,C=null;return m_.copy(t).invert(),yv.matrix.copy(m_),i.shapecast({boundsTraverseOrder:T=>cI.distanceToBox(T),intersectsBounds:(T,I,M)=>M<E&&M<o?(I&&(yv.min.copy(T.min),yv.max.copy(T.max),yv.needsUpdate=!0),!0):!1,intersectsRange:(T,I)=>{if(e.boundsTree)return e.boundsTree.shapecast({boundsTraverseOrder:L=>yv.distanceToBox(L),intersectsBounds:(L,R,P)=>P<E&&P<o,intersectsRange:(L,R)=>{for(let P=L,F=L+R;P<F;P++){Ns(d,3*P,h,u),d.a.applyMatrix4(t),d.b.applyMatrix4(t),d.c.applyMatrix4(t),d.needsUpdate=!0;for(let k=T,z=T+I;k<z;k++){Ns(f,3*k,c,l),f.needsUpdate=!0;const U=f.distanceToTriangle(d,m,g);if(U<E&&(A.copy(m),y&&y.copy(g),E=U,x=k,C=P),U<s)return!0}}}});{const M=IA(e);for(let L=0,R=M;L<R;L++){Ns(d,3*L,h,u),d.a.applyMatrix4(t),d.b.applyMatrix4(t),d.c.applyMatrix4(t),d.needsUpdate=!0;for(let P=T,F=T+I;P<F;P++){Ns(f,3*P,c,l),f.needsUpdate=!0;const k=f.distanceToTriangle(d,m,g);if(k<E&&(A.copy(m),y&&y.copy(g),E=k,x=P,C=L),k<s)return!0}}}}}),pc.releasePrimitive(f),pc.releasePrimitive(d),E===1/0?null:(n.point?n.point.copy(A):n.point=A.clone(),n.distance=E,n.faceIndex=x,r&&(r.point?r.point.copy(y):r.point=y.clone(),r.point.applyMatrix4(m_),A.applyMatrix4(m_),r.distance=A.sub(r.point).length(),r.faceIndex=C),n)}function YAe(i,e=null){e&&Array.isArray(e)&&(e=new Set(e));const t=i.geometry,n=t.index?t.index.array:null,r=t.attributes.position;let s,o,a,l,c=0;const u=i._roots;for(let f=0,d=u.length;f<d;f++)s=u[f],o=new Uint32Array(s),a=new Uint16Array(s),l=new Float32Array(s),h(0,c),c+=s.byteLength;function h(f,d,m=!1){const A=f*2;if(a[A+15]===T4){const y=o[f+6],E=a[A+14];let x=1/0,C=1/0,T=1/0,I=-1/0,M=-1/0,L=-1/0;for(let R=y,P=y+E;R<P;R++){const F=3*i.resolveTriangleIndex(R);for(let k=0;k<3;k++){let z=F+k;z=n?n[z]:z;const U=r.getX(z),W=r.getY(z),$=r.getZ(z);U<x&&(x=U),U>I&&(I=U),W<C&&(C=W),W>M&&(M=W),$<T&&(T=$),$>L&&(L=$)}}return l[f+0]!==x||l[f+1]!==C||l[f+2]!==T||l[f+3]!==I||l[f+4]!==M||l[f+5]!==L?(l[f+0]=x,l[f+1]=C,l[f+2]=T,l[f+3]=I,l[f+4]=M,l[f+5]=L,!0):!1}else{const y=f+8,E=o[f+6],x=y+d,C=E+d;let T=m,I=!1,M=!1;e?T||(I=e.has(x),M=e.has(C),T=!I&&!M):(I=!0,M=!0);const L=T||I,R=T||M;let P=!1;L&&(P=h(y,d,T));let F=!1;R&&(F=h(E,d,T));const k=P||F;if(k)for(let z=0;z<3;z++){const U=y+z,W=E+z,$=l[U],oe=l[U+3],X=l[W],Q=l[W+3];l[f+z]=$<X?$:X,l[f+z+3]=oe>Q?oe:Q}return k}}}function XAe(i,e,t,n,r,s,o){br.setBuffer(i._roots[e]),U5(0,i,t,n,r,s,o),br.clearBuffer()}function U5(i,e,t,n,r,s,o){const{float32Array:a,uint16Array:l,uint32Array:c}=br,u=i*2;if(va(u,l)){const f=el(i,c),d=Il(u,l);OAe(e,t,n,f,d,r,s,o)}else{const f=dc(i);lp(f,a,n,s,o)&&U5(f,e,t,n,r,s,o);const d=Ml(i,c);lp(d,a,n,s,o)&&U5(d,e,t,n,r,s,o)}}const qAe=["x","y","z"];function JAe(i,e,t,n,r,s){br.setBuffer(i._roots[e]);const o=z5(0,i,t,n,r,s);return br.clearBuffer(),o}function z5(i,e,t,n,r,s){const{float32Array:o,uint16Array:a,uint32Array:l}=br;let c=i*2;if(va(c,a)){const h=el(i,l),f=Il(c,a);return NAe(e,t,n,h,f,r,s)}else{const h=n8(i,l),f=qAe[h],m=n.direction[f]>=0;let A,g;m?(A=dc(i),g=Ml(i,l)):(A=Ml(i,l),g=dc(i));const E=lp(A,o,n,r,s)?z5(A,e,t,n,r,s):null;if(E){const T=E.point[f];if(m?T<=o[g+h]:T>=o[g+h+3])return E}const C=lp(g,o,n,r,s)?z5(g,e,t,n,r,s):null;return E&&C?E.distance<=C.distance?E:C:E||C||null}}const g_=new ti,s1=new Tu,o1=new Tu,vv=new Xe,tF=new Ta,A_=new Ta;function ZAe(i,e,t,n){br.setBuffer(i._roots[e]);const r=G5(0,i,t,n);return br.clearBuffer(),r}function G5(i,e,t,n,r=null){const{float32Array:s,uint16Array:o,uint32Array:a}=br;let l=i*2;if(r===null&&(t.boundingBox||t.computeBoundingBox(),tF.set(t.boundingBox.min,t.boundingBox.max,n),r=tF),va(l,o)){const u=e.geometry,h=u.index,f=u.attributes.position,d=t.index,m=t.attributes.position,A=el(i,a),g=Il(l,o);if(vv.copy(n).invert(),t.boundsTree)return ns(i,s,A_),A_.matrix.copy(vv),A_.needsUpdate=!0,t.boundsTree.shapecast({intersectsBounds:E=>A_.intersectsBox(E),intersectsTriangle:E=>{E.a.applyMatrix4(n),E.b.applyMatrix4(n),E.c.applyMatrix4(n),E.needsUpdate=!0;for(let x=A,C=g+A;x<C;x++)if(Ns(o1,3*e.resolveTriangleIndex(x),h,f),o1.needsUpdate=!0,E.intersectsTriangle(o1))return!0;return!1}});for(let y=A,E=g+A;y<E;y++){const x=e.resolveTriangleIndex(y);Ns(s1,3*x,h,f),s1.a.applyMatrix4(vv),s1.b.applyMatrix4(vv),s1.c.applyMatrix4(vv),s1.needsUpdate=!0;for(let C=0,T=d.count;C<T;C+=3)if(Ns(o1,C,d,m),o1.needsUpdate=!0,s1.intersectsTriangle(o1))return!0}}else{const u=i+8,h=a[i+6];return ns(u,s,g_),!!(r.intersectsBox(g_)&&G5(u,e,t,n,r)||(ns(h,s,g_),r.intersectsBox(g_)&&G5(h,e,t,n,r)))}}const y_=new Xe,uI=new Ta,xv=new Ta,eye=new H,tye=new H,nye=new H,iye=new H;function rye(i,e,t,n={},r={},s=0,o=1/0){e.boundingBox||e.computeBoundingBox(),uI.set(e.boundingBox.min,e.boundingBox.max,t),uI.needsUpdate=!0;const a=i.geometry,l=a.attributes.position,c=a.index,u=e.attributes.position,h=e.index,f=pc.getPrimitive(),d=pc.getPrimitive();let m=eye,A=tye,g=null,y=null;r&&(g=nye,y=iye);let E=1/0,x=null,C=null;return y_.copy(t).invert(),xv.matrix.copy(y_),i.shapecast({boundsTraverseOrder:T=>uI.distanceToBox(T),intersectsBounds:(T,I,M)=>M<E&&M<o?(I&&(xv.min.copy(T.min),xv.max.copy(T.max),xv.needsUpdate=!0),!0):!1,intersectsRange:(T,I)=>{if(e.boundsTree){const M=e.boundsTree;return M.shapecast({boundsTraverseOrder:L=>xv.distanceToBox(L),intersectsBounds:(L,R,P)=>P<E&&P<o,intersectsRange:(L,R)=>{for(let P=L,F=L+R;P<F;P++){const k=M.resolveTriangleIndex(P);Ns(d,3*k,h,u),d.a.applyMatrix4(t),d.b.applyMatrix4(t),d.c.applyMatrix4(t),d.needsUpdate=!0;for(let z=T,U=T+I;z<U;z++){const W=i.resolveTriangleIndex(z);Ns(f,3*W,c,l),f.needsUpdate=!0;const $=f.distanceToTriangle(d,m,g);if($<E&&(A.copy(m),y&&y.copy(g),E=$,x=z,C=P),$<s)return!0}}}})}else{const M=IA(e);for(let L=0,R=M;L<R;L++){Ns(d,3*L,h,u),d.a.applyMatrix4(t),d.b.applyMatrix4(t),d.c.applyMatrix4(t),d.needsUpdate=!0;for(let P=T,F=T+I;P<F;P++){const k=i.resolveTriangleIndex(P);Ns(f,3*k,c,l),f.needsUpdate=!0;const z=f.distanceToTriangle(d,m,g);if(z<E&&(A.copy(m),y&&y.copy(g),E=z,x=P,C=L),z<s)return!0}}}}}),pc.releasePrimitive(f),pc.releasePrimitive(d),E===1/0?null:(n.point?n.point.copy(A):n.point=A.clone(),n.distance=E,n.faceIndex=x,r&&(r.point?r.point.copy(y):r.point=y.clone(),r.point.applyMatrix4(y_),A.applyMatrix4(y_),r.distance=A.sub(r.point).length(),r.faceIndex=C),n)}function sye(){return typeof SharedArrayBuffer<"u"}const h2=new br.constructor,qS=new br.constructor,Od=new r8(()=>new ti),a1=new ti,l1=new ti,hI=new ti,fI=new ti;let dI=!1;function oye(i,e,t,n){if(dI)throw new Error("MeshBVH: Recursive calls to bvhcast not supported.");dI=!0;const r=i._roots,s=e._roots;let o,a=0,l=0;const c=new Xe().copy(t).invert();for(let u=0,h=r.length;u<h;u++){h2.setBuffer(r[u]),l=0;const f=Od.getPrimitive();ns(0,h2.float32Array,f),f.applyMatrix4(c);for(let d=0,m=s.length;d<m&&(qS.setBuffer(s[d]),o=lu(0,0,t,c,n,a,l,0,0,f),qS.clearBuffer(),l+=s[d].length,!o);d++);if(Od.releasePrimitive(f),h2.clearBuffer(),a+=r[u].length,o)break}return dI=!1,o}function lu(i,e,t,n,r,s=0,o=0,a=0,l=0,c=null,u=!1){let h,f;u?(h=qS,f=h2):(h=h2,f=qS);const d=h.float32Array,m=h.uint32Array,A=h.uint16Array,g=f.float32Array,y=f.uint32Array,E=f.uint16Array,x=i*2,C=e*2,T=va(x,A),I=va(C,E);let M=!1;if(I&&T)u?M=r(el(e,y),Il(e*2,E),el(i,m),Il(i*2,A),l,o+e,a,s+i):M=r(el(i,m),Il(i*2,A),el(e,y),Il(e*2,E),a,s+i,l,o+e);else if(I){const L=Od.getPrimitive();ns(e,g,L),L.applyMatrix4(t);const R=dc(i),P=Ml(i,m);ns(R,d,a1),ns(P,d,l1);const F=L.intersectsBox(a1),k=L.intersectsBox(l1);M=F&&lu(e,R,n,t,r,o,s,l,a+1,L,!u)||k&&lu(e,P,n,t,r,o,s,l,a+1,L,!u),Od.releasePrimitive(L)}else{const L=dc(e),R=Ml(e,y);ns(L,g,hI),ns(R,g,fI);const P=c.intersectsBox(hI),F=c.intersectsBox(fI);if(P&&F)M=lu(i,L,t,n,r,s,o,a,l+1,c,u)||lu(i,R,t,n,r,s,o,a,l+1,c,u);else if(P)if(T)M=lu(i,L,t,n,r,s,o,a,l+1,c,u);else{const k=Od.getPrimitive();k.copy(hI).applyMatrix4(t);const z=dc(i),U=Ml(i,m);ns(z,d,a1),ns(U,d,l1);const W=k.intersectsBox(a1),$=k.intersectsBox(l1);M=W&&lu(L,z,n,t,r,o,s,l,a+1,k,!u)||$&&lu(L,U,n,t,r,o,s,l,a+1,k,!u),Od.releasePrimitive(k)}else if(F)if(T)M=lu(i,R,t,n,r,s,o,a,l+1,c,u);else{const k=Od.getPrimitive();k.copy(fI).applyMatrix4(t);const z=dc(i),U=Ml(i,m);ns(z,d,a1),ns(U,d,l1);const W=k.intersectsBox(a1),$=k.intersectsBox(l1);M=W&&lu(R,z,n,t,r,o,s,l,a+1,k,!u)||$&&lu(R,U,n,t,r,o,s,l,a+1,k,!u),Od.releasePrimitive(k)}}return M}const v_=new Ta,nF=new ti,aye={strategy:dW,maxDepth:40,maxLeafTris:10,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,indirect:!1,verbose:!0,range:null};class I4{static serialize(e,t={}){t={cloneBuffers:!0,...t};const n=e.geometry,r=e._roots,s=e._indirectBuffer,o=n.getIndex();let a;return t.cloneBuffers?a={roots:r.map(l=>l.slice()),index:o?o.array.slice():null,indirectBuffer:s?s.slice():null}:a={roots:r,index:o?o.array:null,indirectBuffer:s},a}static deserialize(e,t,n={}){n={setIndex:!0,indirect:!!e.indirectBuffer,...n};const{index:r,roots:s,indirectBuffer:o}=e,a=new I4(t,{...n,[rI]:!0});if(a._roots=s,a._indirectBuffer=o||null,n.setIndex){const l=t.getIndex();if(l===null){const c=new mn(e.index,1,!1);t.setIndex(c)}else l.array!==r&&(l.array.set(r),l.needsUpdate=!0)}return a}get indirect(){return!!this._indirectBuffer}constructor(e,t={}){if(e.isBufferGeometry){if(e.index&&e.index.isInterleavedBufferAttribute)throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.")}else throw new Error("MeshBVH: Only BufferGeometries are supported.");if(t=Object.assign({...aye,[rI]:!1},t),t.useSharedArrayBuffer&&!sye())throw new Error("MeshBVH: SharedArrayBuffer is not available.");this.geometry=e,this._roots=null,this._indirectBuffer=null,t[rI]||(SAe(this,t),!e.boundingBox&&t.setBoundingBox&&(e.boundingBox=this.getBoundingBox(new ti))),this.resolveTriangleIndex=t.indirect?n=>this._indirectBuffer[n]:n=>n}refit(e=null){return(this.indirect?YAe:FAe)(this,e)}traverse(e,t=0){const n=this._roots[t],r=new Uint32Array(n),s=new Uint16Array(n);o(0);function o(a,l=0){const c=a*2,u=s[c+15]===T4;if(u){const h=r[a+6],f=s[c+14];e(l,u,new Float32Array(n,a*4,6),h,f)}else{const h=a+Jd/4,f=r[a+6],d=r[a+7];e(l,u,new Float32Array(n,a*4,6),d)||(o(h,l+1),o(f,l+1))}}}raycast(e,t=tl,n=0,r=1/0){const s=this._roots,o=this.geometry,a=[],l=t.isMaterial,c=Array.isArray(t),u=o.groups,h=l?t.side:t,f=this.indirect?XAe:zAe;for(let d=0,m=s.length;d<m;d++){const A=c?t[u[d].materialIndex].side:h,g=a.length;if(f(this,d,A,e,a,n,r),c){const y=u[d].materialIndex;for(let E=g,x=a.length;E<x;E++)a[E].face.materialIndex=y}}return a}raycastFirst(e,t=tl,n=0,r=1/0){const s=this._roots,o=this.geometry,a=t.isMaterial,l=Array.isArray(t);let c=null;const u=o.groups,h=a?t.side:t,f=this.indirect?JAe:HAe;for(let d=0,m=s.length;d<m;d++){const A=l?t[u[d].materialIndex].side:h,g=f(this,d,A,e,n,r);g!=null&&(c==null||g.distance<c.distance)&&(c=g,l&&(g.face.materialIndex=u[d].materialIndex))}return c}intersectsGeometry(e,t){let n=!1;const r=this._roots,s=this.indirect?ZAe:QAe;for(let o=0,a=r.length;o<a&&(n=s(this,o,e,t),!n);o++);return n}shapecast(e){const t=pc.getPrimitive(),n=this.indirect?UAe:kAe;let{boundsTraverseOrder:r,intersectsBounds:s,intersectsRange:o,intersectsTriangle:a}=e;if(o&&a){const h=o;o=(f,d,m,A,g)=>h(f,d,m,A,g)?!0:n(f,d,this,a,m,A,t)}else o||(a?o=(h,f,d,m)=>n(h,f,this,a,d,m,t):o=(h,f,d)=>d);let l=!1,c=0;const u=this._roots;for(let h=0,f=u.length;h<f;h++){const d=u[h];if(l=MAe(this,h,s,o,r,c),l)break;c+=d.byteLength}return pc.releasePrimitive(t),l}bvhcast(e,t,n){let{intersectsRanges:r,intersectsTriangles:s}=n;const o=pc.getPrimitive(),a=this.geometry.index,l=this.geometry.attributes.position,c=this.indirect?m=>{const A=this.resolveTriangleIndex(m);Ns(o,A*3,a,l)}:m=>{Ns(o,m*3,a,l)},u=pc.getPrimitive(),h=e.geometry.index,f=e.geometry.attributes.position,d=e.indirect?m=>{const A=e.resolveTriangleIndex(m);Ns(u,A*3,h,f)}:m=>{Ns(u,m*3,h,f)};if(s){const m=(A,g,y,E,x,C,T,I)=>{for(let M=y,L=y+E;M<L;M++){d(M),u.a.applyMatrix4(t),u.b.applyMatrix4(t),u.c.applyMatrix4(t),u.needsUpdate=!0;for(let R=A,P=A+g;R<P;R++)if(c(R),o.needsUpdate=!0,s(o,u,R,M,x,C,T,I))return!0}return!1};if(r){const A=r;r=function(g,y,E,x,C,T,I,M){return A(g,y,E,x,C,T,I,M)?!0:m(g,y,E,x,C,T,I,M)}}else r=m}return oye(this,e,t,r)}intersectsBox(e,t){return v_.set(e.min,e.max,t),v_.needsUpdate=!0,this.shapecast({intersectsBounds:n=>v_.intersectsBox(n),intersectsTriangle:n=>v_.intersectsTriangle(n)})}intersectsSphere(e){return this.shapecast({intersectsBounds:t=>e.intersectsBox(t),intersectsTriangle:t=>t.intersectsSphere(e)})}closestPointToGeometry(e,t,n={},r={},s=0,o=1/0){return(this.indirect?rye:$Ae)(this,e,t,n,r,s,o)}closestPointToPoint(e,t={},n=0,r=1/0){return RAe(this,e,t,n,r)}getBoundingBox(e){return e.makeEmpty(),this._roots.forEach(n=>{ns(0,new Float32Array(n),nF),e.union(nF)}),e}}function iF(i,e,t){return i===null?null:(i.point.applyMatrix4(e.matrixWorld),i.distance=i.point.distanceTo(t.ray.origin),i.object=e,i)}const rF=T6||null,x_=new vc,sF=new H,oF=new Xe,lye=It.prototype.raycast,cye=rF!==null?rF.prototype.raycast:null,aF=new H,Do=new It,E_=[];function xW(i,e){this.isBatchedMesh?uye.call(this,i,e):hye.call(this,i,e)}function uye(i,e){if(this.boundsTrees){const t=this.boundsTrees,n=this._drawInfo,r=this._drawRanges,s=this.matrixWorld;Do.material=this.material,Do.geometry=this.geometry;const o=Do.geometry.boundsTree,a=Do.geometry.drawRange;Do.geometry.boundingSphere===null&&(Do.geometry.boundingSphere=new Bi);for(let l=0,c=n.length;l<c;l++){if(!this.getVisibleAt(l))continue;const u=n[l].geometryIndex;if(Do.geometry.boundsTree=t[u],this.getMatrixAt(l,Do.matrixWorld).premultiply(s),!Do.geometry.boundsTree){this.getBoundingBoxAt(u,Do.geometry.boundingBox),this.getBoundingSphereAt(u,Do.geometry.boundingSphere);const h=r[u];Do.geometry.setDrawRange(h.start,h.count)}Do.raycast(i,E_);for(let h=0,f=E_.length;h<f;h++){const d=E_[h];d.object=this,d.batchId=l,e.push(d)}E_.length=0}Do.geometry.boundsTree=o,Do.geometry.drawRange=a,Do.material=null,Do.geometry=null}else cye.call(this,i,e)}function hye(i,e){if(this.geometry.boundsTree){if(this.material===void 0)return;oF.copy(this.matrixWorld).invert(),x_.copy(i.ray).applyMatrix4(oF),aF.setFromMatrixScale(this.matrixWorld),sF.copy(x_.direction).multiply(aF);const t=sF.length(),n=i.near/t,r=i.far/t,s=this.geometry.boundsTree;if(i.firstHitOnly===!0){const o=iF(s.raycastFirst(x_,this.material,n,r),this,i);o&&e.push(o)}else{const o=s.raycast(x_,this.material,n,r);for(let a=0,l=o.length;a<l;a++){const c=iF(o[a],this,i);c&&e.push(c)}}}else lye.call(this,i,e)}function EW(i={}){return this.boundsTree=new I4(this,i),this.boundsTree}function _W(){this.boundsTree=null}function fye(i){switch(i){case 1:return"R";case 2:return"RG";case 3:return"RGBA";case 4:return"RGBA"}throw new Error}function dye(i){switch(i){case 1:return hc;case 2:return Gd;case 3:return gi;case 4:return gi}}function lF(i){switch(i){case 1:return yw;case 2:return tx;case 3:return qm;case 4:return qm}}class SW extends Sa{constructor(){super(),this.minFilter=zn,this.magFilter=zn,this.generateMipmaps=!1,this.overrideItemSize=null,this._forcedType=null}updateFrom(e){const t=this.overrideItemSize,n=e.itemSize,r=e.count;if(t!==null){if(n*r%t!==0)throw new Error("VertexAttributeTexture: overrideItemSize must divide evenly into buffer length.");e.itemSize=t,e.count=r*n/t}const s=e.itemSize,o=e.count,a=e.normalized,l=e.array.constructor,c=l.BYTES_PER_ELEMENT;let u=this._forcedType,h=s;if(u===null)switch(l){case Float32Array:u=fi;break;case Uint8Array:case Uint16Array:case Uint32Array:u=Zo;break;case Int8Array:case Int16Array:case Int32Array:u=Nm;break}let f,d,m,A,g=fye(s);switch(u){case fi:m=1,d=dye(s),a&&c===1?(A=l,g+="8",l===Uint8Array?f=Zi:(f=E2,g+="_SNORM")):(A=Float32Array,g+="32F",f=fi);break;case Nm:g+=c*8+"I",m=a?Math.pow(2,l.BYTES_PER_ELEMENT*8-1):1,d=lF(s),c===1?(A=Int8Array,f=E2):c===2?(A=Int16Array,f=Aw):(A=Int32Array,f=Nm);break;case Zo:g+=c*8+"UI",m=a?Math.pow(2,l.BYTES_PER_ELEMENT*8-1):1,d=lF(s),c===1?(A=Uint8Array,f=Zi):c===2?(A=Uint16Array,f=pp):(A=Uint32Array,f=Zo);break}h===3&&(d===gi||d===qm)&&(h=4);const y=Math.ceil(Math.sqrt(o))||1,E=h*y*y,x=new A(E),C=e.normalized;e.normalized=!1;for(let T=0;T<o;T++){const I=h*T;x[I]=e.getX(T)/m,s>=2&&(x[I+1]=e.getY(T)/m),s>=3&&(x[I+2]=e.getZ(T)/m,h===4&&(x[I+3]=1)),s>=4&&(x[I+3]=e.getW(T)/m)}e.normalized=C,this.internalFormat=g,this.format=d,this.type=f,this.image.width=y,this.image.height=y,this.image.data=x,this.needsUpdate=!0,this.dispose(),e.itemSize=n,e.count=r}}class pye extends SW{constructor(){super(),this._forcedType=Zo}}class mye extends SW{constructor(){super(),this._forcedType=fi}}class wW{constructor(){this.index=new pye,this.position=new mye,this.bvhBounds=new Sa,this.bvhContents=new Sa,this._cachedIndexAttr=null,this.index.overrideItemSize=3}updateFrom(e){const{geometry:t}=e;if(Aye(e,this.bvhBounds,this.bvhContents),this.position.updateFrom(t.attributes.position),e.indirect){const n=e._indirectBuffer;if(this._cachedIndexAttr===null||this._cachedIndexAttr.count!==n.length)if(t.index)this._cachedIndexAttr=t.index.clone();else{const r=mW(pW(t));this._cachedIndexAttr=new mn(r,1,!1)}gye(t,n,this._cachedIndexAttr),this.index.updateFrom(this._cachedIndexAttr)}else this.index.updateFrom(t.index)}dispose(){const{index:e,position:t,bvhBounds:n,bvhContents:r}=this;e&&e.dispose(),t&&t.dispose(),n&&n.dispose(),r&&r.dispose()}}function gye(i,e,t){const n=t.array,r=i.index?i.index.array:null;for(let s=0,o=e.length;s<o;s++){const a=3*s,l=3*e[s];for(let c=0;c<3;c++)n[a+c]=r?r[l+c]:l+c}}function Aye(i,e,t){const n=i._roots;if(n.length!==1)throw new Error("MeshBVHUniformStruct: Multi-root BVHs not supported.");const r=n[0],s=new Uint16Array(r),o=new Uint32Array(r),a=new Float32Array(r),l=r.byteLength/Jd,c=2*Math.ceil(Math.sqrt(l/2)),u=new Float32Array(4*c*c),h=Math.ceil(Math.sqrt(l)),f=new Uint32Array(2*h*h);for(let d=0;d<l;d++){const m=d*Jd/4,A=m*2,g=m;for(let y=0;y<3;y++)u[8*d+0+y]=a[g+0+y],u[8*d+4+y]=a[g+3+y];if(va(A,s)){const y=Il(A,s),E=el(m,o),x=4294901760|y;f[d*2+0]=x,f[d*2+1]=E}else{const y=4*Ml(m,o)/Jd,E=n8(m,o);f[d*2+0]=E,f[d*2+1]=y}}e.image.data=u,e.image.width=c,e.image.height=c,e.format=gi,e.type=fi,e.internalFormat="RGBA32F",e.minFilter=zn,e.magFilter=zn,e.generateMipmaps=!1,e.needsUpdate=!0,e.dispose(),t.image.data=f,t.image.width=h,t.image.height=h,t.format=tx,t.type=Zo,t.internalFormat="RG32UI",t.minFilter=zn,t.magFilter=zn,t.generateMipmaps=!1,t.needsUpdate=!0,t.dispose()}const yye=`

// A stack of uint32 indices can can store the indices for
// a perfectly balanced tree with a depth up to 31. Lower stack
// depth gets higher performance.
//
// However not all trees are balanced. Best value to set this to
// is the trees max depth.
#ifndef BVH_STACK_DEPTH
#define BVH_STACK_DEPTH 60
#endif

#ifndef INFINITY
#define INFINITY 1e20
#endif

// Utilities
uvec4 uTexelFetch1D( usampler2D tex, uint index ) {

	uint width = uint( textureSize( tex, 0 ).x );
	uvec2 uv;
	uv.x = index % width;
	uv.y = index / width;

	return texelFetch( tex, ivec2( uv ), 0 );

}

ivec4 iTexelFetch1D( isampler2D tex, uint index ) {

	uint width = uint( textureSize( tex, 0 ).x );
	uvec2 uv;
	uv.x = index % width;
	uv.y = index / width;

	return texelFetch( tex, ivec2( uv ), 0 );

}

vec4 texelFetch1D( sampler2D tex, uint index ) {

	uint width = uint( textureSize( tex, 0 ).x );
	uvec2 uv;
	uv.x = index % width;
	uv.y = index / width;

	return texelFetch( tex, ivec2( uv ), 0 );

}

vec4 textureSampleBarycoord( sampler2D tex, vec3 barycoord, uvec3 faceIndices ) {

	return
		barycoord.x * texelFetch1D( tex, faceIndices.x ) +
		barycoord.y * texelFetch1D( tex, faceIndices.y ) +
		barycoord.z * texelFetch1D( tex, faceIndices.z );

}

void ndcToCameraRay(
	vec2 coord, mat4 cameraWorld, mat4 invProjectionMatrix,
	out vec3 rayOrigin, out vec3 rayDirection
) {

	// get camera look direction and near plane for camera clipping
	vec4 lookDirection = cameraWorld * vec4( 0.0, 0.0, - 1.0, 0.0 );
	vec4 nearVector = invProjectionMatrix * vec4( 0.0, 0.0, - 1.0, 1.0 );
	float near = abs( nearVector.z / nearVector.w );

	// get the camera direction and position from camera matrices
	vec4 origin = cameraWorld * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec4 direction = invProjectionMatrix * vec4( coord, 0.5, 1.0 );
	direction /= direction.w;
	direction = cameraWorld * direction - origin;

	// slide the origin along the ray until it sits at the near clip plane position
	origin.xyz += direction.xyz * near / dot( direction, lookDirection );

	rayOrigin = origin.xyz;
	rayDirection = direction.xyz;

}
`,vye=`

#ifndef TRI_INTERSECT_EPSILON
#define TRI_INTERSECT_EPSILON 1e-5
#endif

// Raycasting
bool intersectsBounds( vec3 rayOrigin, vec3 rayDirection, vec3 boundsMin, vec3 boundsMax, out float dist ) {

	// https://www.reddit.com/r/opengl/comments/8ntzz5/fast_glsl_ray_box_intersection/
	// https://tavianator.com/2011/ray_box.html
	vec3 invDir = 1.0 / rayDirection;

	// find intersection distances for each plane
	vec3 tMinPlane = invDir * ( boundsMin - rayOrigin );
	vec3 tMaxPlane = invDir * ( boundsMax - rayOrigin );

	// get the min and max distances from each intersection
	vec3 tMinHit = min( tMaxPlane, tMinPlane );
	vec3 tMaxHit = max( tMaxPlane, tMinPlane );

	// get the furthest hit distance
	vec2 t = max( tMinHit.xx, tMinHit.yz );
	float t0 = max( t.x, t.y );

	// get the minimum hit distance
	t = min( tMaxHit.xx, tMaxHit.yz );
	float t1 = min( t.x, t.y );

	// set distance to 0.0 if the ray starts inside the box
	dist = max( t0, 0.0 );

	return t1 >= dist;

}

bool intersectsTriangle(
	vec3 rayOrigin, vec3 rayDirection, vec3 a, vec3 b, vec3 c,
	out vec3 barycoord, out vec3 norm, out float dist, out float side
) {

	// https://stackoverflow.com/questions/42740765/intersection-between-line-and-triangle-in-3d
	vec3 edge1 = b - a;
	vec3 edge2 = c - a;
	norm = cross( edge1, edge2 );

	float det = - dot( rayDirection, norm );
	float invdet = 1.0 / det;

	vec3 AO = rayOrigin - a;
	vec3 DAO = cross( AO, rayDirection );

	vec4 uvt;
	uvt.x = dot( edge2, DAO ) * invdet;
	uvt.y = - dot( edge1, DAO ) * invdet;
	uvt.z = dot( AO, norm ) * invdet;
	uvt.w = 1.0 - uvt.x - uvt.y;

	// set the hit information
	barycoord = uvt.wxy; // arranged in A, B, C order
	dist = uvt.z;
	side = sign( det );
	norm = side * normalize( norm );

	// add an epsilon to avoid misses between triangles
	uvt += vec4( TRI_INTERSECT_EPSILON );

	return all( greaterThanEqual( uvt, vec4( 0.0 ) ) );

}

bool intersectTriangles(
	// geometry info and triangle range
	sampler2D positionAttr, usampler2D indexAttr, uint offset, uint count,

	// ray
	vec3 rayOrigin, vec3 rayDirection,

	// outputs
	inout float minDistance, inout uvec4 faceIndices, inout vec3 faceNormal, inout vec3 barycoord,
	inout float side, inout float dist
) {

	bool found = false;
	vec3 localBarycoord, localNormal;
	float localDist, localSide;
	for ( uint i = offset, l = offset + count; i < l; i ++ ) {

		uvec3 indices = uTexelFetch1D( indexAttr, i ).xyz;
		vec3 a = texelFetch1D( positionAttr, indices.x ).rgb;
		vec3 b = texelFetch1D( positionAttr, indices.y ).rgb;
		vec3 c = texelFetch1D( positionAttr, indices.z ).rgb;

		if (
			intersectsTriangle( rayOrigin, rayDirection, a, b, c, localBarycoord, localNormal, localDist, localSide )
			&& localDist < minDistance
		) {

			found = true;
			minDistance = localDist;

			faceIndices = uvec4( indices.xyz, i );
			faceNormal = localNormal;

			side = localSide;
			barycoord = localBarycoord;
			dist = localDist;

		}

	}

	return found;

}

bool intersectsBVHNodeBounds( vec3 rayOrigin, vec3 rayDirection, sampler2D bvhBounds, uint currNodeIndex, out float dist ) {

	uint cni2 = currNodeIndex * 2u;
	vec3 boundsMin = texelFetch1D( bvhBounds, cni2 ).xyz;
	vec3 boundsMax = texelFetch1D( bvhBounds, cni2 + 1u ).xyz;
	return intersectsBounds( rayOrigin, rayDirection, boundsMin, boundsMax, dist );

}

// use a macro to hide the fact that we need to expand the struct into separate fields
#define	bvhIntersectFirstHit(		bvh,		rayOrigin, rayDirection, faceIndices, faceNormal, barycoord, side, dist	)	_bvhIntersectFirstHit(		bvh.position, bvh.index, bvh.bvhBounds, bvh.bvhContents,		rayOrigin, rayDirection, faceIndices, faceNormal, barycoord, side, dist	)

bool _bvhIntersectFirstHit(
	// bvh info
	sampler2D bvh_position, usampler2D bvh_index, sampler2D bvh_bvhBounds, usampler2D bvh_bvhContents,

	// ray
	vec3 rayOrigin, vec3 rayDirection,

	// output variables split into separate variables due to output precision
	inout uvec4 faceIndices, inout vec3 faceNormal, inout vec3 barycoord,
	inout float side, inout float dist
) {

	// stack needs to be twice as long as the deepest tree we expect because
	// we push both the left and right child onto the stack every traversal
	int ptr = 0;
	uint stack[ BVH_STACK_DEPTH ];
	stack[ 0 ] = 0u;

	float triangleDistance = INFINITY;
	bool found = false;
	while ( ptr > - 1 && ptr < BVH_STACK_DEPTH ) {

		uint currNodeIndex = stack[ ptr ];
		ptr --;

		// check if we intersect the current bounds
		float boundsHitDistance;
		if (
			! intersectsBVHNodeBounds( rayOrigin, rayDirection, bvh_bvhBounds, currNodeIndex, boundsHitDistance )
			|| boundsHitDistance > triangleDistance
		) {

			continue;

		}

		uvec2 boundsInfo = uTexelFetch1D( bvh_bvhContents, currNodeIndex ).xy;
		bool isLeaf = bool( boundsInfo.x & 0xffff0000u );

		if ( isLeaf ) {

			uint count = boundsInfo.x & 0x0000ffffu;
			uint offset = boundsInfo.y;

			found = intersectTriangles(
				bvh_position, bvh_index, offset, count,
				rayOrigin, rayDirection, triangleDistance,
				faceIndices, faceNormal, barycoord, side, dist
			) || found;

		} else {

			uint leftIndex = currNodeIndex + 1u;
			uint splitAxis = boundsInfo.x & 0x0000ffffu;
			uint rightIndex = boundsInfo.y;

			bool leftToRight = rayDirection[ splitAxis ] >= 0.0;
			uint c1 = leftToRight ? leftIndex : rightIndex;
			uint c2 = leftToRight ? rightIndex : leftIndex;

			// set c2 in the stack so we traverse it later. We need to keep track of a pointer in
			// the stack while we traverse. The second pointer added is the one that will be
			// traversed first
			ptr ++;
			stack[ ptr ] = c2;

			ptr ++;
			stack[ ptr ] = c1;

		}

	}

	return found;

}
`,xye=`
struct BVH {

	usampler2D index;
	sampler2D position;

	sampler2D bvhBounds;
	usampler2D bvhContents;

};
`,Eye=xye,_ye=`
	${yye}
	${vye}
`,cF=i=>i.isMesh;function Sye(i,e){e={strategy:C4,verbose:!1,setBoundingBox:!0,maxDepth:40,maxLeafTris:10,indirect:!1,...e},w.useEffect(()=>{if(i.current){i.current.raycast=xW;const t=i.current.geometry;return t.computeBoundsTree=EW,t.disposeBoundsTree=_W,t.computeBoundsTree(e),()=>{t.boundsTree&&t.disposeBoundsTree()}}},[i,JSON.stringify(e)])}const wye=w.forwardRef(({enabled:i=!0,firstHitOnly:e=!1,children:t,strategy:n=C4,verbose:r=!1,setBoundingBox:s=!0,maxDepth:o=40,maxLeafTris:a=10,indirect:l=!1,...c},u)=>{const h=w.useRef(null),f=Ve(d=>d.raycaster);return w.useImperativeHandle(u,()=>h.current,[]),w.useEffect(()=>{if(i){const d={strategy:n,verbose:r,setBoundingBox:s,maxDepth:o,maxLeafTris:a,indirect:l},m=h.current;return f.firstHitOnly=e,m.traverse(A=>{cF(A)&&!A.geometry.boundsTree&&A.raycast===It.prototype.raycast&&(A.raycast=xW,A.geometry.computeBoundsTree=EW,A.geometry.disposeBoundsTree=_W,A.geometry.computeBoundsTree(d))}),()=>{delete f.firstHitOnly,m.traverse(A=>{cF(A)&&A.geometry.boundsTree&&(A.geometry.disposeBoundsTree(),A.raycast=It.prototype.raycast)})}}},[]),w.createElement("group",ot({ref:h},c),t)});function Cye(...i){const e=w.useRef([]);return e.current=i.map(t=>w.useContext(t)),w.useMemo(()=>({children:t})=>i.reduceRight((n,r,s)=>w.createElement(r.Provider,{value:e.current[s],children:n}),t),[])}function Tye(i,e){const t=w.useRef(),[n]=w.useState(()=>e?e instanceof _n?{current:e}:e:t),[r]=w.useState(()=>new Y6(void 0));w.useLayoutEffect(()=>{e&&(n.current=e instanceof _n?e:e.current),r._root=n.current});const s=w.useRef({}),o=w.useMemo(()=>{const a={};return i.forEach(l=>Object.defineProperty(a,l.name,{enumerable:!0,get(){if(n.current)return s.current[l.name]||(s.current[l.name]=r.clipAction(l,n.current))},configurable:!0})),{ref:n,clips:i,actions:a,names:i.map(l=>l.name),mixer:r}},[i]);return Kt((a,l)=>r.update(l)),w.useEffect(()=>{const a=n.current;return()=>{s.current={},r.stopAllAction(),Object.values(o.actions).forEach(l=>{a&&r.uncacheAction(l,a)})}},[i]),o}function CW(i){const e=w.useRef(null),t=w.useRef(!1),n=w.useRef(!1),r=w.useRef(i);return w.useLayoutEffect(()=>void(r.current=i),[i]),w.useEffect(()=>{const s=e.current;if(s){const o=Yw(()=>(t.current=!1,!0)),a=s.onBeforeRender;s.onBeforeRender=()=>t.current=!0;const l=Xw(()=>(t.current!==n.current&&(r.current==null||r.current(n.current=t.current)),!0));return()=>{s.onBeforeRender=a,o(),l()}}},[]),e}const bye=`
#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )
  vec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );
  #ifdef BOX_PROJECTED_ENV_MAP
    vWorldPosition = worldPosition.xyz;
  #endif
#endif
`,Iye=`
#ifdef BOX_PROJECTED_ENV_MAP
  uniform vec3 envMapSize;
  uniform vec3 envMapPosition;
  varying vec3 vWorldPosition;
    
  vec3 parallaxCorrectNormal( vec3 v, vec3 cubeSize, vec3 cubePos ) {
    vec3 nDir = normalize( v );
    vec3 rbmax = ( .5 * cubeSize + cubePos - vWorldPosition ) / nDir;
    vec3 rbmin = ( -.5 * cubeSize + cubePos - vWorldPosition ) / nDir;
    vec3 rbminmax;
    rbminmax.x = ( nDir.x > 0. ) ? rbmax.x : rbmin.x;
    rbminmax.y = ( nDir.y > 0. ) ? rbmax.y : rbmin.y;
    rbminmax.z = ( nDir.z > 0. ) ? rbmax.z : rbmin.z;
    float correction = min( min( rbminmax.x, rbminmax.y ), rbminmax.z );
    vec3 boxIntersection = vWorldPosition + nDir * correction;    
    return boxIntersection - cubePos;
  }
#endif
`,Mye=`
#ifdef BOX_PROJECTED_ENV_MAP
  worldNormal = parallaxCorrectNormal( worldNormal, envMapSize, envMapPosition );
#endif
`,Rye=`
#ifdef BOX_PROJECTED_ENV_MAP
  reflectVec = parallaxCorrectNormal( reflectVec, envMapSize, envMapPosition );
#endif
`;function Lye(i,e,t){i.defines.BOX_PROJECTED_ENV_MAP=!0,i.uniforms.envMapPosition={value:e},i.uniforms.envMapSize={value:t},i.vertexShader=`
  varying vec3 vWorldPosition;
  ${i.vertexShader.replace("#include <worldpos_vertex>",bye)}`,i.fragmentShader=`
    ${Iye}
    ${i.fragmentShader.replace("#include <envmap_physical_pars_fragment>",Un.envmap_physical_pars_fragment).replace("vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );",`vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
         ${Mye}
         `).replace("reflectVec = inverseTransformDirection( reflectVec, viewMatrix );",`reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
         ${Rye}
        `)}`}function Pye(i=new H,e=new H){const[t]=w.useState(()=>({position:new H,size:new H}));Os(t,{position:i,size:e});const n=w.useRef(null),r=w.useMemo(()=>({ref:n,onBeforeCompile:s=>Lye(s,t.position,t.size),customProgramCacheKey:()=>JSON.stringify(t.position.toArray())+JSON.stringify(t.size.toArray())}),[...t.position.toArray(),...t.size.toArray()]);return w.useLayoutEffect(()=>void(n.current.needsUpdate=!0),[t]),r}const uF=new ti,__=new H,Bye=({anchor:i,...e})=>{const t=w.useRef(null),n=w.useRef(null);return w.useEffect(()=>{var r;(r=t.current)!=null&&(r=r.parent)!=null&&r.parent&&(n.current=t.current.parent,t.current.parent.parent.add(t.current))},[]),Kt(()=>{n.current&&(uF.setFromObject(n.current),uF.getSize(__),t.current.position.set(n.current.position.x+__.x*(Array.isArray(i)?i[0]:i.x)/2,n.current.position.y+__.y*(Array.isArray(i)?i[1]:i.y)/2,n.current.position.z+__.z*(Array.isArray(i)?i[2]:i.z)/2))}),w.createElement("group",ot({ref:t},e))};function Dye(i,e,t=.9){return e*t+i*(1-t)}const kye=i=>Math.sqrt(1-Math.pow(i-1,2));class Fye{constructor({size:e=256,maxAge:t=750,radius:n=.3,intensity:r=.2,interpolate:s=0,smoothing:o=0,minForce:a=.3,blend:l="screen",ease:c=kye}={}){this.size=e,this.maxAge=t,this.radius=n,this.intensity=r,this.ease=c,this.interpolate=s,this.smoothing=o,this.minForce=a,this.blend=l,this.trail=[],this.force=0,this.initTexture()}initTexture(){this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=this.size;const e=this.canvas.getContext("2d");if(e===null)throw new Error("2D not available");this.ctx=e,this.ctx.fillStyle="black",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.texture=new vi(this.canvas),this.canvas.id="touchTexture",this.canvas.style.width=this.canvas.style.height=`${this.canvas.width}px`}update(e){this.clear(),this.trail.forEach((t,n)=>{t.age+=e*1e3,t.age>this.maxAge&&this.trail.splice(n,1)}),this.trail.length||(this.force=0),this.trail.forEach(t=>{this.drawTouch(t)}),this.texture.needsUpdate=!0}clear(){this.ctx.globalCompositeOperation="source-over",this.ctx.fillStyle="black",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height)}addTouch(e){const t=this.trail[this.trail.length-1];if(t){const n=t.x-e.x,r=t.y-e.y,s=n*n+r*r,o=Math.max(this.minForce,Math.min(s*1e4,1));if(this.force=Dye(o,this.force,this.smoothing),this.interpolate){const a=Math.ceil(s/Math.pow(this.radius*.5/this.interpolate,2));if(a>1)for(let l=1;l<a;l++)this.trail.push({x:t.x-n/a*l,y:t.y-r/a*l,age:0,force:o})}}this.trail.push({x:e.x,y:e.y,age:0,force:this.force})}drawTouch(e){const t={x:e.x*this.size,y:(1-e.y)*this.size};let n=1;e.age<this.maxAge*.3?n=this.ease(e.age/(this.maxAge*.3)):n=this.ease(1-(e.age-this.maxAge*.3)/(this.maxAge*.7)),n*=e.force,this.ctx.globalCompositeOperation=this.blend;const r=this.size*this.radius*n,s=this.ctx.createRadialGradient(t.x,t.y,Math.max(0,r*.25),t.x,t.y,Math.max(0,r));s.addColorStop(0,`rgba(255, 255, 255, ${this.intensity})`),s.addColorStop(1,"rgba(0, 0, 0, 0.0)"),this.ctx.beginPath(),this.ctx.fillStyle=s,this.ctx.arc(t.x,t.y,Math.max(0,r),0,Math.PI*2),this.ctx.fill()}}function TW(i={}){const{size:e,maxAge:t,radius:n,intensity:r,interpolate:s,smoothing:o,minForce:a,blend:l,ease:c}=i,u=w.useMemo(()=>new Fye(i),[e,t,n,r,s,o,a,l,c]);Kt((f,d)=>void u.update(d));const h=w.useCallback(f=>u.addTouch(f.uv),[u]);return[u.texture,h]}const Oye=({children:i,...e})=>{const t=TW(e);return w.createElement(w.Fragment,null,i==null?void 0:i(t))},s8=w.forwardRef(function({children:e,disable:t,disableX:n,disableY:r,disableZ:s,left:o,right:a,top:l,bottom:c,front:u,back:h,onCentered:f,precise:d=!0,cacheKey:m=0,...A},g){const y=w.useRef(null),E=w.useRef(null),x=w.useRef(null);return w.useLayoutEffect(()=>{E.current.matrixWorld.identity();const C=new ti().setFromObject(x.current,d),T=new H,I=new Bi,M=C.max.x-C.min.x,L=C.max.y-C.min.y,R=C.max.z-C.min.z;C.getCenter(T),C.getBoundingSphere(I);const P=l?L/2:c?-L/2:0,F=o?-M/2:a?M/2:0,k=u?R/2:h?-R/2:0;E.current.position.set(t||n?0:-T.x+F,t||r?0:-T.y+P,t||s?0:-T.z+k),typeof f<"u"&&f({parent:y.current.parent,container:y.current,width:M,height:L,depth:R,boundingBox:C,boundingSphere:I,center:T,verticalAlignment:P,horizontalAlignment:F,depthAlignment:k})},[m,f,l,o,u,t,n,r,s,d,a,c,h]),w.useImperativeHandle(g,()=>y.current,[]),w.createElement("group",ot({ref:y},A),w.createElement("group",{ref:E},w.createElement("group",{ref:x},e)))}),Nye=w.forwardRef(({font:i,color:e="#cbcbcb",bevelSize:t=.04,debug:n=!1,children:r,...s},o)=>{const[a,l]=w.useState(0),c=w.useCallback((f=1)=>l(a+f),[a]),u=w.useCallback((f=1)=>l(a-f),[a]),h=w.useMemo(()=>({incr:c,decr:u}),[c,u]);return w.useImperativeHandle(o,()=>h,[h]),w.createElement("group",s,w.createElement(w.Suspense,{fallback:null},w.createElement(s8,{top:!0,cacheKey:JSON.stringify({counter:a,font:i})},w.createElement(tQ,{bevelEnabled:!0,bevelSize:t,font:i},n?w.createElement("meshNormalMaterial",{wireframe:!0}):w.createElement("meshStandardMaterial",{color:e}),a))),r)});var pI={exports:{}},mI,hF;function Uye(){if(hF)return mI;hF=1;var i="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return mI=i,mI}var gI,fF;function zye(){if(fF)return gI;fF=1;var i=Uye();function e(){}function t(){}return t.resetWarningCache=e,gI=function(){function n(o,a,l,c,u,h){if(h!==i){var f=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw f.name="Invariant Violation",f}}n.isRequired=n;function r(){return n}var s={array:n,bigint:n,bool:n,func:n,number:n,object:n,string:n,symbol:n,any:n,arrayOf:r,element:n,elementType:n,instanceOf:r,node:n,objectOf:r,oneOf:r,oneOfType:r,shape:r,exact:r,checkPropTypes:t,resetWarningCache:e};return s.PropTypes=s,s},gI}var dF;function Gye(){return dF||(dF=1,pI.exports=zye()()),pI.exports}var Hye=Gye();const Ev=AA(Hye);function bW(i){return IW(i.children,i.components)}bW.propTypes={children:Ev.func.isRequired,components:Ev.arrayOf(Ev.oneOfType([Ev.element,Ev.func])).isRequired};function IW(i,e,t){if(t=t||[],!e[0])return i(t);function n(r){return IW(i,e.slice(1),t.concat([r]))}return typeof e[0]=="function"?e[0]({results:t,render:n}):w.cloneElement(e[0],{children:n})}const f2=(i,e)=>{"updateRanges"in i?i.updateRanges[0]=e:i.updateRange=e},Qye=3e3,Vye=3001;function Wye(i){return typeof i=="function"}const pF=new Xe,mF=new Xe,S_=[],_v=new It;class MW extends xa{constructor(){super(),this.color=new ut("white"),this.instance={current:void 0},this.instanceKey={current:void 0}}get geometry(){var e;return(e=this.instance.current)==null?void 0:e.geometry}raycast(e,t){const n=this.instance.current;if(!n||!n.geometry||!n.material)return;_v.geometry=n.geometry;const r=n.matrixWorld,s=n.userData.instances.indexOf(this.instanceKey);if(!(s===-1||s>n.count)){n.getMatrixAt(s,pF),mF.multiplyMatrices(r,pF),_v.matrixWorld=mF,n.material instanceof Us?_v.material.side=n.material.side:_v.material.side=n.material[0].side,_v.raycast(e,S_);for(let o=0,a=S_.length;o<a;o++){const l=S_[o];l.instanceId=s,l.object=this,t.push(l)}S_.length=0}}}const RW=w.createContext(null),gF=new Xe,AF=new Xe,jye=new Xe,yF=new H,vF=new Xt,xF=new H,Kye=i=>i.isInstancedBufferAttribute,M4=w.forwardRef(({context:i,children:e,...t},n)=>{w.useMemo(()=>Or({PositionMesh:MW}),[]);const r=w.useRef();w.useImperativeHandle(n,()=>r.current,[]);const{subscribe:s,getParent:o}=w.useContext(i||RW);return w.useLayoutEffect(()=>s(r),[]),w.createElement("positionMesh",ot({instance:o(),instanceKey:r,ref:r},t),e)}),R4=w.forwardRef(({context:i,children:e,range:t,limit:n=1e3,frames:r=1/0,...s},o)=>{const[{localContext:a,instance:l}]=w.useState(()=>{const E=w.createContext(null);return{localContext:E,instance:w.forwardRef((x,C)=>w.createElement(M4,ot({context:E},x,{ref:C})))}}),c=w.useRef(null);w.useImperativeHandle(o,()=>c.current,[]);const[u,h]=w.useState([]),[[f,d]]=w.useState(()=>{const E=new Float32Array(n*16);for(let x=0;x<n;x++)jye.identity().toArray(E,x*16);return[E,new Float32Array([...new Array(n*3)].map(()=>1))]});w.useEffect(()=>{c.current.instanceMatrix.needsUpdate=!0});let m=0,A=0;const g=w.useRef([]);w.useLayoutEffect(()=>{g.current=Object.entries(c.current.geometry.attributes).filter(([E,x])=>Kye(x))}),Kt(()=>{if(r===1/0||m<r){c.current.updateMatrix(),c.current.updateMatrixWorld(),gF.copy(c.current.matrixWorld).invert(),A=Math.min(n,t!==void 0?t:n,u.length),c.current.count=A,f2(c.current.instanceMatrix,{offset:0,count:A*16}),f2(c.current.instanceColor,{offset:0,count:A*3});for(let E=0;E<u.length;E++){const x=u[E].current;x.matrixWorld.decompose(yF,vF,xF),AF.compose(yF,vF,xF).premultiply(gF),AF.toArray(f,E*16),c.current.instanceMatrix.needsUpdate=!0,x.color.toArray(d,E*3),c.current.instanceColor.needsUpdate=!0}m++}});const y=w.useMemo(()=>({getParent:()=>c,subscribe:E=>(h(x=>[...x,E]),()=>h(x=>x.filter(C=>C.current!==E.current)))}),[]);return w.createElement("instancedMesh",ot({userData:{instances:u,limit:n,frames:r},matrixAutoUpdate:!1,ref:c,args:[null,null,0],raycast:()=>null},s),w.createElement("instancedBufferAttribute",{attach:"instanceMatrix",count:f.length/16,array:f,itemSize:16,usage:No}),w.createElement("instancedBufferAttribute",{attach:"instanceColor",count:d.length/3,array:d,itemSize:3,usage:No}),Wye(e)?w.createElement(a.Provider,{value:y},e(l)):i?w.createElement(i.Provider,{value:y},e):w.createElement(RW.Provider,{value:y},e))}),$ye=w.forwardRef(function({meshes:e,children:t,...n},r){const s=Array.isArray(e);if(!s)for(const o of Object.keys(e))e[o].isMesh||delete e[o];return w.createElement("group",{ref:r},w.createElement(bW,{components:(s?e:Object.values(e)).map(({geometry:o,material:a})=>w.createElement(R4,ot({key:o.uuid,geometry:o,material:a},n)))},o=>s?t(...o):t(Object.keys(e).filter(a=>e[a].isMesh).reduce((a,l,c)=>({...a,[l]:o[c]}),{}))))});function Yye(){const i=w.createContext(null);return[w.forwardRef((e,t)=>w.createElement(R4,ot({ref:t,context:i},e))),w.forwardRef((e,t)=>w.createElement(M4,ot({ref:t,context:i},e)))]}const Xye=w.forwardRef(({name:i,defaultValue:e,normalized:t,usage:n=No},r)=>{const s=w.useRef(null);w.useImperativeHandle(r,()=>s.current,[]),w.useLayoutEffect(()=>{const a=s.current.__r3f.parent;a.geometry.attributes[i]=s.current;const l=Array.isArray(e)?e:[e],c=Array.from({length:a.userData.limit},()=>l).flat();return s.current.array=new Float32Array(c),s.current.itemSize=l.length,s.current.count=c.length/s.current.itemSize,()=>{delete a.geometry.attributes[i]}},[i]);let o=0;return Kt(()=>{const a=s.current.__r3f.parent;if(a.userData.frames===1/0||o<a.userData.frames){for(let l=0;l<a.userData.instances.length;l++){const u=a.userData.instances[l].current[i];u!==void 0&&(s.current.set(Array.isArray(u)?u:typeof u.toArray=="function"?u.toArray():[u],l*s.current.itemSize),s.current.needsUpdate=!0)}o++}}),w.createElement("instancedBufferAttribute",{ref:s,usage:n,normalized:t})}),LW=w.createContext(null);function qye(){return w.useContext(LW)}function Jye(i){return i!==null&&"meta"in i&&"frames"in i}const EF=new Fs(1,1),Zye=w.forwardRef(({startFrame:i=0,endFrame:e,fps:t=30,frameName:n="",textureDataURL:r,textureImageURL:s,loop:o=!1,numberOfFrames:a=1,autoPlay:l=!0,animationNames:c,onStart:u,onEnd:h,onLoopEnd:f,onFrame:d,play:m,pause:A=!1,flipX:g=!1,alphaTest:y=0,children:E,asSprite:x=!1,offset:C,playBackwards:T=!1,resetOnEnd:I=!1,maxItems:M=1,instanceItems:L=[[0,0,0]],spriteDataset:R,canvasRenderingContext2DSettings:P,roundFramePosition:F=!1,meshProps:k={},...z},U)=>{const W=w.useRef(new xa),$=w.useRef(null),oe=w.useRef(null),X=w.useRef(null),Q=w.useRef(window.performance.now()),Y=w.useRef(i),O=w.useRef(n),K=t>0?1e3/t:0,[te,q]=w.useState(new vi),J=w.useRef(0),[ie,re]=w.useState(new H(1,1,1)),se=g?-1:1,ge=w.useRef(A),xe=w.useRef(C),pe=w.useRef(!1),{spriteObj:ce,loadJsonAndTexture:we}=w4(null,null,c,a,void 0,P),Ee=w.useRef(n),ve=w.useCallback((Re,Be)=>{if(Be===null)a&&(J.current=a,T&&(Y.current=a-1),$.current=Be);else{var Fe,He;$.current=Be,$.current&&Array.isArray($.current.frames)?J.current=$.current.frames.length:$.current&&typeof $.current=="object"&&Ee.current?J.current=$.current.frames[Ee.current].length:J.current=0,T&&(Y.current=J.current-1);const{w:it,h:$e}=u2((Fe=(He=$.current)==null?void 0:He.frames)!==null&&Fe!==void 0?Fe:[],Ee.current).sourceSize,ct=Te(it,$e);re(ct),oe.current&&(oe.current.map=Re)}q(Re)},[a,T]),Ae=w.useCallback(()=>{if(!$.current)return;const{meta:{size:Re},frames:Be}=$.current,{w:Fe,h:He}=Array.isArray(Be)?Be[0].sourceSize:n?Be[n]?Be[n][0].sourceSize:{w:0,h:0}:{w:0,h:0};oe.current&&oe.current.map&&(oe.current.map.wrapS=oe.current.map.wrapT=_o,oe.current.map.center.set(0,0),oe.current.map.repeat.set(1*se/(Re.w/Fe),1/(Re.h/He)));const $e=1/((Re.h-1)/He);oe.current&&oe.current.map&&(oe.current.map.offset.x=0,oe.current.map.offset.y=1-$e),u&&u({currentFrameName:n??"",currentFrame:Y.current})},[se,n,u]),Le=w.useMemo(()=>({current:xe.current,offset:xe.current,imageUrl:s,hasEnded:!1,ref:U}),[s,U]);w.useImperativeHandle(U,()=>W.current,[]),w.useLayoutEffect(()=>{xe.current=C},[C]);const Te=(Re,Be)=>{var Fe;const He=new H,it=Be/Re;return He.set(1,it,1),(Fe=X.current)==null||Fe.scale.copy(He),He};w.useEffect(()=>{if(R){var Re;ve(R==null||(Re=R.spriteTexture)==null?void 0:Re.clone(),R.spriteData)}else s&&r&&we(s,r)},[we,R,r,s,ve]),w.useEffect(()=>{if(ce){var Re;ve(ce==null||(Re=ce.spriteTexture)==null?void 0:Re.clone(),ce==null?void 0:ce.spriteData)}},[ce,ve]),w.useEffect(()=>{if(Le.hasEnded=!1,$.current&&T===!0){var Re;Y.current=((Re=$.current.frames.length)!==null&&Re!==void 0?Re:0)-1}else Y.current=0},[T,Le]),w.useLayoutEffect(()=>{Ae()},[te,g,Ae]),w.useEffect(()=>{l&&(ge.current=!1)},[l]),w.useLayoutEffect(()=>{if(O.current!==n&&n&&(Y.current=0,O.current=n,Le.hasEnded=!1,K<=0&&(Y.current=e||i||0),$.current)){const{w:Re,h:Be}=u2($.current.frames,n).sourceSize,Fe=Te(Re,Be);re(Fe)}},[n,K,Le,e,i]);const ne=()=>{if(!Jye($.current))return;const{meta:{size:Re},frames:Be}=$.current,{w:Fe,h:He}=u2(Be,n).sourceSize,it=Array.isArray(Be)?Be:n?Be[n]:[],$e=e||it.length-1;var ct=C===void 0?Le.current:C;if(K<=0){Y.current=e||i||0,V(Fe,He,Re,it);return}const pt=window.performance.now(),We=pt-Q.current;if(!(We<=K)){var Mt=T?Y.current<0:Y.current>$e,Ft=T?Y.current===$e:Y.current===0,St=T?Y.current<0:Y.current>=$e;if(Mt){if(Y.current=o?i??0:0,T&&(Y.current=$e),o?f==null||f({currentFrameName:n??"",currentFrame:Y.current}):(h==null||h({currentFrameName:n??"",currentFrame:Y.current}),Le.hasEnded=!I,I&&(ge.current=!0)),!o)return}else Ft&&(u==null||u({currentFrameName:n??"",currentFrame:Y.current}));ct!==void 0&&St?pe.current===!1&&(h==null||h({currentFrameName:n??"",currentFrame:Y.current}),pe.current=!0):pe.current=!1,!(We<=K)&&(Q.current=pt-We%K,V(Fe,He,Re,it))}},V=(Re,Be,Fe,He)=>{var it=C===void 0?Le.current:C;const $e=Y.current;let ct=0,pt=0;Te(Re,Be);const We=F?Math.round((Fe.w-1)/Re):(Fe.w-1)/Re,Mt=F?Math.round((Fe.h-1)/Be):(Fe.h-1)/Be;if(!He[$e])return;const{frame:{x:Ft,y:St},sourceSize:{w:gt,h:ft}}=He[$e],be=1/We,qe=1/Mt;if(oe.current&&oe.current.map&&(ct=se>0?be*(Ft/gt):be*(Ft/gt)-oe.current.map.repeat.x,pt=Math.abs(1-qe)-qe*(St/ft),oe.current.map.offset.x=ct,oe.current.map.offset.y=pt),it!=null){let At=Math.floor(it*He.length);At=Math.max(0,Math.min(At,He.length-1)),isNaN(At)&&(At=0),Y.current=At}else T?Y.current-=1:Y.current+=1};Kt((Re,Be)=>{var Fe,He;!((Fe=$.current)!=null&&Fe.frames)||!((He=oe.current)!=null&&He.map)||ge.current||!Le.hasEnded&&(l||m)&&(ne(),d==null||d({currentFrameName:O.current,currentFrame:Y.current}))});function de(Re=new H(1,1,1),Be=1){if(typeof Be=="number")return Re.multiplyScalar(Be);if(Array.isArray(Be))return Re.multiply(new H(...Be));if(Be instanceof H)return Re.multiply(Be)}return w.createElement("group",ot({},z,{ref:W,scale:de(ie,z.scale)}),w.createElement(LW.Provider,{value:Le},x&&w.createElement(zH,null,w.createElement("mesh",ot({ref:X,scale:1,geometry:EF},k),w.createElement("meshBasicMaterial",{premultipliedAlpha:!1,toneMapped:!1,side:Pi,ref:oe,map:te,transparent:!0,alphaTest:y??0}))),!x&&w.createElement(R4,ot({geometry:EF,limit:M??1},k),w.createElement("meshBasicMaterial",{premultipliedAlpha:!1,toneMapped:!1,side:Pi,ref:oe,map:te,transparent:!0,alphaTest:y??0}),(L??[0]).map((Re,Be)=>w.createElement(M4,ot({key:Be,ref:(L==null?void 0:L.length)===1?X:null,position:Re,scale:1},k)))),E))}),eve=w.forwardRef(({children:i,curve:e},t)=>{const[n]=w.useState(()=>new Mu),[r,s]=w.useState(),o=w.useRef(null);return w.useLayoutEffect(()=>{o.current=new ale(n.children[0]),s(o.current.object3D)},[i]),w.useEffect(()=>{var a;e&&((a=o.current)==null||a.updateCurve(0,e))},[e]),w.useImperativeHandle(t,()=>o.current),w.createElement(w.Fragment,null,vp(i,n),r&&w.createElement("primitive",{object:r}))});var tve=`#define GLSLIFY 1
vec3 mod289(vec3 x){return x-floor(x*(1.0/289.0))*289.0;}vec4 mod289(vec4 x){return x-floor(x*(1.0/289.0))*289.0;}vec4 permute(vec4 x){return mod289(((x*34.0)+1.0)*x);}vec4 taylorInvSqrt(vec4 r){return 1.79284291400159-0.85373472095314*r;}float snoise(vec3 v){const vec2 C=vec2(1.0/6.0,1.0/3.0);const vec4 D=vec4(0.0,0.5,1.0,2.0);vec3 i=floor(v+dot(v,C.yyy));vec3 x0=v-i+dot(i,C.xxx);vec3 g=step(x0.yzx,x0.xyz);vec3 l=1.0-g;vec3 i1=min(g.xyz,l.zxy);vec3 i2=max(g.xyz,l.zxy);vec3 x1=x0-i1+C.xxx;vec3 x2=x0-i2+C.yyy;vec3 x3=x0-D.yyy;i=mod289(i);vec4 p=permute(permute(permute(i.z+vec4(0.0,i1.z,i2.z,1.0))+i.y+vec4(0.0,i1.y,i2.y,1.0))+i.x+vec4(0.0,i1.x,i2.x,1.0));float n_=0.142857142857;vec3 ns=n_*D.wyz-D.xzx;vec4 j=p-49.0*floor(p*ns.z*ns.z);vec4 x_=floor(j*ns.z);vec4 y_=floor(j-7.0*x_);vec4 x=x_*ns.x+ns.yyyy;vec4 y=y_*ns.x+ns.yyyy;vec4 h=1.0-abs(x)-abs(y);vec4 b0=vec4(x.xy,y.xy);vec4 b1=vec4(x.zw,y.zw);vec4 s0=floor(b0)*2.0+1.0;vec4 s1=floor(b1)*2.0+1.0;vec4 sh=-step(h,vec4(0.0));vec4 a0=b0.xzyw+s0.xzyw*sh.xxyy;vec4 a1=b1.xzyw+s1.xzyw*sh.zzww;vec3 p0=vec3(a0.xy,h.x);vec3 p1=vec3(a0.zw,h.y);vec3 p2=vec3(a1.xy,h.z);vec3 p3=vec3(a1.zw,h.w);vec4 norm=taylorInvSqrt(vec4(dot(p0,p0),dot(p1,p1),dot(p2,p2),dot(p3,p3)));p0*=norm.x;p1*=norm.y;p2*=norm.z;p3*=norm.w;vec4 m=max(0.6-vec4(dot(x0,x0),dot(x1,x1),dot(x2,x2),dot(x3,x3)),0.0);m=m*m;return 42.0*dot(m*m,vec4(dot(p0,x0),dot(p1,x1),dot(p2,x2),dot(p3,x3)));}`;class nve extends nl{constructor(e={}){super(e),this.setValues(e),this._time={value:0},this._distort={value:.4},this._radius={value:1}}onBeforeCompile(e){e.uniforms.time=this._time,e.uniforms.radius=this._radius,e.uniforms.distort=this._distort,e.vertexShader=`
      uniform float time;
      uniform float radius;
      uniform float distort;
      ${tve}
      ${e.vertexShader}
    `,e.vertexShader=e.vertexShader.replace("#include <begin_vertex>",`
        float updateTime = time / 50.0;
        float noise = snoise(vec3(position / 2.0 + updateTime * 5.0));
        vec3 transformed = vec3(position * (noise * pow(distort, 2.0) + radius));
        `)}get time(){return this._time.value}set time(e){this._time.value=e}get distort(){return this._distort.value}set distort(e){this._distort.value=e}get radius(){return this._radius.value}set radius(e){this._radius.value=e}}const ive=w.forwardRef(({speed:i=1,...e},t)=>{const[n]=w.useState(()=>new nve);return Kt(r=>n&&(n.time=r.clock.elapsedTime*i)),w.createElement("primitive",ot({object:n,ref:t,attach:"material"},e))});class rve extends p0{constructor(e={}){super(e),this.setValues(e),this._time={value:0},this._factor={value:1}}onBeforeCompile(e){e.uniforms.time=this._time,e.uniforms.factor=this._factor,e.vertexShader=`
      uniform float time;
      uniform float factor;
      ${e.vertexShader}
    `,e.vertexShader=e.vertexShader.replace("#include <begin_vertex>",`float theta = sin( time + position.y ) / 2.0 * factor;
        float c = cos( theta );
        float s = sin( theta );
        mat3 m = mat3( c, 0, s, 0, 1, 0, -s, 0, c );
        vec3 transformed = vec3( position ) * m;
        vNormal = vNormal * m;`)}get time(){return this._time.value}set time(e){this._time.value=e}get factor(){return this._factor.value}set factor(e){this._factor.value=e}}const sve=w.forwardRef(({speed:i=1,...e},t)=>{const[n]=w.useState(()=>new rve);return Kt(r=>n&&(n.time=r.clock.elapsedTime*i)),w.createElement("primitive",ot({object:n,ref:t,attach:"material"},e))});class ove extends Mi{constructor(e=new Ue){super({uniforms:{inputBuffer:new Xo(null),depthBuffer:new Xo(null),resolution:new Xo(new Ue),texelSize:new Xo(new Ue),halfTexelSize:new Xo(new Ue),kernel:new Xo(0),scale:new Xo(1),cameraNear:new Xo(0),cameraFar:new Xo(1),minDepthThreshold:new Xo(0),maxDepthThreshold:new Xo(1),depthScale:new Xo(0),depthToBlurRatioBias:new Xo(.25)},fragmentShader:`#include <common>
        #include <dithering_pars_fragment>      
        uniform sampler2D inputBuffer;
        uniform sampler2D depthBuffer;
        uniform float cameraNear;
        uniform float cameraFar;
        uniform float minDepthThreshold;
        uniform float maxDepthThreshold;
        uniform float depthScale;
        uniform float depthToBlurRatioBias;
        varying vec2 vUv;
        varying vec2 vUv0;
        varying vec2 vUv1;
        varying vec2 vUv2;
        varying vec2 vUv3;

        void main() {
          float depthFactor = 0.0;
          
          #ifdef USE_DEPTH
            vec4 depth = texture2D(depthBuffer, vUv);
            depthFactor = smoothstep(minDepthThreshold, maxDepthThreshold, 1.0-(depth.r * depth.a));
            depthFactor *= depthScale;
            depthFactor = max(0.0, min(1.0, depthFactor + 0.25));
          #endif
          
          vec4 sum = texture2D(inputBuffer, mix(vUv0, vUv, depthFactor));
          sum += texture2D(inputBuffer, mix(vUv1, vUv, depthFactor));
          sum += texture2D(inputBuffer, mix(vUv2, vUv, depthFactor));
          sum += texture2D(inputBuffer, mix(vUv3, vUv, depthFactor));
          gl_FragColor = sum * 0.25 ;

          #include <dithering_fragment>
          #include <tonemapping_fragment>
          #include <${ea>=154?"colorspace_fragment":"encodings_fragment"}>
        }`,vertexShader:`uniform vec2 texelSize;
        uniform vec2 halfTexelSize;
        uniform float kernel;
        uniform float scale;
        varying vec2 vUv;
        varying vec2 vUv0;
        varying vec2 vUv1;
        varying vec2 vUv2;
        varying vec2 vUv3;

        void main() {
          vec2 uv = position.xy * 0.5 + 0.5;
          vUv = uv;

          vec2 dUv = (texelSize * vec2(kernel) + halfTexelSize) * scale;
          vUv0 = vec2(uv.x - dUv.x, uv.y + dUv.y);
          vUv1 = vec2(uv.x + dUv.x, uv.y + dUv.y);
          vUv2 = vec2(uv.x + dUv.x, uv.y - dUv.y);
          vUv3 = vec2(uv.x - dUv.x, uv.y - dUv.y);

          gl_Position = vec4(position.xy, 1.0, 1.0);
        }`,blending:gc,depthWrite:!1,depthTest:!1}),this.toneMapped=!1,this.setTexelSize(e.x,e.y),this.kernel=new Float32Array([0,1,2,2,3])}setTexelSize(e,t){this.uniforms.texelSize.value.set(e,t),this.uniforms.halfTexelSize.value.set(e,t).multiplyScalar(.5)}setResolution(e){this.uniforms.resolution.value.copy(e)}}class PW{constructor({gl:e,resolution:t,width:n=500,height:r=500,minDepthThreshold:s=0,maxDepthThreshold:o=1,depthScale:a=0,depthToBlurRatioBias:l=.25}){this.renderToScreen=!1,this.renderTargetA=new Si(t,t,{minFilter:Pn,magFilter:Pn,stencilBuffer:!1,depthBuffer:!1,type:Ni}),this.renderTargetB=this.renderTargetA.clone(),this.convolutionMaterial=new ove,this.convolutionMaterial.setTexelSize(1/n,1/r),this.convolutionMaterial.setResolution(new Ue(n,r)),this.scene=new Mu,this.camera=new u0,this.convolutionMaterial.uniforms.minDepthThreshold.value=s,this.convolutionMaterial.uniforms.maxDepthThreshold.value=o,this.convolutionMaterial.uniforms.depthScale.value=a,this.convolutionMaterial.uniforms.depthToBlurRatioBias.value=l,this.convolutionMaterial.defines.USE_DEPTH=a>0;const c=new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),u=new Float32Array([0,0,2,0,0,2]),h=new fn;h.setAttribute("position",new mn(c,3)),h.setAttribute("uv",new mn(u,2)),this.screen=new It(h,this.convolutionMaterial),this.screen.frustumCulled=!1,this.scene.add(this.screen)}render(e,t,n){const r=this.scene,s=this.camera,o=this.renderTargetA,a=this.renderTargetB;let l=this.convolutionMaterial,c=l.uniforms;c.depthBuffer.value=t.depthTexture;const u=l.kernel;let h=t,f,d,m;for(d=0,m=u.length-1;d<m;++d)f=(d&1)===0?o:a,c.kernel.value=u[d],c.inputBuffer.value=h.texture,e.setRenderTarget(f),e.render(r,s),h=f;c.kernel.value=u[d],c.inputBuffer.value=h.texture,e.setRenderTarget(this.renderToScreen?null:n),e.render(r,s)}}let BW=class extends p0{constructor(e={}){super(e),this._tDepth={value:null},this._distortionMap={value:null},this._tDiffuse={value:null},this._tDiffuseBlur={value:null},this._textureMatrix={value:null},this._hasBlur={value:!1},this._mirror={value:0},this._mixBlur={value:0},this._blurStrength={value:.5},this._minDepthThreshold={value:.9},this._maxDepthThreshold={value:1},this._depthScale={value:0},this._depthToBlurRatioBias={value:.25},this._distortion={value:1},this._mixContrast={value:1},this.setValues(e)}onBeforeCompile(e){var t;(t=e.defines)!=null&&t.USE_UV||(e.defines.USE_UV=""),e.uniforms.hasBlur=this._hasBlur,e.uniforms.tDiffuse=this._tDiffuse,e.uniforms.tDepth=this._tDepth,e.uniforms.distortionMap=this._distortionMap,e.uniforms.tDiffuseBlur=this._tDiffuseBlur,e.uniforms.textureMatrix=this._textureMatrix,e.uniforms.mirror=this._mirror,e.uniforms.mixBlur=this._mixBlur,e.uniforms.mixStrength=this._blurStrength,e.uniforms.minDepthThreshold=this._minDepthThreshold,e.uniforms.maxDepthThreshold=this._maxDepthThreshold,e.uniforms.depthScale=this._depthScale,e.uniforms.depthToBlurRatioBias=this._depthToBlurRatioBias,e.uniforms.distortion=this._distortion,e.uniforms.mixContrast=this._mixContrast,e.vertexShader=`
        uniform mat4 textureMatrix;
        varying vec4 my_vUv;
      ${e.vertexShader}`,e.vertexShader=e.vertexShader.replace("#include <project_vertex>",`#include <project_vertex>
        my_vUv = textureMatrix * vec4( position, 1.0 );
        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );`),e.fragmentShader=`
        uniform sampler2D tDiffuse;
        uniform sampler2D tDiffuseBlur;
        uniform sampler2D tDepth;
        uniform sampler2D distortionMap;
        uniform float distortion;
        uniform float cameraNear;
			  uniform float cameraFar;
        uniform bool hasBlur;
        uniform float mixBlur;
        uniform float mirror;
        uniform float mixStrength;
        uniform float minDepthThreshold;
        uniform float maxDepthThreshold;
        uniform float mixContrast;
        uniform float depthScale;
        uniform float depthToBlurRatioBias;
        varying vec4 my_vUv;
        ${e.fragmentShader}`,e.fragmentShader=e.fragmentShader.replace("#include <emissivemap_fragment>",`#include <emissivemap_fragment>

      float distortionFactor = 0.0;
      #ifdef USE_DISTORTION
        distortionFactor = texture2D(distortionMap, vUv).r * distortion;
      #endif

      vec4 new_vUv = my_vUv;
      new_vUv.x += distortionFactor;
      new_vUv.y += distortionFactor;

      vec4 base = texture2DProj(tDiffuse, new_vUv);
      vec4 blur = texture2DProj(tDiffuseBlur, new_vUv);

      vec4 merge = base;

      #ifdef USE_NORMALMAP
        vec2 normal_uv = vec2(0.0);
        vec4 normalColor = texture2D(normalMap, vUv * normalScale);
        vec3 my_normal = normalize( vec3( normalColor.r * 2.0 - 1.0, normalColor.b,  normalColor.g * 2.0 - 1.0 ) );
        vec3 coord = new_vUv.xyz / new_vUv.w;
        normal_uv = coord.xy + coord.z * my_normal.xz * 0.05;
        vec4 base_normal = texture2D(tDiffuse, normal_uv);
        vec4 blur_normal = texture2D(tDiffuseBlur, normal_uv);
        merge = base_normal;
        blur = blur_normal;
      #endif

      float depthFactor = 0.0001;
      float blurFactor = 0.0;

      #ifdef USE_DEPTH
        vec4 depth = texture2DProj(tDepth, new_vUv);
        depthFactor = smoothstep(minDepthThreshold, maxDepthThreshold, 1.0-(depth.r * depth.a));
        depthFactor *= depthScale;
        depthFactor = max(0.0001, min(1.0, depthFactor));

        #ifdef USE_BLUR
          blur = blur * min(1.0, depthFactor + depthToBlurRatioBias);
          merge = merge * min(1.0, depthFactor + 0.5);
        #else
          merge = merge * depthFactor;
        #endif

      #endif

      float reflectorRoughnessFactor = roughness;
      #ifdef USE_ROUGHNESSMAP
        vec4 reflectorTexelRoughness = texture2D( roughnessMap, vUv );
        reflectorRoughnessFactor *= reflectorTexelRoughness.g;
      #endif

      #ifdef USE_BLUR
        blurFactor = min(1.0, mixBlur * reflectorRoughnessFactor);
        merge = mix(merge, blur, blurFactor);
      #endif

      vec4 newMerge = vec4(0.0, 0.0, 0.0, 1.0);
      newMerge.r = (merge.r - 0.5) * mixContrast + 0.5;
      newMerge.g = (merge.g - 0.5) * mixContrast + 0.5;
      newMerge.b = (merge.b - 0.5) * mixContrast + 0.5;

      diffuseColor.rgb = diffuseColor.rgb * ((1.0 - min(1.0, mirror)) + newMerge.rgb * mixStrength);
      `)}get tDiffuse(){return this._tDiffuse.value}set tDiffuse(e){this._tDiffuse.value=e}get tDepth(){return this._tDepth.value}set tDepth(e){this._tDepth.value=e}get distortionMap(){return this._distortionMap.value}set distortionMap(e){this._distortionMap.value=e}get tDiffuseBlur(){return this._tDiffuseBlur.value}set tDiffuseBlur(e){this._tDiffuseBlur.value=e}get textureMatrix(){return this._textureMatrix.value}set textureMatrix(e){this._textureMatrix.value=e}get hasBlur(){return this._hasBlur.value}set hasBlur(e){this._hasBlur.value=e}get mirror(){return this._mirror.value}set mirror(e){this._mirror.value=e}get mixBlur(){return this._mixBlur.value}set mixBlur(e){this._mixBlur.value=e}get mixStrength(){return this._blurStrength.value}set mixStrength(e){this._blurStrength.value=e}get minDepthThreshold(){return this._minDepthThreshold.value}set minDepthThreshold(e){this._minDepthThreshold.value=e}get maxDepthThreshold(){return this._maxDepthThreshold.value}set maxDepthThreshold(e){this._maxDepthThreshold.value=e}get depthScale(){return this._depthScale.value}set depthScale(e){this._depthScale.value=e}get depthToBlurRatioBias(){return this._depthToBlurRatioBias.value}set depthToBlurRatioBias(e){this._depthToBlurRatioBias.value=e}get distortion(){return this._distortion.value}set distortion(e){this._distortion.value=e}get mixContrast(){return this._mixContrast.value}set mixContrast(e){this._mixContrast.value=e}};const ave=w.forwardRef(({mixBlur:i=0,mixStrength:e=1,resolution:t=256,blur:n=[0,0],minDepthThreshold:r=.9,maxDepthThreshold:s=1,depthScale:o=0,depthToBlurRatioBias:a=.25,mirror:l=0,distortion:c=1,mixContrast:u=1,distortionMap:h,reflectorOffset:f=0,...d},m)=>{Or({MeshReflectorMaterialImpl:BW});const A=Ve(({gl:O})=>O),g=Ve(({camera:O})=>O),y=Ve(({scene:O})=>O);n=Array.isArray(n)?n:[n,n];const E=n[0]+n[1]>0,x=w.useRef(null);w.useImperativeHandle(m,()=>x.current,[]);const[C]=w.useState(()=>new vo),[T]=w.useState(()=>new H),[I]=w.useState(()=>new H),[M]=w.useState(()=>new H),[L]=w.useState(()=>new Xe),[R]=w.useState(()=>new H(0,0,-1)),[P]=w.useState(()=>new Rn),[F]=w.useState(()=>new H),[k]=w.useState(()=>new H),[z]=w.useState(()=>new Rn),[U]=w.useState(()=>new Xe),[W]=w.useState(()=>new Wn),$=w.useCallback(()=>{var O;const K=x.current.parent||((O=x.current)==null?void 0:O.__r3f.parent);if(!K||(I.setFromMatrixPosition(K.matrixWorld),M.setFromMatrixPosition(g.matrixWorld),L.extractRotation(K.matrixWorld),T.set(0,0,1),T.applyMatrix4(L),I.addScaledVector(T,f),F.subVectors(I,M),F.dot(T)>0))return;F.reflect(T).negate(),F.add(I),L.extractRotation(g.matrixWorld),R.set(0,0,-1),R.applyMatrix4(L),R.add(M),k.subVectors(I,R),k.reflect(T).negate(),k.add(I),W.position.copy(F),W.up.set(0,1,0),W.up.applyMatrix4(L),W.up.reflect(T),W.lookAt(k),W.far=g.far,W.updateMatrixWorld(),W.projectionMatrix.copy(g.projectionMatrix),U.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),U.multiply(W.projectionMatrix),U.multiply(W.matrixWorldInverse),U.multiply(K.matrixWorld),C.setFromNormalAndCoplanarPoint(T,I),C.applyMatrix4(W.matrixWorldInverse),P.set(C.normal.x,C.normal.y,C.normal.z,C.constant);const te=W.projectionMatrix;z.x=(Math.sign(P.x)+te.elements[8])/te.elements[0],z.y=(Math.sign(P.y)+te.elements[9])/te.elements[5],z.z=-1,z.w=(1+te.elements[10])/te.elements[14],P.multiplyScalar(2/P.dot(z)),te.elements[2]=P.x,te.elements[6]=P.y,te.elements[10]=P.z+1,te.elements[14]=P.w},[g,f]),[oe,X,Q,Y]=w.useMemo(()=>{const O={minFilter:Pn,magFilter:Pn,type:Ni},K=new Si(t,t,O);K.depthBuffer=!0,K.depthTexture=new f0(t,t),K.depthTexture.format=vu,K.depthTexture.type=pp;const te=new Si(t,t,O),q=new PW({gl:A,resolution:t,width:n[0],height:n[1],minDepthThreshold:r,maxDepthThreshold:s,depthScale:o,depthToBlurRatioBias:a}),J={mirror:l,textureMatrix:U,mixBlur:i,tDiffuse:K.texture,tDepth:K.depthTexture,tDiffuseBlur:te.texture,hasBlur:E,mixStrength:e,minDepthThreshold:r,maxDepthThreshold:s,depthScale:o,depthToBlurRatioBias:a,distortion:c,distortionMap:h,mixContrast:u,"defines-USE_BLUR":E?"":void 0,"defines-USE_DEPTH":o>0?"":void 0,"defines-USE_DISTORTION":h?"":void 0};return[K,te,q,J]},[A,n,U,t,l,E,i,e,r,s,o,a,c,h,u]);return Kt(()=>{var O;const K=x.current.parent||((O=x.current)==null?void 0:O.__r3f.parent);if(!K)return;K.visible=!1;const te=A.xr.enabled,q=A.shadowMap.autoUpdate;$(),A.xr.enabled=!1,A.shadowMap.autoUpdate=!1,A.setRenderTarget(oe),A.state.buffers.depth.setMask(!0),A.autoClear||A.clear(),A.render(y,W),E&&Q.render(A,oe,X),A.xr.enabled=te,A.shadowMap.autoUpdate=q,K.visible=!0,A.setRenderTarget(null)}),w.createElement("meshReflectorMaterialImpl",ot({attach:"material",key:"key"+Y["defines-USE_BLUR"]+Y["defines-USE_DEPTH"]+Y["defines-USE_DISTORTION"],ref:x},Y,d))}),lve=Ec({envMap:null,bounces:3,ior:2.4,correctMips:!0,aberrationStrength:.01,fresnel:0,bvh:new wW,color:new ut("white"),opacity:1,resolution:new Ue,viewMatrixInverse:new Xe,projectionMatrixInverse:new Xe},`
  uniform mat4 viewMatrixInverse;

  varying vec3 vWorldPosition;
  varying vec3 vNormal;
  varying mat4 vModelMatrixInverse;

  #include <color_pars_vertex>

  void main() {
    #include <color_vertex>

    vec4 transformedNormal = vec4(normal, 0.0);
    vec4 transformedPosition = vec4(position, 1.0);
    #ifdef USE_INSTANCING
      transformedNormal = instanceMatrix * transformedNormal;
      transformedPosition = instanceMatrix * transformedPosition;
    #endif

    #ifdef USE_INSTANCING
      vModelMatrixInverse = inverse(modelMatrix * instanceMatrix);
    #else
      vModelMatrixInverse = inverse(modelMatrix);
    #endif

    vWorldPosition = (modelMatrix * transformedPosition).xyz;
    vNormal = normalize((viewMatrixInverse * vec4(normalMatrix * transformedNormal.xyz, 0.0)).xyz);
    gl_Position = projectionMatrix * viewMatrix * modelMatrix * transformedPosition;
  }`,`
  #define ENVMAP_TYPE_CUBE_UV
  precision highp isampler2D;
  precision highp usampler2D;
  varying vec3 vWorldPosition;
  varying vec3 vNormal;
  varying mat4 vModelMatrixInverse;

  #include <color_pars_fragment>

  #ifdef ENVMAP_TYPE_CUBEM
    uniform samplerCube envMap;
  #else
    uniform sampler2D envMap;
  #endif

  uniform float bounces;
  ${Eye}
  ${_ye}
  uniform BVH bvh;
  uniform float ior;
  uniform bool correctMips;
  uniform vec2 resolution;
  uniform float fresnel;
  uniform mat4 modelMatrix;
  uniform mat4 projectionMatrixInverse;
  uniform mat4 viewMatrixInverse;
  uniform float aberrationStrength;
  uniform vec3 color;
  uniform float opacity;

  float fresnelFunc(vec3 viewDirection, vec3 worldNormal) {
    return pow( 1.0 + dot( viewDirection, worldNormal), 10.0 );
  }

  vec3 totalInternalReflection(vec3 ro, vec3 rd, vec3 normal, float ior, mat4 modelMatrixInverse) {
    vec3 rayOrigin = ro;
    vec3 rayDirection = rd;
    rayDirection = refract(rayDirection, normal, 1.0 / ior);
    rayOrigin = vWorldPosition + rayDirection * 0.001;
    rayOrigin = (modelMatrixInverse * vec4(rayOrigin, 1.0)).xyz;
    rayDirection = normalize((modelMatrixInverse * vec4(rayDirection, 0.0)).xyz);
    for(float i = 0.0; i < bounces; i++) {
      uvec4 faceIndices = uvec4( 0u );
      vec3 faceNormal = vec3( 0.0, 0.0, 1.0 );
      vec3 barycoord = vec3( 0.0 );
      float side = 1.0;
      float dist = 0.0;
      bvhIntersectFirstHit( bvh, rayOrigin, rayDirection, faceIndices, faceNormal, barycoord, side, dist );
      vec3 hitPos = rayOrigin + rayDirection * max(dist - 0.001, 0.0);
      vec3 tempDir = refract(rayDirection, faceNormal, ior);
      if (length(tempDir) != 0.0) {
        rayDirection = tempDir;
        break;
      }
      rayDirection = reflect(rayDirection, faceNormal);
      rayOrigin = hitPos + rayDirection * 0.01;
    }
    rayDirection = normalize((modelMatrix * vec4(rayDirection, 0.0)).xyz);
    return rayDirection;
  }

  #include <common>
  #include <cube_uv_reflection_fragment>

  #ifdef ENVMAP_TYPE_CUBEM
    vec4 textureGradient(samplerCube envMap, vec3 rayDirection, vec3 directionCamPerfect) {
      return textureGrad(envMap, rayDirection, dFdx(correctMips ? directionCamPerfect: rayDirection), dFdy(correctMips ? directionCamPerfect: rayDirection));
    }
  #else
    vec4 textureGradient(sampler2D envMap, vec3 rayDirection, vec3 directionCamPerfect) {
      vec2 uvv = equirectUv( rayDirection );
      vec2 smoothUv = equirectUv( directionCamPerfect );
      return textureGrad(envMap, uvv, dFdx(correctMips ? smoothUv : uvv), dFdy(correctMips ? smoothUv : uvv));
    }
  #endif

  void main() {
    vec2 uv = gl_FragCoord.xy / resolution;
    vec3 directionCamPerfect = (projectionMatrixInverse * vec4(uv * 2.0 - 1.0, 0.0, 1.0)).xyz;
    directionCamPerfect = (viewMatrixInverse * vec4(directionCamPerfect, 0.0)).xyz;
    directionCamPerfect = normalize(directionCamPerfect);
    vec3 normal = vNormal;
    vec3 rayOrigin = cameraPosition;
    vec3 rayDirection = normalize(vWorldPosition - cameraPosition);

    vec4 diffuseColor = vec4(color, opacity);
    #include <color_fragment>

    #ifdef CHROMATIC_ABERRATIONS
      vec3 rayDirectionG = totalInternalReflection(rayOrigin, rayDirection, normal, max(ior, 1.0), vModelMatrixInverse);
      #ifdef FAST_CHROMA
        vec3 rayDirectionR = normalize(rayDirectionG + 1.0 * vec3(aberrationStrength / 2.0));
        vec3 rayDirectionB = normalize(rayDirectionG - 1.0 * vec3(aberrationStrength / 2.0));
      #else
        vec3 rayDirectionR = totalInternalReflection(rayOrigin, rayDirection, normal, max(ior * (1.0 - aberrationStrength), 1.0), vModelMatrixInverse);
        vec3 rayDirectionB = totalInternalReflection(rayOrigin, rayDirection, normal, max(ior * (1.0 + aberrationStrength), 1.0), vModelMatrixInverse);
      #endif
      float finalColorR = textureGradient(envMap, rayDirectionR, directionCamPerfect).r;
      float finalColorG = textureGradient(envMap, rayDirectionG, directionCamPerfect).g;
      float finalColorB = textureGradient(envMap, rayDirectionB, directionCamPerfect).b;
      diffuseColor.rgb *= vec3(finalColorR, finalColorG, finalColorB);
    #else
      rayDirection = totalInternalReflection(rayOrigin, rayDirection, normal, max(ior, 1.0), vModelMatrixInverse);
      diffuseColor.rgb *= textureGradient(envMap, rayDirection, directionCamPerfect).rgb;
    #endif

    vec3 viewDirection = normalize(vWorldPosition - cameraPosition);
    float nFresnel = fresnelFunc(viewDirection, normal) * fresnel;
    gl_FragColor = vec4(mix(diffuseColor.rgb, vec3(1.0), nFresnel), diffuseColor.a);

    #include <tonemapping_fragment>
    #include <${ea>=154?"colorspace_fragment":"encodings_fragment"}>
  }`),cve=i=>i&&i.isCubeTexture;function uve({aberrationStrength:i=0,fastChroma:e=!0,envMap:t,...n}){Or({MeshRefractionMaterial:lve});const r=w.useRef(),{size:s}=Ve(),o=w.useMemo(()=>{var a,l;const c={},u=cve(t),f=((a=u?(l=t.image[0])==null?void 0:l.width:t.image.width)!==null&&a!==void 0?a:1024)/4,d=Math.floor(Math.log2(f)),m=Math.pow(2,d),A=3*Math.max(m,112),g=4*m;return u&&(c.ENVMAP_TYPE_CUBEM=""),c.CUBEUV_TEXEL_WIDTH=`${1/A}`,c.CUBEUV_TEXEL_HEIGHT=`${1/g}`,c.CUBEUV_MAX_MIP=`${d}.0`,i>0&&(c.CHROMATIC_ABERRATIONS=""),e&&(c.FAST_CHROMA=""),c},[i,e]);return w.useLayoutEffect(()=>{var a;const l=(a=r.current)==null||(a=a.__r3f)==null||(a=a.parent)==null?void 0:a.geometry;l&&(r.current.bvh=new wW,r.current.bvh.updateFrom(new I4(l.clone().toNonIndexed(),{strategy:C4})))},[]),Kt(({camera:a})=>{r.current.viewMatrixInverse=a.matrixWorld,r.current.projectionMatrixInverse=a.projectionMatrixInverse}),w.createElement("meshRefractionMaterial",ot({key:JSON.stringify(o),defines:o,ref:r,resolution:[s.width,s.height],aberrationStrength:i,envMap:t},n))}const o8=Ec({},"void main() { }","void main() { gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0); discard;  }");class hve extends nl{constructor(e=6,t=!1){super(),this.uniforms={chromaticAberration:{value:.05},transmission:{value:0},_transmission:{value:1},transmissionMap:{value:null},roughness:{value:0},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:1/0},attenuationColor:{value:new ut("white")},anisotropicBlur:{value:.1},time:{value:0},distortion:{value:0},distortionScale:{value:.5},temporalDistortion:{value:0},buffer:{value:null}},this.onBeforeCompile=n=>{n.uniforms={...n.uniforms,...this.uniforms},this.anisotropy>0&&(n.defines.USE_ANISOTROPY=""),t?n.defines.USE_SAMPLER="":n.defines.USE_TRANSMISSION="",n.fragmentShader=`
      uniform float chromaticAberration;         
      uniform float anisotropicBlur;      
      uniform float time;
      uniform float distortion;
      uniform float distortionScale;
      uniform float temporalDistortion;
      uniform sampler2D buffer;

      vec3 random3(vec3 c) {
        float j = 4096.0*sin(dot(c,vec3(17.0, 59.4, 15.0)));
        vec3 r;
        r.z = fract(512.0*j);
        j *= .125;
        r.x = fract(512.0*j);
        j *= .125;
        r.y = fract(512.0*j);
        return r-0.5;
      }

      uint hash( uint x ) {
        x += ( x << 10u );
        x ^= ( x >>  6u );
        x += ( x <<  3u );
        x ^= ( x >> 11u );
        x += ( x << 15u );
        return x;
      }

      // Compound versions of the hashing algorithm I whipped together.
      uint hash( uvec2 v ) { return hash( v.x ^ hash(v.y)                         ); }
      uint hash( uvec3 v ) { return hash( v.x ^ hash(v.y) ^ hash(v.z)             ); }
      uint hash( uvec4 v ) { return hash( v.x ^ hash(v.y) ^ hash(v.z) ^ hash(v.w) ); }

      // Construct a float with half-open range [0:1] using low 23 bits.
      // All zeroes yields 0.0, all ones yields the next smallest representable value below 1.0.
      float floatConstruct( uint m ) {
        const uint ieeeMantissa = 0x007FFFFFu; // binary32 mantissa bitmask
        const uint ieeeOne      = 0x3F800000u; // 1.0 in IEEE binary32
        m &= ieeeMantissa;                     // Keep only mantissa bits (fractional part)
        m |= ieeeOne;                          // Add fractional part to 1.0
        float  f = uintBitsToFloat( m );       // Range [1:2]
        return f - 1.0;                        // Range [0:1]
      }

      // Pseudo-random value in half-open range [0:1].
      float randomBase( float x ) { return floatConstruct(hash(floatBitsToUint(x))); }
      float randomBase( vec2  v ) { return floatConstruct(hash(floatBitsToUint(v))); }
      float randomBase( vec3  v ) { return floatConstruct(hash(floatBitsToUint(v))); }
      float randomBase( vec4  v ) { return floatConstruct(hash(floatBitsToUint(v))); }
      float rand(float seed) {
        float result = randomBase(vec3(gl_FragCoord.xy, seed));
        return result;
      }

      const float F3 =  0.3333333;
      const float G3 =  0.1666667;

      float snoise(vec3 p) {
        vec3 s = floor(p + dot(p, vec3(F3)));
        vec3 x = p - s + dot(s, vec3(G3));
        vec3 e = step(vec3(0.0), x - x.yzx);
        vec3 i1 = e*(1.0 - e.zxy);
        vec3 i2 = 1.0 - e.zxy*(1.0 - e);
        vec3 x1 = x - i1 + G3;
        vec3 x2 = x - i2 + 2.0*G3;
        vec3 x3 = x - 1.0 + 3.0*G3;
        vec4 w, d;
        w.x = dot(x, x);
        w.y = dot(x1, x1);
        w.z = dot(x2, x2);
        w.w = dot(x3, x3);
        w = max(0.6 - w, 0.0);
        d.x = dot(random3(s), x);
        d.y = dot(random3(s + i1), x1);
        d.z = dot(random3(s + i2), x2);
        d.w = dot(random3(s + 1.0), x3);
        w *= w;
        w *= w;
        d *= w;
        return dot(d, vec4(52.0));
      }

      float snoiseFractal(vec3 m) {
        return 0.5333333* snoise(m)
              +0.2666667* snoise(2.0*m)
              +0.1333333* snoise(4.0*m)
              +0.0666667* snoise(8.0*m);
      }
`+n.fragmentShader,n.fragmentShader=n.fragmentShader.replace("#include <transmission_pars_fragment>",`
        #ifdef USE_TRANSMISSION
          // Transmission code is based on glTF-Sampler-Viewer
          // https://github.com/KhronosGroup/glTF-Sample-Viewer
          uniform float _transmission;
          uniform float thickness;
          uniform float attenuationDistance;
          uniform vec3 attenuationColor;
          #ifdef USE_TRANSMISSIONMAP
            uniform sampler2D transmissionMap;
          #endif
          #ifdef USE_THICKNESSMAP
            uniform sampler2D thicknessMap;
          #endif
          uniform vec2 transmissionSamplerSize;
          uniform sampler2D transmissionSamplerMap;
          uniform mat4 modelMatrix;
          uniform mat4 projectionMatrix;
          varying vec3 vWorldPosition;
          vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
            // Direction of refracted light.
            vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
            // Compute rotation-independant scaling of the model matrix.
            vec3 modelScale;
            modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
            modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
            modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
            // The thickness is specified in local space.
            return normalize( refractionVector ) * thickness * modelScale;
          }
          float applyIorToRoughness( const in float roughness, const in float ior ) {
            // Scale roughness with IOR so that an IOR of 1.0 results in no microfacet refraction and
            // an IOR of 1.5 results in the default amount of microfacet refraction.
            return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
          }
          vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
            float framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );            
            #ifdef USE_SAMPLER
              #ifdef texture2DLodEXT
                return texture2DLodEXT(transmissionSamplerMap, fragCoord.xy, framebufferLod);
              #else
                return texture2D(transmissionSamplerMap, fragCoord.xy, framebufferLod);
              #endif
            #else
              return texture2D(buffer, fragCoord.xy);
            #endif
          }
          vec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
            if ( isinf( attenuationDistance ) ) {
              // Attenuation distance is +∞, i.e. the transmitted color is not attenuated at all.
              return radiance;
            } else {
              // Compute light attenuation using Beer's law.
              vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
              vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance ); // Beer's law
              return transmittance * radiance;
            }
          }
          vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
            const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
            const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,
            const in vec3 attenuationColor, const in float attenuationDistance ) {
            vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
            vec3 refractedRayExit = position + transmissionRay;
            // Project refracted vector on the framebuffer, while mapping to normalized device coordinates.
            vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
            vec2 refractionCoords = ndcPos.xy / ndcPos.w;
            refractionCoords += 1.0;
            refractionCoords /= 2.0;
            // Sample framebuffer to get pixel the refracted ray hits.
            vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
            vec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );
            // Get the specular component.
            vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
            return vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );
          }
        #endif
`),n.fragmentShader=n.fragmentShader.replace("#include <transmission_fragment>",`  
        // Improve the refraction to use the world pos
        material.transmission = _transmission;
        material.transmissionAlpha = 1.0;
        material.thickness = thickness;
        material.attenuationDistance = attenuationDistance;
        material.attenuationColor = attenuationColor;
        #ifdef USE_TRANSMISSIONMAP
          material.transmission *= texture2D( transmissionMap, vUv ).r;
        #endif
        #ifdef USE_THICKNESSMAP
          material.thickness *= texture2D( thicknessMap, vUv ).g;
        #endif
        
        vec3 pos = vWorldPosition;
        float runningSeed = 0.0;
        vec3 v = normalize( cameraPosition - pos );
        vec3 n = inverseTransformDirection( normal, viewMatrix );
        vec3 transmission = vec3(0.0);
        float transmissionR, transmissionB, transmissionG;
        float randomCoords = rand(runningSeed++);
        float thickness_smear = thickness * max(pow(roughnessFactor, 0.33), anisotropicBlur);
        vec3 distortionNormal = vec3(0.0);
        vec3 temporalOffset = vec3(time, -time, -time) * temporalDistortion;
        if (distortion > 0.0) {
          distortionNormal = distortion * vec3(snoiseFractal(vec3((pos * distortionScale + temporalOffset))), snoiseFractal(vec3(pos.zxy * distortionScale - temporalOffset)), snoiseFractal(vec3(pos.yxz * distortionScale + temporalOffset)));
        }
        for (float i = 0.0; i < ${e}.0; i ++) {
          vec3 sampleNorm = normalize(n + roughnessFactor * roughnessFactor * 2.0 * normalize(vec3(rand(runningSeed++) - 0.5, rand(runningSeed++) - 0.5, rand(runningSeed++) - 0.5)) * pow(rand(runningSeed++), 0.33) + distortionNormal);
          transmissionR = getIBLVolumeRefraction(
            sampleNorm, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
            pos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness  + thickness_smear * (i + randomCoords) / float(${e}),
            material.attenuationColor, material.attenuationDistance
          ).r;
          transmissionG = getIBLVolumeRefraction(
            sampleNorm, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
            pos, modelMatrix, viewMatrix, projectionMatrix, material.ior  * (1.0 + chromaticAberration * (i + randomCoords) / float(${e})) , material.thickness + thickness_smear * (i + randomCoords) / float(${e}),
            material.attenuationColor, material.attenuationDistance
          ).g;
          transmissionB = getIBLVolumeRefraction(
            sampleNorm, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
            pos, modelMatrix, viewMatrix, projectionMatrix, material.ior * (1.0 + 2.0 * chromaticAberration * (i + randomCoords) / float(${e})), material.thickness + thickness_smear * (i + randomCoords) / float(${e}),
            material.attenuationColor, material.attenuationDistance
          ).b;
          transmission.r += transmissionR;
          transmission.g += transmissionG;
          transmission.b += transmissionB;
        }
        transmission /= ${e}.0;
        totalDiffuse = mix( totalDiffuse, transmission.rgb, material.transmission );
`)},Object.keys(this.uniforms).forEach(n=>Object.defineProperty(this,n,{get:()=>this.uniforms[n].value,set:r=>this.uniforms[n].value=r}))}}const fve=w.forwardRef(({buffer:i,transmissionSampler:e=!1,backside:t=!1,side:n=tl,transmission:r=1,thickness:s=0,backsideThickness:o=0,backsideEnvMapIntensity:a=1,samples:l=10,resolution:c,backsideResolution:u,background:h,anisotropy:f,anisotropicBlur:d,...m},A)=>{Or({MeshTransmissionMaterial:hve});const g=w.useRef(null),[y]=w.useState(()=>new o8),E=Ea(u||c),x=Ea(c);let C,T,I,M;return Kt(L=>{g.current.time=L.clock.elapsedTime,g.current.buffer===x.texture&&!e&&(M=g.current.__r3f.parent,M&&(I=L.gl.toneMapping,C=L.scene.background,T=g.current.envMapIntensity,L.gl.toneMapping=yu,h&&(L.scene.background=h),M.material=y,t&&(L.gl.setRenderTarget(E),L.gl.render(L.scene,L.camera),M.material=g.current,M.material.buffer=E.texture,M.material.thickness=o,M.material.side=ys,M.material.envMapIntensity=a),L.gl.setRenderTarget(x),L.gl.render(L.scene,L.camera),M.material=g.current,M.material.thickness=s,M.material.side=n,M.material.buffer=x.texture,M.material.envMapIntensity=T,L.scene.background=C,L.gl.setRenderTarget(null),L.gl.toneMapping=I))}),w.useImperativeHandle(A,()=>g.current,[]),w.createElement("meshTransmissionMaterial",ot({args:[l,e],ref:g},m,{buffer:i||x.texture,_transmission:r,anisotropicBlur:d??f,transmission:e?r:0,thickness:s,side:n}))}),dve=w.forwardRef((i,e)=>(Or({DiscardMaterialImpl:o8}),w.createElement("discardMaterialImpl",ot({ref:e},i))));function pve(i){const e=w.useRef(null);return w.useLayoutEffect(()=>{var t;const n=(t=e.current)==null?void 0:t.parent,r=n==null?void 0:n.geometry;if(r){const s=n.material;n.material=e.current.__r3f.objects;const o=[...r.groups];return r.clearGroups(),n.material.forEach((a,l)=>{l<n.material.length-1&&(a.depthWrite=!1),r.addGroup(0,1/0,l)}),()=>{n.material=s,r.groups=o}}}),w.createElement("group",ot({ref:e},i))}const AI=ea>=154?"opaque_fragment":"output_fragment";class DW extends lx{constructor(e){super(e),this.onBeforeCompile=(t,n)=>{const{isWebGL2:r}=n.capabilities;t.fragmentShader=t.fragmentShader.replace(`#include <${AI}>`,`
        ${r?`#include <${AI}>`:`#extension GL_OES_standard_derivatives : enable
#include <${AI}>`}
      vec2 cxy = 2.0 * gl_PointCoord - 1.0;
      float r = dot(cxy, cxy);
      float delta = fwidth(r);     
      float mask = 1.0 - smoothstep(1.0 - delta, 1.0 + delta, r);
      gl_FragColor = vec4(gl_FragColor.rgb, mask * gl_FragColor.a );
      #include <tonemapping_fragment>
      #include <${ea>=154?"colorspace_fragment":"encodings_fragment"}>
      `)}}}const mve=w.forwardRef((i,e)=>{const[t]=w.useState(()=>new DW(null));return w.createElement("primitive",ot({},i,{object:t,ref:e,attach:"material"}))}),gve=({focus:i=0,size:e=25,samples:t=10}={})=>`
#define PENUMBRA_FILTER_SIZE float(${e})
#define RGB_NOISE_FUNCTION(uv) (randRGB(uv))
vec3 randRGB(vec2 uv) {
  return vec3(
    fract(sin(dot(uv, vec2(12.75613, 38.12123))) * 13234.76575),
    fract(sin(dot(uv, vec2(19.45531, 58.46547))) * 43678.23431),
    fract(sin(dot(uv, vec2(23.67817, 78.23121))) * 93567.23423)
  );
}

vec3 lowPassRandRGB(vec2 uv) {
  // 3x3 convolution (average)
  // can be implemented as separable with an extra buffer for a total of 6 samples instead of 9
  vec3 result = vec3(0);
  result += RGB_NOISE_FUNCTION(uv + vec2(-1.0, -1.0));
  result += RGB_NOISE_FUNCTION(uv + vec2(-1.0,  0.0));
  result += RGB_NOISE_FUNCTION(uv + vec2(-1.0, +1.0));
  result += RGB_NOISE_FUNCTION(uv + vec2( 0.0, -1.0));
  result += RGB_NOISE_FUNCTION(uv + vec2( 0.0,  0.0));
  result += RGB_NOISE_FUNCTION(uv + vec2( 0.0, +1.0));
  result += RGB_NOISE_FUNCTION(uv + vec2(+1.0, -1.0));
  result += RGB_NOISE_FUNCTION(uv + vec2(+1.0,  0.0));
  result += RGB_NOISE_FUNCTION(uv + vec2(+1.0, +1.0));
  result *= 0.111111111; // 1.0 / 9.0
  return result;
}
vec3 highPassRandRGB(vec2 uv) {
  // by subtracting the low-pass signal from the original signal, we're being left with the high-pass signal
  // hp(x) = x - lp(x)
  return RGB_NOISE_FUNCTION(uv) - lowPassRandRGB(uv) + 0.5;
}


vec2 vogelDiskSample(int sampleIndex, int sampleCount, float angle) {
  const float goldenAngle = 2.399963f; // radians
  float r = sqrt(float(sampleIndex) + 0.5f) / sqrt(float(sampleCount));
  float theta = float(sampleIndex) * goldenAngle + angle;
  float sine = sin(theta);
  float cosine = cos(theta);
  return vec2(cosine, sine) * r;
}
float penumbraSize( const in float zReceiver, const in float zBlocker ) { // Parallel plane estimation
  return (zReceiver - zBlocker) / zBlocker;
}
float findBlocker(sampler2D shadowMap, vec2 uv, float compare, float angle) {
  float texelSize = 1.0 / float(textureSize(shadowMap, 0).x);
  float blockerDepthSum = float(${i});
  float blockers = 0.0;

  int j = 0;
  vec2 offset = vec2(0.);
  float depth = 0.;

  #pragma unroll_loop_start
  for(int i = 0; i < ${t}; i ++) {
    offset = (vogelDiskSample(j, ${t}, angle) * texelSize) * 2.0 * PENUMBRA_FILTER_SIZE;
    depth = unpackRGBAToDepth( texture2D( shadowMap, uv + offset));
    if (depth < compare) {
      blockerDepthSum += depth;
      blockers++;
    }
    j++;
  }
  #pragma unroll_loop_end

  if (blockers > 0.0) {
    return blockerDepthSum / blockers;
  }
  return -1.0;
}

        
float vogelFilter(sampler2D shadowMap, vec2 uv, float zReceiver, float filterRadius, float angle) {
  float texelSize = 1.0 / float(textureSize(shadowMap, 0).x);
  float shadow = 0.0f;
  int j = 0;
  vec2 vogelSample = vec2(0.0);
  vec2 offset = vec2(0.0);
  #pragma unroll_loop_start
  for (int i = 0; i < ${t}; i++) {
    vogelSample = vogelDiskSample(j, ${t}, angle) * texelSize;
    offset = vogelSample * (1.0 + filterRadius * float(${e}));
    shadow += step( zReceiver, unpackRGBAToDepth( texture2D( shadowMap, uv + offset ) ) );
    j++;
  }
  #pragma unroll_loop_end
  return shadow * 1.0 / ${t}.0;
}

float PCSS (sampler2D shadowMap, vec4 coords) {
  vec2 uv = coords.xy;
  float zReceiver = coords.z; // Assumed to be eye-space z in this code
  float angle = highPassRandRGB(gl_FragCoord.xy).r * PI2;
  float avgBlockerDepth = findBlocker(shadowMap, uv, zReceiver, angle);
  if (avgBlockerDepth == -1.0) {
    return 1.0;
  }
  float penumbraRatio = penumbraSize(zReceiver, avgBlockerDepth);
  return vogelFilter(shadowMap, uv, zReceiver, 1.25 * penumbraRatio, angle);
}`;function _F(i,e,t){e.traverse(n=>{n.material&&(i.properties.remove(n.material),n.material.dispose==null||n.material.dispose())}),i.info.programs.length=0,i.compile(e,t)}function Ave({focus:i=0,samples:e=10,size:t=25}){const n=Ve(o=>o.gl),r=Ve(o=>o.scene),s=Ve(o=>o.camera);return w.useEffect(()=>{const o=Un.shadowmap_pars_fragment;return Un.shadowmap_pars_fragment=Un.shadowmap_pars_fragment.replace("#ifdef USE_SHADOWMAP",`#ifdef USE_SHADOWMAP
`+gve({size:t,samples:e,focus:i})).replace("#if defined( SHADOWMAP_TYPE_PCF )",`
return PCSS(shadowMap, shadowCoord);
#if defined( SHADOWMAP_TYPE_PCF )`),_F(n,r,s),()=>{Un.shadowmap_pars_fragment=o,_F(n,r,s)}},[i,t,e]),null}function ao(i,e){const t=i+"Geometry";return w.forwardRef(({args:n,children:r,...s},o)=>{const a=w.useRef(null);return w.useImperativeHandle(o,()=>a.current),w.useLayoutEffect(()=>void(e==null?void 0:e(a.current))),w.createElement("mesh",ot({ref:a},s),w.createElement(t,{attach:"geometry",args:n}),r)})}const yve=ao("box"),vve=ao("circle"),xve=ao("cone"),Eve=ao("cylinder"),_ve=ao("sphere"),Sve=ao("plane"),wve=ao("tube"),Cve=ao("torus"),Tve=ao("torusKnot"),bve=ao("tetrahedron"),Ive=ao("ring"),Mve=ao("polyhedron"),Rve=ao("icosahedron"),Lve=ao("octahedron"),Pve=ao("dodecahedron"),Bve=ao("extrude"),Dve=ao("lathe"),kve=ao("capsule"),Fve=ao("shape",({geometry:i})=>{const e=i.attributes.position,t=new ti().setFromBufferAttribute(e),n=new H;t.getSize(n);const r=[];let s=0,o=0,a=0,l=0;for(let c=0;c<e.count;c++)s=e.getX(c),o=e.getY(c),a=(s-t.min.x)/n.x,l=(o-t.min.y)/n.y,r.push(a,l);i.setAttribute("uv",new Gt(r,2))}),ah=1e-5;function Ove(i,e,t){const n=new Lf,r=t-ah;return n.absarc(ah,ah,ah,-Math.PI/2,-Math.PI,!0),n.absarc(ah,e-r*2,ah,Math.PI,Math.PI/2,!0),n.absarc(i-r*2,e-r*2,ah,Math.PI/2,0,!0),n.absarc(i-r*2,ah,ah,0,-Math.PI/2,!0),n}const Nve=w.forwardRef(function({args:[e=1,t=1,n=1]=[],radius:r=.05,steps:s=1,smoothness:o=4,bevelSegments:a=4,creaseAngle:l=.4,children:c,...u},h){const f=w.useMemo(()=>Ove(e,t,r),[e,t,r]),d=w.useMemo(()=>({depth:n-r*2,bevelEnabled:!0,bevelSegments:a*2,steps:s,bevelSize:r-ah,bevelThickness:r,curveSegments:o}),[n,r,o]),m=w.useRef(null);return w.useLayoutEffect(()=>{m.current&&(m.current.center(),JG(m.current,l))},[f,d]),w.createElement("mesh",ot({ref:h},u),w.createElement("extrudeGeometry",{ref:m,args:[f,d]}),c)});function Uve(){const i=new fn,e=new Float32Array([-1,-1,3,-1,-1,3]);return i.boundingSphere=new Bi,i.boundingSphere.set(new H,1/0),i.setAttribute("position",new mn(e,2)),i}const zve=w.forwardRef(function({children:e,...t},n){const r=w.useMemo(Uve,[]);return w.createElement("mesh",ot({ref:n,geometry:r,frustumCulled:!1},t),e)}),Gve=w.forwardRef(({children:i,width:e,height:t,depth:n,box3:r,precise:s=!0,...o},a)=>{const l=w.useRef(null),c=w.useRef(null),u=w.useRef(null);return w.useLayoutEffect(()=>{c.current.matrixWorld.identity();let h=r||new ti().setFromObject(u.current,s);const f=h.max.x-h.min.x,d=h.max.y-h.min.y,m=h.max.z-h.min.z;let A=Math.max(f,d,m);e&&(A=f),t&&(A=d),n&&(A=m),c.current.scale.setScalar(1/A)},[e,t,n,r,s]),w.useImperativeHandle(a,()=>l.current,[]),w.createElement("group",ot({ref:l},o),w.createElement("group",{ref:c},w.createElement("group",{ref:u},i)))});var nc=(function(i){return i[i.NONE=0]="NONE",i[i.START=1]="START",i[i.ACTIVE=2]="ACTIVE",i})(nc||{});const c1=i=>i&&i.isOrthographicCamera,Hve=i=>i&&i.isBox3,Qve=i=>1-Math.exp(-5*i)+.007*i,kW=w.createContext(null);function FW({children:i,maxDuration:e=1,margin:t=1.2,observe:n,fit:r,clip:s,interpolateFunc:o=Qve,onFit:a}){const l=w.useRef(null),{camera:c,size:u,invalidate:h}=Ve(),f=Ve(T=>T.controls),d=w.useRef(a);d.current=a;const m=w.useRef({camPos:new H,camRot:new Xt,camZoom:1}),A=w.useRef({camPos:void 0,camRot:void 0,camZoom:void 0,camUp:void 0,target:void 0}),g=w.useRef(nc.NONE),y=w.useRef(0),[E]=w.useState(()=>new ti),x=w.useMemo(()=>{function T(){const I=E.getSize(new H),M=E.getCenter(new H),L=Math.max(I.x,I.y,I.z),R=c1(c)?L*4:L/(2*Math.atan(Math.PI*c.fov/360)),P=c1(c)?L*4:R/c.aspect,F=t*Math.max(R,P);return{box:E,size:I,center:M,distance:F}}return{getSize:T,refresh(I){if(Hve(I))E.copy(I);else{const M=I||l.current;if(!M)return this;M.updateWorldMatrix(!0,!0),E.setFromObject(M)}if(E.isEmpty()){const M=c.position.length()||10;E.setFromCenterAndSize(new H,new H(M,M,M))}return m.current.camPos.copy(c.position),m.current.camRot.copy(c.quaternion),c1(c)&&(m.current.camZoom=c.zoom),A.current.camPos=void 0,A.current.camRot=void 0,A.current.camZoom=void 0,A.current.camUp=void 0,A.current.target=void 0,this},reset(){const{center:I,distance:M}=T(),L=c.position.clone().sub(I).normalize();A.current.camPos=I.clone().addScaledVector(L,M),A.current.target=I.clone();const R=new Xe().lookAt(A.current.camPos,A.current.target,c.up);return A.current.camRot=new Xt().setFromRotationMatrix(R),g.current=nc.START,y.current=0,this},moveTo(I){return A.current.camPos=Array.isArray(I)?new H(...I):I.clone(),g.current=nc.START,y.current=0,this},lookAt({target:I,up:M}){A.current.target=Array.isArray(I)?new H(...I):I.clone(),M?A.current.camUp=Array.isArray(M)?new H(...M):M.clone():A.current.camUp=c.up.clone();const L=new Xe().lookAt(A.current.camPos||c.position,A.current.target,A.current.camUp);return A.current.camRot=new Xt().setFromRotationMatrix(L),g.current=nc.START,y.current=0,this},to({position:I,target:M}){return this.moveTo(I).lookAt({target:M})},fit(){if(!c1(c))return this.reset();let I=0,M=0;const L=[new H(E.min.x,E.min.y,E.min.z),new H(E.min.x,E.max.y,E.min.z),new H(E.min.x,E.min.y,E.max.z),new H(E.min.x,E.max.y,E.max.z),new H(E.max.x,E.max.y,E.max.z),new H(E.max.x,E.max.y,E.min.z),new H(E.max.x,E.min.y,E.max.z),new H(E.max.x,E.min.y,E.min.z)],R=A.current.camPos||c.position,P=A.current.target||(f==null?void 0:f.target),F=A.current.camUp||c.up,k=P?new Xe().lookAt(R,P,F).setPosition(R).invert():c.matrixWorldInverse;for(const W of L)W.applyMatrix4(k),I=Math.max(I,Math.abs(W.y)),M=Math.max(M,Math.abs(W.x));I*=2,M*=2;const z=(c.top-c.bottom)/I,U=(c.right-c.left)/M;return A.current.camZoom=Math.min(z,U)/t,g.current=nc.START,y.current=0,d.current&&d.current(this.getSize()),this},clip(){const{distance:I}=T();return c.near=I/100,c.far=I*100,c.updateProjectionMatrix(),f&&(f.maxDistance=I*10,f.update()),h(),this}}},[E,c,f,t,h]);w.useLayoutEffect(()=>{if(f){const T=()=>{if(f&&A.current.target&&g.current!==nc.NONE){const I=new H().setFromMatrixColumn(c.matrix,2),M=m.current.camPos.distanceTo(f.target),L=(A.current.camPos||m.current.camPos).distanceTo(A.current.target),R=(1-y.current)*M+y.current*L;f.target.copy(c.position).addScaledVector(I,-R),f.update()}g.current=nc.NONE};return f.addEventListener("start",T),()=>f.removeEventListener("start",T)}},[f]);const C=w.useRef(0);return w.useLayoutEffect(()=>{(n||C.current++===0)&&(x.refresh(),r&&x.reset().fit(),s&&x.clip())},[u,s,r,n,c,f]),Kt((T,I)=>{if(g.current===nc.START)g.current=nc.ACTIVE,h();else if(g.current===nc.ACTIVE){if(y.current+=I/e,y.current>=1)A.current.camPos&&c.position.copy(A.current.camPos),A.current.camRot&&c.quaternion.copy(A.current.camRot),A.current.camUp&&c.up.copy(A.current.camUp),A.current.camZoom&&c1(c)&&(c.zoom=A.current.camZoom),c.updateMatrixWorld(),c.updateProjectionMatrix(),f&&A.current.target&&(f.target.copy(A.current.target),f.update()),g.current=nc.NONE;else{const M=o(y.current);A.current.camPos&&c.position.lerpVectors(m.current.camPos,A.current.camPos,M),A.current.camRot&&c.quaternion.slerpQuaternions(m.current.camRot,A.current.camRot,M),A.current.camUp&&c.up.set(0,1,0).applyQuaternion(c.quaternion),A.current.camZoom&&c1(c)&&(c.zoom=(1-M)*m.current.camZoom+M*A.current.camZoom),c.updateMatrixWorld(),c.updateProjectionMatrix()}h()}}),w.createElement("group",{ref:l},w.createElement(kW.Provider,{value:x},i))}function OW(){return w.useContext(kW)}const Vve=w.forwardRef(({intensity:i=1,decay:e,decayRate:t=.65,maxYaw:n=.1,maxPitch:r=.1,maxRoll:s=.1,yawFrequency:o=.1,pitchFrequency:a=.1,rollFrequency:l=.1},c)=>{const u=Ve(E=>E.camera),h=Ve(E=>E.controls),f=w.useRef(i),d=w.useRef(u.rotation.clone()),[m]=w.useState(()=>new jT),[A]=w.useState(()=>new jT),[g]=w.useState(()=>new jT),y=()=>{(f.current<0||f.current>1)&&(f.current=f.current<0?0:1)};return w.useImperativeHandle(c,()=>({getIntensity:()=>f.current,setIntensity:E=>{f.current=E,y()}}),[]),w.useEffect(()=>{if(h){const E=()=>void(d.current=u.rotation.clone());return h.addEventListener("change",E),E(),()=>void h.removeEventListener("change",E)}},[u,h]),Kt((E,x)=>{const C=Math.pow(f.current,2),T=n*C*m.noise(E.clock.elapsedTime*o,1),I=r*C*A.noise(E.clock.elapsedTime*a,1),M=s*C*g.noise(E.clock.elapsedTime*l,1);u.rotation.set(d.current.x+I,d.current.y+T,d.current.z+M),e&&f.current>0&&(f.current-=t*x,y())}),null}),Wve=w.forwardRef(({children:i,enabled:e=!0,speed:t=1,rotationIntensity:n=1,floatIntensity:r=1,floatingRange:s=[-.1,.1],autoInvalidate:o=!1,...a},l)=>{const c=w.useRef(null);w.useImperativeHandle(l,()=>c.current,[]);const u=w.useRef(Math.random()*1e4);return Kt(h=>{var f,d;if(!e||t===0)return;o&&h.invalidate();const m=u.current+h.clock.elapsedTime;c.current.rotation.x=Math.cos(m/4*t)/8*n,c.current.rotation.y=Math.sin(m/4*t)/8*n,c.current.rotation.z=Math.sin(m/4*t)/20*n;let A=Math.sin(m/4*t)/10;A=un.mapLinear(A,-.1,.1,(f=s==null?void 0:s[0])!==null&&f!==void 0?f:-.1,(d=s==null?void 0:s[1])!==null&&d!==void 0?d:.1),c.current.position.y=A*r,c.current.updateMatrix()}),w.createElement("group",a,w.createElement("group",{ref:c,matrixAutoUpdate:!1},i))}),NW=(i,e,t)=>{let n;switch(i){case Zi:n=new Uint8ClampedArray(e*t*4);break;case Ni:n=new Uint16Array(e*t*4);break;case Zo:n=new Uint32Array(e*t*4);break;case E2:n=new Int8Array(e*t*4);break;case Aw:n=new Int16Array(e*t*4);break;case Nm:n=new Int32Array(e*t*4);break;case fi:n=new Float32Array(e*t*4);break;default:throw new Error("Unsupported data type")}return n};let w_;const jve=(i,e,t,n)=>{if(w_!==void 0)return w_;const r=new Si(1,1,n);e.setRenderTarget(r);const s=new It(new Fs,new no({color:16777215}));e.render(s,t),e.setRenderTarget(null);const o=NW(i,r.width,r.height);return e.readRenderTargetPixels(r,0,0,r.width,r.height,o),r.dispose(),s.geometry.dispose(),s.material.dispose(),w_=o[0]!==0,w_};class a8{constructor(e){Zr(this,"_renderer");Zr(this,"_rendererIsDisposable",!1);Zr(this,"_material");Zr(this,"_scene");Zr(this,"_camera");Zr(this,"_quad");Zr(this,"_renderTarget");Zr(this,"_width");Zr(this,"_height");Zr(this,"_type");Zr(this,"_colorSpace");Zr(this,"_supportsReadPixels",!0);Zr(this,"render",()=>{this._renderer.setRenderTarget(this._renderTarget);try{this._renderer.render(this._scene,this._camera)}catch(e){throw this._renderer.setRenderTarget(null),e}this._renderer.setRenderTarget(null)});var n,r,s,o,a,l,c,u,h,f,d,m,A,g,y,E;this._width=e.width,this._height=e.height,this._type=e.type,this._colorSpace=e.colorSpace;const t={format:gi,depthBuffer:!1,stencilBuffer:!1,type:this._type,colorSpace:this._colorSpace,anisotropy:((n=e.renderTargetOptions)==null?void 0:n.anisotropy)!==void 0?(r=e.renderTargetOptions)==null?void 0:r.anisotropy:1,generateMipmaps:((s=e.renderTargetOptions)==null?void 0:s.generateMipmaps)!==void 0?(o=e.renderTargetOptions)==null?void 0:o.generateMipmaps:!1,magFilter:((a=e.renderTargetOptions)==null?void 0:a.magFilter)!==void 0?(l=e.renderTargetOptions)==null?void 0:l.magFilter:Pn,minFilter:((c=e.renderTargetOptions)==null?void 0:c.minFilter)!==void 0?(u=e.renderTargetOptions)==null?void 0:u.minFilter:Pn,samples:((h=e.renderTargetOptions)==null?void 0:h.samples)!==void 0?(f=e.renderTargetOptions)==null?void 0:f.samples:void 0,wrapS:((d=e.renderTargetOptions)==null?void 0:d.wrapS)!==void 0?(m=e.renderTargetOptions)==null?void 0:m.wrapS:ji,wrapT:((A=e.renderTargetOptions)==null?void 0:A.wrapT)!==void 0?(g=e.renderTargetOptions)==null?void 0:g.wrapT:ji};if(this._material=e.material,e.renderer?this._renderer=e.renderer:(this._renderer=a8.instantiateRenderer(),this._rendererIsDisposable=!0),this._scene=new Mu,this._camera=new qi,this._camera.position.set(0,0,10),this._camera.left=-.5,this._camera.right=.5,this._camera.top=.5,this._camera.bottom=-.5,this._camera.updateProjectionMatrix(),!jve(this._type,this._renderer,this._camera,t)){let x;switch(this._type){case Ni:x=this._renderer.extensions.has("EXT_color_buffer_float")?fi:void 0;break}x!==void 0?(console.warn(`This browser does not support reading pixels from ${this._type} RenderTargets, switching to ${fi}`),this._type=x):(this._supportsReadPixels=!1,console.warn("This browser dos not support toArray or toDataTexture, calls to those methods will result in an error thrown"))}this._quad=new It(new Fs,this._material),this._quad.geometry.computeBoundingBox(),this._scene.add(this._quad),this._renderTarget=new Si(this.width,this.height,t),this._renderTarget.texture.mapping=((y=e.renderTargetOptions)==null?void 0:y.mapping)!==void 0?(E=e.renderTargetOptions)==null?void 0:E.mapping:np}static instantiateRenderer(){const e=new Iw;return e.setSize(128,128),e}toArray(){if(!this._supportsReadPixels)throw new Error("Can't read pixels in this browser");const e=NW(this._type,this._width,this._height);return this._renderer.readRenderTargetPixels(this._renderTarget,0,0,this._width,this._height,e),e}toDataTexture(e){const t=new Sa(this.toArray(),this.width,this.height,gi,this._type,(e==null?void 0:e.mapping)||np,(e==null?void 0:e.wrapS)||ji,(e==null?void 0:e.wrapT)||ji,(e==null?void 0:e.magFilter)||Pn,(e==null?void 0:e.minFilter)||Pn,(e==null?void 0:e.anisotropy)||1,Dl);return t.generateMipmaps=(e==null?void 0:e.generateMipmaps)!==void 0?e==null?void 0:e.generateMipmaps:!1,t}disposeOnDemandRenderer(){this._renderer.setRenderTarget(null),this._rendererIsDisposable&&(this._renderer.dispose(),this._renderer.forceContextLoss())}dispose(e){this.disposeOnDemandRenderer(),e&&this.renderTarget.dispose(),this.material instanceof Mi&&Object.values(this.material.uniforms).forEach(t=>{t.value instanceof vi&&t.value.dispose()}),Object.values(this.material).forEach(t=>{t instanceof vi&&t.dispose()}),this.material.dispose(),this._quad.geometry.dispose()}get width(){return this._width}set width(e){this._width=e,this._renderTarget.setSize(this._width,this._height)}get height(){return this._height}set height(e){this._height=e,this._renderTarget.setSize(this._width,this._height)}get renderer(){return this._renderer}get renderTarget(){return this._renderTarget}set renderTarget(e){this._renderTarget=e,this._width=e.width,this._height=e.height}get material(){return this._material}get type(){return this._type}get colorSpace(){return this._colorSpace}}class UW extends Error{}class zW extends Error{}const Sv=(i,e,t)=>{const n=new RegExp(`${e}="([^"]*)"`,"i").exec(i);if(n)return n[1];const r=new RegExp(`<${e}[^>]*>([\\s\\S]*?)</${e}>`,"i").exec(i);if(r){const s=r[1].match(/<rdf:li>([^<]*)<\/rdf:li>/g);return s&&s.length===3?s.map(o=>o.replace(/<\/?rdf:li>/g,"")):r[1].trim()}if(t!==void 0)return t;throw new Error(`Can't find ${e} in gainmap metadata`)},Kve=i=>{let e;typeof TextDecoder<"u"?e=new TextDecoder().decode(i):e=i.toString();let t=e.indexOf("<x:xmpmeta");for(;t!==-1;){const n=e.indexOf("x:xmpmeta>",t),r=e.slice(t,n+10);try{const s=Sv(r,"hdrgm:GainMapMin","0"),o=Sv(r,"hdrgm:GainMapMax"),a=Sv(r,"hdrgm:Gamma","1"),l=Sv(r,"hdrgm:OffsetSDR","0.015625"),c=Sv(r,"hdrgm:OffsetHDR","0.015625"),u=/hdrgm:HDRCapacityMin="([^"]*)"/.exec(r),h=u?u[1]:"0",f=/hdrgm:HDRCapacityMax="([^"]*)"/.exec(r);if(!f)throw new Error("Incomplete gainmap metadata");const d=f[1];return{gainMapMin:Array.isArray(s)?s.map(m=>parseFloat(m)):[parseFloat(s),parseFloat(s),parseFloat(s)],gainMapMax:Array.isArray(o)?o.map(m=>parseFloat(m)):[parseFloat(o),parseFloat(o),parseFloat(o)],gamma:Array.isArray(a)?a.map(m=>parseFloat(m)):[parseFloat(a),parseFloat(a),parseFloat(a)],offsetSdr:Array.isArray(l)?l.map(m=>parseFloat(m)):[parseFloat(l),parseFloat(l),parseFloat(l)],offsetHdr:Array.isArray(c)?c.map(m=>parseFloat(m)):[parseFloat(c),parseFloat(c),parseFloat(c)],hdrCapacityMin:parseFloat(h),hdrCapacityMax:parseFloat(d)}}catch{}t=e.indexOf("<x:xmpmeta",n)}};class $ve{constructor(e){Zr(this,"options");this.options={debug:e&&e.debug!==void 0?e.debug:!1,extractFII:e&&e.extractFII!==void 0?e.extractFII:!0,extractNonFII:e&&e.extractNonFII!==void 0?e.extractNonFII:!0}}extract(e){return new Promise((t,n)=>{const r=this.options.debug,s=new DataView(e.buffer);if(s.getUint16(0)!==65496){n(new Error("Not a valid jpeg"));return}const o=s.byteLength;let a=2,l=0,c;for(;a<o;){if(++l>250){n(new Error(`Found no marker after ${l} loops 😵`));return}if(s.getUint8(a)!==255){n(new Error(`Not a valid marker at offset 0x${a.toString(16)}, found: 0x${s.getUint8(a).toString(16)}`));return}if(c=s.getUint8(a+1),r&&console.log(`Marker: ${c.toString(16)}`),c===226){r&&console.log("Found APP2 marker (0xffe2)");const u=a+4;if(s.getUint32(u)===1297106432){const h=u+4;let f;if(s.getUint16(h)===18761)f=!1;else if(s.getUint16(h)===19789)f=!0;else{n(new Error("No valid endianness marker found in TIFF header"));return}if(s.getUint16(h+2,!f)!==42){n(new Error("Not valid TIFF data! (no 0x002A marker)"));return}const d=s.getUint32(h+4,!f);if(d<8){n(new Error("Not valid TIFF data! (First offset less than 8)"));return}const m=h+d,A=s.getUint16(m,!f),g=m+2;let y=0;for(let T=g;T<g+12*A;T+=12)s.getUint16(T,!f)===45057&&(y=s.getUint32(T+8,!f));const x=m+2+A*12+4,C=[];for(let T=x;T<x+y*16;T+=16){const I={MPType:s.getUint32(T,!f),size:s.getUint32(T+4,!f),dataOffset:s.getUint32(T+8,!f),dependantImages:s.getUint32(T+12,!f),start:-1,end:-1,isFII:!1};I.dataOffset?(I.start=h+I.dataOffset,I.isFII=!1):(I.start=0,I.isFII=!0),I.end=I.start+I.size,C.push(I)}if(this.options.extractNonFII&&C.length){const T=new Blob([s]),I=[];for(const M of C){if(M.isFII&&!this.options.extractFII)continue;const L=T.slice(M.start,M.end+1,"image/jpeg");I.push(L)}t(I)}}}a+=2+s.getUint16(a+2)}})}}const Yve=async i=>{const e=Kve(i);if(!e)throw new zW("Gain map XMP metadata not found");const n=await new $ve({extractFII:!0,extractNonFII:!0}).extract(i);if(n.length!==2)throw new UW("Gain map recovery image not found");return{sdr:new Uint8Array(await n[0].arrayBuffer()),gainMap:new Uint8Array(await n[1].arrayBuffer()),metadata:e}},SF=i=>new Promise((e,t)=>{const n=document.createElement("img");n.onload=()=>{e(n)},n.onerror=r=>{t(r)},n.src=URL.createObjectURL(i)});class Xve extends os{constructor(t,n){super(n);Zr(this,"_renderer");Zr(this,"_renderTargetOptions");Zr(this,"_internalLoadingManager");Zr(this,"_config");this._config=t,t.renderer&&(this._renderer=t.renderer),this._internalLoadingManager=new Qw}setRenderer(t){return this._renderer=t,this}setRenderTargetOptions(t){return this._renderTargetOptions=t,this}prepareQuadRenderer(){this._renderer||console.warn("WARNING: A Renderer was not passed to this Loader constructor or in setRenderer, the result of this Loader will need to be converted to a Data Texture with toDataTexture() before you can use it in your renderer.");const t=this._config.createMaterial({gainMapMax:[1,1,1],gainMapMin:[0,0,0],gamma:[1,1,1],offsetHdr:[1,1,1],offsetSdr:[1,1,1],hdrCapacityMax:1,hdrCapacityMin:0,maxDisplayBoost:1,gainMap:new vi,sdr:new vi});return this._config.createQuadRenderer({width:16,height:16,type:Ni,colorSpace:Dl,material:t,renderer:this._renderer,renderTargetOptions:this._renderTargetOptions})}async processImages(t,n,r){const s=n?new Blob([n],{type:"image/jpeg"}):void 0,o=new Blob([t],{type:"image/jpeg"});let a,l,c=!1;if(typeof createImageBitmap>"u"){const u=await Promise.all([s?SF(s):Promise.resolve(void 0),SF(o)]);l=u[0],a=u[1],c=r==="flipY"}else{const u=await Promise.all([s?createImageBitmap(s,{imageOrientation:r||"flipY"}):Promise.resolve(void 0),createImageBitmap(o,{imageOrientation:r||"flipY"})]);l=u[0],a=u[1]}return{sdrImage:a,gainMapImage:l,needsFlip:c}}createTextures(t,n,r){const s=new vi(n||new ImageData(2,2),np,ji,ji,Pn,iM,gi,Zi,1,Dl);s.flipY=r,s.needsUpdate=!0;const o=new vi(t,np,ji,ji,Pn,iM,gi,Zi,1,gs);return o.flipY=r,o.needsUpdate=!0,{gainMap:s,sdr:o}}updateQuadRenderer(t,n,r,s,o){t.width=n.width,t.height=n.height,t.material.gainMap=r,t.material.sdr=s,t.material.gainMapMin=o.gainMapMin,t.material.gainMapMax=o.gainMapMax,t.material.offsetHdr=o.offsetHdr,t.material.offsetSdr=o.offsetSdr,t.material.gamma=o.gamma,t.material.hdrCapacityMin=o.hdrCapacityMin,t.material.hdrCapacityMax=o.hdrCapacityMax,t.material.maxDisplayBoost=Math.pow(2,o.hdrCapacityMax),t.material.needsUpdate=!0}}const qve=`
varying vec2 vUv;

void main() {
  vUv = uv;
  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
}
`,Jve=`
// min half float value
#define HALF_FLOAT_MIN vec3( -65504, -65504, -65504 )
// max half float value
#define HALF_FLOAT_MAX vec3( 65504, 65504, 65504 )

uniform sampler2D sdr;
uniform sampler2D gainMap;
uniform vec3 gamma;
uniform vec3 offsetHdr;
uniform vec3 offsetSdr;
uniform vec3 gainMapMin;
uniform vec3 gainMapMax;
uniform float weightFactor;

varying vec2 vUv;

void main() {
  vec3 rgb = texture2D( sdr, vUv ).rgb;
  vec3 recovery = texture2D( gainMap, vUv ).rgb;
  vec3 logRecovery = pow( recovery, gamma );
  vec3 logBoost = gainMapMin * ( 1.0 - logRecovery ) + gainMapMax * logRecovery;
  vec3 hdrColor = (rgb + offsetSdr) * exp2( logBoost * weightFactor ) - offsetHdr;
  vec3 clampedHdrColor = max( HALF_FLOAT_MIN, min( HALF_FLOAT_MAX, hdrColor ));
  gl_FragColor = vec4( clampedHdrColor , 1.0 );
}
`;class Zve extends Mi{constructor({gamma:t,offsetHdr:n,offsetSdr:r,gainMapMin:s,gainMapMax:o,maxDisplayBoost:a,hdrCapacityMin:l,hdrCapacityMax:c,sdr:u,gainMap:h}){super({name:"GainMapDecoderMaterial",vertexShader:qve,fragmentShader:Jve,uniforms:{sdr:{value:u},gainMap:{value:h},gamma:{value:new H(1/t[0],1/t[1],1/t[2])},offsetHdr:{value:new H().fromArray(n)},offsetSdr:{value:new H().fromArray(r)},gainMapMin:{value:new H().fromArray(s)},gainMapMax:{value:new H().fromArray(o)},weightFactor:{value:(Math.log2(a)-l)/(c-l)}},blending:gc,depthTest:!1,depthWrite:!1});Zr(this,"_maxDisplayBoost");Zr(this,"_hdrCapacityMin");Zr(this,"_hdrCapacityMax");this._maxDisplayBoost=a,this._hdrCapacityMin=l,this._hdrCapacityMax=c,this.needsUpdate=!0,this.uniformsNeedUpdate=!0}get sdr(){return this.uniforms.sdr.value}set sdr(t){this.uniforms.sdr.value=t}get gainMap(){return this.uniforms.gainMap.value}set gainMap(t){this.uniforms.gainMap.value=t}get offsetHdr(){return this.uniforms.offsetHdr.value.toArray()}set offsetHdr(t){this.uniforms.offsetHdr.value.fromArray(t)}get offsetSdr(){return this.uniforms.offsetSdr.value.toArray()}set offsetSdr(t){this.uniforms.offsetSdr.value.fromArray(t)}get gainMapMin(){return this.uniforms.gainMapMin.value.toArray()}set gainMapMin(t){this.uniforms.gainMapMin.value.fromArray(t)}get gainMapMax(){return this.uniforms.gainMapMax.value.toArray()}set gainMapMax(t){this.uniforms.gainMapMax.value.fromArray(t)}get gamma(){const t=this.uniforms.gamma.value;return[1/t.x,1/t.y,1/t.z]}set gamma(t){const n=this.uniforms.gamma.value;n.x=1/t[0],n.y=1/t[1],n.z=1/t[2]}get hdrCapacityMin(){return this._hdrCapacityMin}set hdrCapacityMin(t){this._hdrCapacityMin=t,this.calculateWeight()}get hdrCapacityMax(){return this._hdrCapacityMax}set hdrCapacityMax(t){this._hdrCapacityMax=t,this.calculateWeight()}get maxDisplayBoost(){return this._maxDisplayBoost}set maxDisplayBoost(t){this._maxDisplayBoost=Math.max(1,Math.min(65504,t)),this.calculateWeight()}calculateWeight(){const t=(Math.log2(this._maxDisplayBoost)-this._hdrCapacityMin)/(this._hdrCapacityMax-this._hdrCapacityMin);this.uniforms.weightFactor.value=Math.max(0,Math.min(1,t))}}class GW extends Xve{constructor(e,t){super({renderer:e,createMaterial:n=>new Zve(n),createQuadRenderer:n=>new a8(n)},t)}async render(e,t,n,r){const{sdrImage:s,gainMapImage:o,needsFlip:a}=await this.processImages(n,r,"flipY"),{gainMap:l,sdr:c}=this.createTextures(s,o,a);this.updateQuadRenderer(e,s,l,c,t),e.render()}}class e2e extends GW{load([e,t,n],r,s,o){const a=this.prepareQuadRenderer();let l,c,u;const h=async()=>{if(l&&c&&u){try{await this.render(a,u,l,c)}catch(R){this.manager.itemError(e),this.manager.itemError(t),this.manager.itemError(n),typeof o=="function"&&o(R),a.disposeOnDemandRenderer();return}typeof r=="function"&&r(a),this.manager.itemEnd(e),this.manager.itemEnd(t),this.manager.itemEnd(n),a.disposeOnDemandRenderer()}};let f=!0,d=0,m=0,A=!0,g=0,y=0,E=!0,x=0,C=0;const T=()=>{if(typeof s=="function"){const R=d+g+x,P=m+y+C,F=f&&A&&E;s(new ProgressEvent("progress",{lengthComputable:F,loaded:P,total:R}))}};this.manager.itemStart(e),this.manager.itemStart(t),this.manager.itemStart(n);const I=new $r(this._internalLoadingManager);I.setResponseType("arraybuffer"),I.setRequestHeader(this.requestHeader),I.setPath(this.path),I.setWithCredentials(this.withCredentials),I.load(e,async R=>{if(typeof R=="string")throw new Error("Invalid sdr buffer");l=R,await h()},R=>{f=R.lengthComputable,m=R.loaded,d=R.total,T()},R=>{this.manager.itemError(e),typeof o=="function"&&o(R)});const M=new $r(this._internalLoadingManager);M.setResponseType("arraybuffer"),M.setRequestHeader(this.requestHeader),M.setPath(this.path),M.setWithCredentials(this.withCredentials),M.load(t,async R=>{if(typeof R=="string")throw new Error("Invalid gainmap buffer");c=R,await h()},R=>{A=R.lengthComputable,y=R.loaded,g=R.total,T()},R=>{this.manager.itemError(t),typeof o=="function"&&o(R)});const L=new $r(this._internalLoadingManager);return L.setRequestHeader(this.requestHeader),L.setPath(this.path),L.setWithCredentials(this.withCredentials),L.load(n,async R=>{if(typeof R!="string")throw new Error("Invalid metadata string");u=JSON.parse(R),await h()},R=>{E=R.lengthComputable,C=R.loaded,x=R.total,T()},R=>{this.manager.itemError(n),typeof o=="function"&&o(R)}),a}}class t2e extends GW{load(e,t,n,r){const s=this.prepareQuadRenderer(),o=new $r(this._internalLoadingManager);return o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setPath(this.path),o.setWithCredentials(this.withCredentials),this.manager.itemStart(e),o.load(e,async a=>{if(typeof a=="string")throw new Error("Invalid buffer, received [string], was expecting [ArrayBuffer]");const l=new Uint8Array(a);let c,u,h;try{const f=await Yve(l);c=f.sdr,u=f.gainMap,h=f.metadata}catch(f){if(f instanceof zW||f instanceof UW)console.warn(`Failure to reconstruct an HDR image from ${e}: Gain map metadata not found in the file, HDRJPGLoader will render the SDR jpeg`),h={gainMapMin:[0,0,0],gainMapMax:[1,1,1],gamma:[1,1,1],hdrCapacityMin:0,hdrCapacityMax:1,offsetHdr:[0,0,0],offsetSdr:[0,0,0]},c=l;else throw f}try{await this.render(s,h,c.buffer,u==null?void 0:u.buffer)}catch(f){this.manager.itemError(e),typeof r=="function"&&r(f),s.disposeOnDemandRenderer();return}typeof t=="function"&&t(s),this.manager.itemEnd(e),s.disposeOnDemandRenderer()},n,a=>{this.manager.itemError(e),typeof r=="function"&&r(a)}),s}}const $2={apartment:"lebombo_1k.hdr",city:"potsdamer_platz_1k.hdr",dawn:"kiara_1_dawn_1k.hdr",forest:"forest_slope_1k.hdr",lobby:"st_fagans_interior_1k.hdr",night:"dikhololo_night_1k.hdr",park:"rooitou_park_1k.hdr",studio:"studio_small_03_1k.hdr",sunset:"venice_sunset_1k.hdr",warehouse:"empty_warehouse_01_1k.hdr"},HW="https://raw.githack.com/pmndrs/drei-assets/456060a26bbeb8fdf79326f224b6d99b8bcce736/hdri/",K1=i=>Array.isArray(i),l8=["/px.png","/nx.png","/py.png","/ny.png","/pz.png","/nz.png"];function wx({files:i=l8,path:e="",preset:t=void 0,encoding:n=void 0,extensions:r}={}){let s=null,o=!1;t&&(c8(t),i=$2[t],e=HW),o=K1(i);const{extension:a,isCubemap:l}=u8(i);if(s=h8(a),!s)throw new Error("useEnvironment: Unrecognized file extension: "+i);const c=Ve(d=>d.gl);w.useLayoutEffect(()=>{if(a!=="webp"&&a!=="jpg"&&a!=="jpeg")return;function d(){cr.clear(s,o?[i]:i)}c.domElement.addEventListener("webglcontextlost",d,{once:!0})},[i,c.domElement]);const u=cr(s,o?[i]:i,d=>{(a==="webp"||a==="jpg"||a==="jpeg")&&d.setRenderer(c),d.setPath==null||d.setPath(e),r&&r(d)});let h=o?u[0]:u;if(a==="jpg"||a==="jpeg"||a==="webp"){var f;h=(f=h.renderTarget)==null?void 0:f.texture}return h.mapping=l?_u:Ym,"colorSpace"in h?h.colorSpace=n??l?"srgb":"srgb-linear":h.encoding=n??l?Vye:Qye,h}const n2e={files:l8,path:"",preset:void 0,extensions:void 0};wx.preload=i=>{const e={...n2e,...i};let{files:t,path:n=""}=e;const{preset:r,extensions:s}=e;r&&(c8(r),t=$2[r],n=HW);const{extension:o}=u8(t);if(o==="webp"||o==="jpg"||o==="jpeg")throw new Error("useEnvironment: Preloading gainmaps is not supported");const a=h8(o);if(!a)throw new Error("useEnvironment: Unrecognized file extension: "+t);cr.preload(a,K1(t)?[t]:t,l=>{l.setPath==null||l.setPath(n),s&&s(l)})};const i2e={files:l8,preset:void 0};wx.clear=i=>{const e={...i2e,...i};let{files:t}=e;const{preset:n}=e;n&&(c8(n),t=$2[n]);const{extension:r}=u8(t),s=h8(r);if(!s)throw new Error("useEnvironment: Unrecognized file extension: "+t);cr.clear(s,K1(t)?[t]:t)};function c8(i){if(!(i in $2))throw new Error("Preset must be one of: "+Object.keys($2).join(", "))}function u8(i){var e;const t=K1(i)&&i.length===6,n=K1(i)&&i.length===3&&i.some(o=>o.endsWith("json")),r=K1(i)?i[0]:i;return{extension:t?"cube":n?"webp":r.startsWith("data:application/exr")?"exr":r.startsWith("data:application/hdr")?"hdr":r.startsWith("data:image/jpeg")?"jpg":(e=r.split(".").pop())==null||(e=e.split("?"))==null||(e=e.shift())==null?void 0:e.toLowerCase(),isCubemap:t,isGainmap:n}}function h8(i){return i==="cube"?Vw:i==="hdr"?che:i==="exr"?uhe:i==="jpg"||i==="jpeg"?t2e:i==="webp"?e2e:null}const r2e=i=>i.current&&i.current.isScene,s2e=i=>r2e(i)?i.current:i;function f8(i,e,t,n,r={}){var s,o,a,l;r={backgroundBlurriness:0,backgroundIntensity:1,backgroundRotation:[0,0,0],environmentIntensity:1,environmentRotation:[0,0,0],...r};const c=s2e(e||t),u=c.background,h=c.environment,f={backgroundBlurriness:c.backgroundBlurriness,backgroundIntensity:c.backgroundIntensity,backgroundRotation:(s=(o=c.backgroundRotation)==null||o.clone==null?void 0:o.clone())!==null&&s!==void 0?s:[0,0,0],environmentIntensity:c.environmentIntensity,environmentRotation:(a=(l=c.environmentRotation)==null||l.clone==null?void 0:l.clone())!==null&&a!==void 0?a:[0,0,0]};return i!=="only"&&(c.environment=n),i&&(c.background=n),Os(c,r),()=>{i!=="only"&&(c.environment=h),i&&(c.background=u),Os(c,f)}}function L4({scene:i,background:e=!1,map:t,...n}){const r=Ve(s=>s.scene);return w.useLayoutEffect(()=>{if(t)return f8(e,i,r,t,n)}),null}function d8({background:i=!1,scene:e,blur:t,backgroundBlurriness:n,backgroundIntensity:r,backgroundRotation:s,environmentIntensity:o,environmentRotation:a,...l}){const c=wx(l),u=Ve(h=>h.scene);return w.useLayoutEffect(()=>f8(i,e,u,c,{backgroundBlurriness:t??n,backgroundIntensity:r,backgroundRotation:s,environmentIntensity:o,environmentRotation:a})),w.useEffect(()=>()=>{c.dispose()},[c]),null}function QW({children:i,near:e=.1,far:t=1e3,resolution:n=256,frames:r=1,map:s,background:o=!1,blur:a,backgroundBlurriness:l,backgroundIntensity:c,backgroundRotation:u,environmentIntensity:h,environmentRotation:f,scene:d,files:m,path:A,preset:g=void 0,extensions:y}){const E=Ve(L=>L.gl),x=Ve(L=>L.scene),C=w.useRef(null),[T]=w.useState(()=>new Mu),I=w.useMemo(()=>{const L=new xA(n);return L.texture.type=Ni,L},[n]);w.useEffect(()=>()=>{I.dispose()},[I]),w.useLayoutEffect(()=>{if(r===1){const L=E.autoClear;E.autoClear=!0,C.current.update(E,T),E.autoClear=L}return f8(o,d,x,I.texture,{backgroundBlurriness:a??l,backgroundIntensity:c,backgroundRotation:u,environmentIntensity:h,environmentRotation:f})},[i,T,I.texture,d,x,o,r,E]);let M=1;return Kt(()=>{if(r===1/0||M<r){const L=E.autoClear;E.autoClear=!0,C.current.update(E,T),E.autoClear=L,M++}}),w.createElement(w.Fragment,null,vp(w.createElement(w.Fragment,null,i,w.createElement("cubeCamera",{ref:C,args:[e,t,I]}),m||g?w.createElement(d8,{background:!0,files:m,preset:g,path:A,extensions:y}):s?w.createElement(L4,{background:!0,map:s,extensions:y}):null),T))}function o2e(i){var e,t,n,r;const s=wx(i),o=i.map||s;w.useMemo(()=>Or({GroundProjectedEnvImpl:Rle}),[]),w.useEffect(()=>()=>{s.dispose()},[s]);const a=w.useMemo(()=>[o],[o]),l=(e=i.ground)==null?void 0:e.height,c=(t=i.ground)==null?void 0:t.radius,u=(n=(r=i.ground)==null?void 0:r.scale)!==null&&n!==void 0?n:1e3;return w.createElement(w.Fragment,null,w.createElement(L4,ot({},i,{map:o})),w.createElement("groundProjectedEnvImpl",{args:a,scale:u,height:l,radius:c}))}function VW(i){return i.ground?w.createElement(o2e,i):i.map?w.createElement(L4,i):i.children?w.createElement(QW,i):w.createElement(d8,i)}const WW=w.forwardRef(({scale:i=10,frames:e=1/0,opacity:t=1,width:n=1,height:r=1,blur:s=1,near:o=0,far:a=10,resolution:l=512,smooth:c=!0,color:u="#000000",depthWrite:h=!1,renderOrder:f,...d},m)=>{const A=w.useRef(null),g=Ve(U=>U.scene),y=Ve(U=>U.gl),E=w.useRef(null);n=n*(Array.isArray(i)?i[0]:i||1),r=r*(Array.isArray(i)?i[1]:i||1);const[x,C,T,I,M,L,R]=w.useMemo(()=>{const U=new Si(l,l),W=new Si(l,l);W.texture.generateMipmaps=U.texture.generateMipmaps=!1;const $=new Fs(n,r).rotateX(Math.PI/2),oe=new It($),X=new rx;X.depthTest=X.depthWrite=!1,X.onBeforeCompile=O=>{O.uniforms={...O.uniforms,ucolor:{value:new ut(u)}},O.fragmentShader=O.fragmentShader.replace("void main() {",`uniform vec3 ucolor;
           void main() {
          `),O.fragmentShader=O.fragmentShader.replace("vec4( vec3( 1.0 - fragCoordZ ), opacity );","vec4( ucolor * fragCoordZ * 2.0, ( 1.0 - fragCoordZ ) * 1.0 );")};const Q=new Mi(fue),Y=new Mi(due);return Y.depthTest=Q.depthTest=!1,[U,$,X,oe,Q,Y,W]},[l,n,r,i,u]),P=U=>{I.visible=!0,I.material=M,M.uniforms.tDiffuse.value=x.texture,M.uniforms.h.value=U*1/256,y.setRenderTarget(R),y.render(I,E.current),I.material=L,L.uniforms.tDiffuse.value=R.texture,L.uniforms.v.value=U*1/256,y.setRenderTarget(x),y.render(I,E.current),I.visible=!1};let F=0,k,z;return Kt(()=>{E.current&&(e===1/0||F<e)&&(F++,k=g.background,z=g.overrideMaterial,A.current.visible=!1,g.background=null,g.overrideMaterial=T,y.setRenderTarget(x),y.render(g,E.current),P(s),c&&P(s*.4),y.setRenderTarget(null),A.current.visible=!0,g.overrideMaterial=z,g.background=k)}),w.useImperativeHandle(m,()=>A.current,[]),w.createElement("group",ot({"rotation-x":Math.PI/2},d,{ref:A}),w.createElement("mesh",{renderOrder:f,geometry:C,scale:[1,-1,1],rotation:[-Math.PI/2,0,0]},w.createElement("meshBasicMaterial",{transparent:!0,map:x.texture,opacity:t,depthWrite:h})),w.createElement("orthographicCamera",{ref:E,args:[-n/2,n/2,r/2,-r/2,o,a]}))});function a2e(i){return i.isLight}function l2e(i){return!!i.geometry}const p8=w.createContext(null),c2e=Ec({color:new ut,blend:2,alphaTest:.75,opacity:0,map:null},`varying vec2 vUv;
   void main() {
     gl_Position = projectionMatrix * viewMatrix * modelMatrix * vec4(position, 1.);
     vUv = uv;
   }`,`varying vec2 vUv;
   uniform sampler2D map;
   uniform vec3 color;
   uniform float opacity;
   uniform float alphaTest;
   uniform float blend;
   void main() {
     vec4 sampledDiffuseColor = texture2D(map, vUv);
     gl_FragColor = vec4(color * sampledDiffuseColor.r * blend, max(0.0, (1.0 - (sampledDiffuseColor.r + sampledDiffuseColor.g + sampledDiffuseColor.b) / alphaTest)) * opacity);
     #include <tonemapping_fragment>
     #include <${ea>=154?"colorspace_fragment":"encodings_fragment"}>
   }`),jW=w.forwardRef(({children:i,temporal:e,frames:t=40,limit:n=1/0,blend:r=20,scale:s=10,opacity:o=1,alphaTest:a=.75,color:l="black",colorBlend:c=2,resolution:u=1024,toneMapped:h=!0,...f},d)=>{Or({SoftShadowMaterial:c2e});const m=Ve(I=>I.gl),A=Ve(I=>I.scene),g=Ve(I=>I.camera),y=Ve(I=>I.invalidate),E=w.useRef(null),x=w.useRef(null),[C]=w.useState(()=>new u2e(m,A,u));w.useLayoutEffect(()=>{C.configure(E.current)},[]);const T=w.useMemo(()=>({lights:new Map,temporal:!!e,frames:Math.max(2,t),blend:Math.max(2,t===1/0?r:t),count:0,getMesh:()=>E.current,reset:()=>{C.clear();const I=E.current.material;I.opacity=0,I.alphaTest=0,T.count=0},update:(I=1)=>{const M=E.current.material;T.temporal?(M.opacity=Math.min(o,M.opacity+o/T.blend),M.alphaTest=Math.min(a,M.alphaTest+a/T.blend)):(M.opacity=o,M.alphaTest=a),x.current.visible=!0,C.prepare();for(let L=0;L<I;L++)T.lights.forEach(R=>R.update()),C.update(g,T.blend);x.current.visible=!1,C.finish()}}),[C,g,A,e,t,r,o,a]);return w.useLayoutEffect(()=>{T.reset(),!T.temporal&&T.frames!==1/0&&T.update(T.blend)}),w.useImperativeHandle(d,()=>T,[T]),Kt(()=>{(T.temporal||T.frames===1/0)&&T.count<T.frames&&T.count<n&&(y(),T.update(),T.count++)}),w.createElement("group",f,w.createElement("group",{traverse:()=>null,ref:x},w.createElement(p8.Provider,{value:T},i)),w.createElement("mesh",{receiveShadow:!0,ref:E,scale:s,rotation:[-Math.PI/2,0,0]},w.createElement("planeGeometry",null),w.createElement("softShadowMaterial",{transparent:!0,depthWrite:!1,toneMapped:h,color:l,blend:c,map:C.progressiveLightMap2.texture})))}),KW=w.forwardRef(({castShadow:i=!0,bias:e=.001,mapSize:t=512,size:n=5,near:r=.5,far:s=500,frames:o=1,position:a=[0,0,0],radius:l=1,amount:c=8,intensity:u=ea>=155?Math.PI:1,ambient:h=.5,...f},d)=>{const m=w.useRef(null),A=new H(...a).length(),g=w.useContext(p8),y=w.useCallback(()=>{let x;if(m.current)for(let C=0;C<m.current.children.length;C++)if(x=m.current.children[C],Math.random()>h)x.position.set(a[0]+un.randFloatSpread(l),a[1]+un.randFloatSpread(l),a[2]+un.randFloatSpread(l));else{let T=Math.acos(2*Math.random()-1)-Math.PI/2,I=2*Math.PI*Math.random();x.position.set(Math.cos(T)*Math.cos(I)*A,Math.abs(Math.cos(T)*Math.sin(I)*A),Math.sin(T)*A)}},[l,h,A,...a]),E=w.useMemo(()=>({update:y}),[y]);return w.useImperativeHandle(d,()=>E,[E]),w.useLayoutEffect(()=>{var x;const C=m.current;return g&&((x=g.lights)==null||x.set(C.uuid,E)),()=>{var T;return void(g==null||(T=g.lights)==null?void 0:T.delete(C.uuid))}},[g,E]),w.createElement("group",ot({ref:m},f),Array.from({length:c},(x,C)=>w.createElement("directionalLight",{key:C,castShadow:i,"shadow-bias":e,"shadow-mapSize":[t,t],intensity:u/c},w.createElement("orthographicCamera",{attach:"shadow-camera",args:[-n,n,n,-n,r,s]}))))});class u2e{constructor(e,t,n=1024){this.renderer=e,this.res=n,this.scene=t,this.buffer1Active=!1,this.lights=[],this.meshes=[],this.object=null,this.clearColor=new ut,this.clearAlpha=0;const r={type:Ni,magFilter:zn,minFilter:zn};this.progressiveLightMap1=new Si(this.res,this.res,r),this.progressiveLightMap2=new Si(this.res,this.res,r),this.discardMat=new o8,this.targetMat=new fx({fog:!1}),this.previousShadowMap={value:this.progressiveLightMap1.texture},this.averagingWindow={value:100},this.targetMat.onBeforeCompile=s=>{s.vertexShader=`varying vec2 vUv;
`+s.vertexShader.slice(0,-1)+"vUv = uv; gl_Position = vec4((uv - 0.5) * 2.0, 1.0, 1.0); }";const o=s.fragmentShader.indexOf("void main() {");s.fragmentShader=`varying vec2 vUv;
`+s.fragmentShader.slice(0,o)+`uniform sampler2D previousShadowMap;
	uniform float averagingWindow;
`+s.fragmentShader.slice(o-1,-1)+`
vec3 texelOld = texture2D(previousShadowMap, vUv).rgb;
        gl_FragColor.rgb = mix(texelOld, gl_FragColor.rgb, 1.0/ averagingWindow);
      }`,s.uniforms.previousShadowMap=this.previousShadowMap,s.uniforms.averagingWindow=this.averagingWindow}}clear(){this.renderer.getClearColor(this.clearColor),this.clearAlpha=this.renderer.getClearAlpha(),this.renderer.setClearColor("black",1),this.renderer.setRenderTarget(this.progressiveLightMap1),this.renderer.clear(),this.renderer.setRenderTarget(this.progressiveLightMap2),this.renderer.clear(),this.renderer.setRenderTarget(null),this.renderer.setClearColor(this.clearColor,this.clearAlpha),this.lights=[],this.meshes=[],this.scene.traverse(e=>{l2e(e)?this.meshes.push({object:e,material:e.material}):a2e(e)&&this.lights.push({object:e,intensity:e.intensity})})}prepare(){this.lights.forEach(e=>e.object.intensity=0),this.meshes.forEach(e=>e.object.material=this.discardMat)}finish(){this.lights.forEach(e=>e.object.intensity=e.intensity),this.meshes.forEach(e=>e.object.material=e.material)}configure(e){this.object=e}update(e,t=100){if(!this.object)return;this.averagingWindow.value=t,this.object.material=this.targetMat;const n=this.buffer1Active?this.progressiveLightMap1:this.progressiveLightMap2,r=this.buffer1Active?this.progressiveLightMap2:this.progressiveLightMap1,s=this.scene.background;this.scene.background=null,this.renderer.setRenderTarget(n),this.previousShadowMap.value=r.texture,this.buffer1Active=!this.buffer1Active,this.renderer.render(this.scene,e),this.renderer.setRenderTarget(null),this.scene.background=s}}const h2e={rembrandt:{main:[1,2,1],fill:[-2,-.5,-2]},portrait:{main:[-1,2,.5],fill:[-1,.5,-1.5]},upfront:{main:[0,2,1],fill:[-1,.5,-1.5]},soft:{main:[-2,4,4],fill:[-1,.5,-1.5]}};function f2e({radius:i,adjustCamera:e}){const t=OW();return w.useEffect(()=>{e&&t.refresh().clip().fit()},[i,e]),null}function d2e({children:i,center:e,adjustCamera:t=!0,intensity:n=.5,shadows:r="contact",environment:s="city",preset:o="rembrandt",...a}){var l,c,u,h,f,d,m,A;const g=typeof o=="string"?h2e[o]:o,[{radius:y,height:E},x]=w.useState({radius:0,width:0,height:0,depth:0}),C=(l=r==null?void 0:r.bias)!==null&&l!==void 0?l:-1e-4,T=(c=r==null?void 0:r.normalBias)!==null&&c!==void 0?c:0,I=(u=r==null?void 0:r.size)!==null&&u!==void 0?u:1024,M=(h=r==null?void 0:r.offset)!==null&&h!==void 0?h:0,L=r==="contact"||(r==null?void 0:r.type)==="contact",R=r==="accumulative"||(r==null?void 0:r.type)==="accumulative",P={...typeof r=="object"?r:{}},F=s?typeof s=="string"?{preset:s}:s:null,k=w.useCallback(z=>{const{width:U,height:W,depth:$,boundingSphere:oe}=z;x({radius:oe.radius,width:U,height:W,depth:$}),e!=null&&e.onCentered&&e.onCentered(z)},[]);return w.createElement(w.Fragment,null,w.createElement("ambientLight",{intensity:n/3}),w.createElement("spotLight",{penumbra:1,position:[g.main[0]*y,g.main[1]*y,g.main[2]*y],intensity:n*2,castShadow:!!r,"shadow-bias":C,"shadow-normalBias":T,"shadow-mapSize":I}),w.createElement("pointLight",{position:[g.fill[0]*y,g.fill[1]*y,g.fill[2]*y],intensity:n}),w.createElement(FW,ot({fit:!!t,clip:!!t,margin:Number(t),observe:!0},a),w.createElement(f2e,{radius:y,adjustCamera:t}),w.createElement(s8,ot({},e,{position:[0,M/2,0],onCentered:k}),i)),w.createElement("group",{position:[0,-E/2-M/2,0]},L&&w.createElement(WW,ot({scale:y*4,far:y,blur:2},P)),R&&w.createElement(jW,ot({temporal:!0,frames:100,alphaTest:.9,toneMapped:!0,scale:y*4},P),w.createElement(KW,{amount:(f=P.amount)!==null&&f!==void 0?f:8,radius:(d=P.radius)!==null&&d!==void 0?d:y,ambient:(m=P.ambient)!==null&&m!==void 0?m:.5,intensity:(A=P.intensity)!==null&&A!==void 0?A:1,position:[g.main[0]*y,g.main[1]*y,g.main[2]*y],size:y*4,bias:-C,mapSize:I}))),s&&w.createElement(VW,F))}const p2e=i=>i===0?0:Math.pow(2,10*i-10);function m2e({children:i,floor:e=.25,segments:t=20,receiveShadow:n,...r}){const s=w.useRef(null);return w.useLayoutEffect(()=>{let o=0;const a=t/t/2,l=s.current.attributes.position;for(let c=0;c<t+1;c++)for(let u=0;u<t+1;u++)l.setXYZ(o++,c/t-a+(c===0?-e:0),u/t-a,p2e(c/t));l.needsUpdate=!0,s.current.computeVertexNormals()},[t,e]),w.createElement("group",r,w.createElement("mesh",{receiveShadow:n,rotation:[-Math.PI/2,0,Math.PI/2]},w.createElement("planeGeometry",{ref:s,args:[1,1,t,t]}),i))}const g2e=w.forwardRef(({fog:i=!1,renderOrder:e,depthWrite:t=!1,colorStop:n=0,color:r="black",opacity:s=.5,...o},a)=>{const l=w.useMemo(()=>{const c=document.createElement("canvas");c.width=128,c.height=128;const u=c.getContext("2d"),h=u.createRadialGradient(c.width/2,c.height/2,0,c.width/2,c.height/2,c.width/2);return h.addColorStop(n,new ut(r).getStyle()),h.addColorStop(1,"rgba(0,0,0,0)"),u.fillStyle=h,u.fillRect(0,0,c.width,c.height),c},[r,n]);return w.createElement("mesh",ot({renderOrder:e,ref:a,"rotation-x":-Math.PI/2},o),w.createElement("planeGeometry",null),w.createElement("meshBasicMaterial",{transparent:!0,opacity:s,fog:i,depthWrite:t,side:Pi},w.createElement("canvasTexture",{attach:"map",args:[l]})))});function wF(i=tl){const e={value:new Xe};return Object.assign(new U6({side:i}),{viewMatrix:e,onBeforeCompile:t=>{t.uniforms.viewMatrix=e,t.fragmentShader=`vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
           return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
         }
`+t.fragmentShader.replace("#include <normal_fragment_maps>",`#include <normal_fragment_maps>
           normal = inverseTransformDirection( normal, viewMatrix );
`)}})}const A2e=Ec({causticsTexture:null,causticsTextureB:null,color:new ut,lightProjMatrix:new Xe,lightViewMatrix:new Xe},`varying vec3 vWorldPosition;
   void main() {
     gl_Position = projectionMatrix * viewMatrix * modelMatrix * vec4(position, 1.);
     vec4 worldPosition = modelMatrix * vec4(position, 1.);
     vWorldPosition = worldPosition.xyz;
   }`,`varying vec3 vWorldPosition;
  uniform vec3 color;
  uniform sampler2D causticsTexture;
  uniform sampler2D causticsTextureB;
  uniform mat4 lightProjMatrix;
  uniform mat4 lightViewMatrix;
   void main() {
    // Apply caustics
    vec4 lightSpacePos = lightProjMatrix * lightViewMatrix * vec4(vWorldPosition, 1.0);
    lightSpacePos.xyz /= lightSpacePos.w;
    lightSpacePos.xyz = lightSpacePos.xyz * 0.5 + 0.5;
    vec3 front = texture2D(causticsTexture, lightSpacePos.xy).rgb;
    vec3 back = texture2D(causticsTextureB, lightSpacePos.xy).rgb;
    gl_FragColor = vec4((front + back) * color, 1.0);
    #include <tonemapping_fragment>
    #include <${ea>=154?"colorspace_fragment":"encodings_fragment"}>
   }`),y2e=Ec({cameraMatrixWorld:new Xe,cameraProjectionMatrixInv:new Xe,normalTexture:null,depthTexture:null,lightDir:new H(0,1,0),lightPlaneNormal:new H(0,1,0),lightPlaneConstant:0,near:.1,far:100,modelMatrix:new Xe,worldRadius:1/40,ior:1.1,bounces:0,resolution:1024,size:10,intensity:.5},`
  varying vec2 vUv;
  void main() {
      vUv = uv;
      gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
  }`,`
  uniform mat4 cameraMatrixWorld;
  uniform mat4 cameraProjectionMatrixInv;
  uniform vec3 lightDir;
  uniform vec3 lightPlaneNormal;
  uniform float lightPlaneConstant;
  uniform float near;
  uniform float far;
  uniform float time;
  uniform float worldRadius;
  uniform float resolution;
  uniform float size;
  uniform float intensity;
  uniform float ior;
  precision highp isampler2D;
  precision highp usampler2D;
  uniform sampler2D normalTexture;
  uniform sampler2D depthTexture;
  uniform float bounces;
  varying vec2 vUv;
  vec3 WorldPosFromDepth(float depth, vec2 coord) {
    float z = depth * 2.0 - 1.0;
    vec4 clipSpacePosition = vec4(coord * 2.0 - 1.0, z, 1.0);
    vec4 viewSpacePosition = cameraProjectionMatrixInv * clipSpacePosition;
    // Perspective division
    viewSpacePosition /= viewSpacePosition.w;
    vec4 worldSpacePosition = cameraMatrixWorld * viewSpacePosition;
    return worldSpacePosition.xyz;
  }
  float sdPlane( vec3 p, vec3 n, float h ) {
    // n must be normalized
    return dot(p,n) + h;
  }
  float planeIntersect( vec3 ro, vec3 rd, vec4 p ) {
    return -(dot(ro,p.xyz)+p.w)/dot(rd,p.xyz);
  }
  vec3 totalInternalReflection(vec3 ro, vec3 rd, vec3 pos, vec3 normal, float ior, out vec3 rayOrigin, out vec3 rayDirection) {
    rayOrigin = ro;
    rayDirection = rd;
    rayDirection = refract(rayDirection, normal, 1.0 / ior);
    rayOrigin = pos + rayDirection * 0.1;
    return rayDirection;
  }
  void main() {
    // Each sample consists of random offset in the x and y direction
    float caustic = 0.0;
    float causticTexelSize = (1.0 / resolution) * size * 2.0;
    float texelsNeeded = worldRadius / causticTexelSize;
    float sampleRadius = texelsNeeded / resolution;
    float sum = 0.0;
    if (texture2D(depthTexture, vUv).x == 1.0) {
      gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);
      return;
    }
    vec2 offset1 = vec2(-0.5, -0.5);//vec2(rand() - 0.5, rand() - 0.5);
    vec2 offset2 = vec2(-0.5, 0.5);//vec2(rand() - 0.5, rand() - 0.5);
    vec2 offset3 = vec2(0.5, 0.5);//vec2(rand() - 0.5, rand() - 0.5);
    vec2 offset4 = vec2(0.5, -0.5);//vec2(rand() - 0.5, rand() - 0.5);
    vec2 uv1 = vUv + offset1 * sampleRadius;
    vec2 uv2 = vUv + offset2 * sampleRadius;
    vec2 uv3 = vUv + offset3 * sampleRadius;
    vec2 uv4 = vUv + offset4 * sampleRadius;
    vec3 normal1 = texture2D(normalTexture, uv1, -10.0).rgb * 2.0 - 1.0;
    vec3 normal2 = texture2D(normalTexture, uv2, -10.0).rgb * 2.0 - 1.0;
    vec3 normal3 = texture2D(normalTexture, uv3, -10.0).rgb * 2.0 - 1.0;
    vec3 normal4 = texture2D(normalTexture, uv4, -10.0).rgb * 2.0 - 1.0;
    float depth1 = texture2D(depthTexture, uv1, -10.0).x;
    float depth2 = texture2D(depthTexture, uv2, -10.0).x;
    float depth3 = texture2D(depthTexture, uv3, -10.0).x;
    float depth4 = texture2D(depthTexture, uv4, -10.0).x;
    // Sanity check the depths
    if (depth1 == 1.0 || depth2 == 1.0 || depth3 == 1.0 || depth4 == 1.0) {
      gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);
      return;
    }
    vec3 pos1 = WorldPosFromDepth(depth1, uv1);
    vec3 pos2 = WorldPosFromDepth(depth2, uv2);
    vec3 pos3 = WorldPosFromDepth(depth3, uv3);
    vec3 pos4 = WorldPosFromDepth(depth4, uv4);
    vec3 originPos1 = WorldPosFromDepth(0.0, uv1);
    vec3 originPos2 = WorldPosFromDepth(0.0, uv2);
    vec3 originPos3 = WorldPosFromDepth(0.0, uv3);
    vec3 originPos4 = WorldPosFromDepth(0.0, uv4);
    vec3 endPos1, endPos2, endPos3, endPos4;
    vec3 endDir1, endDir2, endDir3, endDir4;
    totalInternalReflection(originPos1, lightDir, pos1, normal1, ior, endPos1, endDir1);
    totalInternalReflection(originPos2, lightDir, pos2, normal2, ior, endPos2, endDir2);
    totalInternalReflection(originPos3, lightDir, pos3, normal3, ior, endPos3, endDir3);
    totalInternalReflection(originPos4, lightDir, pos4, normal4, ior, endPos4, endDir4);
    float lightPosArea = length(cross(originPos2 - originPos1, originPos3 - originPos1)) + length(cross(originPos3 - originPos1, originPos4 - originPos1));
    float t1 = planeIntersect(endPos1, endDir1, vec4(lightPlaneNormal, lightPlaneConstant));
    float t2 = planeIntersect(endPos2, endDir2, vec4(lightPlaneNormal, lightPlaneConstant));
    float t3 = planeIntersect(endPos3, endDir3, vec4(lightPlaneNormal, lightPlaneConstant));
    float t4 = planeIntersect(endPos4, endDir4, vec4(lightPlaneNormal, lightPlaneConstant));
    vec3 finalPos1 = endPos1 + endDir1 * t1;
    vec3 finalPos2 = endPos2 + endDir2 * t2;
    vec3 finalPos3 = endPos3 + endDir3 * t3;
    vec3 finalPos4 = endPos4 + endDir4 * t4;
    float finalArea = length(cross(finalPos2 - finalPos1, finalPos3 - finalPos1)) + length(cross(finalPos3 - finalPos1, finalPos4 - finalPos1));
    caustic += intensity * (lightPosArea / finalArea);
    // Calculate the area of the triangle in light spaces
    gl_FragColor = vec4(vec3(max(caustic, 0.0)), 1.0);
  }`),CF={depth:!0,minFilter:Pn,magFilter:Pn,type:Zi},TF={minFilter:Bl,magFilter:Pn,type:fi,generateMipmaps:!0},v2e=w.forwardRef(({debug:i,children:e,frames:t=1,ior:n=1.1,color:r="white",causticsOnly:s=!1,backside:o=!1,backsideIOR:a=1.1,worldRadius:l=.3125,intensity:c=.05,resolution:u=2024,lightSource:h=[5,5,5],...f},d)=>{Or({CausticsProjectionMaterial:A2e});const m=w.useRef(null),A=w.useRef(null),g=w.useRef(null),y=w.useRef(null),E=Ve(ie=>ie.gl),x=t8(i&&A,bz),C=Ea(u,u,CF),T=Ea(u,u,CF),I=Ea(u,u,TF),M=Ea(u,u,TF),[L]=w.useState(()=>wF()),[R]=w.useState(()=>wF(ys)),[P]=w.useState(()=>new y2e),[F]=w.useState(()=>new Tf(P));w.useLayoutEffect(()=>{m.current.updateWorldMatrix(!1,!0)});let k=0;const z=new H,U=new h0,W=new Xe,$=new vo,oe=new H,X=new H,Q=new ti,Y=new H,O=[],K=[],te=[],q=[],J=new H;for(let ie=0;ie<8;ie++)O.push(new H),K.push(new H),te.push(new H),q.push(new H);return Kt(()=>{if(t===1/0||k++<t){var ie,re;Array.isArray(h)?oe.fromArray(h).normalize():oe.copy(m.current.worldToLocal(h.current.getWorldPosition(z)).normalize()),X.copy(oe).multiplyScalar(-1),(ie=g.current.parent)==null||ie.matrixWorld.identity(),Q.setFromObject(g.current,!0),O[0].set(Q.min.x,Q.min.y,Q.min.z),O[1].set(Q.min.x,Q.min.y,Q.max.z),O[2].set(Q.min.x,Q.max.y,Q.min.z),O[3].set(Q.min.x,Q.max.y,Q.max.z),O[4].set(Q.max.x,Q.min.y,Q.min.z),O[5].set(Q.max.x,Q.min.y,Q.max.z),O[6].set(Q.max.x,Q.max.y,Q.min.z),O[7].set(Q.max.x,Q.max.y,Q.max.z);for(let ne=0;ne<8;ne++)K[ne].copy(O[ne]);Q.getCenter(Y),O.map(ne=>ne.sub(Y));const se=$.set(X,0);O.map((ne,V)=>se.projectPoint(ne,te[V]));const ge=te.reduce((ne,V)=>ne.add(V),z.set(0,0,0)).divideScalar(te.length),xe=te.map(ne=>ne.distanceTo(ge)).reduce((ne,V)=>Math.max(ne,V)),pe=O.map(ne=>ne.dot(oe)).reduce((ne,V)=>Math.max(ne,V));A.current.position.copy(J.copy(oe).multiplyScalar(pe).add(Y)),A.current.lookAt(g.current.localToWorld(Y));const ce=W.lookAt(A.current.position,Y,z.set(0,1,0));A.current.left=-xe,A.current.right=xe,A.current.top=xe,A.current.bottom=-xe;const we=z.set(0,xe,0).applyMatrix4(ce),Ee=(A.current.position.y+we.y)/oe.y;A.current.near=.1,A.current.far=Ee,A.current.updateProjectionMatrix(),A.current.updateMatrixWorld();const ve=K.map((ne,V)=>ne.add(q[V].copy(oe).multiplyScalar(-ne.y/oe.y))),Ae=ve.reduce((ne,V)=>ne.add(V),z.set(0,0,0)).divideScalar(ve.length),Le=2*ve.map(ne=>Math.hypot(ne.x-Ae.x,ne.z-Ae.z)).reduce((ne,V)=>Math.max(ne,V));y.current.scale.setScalar(Le),y.current.position.copy(Ae),i&&((re=x.current)==null||re.update()),R.viewMatrix.value=L.viewMatrix.value=A.current.matrixWorldInverse;const Te=U.setFromProjectionMatrix(W.multiplyMatrices(A.current.projectionMatrix,A.current.matrixWorldInverse)).planes[4];P.cameraMatrixWorld=A.current.matrixWorld,P.cameraProjectionMatrixInv=A.current.projectionMatrixInverse,P.lightDir=X,P.lightPlaneNormal=Te.normal,P.lightPlaneConstant=Te.constant,P.near=A.current.near,P.far=A.current.far,P.resolution=u,P.size=xe,P.intensity=c,P.worldRadius=l,g.current.visible=!0,E.setRenderTarget(C),E.clear(),g.current.overrideMaterial=L,E.render(g.current,A.current),E.setRenderTarget(T),E.clear(),o&&(g.current.overrideMaterial=R,E.render(g.current,A.current)),g.current.overrideMaterial=null,P.ior=n,y.current.material.lightProjMatrix=A.current.projectionMatrix,y.current.material.lightViewMatrix=A.current.matrixWorldInverse,P.normalTexture=C.texture,P.depthTexture=C.depthTexture,E.setRenderTarget(I),E.clear(),F.render(E),P.ior=a,P.normalTexture=T.texture,P.depthTexture=T.depthTexture,E.setRenderTarget(M),E.clear(),o&&F.render(E),E.setRenderTarget(null),s&&(g.current.visible=!1)}}),w.useImperativeHandle(d,()=>m.current,[]),w.createElement("group",ot({ref:m},f),w.createElement("scene",{ref:g},w.createElement("orthographicCamera",{ref:A,up:[0,1,0]}),e),w.createElement("mesh",{renderOrder:2,ref:y,"rotation-x":-Math.PI/2},w.createElement("planeGeometry",null),w.createElement("causticsProjectionMaterial",{transparent:!0,color:r,causticsTexture:I.texture,causticsTextureB:M.texture,blending:pw,blendSrc:mw,blendDst:A2,depthWrite:!1}),i&&w.createElement(iQ,null,w.createElement("lineBasicMaterial",{color:"#ffff00",toneMapped:!1}))))}),x2e=w.forwardRef(({mixBlur:i=0,mixStrength:e=.5,resolution:t=256,blur:n=[0,0],args:r=[1,1],minDepthThreshold:s=.9,maxDepthThreshold:o=1,depthScale:a=0,depthToBlurRatioBias:l=.25,mirror:c=0,children:u,debug:h=0,distortion:f=1,mixContrast:d=1,distortionMap:m,...A},g)=>{Or({MeshReflectorMaterial:BW}),w.useEffect(()=>{console.warn("Reflector has been deprecated and will be removed next major. Replace it with <MeshReflectorMaterial />!")},[]);const y=Ve(({gl:te})=>te),E=Ve(({camera:te})=>te),x=Ve(({scene:te})=>te);n=Array.isArray(n)?n:[n,n];const C=n[0]+n[1]>0,T=w.useRef(null);w.useImperativeHandle(g,()=>T.current,[]);const[I]=w.useState(()=>new vo),[M]=w.useState(()=>new H),[L]=w.useState(()=>new H),[R]=w.useState(()=>new H),[P]=w.useState(()=>new Xe),[F]=w.useState(()=>new H(0,0,-1)),[k]=w.useState(()=>new Rn),[z]=w.useState(()=>new H),[U]=w.useState(()=>new H),[W]=w.useState(()=>new Rn),[$]=w.useState(()=>new Xe),[oe]=w.useState(()=>new Wn),X=w.useCallback(()=>{if(L.setFromMatrixPosition(T.current.matrixWorld),R.setFromMatrixPosition(E.matrixWorld),P.extractRotation(T.current.matrixWorld),M.set(0,0,1),M.applyMatrix4(P),z.subVectors(L,R),z.dot(M)>0)return;z.reflect(M).negate(),z.add(L),P.extractRotation(E.matrixWorld),F.set(0,0,-1),F.applyMatrix4(P),F.add(R),U.subVectors(L,F),U.reflect(M).negate(),U.add(L),oe.position.copy(z),oe.up.set(0,1,0),oe.up.applyMatrix4(P),oe.up.reflect(M),oe.lookAt(U),oe.far=E.far,oe.updateMatrixWorld(),oe.projectionMatrix.copy(E.projectionMatrix),$.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),$.multiply(oe.projectionMatrix),$.multiply(oe.matrixWorldInverse),$.multiply(T.current.matrixWorld),I.setFromNormalAndCoplanarPoint(M,L),I.applyMatrix4(oe.matrixWorldInverse),k.set(I.normal.x,I.normal.y,I.normal.z,I.constant);const te=oe.projectionMatrix;W.x=(Math.sign(k.x)+te.elements[8])/te.elements[0],W.y=(Math.sign(k.y)+te.elements[9])/te.elements[5],W.z=-1,W.w=(1+te.elements[10])/te.elements[14],k.multiplyScalar(2/k.dot(W)),te.elements[2]=k.x,te.elements[6]=k.y,te.elements[10]=k.z+1,te.elements[14]=k.w},[]),[Q,Y,O,K]=w.useMemo(()=>{const te={type:Ni,minFilter:Pn,magFilter:Pn},q=new Si(t,t,te);q.depthBuffer=!0,q.depthTexture=new f0(t,t),q.depthTexture.format=vu,q.depthTexture.type=pp;const J=new Si(t,t,te),ie=new PW({gl:y,resolution:t,width:n[0],height:n[1],minDepthThreshold:s,maxDepthThreshold:o,depthScale:a,depthToBlurRatioBias:l}),re={mirror:c,textureMatrix:$,mixBlur:i,tDiffuse:q.texture,tDepth:q.depthTexture,tDiffuseBlur:J.texture,hasBlur:C,mixStrength:e,minDepthThreshold:s,maxDepthThreshold:o,depthScale:a,depthToBlurRatioBias:l,transparent:!0,debug:h,distortion:f,distortionMap:m,mixContrast:d,"defines-USE_BLUR":C?"":void 0,"defines-USE_DEPTH":a>0?"":void 0,"defines-USE_DISTORTION":m?"":void 0};return[q,J,ie,re]},[y,n,$,t,c,C,i,e,s,o,a,l,h,f,m,d]);return Kt(()=>{if(!(T!=null&&T.current))return;T.current.visible=!1;const te=y.xr.enabled,q=y.shadowMap.autoUpdate;X(),y.xr.enabled=!1,y.shadowMap.autoUpdate=!1,y.setRenderTarget(Q),y.state.buffers.depth.setMask(!0),y.autoClear||y.clear(),y.render(x,oe),C&&O.render(y,Q,Y),y.xr.enabled=te,y.shadowMap.autoUpdate=q,T.current.visible=!0,y.setRenderTarget(null)}),w.createElement("mesh",ot({ref:T},A),w.createElement("planeGeometry",{args:r}),u?u("meshReflectorMaterial",K):w.createElement("meshReflectorMaterial",K))});class E2e extends Mi{constructor(){super({uniforms:{depth:{value:null},opacity:{value:1},attenuation:{value:2.5},anglePower:{value:12},spotPosition:{value:new H(0,0,0)},lightColor:{value:new ut("white")},cameraNear:{value:0},cameraFar:{value:1},resolution:{value:new Ue(0,0)}},transparent:!0,depthWrite:!1,vertexShader:`
        varying vec3 vNormal;
        varying float vViewZ;
        varying float vIntensity;
        uniform vec3 spotPosition;
        uniform float attenuation;

        #include <common>
        #include <logdepthbuf_pars_vertex>

        void main() {
          // compute intensity
          vNormal = normalize(normalMatrix * normal);
          vec4 worldPosition = modelMatrix * vec4(position, 1);
          vec4 viewPosition = viewMatrix * worldPosition;
          vViewZ = viewPosition.z;

          vIntensity = 1.0 - saturate(distance(worldPosition.xyz, spotPosition) / attenuation);

          gl_Position = projectionMatrix * viewPosition;

          #include <logdepthbuf_vertex>
        }
      `,fragmentShader:`
        varying vec3 vNormal;
        varying float vViewZ;
        varying float vIntensity;

        uniform vec3 lightColor;
        uniform float anglePower;
        uniform sampler2D depth;
        uniform vec2 resolution;
        uniform float cameraNear;
        uniform float cameraFar;
        uniform float opacity;

        #include <packing>
        #include <logdepthbuf_pars_fragment>

        float readDepth(sampler2D depthSampler, vec2 uv) {
          float fragCoordZ = texture(depthSampler, uv).r;

          // https://github.com/mrdoob/three.js/issues/23072
          #ifdef USE_LOGDEPTHBUF
            float viewZ = 1.0 - exp2(fragCoordZ * log(cameraFar + 1.0) / log(2.0));
          #else
            float viewZ = perspectiveDepthToViewZ(fragCoordZ, cameraNear, cameraFar);
          #endif

          return viewZ;
        }

        void main() {
          #include <logdepthbuf_fragment>

          vec3 normal = vec3(vNormal.x, vNormal.y, abs(vNormal.z));
          float angleIntensity = pow(dot(normal, vec3(0, 0, 1)), anglePower);
          float intensity = vIntensity * angleIntensity;

          // fades when z is close to sampled depth, meaning the cone is intersecting existing geometry
          bool isSoft = resolution[0] > 0.0 && resolution[1] > 0.0;
          if (isSoft) {
            vec2 uv = gl_FragCoord.xy / resolution;
            intensity *= smoothstep(0.0, 1.0, vViewZ - readDepth(depth, uv));
          }

          gl_FragColor = vec4(lightColor, intensity * opacity);

          #include <tonemapping_fragment>
          #include <${ea>=154?"colorspace_fragment":"encodings_fragment"}>
        }
      `})}}var _2e=`#define GLSLIFY 1
varying vec2 vUv;uniform sampler2D uShadowMap;uniform float uTime;void main(){vec3 color=texture2D(uShadowMap,vUv).xyz;gl_FragColor=vec4(color,1.);}`;const S2e=i=>i==null?void 0:i.isSpotLight;function w2e({opacity:i=1,radiusTop:e,radiusBottom:t,depthBuffer:n,color:r="white",distance:s=5,angle:o=.15,attenuation:a=5,anglePower:l=5}){const c=w.useRef(null),u=Ve(g=>g.size),h=Ve(g=>g.camera),f=Ve(g=>g.viewport.dpr),[d]=w.useState(()=>new E2e),[m]=w.useState(()=>new H);e=e===void 0?.1:e,t=t===void 0?o*7:t,Kt(()=>{d.uniforms.spotPosition.value.copy(c.current.getWorldPosition(m)),c.current.lookAt(c.current.parent.target.getWorldPosition(m))});const A=w.useMemo(()=>{const g=new yo(e,t,s,128,64,!0);return g.applyMatrix4(new Xe().makeTranslation(0,-s/2,0)),g.applyMatrix4(new Xe().makeRotationX(-Math.PI/2)),g},[s,e,t]);return w.createElement(w.Fragment,null,w.createElement("mesh",{ref:c,geometry:A,raycast:()=>null},w.createElement("primitive",{object:d,attach:"material","uniforms-opacity-value":i,"uniforms-lightColor-value":r,"uniforms-attenuation-value":a,"uniforms-anglePower-value":l,"uniforms-depth-value":n,"uniforms-cameraNear-value":h.near,"uniforms-cameraFar-value":h.far,"uniforms-resolution-value":n?[u.width*f,u.height*f]:[0,0]})))}function $W(i,e,t,n,r){const[[s,o]]=w.useState(()=>[new H,new H]);w.useLayoutEffect(()=>{if(S2e(i.current))i.current.shadow.mapSize.set(t,n),i.current.shadow.needsUpdate=!0;else throw new Error("SpotlightShadow must be a child of a SpotLight")},[i,t,n]),Kt(()=>{if(!i.current)return;const a=i.current.position,l=i.current.target.position;o.copy(l).sub(a);var c=o.length();o.normalize().multiplyScalar(c*r),s.copy(a).add(o),e.current.position.copy(s),e.current.lookAt(i.current.target.position)})}function C2e({distance:i=.4,alphaTest:e=.5,map:t,shader:n=_2e,width:r=512,height:s=512,scale:o=1,children:a,...l}){const c=w.useRef(null),u=l.spotlightRef,h=l.debug;$W(u,c,r,s,i);const f=w.useMemo(()=>new Si(r,s,{format:gi,stencilBuffer:!1}),[r,s]),d=w.useRef({uShadowMap:{value:t},uTime:{value:0}});w.useEffect(()=>void(d.current.uShadowMap.value=t),[t]);const m=w.useMemo(()=>new Tf(new Mi({uniforms:d.current,vertexShader:`
          varying vec2 vUv;

          void main() {
            vUv = uv;
            gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
          }
          `,fragmentShader:n})),[n]);return w.useEffect(()=>()=>{m.material.dispose(),m.dispose()},[m]),w.useEffect(()=>()=>f.dispose(),[f]),Kt(({gl:A},g)=>{d.current.uTime.value+=g,A.setRenderTarget(f),m.render(A),A.setRenderTarget(null)}),w.createElement(w.Fragment,null,w.createElement("mesh",{ref:c,scale:o,castShadow:!0},w.createElement("planeGeometry",null),w.createElement("meshBasicMaterial",{transparent:!0,side:Pi,alphaTest:e,alphaMap:f.texture,"alphaMap-wrapS":_o,"alphaMap-wrapT":_o,opacity:h?1:0},a)))}function T2e({distance:i=.4,alphaTest:e=.5,map:t,width:n=512,height:r=512,scale:s,children:o,...a}){const l=w.useRef(null),c=a.spotlightRef,u=a.debug;return $W(c,l,n,r,i),w.createElement(w.Fragment,null,w.createElement("mesh",{ref:l,scale:s,castShadow:!0},w.createElement("planeGeometry",null),w.createElement("meshBasicMaterial",{transparent:!0,side:Pi,alphaTest:e,alphaMap:t,"alphaMap-wrapS":_o,"alphaMap-wrapT":_o,opacity:u?1:0},o)))}function b2e(i){return i.shader?w.createElement(C2e,i):w.createElement(T2e,i)}const I2e=w.forwardRef(({opacity:i=1,radiusTop:e,radiusBottom:t,depthBuffer:n,color:r="white",distance:s=5,angle:o=.15,attenuation:a=5,anglePower:l=5,volumetric:c=!0,debug:u=!1,children:h,...f},d)=>{const m=w.useRef(null);return w.useImperativeHandle(d,()=>m.current,[]),w.createElement("group",null,u&&m.current&&w.createElement("spotLightHelper",{args:[m.current]}),w.createElement("spotLight",ot({ref:m,angle:o,color:r,distance:s,castShadow:!0},f),c&&w.createElement(w2e,{debug:u,opacity:i,radiusTop:e,radiusBottom:t,depthBuffer:n,color:r,distance:s,angle:o,attenuation:a,anglePower:l})),h&&w.cloneElement(h,{spotlightRef:m,debug:u}))}),M2e=w.forwardRef(({light:i,args:e,map:t,toneMapped:n=!1,color:r="white",form:s="rect",intensity:o=1,scale:a=1,target:l=[0,0,0],children:c,...u},h)=>{const f=w.useRef(null);return w.useImperativeHandle(h,()=>f.current,[]),w.useLayoutEffect(()=>{!c&&!u.material&&(Os(f.current.material,{color:r}),f.current.material.color.multiplyScalar(o))},[r,o,c,u.material]),w.useLayoutEffect(()=>{u.rotation||f.current.quaternion.identity(),l&&!u.rotation&&(typeof l=="boolean"?f.current.lookAt(0,0,0):f.current.lookAt(Array.isArray(l)?new H(...l):l))},[l,u.rotation]),a=Array.isArray(a)&&a.length===2?[a[0],a[1],1]:a,w.createElement("mesh",ot({ref:f,scale:a},u),s==="circle"?w.createElement("ringGeometry",{args:e||[0,.5,64]}):s==="ring"?w.createElement("ringGeometry",{args:e||[.25,.5,64]}):s==="rect"||s==="plane"?w.createElement("planeGeometry",{args:e||[1,1]}):s==="box"?w.createElement("boxGeometry",{args:e||[1,1,1]}):w.createElement(s,{args:e}),c||w.createElement("meshBasicMaterial",{toneMapped:n,map:t,side:Pi}),i&&w.createElement("pointLight",ot({castShadow:!0},i)))});function YW(i,e,t=new H){const n=Math.PI*(i-.5),r=2*Math.PI*(e-.5);return t.x=Math.cos(r),t.y=Math.sin(n),t.z=Math.sin(r),t}const R2e=w.forwardRef(({inclination:i=.6,azimuth:e=.1,distance:t=1e3,mieCoefficient:n=.005,mieDirectionalG:r=.8,rayleigh:s=.5,turbidity:o=10,sunPosition:a=YW(i,e),...l},c)=>{const u=w.useMemo(()=>new H().setScalar(t),[t]),[h]=w.useState(()=>new Ile);return w.createElement("primitive",ot({object:h,ref:c,"material-uniforms-mieCoefficient-value":n,"material-uniforms-mieDirectionalG-value":r,"material-uniforms-rayleigh-value":s,"material-uniforms-sunPosition-value":a,"material-uniforms-turbidity-value":o,scale:u},l))});class L2e extends Mi{constructor(){super({uniforms:{time:{value:0},fade:{value:1}},vertexShader:`
      uniform float time;
      attribute float size;
      varying vec3 vColor;
      void main() {
        vColor = color;
        vec4 mvPosition = modelViewMatrix * vec4(position, 0.5);
        gl_PointSize = size * (30.0 / -mvPosition.z) * (3.0 + sin(time + 100.0));
        gl_Position = projectionMatrix * mvPosition;
      }`,fragmentShader:`
      uniform sampler2D pointTexture;
      uniform float fade;
      varying vec3 vColor;
      void main() {
        float opacity = 1.0;
        if (fade == 1.0) {
          float d = distance(gl_PointCoord, vec2(0.5, 0.5));
          opacity = 1.0 / (1.0 + exp(16.0 * (d - 0.25)));
        }
        gl_FragColor = vec4(vColor, opacity);

        #include <tonemapping_fragment>
	      #include <${ea>=154?"colorspace_fragment":"encodings_fragment"}>
      }`})}}const P2e=i=>new H().setFromSpherical(new e0(i,Math.acos(1-Math.random()*2),Math.random()*2*Math.PI)),B2e=w.forwardRef(({radius:i=100,depth:e=50,count:t=5e3,saturation:n=0,factor:r=4,fade:s=!1,speed:o=1},a)=>{const l=w.useRef(),[c,u,h]=w.useMemo(()=>{const d=[],m=[],A=Array.from({length:t},()=>(.5+.5*Math.random())*r),g=new ut;let y=i+e;const E=e/t;for(let x=0;x<t;x++)y-=E*Math.random(),d.push(...P2e(y).toArray()),g.setHSL(x/t,n,.9),m.push(g.r,g.g,g.b);return[new Float32Array(d),new Float32Array(m),new Float32Array(A)]},[t,e,r,i,n]);Kt(d=>l.current&&(l.current.uniforms.time.value=d.clock.elapsedTime*o));const[f]=w.useState(()=>new L2e);return w.createElement("points",{ref:a},w.createElement("bufferGeometry",null,w.createElement("bufferAttribute",{attach:"attributes-position",args:[c,3]}),w.createElement("bufferAttribute",{attach:"attributes-color",args:[u,3]}),w.createElement("bufferAttribute",{attach:"attributes-size",args:[h,1]})),w.createElement("primitive",{ref:l,object:f,attach:"material",blending:AS,"uniforms-fade-value":s,depthWrite:!1,transparent:!0,vertexColors:!0}))}),D2e="https://rawcdn.githack.com/pmndrs/drei-assets/9225a9f1fbd449d9411125c2f419b843d0308c9f/cloud.png",bF=new Xe,C_=new H,T_=new Xt,IF=new H,MF=new Xt,wv=new H,m8=w.createContext(null),XW=w.forwardRef(({children:i,material:e=fx,texture:t=D2e,range:n,limit:r=200,frustumCulled:s,...o},a)=>{var l,c;const u=w.useMemo(()=>class extends e{constructor(){super();const L=parseInt(dp.replace(/\D+/g,""))>=154?"opaque_fragment":"output_fragment";this.onBeforeCompile=R=>{R.vertexShader=`attribute float cloudOpacity;
               varying float vOpacity;
              `+R.vertexShader.replace("#include <fog_vertex>",`#include <fog_vertex>
                 vOpacity = cloudOpacity;
                `),R.fragmentShader=`varying float vOpacity;
              `+R.fragmentShader.replace(`#include <${L}>`,`#include <${L}>
                 gl_FragColor = vec4(outgoingLight, diffuseColor.a * vOpacity);
                `)}}},[e]);Or({CloudMaterial:u});const h=w.useRef(null),f=w.useRef([]),d=w.useMemo(()=>new Float32Array(Array.from({length:r},()=>1)),[r]),m=w.useMemo(()=>new Float32Array(Array.from({length:r},()=>[1,1,1]).flat()),[r]),A=xp(t);let g=0,y=0,E;const x=new Xt,C=new H(0,0,1),T=new H;Kt((L,R)=>{for(g=L.clock.elapsedTime,bF.copy(h.current.matrixWorld).invert(),L.camera.matrixWorld.decompose(IF,MF,wv),y=0;y<f.current.length;y++)E=f.current[y],E.ref.current.matrixWorld.decompose(C_,T_,wv),C_.add(T.copy(E.position).applyQuaternion(T_).multiply(wv)),T_.copy(MF).multiply(x.setFromAxisAngle(C,E.rotation+=R*E.rotationFactor)),wv.multiplyScalar(E.volume+(1+Math.sin(g*E.density*E.speed))/2*E.growth),E.matrix.compose(C_,T_,wv).premultiply(bF),E.dist=C_.distanceTo(IF);for(f.current.sort((P,F)=>F.dist-P.dist),y=0;y<f.current.length;y++)E=f.current[y],d[y]=E.opacity*(E.dist<E.fade-1?E.dist/E.fade:1),h.current.setMatrixAt(y,E.matrix),h.current.setColorAt(y,E.color);h.current.geometry.attributes.cloudOpacity.needsUpdate=!0,h.current.instanceMatrix.needsUpdate=!0,h.current.instanceColor&&(h.current.instanceColor.needsUpdate=!0)}),w.useLayoutEffect(()=>{const L=Math.min(r,n!==void 0?n:r,f.current.length);h.current.count=L,f2(h.current.instanceMatrix,{offset:0,count:L*16}),h.current.instanceColor&&f2(h.current.instanceColor,{offset:0,count:L*3}),f2(h.current.geometry.attributes.cloudOpacity,{offset:0,count:L})});let I=[(l=A.image.width)!==null&&l!==void 0?l:1,(c=A.image.height)!==null&&c!==void 0?c:1];const M=Math.max(I[0],I[1]);return I=[I[0]/M,I[1]/M],w.createElement("group",ot({ref:a},o),w.createElement(m8.Provider,{value:f},i,w.createElement("instancedMesh",{matrixAutoUpdate:!1,ref:h,args:[null,null,r],frustumCulled:s},w.createElement("instancedBufferAttribute",{usage:No,attach:"instanceColor",args:[m,3]}),w.createElement("planeGeometry",{args:[...I]},w.createElement("instancedBufferAttribute",{usage:No,attach:"attributes-cloudOpacity",args:[d,1]})),w.createElement("cloudMaterial",{key:e.name,map:A,transparent:!0,depthWrite:!1}))))}),H5=w.forwardRef(({opacity:i=1,speed:e=0,bounds:t=[5,1,1],segments:n=20,color:r="#ffffff",fade:s=10,volume:o=6,smallestVolume:a=.25,distribute:l=null,growth:c=4,concentrate:u="inside",seed:h=Math.random(),...f},d)=>{function m(){const x=Math.sin(h++)*1e4;return x-Math.floor(x)}const A=w.useContext(m8),g=w.useRef(null),y=w.useId(),E=w.useMemo(()=>[...new Array(n)].map((x,C)=>({segments:n,bounds:new H(1,1,1),position:new H,uuid:y,index:C,ref:g,dist:0,matrix:new Xe,color:new ut,rotation:C*(Math.PI/n)})),[n,y]);return w.useLayoutEffect(()=>{E.forEach((x,C)=>{Os(x,{volume:o,color:r,speed:e,growth:c,opacity:i,fade:s,bounds:t,density:Math.max(.5,m()),rotationFactor:Math.max(.2,.5*m())*e});const T=l==null?void 0:l(x,C);if(T||n>1){var I;x.position.copy(x.bounds).multiply((I=T==null?void 0:T.point)!==null&&I!==void 0?I:{x:m()*2-1,y:m()*2-1,z:m()*2-1})}const M=Math.abs(x.position.x),L=Math.abs(x.position.y),R=Math.abs(x.position.z),P=Math.max(M,L,R);x.length=1,M===P&&(x.length-=M/x.bounds.x),L===P&&(x.length-=L/x.bounds.y),R===P&&(x.length-=R/x.bounds.z),x.volume=((T==null?void 0:T.volume)!==void 0?T.volume:Math.max(Math.max(0,a),u==="random"?m():u==="inside"?x.length:1-x.length))*o})},[u,t,s,r,i,c,o,h,n,e]),w.useLayoutEffect(()=>{const x=E;return A.current=[...A.current,...x],()=>{A.current=A.current.filter(C=>C.uuid!==y)}},[E]),w.useImperativeHandle(d,()=>g.current,[]),w.createElement("group",ot({ref:g},f))}),k2e=w.forwardRef((i,e)=>w.useContext(m8)?w.createElement(H5,ot({ref:e},i)):w.createElement(XW,null,w.createElement(H5,ot({ref:e},i))));class F2e extends Mi{constructor(){super({uniforms:{time:{value:0},pixelRatio:{value:1}},vertexShader:`
        uniform float pixelRatio;
        uniform float time;
        attribute float size;  
        attribute float speed;  
        attribute float opacity;
        attribute vec3 noise;
        attribute vec3 color;
        varying vec3 vColor;
        varying float vOpacity;

        void main() {
          vec4 modelPosition = modelMatrix * vec4(position, 1.0);
          modelPosition.y += sin(time * speed + modelPosition.x * noise.x * 100.0) * 0.2;
          modelPosition.z += cos(time * speed + modelPosition.x * noise.y * 100.0) * 0.2;
          modelPosition.x += cos(time * speed + modelPosition.x * noise.z * 100.0) * 0.2;
          vec4 viewPosition = viewMatrix * modelPosition;
          vec4 projectionPostion = projectionMatrix * viewPosition;
          gl_Position = projectionPostion;
          gl_PointSize = size * 25. * pixelRatio;
          gl_PointSize *= (1.0 / - viewPosition.z);
          vColor = color;
          vOpacity = opacity;
        }
      `,fragmentShader:`
        varying vec3 vColor;
        varying float vOpacity;
        void main() {
          float distanceToCenter = distance(gl_PointCoord, vec2(0.5));
          float strength = 0.05 / distanceToCenter - 0.1;
          gl_FragColor = vec4(vColor, strength * vOpacity);
          #include <tonemapping_fragment>
          #include <${ea>=154?"colorspace_fragment":"encodings_fragment"}>
        }
      `})}get time(){return this.uniforms.time.value}set time(e){this.uniforms.time.value=e}get pixelRatio(){return this.uniforms.pixelRatio.value}set pixelRatio(e){this.uniforms.pixelRatio.value=e}}const qW=i=>i&&i.constructor===Float32Array,O2e=i=>[i.r,i.g,i.b],JW=i=>i instanceof Ue||i instanceof H||i instanceof Rn,ZW=i=>Array.isArray(i)?i:JW(i)?i.toArray():[i,i,i];function Cv(i,e,t){return w.useMemo(()=>{if(e!==void 0){if(qW(e))return e;if(e instanceof ut){const n=Array.from({length:i*3},()=>O2e(e)).flat();return Float32Array.from(n)}else if(JW(e)||Array.isArray(e)){const n=Array.from({length:i*3},()=>ZW(e)).flat();return Float32Array.from(n)}return Float32Array.from({length:i},()=>e)}return Float32Array.from({length:i},t)},[e])}const N2e=w.forwardRef(({noise:i=1,count:e=100,speed:t=1,opacity:n=1,scale:r=1,size:s,color:o,children:a,...l},c)=>{w.useMemo(()=>Or({SparklesImplMaterial:F2e}),[]);const u=w.useRef(null),h=Ve(x=>x.viewport.dpr),f=ZW(r),d=w.useMemo(()=>Float32Array.from(Array.from({length:e},()=>f.map(un.randFloatSpread)).flat()),[e,...f]),m=Cv(e,s,Math.random),A=Cv(e,n),g=Cv(e,t),y=Cv(e*3,i),E=Cv(o===void 0?e*3:e,qW(o)?o:new ut(o),()=>1);return Kt(x=>{u.current&&u.current.material&&(u.current.material.time=x.clock.elapsedTime)}),w.useImperativeHandle(c,()=>u.current,[]),w.createElement("points",ot({key:`particle-${e}-${JSON.stringify(r)}`},l,{ref:u}),w.createElement("bufferGeometry",null,w.createElement("bufferAttribute",{attach:"attributes-position",args:[d,3]}),w.createElement("bufferAttribute",{attach:"attributes-size",args:[m,1]}),w.createElement("bufferAttribute",{attach:"attributes-opacity",args:[A,1]}),w.createElement("bufferAttribute",{attach:"attributes-speed",args:[g,1]}),w.createElement("bufferAttribute",{attach:"attributes-color",args:[E,3]}),w.createElement("bufferAttribute",{attach:"attributes-noise",args:[y,3]})),a||w.createElement("sparklesImplMaterial",{transparent:!0,pixelRatio:h,depthWrite:!1}))});function U2e(i){switch(i){case 64:return"-64px";case 128:return"-128px";case 256:return"-256px";case 512:return"-512px";default:return""}}const z2e="https://cdn.jsdelivr.net/gh/pmndrs/drei-assets@master/matcaps.json",G2e="https://rawcdn.githack.com/emmelleppi/matcaps/9b36ccaaf0a24881a39062d05566c9e92be4aa0d";function ej(i=0,e=1024,t){const n=Th(()=>fetch(z2e).then(u=>u.json()),["matcapList"]),r=n[0],s=w.useMemo(()=>Object.keys(n).length,[]),a=`${w.useMemo(()=>typeof i=="string"?i:typeof i=="number"?n[i]:null,[i])||r}${U2e(e)}.png`,l=`${G2e}/${e}/${a}`;return[xp(l,t),l,s]}const H2e=({children:i,id:e,format:t,onLoad:n})=>{const r=ej(e,t,n);return w.createElement(w.Fragment,null,i==null?void 0:i(r))},Q2e="https://rawcdn.githack.com/pmndrs/drei-assets/7a3104997e1576f83472829815b00880d88b32fb",V2e="https://cdn.jsdelivr.net/gh/pmndrs/drei-assets@master/normals/normals.json";function tj(i=0,e={},t){const{repeat:n=[1,1],anisotropy:r=1,offset:s=[0,0]}=e,o=Th(()=>fetch(V2e).then(f=>f.json()),["normalsList"]),a=w.useMemo(()=>Object.keys(o).length,[]),l=o[0],c=o[i]||l,u=`${Q2e}/normals/${c}`,h=xp(u,t);return w.useLayoutEffect(()=>{h&&(h.wrapS=h.wrapT=_o,h.repeat=new Ue(n[0],n[1]),h.offset=new Ue(s[0],s[1]),h.anisotropy=r)},[h,r,n,s]),[h,u,a]}const W2e=({children:i,id:e,onLoad:t,...n})=>{const r=tj(e,n,t);return w.createElement(w.Fragment,null,i==null?void 0:i(r))},Zd={uniforms:{strokeOpacity:1,fillOpacity:.25,fillMix:0,thickness:.05,colorBackfaces:!1,dashInvert:!0,dash:!1,dashRepeats:4,dashLength:.5,squeeze:!1,squeezeMin:.2,squeezeMax:1,stroke:new ut("#ff0000"),backfaceStroke:new ut("#0000ff"),fill:new ut("#00ff00")},vertex:`
	  attribute vec3 barycentric;
	
		varying vec3 v_edges_Barycentric;
		varying vec3 v_edges_Position;

		void initWireframe() {
			v_edges_Barycentric = barycentric;
			v_edges_Position = position.xyz;
		}
	  `,fragment:`
		#ifndef PI
	  	#define PI 3.1415926535897932384626433832795
		#endif
  
	  varying vec3 v_edges_Barycentric;
	  varying vec3 v_edges_Position;
  
	  uniform float strokeOpacity;
	  uniform float fillOpacity;
	  uniform float fillMix;
	  uniform float thickness;
	  uniform bool colorBackfaces;
  
	  // Dash
	  uniform bool dashInvert;
	  uniform bool dash;
	  uniform bool dashOnly;
	  uniform float dashRepeats;
	  uniform float dashLength;
  
	  // Squeeze
	  uniform bool squeeze;
	  uniform float squeezeMin;
	  uniform float squeezeMax;
  
	  // Colors
	  uniform vec3 stroke;
	  uniform vec3 backfaceStroke;
	  uniform vec3 fill;
  
	  // This is like
	  float wireframe_aastep(float threshold, float dist) {
		  float afwidth = fwidth(dist) * 0.5;
		  return smoothstep(threshold - afwidth, threshold + afwidth, dist);
	  }
  
	  float wireframe_map(float value, float min1, float max1, float min2, float max2) {
		  return min2 + (value - min1) * (max2 - min2) / (max1 - min1);
	  }
  
	  float getWireframe() {
			vec3 barycentric = v_edges_Barycentric;
		
			// Distance from center of each triangle to its edges.
			float d = min(min(barycentric.x, barycentric.y), barycentric.z);

			// for dashed rendering, we can use this to get the 0 .. 1 value of the line length
			float positionAlong = max(barycentric.x, barycentric.y);
			if (barycentric.y < barycentric.x && barycentric.y < barycentric.z) {
				positionAlong = 1.0 - positionAlong;
			}

			// the thickness of the stroke
			float computedThickness = wireframe_map(thickness, 0.0, 1.0, 0.0, 0.34);

			// if we want to shrink the thickness toward the center of the line segment
			if (squeeze) {
				computedThickness *= mix(squeezeMin, squeezeMax, (1.0 - sin(positionAlong * PI)));
			}

			// Create dash pattern
			if (dash) {
				// here we offset the stroke position depending on whether it
				// should overlap or not
				float offset = 1.0 / dashRepeats * dashLength / 2.0;
				if (!dashInvert) {
					offset += 1.0 / dashRepeats / 2.0;
				}

				// if we should animate the dash or not
				// if (dashAnimate) {
				// 	offset += time * 0.22;
				// }

				// create the repeating dash pattern
				float pattern = fract((positionAlong + offset) * dashRepeats);
				computedThickness *= 1.0 - wireframe_aastep(dashLength, pattern);
			}

			// compute the anti-aliased stroke edge  
			float edge = 1.0 - wireframe_aastep(computedThickness, d);

			return edge;
	  }
	  `},j2e=Ec(Zd.uniforms,Zd.vertex+`
  	void main() {
		initWireframe();
		gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
	}
  `,Zd.fragment+`
  void main () {
		// Compute color

		float edge = getWireframe();
		vec4 colorStroke = vec4(stroke, edge);

		#ifdef FLIP_SIDED
			colorStroke.rgb = backfaceStroke;
		#endif
    
		vec4 colorFill = vec4(fill, fillOpacity);
		vec4 outColor = mix(colorFill, colorStroke, edge * strokeOpacity);

		gl_FragColor = outColor;
	}
  `);function K2e(i,e){i.onBeforeCompile=t=>{t.uniforms={...t.uniforms,...e},t.vertexShader=t.vertexShader.replace("void main() {",`
		  ${Zd.vertex}
		  void main() {
			initWireframe();
		`),t.fragmentShader=t.fragmentShader.replace("void main() {",`
		  ${Zd.fragment}
		  void main() {
		`),t.fragmentShader=t.fragmentShader.replace("#include <color_fragment>",`
		  #include <color_fragment>
			  float edge = getWireframe();
		  vec4 colorStroke = vec4(stroke, edge);
		  #ifdef FLIP_SIDED
			colorStroke.rgb = backfaceStroke;
		  #endif
		  vec4 colorFill = vec4(mix(diffuseColor.rgb, fill, fillMix), mix(diffuseColor.a, fillOpacity, fillMix));
		  vec4 outColor = mix(colorFill, colorStroke, edge * strokeOpacity);

		  diffuseColor.rgb = outColor.rgb;
		  diffuseColor.a *= outColor.a;
		`)},i.side=Pi,i.transparent=!0}function $2e(i,e){w.useEffect(()=>{var t;return void(i.fillOpacity.value=(t=e.fillOpacity)!==null&&t!==void 0?t:i.fillOpacity.value)},[e.fillOpacity]),w.useEffect(()=>{var t;return void(i.fillMix.value=(t=e.fillMix)!==null&&t!==void 0?t:i.fillMix.value)},[e.fillMix]),w.useEffect(()=>{var t;return void(i.strokeOpacity.value=(t=e.strokeOpacity)!==null&&t!==void 0?t:i.strokeOpacity.value)},[e.strokeOpacity]),w.useEffect(()=>{var t;return void(i.thickness.value=(t=e.thickness)!==null&&t!==void 0?t:i.thickness.value)},[e.thickness]),w.useEffect(()=>void(i.colorBackfaces.value=!!e.colorBackfaces),[e.colorBackfaces]),w.useEffect(()=>void(i.dash.value=!!e.dash),[e.dash]),w.useEffect(()=>void(i.dashInvert.value=!!e.dashInvert),[e.dashInvert]),w.useEffect(()=>{var t;return void(i.dashRepeats.value=(t=e.dashRepeats)!==null&&t!==void 0?t:i.dashRepeats.value)},[e.dashRepeats]),w.useEffect(()=>{var t;return void(i.dashLength.value=(t=e.dashLength)!==null&&t!==void 0?t:i.dashLength.value)},[e.dashLength]),w.useEffect(()=>void(i.squeeze.value=!!e.squeeze),[e.squeeze]),w.useEffect(()=>{var t;return void(i.squeezeMin.value=(t=e.squeezeMin)!==null&&t!==void 0?t:i.squeezeMin.value)},[e.squeezeMin]),w.useEffect(()=>{var t;return void(i.squeezeMax.value=(t=e.squeezeMax)!==null&&t!==void 0?t:i.squeezeMax.value)},[e.squeezeMax]),w.useEffect(()=>void(i.stroke.value=e.stroke?new ut(e.stroke):i.stroke.value),[e.stroke]),w.useEffect(()=>void(i.fill.value=e.fill?new ut(e.fill):i.fill.value),[e.fill]),w.useEffect(()=>void(i.backfaceStroke.value=e.backfaceStroke?new ut(e.backfaceStroke):i.backfaceStroke.value),[e.backfaceStroke])}function Y2e(i){return!!(i!=null&&i.geometry)}function X2e(i){return!!(i!=null&&i.isBufferGeometry)}function q2e(i){return!!(i!=null&&i.current)}function RF(i){return(i==null?void 0:i.current)!==void 0}function LF(i){return i.type==="WireframeGeometry"}function J2e(){const i={};for(const e in Zd.uniforms)i[e]={value:Zd.uniforms[e]};return i}function Z2e(i,e){const n=i.getAttribute("position").count,r=[];for(let s=0;s<n;s++){const o=s%2===0,a=e?1:0;o?r.push(0,0,1,0,1,0,1,0,a):r.push(0,1,0,0,0,1,1,0,a)}return new mn(Float32Array.from(r),3)}function nj(i){const e=q2e(i)?i.current:i;if(X2e(e))return e;{if(LF(e))throw new Error("Wireframe: WireframeGeometry is not supported.");const t=e.parent;if(Y2e(t)){if(LF(t.geometry))throw new Error("Wireframe: WireframeGeometry is not supported.");return t.geometry}}}function ij(i,e){if(i.index){console.warn("Wireframe: Requires non-indexed geometry, converting to non-indexed geometry.");const n=i.toNonIndexed();i.copy(n),i.setIndex(null)}const t=Z2e(i,e);i.setAttribute("barycentric",t)}function exe({geometry:i,simplify:e=!1,...t}){Or({MeshWireframeMaterial:j2e});const[n,r]=w.useState(null);w.useLayoutEffect(()=>{const o=nj(i);if(!o)throw new Error("Wireframe: geometry prop must be a BufferGeometry or a ref to a BufferGeometry.");ij(o,e),RF(i)&&r(o)},[e,i]);const s=RF(i)?n:i;return w.createElement(w.Fragment,null,s&&w.createElement("mesh",{geometry:s},w.createElement("meshWireframeMaterial",ot({attach:"material",transparent:!0,side:Pi,polygonOffset:!0,polygonOffsetFactor:-4},t,{extensions:{derivatives:!0,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1}}))))}function txe({simplify:i=!1,...e}){const t=w.useRef(null),n=w.useMemo(()=>J2e(),[Zd.uniforms]);return $2e(n,e),w.useLayoutEffect(()=>{const r=nj(t);if(!r)throw new Error("Wireframe: Must be a child of a Mesh, Line or Points object or specify a geometry prop.");const s=r.clone();return ij(r,i),()=>{r.copy(s),s.dispose()}},[i]),w.useLayoutEffect(()=>{const r=t.current.parent,s=r.material.clone();return K2e(r.material,n),()=>{r.material.dispose(),r.material=s}},[]),w.createElement("object3D",{ref:t})}function nxe({geometry:i,...e}){return i?w.createElement(exe,ot({geometry:i},e)):w.createElement(txe,e)}function ixe({opacity:i,alphaMap:e}){const t=w.useRef(null),n=w.useRef(null),r=w.useRef({value:1}),s=w.useRef({value:null}),o=w.useRef({value:!1});return w.useLayoutEffect(()=>{t.current.onBeforeCompile=n.current.onBeforeCompile=a=>{const l=a.fragmentShader.indexOf("void main");let c="",u,h=l;for(;u!==`
`&&h<l+100;)u=a.fragmentShader.charAt(h),c+=u,h++;c=c.trim(),a.vertexShader=a.vertexShader.replace("void main() {",`
        varying vec2 custom_vUv;

        void main() {
          custom_vUv = uv;
          
        `),a.fragmentShader=a.fragmentShader.replace(c,`
          uniform float uShadowOpacity;
          uniform sampler2D uAlphaMap;
          uniform bool uHasAlphaMap;

          varying vec2 custom_vUv;
  
          float bayerDither2x2( vec2 v ) {
            return mod( 3.0 * v.y + 2.0 * v.x, 4.0 );
          }
    
          float bayerDither4x4( vec2 v ) {
            vec2 P1 = mod( v, 2.0 );
            vec2 P2 = mod( floor( 0.5  * v ), 2.0 );
            return 4.0 * bayerDither2x2( P1 ) + bayerDither2x2( P2 );
          }
  
          void main() {
            float alpha = 
              uHasAlphaMap ? 
                uShadowOpacity * texture2D(uAlphaMap, custom_vUv).x
              : uShadowOpacity;

            if( ( bayerDither4x4( floor( mod( gl_FragCoord.xy, 4.0 ) ) ) ) / 16.0 >= alpha ) discard;
            
          `),a.uniforms.uShadowOpacity=r.current,a.uniforms.uAlphaMap=s.current,a.uniforms.uHasAlphaMap=o.current}},[]),Kt(()=>{var a;const l=(a=t.current.__r3f)==null?void 0:a.parent;if(l){const c=l.material;c&&(r.current.value=i??c.opacity,e===!1?(s.current.value=null,o.current.value=!1):(s.current.value=e||c.alphaMap,o.current.value=!!s.current.value))}}),w.createElement(w.Fragment,null,w.createElement("meshDepthMaterial",{ref:t,attach:"customDepthMaterial",depthPacking:Ew}),w.createElement("meshDistanceMaterial",{ref:n,attach:"customDistanceMaterial"}))}const PF=new Xe,yI=new vc,BF=new Bi,rxe=new H;class rj extends xa{constructor(){super(),this.size=0,this.color=new ut("white"),this.instance={current:void 0},this.instanceKey={current:void 0}}get geometry(){var e;return(e=this.instance.current)==null?void 0:e.geometry}raycast(e,t){var n,r;const s=this.instance.current;if(!s||!s.geometry)return;const o=s.userData.instances.indexOf(this.instanceKey);if(o===-1||o>s.geometry.drawRange.count)return;const a=(n=(r=e.params.Points)==null?void 0:r.threshold)!==null&&n!==void 0?n:1;if(BF.set(this.getWorldPosition(rxe),a),e.ray.intersectsSphere(BF)===!1)return;PF.copy(s.matrixWorld).invert(),yI.copy(e.ray).applyMatrix4(PF);const l=a/((this.scale.x+this.scale.y+this.scale.z)/3),c=l*l,u=yI.distanceSqToPoint(this.position);if(u<c){const h=new H;yI.closestPointToPoint(this.position,h),h.applyMatrix4(this.matrixWorld);const f=e.ray.origin.distanceTo(h);if(f<e.near||f>e.far)return;t.push({distance:f,distanceToRay:Math.sqrt(u),point:h,index:o,face:null,object:this})}}}let Em,Tv;const sj=w.createContext(null),DF=new Xe,kF=new H,sxe=w.forwardRef(({children:i,range:e,limit:t=1e3,...n},r)=>{const s=w.useRef(null);w.useImperativeHandle(r,()=>s.current,[]);const[o,a]=w.useState([]),[[l,c,u]]=w.useState(()=>[new Float32Array(t*3),Float32Array.from({length:t*3},()=>1),Float32Array.from({length:t},()=>1)]);w.useEffect(()=>{s.current.geometry.attributes.position.needsUpdate=!0}),Kt(()=>{for(s.current.updateMatrix(),s.current.updateMatrixWorld(),DF.copy(s.current.matrixWorld).invert(),s.current.geometry.drawRange.count=Math.min(t,e!==void 0?e:t,o.length),Em=0;Em<o.length;Em++)Tv=o[Em].current,Tv.getWorldPosition(kF).applyMatrix4(DF),kF.toArray(l,Em*3),s.current.geometry.attributes.position.needsUpdate=!0,Tv.matrixWorldNeedsUpdate=!0,Tv.color.toArray(c,Em*3),s.current.geometry.attributes.color.needsUpdate=!0,u.set([Tv.size],Em),s.current.geometry.attributes.size.needsUpdate=!0});const h=w.useMemo(()=>({getParent:()=>s,subscribe:f=>(a(d=>[...d,f]),()=>a(d=>d.filter(m=>m.current!==f.current)))}),[]);return w.createElement("points",ot({userData:{instances:o},matrixAutoUpdate:!1,ref:s,raycast:()=>null},n),w.createElement("bufferGeometry",null,w.createElement("bufferAttribute",{attach:"attributes-position",count:l.length/3,array:l,itemSize:3,usage:No}),w.createElement("bufferAttribute",{attach:"attributes-color",count:c.length/3,array:c,itemSize:3,usage:No}),w.createElement("bufferAttribute",{attach:"attributes-size",count:u.length,array:u,itemSize:1,usage:No})),w.createElement(sj.Provider,{value:h},i))}),oxe=w.forwardRef(({children:i,...e},t)=>{w.useMemo(()=>Or({PositionPoint:rj}),[]);const n=w.useRef(null);w.useImperativeHandle(t,()=>n.current,[]);const{subscribe:r,getParent:s}=w.useContext(sj);return w.useLayoutEffect(()=>r(n),[]),w.createElement("positionPoint",ot({instance:s(),instanceKey:n,ref:n},e),i)}),oj=w.forwardRef(({children:i,positions:e,colors:t,sizes:n,stride:r=3,...s},o)=>{const a=w.useRef(null);return w.useImperativeHandle(o,()=>a.current,[]),Kt(()=>{const l=a.current.geometry.attributes;l.position.needsUpdate=!0,t&&(l.color.needsUpdate=!0),n&&(l.size.needsUpdate=!0)}),w.createElement("points",ot({ref:a},s),w.createElement("bufferGeometry",null,w.createElement("bufferAttribute",{attach:"attributes-position",count:e.length/r,array:e,itemSize:r,usage:No}),t&&w.createElement("bufferAttribute",{attach:"attributes-color",count:t.length/r,array:t,itemSize:3,usage:No}),n&&w.createElement("bufferAttribute",{attach:"attributes-size",count:n.length/r,array:n,itemSize:1,usage:No})),i)}),axe=w.forwardRef((i,e)=>i.positions instanceof Float32Array?w.createElement(oj,ot({},i,{ref:e})):w.createElement(sxe,ot({},i,{ref:e}))),aj=w.createContext(null),lxe=w.forwardRef((i,e)=>{w.useMemo(()=>Or({SegmentObject:lj}),[]);const{limit:t=1e3,lineWidth:n=1,children:r,...s}=i,[o,a]=w.useState([]),[l]=w.useState(()=>new NH),[c]=w.useState(()=>new l4),[u]=w.useState(()=>new a4),[h]=w.useState(()=>new Ue(512,512)),[f]=w.useState(()=>Array(t*6).fill(0)),[d]=w.useState(()=>Array(t*6).fill(0)),m=w.useMemo(()=>({subscribe:A=>(a(g=>[...g,A]),()=>a(g=>g.filter(y=>y.current!==A.current)))}),[]);return Kt(()=>{for(let g=0;g<t;g++){var A;const y=(A=o[g])==null?void 0:A.current;y&&(f[g*6+0]=y.start.x,f[g*6+1]=y.start.y,f[g*6+2]=y.start.z,f[g*6+3]=y.end.x,f[g*6+4]=y.end.y,f[g*6+5]=y.end.z,d[g*6+0]=y.color.r,d[g*6+1]=y.color.g,d[g*6+2]=y.color.b,d[g*6+3]=y.color.r,d[g*6+4]=y.color.g,d[g*6+5]=y.color.b)}u.setColors(d),u.setPositions(f),l.computeLineDistances()}),w.createElement("primitive",{object:l,ref:e},w.createElement("primitive",{object:u,attach:"geometry"}),w.createElement("primitive",ot({object:c,attach:"material",vertexColors:!0,resolution:h,linewidth:n},s)),w.createElement(aj.Provider,{value:m},r))});class lj{constructor(){this.color=new ut("white"),this.start=new H(0,0,0),this.end=new H(0,0,0)}}const FF=i=>i instanceof H?i:new H(...typeof i=="number"?[i,i,i]:i),cxe=w.forwardRef(({color:i,start:e,end:t},n)=>{const r=w.useContext(aj);if(!r)throw"Segment must used inside Segments component.";const s=w.useRef(null);return w.useImperativeHandle(n,()=>s.current,[]),w.useLayoutEffect(()=>r.subscribe(s),[]),w.createElement("segmentObject",{ref:s,color:i,start:FF(e),end:FF(t)})}),uxe=w.forwardRef(({children:i,hysteresis:e=0,distances:t,...n},r)=>{const s=w.useRef(null);return w.useImperativeHandle(r,()=>s.current,[]),w.useLayoutEffect(()=>{const{current:o}=s;o.levels.length=0,o.children.forEach((a,l)=>o.levels.push({object:a,hysteresis:e,distance:t[l]}))}),Kt(o=>{var a;return(a=s.current)==null?void 0:a.update(o.camera)}),w.createElement("lOD",ot({ref:s},n),i)});function hxe({all:i,scene:e,camera:t}){const n=Ve(({gl:o})=>o),r=Ve(({camera:o})=>o),s=Ve(({scene:o})=>o);return w.useLayoutEffect(()=>{const o=[];i&&(e||s).traverse(c=>{c.visible===!1&&(o.push(c),c.visible=!0)}),n.compile(e||s,t||r);const a=new xA(128);new Cw(.01,1e5,a).update(n,e||s),a.dispose(),o.forEach(c=>c.visible=!1)},[]),null}function fxe(){const i=Ve(e=>e.gl);return w.useEffect(()=>(i.shadowMap.autoUpdate=!1,i.shadowMap.needsUpdate=!0,()=>{i.shadowMap.autoUpdate=i.shadowMap.needsUpdate=!0}),[i.shadowMap]),null}const OF=new Xe,NF=new vc,vI=new Bi,xI=new H;function dxe(i,e){const t=this.geometry,n=this.material,r=this.matrixWorld;n!==void 0&&(t.boundingSphere===null&&t.computeBoundingSphere(),vI.copy(t.boundingSphere),vI.applyMatrix4(r),i.ray.intersectsSphere(vI)!==!1&&(OF.copy(r).invert(),NF.copy(i.ray).applyMatrix4(OF),!(t.boundingBox!==null&&NF.intersectBox(t.boundingBox,xI)===null)&&e.push({distance:xI.distanceTo(i.ray.origin),point:xI.clone(),object:this})))}function pxe({pixelated:i}){const e=Ve(o=>o.gl),t=Ve(o=>o.internal.active),n=Ve(o=>o.performance.current),r=Ve(o=>o.viewport.initialDpr),s=Ve(o=>o.setDpr);return w.useEffect(()=>{const o=e.domElement;return()=>{t&&s(r),i&&o&&(o.style.imageRendering="auto")}},[]),w.useEffect(()=>{s(n*r),i&&e.domElement&&(e.domElement.style.imageRendering=n===1?"auto":"pixelated")},[n]),null}function mxe(){const i=Ve(n=>n.get),e=Ve(n=>n.setEvents),t=Ve(n=>n.performance.current);return w.useEffect(()=>{const n=i().events.enabled;return()=>e({enabled:n})},[]),w.useEffect(()=>e({enabled:t===1}),[t]),null}const cj=w.createContext(null);function gxe({iterations:i=10,ms:e=250,threshold:t=.75,step:n=.1,factor:r=.5,flipflops:s=1/0,bounds:o=f=>f>100?[60,100]:[40,60],onIncline:a,onDecline:l,onChange:c,onFallback:u,children:h}){const f=Math.pow(10,0),[d,m]=w.useState(()=>({fps:0,index:0,factor:r,flipped:0,refreshrate:0,fallback:!1,frames:[],averages:[],subscriptions:new Map,subscribe:g=>{const y=Symbol();return d.subscriptions.set(y,g.current),()=>void d.subscriptions.delete(y)}}));let A=0;return Kt(()=>{const{frames:g,averages:y}=d;if(!d.fallback&&y.length<i){g.push(performance.now());const E=g[g.length-1]-g[0];if(E>=e){if(d.fps=Math.round(g.length/E*1e3*f)/f,d.refreshrate=Math.max(d.refreshrate,d.fps),y[d.index++%i]=d.fps,y.length===i){const[x,C]=o(d.refreshrate),T=y.filter(M=>M>=C),I=y.filter(M=>M<x);T.length>i*t&&(d.factor=Math.min(1,d.factor+n),d.flipped++,a&&a(d),d.subscriptions.forEach(M=>M.onIncline&&M.onIncline(d))),I.length>i*t&&(d.factor=Math.max(0,d.factor-n),d.flipped++,l&&l(d),d.subscriptions.forEach(M=>M.onDecline&&M.onDecline(d))),A!==d.factor&&(A=d.factor,c&&c(d),d.subscriptions.forEach(M=>M.onChange&&M.onChange(d))),d.flipped>s&&!d.fallback&&(d.fallback=!0,u&&u(d),d.subscriptions.forEach(M=>M.onFallback&&M.onFallback(d))),d.averages=[]}d.frames=[]}}}),w.createElement(cj.Provider,{value:d},h)}function Axe({onIncline:i,onDecline:e,onChange:t,onFallback:n}){const r=w.useContext(cj),s=w.useRef({onIncline:i,onDecline:e,onChange:t,onFallback:n});w.useLayoutEffect(()=>{s.current.onIncline=i,s.current.onDecline=e,s.current.onChange=t,s.current.onFallback=n},[i,e,t,n]),w.useLayoutEffect(()=>r.subscribe(s),[r])}const uj=w.forwardRef(({children:i,compute:e,width:t,height:n,samples:r=8,renderPriority:s=0,eventPriority:o=0,frames:a=1/0,stencilBuffer:l=!1,depthBuffer:c=!0,generateMipmaps:u=!1,...h},f)=>{const{size:d,viewport:m}=Ve(),A=Ea((t||d.width)*m.dpr,(n||d.height)*m.dpr,{samples:r,stencilBuffer:l,depthBuffer:c,generateMipmaps:u}),[g]=w.useState(()=>new Mu),y=w.useCallback((E,x,C)=>{var T,I;let M=(T=A.texture)==null?void 0:T.__r3f.parent;for(;M&&!(M instanceof _n);)M=M.__r3f.parent;if(!M)return!1;C.raycaster.camera||C.events.compute(E,C,(I=C.previousRoot)==null?void 0:I.getState());const[L]=C.raycaster.intersectObject(M);if(!L)return!1;const R=L.uv;if(!R)return!1;x.raycaster.setFromCamera(x.pointer.set(R.x*2-1,R.y*2-1),x.camera)},[]);return w.useImperativeHandle(f,()=>A.texture,[A]),w.createElement(w.Fragment,null,vp(w.createElement(yxe,{renderPriority:s,frames:a,fbo:A},i,w.createElement("group",{onPointerOver:()=>null})),g,{events:{compute:e||y,priority:o}}),w.createElement("primitive",ot({object:A.texture},h)))});function yxe({frames:i,renderPriority:e,children:t,fbo:n}){let r=0,s,o,a,l;return Kt(c=>{(i===1/0||r<i)&&(s=c.gl.autoClear,o=c.gl.xr.enabled,a=c.gl.getRenderTarget(),l=c.gl.xr.isPresenting,c.gl.autoClear=!0,c.gl.xr.enabled=!1,c.gl.xr.isPresenting=!1,c.gl.setRenderTarget(n),c.gl.render(c.scene,c.camera),c.gl.setRenderTarget(a),c.gl.autoClear=s,c.gl.xr.enabled=o,c.gl.xr.isPresenting=l,r++)},e),w.createElement(w.Fragment,null,t)}const hj=w.forwardRef(({children:i,compute:e,renderPriority:t=-1,eventPriority:n=0,frames:r=1/0,stencilBuffer:s=!1,depthBuffer:o=!0,generateMipmaps:a=!1,resolution:l=896,near:c=.1,far:u=1e3,flip:h=!1,position:f,rotation:d,scale:m,quaternion:A,matrix:g,matrixAutoUpdate:y,...E},x)=>{const{size:C,viewport:T}=Ve(),I=w.useRef(null),M=w.useMemo(()=>{const R=new xA(Math.max((l||C.width)*T.dpr,(l||C.height)*T.dpr),{stencilBuffer:s,depthBuffer:o,generateMipmaps:a});return R.texture.isRenderTargetTexture=!h,R.texture.flipY=!0,R.texture.type=Ni,R},[l,h]);w.useEffect(()=>()=>M.dispose(),[M]);const[L]=w.useState(()=>new Mu);return w.useImperativeHandle(x,()=>({scene:L,fbo:M,camera:I.current}),[M]),w.createElement(w.Fragment,null,vp(w.createElement(vxe,{renderPriority:t,frames:r,camera:I},i,w.createElement("group",{onPointerOver:()=>null})),L,{events:{compute:e,priority:n}}),w.createElement("primitive",ot({object:M.texture},E)),w.createElement("cubeCamera",{ref:I,args:[c,u,M],position:f,rotation:d,scale:m,quaternion:A,matrix:g,matrixAutoUpdate:y}))});function vxe({frames:i,renderPriority:e,children:t,camera:n}){let r=0;return Kt(s=>{(i===1/0||r<i)&&(n.current.update(s.gl,s.scene),r++)},e),w.createElement(w.Fragment,null,t)}const xxe=w.forwardRef(({id:i=1,colorWrite:e=!1,depthWrite:t=!1,...n},r)=>{const s=w.useRef(null),o=w.useMemo(()=>({colorWrite:e,depthWrite:t,stencilWrite:!0,stencilRef:i,stencilFunc:CS,stencilFail:Q_,stencilZFail:Q_,stencilZPass:Q_}),[i,e,t]);return w.useLayoutEffect(()=>{Object.assign(s.current.material,o)}),w.useImperativeHandle(r,()=>s.current,[]),w.createElement("mesh",ot({ref:s,renderOrder:-i},n))});function Exe(i,e=!1){return{stencilWrite:!0,stencilRef:i,stencilFunc:e?CU:wU,stencilFail:hh,stencilZFail:hh,stencilZPass:hh}}function _xe({renderPriority:i=1,zoom:e=0,segments:t=64,children:n,resolution:r=896,...s}){const o=w.useRef(null),a=w.useRef(null),{width:l,height:c}=Ve(g=>g.size),[u]=w.useState(()=>new qi);w.useLayoutEffect(()=>{u.position.set(0,0,100),u.zoom=100,u.left=l/-2,u.right=l/2,u.top=c/2,u.bottom=c/-2,u.updateProjectionMatrix()},[l,c]);const h=Math.sqrt(l*l+c*c)/100*(.5+e/2),f=new H,d=new Bi(new H,h),m=new Tn,A=w.useCallback((g,y,E)=>{if(y.pointer.set(g.offsetX/y.size.width*2-1,-(g.offsetY/y.size.height)*2+1),y.raycaster.setFromCamera(y.pointer,u),y.raycaster.ray.intersectSphere(d,f))f.normalize();else return;m.getNormalMatrix(a.current.camera.matrixWorld),a.current.camera.getWorldPosition(y.raycaster.ray.origin),y.raycaster.ray.direction.set(0,0,1).reflect(f),y.raycaster.ray.direction.x*=-1,y.raycaster.ray.direction.applyNormalMatrix(m).multiplyScalar(-1)},[]);return Kt(g=>{i&&g.gl.render(o.current,u)},i),w.createElement(w.Fragment,null,w.createElement("mesh",ot({ref:o},s,{scale:h}),w.createElement("sphereGeometry",{args:[1,t,t]}),w.createElement("meshBasicMaterial",null,w.createElement(hj,{compute:A,attach:"envMap",flip:!0,resolution:r,ref:a},n,w.createElement(Sxe,{api:a})))))}function Sxe({api:i}){const e=new H,t=new Xt,n=new H,r=new Eo(0,Math.PI,0);return Kt(s=>{s.camera.matrixWorld.decompose(e,t,n),i.current.camera.position.copy(e),i.current.camera.quaternion.setFromEuler(r).premultiply(t)}),null}const wxe=Ec({blur:0,map:null,sdf:null,blend:0,size:0,resolution:new Ue},`varying vec2 vUv;
   void main() {
     gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
     vUv = uv;
   }`,`uniform sampler2D sdf;
   uniform sampler2D map;
   uniform float blur;
   uniform float size;
   uniform float time;
   uniform vec2 resolution;
   varying vec2 vUv;
   #include <packing>
   void main() {
     vec2 uv = gl_FragCoord.xy / resolution.xy;
     vec4 t = texture2D(map, uv);
     float k = blur;
     float d = texture2D(sdf, vUv).r/size;
     float alpha = 1.0 - smoothstep(0.0, 1.0, clamp(d/k + 1.0, 0.0, 1.0));
     gl_FragColor = vec4(t.rgb, blur == 0.0 ? t.a : t.a * alpha);
     #include <tonemapping_fragment>
     #include <${ea>=154?"colorspace_fragment":"encodings_fragment"}>
   }`),Cxe=w.forwardRef(({children:i,events:e=void 0,blur:t=0,eventPriority:n=0,renderPriority:r=0,worldUnits:s=!1,resolution:o=512,...a},l)=>{Or({PortalMaterialImpl:wxe});const c=w.useRef(null),{scene:u,gl:h,size:f,viewport:d,setEvents:m}=Ve(),A=Ea(o,o),[g,y]=w.useState(0);Kt(()=>{const I=c.current.blend>0?Math.max(1,r):0;g!==I&&y(I)}),w.useEffect(()=>{e!==void 0&&m({enabled:!e})},[e]);const[E,x]=w.useState(!0),C=CW(x);w.useLayoutEffect(()=>{var I;C.current=(I=c.current)==null?void 0:I.__r3f.parent},[]),w.useLayoutEffect(()=>{if(C.current&&t&&c.current.sdf===null){const I=new It(C.current.geometry,new no),M=new ti().setFromBufferAttribute(I.geometry.attributes.position),L=new qi(M.min.x*(1+2/o),M.max.x*(1+2/o),M.max.y*(1+2/o),M.min.y*(1+2/o),.1,1e3);L.position.set(0,0,1),L.lookAt(0,0,0),h.setRenderTarget(A),h.render(I,L);const P=bxe(o,o,h)(A.texture),F=new Float32Array(o*o);h.readRenderTargetPixels(P,0,0,o,o,F);let k=1/0;for(let z=0;z<F.length;z++)F[z]<k&&(k=F[z]);k=-k,c.current.size=k,c.current.sdf=P.texture,h.setRenderTarget(null)}},[o,t]),w.useImperativeHandle(l,()=>c.current);const T=w.useCallback((I,M,L)=>{var R;if(!C.current)return!1;if(M.pointer.set(I.offsetX/M.size.width*2-1,-(I.offsetY/M.size.height)*2+1),M.raycaster.setFromCamera(M.pointer,M.camera),((R=c.current)==null?void 0:R.blend)===0){const[P]=M.raycaster.intersectObject(C.current);if(!P)return M.raycaster.camera=void 0,!1}},[]);return w.createElement("portalMaterialImpl",ot({ref:c,blur:t,blend:0,resolution:[f.width*d.dpr,f.height*d.dpr],attach:"material"},a),w.createElement(uj,{attach:"map",frames:E?1/0:0,eventPriority:n,renderPriority:r,compute:T},i,w.createElement(Txe,{events:e,rootScene:u,priority:g,material:c,worldUnits:s})))});function Txe({events:i=void 0,rootScene:e,material:t,priority:n,worldUnits:r}){const s=Ve(h=>h.scene),o=Ve(h=>h.setEvents),a=Ea(),l=Ea();w.useLayoutEffect(()=>{s.matrixAutoUpdate=!1},[]),w.useEffect(()=>{i!==void 0&&o({enabled:i})},[i]);const[c,u]=w.useMemo(()=>{const h={value:0};return[new Tf(new Mi({uniforms:{a:{value:a.texture},b:{value:l.texture},blend:h},vertexShader:`
          varying vec2 vUv;
          void main() {
            vUv = uv;
            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
          }`,fragmentShader:`
          uniform sampler2D a;
          uniform sampler2D b;
          uniform float blend;
          varying vec2 vUv;
          #include <packing>
          void main() {
            vec4 ta = texture2D(a, vUv);
            vec4 tb = texture2D(b, vUv);
            gl_FragColor = mix(tb, ta, blend);
            #include <tonemapping_fragment>
            #include <${ea>=154?"colorspace_fragment":"encodings_fragment"}>
          }`})),h]},[]);return Kt(h=>{var f;let d=t==null||(f=t.current)==null?void 0:f.__r3f.parent;if(d){if(r)s.matrixWorld.identity();else{var m;n&&((m=t.current)==null?void 0:m.blend)===1&&d.updateWorldMatrix(!0,!1),s.matrixWorld.copy(d.matrixWorld)}if(n){var A,g,y;((A=t.current)==null?void 0:A.blend)>0&&((g=t.current)==null?void 0:g.blend)<1?(u.value=t.current.blend,h.gl.setRenderTarget(a),h.gl.render(s,h.camera),h.gl.setRenderTarget(l),h.gl.render(e,h.camera),h.gl.setRenderTarget(null),c.render(h.gl)):((y=t.current)==null?void 0:y.blend)===1&&h.gl.render(s,h.camera)}}},n),w.createElement(w.Fragment,null)}const bxe=(i,e,t)=>{let n=new Si(i,e,{minFilter:Bl,magFilter:Pn,type:fi,format:hc,generateMipmaps:!0}),r=new Si(i,e,{minFilter:zn,magFilter:zn}),s=new Si(i,e,{minFilter:zn,magFilter:zn}),o=new Si(i,e,{minFilter:zn,magFilter:zn}),a=new Si(i,e,{minFilter:zn,magFilter:zn}),l=new Si(i,e,{minFilter:zn,magFilter:zn,type:fi,format:hc}),c=new Si(i,e,{minFilter:zn,magFilter:zn,type:fi,format:hc});const u=new Tf(new Mi({uniforms:{tex:{value:null}},vertexShader:`
        varying vec2 vUv;
        void main() {
          vUv = uv;
          gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        }`,fragmentShader:`
        uniform sampler2D tex;
        varying vec2 vUv;
        #include <packing>
        void main() {
          gl_FragColor = pack2HalfToRGBA(vUv * (round(texture2D(tex, vUv).x)));
        }`})),h=new Tf(new Mi({uniforms:{tex:{value:null}},vertexShader:`
        varying vec2 vUv;
        void main() {
          vUv = uv;
          gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        }`,fragmentShader:`
        uniform sampler2D tex;
        varying vec2 vUv;
        #include <packing>
        void main() {
          gl_FragColor = pack2HalfToRGBA(vUv * (1.0 - round(texture2D(tex, vUv).x)));
        }`})),f=new Tf(new Mi({uniforms:{tex:{value:null},offset:{value:0},level:{value:0},maxSteps:{value:0}},vertexShader:`
        varying vec2 vUv;
        void main() {
          vUv = uv;
          gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        }`,fragmentShader:`
        varying vec2 vUv;
        uniform sampler2D tex;
        uniform float offset;
        uniform float level;
        uniform float maxSteps;
        #include <packing>
        void main() {
          float closestDist = 9999999.9;
          vec2 closestPos = vec2(0.0);
          for (float x = -1.0; x <= 1.0; x += 1.0) {
            for (float y = -1.0; y <= 1.0; y += 1.0) {
              vec2 voffset = vUv;
              voffset += vec2(x, y) * vec2(${1/i}, ${1/e}) * offset;
              vec2 pos = unpackRGBATo2Half(texture2D(tex, voffset));
              float dist = distance(pos.xy, vUv);
              if(pos.x != 0.0 && pos.y != 0.0 && dist < closestDist) {
                closestDist = dist;
                closestPos = pos;
              }
            }
          }
          gl_FragColor = pack2HalfToRGBA(closestPos);
        }`})),d=new Tf(new Mi({uniforms:{tex:{value:null},size:{value:new Ue(i,e)}},vertexShader:`
        varying vec2 vUv;
        void main() {
          vUv = uv;
          gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        }`,fragmentShader:`
        varying vec2 vUv;
        uniform sampler2D tex;
        uniform vec2 size;
        #include <packing>
        void main() {
          gl_FragColor = vec4(distance(size * unpackRGBATo2Half(texture2D(tex, vUv)), size * vUv), 0.0, 0.0, 0.0);
        }`})),m=new Tf(new Mi({uniforms:{inside:{value:c.texture},outside:{value:l.texture},tex:{value:null}},vertexShader:`
        varying vec2 vUv;
        void main() {
          vUv = uv;
          gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        }`,fragmentShader:`
        varying vec2 vUv;
        uniform sampler2D inside;
        uniform sampler2D outside;
        uniform sampler2D tex;
        #include <packing>
        void main() {
          float i = texture2D(inside, vUv).x;
          float o =texture2D(outside, vUv).x;
          if (texture2D(tex, vUv).x == 0.0) {
            gl_FragColor = vec4(o, 0.0, 0.0, 0.0);
          } else {
            gl_FragColor = vec4(-i, 0.0, 0.0, 0.0);
          }
        }`}));return A=>{let g=n;A.minFilter=zn,A.magFilter=zn,u.material.uniforms.tex.value=A,t.setRenderTarget(r),u.render(t);const y=Math.ceil(Math.log(Math.max(i,e))/Math.log(2));let E=r,x=null;for(let C=0;C<y;C++){const T=Math.pow(2,y-C-1);x=E===r?o:r,f.material.uniforms.level.value=C,f.material.uniforms.maxSteps.value=y,f.material.uniforms.offset.value=T,f.material.uniforms.tex.value=E.texture,t.setRenderTarget(x),f.render(t),E=x}t.setRenderTarget(l),d.material.uniforms.tex.value=x.texture,d.render(t),h.material.uniforms.tex.value=A,t.setRenderTarget(s),h.render(t),E=s;for(let C=0;C<y;C++){const T=Math.pow(2,y-C-1);x=E===s?a:s,f.material.uniforms.level.value=C,f.material.uniforms.maxSteps.value=y,f.material.uniforms.offset.value=T,f.material.uniforms.tex.value=E.texture,t.setRenderTarget(x),f.render(t),E=x}return t.setRenderTarget(c),d.material.uniforms.tex.value=x.texture,d.render(t),t.setRenderTarget(g),m.material.uniforms.tex.value=A,m.render(t),t.setRenderTarget(null),g}},Ixe={},UF=i=>{let e;const t=new Set,n=(u,h)=>{const f=typeof u=="function"?u(e):u;if(!Object.is(f,e)){const d=e;e=h??(typeof f!="object"||f===null)?f:Object.assign({},e,f),t.forEach(m=>m(e,d))}},r=()=>e,l={setState:n,getState:r,getInitialState:()=>c,subscribe:u=>(t.add(u),()=>t.delete(u)),destroy:()=>{(Ixe?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),t.clear()}},c=e=i(n,r,l);return l},Mxe=i=>i?UF(i):UF;var EI={exports:{}},_I={},SI={exports:{}},wI={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var zF;function Rxe(){if(zF)return wI;zF=1;var i=yA();function e(h,f){return h===f&&(h!==0||1/h===1/f)||h!==h&&f!==f}var t=typeof Object.is=="function"?Object.is:e,n=i.useState,r=i.useEffect,s=i.useLayoutEffect,o=i.useDebugValue;function a(h,f){var d=f(),m=n({inst:{value:d,getSnapshot:f}}),A=m[0].inst,g=m[1];return s(function(){A.value=d,A.getSnapshot=f,l(A)&&g({inst:A})},[h,d,f]),r(function(){return l(A)&&g({inst:A}),h(function(){l(A)&&g({inst:A})})},[h]),o(d),d}function l(h){var f=h.getSnapshot;h=h.value;try{var d=f();return!t(h,d)}catch{return!0}}function c(h,f){return f()}var u=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?c:a;return wI.useSyncExternalStore=i.useSyncExternalStore!==void 0?i.useSyncExternalStore:u,wI}var GF;function Lxe(){return GF||(GF=1,SI.exports=Rxe()),SI.exports}/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var HF;function Pxe(){if(HF)return _I;HF=1;var i=yA(),e=Lxe();function t(c,u){return c===u&&(c!==0||1/c===1/u)||c!==c&&u!==u}var n=typeof Object.is=="function"?Object.is:t,r=e.useSyncExternalStore,s=i.useRef,o=i.useEffect,a=i.useMemo,l=i.useDebugValue;return _I.useSyncExternalStoreWithSelector=function(c,u,h,f,d){var m=s(null);if(m.current===null){var A={hasValue:!1,value:null};m.current=A}else A=m.current;m=a(function(){function y(I){if(!E){if(E=!0,x=I,I=f(I),d!==void 0&&A.hasValue){var M=A.value;if(d(M,I))return C=M}return C=I}if(M=C,n(x,I))return M;var L=f(I);return d!==void 0&&d(M,L)?(x=I,M):(x=I,C=L)}var E=!1,x,C,T=h===void 0?null:h;return[function(){return y(u())},T===null?void 0:function(){return y(T())}]},[u,h,f,d]);var g=r(c,m[0],m[1]);return o(function(){A.hasValue=!0,A.value=g},[g]),l(g),g},_I}var QF;function Bxe(){return QF||(QF=1,EI.exports=Pxe()),EI.exports}var Dxe=Bxe();const kxe=AA(Dxe),fj={},{useDebugValue:Fxe}=bl,{useSyncExternalStoreWithSelector:Oxe}=kxe;let VF=!1;const Nxe=i=>i;function Uxe(i,e=Nxe,t){(fj?"production":void 0)!=="production"&&t&&!VF&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),VF=!0);const n=Oxe(i.subscribe,i.getState,i.getServerState||i.getInitialState,e,t);return Fxe(n),n}const WF=i=>{(fj?"production":void 0)!=="production"&&typeof i!="function"&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const e=typeof i=="function"?Mxe(i):i,t=(n,r)=>Uxe(e,n,r);return Object.assign(t,e),t},zxe=i=>i?WF(i):WF;var jF,KF;const $F=typeof window<"u"&&((jF=window.document)!=null&&jF.createElement||((KF=window.navigator)==null?void 0:KF.product)==="ReactNative")?bl.useLayoutEffect:bl.useEffect;function Gxe(){const i=zxe(e=>({current:new Array,version:0,set:e}));return{In:({children:e})=>{const t=i(r=>r.set),n=i(r=>r.version);return $F(()=>{t(r=>({version:r.version+1}))},[]),$F(()=>(t(({current:r})=>({current:[...r,e]})),()=>t(({current:r})=>({current:r.filter(s=>s!==e)}))),[e,n]),null},Out:()=>{const e=i(t=>t.current);return bl.createElement(bl.Fragment,null,e)}}}const Hxe=i=>i&&i.isOrthographicCamera,YF=new ut,dj=Gxe();function pj(i){return"top"in i}function CI(i,e){const{right:t,top:n,left:r,bottom:s,width:o,height:a}=e,l=e.bottom<0||n>i.height||t<0||e.left>i.width;if(pj(i)){const h=i.top+i.height-s,f=r-i.left;return{position:{width:o,height:a,left:f,top:n,bottom:h,right:t},isOffscreen:l}}const c=i.height-s;return{position:{width:o,height:a,top:n,left:r,bottom:c,right:t},isOffscreen:l}}function TI(i,{left:e,bottom:t,width:n,height:r}){let s;const o=n/r;return Hxe(i.camera)?i.camera.manual?i.camera.updateProjectionMatrix():(i.camera.left!==n/-2||i.camera.right!==n/2||i.camera.top!==r/2||i.camera.bottom!==r/-2)&&(Object.assign(i.camera,{left:n/-2,right:n/2,top:r/2,bottom:r/-2}),i.camera.updateProjectionMatrix()):i.camera.aspect!==o&&(i.camera.aspect=o,i.camera.updateProjectionMatrix()),s=i.gl.autoClear,i.gl.autoClear=!1,i.gl.setViewport(e,t,n,r),i.gl.setScissor(e,t,n,r),i.gl.setScissorTest(!0),s}function bI(i,e){i.gl.setScissorTest(!1),i.gl.autoClear=e}function XF(i){i.gl.getClearColor(YF),i.gl.setClearColor(YF,i.gl.getClearAlpha()),i.gl.clear(!0,!0)}function Qxe({visible:i=!0,canvasSize:e,scene:t,index:n,children:r,frames:s,rect:o,track:a}){const l=Ve(),[c,u]=w.useState(!1);let h=0;return Kt(f=>{if(s===1/0||h<=s){var d;a&&(o.current=(d=a.current)==null?void 0:d.getBoundingClientRect()),h++}if(o.current){const{position:m,isOffscreen:A}=CI(e,o.current);if(c!==A&&u(A),i&&!c&&o.current){const g=TI(f,m);f.gl.render(r?f.scene:t,f.camera),bI(f,g)}}},n),w.useLayoutEffect(()=>{const f=o.current;if(f&&(!i||!c)){const{position:d}=CI(e,f),m=TI(l,d);XF(l),bI(l,m)}},[i,c]),w.useEffect(()=>{if(!a)return;const f=o.current,d=l.get().events.connected;return l.setEvents({connected:a.current}),()=>{if(f){const{position:m}=CI(e,f),A=TI(l,m);XF(l),bI(l,A)}l.setEvents({connected:d})}},[a]),w.useEffect(()=>{pj(e)||console.warn(`Detected @react-three/fiber canvas size does not include position information. <View /> may not work as expected. Upgrade to @react-three/fiber ^8.1.0 for support.
 See https://github.com/pmndrs/drei/issues/944`)},[]),w.createElement(w.Fragment,null,r,w.createElement("group",{onPointerOver:()=>null}))}const mj=w.forwardRef(({track:i,visible:e=!0,index:t=1,id:n,style:r,className:s,frames:o=1/0,children:a,...l},c)=>{var u,h,f,d;const m=w.useRef(null),{size:A,scene:g}=Ve(),[y]=w.useState(()=>new Mu),[E,x]=w.useReducer(()=>!0,!1),C=w.useCallback((T,I)=>{if(m.current&&i&&i.current&&T.target===i.current){const{width:M,height:L,left:R,top:P}=m.current,F=T.clientX-R,k=T.clientY-P;I.pointer.set(F/M*2-1,-(k/L)*2+1),I.raycaster.setFromCamera(I.pointer,I.camera)}},[m,i]);return w.useEffect(()=>{var T;i&&(m.current=(T=i.current)==null?void 0:T.getBoundingClientRect()),x()},[i]),w.createElement("group",ot({ref:c},l),E&&vp(w.createElement(Qxe,{visible:e,canvasSize:A,frames:o,scene:g,track:i,rect:m,index:t},a),y,{events:{compute:C,priority:t},size:{width:(u=m.current)==null?void 0:u.width,height:(h=m.current)==null?void 0:h.height,top:(f=m.current)==null?void 0:f.top,left:(d=m.current)==null?void 0:d.left}}))}),Vxe=w.forwardRef(({as:i="div",id:e,visible:t,className:n,style:r,index:s=1,track:o,frames:a=1/0,children:l,...c},u)=>{const h=w.useId(),f=w.useRef(null);return w.useImperativeHandle(u,()=>f.current),w.createElement(w.Fragment,null,w.createElement(i,ot({ref:f,id:e,className:n,style:r},c)),w.createElement(dj.In,null,w.createElement(mj,{visible:t,key:h,track:f,frames:a,index:s},l)))}),Wxe=(()=>{const i=w.forwardRef((e,t)=>w.useContext(t0)?w.createElement(mj,ot({ref:t},e)):w.createElement(Vxe,ot({ref:t},e)));return i.Port=()=>w.createElement(dj.Out,null),i})(),Cx=w.createContext(null),b_=new H,qF=new H,jxe=(i,e,t,n)=>{const r=e.dot(e),s=e.dot(i)-e.dot(t),o=e.dot(n);return o===0?-s/r:(b_.copy(n).multiplyScalar(r/o).sub(e),qF.copy(n).multiplyScalar(s/o).add(t).sub(i),-b_.dot(qF)/b_.dot(b_))},Kxe=new H(0,1,0),JF=new Xe,II=({direction:i,axis:e})=>{const{translation:t,translationLimits:n,annotations:r,annotationsClass:s,depthTest:o,scale:a,lineWidth:l,fixed:c,axisColors:u,hoveredColor:h,opacity:f,onDragStart:d,onDrag:m,onDragEnd:A,userData:g}=w.useContext(Cx),y=Ve(oe=>oe.controls),E=w.useRef(null),x=w.useRef(null),C=w.useRef(null),T=w.useRef(0),[I,M]=w.useState(!1),L=w.useCallback(oe=>{r&&(E.current.innerText=`${t.current[e].toFixed(2)}`,E.current.style.display="block"),oe.stopPropagation();const X=new Xe().extractRotation(x.current.matrixWorld),Q=oe.point.clone(),Y=new H().setFromMatrixPosition(x.current.matrixWorld),O=i.clone().applyMatrix4(X).normalize();C.current={clickPoint:Q,dir:O},T.current=t.current[e],d({component:"Arrow",axis:e,origin:Y,directions:[O]}),y&&(y.enabled=!1),oe.target.setPointerCapture(oe.pointerId)},[r,i,y,d,t,e]),R=w.useCallback(oe=>{if(oe.stopPropagation(),I||M(!0),C.current){const{clickPoint:X,dir:Q}=C.current,[Y,O]=(n==null?void 0:n[e])||[void 0,void 0];let K=jxe(X,Q,oe.ray.origin,oe.ray.direction);Y!==void 0&&(K=Math.max(K,Y-T.current)),O!==void 0&&(K=Math.min(K,O-T.current)),t.current[e]=T.current+K,r&&(E.current.innerText=`${t.current[e].toFixed(2)}`),JF.makeTranslation(Q.x*K,Q.y*K,Q.z*K),m(JF)}},[r,m,I,t,n,e]),P=w.useCallback(oe=>{r&&(E.current.style.display="none"),oe.stopPropagation(),C.current=null,A(),y&&(y.enabled=!0),oe.target.releasePointerCapture(oe.pointerId)},[r,y,A]),F=w.useCallback(oe=>{oe.stopPropagation(),M(!1)},[]),{cylinderLength:k,coneWidth:z,coneLength:U,matrixL:W}=w.useMemo(()=>{const oe=c?l/a*1.6:a/20,X=c?.2:a/5,Q=c?1-X:a-X,Y=new Xt().setFromUnitVectors(Kxe,i.clone().normalize()),O=new Xe().makeRotationFromQuaternion(Y);return{cylinderLength:Q,coneWidth:oe,coneLength:X,matrixL:O}},[i,a,l,c]),$=I?h:u[e];return w.createElement("group",{ref:x},w.createElement("group",{matrix:W,matrixAutoUpdate:!1,onPointerDown:L,onPointerMove:R,onPointerUp:P,onPointerOut:F},r&&w.createElement(CA,{position:[0,-U,0]},w.createElement("div",{style:{display:"none",background:"#151520",color:"white",padding:"6px 8px",borderRadius:7,whiteSpace:"nowrap"},className:s,ref:E})),w.createElement("mesh",{visible:!1,position:[0,(k+U)/2,0],userData:g},w.createElement("cylinderGeometry",{args:[z*1.4,z*1.4,k+U,8,1]})),w.createElement(Cu,{transparent:!0,raycast:()=>null,depthTest:o,points:[0,0,0,0,k,0],lineWidth:l,side:Pi,color:$,opacity:f,polygonOffset:!0,renderOrder:1,polygonOffsetFactor:-10,fog:!1}),w.createElement("mesh",{raycast:()=>null,position:[0,k+U/2,0],renderOrder:500},w.createElement("coneGeometry",{args:[z,U,24,1]}),w.createElement("meshBasicMaterial",{transparent:!0,depthTest:o,color:$,opacity:f,polygonOffset:!0,polygonOffsetFactor:-10,fog:!1}))))},MI=new H,RI=new H,LI=i=>i*180/Math.PI,$xe=i=>i*Math.PI/180,Yxe=(i,e,t,n,r)=>{MI.copy(i).sub(t),RI.copy(e).sub(t);const s=n.dot(n),o=r.dot(r),a=MI.dot(n)/s,l=MI.dot(r)/o,c=RI.dot(n)/s,u=RI.dot(r)/o,h=Math.atan2(l,a);return Math.atan2(u,c)-h},Xxe=(i,e)=>{let t=Math.floor(i/e);return t=t<0?t+1:t,i-t*e},ZF=i=>{let e=Xxe(i,2*Math.PI);return Math.abs(e)<1e-6?0:(e<0&&(e+=2*Math.PI),e)},I_=new Xe,eO=new H,M_=new vc,PI=new H,BI=({dir1:i,dir2:e,axis:t})=>{const{rotationLimits:n,annotations:r,annotationsClass:s,depthTest:o,scale:a,lineWidth:l,fixed:c,axisColors:u,hoveredColor:h,opacity:f,onDragStart:d,onDrag:m,onDragEnd:A,userData:g}=w.useContext(Cx),y=Ve($=>$.controls),E=w.useRef(null),x=w.useRef(null),C=w.useRef(0),T=w.useRef(0),I=w.useRef(null),[M,L]=w.useState(!1),R=w.useCallback($=>{r&&(E.current.innerText=`${LI(T.current).toFixed(0)}º`,E.current.style.display="block"),$.stopPropagation();const oe=$.point.clone(),X=new H().setFromMatrixPosition(x.current.matrixWorld),Q=new H().setFromMatrixColumn(x.current.matrixWorld,0).normalize(),Y=new H().setFromMatrixColumn(x.current.matrixWorld,1).normalize(),O=new H().setFromMatrixColumn(x.current.matrixWorld,2).normalize(),K=new vo().setFromNormalAndCoplanarPoint(O,X);I.current={clickPoint:oe,origin:X,e1:Q,e2:Y,normal:O,plane:K},d({component:"Rotator",axis:t,origin:X,directions:[Q,Y,O]}),y&&(y.enabled=!1),$.target.setPointerCapture($.pointerId)},[r,y,d,t]),P=w.useCallback($=>{if($.stopPropagation(),M||L(!0),I.current){const{clickPoint:oe,origin:X,e1:Q,e2:Y,normal:O,plane:K}=I.current,[te,q]=(n==null?void 0:n[t])||[void 0,void 0];M_.copy($.ray),M_.intersectPlane(K,PI),M_.direction.negate(),M_.intersectPlane(K,PI);let J=Yxe(oe,PI,X,Q,Y),ie=LI(J);$.shiftKey&&(ie=Math.round(ie/10)*10,J=$xe(ie)),te!==void 0&&q!==void 0&&q-te<2*Math.PI?(J=ZF(J),J=J>Math.PI?J-2*Math.PI:J,J=un.clamp(J,te-C.current,q-C.current),T.current=C.current+J):(T.current=ZF(C.current+J),T.current=T.current>Math.PI?T.current-2*Math.PI:T.current),r&&(ie=LI(T.current),E.current.innerText=`${ie.toFixed(0)}º`),I_.makeRotationAxis(O,J),eO.copy(X).applyMatrix4(I_).sub(X).negate(),I_.setPosition(eO),m(I_)}},[r,m,M,n,t]),F=w.useCallback($=>{r&&(E.current.style.display="none"),$.stopPropagation(),C.current=T.current,I.current=null,A(),y&&(y.enabled=!0),$.target.releasePointerCapture($.pointerId)},[r,y,A]),k=w.useCallback($=>{$.stopPropagation(),L(!1)},[]),z=w.useMemo(()=>{const $=i.clone().normalize(),oe=e.clone().normalize();return new Xe().makeBasis($,oe,$.clone().cross(oe))},[i,e]),U=c?.65:a*.65,W=w.useMemo(()=>{const oe=[];for(let X=0;X<=32;X++){const Q=X*(Math.PI/2)/32;oe.push(new H(Math.cos(Q)*U,Math.sin(Q)*U,0))}return oe},[U]);return w.createElement("group",{ref:x,onPointerDown:R,onPointerMove:P,onPointerUp:F,onPointerOut:k,matrix:z,matrixAutoUpdate:!1},r&&w.createElement(CA,{position:[U,U,0]},w.createElement("div",{style:{display:"none",background:"#151520",color:"white",padding:"6px 8px",borderRadius:7,whiteSpace:"nowrap"},className:s,ref:E})),w.createElement(Cu,{points:W,lineWidth:l*4,visible:!1,userData:g}),w.createElement(Cu,{transparent:!0,raycast:()=>null,depthTest:o,points:W,lineWidth:l,side:Pi,color:M?h:u[t],opacity:f,polygonOffset:!0,polygonOffsetFactor:-10,fog:!1}))},qxe=(i,e,t)=>{const n=Math.abs(i.x)>=Math.abs(i.y)&&Math.abs(i.x)>=Math.abs(i.z)?0:Math.abs(i.y)>=Math.abs(i.x)&&Math.abs(i.y)>=Math.abs(i.z)?1:2,r=[0,1,2].sort((m,A)=>Math.abs(e.getComponent(A))-Math.abs(e.getComponent(m))),s=n===r[0]?r[1]:r[0],o=i.getComponent(n),a=i.getComponent(s),l=e.getComponent(n),c=e.getComponent(s),u=t.getComponent(n),f=(t.getComponent(s)-u*(a/o))/(c-l*(a/o));return[(u-f*l)/o,f]},R_=new vc,L_=new H,tO=new Xe,DI=({dir1:i,dir2:e,axis:t})=>{const{translation:n,translationLimits:r,annotations:s,annotationsClass:o,depthTest:a,scale:l,lineWidth:c,fixed:u,axisColors:h,hoveredColor:f,opacity:d,onDragStart:m,onDrag:A,onDragEnd:g,userData:y}=w.useContext(Cx),E=Ve(Q=>Q.controls),x=w.useRef(null),C=w.useRef(null),T=w.useRef(null),I=w.useRef(0),M=w.useRef(0),[L,R]=w.useState(!1),P=w.useCallback(Q=>{s&&(x.current.innerText=`${n.current[(t+1)%3].toFixed(2)}, ${n.current[(t+2)%3].toFixed(2)}`,x.current.style.display="block"),Q.stopPropagation();const Y=Q.point.clone(),O=new H().setFromMatrixPosition(C.current.matrixWorld),K=new H().setFromMatrixColumn(C.current.matrixWorld,0).normalize(),te=new H().setFromMatrixColumn(C.current.matrixWorld,1).normalize(),q=new H().setFromMatrixColumn(C.current.matrixWorld,2).normalize(),J=new vo().setFromNormalAndCoplanarPoint(q,O);T.current={clickPoint:Y,e1:K,e2:te,plane:J},I.current=n.current[(t+1)%3],M.current=n.current[(t+2)%3],m({component:"Slider",axis:t,origin:O,directions:[K,te,q]}),E&&(E.enabled=!1),Q.target.setPointerCapture(Q.pointerId)},[s,E,m,t]),F=w.useCallback(Q=>{if(Q.stopPropagation(),L||R(!0),T.current){const{clickPoint:Y,e1:O,e2:K,plane:te}=T.current,[q,J]=(r==null?void 0:r[(t+1)%3])||[void 0,void 0],[ie,re]=(r==null?void 0:r[(t+2)%3])||[void 0,void 0];R_.copy(Q.ray),R_.intersectPlane(te,L_),R_.direction.negate(),R_.intersectPlane(te,L_),L_.sub(Y);let[se,ge]=qxe(O,K,L_);q!==void 0&&(se=Math.max(se,q-I.current)),J!==void 0&&(se=Math.min(se,J-I.current)),ie!==void 0&&(ge=Math.max(ge,ie-M.current)),re!==void 0&&(ge=Math.min(ge,re-M.current)),n.current[(t+1)%3]=I.current+se,n.current[(t+2)%3]=M.current+ge,s&&(x.current.innerText=`${n.current[(t+1)%3].toFixed(2)}, ${n.current[(t+2)%3].toFixed(2)}`),tO.makeTranslation(se*O.x+ge*K.x,se*O.y+ge*K.y,se*O.z+ge*K.z),A(tO)}},[s,A,L,n,r,t]),k=w.useCallback(Q=>{s&&(x.current.style.display="none"),Q.stopPropagation(),T.current=null,g(),E&&(E.enabled=!0),Q.target.releasePointerCapture(Q.pointerId)},[s,E,g]),z=w.useCallback(Q=>{Q.stopPropagation(),R(!1)},[]),U=w.useMemo(()=>{const Q=i.clone().normalize(),Y=e.clone().normalize();return new Xe().makeBasis(Q,Y,Q.clone().cross(Y))},[i,e]),W=u?1/7:l/7,$=u?.225:l*.225,oe=L?f:h[t],X=w.useMemo(()=>[new H(0,0,0),new H(0,$,0),new H($,$,0),new H($,0,0),new H(0,0,0)],[$]);return w.createElement("group",{ref:C,matrix:U,matrixAutoUpdate:!1},s&&w.createElement(CA,{position:[0,0,0]},w.createElement("div",{style:{display:"none",background:"#151520",color:"white",padding:"6px 8px",borderRadius:7,whiteSpace:"nowrap"},className:o,ref:x})),w.createElement("group",{position:[W*1.7,W*1.7,0]},w.createElement("mesh",{visible:!0,onPointerDown:P,onPointerMove:F,onPointerUp:k,onPointerOut:z,scale:$,userData:y},w.createElement("planeGeometry",null),w.createElement("meshBasicMaterial",{transparent:!0,depthTest:a,color:oe,polygonOffset:!0,polygonOffsetFactor:-10,side:Pi,fog:!1})),w.createElement(Cu,{position:[-$/2,-$/2,0],transparent:!0,depthTest:a,points:X,lineWidth:c,color:oe,opacity:d,polygonOffset:!0,polygonOffsetFactor:-10,userData:y,fog:!1})))},Gv=new H,nO=new H,Jxe=(i,e,t,n)=>{const r=e.dot(e),s=e.dot(i)-e.dot(t),o=e.dot(n);return o===0?-s/r:(Gv.copy(n).multiplyScalar(r/o).sub(e),nO.copy(n).multiplyScalar(s/o).add(t).sub(i),-Gv.dot(nO)/Gv.dot(Gv))},Zxe=new H(0,1,0),bv=new H,iO=new Xe,kI=({direction:i,axis:e})=>{const{scaleLimits:t,annotations:n,annotationsClass:r,depthTest:s,scale:o,lineWidth:a,fixed:l,axisColors:c,hoveredColor:u,opacity:h,onDragStart:f,onDrag:d,onDragEnd:m,userData:A}=w.useContext(Cx),g=Ve(X=>X.size),y=Ve(X=>X.controls),E=w.useRef(null),x=w.useRef(null),C=w.useRef(null),T=w.useRef(1),I=w.useRef(1),M=w.useRef(null),[L,R]=w.useState(!1),P=l?1.2:1.2*o,F=w.useCallback(X=>{n&&(E.current.innerText=`${I.current.toFixed(2)}`,E.current.style.display="block"),X.stopPropagation();const Q=new Xe().extractRotation(x.current.matrixWorld),Y=X.point.clone(),O=new H().setFromMatrixPosition(x.current.matrixWorld),K=i.clone().applyMatrix4(Q).normalize(),te=x.current.matrixWorld.clone(),q=te.clone().invert(),J=l?1/c4(x.current.getWorldPosition(Gv),o,X.camera,g):1;M.current={clickPoint:Y,dir:K,mPLG:te,mPLGInv:q,offsetMultiplier:J},f({component:"Sphere",axis:e,origin:O,directions:[K]}),y&&(y.enabled=!1),X.target.setPointerCapture(X.pointerId)},[n,y,i,f,e,l,o,g]),k=w.useCallback(X=>{if(X.stopPropagation(),L||R(!0),M.current){const{clickPoint:Q,dir:Y,mPLG:O,mPLGInv:K,offsetMultiplier:te}=M.current,[q,J]=(t==null?void 0:t[e])||[1e-5,void 0],re=Jxe(Q,Y,X.ray.origin,X.ray.direction)*te,se=l?re:re/o;let ge=Math.pow(2,se*.2);X.shiftKey&&(ge=Math.round(ge*10)/10),ge=Math.max(ge,q/T.current),J!==void 0&&(ge=Math.min(ge,J/T.current)),I.current=T.current*ge,C.current.position.set(0,P+re,0),n&&(E.current.innerText=`${I.current.toFixed(2)}`),bv.set(1,1,1),bv.setComponent(e,ge),iO.makeScale(bv.x,bv.y,bv.z).premultiply(O).multiply(K),d(iO)}},[n,P,d,L,t,e]),z=w.useCallback(X=>{n&&(E.current.style.display="none"),X.stopPropagation(),T.current=I.current,M.current=null,C.current.position.set(0,P,0),m(),y&&(y.enabled=!0),X.target.releasePointerCapture(X.pointerId)},[n,y,m,P]),U=w.useCallback(X=>{X.stopPropagation(),R(!1)},[]),{radius:W,matrixL:$}=w.useMemo(()=>{const X=l?a/o*1.8:o/22.5,Q=new Xt().setFromUnitVectors(Zxe,i.clone().normalize()),Y=new Xe().makeRotationFromQuaternion(Q);return{radius:X,matrixL:Y}},[i,o,a,l]),oe=L?u:c[e];return w.createElement("group",{ref:x},w.createElement("group",{matrix:$,matrixAutoUpdate:!1,onPointerDown:F,onPointerMove:k,onPointerUp:z,onPointerOut:U},n&&w.createElement(CA,{position:[0,P/2,0]},w.createElement("div",{style:{display:"none",background:"#151520",color:"white",padding:"6px 8px",borderRadius:7,whiteSpace:"nowrap"},className:r,ref:E})),w.createElement("mesh",{ref:C,position:[0,P,0],renderOrder:500,userData:A},w.createElement("sphereGeometry",{args:[W,12,12]}),w.createElement("meshBasicMaterial",{transparent:!0,depthTest:s,color:oe,opacity:h,polygonOffset:!0,polygonOffsetFactor:-10}))))},rO=new Xe,sO=new Xe,oO=new Xe,P_=new Xe,FI=new Xe,u1=new Xe,aO=new Xe,lO=new Xe,cO=new Xe,h1=new ti,OI=new ti,uO=new H,hO=new H,fO=new H,dO=new H,Iv=new H,f1=new H(1,0,0),d1=new H(0,1,0),p1=new H(0,0,1),eEe=w.forwardRef(({enabled:i=!0,matrix:e,onDragStart:t,onDrag:n,onDragEnd:r,autoTransform:s=!0,anchor:o,disableAxes:a=!1,disableSliders:l=!1,disableRotations:c=!1,disableScaling:u=!1,activeAxes:h=[!0,!0,!0],offset:f=[0,0,0],rotation:d=[0,0,0],scale:m=1,lineWidth:A=4,fixed:g=!1,translationLimits:y,rotationLimits:E,scaleLimits:x,depthTest:C=!0,axisColors:T=["#ff2060","#20df80","#2080ff"],hoveredColor:I="#ffff40",annotations:M=!1,annotationsClass:L,opacity:R=1,visible:P=!0,userData:F,children:k,...z},U)=>{const W=Ve(J=>J.invalidate),$=w.useRef(null),oe=w.useRef(null),X=w.useRef(null),Q=w.useRef(null),Y=w.useRef([0,0,0]),O=w.useRef(new H(1,1,1)),K=w.useRef(new H(1,1,1));w.useLayoutEffect(()=>{o&&(Q.current.updateWorldMatrix(!0,!0),P_.copy(Q.current.matrixWorld).invert(),h1.makeEmpty(),Q.current.traverse(J=>{J.geometry&&(J.geometry.boundingBox||J.geometry.computeBoundingBox(),u1.copy(J.matrixWorld).premultiply(P_),OI.copy(J.geometry.boundingBox),OI.applyMatrix4(u1),h1.union(OI))}),uO.copy(h1.max).add(h1.min).multiplyScalar(.5),hO.copy(h1.max).sub(h1.min).multiplyScalar(.5),fO.copy(hO).multiply(new H(...o)).add(uO),dO.set(...f).add(fO),X.current.position.copy(dO),W())});const te=w.useMemo(()=>({onDragStart:J=>{rO.copy(oe.current.matrix),sO.copy(oe.current.matrixWorld),t&&t(J),W()},onDrag:J=>{oO.copy($.current.matrixWorld),P_.copy(oO).invert(),FI.copy(sO).premultiply(J),u1.copy(FI).premultiply(P_),aO.copy(rO).invert(),lO.copy(u1).multiply(aO),s&&oe.current.matrix.copy(u1),n&&n(u1,lO,FI,J),W()},onDragEnd:()=>{r&&r(),W()},translation:Y,translationLimits:y,rotationLimits:E,axisColors:T,hoveredColor:I,opacity:R,scale:m,lineWidth:A,fixed:g,depthTest:C,userData:F,annotations:M,annotationsClass:L}),[t,n,r,Y,y,E,x,C,m,A,g,...T,I,R,F,s,M,L]),q=new H;return Kt(J=>{if(g){const ie=c4(X.current.getWorldPosition(q),m,J.camera,J.size);O.current.setScalar(ie)}e&&e instanceof Xe&&(oe.current.matrix=e),oe.current.updateWorldMatrix(!0,!0),cO.makeRotationFromEuler(X.current.rotation).setPosition(X.current.position).premultiply(oe.current.matrixWorld),K.current.setFromMatrixScale(cO),Iv.copy(O.current).divide(K.current),(Math.abs(X.current.scale.x-Iv.x)>1e-4||Math.abs(X.current.scale.y-Iv.y)>1e-4||Math.abs(X.current.scale.z-Iv.z)>1e-4)&&(X.current.scale.copy(Iv),J.invalidate())}),w.useImperativeHandle(U,()=>oe.current,[]),w.createElement(Cx.Provider,{value:te},w.createElement("group",{ref:$},w.createElement("group",ot({ref:oe,matrix:e,matrixAutoUpdate:!1},z),w.createElement("group",{visible:P,ref:X,position:f,rotation:d},i&&w.createElement(w.Fragment,null,!a&&h[0]&&w.createElement(II,{axis:0,direction:f1}),!a&&h[1]&&w.createElement(II,{axis:1,direction:d1}),!a&&h[2]&&w.createElement(II,{axis:2,direction:p1}),!l&&h[0]&&h[1]&&w.createElement(DI,{axis:2,dir1:f1,dir2:d1}),!l&&h[0]&&h[2]&&w.createElement(DI,{axis:1,dir1:p1,dir2:f1}),!l&&h[2]&&h[1]&&w.createElement(DI,{axis:0,dir1:d1,dir2:p1}),!c&&h[0]&&h[1]&&w.createElement(BI,{axis:2,dir1:f1,dir2:d1}),!c&&h[0]&&h[2]&&w.createElement(BI,{axis:1,dir1:p1,dir2:f1}),!c&&h[2]&&h[1]&&w.createElement(BI,{axis:0,dir1:d1,dir2:p1}),!u&&h[0]&&w.createElement(kI,{axis:0,direction:f1}),!u&&h[1]&&w.createElement(kI,{axis:1,direction:d1}),!u&&h[2]&&w.createElement(kI,{axis:2,direction:p1}))),w.createElement("group",{ref:Q},k))))}),tEe=w.forwardRef(({options:i={video:!0},...e},t)=>{const n=Th(()=>navigator.mediaDevices.getDisplayMedia(i),[]);return w.useEffect(()=>()=>{n==null||n.getTracks().forEach(r=>r.stop()),px([])},[n]),w.createElement(S4,ot({ref:t},e,{src:n}))}),gj=w.forwardRef(({constraints:i={audio:!1,video:{facingMode:"user"}},...e},t)=>{const n=Th(()=>navigator.mediaDevices.getUserMedia(i),[]);return w.useEffect(()=>()=>{n==null||n.getTracks().forEach(r=>r.stop()),px([])},[n]),w.createElement(S4,ot({ref:t},e,{src:n}))}),nEe=new H(0,0,-1),iEe=(function(){const i=new H,e=new H,t=new H,n=new H,r=new H;return function(s,o,a,l){return i.copy(s),e.copy(o),t.copy(a),n.copy(e).sub(i),r.copy(t).sub(i),l.crossVectors(r,n).normalize()}})();function rEe(i,e){return i.clone().add(e).multiplyScalar(.5)}const Aj=w.forwardRef(({points:i=lS.SAMPLE_FACELANDMARKER_RESULT.faceLandmarks[0],face:e,facialTransformationMatrix:t,faceBlendshapes:n,offset:r,offsetScalar:s=80,width:o,height:a,depth:l=1,verticalTri:c=[159,386,152],origin:u,eyes:h=!0,eyesAsOrigin:f=!1,debug:d=!1,children:m,...A},g)=>{var y;e&&(i=e.keypoints,console.warn("Facemesh `face` prop is deprecated: use `points` instead"));const E=w.useRef(null),x=w.useRef(null),C=w.useRef(null),T=w.useRef(null),I=w.useRef(null),M=w.useRef(null),L=w.useRef(null),[R]=w.useState(()=>new H),[P]=w.useState(()=>new _n),[F]=w.useState(()=>new Xt),[k]=w.useState(()=>new H),{invalidate:z}=Ve();w.useEffect(()=>{var Q;(Q=I.current)==null||Q.geometry.setIndex(lS.TRIANGULATION)},[]);const[U]=w.useState(()=>new H);w.useEffect(()=>{var Q,Y;const O=(Q=I.current)==null?void 0:Q.geometry;if(!O)return;if(O.setFromPoints(i),O.setDrawRange(0,lS.TRIANGULATION.length),t)if(P.matrix.fromArray(t.data),P.matrix.decompose(P.position,P.quaternion,P.scale),P.rotation.y*=-1,P.rotation.z*=-1,F.setFromEuler(P.rotation),r){var K;P.position.y*=-1,P.position.z*=-1,(K=E.current)==null||K.position.copy(P.position.divideScalar(s))}else{var te;(te=E.current)==null||te.position.set(0,0,0)}else iEe(i[c[0]],i[c[1]],i[c[2]],R),F.setFromUnitVectors(nEe,R);const q=F.clone().invert();if(O.computeBoundingBox(),d&&z(),O.center(),O.applyQuaternion(q),(Y=T.current)==null||Y.setRotationFromQuaternion(F),h){if(!n)console.warn("Facemesh `eyes` option only works if `faceBlendshapes` is provided: skipping.");else if(M.current&&L.current&&C.current)if(f){const J=M.current._computeSphere(O),ie=L.current._computeSphere(O);u=rEe(J.center,ie.center).negate(),M.current._update(O,n,J),L.current._update(O,n,ie)}else M.current._update(O,n),L.current._update(O,n)}if(C.current){if(u!==void 0)if(typeof u=="number"){const J=O.getAttribute("position");k.set(-J.getX(u),-J.getY(u),-J.getZ(u))}else u.isVector3&&k.copy(u);else k.setScalar(0);C.current.position.copy(k)}if(x.current){let J=1;(o||a||l)&&(O.boundingBox.getSize(U),o&&(J=o/U.x),a&&(J=a/U.y),l&&(J=l/U.z)),x.current.scale.setScalar(J!==1?J:1)}O.computeVertexNormals(),O.attributes.position.needsUpdate=!0},[i,t,n,P,r,s,o,a,l,c,u,h,d,z,R,F,U,k]);const W=w.useMemo(()=>({outerRef:T,meshRef:I,eyeRightRef:M,eyeLeftRef:L}),[]);w.useImperativeHandle(g,()=>W,[W]);const[$]=w.useState(()=>new H),oe=(y=I.current)==null?void 0:y.geometry.boundingBox,X=(oe==null?void 0:oe.getSize($).z)||1;return w.createElement("group",A,w.createElement("group",{ref:E},w.createElement("group",{ref:T},w.createElement("group",{ref:x},d?w.createElement(w.Fragment,null,w.createElement("axesHelper",{args:[X]}),w.createElement(Cu,{points:[[0,0,0],[0,0,-X]],color:65535})):null,w.createElement("group",{ref:C},h&&n&&w.createElement("group",{name:"eyes"},w.createElement(Q5,{side:"left",ref:M,debug:d}),w.createElement(Q5,{side:"right",ref:L,debug:d})),w.createElement("mesh",{ref:I,name:"face"},m,d?w.createElement(w.Fragment,null,oe&&w.createElement("box3Helper",{args:[oe]})):null))))))}),C1={contourLandmarks:{right:[33,133,159,145,153],left:[263,362,386,374,380]},blendshapes:{right:[14,16,18,12],left:[13,15,17,11]},color:{right:"red",left:"#00ff00"},fov:{horizontal:100,vertical:90}},Q5=w.forwardRef(({side:i,debug:e=!0},t)=>{const n=w.useRef(null),r=w.useRef(null),[s]=w.useState(()=>new Bi),o=w.useCallback(h=>{const f=h.getAttribute("position"),m=C1.contourLandmarks[i].map(A=>new H(f.getX(A),f.getY(A),f.getZ(A)));return s.center.set(0,0,0),m.forEach(A=>s.center.add(A)),s.center.divideScalar(m.length),s.radius=m[0].sub(m[1]).length()/2,s},[s,i]),[a]=w.useState(()=>new Eo),l=w.useCallback((h,f,d)=>{if(n.current){var m;(m=d)!==null&&m!==void 0||(d=o(h)),n.current.position.copy(d.center),n.current.scale.setScalar(d.radius)}if(f&&r.current){const A=C1.blendshapes[i],g=f.categories[A[0]].score,y=f.categories[A[1]].score,E=f.categories[A[2]].score,x=f.categories[A[3]].score,C=C1.fov.horizontal*un.DEG2RAD,T=C1.fov.vertical*un.DEG2RAD,I=C*.5*(x-E),M=T*.5*(g-y)*(i==="left"?1:-1);a.set(I,M,0),r.current.setRotationFromEuler(a)}},[o,i,a]),c=w.useMemo(()=>({eyeMeshRef:n,irisDirRef:r,_computeSphere:o,_update:l}),[o,l]);w.useImperativeHandle(t,()=>c,[c]);const u=C1.color[i];return w.createElement("group",null,w.createElement("group",{ref:n},e&&w.createElement("axesHelper",null),w.createElement("group",{ref:r},w.createElement(w.Fragment,null,e&&w.createElement(Cu,{points:[[0,0,0],[0,0,-2]],lineWidth:1,color:u})))))}),lS={TRIANGULATION:[127,34,139,11,0,37,232,231,120,72,37,39,128,121,47,232,121,128,104,69,67,175,171,148,157,154,155,118,50,101,73,39,40,9,151,108,48,115,131,194,204,211,74,40,185,80,42,183,40,92,186,230,229,118,202,212,214,83,18,17,76,61,146,160,29,30,56,157,173,106,204,194,135,214,192,203,165,98,21,71,68,51,45,4,144,24,23,77,146,91,205,50,187,201,200,18,91,106,182,90,91,181,85,84,17,206,203,36,148,171,140,92,40,39,193,189,244,159,158,28,247,246,161,236,3,196,54,68,104,193,168,8,117,228,31,189,193,55,98,97,99,126,47,100,166,79,218,155,154,26,209,49,131,135,136,150,47,126,217,223,52,53,45,51,134,211,170,140,67,69,108,43,106,91,230,119,120,226,130,247,63,53,52,238,20,242,46,70,156,78,62,96,46,53,63,143,34,227,173,155,133,123,117,111,44,125,19,236,134,51,216,206,205,154,153,22,39,37,167,200,201,208,36,142,100,57,212,202,20,60,99,28,158,157,35,226,113,160,159,27,204,202,210,113,225,46,43,202,204,62,76,77,137,123,116,41,38,72,203,129,142,64,98,240,49,102,64,41,73,74,212,216,207,42,74,184,169,170,211,170,149,176,105,66,69,122,6,168,123,147,187,96,77,90,65,55,107,89,90,180,101,100,120,63,105,104,93,137,227,15,86,85,129,102,49,14,87,86,55,8,9,100,47,121,145,23,22,88,89,179,6,122,196,88,95,96,138,172,136,215,58,172,115,48,219,42,80,81,195,3,51,43,146,61,171,175,199,81,82,38,53,46,225,144,163,110,246,33,7,52,65,66,229,228,117,34,127,234,107,108,69,109,108,151,48,64,235,62,78,191,129,209,126,111,35,143,163,161,246,117,123,50,222,65,52,19,125,141,221,55,65,3,195,197,25,7,33,220,237,44,70,71,139,122,193,245,247,130,33,71,21,162,153,158,159,170,169,150,188,174,196,216,186,92,144,160,161,2,97,167,141,125,241,164,167,37,72,38,12,145,159,160,38,82,13,63,68,71,226,35,111,158,153,154,101,50,205,206,92,165,209,198,217,165,167,97,220,115,218,133,112,243,239,238,241,214,135,169,190,173,133,171,208,32,125,44,237,86,87,178,85,86,179,84,85,180,83,84,181,201,83,182,137,93,132,76,62,183,61,76,184,57,61,185,212,57,186,214,207,187,34,143,156,79,239,237,123,137,177,44,1,4,201,194,32,64,102,129,213,215,138,59,166,219,242,99,97,2,94,141,75,59,235,24,110,228,25,130,226,23,24,229,22,23,230,26,22,231,112,26,232,189,190,243,221,56,190,28,56,221,27,28,222,29,27,223,30,29,224,247,30,225,238,79,20,166,59,75,60,75,240,147,177,215,20,79,166,187,147,213,112,233,244,233,128,245,128,114,188,114,217,174,131,115,220,217,198,236,198,131,134,177,132,58,143,35,124,110,163,7,228,110,25,356,389,368,11,302,267,452,350,349,302,303,269,357,343,277,452,453,357,333,332,297,175,152,377,384,398,382,347,348,330,303,304,270,9,336,337,278,279,360,418,262,431,304,408,409,310,415,407,270,409,410,450,348,347,422,430,434,313,314,17,306,307,375,387,388,260,286,414,398,335,406,418,364,367,416,423,358,327,251,284,298,281,5,4,373,374,253,307,320,321,425,427,411,421,313,18,321,405,406,320,404,405,315,16,17,426,425,266,377,400,369,322,391,269,417,465,464,386,257,258,466,260,388,456,399,419,284,332,333,417,285,8,346,340,261,413,441,285,327,460,328,355,371,329,392,439,438,382,341,256,429,420,360,364,394,379,277,343,437,443,444,283,275,440,363,431,262,369,297,338,337,273,375,321,450,451,349,446,342,467,293,334,282,458,461,462,276,353,383,308,324,325,276,300,293,372,345,447,382,398,362,352,345,340,274,1,19,456,248,281,436,427,425,381,256,252,269,391,393,200,199,428,266,330,329,287,273,422,250,462,328,258,286,384,265,353,342,387,259,257,424,431,430,342,353,276,273,335,424,292,325,307,366,447,345,271,303,302,423,266,371,294,455,460,279,278,294,271,272,304,432,434,427,272,407,408,394,430,431,395,369,400,334,333,299,351,417,168,352,280,411,325,319,320,295,296,336,319,403,404,330,348,349,293,298,333,323,454,447,15,16,315,358,429,279,14,15,316,285,336,9,329,349,350,374,380,252,318,402,403,6,197,419,318,319,325,367,364,365,435,367,397,344,438,439,272,271,311,195,5,281,273,287,291,396,428,199,311,271,268,283,444,445,373,254,339,263,466,249,282,334,296,449,347,346,264,447,454,336,296,299,338,10,151,278,439,455,292,407,415,358,371,355,340,345,372,390,249,466,346,347,280,442,443,282,19,94,370,441,442,295,248,419,197,263,255,359,440,275,274,300,383,368,351,412,465,263,467,466,301,368,389,380,374,386,395,378,379,412,351,419,436,426,322,373,390,388,2,164,393,370,462,461,164,0,267,302,11,12,374,373,387,268,12,13,293,300,301,446,261,340,385,384,381,330,266,425,426,423,391,429,355,437,391,327,326,440,457,438,341,382,362,459,457,461,434,430,394,414,463,362,396,369,262,354,461,457,316,403,402,315,404,403,314,405,404,313,406,405,421,418,406,366,401,361,306,408,407,291,409,408,287,410,409,432,436,410,434,416,411,264,368,383,309,438,457,352,376,401,274,275,4,421,428,262,294,327,358,433,416,367,289,455,439,462,370,326,2,326,370,305,460,455,254,449,448,255,261,446,253,450,449,252,451,450,256,452,451,341,453,452,413,464,463,441,413,414,258,442,441,257,443,442,259,444,443,260,445,444,467,342,445,459,458,250,289,392,290,290,328,460,376,433,435,250,290,392,411,416,433,341,463,464,453,464,465,357,465,412,343,412,399,360,363,440,437,399,456,420,456,363,401,435,288,372,383,353,339,255,249,448,261,255,133,243,190,133,155,112,33,246,247,33,130,25,398,384,286,362,398,414,362,463,341,263,359,467,263,249,255,466,467,260,75,60,166,238,239,79,162,127,139,72,11,37,121,232,120,73,72,39,114,128,47,233,232,128,103,104,67,152,175,148,173,157,155,119,118,101,74,73,40,107,9,108,49,48,131,32,194,211,184,74,185,191,80,183,185,40,186,119,230,118,210,202,214,84,83,17,77,76,146,161,160,30,190,56,173,182,106,194,138,135,192,129,203,98,54,21,68,5,51,4,145,144,23,90,77,91,207,205,187,83,201,18,181,91,182,180,90,181,16,85,17,205,206,36,176,148,140,165,92,39,245,193,244,27,159,28,30,247,161,174,236,196,103,54,104,55,193,8,111,117,31,221,189,55,240,98,99,142,126,100,219,166,218,112,155,26,198,209,131,169,135,150,114,47,217,224,223,53,220,45,134,32,211,140,109,67,108,146,43,91,231,230,120,113,226,247,105,63,52,241,238,242,124,46,156,95,78,96,70,46,63,116,143,227,116,123,111,1,44,19,3,236,51,207,216,205,26,154,22,165,39,167,199,200,208,101,36,100,43,57,202,242,20,99,56,28,157,124,35,113,29,160,27,211,204,210,124,113,46,106,43,204,96,62,77,227,137,116,73,41,72,36,203,142,235,64,240,48,49,64,42,41,74,214,212,207,183,42,184,210,169,211,140,170,176,104,105,69,193,122,168,50,123,187,89,96,90,66,65,107,179,89,180,119,101,120,68,63,104,234,93,227,16,15,85,209,129,49,15,14,86,107,55,9,120,100,121,153,145,22,178,88,179,197,6,196,89,88,96,135,138,136,138,215,172,218,115,219,41,42,81,5,195,51,57,43,61,208,171,199,41,81,38,224,53,225,24,144,110,105,52,66,118,229,117,227,34,234,66,107,69,10,109,151,219,48,235,183,62,191,142,129,126,116,111,143,7,163,246,118,117,50,223,222,52,94,19,141,222,221,65,196,3,197,45,220,44,156,70,139,188,122,245,139,71,162,145,153,159,149,170,150,122,188,196,206,216,92,163,144,161,164,2,167,242,141,241,0,164,37,11,72,12,144,145,160,12,38,13,70,63,71,31,226,111,157,158,154,36,101,205,203,206,165,126,209,217,98,165,97,237,220,218,237,239,241,210,214,169,140,171,32,241,125,237,179,86,178,180,85,179,181,84,180,182,83,181,194,201,182,177,137,132,184,76,183,185,61,184,186,57,185,216,212,186,192,214,187,139,34,156,218,79,237,147,123,177,45,44,4,208,201,32,98,64,129,192,213,138,235,59,219,141,242,97,97,2,141,240,75,235,229,24,228,31,25,226,230,23,229,231,22,230,232,26,231,233,112,232,244,189,243,189,221,190,222,28,221,223,27,222,224,29,223,225,30,224,113,247,225,99,60,240,213,147,215,60,20,166,192,187,213,243,112,244,244,233,245,245,128,188,188,114,174,134,131,220,174,217,236,236,198,134,215,177,58,156,143,124,25,110,7,31,228,25,264,356,368,0,11,267,451,452,349,267,302,269,350,357,277,350,452,357,299,333,297,396,175,377,381,384,382,280,347,330,269,303,270,151,9,337,344,278,360,424,418,431,270,304,409,272,310,407,322,270,410,449,450,347,432,422,434,18,313,17,291,306,375,259,387,260,424,335,418,434,364,416,391,423,327,301,251,298,275,281,4,254,373,253,375,307,321,280,425,411,200,421,18,335,321,406,321,320,405,314,315,17,423,426,266,396,377,369,270,322,269,413,417,464,385,386,258,248,456,419,298,284,333,168,417,8,448,346,261,417,413,285,326,327,328,277,355,329,309,392,438,381,382,256,279,429,360,365,364,379,355,277,437,282,443,283,281,275,363,395,431,369,299,297,337,335,273,321,348,450,349,359,446,467,283,293,282,250,458,462,300,276,383,292,308,325,283,276,293,264,372,447,346,352,340,354,274,19,363,456,281,426,436,425,380,381,252,267,269,393,421,200,428,371,266,329,432,287,422,290,250,328,385,258,384,446,265,342,386,387,257,422,424,430,445,342,276,422,273,424,306,292,307,352,366,345,268,271,302,358,423,371,327,294,460,331,279,294,303,271,304,436,432,427,304,272,408,395,394,431,378,395,400,296,334,299,6,351,168,376,352,411,307,325,320,285,295,336,320,319,404,329,330,349,334,293,333,366,323,447,316,15,315,331,358,279,317,14,316,8,285,9,277,329,350,253,374,252,319,318,403,351,6,419,324,318,325,397,367,365,288,435,397,278,344,439,310,272,311,248,195,281,375,273,291,175,396,199,312,311,268,276,283,445,390,373,339,295,282,296,448,449,346,356,264,454,337,336,299,337,338,151,294,278,455,308,292,415,429,358,355,265,340,372,388,390,466,352,346,280,295,442,282,354,19,370,285,441,295,195,248,197,457,440,274,301,300,368,417,351,465,251,301,389,385,380,386,394,395,379,399,412,419,410,436,322,387,373,388,326,2,393,354,370,461,393,164,267,268,302,12,386,374,387,312,268,13,298,293,301,265,446,340,380,385,381,280,330,425,322,426,391,420,429,437,393,391,326,344,440,438,458,459,461,364,434,394,428,396,262,274,354,457,317,316,402,316,315,403,315,314,404,314,313,405,313,421,406,323,366,361,292,306,407,306,291,408,291,287,409,287,432,410,427,434,411,372,264,383,459,309,457,366,352,401,1,274,4,418,421,262,331,294,358,435,433,367,392,289,439,328,462,326,94,2,370,289,305,455,339,254,448,359,255,446,254,253,449,253,252,450,252,256,451,256,341,452,414,413,463,286,441,414,286,258,441,258,257,442,257,259,443,259,260,444,260,467,445,309,459,250,305,289,290,305,290,460,401,376,435,309,250,392,376,411,433,453,341,464,357,453,465,343,357,412,437,343,399,344,360,440,420,437,456,360,420,363,361,401,288,265,372,353,390,339,249,339,448,255],SAMPLE_FACE:{keypoints:[{x:356.2804412841797,y:295.1960563659668,z:-23.786449432373047,name:"lips"},{x:354.8859405517578,y:264.69520568847656,z:-36.718435287475586},{x:355.2180862426758,y:275.3360366821289,z:-21.183712482452393},{x:347.349853515625,y:242.4400234222412,z:-25.093655586242676},{x:354.40135955810547,y:256.67933464050293,z:-38.23572635650635},{x:353.7689971923828,y:247.54886627197266,z:-34.5475435256958},{x:352.1288299560547,y:227.34312057495117,z:-13.095386028289795},{x:303.5013198852539,y:234.67002868652344,z:12.500141859054565,name:"rightEye"},{x:351.09378814697266,y:211.87547206878662,z:-6.413471698760986},{x:350.7115936279297,y:202.1251630783081,z:-6.413471698760986},{x:348.33667755126953,y:168.7741756439209,z:6.483500003814697,name:"faceOval"},{x:356.4806365966797,y:299.2995357513428,z:-23.144519329071045},{x:356.5511703491211,y:302.66146659851074,z:-21.020312309265137},{x:356.6239547729492,y:304.1536331176758,z:-18.137459754943848,name:"lips"},{x:356.5807342529297,y:305.1840591430664,z:-18.767719268798828,name:"lips"},{x:356.8241500854492,y:308.25711250305176,z:-20.16829490661621},{x:357.113037109375,y:312.26277351379395,z:-22.10575819015503},{x:357.34962463378906,y:317.1123218536377,z:-21.837315559387207,name:"lips"},{x:357.6658630371094,y:325.51036834716797,z:-16.27002477645874},{x:355.0201416015625,y:269.36279296875,z:-33.73054027557373},{x:348.5237503051758,y:270.33411026000977,z:-24.93025302886963},{x:279.97331619262695,y:213.24176788330078,z:47.759642601013184,name:"faceOval"},{x:322.66529083251953,y:238.5027265548706,z:5.535193085670471},{x:316.0983657836914,y:239.94489669799805,z:5.777376294136047},{x:309.9431610107422,y:240.24518966674805,z:7.510589361190796},{x:301.31994247436523,y:237.86138534545898,z:13.118728399276733},{x:328.14266204833984,y:235.80496788024902,z:6.646900177001953},{x:313.7326431274414,y:222.11161136627197,z:3.9887237548828125},{x:320.45196533203125,y:221.87729358673096,z:4.601476192474365},{x:307.35679626464844,y:223.63793849945068,z:5.932023525238037},{x:303.0031204223633,y:226.3743782043457,z:8.479321002960205},{x:296.80023193359375,y:242.94299125671387,z:15.931552648544312},{x:332.2352981567383,y:340.77341079711914,z:-10.165848731994629},{x:301.38587951660156,y:233.46447944641113,z:14.764405488967896,name:"rightEye"},{x:279.0147018432617,y:244.37155723571777,z:45.77549457550049},{x:289.60548400878906,y:239.1807460784912,z:23.191204071044922},{x:320.32257080078125,y:267.1292781829834,z:-4.954537749290466},{x:347.64583587646484,y:294.4955062866211,z:-23.062820434570312,name:"lips"},{x:349.28138732910156,y:303.1095886230469,z:-20.238323211669922},{x:338.9453125,y:298.19186210632324,z:-19.456336498260498,name:"lips"},{x:333.36788177490234,y:302.6706790924072,z:-14.776077270507812,name:"lips"},{x:342.89188385009766,y:304.3561363220215,z:-17.752301692962646},{x:337.7375030517578,y:306.0098361968994,z:-13.410515785217285},{x:325.6159210205078,y:316.22995376586914,z:-6.681914925575256},{x:349.0104675292969,y:264.9818515777588,z:-36.274919509887695},{x:347.7138900756836,y:257.5664806365967,z:-37.67549514770508},{x:291.79357528686523,y:218.88171672821045,z:11.578094959259033,name:"rightEyebrow"},{x:332.2689437866211,y:247.56946563720703,z:-3.3730539679527283},{x:332.0074462890625,y:267.1201229095459,z:-19.969879388809204},{x:331.27952575683594,y:263.6967658996582,z:-17.47218608856201},{x:301.04373931884766,y:269.56552505493164,z:3.61815482378006},{x:347.4863815307617,y:249.0706443786621,z:-32.633421421051025},{x:307.26118087768555,y:208.2646894454956,z:1.1591226607561111,name:"rightEyebrow"},{x:297.91919708251953,y:212.22604751586914,z:5.914516448974609,name:"rightEyebrow"},{x:285.1651382446289,y:197.98450469970703,z:36.391637325286865,name:"faceOval"},{x:337.04097747802734,y:211.25229835510254,z:-4.548954665660858},{x:326.5912628173828,y:223.16698551177979,z:6.670243740081787},{x:320.05664825439453,y:309.5834255218506,z:-4.055835008621216},{x:289.6866226196289,y:314.617395401001,z:53.875489234924316,name:"faceOval"},{x:337.4256896972656,y:270.8755302429199,z:-17.67060160636902},{x:343.69922637939453,y:273.0000400543213,z:-18.756048679351807},{x:327.4242401123047,y:309.22399520874023,z:-4.703601002693176,name:"lips"},{x:330.37220001220703,y:308.3323001861572,z:-6.442649960517883},{x:293.87027740478516,y:207.7961826324463,z:9.821539521217346,name:"rightEyebrow"},{x:332.11437225341797,y:271.22812271118164,z:-16.64351224899292},{x:320.1197814941406,y:207.40366458892822,z:-2.48164564371109,name:"rightEyebrow"},{x:318.59575271606445,y:201.07443809509277,z:-3.110446035861969,name:"rightEyebrow"},{x:310.72303771972656,y:175.75075149536133,z:13.328815698623657,name:"faceOval"},{x:289.67578887939453,y:202.29835510253906,z:21.370456218719482},{x:315.30879974365234,y:187.35260009765625,z:5.0304025411605835},{x:287.8936767578125,y:216.54793739318848,z:17.81065821647644,name:"rightEyebrow"},{x:283.9391899108887,y:215.01142501831055,z:32.04984903335571},{x:348.35330963134766,y:299.4155788421631,z:-22.47924566268921},{x:341.1790466308594,y:301.8221855163574,z:-18.977805376052856},{x:335.69713592529297,y:304.4266891479492,z:-14.682706594467163},{x:339.4615173339844,y:272.3654365539551,z:-16.38674020767212},{x:328.99600982666016,y:308.86685371398926,z:-5.616893768310547},{x:332.00313568115234,y:309.1875743865967,z:-10.335084199905396},{x:331.0068130493164,y:307.9274368286133,z:-6.681914925575256,name:"lips"},{x:341.13792419433594,y:266.4876937866211,z:-26.56425952911377},{x:339.02950286865234,y:305.6663703918457,z:-12.33674168586731,name:"lips"},{x:344.22935485839844,y:304.9452781677246,z:-15.161235332489014,name:"lips"},{x:350.1844024658203,y:304.374303817749,z:-17.5305438041687,name:"lips"},{x:348.52630615234375,y:325.9562301635742,z:-16.164982318878174},{x:348.6581802368164,y:317.1624183654785,z:-21.510512828826904,name:"lips"},{x:348.9766311645508,y:312.1923065185547,z:-21.708929538726807},{x:349.2427444458008,y:308.0660820007324,z:-19.643079042434692},{x:349.67491149902344,y:305.42747497558594,z:-18.16080331802368,name:"lips"},{x:337.95589447021484,y:306.6535949707031,z:-12.803598642349243,name:"lips"},{x:337.06878662109375,y:307.63169288635254,z:-14.274203777313232},{x:335.77449798583984,y:309.8449516296387,z:-15.698124170303345},{x:334.6099090576172,y:312.7997016906738,z:-14.764405488967896,name:"lips"},{x:327.2330856323242,y:293.80866050720215,z:-11.864047050476074},{x:280.97679138183594,y:279.79928970336914,z:68.90834331512451,name:"faceOval"},{x:355.13843536376953,y:271.7875671386719,z:-25.350427627563477},{x:334.7235870361328,y:307.4656391143799,z:-9.302158951759338,name:"lips"},{x:333.5293960571289,y:307.89782524108887,z:-10.200862884521484},{x:346.29688262939453,y:276.4256286621094,z:-19.748122692108154},{x:335.16246795654297,y:276.22097969055176,z:-12.313398122787476},{x:345.09132385253906,y:274.7082996368408,z:-19.304605722427368},{x:325.4267883300781,y:252.95130729675293,z:-1.6661019623279572},{x:315.347843170166,y:259.05200958251953,z:-.25604281574487686},{x:330.44933319091797,y:267.7570152282715,z:-14.017432928085327},{x:294.96768951416016,y:185.26001930236816,z:23.903164863586426,name:"faceOval"},{x:299.63531494140625,y:192.7913761138916,z:12.640198469161987},{x:304.5452117919922,y:202.4142837524414,z:3.244667649269104,name:"rightEyebrow"},{x:331.6915512084961,y:320.0467872619629,z:-10.632705688476562},{x:334.5911407470703,y:201.27566814422607,z:-6.133356094360352,name:"rightEyebrow"},{x:331.4815902709961,y:185.44180870056152,z:.6627205014228821},{x:328.05816650390625,y:170.8385467529297,z:7.358860373497009,name:"faceOval"},{x:304.49764251708984,y:239.76297855377197,z:10.387605428695679},{x:290.6382179260254,y:248.85257720947266,z:19.03616428375244},{x:331.5682601928711,y:233.20727348327637,z:7.837390303611755},{x:295.5115509033203,y:228.9834451675415,z:14.41426157951355},{x:336.94332122802734,y:241.8259334564209,z:-5.27842104434967},{x:336.2792205810547,y:262.7049922943115,z:-26.12074375152588},{x:284.4102478027344,y:255.3262710571289,z:25.467140674591064},{x:295.1420593261719,y:253.02655220031738,z:12.430112361907959},{x:303.5196113586426,y:254.20703887939453,z:6.139191389083862},{x:315.73450088500977,y:251.64799690246582,z:3.3788898587226868},{x:324.69661712646484,y:247.56494522094727,z:2.3328344523906708},{x:331.57970428466797,y:243.02241325378418,z:1.1423448473215103},{x:345.6210708618164,y:229.9976634979248,z:-10.825285911560059},{x:286.26644134521484,y:270.37991523742676,z:21.708929538726807},{x:290.2525520324707,y:228.4921360015869,z:17.71728754043579},{x:351.65367126464844,y:269.3400764465332,z:-33.450424671173096},{x:333.1378936767578,y:253.88388633728027,z:-7.230473756790161},{x:277.8318977355957,y:246.95331573486328,z:68.20805549621582,name:"faceOval"},{x:336.6680908203125,y:238.10003757476807,z:.7688578963279724},{x:329.95800018310547,y:269.18323516845703,z:-7.207130789756775},{x:299.17491912841797,y:234.13324356079102,z:15.95489501953125},{x:335.61729431152344,y:258.71752738952637,z:-23.016133308410645},{x:284.1079330444336,y:297.0343494415283,z:63.25934886932373,name:"faceOval"},{x:331.44542694091797,y:230.6892442703247,z:9.92658257484436,name:"rightEye"},{x:341.41536712646484,y:253.01264762878418,z:-29.038610458374023},{x:303.5472869873047,y:327.5896739959717,z:16.725212335586548},{x:304.7756576538086,y:337.4389457702637,z:27.38126277923584,name:"faceOval"},{x:280.80501556396484,y:275.32050132751465,z:45.0752067565918},{x:295.43582916259766,y:318.4501647949219,z:26.2608003616333},{x:281.4303207397461,y:228.7355661392212,z:40.94350814819336},{x:331.2549591064453,y:349.4216537475586,z:-7.376367449760437},{x:352.4247741699219,y:271.7330074310303,z:-24.953596591949463},{x:327.5672912597656,y:260.41900634765625,z:-5.456410646438599},{x:284.5432472229004,y:241.7647933959961,z:29.668869972229004},{x:310,y:235.66174507141113,z:8.502663969993591,name:"rightEye"},{x:315.7071113586426,y:235.7572603225708,z:6.938687562942505,name:"rightEye"},{x:330.41088104248047,y:311.04143142700195,z:-9.325502514839172,name:"lips"},{x:288.5377502441406,y:285.31983375549316,z:21.837315559387207},{x:344.55039978027344,y:359.4300842285156,z:-6.705257892608643,name:"faceOval"},{x:323.41880798339844,y:351.67362213134766,z:7.802375555038452,name:"faceOval"},{x:314.64088439941406,y:346.11894607543945,z:16.36339783668518,name:"faceOval"},{x:349.4945526123047,y:184.8434829711914,z:-.21847527474164963},{x:359.24694061279297,y:359.8348903656006,z:-8.403456211090088,name:"faceOval"},{x:321.26182556152344,y:234.64492321014404,z:6.90950870513916,name:"rightEye"},{x:326.318359375,y:232.90250301361084,z:8.029969334602356,name:"rightEye"},{x:329.6211624145508,y:231.6195774078369,z:9.722331762313843,name:"rightEye"},{x:285.9398078918457,y:228.2351303100586,z:24.650139808654785},{x:325.79288482666016,y:227.88007736206055,z:7.469738721847534,name:"rightEye"},{x:320.1699447631836,y:227.5934886932373,z:6.168370842933655,name:"rightEye"},{x:314.85408782958984,y:227.85282611846924,z:6.2675780057907104,name:"rightEye"},{x:309.3084907531738,y:229.1516876220703,z:7.7031683921813965,name:"rightEye"},{x:305.5621337890625,y:230.92366218566895,z:9.722331762313843,name:"rightEye"},{x:277.8681945800781,y:228.5354232788086,z:59.71122741699219,name:"faceOval"},{x:306.1444664001465,y:235.1954698562622,z:10.603528022766113,name:"rightEye"},{x:355.4478454589844,y:281.96210861206055,z:-20.565123558044434},{x:333.02661895751953,y:288.0105400085449,z:-14.72939133644104},{x:337.15728759765625,y:269.2059516906738,z:-19.8414945602417},{x:345.9898376464844,y:283.5453128814697,z:-20.4834246635437},{x:351.48963928222656,y:219.98916149139404,z:-7.0378947257995605},{x:312.39574432373047,y:336.50628089904785,z:8.671900033950806},{x:321.32152557373047,y:343.1755256652832,z:.9067271649837494},{x:343.78379821777344,y:353.2975959777832,z:-14.355905055999756},{x:296.8791389465332,y:327.91497230529785,z:41.01353645324707,name:"faceOval"},{x:329.6939468383789,y:229.27897453308105,z:8.934508562088013,name:"rightEye"},{x:341.6905212402344,y:241.4073657989502,z:-14.589333534240723},{x:359.03079986572266,y:353.48859786987305,z:-15.803166627883911},{x:333.1861877441406,y:356.43213272094727,z:-1.0234417766332626,name:"faceOval"},{x:283.97483825683594,y:291.4318656921387,z:41.94725513458252},{x:343.33770751953125,y:305.830135345459,z:-15.756480693817139,name:"lips"},{x:342.40283966064453,y:307.7453899383545,z:-17.4021577835083},{x:341.53621673583984,y:311.0595703125,z:-19.047834873199463},{x:340.9107208251953,y:315.4837703704834,z:-18.5576331615448,name:"lips"},{x:339.1478729248047,y:323.42233657836914,z:-14.367576837539673},{x:333.3201599121094,y:307.4406337738037,z:-9.617288708686829},{x:331.2411117553711,y:306.9811820983887,z:-9.669809937477112},{x:329.23255920410156,y:306.0508346557617,z:-9.582273960113525,name:"lips"},{x:322.4586486816406,y:301.33323669433594,z:-7.720675468444824},{x:297.1712112426758,y:286.9552803039551,z:8.240055441856384},{x:341.3060760498047,y:235.4432201385498,z:-7.504753470420837},{x:336.9318389892578,y:224.3451976776123,z:5.829898118972778},{x:332.65323638916016,y:226.70403957366943,z:8.105834126472473},{x:334.67357635498047,y:306.4397621154785,z:-8.981193900108337,name:"lips"},{x:297.4601936340332,y:306.29210472106934,z:15.476365089416504},{x:342.9119110107422,y:222.37077713012695,z:-2.754466235637665},{x:335.4629898071289,y:332.20250129699707,z:-11.823196411132812},{x:353.2412338256836,y:240.56339263916016,z:-27.147831916809082},{x:346.3080596923828,y:236.41446590423584,z:-18.452589511871338},{x:352.6475143432617,y:234.1420555114746,z:-19.748122692108154},{x:337.3209762573242,y:253.39937210083008,z:-16.024924516677856},{x:358.6122131347656,y:344.90861892700195,z:-18.592647314071655},{x:358.1117248535156,y:334.64990615844727,z:-17.49552845954895},{x:346.4450454711914,y:335.0321102142334,z:-16.32838249206543},{x:319.17640686035156,y:320.2833938598633,z:-3.276764452457428},{x:325.2540588378906,y:276.2369728088379,z:-6.460157036781311},{x:326.7214584350586,y:327.3939514160156,z:-7.417217493057251},{x:310.7190132141113,y:277.2265148162842,z:-3.5452082753181458},{x:319.78355407714844,y:284.8238182067871,z:-6.4543211460113525},{x:305.773983001709,y:290.83580017089844,z:.06907138042151928},{x:344.4001770019531,y:344.85408782958984,z:-16.946970224380493},{x:333.1879425048828,y:258.74256134033203,z:-11.90489649772644},{x:313.80598068237305,y:327.08919525146484,z:2.2277912497520447},{x:322.9637908935547,y:334.6819496154785,z:-3.3643004298210144},{x:313.4055519104004,y:311.2166690826416,z:-1.1175429821014404},{x:291.0865783691406,y:298.2831001281738,z:22.467575073242188},{x:305.6580924987793,y:313.3707904815674,z:5.561453700065613},{x:288.23760986328125,y:305.9941864013672,z:36.765122413635254},{x:315.10692596435547,y:296.26991271972656,z:-4.604393839836121},{x:337.50518798828125,y:247.5944423675537,z:-10.597691535949707},{x:338.8450622558594,y:265.47778129577637,z:-27.778091430664062},{x:334.25254821777344,y:269.0671920776367,z:-20.938611030578613},{x:341.64512634277344,y:259.6387195587158,z:-32.189905643463135},{x:331.44081115722656,y:219.0976095199585,z:4.207563698291779},{x:320.56339263916016,y:216.49658203125,z:2.930997312068939},{x:311.21912002563477,y:216.57853603363037,z:2.9674705862998962},{x:303.46256256103516,y:218.54614734649658,z:5.357203483581543},{x:297.99999237060547,y:222.505202293396,z:9.325502514839172},{x:294.93839263916016,y:236.39654159545898,z:18.534289598464966},{x:278.87489318847656,y:259.7095584869385,z:45.68212032318115},{x:300.3782653808594,y:245.38593292236328,z:12.278382778167725},{x:307.06348419189453,y:246.36857986450195,z:8.164191246032715},{x:315.5229187011719,y:245.3949737548828,z:5.503097176551819},{x:323.71395111083984,y:242.75178909301758,z:4.6335723996162415},{x:330.2785873413086,y:239.34658527374268,z:4.937030673027039},{x:334.6982192993164,y:236.0460376739502,z:4.823233783245087},{x:279.3412208557129,y:263.5196113586426,z:70.91583728790283,name:"faceOval"},{x:334.65972900390625,y:271.6648578643799,z:-17.775644063949585},{x:342.05677032470703,y:246.99846267700195,z:-20.84523916244507},{x:344.0357971191406,y:264.5701503753662,z:-32.936880588531494},{x:348.25531005859375,y:268.6645030975342,z:-30.695960521697998},{x:344.12227630615234,y:266.34212493896484,z:-29.808926582336426},{x:337.12318420410156,y:274.2556858062744,z:-15.768152475357056},{x:349.49047088623047,y:269.071683883667,z:-32.51670837402344},{x:350.1683044433594,y:271.4691352844238,z:-24.93025302886963},{x:333.9634704589844,y:230.56639194488525,z:8.89949381351471},{x:338.2147979736328,y:231.4807891845703,z:4.6715047955513},{x:340.4712677001953,y:231.74463272094727,z:-.34996166825294495},{x:303.28975677490234,y:232.24980354309082,z:11.916568279266357,name:"rightEye"},{x:299.4649124145508,y:229.53842639923096,z:12.325069904327393},{x:359.09618377685547,y:241.77349090576172,z:-24.650139808654785},{x:399.46216583251953,y:229.89503860473633,z:15.919880867004395,name:"leftEye"},{x:361.38919830322266,y:269.6129894256592,z:-24.510080814361572},{x:416.9973373413086,y:206.0895538330078,z:53.26857566833496,name:"faceOval"},{x:381.32179260253906,y:235.5476474761963,z:7.6214683055877686},{x:387.8068542480469,y:236.25958442687988,z:8.345099091529846},{x:393.95751953125,y:235.8660364151001,z:10.475142002105713},{x:401.84600830078125,y:232.77019500732422,z:16.760226488113403},{x:375.70568084716797,y:233.48456382751465,z:8.234220147132874},{x:388.17752838134766,y:218.94717693328857,z:6.810300946235657},{x:381.64928436279297,y:219.2656660079956,z:6.711093783378601},{x:394.4760513305664,y:219.66821193695068,z:9.173773527145386},{x:398.8843536376953,y:221.8837022781372,z:12.03328251838684},{x:406.5454864501953,y:237.12156772613525,z:19.7131085395813},{x:383.87447357177734,y:337.6932907104492,z:-8.631049990653992},{x:401.2682342529297,y:228.5916566848755,z:18.359217643737793,name:"leftEye"},{x:422.0449447631836,y:236.73934936523438,z:51.16771221160889},{x:412.69153594970703,y:232.80198097229004,z:27.52131938934326},{x:387.3497772216797,y:263.298397064209,z:-2.8609684109687805},{x:364.5124053955078,y:293.39221000671387,z:-22.397546768188477,name:"lips"},{x:363.62987518310547,y:302.1291446685791,z:-19.643079042434692},{x:373.2334518432617,y:295.8647060394287,z:-18.125789165496826,name:"lips"},{x:378.83365631103516,y:299.5177745819092,z:-13.153743743896484,name:"lips"},{x:369.91477966308594,y:302.5704002380371,z:-16.65518283843994},{x:374.9167251586914,y:303.5416603088379,z:-11.963253021240234},{x:387.58888244628906,y:312.2716999053955,z:-4.680258631706238},{x:360.6635284423828,y:264.31986808776855,z:-35.94811677932739},{x:361.04564666748047,y:256.8225860595703,z:-37.278664112091064},{x:408.3855438232422,y:213.52088928222656,z:15.756480693817139,name:"leftEyebrow"},{x:373.2946014404297,y:245.38101196289062,z:-1.9316278398036957},{x:376.83860778808594,y:264.3721103668213,z:-18.510947227478027},{x:376.9546127319336,y:261.0010528564453,z:-15.989909172058105},{x:406.1498260498047,y:263.5030174255371,z:7.072908878326416},{x:360.07205963134766,y:248.3631706237793,z:-32.16656446456909},{x:393.11119079589844,y:205.10473251342773,z:3.7786373496055603,name:"leftEyebrow"},{x:402.12791442871094,y:207.89000988006592,z:9.383859634399414,name:"leftEyebrow"},{x:410.8693313598633,y:191.6182279586792,z:41.27030849456787,name:"faceOval"},{x:364.9509811401367,y:210.40483474731445,z:-3.758212625980377},{x:375.94444274902344,y:221.1331844329834,z:8.368442058563232},{x:392.1904754638672,y:305.0360298156738,z:-1.752179116010666},{x:419.50225830078125,y:307.25592613220215,z:58.96425247192383,name:"faceOval"},{x:372.0027160644531,y:268.7212657928467,z:-16.631840467453003},{x:366.1614227294922,y:271.6237449645996,z:-18.219159841537476},{x:385.00938415527344,y:305.3863334655762,z:-2.567722797393799},{x:381.99771881103516,y:304.9723720550537,z:-4.575215280056},{x:405.078125,y:203.21216583251953,z:13.713973760604858,name:"leftEyebrow"},{x:377.13207244873047,y:268.4710121154785,z:-15.266278982162476},{x:380.9713363647461,y:205.36980628967285,z:-.7250899076461792,name:"leftEyebrow"},{x:381.7788314819336,y:198.9268398284912,z:-1.184653863310814,name:"leftEyebrow"},{x:385.5204772949219,y:172.1484375,z:16.04826807975769,name:"faceOval"},{x:407.94189453125,y:196.76236152648926,z:25.723915100097656},{x:383.03890228271484,y:184.5157527923584,z:7.393874526023865},{x:411.61781311035156,y:210.79241752624512,z:22.315845489501953,name:"leftEyebrow"},{x:414.30870056152344,y:208.4643030166626,z:37.021894454956055},{x:364.28722381591797,y:298.35777282714844,z:-21.86065673828125},{x:371.3682556152344,y:299.78848457336426,z:-17.834001779556274},{x:376.88201904296875,y:301.6696071624756,z:-13.153743743896484},{x:370.2193832397461,y:270.49095153808594,z:-15.569736957550049},{x:383.5081100463867,y:305.2726364135742,z:-3.673594295978546},{x:380.73760986328125,y:305.96869468688965,z:-8.660228252410889},{x:381.2334442138672,y:304.63574409484863,z:-4.820316135883331,name:"lips"},{x:368.1698989868164,y:264.8884963989258,z:-25.653886795043945},{x:373.5087203979492,y:303.4233856201172,z:-10.95950722694397,name:"lips"},{x:368.4544372558594,y:303.29601287841797,z:-14.169161319732666,name:"lips"},{x:362.76554107666016,y:303.5735607147217,z:-16.911956071853638,name:"lips"},{x:366.60980224609375,y:324.8870658874512,z:-15.616422891616821},{x:365.7067108154297,y:315.95678329467773,z:-20.903596878051758,name:"lips"},{x:365.0083923339844,y:311.2232208251953,z:-21.066999435424805},{x:364.1508102416992,y:307.0583438873291,z:-18.907777070999146},{x:363.37512969970703,y:304.5721435546875,z:-17.42550015449524,name:"lips"},{x:374.580078125,y:304.3059539794922,z:-11.40302300453186,name:"lips"},{x:375.55362701416016,y:305.0998020172119,z:-12.861957550048828},{x:377.2437286376953,y:307.1674346923828,z:-14.215847253799438},{x:378.68587493896484,y:309.9015712738037,z:-13.223772048950195,name:"lips"},{x:383.8992691040039,y:290.29629707336426,z:-9.97326910495758},{x:423.3871841430664,y:271.91688537597656,z:74.37058925628662,name:"faceOval"},{x:377.68043518066406,y:304.62209701538086,z:-7.603961229324341,name:"lips"},{x:379.00428771972656,y:304.9314594268799,z:-8.57852816581726},{x:364.00279998779297,y:275.2813911437988,z:-19.25792098045349},{x:374.68231201171875,y:273.82555961608887,z:-11.28047227859497},{x:365.0354766845703,y:273.4548568725586,z:-18.791062831878662},{x:380.61901092529297,y:249.8848056793213,z:.15501167625188828},{x:391.14158630371094,y:254.7934627532959,z:2.0906515419483185},{x:378.1761169433594,y:264.9612236022949,z:-12.605184316635132},{x:400.9540557861328,y:179.99592304229736,z:27.82477855682373,name:"faceOval"},{x:398.0038833618164,y:188.50656509399414,z:16.094952821731567},{x:394.8717498779297,y:199.0359592437744,z:6.226727366447449,name:"leftEyebrow"},{x:382.10926055908203,y:316.83926582336426,z:-8.946179747581482},{x:366.51588439941406,y:200.32583713531494,z:-5.24632453918457,name:"leftEyebrow"},{x:367.4893569946289,y:183.87210845947266,z:1.9039081037044525},{x:368.6243438720703,y:168.8127565383911,z:8.736093044281006,name:"faceOval"},{x:398.96175384521484,y:234.9675178527832,z:13.713973760604858},{x:412.9645538330078,y:242.23042488098145,z:23.272905349731445},{x:372.05257415771484,y:231.41919136047363,z:9.226294755935669},{x:406.0722351074219,y:223.58965873718262,z:18.370890617370605},{x:368.27442169189453,y:240.2039337158203,z:-4.166713654994965},{x:372.3575210571289,y:260.66442489624023,z:-24.976940155029297},{x:419.2244338989258,y:247.9079246520996,z:30.299127101898193},{x:409.43885803222656,y:246.60913467407227,z:16.398411989212036},{x:401.69139862060547,y:248.76328468322754,z:9.395531415939331},{x:389.7608184814453,y:247.56915092468262,z:5.841569304466248},{x:380.5461883544922,y:244.55984115600586,z:4.263003468513489},{x:373.25817108154297,y:240.80214500427246,z:2.5356262922286987},{x:358.77086639404297,y:229.35615062713623,z:-10.387605428695679},{x:419.5793914794922,y:262.8478717803955,z:26.5175724029541},{x:410.8808898925781,y:222.51372814178467,z:22.199130058288574},{x:358.45714569091797,y:268.91467094421387,z:-33.17030906677246},{x:373.4129333496094,y:251.6385841369629,z:-5.771540403366089},{x:422.5408172607422,y:239.23919677734375,z:74.04378890991211,name:"faceOval"},{x:367.8171920776367,y:236.58040523529053,z:1.820748895406723},{x:378.51959228515625,y:266.2532329559326,z:-5.74819803237915},{x:403.3472442626953,y:229.05112266540527,z:19.689764976501465},{x:372.34840393066406,y:256.6451168060303,z:-21.872329711914062},{x:422.54566192626953,y:289.1587829589844,z:68.67491245269775,name:"faceOval"},{x:371.9297409057617,y:228.90116214752197,z:11.432201862335205,name:"leftEye"},{x:366.21360778808594,y:251.6158962249756,z:-28.19826364517212},{x:409.1571807861328,y:321.3156223297119,z:20.2266526222229},{x:408.52943420410156,y:331.44238471984863,z:31.09278917312622,name:"faceOval"},{x:424.2788314819336,y:267.1992301940918,z:50.467424392700195},{x:415.60352325439453,y:311.6528606414795,z:30.579242706298828},{x:418.12793731689453,y:221.59927368164062,z:46.26569747924805},{x:385.68286895751953,y:346.0184955596924,z:-5.70151150226593},{x:357.82936096191406,y:271.3758373260498,z:-24.836881160736084},{x:379.588623046875,y:257.5071716308594,z:-3.755294680595398},{x:417.4592590332031,y:234.71948146820068,z:34.5475435256958},{x:393.4684371948242,y:231.58967971801758,z:11.408859491348267,name:"leftEye"},{x:387.8864288330078,y:232.14245796203613,z:9.51808214187622,name:"leftEye"},{x:382.4981689453125,y:307.5654888153076,z:-7.522260546684265,name:"lips"},{x:419.00169372558594,y:277.8332805633545,z:26.424202919006348},{x:373.62953186035156,y:357.6375102996826,z:-5.75986921787262,name:"faceOval"},{x:392.8708267211914,y:347.72446632385254,z:10.154176950454712,name:"faceOval"},{x:400.3953552246094,y:341.0005187988281,z:19.39797878265381,name:"faceOval"},{x:382.25440979003906,y:231.66935920715332,z:8.998700976371765,name:"leftEye"},{x:377.14550018310547,y:230.4228687286377,z:9.804032444953918,name:"leftEye"},{x:373.8358688354492,y:229.64950561523438,z:11.292144060134888,name:"leftEye"},{x:414.5794677734375,y:221.67891025543213,z:29.412097930908203},{x:377.00672149658203,y:225.66201210021973,z:9.360517263412476,name:"leftEye"},{x:382.29530334472656,y:224.8431158065796,z:8.32175612449646,name:"leftEye"},{x:387.5133514404297,y:224.49507236480713,z:8.917000889778137,name:"leftEye"},{x:393.15906524658203,y:225.24795055389404,z:10.737749338150024,name:"leftEye"},{x:397.05554962158203,y:226.55359268188477,z:13.002015352249146,name:"leftEye"},{x:420.5299377441406,y:221.014666557312,z:65.40690422058105,name:"faceOval"},{x:397.06920623779297,y:230.6661558151245,z:13.807345628738403,name:"leftEye"},{x:377.94647216796875,y:285.1647090911865,z:-13.305472135543823},{x:372.1118927001953,y:267.1267318725586,z:-18.83774757385254},{x:364.9968719482422,y:282.24411964416504,z:-19.818150997161865},{x:401.973876953125,y:331.20131492614746,z:11.566424369812012},{x:394.3083190917969,y:338.86693954467773,z:3.142542541027069},{x:373.9820861816406,y:351.4504623413086,z:-13.50388765335083},{x:414.3888854980469,y:321.24735832214355,z:45.51872253417969,name:"faceOval"},{x:373.44234466552734,y:227.33163356781006,z:10.626870393753052,name:"leftEye"},{x:364.0731430053711,y:240.31539916992188,z:-13.807345628738403},{x:384.2658233642578,y:353.3793067932129,z:.7385850697755814,name:"faceOval"},{x:423.20526123046875,y:283.5176181793213,z:47.152724266052246},{x:369.42798614501953,y:304.0898895263672,z:-14.647691249847412,name:"lips"},{x:370.63812255859375,y:305.90051651000977,z:-16.211668252944946},{x:371.91192626953125,y:309.0167713165283,z:-17.84567356109619},{x:373.0583953857422,y:313.3545398712158,z:-17.378815412521362,name:"lips"},{x:375.39905548095703,y:321.09289169311523,z:-13.118728399276733},{x:379.2567825317383,y:304.3582534790039,z:-7.924926280975342},{x:381.18797302246094,y:303.7031364440918,z:-7.843226194381714},{x:383.0918502807617,y:302.4884605407715,z:-7.6506465673446655,name:"lips"},{x:389.09461975097656,y:297.1475315093994,z:-5.5497825145721436},{x:411.6408920288086,y:280.24898529052734,z:12.02161192893982},{x:363.3110809326172,y:234.27620887756348,z:-6.775286793708801},{x:366.0474395751953,y:223.29872131347656,z:6.827808618545532},{x:370.34427642822266,y:225.1457118988037,z:9.558931589126587},{x:377.5371551513672,y:303.60079765319824,z:-7.358860373497009,name:"lips"},{x:412.9557800292969,y:299.53579902648926,z:19.39797878265381},{x:360.0810241699219,y:221.72012329101562,z:-2.153385728597641},{x:379.82784271240234,y:329.47723388671875,z:-10.48097848892212},{x:359.08477783203125,y:235.7911491394043,z:-18.079102039337158},{x:369.6688461303711,y:251.5407943725586,z:-14.962821006774902},{x:369.5555114746094,y:333.5307312011719,z:-15.67478060722351},{x:394.0193176269531,y:315.6973171234131,z:-.9920747578144073},{x:383.78997802734375,y:272.7268695831299,z:-4.689012169837952},{x:387.67765045166016,y:323.6722755432129,z:-5.640236139297485},{x:397.8769302368164,y:272.1331214904785,z:-.9395531564950943},{x:389.87476348876953,y:280.5630111694336,z:-4.29218202829361},{x:403.83888244628906,y:285.1167869567871,z:3.0229100584983826},{x:372.5467300415039,y:343.1070327758789,z:-16.153310537338257},{x:374.1112518310547,y:256.3721466064453,z:-10.574349164962769},{x:399.73785400390625,y:321.77515983581543,z:4.849494695663452},{x:392.03365325927734,y:330.56447982788086,z:-1.3407598435878754},{x:398.59134674072266,y:305.93902587890625,z:1.517290621995926},{x:417.95997619628906,y:290.9716987609863,z:26.89105987548828},{x:406.04541778564453,y:307.35154151916504,z:8.666064143180847},{x:420.75328826904297,y:298.40752601623535,z:41.78385257720947},{x:395.4522705078125,y:291.4153575897217,z:-2.1752697229385376},{x:368.6452102661133,y:245.8882999420166,z:-9.453888535499573},{x:370.34900665283203,y:263.56690406799316,z:-26.75100326538086},{x:374.98477935791016,y:266.6126346588135,z:-19.77146625518799},{x:366.99840545654297,y:258.12140464782715,z:-31.372904777526855},{x:371.00616455078125,y:217.63479709625244,z:5.60522198677063},{x:381.30577087402344,y:214.14087295532227,z:4.983716309070587},{x:390.1496124267578,y:213.38221549987793,z:5.593550801277161},{x:397.7696990966797,y:214.3659782409668,z:8.57852816581726},{x:403.1652069091797,y:217.65509605407715,z:13.013685941696167},{x:407.3551940917969,y:230.72525024414062,z:22.444231510162354},{x:424.0876770019531,y:251.7839241027832,z:51.16771221160889},{x:403.50196838378906,y:239.88757610321045,z:15.803166627883911},{x:397.31719970703125,y:241.49806022644043,z:11.233787536621094},{x:388.99425506591797,y:241.4366912841797,z:7.948269248008728},{x:380.7804489135742,y:239.78078842163086,z:6.600214838981628},{x:374.01336669921875,y:237.11946487426758,z:6.349278092384338},{x:369.39125061035156,y:234.35351371765137,z:5.987462401390076},{x:422.9730987548828,y:255.76455116271973,z:76.61150932312012,name:"faceOval"},{x:374.73915100097656,y:269.24214363098145,z:-16.608498096466064},{x:364.61681365966797,y:245.71088790893555,z:-20.02823829650879},{x:365.3834533691406,y:263.34174156188965,z:-32.32996463775635},{x:361.58252716064453,y:267.8273677825928,z:-30.345816612243652},{x:365.37208557128906,y:265.0249671936035,z:-29.178667068481445},{x:372.72605895996094,y:272.05135345458984,z:-14.834434986114502},{x:360.48614501953125,y:268.34827423095703,z:-32.189905643463135},{x:359.9516296386719,y:270.8049201965332,z:-24.650139808654785},{x:369.5049285888672,y:229.01945114135742,z:10.107489824295044},{x:365.5447769165039,y:230.24096488952637,z:5.593550801277161},{x:363.50669860839844,y:230.6208372116089,z:.43622106313705444},{x:399.3529510498047,y:227.65677452087402,z:15.35965085029602,name:"leftEye"},{x:402.5693130493164,y:224.60190296173096,z:15.931552648544312}],box:{xMin:277.8318977355957,yMin:168.7741756439209,xMax:424.2788314819336,yMax:359.8348903656006,width:146.4469337463379,height:191.0607147216797}},SAMPLE_FACELANDMARKER_RESULT:{faceLandmarks:[[{x:.5760777592658997,y:.8639070391654968,z:-.030997956171631813},{x:.572094738483429,y:.7886289358139038,z:-.07189624011516571},{x:.5723551511764526,y:.8075382709503174,z:-.03578168898820877},{x:.5548420548439026,y:.7188365459442139,z:-.057787876576185226},{x:.5706077814102173,y:.7674974799156189,z:-.07740399986505508},{x:.5681378245353699,y:.7387768030166626,z:-.07356284558773041},{x:.5621535181999207,y:.6681165099143982,z:-.04189874976873398},{x:.46613582968711853,y:.6679812073707581,z:.011289681307971478},{x:.5579932928085327,y:.6174106597900391,z:-.03502821549773216},{x:.5563451647758484,y:.5905600190162659,z:-.03928658738732338},{x:.5487832427024841,y:.4900572597980499,z:-.029898937791585922},{x:.5765544176101685,y:.8692144751548767,z:-.02831427752971649},{x:.5771114230155945,y:.873644232749939,z:-.02345779910683632},{x:.5771905779838562,y:.877016007900238,z:-.016658689826726913},{x:.5778058767318726,y:.8770116567611694,z:-.014505492523312569},{x:.5783766508102417,y:.8835000991821289,z:-.015996402129530907},{x:.5792440176010132,y:.8913810849189758,z:-.01924579218029976},{x:.5796768069267273,y:.8996334671974182,z:-.018261712044477463},{x:.5817288160324097,y:.9255813956260681,z:-.007126849144697189},{x:.5726592540740967,y:.7992473244667053,z:-.0643521398305893},{x:.5579419136047363,y:.7996989488601685,z:-.04566684365272522},{x:.4216199815273285,y:.5958762764930725,z:.06776496022939682},{x:.5052269697189331,y:.6796539425849915,z:-.0010737782577052712},{x:.49243026971817017,y:.6838865876197815,z:-.0005227324436418712},{x:.4796970784664154,y:.6856290102005005,z:.002684245817363262},{x:.4618356227874756,y:.6764569878578186,z:.013439622707664967},{x:.5160380601882935,y:.6737282276153564,z:-17607348127057776e-21},{x:.48070961236953735,y:.6255870461463928,z:-.008339674212038517},{x:.49719780683517456,y:.6256808042526245,z:-.008027955889701843},{x:.46674346923828125,y:.6317623853683472,z:-.004460199736058712},{x:.4582492709159851,y:.641118049621582,z:.0011905613355338573},{x:.45408669114112854,y:.6911458969116211,z:.020514748990535736},{x:.535312294960022,y:.9619986414909363,z:.012499462813138962},{x:.4608460068702698,y:.6628725528717041,z:.01517564244568348},{x:.4206731915473938,y:.6828458309173584,z:.07848648726940155},{x:.4390624463558197,y:.6796106696128845,z:.03283142298460007},{x:.5029968619346619,y:.7701570391654968,z:-.009734481573104858},{x:.5595027208328247,y:.8607323169708252,z:-.030043255537748337},{x:.5621269941329956,y:.8738374710083008,z:-.021709579974412918},{x:.5451499819755554,y:.865527331829071,z:-.022014077752828598},{x:.5351184010505676,y:.8705098032951355,z:-.011602800339460373},{x:.5495014190673828,y:.8744956254959106,z:-.016490943729877472},{x:.5395170450210571,y:.8759440779685974,z:-.007333362940698862},{x:.5183624029159546,y:.8959754705429077,z:.010520773939788342},{x:.5604349374771118,y:.7895449995994568,z:-.07082037627696991},{x:.557381272315979,y:.7687489986419678,z:-.07590588927268982},{x:.4432901442050934,y:.6308897733688354,z:.0027153254486620426},{x:.5258325338363647,y:.7151225805282593,z:-.014676518738269806},{x:.5271827578544617,y:.7833116054534912,z:-.037643320858478546},{x:.5257382988929749,y:.7717816233634949,z:-.03401920944452286},{x:.46516409516334534,y:.7705106735229492,z:.0065747760236263275},{x:.5558893084526062,y:.7420997619628906,z:-.0694495290517807},{x:.4720408320426941,y:.6066038608551025,z:-.021204356104135513},{x:.45432573556900024,y:.6158540844917297,z:-.011054684408009052},{x:.4305151402950287,y:.5608053803443909,z:.0396830290555954},{x:.5310865640640259,y:.6157484650611877,z:-.03081176057457924},{x:.5114666223526001,y:.6329749226570129,z:-.00335998204536736},{x:.506435751914978,y:.8786543607711792,z:.012980876490473747},{x:.4480472207069397,y:.8640613555908203,z:.12569651007652283},{x:.5372058153152466,y:.7942581176757812,z:-.03168361634016037},{x:.5488379597663879,y:.8001630306243896,z:-.03280917927622795},{x:.5213388204574585,y:.8794381618499756,z:.011892606504261494},{x:.5242055654525757,y:.8789222240447998,z:.008370225317776203},{x:.4477175176143646,y:.6039950251579285,z:-.0050799972377717495},{x:.526964008808136,y:.7916748523712158,z:-.02968614175915718},{x:.4971255660057068,y:.6050706505775452,z:-.028175678104162216},{x:.4938119053840637,y:.5882453918457031,z:-.03210941329598427},{x:.4757143557071686,y:.5094879865646362,z:-.01300730835646391},{x:.43947282433509827,y:.5816648006439209,z:.01415177434682846},{x:.485664039850235,y:.5477864146232605,z:-.023685332387685776},{x:.43635931611061096,y:.6226438283920288,z:.013606148771941662},{x:.42910251021385193,y:.6102726459503174,z:.03926564007997513},{x:.5605402588844299,y:.8680099248886108,z:-.027318159118294716},{x:.5474816560745239,y:.8702861070632935,z:-.019686367362737656},{x:.5373021364212036,y:.8728838562965393,z:-.010484928265213966},{x:.540735125541687,y:.7979167103767395,z:-.029073253273963928},{x:.5228585004806519,y:.87913578748703,z:.009915109723806381},{x:.530497670173645,y:.8815253973007202,z:.0020524784922599792},{x:.5259912610054016,y:.8790552616119385,z:.007895970717072487},{x:.5433906316757202,y:.7882310748100281,z:-.05121905356645584},{x:.541388213634491,y:.8777219653129578,z:-.00466804439201951},{x:.5515822172164917,y:.8767023086547852,z:-.010475946590304375},{x:.5637003779411316,y:.877059817314148,z:-.015273625031113625},{x:.5640299320220947,y:.9263423085212708,z:-.00658724969252944},{x:.5642300248146057,y:.8993074893951416,z:-.017653480172157288},{x:.5637336373329163,y:.8910360932350159,z:-.01852807030081749},{x:.5637134313583374,y:.8837276697158813,z:-.01482592523097992},{x:.564205527305603,y:.8768964409828186,z:-.01331155002117157},{x:.5419867634773254,y:.8778373599052429,z:-.0037720394320786},{x:.5404468774795532,y:.880696177482605,z:-.005610354244709015},{x:.5392338633537292,y:.8845721483230591,z:-.007352025713771582},{x:.538469672203064,y:.8891173601150513,z:-.005154991988092661},{x:.5189250111579895,y:.8452741503715515,z:-.009755070321261883},{x:.4258975088596344,y:.7662280797958374,z:.1387351155281067},{x:.5725725293159485,y:.8041572570800781,z:-.04583907872438431},{x:.5342061519622803,y:.8785833120346069,z:.002659974154084921},{x:.5324031114578247,y:.8804071545600891,z:.0017832003068178892},{x:.5538818836212158,y:.8078407645225525,z:-.03254539892077446},{x:.5325431823730469,y:.8026832938194275,z:-.019140373915433884},{x:.5514076948165894,y:.8043903112411499,z:-.03313535451889038},{x:.5131856203079224,y:.7284771800041199,z:-.009399853646755219},{x:.49331504106521606,y:.7443980574607849,z:-.005225230939686298},{x:.5239617824554443,y:.7807451486587524,z:-.025881027802824974},{x:.4473606050014496,y:.5315827131271362,z:.011164786294102669},{x:.45718759298324585,y:.5604941248893738,z:-.005943301599472761},{x:.4670005738735199,y:.5909327268600464,z:-.019681761041283607},{x:.5311570167541504,y:.9076261520385742,z:.00389476353302598},{x:.5249923467636108,y:.5893563628196716,z:-.037981919944286346},{x:.5166932344436646,y:.5429551005363464,z:-.03319704160094261},{x:.5085030198097229,y:.49676206707954407,z:-.02691275253891945},{x:.4687720239162445,y:.6834565997123718,z:.008113506250083447},{x:.4426414966583252,y:.7069531679153442,z:.028577271848917007},{x:.5230373740196228,y:.6675713658332825,z:.001773772411979735},{x:.4481240212917328,y:.6527872085571289,z:.012414850294589996},{x:.5339856743812561,y:.7012367844581604,z:-.020220188423991203},{x:.5347223281860352,y:.7761190533638,z:-.05141595005989075},{x:.4315067231655121,y:.7211957573890686,z:.04381405934691429},{x:.45203351974487305,y:.7206180095672607,z:.017288070172071457},{x:.46892452239990234,y:.7265436053276062,z:.005602988880127668},{x:.49314674735069275,y:.7202282547950745,z:-.0006408205372281373},{x:.5104925632476807,y:.7091827392578125,z:-.00362918758764863},{x:.5232142210006714,y:.698553740978241,z:-.00787867046892643},{x:.5497883558273315,y:.6743605136871338,z:-.036349106580019},{x:.43658503890037537,y:.7627100348472595,z:.042555369436740875},{x:.4397648870944977,y:.6528646349906921,z:.017956094816327095},{x:.5653332471847534,y:.7992802858352661,z:-.06365057826042175},{x:.5285563468933105,y:.736810564994812,z:-.018836988136172295},{x:.4180678725242615,y:.6792560815811157,z:.12284679710865021},{x:.5328429937362671,y:.6865872144699097,z:-.010484723374247551},{x:.5230283141136169,y:.7809416055679321,z:-.011922398582100868},{x:.4551771283149719,y:.6650775074958801,z:.01774493046104908},{x:.5337203741073608,y:.7618928551673889,z:-.04697106033563614},{x:.43463975191116333,y:.8133478164672852,z:.1354849934577942},{x:.5225707292556763,y:.6605283617973328,z:.004980515688657761},{x:.5441933870315552,y:.7497199773788452,z:-.06091512367129326},{x:.4774007797241211,y:.9159183502197266,z:.059622734785079956},{x:.48068761825561523,y:.9364941716194153,z:.08404944837093353},{x:.4268292486667633,y:.7657528519630432,z:.09051097184419632},{x:.46051913499832153,y:.8880485892295837,z:.0738474428653717},{x:.4243420660495758,y:.6434382200241089,z:.06230505183339119},{x:.5342157483100891,y:.9835634231567383,z:.021662971004843712},{x:.5668109655380249,y:.8042187094688416,z:-.044937074184417725},{x:.5176341533660889,y:.7530587315559387,z:-.012967454269528389},{x:.430206298828125,y:.6835605502128601,z:.04612284153699875},{x:.4794231951236725,y:.6732114553451538,z:.003970044665038586},{x:.49073347449302673,y:.6722435355186462,z:.0008692514384165406},{x:.5294116139411926,y:.884677529335022,z:.004413890186697245},{x:.4430122375488281,y:.80235356092453,z:.04987282305955887},{x:.5603825449943542,y:1.0092442035675049,z:.026417359709739685},{x:.5186598300933838,y:.9828659892082214,z:.0513598807156086},{x:.5010536909103394,y:.9640932679176331,z:.06591596454381943},{x:.5524769425392151,y:.539441704750061,z:-.035816047340631485},{x:.5879997611045837,y:1.0091472864151,z:.02285068854689598},{x:.5016193985939026,y:.6684437990188599,z:.00028415941051207483},{x:.511952817440033,y:.6642197370529175,z:.0021144719794392586},{x:.5194343328475952,y:.6623469591140747,z:.004674181342124939},{x:.4321230351924896,y:.6496355533599854,z:.03124697133898735},{x:.508686363697052,y:.6479565501213074,z:-.00044765998609364033},{x:.4963986277580261,y:.6431032419204712,z:-.0032507688738405704},{x:.4845542013645172,y:.6430778503417969,z:-.002903624437749386},{x:.4733612537384033,y:.647506833076477,z:.00023347247042693198},{x:.4668654501438141,y:.653346598148346,z:.004762572236359119},{x:.41815051436424255,y:.633708119392395,z:.09809435904026031},{x:.47159942984580994,y:.6711485385894775,z:.007849935442209244},{x:.5734396576881409,y:.8256140351295471,z:-.03155219927430153},{x:.5306524038314819,y:.8337990641593933,z:-.018351426348090172},{x:.5371729135513306,y:.7910830974578857,z:-.037286680191755295},{x:.5549534559249878,y:.8275275826454163,z:-.030664825811982155},{x:.5597432255744934,y:.6418541669845581,z:-.03318847343325615},{x:.4958484172821045,y:.9429569244384766,z:.048340678215026855},{x:.5140507817268372,y:.9634028077125549,z:.03589847311377525},{x:.5587693452835083,y:.9951097369194031,z:.00908728688955307},{x:.46411189436912537,y:.9051855206489563,z:.10601935535669327},{x:.5181609392166138,y:.6554316878318787,z:.002546071307733655},{x:.5436590909957886,y:.7085841298103333,z:-.03844436630606651},{x:.5872187614440918,y:.9960382580757141,z:.0063423276878893375},{x:.5379653573036194,y:.9989125728607178,z:.03636329993605614},{x:.4350326955318451,y:.8088565468788147,z:.09147704392671585},{x:.5523084998130798,y:.8773422837257385,z:-.009068487212061882},{x:.5510149598121643,y:.8816931843757629,z:-.011043853126466274},{x:.5503793954849243,y:.88776695728302,z:-.01348799467086792},{x:.5501549243927002,y:.8954370617866516,z:-.012142189778387547},{x:.546072781085968,y:.9192524552345276,z:-.003157563041895628},{x:.5314661860466003,y:.8771666884422302,z:.0005075141089037061},{x:.5293324589729309,y:.8762547969818115,z:.00039177737198770046},{x:.5275698900222778,y:.8750609755516052,z:47732755774632096e-21},{x:.5104271173477173,y:.8607332110404968,z:.0012934643309563398},{x:.45938700437545776,y:.8134918212890625,z:.023569690063595772},{x:.5418947339057922,y:.6864100694656372,z:-.027333909645676613},{x:.531914234161377,y:.6456130743026733,z:-.005434140563011169},{x:.523697018623352,y:.647885262966156,z:-.0002466466394253075},{x:.5338191390037537,y:.8783687353134155,z:.002268768846988678},{x:.46226605772972107,y:.8610277771949768,z:.04718952998518944},{x:.5434442758560181,y:.6456181406974792,z:-.02327350154519081},{x:.5399754643440247,y:.940219521522522,z:.005075343884527683},{x:.5661457777023315,y:.71457839012146,z:-.06242101639509201},{x:.5523148775100708,y:.6974870562553406,z:-.04863070324063301},{x:.5639959573745728,y:.6923378109931946,z:-.05180761218070984},{x:.5367592573165894,y:.7423217296600342,z:-.03623027727007866},{x:.5853689908981323,y:.9752064943313599,z:-.002361974213272333},{x:.5835235118865967,y:.9493685960769653,z:-.003941743168979883},{x:.5615018606185913,y:.949194610118866,z:-.0015953965485095978},{x:.5068561434745789,y:.9048219323158264,z:.01862684078514576},{x:.5134067535400391,y:.7971825003623962,z:-.008485661819577217},{x:.5223897099494934,y:.925589919090271,z:.01249657291918993},{x:.48500555753707886,y:.7959478497505188,z:-.0032065745908766985},{x:.5037734508514404,y:.8184596300125122,z:-.004932103678584099},{x:.4766361117362976,y:.828806459903717,z:.01027688942849636},{x:.5589827299118042,y:.974656343460083,z:.0009666886180639267},{x:.5294582843780518,y:.7541216611862183,z:-.025603046640753746},{x:.4973002076148987,y:.9208990931510925,z:.031931452453136444},{x:.5163551568984985,y:.9432790875434875,z:.024321340024471283},{x:.49399662017822266,y:.8814862370491028,z:.018687399104237556},{x:.44948166608810425,y:.836137592792511,z:.05702034756541252},{x:.47898444533348083,y:.8836610913276672,z:.03150695189833641},{x:.4454479217529297,y:.8499438166618347,z:.08868525922298431},{x:.49572959542274475,y:.8452823758125305,z:.0036111653316766024},{x:.5362502336502075,y:.7222585678100586,z:-.027912352234125137},{x:.5393770337104797,y:.7850722074508667,z:-.05415399745106697},{x:.531399667263031,y:.7898418307304382,z:-.03883346915245056},{x:.5451627373695374,y:.7717036604881287,z:-.06480253487825394},{x:.5206395983695984,y:.6287745833396912,z:-.010521138086915016},{x:.4974782466888428,y:.6191938519477844,z:-.014098240062594414},{x:.4774145185947418,y:.6193130612373352,z:-.013643337413668633},{x:.4616098403930664,y:.6259890198707581,z:-.008448202162981033},{x:.4516478478908539,y:.6368461847305298,z:9050309745362028e-20},{x:.4485096037387848,y:.6719120740890503,z:.022984720766544342},{x:.42177659273147583,y:.7240667343139648,z:.08511673659086227},{x:.4616215229034424,y:.6988231539726257,z:.014238474890589714},{x:.4755798876285553,y:.7034608721733093,z:.00625590980052948},{x:.4924992024898529,y:.7005885243415833,z:.0009391739731654525},{x:.5082254409790039,y:.693384051322937,z:-.0009464038303121924},{x:.5203112959861755,y:.6849707961082458,z:-.0022114769089967012},{x:.52867591381073,y:.6779075860977173,z:-.002962538506835699},{x:.4213953912258148,y:.7219811677932739,z:.1350894570350647},{x:.5320829749107361,y:.794858992099762,z:-.03181503340601921},{x:.5452795028686523,y:.7286570072174072,z:-.04771539941430092},{x:.5496407747268677,y:.7866933345794678,z:-.06452003121376038},{x:.557040274143219,y:.7962084412574768,z:-.05837344378232956},{x:.549176812171936,y:.7895247936248779,z:-.057761140167713165},{x:.5362890362739563,y:.8005836606025696,z:-.026903774589300156},{x:.560200035572052,y:.7983731031417847,z:-.06172555685043335},{x:.5616944432258606,y:.8022753596305847,z:-.045200999826192856},{x:.5273328423500061,y:.6611284017562866,z:.0029021520167589188},{x:.534850537776947,y:.6660012006759644,z:-.005215510260313749},{x:.5394860506057739,y:.6701375246047974,z:-.014931917190551758},{x:.4634307324886322,y:.658291757106781,z:.009295716881752014},{x:.4538393020629883,y:.6519932150840759,z:.00930330716073513},{x:.5776031613349915,y:.7159298658370972,z:-.057365912944078445},{x:.6504855155944824,y:.6461779475212097,z:.014184834435582161},{x:.5860154032707214,y:.7962266206741333,z:-.04522843658924103},{x:.6842049360275269,y:.5631637573242188,z:.07207967340946198},{x:.6152560710906982,y:.6674962639808655,z:.0007529259892180562},{x:.6280948519706726,y:.6684326529502869,z:.0016892586136236787},{x:.6408625245094299,y:.6663892269134521,z:.005331226624548435},{x:.6557814478874207,y:.6534678936004639,z:.01646413467824459},{x:.6035663485527039,y:.6639701724052429,z:.0013799630105495453},{x:.6329053044319153,y:.608010470867157,z:-.006195899099111557},{x:.6167260408401489,y:.6117533445358276,z:-.006319951266050339},{x:.6471013426780701,y:.6112449765205383,z:-.0017843559617176652},{x:.6560901999473572,y:.6185776591300964,z:.004047257360070944},{x:.6666946411132812,y:.6651176810264587,z:.023647578433156013},{x:.6311345100402832,y:.9495396018028259,z:.014004078693687916},{x:.6544655561447144,y:.6397901773452759,z:.01809609681367874},{x:.6965808868408203,y:.6482675075531006,z:.08304904401302338},{x:.679817259311676,y:.650188148021698,z:.03632688894867897},{x:.6336516737937927,y:.7541458010673523,z:-.007742783520370722},{x:.5921701192855835,y:.8567668199539185,z:-.029399123042821884},{x:.591663658618927,y:.870215654373169,z:-.02103729173541069},{x:.6068367958068848,y:.8584195375442505,z:-.020668085664510727},{x:.6176617741584778,y:.860965371131897,z:-.009790095500648022},{x:.6040634512901306,y:.8686612844467163,z:-.015289564616978168},{x:.6143736839294434,y:.8671170473098755,z:-.005712216719985008},{x:.6373105049133301,y:.8815656900405884,z:.012672550976276398},{x:.5832505822181702,y:.7866312861442566,z:-.07051534950733185},{x:.5836675763130188,y:.7658692598342896,z:-.07566110789775848},{x:.6709531545639038,y:.604898989200592,z:.005951565690338612},{x:.6029891967773438,y:.705652117729187,z:-.013388276100158691},{x:.6131622195243835,y:.7728396058082581,z:-.036248479038476944},{x:.6123163104057312,y:.7612020373344421,z:-.03264721855521202},{x:.6696187853813171,y:.744706928730011,z:.009673702530562878},{x:.5803102254867554,y:.7385968565940857,z:-.0689152330160141},{x:.6404349207878113,y:.5877999663352966,z:-.01929756999015808},{x:.6588467955589294,y:.5929454565048218,z:-.008487257175147533},{x:.6720337867736816,y:.530631422996521,z:.043437421321868896},{x:.584305465221405,y:.6099005341529846,z:-.030301367864012718},{x:.6034283638000488,y:.6217452883720398,z:-.001970183802768588},{x:.6460927724838257,y:.8608663082122803,z:.015541625209152699},{x:.6957815289497375,y:.8326103091239929,z:.13015234470367432},{x:.6043362617492676,y:.7861682772636414,z:-.030476901680231094},{x:.594293475151062,y:.7942103147506714,z:-.032218821346759796},{x:.6324057579040527,y:.8665139675140381,z:.014255806803703308},{x:.6296147704124451,y:.8667733669281006,z:.010388285852968693},{x:.663644552230835,y:.5798642635345459,z:-.0022301070857793093},{x:.6140630841255188,y:.7809288501739502,z:-.02835679054260254},{x:.615908145904541,y:.5921698212623596,z:-.026804860681295395},{x:.617181122303009,y:.5748661756515503,z:-.03060605563223362},{x:.6222207546234131,y:.49137672781944275,z:-.011151673272252083},{x:.6669357419013977,y:.5541607141494751,z:.017466170713305473},{x:.6182981729507446,y:.5320425629615784,z:-.021793590858578682},{x:.6760554313659668,y:.595052182674408,z:.017115700989961624},{x:.6801463961601257,y:.5800720453262329,z:.043127160519361496},{x:.5922210812568665,y:.8644017577171326,z:-.02662893570959568},{x:.6054555177688599,y:.8637874722480774,z:-.018363753333687782},{x:.6161889433860779,y:.8641164898872375,z:-.008808949030935764},{x:.6017249822616577,y:.7901403307914734,z:-.028126630932092667},{x:.631446123123169,y:.8664817810058594,z:.012112865224480629},{x:.6249198913574219,y:.8716511130332947,z:.003882825840264559},{x:.6281915903091431,y:.867301881313324,z:.009891441091895103},{x:.5986843109130859,y:.7813931703567505,z:-.050227612257003784},{x:.6126407384872437,y:.869275689125061,z:-.0031255714129656553},{x:.6027271151542664,y:.8711842894554138,z:-.009324162267148495},{x:.59088134765625,y:.8742044568061829,z:-.014608660712838173},{x:.5984604358673096,y:.9216185212135315,z:-.005981989670544863},{x:.5950398445129395,y:.8964707255363464,z:-.01703473925590515},{x:.5941568613052368,y:.8882410526275635,z:-.017784785479307175},{x:.5928806662559509,y:.8803883194923401,z:-.014153128489851952},{x:.5909661054611206,y:.8748103976249695,z:-.012609979137778282},{x:.6128016710281372,y:.8702545762062073,z:-.0022550546564161777},{x:.6150846481323242,y:.8726804256439209,z:-.00414019962772727},{x:.6173093914985657,y:.8770190477371216,z:-.005970994010567665},{x:.619335412979126,y:.8814800977706909,z:-.0036864024586975574},{x:.6292637586593628,y:.8314558267593384,z:-.007714875973761082},{x:.702275276184082,y:.7320667505264282,z:.1433621346950531},{x:.6204835176467896,y:.8689177632331848,z:.0044869170524179935},{x:.6223508715629578,y:.8704851269721985,z:.00352082890458405},{x:.590448260307312,y:.8029727935791016,z:-.03200828656554222},{x:.6097423434257507,y:.7933741211891174,z:-.018042555078864098},{x:.59229576587677,y:.7993767261505127,z:-.032564569264650345},{x:.6171364188194275,y:.7153720259666443,z:-.007672437466681004},{x:.6389747858047485,y:.726390540599823,z:-.002999067772179842},{x:.6151940226554871,y:.769412100315094,z:-.024427521973848343},{x:.6526776552200317,y:.505868136882782,z:.01412637997418642},{x:.6475822329521179,y:.5375454425811768,z:-.0033899128902703524},{x:.6433356404304504,y:.5714520215988159,z:-.017428796738386154},{x:.626949667930603,y:.8962116837501526,z:.005602736957371235},{x:.5868416428565979,y:.5829002261161804,z:-.03727729618549347},{x:.5877229571342468,y:.5345035791397095,z:-.032396964728832245},{x:.5887066125869751,y:.48655083775520325,z:-.025856535881757736},{x:.6507197618484497,y:.6612282991409302,z:.011114613153040409},{x:.6803066730499268,y:.677992045879364,z:.032125361263751984},{x:.5963194370269775,y:.6598632335662842,z:.002976928371936083},{x:.667536199092865,y:.6274255514144897,z:.015618261881172657},{x:.5930740833282471,y:.6940041780471802,z:-.019217798486351967},{x:.6053346395492554,y:.7676517963409424,z:-.050308309495449066},{x:.6934473514556885,y:.6884298920631409,z:.04794462397694588},{x:.6738007664680481,y:.6934011578559875,z:.020697161555290222},{x:.6588084697723389,y:.7033141851425171,z:.008462334051728249},{x:.6346072554588318,y:.7029502391815186,z:.001542167621664703},{x:.6157816648483276,y:.6966525912284851,z:-.002009218093007803},{x:.6015574336051941,y:.688928484916687,z:-.006588225718587637},{x:.5746836066246033,y:.6711069345474243,z:-.03597589209675789},{x:.6947521567344666,y:.7309479117393494,z:.046707939356565475},{x:.6759101152420044,y:.6249120831489563,z:.021654341369867325},{x:.5794773101806641,y:.7971615195274353,z:-.06339326500892639},{x:.6041849851608276,y:.727514922618866,z:-.017512541264295578},{x:.6968844532966614,y:.6440950036048889,z:.12727996706962585},{x:.5910853147506714,y:.679325520992279,z:-.009497715160250664},{x:.6157375574111938,y:.7695677280426025,z:-.010624290443956852},{x:.6606494784355164,y:.6410489678382874,z:.0208158977329731},{x:.6040687561035156,y:.7531470656394958,z:-.045887019485235214},{x:.7012156248092651,y:.780247151851654,z:.14028730988502502},{x:.595149576663971,y:.6527782678604126,z:.006308757700026035},{x:.5925500392913818,y:.7436665892601013,z:-.060151755809783936},{x:.6780198812484741,y:.8905693888664246,z:.0626060739159584},{x:.676746666431427,y:.9113880395889282,z:.08726003766059875},{x:.7030686140060425,y:.7312687635421753,z:.09529774636030197},{x:.688987135887146,y:.8588417172431946,z:.07752864807844162},{x:.6883691549301147,y:.6109960675239563,z:.06669612973928452},{x:.6358906030654907,y:.9702065587043762,z:.023120900616049767},{x:.5781539678573608,y:.8023634552955627,z:-.044763918966054916},{x:.6170316934585571,y:.7408350706100464,z:-.011375460773706436},{x:.688542366027832,y:.6516284346580505,z:.050206027925014496},{x:.6385149359703064,y:.6540714502334595,z:.006462941411882639},{x:.6279382109642029,y:.6563615798950195,z:.003062846139073372},{x:.6268895268440247,y:.8736732006072998,z:.00627936702221632},{x:.6944946050643921,y:.7709181308746338,z:.053824134171009064},{x:.614617109298706,y:1.0022112131118774,z:.02719894051551819},{x:.6493719220161438,y:.9665167927742004,z:.053563784807920456},{x:.6624587178230286,y:.943530797958374,z:.068605437874794},{x:.6162528991699219,y:.6558693051338196,z:.002187855076044798},{x:.6058168411254883,y:.654328465461731,z:.0036193584091961384},{x:.5987918972969055,y:.6536934971809387,z:.006134530063718557},{x:.6831037402153015,y:.6195642948150635,z:.03511790186166763},{x:.6062582731246948,y:.6356398463249207,z:.001280312892049551},{x:.6174948811531067,y:.62776118516922,z:-.0013642468256875873},{x:.6297246217727661,y:.6253792643547058,z:-.0007034156005829573},{x:.6407091617584229,y:.627578616142273,z:.0028144705574959517},{x:.6479622721672058,y:.6322650909423828,z:.00750273372977972},{x:.6915091276168823,y:.5990704298019409,z:.10270945727825165},{x:.6457163095474243,y:.6504453420639038,z:.010696077719330788},{x:.6164222955703735,y:.8231936097145081,z:-.016772059723734856},{x:.6042401194572449,y:.7830976843833923,z:-.03630910441279411},{x:.5922216773033142,y:.8228387236595154,z:-.029992375522851944},{x:.6646111011505127,y:.92097008228302,z:.050967294722795486},{x:.651232898235321,y:.9460107088088989,z:.038000158965587616},{x:.6140977144241333,y:.9882472157478333,z:.009882091544568539},{x:.6870781183242798,y:.8768675327301025,z:.10980932414531708},{x:.5986856818199158,y:.6456438899040222,z:.003999010659754276},{x:.585981547832489,y:.7034481763839722,z:-.0377722829580307},{x:.6342031359672546,y:.9867448806762695,z:.03786521404981613},{x:.7013950943946838,y:.776049017906189,z:.09598205983638763},{x:.6030206680297852,y:.8719133138656616,z:-.007931148633360863},{x:.6050592064857483,y:.8767156004905701,z:-.009791925549507141},{x:.6073468923568726,y:.8831382393836975,z:-.012361008673906326},{x:.6087977290153503,y:.890143632888794,z:-.01098148338496685},{x:.6147705316543579,y:.9110084772109985,z:-.0018823575228452682},{x:.622577965259552,y:.8670604825019836,z:.002609190298244357},{x:.6241236329078674,y:.8651344180107117,z:.0025534380692988634},{x:.6257084608078003,y:.8638408184051514,z:.0023300074972212315},{x:.639931321144104,y:.8449671268463135,z:.0038123116828501225},{x:.6810906529426575,y:.7856625318527222,z:.02717764675617218},{x:.583532452583313,y:.6811994910240173,z:-.026588857173919678},{x:.5855660438537598,y:.6393819451332092,z:-.004512844607234001},{x:.5932201743125916,y:.6398029327392578,z:.0008020466193556786},{x:.6200879812240601,y:.8683351874351501,z:.00417016725987196},{x:.6842559576034546,y:.8330534100532532,z:.050836317241191864},{x:.5754412412643433,y:.6418221592903137,z:-.022838059812784195},{x:.6232790350914001,y:.9295297265052795,z:.006339520215988159},{x:.5764067769050598,y:.694546639919281,z:-.04825803264975548},{x:.59778892993927,y:.7343927621841431,z:-.035004377365112305},{x:.6042810678482056,y:.9441440105438232,z:-.0010970570147037506},{x:.6496372222900391,y:.8869078159332275,z:.021036235615611076},{x:.6274012327194214,y:.7830310463905334,z:-.006658440921455622},{x:.637792706489563,y:.9104999899864197,z:.014290250837802887},{x:.6549934148788452,y:.7748609185218811,z:-.0006672973395325243},{x:.6404005289077759,y:.801220715045929,z:-.0026642554439604282},{x:.6671456694602966,y:.8045546412467957,z:.013180811889469624},{x:.6107483506202698,y:.9680658578872681,z:.001778992242179811},{x:.6060343980789185,y:.744587242603302,z:-.024382334202528},{x:.6602751612663269,y:.8998945355415344,z:.0344940721988678},{x:.6463775038719177,y:.9262562394142151,z:.02617623284459114},{x:.6579852104187012,y:.8602304458618164,z:.021586716175079346},{x:.6926165223121643,y:.8053340315818787,z:.061075080186128616},{x:.6724731922149658,y:.8594399690628052,z:.03457934781908989},{x:.6975721716880798,y:.8183245062828064,z:.09300774335861206},{x:.6512877941131592,y:.8258221745491028,z:.006324059329926968},{x:.594887375831604,y:.7148372530937195,z:-.026898479089140892},{x:.6017440557479858,y:.7773507833480835,z:-.05312420800328255},{x:.6096571683883667,y:.7806998491287231,z:-.037646256387233734},{x:.5952993035316467,y:.7654367685317993,z:-.06398405134677887},{x:.5950021147727966,y:.6201304793357849,z:-.009297547861933708},{x:.6165438890457153,y:.6052900552749634,z:-.012455573305487633},{x:.6362661719322205,y:.6015968918800354,z:-.011649220250546932},{x:.6522727608680725,y:.6046400666236877,z:-.005903332494199276},{x:.6625409722328186,y:.6128141283988953,z:.0030042496509850025},{x:.6688099503517151,y:.6457712054252625,z:.026322703808546066},{x:.7013440728187561,y:.6893666386604309,z:.08984331786632538},{x:.6608623266220093,y:.6749406456947327,z:.0172116681933403},{x:.6482325196266174,y:.6823726296424866,z:.008881398476660252},{x:.6313265562057495,y:.6842025518417358,z:.0031308617908507586},{x:.6147016286849976,y:.6809731721878052,z:.0007630771724507213},{x:.6018834114074707,y:.6755372285842896,z:-.0008834321051836014},{x:.5925027132034302,y:.670681357383728,z:-.001968748401850462},{x:.700127363204956,y:.6871103644371033,z:.13980500400066376},{x:.6095665693283081,y:.7853189706802368,z:-.03074747882783413},{x:.5880423784255981,y:.7229287028312683,z:-.04691500961780548},{x:.5930182337760925,y:.7811514139175415,z:-.06398335844278336},{x:.5867722034454346,y:.7922660112380981,z:-.05794971063733101},{x:.5933279991149902,y:.7842848896980286,z:-.05714067071676254},{x:.6063535809516907,y:.7920218706130981,z:-.02590685710310936},{x:.5839452743530273,y:.794978141784668,z:-.0615212507545948},{x:.5828126072883606,y:.8000800013542175,z:-.0449722595512867},{x:.5909603834152222,y:.6541213393211365,z:.003991890233010054},{x:.5852181911468506,y:.6602938771247864,z:-.004428438376635313},{x:.5825737714767456,y:.6651063561439514,z:-.014345290139317513},{x:.6517343521118164,y:.6362385153770447,z:.012151890434324741},{x:.6615052819252014,y:.6281577944755554,z:.0123682152479887},{x:.4856873154640198,y:.6568945646286011,z:.000720038078725338},{x:.49988406896591187,y:.6547410488128662,z:.0006949726957827806},{x:.48438939452171326,y:.6392973065376282,z:.000705525919329375},{x:.47143134474754333,y:.6589511632919312,z:.0006980331381782889},{x:.48704618215560913,y:.6752797961235046,z:.0006921177846379578},{x:.6243702173233032,y:.640461802482605,z:-6592126737814397e-20},{x:.6390967965126038,y:.6385173797607422,z:-.00016105435497593135},{x:.6230536699295044,y:.6224825382232666,z:-.00016136496560648084},{x:.6095397472381592,y:.641917884349823,z:-.0001803556369850412},{x:.6250996589660645,y:.6586247682571411,z:-.0001785515050869435}]],faceBlendshapes:[{categories:[{index:0,score:5187174338061595e-21,categoryName:"_neutral",displayName:""},{index:1,score:.24521504342556,categoryName:"browDownLeft",displayName:""},{index:2,score:.1987743377685547,categoryName:"browDownRight",displayName:""},{index:3,score:.013400448486208916,categoryName:"browInnerUp",displayName:""},{index:4,score:.012361560948193073,categoryName:"browOuterUpLeft",displayName:""},{index:5,score:.019305096939206123,categoryName:"browOuterUpRight",displayName:""},{index:6,score:28426356948330067e-21,categoryName:"cheekPuff",displayName:""},{index:7,score:34500112633395474e-23,categoryName:"cheekSquintLeft",displayName:""},{index:8,score:483789051486383e-21,categoryName:"cheekSquintRight",displayName:""},{index:9,score:.07650448381900787,categoryName:"eyeBlinkLeft",displayName:""},{index:10,score:.05070012807846069,categoryName:"eyeBlinkRight",displayName:""},{index:11,score:.13978900015354156,categoryName:"eyeLookDownLeft",displayName:""},{index:12,score:.14198613166809082,categoryName:"eyeLookDownRight",displayName:""},{index:13,score:.2177766114473343,categoryName:"eyeLookInLeft",displayName:""},{index:14,score:.014739357866346836,categoryName:"eyeLookInRight",displayName:""},{index:15,score:.02361512929201126,categoryName:"eyeLookOutLeft",displayName:""},{index:16,score:.19679604470729828,categoryName:"eyeLookOutRight",displayName:""},{index:17,score:.04874616861343384,categoryName:"eyeLookUpLeft",displayName:""},{index:18,score:.049392376095056534,categoryName:"eyeLookUpRight",displayName:""},{index:19,score:.34944331645965576,categoryName:"eyeSquintLeft",displayName:""},{index:20,score:.2939716875553131,categoryName:"eyeSquintRight",displayName:""},{index:21,score:.005955042317509651,categoryName:"eyeWideLeft",displayName:""},{index:22,score:.006776117719709873,categoryName:"eyeWideRight",displayName:""},{index:23,score:16942436559475027e-21,categoryName:"jawForward",displayName:""},{index:24,score:.0045165494084358215,categoryName:"jawLeft",displayName:""},{index:25,score:.07803940027952194,categoryName:"jawOpen",displayName:""},{index:26,score:2090057751047425e-20,categoryName:"jawRight",displayName:""},{index:27,score:.06032035872340202,categoryName:"mouthClose",displayName:""},{index:28,score:.00228882092051208,categoryName:"mouthDimpleLeft",displayName:""},{index:29,score:.00781762320548296,categoryName:"mouthDimpleRight",displayName:""},{index:30,score:.0017093931091949344,categoryName:"mouthFrownLeft",displayName:""},{index:31,score:.0019319106359034777,categoryName:"mouthFrownRight",displayName:""},{index:32,score:8485237776767462e-20,categoryName:"mouthFunnel",displayName:""},{index:33,score:.0009051355300471187,categoryName:"mouthLeft",displayName:""},{index:34,score:.0003630454302765429,categoryName:"mouthLowerDownLeft",displayName:""},{index:35,score:.00017601238505449146,categoryName:"mouthLowerDownRight",displayName:""},{index:36,score:.12865161895751953,categoryName:"mouthPressLeft",displayName:""},{index:37,score:.20137207210063934,categoryName:"mouthPressRight",displayName:""},{index:38,score:.0022203284315764904,categoryName:"mouthPucker",displayName:""},{index:39,score:.0009096377179957926,categoryName:"mouthRight",displayName:""},{index:40,score:.34189721941947937,categoryName:"mouthRollLower",displayName:""},{index:41,score:.11409689486026764,categoryName:"mouthRollUpper",displayName:""},{index:42,score:.17172536253929138,categoryName:"mouthShrugLower",displayName:""},{index:43,score:.004038424696773291,categoryName:"mouthShrugUpper",displayName:""},{index:44,score:.00023205230536404997,categoryName:"mouthSmileLeft",displayName:""},{index:45,score:.00019313619122840464,categoryName:"mouthSmileRight",displayName:""},{index:46,score:.0018571305554360151,categoryName:"mouthStretchLeft",displayName:""},{index:47,score:.0023813238367438316,categoryName:"mouthStretchRight",displayName:""},{index:48,score:24323100660694763e-21,categoryName:"mouthUpperUpLeft",displayName:""},{index:49,score:3161552012898028e-20,categoryName:"mouthUpperUpRight",displayName:""},{index:50,score:108198406678639e-21,categoryName:"noseSneerLeft",displayName:""},{index:51,score:12652527630052646e-22,categoryName:"noseSneerRight",displayName:""}],headIndex:-1,headName:""}],facialTransformationMatrixes:[{rows:4,columns:4,data:[.9947517514228821,.10230544209480286,.0013679931871592999,0,-.10230997204780579,.9947447776794434,.003816320328041911,0,-.000970348424743861,-.0039362297393381596,.9999914169311523,0,2.8888821601867676,-7.808934211730957,-30.52109146118164,1]}]}},yj=w.createContext({}),V5={basePath:"https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@0.10.17/wasm",options:{baseOptions:{modelAssetPath:"https://storage.googleapis.com/mediapipe-models/face_landmarker/face_landmarker/float16/1/face_landmarker.task",delegate:"GPU"},runningMode:"VIDEO",outputFaceBlendshapes:!0,outputFacialTransformationMatrixes:!0}},sEe=w.forwardRef(({basePath:i=V5.basePath,options:e=V5.options,children:t},n)=>{const r=JSON.stringify(e),s=Th(async()=>{const{FilesetResolver:o,FaceLandmarker:a}=await k1(async()=>{const{FilesetResolver:c,FaceLandmarker:u}=await Promise.resolve().then(()=>s_e);return{FilesetResolver:c,FaceLandmarker:u}},void 0,import.meta.url),l=await o.forVisionTasks(i);return a.createFromOptions(l,e)},[i,r]);return w.useEffect(()=>()=>{s==null||s.close(),px([i,r])},[s,i,r]),w.useImperativeHandle(n,()=>s,[s]),w.createElement(yj.Provider,{value:s},t)});function vj(){return w.useContext(yj)}function pO(i,e){return i.clone().add(e).multiplyScalar(.5)}function m1(i,e,t){const n=i.localToWorld(e);return t.worldToLocal(n)}const xj=w.createContext({}),oEe=w.forwardRef(({camera:i,videoTexture:e={start:!0},manualDetect:t=!1,faceLandmarkerResult:n,manualUpdate:r=!1,makeDefault:s,smoothTime:o=.25,offset:a=!0,offsetScalar:l=80,eyes:c=!1,eyesAsOrigin:u=!0,depth:h=.15,debug:f=!1,facemesh:d},m)=>{var A,g;const y=Ve(ie=>ie.scene),E=Ve(ie=>ie.camera),x=Ve(ie=>ie.set),C=Ve(ie=>ie.get),T=i||E,I=w.useRef(null),[M]=w.useState(()=>new _n),[L]=w.useState(()=>new H),[R]=w.useState(()=>new H),[P]=w.useState(()=>new H),[F]=w.useState(()=>new H),k=w.useCallback(()=>{M.parent=T.parent;const ie=I.current;if(ie){const{outerRef:re,eyeRightRef:se,eyeLeftRef:ge}=ie;if(se.current&&ge.current){const{irisDirRef:xe}=se.current,{irisDirRef:pe}=ge.current;xe.current&&pe.current&&re.current&&(L.copy(m1(xe.current,new H(0,0,0),re.current)),R.copy(m1(pe.current,new H(0,0,0),re.current)),M.position.copy(m1(re.current,pO(L,R),T.parent||y)),P.copy(m1(xe.current,new H(0,0,1),re.current)),F.copy(m1(pe.current,new H(0,0,1),re.current)),M.lookAt(re.current.localToWorld(pO(P,F))))}else re.current&&(M.position.copy(m1(re.current,new H(0,0,0),T.parent||y)),M.lookAt(re.current.localToWorld(new H(0,0,1))))}return M},[T,R,F,L,P,y,M]),[z]=w.useState(()=>new _n),U=w.useCallback(function(ie,re){if(T){var se;(se=re)!==null&&se!==void 0||(re=k()),o>0?(iA.damp3(z.position,re.position,o,ie,void 0,void 0,1e-9),iA.dampE(z.rotation,re.rotation,o,ie,void 0,void 0,1e-9)):(z.position.copy(re.position),z.rotation.copy(re.rotation)),T.position.copy(z.position),T.rotation.copy(z.rotation)}},[T,k,o,z.position,z.rotation]);Kt((ie,re)=>{r||U(re)});const W=w.useRef(null),[$,oe]=w.useState(),X=vj(),Q=w.useCallback((ie,re)=>{const se=W.current;if(!se)return;const ge=se.source.data,xe=X==null?void 0:X.detectForVideo(ge,ie);oe(xe)},[X]),Y=w.useMemo(()=>Object.assign(Object.create(Ch.prototype),{computeTarget:k,update:U,facemeshApiRef:I}),[k,U]);w.useImperativeHandle(m,()=>Y,[Y]),w.useEffect(()=>{if(s){const ie=C().controls;return x({controls:Y}),()=>x({controls:ie})}},[s,Y,C,x]);const O=n??$,K=O==null?void 0:O.faceLandmarks[0],te=O==null||(A=O.facialTransformationMatrixes)==null?void 0:A[0],q=O==null||(g=O.faceBlendshapes)==null?void 0:g[0],J={onVideoFrame:Q,...e};return w.createElement(xj.Provider,{value:Y},!t&&w.createElement(w.Suspense,{fallback:null},"src"in J?w.createElement(S4,ot({ref:W},J)):w.createElement(gj,ot({ref:W},J))),w.createElement(Aj,ot({ref:I,children:w.createElement("meshNormalMaterial",{side:Pi})},d,{points:K,depth:h,facialTransformationMatrix:te,faceBlendshapes:q,eyes:c,eyesAsOrigin:u,offset:a,offsetScalar:l,debug:f,"rotation-z":Math.PI,visible:f})))}),aEe=()=>w.useContext(xj),lEe=Object.freeze(Object.defineProperty({__proto__:null,AccumulativeShadows:jW,AdaptiveDpr:pxe,AdaptiveEvents:mxe,ArcballControls:Cde,AsciiRenderer:lde,BBAnchor:Bye,Backdrop:m2e,BakeShadows:fxe,Billboard:zH,Bounds:FW,Box:yve,Bvh:wye,CameraControls:Pde,CameraShake:Vve,Capsule:kve,CatmullRomLine:Lhe,Caustics:v2e,Center:s8,Circle:vve,Clone:G2,Cloud:k2e,CloudInstance:H5,Clouds:XW,ComputedAttribute:Zfe,Cone:xve,ContactShadows:WW,CubeCamera:xde,CubeTexture:Xde,CubicBezierLine:Rhe,CurveModifier:eve,CycleRaycast:pre,Cylinder:Eve,Decal:sde,Detailed:uxe,DetectGPU:lAe,DeviceOrientationControls:Ede,Dodecahedron:Pve,DragControls:Dse,Edges:iQ,Effects:Bfe,Environment:VW,EnvironmentCube:d8,EnvironmentMap:L4,EnvironmentPortal:QW,Example:Nye,Extrude:Bve,FaceControls:oEe,FaceLandmarker:sEe,FaceLandmarkerDefaults:V5,Facemesh:Aj,FacemeshDatas:lS,FacemeshEye:Q5,FacemeshEyeDefaults:C1,Fbo:gde,Fbx:qde,FirstPersonControls:Ide,Fisheye:_xe,Float:Wve,FlyControls:_de,GizmoHelper:Ude,GizmoViewcube:jde,GizmoViewport:Kde,Gltf:ade,GradientTexture:Dfe,GradientType:u5,Grid:Yde,Helper:V1e,Html:CA,Hud:mQ,Icosahedron:Rve,Image:Ufe,Instance:M4,InstancedAttribute:Xye,Instances:R4,IsObject:Q1,KeyboardControls:Zae,Ktx2:Jde,Lathe:Dve,Lightformer:M2e,Line:Cu,Loader:Ere,MapControls:Sde,MarchingCube:nde,MarchingCubes:tde,MarchingPlane:ide,Mask:xxe,MatcapTexture:H2e,Merged:$ye,MeshDiscardMaterial:dve,MeshDistortMaterial:ive,MeshPortalMaterial:Cxe,MeshReflectorMaterial:ave,MeshRefractionMaterial:uve,MeshTransmissionMaterial:fve,MeshWobbleMaterial:sve,MotionPathControls:kde,MultiMaterial:pve,NormalTexture:W2e,Octahedron:Lve,OrbitControls:hQ,OrthographicCamera:cQ,Outlines:zfe,PerformanceMonitor:gxe,PerspectiveCamera:vde,PivotControls:eEe,Plane:Sve,Point:oxe,PointMaterial:mve,PointMaterialImpl:DW,PointerLockControls:bde,Points:axe,PointsBuffer:oj,Polyhedron:Mve,PositionMesh:MW,PositionPoint:rj,PositionalAudio:Phe,Preload:hxe,PresentationControls:Xae,Progress:vre,QuadraticBezierLine:Mhe,RandomizedLight:KW,Reflector:x2e,RenderCubeTexture:hj,RenderTexture:uj,Resize:Gve,Ring:Ive,RoundedBox:Nve,Sampler:Jfe,ScreenQuad:zve,ScreenSizer:bhe,ScreenSpace:xhe,ScreenVideoTexture:tEe,Scroll:koe,ScrollControls:Poe,Segment:cxe,SegmentObject:lj,Segments:lxe,Select:yhe,Shadow:g2e,ShadowAlpha:ixe,Shape:Fve,Sky:R2e,SoftShadows:Ave,Sparkles:N2e,Sphere:_ve,Splat:mde,SpotLight:I2e,SpotLightShadow:b2e,SpriteAnimator:Zye,Stage:d2e,Stars:B2e,Stats:X1e,StatsGl:Z1e,Svg:ode,Tetrahedron:bve,Text:ZH,Text3D:tQ,Texture:kfe,Torus:Cve,TorusKnot:Tve,TrackballControls:wde,Trail:qfe,TrailTexture:Oye,TransformControls:Tde,Tube:wve,VideoTexture:S4,View:Wxe,WebcamVideoTexture:gj,Wireframe:nxe,accumulativeContext:p8,calcPosFromAngles:YW,calculateScaleFactor:c4,checkIfFrameIsEmpty:cW,createInstances:Yye,getFirstFrame:u2,isWebGL2Available:Pfe,meshBounds:dxe,shaderMaterial:Ec,useAnimations:Tye,useAspect:tAe,useBVH:Sye,useBounds:OW,useBoxProjectedEnv:Pye,useCamera:nAe,useContextBridge:Cye,useCubeCamera:uQ,useCubeTexture:RR,useCursor:mre,useDepthBuffer:eAe,useDetectGPU:fW,useEnvironment:wx,useFBO:Ea,useFBX:d4,useFaceControls:aEe,useFaceLandmarker:vj,useFont:h4,useGLTF:Sx,useGizmoContext:f4,useHelper:t8,useIntersect:CW,useKTX2:p4,useKeyboardControls:ele,useMask:Exe,useMatcapTexture:ej,useMotion:pQ,useNormalTexture:tj,usePerformanceMonitor:Axe,useProgress:rR,useScroll:aR,useSelect:vhe,useSpriteAnimator:qye,useSpriteLoader:w4,useSurfaceSampler:oQ,useTexture:xp,useTrail:sQ,useTrailTexture:TW,useVideoTexture:lW},Symbol.toStringTag,{value:"Module"}));function mO(i){return MN[i]||RN}function cEe(i,e){const t=new Map;if(i.length===0)return t;const n=new Map;for(const c of e)n.set(c.from,(n.get(c.from)||0)+1),n.set(c.to,(n.get(c.to)||0)+1);let r=i[0],s=0;for(const c of i){const u=n.get(c.id)||0;u>s&&(s=u,r=c)}t.set(r.id,[0,0,0]);const o=[];for(const c of e)c.from===r.id?o.push(c.to):c.to===r.id&&o.push(c.from);const a=1.5,l=109.5*Math.PI/180;o.forEach((c,u)=>{const h=2*Math.PI*u/o.length,f=u===0?0:l,d=a*Math.sin(f)*Math.cos(h),m=a*Math.cos(f),A=a*Math.sin(f)*Math.sin(h);t.set(c,[d,m,A])});for(const c of i)if(!t.has(c.id)){const u=Math.random()*2*Math.PI,h=Math.acos(2*Math.random()-1),f=a*2;t.set(c.id,[f*Math.sin(h)*Math.cos(u),f*Math.cos(h),f*Math.sin(h)*Math.sin(u)])}return t}function uEe({atom:i,position:e,radius:t,color:n,showLabel:r=!1,interactive:s=!1,onClick:o}){const a=w.useRef(null),l=w.useCallback(h=>{h.stopPropagation(),o==null||o()},[o]),c=w.useCallback(()=>{s&&a.current&&(document.body.style.cursor="pointer")},[s]),u=w.useCallback(()=>{s&&(document.body.style.cursor="default")},[s]);return Z.jsxs("group",{position:e,children:[Z.jsxs("mesh",{ref:a,onClick:s?l:void 0,onPointerOver:c,onPointerOut:u,children:[Z.jsx("sphereGeometry",{args:[t,32,32]}),Z.jsx("meshStandardMaterial",{color:n,roughness:.4,metalness:.1})]}),r&&Z.jsx(ZH,{position:[0,t+.2,0],fontSize:.3,color:"#ffffff",anchorX:"center",anchorY:"middle",outlineWidth:.02,outlineColor:"#000000",children:i.symbol})]})}function hEe({start:i,end:e,radius:t,color:n}){const r=[(i[0]+e[0])/2,(i[1]+e[1])/2,(i[2]+e[2])/2],s=new H(e[0]-i[0],e[1]-i[1],e[2]-i[2]),o=s.length(),a=new Xt;return a.setFromUnitVectors(new H(0,1,0),s.normalize()),Z.jsxs("mesh",{position:r,quaternion:a,children:[Z.jsx("cylinderGeometry",{args:[t,t,o,16]}),Z.jsx("meshStandardMaterial",{color:n,roughness:.5,metalness:.2})]})}function fEe({molecule:i,style:e="ball-stick",showLabels:t=!1,onAtomClick:n}){const r=w.useMemo(()=>cEe(i.atoms,i.bonds),[i.atoms,i.bonds]),s=w.useCallback(o=>{const a=mO(o);return e==="space-fill"?a.radius*.8:a.radius*.35},[e]);return Z.jsxs(Z.Fragment,{children:[Z.jsx("ambientLight",{intensity:.5}),Z.jsx("directionalLight",{position:[5,5,5],intensity:1}),Z.jsx("directionalLight",{position:[-5,-5,-5],intensity:.3}),i.atoms.map(o=>{const a=r.get(o.id)||[0,0,0],l=mO(o.symbol),c=s(o.symbol);return Z.jsx(uEe,{atom:o,position:a,radius:c,color:l.color,showLabel:t,interactive:!!n,onClick:()=>n==null?void 0:n(o.id,o)},o.id)}),e==="ball-stick"&&i.bonds.map((o,a)=>{const l=r.get(o.from)||[0,0,0],c=r.get(o.to)||[0,0,0];return Z.jsx(hEe,{start:l,end:c,radius:.08,color:"#374151"},`bond-${a}`)})]})}function dEe({text:i="Loading 3D viewer..."}){return Z.jsx(CA,{center:!0,children:Z.jsx("div",{className:"text-gray-500 text-sm",children:i})})}function gO({molecule:i,style:e="ball-stick",showLabels:t=!1,autoRotate:n=!1,autoRotateSpeed:r=2,cameraPreset:s="default",onAtomClick:o,width:a="100%",height:l=300,backgroundColor:c="transparent",className:u="",loadingFallback:h}){const f=w.useMemo(()=>{switch(s){case"top":return[0,5,0];case"front":return[0,0,5];case"side":return[5,0,0];case"default":default:return[3,2,3]}},[s]);return Z.jsx("div",{className:`molecule-viewer-3d ${u}`,style:{width:typeof a=="number"?`${a}px`:a,height:typeof l=="number"?`${l}px`:l,backgroundColor:c},children:Z.jsxs(Zz,{camera:{position:f,fov:50},style:{background:c},children:[Z.jsx(w.Suspense,{fallback:h||Z.jsx(dEe,{}),children:Z.jsx(fEe,{molecule:i,style:e,showLabels:t,onAtomClick:o})}),Z.jsx(hQ,{autoRotate:n,autoRotateSpeed:r,enablePan:!0,enableZoom:!0,enableRotate:!0})]})})}const pEe=Object.freeze(Object.defineProperty({__proto__:null,MoleculeViewer3D:gO,default:gO},Symbol.toStringTag,{value:"Module"}));function Ej(i){const e=[...i];for(let t=e.length-1;t>0;t--){const n=Math.floor(Math.random()*(t+1));[e[t],e[n]]=[e[n],e[t]]}return e}const mEe={count_valence:"Gildisrafeindir eru rafeindir í ystu skel. Hópnúmer (1-8 fyrir aðalflokka) segir beint til um fjöldann.",total_electrons:"Heildarfjöldi = summa gildisrafeinda allra atóma. Mundu að margfalda með fjölda atóma af hverri tegund.",octet_rule:"Áttureglan segir að atóm vilja hafa 8 rafeindir í ystu skel (nema H sem vill 2).",electron_need:"Rafeindaþörf = 8 - gildisrafeindir (eða 2 - gildisrafeindir fyrir H)."},gEe={count_valence:["Lotukerfið","Hópar","Rafeindaskel"],total_electrons:["Sameindaformúlur","Atómafjöldi","Summa rafeinda"],octet_rule:["Áttureglan","Stöðugleiki","Eðalgösin"],electron_need:["Efnatengi","Rafeindasameignir","Jónatengi"]},AEe={H:1,Li:1,Na:1,K:1,Be:2,Mg:2,Ca:2,B:3,Al:3,C:4,Si:4,N:5,P:5,O:6,S:6,F:7,Cl:7,Br:7,I:7,He:2,Ne:8,Ar:8},Mv=[{id:1,title:"Gildisrafeindir í hópi",type:"count_valence",question:"Hversu margar gildisrafeindir hefur kolefni (C)?",correctAnswer:4,hints:{topic:"Gildisrafeindir tengjast hópnúmeri frumefnisins í lotukerfinu.",strategy:"Finndu kolefni (C) í lotukerfinu og athugaðu hvaða hóp það er í.",method:"Kolefni er í hópi 14 (IV A). Fyrir aðalflokksfrumefni: gildisrafeindir = hópnúmer - 10.",solution:"C er í hópi 14: 14 - 10 = 4 gildisrafeindir."},explanation:"C er í hópi 14, sem þýðir 4 gildisrafeindir. Hópnúmerið (1-8 fyrir aðalflokka) segir beint til um gildisrafeindafjöldann."},{id:2,title:"Súrefni og halógenar",type:"count_valence",question:"Hversu margar gildisrafeindir hefur klór (Cl)?",correctAnswer:7,hints:{topic:"Halógenar eru í hópi 17 í lotukerfinu.",strategy:"Finndu klór og athugaðu hvaða hóp það tilheyrir.",method:"Klór er halógen í hópi 17 (VII A). Gildisrafeindir = 17 - 10 = 7.",solution:"Cl hefur 7 gildisrafeindir og þarf því 1 rafeind til að ná áttureglunni."},explanation:"Cl er í hópi 17 (VII A), sem þýðir 7 gildisrafeindir. Halógenar þurfa 1 rafeind til að ná áttureglunni."},{id:3,title:"Heildarfjöldi í sameind",type:"total_electrons",question:"Hversu margar gildisrafeindir eru alls í H₂O?",molecule:"H₂O",elements:[{symbol:"H",count:2,valence:1},{symbol:"O",count:1,valence:6}],correctAnswer:8,hints:{topic:"Heildarfjöldi gildisrafeinda er summa allra atóma í sameindinni.",strategy:"Leggðu saman gildisrafeindir hvers atóms: fjöldi × gildisrafeindir.",method:"H₂O: 2×H + 1×O = 2×(1) + 1×(6)",solution:"2(1) + 1(6) = 2 + 6 = 8 gildisrafeindir."},explanation:"H₂O: 2(1) + 1(6) = 2 + 6 = 8 gildisrafeindir. Þetta er lykilskref áður en þú teiknar Lewis-formúlu."},{id:4,title:"Ammóníak",type:"total_electrons",question:"Hversu margar gildisrafeindir eru alls í NH₃?",molecule:"NH₃",elements:[{symbol:"N",count:1,valence:5},{symbol:"H",count:3,valence:1}],correctAnswer:8,hints:{topic:"Nitur (N) er í hópi 15, vetni (H) í hópi 1.",strategy:"Margfaldaðu fjölda hvers atóms með gildisrafeindafjölda þess.",method:"NH₃: 1×N + 3×H = 1×(5) + 3×(1)",solution:"1(5) + 3(1) = 5 + 3 = 8 gildisrafeindir."},explanation:"NH₃: 1(5) + 3(1) = 5 + 3 = 8 gildisrafeindir. Nitur hefur 5 og hvert vetni 1."},{id:5,title:"Koltvísýringur",type:"total_electrons",question:"Hversu margar gildisrafeindir eru alls í CO₂?",molecule:"CO₂",elements:[{symbol:"C",count:1,valence:4},{symbol:"O",count:2,valence:6}],correctAnswer:16,hints:{topic:"Kolefni (C) hefur 4 gildisrafeindir, súrefni (O) hefur 6.",strategy:"Leggðu saman: fjöldi hvers atóms × gildisrafeindir þess.",method:"CO₂: 1×C + 2×O = 1×(4) + 2×(6)",solution:"1(4) + 2(6) = 4 + 12 = 16 gildisrafeindir (8 rafeindarapör)."},explanation:"CO₂: 1(4) + 2(6) = 4 + 12 = 16 gildisrafeindir. Þetta eru 8 rafeindarapör til að skipta á milli atóma."},{id:6,title:"Jónir og hleðsla",type:"total_electrons",question:"Hversu margar gildisrafeindir eru alls í OH⁻?",molecule:"OH⁻",elements:[{symbol:"O",count:1,valence:6},{symbol:"H",count:1,valence:1}],charge:-1,correctAnswer:8,hints:{topic:"Hleðsla jónar hefur áhrif á heildarfjölda gildisrafeinda.",strategy:"Neikvæð hleðsla bætir við rafeindum, jákvæð dregur frá.",method:"OH⁻: O + H + hleðsla = 6 + 1 + 1 (vegna -1)",solution:"6 + 1 + 1 = 8 gildisrafeindir. Neikvæð hleðsla = fleiri rafeindir."},explanation:"OH⁻: 6 + 1 + 1 (vegna -1 hleðslu) = 8 gildisrafeindir. Neikvæð hleðsla = fleiri rafeindir."},{id:7,title:"Áttureglann",type:"octet_rule",question:"Hversu margar rafeindir vill súrefni hafa í ystu skel sinni?",correctAnswer:8,options:[{id:"a",text:"2 rafeindir",correct:!1,explanation:"Þetta á við um vetni (H) og helíum (He)."},{id:"b",text:"6 rafeindir",correct:!1,explanation:"Súrefni HEFUR 6 gildisrafeindir, en það VILL hafa 8."},{id:"c",text:"8 rafeindir",correct:!0,explanation:"Rétt! Áttureglan segir að atóm vilja hafa 8 rafeindir í ystu skel."},{id:"d",text:"18 rafeindir",correct:!1,explanation:"18 er fyrir d-undirskeljar, ekki s og p."}],hints:{topic:"Áttureglan (octet rule) er grundvallarregla í efnafræði.",strategy:"Hugsaðu um eðalgastegundir - þær eru stöðugar vegna fullrar ystu skeljar.",method:"Flest atóm vilja líkja eftir eðalgastegundum með 8 rafeindir í ystu skel.",solution:"Súrefni vill hafa 8 rafeindir í ystu skel (áttureglan)."},explanation:"Áttureglan: Atóm vilja hafa 8 rafeindir í ystu skel til að vera stöðug (eins og eðalgastegundir)."},{id:8,title:"Rafeindir sem vantar",type:"electron_need",question:"Ef klór hefur 7 gildisrafeindir, hversu margar rafeindir vantar til að uppfylla átturegluna?",correctAnswer:1,hints:{topic:"Áttureglan segir að atóm vilja hafa 8 rafeindir í ystu skel.",strategy:"Reiknaðu mismuninn á milli 8 og núverandi gildisrafeinda.",method:"Rafeindir sem vantar = 8 - gildisrafeindir",solution:"8 - 7 = 1 rafeind. Þess vegna myndar Cl eitt efnatengi."},explanation:"Klór þarf 8 - 7 = 1 rafeind til að uppfylla átturegluna. Þess vegna myndar Cl gjarnan eitt efnatengi."}],yEe=120;function vEe({onComplete:i,onBack:e,onCorrectAnswer:t,onIncorrectAnswer:n}){const[r,s]=w.useState(0),[o,a]=w.useState(""),[l,c]=w.useState(null),[u,h]=w.useState(!1),[f,d]=w.useState(1),[m,A]=w.useState(0),[g,y]=w.useState(!1),[E,x]=w.useState(0),C=Mv[r],T=15,I=w.useMemo(()=>C.options?Ej(C.options).map((P,F)=>({...P,id:String.fromCharCode(97+F)})):[],[r,C.options]),M=()=>{let R=!1;if(I.length>0){const P=I.find(F=>F.id===l);R=(P==null?void 0:P.correct)??!1}else R=parseInt(o)===C.correctAnswer;if(y(R),R){t==null||t();const P=Math.round(T*f);x(F=>F+P)}else n==null||n();h(!0)},L=()=>{r<Mv.length-1?(s(R=>R+1),a(""),c(null),h(!1),d(1),A(0),y(!1)):i(E,yEe,m)};return Z.jsx("div",{className:"min-h-screen bg-gradient-to-br from-teal-50 to-cyan-100 p-4 md:p-8",children:Z.jsxs("div",{className:"max-w-3xl mx-auto",children:[Z.jsxs("div",{className:"flex items-center justify-between mb-6",children:[Z.jsxs("button",{onClick:e,className:"text-gray-600 hover:text-gray-800 flex items-center gap-2",children:[Z.jsx("span",{children:"←"})," Til baka"]}),Z.jsxs("div",{className:"text-right",children:[Z.jsxs("div",{className:"text-sm text-gray-600",children:["Stig 1 / Þraut ",r+1," af ",Mv.length]}),Z.jsxs("div",{className:"text-lg font-bold text-blue-600",children:[E," stig"]})]})]}),Z.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 mb-6",children:Z.jsx("div",{className:"bg-blue-500 h-2 rounded-full transition-all duration-300",style:{width:`${(r+1)/Mv.length*100}%`}})}),Z.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl p-6 md:p-8",children:[Z.jsx("h2",{className:"text-2xl font-bold text-blue-800 mb-4",children:C.title}),C.molecule&&Z.jsxs("div",{className:"bg-indigo-50 p-4 rounded-xl mb-4",children:[Z.jsx("div",{className:"text-center font-mono text-3xl font-bold text-indigo-800",children:C.molecule}),C.elements&&Z.jsxs("div",{className:"flex justify-center gap-4 mt-3",children:[C.elements.map((R,P)=>Z.jsxs("div",{className:"text-center",children:[Z.jsx("div",{className:"font-bold text-indigo-600",children:R.symbol}),Z.jsxs("div",{className:"text-sm text-gray-600",children:[R.count," × ",R.valence," = ",R.count*R.valence]})]},P)),C.charge&&Z.jsxs("div",{className:"text-center",children:[Z.jsx("div",{className:"font-bold text-red-600",children:"Hleðsla"}),Z.jsx("div",{className:"text-sm text-gray-600",children:C.charge>0?`-${C.charge}`:`+${Math.abs(C.charge)}`})]})]})]}),Z.jsx("p",{className:"text-gray-700 text-lg mb-6",children:C.question}),I.length>0?Z.jsx("div",{className:"space-y-3 mb-6",children:I.map(R=>Z.jsxs("button",{onClick:()=>!u&&c(R.id),disabled:u,className:`w-full p-4 rounded-xl border-2 text-left transition-all ${u?R.correct?"border-green-500 bg-green-50":l===R.id?"border-red-500 bg-red-50":"border-gray-200 bg-gray-50 opacity-50":l===R.id?"border-blue-500 bg-blue-50 ring-2 ring-blue-200":"border-gray-300 hover:border-blue-400 hover:bg-blue-50"}`,children:[Z.jsxs("div",{className:"flex items-start gap-3",children:[Z.jsxs("span",{className:"font-bold text-gray-500 uppercase",children:[R.id,"."]}),Z.jsx("span",{className:"flex-1",children:R.text})]}),u&&l===R.id&&Z.jsx("div",{className:`mt-2 text-sm ${R.correct?"text-green-700":"text-red-700"}`,children:R.explanation})]},R.id))}):Z.jsx("div",{className:"mb-6",children:Z.jsxs("div",{className:"flex gap-4 items-center",children:[Z.jsx("input",{type:"number",value:o,onChange:R=>a(R.target.value),disabled:u,className:"flex-1 p-4 border-2 border-gray-300 rounded-xl focus:border-blue-500 focus:outline-none text-2xl font-mono text-center",placeholder:"?"}),Z.jsx("span",{className:"text-gray-600 font-medium",children:"rafeindir"})]})}),Z.jsx("div",{className:"mb-4",children:Z.jsx(FY,{hints:C.hints,basePoints:T,onHintUsed:R=>A(R),onPointsChange:d,disabled:u,resetKey:r})}),!u&&Z.jsx("button",{onClick:M,disabled:I.length>0?!l:!o,className:"w-full bg-blue-500 hover:bg-blue-600 disabled:bg-gray-300 text-white font-bold py-4 px-6 rounded-xl transition-colors",children:"Athuga svar"}),u&&Z.jsx("div",{className:"mb-4",children:Z.jsx(DN,{feedback:{isCorrect:g,explanation:g?C.explanation:`Rétt svar: ${C.correctAnswer}. ${C.explanation}`,misconception:g?void 0:mEe[C.type],relatedConcepts:gEe[C.type],nextSteps:g?"Frábært! Þú skilur þetta vel. Haltu áfram.":"Skoðaðu útskýringuna og reyndu að muna regluna."},config:{showExplanation:!0,showMisconceptions:!g,showRelatedConcepts:!0,showNextSteps:!0}})}),u&&Z.jsx("button",{onClick:L,className:"w-full bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-4 px-6 rounded-xl transition-colors",children:r<Mv.length-1?"Næsta þraut":"Ljúka stigi 1"})]}),Z.jsxs("div",{className:"mt-6 bg-white rounded-xl p-4 shadow",children:[Z.jsx("h3",{className:"font-bold text-gray-700 mb-3",children:"Gildisrafeindatafla"}),Z.jsx("div",{className:"grid grid-cols-4 md:grid-cols-8 gap-2 text-sm",children:Object.entries(AEe).slice(0,16).map(([R,P])=>Z.jsxs("div",{className:"bg-gray-50 p-2 rounded text-center border",children:[Z.jsx("div",{className:"font-bold text-gray-800",children:R}),Z.jsx("div",{className:"text-blue-600",children:P})]},R))})]})]})})}function xEe(i,e){const t=i+e;if(t===2&&i===0)return"linear";if(t===3){if(i===0)return"trigonal-planar";if(i===1)return"bent"}if(t===4){if(i===0)return"tetrahedral";if(i===1)return"trigonal-pyramidal";if(i===2)return"bent"}if(e===1)return"linear"}function EEe(i,e,t){const n=[],r=[],s=`${i.centralAtom.toLowerCase()}-central`;n.push({id:s,symbol:i.centralAtom,lonePairs:i.centralLonePairs,formalCharge:i.centralFormalCharge,isRadical:i.centralUnpairedElectron}),i.surroundingAtoms.forEach((a,l)=>{const c=`${a.symbol.toLowerCase()}-${l}`;n.push({id:c,symbol:a.symbol,lonePairs:a.lonePairs,formalCharge:a.formalCharge}),r.push({from:s,to:c,type:a.bondType})});const o=xEe(i.centralLonePairs,i.surroundingAtoms.length);return{id:e.toLowerCase().replace(/[₀₁₂₃₄₅₆₇₈₉⁺⁻]/g,""),formula:e,name:t,atoms:n,bonds:r,geometry:o}}const _Ee={lone_pairs:"Einstæð pör eru rafeindir sem tilheyra einu atómi og taka ekki þátt í efnabindingum."},AO=["Lewis-formúlur","Gildisrafeindir","Áttureglan","Efnatengi"],B_=[{id:1,title:"Vatn (H₂O)",molecule:"H₂O",totalElectrons:8,correctStructure:{centralAtom:"O",surroundingAtoms:[{symbol:"H",bondType:"single",lonePairs:0},{symbol:"H",bondType:"single",lonePairs:0}],centralLonePairs:2},steps:[{question:"Hvert er miðatómið í H₂O?",type:"central_atom",options:[{id:"H",text:"Vetni (H)",correct:!1},{id:"O",text:"Súrefni (O)",correct:!0}],explanation:"Súrefni er miðatómið - það hefur fleiri gildisrafeindir og getur myndað fleiri tengsl."},{question:"Hversu mörg einföld tengsl eru á milli O og H atómanna?",type:"bond_count",options:[{id:"1",text:"1 tengi",correct:!1},{id:"2",text:"2 tengsl",correct:!0},{id:"3",text:"3 tengsl",correct:!1}],explanation:"Tvö einföld tengsl - eitt til hvers vetnis. Þetta notar 4 rafeindir."},{question:"Hversu mörg einstæð rafeindarapör (lone pairs) eru á súrefninu?",type:"lone_pairs_central",options:[{id:"0",text:"0 pör",correct:!1},{id:"1",text:"1 par",correct:!1},{id:"2",text:"2 pör",correct:!0},{id:"3",text:"3 pör",correct:!1}],explanation:"8 heildarrafeindir - 4 í tengslum = 4 óbundnar, sem eru 2 einstæð rafeindarapör."}],hint:"H getur aðeins myndað 1 tengi, þannig að O verður að vera miðatómið",finalExplanation:"H₂O: O í miðju með 2 H tengd og 2 einstæð rafeindarapör. Þetta gefur 4 rafeindarapör í kringum O."},{id:2,title:"Ammóníak (NH₃)",molecule:"NH₃",totalElectrons:8,correctStructure:{centralAtom:"N",surroundingAtoms:[{symbol:"H",bondType:"single",lonePairs:0},{symbol:"H",bondType:"single",lonePairs:0},{symbol:"H",bondType:"single",lonePairs:0}],centralLonePairs:1},steps:[{question:"Hvert er miðatómið í NH₃?",type:"central_atom",options:[{id:"N",text:"Nitur (N)",correct:!0},{id:"H",text:"Vetni (H)",correct:!1}],explanation:"Nitur er miðatómið með 5 gildisrafeindir."},{question:"Hversu mörg einföld N-H tengsl eru?",type:"bond_count",options:[{id:"2",text:"2 tengsl",correct:!1},{id:"3",text:"3 tengsl",correct:!0},{id:"4",text:"4 tengsl",correct:!1}],explanation:"Þrjú einföld tengsl - eitt til hvers vetnis. Þetta notar 6 rafeindir."},{question:"Hversu mörg einstæð rafeindarapör eru á nitrinu?",type:"lone_pairs_central",options:[{id:"0",text:"0 pör",correct:!1},{id:"1",text:"1 par",correct:!0},{id:"2",text:"2 pör",correct:!1}],explanation:"8 heildarrafeindir - 6 í tengslum = 2 óbundnar, sem eru 1 einstætt rafeindarapar."}],hint:"N hefur 5 gildisrafeindir, þannig að það getur myndað 3 tengsl og hefur 1 einstætt par",finalExplanation:"NH₃: N í miðju með 3 H tengd og 1 einstætt rafeindarapar. Þetta gerir N tetrahedral en sameindina pýramídalaga."},{id:3,title:"Koltvísýringur (CO₂)",molecule:"CO₂",totalElectrons:16,correctStructure:{centralAtom:"C",surroundingAtoms:[{symbol:"O",bondType:"double",lonePairs:2},{symbol:"O",bondType:"double",lonePairs:2}],centralLonePairs:0},steps:[{question:"Hvert er miðatómið í CO₂?",type:"central_atom",options:[{id:"C",text:"Kolefni (C)",correct:!0},{id:"O",text:"Súrefni (O)",correct:!1}],explanation:"Kolefni er miðatómið - það hefur færri rafeindir og stendur venjulega í miðjunni."},{question:"Hvers konar tengsl eru á milli C og O?",type:"bond_count",options:[{id:"single",text:"Einföld tengsl (C-O)",correct:!1},{id:"double",text:"Tvöföld tengsl (C=O)",correct:!0},{id:"triple",text:"Þreföld tengsl (C≡O)",correct:!1}],explanation:"Tvöföld tengsl til beggja súrefna. C myndar 4 tengsl alls (2+2) og hvert O hefur 8 rafeindir."},{question:"Hversu mörg einstæð rafeindarapör eru á HVERJU súrefni?",type:"lone_pairs_surrounding",options:[{id:"1",text:"1 par",correct:!1},{id:"2",text:"2 pör",correct:!0},{id:"3",text:"3 pör",correct:!1}],explanation:"Hvert O hefur 2 einstæð rafeindarapör. Ásamt tvöföldu tengslunum hefur hvert O 8 rafeindir."}],hint:"C þarf 4 tengsl og hvert O þarf 2 tengsl (fyrir áttu)",finalExplanation:"CO₂: O=C=O með tvöföldum tengslum. Hvert O hefur 2 einstæð pör. Þetta er línuleg sameind."},{id:4,title:"Metan (CH₄)",molecule:"CH₄",totalElectrons:8,correctStructure:{centralAtom:"C",surroundingAtoms:[{symbol:"H",bondType:"single",lonePairs:0},{symbol:"H",bondType:"single",lonePairs:0},{symbol:"H",bondType:"single",lonePairs:0},{symbol:"H",bondType:"single",lonePairs:0}],centralLonePairs:0},steps:[{question:"Hvert er miðatómið í CH₄?",type:"central_atom",options:[{id:"C",text:"Kolefni (C)",correct:!0},{id:"H",text:"Vetni (H)",correct:!1}],explanation:"Kolefni er miðatómið með 4 gildisrafeindir."},{question:"Hversu mörg C-H tengsl eru í metan?",type:"bond_count",options:[{id:"3",text:"3 tengsl",correct:!1},{id:"4",text:"4 tengsl",correct:!0},{id:"5",text:"5 tengsl",correct:!1}],explanation:"4 einföld C-H tengsl. Þetta notar allar 8 rafeindirnar."},{question:"Eru einhver einstæð rafeindarapör á kolefninu?",type:"lone_pairs_central",options:[{id:"0",text:"Nei, engin",correct:!0},{id:"1",text:"Já, 1 par",correct:!1},{id:"2",text:"Já, 2 pör",correct:!1}],explanation:"Allar 8 rafeindir eru í tengslum. Kolefni hefur engin einstæð pör í metan."}],hint:"C myndar 4 tengsl og H myndar 1 - þannig kemur CH₄",finalExplanation:"CH₄: C í miðju með 4 H tengd. Engin einstæð rafeindarapör. Þetta er tetrahedal sameind."},{id:5,title:"Nituroxíð (NO)",molecule:"NO",totalElectrons:11,correctStructure:{centralAtom:"N",surroundingAtoms:[{symbol:"O",bondType:"double",lonePairs:2}],centralLonePairs:1,centralUnpairedElectron:!0},steps:[{question:"Þessi sameind hefur oddatölu rafeinda (11). Hvað þýðir það?",type:"central_atom",options:[{id:"radical",text:"Hún hefur óparaða rafeind (radical)",correct:!0},{id:"normal",text:"Ekkert sérstakt",correct:!1}],explanation:"NO er róttæki (radical) með eina óparaða rafeind. Þetta gerir hana mjög hvarfgjarnan."},{question:"Hvers konar tengsl eru á milli N og O?",type:"bond_count",options:[{id:"single",text:"Einföld tengsl",correct:!1},{id:"double",text:"Tvöföld tengsl",correct:!0},{id:"triple",text:"Þreföld tengsl",correct:!1}],explanation:"Tvöföld tengsl (N=O) með óparaðri rafeind á nitrinu."},{question:"Hvar er óparaða rafeindin?",type:"lone_pairs_central",options:[{id:"N",text:"Á nitrinu (N)",correct:!0},{id:"O",text:"Á súrefninu (O)",correct:!1}],explanation:"N hefur óparaða rafeind, sem gerir NO að róttæki."}],hint:"Sameindir með oddatölu rafeinda eru róttæki",finalExplanation:"NO: Tvöföld tengsl N=O með óparaðri rafeind á N. Þetta er róttæki og mjög hvarfgjarnt."},{id:6,title:"Vetni klóríð (HCl)",molecule:"HCl",totalElectrons:8,correctStructure:{centralAtom:"Cl",surroundingAtoms:[{symbol:"H",bondType:"single",lonePairs:0}],centralLonePairs:3},steps:[{question:"Hvers konar tengsl eru í HCl?",type:"bond_count",options:[{id:"single",text:"Einföld tengsl (H-Cl)",correct:!0},{id:"double",text:"Tvöföld tengsl",correct:!1}],explanation:"Eitt einfalt tengi. Bæði H og Cl þurfa aðeins 1 rafeind."},{question:"Hversu mörg einstæð rafeindarapör eru á Cl?",type:"lone_pairs_central",options:[{id:"2",text:"2 pör",correct:!1},{id:"3",text:"3 pör",correct:!0},{id:"4",text:"4 pör",correct:!1}],explanation:"Cl hefur 7 gildisrafeindir. 1 í tengslum, 6 óbundnar = 3 einstæð pör."},{question:"Er áttureglan uppfyllt fyrir Cl?",type:"central_atom",options:[{id:"yes",text:"Já",correct:!0},{id:"no",text:"Nei",correct:!1}],explanation:"Cl hefur 2 (frá tengi) + 6 (einstæð) = 8 rafeindir. Áttureglan er uppfyllt!"}],hint:"Cl þarf aðeins 1 rafeind til að ná áttureglunni",finalExplanation:"HCl: Einfalt H-Cl tengi. Cl hefur 3 einstæð rafeindarapör. Bæði H og Cl hafa fulla ystu skel."}],SEe=90;function wEe({onComplete:i,onBack:e,onCorrectAnswer:t,onIncorrectAnswer:n}){var pe;const[r,s]=w.useState(0),[o,a]=w.useState(0),[l,c]=w.useState(null),[u,h]=w.useState(!1),[f,d]=w.useState(!1),[m,A]=w.useState([]),[g,y]=w.useState(0),[E,x]=w.useState(0),[C,T]=w.useState(!1),[I,M]=w.useState({}),[L,R]=w.useState(!1),[P,F]=w.useState(!1),[k,z]=w.useState("2d"),U=B_[r],W=U.steps[o],$=o===U.steps.length-1,oe=r===B_.length-1,{electronItems:X,atomZones:Q}=w.useMemo(()=>{const ce=U.correctStructure,we=[],Ee=ce.centralLonePairs+ce.surroundingAtoms.reduce((Ae,Le)=>Ae+Le.lonePairs,0);for(let Ae=0;Ae<Ee+2;Ae++)we.push({id:`lone-pair-${Ae}`,content:Z.jsxs("div",{className:"flex items-center gap-1 p-2",children:[Z.jsx("div",{className:"w-2 h-2 rounded-full bg-blue-600"}),Z.jsx("div",{className:"w-2 h-2 rounded-full bg-blue-600"}),Z.jsx("span",{className:"text-xs ml-1",children:"Einstætt par"})]}),category:"electron",data:{type:"lone-pair"}});const ve=[{id:`zone-${ce.centralAtom}`,label:`${ce.centralAtom} (miðatóm)`,maxItems:4,placeholder:"Dragðu einstæð pör hingað",data:{atom:ce.centralAtom,expectedPairs:ce.centralLonePairs,isCentral:!0}}];return ce.surroundingAtoms.forEach((Ae,Le)=>{Ae.lonePairs>0&&ve.push({id:`zone-${Ae.symbol}-${Le}`,label:`${Ae.symbol} (ytri atóm)`,maxItems:4,placeholder:"Dragðu einstæð pör hingað",data:{atom:Ae.symbol,expectedPairs:Ae.lonePairs,isCentral:!1}})}),{electronItems:we,atomZones:ve}},[U]),Y=ce=>{const{itemId:we,zoneId:Ee,index:ve}=ce;M(Ae=>{const Le={...Ae};for(const Te of Object.keys(Le))Le[Te]=Le[Te].filter(ne=>ne!==we);return Le[Ee]||(Le[Ee]=[]),Le[Ee].splice(ve,0,we),Le})},O=(ce,we)=>{M(Ee=>({...Ee,[ce]:we}))},K=()=>{var we;let ce=!0;for(const Ee of Q){const ve=I[Ee.id]||[],Ae=((we=Ee.data)==null?void 0:we.expectedPairs)||0;if(ve.length!==Ae){ce=!1;break}}F(ce),R(!0),ce?(t==null||t(),y(Ee=>Ee+10)):n==null||n()},te=()=>{var we,Ee;if(P)return{isCorrect:!0,explanation:`Rétt! ${U.molecule} hefur ${U.correctStructure.centralLonePairs} einstæð pör á ${U.correctStructure.centralAtom}.`,relatedConcepts:AO,nextSteps:"Þú skilur hvernig einstæð pör dreifast á atóm í Lewis-formúlum."};let ce=`Athugaðu fjölda einstæðra para á hverju atómi:
`;for(const ve of Q){const Ae=(I[ve.id]||[]).length,Le=((we=ve.data)==null?void 0:we.expectedPairs)||0;ce+=`• ${(Ee=ve.data)==null?void 0:Ee.atom}: ${Ae}/${Le} pör
`}return{isCorrect:!1,explanation:ce,misconception:_Ee.lone_pairs,relatedConcepts:AO,nextSteps:"Reiknaðu heildarfjölda gildisrafeinda og dreifðu þeim rétt."}},q=w.useMemo(()=>Ej(W.options),[r,o,W.options]),J=w.useMemo(()=>EEe(U.correctStructure,U.molecule,U.title),[U]),ie=$&&u,re=()=>{var we;const ce=((we=q.find(Ee=>Ee.id===l))==null?void 0:we.correct)??!1;A(Ee=>[...Ee,ce]),ce?(t==null||t(),y(f?Ee=>Ee+2:Ee=>Ee+5)):n==null||n(),h(!0)},se=()=>{$||(a(ce=>ce+1),c(null),h(!1),d(!1))},ge=()=>{T(!0),M({}),R(!1),F(!1)},xe=()=>{oe?i(g,SEe,E):(s(ce=>ce+1),a(0),c(null),h(!1),d(!1),A([]),T(!1),M({}),R(!1),F(!1))};return Z.jsx("div",{className:"min-h-screen bg-gradient-to-br from-teal-50 to-cyan-100 p-4 md:p-8",children:Z.jsxs("div",{className:"max-w-3xl mx-auto",children:[Z.jsxs("div",{className:"flex items-center justify-between mb-6",children:[Z.jsxs("button",{onClick:e,className:"text-gray-600 hover:text-gray-800 flex items-center gap-2",children:[Z.jsx("span",{children:"←"})," Til baka"]}),Z.jsxs("div",{className:"text-right",children:[Z.jsxs("div",{className:"text-sm text-gray-600",children:["Stig 2 / Sameind ",r+1," af ",B_.length]}),Z.jsxs("div",{className:"text-lg font-bold text-green-600",children:[g," stig"]})]})]}),Z.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 mb-6",children:Z.jsx("div",{className:"bg-green-500 h-2 rounded-full transition-all duration-300",style:{width:`${(r+(o+1)/U.steps.length)/B_.length*100}%`}})}),Z.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl p-6 md:p-8",children:[Z.jsx("h2",{className:"text-2xl font-bold text-green-800 mb-2",children:U.title}),Z.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[Z.jsx("span",{className:"font-mono text-3xl font-bold text-indigo-600",children:U.molecule}),Z.jsxs("span",{className:"text-sm text-gray-600",children:["(",U.totalElectrons," gildisrafeindir)"]})]}),Z.jsxs("div",{className:"bg-gray-50 rounded-xl p-4 mb-6",children:[$&&u&&Z.jsxs("div",{className:"flex justify-center gap-2 mb-3",children:[Z.jsx("button",{onClick:()=>z("2d"),className:`px-4 py-1.5 rounded-lg text-sm font-medium transition-colors ${k==="2d"?"bg-green-600 text-white":"bg-gray-200 text-gray-600 hover:bg-gray-300"}`,children:"2D Lewis"}),Z.jsx("button",{onClick:()=>z("3d"),className:`px-4 py-1.5 rounded-lg text-sm font-medium transition-colors ${k==="3d"?"bg-green-600 text-white":"bg-gray-200 text-gray-600 hover:bg-gray-300"}`,children:"3D lögun"})]}),Z.jsx("div",{className:"flex justify-center py-4",children:k==="2d"||!ie?Z.jsx(PY,{molecule:J,mode:"lewis",size:"lg",animation:u?"fade-in":"none",showLonePairs:ie,showFormalCharges:ie,ariaLabel:`Lewis-formúla fyrir ${U.molecule}`}):Z.jsxs("div",{className:"w-full",children:[Z.jsx(KY,{molecule:J,style:"ball-stick",showLabels:!0,autoRotate:!0,autoRotateSpeed:1.5,height:200,width:"100%",backgroundColor:"#f9fafb"}),Z.jsx("div",{className:"text-xs text-gray-500 text-center mt-2",children:"Dragðu til að snúa, skrollaðu til að stækka"})]})}),$&&u&&Z.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-200",children:[Z.jsx("div",{className:"text-xs text-gray-500 mb-2 font-medium",children:"Skýringar:"}),Z.jsxs("div",{className:"flex flex-wrap gap-4 text-xs",children:[Z.jsxs("div",{className:"flex items-center gap-1.5",children:[Z.jsx("div",{className:"w-4 h-4 rounded-full border-2 border-blue-500 bg-blue-100"}),Z.jsx("span",{children:"Miðatóm"})]}),Z.jsxs("div",{className:"flex items-center gap-1.5",children:[Z.jsx("div",{className:"w-4 h-4 rounded-full border-2 border-green-500 bg-green-100"}),Z.jsx("span",{children:"Ytri atóm"})]}),Z.jsxs("div",{className:"flex items-center gap-1.5",children:[Z.jsxs("div",{className:"flex gap-0.5",children:[Z.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-blue-600"}),Z.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-blue-600"})]}),Z.jsx("span",{children:"Einstætt par"})]}),Z.jsxs("div",{className:"flex items-center gap-1.5",children:[Z.jsx("div",{className:"w-6 h-0.5 bg-gray-800"}),Z.jsx("span",{children:"Einfalt tengi"})]}),Z.jsxs("div",{className:"flex items-center gap-1.5",children:[Z.jsxs("div",{className:"flex flex-col gap-0.5",children:[Z.jsx("div",{className:"w-6 h-0.5 bg-gray-800"}),Z.jsx("div",{className:"w-6 h-0.5 bg-gray-800"})]}),Z.jsx("span",{children:"Tvöfalt tengi"})]}),U.correctStructure.centralUnpairedElectron&&Z.jsxs("div",{className:"flex items-center gap-1.5",children:[Z.jsx("div",{className:"w-2 h-2 rounded-full bg-red-500"}),Z.jsx("span",{children:"Óparuð rafeind"})]})]})]})]}),Z.jsx("div",{className:"flex gap-2 mb-4",children:U.steps.map((ce,we)=>Z.jsx("div",{className:`flex-1 h-2 rounded-full ${we<o?m[we]?"bg-green-500":"bg-red-400":we===o?"bg-blue-500":"bg-gray-200"}`},we))}),Z.jsxs("div",{className:"mb-6",children:[Z.jsxs("p",{className:"text-lg font-medium text-gray-800 mb-4",children:["Skref ",o+1,": ",W.question]}),Z.jsx("div",{className:"space-y-3",children:q.map(ce=>Z.jsx("button",{onClick:()=>!u&&c(ce.id),disabled:u,className:`w-full p-4 rounded-xl border-2 text-left transition-all ${u?ce.correct?"border-green-500 bg-green-50":l===ce.id?"border-red-500 bg-red-50":"border-gray-200 bg-gray-50 opacity-50":l===ce.id?"border-green-500 bg-green-50 ring-2 ring-green-200":"border-gray-300 hover:border-green-400 hover:bg-green-50"}`,children:ce.text},ce.id))})]}),u&&Z.jsx("div",{className:`p-4 rounded-xl mb-4 ${(pe=q.find(ce=>ce.id===l))!=null&&pe.correct?"bg-green-50 border border-green-200":"bg-red-50 border border-red-200"}`,children:Z.jsx("p",{className:"text-sm text-gray-700",children:W.explanation})}),$&&u&&!C&&Z.jsxs("div",{className:"bg-indigo-50 p-4 rounded-xl mb-4",children:[Z.jsx("div",{className:"font-bold text-indigo-800 mb-2",children:"Lewis-formúla:"}),Z.jsx("p",{className:"text-indigo-900 text-sm",children:U.finalExplanation})]}),C&&Z.jsxs("div",{className:"mb-6",children:[Z.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-xl p-4 mb-4",children:[Z.jsx("h3",{className:"font-bold text-green-800 mb-2",children:"Byggðu Lewis-formúluna"}),Z.jsxs("p",{className:"text-green-700 text-sm mb-4",children:["Dragðu einstæð rafeindarapör á réttu atómin til að ljúka Lewis-formúlunni fyrir ",U.molecule,"."]}),Z.jsx(GY,{items:X,zones:Q,initialState:I,onDrop:Y,onReorder:O,orientation:"horizontal",disabled:L})]}),L&&Z.jsx("div",{className:"mb-4",children:Z.jsx(DN,{feedback:te(),config:{showExplanation:!0,showMisconceptions:!P,showRelatedConcepts:!0,showNextSteps:!0}})}),L?Z.jsx("button",{onClick:xe,className:"w-full bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-4 px-6 rounded-xl transition-colors",children:oe?"Ljúka stigi 2":"Næsta sameind"}):Z.jsx("button",{onClick:K,className:"w-full bg-green-500 hover:bg-green-600 text-white font-bold py-4 px-6 rounded-xl transition-colors",children:"Athuga byggingu"})]}),!u&&!f&&Z.jsx("button",{onClick:()=>{d(!0),x(ce=>ce+1)},className:"text-green-600 hover:text-green-800 text-sm underline mb-4",children:"Sýna vísbendingu (-3 stig)"}),f&&!u&&Z.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 p-4 rounded-xl mb-4",children:[Z.jsx("span",{className:"font-bold text-yellow-800",children:"Vísbending: "}),Z.jsx("span",{className:"text-yellow-900",children:U.hint})]}),!C&&Z.jsx(Z.Fragment,{children:u?$?Z.jsxs("div",{className:"space-y-3",children:[Q.length>0&&Z.jsxs("button",{onClick:ge,className:"w-full bg-green-500 hover:bg-green-600 text-white font-bold py-4 px-6 rounded-xl transition-colors flex items-center justify-center gap-2",children:[Z.jsx("span",{children:"✋"})," Byggja Lewis-formúlu (bónus +10 stig)"]}),Z.jsx("button",{onClick:xe,className:"w-full bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-4 px-6 rounded-xl transition-colors",children:oe?"Ljúka stigi 2":"Næsta sameind"})]}):Z.jsx("button",{onClick:se,className:"w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-4 px-6 rounded-xl transition-colors",children:"Næsta skref"}):Z.jsx("button",{onClick:re,disabled:!l,className:"w-full bg-green-500 hover:bg-green-600 disabled:bg-gray-300 text-white font-bold py-4 px-6 rounded-xl transition-colors",children:"Athuga"})})]}),Z.jsxs("div",{className:"mt-6 bg-white rounded-xl p-4 shadow",children:[Z.jsx("h3",{className:"font-bold text-gray-700 mb-2",children:"Skref til að teikna Lewis-formúlu:"}),Z.jsxs("ol",{className:"text-sm text-gray-600 space-y-1 list-decimal list-inside",children:[Z.jsx("li",{className:o>=0?"text-green-600 font-medium":"",children:"Veldu miðatóm (oftast það sem hefur flest tengsl)"}),Z.jsx("li",{className:o>=1?"text-green-600 font-medium":"",children:"Teiknaðu einföld tengsl til allra ytri atóma"}),Z.jsx("li",{className:o>=2?"text-green-600 font-medium":"",children:"Dreifðu eftirstandandi rafeindum sem einstæð pör"}),Z.jsx("li",{children:"Breyttu í tvöföld/þreföld tengsl ef þarf til að uppfylla átturegluna"})]})]})]})})}const Rv=[{id:1,title:"Formhleðsla - Formúlan",type:"calculate_fc",molecule:"Formhleðsla",description:"Formhleðsla (formal charge) segir til um hvernig rafeindum er dreift á atóm í Lewis-formúlu.",question:"Hvaða formúla er notuð til að reikna formhleðslu?",correctAnswer:"fc_formula",options:[{id:"fc_formula",text:"FC = Gildisraf. - (óbundnar + ½ bundnar)",correct:!0,explanation:"Rétt! Þetta er formúlan fyrir formhleðslu."},{id:"wrong1",text:"FC = Gildisraf. - (óbundnar + bundnar)",correct:!1,explanation:"Bundnar rafeindir eru sameiginlegar, þannig að þú deilir með 2."},{id:"wrong2",text:"FC = Gildisraf. + óbundnar - bundnar",correct:!1,explanation:"Þú dregur óbundnar og helminginn af bundnum frá gildisrafeindum."}],hint:"Bundnar rafeindir eru sameiginlegar á milli atóma",explanation:"FC = V - (L + ½B) þar sem V = gildisrafeindir, L = lone pair rafeindir, B = bundin rafeindir."},{id:2,title:"Reikna formhleðslu: Súrefni í vatni",type:"calculate_fc",molecule:"H₂O",description:"Í vatni hefur súrefni 2 einstæð pör (4 óbundnar rafeindir) og 2 tengsl (4 bundnar rafeindir).",atoms:[{symbol:"O",valenceElectrons:6,lonePairElectrons:4,bondingElectrons:4,formalCharge:0}],question:"Hver er formhleðsla súrefnisins í H₂O?",correctAnswer:0,options:[{id:"-1",text:"-1",correct:!1,explanation:"FC = 6 - (4 + ½×4) = 6 - 6 = 0, ekki -1."},{id:"0",text:"0",correct:!0,explanation:"Rétt! FC = 6 - (4 + 2) = 0. Súrefnið hefur enga formhleðslu."},{id:"+1",text:"+1",correct:!1,explanation:"Jákvæð formhleðsla myndi þýða of fáar rafeindir."}],hint:"FC = 6 - (4 óbundnar + ½ × 4 bundnar)",explanation:"O í H₂O: FC = 6 - (4 + 2) = 0. Súrefnið hefur enga formhleðslu, sem er æskilegt."},{id:3,title:"Reikna formhleðslu: Nitur í ammóníum",type:"calculate_fc",molecule:"NH₄⁺",description:"Í ammóníumjóninni er nitur tengt við 4 vetni með einföldum tengslum og engin einstæð pör.",atoms:[{symbol:"N",valenceElectrons:5,lonePairElectrons:0,bondingElectrons:8,formalCharge:1}],question:"Hver er formhleðsla nitursins í NH₄⁺?",correctAnswer:1,options:[{id:"0",text:"0",correct:!1,explanation:"Nitur deilir 8 rafeindum en á aðeins 5 gildisrafeindir."},{id:"+1",text:"+1",correct:!0,explanation:"Rétt! FC = 5 - (0 + ½×8) = 5 - 4 = +1."},{id:"-1",text:"-1",correct:!1,explanation:"Neikvæð formhleðsla myndi þýða fleiri rafeindir en gildisrafeindir."}],hint:"Nitur hefur 5 gildisrafeindir en deilir 8 í tengslum",explanation:"N í NH₄⁺: FC = 5 - (0 + 4) = +1. Þetta samræmist við +1 hleðslu jónarinnar."},{id:4,title:"Besta Lewis-formúlan",type:"best_structure",molecule:"CO",description:"Kolsýringur getur teiknast á mismunandi vegu. Formhleðsla hjálpar okkur að velja bestu formúluna.",structures:[{id:"triple",description:"C≡O (þreföld tengsl)",formalCharges:[{atom:"C",charge:-1},{atom:"O",charge:1}],isPreferred:!0,explanation:"Þreföld tengsl uppfylla áttu fyrir bæði atóm og lágmarka formhleðslu."},{id:"double",description:"C=O (tvöföld tengsl)",formalCharges:[{atom:"C",charge:0},{atom:"O",charge:0}],isPreferred:!1,explanation:"Kolefni hefur aðeins 6 rafeindir - uppfyllir ekki áttu."}],question:"Hver er æskilegasta formúlan fyrir CO?",correctAnswer:"triple",options:[{id:"triple",text:":C≡O: með þreföldum tengslum",correct:!0,explanation:"Rétt! Bæði atóm hafa 8 rafeindir, þó formhleðslur séu ekki núll."},{id:"double",text:"C=O með tvöföldum tengslum",correct:!1,explanation:"Kolefni fengi aðeins 6 rafeindir - uppfyllir ekki áttu."}],hint:"Áttureglan er mikilvægari en lágmarks formhleðsla",explanation:"Í CO er þreföld tengsl æskilegust þó hún gefi formhleðslur C⁻ og O⁺, vegna þess að þá uppfylla bæði atóm átturegluna."},{id:5,title:"Samsvörunarformúlur I",type:"resonance",molecule:"NO₂⁻",description:"Nítrítjónin hefur tvær jafngildar samsvörunarformúlur.",resonanceForms:[{id:"a",structure:"O=N-O⁻",isValid:!0},{id:"b",structure:"⁻O-N=O",isValid:!0}],question:"Hversu margar samsvörunarformúlur hefur NO₂⁻?",correctAnswer:"2",options:[{id:"1",text:"1 formúla",correct:!1,explanation:"Tvöfalda tengslin geta verið á sitt hvoru O-inu."},{id:"2",text:"2 formúlur",correct:!0,explanation:"Rétt! O=N-O⁻ og ⁻O-N=O eru jafngildar samsvörunarformúlur."},{id:"3",text:"3 formúlur",correct:!1,explanation:"Aðeins tvær eru mögulegar með þessari rafeindasamsetningu."}],hint:"Tvöfalda tengslin geta verið á sitt hvoru O-inu",explanation:'NO₂⁻ hefur tvær samsvörunarformúlur þar sem tvöfalda tengslin "hoppa" á milli súrefnisatómanna. Raunverulega sameindina er meðaltal beggja.'},{id:6,title:"Samsvörunarformúlur II",type:"resonance",molecule:"CO₃²⁻",description:"Karbónatjónin er klassískt dæmi um samsvörun.",resonanceForms:[{id:"a",structure:"O=C(-O⁻)₂",isValid:!0},{id:"b",structure:"⁻O-C(=O)-O⁻",isValid:!0},{id:"c",structure:"(⁻O)₂-C=O",isValid:!0}],question:"Hversu margar samsvörunarformúlur hefur CO₃²⁻?",correctAnswer:"3",options:[{id:"2",text:"2 formúlur",correct:!1,explanation:"Þrjú súrefni geta hvert um sig haft tvöfalt tengi."},{id:"3",text:"3 formúlur",correct:!0,explanation:"Rétt! Tvöfalda tengið getur verið á hverju súrefni."},{id:"4",text:"4 formúlur",correct:!1,explanation:"Með 3 súrefni eru aðeins 3 möguleikar."}],hint:"Hvert súrefni getur haft tvöfalda tengið",explanation:"CO₃²⁻ hefur þrjár samsvörunarformúlur. Raunveruleg tengsla-lengd er eins fyrir öll þrjú C-O tengslin (á milli einfalds og tvöfalds)."},{id:7,title:"Raunveruleg sameindin",type:"resonance",molecule:"O₃",description:"Ósón hefur tvær samsvörunarformúlur.",question:"Hvaða fullyrðing er rétt um ósón (O₃)?",correctAnswer:"hybrid",options:[{id:"flips",text:'Sameindin "flippar" milli formúla',correct:!1,explanation:"Nei, sameindin er alltaf hybrid - hún breytist ekki."},{id:"hybrid",text:"Sameindin er hybrid af öllum formúlum",correct:!0,explanation:"Rétt! Raunverulega sameindin er stöðugt meðaltal allra samsvörunarformúla."},{id:"one",text:"Aðeins ein formúla er rétt",correct:!1,explanation:"Báðar formúlur eru jafngildar og sameindin er hybrid."}],hint:"Samsvörunarformúlur sýna takmarkanir Lewis-formúla",explanation:'Samsvörunarformúlur eru ekki mismunandi form sameindarinnar. Raunverulega sameindin er einn "hybrid" sem er meðaltal allra samsvörunarformúla.'},{id:8,title:"Formhleðsla og stöðugleiki",type:"best_structure",molecule:"SCN⁻",description:"Þíósýanatjónin getur teiknast á nokkra vegu.",question:"Hvaða regla gildir um bestu Lewis-formúluna?",correctAnswer:"minimize",options:[{id:"maximize",text:"Hámarka formhleðslur",correct:!1,explanation:"Háar formhleðslur gera sameindir óstöðugri."},{id:"minimize",text:"Lágmarka formhleðslur (helst 0)",correct:!0,explanation:"Rétt! Lægri formhleðslur = stöðugri sameind."},{id:"negative",text:"Setja neikvæða hleðslu á C",correct:!1,explanation:"Neikvæð hleðsla ætti að vera á rafeinadrægnasta atóminu."}],hint:"Stöðugri formúlur hafa lægri formhleðslur",explanation:"Bestu Lewis-formúlur hafa: (1) Lágmarks formhleðslur, (2) Neikvæð hleðsla á rafeinadrægnasta atómi, (3) Uppfyllt átta."}],CEe=120;function TEe({onComplete:i,onBack:e,onCorrectAnswer:t,onIncorrectAnswer:n}){var P,F,k;const[r,s]=w.useState(0),[o,a]=w.useState(null),[l,c]=w.useState(!1),[u,h]=w.useState(!1),[f,d]=w.useState(0),[m,A]=w.useState(0),g=Rv[r],y=()=>{var U,W;((W=(U=g.options)==null?void 0:U.find($=>$.id===o))==null?void 0:W.correct)??!1?(t==null||t(),d(u?$=>$+8:$=>$+15)):n==null||n(),c(!0)},E=()=>{r<Rv.length-1?(s(z=>z+1),a(null),c(!1),h(!1)):i(f,CEe,m)},x=((F=(P=g.options)==null?void 0:P.find(z=>z.id===o))==null?void 0:F.correct)??!1,C=z=>{if(z===0)return null;const U=z>0?`+${z}`:`${z}`,W=z>0?"bg-red-500":"bg-blue-500";return Z.jsx("div",{className:`absolute -top-2 -right-2 ${W} text-white text-xs font-bold w-5 h-5 rounded-full flex items-center justify-center shadow-sm`,children:U})},T=(z,U)=>{const W=Math.floor(z/2);if(W===0)return null;const $={top:"absolute -top-4 left-1/2 -translate-x-1/2",bottom:"absolute -bottom-4 left-1/2 -translate-x-1/2",left:"absolute top-1/2 -left-4 -translate-y-1/2",right:"absolute top-1/2 -right-4 -translate-y-1/2"};return Z.jsx("div",{className:`${$[U]} flex gap-0.5`,children:Array(Math.min(W,2)).fill(0).map((oe,X)=>Z.jsxs("div",{className:"flex gap-0.5",children:[Z.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-purple-600"}),Z.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-purple-600"})]},X))})},I=z=>{const U=z/2;return Z.jsx("div",{className:"flex flex-col gap-0.5",children:Array(Math.min(U,4)).fill(0).map((W,$)=>Z.jsx("div",{className:"w-6 h-0.5 bg-gray-600"},$))})},M=(z,U)=>{const W=z.lonePairElectrons/2;return Z.jsxs("div",{className:"flex items-center justify-center gap-2 py-4",children:[Z.jsxs("div",{className:"flex items-center",children:[Z.jsx("div",{className:"text-xs text-gray-500 mr-2",children:"tengsl"}),I(z.bondingElectrons)]}),Z.jsxs("div",{className:"relative mx-4",children:[Z.jsx("div",{className:"w-16 h-16 rounded-full border-4 border-purple-500 bg-purple-100 flex items-center justify-center font-bold text-xl text-purple-800",children:z.symbol}),U&&C(z.formalCharge),W>=1&&T(2,"top"),W>=2&&T(2,"bottom")]}),Z.jsxs("div",{className:"text-xs text-gray-600 ml-4 text-left",children:[Z.jsxs("div",{children:["V = ",z.valenceElectrons]}),Z.jsxs("div",{children:["L = ",z.lonePairElectrons]}),Z.jsxs("div",{children:["B = ",z.bondingElectrons]})]})]})},L=z=>Z.jsx("div",{className:"flex flex-wrap justify-center gap-6 py-4",children:z.map(U=>Z.jsxs("div",{className:`p-4 rounded-xl border-2 ${l&&U.isPreferred?"border-green-500 bg-green-50":"border-gray-200 bg-white"}`,children:[Z.jsx("div",{className:"flex items-center justify-center gap-1 mb-3",children:U.formalCharges.map((W,$)=>Z.jsxs("div",{className:"relative mx-1",children:[Z.jsx("div",{className:`w-12 h-12 rounded-full border-3 flex items-center justify-center font-bold ${$===0?"border-blue-400 bg-blue-50 text-blue-700":"border-green-400 bg-green-50 text-green-700"}`,children:W.atom}),W.charge!==0&&Z.jsx("div",{className:`absolute -top-1.5 -right-1.5 ${W.charge>0?"bg-red-500":"bg-blue-500"} text-white text-xs font-bold w-4 h-4 rounded-full flex items-center justify-center`,children:W.charge>0?"+":"−"}),$<U.formalCharges.length-1&&Z.jsx("div",{className:"absolute top-1/2 -right-3 transform -translate-y-1/2",children:U.id==="triple"?Z.jsxs("div",{className:"flex flex-col gap-0.5",children:[Z.jsx("div",{className:"w-4 h-0.5 bg-gray-700"}),Z.jsx("div",{className:"w-4 h-0.5 bg-gray-700"}),Z.jsx("div",{className:"w-4 h-0.5 bg-gray-700"})]}):Z.jsxs("div",{className:"flex flex-col gap-0.5",children:[Z.jsx("div",{className:"w-4 h-0.5 bg-gray-700"}),Z.jsx("div",{className:"w-4 h-0.5 bg-gray-700"})]})})]},$))}),Z.jsx("div",{className:"text-center text-sm font-mono font-bold text-gray-700",children:U.description}),Z.jsx("div",{className:"text-center text-xs text-gray-500 mt-1",children:U.formalCharges.map(W=>`${W.atom}: ${W.charge>=0?"+":""}${W.charge}`).join(", ")}),l&&U.isPreferred&&Z.jsx("div",{className:"text-center mt-2",children:Z.jsx("span",{className:"bg-green-500 text-white text-xs px-2 py-1 rounded-full",children:"✓ Æskilegast"})})]},U.id))}),R=z=>Z.jsx("div",{className:"flex flex-wrap justify-center items-center gap-4 py-4",children:z.map((U,W)=>Z.jsxs("div",{className:"flex items-center gap-2",children:[Z.jsx("div",{className:`p-3 rounded-lg border-2 ${U.isValid?"border-purple-300 bg-purple-50":"border-gray-200 bg-gray-50"}`,children:Z.jsx("div",{className:"font-mono text-lg font-bold text-purple-800",children:U.structure})}),W<z.length-1&&Z.jsx("div",{className:"text-2xl text-purple-400 font-bold",children:"⟷"})]},U.id))});return Z.jsx("div",{className:"min-h-screen bg-gradient-to-br from-teal-50 to-cyan-100 p-4 md:p-8",children:Z.jsxs("div",{className:"max-w-3xl mx-auto",children:[Z.jsxs("div",{className:"flex items-center justify-between mb-6",children:[Z.jsxs("button",{onClick:e,className:"text-gray-600 hover:text-gray-800 flex items-center gap-2",children:[Z.jsx("span",{children:"←"})," Til baka"]}),Z.jsxs("div",{className:"text-right",children:[Z.jsxs("div",{className:"text-sm text-gray-600",children:["Stig 3 / Þraut ",r+1," af ",Rv.length]}),Z.jsxs("div",{className:"text-lg font-bold text-purple-600",children:[f," stig"]})]})]}),Z.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 mb-6",children:Z.jsx("div",{className:"bg-purple-500 h-2 rounded-full transition-all duration-300",style:{width:`${(r+1)/Rv.length*100}%`}})}),Z.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl p-6 md:p-8",children:[Z.jsx("h2",{className:"text-2xl font-bold text-purple-800 mb-2",children:g.title}),g.molecule&&Z.jsx("div",{className:"inline-block bg-purple-50 px-4 py-2 rounded-lg mb-4",children:Z.jsx("span",{className:"font-mono text-2xl font-bold text-purple-700",children:g.molecule})}),Z.jsx("p",{className:"text-gray-600 mb-6",children:g.description}),g.atoms&&Z.jsxs("div",{className:"bg-gray-50 p-4 rounded-xl mb-6",children:[Z.jsx("h3",{className:"font-bold text-gray-700 mb-3",children:"Rafeindasamsetning:"}),g.atoms.map((z,U)=>Z.jsx("div",{children:M(z,l)},U)),l&&g.atoms.map((z,U)=>Z.jsx("div",{className:"mt-4 p-3 bg-white rounded-lg border border-purple-200",children:Z.jsxs("div",{className:"text-sm font-mono text-center",children:[Z.jsx("span",{className:"text-gray-600",children:"FC = "}),Z.jsx("span",{className:"text-purple-600",children:z.valenceElectrons}),Z.jsx("span",{className:"text-gray-600",children:" - ("}),Z.jsx("span",{className:"text-blue-600",children:z.lonePairElectrons}),Z.jsx("span",{className:"text-gray-600",children:" + ½×"}),Z.jsx("span",{className:"text-green-600",children:z.bondingElectrons}),Z.jsx("span",{className:"text-gray-600",children:") = "}),Z.jsxs("span",{className:`font-bold ${z.formalCharge===0?"text-green-600":z.formalCharge>0?"text-red-600":"text-blue-600"}`,children:[z.formalCharge>=0?"+":"",z.formalCharge]})]})},`calc-${U}`))]}),g.structures&&Z.jsxs("div",{className:"bg-gray-50 p-4 rounded-xl mb-6",children:[Z.jsx("h3",{className:"font-bold text-gray-700 mb-3",children:"Möguleg form:"}),L(g.structures)]}),g.resonanceForms&&Z.jsxs("div",{className:"bg-gray-50 p-4 rounded-xl mb-6",children:[Z.jsx("h3",{className:"font-bold text-gray-700 mb-3",children:"Samsvörunarformúlur:"}),R(g.resonanceForms)]}),Z.jsx("p",{className:"text-lg font-medium text-gray-800 mb-4",children:g.question}),Z.jsx("div",{className:"space-y-3 mb-6",children:(k=g.options)==null?void 0:k.map(z=>Z.jsxs("button",{onClick:()=>!l&&a(z.id),disabled:l,className:`w-full p-4 rounded-xl border-2 text-left transition-all ${l?z.correct?"border-green-500 bg-green-50":o===z.id?"border-red-500 bg-red-50":"border-gray-200 bg-gray-50 opacity-50":o===z.id?"border-purple-500 bg-purple-50 ring-2 ring-purple-200":"border-gray-300 hover:border-purple-400 hover:bg-purple-50"}`,children:[Z.jsx("span",{children:z.text}),l&&o===z.id&&Z.jsx("div",{className:`mt-2 text-sm ${z.correct?"text-green-700":"text-red-700"}`,children:z.explanation})]},z.id))}),!l&&!u&&Z.jsx("button",{onClick:()=>{h(!0),A(z=>z+1)},className:"text-purple-600 hover:text-purple-800 text-sm underline mb-4",children:"Sýna vísbendingu (-7 stig)"}),u&&!l&&Z.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 p-4 rounded-xl mb-4",children:[Z.jsx("span",{className:"font-bold text-yellow-800",children:"Vísbending: "}),Z.jsx("span",{className:"text-yellow-900",children:g.hint})]}),!l&&Z.jsx("button",{onClick:y,disabled:!o,className:"w-full bg-purple-500 hover:bg-purple-600 disabled:bg-gray-300 text-white font-bold py-4 px-6 rounded-xl transition-colors",children:"Athuga svar"}),l&&Z.jsxs("div",{className:`p-4 rounded-xl mb-4 ${x?"bg-green-50 border border-green-200":"bg-red-50 border border-red-200"}`,children:[Z.jsx("div",{className:`font-bold text-lg mb-2 ${x?"text-green-700":"text-red-700"}`,children:x?"Rétt!":"Rangt"}),Z.jsx("div",{className:"text-sm text-gray-700",children:g.explanation})]}),l&&Z.jsx("button",{onClick:E,className:"w-full bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-4 px-6 rounded-xl transition-colors",children:r<Rv.length-1?"Næsta þraut":"Ljúka stigi 3"})]}),Z.jsxs("div",{className:"mt-6 bg-white rounded-xl p-4 shadow",children:[Z.jsx("h3",{className:"font-bold text-gray-700 mb-3",children:"Formhleðsluformúlan"}),Z.jsx("div",{className:"bg-purple-50 p-3 rounded-lg text-center font-mono mb-3",children:Z.jsx("strong",{children:"FC = V - (L + ½B)"})}),Z.jsxs("ul",{className:"text-sm text-gray-600 space-y-1",children:[Z.jsxs("li",{children:[Z.jsx("strong",{children:"V"})," = Gildisrafeindir (frá lotukerfinu)"]}),Z.jsxs("li",{children:[Z.jsx("strong",{children:"L"})," = Óbundnar rafeindir (lone pairs)"]}),Z.jsxs("li",{children:[Z.jsx("strong",{children:"B"})," = Bundnar rafeindir (í tengslum)"]})]})]})]})})}function bEe({gameId:i,onAchievementUnlocked:e}){const[t,n]=w.useState(wE),[r,s]=w.useState([]);w.useEffect(()=>{const A=new Date().toISOString().split("T")[0];if(!t.daysPlayed.includes(A)){const g={...t,daysPlayed:[...t.daysPlayed,A]};n(g),f6(g);const y=qL(g,{type:"game_start"});y.length>0&&(s(E=>[...E,...y]),y.forEach(E=>e==null?void 0:e(E)))}},[]);const o=w.useCallback(A=>{const g=wE(),y=qL(g,A);y.length>0&&(s(E=>[...E,...y]),y.forEach(E=>e==null?void 0:e(E))),n(wE())},[e]),a=w.useCallback(A=>{o({type:"answer_correct",gameId:i,firstAttempt:A==null?void 0:A.firstAttempt})},[i,o]),l=w.useCallback(()=>{o({type:"answer_incorrect",gameId:i})},[i,o]),c=w.useCallback((A,g,y,E)=>{o({type:"level_complete",gameId:i,level:A,score:g,maxScore:y,timeTaken:E==null?void 0:E.timeTaken,hintsUsed:(E==null?void 0:E.hintsUsed)??0})},[i,o]),u=w.useCallback(()=>{o({type:"game_complete",gameId:i})},[i,o]),h=w.useCallback(A=>{s(g=>g.filter(y=>y.achievement.id!==A))},[]),f=w.useCallback(()=>{s([])},[]),d=w.useCallback(A=>IN(t,A),[t]),m=w.useCallback(()=>{iY(),n(wE()),s([])},[]);return{achievements:t,allAchievements:Z2,unlockedAchievements:tY(t),lockedAchievements:nY(t),currentStreak:t.currentStreak,bestStreak:t.bestStreak,totalPoints:t.totalPoints,unlockedPercentage:eY(t),notifications:r,trackCorrectAnswer:a,trackIncorrectAnswer:l,trackLevelComplete:c,trackGameComplete:u,dismissNotification:h,clearNotifications:f,getProgress:d,resetAll:m}}const _j="lewis-structures-progress";function IEe(){const i=localStorage.getItem(_j);if(i)try{return JSON.parse(i)}catch{return W5()}return W5()}function W5(){return{level1Completed:!1,level1Score:0,level2Completed:!1,level2Score:0,level3Completed:!1,level3Score:0,totalGamesPlayed:0}}function yO(i){localStorage.setItem(_j,JSON.stringify(i))}function MEe(){const[i,e]=w.useState("menu"),[t,n]=w.useState(IEe),[r,s]=w.useState(!1),{achievements:o,allAchievements:a,notifications:l,dismissNotification:c,trackCorrectAnswer:u,trackIncorrectAnswer:h,trackLevelComplete:f,trackGameComplete:d,resetAll:m}=bEe({gameId:"lewis-structures"});w.useEffect(()=>{yO(t)},[t]);const A=(T,I,M)=>{n(L=>({...L,level1Completed:!0,level1Score:Math.max(L.level1Score,T),totalGamesPlayed:L.totalGamesPlayed+1})),f(1,T,I,{hintsUsed:M}),e("menu")},g=(T,I,M)=>{n(L=>({...L,level2Completed:!0,level2Score:Math.max(L.level2Score,T),totalGamesPlayed:L.totalGamesPlayed+1})),f(2,T,I,{hintsUsed:M}),e("menu")},y=(T,I,M)=>{n(L=>({...L,level3Completed:!0,level3Score:Math.max(L.level3Score,T),totalGamesPlayed:L.totalGamesPlayed+1})),f(3,T,I,{hintsUsed:M}),d(),e("complete")},E=()=>{const T=W5();n(T),yO(T)};if(i==="level1")return Z.jsxs(Z.Fragment,{children:[Z.jsx(vEe,{onComplete:A,onBack:()=>e("menu"),onCorrectAnswer:u,onIncorrectAnswer:h}),Z.jsx(SE,{notifications:l,onDismiss:c})]});if(i==="level2")return Z.jsxs(Z.Fragment,{children:[Z.jsx(wEe,{onComplete:g,onBack:()=>e("menu"),onCorrectAnswer:u,onIncorrectAnswer:h}),Z.jsx(SE,{notifications:l,onDismiss:c})]});if(i==="level3")return Z.jsxs(Z.Fragment,{children:[Z.jsx(TEe,{onComplete:y,onBack:()=>e("menu"),onCorrectAnswer:u,onIncorrectAnswer:h}),Z.jsx(SE,{notifications:l,onDismiss:c})]});if(i==="complete"){const T=t.level1Score+t.level2Score+t.level3Score;return Z.jsx("div",{className:"min-h-screen bg-gradient-to-br from-teal-50 to-cyan-100 p-4 md:p-8",children:Z.jsxs("div",{className:"max-w-2xl mx-auto bg-white rounded-2xl shadow-2xl p-6 md:p-8",children:[Z.jsx("h1",{className:"text-3xl md:text-4xl font-bold text-center mb-6 text-teal-600",children:"Til hamingju!"}),Z.jsxs("div",{className:"text-center mb-8",children:[Z.jsx("div",{className:"text-6xl mb-4",children:"🏆"}),Z.jsx("div",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Þú hefur lokið öllum stigum!"})]}),Z.jsxs("div",{className:"space-y-4 mb-8",children:[Z.jsxs("div",{className:"bg-blue-50 p-4 rounded-xl flex justify-between items-center",children:[Z.jsxs("div",{children:[Z.jsx("div",{className:"font-bold text-blue-800",children:"Stig 1: Gildisrafeindir"}),Z.jsx("div",{className:"text-sm text-blue-600",children:"Telja og skilja"})]}),Z.jsx("div",{className:"text-2xl font-bold text-blue-600",children:t.level1Score})]}),Z.jsxs("div",{className:"bg-green-50 p-4 rounded-xl flex justify-between items-center",children:[Z.jsxs("div",{children:[Z.jsx("div",{className:"font-bold text-green-800",children:"Stig 2: Teikna Lewis"}),Z.jsx("div",{className:"text-sm text-green-600",children:"Byggja formúlur"})]}),Z.jsx("div",{className:"text-2xl font-bold text-green-600",children:t.level2Score})]}),Z.jsxs("div",{className:"bg-purple-50 p-4 rounded-xl flex justify-between items-center",children:[Z.jsxs("div",{children:[Z.jsx("div",{className:"font-bold text-purple-800",children:"Stig 3: Formhleðsla"}),Z.jsx("div",{className:"text-sm text-purple-600",children:"Samsvörunarformúlur"})]}),Z.jsx("div",{className:"text-2xl font-bold text-purple-600",children:t.level3Score})]}),Z.jsxs("div",{className:"bg-orange-100 p-4 rounded-xl flex justify-between items-center border-2 border-orange-400",children:[Z.jsx("div",{className:"font-bold text-orange-800 text-lg",children:"Heildarstig"}),Z.jsx("div",{className:"text-3xl font-bold text-orange-600",children:T})]})]}),Z.jsxs("div",{className:"bg-teal-50 p-6 rounded-xl mb-6",children:[Z.jsx("h2",{className:"font-bold text-teal-800 mb-3",children:"Hvað lærðir þú?"}),Z.jsxs("ul",{className:"space-y-2 text-teal-900 text-sm",children:[Z.jsxs("li",{children:["✓ ",Z.jsx("strong",{children:"Gildisrafeindir:"})," Rafeindir í ystu skel ákvarða efnatengsl"]}),Z.jsxs("li",{children:["✓ ",Z.jsx("strong",{children:"Áttureglann:"})," Atóm vilja hafa 8 rafeindir (H vill 2)"]}),Z.jsxs("li",{children:["✓ ",Z.jsx("strong",{children:"Lewis-formúlur:"})," Sýna hvernig rafeindir dreifast í sameindum"]}),Z.jsxs("li",{children:["✓ ",Z.jsx("strong",{children:"Formhleðsla:"})," FC = Gildisraf. - (óbundin + ½ bundin)"]}),Z.jsxs("li",{children:["✓ ",Z.jsx("strong",{children:"Samsvörun:"})," Margar jafngildar formúlur fyrir sömu sameind"]})]})]}),Z.jsx("button",{onClick:()=>e("menu"),className:"w-full bg-teal-500 hover:bg-teal-600 text-white font-bold py-4 px-6 rounded-xl transition-colors",children:"Til baka í valmynd"})]})})}const x=t.level1Score+t.level2Score+t.level3Score,C=[t.level1Completed,t.level2Completed,t.level3Completed].filter(Boolean).length;return Z.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-teal-50 to-cyan-100 p-4 md:p-8",children:[Z.jsxs("div",{className:"max-w-3xl mx-auto bg-white rounded-2xl shadow-2xl p-6 md:p-8",children:[Z.jsx("div",{className:"flex justify-end mb-4",children:Z.jsx(sY,{achievements:o,onClick:()=>s(!0)})}),Z.jsx("h1",{className:"text-3xl md:text-4xl font-bold text-center mb-2 text-teal-600",children:"⚛️ Lewis-formúlur"}),Z.jsx("p",{className:"text-center text-gray-600 mb-8",children:"Lærðu að teikna rafeindasamsetningu sameinda"}),Z.jsxs("div",{className:"bg-teal-50 p-6 rounded-xl mb-8",children:[Z.jsx("h2",{className:"font-bold text-teal-800 mb-3",children:"Hvað eru Lewis-formúlur?"}),Z.jsxs("p",{className:"text-teal-900 text-sm mb-4",children:[Z.jsx("strong",{children:"Lewis-formúlur"})," (eða rafeinapunktaformúlur) sýna hvernig gildisrafeindir dreifast á milli atóma í sameind. Þær hjálpa okkur að skilja efnatengsl og lögun sameinda."]}),Z.jsx("div",{className:"bg-white p-3 rounded-lg border border-teal-200",children:Z.jsx("p",{className:"text-sm text-teal-800 font-mono text-center",children:"Alls rafeindir = Σ gildisrafeindir - hleðsla"})})]}),Z.jsxs("div",{className:"space-y-4",children:[Z.jsx("button",{onClick:()=>e("level1"),className:"w-full p-6 rounded-xl border-4 border-blue-400 bg-blue-50 hover:bg-blue-100 transition-all text-left",children:Z.jsxs("div",{className:"flex items-center gap-4",children:[Z.jsx("div",{className:"text-4xl",children:"🔢"}),Z.jsxs("div",{className:"flex-1",children:[Z.jsxs("div",{className:"flex items-center gap-2",children:[Z.jsx("span",{className:"text-xl font-bold text-blue-800",children:"Stig 1: Gildisrafeindir"}),t.level1Completed&&Z.jsxs("span",{className:"bg-green-500 text-white text-xs px-2 py-1 rounded-full",children:["✓ ",t.level1Score," stig"]})]}),Z.jsx("div",{className:"text-sm text-blue-600 mt-1",children:"Telja gildisrafeindir og skilja átturegluna"}),Z.jsx("div",{className:"text-xs text-gray-600 mt-2",children:"Hvaða rafeindir taka þátt í efnatengslum? Lærðu að telja þær."})]})]})}),Z.jsx("button",{onClick:()=>t.level1Completed&&e("level2"),className:`w-full p-6 rounded-xl border-4 transition-all text-left ${t.level1Completed?"border-green-400 bg-green-50 hover:bg-green-100 cursor-pointer":"border-gray-200 bg-gray-50 opacity-60 cursor-not-allowed"}`,children:Z.jsxs("div",{className:"flex items-center gap-4",children:[Z.jsx("div",{className:"text-4xl",children:"✏️"}),Z.jsxs("div",{className:"flex-1",children:[Z.jsxs("div",{className:"flex items-center gap-2",children:[Z.jsx("span",{className:`text-xl font-bold ${t.level1Completed?"text-green-800":"text-gray-600"}`,children:"Stig 2: Teikna Lewis-formúlur"}),t.level2Completed&&Z.jsxs("span",{className:"bg-green-500 text-white text-xs px-2 py-1 rounded-full",children:["✓ ",t.level2Score," stig"]}),!t.level1Completed&&Z.jsx("span",{className:"text-xs text-gray-500",children:"(Ljúktu stigi 1 fyrst)"})]}),Z.jsx("div",{className:`text-sm mt-1 ${t.level1Completed?"text-green-600":"text-gray-500"}`,children:"Byggja Lewis-formúlur skref fyrir skref"}),Z.jsx("div",{className:"text-xs text-gray-600 mt-2",children:"Settu miðatóm, teiknaðu tengsl og einstæð rafeindarapör."})]})]})}),Z.jsx("button",{onClick:()=>t.level2Completed&&e("level3"),className:`w-full p-6 rounded-xl border-4 transition-all text-left ${t.level2Completed?"border-purple-400 bg-purple-50 hover:bg-purple-100 cursor-pointer":"border-gray-200 bg-gray-50 opacity-60 cursor-not-allowed"}`,children:Z.jsxs("div",{className:"flex items-center gap-4",children:[Z.jsx("div",{className:"text-4xl",children:"⚖️"}),Z.jsxs("div",{className:"flex-1",children:[Z.jsxs("div",{className:"flex items-center gap-2",children:[Z.jsx("span",{className:`text-xl font-bold ${t.level2Completed?"text-purple-800":"text-gray-600"}`,children:"Stig 3: Formhleðsla og samsvörun"}),t.level3Completed&&Z.jsxs("span",{className:"bg-green-500 text-white text-xs px-2 py-1 rounded-full",children:["✓ ",t.level3Score," stig"]}),!t.level2Completed&&Z.jsx("span",{className:"text-xs text-gray-500",children:"(Ljúktu stigi 2 fyrst)"})]}),Z.jsx("div",{className:`text-sm mt-1 ${t.level2Completed?"text-purple-600":"text-gray-500"}`,children:"Reikna formhleðslu og finna samsvörunarformúlur"}),Z.jsx("div",{className:"text-xs text-gray-600 mt-2",children:"Hvernig finnur þú bestu Lewis-formúluna?"})]})]})})]}),t.totalGamesPlayed>0&&Z.jsxs("div",{className:"mt-8 bg-gray-50 p-4 rounded-xl",children:[Z.jsxs("div",{className:"flex justify-between items-center mb-3",children:[Z.jsx("h3",{className:"font-semibold text-gray-700",children:"Framvinda"}),Z.jsx("button",{onClick:E,className:"text-sm text-gray-500 hover:text-red-500 transition-colors",children:"Endurstilla"})]}),Z.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center",children:[Z.jsxs("div",{className:"bg-blue-50 rounded-lg p-3",children:[Z.jsxs("div",{className:"text-2xl font-bold text-blue-600",children:[C,"/3"]}),Z.jsx("div",{className:"text-xs text-gray-600",children:"Stig lokið"})]}),Z.jsxs("div",{className:"bg-green-50 rounded-lg p-3",children:[Z.jsx("div",{className:"text-2xl font-bold text-green-600",children:x}),Z.jsx("div",{className:"text-xs text-gray-600",children:"Heildar stig"})]}),Z.jsxs("div",{className:"bg-purple-50 rounded-lg p-3",children:[Z.jsx("div",{className:"text-2xl font-bold text-purple-600",children:t.totalGamesPlayed}),Z.jsx("div",{className:"text-xs text-gray-600",children:"Leikir spilaðir"})]})]})]}),Z.jsxs("div",{className:"mt-6 bg-gray-50 p-4 rounded-xl",children:[Z.jsx("h3",{className:"font-semibold text-gray-700 mb-2",children:"🔢 Gildisrafeindir eftir hópi"}),Z.jsxs("div",{className:"grid grid-cols-4 md:grid-cols-8 gap-2 text-sm",children:[Z.jsxs("div",{className:"bg-red-50 p-2 rounded text-center",children:[Z.jsx("div",{className:"font-bold text-red-700",children:"1"}),Z.jsx("div",{className:"text-xs text-red-600",children:"H, Li, Na"})]}),Z.jsxs("div",{className:"bg-orange-50 p-2 rounded text-center",children:[Z.jsx("div",{className:"font-bold text-orange-700",children:"2"}),Z.jsx("div",{className:"text-xs text-orange-600",children:"Be, Mg"})]}),Z.jsxs("div",{className:"bg-yellow-50 p-2 rounded text-center",children:[Z.jsx("div",{className:"font-bold text-yellow-700",children:"3"}),Z.jsx("div",{className:"text-xs text-yellow-600",children:"B, Al"})]}),Z.jsxs("div",{className:"bg-green-50 p-2 rounded text-center",children:[Z.jsx("div",{className:"font-bold text-green-700",children:"4"}),Z.jsx("div",{className:"text-xs text-green-600",children:"C, Si"})]}),Z.jsxs("div",{className:"bg-teal-50 p-2 rounded text-center",children:[Z.jsx("div",{className:"font-bold text-teal-700",children:"5"}),Z.jsx("div",{className:"text-xs text-teal-600",children:"N, P"})]}),Z.jsxs("div",{className:"bg-blue-50 p-2 rounded text-center",children:[Z.jsx("div",{className:"font-bold text-blue-700",children:"6"}),Z.jsx("div",{className:"text-xs text-blue-600",children:"O, S"})]}),Z.jsxs("div",{className:"bg-purple-50 p-2 rounded text-center",children:[Z.jsx("div",{className:"font-bold text-purple-700",children:"7"}),Z.jsx("div",{className:"text-xs text-purple-600",children:"F, Cl, Br"})]}),Z.jsxs("div",{className:"bg-gray-100 p-2 rounded text-center",children:[Z.jsx("div",{className:"font-bold text-gray-700",children:"8"}),Z.jsx("div",{className:"text-xs text-gray-600",children:"Ne, Ar"})]})]})]}),Z.jsx("div",{className:"mt-6 text-center text-xs text-gray-500",children:"Kafli 8 — Chemistry: The Central Science (Brown et al.)"})]}),r&&Z.jsx(rY,{achievements:o,allAchievements:a,onClose:()=>s(!1),onReset:m}),Z.jsx(SE,{notifications:l,onDismiss:c})]})}X$.createRoot(document.getElementById("root")).render(Z.jsx(bl.StrictMode,{children:Z.jsx(MEe,{})}));var o0=typeof self<"u"?self:{};function JS(i,e){e:{for(var t=["CLOSURE_FLAGS"],n=o0,r=0;r<t.length;r++)if((n=n[t[r]])==null){t=null;break e}t=n}return(i=t&&t[i])!=null?i:e}function _m(){throw Error("Invalid UTF8")}function vO(i,e){return e=String.fromCharCode.apply(null,e),i==null?e:i+e}let D_,NI;const REe=typeof TextDecoder<"u";let LEe;const PEe=typeof TextEncoder<"u";function Sj(i){if(PEe)i=(LEe||(LEe=new TextEncoder)).encode(i);else{let t=0;const n=new Uint8Array(3*i.length);for(let r=0;r<i.length;r++){var e=i.charCodeAt(r);if(e<128)n[t++]=e;else{if(e<2048)n[t++]=e>>6|192;else{if(e>=55296&&e<=57343){if(e<=56319&&r<i.length){const s=i.charCodeAt(++r);if(s>=56320&&s<=57343){e=1024*(e-55296)+s-56320+65536,n[t++]=e>>18|240,n[t++]=e>>12&63|128,n[t++]=e>>6&63|128,n[t++]=63&e|128;continue}r--}e=65533}n[t++]=e>>12|224,n[t++]=e>>6&63|128}n[t++]=63&e|128}}i=t===n.length?n:n.subarray(0,t)}return i}var Y2,wj=JS(610401301,!1),BEe=JS(653718497,JS(1,!0)),Cj=JS(660014094,!1);const xO=o0.navigator;function j5(i){return!!wj&&!!Y2&&Y2.brands.some((({brand:e})=>e&&e.indexOf(i)!=-1))}function lc(i){var e;return(e=o0.navigator)&&(e=e.userAgent)||(e=""),e.indexOf(i)!=-1}function Ud(){return!!wj&&!!Y2&&Y2.brands.length>0}function UI(){return Ud()?j5("Chromium"):(lc("Chrome")||lc("CriOS"))&&!(!Ud()&&lc("Edge"))||lc("Silk")}function g8(i){return g8[" "](i),i}Y2=xO&&xO.userAgentData||null,g8[" "]=function(){};var DEe=!Ud()&&(lc("Trident")||lc("MSIE"));!lc("Android")||UI(),UI(),lc("Safari")&&(UI()||!Ud()&&lc("Coast")||!Ud()&&lc("Opera")||!Ud()&&lc("Edge")||(Ud()?j5("Microsoft Edge"):lc("Edg/"))||Ud()&&j5("Opera"));var Tj={},Hv=null;function kEe(i){var e=i.length,t=3*e/4;t%3?t=Math.floor(t):"=.".indexOf(i[e-1])!=-1&&(t="=.".indexOf(i[e-2])!=-1?t-2:t-1);var n=new Uint8Array(t),r=0;return(function(s,o){function a(d){for(;l<s.length;){var m=s.charAt(l++),A=Hv[m];if(A!=null)return A;if(!/^[\s\xa0]*$/.test(m))throw Error("Unknown base64 encoding at char: "+m)}return d}bj();for(var l=0;;){var c=a(-1),u=a(0),h=a(64),f=a(64);if(f===64&&c===-1)break;o(c<<2|u>>4),h!=64&&(o(u<<4&240|h>>2),f!=64&&o(h<<6&192|f))}})(i,(function(s){n[r++]=s})),r!==t?n.subarray(0,r):n}function bj(){if(!Hv){Hv={};for(var i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".split(""),e=["+/=","+/","-_=","-_.","-_"],t=0;t<5;t++){var n=i.concat(e[t].split(""));Tj[t]=n;for(var r=0;r<n.length;r++){var s=n[r];Hv[s]===void 0&&(Hv[s]=r)}}}}var Ij=typeof Uint8Array<"u",Mj=!DEe&&typeof btoa=="function";function EO(i){if(!Mj){var e;e===void 0&&(e=0),bj(),e=Tj[e];var t=Array(Math.floor(i.length/3)),n=e[64]||"";let l=0,c=0;for(;l<i.length-2;l+=3){var r=i[l],s=i[l+1],o=i[l+2],a=e[r>>2];r=e[(3&r)<<4|s>>4],s=e[(15&s)<<2|o>>6],o=e[63&o],t[c++]=a+r+s+o}switch(a=0,o=n,i.length-l){case 2:o=e[(15&(a=i[l+1]))<<2]||n;case 1:i=i[l],t[c]=e[i>>2]+e[(3&i)<<4|a>>4]+o+n}return t.join("")}for(e="",t=0,n=i.length-10240;t<n;)e+=String.fromCharCode.apply(null,i.subarray(t,t+=10240));return e+=String.fromCharCode.apply(null,t?i.subarray(t):i),btoa(e)}const _O=/[-_.]/g,FEe={"-":"+",_:"/",".":"="};function OEe(i){return FEe[i]||""}function Rj(i){if(!Mj)return kEe(i);_O.test(i)&&(i=i.replace(_O,OEe)),i=atob(i);const e=new Uint8Array(i.length);for(let t=0;t<i.length;t++)e[t]=i.charCodeAt(t);return e}function Tx(i){return Ij&&i!=null&&i instanceof Uint8Array}var cA={};let NEe;function Lj(i){if(i!==cA)throw Error("illegal external caller")}function a0(){return NEe||(NEe=new kf(null,cA))}function A8(i){Lj(cA);var e=i.ba;return(e=e==null||Tx(e)?e:typeof e=="string"?Rj(e):null)==null?e:i.ba=e}var kf=class{constructor(i,e){if(Lj(e),this.ba=i,i!=null&&i.length===0)throw Error("ByteString should be constructed with non-empty values")}ua(){return new Uint8Array(A8(this)||0)}};function Pj(i,e){i.__closure__error__context__984382||(i.__closure__error__context__984382={}),i.__closure__error__context__984382.severity=e}let UEe;function l0(){const i=Error();Pj(i,"incident"),(function(e){o0.setTimeout((()=>{throw e}),0)})(i)}function K5(i){return Pj(i=Error(i),"warning"),i}function y8(){return typeof BigInt=="function"}function kl(i){return Array.prototype.slice.call(i)}var MA=typeof Symbol=="function"&&typeof Symbol()=="symbol";function P4(i){return typeof Symbol=="function"&&typeof Symbol()=="symbol"?Symbol():i}var bx=P4(),SO=P4("0di"),zI=P4("2ex"),Lv=P4("1oa"),B4=MA?(i,e)=>{i[bx]|=e}:(i,e)=>{i.G!==void 0?i.G|=e:Object.defineProperties(i,{G:{value:e,configurable:!0,writable:!0,enumerable:!1}})},ZS=MA?(i,e)=>{i[bx]&=~e}:(i,e)=>{i.G!==void 0&&(i.G&=~e)},xs=MA?i=>0|i[bx]:i=>0|i.G,Ui=MA?i=>i[bx]:i=>i.G,jr=MA?(i,e)=>{i[bx]=e}:(i,e)=>{i.G!==void 0?i.G=e:Object.defineProperties(i,{G:{value:e,configurable:!0,writable:!0,enumerable:!1}})};function RA(i){return B4(i,34),i}function zEe(i,e){jr(e,-14591&(0|i))}function $5(i,e){jr(e,-14557&(34|i))}var v8,Ix={},Bj={};function wO(i){return!(!i||typeof i!="object"||i.La!==Bj)}function D4(i){return i!==null&&typeof i=="object"&&!Array.isArray(i)&&i.constructor===Object}function x8(i,e,t){if(i!=null){if(typeof i=="string")i=i?new kf(i,cA):a0();else if(i.constructor!==kf)if(Tx(i))i=i.length?new kf(t?i:new Uint8Array(i),cA):a0();else{if(!e)throw Error();i=void 0}}return i}function ew(i){return!(!Array.isArray(i)||i.length)&&!!(1&xs(i))}const CO=[];function Hf(i){if(2&i)throw Error()}jr(CO,55),v8=Object.freeze(CO);class tw{constructor(e,t,n){this.l=0,this.g=e,this.h=t,this.m=n}next(){if(this.l<this.g.length){const e=this.g[this.l++];return{done:!1,value:this.h?this.h.call(this.m,e):e}}return{done:!0,value:void 0}}[Symbol.iterator](){return new tw(this.g,this.h,this.m)}}let ep;function Dj(i,e){(e=ep?e[ep]:void 0)&&(i[ep]=kl(e))}var GEe=Object.freeze({}),HEe=Object.freeze({});function k4(i){return i.Sa=!0,i}var QEe=k4((i=>typeof i=="number")),TO=k4((i=>typeof i=="string")),VEe=k4((i=>typeof i=="boolean")),F4=typeof o0.BigInt=="function"&&typeof o0.BigInt(0)=="bigint",Y5=k4((i=>F4?i>=jEe&&i<=$Ee:i[0]==="-"?bO(i,WEe):bO(i,KEe)));const WEe=Number.MIN_SAFE_INTEGER.toString(),jEe=F4?BigInt(Number.MIN_SAFE_INTEGER):void 0,KEe=Number.MAX_SAFE_INTEGER.toString(),$Ee=F4?BigInt(Number.MAX_SAFE_INTEGER):void 0;function bO(i,e){if(i.length>e.length)return!1;if(i.length<e.length||i===e)return!0;for(let t=0;t<i.length;t++){const n=i[t],r=e[t];if(n>r)return!1;if(n<r)return!0}}const YEe=typeof Uint8Array.prototype.slice=="function";let kj,or=0,is=0;function IO(i){const e=i>>>0;or=e,is=(i-e)/4294967296>>>0}function uA(i){if(i<0){IO(-i);const[e,t]=w8(or,is);or=e>>>0,is=t>>>0}else IO(i)}function E8(i){const e=kj||(kj=new DataView(new ArrayBuffer(8)));e.setFloat32(0,+i,!0),is=0,or=e.getUint32(0,!0)}function _8(i,e){return 4294967296*e+(i>>>0)}function S8(i,e){const t=2147483648&e;return t&&(e=~e>>>0,(i=1+~i>>>0)==0&&(e=e+1>>>0)),i=_8(i,e),t?-i:i}function nw(i,e){if(i>>>=0,(e>>>=0)<=2097151)var t=""+(4294967296*e+i);else y8()?t=""+(BigInt(e)<<BigInt(32)|BigInt(i)):(i=(16777215&i)+6777216*(t=16777215&(i>>>24|e<<8))+6710656*(e=e>>16&65535),t+=8147497*e,e*=2,i>=1e7&&(t+=i/1e7>>>0,i%=1e7),t>=1e7&&(e+=t/1e7>>>0,t%=1e7),t=e+MO(t)+MO(i));return t}function MO(i){return i=String(i),"0000000".slice(i.length)+i}function O4(i){if(i.length<16)uA(Number(i));else if(y8())i=BigInt(i),or=Number(i&BigInt(4294967295))>>>0,is=Number(i>>BigInt(32)&BigInt(4294967295));else{const e=+(i[0]==="-");is=or=0;const t=i.length;for(let n=e,r=(t-e)%6+e;r<=t;n=r,r+=6){const s=Number(i.slice(n,r));is*=1e6,or=1e6*or+s,or>=4294967296&&(is+=Math.trunc(or/4294967296),is>>>=0,or>>>=0)}if(e){const[n,r]=w8(or,is);or=n,is=r}}}function w8(i,e){return e=~e,i?i=1+~i:e+=1,[i,e]}function Ep(i){return i==null||typeof i=="number"?i:i==="NaN"||i==="Infinity"||i==="-Infinity"?Number(i):void 0}function Fj(i){return i==null||typeof i=="boolean"?i:typeof i=="number"?!!i:void 0}const XEe=/^-?([1-9][0-9]*|0)(\.[0-9]+)?$/;function N4(i){const e=typeof i;switch(e){case"bigint":return!0;case"number":return Number.isFinite(i)}return e==="string"&&XEe.test(i)}function LA(i){if(i==null)return i;if(typeof i=="string"){if(!i)return;i=+i}return typeof i=="number"&&Number.isFinite(i)?0|i:void 0}function qEe(i){if(i==null)return i;if(typeof i=="string"){if(!i)return;i=+i}return typeof i=="number"&&Number.isFinite(i)?i>>>0:void 0}function RO(i){return i[0]!=="-"&&(i.length<20||i.length===20&&Number(i.substring(0,6))<184467)}function C8(i){return i=Math.trunc(i),Number.isSafeInteger(i)||(uA(i),i=S8(or,is)),i}function T8(i){var e=Math.trunc(Number(i));if(Number.isSafeInteger(e))return String(e);if((e=i.indexOf("."))!==-1&&(i=i.substring(0,e)),!(i[0]==="-"?i.length<20||i.length===20&&Number(i.substring(0,7))>-922337:i.length<19||i.length===19&&Number(i.substring(0,6))<922337))if(O4(i),i=or,2147483648&(e=is))if(y8())i=""+(BigInt(0|e)<<BigInt(32)|BigInt(i>>>0));else{const[t,n]=w8(i,e);i="-"+nw(t,n)}else i=nw(i,e);return i}function iw(i){return i==null?i:typeof i=="bigint"?(Y5(i)?i=Number(i):(i=BigInt.asIntN(64,i),i=Y5(i)?Number(i):String(i)),i):N4(i)?typeof i=="number"?C8(i):T8(i):void 0}function JEe(i){if(i==null)return i;var e=typeof i;if(e==="bigint")return String(BigInt.asUintN(64,i));if(N4(i)){if(e==="string")return e=Math.trunc(Number(i)),Number.isSafeInteger(e)&&e>=0?i=String(e):((e=i.indexOf("."))!==-1&&(i=i.substring(0,e)),RO(i)||(O4(i),i=nw(or,is))),i;if(e==="number")return(i=Math.trunc(i))>=0&&Number.isSafeInteger(i)?i:(function(t){if(t<0){uA(t);const n=nw(or,is);return t=Number(n),Number.isSafeInteger(t)?t:n}return RO(String(t))?t:(uA(t),_8(or,is))})(i)}}function Oj(i){if(typeof i!="string")throw Error();return i}function PA(i){if(i!=null&&typeof i!="string")throw Error();return i}function tp(i){return i==null||typeof i=="string"?i:void 0}function b8(i,e,t,n){if(i!=null&&typeof i=="object"&&i.Y===Ix)return i;if(!Array.isArray(i))return t?2&n?(i=e[SO])?e=i:(RA((i=new e).u),e=e[SO]=i):e=new e:e=void 0,e;let r=t=xs(i);return r===0&&(r|=32&n),r|=2&n,r!==t&&jr(i,r),new e(i)}function ZEe(i,e,t){if(e)e:{if(!N4(e=i))throw K5("int64");switch(typeof e){case"string":e=T8(e);break e;case"bigint":if(i=e=BigInt.asIntN(64,e),TO(i)){if(!/^\s*(?:-?[1-9]\d*|0)?\s*$/.test(i))throw Error(String(i))}else if(QEe(i)&&!Number.isSafeInteger(i))throw Error(String(i));e=F4?BigInt(e):VEe(e)?e?"1":"0":TO(e)?e.trim()||"0":String(e);break e;default:e=C8(e)}}else e=iw(i);return typeof(t=(i=e)==null?t?0:void 0:i)=="string"&&(e=+t,Number.isSafeInteger(e))?e:t}function Nj(i){if(Pv===void 0&&(Pv=typeof Proxy=="function"?zj(Proxy):null),!Pv||!Uj())return i;let e=Jo==null?void 0:Jo.get(i);return e||(Math.random()>.01?i:((function(t){if(GI===void 0){const n=new Pv([],{});GI=Array.prototype.concat.call([],n).length===1}GI&&typeof Symbol=="function"&&Symbol.isConcatSpreadable&&(t[Symbol.isConcatSpreadable]=!0)})(i),e=new Pv(i,{set:(t,n,r)=>(l0(),t[n]=r,!0)}),(function(t,n){(Jo||(Jo=new jm)).set(t,n),(cS||(cS=new jm)).set(n,t)})(i,e),e))}let Jo,cS,Pv,jm,GI,Rl,rw,e3e,t3e;function Uj(){return jm===void 0&&(jm=typeof WeakMap=="function"?zj(WeakMap):null),jm}function zj(i){try{return i.toString().indexOf("[native code]")!==-1?i:null}catch{return null}}function I8(i,e,t){var o;if(BEe&&Uj()){if((o=Rl==null?void 0:Rl.get(e))!=null&&o.get(i)){if(t)return}else if(Math.random()>.01)return;var n=i.length;t={length:n};for(var r=0;r<Math.min(n,10);r++){if(n<=10)var s=r;else{s=n/10;const a=Math.floor(r*s);s=a+Math.floor(Math.random()*(Math.floor((r+1)*s)-a))}t[s]=i[s]}Gj(i,t)?((r=(n=Rl||(Rl=new jm)).get(e))||(r=new jm,n.set(e,r)),r.set(i,t)):(l0(),X2(i,e))}}function sw(i,e){var n;const t=(n=Rl==null?void 0:Rl.get(e))==null?void 0:n.get(i);t&&!Gj(i,t)&&(l0(),X2(i,e))}function Gj(i,e){if(i.length!==e.length)return!1;for(const r in e){var t,n=Number(r);if((t=Number.isInteger(n))&&(t=i[n],n=e[n],t=!(Number.isNaN(t)?Number.isNaN(n):t===n)),t)return!1}return!0}function U4(i){if(i&&(Rl!=null&&Rl.has(i))){var e=i.u;if(e)for(let t=0;t<e.length;t++){const n=e[t];if(t===e.length-1&&D4(n))for(const r in n){const s=n[r];Array.isArray(s)&&sw(s,i)}else Array.isArray(n)&&sw(n,i)}}}function X2(i,e){var t;(t=Rl==null?void 0:Rl.get(e))==null||t.delete(i)}function Km(i,e){return i=Hj(i,e[0],e[1]),B4(i,16384),i}function Hj(i,e,t){if(i==null&&(i=rw),rw=void 0,i==null){var n=96;t?(i=[t],n|=512):i=[],e&&(n=-33521665&n|(1023&e)<<15)}else{if(!Array.isArray(i))throw Error("narr");if(2048&(n=xs(i)))throw Error("farr");if(64&n)return i;if(n|=64,t&&(n|=512,t!==i[0]))throw Error("mid");e:{const r=(t=i).length;if(r){const s=r-1;if(D4(t[s])){if((e=s-(+!!(512&(n|=256))-1))>=1024)throw Error("pvtlmt");n=-33521665&n|(1023&e)<<15;break e}}if(e){if((e=Math.max(e,r-(+!!(512&n)-1)))>1024)throw Error("spvt");n=-33521665&n|(1023&e)<<15}}}return jr(i,n),i}const n3e={};let i3e=(function(){try{return g8(new class extends Map{constructor(){super()}}),!1}catch{return!0}})();class HI{constructor(){this.g=new Map}get(e){return this.g.get(e)}set(e,t){return this.g.set(e,t),this.size=this.g.size,this}delete(e){return e=this.g.delete(e),this.size=this.g.size,e}clear(){this.g.clear(),this.size=this.g.size}has(e){return this.g.has(e)}entries(){return this.g.entries()}keys(){return this.g.keys()}values(){return this.g.values()}forEach(e,t){return this.g.forEach(e,t)}[Symbol.iterator](){return this.entries()}}const r3e=i3e?(Object.setPrototypeOf(HI.prototype,Map.prototype),Object.defineProperties(HI.prototype,{size:{value:0,configurable:!0,enumerable:!0,writable:!0}}),HI):class extends Map{constructor(){super()}};function LO(i){return i}function QI(i){if(2&i.M)throw Error("Cannot mutate an immutable Map")}var yc=class extends r3e{constructor(i,e,t=LO,n=LO){super();let r=xs(i);r|=64,jr(i,r),this.M=r,this.U=e,this.T=t,this.aa=this.U?s3e:n;for(let s=0;s<i.length;s++){const o=i[s],a=t(o[0],!1,!0);let l=o[1];e?l===void 0&&(l=null):l=n(o[1],!1,!0,void 0,void 0,r),super.set(a,l)}}pa(i=PO){if(this.size!==0)return this.Z(i)}Z(i=PO){const e=[],t=super.entries();for(var n;!(n=t.next()).done;)(n=n.value)[0]=i(n[0]),n[1]=i(n[1]),e.push(n);return e}clear(){QI(this),super.clear()}delete(i){return QI(this),super.delete(this.T(i,!0,!1))}entries(){var i=this.oa();return new tw(i,o3e,this)}keys(){return this.Ka()}values(){var i=this.oa();return new tw(i,yc.prototype.get,this)}forEach(i,e){super.forEach(((t,n)=>{i.call(e,this.get(n),n,this)}))}set(i,e){return QI(this),(i=this.T(i,!0,!1))==null?this:e==null?(super.delete(i),this):super.set(i,this.aa(e,!0,!0,this.U,!1,this.M))}Qa(i){const e=this.T(i[0],!1,!0);i=i[1],i=this.U?i===void 0?null:i:this.aa(i,!1,!0,void 0,!1,this.M),super.set(e,i)}has(i){return super.has(this.T(i,!1,!1))}get(i){i=this.T(i,!1,!1);const e=super.get(i);if(e!==void 0){var t=this.U;return t?((t=this.aa(e,!1,!0,t,this.va,this.M))!==e&&super.set(i,t),t):e}}oa(){return Array.from(super.keys())}Ka(){return super.keys()}[Symbol.iterator](){return this.entries()}};function s3e(i,e,t,n,r,s){return i=b8(i,n,t,s),r&&(i=G4(i)),i}function PO(i){return i}function o3e(i){return[i,this.get(i)]}let a3e;function BO(){return a3e||(a3e=new yc(RA([]),void 0,void 0,void 0,n3e))}function M8(i,e,t,n,r){if(i!=null){if(Array.isArray(i))i=ew(i)?void 0:r&&2&xs(i)?i:z4(i,e,t,n!==void 0,r);else if(D4(i)){const s={};for(let o in i)s[o]=M8(i[o],e,t,n,r);i=s}else i=e(i,n);return i}}function z4(i,e,t,n,r){const s=n||t?xs(i):0;n=n?!!(32&s):void 0;const o=kl(i);for(let a=0;a<o.length;a++)o[a]=M8(o[a],e,t,n,r);return t&&(Dj(o,i),t(s,o)),o}function l3e(i){return M8(i,R8,void 0,void 0,!1)}function R8(i){return i.Y===Ix?i.toJSON():i instanceof yc?i.pa(l3e):(function(e){switch(typeof e){case"number":return isFinite(e)?e:String(e);case"bigint":return Y5(e)?Number(e):String(e);case"boolean":return e?1:0;case"object":if(e)if(Array.isArray(e)){if(ew(e))return}else{if(Tx(e))return EO(e);if(e instanceof kf){const t=e.ba;return t==null?"":typeof t=="string"?t:e.ba=EO(t)}if(e instanceof yc)return e.pa()}}return e})(i)}function X5(i,e,t=$5){if(i!=null){if(Ij&&i instanceof Uint8Array)return e?i:new Uint8Array(i);if(Array.isArray(i)){var n=xs(i);return 2&n?i:(e&&(e=n===0||!!(32&n)&&!(64&n||!(16&n))),e?(jr(i,-12293&(34|n)),i):z4(i,X5,4&n?$5:t,!0,!0))}return i.Y===Ix?(t=i.u,i=2&(n=Ui(t))?i:L8(i,t,n,!0)):i instanceof yc&&!(2&i.M)&&(t=RA(i.Z(X5)),i=new yc(t,i.U,i.T,i.aa)),i}}function L8(i,e,t,n){return U4(i),i=i.constructor,rw=e=Qj(e,t,n),e=new i(e),rw=void 0,e}function Qj(i,e,t){const n=t||2&e?$5:zEe,r=!!(32&e);return i=(function(s,o,a){const l=kl(s);var c=l.length;const u=256&o?l[c-1]:void 0;for(c+=u?-1:0,o=512&o?1:0;o<c;o++)l[o]=a(l[o]);if(u){o=l[o]={};for(const h in u)o[h]=a(u[h])}return Dj(l,s),l})(i,e,(s=>X5(s,r,n))),B4(i,32|(t?2:0)),i}function G4(i){const e=i.u,t=Ui(e);return 2&t?L8(i,e,t,!1):i}function Vj(i,e,t,n){return!(4&e)||t!=null}function cp(i,e){return bh(i=i.u,Ui(i),e)}function DO(i,e,t,n){if(!((e=n+(+!!(512&e)-1))<0||e>=i.length||e>=t))return i[e]}function bh(i,e,t,n){if(t===-1)return null;const r=e>>15&1023||536870912;if(!(t>=r)){var s=i.length;return n&&256&e&&(n=i[s-1][t])!=null?(DO(i,e,r,t)&&zI!=null&&((e=(i=UEe??(UEe={}))[zI]||0)>=4||(i[zI]=e+1,l0())),n):DO(i,e,r,t)}return 256&e?i[i.length-1][t]:void 0}function Ar(i,e,t){const n=i.u;let r=Ui(n);return Hf(r),kr(n,r,e,t),i}function kr(i,e,t,n){const r=e>>15&1023||536870912;if(t>=r){let s,o=e;if(256&e)s=i[i.length-1];else{if(n==null)return o;s=i[r+(+!!(512&e)-1)]={},o|=256}return s[t]=n,t<r&&(i[t+(+!!(512&e)-1)]=void 0),o!==e&&jr(i,o),o}return i[t+(+!!(512&e)-1)]=n,256&e&&t in(i=i[i.length-1])&&delete i[t],e}function BA(i,e,t,n,r){var s=2&e;r=bh(i,e,t,r),Array.isArray(r)||(r=v8);const o=!(2&n);n=!(1&n);const a=!!(32&e);let l=xs(r);return l!==0||!a||s||o?1&l||(l|=1,jr(r,l)):(l|=33,jr(r,l)),s?(i=!1,2&l||(RA(r),i=!!(4&l)),(n||i)&&Object.freeze(r)):(s=!!(2&l)||!!(2048&l),n&&s?(r=kl(r),s=1,a&&!o&&(s|=32),jr(r,s),kr(i,e,t,r)):o&&32&l&&!s&&ZS(r,32)),r}function uS(i,e){i=i.u;let t=Ui(i);const n=bh(i,t,e),r=Ep(n);return r!=null&&r!==n&&kr(i,t,e,r),r}function Wj(i){i=i.u;let e=Ui(i);const t=bh(i,e,1),n=x8(t,!0,!!(34&e));return n!=null&&n!==t&&kr(i,e,1,n),n}function Fm(){return GEe===void 0?2:5}function Om(i,e,t,n,r,s){const o=i.u;let a=Ui(o);n=2&a?1:n,s=!!s,r=jj(o,a,e,r);var l=xs(r),c=r;if(sw(c,i),n!==2&&n!==1||X2(c,i),Vj(i,l,void 0)){4&l&&(r=kl(r),l=c0(l,a),a=kr(o,a,e,r));let h=c=0;for(;c<r.length;c++){const f=t(r[c]);f!=null&&(r[h++]=f)}h<c&&(r.length=h),l=-4097&(20|(l=Kj(l,a))),jr(r,l&=-8193),2&l&&Object.freeze(r)}let u;return n===1||n===4&&32&l?If(l)||(i=l,(l|=2)!==i&&jr(r,l),Object.freeze(r)):(t=n===5&&(!!(32&l)||If(l)||!!(Jo!=null&&Jo.get(r))),(n===2||t)&&If(l)&&(r=kl(r),l=hA(l=c0(l,a),a,s),jr(r,l),a=kr(o,a,e,r)),If(l)||(e=l,(l=hA(l,a,s))!==e&&jr(r,l)),t?(u=Nj(r),I8(r,i,!0)):n!==2||s||(Jo==null||Jo.delete(r))),u||r}function jj(i,e,t,n){return i=bh(i,e,t,n),Array.isArray(i)?i:v8}function Kj(i,e){return i===0&&(i=c0(i,e)),1|i}function If(i){return!!(2&i)&&!!(4&i)||!!(2048&i)}function $j(i){i=kl(i);for(let e=0;e<i.length;e++){const t=i[e]=kl(i[e]);Array.isArray(t[1])&&(t[1]=RA(t[1]))}return i}function q5(i,e,t,n){i=i.u;let r=Ui(i);Hf(r),kr(i,r,e,(n==="0"?Number(t)===0:t===n)?void 0:t)}function VI(i,e){var t=IK;return B8(P8(i=i.u),i,Ui(i),t)===e?e:-1}function P8(i){if(MA)return i[Lv]??(i[Lv]=new Map);if(Lv in i)return i[Lv];const e=new Map;return Object.defineProperty(i,Lv,{value:e}),e}function Yj(i,e,t,n){const r=P8(i),s=B8(r,i,e,t);return s!==n&&(s&&(e=kr(i,e,s)),r.set(t,n)),e}function B8(i,e,t,n){let r=i.get(n);if(r!=null)return r;r=0;for(let s=0;s<n.length;s++){const o=n[s];bh(e,t,o)!=null&&(r!==0&&(t=kr(e,t,r)),r=o)}return i.set(n,r),r}function D8(i,e,t,n){let r,s=Ui(i);if((n=bh(i,s,t,n))!=null&&n.Y===Ix)return(e=G4(n))!==n&&kr(i,s,t,e),e.u;if(Array.isArray(n)){const o=xs(n);r=2&o?Qj(n,o,!1):n,r=Km(r,e)}else r=Km(void 0,e);return r!==n&&kr(i,s,t,r),r}function Xj(i,e,t,n){i=i.u;let r=Ui(i);return(e=b8(n=bh(i,r,t,n),e,!1,r))!==n&&e!=null&&kr(i,r,t,e),e}function wi(i,e,t,n=!1){if((e=Xj(i,e,t,n))==null)return e;if(i=i.u,!(2&(n=Ui(i)))){const r=G4(e);r!==e&&kr(i,n,t,e=r)}return e}function qj(i,e,t,n,r,s,o){const a=i.u;var l=!!(2&e);r=l?1:r,s=!!s,o&&(o=!l),l=jj(a,e,n);var c=xs(l),u=l;if(sw(u,i),r!==2&&r!==1||X2(u,i),!(u=!!(4&c))){var h=l,f=e;const m=!!(2&(c=Kj(c,e)));m&&(f|=2);let A=!m,g=!0,y=0,E=0;for(;y<h.length;y++){const x=b8(h[y],t,!1,f);if(x instanceof t){if(!m){const C=!!(2&xs(x.u));A&&(A=!C),g&&(g=C)}h[E++]=x}}E<y&&(h.length=E),c|=4,c=g?16|c:-17&c,jr(h,c=A?8|c:-9&c),m&&Object.freeze(h)}if(o&&!(8&c||!l.length&&(r===1||r===4&&32&c))){for(If(c)?(l=kl(l),c=c0(c,e),e=kr(a,e,n,l)):X2(l,i),t=l,o=c,h=0;h<t.length;h++)(c=t[h])!==(f=G4(c))&&(t[h]=f);o|=8,o=t.length?-17&o:16|o,jr(t,o),c=o}let d;return r===1||r===4&&32&c?If(c)||(i=c,(c|=!l.length||16&c&&(!u||32&c)?2:2048)!==i&&jr(l,c),Object.freeze(l)):(u=r===5&&(!!(32&c)||If(c)||!!(Jo!=null&&Jo.get(l))),(r===2||u)&&If(c)&&(l=kl(l),c=hA(c=c0(c,e),e,s),jr(l,c),e=kr(a,e,n,l)),If(c)||(n=c,(c=hA(c,e,s))!==n&&jr(l,c)),u?(d=Nj(l),I8(l,i,!0)):r!==2||s||(Jo==null||Jo.delete(l))),d||l}function Gf(i,e,t){const n=Ui(i.u);return qj(i,n,e,t,Fm(),!1,!(2&n))}function Cn(i,e,t,n){return n==null&&(n=void 0),Ar(i,t,n)}function d2(i,e,t,n){n==null&&(n=void 0);e:{i=i.u;let r=Ui(i);if(Hf(r),n==null){const s=P8(i);if(B8(s,i,r,t)!==e)break e;s.set(t,0)}else r=Yj(i,r,t,e);kr(i,r,e,n)}}function c0(i,e){return-2049&(i=32|(2&e?2|i:-3&i))}function hA(i,e,t){return 32&e&&t||(i&=-33),i}function ow(i,e,t,n){const r=Ui(i.u);Hf(r),i=qj(i,r,t,e,2,!0),t=n??new t,i.push(t),2&xs(t.u)?ZS(i,8):ZS(i,16)}function bu(i,e){return i??e}function mc(i,e){return LA(cp(i,e))}function ms(i,e){return bu(uS(i,e),0)}function Sh(i,e){return bu(tp(cp(i,e)),"")}function q2(i,e,t){if(t!=null&&typeof t!="boolean")throw i=typeof t,Error(`Expected boolean but got ${i!="object"?i:t?Array.isArray(t)?"array":i:"null"}: ${t}`);Ar(i,e,t)}function wh(i,e,t){if(t!=null){if(typeof t!="number"||!Number.isFinite(t))throw K5("int32");t|=0}Ar(i,e,t)}function hn(i,e,t){if(t!=null&&typeof t!="number")throw Error(`Value of float/double field must be a number, found ${typeof t}: ${t}`);Ar(i,e,t)}function aw(i,e,t){{const a=i.u;let l=Ui(a);if(Hf(l),t==null)kr(a,l,e);else{t=(cS==null?void 0:cS.get(t))||t;var n,r=xs(t),s=r,o=!!(2&r)||Object.isFrozen(t);if((n=!o)&&(n=HEe===void 0||!1),Vj(i,r)){r=21,o&&(t=kl(t),s=0,r=hA(r=c0(r,l),l,!0));for(let c=0;c<t.length;c++)t[c]=Oj(t[c])}n?(t=kl(t),s=0,r=hA(r=c0(r,l),l,!0)):o||I8(t,i),r!==s&&jr(t,r),kr(a,l,e,t)}}}function H4(i,e,t){Hf(Ui(i.u)),Om(i,e,tp,2,void 0,!0).push(Oj(t))}function Jj(i,e){return Error(`Invalid wire type: ${i} (at position ${e})`)}function k8(){return Error("Failed to read varint, encoding is invalid.")}function Zj(i,e){return Error(`Tried to read past the end of the data ${e} > ${i}`)}function F8(i){if(typeof i=="string")return{buffer:Rj(i),O:!1};if(Array.isArray(i))return{buffer:new Uint8Array(i),O:!1};if(i.constructor===Uint8Array)return{buffer:i,O:!1};if(i.constructor===ArrayBuffer)return{buffer:new Uint8Array(i),O:!1};if(i.constructor===kf)return{buffer:A8(i)||new Uint8Array(0),O:!0};if(i instanceof Uint8Array)return{buffer:new Uint8Array(i.buffer,i.byteOffset,i.byteLength),O:!1};throw Error("Type not convertible to a Uint8Array, expected a Uint8Array, an ArrayBuffer, a base64 encoded string, a ByteString or an Array of numbers")}function O8(i,e){let t,n=0,r=0,s=0;const o=i.h;let a=i.g;do t=o[a++],n|=(127&t)<<s,s+=7;while(s<32&&128&t);for(s>32&&(r|=(127&t)>>4),s=3;s<32&&128&t;s+=7)t=o[a++],r|=(127&t)<<s;if($m(i,a),t<128)return e(n>>>0,r>>>0);throw k8()}function N8(i){let e=0,t=i.g;const n=t+10,r=i.h;for(;t<n;){const s=r[t++];if(e|=s,(128&s)==0)return $m(i,t),!!(127&e)}throw k8()}function up(i){const e=i.h;let t=i.g,n=e[t++],r=127&n;if(128&n&&(n=e[t++],r|=(127&n)<<7,128&n&&(n=e[t++],r|=(127&n)<<14,128&n&&(n=e[t++],r|=(127&n)<<21,128&n&&(n=e[t++],r|=n<<28,128&n&&128&e[t++]&&128&e[t++]&&128&e[t++]&&128&e[t++]&&128&e[t++])))))throw k8();return $m(i,t),r}function hp(i){return up(i)>>>0}function J5(i){var e=i.h;const t=i.g,n=e[t],r=e[t+1],s=e[t+2];return e=e[t+3],$m(i,i.g+4),(n<<0|r<<8|s<<16|e<<24)>>>0}function Z5(i){var e=J5(i);i=2*(e>>31)+1;const t=e>>>23&255;return e&=8388607,t==255?e?NaN:i*(1/0):t==0?1401298464324817e-60*i*e:i*Math.pow(2,t-150)*(e+8388608)}function c3e(i){return up(i)}function WI(i,e,{ea:t=!1}={}){i.ea=t,e&&(e=F8(e),i.h=e.buffer,i.m=e.O,i.j=0,i.l=i.h.length,i.g=i.j)}function $m(i,e){if(i.g=e,e>i.l)throw Zj(i.l,e)}function eK(i,e){if(e<0)throw Error(`Tried to read a negative byte length: ${e}`);const t=i.g,n=t+e;if(n>i.l)throw Zj(e,i.l-t);return i.g=n,t}function tK(i,e){if(e==0)return a0();var t=eK(i,e);return i.ea&&i.m?t=i.h.subarray(t,t+e):(i=i.h,t=t===(e=t+e)?new Uint8Array(0):YEe?i.slice(t,e):new Uint8Array(i.subarray(t,e))),t.length==0?a0():new kf(t,cA)}yc.prototype.toJSON=void 0,yc.prototype.La=Bj;var kO=[];function nK(i){var e=i.g;if(e.g==e.l)return!1;i.l=i.g.g;var t=hp(i.g);if(e=t>>>3,!((t&=7)>=0&&t<=5))throw Jj(t,i.l);if(e<1)throw Error(`Invalid field number: ${e} (at position ${i.l})`);return i.m=e,i.h=t,!0}function hS(i){switch(i.h){case 0:i.h!=0?hS(i):N8(i.g);break;case 1:$m(i=i.g,i.g+8);break;case 2:if(i.h!=2)hS(i);else{var e=hp(i.g);$m(i=i.g,i.g+e)}break;case 5:$m(i=i.g,i.g+4);break;case 3:for(e=i.m;;){if(!nK(i))throw Error("Unmatched start-group tag: stream EOF");if(i.h==4){if(i.m!=e)throw Error("Unmatched end-group tag");break}hS(i)}break;default:throw Jj(i.h,i.l)}}function Mx(i,e,t){const n=i.g.l,r=hp(i.g),s=i.g.g+r;let o=s-n;if(o<=0&&(i.g.l=s,t(e,i,void 0,void 0,void 0),o=s-i.g.g),o)throw Error(`Message parsing ended unexpectedly. Expected to read ${r} bytes, instead read ${r-o} bytes, either the data ended unexpectedly or the message misreported its own length`);return i.g.g=s,i.g.l=n,e}function U8(i){var e=hp(i.g),t=eK(i=i.g,e);if(i=i.h,REe){var n,r=i;(n=NI)||(n=NI=new TextDecoder("utf-8",{fatal:!0})),e=t+e,r=t===0&&e===r.length?r:r.subarray(t,e);try{var s=n.decode(r)}catch(a){if(D_===void 0){try{n.decode(new Uint8Array([128]))}catch{}try{n.decode(new Uint8Array([97])),D_=!0}catch{D_=!1}}throw!D_&&(NI=void 0),a}}else{e=(s=t)+e,t=[];let a,l=null;for(;s<e;){var o=i[s++];o<128?t.push(o):o<224?s>=e?_m():(a=i[s++],o<194||(192&a)!=128?(s--,_m()):t.push((31&o)<<6|63&a)):o<240?s>=e-1?_m():(a=i[s++],(192&a)!=128||o===224&&a<160||o===237&&a>=160||(192&(n=i[s++]))!=128?(s--,_m()):t.push((15&o)<<12|(63&a)<<6|63&n)):o<=244?s>=e-2?_m():(a=i[s++],(192&a)!=128||a-144+(o<<28)>>30!=0||(192&(n=i[s++]))!=128||(192&(r=i[s++]))!=128?(s--,_m()):(o=(7&o)<<18|(63&a)<<12|(63&n)<<6|63&r,o-=65536,t.push(55296+(o>>10&1023),56320+(1023&o)))):_m(),t.length>=8192&&(l=vO(l,t),t.length=0)}s=vO(l,t)}return s}function iK(i){const e=hp(i.g);return tK(i.g,e)}function Q4(i,e,t){var n=hp(i.g);for(n=i.g.g+n;i.g.g<n;)t.push(e(i.g))}var k_=[];let lw;function Pu(i,e,t){e.g?e.m(i,e.g,e.h,t,!0):e.m(i,e.h,t,!0)}var an=class{constructor(i,e){this.u=Hj(i,e)}toJSON(){return rK(this)}l(){var i=X3e;return i.g?i.l(this,i.g,i.h,!0):i.l(this,i.h,i.defaultValue,!0)}clone(){const i=this.u;return L8(this,i,Ui(i),!1)}O(){return!!(2&xs(this.u))}};function rK(i){U4(i),i=lw?i.u:z4(i.u,R8,void 0,void 0,!1);{var e=!lw;let c=i.length;if(c){var t=i[c-1],n=D4(t);n?c--:t=void 0;var r=i;if(n){e:{var s,o=t,a=!1;if(o)for(let u in o)isNaN(+u)?(s??(s={}))[u]=o[u]:(n=o[u],Array.isArray(n)&&(ew(n)||wO(n)&&n.size===0)&&(n=null),n==null&&(a=!0),n!=null&&((s??(s={}))[u]=n));if(a||(s=o),s)for(let u in s){a=s;break e}a=null}o=a==null?t!=null:a!==t}for(;c>0&&((s=r[c-1])==null||ew(s)||wO(s)&&s.size===0);c--)var l=!0;(r!==i||o||l)&&(e?(l||o||a)&&(r.length=c):r=Array.prototype.slice.call(r,0,c),a&&r.push(a)),l=r}else l=i}return l}function FO(i){return i?/^\d+$/.test(i)?(O4(i),new e6(or,is)):null:u3e||(u3e=new e6(0,0))}an.prototype.Y=Ix,an.prototype.toString=function(){try{return lw=!0,rK(this).toString()}finally{lw=!1}};var e6=class{constructor(i,e){this.h=i>>>0,this.g=e>>>0}};let u3e;function OO(i){return i?/^-?\d+$/.test(i)?(O4(i),new t6(or,is)):null:h3e||(h3e=new t6(0,0))}var t6=class{constructor(i,e){this.h=i>>>0,this.g=e>>>0}};let h3e;function $1(i,e,t){for(;t>0||e>127;)i.g.push(127&e|128),e=(e>>>7|t<<25)>>>0,t>>>=7;i.g.push(e)}function Rx(i,e){for(;e>127;)i.g.push(127&e|128),e>>>=7;i.g.push(e)}function V4(i,e){if(e>=0)Rx(i,e);else{for(let t=0;t<9;t++)i.g.push(127&e|128),e>>=7;i.g.push(1)}}function J2(i,e){i.g.push(e>>>0&255),i.g.push(e>>>8&255),i.g.push(e>>>16&255),i.g.push(e>>>24&255)}function fA(i,e){e.length!==0&&(i.l.push(e),i.h+=e.length)}function Sc(i,e,t){Rx(i.g,8*e+t)}function z8(i,e){return Sc(i,e,2),e=i.g.end(),fA(i,e),e.push(i.h),e}function G8(i,e){var t=e.pop();for(t=i.h+i.g.length()-t;t>127;)e.push(127&t|128),t>>>=7,i.h++;e.push(t),i.h++}function W4(i,e,t){Sc(i,e,2),Rx(i.g,t.length),fA(i,i.g.end()),fA(i,t)}function n6(i,e,t,n){t!=null&&(e=z8(i,e),n(t,i),G8(i,e))}class DA{constructor(e,t,n){this.g=e,this.h=t,this.qa=n}}function sK(i){return Array.isArray(i)?i[0]instanceof DA?i:[E3e,i]:[i,void 0]}function kA(i,e){if(Array.isArray(e)){var t=xs(e);if(4&t)return e;for(var n=0,r=0;n<e.length;n++){const s=i(e[n]);s!=null&&(e[r++]=s)}return r<n&&(e.length=r),jr(e,-12289&(5|t)),2&t&&Object.freeze(e),e}}const NO=Symbol();function H8(i){let e=i[NO];if(!e){const t=Q8(i),n=t.h;e=n?(r,s)=>n(r,s,t):(r,s)=>{var c;for(;nK(s)&&s.h!=4;){var o=s.m;let u=t[o];const h=!u;let f=!1;if(!u){var a=t.X;if(a){var l=a[o];l&&(f=(c=a.P)==null?void 0:c[o],(!Cj||f)&&(a=f3e(l))&&(u=t[o]=a))}}u&&u(s,r,o)||(o=(a=s).l,hS(a),a.ja?a=void 0:(l=a.g.g-o,a.g.g=o,a=tK(a.g,l)),o=r,a&&(ep||(ep=Symbol()),(l=o[ep])?l.push(a):o[ep]=[a])),h&&u&&!f&&i6++<5&&l0()}},i[NO]=e}return e}function f3e(i){const e=(i=sK(i))[0].g;if(i=i[1]){const t=H8(i),n=Q8(i).g;return(r,s,o)=>e(r,s,o,n,t)}return e}function d3e(i,e,t){i[e]=t}function oK(i,e,t,n){var r=d3e;e.g=(function(h){switch(typeof h){case"boolean":return e3e||(e3e=[0,void 0,!0]);case"number":return h>0?void 0:h===0?t3e||(t3e=[0,void 0]):[-h,void 0];case"string":return[0,h];case"object":return h}})(i[0]);let s=0;var o=i[++s];o&&o.constructor===Object&&(e.X=o,typeof(o=i[++s])=="function"&&(e.h=o,e.l=i[++s],o=i[++s]));const a={};for(;Array.isArray(o)&&typeof o[0]=="number"&&o[0]>0;){for(var l=0;l<o.length;l++)a[o[l]]=o;o=i[++s]}for(l=1;o!==void 0;){let h;typeof o=="number"&&(l+=o,o=i[++s]);var c=void 0;if(o instanceof DA?h=o:(h=_3e,s--),h.qa){o=i[++s],c=i;var u=s;typeof o=="function"&&(o=o(),c[u]=o),c=o}for(u=l+1,typeof(o=i[++s])=="number"&&o<0&&(u-=o,o=i[++s]);l<u;l++){const f=a[l];r(e,l,c?n(h,c,f):t(h,f))}}return e}const UO=Symbol();function aK(i){let e=i[UO];if(!e){const t=j4(i);e=(n,r)=>lK(n,r,t),i[UO]=e}return e}const zO=Symbol();function p3e(i){return i.h}function m3e(i,e){let t,n;const r=i.h;return(s,o,a)=>r(s,o,a,n||(n=j4(e).g),t||(t=aK(e)))}function j4(i){let e=i[zO];return e||(e=oK(i,i[zO]={},p3e,m3e))}const GO=Symbol();function g3e(i,e){const t=i.g;return e?(n,r,s)=>t(n,r,s,e):t}function A3e(i,e,t){const n=i.g;let r,s;return(o,a,l)=>n(o,a,l,s||(s=Q8(e).g),r||(r=H8(e)),t)}function Q8(i){let e=i[GO];return e||(e=oK(i,i[GO]={},g3e,A3e))}function HO(i,e){var s;var t=i[e];if(t)return t;if(t=i.X){var n=t[e];if(n){var r=(n=sK(n))[0].h;if(n=n[1],t=(s=t.P)==null?void 0:s[e],!Cj||t){if(n){const o=aK(n),a=j4(n).g;t=(t=i.l)?t(a,o):(l,c,u)=>r(l,c,u,a,o)}else t=r;return i[e]=t}}}}function lK(i,e,t){var l,c,u;for(var n=Ui(i),r=+!!(512&n)-1,s=i.length,o=512&n?1:0,a=s+(256&n?-1:0);o<a;o++){const h=i[o];if(h==null)continue;const f=o-r,d=HO(t,f);if(!d)continue;const m=t.X;m!=null&&m[f]&&!((l=m==null?void 0:m.P)!=null&&l[f])&&i6++<5&&l0(),d(e,h,f)}if(256&n){n=i[s-1];for(let h in n)r=+h,!Number.isNaN(r)&&(s=n[h])!=null&&(a=HO(t,r))&&((c=o=t.X)!=null&&c[r]&&!((u=o==null?void 0:o.P)!=null&&u[r])&&i6++<5&&l0(),a(e,s,r))}if(i=ep?i[ep]:void 0)for(fA(e,e.g.end()),t=0;t<i.length;t++)fA(e,A8(i[t])||new Uint8Array(0))}function il(i,e){return new DA(i,e,!1)}function FA(i,e){return new DA(i,e,!1)}function K4(i,e){return new DA(i,e,!0)}function rl(i,e,t){kr(i,Ui(i),e,t)}var y3e=K4((function(i,e,t,n,r){return i.h===2&&(i=Mx(i,Km([void 0,void 0],n),r),Hf(n=Ui(e)),(r=bh(e,n,t))instanceof yc?(2&r.M)!=0?((r=r.Z()).push(i),kr(e,n,t,r)):r.Qa(i):Array.isArray(r)?(2&xs(r)&&kr(e,n,t,r=$j(r)),r.push(i)):kr(e,n,t,[i]),!0)}),(function(i,e,t,n,r){if(e instanceof yc)e.forEach(((s,o)=>{n6(i,t,Km([o,s],n),r)}));else if(Array.isArray(e))for(let s=0;s<e.length;s++){const o=e[s];Array.isArray(o)&&n6(i,t,Km(o,n),r)}}));let i6=0;function cK(i,e,t){if(e=(function(n){if(n==null)return n;const r=typeof n;if(r==="bigint")return String(BigInt.asIntN(64,n));if(N4(n)){if(r==="string")return T8(n);if(r==="number")return C8(n)}})(e),e!=null&&(typeof e=="string"&&OO(e),e!=null))switch(Sc(i,t,0),typeof e){case"number":i=i.g,uA(e),$1(i,or,is);break;case"bigint":t=BigInt.asUintN(64,e),t=new t6(Number(t&BigInt(4294967295)),Number(t>>BigInt(32))),$1(i.g,t.h,t.g);break;default:t=OO(e),$1(i.g,t.h,t.g)}}function uK(i,e,t){(e=LA(e))!=null&&e!=null&&(Sc(i,t,0),V4(i.g,e))}function hK(i,e,t){(e=Fj(e))!=null&&(Sc(i,t,0),i.g.g.push(e?1:0))}function fK(i,e,t){(e=tp(e))!=null&&W4(i,t,Sj(e))}function $4(i,e,t,n,r){e instanceof an?(U4(e),e=e.u):e=Array.isArray(e)?Km(e,n):void 0,n6(i,t,e,r)}function dK(i,e,t){(e=e==null||typeof e=="string"||Tx(e)||e instanceof kf?e:void 0)!=null&&W4(i,t,F8(e).buffer)}function pK(i,e,t){return(i.h===5||i.h===2)&&(e=BA(e,Ui(e),t,2,!1),i.h==2?Q4(i,Z5,e):e.push(Z5(i.g)),!0)}var Ds,wf=il((function(i,e,t){if(i.h!==1)return!1;var n=i.g;i=J5(n);const r=J5(n);n=2*(r>>31)+1;const s=r>>>20&2047;return i=4294967296*(1048575&r)+i,rl(e,t,s==2047?i?NaN:n*(1/0):s==0?5e-324*n*i:n*Math.pow(2,s-1075)*(i+4503599627370496)),!0}),(function(i,e,t){(e=Ep(e))!=null&&(Sc(i,t,1),i=i.g,(t=kj||(kj=new DataView(new ArrayBuffer(8)))).setFloat64(0,+e,!0),or=t.getUint32(0,!0),is=t.getUint32(4,!0),J2(i,or),J2(i,is))})),ro=il((function(i,e,t){return i.h===5&&(rl(e,t,Z5(i.g)),!0)}),(function(i,e,t){(e=Ep(e))!=null&&(Sc(i,t,5),i=i.g,E8(e),J2(i,or))})),v3e=FA(pK,(function(i,e,t){if((e=kA(Ep,e))!=null)for(let o=0;o<e.length;o++){var n=i,r=t,s=e[o];s!=null&&(Sc(n,r,5),n=n.g,E8(s),J2(n,or))}})),V8=FA(pK,(function(i,e,t){if((e=kA(Ep,e))!=null&&e.length){Sc(i,t,2),Rx(i.g,4*e.length);for(let n=0;n<e.length;n++)t=i.g,E8(e[n]),J2(t,or)}})),fp=il((function(i,e,t){return i.h===0&&(rl(e,t,O8(i.g,S8)),!0)}),cK),jI=il((function(i,e,t){return i.h===0&&(rl(e,t,(i=O8(i.g,S8))===0?void 0:i),!0)}),cK),x3e=il((function(i,e,t){return i.h===0&&(rl(e,t,O8(i.g,_8)),!0)}),(function(i,e,t){if((e=JEe(e))!=null&&(typeof e=="string"&&FO(e),e!=null))switch(Sc(i,t,0),typeof e){case"number":i=i.g,uA(e),$1(i,or,is);break;case"bigint":t=BigInt.asUintN(64,e),t=new e6(Number(t&BigInt(4294967295)),Number(t>>BigInt(32))),$1(i.g,t.h,t.g);break;default:t=FO(e),$1(i.g,t.h,t.g)}})),ss=il((function(i,e,t){return i.h===0&&(rl(e,t,up(i.g)),!0)}),uK),Y4=FA((function(i,e,t){return(i.h===0||i.h===2)&&(e=BA(e,Ui(e),t,2,!1),i.h==2?Q4(i,up,e):e.push(up(i.g)),!0)}),(function(i,e,t){if((e=kA(LA,e))!=null&&e.length){t=z8(i,t);for(let n=0;n<e.length;n++)V4(i.g,e[n]);G8(i,t)}})),D1=il((function(i,e,t){return i.h===0&&(rl(e,t,(i=up(i.g))===0?void 0:i),!0)}),uK),Vr=il((function(i,e,t){return i.h===0&&(rl(e,t,N8(i.g)),!0)}),hK),p2=il((function(i,e,t){return i.h===0&&(rl(e,t,(i=N8(i.g))===!1?void 0:i),!0)}),hK),qo=FA((function(i,e,t){if(i.h!==2)return!1;i=U8(i);const n=Ui(e);return Hf(n),BA(e,n,t,2).push(i),!0}),(function(i,e,t){if((e=kA(tp,e))!=null)for(let o=0;o<e.length;o++){var n=i,r=t,s=e[o];s!=null&&W4(n,r,Sj(s))}})),zd=il((function(i,e,t){return i.h===2&&(rl(e,t,(i=U8(i))===""?void 0:i),!0)}),fK),Wi=il((function(i,e,t){return i.h===2&&(rl(e,t,U8(i)),!0)}),fK),E3e=K4((function(i,e,t,n,r){return i.h===2&&(Mx(i,D8(e,n,t,!0),r),!0)}),$4),_3e=K4((function(i,e,t,n,r){return i.h===2&&(Mx(i,D8(e,n,t),r),!0)}),$4);Ds=new DA((function(i,e,t,n,r){if(i.h!==2)return!1;n=Km(void 0,n);let s=Ui(e);Hf(s);let o=BA(e,s,t,3);return s=Ui(e),4&xs(o)&&(o=kl(o),jr(o,-2079&(1|xs(o))),kr(e,s,t,o)),o.push(n),Mx(i,n,r),!0}),(function(i,e,t,n,r){if(Array.isArray(e))for(let s=0;s<e.length;s++)$4(i,e[s],t,n,r)}),!0);var Ji=K4((function(i,e,t,n,r,s){return i.h===2&&(Yj(e,Ui(e),s,t),Mx(i,e=D8(e,n,t),r),!0)}),$4),mK=il((function(i,e,t){return i.h===2&&(rl(e,t,iK(i)),!0)}),dK),S3e=FA((function(i,e,t){return(i.h===0||i.h===2)&&(e=BA(e,Ui(e),t,2,!1),i.h==2?Q4(i,hp,e):e.push(hp(i.g)),!0)}),(function(i,e,t){if((e=kA(qEe,e))!=null)for(let o=0;o<e.length;o++){var n=i,r=t,s=e[o];s!=null&&(Sc(n,r,0),Rx(n.g,s))}})),Iu=il((function(i,e,t){return i.h===0&&(rl(e,t,up(i.g)),!0)}),(function(i,e,t){(e=LA(e))!=null&&(e=parseInt(e,10),Sc(i,t,0),V4(i.g,e))}));class w3e{constructor(e,t){this.h=e,this.g=t,this.l=wi,this.m=Cn,this.defaultValue=void 0}}function Bu(i,e){return new w3e(i,e)}function _p(i,e){return(t,n)=>{if(k_.length){const s=k_.pop();s.o(n),WI(s.g,t,n),t=s}else t=new class{constructor(s,o){if(kO.length){const a=kO.pop();WI(a,s,o),s=a}else s=new class{constructor(a,l){this.h=null,this.m=!1,this.g=this.l=this.j=0,WI(this,a,l)}clear(){this.h=null,this.m=!1,this.g=this.l=this.j=0,this.ea=!1}}(s,o);this.g=s,this.l=this.g.g,this.h=this.m=-1,this.o(o)}o({ja:s=!1}={}){this.ja=s}}(t,n);try{const s=new i,o=s.u;H8(e)(o,t);var r=s}finally{t.g.clear(),t.m=-1,t.h=-1,k_.length<100&&k_.push(t)}return r}}function X4(i){return function(){U4(this);const e=new class{constructor(){this.l=[],this.h=0,this.g=new class{constructor(){this.g=[]}length(){return this.g.length}end(){const o=this.g;return this.g=[],o}}}};lK(this.u,e,j4(i)),fA(e,e.g.end());const t=new Uint8Array(e.h),n=e.l,r=n.length;let s=0;for(let o=0;o<r;o++){const a=n[o];t.set(a,s),s+=a.length}return e.l=[t],t}}var QO=class extends an{constructor(i){super(i)}},VO=[0,zd,il((function(i,e,t){return i.h===2&&(rl(e,t,(i=iK(i))===a0()?void 0:i),!0)}),(function(i,e,t){if(e!=null){if(e instanceof an){const n=e.Ta;return void(n&&(e=n(e),e!=null&&W4(i,t,F8(e).buffer)))}if(Array.isArray(e))return}dK(i,e,t)}))],gK=[0,ss,Iu,Vr,-1,Y4,Iu,-1],C3e=class extends an{constructor(){super()}},AK=[0,Vr,Wi,Vr,Iu,-1,FA((function(i,e,t){return(i.h===0||i.h===2)&&(e=BA(e,Ui(e),t,2,!1),i.h==2?Q4(i,c3e,e):e.push(up(i.g)),!0)}),(function(i,e,t){if((e=kA(LA,e))!=null&&e.length){t=z8(i,t);for(let n=0;n<e.length;n++)V4(i.g,e[n]);G8(i,t)}})),Wi,-1,[0,Vr,-1],Iu,Vr,-1],yK=[0,Wi,-2],WO=class extends an{constructor(){super()}},vK=[0],xK=[0,ss,Vr,1,Vr,-3],T3e=[0,Wi,Vr,-1,ss,[0,[1,2,3,4,5,6,7],Ji,vK,Ji,AK,Ji,yK,Ji,xK,Ji,gK,Ji,[0,Wi,-2],Ji,[0,Wi,Iu]],[0,Wi],Vr,[0,[1,3],[2,4],Ji,[0,Y4],-1,Ji,[0,qo],-1,Ds,[0,Wi,-1]],Wi],Fl=class extends an{constructor(i){super(i,2)}},Ir={},to=Ir.P={};Ir[336783863]=T3e,to[336783863]=1;var jO=[0,jI,-1,p2,-3,jI,Y4,zd,D1,jI,-1,p2,D1,p2,-2,zd];function Ol(i,e){q5(i,2,PA(e),"")}function yr(i,e){H4(i,3,e)}function mi(i,e){H4(i,4,e)}var wa=class extends an{constructor(i){super(i,500)}o(i){return Cn(this,0,7,i)}},m2=[-1,{P:{}}],KO=[0,Wi,1,m2],$O=[0,Wi,qo,m2];function Nl(i,e){ow(i,1,wa,e)}function Mr(i,e){H4(i,10,e)}function Ii(i,e){H4(i,15,e)}var sl=class extends an{constructor(i){super(i,500)}o(i){return Cn(this,0,1001,i)}},EK=[-500,Ds,[-500,zd,-1,qo,-3,[-2,Ir,Vr],Ds,VO,D1,-1,KO,$O,Ds,[0,zd,p2],zd,jO,D1,qo,987,qo],4,Ds,[-500,Wi,-1,[-1,{P:{}}],998,Wi],Ds,[-500,Wi,qo,-1,[-2,{P:{}},Vr],997,qo,-1],D1,Ds,[-500,Wi,qo,m2,998,qo],qo,D1,KO,$O,Ds,[0,zd,-1,m2],qo,-2,jO,zd,-1,p2,979,m2,Ds,VO];sl.prototype.g=X4(EK);var b3e=_p(sl,EK),I3e=class extends an{constructor(i){super(i)}},_K=class extends an{constructor(i){super(i)}g(){return Gf(this,I3e,1)}},SK=[0,Ds,[0,ss,ro,Wi,-1]],q4=_p(_K,SK),M3e=class extends an{constructor(i){super(i)}},R3e=class extends an{constructor(i){super(i)}},KI=class extends an{constructor(i){super(i)}h(){return wi(this,M3e,2)}g(){return Gf(this,R3e,5)}},wK=_p(class extends an{constructor(i){super(i)}},[0,qo,Y4,V8,[0,Iu,[0,ss,-3],[0,ro,-3],[0,ss,-1,[0,Ds,[0,ss,-2]]],Ds,[0,ro,-1,Wi,ro]],Wi,-1,fp,Ds,[0,ss,ro],qo,fp]),CK=class extends an{constructor(i){super(i)}},Y1=_p(class extends an{constructor(i){super(i)}},[0,Ds,[0,ro,-4]]),TK=class extends an{constructor(i){super(i)}},Lx=_p(class extends an{constructor(i){super(i)}},[0,Ds,[0,ro,-4]]),L3e=class extends an{constructor(i){super(i)}},P3e=[0,ss,-1,V8,Iu],bK=class extends an{constructor(){super()}};bK.prototype.g=X4([0,ro,-4,fp]);var B3e=class extends an{constructor(i){super(i)}},D3e=_p(class extends an{constructor(i){super(i)}},[0,Ds,[0,1,ss,Wi,SK],fp]),YO=class extends an{constructor(i){super(i)}},k3e=class extends an{constructor(i){super(i)}ra(){const i=Wj(this);return i??a0()}},F3e=class extends an{constructor(i){super(i)}},IK=[1,2],O3e=_p(class extends an{constructor(i){super(i)}},[0,Ds,[0,IK,Ji,[0,V8],Ji,[0,mK],ss,Wi],fp]),W8=class extends an{constructor(i){super(i)}},MK=[0,Wi,ss,ro,qo,-1],XO=class extends an{constructor(i){super(i)}},N3e=[0,Vr,-1],qO=class extends an{constructor(i){super(i)}},fS=[1,2,3,4,5],cw=class extends an{constructor(i){super(i)}g(){return Wj(this)!=null}h(){return tp(cp(this,2))!=null}},Fr=class extends an{constructor(i){super(i)}g(){return Fj(cp(this,2))??!1}},RK=[0,mK,Wi,[0,ss,fp,-1],[0,x3e,fp]],Es=[0,RK,Vr,[0,fS,Ji,xK,Ji,AK,Ji,gK,Ji,vK,Ji,yK],Iu],J4=class extends an{constructor(i){super(i)}},j8=[0,Es,ro,-1,ss],U3e=Bu(502141897,J4);Ir[502141897]=j8,to[502141897]=1;var LK=[0,RK];Ir[512499200]=LK;var PK=[0,LK];Ir[515723506]=PK;var z3e=_p(class extends an{constructor(i){super(i)}},[0,[0,Iu,-1,v3e,S3e],P3e]),BK=[0,Es];Ir[508981768]=BK;var DK=class extends an{constructor(i){super(i)}},kK=class extends an{constructor(i){super(i)}},K8=[0,Es,ro,BK,Vr],FK=[0,Es,j8,K8,ro,PK];Ir[508968149]=K8;var G3e=Bu(508968150,kK);Ir[508968150]=FK,to[508968150]=1,to[508968149]=1;var OK=class extends an{constructor(i){super(i)}},H3e=Bu(513916220,OK);Ir[513916220]=[0,Es,FK,ss],to[513916220]=1;var g1=class extends an{constructor(i){super(i)}h(){return wi(this,W8,2)}g(){Ar(this,2)}},NK=[0,Es,MK];Ir[478825465]=NK,to[478825465]=1;var UK=[0,Es];Ir[478825422]=UK;var Q3e=class extends an{constructor(i){super(i)}},zK=class extends an{constructor(i){super(i)}},$8=class extends an{constructor(i){super(i)}},Y8=class extends an{constructor(i){super(i)}},GK=class extends an{constructor(i){super(i)}},HK=[0,Es,UK,NK,-1],QK=[0,Es,ro,ss],X8=[0,Es,ro],VK=[0,Es,QK,X8,ro],V3e=[0,Es,VK,HK];Ir[463370452]=HK,Ir[464864288]=QK,Ir[474472470]=X8;var W3e=Bu(462713202,Y8);Ir[462713202]=VK;var j3e=Bu(479097054,GK);Ir[479097054]=V3e,to[479097054]=1,to[463370452]=1,to[464864288]=1,to[462713202]=1,to[474472470]=1;var K3e=class extends an{constructor(i){super(i)}},WK=class extends an{constructor(i){super(i)}},jK=class extends an{constructor(i){super(i)}},KK=class extends an{constructor(){super()}},r6=[0,Es,ro,-1,ss],s6=[0,Es,ro,Vr];KK.prototype.g=X4([0,Es,X8,[0,Es],j8,K8,r6,s6]),Ir[514774813]=r6,Ir[518928384]=s6;var $K=class extends an{constructor(i){super(i)}},$3e=Bu(456383383,$K);Ir[456383383]=[0,Es,MK],to[456383383]=1;var YK=class extends an{constructor(i){super(i)}},Y3e=Bu(476348187,YK);Ir[476348187]=[0,Es,N3e],to[476348187]=1;var XK=class extends an{constructor(i){super(i)}},JO=class extends an{constructor(i){super(i)}},qK=[0,Iu,-1],X3e=Bu(458105876,class extends an{constructor(i){super(i)}g(){var i=this.u;const e=Ui(i),t=2&e;return i=(function(n,r,s){var o=JO;const a=2&r;let l=!1;if(s==null){if(a)return BO();s=[]}else if(s.constructor===yc){if((2&s.M)==0||a)return s;s=s.Z()}else Array.isArray(s)?l=!!(2&xs(s)):s=[];if(a){if(!s.length)return BO();l||(l=!0,RA(s))}else l&&(l=!1,s=$j(s));return l||(64&xs(s)?ZS(s,32):32&r&&B4(s,32)),kr(n,r,2,o=new yc(s,o,ZEe,void 0)),o})(i,e,bh(i,e,2)),!t&&JO&&(i.va=!0),i}});Ir[458105876]=[0,qK,y3e,[!0,fp,[0,Wi,-1,qo]]],to[458105876]=1;var q8=class extends an{constructor(i){super(i)}},JK=Bu(458105758,q8);Ir[458105758]=[0,Es,Wi,qK],to[458105758]=1;var ZK=class extends an{constructor(i){super(i)}},q3e=Bu(443442058,ZK);Ir[443442058]=[0,Es,Wi,ss,ro,qo,-1],to[443442058]=1,to[514774813]=1;var e$=class extends an{constructor(i){super(i)}},J3e=Bu(516587230,e$);function o6(i,e){return e=e?e.clone():new W8,i.displayNamesLocale!==void 0?Ar(e,1,PA(i.displayNamesLocale)):i.displayNamesLocale===void 0&&Ar(e,1),i.maxResults!==void 0?wh(e,2,i.maxResults):"maxResults"in i&&Ar(e,2),i.scoreThreshold!==void 0?hn(e,3,i.scoreThreshold):"scoreThreshold"in i&&Ar(e,3),i.categoryAllowlist!==void 0?aw(e,4,i.categoryAllowlist):"categoryAllowlist"in i&&Ar(e,4),i.categoryDenylist!==void 0?aw(e,5,i.categoryDenylist):"categoryDenylist"in i&&Ar(e,5),e}function J8(i,e=-1,t=""){return{categories:i.map((n=>({index:bu(mc(n,1),0)??-1,score:ms(n,2)??0,categoryName:Sh(n,3)??"",displayName:Sh(n,4)??""}))),headIndex:e,headName:t}}function t$(i){var o,a;var e=Om(i,3,Ep,Fm()),t=Om(i,2,LA,Fm()),n=Om(i,1,tp,Fm()),r=Om(i,9,tp,Fm());const s={categories:[],keypoints:[]};for(let l=0;l<e.length;l++)s.categories.push({score:e[l],index:t[l]??-1,categoryName:n[l]??"",displayName:r[l]??""});if((e=(o=wi(i,KI,4))==null?void 0:o.h())&&(s.boundingBox={originX:mc(e,1)??0,originY:mc(e,2)??0,width:mc(e,3)??0,height:mc(e,4)??0,angle:0}),(a=wi(i,KI,4))==null?void 0:a.g().length)for(const l of wi(i,KI,4).g())s.keypoints.push({x:uS(l,1)??0,y:uS(l,2)??0,score:uS(l,4)??0,label:tp(cp(l,3))??""});return s}function Z4(i){const e=[];for(const t of Gf(i,TK,1))e.push({x:ms(t,1)??0,y:ms(t,2)??0,z:ms(t,3)??0,visibility:ms(t,4)??0});return e}function g2(i){const e=[];for(const t of Gf(i,CK,1))e.push({x:ms(t,1)??0,y:ms(t,2)??0,z:ms(t,3)??0,visibility:ms(t,4)??0});return e}function ZO(i){return Array.from(i,(e=>e>127?e-256:e))}function eN(i,e){if(i.length!==e.length)throw Error(`Cannot compute cosine similarity between embeddings of different sizes (${i.length} vs. ${e.length}).`);let t=0,n=0,r=0;for(let s=0;s<i.length;s++)t+=i[s]*e[s],n+=i[s]*i[s],r+=e[s]*e[s];if(n<=0||r<=0)throw Error("Cannot compute cosine similarity on embedding with 0 norm.");return t/Math.sqrt(n*r)}let F_;Ir[516587230]=[0,Es,r6,s6,ro],to[516587230]=1,to[518928384]=1;const Z3e=new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11]);async function n$(){if(F_===void 0)try{await WebAssembly.instantiate(Z3e),F_=!0}catch{F_=!1}return F_}async function Bv(i,e=""){const t=await n$()?"wasm_internal":"wasm_nosimd_internal";return{wasmLoaderPath:`${e}/${i}_${t}.js`,wasmBinaryPath:`${e}/${i}_${t}.wasm`}}var Cm=class{};function i$(){var i=navigator;return typeof OffscreenCanvas<"u"&&(!(function(e=navigator){return(e=e.userAgent).includes("Safari")&&!e.includes("Chrome")})(i)||!!((i=i.userAgent.match(/Version\/([\d]+).*Safari/))&&i.length>=1&&Number(i[1])>=17))}async function tN(i){if(typeof importScripts!="function"){const e=document.createElement("script");return e.src=i.toString(),e.crossOrigin="anonymous",new Promise(((t,n)=>{e.addEventListener("load",(()=>{t()}),!1),e.addEventListener("error",(r=>{n(r)}),!1),document.body.appendChild(e)}))}importScripts(i.toString())}function r$(i){return i.videoWidth!==void 0?[i.videoWidth,i.videoHeight]:i.naturalWidth!==void 0?[i.naturalWidth,i.naturalHeight]:i.displayWidth!==void 0?[i.displayWidth,i.displayHeight]:[i.width,i.height]}function gn(i,e,t){i.m||console.error("No wasm multistream support detected: ensure dependency inclusion of :gl_graph_runner_internal_multi_input target"),t(e=i.i.stringToNewUTF8(e)),i.i._free(e)}function nN(i,e,t){if(!i.i.canvas)throw Error("No OpenGL canvas configured.");if(t?i.i._bindTextureToStream(t):i.i._bindTextureToCanvas(),!(t=i.i.canvas.getContext("webgl2")||i.i.canvas.getContext("webgl")))throw Error("Failed to obtain WebGL context from the provided canvas. `getContext()` should only be invoked with `webgl` or `webgl2`.");i.i.gpuOriginForWebTexturesIsBottomLeft&&t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!0),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e),i.i.gpuOriginForWebTexturesIsBottomLeft&&t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!1);const[n,r]=r$(e);return!i.l||n===i.i.canvas.width&&r===i.i.canvas.height||(i.i.canvas.width=n,i.i.canvas.height=r),[n,r]}function iN(i,e,t){i.m||console.error("No wasm multistream support detected: ensure dependency inclusion of :gl_graph_runner_internal_multi_input target");const n=new Uint32Array(e.length);for(let r=0;r<e.length;r++)n[r]=i.i.stringToNewUTF8(e[r]);e=i.i._malloc(4*n.length),i.i.HEAPU32.set(n,e>>2),t(e);for(const r of n)i.i._free(r);i.i._free(e)}function oh(i,e,t){i.i.simpleListeners=i.i.simpleListeners||{},i.i.simpleListeners[e]=t}function Bd(i,e,t){let n=[];i.i.simpleListeners=i.i.simpleListeners||{},i.i.simpleListeners[e]=(r,s,o)=>{s?(t(n,o),n=[]):n.push(r)}}Cm.forVisionTasks=function(i){return Bv("vision",i)},Cm.forTextTasks=function(i){return Bv("text",i)},Cm.forGenAiExperimentalTasks=function(i){return Bv("genai_experimental",i)},Cm.forGenAiTasks=function(i){return Bv("genai",i)},Cm.forAudioTasks=function(i){return Bv("audio",i)},Cm.isSimdSupported=function(){return n$()};async function e_e(i,e,t,n){return i=await(async(r,s,o,a,l)=>{if(s&&await tN(s),!self.ModuleFactory||o&&(await tN(o),!self.ModuleFactory))throw Error("ModuleFactory not set.");return self.Module&&l&&((s=self.Module).locateFile=l.locateFile,l.mainScriptUrlOrBlob&&(s.mainScriptUrlOrBlob=l.mainScriptUrlOrBlob)),l=await self.ModuleFactory(self.Module||l),self.ModuleFactory=self.Module=void 0,new r(l,a)})(i,t.wasmLoaderPath,t.assetLoaderPath,e,{locateFile:r=>r.endsWith(".wasm")?t.wasmBinaryPath.toString():t.assetBinaryPath&&r.endsWith(".data")?t.assetBinaryPath.toString():r}),await i.o(n),i}function $I(i,e){const t=wi(i.baseOptions,cw,1)||new cw;typeof e=="string"?(Ar(t,2,PA(e)),Ar(t,1)):e instanceof Uint8Array&&(Ar(t,1,x8(e,!1,!1)),Ar(t,2)),Cn(i.baseOptions,0,1,t)}function rN(i){try{const e=i.H.length;if(e===1)throw Error(i.H[0].message);if(e>1)throw Error("Encountered multiple errors: "+i.H.map((t=>t.message)).join(", "))}finally{i.H=[]}}function en(i,e){i.B=Math.max(i.B,e)}function eC(i,e){i.A=new wa,Ol(i.A,"PassThroughCalculator"),yr(i.A,"free_memory"),mi(i.A,"free_memory_unused_out"),Mr(e,"free_memory"),Nl(e,i.A)}function dA(i,e){yr(i.A,e),mi(i.A,e+"_unused_out")}function tC(i){i.g.addBoolToStream(!0,"free_memory",i.B)}var dS=class{constructor(i){this.g=i,this.H=[],this.B=0,this.g.setAutoRenderToScreen(!1)}l(i,e=!0){var t,n,r,s,o,a;if(e){const l=i.baseOptions||{};if((t=i.baseOptions)!=null&&t.modelAssetBuffer&&((n=i.baseOptions)!=null&&n.modelAssetPath))throw Error("Cannot set both baseOptions.modelAssetPath and baseOptions.modelAssetBuffer");if(!((r=wi(this.baseOptions,cw,1))!=null&&r.g()||(s=wi(this.baseOptions,cw,1))!=null&&s.h()||(o=i.baseOptions)!=null&&o.modelAssetBuffer||(a=i.baseOptions)!=null&&a.modelAssetPath))throw Error("Either baseOptions.modelAssetPath or baseOptions.modelAssetBuffer must be set");if((function(c,u){let h=wi(c.baseOptions,qO,3);if(!h){var f=h=new qO,d=new WO;d2(f,4,fS,d)}"delegate"in u&&(u.delegate==="GPU"?(u=h,f=new C3e,d2(u,2,fS,f)):(u=h,f=new WO,d2(u,4,fS,f))),Cn(c.baseOptions,0,3,h)})(this,l),l.modelAssetPath)return fetch(l.modelAssetPath.toString()).then((c=>{if(c.ok)return c.arrayBuffer();throw Error(`Failed to fetch model: ${l.modelAssetPath} (${c.status})`)})).then((c=>{try{this.g.i.FS_unlink("/model.dat")}catch{}this.g.i.FS_createDataFile("/","model.dat",new Uint8Array(c),!0,!1,!1),$I(this,"/model.dat"),this.m(),this.J()}));if(l.modelAssetBuffer instanceof Uint8Array)$I(this,l.modelAssetBuffer);else if(l.modelAssetBuffer)return(async function(c){const u=[];for(var h=0;;){const{done:f,value:d}=await c.read();if(f)break;u.push(d),h+=d.length}if(u.length===0)return new Uint8Array(0);if(u.length===1)return u[0];c=new Uint8Array(h),h=0;for(const f of u)c.set(f,h),h+=f.length;return c})(l.modelAssetBuffer).then((c=>{$I(this,c),this.m(),this.J()}))}return this.m(),this.J(),Promise.resolve()}J(){}ga(){let i;if(this.g.ga((e=>{i=b3e(e)})),!i)throw Error("Failed to retrieve CalculatorGraphConfig");return i}setGraph(i,e){this.g.attachErrorListener(((t,n)=>{this.H.push(Error(n))})),this.g.Oa(),this.g.setGraph(i,e),this.A=void 0,rN(this)}finishProcessing(){this.g.finishProcessing(),rN(this)}close(){this.A=void 0,this.g.closeGraph()}};function Ff(i,e){if(!i)throw Error(`Unable to obtain required WebGL resource: ${e}`);return i}dS.prototype.close=dS.prototype.close,(function(i,e){i=i.split(".");var t,n=o0;for((i[0]in n)||n.execScript===void 0||n.execScript("var "+i[0]);i.length&&(t=i.shift());)i.length||e===void 0?n=n[t]&&n[t]!==Object.prototype[t]?n[t]:n[t]={}:n[t]=e})("TaskRunner",dS);class t_e{constructor(e,t,n,r){this.g=e,this.h=t,this.m=n,this.l=r}bind(){this.g.bindVertexArray(this.h)}close(){this.g.deleteVertexArray(this.h),this.g.deleteBuffer(this.m),this.g.deleteBuffer(this.l)}}function sN(i,e,t){const n=i.g;if(t=Ff(n.createShader(t),"Failed to create WebGL shader"),n.shaderSource(t,e),n.compileShader(t),!n.getShaderParameter(t,n.COMPILE_STATUS))throw Error(`Could not compile WebGL shader: ${n.getShaderInfoLog(t)}`);return n.attachShader(i.h,t),t}function oN(i,e){const t=i.g,n=Ff(t.createVertexArray(),"Failed to create vertex array");t.bindVertexArray(n);const r=Ff(t.createBuffer(),"Failed to create buffer");t.bindBuffer(t.ARRAY_BUFFER,r),t.enableVertexAttribArray(i.R),t.vertexAttribPointer(i.R,2,t.FLOAT,!1,0,0),t.bufferData(t.ARRAY_BUFFER,new Float32Array([-1,-1,-1,1,1,1,1,-1]),t.STATIC_DRAW);const s=Ff(t.createBuffer(),"Failed to create buffer");return t.bindBuffer(t.ARRAY_BUFFER,s),t.enableVertexAttribArray(i.J),t.vertexAttribPointer(i.J,2,t.FLOAT,!1,0,0),t.bufferData(t.ARRAY_BUFFER,new Float32Array(e?[0,1,0,0,1,0,1,1]:[0,0,0,1,1,1,1,0]),t.STATIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,null),t.bindVertexArray(null),new t_e(t,n,r,s)}function Z8(i,e){if(i.g){if(e!==i.g)throw Error("Cannot change GL context once initialized")}else i.g=e}function eL(i,e,t,n){return Z8(i,e),i.h||(i.m(),i.C()),t?(i.s||(i.s=oN(i,!0)),t=i.s):(i.v||(i.v=oN(i,!1)),t=i.v),e.useProgram(i.h),t.bind(),i.l(),i=n(),t.g.bindVertexArray(null),i}function nC(i,e,t){return Z8(i,e),i=Ff(e.createTexture(),"Failed to create texture"),e.bindTexture(e.TEXTURE_2D,i),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,t??e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,t??e.LINEAR),e.bindTexture(e.TEXTURE_2D,null),i}function iC(i,e,t){Z8(i,e),i.A||(i.A=Ff(e.createFramebuffer(),"Failed to create framebuffe.")),e.bindFramebuffer(e.FRAMEBUFFER,i.A),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0)}function tL(i){var e;(e=i.g)==null||e.bindFramebuffer(i.g.FRAMEBUFFER,null)}var nL=class{H(){return`
  precision mediump float;
  varying vec2 vTex;
  uniform sampler2D inputTexture;
  void main() {
    gl_FragColor = texture2D(inputTexture, vTex);
  }
 `}m(){const i=this.g;if(this.h=Ff(i.createProgram(),"Failed to create WebGL program"),this.da=sN(this,`
  attribute vec2 aVertex;
  attribute vec2 aTex;
  varying vec2 vTex;
  void main(void) {
    gl_Position = vec4(aVertex, 0.0, 1.0);
    vTex = aTex;
  }`,i.VERTEX_SHADER),this.ca=sN(this,this.H(),i.FRAGMENT_SHADER),i.linkProgram(this.h),!i.getProgramParameter(this.h,i.LINK_STATUS))throw Error(`Error during program linking: ${i.getProgramInfoLog(this.h)}`);this.R=i.getAttribLocation(this.h,"aVertex"),this.J=i.getAttribLocation(this.h,"aTex")}C(){}l(){}close(){if(this.h){const i=this.g;i.deleteProgram(this.h),i.deleteShader(this.da),i.deleteShader(this.ca)}this.A&&this.g.deleteFramebuffer(this.A),this.v&&this.v.close(),this.s&&this.s.close()}};function Mf(i,e){switch(e){case 0:return i.g.find((t=>t instanceof Uint8Array));case 1:return i.g.find((t=>t instanceof Float32Array));case 2:return i.g.find((t=>typeof WebGLTexture<"u"&&t instanceof WebGLTexture));default:throw Error(`Type is not supported: ${e}`)}}function a6(i){var e=Mf(i,1);if(!e){if(e=Mf(i,0))e=new Float32Array(e).map((n=>n/255));else{e=new Float32Array(i.width*i.height);const n=pA(i);var t=iL(i);if(iC(t,n,s$(i)),"iPad Simulator;iPhone Simulator;iPod Simulator;iPad;iPhone;iPod".split(";").includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in self.document){t=new Float32Array(i.width*i.height*4),n.readPixels(0,0,i.width,i.height,n.RGBA,n.FLOAT,t);for(let r=0,s=0;r<e.length;++r,s+=4)e[r]=t[s]}else n.readPixels(0,0,i.width,i.height,n.RED,n.FLOAT,e)}i.g.push(e)}return e}function s$(i){let e=Mf(i,2);if(!e){const t=pA(i);e=a$(i);const n=a6(i),r=o$(i);t.texImage2D(t.TEXTURE_2D,0,r,i.width,i.height,0,t.RED,t.FLOAT,n),l6(i)}return e}function pA(i){if(!i.canvas)throw Error("Conversion to different image formats require that a canvas is passed when initializing the image.");return i.h||(i.h=Ff(i.canvas.getContext("webgl2"),"You cannot use a canvas that is already bound to a different type of rendering context.")),i.h}function o$(i){if(i=pA(i),!O_)if(i.getExtension("EXT_color_buffer_float")&&i.getExtension("OES_texture_float_linear")&&i.getExtension("EXT_float_blend"))O_=i.R32F;else{if(!i.getExtension("EXT_color_buffer_half_float"))throw Error("GPU does not fully support 4-channel float32 or float16 formats");O_=i.R16F}return O_}function iL(i){return i.l||(i.l=new nL),i.l}function a$(i){const e=pA(i);e.viewport(0,0,i.width,i.height),e.activeTexture(e.TEXTURE0);let t=Mf(i,2);return t||(t=nC(iL(i),e,i.m?e.LINEAR:e.NEAREST),i.g.push(t),i.j=!0),e.bindTexture(e.TEXTURE_2D,t),t}function l6(i){i.h.bindTexture(i.h.TEXTURE_2D,null)}var O_,Xs=class{constructor(i,e,t,n,r,s,o){this.g=i,this.m=e,this.j=t,this.canvas=n,this.l=r,this.width=s,this.height=o,this.j&&--aN===0&&console.error("You seem to be creating MPMask instances without invoking .close(). This leaks resources.")}Ja(){return!!Mf(this,0)}ma(){return!!Mf(this,1)}S(){return!!Mf(this,2)}la(){return(e=Mf(i=this,0))||(e=a6(i),e=new Uint8Array(e.map((t=>255*t))),i.g.push(e)),e;var i,e}ka(){return a6(this)}N(){return s$(this)}clone(){const i=[];for(const e of this.g){let t;if(e instanceof Uint8Array)t=new Uint8Array(e);else if(e instanceof Float32Array)t=new Float32Array(e);else{if(!(e instanceof WebGLTexture))throw Error(`Type is not supported: ${e}`);{const n=pA(this),r=iL(this);n.activeTexture(n.TEXTURE1),t=nC(r,n,this.m?n.LINEAR:n.NEAREST),n.bindTexture(n.TEXTURE_2D,t);const s=o$(this);n.texImage2D(n.TEXTURE_2D,0,s,this.width,this.height,0,n.RED,n.FLOAT,null),n.bindTexture(n.TEXTURE_2D,null),iC(r,n,t),eL(r,n,!1,(()=>{a$(this),n.clearColor(0,0,0,0),n.clear(n.COLOR_BUFFER_BIT),n.drawArrays(n.TRIANGLE_FAN,0,4),l6(this)})),tL(r),l6(this)}}i.push(t)}return new Xs(i,this.m,this.S(),this.canvas,this.l,this.width,this.height)}close(){this.j&&pA(this).deleteTexture(Mf(this,2)),aN=-1}};Xs.prototype.close=Xs.prototype.close,Xs.prototype.clone=Xs.prototype.clone,Xs.prototype.getAsWebGLTexture=Xs.prototype.N,Xs.prototype.getAsFloat32Array=Xs.prototype.ka,Xs.prototype.getAsUint8Array=Xs.prototype.la,Xs.prototype.hasWebGLTexture=Xs.prototype.S,Xs.prototype.hasFloat32Array=Xs.prototype.ma,Xs.prototype.hasUint8Array=Xs.prototype.Ja;var aN=250;function ph(i,e){switch(e){case 0:return i.g.find((t=>t instanceof ImageData));case 1:return i.g.find((t=>typeof ImageBitmap<"u"&&t instanceof ImageBitmap));case 2:return i.g.find((t=>typeof WebGLTexture<"u"&&t instanceof WebGLTexture));default:throw Error(`Type is not supported: ${e}`)}}function l$(i){var e=ph(i,0);if(!e){e=mA(i);const t=rC(i),n=new Uint8Array(i.width*i.height*4);iC(t,e,pS(i)),e.readPixels(0,0,i.width,i.height,e.RGBA,e.UNSIGNED_BYTE,n),tL(t),e=new ImageData(new Uint8ClampedArray(n.buffer),i.width,i.height),i.g.push(e)}return e}function pS(i){let e=ph(i,2);if(!e){const t=mA(i);e=mS(i);const n=ph(i,1)||l$(i);t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,n),Qv(i)}return e}function mA(i){if(!i.canvas)throw Error("Conversion to different image formats require that a canvas is passed when iniitializing the image.");return i.h||(i.h=Ff(i.canvas.getContext("webgl2"),"You cannot use a canvas that is already bound to a different type of rendering context.")),i.h}function rC(i){return i.l||(i.l=new nL),i.l}function mS(i){const e=mA(i);e.viewport(0,0,i.width,i.height),e.activeTexture(e.TEXTURE0);let t=ph(i,2);return t||(t=nC(rC(i),e),i.g.push(t),i.m=!0),e.bindTexture(e.TEXTURE_2D,t),t}function Qv(i){i.h.bindTexture(i.h.TEXTURE_2D,null)}function lN(i){const e=mA(i);return eL(rC(i),e,!0,(()=>(function(t,n){const r=t.canvas;if(r.width===t.width&&r.height===t.height)return n();const s=r.width,o=r.height;return r.width=t.width,r.height=t.height,t=n(),r.width=s,r.height=o,t})(i,(()=>{if(e.bindFramebuffer(e.FRAMEBUFFER,null),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT),e.drawArrays(e.TRIANGLE_FAN,0,4),!(i.canvas instanceof OffscreenCanvas))throw Error("Conversion to ImageBitmap requires that the MediaPipe Tasks is initialized with an OffscreenCanvas");return i.canvas.transferToImageBitmap()}))))}var qs=class{constructor(i,e,t,n,r,s,o){this.g=i,this.j=e,this.m=t,this.canvas=n,this.l=r,this.width=s,this.height=o,(this.j||this.m)&&--cN===0&&console.error("You seem to be creating MPImage instances without invoking .close(). This leaks resources.")}Ia(){return!!ph(this,0)}na(){return!!ph(this,1)}S(){return!!ph(this,2)}Ga(){return l$(this)}Fa(){var i=ph(this,1);return i||(pS(this),mS(this),i=lN(this),Qv(this),this.g.push(i),this.j=!0),i}N(){return pS(this)}clone(){const i=[];for(const e of this.g){let t;if(e instanceof ImageData)t=new ImageData(e.data,this.width,this.height);else if(e instanceof WebGLTexture){const n=mA(this),r=rC(this);n.activeTexture(n.TEXTURE1),t=nC(r,n),n.bindTexture(n.TEXTURE_2D,t),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,this.width,this.height,0,n.RGBA,n.UNSIGNED_BYTE,null),n.bindTexture(n.TEXTURE_2D,null),iC(r,n,t),eL(r,n,!1,(()=>{mS(this),n.clearColor(0,0,0,0),n.clear(n.COLOR_BUFFER_BIT),n.drawArrays(n.TRIANGLE_FAN,0,4),Qv(this)})),tL(r),Qv(this)}else{if(!(e instanceof ImageBitmap))throw Error(`Type is not supported: ${e}`);pS(this),mS(this),t=lN(this),Qv(this)}i.push(t)}return new qs(i,this.na(),this.S(),this.canvas,this.l,this.width,this.height)}close(){this.j&&ph(this,1).close(),this.m&&mA(this).deleteTexture(ph(this,2)),cN=-1}};qs.prototype.close=qs.prototype.close,qs.prototype.clone=qs.prototype.clone,qs.prototype.getAsWebGLTexture=qs.prototype.N,qs.prototype.getAsImageBitmap=qs.prototype.Fa,qs.prototype.getAsImageData=qs.prototype.Ga,qs.prototype.hasWebGLTexture=qs.prototype.S,qs.prototype.hasImageBitmap=qs.prototype.na,qs.prototype.hasImageData=qs.prototype.Ia;var cN=250;function Du(...i){return i.map((([e,t])=>({start:e,end:t})))}const n_e=(function(i){return class extends i{Oa(){this.i._registerModelResourcesGraphService()}}})((uN=class{constructor(i,e){this.l=!0,this.i=i,this.g=null,this.h=0,this.m=typeof this.i._addIntToInputStream=="function",e!==void 0?this.i.canvas=e:i$()?this.i.canvas=new OffscreenCanvas(1,1):(console.warn("OffscreenCanvas not supported and GraphRunner constructor glCanvas parameter is undefined. Creating backup canvas."),this.i.canvas=document.createElement("canvas"))}async initializeGraph(i){const e=await(await fetch(i)).arrayBuffer();i=!(i.endsWith(".pbtxt")||i.endsWith(".textproto")),this.setGraph(new Uint8Array(e),i)}setGraphFromString(i){this.setGraph(new TextEncoder().encode(i),!1)}setGraph(i,e){const t=i.length,n=this.i._malloc(t);this.i.HEAPU8.set(i,n),e?this.i._changeBinaryGraph(t,n):this.i._changeTextGraph(t,n),this.i._free(n)}configureAudio(i,e,t,n,r){this.i._configureAudio||console.warn('Attempting to use configureAudio without support for input audio. Is build dep ":gl_graph_runner_audio" missing?'),gn(this,n||"input_audio",(s=>{gn(this,r=r||"audio_header",(o=>{this.i._configureAudio(s,o,i,e,t)}))}))}setAutoResizeCanvas(i){this.l=i}setAutoRenderToScreen(i){this.i._setAutoRenderToScreen(i)}setGpuBufferVerticalFlip(i){this.i.gpuOriginForWebTexturesIsBottomLeft=i}ga(i){oh(this,"__graph_config__",(e=>{i(e)})),gn(this,"__graph_config__",(e=>{this.i._getGraphConfig(e,void 0)})),delete this.i.simpleListeners.__graph_config__}attachErrorListener(i){this.i.errorListener=i}attachEmptyPacketListener(i,e){this.i.emptyPacketListeners=this.i.emptyPacketListeners||{},this.i.emptyPacketListeners[i]=e}addAudioToStream(i,e,t){this.addAudioToStreamWithShape(i,0,0,e,t)}addAudioToStreamWithShape(i,e,t,n,r){const s=4*i.length;this.h!==s&&(this.g&&this.i._free(this.g),this.g=this.i._malloc(s),this.h=s),this.i.HEAPF32.set(i,this.g/4),gn(this,n,(o=>{this.i._addAudioToInputStream(this.g,e,t,o,r)}))}addGpuBufferToStream(i,e,t){gn(this,e,(n=>{const[r,s]=nN(this,i,n);this.i._addBoundTextureToStream(n,r,s,t)}))}addBoolToStream(i,e,t){gn(this,e,(n=>{this.i._addBoolToInputStream(i,n,t)}))}addDoubleToStream(i,e,t){gn(this,e,(n=>{this.i._addDoubleToInputStream(i,n,t)}))}addFloatToStream(i,e,t){gn(this,e,(n=>{this.i._addFloatToInputStream(i,n,t)}))}addIntToStream(i,e,t){gn(this,e,(n=>{this.i._addIntToInputStream(i,n,t)}))}addUintToStream(i,e,t){gn(this,e,(n=>{this.i._addUintToInputStream(i,n,t)}))}addStringToStream(i,e,t){gn(this,e,(n=>{gn(this,i,(r=>{this.i._addStringToInputStream(r,n,t)}))}))}addStringRecordToStream(i,e,t){gn(this,e,(n=>{iN(this,Object.keys(i),(r=>{iN(this,Object.values(i),(s=>{this.i._addFlatHashMapToInputStream(r,s,Object.keys(i).length,n,t)}))}))}))}addProtoToStream(i,e,t,n){gn(this,t,(r=>{gn(this,e,(s=>{const o=this.i._malloc(i.length);this.i.HEAPU8.set(i,o),this.i._addProtoToInputStream(o,i.length,s,r,n),this.i._free(o)}))}))}addEmptyPacketToStream(i,e){gn(this,i,(t=>{this.i._addEmptyPacketToInputStream(t,e)}))}addBoolVectorToStream(i,e,t){gn(this,e,(n=>{const r=this.i._allocateBoolVector(i.length);if(!r)throw Error("Unable to allocate new bool vector on heap.");for(const s of i)this.i._addBoolVectorEntry(r,s);this.i._addBoolVectorToInputStream(r,n,t)}))}addDoubleVectorToStream(i,e,t){gn(this,e,(n=>{const r=this.i._allocateDoubleVector(i.length);if(!r)throw Error("Unable to allocate new double vector on heap.");for(const s of i)this.i._addDoubleVectorEntry(r,s);this.i._addDoubleVectorToInputStream(r,n,t)}))}addFloatVectorToStream(i,e,t){gn(this,e,(n=>{const r=this.i._allocateFloatVector(i.length);if(!r)throw Error("Unable to allocate new float vector on heap.");for(const s of i)this.i._addFloatVectorEntry(r,s);this.i._addFloatVectorToInputStream(r,n,t)}))}addIntVectorToStream(i,e,t){gn(this,e,(n=>{const r=this.i._allocateIntVector(i.length);if(!r)throw Error("Unable to allocate new int vector on heap.");for(const s of i)this.i._addIntVectorEntry(r,s);this.i._addIntVectorToInputStream(r,n,t)}))}addUintVectorToStream(i,e,t){gn(this,e,(n=>{const r=this.i._allocateUintVector(i.length);if(!r)throw Error("Unable to allocate new unsigned int vector on heap.");for(const s of i)this.i._addUintVectorEntry(r,s);this.i._addUintVectorToInputStream(r,n,t)}))}addStringVectorToStream(i,e,t){gn(this,e,(n=>{const r=this.i._allocateStringVector(i.length);if(!r)throw Error("Unable to allocate new string vector on heap.");for(const s of i)gn(this,s,(o=>{this.i._addStringVectorEntry(r,o)}));this.i._addStringVectorToInputStream(r,n,t)}))}addBoolToInputSidePacket(i,e){gn(this,e,(t=>{this.i._addBoolToInputSidePacket(i,t)}))}addDoubleToInputSidePacket(i,e){gn(this,e,(t=>{this.i._addDoubleToInputSidePacket(i,t)}))}addFloatToInputSidePacket(i,e){gn(this,e,(t=>{this.i._addFloatToInputSidePacket(i,t)}))}addIntToInputSidePacket(i,e){gn(this,e,(t=>{this.i._addIntToInputSidePacket(i,t)}))}addUintToInputSidePacket(i,e){gn(this,e,(t=>{this.i._addUintToInputSidePacket(i,t)}))}addStringToInputSidePacket(i,e){gn(this,e,(t=>{gn(this,i,(n=>{this.i._addStringToInputSidePacket(n,t)}))}))}addProtoToInputSidePacket(i,e,t){gn(this,t,(n=>{gn(this,e,(r=>{const s=this.i._malloc(i.length);this.i.HEAPU8.set(i,s),this.i._addProtoToInputSidePacket(s,i.length,r,n),this.i._free(s)}))}))}addBoolVectorToInputSidePacket(i,e){gn(this,e,(t=>{const n=this.i._allocateBoolVector(i.length);if(!n)throw Error("Unable to allocate new bool vector on heap.");for(const r of i)this.i._addBoolVectorEntry(n,r);this.i._addBoolVectorToInputSidePacket(n,t)}))}addDoubleVectorToInputSidePacket(i,e){gn(this,e,(t=>{const n=this.i._allocateDoubleVector(i.length);if(!n)throw Error("Unable to allocate new double vector on heap.");for(const r of i)this.i._addDoubleVectorEntry(n,r);this.i._addDoubleVectorToInputSidePacket(n,t)}))}addFloatVectorToInputSidePacket(i,e){gn(this,e,(t=>{const n=this.i._allocateFloatVector(i.length);if(!n)throw Error("Unable to allocate new float vector on heap.");for(const r of i)this.i._addFloatVectorEntry(n,r);this.i._addFloatVectorToInputSidePacket(n,t)}))}addIntVectorToInputSidePacket(i,e){gn(this,e,(t=>{const n=this.i._allocateIntVector(i.length);if(!n)throw Error("Unable to allocate new int vector on heap.");for(const r of i)this.i._addIntVectorEntry(n,r);this.i._addIntVectorToInputSidePacket(n,t)}))}addUintVectorToInputSidePacket(i,e){gn(this,e,(t=>{const n=this.i._allocateUintVector(i.length);if(!n)throw Error("Unable to allocate new unsigned int vector on heap.");for(const r of i)this.i._addUintVectorEntry(n,r);this.i._addUintVectorToInputSidePacket(n,t)}))}addStringVectorToInputSidePacket(i,e){gn(this,e,(t=>{const n=this.i._allocateStringVector(i.length);if(!n)throw Error("Unable to allocate new string vector on heap.");for(const r of i)gn(this,r,(s=>{this.i._addStringVectorEntry(n,s)}));this.i._addStringVectorToInputSidePacket(n,t)}))}attachBoolListener(i,e){oh(this,i,e),gn(this,i,(t=>{this.i._attachBoolListener(t)}))}attachBoolVectorListener(i,e){Bd(this,i,e),gn(this,i,(t=>{this.i._attachBoolVectorListener(t)}))}attachIntListener(i,e){oh(this,i,e),gn(this,i,(t=>{this.i._attachIntListener(t)}))}attachIntVectorListener(i,e){Bd(this,i,e),gn(this,i,(t=>{this.i._attachIntVectorListener(t)}))}attachUintListener(i,e){oh(this,i,e),gn(this,i,(t=>{this.i._attachUintListener(t)}))}attachUintVectorListener(i,e){Bd(this,i,e),gn(this,i,(t=>{this.i._attachUintVectorListener(t)}))}attachDoubleListener(i,e){oh(this,i,e),gn(this,i,(t=>{this.i._attachDoubleListener(t)}))}attachDoubleVectorListener(i,e){Bd(this,i,e),gn(this,i,(t=>{this.i._attachDoubleVectorListener(t)}))}attachFloatListener(i,e){oh(this,i,e),gn(this,i,(t=>{this.i._attachFloatListener(t)}))}attachFloatVectorListener(i,e){Bd(this,i,e),gn(this,i,(t=>{this.i._attachFloatVectorListener(t)}))}attachStringListener(i,e){oh(this,i,e),gn(this,i,(t=>{this.i._attachStringListener(t)}))}attachStringVectorListener(i,e){Bd(this,i,e),gn(this,i,(t=>{this.i._attachStringVectorListener(t)}))}attachProtoListener(i,e,t){oh(this,i,e),gn(this,i,(n=>{this.i._attachProtoListener(n,t||!1)}))}attachProtoVectorListener(i,e,t){Bd(this,i,e),gn(this,i,(n=>{this.i._attachProtoVectorListener(n,t||!1)}))}attachAudioListener(i,e,t){this.i._attachAudioListener||console.warn('Attempting to use attachAudioListener without support for output audio. Is build dep ":gl_graph_runner_audio_out" missing?'),oh(this,i,((n,r)=>{n=new Float32Array(n.buffer,n.byteOffset,n.length/4),e(n,r)})),gn(this,i,(n=>{this.i._attachAudioListener(n,t||!1)}))}finishProcessing(){this.i._waitUntilIdle()}closeGraph(){this.i._closeGraph(),this.i.simpleListeners=void 0,this.i.emptyPacketListeners=void 0}},class extends uN{get ia(){return this.i}ta(i,e,t){gn(this,e,(n=>{const[r,s]=nN(this,i,n);this.ia._addBoundTextureAsImageToStream(n,r,s,t)}))}W(i,e){oh(this,i,e),gn(this,i,(t=>{this.ia._attachImageListener(t)}))}fa(i,e){Bd(this,i,e),gn(this,i,(t=>{this.ia._attachImageVectorListener(t)}))}}));var uN,wc=class extends n_e{};async function di(i,e,t){return(async function(n,r,s,o){return e_e(n,r,s,o)})(i,t.canvas??(i$()?void 0:document.createElement("canvas")),e,t)}function c$(i,e,t,n){if(i.V){const s=new bK;if(t!=null&&t.regionOfInterest){if(!i.sa)throw Error("This task doesn't support region-of-interest.");var r=t.regionOfInterest;if(r.left>=r.right||r.top>=r.bottom)throw Error("Expected RectF with left < right and top < bottom.");if(r.left<0||r.top<0||r.right>1||r.bottom>1)throw Error("Expected RectF values to be in [0,1].");hn(s,1,(r.left+r.right)/2),hn(s,2,(r.top+r.bottom)/2),hn(s,4,r.right-r.left),hn(s,3,r.bottom-r.top)}else hn(s,1,.5),hn(s,2,.5),hn(s,4,1),hn(s,3,1);if(t!=null&&t.rotationDegrees){if((t==null?void 0:t.rotationDegrees)%90!=0)throw Error("Expected rotation to be a multiple of 90°.");if(hn(s,5,-Math.PI*t.rotationDegrees/180),(t==null?void 0:t.rotationDegrees)%180!=0){const[o,a]=r$(e);t=ms(s,3)*a/o,r=ms(s,4)*o/a,hn(s,4,t),hn(s,3,r)}}i.g.addProtoToStream(s.g(),"mediapipe.NormalizedRect",i.V,n)}i.g.ta(e,i.da,n??performance.now()),i.finishProcessing()}function Cc(i,e,t){var n;if((n=i.baseOptions)!=null&&n.g())throw Error("Task is not initialized with image mode. 'runningMode' must be set to 'IMAGE'.");c$(i,e,t,i.B+1)}function Ih(i,e,t,n){var r;if(!((r=i.baseOptions)!=null&&r.g()))throw Error("Task is not initialized with video mode. 'runningMode' must be set to 'VIDEO'.");c$(i,e,t,n)}function gA(i,e,t,n){var r=e.data;const s=e.width,o=s*(e=e.height);if((r instanceof Uint8Array||r instanceof Float32Array)&&r.length!==o)throw Error("Unsupported channel count: "+r.length/o);return i=new Xs([r],t,!1,i.g.i.canvas,i.R,s,e),n?i.clone():i}var Ca=class extends dS{constructor(i,e,t,n){super(i),this.g=i,this.da=e,this.V=t,this.sa=n,this.R=new nL}l(i,e=!0){if("runningMode"in i&&q2(this.baseOptions,2,!!i.runningMode&&i.runningMode!=="IMAGE"),i.canvas!==void 0&&this.g.i.canvas!==i.canvas)throw Error("You must create a new task to reset the canvas.");return super.l(i,e)}close(){this.R.close(),super.close()}};Ca.prototype.close=Ca.prototype.close;var _l=class extends Ca{constructor(i,e){super(new wc(i,e),"image_in","norm_rect_in",!1),this.j={detections:[]},Cn(i=this.h=new J4,0,1,e=new Fr),hn(this.h,2,.5),hn(this.h,3,.3)}get baseOptions(){return wi(this.h,Fr,1)}set baseOptions(i){Cn(this.h,0,1,i)}o(i){return"minDetectionConfidence"in i&&hn(this.h,2,i.minDetectionConfidence??.5),"minSuppressionThreshold"in i&&hn(this.h,3,i.minSuppressionThreshold??.3),this.l(i)}D(i,e){return this.j={detections:[]},Cc(this,i,e),this.j}F(i,e,t){return this.j={detections:[]},Ih(this,i,t,e),this.j}m(){var i=new sl;Mr(i,"image_in"),Mr(i,"norm_rect_in"),Ii(i,"detections");const e=new Fl;Pu(e,U3e,this.h);const t=new wa;Ol(t,"mediapipe.tasks.vision.face_detector.FaceDetectorGraph"),yr(t,"IMAGE:image_in"),yr(t,"NORM_RECT:norm_rect_in"),mi(t,"DETECTIONS:detections"),t.o(e),Nl(i,t),this.g.attachProtoVectorListener("detections",((n,r)=>{for(const s of n)n=wK(s),this.j.detections.push(t$(n));en(this,r)})),this.g.attachEmptyPacketListener("detections",(n=>{en(this,n)})),i=i.g(),this.setGraph(new Uint8Array(i),!0)}};_l.prototype.detectForVideo=_l.prototype.F,_l.prototype.detect=_l.prototype.D,_l.prototype.setOptions=_l.prototype.o,_l.createFromModelPath=async function(i,e){return di(_l,i,{baseOptions:{modelAssetPath:e}})},_l.createFromModelBuffer=function(i,e){return di(_l,i,{baseOptions:{modelAssetBuffer:e}})},_l.createFromOptions=function(i,e){return di(_l,i,e)};var rL=Du([61,146],[146,91],[91,181],[181,84],[84,17],[17,314],[314,405],[405,321],[321,375],[375,291],[61,185],[185,40],[40,39],[39,37],[37,0],[0,267],[267,269],[269,270],[270,409],[409,291],[78,95],[95,88],[88,178],[178,87],[87,14],[14,317],[317,402],[402,318],[318,324],[324,308],[78,191],[191,80],[80,81],[81,82],[82,13],[13,312],[312,311],[311,310],[310,415],[415,308]),sL=Du([263,249],[249,390],[390,373],[373,374],[374,380],[380,381],[381,382],[382,362],[263,466],[466,388],[388,387],[387,386],[386,385],[385,384],[384,398],[398,362]),oL=Du([276,283],[283,282],[282,295],[295,285],[300,293],[293,334],[334,296],[296,336]),u$=Du([474,475],[475,476],[476,477],[477,474]),aL=Du([33,7],[7,163],[163,144],[144,145],[145,153],[153,154],[154,155],[155,133],[33,246],[246,161],[161,160],[160,159],[159,158],[158,157],[157,173],[173,133]),lL=Du([46,53],[53,52],[52,65],[65,55],[70,63],[63,105],[105,66],[66,107]),h$=Du([469,470],[470,471],[471,472],[472,469]),cL=Du([10,338],[338,297],[297,332],[332,284],[284,251],[251,389],[389,356],[356,454],[454,323],[323,361],[361,288],[288,397],[397,365],[365,379],[379,378],[378,400],[400,377],[377,152],[152,148],[148,176],[176,149],[149,150],[150,136],[136,172],[172,58],[58,132],[132,93],[93,234],[234,127],[127,162],[162,21],[21,54],[54,103],[103,67],[67,109],[109,10]),f$=[...rL,...sL,...oL,...aL,...lL,...cL],d$=Du([127,34],[34,139],[139,127],[11,0],[0,37],[37,11],[232,231],[231,120],[120,232],[72,37],[37,39],[39,72],[128,121],[121,47],[47,128],[232,121],[121,128],[128,232],[104,69],[69,67],[67,104],[175,171],[171,148],[148,175],[118,50],[50,101],[101,118],[73,39],[39,40],[40,73],[9,151],[151,108],[108,9],[48,115],[115,131],[131,48],[194,204],[204,211],[211,194],[74,40],[40,185],[185,74],[80,42],[42,183],[183,80],[40,92],[92,186],[186,40],[230,229],[229,118],[118,230],[202,212],[212,214],[214,202],[83,18],[18,17],[17,83],[76,61],[61,146],[146,76],[160,29],[29,30],[30,160],[56,157],[157,173],[173,56],[106,204],[204,194],[194,106],[135,214],[214,192],[192,135],[203,165],[165,98],[98,203],[21,71],[71,68],[68,21],[51,45],[45,4],[4,51],[144,24],[24,23],[23,144],[77,146],[146,91],[91,77],[205,50],[50,187],[187,205],[201,200],[200,18],[18,201],[91,106],[106,182],[182,91],[90,91],[91,181],[181,90],[85,84],[84,17],[17,85],[206,203],[203,36],[36,206],[148,171],[171,140],[140,148],[92,40],[40,39],[39,92],[193,189],[189,244],[244,193],[159,158],[158,28],[28,159],[247,246],[246,161],[161,247],[236,3],[3,196],[196,236],[54,68],[68,104],[104,54],[193,168],[168,8],[8,193],[117,228],[228,31],[31,117],[189,193],[193,55],[55,189],[98,97],[97,99],[99,98],[126,47],[47,100],[100,126],[166,79],[79,218],[218,166],[155,154],[154,26],[26,155],[209,49],[49,131],[131,209],[135,136],[136,150],[150,135],[47,126],[126,217],[217,47],[223,52],[52,53],[53,223],[45,51],[51,134],[134,45],[211,170],[170,140],[140,211],[67,69],[69,108],[108,67],[43,106],[106,91],[91,43],[230,119],[119,120],[120,230],[226,130],[130,247],[247,226],[63,53],[53,52],[52,63],[238,20],[20,242],[242,238],[46,70],[70,156],[156,46],[78,62],[62,96],[96,78],[46,53],[53,63],[63,46],[143,34],[34,227],[227,143],[123,117],[117,111],[111,123],[44,125],[125,19],[19,44],[236,134],[134,51],[51,236],[216,206],[206,205],[205,216],[154,153],[153,22],[22,154],[39,37],[37,167],[167,39],[200,201],[201,208],[208,200],[36,142],[142,100],[100,36],[57,212],[212,202],[202,57],[20,60],[60,99],[99,20],[28,158],[158,157],[157,28],[35,226],[226,113],[113,35],[160,159],[159,27],[27,160],[204,202],[202,210],[210,204],[113,225],[225,46],[46,113],[43,202],[202,204],[204,43],[62,76],[76,77],[77,62],[137,123],[123,116],[116,137],[41,38],[38,72],[72,41],[203,129],[129,142],[142,203],[64,98],[98,240],[240,64],[49,102],[102,64],[64,49],[41,73],[73,74],[74,41],[212,216],[216,207],[207,212],[42,74],[74,184],[184,42],[169,170],[170,211],[211,169],[170,149],[149,176],[176,170],[105,66],[66,69],[69,105],[122,6],[6,168],[168,122],[123,147],[147,187],[187,123],[96,77],[77,90],[90,96],[65,55],[55,107],[107,65],[89,90],[90,180],[180,89],[101,100],[100,120],[120,101],[63,105],[105,104],[104,63],[93,137],[137,227],[227,93],[15,86],[86,85],[85,15],[129,102],[102,49],[49,129],[14,87],[87,86],[86,14],[55,8],[8,9],[9,55],[100,47],[47,121],[121,100],[145,23],[23,22],[22,145],[88,89],[89,179],[179,88],[6,122],[122,196],[196,6],[88,95],[95,96],[96,88],[138,172],[172,136],[136,138],[215,58],[58,172],[172,215],[115,48],[48,219],[219,115],[42,80],[80,81],[81,42],[195,3],[3,51],[51,195],[43,146],[146,61],[61,43],[171,175],[175,199],[199,171],[81,82],[82,38],[38,81],[53,46],[46,225],[225,53],[144,163],[163,110],[110,144],[52,65],[65,66],[66,52],[229,228],[228,117],[117,229],[34,127],[127,234],[234,34],[107,108],[108,69],[69,107],[109,108],[108,151],[151,109],[48,64],[64,235],[235,48],[62,78],[78,191],[191,62],[129,209],[209,126],[126,129],[111,35],[35,143],[143,111],[117,123],[123,50],[50,117],[222,65],[65,52],[52,222],[19,125],[125,141],[141,19],[221,55],[55,65],[65,221],[3,195],[195,197],[197,3],[25,7],[7,33],[33,25],[220,237],[237,44],[44,220],[70,71],[71,139],[139,70],[122,193],[193,245],[245,122],[247,130],[130,33],[33,247],[71,21],[21,162],[162,71],[170,169],[169,150],[150,170],[188,174],[174,196],[196,188],[216,186],[186,92],[92,216],[2,97],[97,167],[167,2],[141,125],[125,241],[241,141],[164,167],[167,37],[37,164],[72,38],[38,12],[12,72],[38,82],[82,13],[13,38],[63,68],[68,71],[71,63],[226,35],[35,111],[111,226],[101,50],[50,205],[205,101],[206,92],[92,165],[165,206],[209,198],[198,217],[217,209],[165,167],[167,97],[97,165],[220,115],[115,218],[218,220],[133,112],[112,243],[243,133],[239,238],[238,241],[241,239],[214,135],[135,169],[169,214],[190,173],[173,133],[133,190],[171,208],[208,32],[32,171],[125,44],[44,237],[237,125],[86,87],[87,178],[178,86],[85,86],[86,179],[179,85],[84,85],[85,180],[180,84],[83,84],[84,181],[181,83],[201,83],[83,182],[182,201],[137,93],[93,132],[132,137],[76,62],[62,183],[183,76],[61,76],[76,184],[184,61],[57,61],[61,185],[185,57],[212,57],[57,186],[186,212],[214,207],[207,187],[187,214],[34,143],[143,156],[156,34],[79,239],[239,237],[237,79],[123,137],[137,177],[177,123],[44,1],[1,4],[4,44],[201,194],[194,32],[32,201],[64,102],[102,129],[129,64],[213,215],[215,138],[138,213],[59,166],[166,219],[219,59],[242,99],[99,97],[97,242],[2,94],[94,141],[141,2],[75,59],[59,235],[235,75],[24,110],[110,228],[228,24],[25,130],[130,226],[226,25],[23,24],[24,229],[229,23],[22,23],[23,230],[230,22],[26,22],[22,231],[231,26],[112,26],[26,232],[232,112],[189,190],[190,243],[243,189],[221,56],[56,190],[190,221],[28,56],[56,221],[221,28],[27,28],[28,222],[222,27],[29,27],[27,223],[223,29],[30,29],[29,224],[224,30],[247,30],[30,225],[225,247],[238,79],[79,20],[20,238],[166,59],[59,75],[75,166],[60,75],[75,240],[240,60],[147,177],[177,215],[215,147],[20,79],[79,166],[166,20],[187,147],[147,213],[213,187],[112,233],[233,244],[244,112],[233,128],[128,245],[245,233],[128,114],[114,188],[188,128],[114,217],[217,174],[174,114],[131,115],[115,220],[220,131],[217,198],[198,236],[236,217],[198,131],[131,134],[134,198],[177,132],[132,58],[58,177],[143,35],[35,124],[124,143],[110,163],[163,7],[7,110],[228,110],[110,25],[25,228],[356,389],[389,368],[368,356],[11,302],[302,267],[267,11],[452,350],[350,349],[349,452],[302,303],[303,269],[269,302],[357,343],[343,277],[277,357],[452,453],[453,357],[357,452],[333,332],[332,297],[297,333],[175,152],[152,377],[377,175],[347,348],[348,330],[330,347],[303,304],[304,270],[270,303],[9,336],[336,337],[337,9],[278,279],[279,360],[360,278],[418,262],[262,431],[431,418],[304,408],[408,409],[409,304],[310,415],[415,407],[407,310],[270,409],[409,410],[410,270],[450,348],[348,347],[347,450],[422,430],[430,434],[434,422],[313,314],[314,17],[17,313],[306,307],[307,375],[375,306],[387,388],[388,260],[260,387],[286,414],[414,398],[398,286],[335,406],[406,418],[418,335],[364,367],[367,416],[416,364],[423,358],[358,327],[327,423],[251,284],[284,298],[298,251],[281,5],[5,4],[4,281],[373,374],[374,253],[253,373],[307,320],[320,321],[321,307],[425,427],[427,411],[411,425],[421,313],[313,18],[18,421],[321,405],[405,406],[406,321],[320,404],[404,405],[405,320],[315,16],[16,17],[17,315],[426,425],[425,266],[266,426],[377,400],[400,369],[369,377],[322,391],[391,269],[269,322],[417,465],[465,464],[464,417],[386,257],[257,258],[258,386],[466,260],[260,388],[388,466],[456,399],[399,419],[419,456],[284,332],[332,333],[333,284],[417,285],[285,8],[8,417],[346,340],[340,261],[261,346],[413,441],[441,285],[285,413],[327,460],[460,328],[328,327],[355,371],[371,329],[329,355],[392,439],[439,438],[438,392],[382,341],[341,256],[256,382],[429,420],[420,360],[360,429],[364,394],[394,379],[379,364],[277,343],[343,437],[437,277],[443,444],[444,283],[283,443],[275,440],[440,363],[363,275],[431,262],[262,369],[369,431],[297,338],[338,337],[337,297],[273,375],[375,321],[321,273],[450,451],[451,349],[349,450],[446,342],[342,467],[467,446],[293,334],[334,282],[282,293],[458,461],[461,462],[462,458],[276,353],[353,383],[383,276],[308,324],[324,325],[325,308],[276,300],[300,293],[293,276],[372,345],[345,447],[447,372],[352,345],[345,340],[340,352],[274,1],[1,19],[19,274],[456,248],[248,281],[281,456],[436,427],[427,425],[425,436],[381,256],[256,252],[252,381],[269,391],[391,393],[393,269],[200,199],[199,428],[428,200],[266,330],[330,329],[329,266],[287,273],[273,422],[422,287],[250,462],[462,328],[328,250],[258,286],[286,384],[384,258],[265,353],[353,342],[342,265],[387,259],[259,257],[257,387],[424,431],[431,430],[430,424],[342,353],[353,276],[276,342],[273,335],[335,424],[424,273],[292,325],[325,307],[307,292],[366,447],[447,345],[345,366],[271,303],[303,302],[302,271],[423,266],[266,371],[371,423],[294,455],[455,460],[460,294],[279,278],[278,294],[294,279],[271,272],[272,304],[304,271],[432,434],[434,427],[427,432],[272,407],[407,408],[408,272],[394,430],[430,431],[431,394],[395,369],[369,400],[400,395],[334,333],[333,299],[299,334],[351,417],[417,168],[168,351],[352,280],[280,411],[411,352],[325,319],[319,320],[320,325],[295,296],[296,336],[336,295],[319,403],[403,404],[404,319],[330,348],[348,349],[349,330],[293,298],[298,333],[333,293],[323,454],[454,447],[447,323],[15,16],[16,315],[315,15],[358,429],[429,279],[279,358],[14,15],[15,316],[316,14],[285,336],[336,9],[9,285],[329,349],[349,350],[350,329],[374,380],[380,252],[252,374],[318,402],[402,403],[403,318],[6,197],[197,419],[419,6],[318,319],[319,325],[325,318],[367,364],[364,365],[365,367],[435,367],[367,397],[397,435],[344,438],[438,439],[439,344],[272,271],[271,311],[311,272],[195,5],[5,281],[281,195],[273,287],[287,291],[291,273],[396,428],[428,199],[199,396],[311,271],[271,268],[268,311],[283,444],[444,445],[445,283],[373,254],[254,339],[339,373],[282,334],[334,296],[296,282],[449,347],[347,346],[346,449],[264,447],[447,454],[454,264],[336,296],[296,299],[299,336],[338,10],[10,151],[151,338],[278,439],[439,455],[455,278],[292,407],[407,415],[415,292],[358,371],[371,355],[355,358],[340,345],[345,372],[372,340],[346,347],[347,280],[280,346],[442,443],[443,282],[282,442],[19,94],[94,370],[370,19],[441,442],[442,295],[295,441],[248,419],[419,197],[197,248],[263,255],[255,359],[359,263],[440,275],[275,274],[274,440],[300,383],[383,368],[368,300],[351,412],[412,465],[465,351],[263,467],[467,466],[466,263],[301,368],[368,389],[389,301],[395,378],[378,379],[379,395],[412,351],[351,419],[419,412],[436,426],[426,322],[322,436],[2,164],[164,393],[393,2],[370,462],[462,461],[461,370],[164,0],[0,267],[267,164],[302,11],[11,12],[12,302],[268,12],[12,13],[13,268],[293,300],[300,301],[301,293],[446,261],[261,340],[340,446],[330,266],[266,425],[425,330],[426,423],[423,391],[391,426],[429,355],[355,437],[437,429],[391,327],[327,326],[326,391],[440,457],[457,438],[438,440],[341,382],[382,362],[362,341],[459,457],[457,461],[461,459],[434,430],[430,394],[394,434],[414,463],[463,362],[362,414],[396,369],[369,262],[262,396],[354,461],[461,457],[457,354],[316,403],[403,402],[402,316],[315,404],[404,403],[403,315],[314,405],[405,404],[404,314],[313,406],[406,405],[405,313],[421,418],[418,406],[406,421],[366,401],[401,361],[361,366],[306,408],[408,407],[407,306],[291,409],[409,408],[408,291],[287,410],[410,409],[409,287],[432,436],[436,410],[410,432],[434,416],[416,411],[411,434],[264,368],[368,383],[383,264],[309,438],[438,457],[457,309],[352,376],[376,401],[401,352],[274,275],[275,4],[4,274],[421,428],[428,262],[262,421],[294,327],[327,358],[358,294],[433,416],[416,367],[367,433],[289,455],[455,439],[439,289],[462,370],[370,326],[326,462],[2,326],[326,370],[370,2],[305,460],[460,455],[455,305],[254,449],[449,448],[448,254],[255,261],[261,446],[446,255],[253,450],[450,449],[449,253],[252,451],[451,450],[450,252],[256,452],[452,451],[451,256],[341,453],[453,452],[452,341],[413,464],[464,463],[463,413],[441,413],[413,414],[414,441],[258,442],[442,441],[441,258],[257,443],[443,442],[442,257],[259,444],[444,443],[443,259],[260,445],[445,444],[444,260],[467,342],[342,445],[445,467],[459,458],[458,250],[250,459],[289,392],[392,290],[290,289],[290,328],[328,460],[460,290],[376,433],[433,435],[435,376],[250,290],[290,392],[392,250],[411,416],[416,433],[433,411],[341,463],[463,464],[464,341],[453,464],[464,465],[465,453],[357,465],[465,412],[412,357],[343,412],[412,399],[399,343],[360,363],[363,440],[440,360],[437,399],[399,456],[456,437],[420,456],[456,363],[363,420],[401,435],[435,288],[288,401],[372,383],[383,353],[353,372],[339,255],[255,249],[249,339],[448,261],[261,255],[255,448],[133,243],[243,190],[190,133],[133,155],[155,112],[112,133],[33,246],[246,247],[247,33],[33,130],[130,25],[25,33],[398,384],[384,286],[286,398],[362,398],[398,414],[414,362],[362,463],[463,341],[341,362],[263,359],[359,467],[467,263],[263,249],[249,255],[255,263],[466,467],[467,260],[260,466],[75,60],[60,166],[166,75],[238,239],[239,79],[79,238],[162,127],[127,139],[139,162],[72,11],[11,37],[37,72],[121,232],[232,120],[120,121],[73,72],[72,39],[39,73],[114,128],[128,47],[47,114],[233,232],[232,128],[128,233],[103,104],[104,67],[67,103],[152,175],[175,148],[148,152],[119,118],[118,101],[101,119],[74,73],[73,40],[40,74],[107,9],[9,108],[108,107],[49,48],[48,131],[131,49],[32,194],[194,211],[211,32],[184,74],[74,185],[185,184],[191,80],[80,183],[183,191],[185,40],[40,186],[186,185],[119,230],[230,118],[118,119],[210,202],[202,214],[214,210],[84,83],[83,17],[17,84],[77,76],[76,146],[146,77],[161,160],[160,30],[30,161],[190,56],[56,173],[173,190],[182,106],[106,194],[194,182],[138,135],[135,192],[192,138],[129,203],[203,98],[98,129],[54,21],[21,68],[68,54],[5,51],[51,4],[4,5],[145,144],[144,23],[23,145],[90,77],[77,91],[91,90],[207,205],[205,187],[187,207],[83,201],[201,18],[18,83],[181,91],[91,182],[182,181],[180,90],[90,181],[181,180],[16,85],[85,17],[17,16],[205,206],[206,36],[36,205],[176,148],[148,140],[140,176],[165,92],[92,39],[39,165],[245,193],[193,244],[244,245],[27,159],[159,28],[28,27],[30,247],[247,161],[161,30],[174,236],[236,196],[196,174],[103,54],[54,104],[104,103],[55,193],[193,8],[8,55],[111,117],[117,31],[31,111],[221,189],[189,55],[55,221],[240,98],[98,99],[99,240],[142,126],[126,100],[100,142],[219,166],[166,218],[218,219],[112,155],[155,26],[26,112],[198,209],[209,131],[131,198],[169,135],[135,150],[150,169],[114,47],[47,217],[217,114],[224,223],[223,53],[53,224],[220,45],[45,134],[134,220],[32,211],[211,140],[140,32],[109,67],[67,108],[108,109],[146,43],[43,91],[91,146],[231,230],[230,120],[120,231],[113,226],[226,247],[247,113],[105,63],[63,52],[52,105],[241,238],[238,242],[242,241],[124,46],[46,156],[156,124],[95,78],[78,96],[96,95],[70,46],[46,63],[63,70],[116,143],[143,227],[227,116],[116,123],[123,111],[111,116],[1,44],[44,19],[19,1],[3,236],[236,51],[51,3],[207,216],[216,205],[205,207],[26,154],[154,22],[22,26],[165,39],[39,167],[167,165],[199,200],[200,208],[208,199],[101,36],[36,100],[100,101],[43,57],[57,202],[202,43],[242,20],[20,99],[99,242],[56,28],[28,157],[157,56],[124,35],[35,113],[113,124],[29,160],[160,27],[27,29],[211,204],[204,210],[210,211],[124,113],[113,46],[46,124],[106,43],[43,204],[204,106],[96,62],[62,77],[77,96],[227,137],[137,116],[116,227],[73,41],[41,72],[72,73],[36,203],[203,142],[142,36],[235,64],[64,240],[240,235],[48,49],[49,64],[64,48],[42,41],[41,74],[74,42],[214,212],[212,207],[207,214],[183,42],[42,184],[184,183],[210,169],[169,211],[211,210],[140,170],[170,176],[176,140],[104,105],[105,69],[69,104],[193,122],[122,168],[168,193],[50,123],[123,187],[187,50],[89,96],[96,90],[90,89],[66,65],[65,107],[107,66],[179,89],[89,180],[180,179],[119,101],[101,120],[120,119],[68,63],[63,104],[104,68],[234,93],[93,227],[227,234],[16,15],[15,85],[85,16],[209,129],[129,49],[49,209],[15,14],[14,86],[86,15],[107,55],[55,9],[9,107],[120,100],[100,121],[121,120],[153,145],[145,22],[22,153],[178,88],[88,179],[179,178],[197,6],[6,196],[196,197],[89,88],[88,96],[96,89],[135,138],[138,136],[136,135],[138,215],[215,172],[172,138],[218,115],[115,219],[219,218],[41,42],[42,81],[81,41],[5,195],[195,51],[51,5],[57,43],[43,61],[61,57],[208,171],[171,199],[199,208],[41,81],[81,38],[38,41],[224,53],[53,225],[225,224],[24,144],[144,110],[110,24],[105,52],[52,66],[66,105],[118,229],[229,117],[117,118],[227,34],[34,234],[234,227],[66,107],[107,69],[69,66],[10,109],[109,151],[151,10],[219,48],[48,235],[235,219],[183,62],[62,191],[191,183],[142,129],[129,126],[126,142],[116,111],[111,143],[143,116],[118,117],[117,50],[50,118],[223,222],[222,52],[52,223],[94,19],[19,141],[141,94],[222,221],[221,65],[65,222],[196,3],[3,197],[197,196],[45,220],[220,44],[44,45],[156,70],[70,139],[139,156],[188,122],[122,245],[245,188],[139,71],[71,162],[162,139],[149,170],[170,150],[150,149],[122,188],[188,196],[196,122],[206,216],[216,92],[92,206],[164,2],[2,167],[167,164],[242,141],[141,241],[241,242],[0,164],[164,37],[37,0],[11,72],[72,12],[12,11],[12,38],[38,13],[13,12],[70,63],[63,71],[71,70],[31,226],[226,111],[111,31],[36,101],[101,205],[205,36],[203,206],[206,165],[165,203],[126,209],[209,217],[217,126],[98,165],[165,97],[97,98],[237,220],[220,218],[218,237],[237,239],[239,241],[241,237],[210,214],[214,169],[169,210],[140,171],[171,32],[32,140],[241,125],[125,237],[237,241],[179,86],[86,178],[178,179],[180,85],[85,179],[179,180],[181,84],[84,180],[180,181],[182,83],[83,181],[181,182],[194,201],[201,182],[182,194],[177,137],[137,132],[132,177],[184,76],[76,183],[183,184],[185,61],[61,184],[184,185],[186,57],[57,185],[185,186],[216,212],[212,186],[186,216],[192,214],[214,187],[187,192],[139,34],[34,156],[156,139],[218,79],[79,237],[237,218],[147,123],[123,177],[177,147],[45,44],[44,4],[4,45],[208,201],[201,32],[32,208],[98,64],[64,129],[129,98],[192,213],[213,138],[138,192],[235,59],[59,219],[219,235],[141,242],[242,97],[97,141],[97,2],[2,141],[141,97],[240,75],[75,235],[235,240],[229,24],[24,228],[228,229],[31,25],[25,226],[226,31],[230,23],[23,229],[229,230],[231,22],[22,230],[230,231],[232,26],[26,231],[231,232],[233,112],[112,232],[232,233],[244,189],[189,243],[243,244],[189,221],[221,190],[190,189],[222,28],[28,221],[221,222],[223,27],[27,222],[222,223],[224,29],[29,223],[223,224],[225,30],[30,224],[224,225],[113,247],[247,225],[225,113],[99,60],[60,240],[240,99],[213,147],[147,215],[215,213],[60,20],[20,166],[166,60],[192,187],[187,213],[213,192],[243,112],[112,244],[244,243],[244,233],[233,245],[245,244],[245,128],[128,188],[188,245],[188,114],[114,174],[174,188],[134,131],[131,220],[220,134],[174,217],[217,236],[236,174],[236,198],[198,134],[134,236],[215,177],[177,58],[58,215],[156,143],[143,124],[124,156],[25,110],[110,7],[7,25],[31,228],[228,25],[25,31],[264,356],[356,368],[368,264],[0,11],[11,267],[267,0],[451,452],[452,349],[349,451],[267,302],[302,269],[269,267],[350,357],[357,277],[277,350],[350,452],[452,357],[357,350],[299,333],[333,297],[297,299],[396,175],[175,377],[377,396],[280,347],[347,330],[330,280],[269,303],[303,270],[270,269],[151,9],[9,337],[337,151],[344,278],[278,360],[360,344],[424,418],[418,431],[431,424],[270,304],[304,409],[409,270],[272,310],[310,407],[407,272],[322,270],[270,410],[410,322],[449,450],[450,347],[347,449],[432,422],[422,434],[434,432],[18,313],[313,17],[17,18],[291,306],[306,375],[375,291],[259,387],[387,260],[260,259],[424,335],[335,418],[418,424],[434,364],[364,416],[416,434],[391,423],[423,327],[327,391],[301,251],[251,298],[298,301],[275,281],[281,4],[4,275],[254,373],[373,253],[253,254],[375,307],[307,321],[321,375],[280,425],[425,411],[411,280],[200,421],[421,18],[18,200],[335,321],[321,406],[406,335],[321,320],[320,405],[405,321],[314,315],[315,17],[17,314],[423,426],[426,266],[266,423],[396,377],[377,369],[369,396],[270,322],[322,269],[269,270],[413,417],[417,464],[464,413],[385,386],[386,258],[258,385],[248,456],[456,419],[419,248],[298,284],[284,333],[333,298],[168,417],[417,8],[8,168],[448,346],[346,261],[261,448],[417,413],[413,285],[285,417],[326,327],[327,328],[328,326],[277,355],[355,329],[329,277],[309,392],[392,438],[438,309],[381,382],[382,256],[256,381],[279,429],[429,360],[360,279],[365,364],[364,379],[379,365],[355,277],[277,437],[437,355],[282,443],[443,283],[283,282],[281,275],[275,363],[363,281],[395,431],[431,369],[369,395],[299,297],[297,337],[337,299],[335,273],[273,321],[321,335],[348,450],[450,349],[349,348],[359,446],[446,467],[467,359],[283,293],[293,282],[282,283],[250,458],[458,462],[462,250],[300,276],[276,383],[383,300],[292,308],[308,325],[325,292],[283,276],[276,293],[293,283],[264,372],[372,447],[447,264],[346,352],[352,340],[340,346],[354,274],[274,19],[19,354],[363,456],[456,281],[281,363],[426,436],[436,425],[425,426],[380,381],[381,252],[252,380],[267,269],[269,393],[393,267],[421,200],[200,428],[428,421],[371,266],[266,329],[329,371],[432,287],[287,422],[422,432],[290,250],[250,328],[328,290],[385,258],[258,384],[384,385],[446,265],[265,342],[342,446],[386,387],[387,257],[257,386],[422,424],[424,430],[430,422],[445,342],[342,276],[276,445],[422,273],[273,424],[424,422],[306,292],[292,307],[307,306],[352,366],[366,345],[345,352],[268,271],[271,302],[302,268],[358,423],[423,371],[371,358],[327,294],[294,460],[460,327],[331,279],[279,294],[294,331],[303,271],[271,304],[304,303],[436,432],[432,427],[427,436],[304,272],[272,408],[408,304],[395,394],[394,431],[431,395],[378,395],[395,400],[400,378],[296,334],[334,299],[299,296],[6,351],[351,168],[168,6],[376,352],[352,411],[411,376],[307,325],[325,320],[320,307],[285,295],[295,336],[336,285],[320,319],[319,404],[404,320],[329,330],[330,349],[349,329],[334,293],[293,333],[333,334],[366,323],[323,447],[447,366],[316,15],[15,315],[315,316],[331,358],[358,279],[279,331],[317,14],[14,316],[316,317],[8,285],[285,9],[9,8],[277,329],[329,350],[350,277],[253,374],[374,252],[252,253],[319,318],[318,403],[403,319],[351,6],[6,419],[419,351],[324,318],[318,325],[325,324],[397,367],[367,365],[365,397],[288,435],[435,397],[397,288],[278,344],[344,439],[439,278],[310,272],[272,311],[311,310],[248,195],[195,281],[281,248],[375,273],[273,291],[291,375],[175,396],[396,199],[199,175],[312,311],[311,268],[268,312],[276,283],[283,445],[445,276],[390,373],[373,339],[339,390],[295,282],[282,296],[296,295],[448,449],[449,346],[346,448],[356,264],[264,454],[454,356],[337,336],[336,299],[299,337],[337,338],[338,151],[151,337],[294,278],[278,455],[455,294],[308,292],[292,415],[415,308],[429,358],[358,355],[355,429],[265,340],[340,372],[372,265],[352,346],[346,280],[280,352],[295,442],[442,282],[282,295],[354,19],[19,370],[370,354],[285,441],[441,295],[295,285],[195,248],[248,197],[197,195],[457,440],[440,274],[274,457],[301,300],[300,368],[368,301],[417,351],[351,465],[465,417],[251,301],[301,389],[389,251],[394,395],[395,379],[379,394],[399,412],[412,419],[419,399],[410,436],[436,322],[322,410],[326,2],[2,393],[393,326],[354,370],[370,461],[461,354],[393,164],[164,267],[267,393],[268,302],[302,12],[12,268],[312,268],[268,13],[13,312],[298,293],[293,301],[301,298],[265,446],[446,340],[340,265],[280,330],[330,425],[425,280],[322,426],[426,391],[391,322],[420,429],[429,437],[437,420],[393,391],[391,326],[326,393],[344,440],[440,438],[438,344],[458,459],[459,461],[461,458],[364,434],[434,394],[394,364],[428,396],[396,262],[262,428],[274,354],[354,457],[457,274],[317,316],[316,402],[402,317],[316,315],[315,403],[403,316],[315,314],[314,404],[404,315],[314,313],[313,405],[405,314],[313,421],[421,406],[406,313],[323,366],[366,361],[361,323],[292,306],[306,407],[407,292],[306,291],[291,408],[408,306],[291,287],[287,409],[409,291],[287,432],[432,410],[410,287],[427,434],[434,411],[411,427],[372,264],[264,383],[383,372],[459,309],[309,457],[457,459],[366,352],[352,401],[401,366],[1,274],[274,4],[4,1],[418,421],[421,262],[262,418],[331,294],[294,358],[358,331],[435,433],[433,367],[367,435],[392,289],[289,439],[439,392],[328,462],[462,326],[326,328],[94,2],[2,370],[370,94],[289,305],[305,455],[455,289],[339,254],[254,448],[448,339],[359,255],[255,446],[446,359],[254,253],[253,449],[449,254],[253,252],[252,450],[450,253],[252,256],[256,451],[451,252],[256,341],[341,452],[452,256],[414,413],[413,463],[463,414],[286,441],[441,414],[414,286],[286,258],[258,441],[441,286],[258,257],[257,442],[442,258],[257,259],[259,443],[443,257],[259,260],[260,444],[444,259],[260,467],[467,445],[445,260],[309,459],[459,250],[250,309],[305,289],[289,290],[290,305],[305,290],[290,460],[460,305],[401,376],[376,435],[435,401],[309,250],[250,392],[392,309],[376,411],[411,433],[433,376],[453,341],[341,464],[464,453],[357,453],[453,465],[465,357],[343,357],[357,412],[412,343],[437,343],[343,399],[399,437],[344,360],[360,440],[440,344],[420,437],[437,456],[456,420],[360,420],[420,363],[363,360],[361,401],[401,288],[288,361],[265,372],[372,353],[353,265],[390,339],[339,249],[249,390],[339,448],[448,255],[255,339]);function hN(i){i.j={faceLandmarks:[],faceBlendshapes:[],facialTransformationMatrixes:[]}}var Qr=class extends Ca{constructor(i,e){super(new wc(i,e),"image_in","norm_rect",!1),this.j={faceLandmarks:[],faceBlendshapes:[],facialTransformationMatrixes:[]},this.outputFacialTransformationMatrixes=this.outputFaceBlendshapes=!1,Cn(i=this.h=new kK,0,1,e=new Fr),this.v=new DK,Cn(this.h,0,3,this.v),this.s=new J4,Cn(this.h,0,2,this.s),wh(this.s,4,1),hn(this.s,2,.5),hn(this.v,2,.5),hn(this.h,4,.5)}get baseOptions(){return wi(this.h,Fr,1)}set baseOptions(i){Cn(this.h,0,1,i)}o(i){return"numFaces"in i&&wh(this.s,4,i.numFaces??1),"minFaceDetectionConfidence"in i&&hn(this.s,2,i.minFaceDetectionConfidence??.5),"minTrackingConfidence"in i&&hn(this.h,4,i.minTrackingConfidence??.5),"minFacePresenceConfidence"in i&&hn(this.v,2,i.minFacePresenceConfidence??.5),"outputFaceBlendshapes"in i&&(this.outputFaceBlendshapes=!!i.outputFaceBlendshapes),"outputFacialTransformationMatrixes"in i&&(this.outputFacialTransformationMatrixes=!!i.outputFacialTransformationMatrixes),this.l(i)}D(i,e){return hN(this),Cc(this,i,e),this.j}F(i,e,t){return hN(this),Ih(this,i,t,e),this.j}m(){var i=new sl;Mr(i,"image_in"),Mr(i,"norm_rect"),Ii(i,"face_landmarks");const e=new Fl;Pu(e,G3e,this.h);const t=new wa;Ol(t,"mediapipe.tasks.vision.face_landmarker.FaceLandmarkerGraph"),yr(t,"IMAGE:image_in"),yr(t,"NORM_RECT:norm_rect"),mi(t,"NORM_LANDMARKS:face_landmarks"),t.o(e),Nl(i,t),this.g.attachProtoVectorListener("face_landmarks",((n,r)=>{for(const s of n)n=Lx(s),this.j.faceLandmarks.push(Z4(n));en(this,r)})),this.g.attachEmptyPacketListener("face_landmarks",(n=>{en(this,n)})),this.outputFaceBlendshapes&&(Ii(i,"blendshapes"),mi(t,"BLENDSHAPES:blendshapes"),this.g.attachProtoVectorListener("blendshapes",((n,r)=>{if(this.outputFaceBlendshapes)for(const s of n)n=q4(s),this.j.faceBlendshapes.push(J8(n.g()??[]));en(this,r)})),this.g.attachEmptyPacketListener("blendshapes",(n=>{en(this,n)}))),this.outputFacialTransformationMatrixes&&(Ii(i,"face_geometry"),mi(t,"FACE_GEOMETRY:face_geometry"),this.g.attachProtoVectorListener("face_geometry",((n,r)=>{if(this.outputFacialTransformationMatrixes)for(const s of n)(n=wi(z3e(s),L3e,2))&&this.j.facialTransformationMatrixes.push({rows:bu(mc(n,1),0)??0,columns:bu(mc(n,2),0)??0,data:Om(n,3,Ep,Fm()).slice()??[]});en(this,r)})),this.g.attachEmptyPacketListener("face_geometry",(n=>{en(this,n)}))),i=i.g(),this.setGraph(new Uint8Array(i),!0)}};Qr.prototype.detectForVideo=Qr.prototype.F,Qr.prototype.detect=Qr.prototype.D,Qr.prototype.setOptions=Qr.prototype.o,Qr.createFromModelPath=function(i,e){return di(Qr,i,{baseOptions:{modelAssetPath:e}})},Qr.createFromModelBuffer=function(i,e){return di(Qr,i,{baseOptions:{modelAssetBuffer:e}})},Qr.createFromOptions=function(i,e){return di(Qr,i,e)},Qr.FACE_LANDMARKS_LIPS=rL,Qr.FACE_LANDMARKS_LEFT_EYE=sL,Qr.FACE_LANDMARKS_LEFT_EYEBROW=oL,Qr.FACE_LANDMARKS_LEFT_IRIS=u$,Qr.FACE_LANDMARKS_RIGHT_EYE=aL,Qr.FACE_LANDMARKS_RIGHT_EYEBROW=lL,Qr.FACE_LANDMARKS_RIGHT_IRIS=h$,Qr.FACE_LANDMARKS_FACE_OVAL=cL,Qr.FACE_LANDMARKS_CONTOURS=f$,Qr.FACE_LANDMARKS_TESSELATION=d$;var cu=class extends Ca{constructor(i,e){super(new wc(i,e),"image_in","norm_rect",!0),Cn(i=this.j=new OK,0,1,e=new Fr)}get baseOptions(){return wi(this.j,Fr,1)}set baseOptions(i){Cn(this.j,0,1,i)}o(i){return super.l(i)}Ra(i,e,t){const n=typeof e!="function"?e:{};if(this.h=typeof e=="function"?e:t,Cc(this,i,n??{}),!this.h)return this.s}m(){var i=new sl;Mr(i,"image_in"),Mr(i,"norm_rect"),Ii(i,"stylized_image");const e=new Fl;Pu(e,H3e,this.j);const t=new wa;Ol(t,"mediapipe.tasks.vision.face_stylizer.FaceStylizerGraph"),yr(t,"IMAGE:image_in"),yr(t,"NORM_RECT:norm_rect"),mi(t,"STYLIZED_IMAGE:stylized_image"),t.o(e),Nl(i,t),this.g.W("stylized_image",((n,r)=>{var s=!this.h,o=n.data,a=n.width;const l=a*(n=n.height);if(o instanceof Uint8Array)if(o.length===3*l){const c=new Uint8ClampedArray(4*l);for(let u=0;u<l;++u)c[4*u]=o[3*u],c[4*u+1]=o[3*u+1],c[4*u+2]=o[3*u+2],c[4*u+3]=255;o=new ImageData(c,a,n)}else{if(o.length!==4*l)throw Error("Unsupported channel count: "+o.length/l);o=new ImageData(new Uint8ClampedArray(o.buffer,o.byteOffset,o.length),a,n)}else if(!(o instanceof WebGLTexture))throw Error(`Unsupported format: ${o.constructor.name}`);a=new qs([o],!1,!1,this.g.i.canvas,this.R,a,n),this.s=s=s?a.clone():a,this.h&&this.h(s),en(this,r)})),this.g.attachEmptyPacketListener("stylized_image",(n=>{this.s=null,this.h&&this.h(null),en(this,n)})),i=i.g(),this.setGraph(new Uint8Array(i),!0)}};cu.prototype.stylize=cu.prototype.Ra,cu.prototype.setOptions=cu.prototype.o,cu.createFromModelPath=function(i,e){return di(cu,i,{baseOptions:{modelAssetPath:e}})},cu.createFromModelBuffer=function(i,e){return di(cu,i,{baseOptions:{modelAssetBuffer:e}})},cu.createFromOptions=function(i,e){return di(cu,i,e)};var uL=Du([0,1],[1,2],[2,3],[3,4],[0,5],[5,6],[6,7],[7,8],[5,9],[9,10],[10,11],[11,12],[9,13],[13,14],[14,15],[15,16],[13,17],[0,17],[17,18],[18,19],[19,20]);function fN(i){i.gestures=[],i.landmarks=[],i.worldLandmarks=[],i.handedness=[]}function dN(i){return i.gestures.length===0?{gestures:[],landmarks:[],worldLandmarks:[],handedness:[],handednesses:[]}:{gestures:i.gestures,landmarks:i.landmarks,worldLandmarks:i.worldLandmarks,handedness:i.handedness,handednesses:i.handedness}}function pN(i,e=!0){const t=[];for(const r of i){var n=q4(r);i=[];for(const s of n.g())n=e&&mc(s,1)!=null?bu(mc(s,1),0):-1,i.push({score:ms(s,2)??0,index:n,categoryName:Sh(s,3)??"",displayName:Sh(s,4)??""});t.push(i)}return t}var Qa=class extends Ca{constructor(i,e){super(new wc(i,e),"image_in","norm_rect",!1),this.gestures=[],this.landmarks=[],this.worldLandmarks=[],this.handedness=[],Cn(i=this.j=new GK,0,1,e=new Fr),this.s=new Y8,Cn(this.j,0,2,this.s),this.C=new $8,Cn(this.s,0,3,this.C),this.v=new zK,Cn(this.s,0,2,this.v),this.h=new Q3e,Cn(this.j,0,3,this.h),hn(this.v,2,.5),hn(this.s,4,.5),hn(this.C,2,.5)}get baseOptions(){return wi(this.j,Fr,1)}set baseOptions(i){Cn(this.j,0,1,i)}o(i){var r,s,o,a;if(wh(this.v,3,i.numHands??1),"minHandDetectionConfidence"in i&&hn(this.v,2,i.minHandDetectionConfidence??.5),"minTrackingConfidence"in i&&hn(this.s,4,i.minTrackingConfidence??.5),"minHandPresenceConfidence"in i&&hn(this.C,2,i.minHandPresenceConfidence??.5),i.cannedGesturesClassifierOptions){var e=new g1,t=e,n=o6(i.cannedGesturesClassifierOptions,(r=wi(this.h,g1,3))==null?void 0:r.h());Cn(t,0,2,n),Cn(this.h,0,3,e)}else i.cannedGesturesClassifierOptions===void 0&&((s=wi(this.h,g1,3))==null||s.g());return i.customGesturesClassifierOptions?(Cn(t=e=new g1,0,2,n=o6(i.customGesturesClassifierOptions,(o=wi(this.h,g1,4))==null?void 0:o.h())),Cn(this.h,0,4,e)):i.customGesturesClassifierOptions===void 0&&((a=wi(this.h,g1,4))==null||a.g()),this.l(i)}Ma(i,e){return fN(this),Cc(this,i,e),dN(this)}Na(i,e,t){return fN(this),Ih(this,i,t,e),dN(this)}m(){var i=new sl;Mr(i,"image_in"),Mr(i,"norm_rect"),Ii(i,"hand_gestures"),Ii(i,"hand_landmarks"),Ii(i,"world_hand_landmarks"),Ii(i,"handedness");const e=new Fl;Pu(e,j3e,this.j);const t=new wa;Ol(t,"mediapipe.tasks.vision.gesture_recognizer.GestureRecognizerGraph"),yr(t,"IMAGE:image_in"),yr(t,"NORM_RECT:norm_rect"),mi(t,"HAND_GESTURES:hand_gestures"),mi(t,"LANDMARKS:hand_landmarks"),mi(t,"WORLD_LANDMARKS:world_hand_landmarks"),mi(t,"HANDEDNESS:handedness"),t.o(e),Nl(i,t),this.g.attachProtoVectorListener("hand_landmarks",((n,r)=>{for(const s of n){n=Lx(s);const o=[];for(const a of Gf(n,TK,1))o.push({x:ms(a,1)??0,y:ms(a,2)??0,z:ms(a,3)??0,visibility:ms(a,4)??0});this.landmarks.push(o)}en(this,r)})),this.g.attachEmptyPacketListener("hand_landmarks",(n=>{en(this,n)})),this.g.attachProtoVectorListener("world_hand_landmarks",((n,r)=>{for(const s of n){n=Y1(s);const o=[];for(const a of Gf(n,CK,1))o.push({x:ms(a,1)??0,y:ms(a,2)??0,z:ms(a,3)??0,visibility:ms(a,4)??0});this.worldLandmarks.push(o)}en(this,r)})),this.g.attachEmptyPacketListener("world_hand_landmarks",(n=>{en(this,n)})),this.g.attachProtoVectorListener("hand_gestures",((n,r)=>{this.gestures.push(...pN(n,!1)),en(this,r)})),this.g.attachEmptyPacketListener("hand_gestures",(n=>{en(this,n)})),this.g.attachProtoVectorListener("handedness",((n,r)=>{this.handedness.push(...pN(n)),en(this,r)})),this.g.attachEmptyPacketListener("handedness",(n=>{en(this,n)})),i=i.g(),this.setGraph(new Uint8Array(i),!0)}};function mN(i){return{landmarks:i.landmarks,worldLandmarks:i.worldLandmarks,handednesses:i.handedness,handedness:i.handedness}}Qa.prototype.recognizeForVideo=Qa.prototype.Na,Qa.prototype.recognize=Qa.prototype.Ma,Qa.prototype.setOptions=Qa.prototype.o,Qa.createFromModelPath=function(i,e){return di(Qa,i,{baseOptions:{modelAssetPath:e}})},Qa.createFromModelBuffer=function(i,e){return di(Qa,i,{baseOptions:{modelAssetBuffer:e}})},Qa.createFromOptions=function(i,e){return di(Qa,i,e)},Qa.HAND_CONNECTIONS=uL;var Va=class extends Ca{constructor(i,e){super(new wc(i,e),"image_in","norm_rect",!1),this.landmarks=[],this.worldLandmarks=[],this.handedness=[],Cn(i=this.h=new Y8,0,1,e=new Fr),this.s=new $8,Cn(this.h,0,3,this.s),this.j=new zK,Cn(this.h,0,2,this.j),wh(this.j,3,1),hn(this.j,2,.5),hn(this.s,2,.5),hn(this.h,4,.5)}get baseOptions(){return wi(this.h,Fr,1)}set baseOptions(i){Cn(this.h,0,1,i)}o(i){return"numHands"in i&&wh(this.j,3,i.numHands??1),"minHandDetectionConfidence"in i&&hn(this.j,2,i.minHandDetectionConfidence??.5),"minTrackingConfidence"in i&&hn(this.h,4,i.minTrackingConfidence??.5),"minHandPresenceConfidence"in i&&hn(this.s,2,i.minHandPresenceConfidence??.5),this.l(i)}D(i,e){return this.landmarks=[],this.worldLandmarks=[],this.handedness=[],Cc(this,i,e),mN(this)}F(i,e,t){return this.landmarks=[],this.worldLandmarks=[],this.handedness=[],Ih(this,i,t,e),mN(this)}m(){var i=new sl;Mr(i,"image_in"),Mr(i,"norm_rect"),Ii(i,"hand_landmarks"),Ii(i,"world_hand_landmarks"),Ii(i,"handedness");const e=new Fl;Pu(e,W3e,this.h);const t=new wa;Ol(t,"mediapipe.tasks.vision.hand_landmarker.HandLandmarkerGraph"),yr(t,"IMAGE:image_in"),yr(t,"NORM_RECT:norm_rect"),mi(t,"LANDMARKS:hand_landmarks"),mi(t,"WORLD_LANDMARKS:world_hand_landmarks"),mi(t,"HANDEDNESS:handedness"),t.o(e),Nl(i,t),this.g.attachProtoVectorListener("hand_landmarks",((n,r)=>{for(const s of n)n=Lx(s),this.landmarks.push(Z4(n));en(this,r)})),this.g.attachEmptyPacketListener("hand_landmarks",(n=>{en(this,n)})),this.g.attachProtoVectorListener("world_hand_landmarks",((n,r)=>{for(const s of n)n=Y1(s),this.worldLandmarks.push(g2(n));en(this,r)})),this.g.attachEmptyPacketListener("world_hand_landmarks",(n=>{en(this,n)})),this.g.attachProtoVectorListener("handedness",((n,r)=>{var s=this.handedness,o=s.push;const a=[];for(const l of n){n=q4(l);const c=[];for(const u of n.g())c.push({score:ms(u,2)??0,index:bu(mc(u,1),0)??-1,categoryName:Sh(u,3)??"",displayName:Sh(u,4)??""});a.push(c)}o.call(s,...a),en(this,r)})),this.g.attachEmptyPacketListener("handedness",(n=>{en(this,n)})),i=i.g(),this.setGraph(new Uint8Array(i),!0)}};Va.prototype.detectForVideo=Va.prototype.F,Va.prototype.detect=Va.prototype.D,Va.prototype.setOptions=Va.prototype.o,Va.createFromModelPath=function(i,e){return di(Va,i,{baseOptions:{modelAssetPath:e}})},Va.createFromModelBuffer=function(i,e){return di(Va,i,{baseOptions:{modelAssetBuffer:e}})},Va.createFromOptions=function(i,e){return di(Va,i,e)},Va.HAND_CONNECTIONS=uL;var p$=Du([0,1],[1,2],[2,3],[3,7],[0,4],[4,5],[5,6],[6,8],[9,10],[11,12],[11,13],[13,15],[15,17],[15,19],[15,21],[17,19],[12,14],[14,16],[16,18],[16,20],[16,22],[18,20],[11,23],[12,24],[23,24],[23,25],[24,26],[25,27],[26,28],[27,29],[28,30],[29,31],[30,32],[27,31],[28,32]);function gN(i){i.h={faceLandmarks:[],faceBlendshapes:[],poseLandmarks:[],poseWorldLandmarks:[],poseSegmentationMasks:[],leftHandLandmarks:[],leftHandWorldLandmarks:[],rightHandLandmarks:[],rightHandWorldLandmarks:[]}}function AN(i){try{if(!i.C)return i.h;i.C(i.h)}finally{tC(i)}}function N_(i,e){i=Lx(i),e.push(Z4(i))}var wr=class extends Ca{constructor(i,e){super(new wc(i,e),"input_frames_image",null,!1),this.h={faceLandmarks:[],faceBlendshapes:[],poseLandmarks:[],poseWorldLandmarks:[],poseSegmentationMasks:[],leftHandLandmarks:[],leftHandWorldLandmarks:[],rightHandLandmarks:[],rightHandWorldLandmarks:[]},this.outputPoseSegmentationMasks=this.outputFaceBlendshapes=!1,Cn(i=this.j=new KK,0,1,e=new Fr),this.K=new $8,Cn(this.j,0,2,this.K),this.ca=new K3e,Cn(this.j,0,3,this.ca),this.s=new J4,Cn(this.j,0,4,this.s),this.I=new DK,Cn(this.j,0,5,this.I),this.v=new WK,Cn(this.j,0,6,this.v),this.L=new jK,Cn(this.j,0,7,this.L),hn(this.s,2,.5),hn(this.s,3,.3),hn(this.I,2,.5),hn(this.v,2,.5),hn(this.v,3,.3),hn(this.L,2,.5),hn(this.K,2,.5)}get baseOptions(){return wi(this.j,Fr,1)}set baseOptions(i){Cn(this.j,0,1,i)}o(i){return"minFaceDetectionConfidence"in i&&hn(this.s,2,i.minFaceDetectionConfidence??.5),"minFaceSuppressionThreshold"in i&&hn(this.s,3,i.minFaceSuppressionThreshold??.3),"minFacePresenceConfidence"in i&&hn(this.I,2,i.minFacePresenceConfidence??.5),"outputFaceBlendshapes"in i&&(this.outputFaceBlendshapes=!!i.outputFaceBlendshapes),"minPoseDetectionConfidence"in i&&hn(this.v,2,i.minPoseDetectionConfidence??.5),"minPoseSuppressionThreshold"in i&&hn(this.v,3,i.minPoseSuppressionThreshold??.3),"minPosePresenceConfidence"in i&&hn(this.L,2,i.minPosePresenceConfidence??.5),"outputPoseSegmentationMasks"in i&&(this.outputPoseSegmentationMasks=!!i.outputPoseSegmentationMasks),"minHandLandmarksConfidence"in i&&hn(this.K,2,i.minHandLandmarksConfidence??.5),this.l(i)}D(i,e,t){const n=typeof e!="function"?e:{};return this.C=typeof e=="function"?e:t,gN(this),Cc(this,i,n),AN(this)}F(i,e,t,n){const r=typeof t!="function"?t:{};return this.C=typeof t=="function"?t:n,gN(this),Ih(this,i,r,e),AN(this)}m(){var i=new sl;Mr(i,"input_frames_image"),Ii(i,"pose_landmarks"),Ii(i,"pose_world_landmarks"),Ii(i,"face_landmarks"),Ii(i,"left_hand_landmarks"),Ii(i,"left_hand_world_landmarks"),Ii(i,"right_hand_landmarks"),Ii(i,"right_hand_world_landmarks");const e=new Fl,t=new QO;q5(t,1,PA("type.googleapis.com/mediapipe.tasks.vision.holistic_landmarker.proto.HolisticLandmarkerGraphOptions"),""),(function(r,s){if(s!=null)if(Array.isArray(s))Ar(r,2,z4(s,R8,void 0,void 0,!1));else{if(!(typeof s=="string"||s instanceof kf||Tx(s)))throw Error("invalid value in Any.value field: "+s+" expected a ByteString, a base64 encoded string, a Uint8Array or a jspb array");q5(r,2,x8(s,!1,!1),a0())}})(t,this.j.g());const n=new wa;Ol(n,"mediapipe.tasks.vision.holistic_landmarker.HolisticLandmarkerGraph"),ow(n,8,QO,t),yr(n,"IMAGE:input_frames_image"),mi(n,"POSE_LANDMARKS:pose_landmarks"),mi(n,"POSE_WORLD_LANDMARKS:pose_world_landmarks"),mi(n,"FACE_LANDMARKS:face_landmarks"),mi(n,"LEFT_HAND_LANDMARKS:left_hand_landmarks"),mi(n,"LEFT_HAND_WORLD_LANDMARKS:left_hand_world_landmarks"),mi(n,"RIGHT_HAND_LANDMARKS:right_hand_landmarks"),mi(n,"RIGHT_HAND_WORLD_LANDMARKS:right_hand_world_landmarks"),n.o(e),Nl(i,n),eC(this,i),this.g.attachProtoListener("pose_landmarks",((r,s)=>{N_(r,this.h.poseLandmarks),en(this,s)})),this.g.attachEmptyPacketListener("pose_landmarks",(r=>{en(this,r)})),this.g.attachProtoListener("pose_world_landmarks",((r,s)=>{var o=this.h.poseWorldLandmarks;r=Y1(r),o.push(g2(r)),en(this,s)})),this.g.attachEmptyPacketListener("pose_world_landmarks",(r=>{en(this,r)})),this.outputPoseSegmentationMasks&&(mi(n,"POSE_SEGMENTATION_MASK:pose_segmentation_mask"),dA(this,"pose_segmentation_mask"),this.g.W("pose_segmentation_mask",((r,s)=>{this.h.poseSegmentationMasks=[gA(this,r,!0,!this.C)],en(this,s)})),this.g.attachEmptyPacketListener("pose_segmentation_mask",(r=>{this.h.poseSegmentationMasks=[],en(this,r)}))),this.g.attachProtoListener("face_landmarks",((r,s)=>{N_(r,this.h.faceLandmarks),en(this,s)})),this.g.attachEmptyPacketListener("face_landmarks",(r=>{en(this,r)})),this.outputFaceBlendshapes&&(Ii(i,"extra_blendshapes"),mi(n,"FACE_BLENDSHAPES:extra_blendshapes"),this.g.attachProtoListener("extra_blendshapes",((r,s)=>{var o=this.h.faceBlendshapes;this.outputFaceBlendshapes&&(r=q4(r),o.push(J8(r.g()??[]))),en(this,s)})),this.g.attachEmptyPacketListener("extra_blendshapes",(r=>{en(this,r)}))),this.g.attachProtoListener("left_hand_landmarks",((r,s)=>{N_(r,this.h.leftHandLandmarks),en(this,s)})),this.g.attachEmptyPacketListener("left_hand_landmarks",(r=>{en(this,r)})),this.g.attachProtoListener("left_hand_world_landmarks",((r,s)=>{var o=this.h.leftHandWorldLandmarks;r=Y1(r),o.push(g2(r)),en(this,s)})),this.g.attachEmptyPacketListener("left_hand_world_landmarks",(r=>{en(this,r)})),this.g.attachProtoListener("right_hand_landmarks",((r,s)=>{N_(r,this.h.rightHandLandmarks),en(this,s)})),this.g.attachEmptyPacketListener("right_hand_landmarks",(r=>{en(this,r)})),this.g.attachProtoListener("right_hand_world_landmarks",((r,s)=>{var o=this.h.rightHandWorldLandmarks;r=Y1(r),o.push(g2(r)),en(this,s)})),this.g.attachEmptyPacketListener("right_hand_world_landmarks",(r=>{en(this,r)})),i=i.g(),this.setGraph(new Uint8Array(i),!0)}};wr.prototype.detectForVideo=wr.prototype.F,wr.prototype.detect=wr.prototype.D,wr.prototype.setOptions=wr.prototype.o,wr.createFromModelPath=function(i,e){return di(wr,i,{baseOptions:{modelAssetPath:e}})},wr.createFromModelBuffer=function(i,e){return di(wr,i,{baseOptions:{modelAssetBuffer:e}})},wr.createFromOptions=function(i,e){return di(wr,i,e)},wr.HAND_CONNECTIONS=uL,wr.POSE_CONNECTIONS=p$,wr.FACE_LANDMARKS_LIPS=rL,wr.FACE_LANDMARKS_LEFT_EYE=sL,wr.FACE_LANDMARKS_LEFT_EYEBROW=oL,wr.FACE_LANDMARKS_LEFT_IRIS=u$,wr.FACE_LANDMARKS_RIGHT_EYE=aL,wr.FACE_LANDMARKS_RIGHT_EYEBROW=lL,wr.FACE_LANDMARKS_RIGHT_IRIS=h$,wr.FACE_LANDMARKS_FACE_OVAL=cL,wr.FACE_LANDMARKS_CONTOURS=f$,wr.FACE_LANDMARKS_TESSELATION=d$;var Sl=class extends Ca{constructor(i,e){super(new wc(i,e),"input_image","norm_rect",!0),this.j={classifications:[]},Cn(i=this.h=new $K,0,1,e=new Fr)}get baseOptions(){return wi(this.h,Fr,1)}set baseOptions(i){Cn(this.h,0,1,i)}o(i){return Cn(this.h,0,2,o6(i,wi(this.h,W8,2))),this.l(i)}wa(i,e){return this.j={classifications:[]},Cc(this,i,e),this.j}xa(i,e,t){return this.j={classifications:[]},Ih(this,i,t,e),this.j}m(){var i=new sl;Mr(i,"input_image"),Mr(i,"norm_rect"),Ii(i,"classifications");const e=new Fl;Pu(e,$3e,this.h);const t=new wa;Ol(t,"mediapipe.tasks.vision.image_classifier.ImageClassifierGraph"),yr(t,"IMAGE:input_image"),yr(t,"NORM_RECT:norm_rect"),mi(t,"CLASSIFICATIONS:classifications"),t.o(e),Nl(i,t),this.g.attachProtoListener("classifications",((n,r)=>{this.j=(function(s){const o={classifications:Gf(s,B3e,1).map((a=>{var l;return J8(((l=wi(a,_K,4))==null?void 0:l.g())??[],bu(mc(a,2),0),Sh(a,3))}))};return iw(cp(s,2))!=null&&(o.timestampMs=bu(iw(cp(s,2)),0)),o})(D3e(n)),en(this,r)})),this.g.attachEmptyPacketListener("classifications",(n=>{en(this,n)})),i=i.g(),this.setGraph(new Uint8Array(i),!0)}};Sl.prototype.classifyForVideo=Sl.prototype.xa,Sl.prototype.classify=Sl.prototype.wa,Sl.prototype.setOptions=Sl.prototype.o,Sl.createFromModelPath=function(i,e){return di(Sl,i,{baseOptions:{modelAssetPath:e}})},Sl.createFromModelBuffer=function(i,e){return di(Sl,i,{baseOptions:{modelAssetBuffer:e}})},Sl.createFromOptions=function(i,e){return di(Sl,i,e)};var Wa=class extends Ca{constructor(i,e){super(new wc(i,e),"image_in","norm_rect",!0),this.h=new YK,this.embeddings={embeddings:[]},Cn(i=this.h,0,1,e=new Fr)}get baseOptions(){return wi(this.h,Fr,1)}set baseOptions(i){Cn(this.h,0,1,i)}o(i){var e=this.h,t=wi(this.h,XO,2);return t=t?t.clone():new XO,i.l2Normalize!==void 0?q2(t,1,i.l2Normalize):"l2Normalize"in i&&Ar(t,1),i.quantize!==void 0?q2(t,2,i.quantize):"quantize"in i&&Ar(t,2),Cn(e,0,2,t),this.l(i)}Da(i,e){return Cc(this,i,e),this.embeddings}Ea(i,e,t){return Ih(this,i,t,e),this.embeddings}m(){var i=new sl;Mr(i,"image_in"),Mr(i,"norm_rect"),Ii(i,"embeddings_out");const e=new Fl;Pu(e,Y3e,this.h);const t=new wa;Ol(t,"mediapipe.tasks.vision.image_embedder.ImageEmbedderGraph"),yr(t,"IMAGE:image_in"),yr(t,"NORM_RECT:norm_rect"),mi(t,"EMBEDDINGS:embeddings_out"),t.o(e),Nl(i,t),this.g.attachProtoListener("embeddings_out",((n,r)=>{n=O3e(n),this.embeddings=(function(s){return{embeddings:Gf(s,F3e,1).map((o=>{var l,c;const a={headIndex:bu(mc(o,3),0)??-1,headName:Sh(o,4)??""};if(Xj(o,YO,VI(o,1))!==void 0)o=Om(o=wi(o,YO,VI(o,1)),1,Ep,Fm()),a.floatEmbedding=o.slice();else{const u=new Uint8Array(0);a.quantizedEmbedding=((c=(l=wi(o,k3e,VI(o,2)))==null?void 0:l.ra())==null?void 0:c.ua())??u}return a})),timestampMs:bu(iw(cp(s,2)),0)}})(n),en(this,r)})),this.g.attachEmptyPacketListener("embeddings_out",(n=>{en(this,n)})),i=i.g(),this.setGraph(new Uint8Array(i),!0)}};Wa.cosineSimilarity=function(i,e){if(i.floatEmbedding&&e.floatEmbedding)i=eN(i.floatEmbedding,e.floatEmbedding);else{if(!i.quantizedEmbedding||!e.quantizedEmbedding)throw Error("Cannot compute cosine similarity between quantized and float embeddings.");i=eN(ZO(i.quantizedEmbedding),ZO(e.quantizedEmbedding))}return i},Wa.prototype.embedForVideo=Wa.prototype.Ea,Wa.prototype.embed=Wa.prototype.Da,Wa.prototype.setOptions=Wa.prototype.o,Wa.createFromModelPath=function(i,e){return di(Wa,i,{baseOptions:{modelAssetPath:e}})},Wa.createFromModelBuffer=function(i,e){return di(Wa,i,{baseOptions:{modelAssetBuffer:e}})},Wa.createFromOptions=function(i,e){return di(Wa,i,e)};var uw=class{constructor(i,e,t){this.confidenceMasks=i,this.categoryMask=e,this.qualityScores=t}close(){var i,e;(i=this.confidenceMasks)==null||i.forEach((t=>{t.close()})),(e=this.categoryMask)==null||e.close()}};function yN(i){i.categoryMask=void 0,i.confidenceMasks=void 0,i.qualityScores=void 0}function vN(i){try{const e=new uw(i.confidenceMasks,i.categoryMask,i.qualityScores);if(!i.j)return e;i.j(e)}finally{tC(i)}}uw.prototype.close=uw.prototype.close;var ga=class extends Ca{constructor(i,e){super(new wc(i,e),"image_in","norm_rect",!1),this.s=[],this.outputCategoryMask=!1,this.outputConfidenceMasks=!0,this.h=new q8,this.v=new XK,Cn(this.h,0,3,this.v),Cn(i=this.h,0,1,e=new Fr)}get baseOptions(){return wi(this.h,Fr,1)}set baseOptions(i){Cn(this.h,0,1,i)}o(i){return i.displayNamesLocale!==void 0?Ar(this.h,2,PA(i.displayNamesLocale)):"displayNamesLocale"in i&&Ar(this.h,2),"outputCategoryMask"in i&&(this.outputCategoryMask=i.outputCategoryMask??!1),"outputConfidenceMasks"in i&&(this.outputConfidenceMasks=i.outputConfidenceMasks??!0),super.l(i)}J(){(function(i){var t,n;const e=Gf(i.ga(),wa,1).filter((r=>Sh(r,1).includes("mediapipe.tasks.TensorsToSegmentationCalculator")));if(i.s=[],e.length>1)throw Error("The graph has more than one mediapipe.tasks.TensorsToSegmentationCalculator.");e.length===1&&(((n=(t=wi(e[0],Fl,7))==null?void 0:t.l())==null?void 0:n.g())??new Map).forEach(((r,s)=>{i.s[Number(s)]=Sh(r,1)}))})(this)}ha(i,e,t){const n=typeof e!="function"?e:{};return this.j=typeof e=="function"?e:t,yN(this),Cc(this,i,n),vN(this)}Pa(i,e,t,n){const r=typeof t!="function"?t:{};return this.j=typeof t=="function"?t:n,yN(this),Ih(this,i,r,e),vN(this)}Ha(){return this.s}m(){var i=new sl;Mr(i,"image_in"),Mr(i,"norm_rect");const e=new Fl;Pu(e,JK,this.h);const t=new wa;Ol(t,"mediapipe.tasks.vision.image_segmenter.ImageSegmenterGraph"),yr(t,"IMAGE:image_in"),yr(t,"NORM_RECT:norm_rect"),t.o(e),Nl(i,t),eC(this,i),this.outputConfidenceMasks&&(Ii(i,"confidence_masks"),mi(t,"CONFIDENCE_MASKS:confidence_masks"),dA(this,"confidence_masks"),this.g.fa("confidence_masks",((n,r)=>{this.confidenceMasks=n.map((s=>gA(this,s,!0,!this.j))),en(this,r)})),this.g.attachEmptyPacketListener("confidence_masks",(n=>{this.confidenceMasks=[],en(this,n)}))),this.outputCategoryMask&&(Ii(i,"category_mask"),mi(t,"CATEGORY_MASK:category_mask"),dA(this,"category_mask"),this.g.W("category_mask",((n,r)=>{this.categoryMask=gA(this,n,!1,!this.j),en(this,r)})),this.g.attachEmptyPacketListener("category_mask",(n=>{this.categoryMask=void 0,en(this,n)}))),Ii(i,"quality_scores"),mi(t,"QUALITY_SCORES:quality_scores"),this.g.attachFloatVectorListener("quality_scores",((n,r)=>{this.qualityScores=n,en(this,r)})),this.g.attachEmptyPacketListener("quality_scores",(n=>{this.categoryMask=void 0,en(this,n)})),i=i.g(),this.setGraph(new Uint8Array(i),!0)}};ga.prototype.getLabels=ga.prototype.Ha,ga.prototype.segmentForVideo=ga.prototype.Pa,ga.prototype.segment=ga.prototype.ha,ga.prototype.setOptions=ga.prototype.o,ga.createFromModelPath=function(i,e){return di(ga,i,{baseOptions:{modelAssetPath:e}})},ga.createFromModelBuffer=function(i,e){return di(ga,i,{baseOptions:{modelAssetBuffer:e}})},ga.createFromOptions=function(i,e){return di(ga,i,e)};var hw=class{constructor(i,e,t){this.confidenceMasks=i,this.categoryMask=e,this.qualityScores=t}close(){var i,e;(i=this.confidenceMasks)==null||i.forEach((t=>{t.close()})),(e=this.categoryMask)==null||e.close()}};hw.prototype.close=hw.prototype.close;var i_e=class extends an{constructor(i){super(i)}},A1=[0,ss,-2],fw=[0,wf,-3,Vr,wf,-1],xN=[0,fw],EN=[0,fw,ss,-1],YI=class extends an{constructor(i){super(i)}},_N=[0,wf,-1,Vr],r_e=class extends an{constructor(){super()}},SN=class extends an{constructor(i){super(i)}},c6=[1,2,3,4,5,6,7,8,9,10,14,15],m$=class extends an{constructor(){super()}};m$.prototype.g=X4([0,Ds,[0,c6,Ji,fw,Ji,[0,fw,A1],Ji,xN,Ji,[0,xN,A1],Ji,_N,Ji,[0,wf,-3,Vr,Iu],Ji,[0,wf,-3,Vr],Ji,[0,Wi,wf,-2,Vr,ss,Vr,-1,2,wf,A1],Ji,EN,Ji,[0,EN,A1],wf,A1,Wi,Ji,[0,wf,-3,Vr,A1,-1],Ji,[0,Ds,_N]],Wi,[0,Wi,ss,-1,Vr]]);var uu=class extends Ca{constructor(i,e){super(new wc(i,e),"image_in","norm_rect_in",!1),this.outputCategoryMask=!1,this.outputConfidenceMasks=!0,this.h=new q8,this.s=new XK,Cn(this.h,0,3,this.s),Cn(i=this.h,0,1,e=new Fr)}get baseOptions(){return wi(this.h,Fr,1)}set baseOptions(i){Cn(this.h,0,1,i)}o(i){return"outputCategoryMask"in i&&(this.outputCategoryMask=i.outputCategoryMask??!1),"outputConfidenceMasks"in i&&(this.outputConfidenceMasks=i.outputConfidenceMasks??!0),super.l(i)}ha(i,e,t,n){const r=typeof t!="function"?t:{};this.j=typeof t=="function"?t:n,this.qualityScores=this.categoryMask=this.confidenceMasks=void 0,t=this.B+1,n=new m$;const s=new SN;var o=new i_e;if(wh(o,1,255),Cn(s,0,12,o),e.keypoint&&e.scribble)throw Error("Cannot provide both keypoint and scribble.");if(e.keypoint){var a=new YI;q2(a,3,!0),hn(a,1,e.keypoint.x),hn(a,2,e.keypoint.y),d2(s,5,c6,a)}else{if(!e.scribble)throw Error("Must provide either a keypoint or a scribble.");for(a of(o=new r_e,e.scribble))q2(e=new YI,3,!0),hn(e,1,a.x),hn(e,2,a.y),ow(o,1,YI,e);d2(s,15,c6,o)}ow(n,1,SN,s),this.g.addProtoToStream(n.g(),"drishti.RenderData","roi_in",t),Cc(this,i,r);e:{try{const c=new hw(this.confidenceMasks,this.categoryMask,this.qualityScores);if(!this.j){var l=c;break e}this.j(c)}finally{tC(this)}l=void 0}return l}m(){var i=new sl;Mr(i,"image_in"),Mr(i,"roi_in"),Mr(i,"norm_rect_in");const e=new Fl;Pu(e,JK,this.h);const t=new wa;Ol(t,"mediapipe.tasks.vision.interactive_segmenter.InteractiveSegmenterGraph"),yr(t,"IMAGE:image_in"),yr(t,"ROI:roi_in"),yr(t,"NORM_RECT:norm_rect_in"),t.o(e),Nl(i,t),eC(this,i),this.outputConfidenceMasks&&(Ii(i,"confidence_masks"),mi(t,"CONFIDENCE_MASKS:confidence_masks"),dA(this,"confidence_masks"),this.g.fa("confidence_masks",((n,r)=>{this.confidenceMasks=n.map((s=>gA(this,s,!0,!this.j))),en(this,r)})),this.g.attachEmptyPacketListener("confidence_masks",(n=>{this.confidenceMasks=[],en(this,n)}))),this.outputCategoryMask&&(Ii(i,"category_mask"),mi(t,"CATEGORY_MASK:category_mask"),dA(this,"category_mask"),this.g.W("category_mask",((n,r)=>{this.categoryMask=gA(this,n,!1,!this.j),en(this,r)})),this.g.attachEmptyPacketListener("category_mask",(n=>{this.categoryMask=void 0,en(this,n)}))),Ii(i,"quality_scores"),mi(t,"QUALITY_SCORES:quality_scores"),this.g.attachFloatVectorListener("quality_scores",((n,r)=>{this.qualityScores=n,en(this,r)})),this.g.attachEmptyPacketListener("quality_scores",(n=>{this.categoryMask=void 0,en(this,n)})),i=i.g(),this.setGraph(new Uint8Array(i),!0)}};uu.prototype.segment=uu.prototype.ha,uu.prototype.setOptions=uu.prototype.o,uu.createFromModelPath=function(i,e){return di(uu,i,{baseOptions:{modelAssetPath:e}})},uu.createFromModelBuffer=function(i,e){return di(uu,i,{baseOptions:{modelAssetBuffer:e}})},uu.createFromOptions=function(i,e){return di(uu,i,e)};var wl=class extends Ca{constructor(i,e){super(new wc(i,e),"input_frame_gpu","norm_rect",!1),this.j={detections:[]},Cn(i=this.h=new ZK,0,1,e=new Fr)}get baseOptions(){return wi(this.h,Fr,1)}set baseOptions(i){Cn(this.h,0,1,i)}o(i){return i.displayNamesLocale!==void 0?Ar(this.h,2,PA(i.displayNamesLocale)):"displayNamesLocale"in i&&Ar(this.h,2),i.maxResults!==void 0?wh(this.h,3,i.maxResults):"maxResults"in i&&Ar(this.h,3),i.scoreThreshold!==void 0?hn(this.h,4,i.scoreThreshold):"scoreThreshold"in i&&Ar(this.h,4),i.categoryAllowlist!==void 0?aw(this.h,5,i.categoryAllowlist):"categoryAllowlist"in i&&Ar(this.h,5),i.categoryDenylist!==void 0?aw(this.h,6,i.categoryDenylist):"categoryDenylist"in i&&Ar(this.h,6),this.l(i)}D(i,e){return this.j={detections:[]},Cc(this,i,e),this.j}F(i,e,t){return this.j={detections:[]},Ih(this,i,t,e),this.j}m(){var i=new sl;Mr(i,"input_frame_gpu"),Mr(i,"norm_rect"),Ii(i,"detections");const e=new Fl;Pu(e,q3e,this.h);const t=new wa;Ol(t,"mediapipe.tasks.vision.ObjectDetectorGraph"),yr(t,"IMAGE:input_frame_gpu"),yr(t,"NORM_RECT:norm_rect"),mi(t,"DETECTIONS:detections"),t.o(e),Nl(i,t),this.g.attachProtoVectorListener("detections",((n,r)=>{for(const s of n)n=wK(s),this.j.detections.push(t$(n));en(this,r)})),this.g.attachEmptyPacketListener("detections",(n=>{en(this,n)})),i=i.g(),this.setGraph(new Uint8Array(i),!0)}};wl.prototype.detectForVideo=wl.prototype.F,wl.prototype.detect=wl.prototype.D,wl.prototype.setOptions=wl.prototype.o,wl.createFromModelPath=async function(i,e){return di(wl,i,{baseOptions:{modelAssetPath:e}})},wl.createFromModelBuffer=function(i,e){return di(wl,i,{baseOptions:{modelAssetBuffer:e}})},wl.createFromOptions=function(i,e){return di(wl,i,e)};var u6=class{constructor(i,e,t){this.landmarks=i,this.worldLandmarks=e,this.segmentationMasks=t}close(){var i;(i=this.segmentationMasks)==null||i.forEach((e=>{e.close()}))}};function wN(i){i.landmarks=[],i.worldLandmarks=[],i.segmentationMasks=void 0}function CN(i){try{const e=new u6(i.landmarks,i.worldLandmarks,i.segmentationMasks);if(!i.s)return e;i.s(e)}finally{tC(i)}}u6.prototype.close=u6.prototype.close;var ja=class extends Ca{constructor(i,e){super(new wc(i,e),"image_in","norm_rect",!1),this.landmarks=[],this.worldLandmarks=[],this.outputSegmentationMasks=!1,Cn(i=this.h=new e$,0,1,e=new Fr),this.v=new jK,Cn(this.h,0,3,this.v),this.j=new WK,Cn(this.h,0,2,this.j),wh(this.j,4,1),hn(this.j,2,.5),hn(this.v,2,.5),hn(this.h,4,.5)}get baseOptions(){return wi(this.h,Fr,1)}set baseOptions(i){Cn(this.h,0,1,i)}o(i){return"numPoses"in i&&wh(this.j,4,i.numPoses??1),"minPoseDetectionConfidence"in i&&hn(this.j,2,i.minPoseDetectionConfidence??.5),"minTrackingConfidence"in i&&hn(this.h,4,i.minTrackingConfidence??.5),"minPosePresenceConfidence"in i&&hn(this.v,2,i.minPosePresenceConfidence??.5),"outputSegmentationMasks"in i&&(this.outputSegmentationMasks=i.outputSegmentationMasks??!1),this.l(i)}D(i,e,t){const n=typeof e!="function"?e:{};return this.s=typeof e=="function"?e:t,wN(this),Cc(this,i,n),CN(this)}F(i,e,t,n){const r=typeof t!="function"?t:{};return this.s=typeof t=="function"?t:n,wN(this),Ih(this,i,r,e),CN(this)}m(){var i=new sl;Mr(i,"image_in"),Mr(i,"norm_rect"),Ii(i,"normalized_landmarks"),Ii(i,"world_landmarks"),Ii(i,"segmentation_masks");const e=new Fl;Pu(e,J3e,this.h);const t=new wa;Ol(t,"mediapipe.tasks.vision.pose_landmarker.PoseLandmarkerGraph"),yr(t,"IMAGE:image_in"),yr(t,"NORM_RECT:norm_rect"),mi(t,"NORM_LANDMARKS:normalized_landmarks"),mi(t,"WORLD_LANDMARKS:world_landmarks"),t.o(e),Nl(i,t),eC(this,i),this.g.attachProtoVectorListener("normalized_landmarks",((n,r)=>{this.landmarks=[];for(const s of n)n=Lx(s),this.landmarks.push(Z4(n));en(this,r)})),this.g.attachEmptyPacketListener("normalized_landmarks",(n=>{this.landmarks=[],en(this,n)})),this.g.attachProtoVectorListener("world_landmarks",((n,r)=>{this.worldLandmarks=[];for(const s of n)n=Y1(s),this.worldLandmarks.push(g2(n));en(this,r)})),this.g.attachEmptyPacketListener("world_landmarks",(n=>{this.worldLandmarks=[],en(this,n)})),this.outputSegmentationMasks&&(mi(t,"SEGMENTATION_MASK:segmentation_masks"),dA(this,"segmentation_masks"),this.g.fa("segmentation_masks",((n,r)=>{this.segmentationMasks=n.map((s=>gA(this,s,!0,!this.s))),en(this,r)})),this.g.attachEmptyPacketListener("segmentation_masks",(n=>{this.segmentationMasks=[],en(this,n)}))),i=i.g(),this.setGraph(new Uint8Array(i),!0)}};ja.prototype.detectForVideo=ja.prototype.F,ja.prototype.detect=ja.prototype.D,ja.prototype.setOptions=ja.prototype.o,ja.createFromModelPath=function(i,e){return di(ja,i,{baseOptions:{modelAssetPath:e}})},ja.createFromModelBuffer=function(i,e){return di(ja,i,{baseOptions:{modelAssetBuffer:e}})},ja.createFromOptions=function(i,e){return di(ja,i,e)},ja.POSE_CONNECTIONS=p$;const s_e=Object.freeze(Object.defineProperty({__proto__:null,FaceDetector:_l,FaceLandmarker:Qr,FaceStylizer:cu,FilesetResolver:Cm,GestureRecognizer:Qa,HandLandmarker:Va,HolisticLandmarker:wr,ImageClassifier:Sl,ImageEmbedder:Wa,ImageSegmenter:ga,ImageSegmenterResult:uw,InteractiveSegmenter:uu,InteractiveSegmenterResult:hw,MPImage:qs,MPMask:Xs,ObjectDetector:wl,PoseLandmarker:ja,VisionTaskRunner:Ca},Symbol.toStringTag,{value:"Module"}));</script>
    <style rel="stylesheet" crossorigin>@import"https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap";*,:before,:after{--tw-border-spacing-x: 0;--tw-border-spacing-y: 0;--tw-translate-x: 0;--tw-translate-y: 0;--tw-rotate: 0;--tw-skew-x: 0;--tw-skew-y: 0;--tw-scale-x: 1;--tw-scale-y: 1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness: proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width: 0px;--tw-ring-offset-color: #fff;--tw-ring-color: rgb(59 130 246 / .5);--tw-ring-offset-shadow: 0 0 #0000;--tw-ring-shadow: 0 0 #0000;--tw-shadow: 0 0 #0000;--tw-shadow-colored: 0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }::backdrop{--tw-border-spacing-x: 0;--tw-border-spacing-y: 0;--tw-translate-x: 0;--tw-translate-y: 0;--tw-rotate: 0;--tw-skew-x: 0;--tw-skew-y: 0;--tw-scale-x: 1;--tw-scale-y: 1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness: proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width: 0px;--tw-ring-offset-color: #fff;--tw-ring-color: rgb(59 130 246 / .5);--tw-ring-offset-shadow: 0 0 #0000;--tw-ring-shadow: 0 0 #0000;--tw-shadow: 0 0 #0000;--tw-shadow-colored: 0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }*,:before,:after{box-sizing:border-box;border-width:0;border-style:solid;border-color:#e5e7eb}:before,:after{--tw-content: ""}html,:host{line-height:1.5;-webkit-text-size-adjust:100%;-moz-tab-size:4;-o-tab-size:4;tab-size:4;font-family:ui-sans-serif,system-ui,sans-serif,"Apple Color Emoji","Segoe UI Emoji",Segoe UI Symbol,"Noto Color Emoji";font-feature-settings:normal;font-variation-settings:normal;-webkit-tap-highlight-color:transparent}body{margin:0;line-height:inherit}hr{height:0;color:inherit;border-top-width:1px}abbr:where([title]){-webkit-text-decoration:underline dotted;text-decoration:underline dotted}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}b,strong{font-weight:bolder}code,kbd,samp,pre{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace;font-feature-settings:normal;font-variation-settings:normal;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}table{text-indent:0;border-color:inherit;border-collapse:collapse}button,input,optgroup,select,textarea{font-family:inherit;font-feature-settings:inherit;font-variation-settings:inherit;font-size:100%;font-weight:inherit;line-height:inherit;letter-spacing:inherit;color:inherit;margin:0;padding:0}button,select{text-transform:none}button,input:where([type=button]),input:where([type=reset]),input:where([type=submit]){-webkit-appearance:button;background-color:transparent;background-image:none}:-moz-focusring{outline:auto}:-moz-ui-invalid{box-shadow:none}progress{vertical-align:baseline}::-webkit-inner-spin-button,::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}blockquote,dl,dd,h1,h2,h3,h4,h5,h6,hr,figure,p,pre{margin:0}fieldset{margin:0;padding:0}legend{padding:0}ol,ul,menu{list-style:none;margin:0;padding:0}dialog{padding:0}textarea{resize:vertical}input::-moz-placeholder,textarea::-moz-placeholder{opacity:1;color:#9ca3af}input::placeholder,textarea::placeholder{opacity:1;color:#9ca3af}button,[role=button]{cursor:pointer}:disabled{cursor:default}img,svg,video,canvas,audio,iframe,embed,object{display:block;vertical-align:middle}img,video{max-width:100%;height:auto}[hidden]:where(:not([hidden=until-found])){display:none}.absolute{position:absolute}.relative{position:relative}.-bottom-4{bottom:-1rem}.-left-4{left:-1rem}.-right-1\.5{right:-.375rem}.-right-2{right:-.5rem}.-right-3{right:-.75rem}.-right-4{right:-1rem}.-top-1\.5{top:-.375rem}.-top-2{top:-.5rem}.-top-4{top:-1rem}.left-1\/2{left:50%}.top-1\/2{top:50%}.mx-1{margin-left:.25rem;margin-right:.25rem}.mx-4{margin-left:1rem;margin-right:1rem}.mx-auto{margin-left:auto;margin-right:auto}.mb-2{margin-bottom:.5rem}.mb-3{margin-bottom:.75rem}.mb-4{margin-bottom:1rem}.mb-6{margin-bottom:1.5rem}.mb-8{margin-bottom:2rem}.ml-1{margin-left:.25rem}.ml-4{margin-left:1rem}.mr-2{margin-right:.5rem}.mt-1{margin-top:.25rem}.mt-2{margin-top:.5rem}.mt-3{margin-top:.75rem}.mt-4{margin-top:1rem}.mt-6{margin-top:1.5rem}.mt-8{margin-top:2rem}.inline-block{display:inline-block}.flex{display:flex}.grid{display:grid}.h-0\.5{height:.125rem}.h-1\.5{height:.375rem}.h-12{height:3rem}.h-16{height:4rem}.h-2{height:.5rem}.h-4{height:1rem}.h-5{height:1.25rem}.min-h-screen{min-height:100vh}.w-1\.5{width:.375rem}.w-12{width:3rem}.w-16{width:4rem}.w-2{width:.5rem}.w-4{width:1rem}.w-5{width:1.25rem}.w-6{width:1.5rem}.w-full{width:100%}.max-w-2xl{max-width:42rem}.max-w-3xl{max-width:48rem}.flex-1{flex:1 1 0%}.-translate-x-1\/2{--tw-translate-x: -50%;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.-translate-y-1\/2{--tw-translate-y: -50%;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.transform{transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.cursor-not-allowed{cursor:not-allowed}.cursor-pointer{cursor:pointer}.list-inside{list-style-position:inside}.list-decimal{list-style-type:decimal}.grid-cols-3{grid-template-columns:repeat(3,minmax(0,1fr))}.grid-cols-4{grid-template-columns:repeat(4,minmax(0,1fr))}.flex-col{flex-direction:column}.flex-wrap{flex-wrap:wrap}.items-start{align-items:flex-start}.items-center{align-items:center}.justify-end{justify-content:flex-end}.justify-center{justify-content:center}.justify-between{justify-content:space-between}.gap-0\.5{gap:.125rem}.gap-1{gap:.25rem}.gap-1\.5{gap:.375rem}.gap-2{gap:.5rem}.gap-3{gap:.75rem}.gap-4{gap:1rem}.gap-6{gap:1.5rem}.space-y-1>:not([hidden])~:not([hidden]){--tw-space-y-reverse: 0;margin-top:calc(.25rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(.25rem * var(--tw-space-y-reverse))}.space-y-2>:not([hidden])~:not([hidden]){--tw-space-y-reverse: 0;margin-top:calc(.5rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(.5rem * var(--tw-space-y-reverse))}.space-y-3>:not([hidden])~:not([hidden]){--tw-space-y-reverse: 0;margin-top:calc(.75rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(.75rem * var(--tw-space-y-reverse))}.space-y-4>:not([hidden])~:not([hidden]){--tw-space-y-reverse: 0;margin-top:calc(1rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(1rem * var(--tw-space-y-reverse))}.rounded{border-radius:.25rem}.rounded-2xl{border-radius:1rem}.rounded-full{border-radius:9999px}.rounded-lg{border-radius:.5rem}.rounded-xl{border-radius:.75rem}.border{border-width:1px}.border-2{border-width:2px}.border-4{border-width:4px}.border-t{border-top-width:1px}.border-blue-400{--tw-border-opacity: 1;border-color:rgb(96 165 250 / var(--tw-border-opacity, 1))}.border-blue-500{--tw-border-opacity: 1;border-color:rgb(59 130 246 / var(--tw-border-opacity, 1))}.border-gray-200{--tw-border-opacity: 1;border-color:rgb(229 231 235 / var(--tw-border-opacity, 1))}.border-gray-300{--tw-border-opacity: 1;border-color:rgb(209 213 219 / var(--tw-border-opacity, 1))}.border-green-200{--tw-border-opacity: 1;border-color:rgb(187 247 208 / var(--tw-border-opacity, 1))}.border-green-400{--tw-border-opacity: 1;border-color:rgb(74 222 128 / var(--tw-border-opacity, 1))}.border-green-500{--tw-border-opacity: 1;border-color:rgb(34 197 94 / var(--tw-border-opacity, 1))}.border-orange-400{--tw-border-opacity: 1;border-color:rgb(251 146 60 / var(--tw-border-opacity, 1))}.border-purple-200{--tw-border-opacity: 1;border-color:rgb(233 213 255 / var(--tw-border-opacity, 1))}.border-purple-300{--tw-border-opacity: 1;border-color:rgb(216 180 254 / var(--tw-border-opacity, 1))}.border-purple-400{--tw-border-opacity: 1;border-color:rgb(192 132 252 / var(--tw-border-opacity, 1))}.border-purple-500{--tw-border-opacity: 1;border-color:rgb(168 85 247 / var(--tw-border-opacity, 1))}.border-red-200{--tw-border-opacity: 1;border-color:rgb(254 202 202 / var(--tw-border-opacity, 1))}.border-red-500{--tw-border-opacity: 1;border-color:rgb(239 68 68 / var(--tw-border-opacity, 1))}.border-teal-200{--tw-border-opacity: 1;border-color:rgb(153 246 228 / var(--tw-border-opacity, 1))}.border-yellow-200{--tw-border-opacity: 1;border-color:rgb(254 240 138 / var(--tw-border-opacity, 1))}.bg-blue-100{--tw-bg-opacity: 1;background-color:rgb(219 234 254 / var(--tw-bg-opacity, 1))}.bg-blue-50{--tw-bg-opacity: 1;background-color:rgb(239 246 255 / var(--tw-bg-opacity, 1))}.bg-blue-500{--tw-bg-opacity: 1;background-color:rgb(59 130 246 / var(--tw-bg-opacity, 1))}.bg-blue-600{--tw-bg-opacity: 1;background-color:rgb(37 99 235 / var(--tw-bg-opacity, 1))}.bg-gray-100{--tw-bg-opacity: 1;background-color:rgb(243 244 246 / var(--tw-bg-opacity, 1))}.bg-gray-200{--tw-bg-opacity: 1;background-color:rgb(229 231 235 / var(--tw-bg-opacity, 1))}.bg-gray-50{--tw-bg-opacity: 1;background-color:rgb(249 250 251 / var(--tw-bg-opacity, 1))}.bg-gray-600{--tw-bg-opacity: 1;background-color:rgb(75 85 99 / var(--tw-bg-opacity, 1))}.bg-gray-700{--tw-bg-opacity: 1;background-color:rgb(55 65 81 / var(--tw-bg-opacity, 1))}.bg-gray-800{--tw-bg-opacity: 1;background-color:rgb(31 41 55 / var(--tw-bg-opacity, 1))}.bg-green-100{--tw-bg-opacity: 1;background-color:rgb(220 252 231 / var(--tw-bg-opacity, 1))}.bg-green-50{--tw-bg-opacity: 1;background-color:rgb(240 253 244 / var(--tw-bg-opacity, 1))}.bg-green-500{--tw-bg-opacity: 1;background-color:rgb(34 197 94 / var(--tw-bg-opacity, 1))}.bg-green-600{--tw-bg-opacity: 1;background-color:rgb(22 163 74 / var(--tw-bg-opacity, 1))}.bg-indigo-50{--tw-bg-opacity: 1;background-color:rgb(238 242 255 / var(--tw-bg-opacity, 1))}.bg-indigo-500{--tw-bg-opacity: 1;background-color:rgb(99 102 241 / var(--tw-bg-opacity, 1))}.bg-orange-100{--tw-bg-opacity: 1;background-color:rgb(255 237 213 / var(--tw-bg-opacity, 1))}.bg-orange-50{--tw-bg-opacity: 1;background-color:rgb(255 247 237 / var(--tw-bg-opacity, 1))}.bg-purple-100{--tw-bg-opacity: 1;background-color:rgb(243 232 255 / var(--tw-bg-opacity, 1))}.bg-purple-50{--tw-bg-opacity: 1;background-color:rgb(250 245 255 / var(--tw-bg-opacity, 1))}.bg-purple-500{--tw-bg-opacity: 1;background-color:rgb(168 85 247 / var(--tw-bg-opacity, 1))}.bg-purple-600{--tw-bg-opacity: 1;background-color:rgb(147 51 234 / var(--tw-bg-opacity, 1))}.bg-red-400{--tw-bg-opacity: 1;background-color:rgb(248 113 113 / var(--tw-bg-opacity, 1))}.bg-red-50{--tw-bg-opacity: 1;background-color:rgb(254 242 242 / var(--tw-bg-opacity, 1))}.bg-red-500{--tw-bg-opacity: 1;background-color:rgb(239 68 68 / var(--tw-bg-opacity, 1))}.bg-teal-50{--tw-bg-opacity: 1;background-color:rgb(240 253 250 / var(--tw-bg-opacity, 1))}.bg-teal-500{--tw-bg-opacity: 1;background-color:rgb(20 184 166 / var(--tw-bg-opacity, 1))}.bg-white{--tw-bg-opacity: 1;background-color:rgb(255 255 255 / var(--tw-bg-opacity, 1))}.bg-yellow-50{--tw-bg-opacity: 1;background-color:rgb(254 252 232 / var(--tw-bg-opacity, 1))}.bg-gradient-to-br{background-image:linear-gradient(to bottom right,var(--tw-gradient-stops))}.from-teal-50{--tw-gradient-from: #f0fdfa var(--tw-gradient-from-position);--tw-gradient-to: rgb(240 253 250 / 0) var(--tw-gradient-to-position);--tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to)}.to-cyan-100{--tw-gradient-to: #cffafe var(--tw-gradient-to-position)}.p-2{padding:.5rem}.p-3{padding:.75rem}.p-4{padding:1rem}.p-6{padding:1.5rem}.px-2{padding-left:.5rem;padding-right:.5rem}.px-4{padding-left:1rem;padding-right:1rem}.px-6{padding-left:1.5rem;padding-right:1.5rem}.py-1{padding-top:.25rem;padding-bottom:.25rem}.py-1\.5{padding-top:.375rem;padding-bottom:.375rem}.py-2{padding-top:.5rem;padding-bottom:.5rem}.py-4{padding-top:1rem;padding-bottom:1rem}.pt-4{padding-top:1rem}.text-left{text-align:left}.text-center{text-align:center}.text-right{text-align:right}.font-mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace}.text-2xl{font-size:1.5rem;line-height:2rem}.text-3xl{font-size:1.875rem;line-height:2.25rem}.text-4xl{font-size:2.25rem;line-height:2.5rem}.text-6xl{font-size:3.75rem;line-height:1}.text-lg{font-size:1.125rem;line-height:1.75rem}.text-sm{font-size:.875rem;line-height:1.25rem}.text-xl{font-size:1.25rem;line-height:1.75rem}.text-xs{font-size:.75rem;line-height:1rem}.font-bold{font-weight:700}.font-medium{font-weight:500}.font-semibold{font-weight:600}.uppercase{text-transform:uppercase}.text-blue-600{--tw-text-opacity: 1;color:rgb(37 99 235 / var(--tw-text-opacity, 1))}.text-blue-700{--tw-text-opacity: 1;color:rgb(29 78 216 / var(--tw-text-opacity, 1))}.text-blue-800{--tw-text-opacity: 1;color:rgb(30 64 175 / var(--tw-text-opacity, 1))}.text-gray-500{--tw-text-opacity: 1;color:rgb(107 114 128 / var(--tw-text-opacity, 1))}.text-gray-600{--tw-text-opacity: 1;color:rgb(75 85 99 / var(--tw-text-opacity, 1))}.text-gray-700{--tw-text-opacity: 1;color:rgb(55 65 81 / var(--tw-text-opacity, 1))}.text-gray-800{--tw-text-opacity: 1;color:rgb(31 41 55 / var(--tw-text-opacity, 1))}.text-green-600{--tw-text-opacity: 1;color:rgb(22 163 74 / var(--tw-text-opacity, 1))}.text-green-700{--tw-text-opacity: 1;color:rgb(21 128 61 / var(--tw-text-opacity, 1))}.text-green-800{--tw-text-opacity: 1;color:rgb(22 101 52 / var(--tw-text-opacity, 1))}.text-indigo-600{--tw-text-opacity: 1;color:rgb(79 70 229 / var(--tw-text-opacity, 1))}.text-indigo-800{--tw-text-opacity: 1;color:rgb(55 48 163 / var(--tw-text-opacity, 1))}.text-indigo-900{--tw-text-opacity: 1;color:rgb(49 46 129 / var(--tw-text-opacity, 1))}.text-orange-600{--tw-text-opacity: 1;color:rgb(234 88 12 / var(--tw-text-opacity, 1))}.text-orange-700{--tw-text-opacity: 1;color:rgb(194 65 12 / var(--tw-text-opacity, 1))}.text-orange-800{--tw-text-opacity: 1;color:rgb(154 52 18 / var(--tw-text-opacity, 1))}.text-purple-400{--tw-text-opacity: 1;color:rgb(192 132 252 / var(--tw-text-opacity, 1))}.text-purple-600{--tw-text-opacity: 1;color:rgb(147 51 234 / var(--tw-text-opacity, 1))}.text-purple-700{--tw-text-opacity: 1;color:rgb(126 34 206 / var(--tw-text-opacity, 1))}.text-purple-800{--tw-text-opacity: 1;color:rgb(107 33 168 / var(--tw-text-opacity, 1))}.text-red-600{--tw-text-opacity: 1;color:rgb(220 38 38 / var(--tw-text-opacity, 1))}.text-red-700{--tw-text-opacity: 1;color:rgb(185 28 28 / var(--tw-text-opacity, 1))}.text-teal-600{--tw-text-opacity: 1;color:rgb(13 148 136 / var(--tw-text-opacity, 1))}.text-teal-700{--tw-text-opacity: 1;color:rgb(15 118 110 / var(--tw-text-opacity, 1))}.text-teal-800{--tw-text-opacity: 1;color:rgb(17 94 89 / var(--tw-text-opacity, 1))}.text-teal-900{--tw-text-opacity: 1;color:rgb(19 78 74 / var(--tw-text-opacity, 1))}.text-white{--tw-text-opacity: 1;color:rgb(255 255 255 / var(--tw-text-opacity, 1))}.text-yellow-600{--tw-text-opacity: 1;color:rgb(202 138 4 / var(--tw-text-opacity, 1))}.text-yellow-700{--tw-text-opacity: 1;color:rgb(161 98 7 / var(--tw-text-opacity, 1))}.text-yellow-800{--tw-text-opacity: 1;color:rgb(133 77 14 / var(--tw-text-opacity, 1))}.text-yellow-900{--tw-text-opacity: 1;color:rgb(113 63 18 / var(--tw-text-opacity, 1))}.underline{text-decoration-line:underline}.opacity-50{opacity:.5}.opacity-60{opacity:.6}.shadow{--tw-shadow: 0 1px 3px 0 rgb(0 0 0 / .1), 0 1px 2px -1px rgb(0 0 0 / .1);--tw-shadow-colored: 0 1px 3px 0 var(--tw-shadow-color), 0 1px 2px -1px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}.shadow-2xl{--tw-shadow: 0 25px 50px -12px rgb(0 0 0 / .25);--tw-shadow-colored: 0 25px 50px -12px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}.shadow-sm{--tw-shadow: 0 1px 2px 0 rgb(0 0 0 / .05);--tw-shadow-colored: 0 1px 2px 0 var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}.ring-2{--tw-ring-offset-shadow: var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);--tw-ring-shadow: var(--tw-ring-inset) 0 0 0 calc(2px + var(--tw-ring-offset-width)) var(--tw-ring-color);box-shadow:var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow, 0 0 #0000)}.ring-blue-200{--tw-ring-opacity: 1;--tw-ring-color: rgb(191 219 254 / var(--tw-ring-opacity, 1))}.ring-green-200{--tw-ring-opacity: 1;--tw-ring-color: rgb(187 247 208 / var(--tw-ring-opacity, 1))}.ring-purple-200{--tw-ring-opacity: 1;--tw-ring-color: rgb(233 213 255 / var(--tw-ring-opacity, 1))}.filter{filter:var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow)}.transition-all{transition-property:all;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s}.transition-colors{transition-property:color,background-color,border-color,text-decoration-color,fill,stroke;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s}.duration-300{transition-duration:.3s}*{font-family:Inter,sans-serif}.skip-link{position:absolute;top:-40px;left:0;background:#f36b22;color:#fff;padding:8px;text-decoration:none;z-index:100}.skip-link:focus{top:0}*:focus-visible{outline:2px solid #f36b22;outline-offset:2px}.atom{position:relative;display:inline-flex;align-items:center;justify-content:center;height:4rem;width:4rem;border-radius:9999px;border-width:4px;font-size:1.25rem;line-height:1.75rem;font-weight:700}.atom.central{--tw-border-opacity: 1;border-color:rgb(59 130 246 / var(--tw-border-opacity, 1));--tw-bg-opacity: 1;background-color:rgb(219 234 254 / var(--tw-bg-opacity, 1));--tw-text-opacity: 1;color:rgb(30 64 175 / var(--tw-text-opacity, 1))}.atom.surrounding{--tw-border-opacity: 1;border-color:rgb(34 197 94 / var(--tw-border-opacity, 1));--tw-bg-opacity: 1;background-color:rgb(220 252 231 / var(--tw-bg-opacity, 1));--tw-text-opacity: 1;color:rgb(22 101 52 / var(--tw-text-opacity, 1))}.atom.hydrogen{height:2.5rem;width:2.5rem;--tw-border-opacity: 1;border-color:rgb(156 163 175 / var(--tw-border-opacity, 1));--tw-bg-opacity: 1;background-color:rgb(243 244 246 / var(--tw-bg-opacity, 1));font-size:.875rem;line-height:1.25rem;--tw-text-opacity: 1;color:rgb(55 65 81 / var(--tw-text-opacity, 1))}.electron-dot{position:absolute;height:.5rem;width:.5rem;border-radius:9999px;background-color:currentColor}.electron-dot.top{top:-.25rem;left:50%;--tw-translate-x: -50%;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.electron-dot.bottom{bottom:-.25rem;left:50%;--tw-translate-x: -50%;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.electron-dot.left{top:50%;left:-.25rem;--tw-translate-y: -50%;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.electron-dot.right{top:50%;right:-.25rem;--tw-translate-y: -50%;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.electron-dot.top-left{top:-.125rem;left:-.125rem}.electron-dot.top-right{top:-.125rem;right:-.125rem}.electron-dot.bottom-left{bottom:-.125rem;left:-.125rem}.electron-dot.bottom-right{bottom:-.125rem;right:-.125rem}.lone-pair{position:absolute;display:flex;gap:.125rem}.lone-pair.horizontal{flex-direction:row}.lone-pair.vertical{flex-direction:column}.bond-line{position:absolute;--tw-bg-opacity: 1;background-color:rgb(31 41 55 / var(--tw-bg-opacity, 1))}.bond-line.single{height:3px}.bond-line.double{height:8px;background:linear-gradient(to bottom,#1f2937 0%,#1f2937 30%,transparent 30%,transparent 70%,#1f2937 70%,#1f2937 100%)}.bond-line.triple{height:12px;background:linear-gradient(to bottom,#1f2937 0%,#1f2937 20%,transparent 20%,transparent 40%,#1f2937 40%,#1f2937 60%,transparent 60%,transparent 80%,#1f2937 80%,#1f2937 100%)}.lewis-container{position:relative;border-radius:.75rem;border-width:2px;--tw-border-opacity: 1;border-color:rgb(229 231 235 / var(--tw-border-opacity, 1));--tw-bg-opacity: 1;background-color:rgb(255 255 255 / var(--tw-bg-opacity, 1));padding:2rem;min-height:300px}.valence-counter{display:flex;align-items:center;gap:.5rem;border-radius:.5rem;border-width:1px;--tw-border-opacity: 1;border-color:rgb(229 231 235 / var(--tw-border-opacity, 1));--tw-bg-opacity: 1;background-color:rgb(249 250 251 / var(--tw-bg-opacity, 1));padding:.75rem}.valence-dot{height:.75rem;width:.75rem;border-radius:9999px;--tw-bg-opacity: 1;background-color:rgb(59 130 246 / var(--tw-bg-opacity, 1))}.valence-dot.used{--tw-bg-opacity: 1;background-color:rgb(209 213 219 / var(--tw-bg-opacity, 1))}.periodic-mini{display:grid;gap:.25rem;font-size:.75rem;line-height:1rem;grid-template-columns:repeat(18,1fr)}.element-cell{cursor:pointer;border-radius:.25rem;border-width:1px;padding:.25rem;text-align:center;transition-property:all;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s}.element-cell:hover{--tw-border-opacity: 1;border-color:rgb(251 146 60 / var(--tw-border-opacity, 1));--tw-bg-opacity: 1;background-color:rgb(255 247 237 / var(--tw-bg-opacity, 1))}.element-cell.selected{--tw-border-opacity: 1;border-color:rgb(249 115 22 / var(--tw-border-opacity, 1));--tw-bg-opacity: 1;background-color:rgb(255 237 213 / var(--tw-bg-opacity, 1));--tw-ring-offset-shadow: var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);--tw-ring-shadow: var(--tw-ring-inset) 0 0 0 calc(2px + var(--tw-ring-offset-width)) var(--tw-ring-color);box-shadow:var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow, 0 0 #0000);--tw-ring-opacity: 1;--tw-ring-color: rgb(254 215 170 / var(--tw-ring-opacity, 1))}.element-cell.group-1{--tw-border-opacity: 1;border-color:rgb(254 202 202 / var(--tw-border-opacity, 1));--tw-bg-opacity: 1;background-color:rgb(254 242 242 / var(--tw-bg-opacity, 1))}.element-cell.group-2{--tw-border-opacity: 1;border-color:rgb(254 215 170 / var(--tw-border-opacity, 1));--tw-bg-opacity: 1;background-color:rgb(255 247 237 / var(--tw-bg-opacity, 1))}.element-cell.group-13{--tw-border-opacity: 1;border-color:rgb(254 240 138 / var(--tw-border-opacity, 1));--tw-bg-opacity: 1;background-color:rgb(254 252 232 / var(--tw-bg-opacity, 1))}.element-cell.group-14{--tw-border-opacity: 1;border-color:rgb(187 247 208 / var(--tw-border-opacity, 1));--tw-bg-opacity: 1;background-color:rgb(240 253 244 / var(--tw-bg-opacity, 1))}.element-cell.group-15{--tw-border-opacity: 1;border-color:rgb(153 246 228 / var(--tw-border-opacity, 1));--tw-bg-opacity: 1;background-color:rgb(240 253 250 / var(--tw-bg-opacity, 1))}.element-cell.group-16{--tw-border-opacity: 1;border-color:rgb(191 219 254 / var(--tw-border-opacity, 1));--tw-bg-opacity: 1;background-color:rgb(239 246 255 / var(--tw-bg-opacity, 1))}.element-cell.group-17{--tw-border-opacity: 1;border-color:rgb(233 213 255 / var(--tw-border-opacity, 1));--tw-bg-opacity: 1;background-color:rgb(250 245 255 / var(--tw-bg-opacity, 1))}.element-cell.group-18{--tw-border-opacity: 1;border-color:rgb(229 231 235 / var(--tw-border-opacity, 1));--tw-bg-opacity: 1;background-color:rgb(249 250 251 / var(--tw-bg-opacity, 1))}.formal-charge{position:absolute;top:-.5rem;right:-.5rem;display:flex;height:1.25rem;width:1.25rem;align-items:center;justify-content:center;border-radius:9999px;font-size:.75rem;line-height:1rem;font-weight:700}.formal-charge.positive{--tw-bg-opacity: 1;background-color:rgb(239 68 68 / var(--tw-bg-opacity, 1));--tw-text-opacity: 1;color:rgb(255 255 255 / var(--tw-text-opacity, 1))}.formal-charge.negative{--tw-bg-opacity: 1;background-color:rgb(59 130 246 / var(--tw-bg-opacity, 1));--tw-text-opacity: 1;color:rgb(255 255 255 / var(--tw-text-opacity, 1))}.structure-builder{position:relative;min-height:16rem;border-radius:.75rem;--tw-bg-opacity: 1;background-color:rgb(249 250 251 / var(--tw-bg-opacity, 1));padding:1rem}.drop-zone{border-radius:.5rem;border-width:2px;border-style:dashed;--tw-border-opacity: 1;border-color:rgb(209 213 219 / var(--tw-border-opacity, 1));padding:1rem;text-align:center;--tw-text-opacity: 1;color:rgb(107 114 128 / var(--tw-text-opacity, 1))}.drop-zone.active{--tw-border-opacity: 1;border-color:rgb(251 146 60 / var(--tw-border-opacity, 1));--tw-bg-opacity: 1;background-color:rgb(255 247 237 / var(--tw-bg-opacity, 1))}@keyframes pulse-dot{0%,to{transform:scale(1);opacity:1}50%{transform:scale(1.3);opacity:.7}}@keyframes draw-bond{0%{width:0}to{width:100%}}.animate-pulse-dot{animation:pulse-dot 1s ease-in-out infinite}.animate-draw-bond{animation:draw-bond .3s ease-out forwards}@media(prefers-reduced-motion:reduce){*{animation-duration:.01ms!important;animation-iteration-count:1!important;transition-duration:.01ms!important}}input::-webkit-outer-spin-button,input::-webkit-inner-spin-button{-webkit-appearance:none;margin:0}input[type=number]{-moz-appearance:textfield}.hover\:border-blue-400:hover{--tw-border-opacity: 1;border-color:rgb(96 165 250 / var(--tw-border-opacity, 1))}.hover\:border-green-400:hover{--tw-border-opacity: 1;border-color:rgb(74 222 128 / var(--tw-border-opacity, 1))}.hover\:border-purple-400:hover{--tw-border-opacity: 1;border-color:rgb(192 132 252 / var(--tw-border-opacity, 1))}.hover\:bg-blue-100:hover{--tw-bg-opacity: 1;background-color:rgb(219 234 254 / var(--tw-bg-opacity, 1))}.hover\:bg-blue-50:hover{--tw-bg-opacity: 1;background-color:rgb(239 246 255 / var(--tw-bg-opacity, 1))}.hover\:bg-blue-600:hover{--tw-bg-opacity: 1;background-color:rgb(37 99 235 / var(--tw-bg-opacity, 1))}.hover\:bg-gray-300:hover{--tw-bg-opacity: 1;background-color:rgb(209 213 219 / var(--tw-bg-opacity, 1))}.hover\:bg-green-100:hover{--tw-bg-opacity: 1;background-color:rgb(220 252 231 / var(--tw-bg-opacity, 1))}.hover\:bg-green-50:hover{--tw-bg-opacity: 1;background-color:rgb(240 253 244 / var(--tw-bg-opacity, 1))}.hover\:bg-green-600:hover{--tw-bg-opacity: 1;background-color:rgb(22 163 74 / var(--tw-bg-opacity, 1))}.hover\:bg-indigo-600:hover{--tw-bg-opacity: 1;background-color:rgb(79 70 229 / var(--tw-bg-opacity, 1))}.hover\:bg-purple-100:hover{--tw-bg-opacity: 1;background-color:rgb(243 232 255 / var(--tw-bg-opacity, 1))}.hover\:bg-purple-50:hover{--tw-bg-opacity: 1;background-color:rgb(250 245 255 / var(--tw-bg-opacity, 1))}.hover\:bg-purple-600:hover{--tw-bg-opacity: 1;background-color:rgb(147 51 234 / var(--tw-bg-opacity, 1))}.hover\:bg-teal-600:hover{--tw-bg-opacity: 1;background-color:rgb(13 148 136 / var(--tw-bg-opacity, 1))}.hover\:text-gray-800:hover{--tw-text-opacity: 1;color:rgb(31 41 55 / var(--tw-text-opacity, 1))}.hover\:text-green-800:hover{--tw-text-opacity: 1;color:rgb(22 101 52 / var(--tw-text-opacity, 1))}.hover\:text-purple-800:hover{--tw-text-opacity: 1;color:rgb(107 33 168 / var(--tw-text-opacity, 1))}.hover\:text-red-500:hover{--tw-text-opacity: 1;color:rgb(239 68 68 / var(--tw-text-opacity, 1))}.focus\:border-blue-500:focus{--tw-border-opacity: 1;border-color:rgb(59 130 246 / var(--tw-border-opacity, 1))}.focus\:outline-none:focus{outline:2px solid transparent;outline-offset:2px}.disabled\:bg-gray-300:disabled{--tw-bg-opacity: 1;background-color:rgb(209 213 219 / var(--tw-bg-opacity, 1))}@media(min-width:768px){.md\:grid-cols-8{grid-template-columns:repeat(8,minmax(0,1fr))}.md\:p-8{padding:2rem}.md\:text-4xl{font-size:2.25rem;line-height:2.5rem}}</style>
  </head>
  <body>
    <div id="root"></div>
  </body>
</html>
