<!DOCTYPE html>
<html lang="is">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gas Law Challenge - Kvenno Efnafr√¶√∞i</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Kvenno Brand Colors */
        :root {
            --kvenno-orange: #f36b22;
            --kvenno-orange-dark: #d95a1a;
        }

        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
                'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
                sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            background: #f9fafb;
        }

        /* Remove number input spinners */
        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        input[type=number] {
            -moz-appearance: textfield;
        }

        /* Header Styles */
        .site-header {
            background: white;
            border-bottom: 2px solid #e5e7eb;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        }

        @media (max-width: 768px) {
            .site-header {
                position: sticky;
                top: 0;
                z-index: 1000;
            }
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1rem;
            height: 60px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .site-logo {
            font-size: 1.25rem;
            font-weight: bold;
            color: var(--kvenno-orange);
            text-decoration: none;
        }

        .site-logo:hover {
            color: var(--kvenno-orange-dark);
        }

        .header-btn {
            background: white;
            border: 2px solid var(--kvenno-orange);
            color: var(--kvenno-orange);
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-left: 0.5rem;
        }

        .header-btn:hover {
            background: var(--kvenno-orange);
            color: white;
        }

        /* Back Button */
        .back-btn {
            background: white;
            border: 2px solid var(--kvenno-orange);
            color: var(--kvenno-orange);
            padding: 8px 16px;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
            font-size: 0.875rem;
            margin: 0 1rem 1rem 1rem;
        }

        .back-btn:hover {
            background: var(--kvenno-orange);
            color: white;
        }

        /* Canvas for Particle Animation */
        #gasCanvas {
            border-radius: 12px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        /* Animations */
        @keyframes pulse-success {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .pulse-success {
            animation: pulse-success 0.6s ease-in-out;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        .shake {
            animation: shake 0.4s ease-in-out;
        }

        @keyframes celebration {
            0%, 100% { transform: translateY(0); }
            25% { transform: translateY(-5px); }
            75% { transform: translateY(-10px); }
        }

        /* Pressure Indicator Borders */
        .pressure-low {
            border: 3px solid #3b82f6 !important;
        }

        .pressure-normal {
            border: 4px solid #22c55e !important;
        }

        .pressure-high {
            border: 6px solid #ef4444 !important;
        }

        /* Mobile Optimizations */
        @media (max-width: 768px) {
            #gasCanvas {
                max-width: 100%;
                height: auto;
            }

            .header-content {
                font-size: 0.875rem;
            }
        }

        /* Loading Animation */
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading {
            border: 3px solid #f3f4f6;
            border-top: 3px solid var(--kvenno-orange);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }

        /* Hint box styling */
        .hint-box {
            background: #fef3c7;
            border-left: 4px solid #eab308;
            padding: 1rem;
            border-radius: 0.5rem;
            margin: 1rem 0;
        }

        /* Solution box styling */
        .solution-box {
            background: #dbeafe;
            border-left: 4px solid #3b82f6;
            padding: 1rem;
            border-radius: 0.5rem;
            margin: 1rem 0;
        }

        /* Feedback styling */
        .feedback-correct {
            background: #dcfce7;
            border-left: 4px solid #22c55e;
            padding: 1rem;
            border-radius: 0.5rem;
            margin: 1rem 0;
        }

        .feedback-incorrect {
            background: #fee2e2;
            border-left: 4px solid #ef4444;
            padding: 1rem;
            border-radius: 0.5rem;
            margin: 1rem 0;
        }

        .monospace {
            font-family: 'Courier New', monospace;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // ============================================
        // CONFIGURATION & CONSTANTS
        // ============================================

        const R = 0.08206; // Gas constant in L¬∑atm/(mol¬∑K)

        const TRANSLATIONS = {
            practiceMode: "√Üfingarhamur",
            challengeMode: "Keppnishamur",
            score: "Stig",
            streak: "Runa",
            time: "T√≠mi",
            difficulty: "Erfi√∞leikastig",
            checkAnswer: "Athuga svar",
            nextQuestion: "N√¶sta spurning",
            showSolution: "S√Ωna lausn",
            hint: "V√≠sbending",
            tryAgain: "Reyndu aftur",
            correct: "R√©tt! Vel gert!",
            incorrect: "Rangt",
            timeout: "T√≠minn rann √∫t!",
            instructions: "Lei√∞beiningar",
            help: "Hj√°lp",
            back: "Til baka",
            easy: "Au√∞velt",
            medium: "Mi√∞lungs",
            hard: "Erfitt",
            given: "Gefi√∞",
            find: "Finna",
            yourAnswer: "√ûitt svar",
            solution: "Lausn",
            step: "Skref",
            startGame: "Byrja leik",
            playAgain: "Spila aftur",
            backToMenu: "Til baka √≠ valmynd",
            questionsAnswered: "Spurningar svara√∞ar",
            accuracy: "N√°kv√¶mni",
            avgTime: "Me√∞alt√≠mi",
            bestStreak: "Besta runa",
            finalScore: "Lokaeinkunn",
            gameOver: "Leik loki√∞!",
            hintsRemaining: "V√≠sbendingar eftir",
        };

        // ============================================
        // PARTICLE SYSTEM FOR GAS VISUALIZATION
        // ============================================

        class Particle {
            constructor(x, y, containerWidth, containerHeight) {
                this.x = x;
                this.y = y;
                this.radius = 4;
                this.color = '#ffffff';
                // Random velocity
                this.vx = (Math.random() - 0.5) * 4;
                this.vy = (Math.random() - 0.5) * 4;
                this.celebrating = false;
            }

            update(containerWidth, containerHeight, temperature, celebrating = false) {
                this.celebrating = celebrating;

                // Speed factor based on temperature (kinetic theory: v ‚àù ‚àöT)
                const speedFactor = Math.sqrt(temperature / 273);

                // Add celebration bounce
                const celebrationFactor = celebrating ? 1.5 : 1;

                // Update position
                this.x += this.vx * speedFactor * celebrationFactor;
                this.y += this.vy * speedFactor * celebrationFactor;

                // Bounce off walls
                if (this.x - this.radius <= 0 || this.x + this.radius >= containerWidth) {
                    this.vx *= -1;
                    this.x = Math.max(this.radius, Math.min(containerWidth - this.radius, this.x));
                }

                if (this.y - this.radius <= 0 || this.y + this.radius >= containerHeight) {
                    this.vy *= -1;
                    this.y = Math.max(this.radius, Math.min(containerHeight - this.radius, this.y));
                }
            }

            draw(ctx) {
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                ctx.fillStyle = this.celebrating ? '#ffd700' : this.color;
                ctx.fill();

                // Add glow effect
                ctx.shadowBlur = this.celebrating ? 15 : 10;
                ctx.shadowColor = this.celebrating ? '#ffd700' : this.color;
                ctx.fill();
                ctx.shadowBlur = 0;
            }
        }

        // ============================================
        // QUESTION BANK - All 30 Questions
        // ============================================

        const QUESTION_BANK = [
            // EASY QUESTIONS (10)
            {
                id: 1,
                difficulty: 'easy',
                scenario: {
                    title: "Afm√¶lisbl√∂√∞ra",
                    titleEn: "Birthday Balloon",
                    icon: "üéà",
                    description: "√û√∫ ert a√∞ bl√°sa upp bl√∂√∞ru fyrir afm√¶lisveislu. Lofti√∞ √≠ andanum √æ√≠num er um 37¬∞C.",
                    descriptionEn: "You're blowing up a balloon for a birthday party. The air from your breath is about 37¬∞C."
                },
                given: {
                    P: { value: 1.0, unit: "atm" },
                    T: { value: 310, unit: "K", celsius: 37 },
                    n: { value: 0.15, unit: "mol" }
                },
                find: "V",
                answer: {
                    value: 3.82,
                    unit: "L",
                    tolerance: 0.08
                }
            },
            {
                id: 2,
                difficulty: 'easy',
                scenario: {
                    title: "Hj√≥lbar√∞i",
                    titleEn: "Bicycle Tire",
                    icon: "üö¥",
                    description: "√û√∫ ert a√∞ athuga loft√ær√Ωsting √≠ hj√≥lbar√∞a hj√≥lrei√∞arinnar √æinnar a√∞ morgni.",
                    descriptionEn: "You're checking the tire pressure on your bicycle in the morning."
                },
                given: {
                    P: { value: 2.5, unit: "atm" },
                    V: { value: 2.0, unit: "L" },
                    T: { value: 288, unit: "K", celsius: 15 }
                },
                find: "n",
                answer: {
                    value: 0.211,
                    unit: "mol",
                    tolerance: 0.004
                }
            },
            {
                id: 3,
                difficulty: 'easy',
                scenario: {
                    title: "K√≥laflaska",
                    titleEn: "Soda Bottle",
                    icon: "ü•§",
                    description: "K√≥laflaska inniheldur koltv√≠s√Ωring undir √ær√Ωstingi.",
                    descriptionEn: "A soda bottle contains carbon dioxide under pressure."
                },
                given: {
                    V: { value: 2.0, unit: "L" },
                    T: { value: 298, unit: "K", celsius: 25 },
                    n: { value: 0.30, unit: "mol" }
                },
                find: "P",
                answer: {
                    value: 3.67,
                    unit: "atm",
                    tolerance: 0.07
                }
            },
            {
                id: 4,
                difficulty: 'easy',
                scenario: {
                    title: "Ranns√≥knarstofa",
                    titleEn: "Lab Experiment",
                    icon: "üß™",
                    description: "√ç efnafr√¶√∞istofu ertu a√∞ vinna me√∞ lofteinangrun vi√∞ sta√∞alskilyr√∞i.",
                    descriptionEn: "In the chemistry lab, you're working with a gas sample at standard conditions."
                },
                given: {
                    P: { value: 1.0, unit: "atm" },
                    V: { value: 5.0, unit: "L" },
                    n: { value: 0.20, unit: "mol" }
                },
                find: "T",
                answer: {
                    value: 305,
                    unit: "K",
                    tolerance: 6
                }
            },
            {
                id: 5,
                difficulty: 'easy',
                scenario: {
                    title: "H√©l√≠umbl√∂√∞ra",
                    titleEn: "Helium Balloon",
                    icon: "üéà",
                    description: "H√©l√≠umbl√∂√∞ra fl√Ωtur √≠ herbergi vi√∞ stofuhita.",
                    descriptionEn: "A helium balloon floats in a room at room temperature."
                },
                given: {
                    P: { value: 1.0, unit: "atm" },
                    V: { value: 4.5, unit: "L" },
                    T: { value: 293, unit: "K", celsius: 20 }
                },
                find: "n",
                answer: {
                    value: 0.187,
                    unit: "mol",
                    tolerance: 0.004
                }
            },
            {
                id: 6,
                difficulty: 'easy',
                scenario: {
                    title: "K√∂rfubolti",
                    titleEn: "Basketball",
                    icon: "üèÄ",
                    description: "√û√∫ ert a√∞ d√¶la lofti √≠ k√∂rfubolta.",
                    descriptionEn: "You're pumping air into a basketball."
                },
                given: {
                    V: { value: 7.5, unit: "L" },
                    T: { value: 300, unit: "K", celsius: 27 },
                    n: { value: 0.40, unit: "mol" }
                },
                find: "P",
                answer: {
                    value: 1.31,
                    unit: "atm",
                    tolerance: 0.03
                }
            },
            {
                id: 7,
                difficulty: 'easy',
                scenario: {
                    title: "B√≠ladekk √° sumri",
                    titleEn: "Car Tire Summer",
                    icon: "üöó",
                    description: "B√≠ladekk √° heitum sumardegi. S√≥lin hefur hita√∞ lofti√∞ innandyra.",
                    descriptionEn: "A car tire on a hot summer day. The sun has heated the air inside."
                },
                given: {
                    P: { value: 2.2, unit: "atm" },
                    V: { value: 30, unit: "L" },
                    T: { value: 323, unit: "K", celsius: 50 }
                },
                find: "n",
                answer: {
                    value: 2.49,
                    unit: "mol",
                    tolerance: 0.05
                }
            },
            {
                id: 8,
                difficulty: 'easy',
                scenario: {
                    title: "Sl√∂kkvit√¶ki",
                    titleEn: "Fire Extinguisher",
                    icon: "üßØ",
                    description: "Sl√∂kkvit√¶ki inniheldur koltv√≠s√Ωring vi√∞ herberghita.",
                    descriptionEn: "A fire extinguisher contains carbon dioxide at room temperature."
                },
                given: {
                    P: { value: 5.0, unit: "atm" },
                    n: { value: 1.5, unit: "mol" },
                    T: { value: 293, unit: "K", celsius: 20 }
                },
                find: "V",
                answer: {
                    value: 7.23,
                    unit: "L",
                    tolerance: 0.14
                }
            },
            {
                id: 9,
                difficulty: 'easy',
                scenario: {
                    title: "M√°lmbl√∂√∞ra",
                    titleEn: "Mylar Balloon",
                    icon: "üéà",
                    description: "M√°lmbl√∂√∞ra sem er full af lofti heldur laginu √≠ nokkra daga.",
                    descriptionEn: "A mylar balloon filled with air keeps its shape for several days."
                },
                given: {
                    V: { value: 3.0, unit: "L" },
                    T: { value: 295, unit: "K", celsius: 22 },
                    n: { value: 0.12, unit: "mol" }
                },
                find: "P",
                answer: {
                    value: 0.97,
                    unit: "atm",
                    tolerance: 0.02
                }
            },
            {
                id: 10,
                difficulty: 'easy',
                scenario: {
                    title: "Hitun lofttegunda",
                    titleEn: "Warming Gas",
                    icon: "üå°Ô∏è",
                    description: "Lofteinangrun er hitu√∞ √∫r 20¬∞C √≠ 100¬∞C vi√∞ fasta r√∫mm√°l.",
                    descriptionEn: "A gas sample is heated from 20¬∞C to 100¬∞C at constant volume."
                },
                given: {
                    V: { value: 2.0, unit: "L" },
                    T: { value: 373, unit: "K", celsius: 100 },
                    n: { value: 0.10, unit: "mol" }
                },
                find: "P",
                answer: {
                    value: 1.53,
                    unit: "atm",
                    tolerance: 0.03
                }
            },
            // MEDIUM QUESTIONS (12)
            {
                id: 11,
                difficulty: 'medium',
                scenario: {
                    title: "S√∫refnistanki kafara",
                    titleEn: "Scuba Tank",
                    icon: "ü§ø",
                    description: "Kafari notar s√∫refnistanka √° 20 metra d√Ωpi √æar sem √ær√Ωstingur er 3.0 atm.",
                    descriptionEn: "A scuba diver uses an oxygen tank at 20 meters depth where pressure is 3.0 atm."
                },
                given: {
                    P: { value: 3.0, unit: "atm" },
                    V: { value: 12.0, unit: "L" },
                    T: { value: 283, unit: "K", celsius: 10 }
                },
                find: "n",
                answer: {
                    value: 1.55,
                    unit: "mol",
                    tolerance: 0.03
                }
            },
            {
                id: 12,
                difficulty: 'medium',
                scenario: {
                    title: "Loftheitt bl√∂√∞ra",
                    titleEn: "Hot Air Balloon",
                    icon: "üéà",
                    description: "Loftheitt bl√∂√∞ra hitnar til a√∞ r√≠sa √≠ lofti√∞.",
                    descriptionEn: "A hot air balloon is heated to rise into the air."
                },
                given: {
                    P: { value: 0.95, unit: "atm" },
                    n: { value: 150, unit: "mol" },
                    T: { value: 373, unit: "K", celsius: 100 }
                },
                find: "V",
                answer: {
                    value: 4836,
                    unit: "L",
                    tolerance: 97
                }
            },
            {
                id: 13,
                difficulty: 'medium',
                scenario: {
                    title: "Loftp√∫√∞i b√≠ls",
                    titleEn: "Car Airbag",
                    icon: "üí•",
                    description: "Loftp√∫√∞i √≠ b√≠l b√≥lgnar hratt √∫t vi√∞ √°rekstur.",
                    descriptionEn: "A car airbag inflates rapidly during a collision."
                },
                given: {
                    V: { value: 65, unit: "L" },
                    T: { value: 353, unit: "K", celsius: 80 },
                    n: { value: 2.5, unit: "mol" }
                },
                find: "P",
                answer: {
                    value: 1.12,
                    unit: "atm",
                    tolerance: 0.02
                }
            },
            {
                id: 14,
                difficulty: 'medium',
                scenario: {
                    title: "Fjallganga",
                    titleEn: "Mountain Climb",
                    icon: "üèîÔ∏è",
                    description: "√Å 3000 metra h√¶√∞ l√¶kkar loft√ær√Ωstingur √≠ um 0.7 atm.",
                    descriptionEn: "At 3000 meters altitude, air pressure drops to about 0.7 atm."
                },
                given: {
                    P: { value: 0.70, unit: "atm" },
                    V: { value: 25, unit: "L" },
                    n: { value: 0.85, unit: "mol" }
                },
                find: "T",
                answer: {
                    value: 251,
                    unit: "K",
                    tolerance: 5
                }
            },
            {
                id: 15,
                difficulty: 'medium',
                scenario: {
                    title: "Pr√≥pangastanki",
                    titleEn: "Propane Tank",
                    icon: "‚õΩ",
                    description: "Pr√≥pangas tank fyrir grilli√∞ inniheldur loftkennd pr√≥pan.",
                    descriptionEn: "A propane tank for the grill contains gaseous propane above the liquid."
                },
                given: {
                    P: { value: 8.0, unit: "atm" },
                    V: { value: 20, unit: "L" },
                    T: { value: 298, unit: "K", celsius: 25 }
                },
                find: "n",
                answer: {
                    value: 6.55,
                    unit: "mol",
                    tolerance: 0.13
                }
            },
            {
                id: 16,
                difficulty: 'medium',
                scenario: {
                    title: "Kafb√°tur",
                    titleEn: "Submarine",
                    icon: "üåä",
                    description: "Ranns√≥knarkafb√°tur √° 100 metra d√Ωpi √æar sem P = 11 atm.",
                    descriptionEn: "A research submarine at 100 meters depth where P = 11 atm."
                },
                given: {
                    P: { value: 11.0, unit: "atm" },
                    n: { value: 3.5, unit: "mol" },
                    T: { value: 277, unit: "K", celsius: 4 }
                },
                find: "V",
                answer: {
                    value: 7.23,
                    unit: "L",
                    tolerance: 0.14
                }
            },
            {
                id: 17,
                difficulty: 'medium',
                scenario: {
                    title: "√ûj√∂ppu√∞ lofttanka",
                    titleEn: "Compressed Air",
                    icon: "üöÄ",
                    description: "√ûj√∂ppu√∞ lofttanka fyrir i√∞na√∞arnotkun.",
                    descriptionEn: "Compressed air tank for industrial use."
                },
                given: {
                    V: { value: 50, unit: "L" },
                    T: { value: 293, unit: "K", celsius: 20 },
                    n: { value: 8.0, unit: "mol" }
                },
                find: "P",
                answer: {
                    value: 3.85,
                    unit: "atm",
                    tolerance: 0.08
                }
            },
            {
                id: 18,
                difficulty: 'medium',
                scenario: {
                    title: "K√∂ld geymsla",
                    titleEn: "Cryogenic Storage",
                    icon: "‚ùÑÔ∏è",
                    description: "K√∂ld geymsla fyrir lofttegundir vi√∞ mj√∂g l√°gan hita.",
                    descriptionEn: "Cryogenic storage for gases at very low temperature."
                },
                given: {
                    P: { value: 2.0, unit: "atm" },
                    V: { value: 15, unit: "L" },
                    T: { value: 200, unit: "K", celsius: -73 }
                },
                find: "n",
                answer: {
                    value: 1.83,
                    unit: "mol",
                    tolerance: 0.04
                }
            },
            {
                id: 19,
                difficulty: 'medium',
                scenario: {
                    title: "S√∫refnistanki sp√≠tala",
                    titleEn: "Medical Oxygen",
                    icon: "üè•",
                    description: "S√∫refnistanki √≠ sp√≠tala fyrir sj√∫klinga.",
                    descriptionEn: "Oxygen tank in a hospital for patients."
                },
                given: {
                    P: { value: 10.0, unit: "atm" },
                    V: { value: 40, unit: "L" },
                    T: { value: 293, unit: "K", celsius: 20 }
                },
                find: "n",
                answer: {
                    value: 16.6,
                    unit: "mol",
                    tolerance: 0.3
                }
            },
            {
                id: 20,
                difficulty: 'medium',
                scenario: {
                    title: "Bunsen brennari",
                    titleEn: "Bunsen Burner",
                    icon: "üî•",
                    description: "N√°tt√∫rugasteygir √≠ ranns√≥knarstofueldav√©l.",
                    descriptionEn: "Natural gas burner in a laboratory Bunsen burner."
                },
                given: {
                    n: { value: 0.50, unit: "mol" },
                    T: { value: 298, unit: "K", celsius: 25 },
                    P: { value: 1.2, unit: "atm" }
                },
                find: "V",
                answer: {
                    value: 10.2,
                    unit: "L",
                    tolerance: 0.2
                }
            },
            {
                id: 21,
                difficulty: 'medium',
                scenario: {
                    title: "Sk√≠√∞asv√¶√∞i",
                    titleEn: "Ski Lift Altitude",
                    icon: "üéø",
                    description: "√Å 2500 m h√¶√∞ √≠ sk√≠√∞asv√¶√∞i √æar sem P = 0.75 atm.",
                    descriptionEn: "At 2500 m altitude in a ski resort where P = 0.75 atm."
                },
                given: {
                    P: { value: 0.75, unit: "atm" },
                    V: { value: 30, unit: "L" },
                    T: { value: 268, unit: "K", celsius: -5 }
                },
                find: "n",
                answer: {
                    value: 1.02,
                    unit: "mol",
                    tolerance: 0.02
                }
            },
            {
                id: 22,
                difficulty: 'medium',
                scenario: {
                    title: "Hitakerfi",
                    titleEn: "Thermal Expansion",
                    icon: "üå°Ô∏è",
                    description: "Hitakerfi hitar loft √≠ h√∫si fr√° 15¬∞C √≠ 25¬∞C.",
                    descriptionEn: "A heating system warms air in a house from 15¬∞C to 25¬∞C."
                },
                given: {
                    P: { value: 1.0, unit: "atm" },
                    T: { value: 298, unit: "K", celsius: 25 },
                    n: { value: 8.5, unit: "mol" }
                },
                find: "V",
                answer: {
                    value: 208,
                    unit: "L",
                    tolerance: 4
                }
            },
            // HARD QUESTIONS (8)
            {
                id: 23,
                difficulty: 'hard',
                scenario: {
                    title: "Ve√∞urbl√∂√∞ra",
                    titleEn: "Weather Balloon",
                    icon: "üéà‚òÅÔ∏è",
                    description: "Ve√∞urbl√∂√∞ra h√¶kkar √≠ 30 km h√¶√∞ √æar sem P = 0.012 atm.",
                    descriptionEn: "A weather balloon rises to 30 km altitude where P = 0.012 atm."
                },
                given: {
                    P: { value: 0.012, unit: "atm" },
                    V: { value: 500, unit: "L" },
                    n: { value: 2.5, unit: "mol" }
                },
                find: "T",
                answer: {
                    value: 29.2,
                    unit: "K",
                    tolerance: 0.6
                }
            },
            {
                id: 24,
                difficulty: 'hard',
                scenario: {
                    title: "I√∞na√∞argass√≠lindar",
                    titleEn: "Industrial Cylinder",
                    icon: "üè≠",
                    description: "I√∞na√∞arlofttanka me√∞ h√°√æj√∂ppu√∞u k√∂fnunarefni.",
                    descriptionEn: "Industrial gas cylinder with highly compressed nitrogen."
                },
                given: {
                    P: { value: 150, unit: "atm" },
                    V: { value: 50, unit: "L" },
                    T: { value: 293, unit: "K", celsius: 20 }
                },
                find: "n",
                answer: {
                    value: 312,
                    unit: "mol",
                    tolerance: 6
                }
            },
            {
                id: 25,
                difficulty: 'hard',
                scenario: {
                    title: "Dj√∫pk√∂fun",
                    titleEn: "Deep Sea Dive",
                    icon: "üåä",
                    description: "Kafb√°tur √° 1000 metra d√Ωpi √æar sem P = 100 atm.",
                    descriptionEn: "Submarine at 1000 meters depth where P = 100 atm."
                },
                given: {
                    P: { value: 100, unit: "atm" },
                    n: { value: 15, unit: "mol" },
                    T: { value: 277, unit: "K", celsius: 4 }
                },
                find: "V",
                answer: {
                    value: 3.41,
                    unit: "L",
                    tolerance: 0.07
                }
            },
            {
                id: 26,
                difficulty: 'hard',
                scenario: {
                    title: "Geimfatna√∞ur",
                    titleEn: "Space Suit",
                    icon: "üöÄ",
                    description: "S√∫refniskerfi √≠ geimf√∂tum geimfara.",
                    descriptionEn: "Oxygen system in an astronaut's space suit."
                },
                given: {
                    V: { value: 5.0, unit: "L" },
                    T: { value: 293, unit: "K", celsius: 20 },
                    n: { value: 1.2, unit: "mol" }
                },
                find: "P",
                answer: {
                    value: 5.77,
                    unit: "atm",
                    tolerance: 0.12
                }
            },
            {
                id: 27,
                difficulty: 'hard',
                scenario: {
                    title: "Amm√≥n√≠akframlei√∞sla",
                    titleEn: "Ammonia Synthesis",
                    icon: "üè≠",
                    description: "Haber-a√∞fer√∞ til a√∞ b√∫a til amm√≥n√≠ak vi√∞ h√°an √ær√Ωsting.",
                    descriptionEn: "Haber process for ammonia production at high pressure."
                },
                given: {
                    P: { value: 200, unit: "atm" },
                    V: { value: 100, unit: "L" },
                    T: { value: 723, unit: "K", celsius: 450 }
                },
                find: "n",
                answer: {
                    value: 337,
                    unit: "mol",
                    tolerance: 7
                }
            },
            {
                id: 28,
                difficulty: 'hard',
                scenario: {
                    title: "Ofurkraftmikil CO‚ÇÇ",
                    titleEn: "Supercritical CO‚ÇÇ",
                    icon: "üî¨",
                    description: "Ofurkraftmikill koltv√≠s√Ωringur √≠ vinnsluferli.",
                    descriptionEn: "Supercritical carbon dioxide in an industrial process."
                },
                given: {
                    P: { value: 80, unit: "atm" },
                    n: { value: 10, unit: "mol" },
                    T: { value: 323, unit: "K", celsius: 50 }
                },
                find: "V",
                answer: {
                    value: 3.31,
                    unit: "L",
                    tolerance: 0.07
                }
            },
            {
                id: 29,
                difficulty: 'hard',
                scenario: {
                    title: "Flj√≥tandi k√∂fnunarefni",
                    titleEn: "Liquid Nitrogen",
                    icon: "‚ùÑÔ∏è",
                    description: "Flj√≥tandi k√∂fnunarefni gufar upp vi√∞ -196¬∞C.",
                    descriptionEn: "Liquid nitrogen boiling off at -196¬∞C."
                },
                given: {
                    P: { value: 1.0, unit: "atm" },
                    V: { value: 20, unit: "L" },
                    T: { value: 77, unit: "K", celsius: -196 }
                },
                find: "n",
                answer: {
                    value: 3.17,
                    unit: "mol",
                    tolerance: 0.06
                }
            },
            {
                id: 30,
                difficulty: 'hard',
                scenario: {
                    title: "Ja√∞ar geimkvers",
                    titleEn: "Edge of Space",
                    icon: "üèîÔ∏è‚òÅÔ∏è",
                    description: "√ç 40 km h√¶√∞ (vi√∞ ja√∞ar geimkvers) √æar sem P = 0.003 atm.",
                    descriptionEn: "At 40 km altitude (edge of space) where P = 0.003 atm."
                },
                given: {
                    P: { value: 0.003, unit: "atm" },
                    V: { value: 1000, unit: "L" },
                    n: { value: 1.5, unit: "mol" }
                },
                find: "T",
                answer: {
                    value: 24.4,
                    unit: "K",
                    tolerance: 0.5
                }
            }
        ];

        // ============================================
        // GAS LAW CALCULATION FUNCTIONS
        // ============================================

        const solveGasLaw = (question) => {
            const { given, find } = question;

            switch(find) {
                case 'P':
                    // P = nRT/V
                    return (given.n.value * R * given.T.value) / given.V.value;
                case 'V':
                    // V = nRT/P
                    return (given.n.value * R * given.T.value) / given.P.value;
                case 'T':
                    // T = PV/(nR)
                    return (given.P.value * given.V.value) / (given.n.value * R);
                case 'n':
                    // n = PV/(RT)
                    return (given.P.value * given.V.value) / (R * given.T.value);
                default:
                    return 0;
            }
        };

        const getSolutionSteps = (question) => {
            const { given, find, answer } = question;
            const steps = [];

            // Step 1: Formula
            steps.push({
                label: "Jafna / Equation",
                content: "PV = nRT"
            });

            // Step 2: Rearrangement
            let rearranged = "";
            switch(find) {
                case 'P':
                    rearranged = "P = nRT/V";
                    break;
                case 'V':
                    rearranged = "V = nRT/P";
                    break;
                case 'T':
                    rearranged = "T = PV/(nR)";
                    break;
                case 'n':
                    rearranged = "n = PV/(RT)";
                    break;
            }
            steps.push({
                label: "Endurr√∂√∞un / Rearrangement",
                content: rearranged
            });

            // Step 3: Substitution
            let substitution = "";
            switch(find) {
                case 'P':
                    substitution = `P = (${given.n.value})(${R})(${given.T.value}) / ${given.V.value}`;
                    break;
                case 'V':
                    substitution = `V = (${given.n.value})(${R})(${given.T.value}) / ${given.P.value}`;
                    break;
                case 'T':
                    substitution = `T = (${given.P.value})(${given.V.value}) / [(${given.n.value})(${R})]`;
                    break;
                case 'n':
                    substitution = `n = (${given.P.value})(${given.V.value}) / [(${R})(${given.T.value})]`;
                    break;
            }
            steps.push({
                label: "Setja inn gildi / Substitution",
                content: substitution
            });

            // Step 4: Calculation
            const calculated = solveGasLaw(question);
            steps.push({
                label: "√ötreikningur / Calculation",
                content: `${find} = ${calculated.toFixed(2)} ${answer.unit}`
            });

            return steps;
        };

        const getHintText = (level, question) => {
            const { find } = question;

            switch(level) {
                case 1:
                    return `√û√∫ √æarft a√∞ leysa fyrir ${find}. Endurra√∞a√∞u PV = nRT til a√∞ f√° ${find} eitt og s√©r. / You need to solve for ${find}. Rearrange PV = nRT to get ${find} alone.`;
                case 2:
                    let formula = "";
                    switch(find) {
                        case 'P': formula = "P = nRT/V"; break;
                        case 'V': formula = "V = nRT/P"; break;
                        case 'T': formula = "T = PV/(nR)"; break;
                        case 'n': formula = "n = PV/(RT)"; break;
                    }
                    return `Nota√∞u j√∂fnuna / Use the equation: ${formula}`;
                case 3:
                    const { given } = question;
                    let sub = "";
                    switch(find) {
                        case 'P':
                            sub = `P = (${given.n.value})(${R})(${given.T.value}) / ${given.V.value}`;
                            break;
                        case 'V':
                            sub = `V = (${given.n.value})(${R})(${given.T.value}) / ${given.P.value}`;
                            break;
                        case 'T':
                            sub = `T = (${given.P.value})(${given.V.value}) / [(${given.n.value})(${R})]`;
                            break;
                        case 'n':
                            sub = `n = (${given.P.value})(${given.V.value}) / [(${R})(${given.T.value})]`;
                            break;
                    }
                    return `Settu inn gildin / Substitute values: ${sub}`;
                case 4:
                    const answer = solveGasLaw(question);
                    return `Svari√∞ er n√°l√¶gt / The answer is close to: ${answer.toFixed(1)} ${question.answer.unit}`;
                default:
                    return "";
            }
        };

        // ============================================
        // MAIN GAME COMPONENT
        // ============================================

        const GasLawChallenge = () => {
            // State management
            const [gameState, setGameState] = useState({
                screen: 'menu', // 'menu', 'playing', 'results'
                mode: null, // 'practice' or 'challenge'
                difficulty: 'easy',
                currentQuestion: null,
                questionNumber: 0,
                score: 0,
                streak: 0,
                bestStreak: 0,
                hintsUsed: 0,
                hintsRemaining: 3,
                timeRemaining: 90,
                userAnswer: '',
                feedback: null,
                showHint: false,
                hintLevel: 0,
                showSolution: false,
                isCorrect: null,
                totalQuestions: 0,
                correctAnswers: 0,
                totalTime: 0,
                questionStartTime: null,
                celebrating: false,
            });

            const canvasRef = useRef(null);
            const particlesRef = useRef([]);
            const animationRef = useRef(null);
            const usedQuestions = useRef(new Set());

            // Initialize particles based on current question
            const initializeParticles = (question) => {
                if (!question || !canvasRef.current) return;

                const canvas = canvasRef.current;
                const n = question.given.n?.value || 0.5;
                const numParticles = Math.floor(n * 50); // 50 particles per mole

                particlesRef.current = [];
                for (let i = 0; i < numParticles; i++) {
                    const x = Math.random() * canvas.width;
                    const y = Math.random() * canvas.height;
                    particlesRef.current.push(new Particle(x, y, canvas.width, canvas.height));
                }
            };

            // Get pressure border class
            const getPressureBorderClass = () => {
                if (!gameState.currentQuestion) return 'pressure-normal';

                const P = gameState.currentQuestion.given.P?.value ||
                          solveGasLaw(gameState.currentQuestion);

                if (P < 1) return 'pressure-low';
                if (P <= 5) return 'pressure-normal';
                return 'pressure-high';
            };

            // Start game
            const startGame = (mode) => {
                usedQuestions.current = new Set();
                setGameState({
                    ...gameState,
                    screen: 'playing',
                    mode: mode,
                    questionNumber: 0,
                    score: 0,
                    streak: 0,
                    bestStreak: 0,
                    hintsRemaining: 3,
                    totalQuestions: 0,
                    correctAnswers: 0,
                    totalTime: 0,
                });
                loadNextQuestion(mode);
            };

            // Load next question
            const loadNextQuestion = (mode = gameState.mode) => {
                // Filter available questions
                const availableQuestions = QUESTION_BANK.filter(q =>
                    !usedQuestions.current.has(q.id)
                );

                if (availableQuestions.length === 0) {
                    // Game over - all questions used
                    endGame();
                    return;
                }

                // Select random question
                const randomQuestion = availableQuestions[
                    Math.floor(Math.random() * availableQuestions.length)
                ];

                usedQuestions.current.add(randomQuestion.id);

                setGameState(prev => ({
                    ...prev,
                    currentQuestion: randomQuestion,
                    questionNumber: prev.questionNumber + 1,
                    userAnswer: '',
                    feedback: null,
                    showHint: false,
                    hintLevel: 0,
                    showSolution: false,
                    isCorrect: null,
                    hintsUsed: 0,
                    timeRemaining: mode === 'challenge' ? 90 : 999,
                    questionStartTime: Date.now(),
                    celebrating: false,
                }));

                // Initialize particles for new question
                setTimeout(() => initializeParticles(randomQuestion), 100);
            };

            // Check answer
            const checkAnswer = () => {
                if (!gameState.userAnswer || !gameState.currentQuestion) return;

                const userValue = parseFloat(gameState.userAnswer);
                const correctValue = gameState.currentQuestion.answer.value;
                const tolerance = gameState.currentQuestion.answer.tolerance;

                const isCorrect = Math.abs(userValue - correctValue) <= tolerance;
                const timeElapsed = (Date.now() - gameState.questionStartTime) / 1000;
                const isFast = timeElapsed < 30;

                if (isCorrect) {
                    // Calculate points
                    let points = 0;
                    switch(gameState.currentQuestion.difficulty) {
                        case 'easy': points = 10; break;
                        case 'medium': points = 20; break;
                        case 'hard': points = 30; break;
                    }

                    if (gameState.hintsUsed === 0) points += 10; // No hints bonus
                    if (isFast && gameState.mode === 'challenge') points += 5; // Speed bonus

                    const newStreak = gameState.streak + 1;
                    const streakBonus = Math.min(newStreak * 5, 20);
                    if (gameState.mode === 'challenge') points += streakBonus;

                    // Check for perfect precision
                    const percentError = Math.abs((userValue - correctValue) / correctValue);
                    if (percentError <= 0.005) points += 5; // Perfect precision bonus

                    setGameState(prev => ({
                        ...prev,
                        isCorrect: true,
                        feedback: TRANSLATIONS.correct,
                        score: prev.score + points,
                        streak: newStreak,
                        bestStreak: Math.max(prev.bestStreak, newStreak),
                        correctAnswers: prev.correctAnswers + 1,
                        totalTime: prev.totalTime + timeElapsed,
                        celebrating: true,
                        showSolution: true,
                    }));
                } else {
                    // Wrong answer
                    const penalty = gameState.mode === 'challenge' ? 5 : 0;

                    setGameState(prev => ({
                        ...prev,
                        isCorrect: false,
                        feedback: TRANSLATIONS.incorrect,
                        score: Math.max(0, prev.score - penalty),
                        streak: 0,
                        totalTime: prev.totalTime + timeElapsed,
                    }));
                }

                setGameState(prev => ({
                    ...prev,
                    totalQuestions: prev.totalQuestions + 1,
                }));
            };

            // Show hint
            const showHint = () => {
                const newLevel = gameState.hintLevel + 1;
                const penalty = gameState.mode === 'challenge' ? 10 : 0;

                setGameState(prev => ({
                    ...prev,
                    showHint: true,
                    hintLevel: newLevel,
                    hintsUsed: prev.hintsUsed + 1,
                    hintsRemaining: Math.max(0, prev.hintsRemaining - 1),
                    score: Math.max(0, prev.score - penalty),
                }));
            };

            // Next question
            const nextQuestion = () => {
                if (gameState.mode === 'challenge' && gameState.questionNumber >= 10) {
                    endGame();
                } else {
                    loadNextQuestion();
                }
            };

            // End game
            const endGame = () => {
                setGameState(prev => ({
                    ...prev,
                    screen: 'results',
                }));
            };

            // Return to menu
            const returnToMenu = () => {
                usedQuestions.current = new Set();
                setGameState({
                    screen: 'menu',
                    mode: null,
                    difficulty: 'easy',
                    currentQuestion: null,
                    questionNumber: 0,
                    score: 0,
                    streak: 0,
                    bestStreak: 0,
                    hintsUsed: 0,
                    hintsRemaining: 3,
                    timeRemaining: 90,
                    userAnswer: '',
                    feedback: null,
                    showHint: false,
                    hintLevel: 0,
                    showSolution: false,
                    isCorrect: null,
                    totalQuestions: 0,
                    correctAnswers: 0,
                    totalTime: 0,
                    questionStartTime: null,
                    celebrating: false,
                });
            };

            // Canvas animation effect
            useEffect(() => {
                const canvas = canvasRef.current;
                if (!canvas || gameState.screen !== 'playing') return;

                const ctx = canvas.getContext('2d');
                const animate = () => {
                    ctx.clearRect(0, 0, canvas.width, canvas.height);

                    const temperature = gameState.currentQuestion?.given.T?.value || 273;

                    particlesRef.current.forEach(particle => {
                        particle.update(
                            canvas.width,
                            canvas.height,
                            temperature,
                            gameState.celebrating
                        );
                        particle.draw(ctx);
                    });

                    animationRef.current = requestAnimationFrame(animate);
                };

                animate();

                return () => {
                    if (animationRef.current) {
                        cancelAnimationFrame(animationRef.current);
                    }
                };
            }, [gameState.currentQuestion, gameState.screen, gameState.celebrating]);

            // Timer effect for Challenge mode
            useEffect(() => {
                if (gameState.mode === 'challenge' &&
                    gameState.screen === 'playing' &&
                    gameState.timeRemaining > 0 &&
                    gameState.isCorrect === null) {

                    const timer = setTimeout(() => {
                        setGameState(prev => {
                            const newTime = prev.timeRemaining - 1;
                            if (newTime === 0) {
                                // Time's up
                                return {
                                    ...prev,
                                    timeRemaining: 0,
                                    feedback: TRANSLATIONS.timeout,
                                    isCorrect: false,
                                    showSolution: true,
                                    streak: 0,
                                    totalQuestions: prev.totalQuestions + 1,
                                };
                            }
                            return {
                                ...prev,
                                timeRemaining: newTime
                            };
                        });
                    }, 1000);

                    return () => clearTimeout(timer);
                }
            }, [gameState.timeRemaining, gameState.mode, gameState.screen, gameState.isCorrect]);

            // Handle Enter key
            useEffect(() => {
                const handleKeyPress = (e) => {
                    if (e.key === 'Enter' && gameState.screen === 'playing') {
                        if (gameState.isCorrect === null) {
                            checkAnswer();
                        } else {
                            nextQuestion();
                        }
                    }
                };

                window.addEventListener('keypress', handleKeyPress);
                return () => window.removeEventListener('keypress', handleKeyPress);
            }, [gameState]);

            // ============================================
            // RENDER: Menu Screen
            // ============================================

            if (gameState.screen === 'menu') {
                return (
                    <div>
                        <header className="site-header">
                            <div className="header-content">
                                <a href="https://kvenno.app" className="site-logo">Kvenno.app</a>
                            </div>
                        </header>

                        <nav className="nav-container">
                            <a href="../index.html" className="back-btn">
                                ‚Üê {TRANSLATIONS.back}
                            </a>
                        </nav>

                        <div className="max-w-4xl mx-auto px-4 py-8">
                            <div className="bg-white rounded-2xl shadow-xl p-8 text-center">
                                <h1 className="text-4xl md:text-5xl font-bold mb-4"
                                    style={{color: 'var(--kvenno-orange)'}}>
                                    Gas Law Challenge
                                </h1>
                                <h2 className="text-2xl text-gray-600 mb-8">
                                    L√∂gm√°li√∞ um lofttegundir
                                </h2>

                                <div className="text-6xl mb-6">üéàüî¨‚öóÔ∏è</div>

                                <p className="text-lg text-gray-700 mb-4 max-w-2xl mx-auto">
                                    √Üf√∞u √æig √≠ a√∞ nota j√∂fnu st√∂√∞ulofttegunda (PV = nRT) me√∞ gagnvirkum
                                    vandam√°lum. Sj√°√∞u agnir hreyfast √≠ raunt√≠ma!
                                </p>

                                <p className="text-base text-gray-600 mb-8">
                                    Practice using the ideal gas law (PV = nRT) with interactive problems.
                                    See particles move in real-time!
                                </p>

                                <div className="grid md:grid-cols-2 gap-6 max-w-3xl mx-auto">
                                    <button
                                        onClick={() => startGame('practice')}
                                        className="bg-blue-500 hover:bg-blue-600 text-white font-bold py-6 px-8 rounded-xl text-xl transition-all transform hover:scale-105">
                                        üìö {TRANSLATIONS.practiceMode}
                                        <div className="text-sm mt-2 opacity-90">
                                            √ìt√≠matakm√∂rku√∞ ‚Ä¢ √ìtakmarka√∞ar v√≠sbendingar
                                        </div>
                                    </button>

                                    <button
                                        onClick={() => startGame('challenge')}
                                        className="text-white font-bold py-6 px-8 rounded-xl text-xl transition-all transform hover:scale-105"
                                        style={{
                                            background: 'linear-gradient(to right, var(--kvenno-orange), var(--kvenno-orange-dark))'
                                        }}>
                                        üèÜ {TRANSLATIONS.challengeMode}
                                        <div className="text-sm mt-2 opacity-90">
                                            90 sek √° spurningu ‚Ä¢ Stigat√∂flur ‚Ä¢ 10 spurningar
                                        </div>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }

            // ============================================
            // RENDER: Playing Screen
            // ============================================

            if (gameState.screen === 'playing' && gameState.currentQuestion) {
                const question = gameState.currentQuestion;

                return (
                    <div>
                        <header className="site-header">
                            <div className="header-content">
                                <a href="https://kvenno.app" className="site-logo">Kvenno.app</a>
                                <div className="flex flex-wrap items-center gap-2 md:gap-4 text-xs md:text-sm">
                                    {gameState.mode === 'challenge' && (
                                        <>
                                            <div>
                                                <span className="font-bold">{TRANSLATIONS.score}:</span> {gameState.score}
                                            </div>
                                            <div>
                                                <span className="font-bold">{TRANSLATIONS.streak}:</span> {gameState.streak} üî•
                                            </div>
                                            <div className={gameState.timeRemaining <= 10 ? 'text-red-600 font-bold' : ''}>
                                                <span className="font-bold">{TRANSLATIONS.time}:</span> {gameState.timeRemaining}s
                                            </div>
                                        </>
                                    )}
                                    <div>
                                        <span className="font-bold">Q:</span> {gameState.questionNumber}/10
                                    </div>
                                </div>
                            </div>
                        </header>

                        <div className="max-w-6xl mx-auto px-4 py-4 md:py-8">
                            <div className="grid md:grid-cols-2 gap-4 md:gap-6">
                                {/* Left: Particle Animation */}
                                <div className="bg-white rounded-2xl shadow-xl p-4 md:p-6">
                                    <h3 className="text-base md:text-lg font-bold text-gray-800 mb-4 text-center">
                                        Agnahreyfing / Particle Motion
                                    </h3>
                                    <canvas
                                        ref={canvasRef}
                                        id="gasCanvas"
                                        width="400"
                                        height="400"
                                        className={`w-full ${getPressureBorderClass()}`}
                                    />
                                    <div className="mt-4 text-sm text-gray-600 text-center">
                                        <div className="mb-1">
                                            <span className="font-semibold">{question.difficulty === 'easy' ? TRANSLATIONS.easy : question.difficulty === 'medium' ? TRANSLATIONS.medium : TRANSLATIONS.hard}</span>
                                        </div>
                                    </div>
                                </div>

                                {/* Right: Problem & Input */}
                                <div className="bg-white rounded-2xl shadow-xl p-4 md:p-6">
                                    {/* Scenario Card */}
                                    <div className="bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-xl p-4 md:p-6 mb-4 md:mb-6">
                                        <div className="text-3xl md:text-4xl mb-2 text-center">
                                            {question.scenario.icon}
                                        </div>
                                        <h2 className="text-xl md:text-2xl font-bold text-center mb-2">
                                            {question.scenario.title}
                                        </h2>
                                        <p className="text-sm md:text-base text-center opacity-90 mb-1">
                                            {question.scenario.description}
                                        </p>
                                        <p className="text-xs md:text-sm text-center opacity-75 italic">
                                            {question.scenario.descriptionEn}
                                        </p>
                                    </div>

                                    {/* Problem Setup */}
                                    <div className="bg-gray-50 rounded-xl p-4 md:p-6 mb-4 md:mb-6">
                                        <h3 className="font-bold text-gray-800 mb-3">{TRANSLATIONS.given}:</h3>
                                        <div className="space-y-2 monospace text-sm md:text-base">
                                            {Object.keys(question.given).map(key => {
                                                const value = question.given[key];
                                                return (
                                                    <div key={key}>
                                                        <span className="font-bold">{key}</span> = {value.value} {value.unit}
                                                        {value.celsius !== undefined && (
                                                            <span className="text-gray-600 ml-2">({value.celsius}¬∞C)</span>
                                                        )}
                                                    </div>
                                                );
                                            })}
                                        </div>

                                        <h3 className="font-bold text-gray-800 mt-4 mb-2">{TRANSLATIONS.find}:</h3>
                                        <div className="text-lg font-bold" style={{color: 'var(--kvenno-orange)'}}>
                                            {question.find} = ? {question.answer.unit}
                                        </div>
                                    </div>

                                    {/* Feedback */}
                                    {gameState.feedback && (
                                        <div className={gameState.isCorrect ? 'feedback-correct' : 'feedback-incorrect'}>
                                            <div className="text-lg font-bold mb-2">
                                                {gameState.feedback}
                                            </div>
                                            {!gameState.isCorrect && gameState.userAnswer && (
                                                <div className="text-sm">
                                                    {TRANSLATIONS.yourAnswer}: {gameState.userAnswer} {question.answer.unit}
                                                </div>
                                            )}
                                        </div>
                                    )}

                                    {/* Hints */}
                                    {gameState.showHint && gameState.hintLevel > 0 && (
                                        <div className="hint-box">
                                            <div className="font-bold mb-2">üí° {TRANSLATIONS.hint} {gameState.hintLevel}:</div>
                                            <div className="text-sm">
                                                {getHintText(gameState.hintLevel, question)}
                                            </div>
                                        </div>
                                    )}

                                    {/* Solution */}
                                    {gameState.showSolution && (
                                        <div className="solution-box">
                                            <div className="font-bold mb-3 text-lg">{TRANSLATIONS.solution}:</div>
                                            {getSolutionSteps(question).map((step, idx) => (
                                                <div key={idx} className="mb-3">
                                                    <div className="text-sm font-semibold text-blue-700 mb-1">
                                                        {TRANSLATIONS.step} {idx + 1}: {step.label}
                                                    </div>
                                                    <div className="monospace bg-white p-2 rounded text-sm">
                                                        {step.content}
                                                    </div>
                                                </div>
                                            ))}
                                            <div className="mt-3 p-3 bg-green-50 rounded border border-green-200">
                                                <div className="font-bold text-green-800">
                                                    {TRANSLATIONS.correct}: {question.answer.value} {question.answer.unit}
                                                </div>
                                                {gameState.userAnswer && (
                                                    <div className="text-sm text-gray-700 mt-1">
                                                        {TRANSLATIONS.yourAnswer}: {gameState.userAnswer} {question.answer.unit}
                                                    </div>
                                                )}
                                            </div>
                                        </div>
                                    )}

                                    {/* Answer Input */}
                                    {gameState.isCorrect === null && (
                                        <>
                                            <div className="mb-4 md:mb-6">
                                                <label className="block text-gray-700 font-bold mb-2 text-sm md:text-base">
                                                    {TRANSLATIONS.yourAnswer}:
                                                </label>
                                                <div className="flex gap-2">
                                                    <input
                                                        type="number"
                                                        step="any"
                                                        value={gameState.userAnswer}
                                                        onChange={(e) => setGameState(prev => ({
                                                            ...prev,
                                                            userAnswer: e.target.value
                                                        }))}
                                                        className="flex-1 border-2 border-gray-300 rounded-lg px-3 md:px-4 py-2 md:py-3 text-base md:text-lg focus:border-purple-500 focus:outline-none"
                                                        placeholder="0.00"
                                                        autoFocus
                                                    />
                                                    <span className="flex items-center px-3 md:px-4 bg-gray-100 rounded-lg font-bold text-sm md:text-base">
                                                        {question.answer.unit}
                                                    </span>
                                                </div>
                                            </div>

                                            {/* Action Buttons */}
                                            <div className="flex gap-2 md:gap-4">
                                                <button
                                                    onClick={checkAnswer}
                                                    disabled={!gameState.userAnswer}
                                                    className="flex-1 bg-purple-600 hover:bg-purple-700 disabled:bg-gray-400 disabled:cursor-not-allowed text-white font-bold py-3 md:py-4 rounded-xl transition-colors text-base md:text-xl">
                                                    {TRANSLATIONS.checkAnswer} ‚úì
                                                </button>

                                                {(gameState.mode === 'practice' || gameState.hintsRemaining > 0) && (
                                                    <button
                                                        onClick={showHint}
                                                        disabled={gameState.hintLevel >= 4 || (gameState.mode === 'challenge' && gameState.hintsRemaining === 0)}
                                                        className="bg-yellow-500 hover:bg-yellow-600 disabled:bg-gray-400 disabled:cursor-not-allowed text-white font-bold py-3 md:py-4 px-4 md:px-6 rounded-xl transition-colors text-sm md:text-base">
                                                        üí°
                                                        {gameState.mode === 'challenge' && (
                                                            <span className="ml-1 text-xs">({gameState.hintsRemaining})</span>
                                                        )}
                                                    </button>
                                                )}

                                                {gameState.mode === 'practice' && !gameState.showSolution && (
                                                    <button
                                                        onClick={() => setGameState(prev => ({ ...prev, showSolution: true }))}
                                                        className="bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 md:py-4 px-4 md:px-6 rounded-xl transition-colors text-sm md:text-base">
                                                        üìñ
                                                    </button>
                                                )}
                                            </div>
                                        </>
                                    )}

                                    {/* Next Button */}
                                    {gameState.isCorrect !== null && (
                                        <div className="mt-4">
                                            <button
                                                onClick={nextQuestion}
                                                className="w-full text-white font-bold py-4 rounded-xl text-xl transition-all"
                                                style={{
                                                    background: 'linear-gradient(to right, var(--kvenno-orange), var(--kvenno-orange-dark))'
                                                }}>
                                                {TRANSLATIONS.nextQuestion} ‚Üí
                                            </button>
                                        </div>
                                    )}
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }

            // ============================================
            // RENDER: Results Screen
            // ============================================

            if (gameState.screen === 'results') {
                const accuracy = gameState.totalQuestions > 0
                    ? Math.round((gameState.correctAnswers / gameState.totalQuestions) * 100)
                    : 0;
                const avgTime = gameState.totalQuestions > 0
                    ? Math.round(gameState.totalTime / gameState.totalQuestions)
                    : 0;

                return (
                    <div>
                        <header className="site-header">
                            <div className="header-content">
                                <a href="https://kvenno.app" className="site-logo">Kvenno.app</a>
                            </div>
                        </header>

                        <div className="max-w-4xl mx-auto px-4 py-8">
                            <div className="bg-white rounded-2xl shadow-xl p-8 text-center">
                                <h1 className="text-4xl md:text-5xl font-bold mb-4"
                                    style={{color: 'var(--kvenno-orange)'}}>
                                    {TRANSLATIONS.gameOver}
                                </h1>

                                <div className="text-6xl mb-6">
                                    {accuracy >= 80 ? 'üéâ' : accuracy >= 60 ? 'üëç' : 'üí™'}
                                </div>

                                {gameState.mode === 'challenge' && (
                                    <div className="mb-8">
                                        <div className="text-6xl font-bold mb-2" style={{color: 'var(--kvenno-orange)'}}>
                                            {gameState.score}
                                        </div>
                                        <div className="text-xl text-gray-600">{TRANSLATIONS.finalScore}</div>
                                    </div>
                                )}

                                <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
                                    <div className="bg-gray-50 rounded-lg p-4">
                                        <div className="text-2xl font-bold text-gray-800">
                                            {gameState.totalQuestions}
                                        </div>
                                        <div className="text-sm text-gray-600">{TRANSLATIONS.questionsAnswered}</div>
                                    </div>
                                    <div className="bg-gray-50 rounded-lg p-4">
                                        <div className="text-2xl font-bold text-gray-800">
                                            {accuracy}%
                                        </div>
                                        <div className="text-sm text-gray-600">{TRANSLATIONS.accuracy}</div>
                                    </div>
                                    <div className="bg-gray-50 rounded-lg p-4">
                                        <div className="text-2xl font-bold text-gray-800">
                                            {avgTime}s
                                        </div>
                                        <div className="text-sm text-gray-600">{TRANSLATIONS.avgTime}</div>
                                    </div>
                                    <div className="bg-gray-50 rounded-lg p-4">
                                        <div className="text-2xl font-bold text-gray-800">
                                            {gameState.bestStreak} üî•
                                        </div>
                                        <div className="text-sm text-gray-600">{TRANSLATIONS.bestStreak}</div>
                                    </div>
                                </div>

                                <div className="flex flex-col md:flex-row gap-4 justify-center">
                                    <button
                                        onClick={() => startGame(gameState.mode)}
                                        className="text-white font-bold py-4 px-8 rounded-xl text-xl transition-all"
                                        style={{
                                            background: 'linear-gradient(to right, var(--kvenno-orange), var(--kvenno-orange-dark))'
                                        }}>
                                        {TRANSLATIONS.playAgain} üîÑ
                                    </button>
                                    <button
                                        onClick={returnToMenu}
                                        className="bg-gray-500 hover:bg-gray-600 text-white font-bold py-4 px-8 rounded-xl text-xl transition-all">
                                        {TRANSLATIONS.backToMenu} ‚Üê
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }

            return null;
        };

        // ============================================
        // RENDER APP
        // ============================================

        ReactDOM.render(<GasLawChallenge />, document.getElementById('root'));
    </script>
</body>
</html>
