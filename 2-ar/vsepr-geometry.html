<!DOCTYPE html>
<html lang="is">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>VSEPR Rúmfræði - Kvennaskólinn</title>
  <meta name="description" content="Lærðu um lögun sameinda með VSEPR kenningunni">
  <script type="module" crossorigin>var $Y=Object.defineProperty;var XY=(i,e,t)=>e in i?$Y(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var Zr=(i,e,t)=>XY(i,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function t(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(r){if(r.ep)return;r.ep=!0;const s=t(r);fetch(r.href,s)}})();function EA(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var kC={exports:{}},Ly={},FC={exports:{}},oi={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var YP;function qY(){if(YP)return oi;YP=1;var i=Symbol.for("react.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),n=Symbol.for("react.strict_mode"),r=Symbol.for("react.profiler"),s=Symbol.for("react.provider"),o=Symbol.for("react.context"),a=Symbol.for("react.forward_ref"),l=Symbol.for("react.suspense"),c=Symbol.for("react.memo"),u=Symbol.for("react.lazy"),h=Symbol.iterator;function f(F){return F===null||typeof F!="object"?null:(F=h&&F[h]||F["@@iterator"],typeof F=="function"?F:null)}var d={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},m=Object.assign,y={};function g(F,Y,te){this.props=F,this.context=Y,this.refs=y,this.updater=te||d}g.prototype.isReactComponent={},g.prototype.setState=function(F,Y){if(typeof F!="object"&&typeof F!="function"&&F!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,F,Y,"setState")},g.prototype.forceUpdate=function(F){this.updater.enqueueForceUpdate(this,F,"forceUpdate")};function A(){}A.prototype=g.prototype;function E(F,Y,te){this.props=F,this.context=Y,this.refs=y,this.updater=te||d}var x=E.prototype=new A;x.constructor=E,m(x,g.prototype),x.isPureReactComponent=!0;var w=Array.isArray,T=Object.prototype.hasOwnProperty,I={current:null},M={key:!0,ref:!0,__self:!0,__source:!0};function L(F,Y,te){var q,J={},re=null,ie=null;if(Y!=null)for(q in Y.ref!==void 0&&(ie=Y.ref),Y.key!==void 0&&(re=""+Y.key),Y)T.call(Y,q)&&!M.hasOwnProperty(q)&&(J[q]=Y[q]);var se=arguments.length-2;if(se===1)J.children=te;else if(1<se){for(var ge=Array(se),xe=0;xe<se;xe++)ge[xe]=arguments[xe+2];J.children=ge}if(F&&F.defaultProps)for(q in se=F.defaultProps,se)J[q]===void 0&&(J[q]=se[q]);return{$$typeof:i,type:F,key:re,ref:ie,props:J,_owner:I.current}}function P(F,Y){return{$$typeof:i,type:F.type,key:Y,ref:F.ref,props:F.props,_owner:F._owner}}function R(F){return typeof F=="object"&&F!==null&&F.$$typeof===i}function U(F){var Y={"=":"=0",":":"=2"};return"$"+F.replace(/[=:]/g,function(te){return Y[te]})}var k=/\/+/g;function H(F,Y){return typeof F=="object"&&F!==null&&F.key!=null?U(""+F.key):Y.toString(36)}function G(F,Y,te,q,J){var re=typeof F;(re==="undefined"||re==="boolean")&&(F=null);var ie=!1;if(F===null)ie=!0;else switch(re){case"string":case"number":ie=!0;break;case"object":switch(F.$$typeof){case i:case e:ie=!0}}if(ie)return ie=F,J=J(ie),F=q===""?"."+H(ie,0):q,w(J)?(te="",F!=null&&(te=F.replace(k,"$&/")+"/"),G(J,Y,te,"",function(xe){return xe})):J!=null&&(R(J)&&(J=P(J,te+(!J.key||ie&&ie.key===J.key?"":(""+J.key).replace(k,"$&/")+"/")+F)),Y.push(J)),1;if(ie=0,q=q===""?".":q+":",w(F))for(var se=0;se<F.length;se++){re=F[se];var ge=q+H(re,se);ie+=G(re,Y,te,ge,J)}else if(ge=f(F),typeof ge=="function")for(F=ge.call(F),se=0;!(re=F.next()).done;)re=re.value,ge=q+H(re,se++),ie+=G(re,Y,te,ge,J);else if(re==="object")throw Y=String(F),Error("Objects are not valid as a React child (found: "+(Y==="[object Object]"?"object with keys {"+Object.keys(F).join(", ")+"}":Y)+"). If you meant to render a collection of children, use an array instead.");return ie}function X(F,Y,te){if(F==null)return F;var q=[],J=0;return G(F,q,"","",function(re){return Y.call(te,re,J++)}),q}function Z(F){if(F._status===-1){var Y=F._result;Y=Y(),Y.then(function(te){(F._status===0||F._status===-1)&&(F._status=1,F._result=te)},function(te){(F._status===0||F._status===-1)&&(F._status=2,F._result=te)}),F._status===-1&&(F._status=0,F._result=Y)}if(F._status===1)return F._result.default;throw F._result}var oe={current:null},K={transition:null},V={ReactCurrentDispatcher:oe,ReactCurrentBatchConfig:K,ReactCurrentOwner:I};function W(){throw Error("act(...) is not supported in production builds of React.")}return oi.Children={map:X,forEach:function(F,Y,te){X(F,function(){Y.apply(this,arguments)},te)},count:function(F){var Y=0;return X(F,function(){Y++}),Y},toArray:function(F){return X(F,function(Y){return Y})||[]},only:function(F){if(!R(F))throw Error("React.Children.only expected to receive a single React element child.");return F}},oi.Component=g,oi.Fragment=t,oi.Profiler=r,oi.PureComponent=E,oi.StrictMode=n,oi.Suspense=l,oi.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=V,oi.act=W,oi.cloneElement=function(F,Y,te){if(F==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+F+".");var q=m({},F.props),J=F.key,re=F.ref,ie=F._owner;if(Y!=null){if(Y.ref!==void 0&&(re=Y.ref,ie=I.current),Y.key!==void 0&&(J=""+Y.key),F.type&&F.type.defaultProps)var se=F.type.defaultProps;for(ge in Y)T.call(Y,ge)&&!M.hasOwnProperty(ge)&&(q[ge]=Y[ge]===void 0&&se!==void 0?se[ge]:Y[ge])}var ge=arguments.length-2;if(ge===1)q.children=te;else if(1<ge){se=Array(ge);for(var xe=0;xe<ge;xe++)se[xe]=arguments[xe+2];q.children=se}return{$$typeof:i,type:F.type,key:J,ref:re,props:q,_owner:ie}},oi.createContext=function(F){return F={$$typeof:o,_currentValue:F,_currentValue2:F,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},F.Provider={$$typeof:s,_context:F},F.Consumer=F},oi.createElement=L,oi.createFactory=function(F){var Y=L.bind(null,F);return Y.type=F,Y},oi.createRef=function(){return{current:null}},oi.forwardRef=function(F){return{$$typeof:a,render:F}},oi.isValidElement=R,oi.lazy=function(F){return{$$typeof:u,_payload:{_status:-1,_result:F},_init:Z}},oi.memo=function(F,Y){return{$$typeof:c,type:F,compare:Y===void 0?null:Y}},oi.startTransition=function(F){var Y=K.transition;K.transition={};try{F()}finally{K.transition=Y}},oi.unstable_act=W,oi.useCallback=function(F,Y){return oe.current.useCallback(F,Y)},oi.useContext=function(F){return oe.current.useContext(F)},oi.useDebugValue=function(){},oi.useDeferredValue=function(F){return oe.current.useDeferredValue(F)},oi.useEffect=function(F,Y){return oe.current.useEffect(F,Y)},oi.useId=function(){return oe.current.useId()},oi.useImperativeHandle=function(F,Y,te){return oe.current.useImperativeHandle(F,Y,te)},oi.useInsertionEffect=function(F,Y){return oe.current.useInsertionEffect(F,Y)},oi.useLayoutEffect=function(F,Y){return oe.current.useLayoutEffect(F,Y)},oi.useMemo=function(F,Y){return oe.current.useMemo(F,Y)},oi.useReducer=function(F,Y,te){return oe.current.useReducer(F,Y,te)},oi.useRef=function(F){return oe.current.useRef(F)},oi.useState=function(F){return oe.current.useState(F)},oi.useSyncExternalStore=function(F,Y,te){return oe.current.useSyncExternalStore(F,Y,te)},oi.useTransition=function(){return oe.current.useTransition()},oi.version="18.3.1",oi}var $P;function _A(){return $P||($P=1,FC.exports=qY()),FC.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var XP;function JY(){if(XP)return Ly;XP=1;var i=_A(),e=Symbol.for("react.element"),t=Symbol.for("react.fragment"),n=Object.prototype.hasOwnProperty,r=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,s={key:!0,ref:!0,__self:!0,__source:!0};function o(a,l,c){var u,h={},f=null,d=null;c!==void 0&&(f=""+c),l.key!==void 0&&(f=""+l.key),l.ref!==void 0&&(d=l.ref);for(u in l)n.call(l,u)&&!s.hasOwnProperty(u)&&(h[u]=l[u]);if(a&&a.defaultProps)for(u in l=a.defaultProps,l)h[u]===void 0&&(h[u]=l[u]);return{$$typeof:e,type:a,key:f,ref:d,props:h,_owner:r.current}}return Ly.Fragment=t,Ly.jsx=o,Ly.jsxs=o,Ly}var qP;function ZY(){return qP||(qP=1,kC.exports=JY()),kC.exports}var N=ZY(),C=_A();const bl=EA(C);var C3={},OC={exports:{}},Ua={},NC={exports:{}},UC={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var JP;function e$(){return JP||(JP=1,(function(i){function e(K,V){var W=K.length;K.push(V);e:for(;0<W;){var F=W-1>>>1,Y=K[F];if(0<r(Y,V))K[F]=V,K[W]=Y,W=F;else break e}}function t(K){return K.length===0?null:K[0]}function n(K){if(K.length===0)return null;var V=K[0],W=K.pop();if(W!==V){K[0]=W;e:for(var F=0,Y=K.length,te=Y>>>1;F<te;){var q=2*(F+1)-1,J=K[q],re=q+1,ie=K[re];if(0>r(J,W))re<Y&&0>r(ie,J)?(K[F]=ie,K[re]=W,F=re):(K[F]=J,K[q]=W,F=q);else if(re<Y&&0>r(ie,W))K[F]=ie,K[re]=W,F=re;else break e}}return V}function r(K,V){var W=K.sortIndex-V.sortIndex;return W!==0?W:K.id-V.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;i.unstable_now=function(){return s.now()}}else{var o=Date,a=o.now();i.unstable_now=function(){return o.now()-a}}var l=[],c=[],u=1,h=null,f=3,d=!1,m=!1,y=!1,g=typeof setTimeout=="function"?setTimeout:null,A=typeof clearTimeout=="function"?clearTimeout:null,E=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function x(K){for(var V=t(c);V!==null;){if(V.callback===null)n(c);else if(V.startTime<=K)n(c),V.sortIndex=V.expirationTime,e(l,V);else break;V=t(c)}}function w(K){if(y=!1,x(K),!m)if(t(l)!==null)m=!0,Z(T);else{var V=t(c);V!==null&&oe(w,V.startTime-K)}}function T(K,V){m=!1,y&&(y=!1,A(L),L=-1),d=!0;var W=f;try{for(x(V),h=t(l);h!==null&&(!(h.expirationTime>V)||K&&!U());){var F=h.callback;if(typeof F=="function"){h.callback=null,f=h.priorityLevel;var Y=F(h.expirationTime<=V);V=i.unstable_now(),typeof Y=="function"?h.callback=Y:h===t(l)&&n(l),x(V)}else n(l);h=t(l)}if(h!==null)var te=!0;else{var q=t(c);q!==null&&oe(w,q.startTime-V),te=!1}return te}finally{h=null,f=W,d=!1}}var I=!1,M=null,L=-1,P=5,R=-1;function U(){return!(i.unstable_now()-R<P)}function k(){if(M!==null){var K=i.unstable_now();R=K;var V=!0;try{V=M(!0,K)}finally{V?H():(I=!1,M=null)}}else I=!1}var H;if(typeof E=="function")H=function(){E(k)};else if(typeof MessageChannel<"u"){var G=new MessageChannel,X=G.port2;G.port1.onmessage=k,H=function(){X.postMessage(null)}}else H=function(){g(k,0)};function Z(K){M=K,I||(I=!0,H())}function oe(K,V){L=g(function(){K(i.unstable_now())},V)}i.unstable_IdlePriority=5,i.unstable_ImmediatePriority=1,i.unstable_LowPriority=4,i.unstable_NormalPriority=3,i.unstable_Profiling=null,i.unstable_UserBlockingPriority=2,i.unstable_cancelCallback=function(K){K.callback=null},i.unstable_continueExecution=function(){m||d||(m=!0,Z(T))},i.unstable_forceFrameRate=function(K){0>K||125<K?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):P=0<K?Math.floor(1e3/K):5},i.unstable_getCurrentPriorityLevel=function(){return f},i.unstable_getFirstCallbackNode=function(){return t(l)},i.unstable_next=function(K){switch(f){case 1:case 2:case 3:var V=3;break;default:V=f}var W=f;f=V;try{return K()}finally{f=W}},i.unstable_pauseExecution=function(){},i.unstable_requestPaint=function(){},i.unstable_runWithPriority=function(K,V){switch(K){case 1:case 2:case 3:case 4:case 5:break;default:K=3}var W=f;f=K;try{return V()}finally{f=W}},i.unstable_scheduleCallback=function(K,V,W){var F=i.unstable_now();switch(typeof W=="object"&&W!==null?(W=W.delay,W=typeof W=="number"&&0<W?F+W:F):W=F,K){case 1:var Y=-1;break;case 2:Y=250;break;case 5:Y=1073741823;break;case 4:Y=1e4;break;default:Y=5e3}return Y=W+Y,K={id:u++,callback:V,priorityLevel:K,startTime:W,expirationTime:Y,sortIndex:-1},W>F?(K.sortIndex=W,e(c,K),t(l)===null&&K===t(c)&&(y?(A(L),L=-1):y=!0,oe(w,W-F))):(K.sortIndex=Y,e(l,K),m||d||(m=!0,Z(T))),K},i.unstable_shouldYield=U,i.unstable_wrapCallback=function(K){var V=f;return function(){var W=f;f=V;try{return K.apply(this,arguments)}finally{f=W}}}})(UC)),UC}var ZP;function t$(){return ZP||(ZP=1,NC.exports=e$()),NC.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var eL;function n$(){if(eL)return Ua;eL=1;var i=_A(),e=t$();function t(p){for(var v="https://reactjs.org/docs/error-decoder.html?invariant="+p,b=1;b<arguments.length;b++)v+="&args[]="+encodeURIComponent(arguments[b]);return"Minified React error #"+p+"; visit "+v+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var n=new Set,r={};function s(p,v){o(p,v),o(p+"Capture",v)}function o(p,v){for(r[p]=v,p=0;p<v.length;p++)n.add(v[p])}var a=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),l=Object.prototype.hasOwnProperty,c=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,u={},h={};function f(p){return l.call(h,p)?!0:l.call(u,p)?!1:c.test(p)?h[p]=!0:(u[p]=!0,!1)}function d(p,v,b,D){if(b!==null&&b.type===0)return!1;switch(typeof v){case"function":case"symbol":return!0;case"boolean":return D?!1:b!==null?!b.acceptsBooleans:(p=p.toLowerCase().slice(0,5),p!=="data-"&&p!=="aria-");default:return!1}}function m(p,v,b,D){if(v===null||typeof v>"u"||d(p,v,b,D))return!0;if(D)return!1;if(b!==null)switch(b.type){case 3:return!v;case 4:return v===!1;case 5:return isNaN(v);case 6:return isNaN(v)||1>v}return!1}function y(p,v,b,D,z,ee,fe){this.acceptsBooleans=v===2||v===3||v===4,this.attributeName=D,this.attributeNamespace=z,this.mustUseProperty=b,this.propertyName=p,this.type=v,this.sanitizeURL=ee,this.removeEmptyString=fe}var g={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(p){g[p]=new y(p,0,!1,p,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(p){var v=p[0];g[v]=new y(v,1,!1,p[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(p){g[p]=new y(p,2,!1,p.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(p){g[p]=new y(p,2,!1,p,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(p){g[p]=new y(p,3,!1,p.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(p){g[p]=new y(p,3,!0,p,null,!1,!1)}),["capture","download"].forEach(function(p){g[p]=new y(p,4,!1,p,null,!1,!1)}),["cols","rows","size","span"].forEach(function(p){g[p]=new y(p,6,!1,p,null,!1,!1)}),["rowSpan","start"].forEach(function(p){g[p]=new y(p,5,!1,p.toLowerCase(),null,!1,!1)});var A=/[\-:]([a-z])/g;function E(p){return p[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(p){var v=p.replace(A,E);g[v]=new y(v,1,!1,p,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(p){var v=p.replace(A,E);g[v]=new y(v,1,!1,p,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(p){var v=p.replace(A,E);g[v]=new y(v,1,!1,p,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(p){g[p]=new y(p,1,!1,p.toLowerCase(),null,!1,!1)}),g.xlinkHref=new y("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(p){g[p]=new y(p,1,!1,p.toLowerCase(),null,!0,!0)});function x(p,v,b,D){var z=g.hasOwnProperty(v)?g[v]:null;(z!==null?z.type!==0:D||!(2<v.length)||v[0]!=="o"&&v[0]!=="O"||v[1]!=="n"&&v[1]!=="N")&&(m(v,b,z,D)&&(b=null),D||z===null?f(v)&&(b===null?p.removeAttribute(v):p.setAttribute(v,""+b)):z.mustUseProperty?p[z.propertyName]=b===null?z.type===3?!1:"":b:(v=z.attributeName,D=z.attributeNamespace,b===null?p.removeAttribute(v):(z=z.type,b=z===3||z===4&&b===!0?"":""+b,D?p.setAttributeNS(D,v,b):p.setAttribute(v,b))))}var w=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,T=Symbol.for("react.element"),I=Symbol.for("react.portal"),M=Symbol.for("react.fragment"),L=Symbol.for("react.strict_mode"),P=Symbol.for("react.profiler"),R=Symbol.for("react.provider"),U=Symbol.for("react.context"),k=Symbol.for("react.forward_ref"),H=Symbol.for("react.suspense"),G=Symbol.for("react.suspense_list"),X=Symbol.for("react.memo"),Z=Symbol.for("react.lazy"),oe=Symbol.for("react.offscreen"),K=Symbol.iterator;function V(p){return p===null||typeof p!="object"?null:(p=K&&p[K]||p["@@iterator"],typeof p=="function"?p:null)}var W=Object.assign,F;function Y(p){if(F===void 0)try{throw Error()}catch(b){var v=b.stack.trim().match(/\n( *(at )?)/);F=v&&v[1]||""}return`
`+F+p}var te=!1;function q(p,v){if(!p||te)return"";te=!0;var b=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(v)if(v=function(){throw Error()},Object.defineProperty(v.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(v,[])}catch(rt){var D=rt}Reflect.construct(p,[],v)}else{try{v.call()}catch(rt){D=rt}p.call(v.prototype)}else{try{throw Error()}catch(rt){D=rt}p()}}catch(rt){if(rt&&D&&typeof rt.stack=="string"){for(var z=rt.stack.split(`
`),ee=D.stack.split(`
`),fe=z.length-1,Te=ee.length-1;1<=fe&&0<=Te&&z[fe]!==ee[Te];)Te--;for(;1<=fe&&0<=Te;fe--,Te--)if(z[fe]!==ee[Te]){if(fe!==1||Te!==1)do if(fe--,Te--,0>Te||z[fe]!==ee[Te]){var Ne=`
`+z[fe].replace(" at new "," at ");return p.displayName&&Ne.includes("<anonymous>")&&(Ne=Ne.replace("<anonymous>",p.displayName)),Ne}while(1<=fe&&0<=Te);break}}}finally{te=!1,Error.prepareStackTrace=b}return(p=p?p.displayName||p.name:"")?Y(p):""}function J(p){switch(p.tag){case 5:return Y(p.type);case 16:return Y("Lazy");case 13:return Y("Suspense");case 19:return Y("SuspenseList");case 0:case 2:case 15:return p=q(p.type,!1),p;case 11:return p=q(p.type.render,!1),p;case 1:return p=q(p.type,!0),p;default:return""}}function re(p){if(p==null)return null;if(typeof p=="function")return p.displayName||p.name||null;if(typeof p=="string")return p;switch(p){case M:return"Fragment";case I:return"Portal";case P:return"Profiler";case L:return"StrictMode";case H:return"Suspense";case G:return"SuspenseList"}if(typeof p=="object")switch(p.$$typeof){case U:return(p.displayName||"Context")+".Consumer";case R:return(p._context.displayName||"Context")+".Provider";case k:var v=p.render;return p=p.displayName,p||(p=v.displayName||v.name||"",p=p!==""?"ForwardRef("+p+")":"ForwardRef"),p;case X:return v=p.displayName||null,v!==null?v:re(p.type)||"Memo";case Z:v=p._payload,p=p._init;try{return re(p(v))}catch{}}return null}function ie(p){var v=p.type;switch(p.tag){case 24:return"Cache";case 9:return(v.displayName||"Context")+".Consumer";case 10:return(v._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return p=v.render,p=p.displayName||p.name||"",v.displayName||(p!==""?"ForwardRef("+p+")":"ForwardRef");case 7:return"Fragment";case 5:return v;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return re(v);case 8:return v===L?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof v=="function")return v.displayName||v.name||null;if(typeof v=="string")return v}return null}function se(p){switch(typeof p){case"boolean":case"number":case"string":case"undefined":return p;case"object":return p;default:return""}}function ge(p){var v=p.type;return(p=p.nodeName)&&p.toLowerCase()==="input"&&(v==="checkbox"||v==="radio")}function xe(p){var v=ge(p)?"checked":"value",b=Object.getOwnPropertyDescriptor(p.constructor.prototype,v),D=""+p[v];if(!p.hasOwnProperty(v)&&typeof b<"u"&&typeof b.get=="function"&&typeof b.set=="function"){var z=b.get,ee=b.set;return Object.defineProperty(p,v,{configurable:!0,get:function(){return z.call(this)},set:function(fe){D=""+fe,ee.call(this,fe)}}),Object.defineProperty(p,v,{enumerable:b.enumerable}),{getValue:function(){return D},setValue:function(fe){D=""+fe},stopTracking:function(){p._valueTracker=null,delete p[v]}}}}function pe(p){p._valueTracker||(p._valueTracker=xe(p))}function ue(p){if(!p)return!1;var v=p._valueTracker;if(!v)return!0;var b=v.getValue(),D="";return p&&(D=ge(p)?p.checked?"true":"false":p.value),p=D,p!==b?(v.setValue(p),!0):!1}function Me(p){if(p=p||(typeof document<"u"?document:void 0),typeof p>"u")return null;try{return p.activeElement||p.body}catch{return p.body}}function Se(p,v){var b=v.checked;return W({},v,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:b??p._wrapperState.initialChecked})}function ve(p,v){var b=v.defaultValue==null?"":v.defaultValue,D=v.checked!=null?v.checked:v.defaultChecked;b=se(v.value!=null?v.value:b),p._wrapperState={initialChecked:D,initialValue:b,controlled:v.type==="checkbox"||v.type==="radio"?v.checked!=null:v.value!=null}}function Ae(p,v){v=v.checked,v!=null&&x(p,"checked",v,!1)}function ke(p,v){Ae(p,v);var b=se(v.value),D=v.type;if(b!=null)D==="number"?(b===0&&p.value===""||p.value!=b)&&(p.value=""+b):p.value!==""+b&&(p.value=""+b);else if(D==="submit"||D==="reset"){p.removeAttribute("value");return}v.hasOwnProperty("value")?ne(p,v.type,b):v.hasOwnProperty("defaultValue")&&ne(p,v.type,se(v.defaultValue)),v.checked==null&&v.defaultChecked!=null&&(p.defaultChecked=!!v.defaultChecked)}function be(p,v,b){if(v.hasOwnProperty("value")||v.hasOwnProperty("defaultValue")){var D=v.type;if(!(D!=="submit"&&D!=="reset"||v.value!==void 0&&v.value!==null))return;v=""+p._wrapperState.initialValue,b||v===p.value||(p.value=v),p.defaultValue=v}b=p.name,b!==""&&(p.name=""),p.defaultChecked=!!p._wrapperState.initialChecked,b!==""&&(p.name=b)}function ne(p,v,b){(v!=="number"||Me(p.ownerDocument)!==p)&&(b==null?p.defaultValue=""+p._wrapperState.initialValue:p.defaultValue!==""+b&&(p.defaultValue=""+b))}var j=Array.isArray;function de(p,v,b,D){if(p=p.options,v){v={};for(var z=0;z<b.length;z++)v["$"+b[z]]=!0;for(b=0;b<p.length;b++)z=v.hasOwnProperty("$"+p[b].value),p[b].selected!==z&&(p[b].selected=z),z&&D&&(p[b].defaultSelected=!0)}else{for(b=""+se(b),v=null,z=0;z<p.length;z++){if(p[z].value===b){p[z].selected=!0,D&&(p[z].defaultSelected=!0);return}v!==null||p[z].disabled||(v=p[z])}v!==null&&(v.selected=!0)}}function Re(p,v){if(v.dangerouslySetInnerHTML!=null)throw Error(t(91));return W({},v,{value:void 0,defaultValue:void 0,children:""+p._wrapperState.initialValue})}function Le(p,v){var b=v.value;if(b==null){if(b=v.children,v=v.defaultValue,b!=null){if(v!=null)throw Error(t(92));if(j(b)){if(1<b.length)throw Error(t(93));b=b[0]}v=b}v==null&&(v=""),b=v}p._wrapperState={initialValue:se(b)}}function Fe(p,v){var b=se(v.value),D=se(v.defaultValue);b!=null&&(b=""+b,b!==p.value&&(p.value=b),v.defaultValue==null&&p.defaultValue!==b&&(p.defaultValue=b)),D!=null&&(p.defaultValue=""+D)}function He(p){var v=p.textContent;v===p._wrapperState.initialValue&&v!==""&&v!==null&&(p.value=v)}function it(p){switch(p){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Ye(p,v){return p==null||p==="http://www.w3.org/1999/xhtml"?it(v):p==="http://www.w3.org/2000/svg"&&v==="foreignObject"?"http://www.w3.org/1999/xhtml":p}var ct,pt=(function(p){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(v,b,D,z){MSApp.execUnsafeLocalFunction(function(){return p(v,b,D,z)})}:p})(function(p,v){if(p.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in p)p.innerHTML=v;else{for(ct=ct||document.createElement("div"),ct.innerHTML="<svg>"+v.valueOf().toString()+"</svg>",v=ct.firstChild;p.firstChild;)p.removeChild(p.firstChild);for(;v.firstChild;)p.appendChild(v.firstChild)}});function je(p,v){if(v){var b=p.firstChild;if(b&&b===p.lastChild&&b.nodeType===3){b.nodeValue=v;return}}p.textContent=v}var Mt={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Ft=["Webkit","ms","Moz","O"];Object.keys(Mt).forEach(function(p){Ft.forEach(function(v){v=v+p.charAt(0).toUpperCase()+p.substring(1),Mt[v]=Mt[p]})});function St(p,v,b){return v==null||typeof v=="boolean"||v===""?"":b||typeof v!="number"||v===0||Mt.hasOwnProperty(p)&&Mt[p]?(""+v).trim():v+"px"}function gt(p,v){p=p.style;for(var b in v)if(v.hasOwnProperty(b)){var D=b.indexOf("--")===0,z=St(b,v[b],D);b==="float"&&(b="cssFloat"),D?p.setProperty(b,z):p[b]=z}}var ft=W({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Ce(p,v){if(v){if(ft[p]&&(v.children!=null||v.dangerouslySetInnerHTML!=null))throw Error(t(137,p));if(v.dangerouslySetInnerHTML!=null){if(v.children!=null)throw Error(t(60));if(typeof v.dangerouslySetInnerHTML!="object"||!("__html"in v.dangerouslySetInnerHTML))throw Error(t(61))}if(v.style!=null&&typeof v.style!="object")throw Error(t(62))}}function qe(p,v){if(p.indexOf("-")===-1)return typeof v.is=="string";switch(p){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var At=null;function yt(p){return p=p.target||p.srcElement||window,p.correspondingUseElement&&(p=p.correspondingUseElement),p.nodeType===3?p.parentNode:p}var Be=null,we=null,_t=null;function vt(p){if(p=Oc(p)){if(typeof Be!="function")throw Error(t(280));var v=p.stateNode;v&&(v=W0(v),Be(p.stateNode,p.type,v))}}function bt(p){we?_t?_t.push(p):_t=[p]:we=p}function Lt(){if(we){var p=we,v=_t;if(_t=we=null,vt(p),v)for(p=0;p<v.length;p++)vt(v[p])}}function qt(p,v){return p(v)}function Nt(){}var dn=!1;function Vn(p,v,b){if(dn)return p(v,b);dn=!0;try{return qt(p,v,b)}finally{dn=!1,(we!==null||_t!==null)&&(Nt(),Lt())}}function pn(p,v){var b=p.stateNode;if(b===null)return null;var D=W0(b);if(D===null)return null;b=D[v];e:switch(v){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(D=!D.disabled)||(p=p.type,D=!(p==="button"||p==="input"||p==="select"||p==="textarea")),p=!D;break e;default:p=!1}if(p)return null;if(b&&typeof b!="function")throw Error(t(231,v,typeof b));return b}var qn=!1;if(a)try{var Ci={};Object.defineProperty(Ci,"passive",{get:function(){qn=!0}}),window.addEventListener("test",Ci,Ci),window.removeEventListener("test",Ci,Ci)}catch{qn=!1}function as(p,v,b,D,z,ee,fe,Te,Ne){var rt=Array.prototype.slice.call(arguments,3);try{v.apply(b,rt)}catch(Ct){this.onError(Ct)}}var Nr=!1,ur=null,tr=!1,An=null,vr={onError:function(p){Nr=!0,ur=p}};function Uo(p,v,b,D,z,ee,fe,Te,Ne){Nr=!1,ur=null,as.apply(vr,arguments)}function he(p,v,b,D,z,ee,fe,Te,Ne){if(Uo.apply(this,arguments),Nr){if(Nr){var rt=ur;Nr=!1,ur=null}else throw Error(t(198));tr||(tr=!0,An=rt)}}function me(p){var v=p,b=p;if(p.alternate)for(;v.return;)v=v.return;else{p=v;do v=p,(v.flags&4098)!==0&&(b=v.return),p=v.return;while(p)}return v.tag===3?b:null}function De(p){if(p.tag===13){var v=p.memoizedState;if(v===null&&(p=p.alternate,p!==null&&(v=p.memoizedState)),v!==null)return v.dehydrated}return null}function ce(p){if(me(p)!==p)throw Error(t(188))}function ye(p){var v=p.alternate;if(!v){if(v=me(p),v===null)throw Error(t(188));return v!==p?null:p}for(var b=p,D=v;;){var z=b.return;if(z===null)break;var ee=z.alternate;if(ee===null){if(D=z.return,D!==null){b=D;continue}break}if(z.child===ee.child){for(ee=z.child;ee;){if(ee===b)return ce(z),p;if(ee===D)return ce(z),v;ee=ee.sibling}throw Error(t(188))}if(b.return!==D.return)b=z,D=ee;else{for(var fe=!1,Te=z.child;Te;){if(Te===b){fe=!0,b=z,D=ee;break}if(Te===D){fe=!0,D=z,b=ee;break}Te=Te.sibling}if(!fe){for(Te=ee.child;Te;){if(Te===b){fe=!0,b=ee,D=z;break}if(Te===D){fe=!0,D=ee,b=z;break}Te=Te.sibling}if(!fe)throw Error(t(189))}}if(b.alternate!==D)throw Error(t(190))}if(b.tag!==3)throw Error(t(188));return b.stateNode.current===b?p:v}function Ee(p){return p=ye(p),p!==null?Pe(p):null}function Pe(p){if(p.tag===5||p.tag===6)return p;for(p=p.child;p!==null;){var v=Pe(p);if(v!==null)return v;p=p.sibling}return null}var Ie=e.unstable_scheduleCallback,Je=e.unstable_cancelCallback,st=e.unstable_shouldYield,lt=e.unstable_requestPaint,Oe=e.unstable_now,Ht=e.unstable_getCurrentPriorityLevel,xt=e.unstable_ImmediatePriority,Et=e.unstable_UserBlockingPriority,Qt=e.unstable_NormalPriority,sn=e.unstable_LowPriority,ln=e.unstable_IdlePriority,vn=null,Dt=null;function Bt(p){if(Dt&&typeof Dt.onCommitFiberRoot=="function")try{Dt.onCommitFiberRoot(vn,p,void 0,(p.current.flags&128)===128)}catch{}}var yn=Math.clz32?Math.clz32:Ai,xn=Math.log,Sn=Math.LN2;function Ai(p){return p>>>=0,p===0?32:31-(xn(p)/Sn|0)|0}var xi=64,Ei=4194304;function Dn(p){switch(p&-p){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return p&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return p&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return p}}function kn(p,v){var b=p.pendingLanes;if(b===0)return 0;var D=0,z=p.suspendedLanes,ee=p.pingedLanes,fe=b&268435455;if(fe!==0){var Te=fe&~z;Te!==0?D=Dn(Te):(ee&=fe,ee!==0&&(D=Dn(ee)))}else fe=b&~z,fe!==0?D=Dn(fe):ee!==0&&(D=Dn(ee));if(D===0)return 0;if(v!==0&&v!==D&&(v&z)===0&&(z=D&-D,ee=v&-v,z>=ee||z===16&&(ee&4194240)!==0))return v;if((D&4)!==0&&(D|=b&16),v=p.entangledLanes,v!==0)for(p=p.entanglements,v&=D;0<v;)b=31-yn(v),z=1<<b,D|=p[b],v&=~z;return D}function zi(p,v){switch(p){case 1:case 2:case 4:return v+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return v+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Bn(p,v){for(var b=p.suspendedLanes,D=p.pingedLanes,z=p.expirationTimes,ee=p.pendingLanes;0<ee;){var fe=31-yn(ee),Te=1<<fe,Ne=z[fe];Ne===-1?((Te&b)===0||(Te&D)!==0)&&(z[fe]=zi(Te,v)):Ne<=v&&(p.expiredLanes|=Te),ee&=~Te}}function Pn(p){return p=p.pendingLanes&-1073741825,p!==0?p:p&1073741824?1073741824:0}function Ri(){var p=xi;return xi<<=1,(xi&4194240)===0&&(xi=64),p}function ls(p){for(var v=[],b=0;31>b;b++)v.push(p);return v}function nr(p,v,b){p.pendingLanes|=v,v!==536870912&&(p.suspendedLanes=0,p.pingedLanes=0),p=p.eventTimes,v=31-yn(v),p[v]=b}function ta(p,v){var b=p.pendingLanes&~v;p.pendingLanes=v,p.suspendedLanes=0,p.pingedLanes=0,p.expiredLanes&=v,p.mutableReadLanes&=v,p.entangledLanes&=v,v=p.entanglements;var D=p.eventTimes;for(p=p.expirationTimes;0<b;){var z=31-yn(b),ee=1<<z;v[z]=0,D[z]=-1,p[z]=-1,b&=~ee}}function ol(p,v){var b=p.entangledLanes|=v;for(p=p.entanglements;b;){var D=31-yn(b),z=1<<D;z&v|p[D]&v&&(p[D]|=v),b&=~z}}var ri=0;function Ul(p){return p&=-p,1<p?4<p?(p&268435455)!==0?16:536870912:4:1}var ku,Qf,Vf,zl,Mh,ba=!1,al=[],zs=null,Fn=null,Ia=null,na=new Map,Gl=new Map,Ma=[],E0="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function hr(p,v){switch(p){case"focusin":case"focusout":zs=null;break;case"dragenter":case"dragleave":Fn=null;break;case"mouseover":case"mouseout":Ia=null;break;case"pointerover":case"pointerout":na.delete(v.pointerId);break;case"gotpointercapture":case"lostpointercapture":Gl.delete(v.pointerId)}}function ll(p,v,b,D,z,ee){return p===null||p.nativeEvent!==ee?(p={blockedOn:v,domEventName:b,eventSystemFlags:D,nativeEvent:ee,targetContainers:[z]},v!==null&&(v=Oc(v),v!==null&&Qf(v)),p):(p.eventSystemFlags|=D,v=p.targetContainers,z!==null&&v.indexOf(z)===-1&&v.push(z),p)}function _0(p,v,b,D,z){switch(v){case"focusin":return zs=ll(zs,p,v,b,D,z),!0;case"dragenter":return Fn=ll(Fn,p,v,b,D,z),!0;case"mouseover":return Ia=ll(Ia,p,v,b,D,z),!0;case"pointerover":var ee=z.pointerId;return na.set(ee,ll(na.get(ee)||null,p,v,b,D,z)),!0;case"gotpointercapture":return ee=z.pointerId,Gl.set(ee,ll(Gl.get(ee)||null,p,v,b,D,z)),!0}return!1}function lo(p){var v=Ku(p.target);if(v!==null){var b=me(v);if(b!==null){if(v=b.tag,v===13){if(v=De(b),v!==null){p.blockedOn=v,Mh(p.priority,function(){Vf(b)});return}}else if(v===3&&b.stateNode.current.memoizedState.isDehydrated){p.blockedOn=b.tag===3?b.stateNode.containerInfo:null;return}}}p.blockedOn=null}function Fu(p){if(p.blockedOn!==null)return!1;for(var v=p.targetContainers;0<v.length;){var b=co(p.domEventName,p.eventSystemFlags,v[0],p.nativeEvent);if(b===null){b=p.nativeEvent;var D=new b.constructor(b.type,b);At=D,b.target.dispatchEvent(D),At=null}else return v=Oc(b),v!==null&&Qf(v),p.blockedOn=b,!1;v.shift()}return!0}function Ou(p,v,b){Fu(p)&&b.delete(v)}function ia(){ba=!1,zs!==null&&Fu(zs)&&(zs=null),Fn!==null&&Fu(Fn)&&(Fn=null),Ia!==null&&Fu(Ia)&&(Ia=null),na.forEach(Ou),Gl.forEach(Ou)}function Tc(p,v){p.blockedOn===v&&(p.blockedOn=null,ba||(ba=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,ia)))}function Nu(p){function v(z){return Tc(z,p)}if(0<al.length){Tc(al[0],p);for(var b=1;b<al.length;b++){var D=al[b];D.blockedOn===p&&(D.blockedOn=null)}}for(zs!==null&&Tc(zs,p),Fn!==null&&Tc(Fn,p),Ia!==null&&Tc(Ia,p),na.forEach(v),Gl.forEach(v),b=0;b<Ma.length;b++)D=Ma[b],D.blockedOn===p&&(D.blockedOn=null);for(;0<Ma.length&&(b=Ma[0],b.blockedOn===null);)lo(b),b.blockedOn===null&&Ma.shift()}var _s=w.ReactCurrentBatchConfig,Ss=!0;function Hl(p,v,b,D){var z=ri,ee=_s.transition;_s.transition=null;try{ri=1,Rh(p,v,b,D)}finally{ri=z,_s.transition=ee}}function Ra(p,v,b,D){var z=ri,ee=_s.transition;_s.transition=null;try{ri=4,Rh(p,v,b,D)}finally{ri=z,_s.transition=ee}}function Rh(p,v,b,D){if(Ss){var z=co(p,v,b,D);if(z===null)z0(p,v,D,Uu,b),hr(p,D);else if(_0(z,p,v,b,D))D.stopPropagation();else if(hr(p,D),v&4&&-1<E0.indexOf(p)){for(;z!==null;){var ee=Oc(z);if(ee!==null&&ku(ee),ee=co(p,v,b,D),ee===null&&z0(p,v,D,Uu,b),ee===z)break;z=ee}z!==null&&D.stopPropagation()}else z0(p,v,D,null,b)}}var Uu=null;function co(p,v,b,D){if(Uu=null,p=yt(D),p=Ku(p),p!==null)if(v=me(p),v===null)p=null;else if(b=v.tag,b===13){if(p=De(v),p!==null)return p;p=null}else if(b===3){if(v.stateNode.current.memoizedState.isDehydrated)return v.tag===3?v.stateNode.containerInfo:null;p=null}else v!==p&&(p=null);return Uu=p,null}function zu(p){switch(p){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Ht()){case xt:return 1;case Et:return 4;case Qt:case sn:return 16;case ln:return 536870912;default:return 16}default:return 16}}var zo=null,bc=null,ws=null;function cs(){if(ws)return ws;var p,v=bc,b=v.length,D,z="value"in zo?zo.value:zo.textContent,ee=z.length;for(p=0;p<b&&v[p]===z[p];p++);var fe=b-p;for(D=1;D<=fe&&v[b-D]===z[ee-D];D++);return ws=z.slice(p,1<D?1-D:void 0)}function Ic(p){var v=p.keyCode;return"charCode"in p?(p=p.charCode,p===0&&v===13&&(p=13)):p=v,p===10&&(p=13),32<=p||p===13?p:0}function Go(){return!0}function Mc(){return!1}function Cs(p){function v(b,D,z,ee,fe){this._reactName=b,this._targetInst=z,this.type=D,this.nativeEvent=ee,this.target=fe,this.currentTarget=null;for(var Te in p)p.hasOwnProperty(Te)&&(b=p[Te],this[Te]=b?b(ee):ee[Te]);return this.isDefaultPrevented=(ee.defaultPrevented!=null?ee.defaultPrevented:ee.returnValue===!1)?Go:Mc,this.isPropagationStopped=Mc,this}return W(v.prototype,{preventDefault:function(){this.defaultPrevented=!0;var b=this.nativeEvent;b&&(b.preventDefault?b.preventDefault():typeof b.returnValue!="unknown"&&(b.returnValue=!1),this.isDefaultPrevented=Go)},stopPropagation:function(){var b=this.nativeEvent;b&&(b.stopPropagation?b.stopPropagation():typeof b.cancelBubble!="unknown"&&(b.cancelBubble=!0),this.isPropagationStopped=Go)},persist:function(){},isPersistent:Go}),v}var Rc={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(p){return p.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},$r=Cs(Rc),us=W({},Rc,{view:0,detail:0}),Ur=Cs(us),xr,So,Pa,jf=W({},us,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Hu,button:0,buttons:0,relatedTarget:function(p){return p.relatedTarget===void 0?p.fromElement===p.srcElement?p.toElement:p.fromElement:p.relatedTarget},movementX:function(p){return"movementX"in p?p.movementX:(p!==Pa&&(Pa&&p.type==="mousemove"?(xr=p.screenX-Pa.screenX,So=p.screenY-Pa.screenY):So=xr=0,Pa=p),xr)},movementY:function(p){return"movementY"in p?p.movementY:So}}),GA=Cs(jf),Pc=W({},jf,{dataTransfer:0}),Gu=Cs(Pc),S0=W({},us,{relatedTarget:0}),w0=Cs(S0),C0=W({},Rc,{animationName:0,elapsedTime:0,pseudoElement:0}),kx=Cs(C0),Fx=W({},Rc,{clipboardData:function(p){return"clipboardData"in p?p.clipboardData:window.clipboardData}}),HA=Cs(Fx),T0=W({},Rc,{data:0}),QA=Cs(T0),Ox={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Nx={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},VA={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Wf(p){var v=this.nativeEvent;return v.getModifierState?v.getModifierState(p):(p=VA[p])?!!v[p]:!1}function Hu(){return Wf}var b0=W({},us,{key:function(p){if(p.key){var v=Ox[p.key]||p.key;if(v!=="Unidentified")return v}return p.type==="keypress"?(p=Ic(p),p===13?"Enter":String.fromCharCode(p)):p.type==="keydown"||p.type==="keyup"?Nx[p.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Hu,charCode:function(p){return p.type==="keypress"?Ic(p):0},keyCode:function(p){return p.type==="keydown"||p.type==="keyup"?p.keyCode:0},which:function(p){return p.type==="keypress"?Ic(p):p.type==="keydown"||p.type==="keyup"?p.keyCode:0}}),I0=Cs(b0),La=W({},jf,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),ra=Cs(La),Ph=W({},us,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Hu}),Lc=Cs(Ph),Bc=W({},Rc,{propertyName:0,elapsedTime:0,pseudoElement:0}),Lh=Cs(Bc),Ux=W({},jf,{deltaX:function(p){return"deltaX"in p?p.deltaX:"wheelDeltaX"in p?-p.wheelDeltaX:0},deltaY:function(p){return"deltaY"in p?p.deltaY:"wheelDeltaY"in p?-p.wheelDeltaY:"wheelDelta"in p?-p.wheelDelta:0},deltaZ:0,deltaMode:0}),jA=Cs(Ux),WA=[9,13,27,32],wo=a&&"CompositionEvent"in window,Gs=null;a&&"documentMode"in document&&(Gs=document.documentMode);var fr=a&&"TextEvent"in window&&!Gs,Kf=a&&(!wo||Gs&&8<Gs&&11>=Gs),Ba=" ",KA=!1;function YA(p,v){switch(p){case"keyup":return WA.indexOf(v.keyCode)!==-1;case"keydown":return v.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function M0(p){return p=p.detail,typeof p=="object"&&"data"in p?p.data:null}var Qu=!1;function zx(p,v){switch(p){case"compositionend":return M0(v);case"keypress":return v.which!==32?null:(KA=!0,Ba);case"textInput":return p=v.data,p===Ba&&KA?null:p;default:return null}}function Sp(p,v){if(Qu)return p==="compositionend"||!wo&&YA(p,v)?(p=cs(),ws=bc=zo=null,Qu=!1,p):null;switch(p){case"paste":return null;case"keypress":if(!(v.ctrlKey||v.altKey||v.metaKey)||v.ctrlKey&&v.altKey){if(v.char&&1<v.char.length)return v.char;if(v.which)return String.fromCharCode(v.which)}return null;case"compositionend":return Kf&&v.locale!=="ko"?null:v.data;default:return null}}var Yf={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function R0(p){var v=p&&p.nodeName&&p.nodeName.toLowerCase();return v==="input"?!!Yf[p.type]:v==="textarea"}function $f(p,v,b,D){bt(D),v=G0(v,"onChange"),0<v.length&&(b=new $r("onChange","change",null,b,D),p.push({event:b,listeners:v}))}var Vu=null,Xf=null;function Gx(p){ed(p,0)}function Dc(p){var v=zr(p);if(ue(v))return p}function Hx(p,v){if(p==="change")return v}var qf=!1;if(a){var Ho;if(a){var Bh="oninput"in document;if(!Bh){var Dh=document.createElement("div");Dh.setAttribute("oninput","return;"),Bh=typeof Dh.oninput=="function"}Ho=Bh}else Ho=!1;qf=Ho&&(!document.documentMode||9<document.documentMode)}function cl(){Vu&&(Vu.detachEvent("onpropertychange",P0),Xf=Vu=null)}function P0(p){if(p.propertyName==="value"&&Dc(Xf)){var v=[];$f(v,Xf,p,yt(p)),Vn(Gx,v)}}function Jf(p,v,b){p==="focusin"?(cl(),Vu=v,Xf=b,Vu.attachEvent("onpropertychange",P0)):p==="focusout"&&cl()}function Qx(p){if(p==="selectionchange"||p==="keyup"||p==="keydown")return Dc(Xf)}function $A(p,v){if(p==="click")return Dc(v)}function Er(p,v){if(p==="input"||p==="change")return Dc(v)}function L0(p,v){return p===v&&(p!==0||1/p===1/v)||p!==p&&v!==v}var sa=typeof Object.is=="function"?Object.is:L0;function kh(p,v){if(sa(p,v))return!0;if(typeof p!="object"||p===null||typeof v!="object"||v===null)return!1;var b=Object.keys(p),D=Object.keys(v);if(b.length!==D.length)return!1;for(D=0;D<b.length;D++){var z=b[D];if(!l.call(v,z)||!sa(p[z],v[z]))return!1}return!0}function wp(p){for(;p&&p.firstChild;)p=p.firstChild;return p}function oa(p,v){var b=wp(p);p=0;for(var D;b;){if(b.nodeType===3){if(D=p+b.textContent.length,p<=v&&D>=v)return{node:b,offset:v-p};p=D}e:{for(;b;){if(b.nextSibling){b=b.nextSibling;break e}b=b.parentNode}b=void 0}b=wp(b)}}function Fh(p,v){return p&&v?p===v?!0:p&&p.nodeType===3?!1:v&&v.nodeType===3?Fh(p,v.parentNode):"contains"in p?p.contains(v):p.compareDocumentPosition?!!(p.compareDocumentPosition(v)&16):!1:!1}function _r(){for(var p=window,v=Me();v instanceof p.HTMLIFrameElement;){try{var b=typeof v.contentWindow.location.href=="string"}catch{b=!1}if(b)p=v.contentWindow;else break;v=Me(p.document)}return v}function Ts(p){var v=p&&p.nodeName&&p.nodeName.toLowerCase();return v&&(v==="input"&&(p.type==="text"||p.type==="search"||p.type==="tel"||p.type==="url"||p.type==="password")||v==="textarea"||p.contentEditable==="true")}function bs(p){var v=_r(),b=p.focusedElem,D=p.selectionRange;if(v!==b&&b&&b.ownerDocument&&Fh(b.ownerDocument.documentElement,b)){if(D!==null&&Ts(b)){if(v=D.start,p=D.end,p===void 0&&(p=v),"selectionStart"in b)b.selectionStart=v,b.selectionEnd=Math.min(p,b.value.length);else if(p=(v=b.ownerDocument||document)&&v.defaultView||window,p.getSelection){p=p.getSelection();var z=b.textContent.length,ee=Math.min(D.start,z);D=D.end===void 0?ee:Math.min(D.end,z),!p.extend&&ee>D&&(z=D,D=ee,ee=z),z=oa(b,ee);var fe=oa(b,D);z&&fe&&(p.rangeCount!==1||p.anchorNode!==z.node||p.anchorOffset!==z.offset||p.focusNode!==fe.node||p.focusOffset!==fe.offset)&&(v=v.createRange(),v.setStart(z.node,z.offset),p.removeAllRanges(),ee>D?(p.addRange(v),p.extend(fe.node,fe.offset)):(v.setEnd(fe.node,fe.offset),p.addRange(v)))}}for(v=[],p=b;p=p.parentNode;)p.nodeType===1&&v.push({element:p,left:p.scrollLeft,top:p.scrollTop});for(typeof b.focus=="function"&&b.focus(),b=0;b<v.length;b++)p=v[b],p.element.scrollLeft=p.left,p.element.scrollTop=p.top}}var B0=a&&"documentMode"in document&&11>=document.documentMode,Ql=null,Oh=null,Cp=null,Is=!1;function D0(p,v,b){var D=b.window===b?b.document:b.nodeType===9?b:b.ownerDocument;Is||Ql==null||Ql!==Me(D)||(D=Ql,"selectionStart"in D&&Ts(D)?D={start:D.selectionStart,end:D.selectionEnd}:(D=(D.ownerDocument&&D.ownerDocument.defaultView||window).getSelection(),D={anchorNode:D.anchorNode,anchorOffset:D.anchorOffset,focusNode:D.focusNode,focusOffset:D.focusOffset}),Cp&&kh(Cp,D)||(Cp=D,D=G0(Oh,"onSelect"),0<D.length&&(v=new $r("onSelect","select",null,v,b),p.push({event:v,listeners:D}),v.target=Ql)))}function Zf(p,v){var b={};return b[p.toLowerCase()]=v.toLowerCase(),b["Webkit"+p]="webkit"+v,b["Moz"+p]="moz"+v,b}var ju={animationend:Zf("Animation","AnimationEnd"),animationiteration:Zf("Animation","AnimationIteration"),animationstart:Zf("Animation","AnimationStart"),transitionend:Zf("Transition","TransitionEnd")},ul={},hl={};a&&(hl=document.createElement("div").style,"AnimationEvent"in window||(delete ju.animationend.animation,delete ju.animationiteration.animation,delete ju.animationstart.animation),"TransitionEvent"in window||delete ju.transitionend.transition);function Vl(p){if(ul[p])return ul[p];if(!ju[p])return p;var v=ju[p],b;for(b in v)if(v.hasOwnProperty(b)&&b in hl)return ul[p]=v[b];return p}var Tp=Vl("animationend"),bp=Vl("animationiteration"),XA=Vl("animationstart"),qA=Vl("transitionend"),JA=new Map,ZA="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function kc(p,v){JA.set(p,v),s(v,[p])}for(var k0=0;k0<ZA.length;k0++){var Ip=ZA[k0],Mp=Ip.toLowerCase(),Vx=Ip[0].toUpperCase()+Ip.slice(1);kc(Mp,"on"+Vx)}kc(Tp,"onAnimationEnd"),kc(bp,"onAnimationIteration"),kc(XA,"onAnimationStart"),kc("dblclick","onDoubleClick"),kc("focusin","onFocus"),kc("focusout","onBlur"),kc(qA,"onTransitionEnd"),o("onMouseEnter",["mouseout","mouseover"]),o("onMouseLeave",["mouseout","mouseover"]),o("onPointerEnter",["pointerout","pointerover"]),o("onPointerLeave",["pointerout","pointerover"]),s("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),s("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),s("onBeforeInput",["compositionend","keypress","textInput","paste"]),s("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),s("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),s("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Wu="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),F0=new Set("cancel close invalid load scroll toggle".split(" ").concat(Wu));function O0(p,v,b){var D=p.type||"unknown-event";p.currentTarget=b,he(D,v,void 0,p),p.currentTarget=null}function ed(p,v){v=(v&4)!==0;for(var b=0;b<p.length;b++){var D=p[b],z=D.event;D=D.listeners;e:{var ee=void 0;if(v)for(var fe=D.length-1;0<=fe;fe--){var Te=D[fe],Ne=Te.instance,rt=Te.currentTarget;if(Te=Te.listener,Ne!==ee&&z.isPropagationStopped())break e;O0(z,Te,rt),ee=Ne}else for(fe=0;fe<D.length;fe++){if(Te=D[fe],Ne=Te.instance,rt=Te.currentTarget,Te=Te.listener,Ne!==ee&&z.isPropagationStopped())break e;O0(z,Te,rt),ee=Ne}}}if(tr)throw p=An,tr=!1,An=null,p}function Yi(p,v){var b=v[zh];b===void 0&&(b=v[zh]=new Set);var D=p+"__bubble";b.has(D)||(U0(v,p,2,!1),b.add(D))}function N0(p,v,b){var D=0;v&&(D|=4),U0(b,p,D,v)}var Rp="_reactListening"+Math.random().toString(36).slice(2);function td(p){if(!p[Rp]){p[Rp]=!0,n.forEach(function(b){b!=="selectionchange"&&(F0.has(b)||N0(b,!1,p),N0(b,!0,p))});var v=p.nodeType===9?p:p.ownerDocument;v===null||v[Rp]||(v[Rp]=!0,N0("selectionchange",!1,v))}}function U0(p,v,b,D){switch(zu(v)){case 1:var z=Hl;break;case 4:z=Ra;break;default:z=Rh}b=z.bind(null,v,b,p),z=void 0,!qn||v!=="touchstart"&&v!=="touchmove"&&v!=="wheel"||(z=!0),D?z!==void 0?p.addEventListener(v,b,{capture:!0,passive:z}):p.addEventListener(v,b,!0):z!==void 0?p.addEventListener(v,b,{passive:z}):p.addEventListener(v,b,!1)}function z0(p,v,b,D,z){var ee=D;if((v&1)===0&&(v&2)===0&&D!==null)e:for(;;){if(D===null)return;var fe=D.tag;if(fe===3||fe===4){var Te=D.stateNode.containerInfo;if(Te===z||Te.nodeType===8&&Te.parentNode===z)break;if(fe===4)for(fe=D.return;fe!==null;){var Ne=fe.tag;if((Ne===3||Ne===4)&&(Ne=fe.stateNode.containerInfo,Ne===z||Ne.nodeType===8&&Ne.parentNode===z))return;fe=fe.return}for(;Te!==null;){if(fe=Ku(Te),fe===null)return;if(Ne=fe.tag,Ne===5||Ne===6){D=ee=fe;continue e}Te=Te.parentNode}}D=D.return}Vn(function(){var rt=ee,Ct=yt(b),Tt=[];e:{var wt=JA.get(p);if(wt!==void 0){var Yt=$r,tn=p;switch(p){case"keypress":if(Ic(b)===0)break e;case"keydown":case"keyup":Yt=I0;break;case"focusin":tn="focus",Yt=w0;break;case"focusout":tn="blur",Yt=w0;break;case"beforeblur":case"afterblur":Yt=w0;break;case"click":if(b.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Yt=GA;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Yt=Gu;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Yt=Lc;break;case Tp:case bp:case XA:Yt=kx;break;case qA:Yt=Lh;break;case"scroll":Yt=Ur;break;case"wheel":Yt=jA;break;case"copy":case"cut":case"paste":Yt=HA;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Yt=ra}var nn=(v&4)!==0,fs=!nn&&p==="scroll",$e=nn?wt!==null?wt+"Capture":null:wt;nn=[];for(var ze=rt,Ze;ze!==null;){Ze=ze;var Pt=Ze.stateNode;if(Ze.tag===5&&Pt!==null&&(Ze=Pt,$e!==null&&(Pt=pn(ze,$e),Pt!=null&&nn.push(nd(ze,Pt,Ze)))),fs)break;ze=ze.return}0<nn.length&&(wt=new Yt(wt,tn,null,b,Ct),Tt.push({event:wt,listeners:nn}))}}if((v&7)===0){e:{if(wt=p==="mouseover"||p==="pointerover",Yt=p==="mouseout"||p==="pointerout",wt&&b!==At&&(tn=b.relatedTarget||b.fromElement)&&(Ku(tn)||tn[aa]))break e;if((Yt||wt)&&(wt=Ct.window===Ct?Ct:(wt=Ct.ownerDocument)?wt.defaultView||wt.parentWindow:window,Yt?(tn=b.relatedTarget||b.toElement,Yt=rt,tn=tn?Ku(tn):null,tn!==null&&(fs=me(tn),tn!==fs||tn.tag!==5&&tn.tag!==6)&&(tn=null)):(Yt=null,tn=rt),Yt!==tn)){if(nn=GA,Pt="onMouseLeave",$e="onMouseEnter",ze="mouse",(p==="pointerout"||p==="pointerover")&&(nn=ra,Pt="onPointerLeave",$e="onPointerEnter",ze="pointer"),fs=Yt==null?wt:zr(Yt),Ze=tn==null?wt:zr(tn),wt=new nn(Pt,ze+"leave",Yt,b,Ct),wt.target=fs,wt.relatedTarget=Ze,Pt=null,Ku(Ct)===rt&&(nn=new nn($e,ze+"enter",tn,b,Ct),nn.target=Ze,nn.relatedTarget=fs,Pt=nn),fs=Pt,Yt&&tn)t:{for(nn=Yt,$e=tn,ze=0,Ze=nn;Ze;Ze=Nh(Ze))ze++;for(Ze=0,Pt=$e;Pt;Pt=Nh(Pt))Ze++;for(;0<ze-Ze;)nn=Nh(nn),ze--;for(;0<Ze-ze;)$e=Nh($e),Ze--;for(;ze--;){if(nn===$e||$e!==null&&nn===$e.alternate)break t;nn=Nh(nn),$e=Nh($e)}nn=null}else nn=null;Yt!==null&&jx(Tt,wt,Yt,nn,!1),tn!==null&&fs!==null&&jx(Tt,fs,tn,nn,!0)}}e:{if(wt=rt?zr(rt):window,Yt=wt.nodeName&&wt.nodeName.toLowerCase(),Yt==="select"||Yt==="input"&&wt.type==="file")var cn=Hx;else if(R0(wt))if(qf)cn=Er;else{cn=Qx;var bn=Jf}else(Yt=wt.nodeName)&&Yt.toLowerCase()==="input"&&(wt.type==="checkbox"||wt.type==="radio")&&(cn=$A);if(cn&&(cn=cn(p,rt))){$f(Tt,cn,b,Ct);break e}bn&&bn(p,wt,rt),p==="focusout"&&(bn=wt._wrapperState)&&bn.controlled&&wt.type==="number"&&ne(wt,"number",wt.value)}switch(bn=rt?zr(rt):window,p){case"focusin":(R0(bn)||bn.contentEditable==="true")&&(Ql=bn,Oh=rt,Cp=null);break;case"focusout":Cp=Oh=Ql=null;break;case"mousedown":Is=!0;break;case"contextmenu":case"mouseup":case"dragend":Is=!1,D0(Tt,b,Ct);break;case"selectionchange":if(B0)break;case"keydown":case"keyup":D0(Tt,b,Ct)}var In;if(wo)e:{switch(p){case"compositionstart":var On="onCompositionStart";break e;case"compositionend":On="onCompositionEnd";break e;case"compositionupdate":On="onCompositionUpdate";break e}On=void 0}else Qu?YA(p,b)&&(On="onCompositionEnd"):p==="keydown"&&b.keyCode===229&&(On="onCompositionStart");On&&(Kf&&b.locale!=="ko"&&(Qu||On!=="onCompositionStart"?On==="onCompositionEnd"&&Qu&&(In=cs()):(zo=Ct,bc="value"in zo?zo.value:zo.textContent,Qu=!0)),bn=G0(rt,On),0<bn.length&&(On=new QA(On,p,null,b,Ct),Tt.push({event:On,listeners:bn}),In?On.data=In:(In=M0(b),In!==null&&(On.data=In)))),(In=fr?zx(p,b):Sp(p,b))&&(rt=G0(rt,"onBeforeInput"),0<rt.length&&(Ct=new QA("onBeforeInput","beforeinput",null,b,Ct),Tt.push({event:Ct,listeners:rt}),Ct.data=In))}ed(Tt,v)})}function nd(p,v,b){return{instance:p,listener:v,currentTarget:b}}function G0(p,v){for(var b=v+"Capture",D=[];p!==null;){var z=p,ee=z.stateNode;z.tag===5&&ee!==null&&(z=ee,ee=pn(p,b),ee!=null&&D.unshift(nd(p,ee,z)),ee=pn(p,v),ee!=null&&D.push(nd(p,ee,z))),p=p.return}return D}function Nh(p){if(p===null)return null;do p=p.return;while(p&&p.tag!==5);return p||null}function jx(p,v,b,D,z){for(var ee=v._reactName,fe=[];b!==null&&b!==D;){var Te=b,Ne=Te.alternate,rt=Te.stateNode;if(Ne!==null&&Ne===D)break;Te.tag===5&&rt!==null&&(Te=rt,z?(Ne=pn(b,ee),Ne!=null&&fe.unshift(nd(b,Ne,Te))):z||(Ne=pn(b,ee),Ne!=null&&fe.push(nd(b,Ne,Te)))),b=b.return}fe.length!==0&&p.push({event:v,listeners:fe})}var lC=/\r\n?/g,Wx=/\u0000|\uFFFD/g;function ey(p){return(typeof p=="string"?p:""+p).replace(lC,`
`).replace(Wx,"")}function Pp(p,v,b){if(v=ey(v),ey(p)!==v&&b)throw Error(t(425))}function Lp(){}var id=null,ty=null;function ny(p,v){return p==="textarea"||p==="noscript"||typeof v.children=="string"||typeof v.children=="number"||typeof v.dangerouslySetInnerHTML=="object"&&v.dangerouslySetInnerHTML!==null&&v.dangerouslySetInnerHTML.__html!=null}var iy=typeof setTimeout=="function"?setTimeout:void 0,ry=typeof clearTimeout=="function"?clearTimeout:void 0,H0=typeof Promise=="function"?Promise:void 0,cC=typeof queueMicrotask=="function"?queueMicrotask:typeof H0<"u"?function(p){return H0.resolve(null).then(p).catch(Kx)}:iy;function Kx(p){setTimeout(function(){throw p})}function Q0(p,v){var b=v,D=0;do{var z=b.nextSibling;if(p.removeChild(b),z&&z.nodeType===8)if(b=z.data,b==="/$"){if(D===0){p.removeChild(z),Nu(v);return}D--}else b!=="$"&&b!=="$?"&&b!=="$!"||D++;b=z}while(b);Nu(v)}function Fc(p){for(;p!=null;p=p.nextSibling){var v=p.nodeType;if(v===1||v===3)break;if(v===8){if(v=p.data,v==="$"||v==="$!"||v==="$?")break;if(v==="/$")return null}}return p}function sy(p){p=p.previousSibling;for(var v=0;p;){if(p.nodeType===8){var b=p.data;if(b==="$"||b==="$!"||b==="$?"){if(v===0)return p;v--}else b==="/$"&&v++}p=p.previousSibling}return null}var Uh=Math.random().toString(36).slice(2),hs="__reactFiber$"+Uh,rd="__reactProps$"+Uh,aa="__reactContainer$"+Uh,zh="__reactEvents$"+Uh,V0="__reactListeners$"+Uh,j0="__reactHandles$"+Uh;function Ku(p){var v=p[hs];if(v)return v;for(var b=p.parentNode;b;){if(v=b[aa]||b[hs]){if(b=v.alternate,v.child!==null||b!==null&&b.child!==null)for(p=sy(p);p!==null;){if(b=p[hs])return b;p=sy(p)}return v}p=b,b=p.parentNode}return null}function Oc(p){return p=p[hs]||p[aa],!p||p.tag!==5&&p.tag!==6&&p.tag!==13&&p.tag!==3?null:p}function zr(p){if(p.tag===5||p.tag===6)return p.stateNode;throw Error(t(33))}function W0(p){return p[rd]||null}var oy=[],Ms=-1;function Rr(p){return{current:p}}function $i(p){0>Ms||(p.current=oy[Ms],oy[Ms]=null,Ms--)}function Gi(p,v){Ms++,oy[Ms]=p.current,p.current=v}var Nc={},Hs=Rr(Nc),Co=Rr(!1),Uc=Nc;function Gh(p,v){var b=p.type.contextTypes;if(!b)return Nc;var D=p.stateNode;if(D&&D.__reactInternalMemoizedUnmaskedChildContext===v)return D.__reactInternalMemoizedMaskedChildContext;var z={},ee;for(ee in b)z[ee]=v[ee];return D&&(p=p.stateNode,p.__reactInternalMemoizedUnmaskedChildContext=v,p.__reactInternalMemoizedMaskedChildContext=z),z}function uo(p){return p=p.childContextTypes,p!=null}function Bp(){$i(Co),$i(Hs)}function ay(p,v,b){if(Hs.current!==Nc)throw Error(t(168));Gi(Hs,v),Gi(Co,b)}function Dp(p,v,b){var D=p.stateNode;if(v=v.childContextTypes,typeof D.getChildContext!="function")return b;D=D.getChildContext();for(var z in D)if(!(z in v))throw Error(t(108,ie(p)||"Unknown",z));return W({},b,D)}function Hh(p){return p=(p=p.stateNode)&&p.__reactInternalMemoizedMergedChildContext||Nc,Uc=Hs.current,Gi(Hs,p),Gi(Co,Co.current),!0}function ly(p,v,b){var D=p.stateNode;if(!D)throw Error(t(169));b?(p=Dp(p,v,Uc),D.__reactInternalMemoizedMergedChildContext=p,$i(Co),$i(Hs),Gi(Hs,p)):$i(Co),Gi(Co,b)}var fl=null,kp=!1,K0=!1;function Fp(p){fl===null?fl=[p]:fl.push(p)}function Yx(p){kp=!0,Fp(p)}function jl(){if(!K0&&fl!==null){K0=!0;var p=0,v=ri;try{var b=fl;for(ri=1;p<b.length;p++){var D=b[p];do D=D(!0);while(D!==null)}fl=null,kp=!1}catch(z){throw fl!==null&&(fl=fl.slice(p+1)),Ie(xt,jl),z}finally{ri=v,K0=!1}}return null}var Qh=[],Qo=0,Y0=null,$0=0,To=[],Rs=0,Vh=null,kt=1,Da="";function zc(p,v){Qh[Qo++]=$0,Qh[Qo++]=Y0,Y0=p,$0=v}function cy(p,v,b){To[Rs++]=kt,To[Rs++]=Da,To[Rs++]=Vh,Vh=p;var D=kt;p=Da;var z=32-yn(D)-1;D&=~(1<<z),b+=1;var ee=32-yn(v)+z;if(30<ee){var fe=z-z%5;ee=(D&(1<<fe)-1).toString(32),D>>=fe,z-=fe,kt=1<<32-yn(v)+z|b<<z|D,Da=ee+p}else kt=1<<ee|b<<z|D,Da=p}function uy(p){p.return!==null&&(zc(p,1),cy(p,1,0))}function Gc(p){for(;p===Y0;)Y0=Qh[--Qo],Qh[Qo]=null,$0=Qh[--Qo],Qh[Qo]=null;for(;p===Vh;)Vh=To[--Rs],To[Rs]=null,Da=To[--Rs],To[Rs]=null,kt=To[--Rs],To[Rs]=null}var Qs=null,bo=null,ir=!1,ka=null;function hy(p,v){var b=Xl(5,null,null,0);b.elementType="DELETED",b.stateNode=v,b.return=p,v=p.deletions,v===null?(p.deletions=[b],p.flags|=16):v.push(b)}function fy(p,v){switch(p.tag){case 5:var b=p.type;return v=v.nodeType!==1||b.toLowerCase()!==v.nodeName.toLowerCase()?null:v,v!==null?(p.stateNode=v,Qs=p,bo=Fc(v.firstChild),!0):!1;case 6:return v=p.pendingProps===""||v.nodeType!==3?null:v,v!==null?(p.stateNode=v,Qs=p,bo=null,!0):!1;case 13:return v=v.nodeType!==8?null:v,v!==null?(b=Vh!==null?{id:kt,overflow:Da}:null,p.memoizedState={dehydrated:v,treeContext:b,retryLane:1073741824},b=Xl(18,null,null,0),b.stateNode=v,b.return=p,p.child=b,Qs=p,bo=null,!0):!1;default:return!1}}function X0(p){return(p.mode&1)!==0&&(p.flags&128)===0}function q0(p){if(ir){var v=bo;if(v){var b=v;if(!fy(p,v)){if(X0(p))throw Error(t(418));v=Fc(b.nextSibling);var D=Qs;v&&fy(p,v)?hy(D,b):(p.flags=p.flags&-4097|2,ir=!1,Qs=p)}}else{if(X0(p))throw Error(t(418));p.flags=p.flags&-4097|2,ir=!1,Qs=p}}}function J0(p){for(p=p.return;p!==null&&p.tag!==5&&p.tag!==3&&p.tag!==13;)p=p.return;Qs=p}function sd(p){if(p!==Qs)return!1;if(!ir)return J0(p),ir=!0,!1;var v;if((v=p.tag!==3)&&!(v=p.tag!==5)&&(v=p.type,v=v!=="head"&&v!=="body"&&!ny(p.type,p.memoizedProps)),v&&(v=bo)){if(X0(p))throw dy(),Error(t(418));for(;v;)hy(p,v),v=Fc(v.nextSibling)}if(J0(p),p.tag===13){if(p=p.memoizedState,p=p!==null?p.dehydrated:null,!p)throw Error(t(317));e:{for(p=p.nextSibling,v=0;p;){if(p.nodeType===8){var b=p.data;if(b==="/$"){if(v===0){bo=Fc(p.nextSibling);break e}v--}else b!=="$"&&b!=="$!"&&b!=="$?"||v++}p=p.nextSibling}bo=null}}else bo=Qs?Fc(p.stateNode.nextSibling):null;return!0}function dy(){for(var p=bo;p;)p=Fc(p.nextSibling)}function Yu(){bo=Qs=null,ir=!1}function od(p){ka===null?ka=[p]:ka.push(p)}var uC=w.ReactCurrentBatchConfig;function Op(p,v,b){if(p=b.ref,p!==null&&typeof p!="function"&&typeof p!="object"){if(b._owner){if(b=b._owner,b){if(b.tag!==1)throw Error(t(309));var D=b.stateNode}if(!D)throw Error(t(147,p));var z=D,ee=""+p;return v!==null&&v.ref!==null&&typeof v.ref=="function"&&v.ref._stringRef===ee?v.ref:(v=function(fe){var Te=z.refs;fe===null?delete Te[ee]:Te[ee]=fe},v._stringRef=ee,v)}if(typeof p!="string")throw Error(t(284));if(!b._owner)throw Error(t(290,p))}return p}function Np(p,v){throw p=Object.prototype.toString.call(v),Error(t(31,p==="[object Object]"?"object with keys {"+Object.keys(v).join(", ")+"}":p))}function py(p){var v=p._init;return v(p._payload)}function my(p){function v($e,ze){if(p){var Ze=$e.deletions;Ze===null?($e.deletions=[ze],$e.flags|=16):Ze.push(ze)}}function b($e,ze){if(!p)return null;for(;ze!==null;)v($e,ze),ze=ze.sibling;return null}function D($e,ze){for($e=new Map;ze!==null;)ze.key!==null?$e.set(ze.key,ze):$e.set(ze.index,ze),ze=ze.sibling;return $e}function z($e,ze){return $e=Ad($e,ze),$e.index=0,$e.sibling=null,$e}function ee($e,ze,Ze){return $e.index=Ze,p?(Ze=$e.alternate,Ze!==null?(Ze=Ze.index,Ze<ze?($e.flags|=2,ze):Ze):($e.flags|=2,ze)):($e.flags|=1048576,ze)}function fe($e){return p&&$e.alternate===null&&($e.flags|=2),$e}function Te($e,ze,Ze,Pt){return ze===null||ze.tag!==6?(ze=MC(Ze,$e.mode,Pt),ze.return=$e,ze):(ze=z(ze,Ze),ze.return=$e,ze)}function Ne($e,ze,Ze,Pt){var cn=Ze.type;return cn===M?Ct($e,ze,Ze.props.children,Pt,Ze.key):ze!==null&&(ze.elementType===cn||typeof cn=="object"&&cn!==null&&cn.$$typeof===Z&&py(cn)===ze.type)?(Pt=z(ze,Ze.props),Pt.ref=Op($e,ze,Ze),Pt.return=$e,Pt):(Pt=A3(Ze.type,Ze.key,Ze.props,null,$e.mode,Pt),Pt.ref=Op($e,ze,Ze),Pt.return=$e,Pt)}function rt($e,ze,Ze,Pt){return ze===null||ze.tag!==4||ze.stateNode.containerInfo!==Ze.containerInfo||ze.stateNode.implementation!==Ze.implementation?(ze=RC(Ze,$e.mode,Pt),ze.return=$e,ze):(ze=z(ze,Ze.children||[]),ze.return=$e,ze)}function Ct($e,ze,Ze,Pt,cn){return ze===null||ze.tag!==7?(ze=tm(Ze,$e.mode,Pt,cn),ze.return=$e,ze):(ze=z(ze,Ze),ze.return=$e,ze)}function Tt($e,ze,Ze){if(typeof ze=="string"&&ze!==""||typeof ze=="number")return ze=MC(""+ze,$e.mode,Ze),ze.return=$e,ze;if(typeof ze=="object"&&ze!==null){switch(ze.$$typeof){case T:return Ze=A3(ze.type,ze.key,ze.props,null,$e.mode,Ze),Ze.ref=Op($e,null,ze),Ze.return=$e,Ze;case I:return ze=RC(ze,$e.mode,Ze),ze.return=$e,ze;case Z:var Pt=ze._init;return Tt($e,Pt(ze._payload),Ze)}if(j(ze)||V(ze))return ze=tm(ze,$e.mode,Ze,null),ze.return=$e,ze;Np($e,ze)}return null}function wt($e,ze,Ze,Pt){var cn=ze!==null?ze.key:null;if(typeof Ze=="string"&&Ze!==""||typeof Ze=="number")return cn!==null?null:Te($e,ze,""+Ze,Pt);if(typeof Ze=="object"&&Ze!==null){switch(Ze.$$typeof){case T:return Ze.key===cn?Ne($e,ze,Ze,Pt):null;case I:return Ze.key===cn?rt($e,ze,Ze,Pt):null;case Z:return cn=Ze._init,wt($e,ze,cn(Ze._payload),Pt)}if(j(Ze)||V(Ze))return cn!==null?null:Ct($e,ze,Ze,Pt,null);Np($e,Ze)}return null}function Yt($e,ze,Ze,Pt,cn){if(typeof Pt=="string"&&Pt!==""||typeof Pt=="number")return $e=$e.get(Ze)||null,Te(ze,$e,""+Pt,cn);if(typeof Pt=="object"&&Pt!==null){switch(Pt.$$typeof){case T:return $e=$e.get(Pt.key===null?Ze:Pt.key)||null,Ne(ze,$e,Pt,cn);case I:return $e=$e.get(Pt.key===null?Ze:Pt.key)||null,rt(ze,$e,Pt,cn);case Z:var bn=Pt._init;return Yt($e,ze,Ze,bn(Pt._payload),cn)}if(j(Pt)||V(Pt))return $e=$e.get(Ze)||null,Ct(ze,$e,Pt,cn,null);Np(ze,Pt)}return null}function tn($e,ze,Ze,Pt){for(var cn=null,bn=null,In=ze,On=ze=0,mo=null;In!==null&&On<Ze.length;On++){In.index>On?(mo=In,In=null):mo=In.sibling;var Ti=wt($e,In,Ze[On],Pt);if(Ti===null){In===null&&(In=mo);break}p&&In&&Ti.alternate===null&&v($e,In),ze=ee(Ti,ze,On),bn===null?cn=Ti:bn.sibling=Ti,bn=Ti,In=mo}if(On===Ze.length)return b($e,In),ir&&zc($e,On),cn;if(In===null){for(;On<Ze.length;On++)In=Tt($e,Ze[On],Pt),In!==null&&(ze=ee(In,ze,On),bn===null?cn=In:bn.sibling=In,bn=In);return ir&&zc($e,On),cn}for(In=D($e,In);On<Ze.length;On++)mo=Yt(In,$e,On,Ze[On],Pt),mo!==null&&(p&&mo.alternate!==null&&In.delete(mo.key===null?On:mo.key),ze=ee(mo,ze,On),bn===null?cn=mo:bn.sibling=mo,bn=mo);return p&&In.forEach(function(yd){return v($e,yd)}),ir&&zc($e,On),cn}function nn($e,ze,Ze,Pt){var cn=V(Ze);if(typeof cn!="function")throw Error(t(150));if(Ze=cn.call(Ze),Ze==null)throw Error(t(151));for(var bn=cn=null,In=ze,On=ze=0,mo=null,Ti=Ze.next();In!==null&&!Ti.done;On++,Ti=Ze.next()){In.index>On?(mo=In,In=null):mo=In.sibling;var yd=wt($e,In,Ti.value,Pt);if(yd===null){In===null&&(In=mo);break}p&&In&&yd.alternate===null&&v($e,In),ze=ee(yd,ze,On),bn===null?cn=yd:bn.sibling=yd,bn=yd,In=mo}if(Ti.done)return b($e,In),ir&&zc($e,On),cn;if(In===null){for(;!Ti.done;On++,Ti=Ze.next())Ti=Tt($e,Ti.value,Pt),Ti!==null&&(ze=ee(Ti,ze,On),bn===null?cn=Ti:bn.sibling=Ti,bn=Ti);return ir&&zc($e,On),cn}for(In=D($e,In);!Ti.done;On++,Ti=Ze.next())Ti=Yt(In,$e,On,Ti.value,Pt),Ti!==null&&(p&&Ti.alternate!==null&&In.delete(Ti.key===null?On:Ti.key),ze=ee(Ti,ze,On),bn===null?cn=Ti:bn.sibling=Ti,bn=Ti);return p&&In.forEach(function(YY){return v($e,YY)}),ir&&zc($e,On),cn}function fs($e,ze,Ze,Pt){if(typeof Ze=="object"&&Ze!==null&&Ze.type===M&&Ze.key===null&&(Ze=Ze.props.children),typeof Ze=="object"&&Ze!==null){switch(Ze.$$typeof){case T:e:{for(var cn=Ze.key,bn=ze;bn!==null;){if(bn.key===cn){if(cn=Ze.type,cn===M){if(bn.tag===7){b($e,bn.sibling),ze=z(bn,Ze.props.children),ze.return=$e,$e=ze;break e}}else if(bn.elementType===cn||typeof cn=="object"&&cn!==null&&cn.$$typeof===Z&&py(cn)===bn.type){b($e,bn.sibling),ze=z(bn,Ze.props),ze.ref=Op($e,bn,Ze),ze.return=$e,$e=ze;break e}b($e,bn);break}else v($e,bn);bn=bn.sibling}Ze.type===M?(ze=tm(Ze.props.children,$e.mode,Pt,Ze.key),ze.return=$e,$e=ze):(Pt=A3(Ze.type,Ze.key,Ze.props,null,$e.mode,Pt),Pt.ref=Op($e,ze,Ze),Pt.return=$e,$e=Pt)}return fe($e);case I:e:{for(bn=Ze.key;ze!==null;){if(ze.key===bn)if(ze.tag===4&&ze.stateNode.containerInfo===Ze.containerInfo&&ze.stateNode.implementation===Ze.implementation){b($e,ze.sibling),ze=z(ze,Ze.children||[]),ze.return=$e,$e=ze;break e}else{b($e,ze);break}else v($e,ze);ze=ze.sibling}ze=RC(Ze,$e.mode,Pt),ze.return=$e,$e=ze}return fe($e);case Z:return bn=Ze._init,fs($e,ze,bn(Ze._payload),Pt)}if(j(Ze))return tn($e,ze,Ze,Pt);if(V(Ze))return nn($e,ze,Ze,Pt);Np($e,Ze)}return typeof Ze=="string"&&Ze!==""||typeof Ze=="number"?(Ze=""+Ze,ze!==null&&ze.tag===6?(b($e,ze.sibling),ze=z(ze,Ze),ze.return=$e,$e=ze):(b($e,ze),ze=MC(Ze,$e.mode,Pt),ze.return=$e,$e=ze),fe($e)):b($e,ze)}return fs}var jh=my(!0),Up=my(!1),Wh=Rr(null),Kh=null,Hc=null,ad=null;function Yh(){ad=Hc=Kh=null}function zp(p){var v=Wh.current;$i(Wh),p._currentValue=v}function Gp(p,v,b){for(;p!==null;){var D=p.alternate;if((p.childLanes&v)!==v?(p.childLanes|=v,D!==null&&(D.childLanes|=v)):D!==null&&(D.childLanes&v)!==v&&(D.childLanes|=v),p===b)break;p=p.return}}function $u(p,v){Kh=p,ad=Hc=null,p=p.dependencies,p!==null&&p.firstContext!==null&&((p.lanes&v)!==0&&(Zn=!0),p.firstContext=null)}function la(p){var v=p._currentValue;if(ad!==p)if(p={context:p,memoizedValue:v,next:null},Hc===null){if(Kh===null)throw Error(t(308));Hc=p,Kh.dependencies={lanes:0,firstContext:p}}else Hc=Hc.next=p;return v}var Qc=null;function gy(p){Qc===null?Qc=[p]:Qc.push(p)}function Hp(p,v,b,D){var z=v.interleaved;return z===null?(b.next=b,gy(v)):(b.next=z.next,z.next=b),v.interleaved=b,dl(p,D)}function dl(p,v){p.lanes|=v;var b=p.alternate;for(b!==null&&(b.lanes|=v),b=p,p=p.return;p!==null;)p.childLanes|=v,b=p.alternate,b!==null&&(b.childLanes|=v),b=p,p=p.return;return b.tag===3?b.stateNode:null}var Di=!1;function Jn(p){p.updateQueue={baseState:p.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Gr(p,v){p=p.updateQueue,v.updateQueue===p&&(v.updateQueue={baseState:p.baseState,firstBaseUpdate:p.firstBaseUpdate,lastBaseUpdate:p.lastBaseUpdate,shared:p.shared,effects:p.effects})}function ki(p,v){return{eventTime:p,lane:v,tag:0,payload:null,callback:null,next:null}}function dr(p,v,b){var D=p.updateQueue;if(D===null)return null;if(D=D.shared,(_i&2)!==0){var z=D.pending;return z===null?v.next=v:(v.next=z.next,z.next=v),D.pending=v,dl(p,b)}return z=D.interleaved,z===null?(v.next=v,gy(D)):(v.next=z.next,z.next=v),D.interleaved=v,dl(p,b)}function ho(p,v,b){if(v=v.updateQueue,v!==null&&(v=v.shared,(b&4194240)!==0)){var D=v.lanes;D&=p.pendingLanes,b|=D,v.lanes=b,ol(p,b)}}function $h(p,v){var b=p.updateQueue,D=p.alternate;if(D!==null&&(D=D.updateQueue,b===D)){var z=null,ee=null;if(b=b.firstBaseUpdate,b!==null){do{var fe={eventTime:b.eventTime,lane:b.lane,tag:b.tag,payload:b.payload,callback:b.callback,next:null};ee===null?z=ee=fe:ee=ee.next=fe,b=b.next}while(b!==null);ee===null?z=ee=v:ee=ee.next=v}else z=ee=v;b={baseState:D.baseState,firstBaseUpdate:z,lastBaseUpdate:ee,shared:D.shared,effects:D.effects},p.updateQueue=b;return}p=b.lastBaseUpdate,p===null?b.firstBaseUpdate=v:p.next=v,b.lastBaseUpdate=v}function Pr(p,v,b,D){var z=p.updateQueue;Di=!1;var ee=z.firstBaseUpdate,fe=z.lastBaseUpdate,Te=z.shared.pending;if(Te!==null){z.shared.pending=null;var Ne=Te,rt=Ne.next;Ne.next=null,fe===null?ee=rt:fe.next=rt,fe=Ne;var Ct=p.alternate;Ct!==null&&(Ct=Ct.updateQueue,Te=Ct.lastBaseUpdate,Te!==fe&&(Te===null?Ct.firstBaseUpdate=rt:Te.next=rt,Ct.lastBaseUpdate=Ne))}if(ee!==null){var Tt=z.baseState;fe=0,Ct=rt=Ne=null,Te=ee;do{var wt=Te.lane,Yt=Te.eventTime;if((D&wt)===wt){Ct!==null&&(Ct=Ct.next={eventTime:Yt,lane:0,tag:Te.tag,payload:Te.payload,callback:Te.callback,next:null});e:{var tn=p,nn=Te;switch(wt=v,Yt=b,nn.tag){case 1:if(tn=nn.payload,typeof tn=="function"){Tt=tn.call(Yt,Tt,wt);break e}Tt=tn;break e;case 3:tn.flags=tn.flags&-65537|128;case 0:if(tn=nn.payload,wt=typeof tn=="function"?tn.call(Yt,Tt,wt):tn,wt==null)break e;Tt=W({},Tt,wt);break e;case 2:Di=!0}}Te.callback!==null&&Te.lane!==0&&(p.flags|=64,wt=z.effects,wt===null?z.effects=[Te]:wt.push(Te))}else Yt={eventTime:Yt,lane:wt,tag:Te.tag,payload:Te.payload,callback:Te.callback,next:null},Ct===null?(rt=Ct=Yt,Ne=Tt):Ct=Ct.next=Yt,fe|=wt;if(Te=Te.next,Te===null){if(Te=z.shared.pending,Te===null)break;wt=Te,Te=wt.next,wt.next=null,z.lastBaseUpdate=wt,z.shared.pending=null}}while(!0);if(Ct===null&&(Ne=Tt),z.baseState=Ne,z.firstBaseUpdate=rt,z.lastBaseUpdate=Ct,v=z.shared.interleaved,v!==null){z=v;do fe|=z.lane,z=z.next;while(z!==v)}else ee===null&&(z.shared.lanes=0);qp|=fe,p.lanes=fe,p.memoizedState=Tt}}function ld(p,v,b){if(p=v.effects,v.effects=null,p!==null)for(v=0;v<p.length;v++){var D=p[v],z=D.callback;if(z!==null){if(D.callback=null,D=b,typeof z!="function")throw Error(t(191,z));z.call(D)}}}var Wl={},ca=Rr(Wl),Xh=Rr(Wl),Vc=Rr(Wl);function Xr(p){if(p===Wl)throw Error(t(174));return p}function Qp(p,v){switch(Gi(Vc,v),Gi(Xh,p),Gi(ca,Wl),p=v.nodeType,p){case 9:case 11:v=(v=v.documentElement)?v.namespaceURI:Ye(null,"");break;default:p=p===8?v.parentNode:v,v=p.namespaceURI||null,p=p.tagName,v=Ye(v,p)}$i(ca),Gi(ca,v)}function Xu(){$i(ca),$i(Xh),$i(Vc)}function qh(p){Xr(Vc.current);var v=Xr(ca.current),b=Ye(v,p.type);v!==b&&(Gi(Xh,p),Gi(ca,b))}function cd(p){Xh.current===p&&($i(ca),$i(Xh))}var rr=Rr(0);function pl(p){for(var v=p;v!==null;){if(v.tag===13){var b=v.memoizedState;if(b!==null&&(b=b.dehydrated,b===null||b.data==="$?"||b.data==="$!"))return v}else if(v.tag===19&&v.memoizedProps.revealOrder!==void 0){if((v.flags&128)!==0)return v}else if(v.child!==null){v.child.return=v,v=v.child;continue}if(v===p)break;for(;v.sibling===null;){if(v.return===null||v.return===p)return null;v=v.return}v.sibling.return=v.return,v=v.sibling}return null}var ud=[];function Kl(){for(var p=0;p<ud.length;p++)ud[p]._workInProgressVersionPrimary=null;ud.length=0}var Jh=w.ReactCurrentDispatcher,Zh=w.ReactCurrentBatchConfig,jc=0,Xi=null,Lr=null,yi=null,ml=!1,fo=!1,qu=0,Vo=0;function Vs(){throw Error(t(321))}function Vp(p,v){if(v===null)return!1;for(var b=0;b<v.length&&b<p.length;b++)if(!sa(p[b],v[b]))return!1;return!0}function jp(p,v,b,D,z,ee){if(jc=ee,Xi=v,v.memoizedState=null,v.updateQueue=null,v.lanes=0,Jh.current=p===null||p.memoizedState===null?t3:n3,p=b(D,z),fo){ee=0;do{if(fo=!1,qu=0,25<=ee)throw Error(t(301));ee+=1,yi=Lr=null,v.updateQueue=null,Jh.current=i3,p=b(D,z)}while(fo)}if(Jh.current=sg,v=Lr!==null&&Lr.next!==null,jc=0,yi=Lr=Xi=null,ml=!1,v)throw Error(t(300));return p}function Ay(){var p=qu!==0;return qu=0,p}function js(){var p={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return yi===null?Xi.memoizedState=yi=p:yi=yi.next=p,yi}function ua(){if(Lr===null){var p=Xi.alternate;p=p!==null?p.memoizedState:null}else p=Lr.next;var v=yi===null?Xi.memoizedState:yi.next;if(v!==null)yi=v,Lr=p;else{if(p===null)throw Error(t(310));Lr=p,p={memoizedState:Lr.memoizedState,baseState:Lr.baseState,baseQueue:Lr.baseQueue,queue:Lr.queue,next:null},yi===null?Xi.memoizedState=yi=p:yi=yi.next=p}return yi}function hd(p,v){return typeof v=="function"?v(p):v}function Wp(p){var v=ua(),b=v.queue;if(b===null)throw Error(t(311));b.lastRenderedReducer=p;var D=Lr,z=D.baseQueue,ee=b.pending;if(ee!==null){if(z!==null){var fe=z.next;z.next=ee.next,ee.next=fe}D.baseQueue=z=ee,b.pending=null}if(z!==null){ee=z.next,D=D.baseState;var Te=fe=null,Ne=null,rt=ee;do{var Ct=rt.lane;if((jc&Ct)===Ct)Ne!==null&&(Ne=Ne.next={lane:0,action:rt.action,hasEagerState:rt.hasEagerState,eagerState:rt.eagerState,next:null}),D=rt.hasEagerState?rt.eagerState:p(D,rt.action);else{var Tt={lane:Ct,action:rt.action,hasEagerState:rt.hasEagerState,eagerState:rt.eagerState,next:null};Ne===null?(Te=Ne=Tt,fe=D):Ne=Ne.next=Tt,Xi.lanes|=Ct,qp|=Ct}rt=rt.next}while(rt!==null&&rt!==ee);Ne===null?fe=D:Ne.next=Te,sa(D,v.memoizedState)||(Zn=!0),v.memoizedState=D,v.baseState=fe,v.baseQueue=Ne,b.lastRenderedState=D}if(p=b.interleaved,p!==null){z=p;do ee=z.lane,Xi.lanes|=ee,qp|=ee,z=z.next;while(z!==p)}else z===null&&(b.lanes=0);return[v.memoizedState,b.dispatch]}function Wc(p){var v=ua(),b=v.queue;if(b===null)throw Error(t(311));b.lastRenderedReducer=p;var D=b.dispatch,z=b.pending,ee=v.memoizedState;if(z!==null){b.pending=null;var fe=z=z.next;do ee=p(ee,fe.action),fe=fe.next;while(fe!==z);sa(ee,v.memoizedState)||(Zn=!0),v.memoizedState=ee,v.baseQueue===null&&(v.baseState=ee),b.lastRenderedState=ee}return[ee,D]}function yy(){}function vy(p,v){var b=Xi,D=ua(),z=v(),ee=!sa(D.memoizedState,z);if(ee&&(D.memoizedState=z,Zn=!0),D=D.queue,_y($x.bind(null,b,D,p),[p]),D.getSnapshot!==v||ee||yi!==null&&yi.memoizedState.tag&1){if(b.flags|=2048,gl(9,Kp.bind(null,b,D,z,v),void 0,null),po===null)throw Error(t(349));(jc&30)!==0||Z0(b,v,z)}return z}function Z0(p,v,b){p.flags|=16384,p={getSnapshot:v,value:b},v=Xi.updateQueue,v===null?(v={lastEffect:null,stores:null},Xi.updateQueue=v,v.stores=[p]):(b=v.stores,b===null?v.stores=[p]:b.push(p))}function Kp(p,v,b,D){v.value=b,v.getSnapshot=D,Xx(v)&&xy(p)}function $x(p,v,b){return b(function(){Xx(v)&&xy(p)})}function Xx(p){var v=p.getSnapshot;p=p.value;try{var b=v();return!sa(p,b)}catch{return!0}}function xy(p){var v=dl(p,1);v!==null&&qc(v,p,1,-1)}function Ey(p){var v=js();return typeof p=="function"&&(p=p()),v.memoizedState=v.baseState=p,p={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:hd,lastRenderedState:p},v.queue=p,p=p.dispatch=ef.bind(null,Xi,p),[v.memoizedState,p]}function gl(p,v,b,D){return p={tag:p,create:v,destroy:b,deps:D,next:null},v=Xi.updateQueue,v===null?(v={lastEffect:null,stores:null},Xi.updateQueue=v,v.lastEffect=p.next=p):(b=v.lastEffect,b===null?v.lastEffect=p.next=p:(D=b.next,b.next=p,p.next=D,v.lastEffect=p)),p}function qx(){return ua().memoizedState}function Yl(p,v,b,D){var z=js();Xi.flags|=p,z.memoizedState=gl(1|v,b,void 0,D===void 0?null:D)}function Yp(p,v,b,D){var z=ua();D=D===void 0?null:D;var ee=void 0;if(Lr!==null){var fe=Lr.memoizedState;if(ee=fe.destroy,D!==null&&Vp(D,fe.deps)){z.memoizedState=gl(v,b,ee,D);return}}Xi.flags|=p,z.memoizedState=gl(1|v,b,ee,D)}function Io(p,v){return Yl(8390656,8,p,v)}function _y(p,v){return Yp(2048,8,p,v)}function Sy(p,v){return Yp(4,2,p,v)}function Jx(p,v){return Yp(4,4,p,v)}function Zx(p,v){if(typeof v=="function")return p=p(),v(p),function(){v(null)};if(v!=null)return p=p(),v.current=p,function(){v.current=null}}function wy(p,v,b){return b=b!=null?b.concat([p]):null,Yp(4,4,Zx.bind(null,v,p),b)}function eg(){}function e3(p,v){var b=ua();v=v===void 0?null:v;var D=b.memoizedState;return D!==null&&v!==null&&Vp(v,D[1])?D[0]:(b.memoizedState=[p,v],p)}function ha(p,v){var b=ua();v=v===void 0?null:v;var D=b.memoizedState;return D!==null&&v!==null&&Vp(v,D[1])?D[0]:(p=p(),b.memoizedState=[p,v],p)}function tg(p,v,b){return(jc&21)===0?(p.baseState&&(p.baseState=!1,Zn=!0),p.memoizedState=b):(sa(b,v)||(b=Ri(),Xi.lanes|=b,qp|=b,p.baseState=!0),v)}function hC(p,v){var b=ri;ri=b!==0&&4>b?b:4,p(!0);var D=Zh.transition;Zh.transition={};try{p(!1),v()}finally{ri=b,Zh.transition=D}}function Kc(){return ua().memoizedState}function ng(p,v,b){var D=md(p);if(b={lane:D,action:b,hasEagerState:!1,eagerState:null,next:null},$p(p))ig(v,b);else if(b=Hp(p,v,b,D),b!==null){var z=da();qc(b,p,D,z),rg(b,v,D)}}function ef(p,v,b){var D=md(p),z={lane:D,action:b,hasEagerState:!1,eagerState:null,next:null};if($p(p))ig(v,z);else{var ee=p.alternate;if(p.lanes===0&&(ee===null||ee.lanes===0)&&(ee=v.lastRenderedReducer,ee!==null))try{var fe=v.lastRenderedState,Te=ee(fe,b);if(z.hasEagerState=!0,z.eagerState=Te,sa(Te,fe)){var Ne=v.interleaved;Ne===null?(z.next=z,gy(v)):(z.next=Ne.next,Ne.next=z),v.interleaved=z;return}}catch{}finally{}b=Hp(p,v,z,D),b!==null&&(z=da(),qc(b,p,D,z),rg(b,v,D))}}function $p(p){var v=p.alternate;return p===Xi||v!==null&&v===Xi}function ig(p,v){fo=ml=!0;var b=p.pending;b===null?v.next=v:(v.next=b.next,b.next=v),p.pending=v}function rg(p,v,b){if((b&4194240)!==0){var D=v.lanes;D&=p.pendingLanes,b|=D,v.lanes=b,ol(p,b)}}var sg={readContext:la,useCallback:Vs,useContext:Vs,useEffect:Vs,useImperativeHandle:Vs,useInsertionEffect:Vs,useLayoutEffect:Vs,useMemo:Vs,useReducer:Vs,useRef:Vs,useState:Vs,useDebugValue:Vs,useDeferredValue:Vs,useTransition:Vs,useMutableSource:Vs,useSyncExternalStore:Vs,useId:Vs,unstable_isNewReconciler:!1},t3={readContext:la,useCallback:function(p,v){return js().memoizedState=[p,v===void 0?null:v],p},useContext:la,useEffect:Io,useImperativeHandle:function(p,v,b){return b=b!=null?b.concat([p]):null,Yl(4194308,4,Zx.bind(null,v,p),b)},useLayoutEffect:function(p,v){return Yl(4194308,4,p,v)},useInsertionEffect:function(p,v){return Yl(4,2,p,v)},useMemo:function(p,v){var b=js();return v=v===void 0?null:v,p=p(),b.memoizedState=[p,v],p},useReducer:function(p,v,b){var D=js();return v=b!==void 0?b(v):v,D.memoizedState=D.baseState=v,p={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:p,lastRenderedState:v},D.queue=p,p=p.dispatch=ng.bind(null,Xi,p),[D.memoizedState,p]},useRef:function(p){var v=js();return p={current:p},v.memoizedState=p},useState:Ey,useDebugValue:eg,useDeferredValue:function(p){return js().memoizedState=p},useTransition:function(){var p=Ey(!1),v=p[0];return p=hC.bind(null,p[1]),js().memoizedState=p,[v,p]},useMutableSource:function(){},useSyncExternalStore:function(p,v,b){var D=Xi,z=js();if(ir){if(b===void 0)throw Error(t(407));b=b()}else{if(b=v(),po===null)throw Error(t(349));(jc&30)!==0||Z0(D,v,b)}z.memoizedState=b;var ee={value:b,getSnapshot:v};return z.queue=ee,Io($x.bind(null,D,ee,p),[p]),D.flags|=2048,gl(9,Kp.bind(null,D,ee,b,v),void 0,null),b},useId:function(){var p=js(),v=po.identifierPrefix;if(ir){var b=Da,D=kt;b=(D&~(1<<32-yn(D)-1)).toString(32)+b,v=":"+v+"R"+b,b=qu++,0<b&&(v+="H"+b.toString(32)),v+=":"}else b=Vo++,v=":"+v+"r"+b.toString(32)+":";return p.memoizedState=v},unstable_isNewReconciler:!1},n3={readContext:la,useCallback:e3,useContext:la,useEffect:_y,useImperativeHandle:wy,useInsertionEffect:Sy,useLayoutEffect:Jx,useMemo:ha,useReducer:Wp,useRef:qx,useState:function(){return Wp(hd)},useDebugValue:eg,useDeferredValue:function(p){var v=ua();return tg(v,Lr.memoizedState,p)},useTransition:function(){var p=Wp(hd)[0],v=ua().memoizedState;return[p,v]},useMutableSource:yy,useSyncExternalStore:vy,useId:Kc,unstable_isNewReconciler:!1},i3={readContext:la,useCallback:e3,useContext:la,useEffect:_y,useImperativeHandle:wy,useInsertionEffect:Sy,useLayoutEffect:Jx,useMemo:ha,useReducer:Wc,useRef:qx,useState:function(){return Wc(hd)},useDebugValue:eg,useDeferredValue:function(p){var v=ua();return Lr===null?v.memoizedState=p:tg(v,Lr.memoizedState,p)},useTransition:function(){var p=Wc(hd)[0],v=ua().memoizedState;return[p,v]},useMutableSource:yy,useSyncExternalStore:vy,useId:Kc,unstable_isNewReconciler:!1};function Fa(p,v){if(p&&p.defaultProps){v=W({},v),p=p.defaultProps;for(var b in p)v[b]===void 0&&(v[b]=p[b]);return v}return v}function Xp(p,v,b,D){v=p.memoizedState,b=b(D,v),b=b==null?v:W({},v,b),p.memoizedState=b,p.lanes===0&&(p.updateQueue.baseState=b)}var og={isMounted:function(p){return(p=p._reactInternals)?me(p)===p:!1},enqueueSetState:function(p,v,b){p=p._reactInternals;var D=da(),z=md(p),ee=ki(D,z);ee.payload=v,b!=null&&(ee.callback=b),v=dr(p,ee,z),v!==null&&(qc(v,p,z,D),ho(v,p,z))},enqueueReplaceState:function(p,v,b){p=p._reactInternals;var D=da(),z=md(p),ee=ki(D,z);ee.tag=1,ee.payload=v,b!=null&&(ee.callback=b),v=dr(p,ee,z),v!==null&&(qc(v,p,z,D),ho(v,p,z))},enqueueForceUpdate:function(p,v){p=p._reactInternals;var b=da(),D=md(p),z=ki(b,D);z.tag=2,v!=null&&(z.callback=v),v=dr(p,z,D),v!==null&&(qc(v,p,D,b),ho(v,p,D))}};function r3(p,v,b,D,z,ee,fe){return p=p.stateNode,typeof p.shouldComponentUpdate=="function"?p.shouldComponentUpdate(D,ee,fe):v.prototype&&v.prototype.isPureReactComponent?!kh(b,D)||!kh(z,ee):!0}function _(p,v,b){var D=!1,z=Nc,ee=v.contextType;return typeof ee=="object"&&ee!==null?ee=la(ee):(z=uo(v)?Uc:Hs.current,D=v.contextTypes,ee=(D=D!=null)?Gh(p,z):Nc),v=new v(b,ee),p.memoizedState=v.state!==null&&v.state!==void 0?v.state:null,v.updater=og,p.stateNode=v,v._reactInternals=p,D&&(p=p.stateNode,p.__reactInternalMemoizedUnmaskedChildContext=z,p.__reactInternalMemoizedMaskedChildContext=ee),v}function S(p,v,b,D){p=v.state,typeof v.componentWillReceiveProps=="function"&&v.componentWillReceiveProps(b,D),typeof v.UNSAFE_componentWillReceiveProps=="function"&&v.UNSAFE_componentWillReceiveProps(b,D),v.state!==p&&og.enqueueReplaceState(v,v.state,null)}function B(p,v,b,D){var z=p.stateNode;z.props=b,z.state=p.memoizedState,z.refs={},Jn(p);var ee=v.contextType;typeof ee=="object"&&ee!==null?z.context=la(ee):(ee=uo(v)?Uc:Hs.current,z.context=Gh(p,ee)),z.state=p.memoizedState,ee=v.getDerivedStateFromProps,typeof ee=="function"&&(Xp(p,v,ee,b),z.state=p.memoizedState),typeof v.getDerivedStateFromProps=="function"||typeof z.getSnapshotBeforeUpdate=="function"||typeof z.UNSAFE_componentWillMount!="function"&&typeof z.componentWillMount!="function"||(v=z.state,typeof z.componentWillMount=="function"&&z.componentWillMount(),typeof z.UNSAFE_componentWillMount=="function"&&z.UNSAFE_componentWillMount(),v!==z.state&&og.enqueueReplaceState(z,z.state,null),Pr(p,b,z,D),z.state=p.memoizedState),typeof z.componentDidMount=="function"&&(p.flags|=4194308)}function O(p,v){try{var b="",D=v;do b+=J(D),D=D.return;while(D);var z=b}catch(ee){z=`
Error generating stack: `+ee.message+`
`+ee.stack}return{value:p,source:v,stack:z,digest:null}}function $(p,v,b){return{value:p,source:null,stack:b??null,digest:v??null}}function le(p,v){try{console.error(v.value)}catch(b){setTimeout(function(){throw b})}}var _e=typeof WeakMap=="function"?WeakMap:Map;function Ge(p,v,b){b=ki(-1,b),b.tag=3,b.payload={element:null};var D=v.value;return b.callback=function(){h3||(h3=!0,EC=D),le(p,v)},b}function ht(p,v,b){b=ki(-1,b),b.tag=3;var D=p.type.getDerivedStateFromError;if(typeof D=="function"){var z=v.value;b.payload=function(){return D(z)},b.callback=function(){le(p,v)}}var ee=p.stateNode;return ee!==null&&typeof ee.componentDidCatch=="function"&&(b.callback=function(){le(p,v),typeof D!="function"&&(dd===null?dd=new Set([this]):dd.add(this));var fe=v.stack;this.componentDidCatch(v.value,{componentStack:fe!==null?fe:""})}),b}function Rt(p,v,b){var D=p.pingCache;if(D===null){D=p.pingCache=new _e;var z=new Set;D.set(v,z)}else z=D.get(v),z===void 0&&(z=new Set,D.set(v,z));z.has(b)||(z.add(b),p=OY.bind(null,p,v,b),v.then(p,p))}function Jt(p){do{var v;if((v=p.tag===13)&&(v=p.memoizedState,v=v!==null?v.dehydrated!==null:!0),v)return p;p=p.return}while(p!==null);return null}function Hn(p,v,b,D,z){return(p.mode&1)===0?(p===v?p.flags|=65536:(p.flags|=128,b.flags|=131072,b.flags&=-52805,b.tag===1&&(b.alternate===null?b.tag=17:(v=ki(-1,1),v.tag=2,dr(b,v,1))),b.lanes|=1),p):(p.flags|=65536,p.lanes=z,p)}var wn=w.ReactCurrentOwner,Zn=!1;function Wt(p,v,b,D){v.child=p===null?Up(v,null,b,D):jh(v,p.child,b,D)}function Ws(p,v,b,D,z){b=b.render;var ee=v.ref;return $u(v,z),D=jp(p,v,b,D,ee,z),b=Ay(),p!==null&&!Zn?(v.updateQueue=p.updateQueue,v.flags&=-2053,p.lanes&=~z,tf(p,v,z)):(ir&&b&&uy(v),v.flags|=1,Wt(p,v,D,z),v.child)}function fa(p,v,b,D,z){if(p===null){var ee=b.type;return typeof ee=="function"&&!IC(ee)&&ee.defaultProps===void 0&&b.compare===null&&b.defaultProps===void 0?(v.tag=15,v.type=ee,et(p,v,ee,D,z)):(p=A3(b.type,null,D,v,v.mode,z),p.ref=v.ref,p.return=v,v.child=p)}if(ee=p.child,(p.lanes&z)===0){var fe=ee.memoizedProps;if(b=b.compare,b=b!==null?b:kh,b(fe,D)&&p.ref===v.ref)return tf(p,v,z)}return v.flags|=1,p=Ad(ee,D),p.ref=v.ref,p.return=v,v.child=p}function et(p,v,b,D,z){if(p!==null){var ee=p.memoizedProps;if(kh(ee,D)&&p.ref===v.ref)if(Zn=!1,v.pendingProps=D=ee,(p.lanes&z)!==0)(p.flags&131072)!==0&&(Zn=!0);else return v.lanes=p.lanes,tf(p,v,z)}return Vt(p,v,b,D,z)}function Qe(p,v,b){var D=v.pendingProps,z=D.children,ee=p!==null?p.memoizedState:null;if(D.mode==="hidden")if((v.mode&1)===0)v.memoizedState={baseLanes:0,cachePool:null,transitions:null},Gi(lg,Al),Al|=b;else{if((b&1073741824)===0)return p=ee!==null?ee.baseLanes|b:b,v.lanes=v.childLanes=1073741824,v.memoizedState={baseLanes:p,cachePool:null,transitions:null},v.updateQueue=null,Gi(lg,Al),Al|=p,null;v.memoizedState={baseLanes:0,cachePool:null,transitions:null},D=ee!==null?ee.baseLanes:b,Gi(lg,Al),Al|=D}else ee!==null?(D=ee.baseLanes|b,v.memoizedState=null):D=b,Gi(lg,Al),Al|=D;return Wt(p,v,z,b),v.child}function at(p,v){var b=v.ref;(p===null&&b!==null||p!==null&&p.ref!==b)&&(v.flags|=512,v.flags|=2097152)}function Vt(p,v,b,D,z){var ee=uo(b)?Uc:Hs.current;return ee=Gh(v,ee),$u(v,z),b=jp(p,v,b,D,ee,z),D=Ay(),p!==null&&!Zn?(v.updateQueue=p.updateQueue,v.flags&=-2053,p.lanes&=~z,tf(p,v,z)):(ir&&D&&uy(v),v.flags|=1,Wt(p,v,b,z),v.child)}function on(p,v,b,D,z){if(uo(b)){var ee=!0;Hh(v)}else ee=!1;if($u(v,z),v.stateNode===null)o3(p,v),_(v,b,D),B(v,b,D,z),D=!0;else if(p===null){var fe=v.stateNode,Te=v.memoizedProps;fe.props=Te;var Ne=fe.context,rt=b.contextType;typeof rt=="object"&&rt!==null?rt=la(rt):(rt=uo(b)?Uc:Hs.current,rt=Gh(v,rt));var Ct=b.getDerivedStateFromProps,Tt=typeof Ct=="function"||typeof fe.getSnapshotBeforeUpdate=="function";Tt||typeof fe.UNSAFE_componentWillReceiveProps!="function"&&typeof fe.componentWillReceiveProps!="function"||(Te!==D||Ne!==rt)&&S(v,fe,D,rt),Di=!1;var wt=v.memoizedState;fe.state=wt,Pr(v,D,fe,z),Ne=v.memoizedState,Te!==D||wt!==Ne||Co.current||Di?(typeof Ct=="function"&&(Xp(v,b,Ct,D),Ne=v.memoizedState),(Te=Di||r3(v,b,Te,D,wt,Ne,rt))?(Tt||typeof fe.UNSAFE_componentWillMount!="function"&&typeof fe.componentWillMount!="function"||(typeof fe.componentWillMount=="function"&&fe.componentWillMount(),typeof fe.UNSAFE_componentWillMount=="function"&&fe.UNSAFE_componentWillMount()),typeof fe.componentDidMount=="function"&&(v.flags|=4194308)):(typeof fe.componentDidMount=="function"&&(v.flags|=4194308),v.memoizedProps=D,v.memoizedState=Ne),fe.props=D,fe.state=Ne,fe.context=rt,D=Te):(typeof fe.componentDidMount=="function"&&(v.flags|=4194308),D=!1)}else{fe=v.stateNode,Gr(p,v),Te=v.memoizedProps,rt=v.type===v.elementType?Te:Fa(v.type,Te),fe.props=rt,Tt=v.pendingProps,wt=fe.context,Ne=b.contextType,typeof Ne=="object"&&Ne!==null?Ne=la(Ne):(Ne=uo(b)?Uc:Hs.current,Ne=Gh(v,Ne));var Yt=b.getDerivedStateFromProps;(Ct=typeof Yt=="function"||typeof fe.getSnapshotBeforeUpdate=="function")||typeof fe.UNSAFE_componentWillReceiveProps!="function"&&typeof fe.componentWillReceiveProps!="function"||(Te!==Tt||wt!==Ne)&&S(v,fe,D,Ne),Di=!1,wt=v.memoizedState,fe.state=wt,Pr(v,D,fe,z);var tn=v.memoizedState;Te!==Tt||wt!==tn||Co.current||Di?(typeof Yt=="function"&&(Xp(v,b,Yt,D),tn=v.memoizedState),(rt=Di||r3(v,b,rt,D,wt,tn,Ne)||!1)?(Ct||typeof fe.UNSAFE_componentWillUpdate!="function"&&typeof fe.componentWillUpdate!="function"||(typeof fe.componentWillUpdate=="function"&&fe.componentWillUpdate(D,tn,Ne),typeof fe.UNSAFE_componentWillUpdate=="function"&&fe.UNSAFE_componentWillUpdate(D,tn,Ne)),typeof fe.componentDidUpdate=="function"&&(v.flags|=4),typeof fe.getSnapshotBeforeUpdate=="function"&&(v.flags|=1024)):(typeof fe.componentDidUpdate!="function"||Te===p.memoizedProps&&wt===p.memoizedState||(v.flags|=4),typeof fe.getSnapshotBeforeUpdate!="function"||Te===p.memoizedProps&&wt===p.memoizedState||(v.flags|=1024),v.memoizedProps=D,v.memoizedState=tn),fe.props=D,fe.state=tn,fe.context=Ne,D=rt):(typeof fe.componentDidUpdate!="function"||Te===p.memoizedProps&&wt===p.memoizedState||(v.flags|=4),typeof fe.getSnapshotBeforeUpdate!="function"||Te===p.memoizedProps&&wt===p.memoizedState||(v.flags|=1024),D=!1)}return Kn(p,v,b,D,ee,z)}function Kn(p,v,b,D,z,ee){at(p,v);var fe=(v.flags&128)!==0;if(!D&&!fe)return z&&ly(v,b,!1),tf(p,v,ee);D=v.stateNode,wn.current=v;var Te=fe&&typeof b.getDerivedStateFromError!="function"?null:D.render();return v.flags|=1,p!==null&&fe?(v.child=jh(v,p.child,null,ee),v.child=jh(v,null,Te,ee)):Wt(p,v,Te,ee),v.memoizedState=D.state,z&&ly(v,b,!0),v.child}function Qn(p){var v=p.stateNode;v.pendingContext?ay(p,v.pendingContext,v.pendingContext!==v.context):v.context&&ay(p,v.context,!1),Qp(p,v.containerInfo)}function pi(p,v,b,D,z){return Yu(),od(z),v.flags|=256,Wt(p,v,b,D),v.child}var qr={dehydrated:null,treeContext:null,retryLane:0};function hi(p){return{baseLanes:p,cachePool:null,transitions:null}}function Yc(p,v,b){var D=v.pendingProps,z=rr.current,ee=!1,fe=(v.flags&128)!==0,Te;if((Te=fe)||(Te=p!==null&&p.memoizedState===null?!1:(z&2)!==0),Te?(ee=!0,v.flags&=-129):(p===null||p.memoizedState!==null)&&(z|=1),Gi(rr,z&1),p===null)return q0(v),p=v.memoizedState,p!==null&&(p=p.dehydrated,p!==null)?((v.mode&1)===0?v.lanes=1:p.data==="$!"?v.lanes=8:v.lanes=1073741824,null):(fe=D.children,p=D.fallback,ee?(D=v.mode,ee=v.child,fe={mode:"hidden",children:fe},(D&1)===0&&ee!==null?(ee.childLanes=0,ee.pendingProps=fe):ee=y3(fe,D,0,null),p=tm(p,D,b,null),ee.return=v,p.return=v,ee.sibling=p,v.child=ee,v.child.memoizedState=hi(b),v.memoizedState=qr,p):Cy(v,fe));if(z=p.memoizedState,z!==null&&(Te=z.dehydrated,Te!==null))return CY(p,v,fe,D,Te,z,b);if(ee){ee=D.fallback,fe=v.mode,z=p.child,Te=z.sibling;var Ne={mode:"hidden",children:D.children};return(fe&1)===0&&v.child!==z?(D=v.child,D.childLanes=0,D.pendingProps=Ne,v.deletions=null):(D=Ad(z,Ne),D.subtreeFlags=z.subtreeFlags&14680064),Te!==null?ee=Ad(Te,ee):(ee=tm(ee,fe,b,null),ee.flags|=2),ee.return=v,D.return=v,D.sibling=ee,v.child=D,D=ee,ee=v.child,fe=p.child.memoizedState,fe=fe===null?hi(b):{baseLanes:fe.baseLanes|b,cachePool:null,transitions:fe.transitions},ee.memoizedState=fe,ee.childLanes=p.childLanes&~b,v.memoizedState=qr,D}return ee=p.child,p=ee.sibling,D=Ad(ee,{mode:"visible",children:D.children}),(v.mode&1)===0&&(D.lanes=b),D.return=v,D.sibling=null,p!==null&&(b=v.deletions,b===null?(v.deletions=[p],v.flags|=16):b.push(p)),v.child=D,v.memoizedState=null,D}function Cy(p,v){return v=y3({mode:"visible",children:v},p.mode,0,null),v.return=p,p.child=v}function s3(p,v,b,D){return D!==null&&od(D),jh(v,p.child,null,b),p=Cy(v,v.pendingProps.children),p.flags|=2,v.memoizedState=null,p}function CY(p,v,b,D,z,ee,fe){if(b)return v.flags&256?(v.flags&=-257,D=$(Error(t(422))),s3(p,v,fe,D)):v.memoizedState!==null?(v.child=p.child,v.flags|=128,null):(ee=D.fallback,z=v.mode,D=y3({mode:"visible",children:D.children},z,0,null),ee=tm(ee,z,fe,null),ee.flags|=2,D.return=v,ee.return=v,D.sibling=ee,v.child=D,(v.mode&1)!==0&&jh(v,p.child,null,fe),v.child.memoizedState=hi(fe),v.memoizedState=qr,ee);if((v.mode&1)===0)return s3(p,v,fe,null);if(z.data==="$!"){if(D=z.nextSibling&&z.nextSibling.dataset,D)var Te=D.dgst;return D=Te,ee=Error(t(419)),D=$(ee,D,void 0),s3(p,v,fe,D)}if(Te=(fe&p.childLanes)!==0,Zn||Te){if(D=po,D!==null){switch(fe&-fe){case 4:z=2;break;case 16:z=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:z=32;break;case 536870912:z=268435456;break;default:z=0}z=(z&(D.suspendedLanes|fe))!==0?0:z,z!==0&&z!==ee.retryLane&&(ee.retryLane=z,dl(p,z),qc(D,p,z,-1))}return bC(),D=$(Error(t(421))),s3(p,v,fe,D)}return z.data==="$?"?(v.flags|=128,v.child=p.child,v=NY.bind(null,p),z._reactRetry=v,null):(p=ee.treeContext,bo=Fc(z.nextSibling),Qs=v,ir=!0,ka=null,p!==null&&(To[Rs++]=kt,To[Rs++]=Da,To[Rs++]=Vh,kt=p.id,Da=p.overflow,Vh=v),v=Cy(v,D.children),v.flags|=4096,v)}function AP(p,v,b){p.lanes|=v;var D=p.alternate;D!==null&&(D.lanes|=v),Gp(p.return,v,b)}function fC(p,v,b,D,z){var ee=p.memoizedState;ee===null?p.memoizedState={isBackwards:v,rendering:null,renderingStartTime:0,last:D,tail:b,tailMode:z}:(ee.isBackwards=v,ee.rendering=null,ee.renderingStartTime=0,ee.last=D,ee.tail=b,ee.tailMode=z)}function yP(p,v,b){var D=v.pendingProps,z=D.revealOrder,ee=D.tail;if(Wt(p,v,D.children,b),D=rr.current,(D&2)!==0)D=D&1|2,v.flags|=128;else{if(p!==null&&(p.flags&128)!==0)e:for(p=v.child;p!==null;){if(p.tag===13)p.memoizedState!==null&&AP(p,b,v);else if(p.tag===19)AP(p,b,v);else if(p.child!==null){p.child.return=p,p=p.child;continue}if(p===v)break e;for(;p.sibling===null;){if(p.return===null||p.return===v)break e;p=p.return}p.sibling.return=p.return,p=p.sibling}D&=1}if(Gi(rr,D),(v.mode&1)===0)v.memoizedState=null;else switch(z){case"forwards":for(b=v.child,z=null;b!==null;)p=b.alternate,p!==null&&pl(p)===null&&(z=b),b=b.sibling;b=z,b===null?(z=v.child,v.child=null):(z=b.sibling,b.sibling=null),fC(v,!1,z,b,ee);break;case"backwards":for(b=null,z=v.child,v.child=null;z!==null;){if(p=z.alternate,p!==null&&pl(p)===null){v.child=z;break}p=z.sibling,z.sibling=b,b=z,z=p}fC(v,!0,b,null,ee);break;case"together":fC(v,!1,null,null,void 0);break;default:v.memoizedState=null}return v.child}function o3(p,v){(v.mode&1)===0&&p!==null&&(p.alternate=null,v.alternate=null,v.flags|=2)}function tf(p,v,b){if(p!==null&&(v.dependencies=p.dependencies),qp|=v.lanes,(b&v.childLanes)===0)return null;if(p!==null&&v.child!==p.child)throw Error(t(153));if(v.child!==null){for(p=v.child,b=Ad(p,p.pendingProps),v.child=b,b.return=v;p.sibling!==null;)p=p.sibling,b=b.sibling=Ad(p,p.pendingProps),b.return=v;b.sibling=null}return v.child}function TY(p,v,b){switch(v.tag){case 3:Qn(v),Yu();break;case 5:qh(v);break;case 1:uo(v.type)&&Hh(v);break;case 4:Qp(v,v.stateNode.containerInfo);break;case 10:var D=v.type._context,z=v.memoizedProps.value;Gi(Wh,D._currentValue),D._currentValue=z;break;case 13:if(D=v.memoizedState,D!==null)return D.dehydrated!==null?(Gi(rr,rr.current&1),v.flags|=128,null):(b&v.child.childLanes)!==0?Yc(p,v,b):(Gi(rr,rr.current&1),p=tf(p,v,b),p!==null?p.sibling:null);Gi(rr,rr.current&1);break;case 19:if(D=(b&v.childLanes)!==0,(p.flags&128)!==0){if(D)return yP(p,v,b);v.flags|=128}if(z=v.memoizedState,z!==null&&(z.rendering=null,z.tail=null,z.lastEffect=null),Gi(rr,rr.current),D)break;return null;case 22:case 23:return v.lanes=0,Qe(p,v,b)}return tf(p,v,b)}var vP,dC,xP,EP;vP=function(p,v){for(var b=v.child;b!==null;){if(b.tag===5||b.tag===6)p.appendChild(b.stateNode);else if(b.tag!==4&&b.child!==null){b.child.return=b,b=b.child;continue}if(b===v)break;for(;b.sibling===null;){if(b.return===null||b.return===v)return;b=b.return}b.sibling.return=b.return,b=b.sibling}},dC=function(){},xP=function(p,v,b,D){var z=p.memoizedProps;if(z!==D){p=v.stateNode,Xr(ca.current);var ee=null;switch(b){case"input":z=Se(p,z),D=Se(p,D),ee=[];break;case"select":z=W({},z,{value:void 0}),D=W({},D,{value:void 0}),ee=[];break;case"textarea":z=Re(p,z),D=Re(p,D),ee=[];break;default:typeof z.onClick!="function"&&typeof D.onClick=="function"&&(p.onclick=Lp)}Ce(b,D);var fe;b=null;for(rt in z)if(!D.hasOwnProperty(rt)&&z.hasOwnProperty(rt)&&z[rt]!=null)if(rt==="style"){var Te=z[rt];for(fe in Te)Te.hasOwnProperty(fe)&&(b||(b={}),b[fe]="")}else rt!=="dangerouslySetInnerHTML"&&rt!=="children"&&rt!=="suppressContentEditableWarning"&&rt!=="suppressHydrationWarning"&&rt!=="autoFocus"&&(r.hasOwnProperty(rt)?ee||(ee=[]):(ee=ee||[]).push(rt,null));for(rt in D){var Ne=D[rt];if(Te=z!=null?z[rt]:void 0,D.hasOwnProperty(rt)&&Ne!==Te&&(Ne!=null||Te!=null))if(rt==="style")if(Te){for(fe in Te)!Te.hasOwnProperty(fe)||Ne&&Ne.hasOwnProperty(fe)||(b||(b={}),b[fe]="");for(fe in Ne)Ne.hasOwnProperty(fe)&&Te[fe]!==Ne[fe]&&(b||(b={}),b[fe]=Ne[fe])}else b||(ee||(ee=[]),ee.push(rt,b)),b=Ne;else rt==="dangerouslySetInnerHTML"?(Ne=Ne?Ne.__html:void 0,Te=Te?Te.__html:void 0,Ne!=null&&Te!==Ne&&(ee=ee||[]).push(rt,Ne)):rt==="children"?typeof Ne!="string"&&typeof Ne!="number"||(ee=ee||[]).push(rt,""+Ne):rt!=="suppressContentEditableWarning"&&rt!=="suppressHydrationWarning"&&(r.hasOwnProperty(rt)?(Ne!=null&&rt==="onScroll"&&Yi("scroll",p),ee||Te===Ne||(ee=[])):(ee=ee||[]).push(rt,Ne))}b&&(ee=ee||[]).push("style",b);var rt=ee;(v.updateQueue=rt)&&(v.flags|=4)}},EP=function(p,v,b,D){b!==D&&(v.flags|=4)};function Ty(p,v){if(!ir)switch(p.tailMode){case"hidden":v=p.tail;for(var b=null;v!==null;)v.alternate!==null&&(b=v),v=v.sibling;b===null?p.tail=null:b.sibling=null;break;case"collapsed":b=p.tail;for(var D=null;b!==null;)b.alternate!==null&&(D=b),b=b.sibling;D===null?v||p.tail===null?p.tail=null:p.tail.sibling=null:D.sibling=null}}function jo(p){var v=p.alternate!==null&&p.alternate.child===p.child,b=0,D=0;if(v)for(var z=p.child;z!==null;)b|=z.lanes|z.childLanes,D|=z.subtreeFlags&14680064,D|=z.flags&14680064,z.return=p,z=z.sibling;else for(z=p.child;z!==null;)b|=z.lanes|z.childLanes,D|=z.subtreeFlags,D|=z.flags,z.return=p,z=z.sibling;return p.subtreeFlags|=D,p.childLanes=b,v}function bY(p,v,b){var D=v.pendingProps;switch(Gc(v),v.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return jo(v),null;case 1:return uo(v.type)&&Bp(),jo(v),null;case 3:return D=v.stateNode,Xu(),$i(Co),$i(Hs),Kl(),D.pendingContext&&(D.context=D.pendingContext,D.pendingContext=null),(p===null||p.child===null)&&(sd(v)?v.flags|=4:p===null||p.memoizedState.isDehydrated&&(v.flags&256)===0||(v.flags|=1024,ka!==null&&(wC(ka),ka=null))),dC(p,v),jo(v),null;case 5:cd(v);var z=Xr(Vc.current);if(b=v.type,p!==null&&v.stateNode!=null)xP(p,v,b,D,z),p.ref!==v.ref&&(v.flags|=512,v.flags|=2097152);else{if(!D){if(v.stateNode===null)throw Error(t(166));return jo(v),null}if(p=Xr(ca.current),sd(v)){D=v.stateNode,b=v.type;var ee=v.memoizedProps;switch(D[hs]=v,D[rd]=ee,p=(v.mode&1)!==0,b){case"dialog":Yi("cancel",D),Yi("close",D);break;case"iframe":case"object":case"embed":Yi("load",D);break;case"video":case"audio":for(z=0;z<Wu.length;z++)Yi(Wu[z],D);break;case"source":Yi("error",D);break;case"img":case"image":case"link":Yi("error",D),Yi("load",D);break;case"details":Yi("toggle",D);break;case"input":ve(D,ee),Yi("invalid",D);break;case"select":D._wrapperState={wasMultiple:!!ee.multiple},Yi("invalid",D);break;case"textarea":Le(D,ee),Yi("invalid",D)}Ce(b,ee),z=null;for(var fe in ee)if(ee.hasOwnProperty(fe)){var Te=ee[fe];fe==="children"?typeof Te=="string"?D.textContent!==Te&&(ee.suppressHydrationWarning!==!0&&Pp(D.textContent,Te,p),z=["children",Te]):typeof Te=="number"&&D.textContent!==""+Te&&(ee.suppressHydrationWarning!==!0&&Pp(D.textContent,Te,p),z=["children",""+Te]):r.hasOwnProperty(fe)&&Te!=null&&fe==="onScroll"&&Yi("scroll",D)}switch(b){case"input":pe(D),be(D,ee,!0);break;case"textarea":pe(D),He(D);break;case"select":case"option":break;default:typeof ee.onClick=="function"&&(D.onclick=Lp)}D=z,v.updateQueue=D,D!==null&&(v.flags|=4)}else{fe=z.nodeType===9?z:z.ownerDocument,p==="http://www.w3.org/1999/xhtml"&&(p=it(b)),p==="http://www.w3.org/1999/xhtml"?b==="script"?(p=fe.createElement("div"),p.innerHTML="<script><\/script>",p=p.removeChild(p.firstChild)):typeof D.is=="string"?p=fe.createElement(b,{is:D.is}):(p=fe.createElement(b),b==="select"&&(fe=p,D.multiple?fe.multiple=!0:D.size&&(fe.size=D.size))):p=fe.createElementNS(p,b),p[hs]=v,p[rd]=D,vP(p,v,!1,!1),v.stateNode=p;e:{switch(fe=qe(b,D),b){case"dialog":Yi("cancel",p),Yi("close",p),z=D;break;case"iframe":case"object":case"embed":Yi("load",p),z=D;break;case"video":case"audio":for(z=0;z<Wu.length;z++)Yi(Wu[z],p);z=D;break;case"source":Yi("error",p),z=D;break;case"img":case"image":case"link":Yi("error",p),Yi("load",p),z=D;break;case"details":Yi("toggle",p),z=D;break;case"input":ve(p,D),z=Se(p,D),Yi("invalid",p);break;case"option":z=D;break;case"select":p._wrapperState={wasMultiple:!!D.multiple},z=W({},D,{value:void 0}),Yi("invalid",p);break;case"textarea":Le(p,D),z=Re(p,D),Yi("invalid",p);break;default:z=D}Ce(b,z),Te=z;for(ee in Te)if(Te.hasOwnProperty(ee)){var Ne=Te[ee];ee==="style"?gt(p,Ne):ee==="dangerouslySetInnerHTML"?(Ne=Ne?Ne.__html:void 0,Ne!=null&&pt(p,Ne)):ee==="children"?typeof Ne=="string"?(b!=="textarea"||Ne!=="")&&je(p,Ne):typeof Ne=="number"&&je(p,""+Ne):ee!=="suppressContentEditableWarning"&&ee!=="suppressHydrationWarning"&&ee!=="autoFocus"&&(r.hasOwnProperty(ee)?Ne!=null&&ee==="onScroll"&&Yi("scroll",p):Ne!=null&&x(p,ee,Ne,fe))}switch(b){case"input":pe(p),be(p,D,!1);break;case"textarea":pe(p),He(p);break;case"option":D.value!=null&&p.setAttribute("value",""+se(D.value));break;case"select":p.multiple=!!D.multiple,ee=D.value,ee!=null?de(p,!!D.multiple,ee,!1):D.defaultValue!=null&&de(p,!!D.multiple,D.defaultValue,!0);break;default:typeof z.onClick=="function"&&(p.onclick=Lp)}switch(b){case"button":case"input":case"select":case"textarea":D=!!D.autoFocus;break e;case"img":D=!0;break e;default:D=!1}}D&&(v.flags|=4)}v.ref!==null&&(v.flags|=512,v.flags|=2097152)}return jo(v),null;case 6:if(p&&v.stateNode!=null)EP(p,v,p.memoizedProps,D);else{if(typeof D!="string"&&v.stateNode===null)throw Error(t(166));if(b=Xr(Vc.current),Xr(ca.current),sd(v)){if(D=v.stateNode,b=v.memoizedProps,D[hs]=v,(ee=D.nodeValue!==b)&&(p=Qs,p!==null))switch(p.tag){case 3:Pp(D.nodeValue,b,(p.mode&1)!==0);break;case 5:p.memoizedProps.suppressHydrationWarning!==!0&&Pp(D.nodeValue,b,(p.mode&1)!==0)}ee&&(v.flags|=4)}else D=(b.nodeType===9?b:b.ownerDocument).createTextNode(D),D[hs]=v,v.stateNode=D}return jo(v),null;case 13:if($i(rr),D=v.memoizedState,p===null||p.memoizedState!==null&&p.memoizedState.dehydrated!==null){if(ir&&bo!==null&&(v.mode&1)!==0&&(v.flags&128)===0)dy(),Yu(),v.flags|=98560,ee=!1;else if(ee=sd(v),D!==null&&D.dehydrated!==null){if(p===null){if(!ee)throw Error(t(318));if(ee=v.memoizedState,ee=ee!==null?ee.dehydrated:null,!ee)throw Error(t(317));ee[hs]=v}else Yu(),(v.flags&128)===0&&(v.memoizedState=null),v.flags|=4;jo(v),ee=!1}else ka!==null&&(wC(ka),ka=null),ee=!0;if(!ee)return v.flags&65536?v:null}return(v.flags&128)!==0?(v.lanes=b,v):(D=D!==null,D!==(p!==null&&p.memoizedState!==null)&&D&&(v.child.flags|=8192,(v.mode&1)!==0&&(p===null||(rr.current&1)!==0?Ks===0&&(Ks=3):bC())),v.updateQueue!==null&&(v.flags|=4),jo(v),null);case 4:return Xu(),dC(p,v),p===null&&td(v.stateNode.containerInfo),jo(v),null;case 10:return zp(v.type._context),jo(v),null;case 17:return uo(v.type)&&Bp(),jo(v),null;case 19:if($i(rr),ee=v.memoizedState,ee===null)return jo(v),null;if(D=(v.flags&128)!==0,fe=ee.rendering,fe===null)if(D)Ty(ee,!1);else{if(Ks!==0||p!==null&&(p.flags&128)!==0)for(p=v.child;p!==null;){if(fe=pl(p),fe!==null){for(v.flags|=128,Ty(ee,!1),D=fe.updateQueue,D!==null&&(v.updateQueue=D,v.flags|=4),v.subtreeFlags=0,D=b,b=v.child;b!==null;)ee=b,p=D,ee.flags&=14680066,fe=ee.alternate,fe===null?(ee.childLanes=0,ee.lanes=p,ee.child=null,ee.subtreeFlags=0,ee.memoizedProps=null,ee.memoizedState=null,ee.updateQueue=null,ee.dependencies=null,ee.stateNode=null):(ee.childLanes=fe.childLanes,ee.lanes=fe.lanes,ee.child=fe.child,ee.subtreeFlags=0,ee.deletions=null,ee.memoizedProps=fe.memoizedProps,ee.memoizedState=fe.memoizedState,ee.updateQueue=fe.updateQueue,ee.type=fe.type,p=fe.dependencies,ee.dependencies=p===null?null:{lanes:p.lanes,firstContext:p.firstContext}),b=b.sibling;return Gi(rr,rr.current&1|2),v.child}p=p.sibling}ee.tail!==null&&Oe()>cg&&(v.flags|=128,D=!0,Ty(ee,!1),v.lanes=4194304)}else{if(!D)if(p=pl(fe),p!==null){if(v.flags|=128,D=!0,b=p.updateQueue,b!==null&&(v.updateQueue=b,v.flags|=4),Ty(ee,!0),ee.tail===null&&ee.tailMode==="hidden"&&!fe.alternate&&!ir)return jo(v),null}else 2*Oe()-ee.renderingStartTime>cg&&b!==1073741824&&(v.flags|=128,D=!0,Ty(ee,!1),v.lanes=4194304);ee.isBackwards?(fe.sibling=v.child,v.child=fe):(b=ee.last,b!==null?b.sibling=fe:v.child=fe,ee.last=fe)}return ee.tail!==null?(v=ee.tail,ee.rendering=v,ee.tail=v.sibling,ee.renderingStartTime=Oe(),v.sibling=null,b=rr.current,Gi(rr,D?b&1|2:b&1),v):(jo(v),null);case 22:case 23:return TC(),D=v.memoizedState!==null,p!==null&&p.memoizedState!==null!==D&&(v.flags|=8192),D&&(v.mode&1)!==0?(Al&1073741824)!==0&&(jo(v),v.subtreeFlags&6&&(v.flags|=8192)):jo(v),null;case 24:return null;case 25:return null}throw Error(t(156,v.tag))}function IY(p,v){switch(Gc(v),v.tag){case 1:return uo(v.type)&&Bp(),p=v.flags,p&65536?(v.flags=p&-65537|128,v):null;case 3:return Xu(),$i(Co),$i(Hs),Kl(),p=v.flags,(p&65536)!==0&&(p&128)===0?(v.flags=p&-65537|128,v):null;case 5:return cd(v),null;case 13:if($i(rr),p=v.memoizedState,p!==null&&p.dehydrated!==null){if(v.alternate===null)throw Error(t(340));Yu()}return p=v.flags,p&65536?(v.flags=p&-65537|128,v):null;case 19:return $i(rr),null;case 4:return Xu(),null;case 10:return zp(v.type._context),null;case 22:case 23:return TC(),null;case 24:return null;default:return null}}var a3=!1,Wo=!1,MY=typeof WeakSet=="function"?WeakSet:Set,Zt=null;function ag(p,v){var b=p.ref;if(b!==null)if(typeof b=="function")try{b(null)}catch(D){Jr(p,v,D)}else b.current=null}function pC(p,v,b){try{b()}catch(D){Jr(p,v,D)}}var _P=!1;function RY(p,v){if(id=Ss,p=_r(),Ts(p)){if("selectionStart"in p)var b={start:p.selectionStart,end:p.selectionEnd};else e:{b=(b=p.ownerDocument)&&b.defaultView||window;var D=b.getSelection&&b.getSelection();if(D&&D.rangeCount!==0){b=D.anchorNode;var z=D.anchorOffset,ee=D.focusNode;D=D.focusOffset;try{b.nodeType,ee.nodeType}catch{b=null;break e}var fe=0,Te=-1,Ne=-1,rt=0,Ct=0,Tt=p,wt=null;t:for(;;){for(var Yt;Tt!==b||z!==0&&Tt.nodeType!==3||(Te=fe+z),Tt!==ee||D!==0&&Tt.nodeType!==3||(Ne=fe+D),Tt.nodeType===3&&(fe+=Tt.nodeValue.length),(Yt=Tt.firstChild)!==null;)wt=Tt,Tt=Yt;for(;;){if(Tt===p)break t;if(wt===b&&++rt===z&&(Te=fe),wt===ee&&++Ct===D&&(Ne=fe),(Yt=Tt.nextSibling)!==null)break;Tt=wt,wt=Tt.parentNode}Tt=Yt}b=Te===-1||Ne===-1?null:{start:Te,end:Ne}}else b=null}b=b||{start:0,end:0}}else b=null;for(ty={focusedElem:p,selectionRange:b},Ss=!1,Zt=v;Zt!==null;)if(v=Zt,p=v.child,(v.subtreeFlags&1028)!==0&&p!==null)p.return=v,Zt=p;else for(;Zt!==null;){v=Zt;try{var tn=v.alternate;if((v.flags&1024)!==0)switch(v.tag){case 0:case 11:case 15:break;case 1:if(tn!==null){var nn=tn.memoizedProps,fs=tn.memoizedState,$e=v.stateNode,ze=$e.getSnapshotBeforeUpdate(v.elementType===v.type?nn:Fa(v.type,nn),fs);$e.__reactInternalSnapshotBeforeUpdate=ze}break;case 3:var Ze=v.stateNode.containerInfo;Ze.nodeType===1?Ze.textContent="":Ze.nodeType===9&&Ze.documentElement&&Ze.removeChild(Ze.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(t(163))}}catch(Pt){Jr(v,v.return,Pt)}if(p=v.sibling,p!==null){p.return=v.return,Zt=p;break}Zt=v.return}return tn=_P,_P=!1,tn}function by(p,v,b){var D=v.updateQueue;if(D=D!==null?D.lastEffect:null,D!==null){var z=D=D.next;do{if((z.tag&p)===p){var ee=z.destroy;z.destroy=void 0,ee!==void 0&&pC(v,b,ee)}z=z.next}while(z!==D)}}function l3(p,v){if(v=v.updateQueue,v=v!==null?v.lastEffect:null,v!==null){var b=v=v.next;do{if((b.tag&p)===p){var D=b.create;b.destroy=D()}b=b.next}while(b!==v)}}function mC(p){var v=p.ref;if(v!==null){var b=p.stateNode;switch(p.tag){case 5:p=b;break;default:p=b}typeof v=="function"?v(p):v.current=p}}function SP(p){var v=p.alternate;v!==null&&(p.alternate=null,SP(v)),p.child=null,p.deletions=null,p.sibling=null,p.tag===5&&(v=p.stateNode,v!==null&&(delete v[hs],delete v[rd],delete v[zh],delete v[V0],delete v[j0])),p.stateNode=null,p.return=null,p.dependencies=null,p.memoizedProps=null,p.memoizedState=null,p.pendingProps=null,p.stateNode=null,p.updateQueue=null}function wP(p){return p.tag===5||p.tag===3||p.tag===4}function CP(p){e:for(;;){for(;p.sibling===null;){if(p.return===null||wP(p.return))return null;p=p.return}for(p.sibling.return=p.return,p=p.sibling;p.tag!==5&&p.tag!==6&&p.tag!==18;){if(p.flags&2||p.child===null||p.tag===4)continue e;p.child.return=p,p=p.child}if(!(p.flags&2))return p.stateNode}}function gC(p,v,b){var D=p.tag;if(D===5||D===6)p=p.stateNode,v?b.nodeType===8?b.parentNode.insertBefore(p,v):b.insertBefore(p,v):(b.nodeType===8?(v=b.parentNode,v.insertBefore(p,b)):(v=b,v.appendChild(p)),b=b._reactRootContainer,b!=null||v.onclick!==null||(v.onclick=Lp));else if(D!==4&&(p=p.child,p!==null))for(gC(p,v,b),p=p.sibling;p!==null;)gC(p,v,b),p=p.sibling}function AC(p,v,b){var D=p.tag;if(D===5||D===6)p=p.stateNode,v?b.insertBefore(p,v):b.appendChild(p);else if(D!==4&&(p=p.child,p!==null))for(AC(p,v,b),p=p.sibling;p!==null;)AC(p,v,b),p=p.sibling}var Mo=null,$c=!1;function fd(p,v,b){for(b=b.child;b!==null;)TP(p,v,b),b=b.sibling}function TP(p,v,b){if(Dt&&typeof Dt.onCommitFiberUnmount=="function")try{Dt.onCommitFiberUnmount(vn,b)}catch{}switch(b.tag){case 5:Wo||ag(b,v);case 6:var D=Mo,z=$c;Mo=null,fd(p,v,b),Mo=D,$c=z,Mo!==null&&($c?(p=Mo,b=b.stateNode,p.nodeType===8?p.parentNode.removeChild(b):p.removeChild(b)):Mo.removeChild(b.stateNode));break;case 18:Mo!==null&&($c?(p=Mo,b=b.stateNode,p.nodeType===8?Q0(p.parentNode,b):p.nodeType===1&&Q0(p,b),Nu(p)):Q0(Mo,b.stateNode));break;case 4:D=Mo,z=$c,Mo=b.stateNode.containerInfo,$c=!0,fd(p,v,b),Mo=D,$c=z;break;case 0:case 11:case 14:case 15:if(!Wo&&(D=b.updateQueue,D!==null&&(D=D.lastEffect,D!==null))){z=D=D.next;do{var ee=z,fe=ee.destroy;ee=ee.tag,fe!==void 0&&((ee&2)!==0||(ee&4)!==0)&&pC(b,v,fe),z=z.next}while(z!==D)}fd(p,v,b);break;case 1:if(!Wo&&(ag(b,v),D=b.stateNode,typeof D.componentWillUnmount=="function"))try{D.props=b.memoizedProps,D.state=b.memoizedState,D.componentWillUnmount()}catch(Te){Jr(b,v,Te)}fd(p,v,b);break;case 21:fd(p,v,b);break;case 22:b.mode&1?(Wo=(D=Wo)||b.memoizedState!==null,fd(p,v,b),Wo=D):fd(p,v,b);break;default:fd(p,v,b)}}function bP(p){var v=p.updateQueue;if(v!==null){p.updateQueue=null;var b=p.stateNode;b===null&&(b=p.stateNode=new MY),v.forEach(function(D){var z=UY.bind(null,p,D);b.has(D)||(b.add(D),D.then(z,z))})}}function Xc(p,v){var b=v.deletions;if(b!==null)for(var D=0;D<b.length;D++){var z=b[D];try{var ee=p,fe=v,Te=fe;e:for(;Te!==null;){switch(Te.tag){case 5:Mo=Te.stateNode,$c=!1;break e;case 3:Mo=Te.stateNode.containerInfo,$c=!0;break e;case 4:Mo=Te.stateNode.containerInfo,$c=!0;break e}Te=Te.return}if(Mo===null)throw Error(t(160));TP(ee,fe,z),Mo=null,$c=!1;var Ne=z.alternate;Ne!==null&&(Ne.return=null),z.return=null}catch(rt){Jr(z,v,rt)}}if(v.subtreeFlags&12854)for(v=v.child;v!==null;)IP(v,p),v=v.sibling}function IP(p,v){var b=p.alternate,D=p.flags;switch(p.tag){case 0:case 11:case 14:case 15:if(Xc(v,p),Ju(p),D&4){try{by(3,p,p.return),l3(3,p)}catch(nn){Jr(p,p.return,nn)}try{by(5,p,p.return)}catch(nn){Jr(p,p.return,nn)}}break;case 1:Xc(v,p),Ju(p),D&512&&b!==null&&ag(b,b.return);break;case 5:if(Xc(v,p),Ju(p),D&512&&b!==null&&ag(b,b.return),p.flags&32){var z=p.stateNode;try{je(z,"")}catch(nn){Jr(p,p.return,nn)}}if(D&4&&(z=p.stateNode,z!=null)){var ee=p.memoizedProps,fe=b!==null?b.memoizedProps:ee,Te=p.type,Ne=p.updateQueue;if(p.updateQueue=null,Ne!==null)try{Te==="input"&&ee.type==="radio"&&ee.name!=null&&Ae(z,ee),qe(Te,fe);var rt=qe(Te,ee);for(fe=0;fe<Ne.length;fe+=2){var Ct=Ne[fe],Tt=Ne[fe+1];Ct==="style"?gt(z,Tt):Ct==="dangerouslySetInnerHTML"?pt(z,Tt):Ct==="children"?je(z,Tt):x(z,Ct,Tt,rt)}switch(Te){case"input":ke(z,ee);break;case"textarea":Fe(z,ee);break;case"select":var wt=z._wrapperState.wasMultiple;z._wrapperState.wasMultiple=!!ee.multiple;var Yt=ee.value;Yt!=null?de(z,!!ee.multiple,Yt,!1):wt!==!!ee.multiple&&(ee.defaultValue!=null?de(z,!!ee.multiple,ee.defaultValue,!0):de(z,!!ee.multiple,ee.multiple?[]:"",!1))}z[rd]=ee}catch(nn){Jr(p,p.return,nn)}}break;case 6:if(Xc(v,p),Ju(p),D&4){if(p.stateNode===null)throw Error(t(162));z=p.stateNode,ee=p.memoizedProps;try{z.nodeValue=ee}catch(nn){Jr(p,p.return,nn)}}break;case 3:if(Xc(v,p),Ju(p),D&4&&b!==null&&b.memoizedState.isDehydrated)try{Nu(v.containerInfo)}catch(nn){Jr(p,p.return,nn)}break;case 4:Xc(v,p),Ju(p);break;case 13:Xc(v,p),Ju(p),z=p.child,z.flags&8192&&(ee=z.memoizedState!==null,z.stateNode.isHidden=ee,!ee||z.alternate!==null&&z.alternate.memoizedState!==null||(xC=Oe())),D&4&&bP(p);break;case 22:if(Ct=b!==null&&b.memoizedState!==null,p.mode&1?(Wo=(rt=Wo)||Ct,Xc(v,p),Wo=rt):Xc(v,p),Ju(p),D&8192){if(rt=p.memoizedState!==null,(p.stateNode.isHidden=rt)&&!Ct&&(p.mode&1)!==0)for(Zt=p,Ct=p.child;Ct!==null;){for(Tt=Zt=Ct;Zt!==null;){switch(wt=Zt,Yt=wt.child,wt.tag){case 0:case 11:case 14:case 15:by(4,wt,wt.return);break;case 1:ag(wt,wt.return);var tn=wt.stateNode;if(typeof tn.componentWillUnmount=="function"){D=wt,b=wt.return;try{v=D,tn.props=v.memoizedProps,tn.state=v.memoizedState,tn.componentWillUnmount()}catch(nn){Jr(D,b,nn)}}break;case 5:ag(wt,wt.return);break;case 22:if(wt.memoizedState!==null){PP(Tt);continue}}Yt!==null?(Yt.return=wt,Zt=Yt):PP(Tt)}Ct=Ct.sibling}e:for(Ct=null,Tt=p;;){if(Tt.tag===5){if(Ct===null){Ct=Tt;try{z=Tt.stateNode,rt?(ee=z.style,typeof ee.setProperty=="function"?ee.setProperty("display","none","important"):ee.display="none"):(Te=Tt.stateNode,Ne=Tt.memoizedProps.style,fe=Ne!=null&&Ne.hasOwnProperty("display")?Ne.display:null,Te.style.display=St("display",fe))}catch(nn){Jr(p,p.return,nn)}}}else if(Tt.tag===6){if(Ct===null)try{Tt.stateNode.nodeValue=rt?"":Tt.memoizedProps}catch(nn){Jr(p,p.return,nn)}}else if((Tt.tag!==22&&Tt.tag!==23||Tt.memoizedState===null||Tt===p)&&Tt.child!==null){Tt.child.return=Tt,Tt=Tt.child;continue}if(Tt===p)break e;for(;Tt.sibling===null;){if(Tt.return===null||Tt.return===p)break e;Ct===Tt&&(Ct=null),Tt=Tt.return}Ct===Tt&&(Ct=null),Tt.sibling.return=Tt.return,Tt=Tt.sibling}}break;case 19:Xc(v,p),Ju(p),D&4&&bP(p);break;case 21:break;default:Xc(v,p),Ju(p)}}function Ju(p){var v=p.flags;if(v&2){try{e:{for(var b=p.return;b!==null;){if(wP(b)){var D=b;break e}b=b.return}throw Error(t(160))}switch(D.tag){case 5:var z=D.stateNode;D.flags&32&&(je(z,""),D.flags&=-33);var ee=CP(p);AC(p,ee,z);break;case 3:case 4:var fe=D.stateNode.containerInfo,Te=CP(p);gC(p,Te,fe);break;default:throw Error(t(161))}}catch(Ne){Jr(p,p.return,Ne)}p.flags&=-3}v&4096&&(p.flags&=-4097)}function PY(p,v,b){Zt=p,MP(p)}function MP(p,v,b){for(var D=(p.mode&1)!==0;Zt!==null;){var z=Zt,ee=z.child;if(z.tag===22&&D){var fe=z.memoizedState!==null||a3;if(!fe){var Te=z.alternate,Ne=Te!==null&&Te.memoizedState!==null||Wo;Te=a3;var rt=Wo;if(a3=fe,(Wo=Ne)&&!rt)for(Zt=z;Zt!==null;)fe=Zt,Ne=fe.child,fe.tag===22&&fe.memoizedState!==null?LP(z):Ne!==null?(Ne.return=fe,Zt=Ne):LP(z);for(;ee!==null;)Zt=ee,MP(ee),ee=ee.sibling;Zt=z,a3=Te,Wo=rt}RP(p)}else(z.subtreeFlags&8772)!==0&&ee!==null?(ee.return=z,Zt=ee):RP(p)}}function RP(p){for(;Zt!==null;){var v=Zt;if((v.flags&8772)!==0){var b=v.alternate;try{if((v.flags&8772)!==0)switch(v.tag){case 0:case 11:case 15:Wo||l3(5,v);break;case 1:var D=v.stateNode;if(v.flags&4&&!Wo)if(b===null)D.componentDidMount();else{var z=v.elementType===v.type?b.memoizedProps:Fa(v.type,b.memoizedProps);D.componentDidUpdate(z,b.memoizedState,D.__reactInternalSnapshotBeforeUpdate)}var ee=v.updateQueue;ee!==null&&ld(v,ee,D);break;case 3:var fe=v.updateQueue;if(fe!==null){if(b=null,v.child!==null)switch(v.child.tag){case 5:b=v.child.stateNode;break;case 1:b=v.child.stateNode}ld(v,fe,b)}break;case 5:var Te=v.stateNode;if(b===null&&v.flags&4){b=Te;var Ne=v.memoizedProps;switch(v.type){case"button":case"input":case"select":case"textarea":Ne.autoFocus&&b.focus();break;case"img":Ne.src&&(b.src=Ne.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(v.memoizedState===null){var rt=v.alternate;if(rt!==null){var Ct=rt.memoizedState;if(Ct!==null){var Tt=Ct.dehydrated;Tt!==null&&Nu(Tt)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(t(163))}Wo||v.flags&512&&mC(v)}catch(wt){Jr(v,v.return,wt)}}if(v===p){Zt=null;break}if(b=v.sibling,b!==null){b.return=v.return,Zt=b;break}Zt=v.return}}function PP(p){for(;Zt!==null;){var v=Zt;if(v===p){Zt=null;break}var b=v.sibling;if(b!==null){b.return=v.return,Zt=b;break}Zt=v.return}}function LP(p){for(;Zt!==null;){var v=Zt;try{switch(v.tag){case 0:case 11:case 15:var b=v.return;try{l3(4,v)}catch(Ne){Jr(v,b,Ne)}break;case 1:var D=v.stateNode;if(typeof D.componentDidMount=="function"){var z=v.return;try{D.componentDidMount()}catch(Ne){Jr(v,z,Ne)}}var ee=v.return;try{mC(v)}catch(Ne){Jr(v,ee,Ne)}break;case 5:var fe=v.return;try{mC(v)}catch(Ne){Jr(v,fe,Ne)}}}catch(Ne){Jr(v,v.return,Ne)}if(v===p){Zt=null;break}var Te=v.sibling;if(Te!==null){Te.return=v.return,Zt=Te;break}Zt=v.return}}var LY=Math.ceil,c3=w.ReactCurrentDispatcher,yC=w.ReactCurrentOwner,$l=w.ReactCurrentBatchConfig,_i=0,po=null,Ps=null,Ro=0,Al=0,lg=Rr(0),Ks=0,Iy=null,qp=0,u3=0,vC=0,My=null,Oa=null,xC=0,cg=1/0,nf=null,h3=!1,EC=null,dd=null,f3=!1,pd=null,d3=0,Ry=0,_C=null,p3=-1,m3=0;function da(){return(_i&6)!==0?Oe():p3!==-1?p3:p3=Oe()}function md(p){return(p.mode&1)===0?1:(_i&2)!==0&&Ro!==0?Ro&-Ro:uC.transition!==null?(m3===0&&(m3=Ri()),m3):(p=ri,p!==0||(p=window.event,p=p===void 0?16:zu(p.type)),p)}function qc(p,v,b,D){if(50<Ry)throw Ry=0,_C=null,Error(t(185));nr(p,b,D),((_i&2)===0||p!==po)&&(p===po&&((_i&2)===0&&(u3|=b),Ks===4&&gd(p,Ro)),Na(p,D),b===1&&_i===0&&(v.mode&1)===0&&(cg=Oe()+500,kp&&jl()))}function Na(p,v){var b=p.callbackNode;Bn(p,v);var D=kn(p,p===po?Ro:0);if(D===0)b!==null&&Je(b),p.callbackNode=null,p.callbackPriority=0;else if(v=D&-D,p.callbackPriority!==v){if(b!=null&&Je(b),v===1)p.tag===0?Yx(DP.bind(null,p)):Fp(DP.bind(null,p)),cC(function(){(_i&6)===0&&jl()}),b=null;else{switch(Ul(D)){case 1:b=xt;break;case 4:b=Et;break;case 16:b=Qt;break;case 536870912:b=ln;break;default:b=Qt}b=HP(b,BP.bind(null,p))}p.callbackPriority=v,p.callbackNode=b}}function BP(p,v){if(p3=-1,m3=0,(_i&6)!==0)throw Error(t(327));var b=p.callbackNode;if(ug()&&p.callbackNode!==b)return null;var D=kn(p,p===po?Ro:0);if(D===0)return null;if((D&30)!==0||(D&p.expiredLanes)!==0||v)v=g3(p,D);else{v=D;var z=_i;_i|=2;var ee=FP();(po!==p||Ro!==v)&&(nf=null,cg=Oe()+500,Zp(p,v));do try{kY();break}catch(Te){kP(p,Te)}while(!0);Yh(),c3.current=ee,_i=z,Ps!==null?v=0:(po=null,Ro=0,v=Ks)}if(v!==0){if(v===2&&(z=Pn(p),z!==0&&(D=z,v=SC(p,z))),v===1)throw b=Iy,Zp(p,0),gd(p,D),Na(p,Oe()),b;if(v===6)gd(p,D);else{if(z=p.current.alternate,(D&30)===0&&!BY(z)&&(v=g3(p,D),v===2&&(ee=Pn(p),ee!==0&&(D=ee,v=SC(p,ee))),v===1))throw b=Iy,Zp(p,0),gd(p,D),Na(p,Oe()),b;switch(p.finishedWork=z,p.finishedLanes=D,v){case 0:case 1:throw Error(t(345));case 2:em(p,Oa,nf);break;case 3:if(gd(p,D),(D&130023424)===D&&(v=xC+500-Oe(),10<v)){if(kn(p,0)!==0)break;if(z=p.suspendedLanes,(z&D)!==D){da(),p.pingedLanes|=p.suspendedLanes&z;break}p.timeoutHandle=iy(em.bind(null,p,Oa,nf),v);break}em(p,Oa,nf);break;case 4:if(gd(p,D),(D&4194240)===D)break;for(v=p.eventTimes,z=-1;0<D;){var fe=31-yn(D);ee=1<<fe,fe=v[fe],fe>z&&(z=fe),D&=~ee}if(D=z,D=Oe()-D,D=(120>D?120:480>D?480:1080>D?1080:1920>D?1920:3e3>D?3e3:4320>D?4320:1960*LY(D/1960))-D,10<D){p.timeoutHandle=iy(em.bind(null,p,Oa,nf),D);break}em(p,Oa,nf);break;case 5:em(p,Oa,nf);break;default:throw Error(t(329))}}}return Na(p,Oe()),p.callbackNode===b?BP.bind(null,p):null}function SC(p,v){var b=My;return p.current.memoizedState.isDehydrated&&(Zp(p,v).flags|=256),p=g3(p,v),p!==2&&(v=Oa,Oa=b,v!==null&&wC(v)),p}function wC(p){Oa===null?Oa=p:Oa.push.apply(Oa,p)}function BY(p){for(var v=p;;){if(v.flags&16384){var b=v.updateQueue;if(b!==null&&(b=b.stores,b!==null))for(var D=0;D<b.length;D++){var z=b[D],ee=z.getSnapshot;z=z.value;try{if(!sa(ee(),z))return!1}catch{return!1}}}if(b=v.child,v.subtreeFlags&16384&&b!==null)b.return=v,v=b;else{if(v===p)break;for(;v.sibling===null;){if(v.return===null||v.return===p)return!0;v=v.return}v.sibling.return=v.return,v=v.sibling}}return!0}function gd(p,v){for(v&=~vC,v&=~u3,p.suspendedLanes|=v,p.pingedLanes&=~v,p=p.expirationTimes;0<v;){var b=31-yn(v),D=1<<b;p[b]=-1,v&=~D}}function DP(p){if((_i&6)!==0)throw Error(t(327));ug();var v=kn(p,0);if((v&1)===0)return Na(p,Oe()),null;var b=g3(p,v);if(p.tag!==0&&b===2){var D=Pn(p);D!==0&&(v=D,b=SC(p,D))}if(b===1)throw b=Iy,Zp(p,0),gd(p,v),Na(p,Oe()),b;if(b===6)throw Error(t(345));return p.finishedWork=p.current.alternate,p.finishedLanes=v,em(p,Oa,nf),Na(p,Oe()),null}function CC(p,v){var b=_i;_i|=1;try{return p(v)}finally{_i=b,_i===0&&(cg=Oe()+500,kp&&jl())}}function Jp(p){pd!==null&&pd.tag===0&&(_i&6)===0&&ug();var v=_i;_i|=1;var b=$l.transition,D=ri;try{if($l.transition=null,ri=1,p)return p()}finally{ri=D,$l.transition=b,_i=v,(_i&6)===0&&jl()}}function TC(){Al=lg.current,$i(lg)}function Zp(p,v){p.finishedWork=null,p.finishedLanes=0;var b=p.timeoutHandle;if(b!==-1&&(p.timeoutHandle=-1,ry(b)),Ps!==null)for(b=Ps.return;b!==null;){var D=b;switch(Gc(D),D.tag){case 1:D=D.type.childContextTypes,D!=null&&Bp();break;case 3:Xu(),$i(Co),$i(Hs),Kl();break;case 5:cd(D);break;case 4:Xu();break;case 13:$i(rr);break;case 19:$i(rr);break;case 10:zp(D.type._context);break;case 22:case 23:TC()}b=b.return}if(po=p,Ps=p=Ad(p.current,null),Ro=Al=v,Ks=0,Iy=null,vC=u3=qp=0,Oa=My=null,Qc!==null){for(v=0;v<Qc.length;v++)if(b=Qc[v],D=b.interleaved,D!==null){b.interleaved=null;var z=D.next,ee=b.pending;if(ee!==null){var fe=ee.next;ee.next=z,D.next=fe}b.pending=D}Qc=null}return p}function kP(p,v){do{var b=Ps;try{if(Yh(),Jh.current=sg,ml){for(var D=Xi.memoizedState;D!==null;){var z=D.queue;z!==null&&(z.pending=null),D=D.next}ml=!1}if(jc=0,yi=Lr=Xi=null,fo=!1,qu=0,yC.current=null,b===null||b.return===null){Ks=1,Iy=v,Ps=null;break}e:{var ee=p,fe=b.return,Te=b,Ne=v;if(v=Ro,Te.flags|=32768,Ne!==null&&typeof Ne=="object"&&typeof Ne.then=="function"){var rt=Ne,Ct=Te,Tt=Ct.tag;if((Ct.mode&1)===0&&(Tt===0||Tt===11||Tt===15)){var wt=Ct.alternate;wt?(Ct.updateQueue=wt.updateQueue,Ct.memoizedState=wt.memoizedState,Ct.lanes=wt.lanes):(Ct.updateQueue=null,Ct.memoizedState=null)}var Yt=Jt(fe);if(Yt!==null){Yt.flags&=-257,Hn(Yt,fe,Te,ee,v),Yt.mode&1&&Rt(ee,rt,v),v=Yt,Ne=rt;var tn=v.updateQueue;if(tn===null){var nn=new Set;nn.add(Ne),v.updateQueue=nn}else tn.add(Ne);break e}else{if((v&1)===0){Rt(ee,rt,v),bC();break e}Ne=Error(t(426))}}else if(ir&&Te.mode&1){var fs=Jt(fe);if(fs!==null){(fs.flags&65536)===0&&(fs.flags|=256),Hn(fs,fe,Te,ee,v),od(O(Ne,Te));break e}}ee=Ne=O(Ne,Te),Ks!==4&&(Ks=2),My===null?My=[ee]:My.push(ee),ee=fe;do{switch(ee.tag){case 3:ee.flags|=65536,v&=-v,ee.lanes|=v;var $e=Ge(ee,Ne,v);$h(ee,$e);break e;case 1:Te=Ne;var ze=ee.type,Ze=ee.stateNode;if((ee.flags&128)===0&&(typeof ze.getDerivedStateFromError=="function"||Ze!==null&&typeof Ze.componentDidCatch=="function"&&(dd===null||!dd.has(Ze)))){ee.flags|=65536,v&=-v,ee.lanes|=v;var Pt=ht(ee,Te,v);$h(ee,Pt);break e}}ee=ee.return}while(ee!==null)}NP(b)}catch(cn){v=cn,Ps===b&&b!==null&&(Ps=b=b.return);continue}break}while(!0)}function FP(){var p=c3.current;return c3.current=sg,p===null?sg:p}function bC(){(Ks===0||Ks===3||Ks===2)&&(Ks=4),po===null||(qp&268435455)===0&&(u3&268435455)===0||gd(po,Ro)}function g3(p,v){var b=_i;_i|=2;var D=FP();(po!==p||Ro!==v)&&(nf=null,Zp(p,v));do try{DY();break}catch(z){kP(p,z)}while(!0);if(Yh(),_i=b,c3.current=D,Ps!==null)throw Error(t(261));return po=null,Ro=0,Ks}function DY(){for(;Ps!==null;)OP(Ps)}function kY(){for(;Ps!==null&&!st();)OP(Ps)}function OP(p){var v=GP(p.alternate,p,Al);p.memoizedProps=p.pendingProps,v===null?NP(p):Ps=v,yC.current=null}function NP(p){var v=p;do{var b=v.alternate;if(p=v.return,(v.flags&32768)===0){if(b=bY(b,v,Al),b!==null){Ps=b;return}}else{if(b=IY(b,v),b!==null){b.flags&=32767,Ps=b;return}if(p!==null)p.flags|=32768,p.subtreeFlags=0,p.deletions=null;else{Ks=6,Ps=null;return}}if(v=v.sibling,v!==null){Ps=v;return}Ps=v=p}while(v!==null);Ks===0&&(Ks=5)}function em(p,v,b){var D=ri,z=$l.transition;try{$l.transition=null,ri=1,FY(p,v,b,D)}finally{$l.transition=z,ri=D}return null}function FY(p,v,b,D){do ug();while(pd!==null);if((_i&6)!==0)throw Error(t(327));b=p.finishedWork;var z=p.finishedLanes;if(b===null)return null;if(p.finishedWork=null,p.finishedLanes=0,b===p.current)throw Error(t(177));p.callbackNode=null,p.callbackPriority=0;var ee=b.lanes|b.childLanes;if(ta(p,ee),p===po&&(Ps=po=null,Ro=0),(b.subtreeFlags&2064)===0&&(b.flags&2064)===0||f3||(f3=!0,HP(Qt,function(){return ug(),null})),ee=(b.flags&15990)!==0,(b.subtreeFlags&15990)!==0||ee){ee=$l.transition,$l.transition=null;var fe=ri;ri=1;var Te=_i;_i|=4,yC.current=null,RY(p,b),IP(b,p),bs(ty),Ss=!!id,ty=id=null,p.current=b,PY(b),lt(),_i=Te,ri=fe,$l.transition=ee}else p.current=b;if(f3&&(f3=!1,pd=p,d3=z),ee=p.pendingLanes,ee===0&&(dd=null),Bt(b.stateNode),Na(p,Oe()),v!==null)for(D=p.onRecoverableError,b=0;b<v.length;b++)z=v[b],D(z.value,{componentStack:z.stack,digest:z.digest});if(h3)throw h3=!1,p=EC,EC=null,p;return(d3&1)!==0&&p.tag!==0&&ug(),ee=p.pendingLanes,(ee&1)!==0?p===_C?Ry++:(Ry=0,_C=p):Ry=0,jl(),null}function ug(){if(pd!==null){var p=Ul(d3),v=$l.transition,b=ri;try{if($l.transition=null,ri=16>p?16:p,pd===null)var D=!1;else{if(p=pd,pd=null,d3=0,(_i&6)!==0)throw Error(t(331));var z=_i;for(_i|=4,Zt=p.current;Zt!==null;){var ee=Zt,fe=ee.child;if((Zt.flags&16)!==0){var Te=ee.deletions;if(Te!==null){for(var Ne=0;Ne<Te.length;Ne++){var rt=Te[Ne];for(Zt=rt;Zt!==null;){var Ct=Zt;switch(Ct.tag){case 0:case 11:case 15:by(8,Ct,ee)}var Tt=Ct.child;if(Tt!==null)Tt.return=Ct,Zt=Tt;else for(;Zt!==null;){Ct=Zt;var wt=Ct.sibling,Yt=Ct.return;if(SP(Ct),Ct===rt){Zt=null;break}if(wt!==null){wt.return=Yt,Zt=wt;break}Zt=Yt}}}var tn=ee.alternate;if(tn!==null){var nn=tn.child;if(nn!==null){tn.child=null;do{var fs=nn.sibling;nn.sibling=null,nn=fs}while(nn!==null)}}Zt=ee}}if((ee.subtreeFlags&2064)!==0&&fe!==null)fe.return=ee,Zt=fe;else e:for(;Zt!==null;){if(ee=Zt,(ee.flags&2048)!==0)switch(ee.tag){case 0:case 11:case 15:by(9,ee,ee.return)}var $e=ee.sibling;if($e!==null){$e.return=ee.return,Zt=$e;break e}Zt=ee.return}}var ze=p.current;for(Zt=ze;Zt!==null;){fe=Zt;var Ze=fe.child;if((fe.subtreeFlags&2064)!==0&&Ze!==null)Ze.return=fe,Zt=Ze;else e:for(fe=ze;Zt!==null;){if(Te=Zt,(Te.flags&2048)!==0)try{switch(Te.tag){case 0:case 11:case 15:l3(9,Te)}}catch(cn){Jr(Te,Te.return,cn)}if(Te===fe){Zt=null;break e}var Pt=Te.sibling;if(Pt!==null){Pt.return=Te.return,Zt=Pt;break e}Zt=Te.return}}if(_i=z,jl(),Dt&&typeof Dt.onPostCommitFiberRoot=="function")try{Dt.onPostCommitFiberRoot(vn,p)}catch{}D=!0}return D}finally{ri=b,$l.transition=v}}return!1}function UP(p,v,b){v=O(b,v),v=Ge(p,v,1),p=dr(p,v,1),v=da(),p!==null&&(nr(p,1,v),Na(p,v))}function Jr(p,v,b){if(p.tag===3)UP(p,p,b);else for(;v!==null;){if(v.tag===3){UP(v,p,b);break}else if(v.tag===1){var D=v.stateNode;if(typeof v.type.getDerivedStateFromError=="function"||typeof D.componentDidCatch=="function"&&(dd===null||!dd.has(D))){p=O(b,p),p=ht(v,p,1),v=dr(v,p,1),p=da(),v!==null&&(nr(v,1,p),Na(v,p));break}}v=v.return}}function OY(p,v,b){var D=p.pingCache;D!==null&&D.delete(v),v=da(),p.pingedLanes|=p.suspendedLanes&b,po===p&&(Ro&b)===b&&(Ks===4||Ks===3&&(Ro&130023424)===Ro&&500>Oe()-xC?Zp(p,0):vC|=b),Na(p,v)}function zP(p,v){v===0&&((p.mode&1)===0?v=1:(v=Ei,Ei<<=1,(Ei&130023424)===0&&(Ei=4194304)));var b=da();p=dl(p,v),p!==null&&(nr(p,v,b),Na(p,b))}function NY(p){var v=p.memoizedState,b=0;v!==null&&(b=v.retryLane),zP(p,b)}function UY(p,v){var b=0;switch(p.tag){case 13:var D=p.stateNode,z=p.memoizedState;z!==null&&(b=z.retryLane);break;case 19:D=p.stateNode;break;default:throw Error(t(314))}D!==null&&D.delete(v),zP(p,b)}var GP;GP=function(p,v,b){if(p!==null)if(p.memoizedProps!==v.pendingProps||Co.current)Zn=!0;else{if((p.lanes&b)===0&&(v.flags&128)===0)return Zn=!1,TY(p,v,b);Zn=(p.flags&131072)!==0}else Zn=!1,ir&&(v.flags&1048576)!==0&&cy(v,$0,v.index);switch(v.lanes=0,v.tag){case 2:var D=v.type;o3(p,v),p=v.pendingProps;var z=Gh(v,Hs.current);$u(v,b),z=jp(null,v,D,p,z,b);var ee=Ay();return v.flags|=1,typeof z=="object"&&z!==null&&typeof z.render=="function"&&z.$$typeof===void 0?(v.tag=1,v.memoizedState=null,v.updateQueue=null,uo(D)?(ee=!0,Hh(v)):ee=!1,v.memoizedState=z.state!==null&&z.state!==void 0?z.state:null,Jn(v),z.updater=og,v.stateNode=z,z._reactInternals=v,B(v,D,p,b),v=Kn(null,v,D,!0,ee,b)):(v.tag=0,ir&&ee&&uy(v),Wt(null,v,z,b),v=v.child),v;case 16:D=v.elementType;e:{switch(o3(p,v),p=v.pendingProps,z=D._init,D=z(D._payload),v.type=D,z=v.tag=GY(D),p=Fa(D,p),z){case 0:v=Vt(null,v,D,p,b);break e;case 1:v=on(null,v,D,p,b);break e;case 11:v=Ws(null,v,D,p,b);break e;case 14:v=fa(null,v,D,Fa(D.type,p),b);break e}throw Error(t(306,D,""))}return v;case 0:return D=v.type,z=v.pendingProps,z=v.elementType===D?z:Fa(D,z),Vt(p,v,D,z,b);case 1:return D=v.type,z=v.pendingProps,z=v.elementType===D?z:Fa(D,z),on(p,v,D,z,b);case 3:e:{if(Qn(v),p===null)throw Error(t(387));D=v.pendingProps,ee=v.memoizedState,z=ee.element,Gr(p,v),Pr(v,D,null,b);var fe=v.memoizedState;if(D=fe.element,ee.isDehydrated)if(ee={element:D,isDehydrated:!1,cache:fe.cache,pendingSuspenseBoundaries:fe.pendingSuspenseBoundaries,transitions:fe.transitions},v.updateQueue.baseState=ee,v.memoizedState=ee,v.flags&256){z=O(Error(t(423)),v),v=pi(p,v,D,b,z);break e}else if(D!==z){z=O(Error(t(424)),v),v=pi(p,v,D,b,z);break e}else for(bo=Fc(v.stateNode.containerInfo.firstChild),Qs=v,ir=!0,ka=null,b=Up(v,null,D,b),v.child=b;b;)b.flags=b.flags&-3|4096,b=b.sibling;else{if(Yu(),D===z){v=tf(p,v,b);break e}Wt(p,v,D,b)}v=v.child}return v;case 5:return qh(v),p===null&&q0(v),D=v.type,z=v.pendingProps,ee=p!==null?p.memoizedProps:null,fe=z.children,ny(D,z)?fe=null:ee!==null&&ny(D,ee)&&(v.flags|=32),at(p,v),Wt(p,v,fe,b),v.child;case 6:return p===null&&q0(v),null;case 13:return Yc(p,v,b);case 4:return Qp(v,v.stateNode.containerInfo),D=v.pendingProps,p===null?v.child=jh(v,null,D,b):Wt(p,v,D,b),v.child;case 11:return D=v.type,z=v.pendingProps,z=v.elementType===D?z:Fa(D,z),Ws(p,v,D,z,b);case 7:return Wt(p,v,v.pendingProps,b),v.child;case 8:return Wt(p,v,v.pendingProps.children,b),v.child;case 12:return Wt(p,v,v.pendingProps.children,b),v.child;case 10:e:{if(D=v.type._context,z=v.pendingProps,ee=v.memoizedProps,fe=z.value,Gi(Wh,D._currentValue),D._currentValue=fe,ee!==null)if(sa(ee.value,fe)){if(ee.children===z.children&&!Co.current){v=tf(p,v,b);break e}}else for(ee=v.child,ee!==null&&(ee.return=v);ee!==null;){var Te=ee.dependencies;if(Te!==null){fe=ee.child;for(var Ne=Te.firstContext;Ne!==null;){if(Ne.context===D){if(ee.tag===1){Ne=ki(-1,b&-b),Ne.tag=2;var rt=ee.updateQueue;if(rt!==null){rt=rt.shared;var Ct=rt.pending;Ct===null?Ne.next=Ne:(Ne.next=Ct.next,Ct.next=Ne),rt.pending=Ne}}ee.lanes|=b,Ne=ee.alternate,Ne!==null&&(Ne.lanes|=b),Gp(ee.return,b,v),Te.lanes|=b;break}Ne=Ne.next}}else if(ee.tag===10)fe=ee.type===v.type?null:ee.child;else if(ee.tag===18){if(fe=ee.return,fe===null)throw Error(t(341));fe.lanes|=b,Te=fe.alternate,Te!==null&&(Te.lanes|=b),Gp(fe,b,v),fe=ee.sibling}else fe=ee.child;if(fe!==null)fe.return=ee;else for(fe=ee;fe!==null;){if(fe===v){fe=null;break}if(ee=fe.sibling,ee!==null){ee.return=fe.return,fe=ee;break}fe=fe.return}ee=fe}Wt(p,v,z.children,b),v=v.child}return v;case 9:return z=v.type,D=v.pendingProps.children,$u(v,b),z=la(z),D=D(z),v.flags|=1,Wt(p,v,D,b),v.child;case 14:return D=v.type,z=Fa(D,v.pendingProps),z=Fa(D.type,z),fa(p,v,D,z,b);case 15:return et(p,v,v.type,v.pendingProps,b);case 17:return D=v.type,z=v.pendingProps,z=v.elementType===D?z:Fa(D,z),o3(p,v),v.tag=1,uo(D)?(p=!0,Hh(v)):p=!1,$u(v,b),_(v,D,z),B(v,D,z,b),Kn(null,v,D,!0,p,b);case 19:return yP(p,v,b);case 22:return Qe(p,v,b)}throw Error(t(156,v.tag))};function HP(p,v){return Ie(p,v)}function zY(p,v,b,D){this.tag=p,this.key=b,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=v,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=D,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Xl(p,v,b,D){return new zY(p,v,b,D)}function IC(p){return p=p.prototype,!(!p||!p.isReactComponent)}function GY(p){if(typeof p=="function")return IC(p)?1:0;if(p!=null){if(p=p.$$typeof,p===k)return 11;if(p===X)return 14}return 2}function Ad(p,v){var b=p.alternate;return b===null?(b=Xl(p.tag,v,p.key,p.mode),b.elementType=p.elementType,b.type=p.type,b.stateNode=p.stateNode,b.alternate=p,p.alternate=b):(b.pendingProps=v,b.type=p.type,b.flags=0,b.subtreeFlags=0,b.deletions=null),b.flags=p.flags&14680064,b.childLanes=p.childLanes,b.lanes=p.lanes,b.child=p.child,b.memoizedProps=p.memoizedProps,b.memoizedState=p.memoizedState,b.updateQueue=p.updateQueue,v=p.dependencies,b.dependencies=v===null?null:{lanes:v.lanes,firstContext:v.firstContext},b.sibling=p.sibling,b.index=p.index,b.ref=p.ref,b}function A3(p,v,b,D,z,ee){var fe=2;if(D=p,typeof p=="function")IC(p)&&(fe=1);else if(typeof p=="string")fe=5;else e:switch(p){case M:return tm(b.children,z,ee,v);case L:fe=8,z|=8;break;case P:return p=Xl(12,b,v,z|2),p.elementType=P,p.lanes=ee,p;case H:return p=Xl(13,b,v,z),p.elementType=H,p.lanes=ee,p;case G:return p=Xl(19,b,v,z),p.elementType=G,p.lanes=ee,p;case oe:return y3(b,z,ee,v);default:if(typeof p=="object"&&p!==null)switch(p.$$typeof){case R:fe=10;break e;case U:fe=9;break e;case k:fe=11;break e;case X:fe=14;break e;case Z:fe=16,D=null;break e}throw Error(t(130,p==null?p:typeof p,""))}return v=Xl(fe,b,v,z),v.elementType=p,v.type=D,v.lanes=ee,v}function tm(p,v,b,D){return p=Xl(7,p,D,v),p.lanes=b,p}function y3(p,v,b,D){return p=Xl(22,p,D,v),p.elementType=oe,p.lanes=b,p.stateNode={isHidden:!1},p}function MC(p,v,b){return p=Xl(6,p,null,v),p.lanes=b,p}function RC(p,v,b){return v=Xl(4,p.children!==null?p.children:[],p.key,v),v.lanes=b,v.stateNode={containerInfo:p.containerInfo,pendingChildren:null,implementation:p.implementation},v}function HY(p,v,b,D,z){this.tag=v,this.containerInfo=p,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=ls(0),this.expirationTimes=ls(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=ls(0),this.identifierPrefix=D,this.onRecoverableError=z,this.mutableSourceEagerHydrationData=null}function PC(p,v,b,D,z,ee,fe,Te,Ne){return p=new HY(p,v,b,Te,Ne),v===1?(v=1,ee===!0&&(v|=8)):v=0,ee=Xl(3,null,null,v),p.current=ee,ee.stateNode=p,ee.memoizedState={element:D,isDehydrated:b,cache:null,transitions:null,pendingSuspenseBoundaries:null},Jn(ee),p}function QY(p,v,b){var D=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:I,key:D==null?null:""+D,children:p,containerInfo:v,implementation:b}}function QP(p){if(!p)return Nc;p=p._reactInternals;e:{if(me(p)!==p||p.tag!==1)throw Error(t(170));var v=p;do{switch(v.tag){case 3:v=v.stateNode.context;break e;case 1:if(uo(v.type)){v=v.stateNode.__reactInternalMemoizedMergedChildContext;break e}}v=v.return}while(v!==null);throw Error(t(171))}if(p.tag===1){var b=p.type;if(uo(b))return Dp(p,b,v)}return v}function VP(p,v,b,D,z,ee,fe,Te,Ne){return p=PC(b,D,!0,p,z,ee,fe,Te,Ne),p.context=QP(null),b=p.current,D=da(),z=md(b),ee=ki(D,z),ee.callback=v??null,dr(b,ee,z),p.current.lanes=z,nr(p,z,D),Na(p,D),p}function v3(p,v,b,D){var z=v.current,ee=da(),fe=md(z);return b=QP(b),v.context===null?v.context=b:v.pendingContext=b,v=ki(ee,fe),v.payload={element:p},D=D===void 0?null:D,D!==null&&(v.callback=D),p=dr(z,v,fe),p!==null&&(qc(p,z,fe,ee),ho(p,z,fe)),fe}function x3(p){if(p=p.current,!p.child)return null;switch(p.child.tag){case 5:return p.child.stateNode;default:return p.child.stateNode}}function jP(p,v){if(p=p.memoizedState,p!==null&&p.dehydrated!==null){var b=p.retryLane;p.retryLane=b!==0&&b<v?b:v}}function LC(p,v){jP(p,v),(p=p.alternate)&&jP(p,v)}function VY(){return null}var WP=typeof reportError=="function"?reportError:function(p){console.error(p)};function BC(p){this._internalRoot=p}E3.prototype.render=BC.prototype.render=function(p){var v=this._internalRoot;if(v===null)throw Error(t(409));v3(p,v,null,null)},E3.prototype.unmount=BC.prototype.unmount=function(){var p=this._internalRoot;if(p!==null){this._internalRoot=null;var v=p.containerInfo;Jp(function(){v3(null,p,null,null)}),v[aa]=null}};function E3(p){this._internalRoot=p}E3.prototype.unstable_scheduleHydration=function(p){if(p){var v=zl();p={blockedOn:null,target:p,priority:v};for(var b=0;b<Ma.length&&v!==0&&v<Ma[b].priority;b++);Ma.splice(b,0,p),b===0&&lo(p)}};function DC(p){return!(!p||p.nodeType!==1&&p.nodeType!==9&&p.nodeType!==11)}function _3(p){return!(!p||p.nodeType!==1&&p.nodeType!==9&&p.nodeType!==11&&(p.nodeType!==8||p.nodeValue!==" react-mount-point-unstable "))}function KP(){}function jY(p,v,b,D,z){if(z){if(typeof D=="function"){var ee=D;D=function(){var rt=x3(fe);ee.call(rt)}}var fe=VP(v,D,p,0,null,!1,!1,"",KP);return p._reactRootContainer=fe,p[aa]=fe.current,td(p.nodeType===8?p.parentNode:p),Jp(),fe}for(;z=p.lastChild;)p.removeChild(z);if(typeof D=="function"){var Te=D;D=function(){var rt=x3(Ne);Te.call(rt)}}var Ne=PC(p,0,!1,null,null,!1,!1,"",KP);return p._reactRootContainer=Ne,p[aa]=Ne.current,td(p.nodeType===8?p.parentNode:p),Jp(function(){v3(v,Ne,b,D)}),Ne}function S3(p,v,b,D,z){var ee=b._reactRootContainer;if(ee){var fe=ee;if(typeof z=="function"){var Te=z;z=function(){var Ne=x3(fe);Te.call(Ne)}}v3(v,fe,p,z)}else fe=jY(b,v,p,z,D);return x3(fe)}ku=function(p){switch(p.tag){case 3:var v=p.stateNode;if(v.current.memoizedState.isDehydrated){var b=Dn(v.pendingLanes);b!==0&&(ol(v,b|1),Na(v,Oe()),(_i&6)===0&&(cg=Oe()+500,jl()))}break;case 13:Jp(function(){var D=dl(p,1);if(D!==null){var z=da();qc(D,p,1,z)}}),LC(p,1)}},Qf=function(p){if(p.tag===13){var v=dl(p,134217728);if(v!==null){var b=da();qc(v,p,134217728,b)}LC(p,134217728)}},Vf=function(p){if(p.tag===13){var v=md(p),b=dl(p,v);if(b!==null){var D=da();qc(b,p,v,D)}LC(p,v)}},zl=function(){return ri},Mh=function(p,v){var b=ri;try{return ri=p,v()}finally{ri=b}},Be=function(p,v,b){switch(v){case"input":if(ke(p,b),v=b.name,b.type==="radio"&&v!=null){for(b=p;b.parentNode;)b=b.parentNode;for(b=b.querySelectorAll("input[name="+JSON.stringify(""+v)+'][type="radio"]'),v=0;v<b.length;v++){var D=b[v];if(D!==p&&D.form===p.form){var z=W0(D);if(!z)throw Error(t(90));ue(D),ke(D,z)}}}break;case"textarea":Fe(p,b);break;case"select":v=b.value,v!=null&&de(p,!!b.multiple,v,!1)}},qt=CC,Nt=Jp;var WY={usingClientEntryPoint:!1,Events:[Oc,zr,W0,bt,Lt,CC]},Py={findFiberByHostInstance:Ku,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},KY={bundleType:Py.bundleType,version:Py.version,rendererPackageName:Py.rendererPackageName,rendererConfig:Py.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:w.ReactCurrentDispatcher,findHostInstanceByFiber:function(p){return p=Ee(p),p===null?null:p.stateNode},findFiberByHostInstance:Py.findFiberByHostInstance||VY,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var w3=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!w3.isDisabled&&w3.supportsFiber)try{vn=w3.inject(KY),Dt=w3}catch{}}return Ua.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=WY,Ua.createPortal=function(p,v){var b=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!DC(v))throw Error(t(200));return QY(p,v,null,b)},Ua.createRoot=function(p,v){if(!DC(p))throw Error(t(299));var b=!1,D="",z=WP;return v!=null&&(v.unstable_strictMode===!0&&(b=!0),v.identifierPrefix!==void 0&&(D=v.identifierPrefix),v.onRecoverableError!==void 0&&(z=v.onRecoverableError)),v=PC(p,1,!1,null,null,b,!1,D,z),p[aa]=v.current,td(p.nodeType===8?p.parentNode:p),new BC(v)},Ua.findDOMNode=function(p){if(p==null)return null;if(p.nodeType===1)return p;var v=p._reactInternals;if(v===void 0)throw typeof p.render=="function"?Error(t(188)):(p=Object.keys(p).join(","),Error(t(268,p)));return p=Ee(v),p=p===null?null:p.stateNode,p},Ua.flushSync=function(p){return Jp(p)},Ua.hydrate=function(p,v,b){if(!_3(v))throw Error(t(200));return S3(null,p,v,!0,b)},Ua.hydrateRoot=function(p,v,b){if(!DC(p))throw Error(t(405));var D=b!=null&&b.hydratedSources||null,z=!1,ee="",fe=WP;if(b!=null&&(b.unstable_strictMode===!0&&(z=!0),b.identifierPrefix!==void 0&&(ee=b.identifierPrefix),b.onRecoverableError!==void 0&&(fe=b.onRecoverableError)),v=VP(v,null,p,1,b??null,z,!1,ee,fe),p[aa]=v.current,td(p),D)for(p=0;p<D.length;p++)b=D[p],z=b._getVersion,z=z(b._source),v.mutableSourceEagerHydrationData==null?v.mutableSourceEagerHydrationData=[b,z]:v.mutableSourceEagerHydrationData.push(b,z);return new E3(v)},Ua.render=function(p,v,b){if(!_3(v))throw Error(t(200));return S3(null,p,v,!1,b)},Ua.unmountComponentAtNode=function(p){if(!_3(p))throw Error(t(40));return p._reactRootContainer?(Jp(function(){S3(null,null,p,!1,function(){p._reactRootContainer=null,p[aa]=null})}),!0):!1},Ua.unstable_batchedUpdates=CC,Ua.unstable_renderSubtreeIntoContainer=function(p,v,b,D){if(!_3(b))throw Error(t(200));if(p==null||p._reactInternals===void 0)throw Error(t(38));return S3(p,v,b,!1,D)},Ua.version="18.3.1-next-f1338f8080-20240426",Ua}var tL;function i$(){if(tL)return OC.exports;tL=1;function i(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(i)}catch(e){console.error(e)}}return i(),OC.exports=n$(),OC.exports}var nL;function r$(){if(nL)return C3;nL=1;var i=i$();return C3.createRoot=i.createRoot,C3.hydrateRoot=i.hydrateRoot,C3}var A6=r$();const s$=EA(A6),vS={common:{bg:"bg-gray-100",border:"border-gray-300",text:"text-gray-700"},uncommon:{bg:"bg-green-100",border:"border-green-400",text:"text-green-700"},rare:{bg:"bg-blue-100",border:"border-blue-400",text:"text-blue-700"},epic:{bg:"bg-purple-100",border:"border-purple-400",text:"text-purple-700"},legendary:{bg:"bg-yellow-100",border:"border-yellow-400",text:"text-yellow-700"}},kN={common:"Almennur",uncommon:"Óvenjulegur",rare:"Sjaldgæfur",epic:"Epískur",legendary:"Goðsagnakenndur"};function o$({achievement:i,progress:e,size:t="md",showProgress:n=!0,onClick:r}){const s=(e==null?void 0:e.unlocked)??!1,o=vS[i.rarity],a={sm:"w-12 h-12 text-lg",md:"w-16 h-16 text-2xl",lg:"w-20 h-20 text-3xl"},l={sm:"gap-2",md:"gap-3",lg:"gap-4"};return N.jsxs("div",{className:`flex items-center ${l[t]} ${r?"cursor-pointer hover:scale-105 transition-transform":""}`,onClick:r,role:r?"button":void 0,tabIndex:r?0:void 0,onKeyDown:r?c=>c.key==="Enter"&&r():void 0,children:[N.jsx("div",{className:`
          ${a[t]}
          ${s?o.bg:"bg-gray-200"}
          ${s?o.border:"border-gray-300"}
          border-2 rounded-full flex items-center justify-center
          ${s?"":"grayscale opacity-50"}
          transition-all
        `,children:N.jsx("span",{className:s?"":"opacity-30",children:i.icon})}),N.jsxs("div",{className:"flex-1 min-w-0",children:[N.jsx("div",{className:`font-semibold truncate ${s?o.text:"text-gray-500"}`,children:i.secret&&!s?"???":i.name}),N.jsx("div",{className:"text-xs text-gray-500 truncate",children:i.secret&&!s?"Leynilegt afrek":i.description}),n&&e&&!s&&N.jsxs("div",{className:"mt-1",children:[N.jsx("div",{className:"h-1.5 bg-gray-200 rounded-full overflow-hidden",children:N.jsx("div",{className:`h-full ${o.bg.replace("100","400")} transition-all`,style:{width:`${Math.min(100,e.currentValue/e.targetValue*100)}%`}})}),N.jsxs("div",{className:"text-xs text-gray-400 mt-0.5",children:[e.currentValue," / ",e.targetValue]})]}),s&&N.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[N.jsxs("span",{className:`text-xs ${o.text}`,children:["+",i.points," stig"]}),N.jsx("span",{className:`text-xs px-1.5 py-0.5 rounded ${o.bg} ${o.text}`,children:kN[i.rarity]})]})]})]})}function a$({notification:i,onDismiss:e,autoDismissMs:t=5e3}){const[n,r]=C.useState(!1),[s,o]=C.useState(!1),{achievement:a}=i,l=vS[a.rarity];C.useEffect(()=>{const u=setTimeout(()=>r(!0),50),h=setTimeout(()=>{o(!0),setTimeout(e,300)},t);return()=>{clearTimeout(u),clearTimeout(h)}},[t,e]);const c=()=>{o(!0),setTimeout(e,300)};return N.jsx("div",{className:`
        fixed top-4 right-4 z-50
        transform transition-all duration-300 ease-out
        ${n&&!s?"translate-x-0 opacity-100":"translate-x-full opacity-0"}
      `,children:N.jsxs("div",{className:`
          ${l.bg} ${l.border}
          border-2 rounded-xl shadow-2xl p-4 max-w-sm
          backdrop-blur-sm
        `,children:[N.jsxs("div",{className:"flex items-center justify-between mb-3",children:[N.jsxs("div",{className:"flex items-center gap-2",children:[N.jsx("span",{className:"text-lg",children:"🎉"}),N.jsx("span",{className:`font-bold ${l.text}`,children:"Afrek opnað!"})]}),N.jsx("button",{onClick:c,className:"text-gray-400 hover:text-gray-600 transition-colors","aria-label":"Loka",children:"×"})]}),N.jsxs("div",{className:"flex items-center gap-4",children:[N.jsx("div",{className:`
              w-16 h-16 ${l.bg} ${l.border}
              border-2 rounded-full flex items-center justify-center text-3xl
              animate-bounce
            `,children:a.icon}),N.jsxs("div",{className:"flex-1",children:[N.jsx("div",{className:`font-bold text-lg ${l.text}`,children:a.name}),N.jsx("div",{className:"text-sm text-gray-600",children:a.description}),N.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[N.jsxs("span",{className:`text-sm font-semibold ${l.text}`,children:["+",a.points," stig"]}),N.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${l.bg} ${l.text} border ${l.border}`,children:kN[a.rarity]})]})]})]}),N.jsx("div",{className:"mt-3 h-1 bg-gray-200 rounded-full overflow-hidden",children:N.jsx("div",{className:"h-full bg-gradient-to-r from-yellow-400 to-yellow-500 transition-all duration-1000",style:{width:"100%"}})})]})})}function T3({notifications:i,onDismiss:e}){const t=i[0];return t?N.jsx(a$,{notification:t,onDismiss:()=>e(t.achievement.id)},t.achievement.id):null}const FN="kvenno-chemistry-achievements",nx=[{id:"perfect-level-1",name:"Fullkominn byrjandi",description:"Fáðu 100% á stigi 1",icon:"🌟",category:"performance",rarity:"uncommon",criteria:{type:"perfect_score",target:100,level:1},points:10},{id:"perfect-level-2",name:"Fullkominn framhaldsnemi",description:"Fáðu 100% á stigi 2",icon:"⭐",category:"performance",rarity:"rare",criteria:{type:"perfect_score",target:100,level:2},points:20},{id:"perfect-level-3",name:"Fullkominn meistari",description:"Fáðu 100% á stigi 3",icon:"🏆",category:"performance",rarity:"epic",criteria:{type:"perfect_score",target:100,level:3},points:30},{id:"high-scorer",name:"Hámarks stigamaður",description:"Náðu 90+ stigum í einu stigi",icon:"📈",category:"performance",rarity:"uncommon",criteria:{type:"high_score",target:90},points:15},{id:"streak-3",name:"Þrefalt rétt",description:"3 rétt svör í röð",icon:"🔥",category:"streak",rarity:"common",criteria:{type:"streak",target:3},points:5},{id:"streak-5",name:"Fimmfalt rétt",description:"5 rétt svör í röð",icon:"🔥",category:"streak",rarity:"uncommon",criteria:{type:"streak",target:5},points:10},{id:"streak-10",name:"Óstöðvandi",description:"10 rétt svör í röð",icon:"💥",category:"streak",rarity:"rare",criteria:{type:"streak",target:10},points:25},{id:"streak-20",name:"Eldfjall",description:"20 rétt svör í röð",icon:"🌋",category:"streak",rarity:"epic",criteria:{type:"streak",target:20},points:50},{id:"speed-demon",name:"Hraðfari",description:"Ljúktu stigi á undir 60 sekúndum",icon:"⚡",category:"speed",rarity:"rare",criteria:{type:"speed",target:60},points:20},{id:"lightning",name:"Eldingur",description:"Ljúktu stigi á undir 30 sekúndum",icon:"⚡",category:"speed",rarity:"epic",criteria:{type:"speed",target:30},points:40},{id:"first-level-complete",name:"Fyrsta stig lokið",description:"Ljúktu stigi 1 í einhverjum leik",icon:"✅",category:"mastery",rarity:"common",criteria:{type:"level_complete",target:1,level:1},points:5},{id:"game-complete",name:"Leik lokið",description:"Ljúktu öllum stigum í einum leik",icon:"🎮",category:"mastery",rarity:"uncommon",criteria:{type:"game_complete",target:1},points:15},{id:"five-games",name:"Fimm leikir",description:"Ljúktu 5 leikjum",icon:"🎯",category:"mastery",rarity:"rare",criteria:{type:"total_games",target:5},points:30},{id:"all-games",name:"Allar leikvangur",description:"Ljúktu öllum 18 leikjum",icon:"👑",category:"mastery",rarity:"legendary",criteria:{type:"total_games",target:18},points:100},{id:"problem-solver-10",name:"Vandamálaleysir",description:"Leystu 10 verkefni",icon:"🧩",category:"dedication",rarity:"common",criteria:{type:"total_problems",target:10},points:5},{id:"problem-solver-50",name:"Duglegur nemandi",description:"Leystu 50 verkefni",icon:"📚",category:"dedication",rarity:"uncommon",criteria:{type:"total_problems",target:50},points:15},{id:"problem-solver-100",name:"Ákafur iðjumaður",description:"Leystu 100 verkefni",icon:"🏅",category:"dedication",rarity:"rare",criteria:{type:"total_problems",target:100},points:30},{id:"problem-solver-500",name:"Efnafræðingur",description:"Leystu 500 verkefni",icon:"🔬",category:"dedication",rarity:"epic",criteria:{type:"total_problems",target:500},points:75},{id:"daily-player-3",name:"Stöðugur nemandi",description:"Spilaðu 3 daga",icon:"📅",category:"dedication",rarity:"uncommon",criteria:{type:"daily_play",target:3},points:10},{id:"daily-player-7",name:"Vikuflakkari",description:"Spilaðu 7 daga",icon:"📆",category:"dedication",rarity:"rare",criteria:{type:"daily_play",target:7},points:25},{id:"first-try-master",name:"Rétt í fyrstu",description:"Svaraðu 5 spurningum rétt í fyrstu tilraun",icon:"🎯",category:"special",rarity:"rare",criteria:{type:"first_try",target:5},points:20},{id:"no-hints",name:"Án hjálpar",description:"Ljúktu stigi án þess að nota vísbendingar",icon:"💪",category:"special",rarity:"uncommon",criteria:{type:"no_hints",target:1},points:15},{id:"comeback-king",name:"Aftur á sporin",description:"Batnaðu úr 50% eða lægra í 80%+ í sama stigi",icon:"🦅",category:"special",rarity:"rare",criteria:{type:"high_score",target:80},points:25,secret:!0}];function eM(){return{unlocked:[],progress:{},totalPoints:0,currentStreak:0,bestStreak:0,daysPlayed:[],totalProblemsSolved:0,totalGamesCompleted:0,lastUpdated:new Date().toISOString()}}function b3(){try{const i=localStorage.getItem(FN);if(i){const e=JSON.parse(i);if(e&&typeof e=="object"&&Array.isArray(e.unlocked))return{...eM(),...e}}}catch(i){console.error("Failed to load achievements:",i)}return eM()}function y6(i){try{i.lastUpdated=new Date().toISOString(),localStorage.setItem(FN,JSON.stringify(i))}catch(e){console.error("Failed to save achievements:",e)}}function l$(i,e){return i.unlocked.includes(e)}function ON(i,e){const t=i.progress[e.id];return t||{achievementId:e.id,currentValue:0,targetValue:e.criteria.target,unlocked:l$(i,e.id)}}function iL(i,e){var s;const t=[],n={...i},r=new Date().toISOString().split("T")[0];switch(n.daysPlayed.includes(r)||(n.daysPlayed=[...n.daysPlayed,r]),e.type){case"answer_correct":n.currentStreak+=1,n.bestStreak=Math.max(n.bestStreak,n.currentStreak),n.totalProblemsSolved+=1;break;case"answer_incorrect":n.currentStreak=0;break;case"level_complete":break;case"game_complete":n.totalGamesCompleted+=1;break}for(const o of nx){if(n.unlocked.includes(o.id))continue;let a=!1,l=0;switch(o.criteria.type){case"streak":l=n.currentStreak,a=n.currentStreak>=o.criteria.target;break;case"perfect_score":e.type==="level_complete"&&e.score!==void 0&&e.maxScore&&e.score/e.maxScore*100>=100&&(!o.criteria.level||o.criteria.level===e.level)&&(a=!0,l=100);break;case"high_score":e.type==="level_complete"&&e.score!==void 0&&(l=e.score,a=e.score>=o.criteria.target);break;case"speed":e.type==="level_complete"&&e.timeTaken!==void 0&&(l=e.timeTaken,a=e.timeTaken<=o.criteria.target);break;case"level_complete":e.type==="level_complete"&&(l=1,a=!o.criteria.level||o.criteria.level===e.level);break;case"game_complete":l=n.totalGamesCompleted,a=n.totalGamesCompleted>=o.criteria.target;break;case"total_problems":l=n.totalProblemsSolved,a=n.totalProblemsSolved>=o.criteria.target;break;case"total_games":l=n.totalGamesCompleted,a=n.totalGamesCompleted>=o.criteria.target;break;case"daily_play":l=n.daysPlayed.length,a=n.daysPlayed.length>=o.criteria.target;break;case"no_hints":e.type==="level_complete"&&e.hintsUsed===0&&(a=!0,l=1);break;case"first_try":if(e.type==="answer_correct"&&e.firstAttempt){const c=(((s=n.progress[o.id])==null?void 0:s.currentValue)||0)+1;l=c,a=c>=o.criteria.target}break}n.progress[o.id]={achievementId:o.id,currentValue:l,targetValue:o.criteria.target,unlocked:a,unlockedAt:a?new Date().toISOString():void 0},a&&(n.unlocked.push(o.id),n.totalPoints+=o.points,t.push({achievement:o,unlockedAt:new Date().toISOString(),isNew:!0}))}return y6(n),t}function c$(i){return Math.round(i.unlocked.length/nx.length*100)}function u$(i){return nx.filter(e=>i.unlocked.includes(e.id))}function h$(i){return nx.filter(e=>!i.unlocked.includes(e.id)&&!e.secret)}function f$(){y6(eM())}const zC={performance:{label:"Frammistaða",icon:"⭐"},streak:{label:"Röð",icon:"🔥"},speed:{label:"Hraði",icon:"⚡"},mastery:{label:"Leikni",icon:"🎮"},dedication:{label:"Hollusta",icon:"📚"},special:{label:"Sérstök",icon:"🎯"}};function d$({achievements:i,allAchievements:e,onClose:t,onReset:n}){const[r,s]=C.useState("all"),o=r==="all"?e:e.filter(u=>u.category===r),a=i.unlocked.length,l=e.filter(u=>!u.secret||i.unlocked.includes(u.id)).length,c=Math.round(a/e.length*100);return N.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50",children:N.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[N.jsxs("div",{className:"bg-gradient-to-r from-yellow-400 to-orange-500 p-6 text-white",children:[N.jsxs("div",{className:"flex items-center justify-between",children:[N.jsxs("div",{children:[N.jsx("h2",{className:"text-2xl font-bold flex items-center gap-2",children:"🏆 Afrek"}),N.jsxs("p",{className:"text-yellow-100 text-sm mt-1",children:[a," / ",l," opnuð (",c,"%)"]})]}),t&&N.jsx("button",{onClick:t,className:"text-white/80 hover:text-white text-2xl transition-colors","aria-label":"Loka",children:"×"})]}),N.jsx("div",{className:"mt-4 h-3 bg-white/30 rounded-full overflow-hidden",children:N.jsx("div",{className:"h-full bg-white transition-all duration-500",style:{width:`${c}%`}})}),N.jsxs("div",{className:"mt-4 grid grid-cols-3 gap-4 text-center",children:[N.jsxs("div",{className:"bg-white/20 rounded-lg p-2",children:[N.jsx("div",{className:"text-2xl font-bold",children:i.totalPoints}),N.jsx("div",{className:"text-xs text-yellow-100",children:"Stig"})]}),N.jsxs("div",{className:"bg-white/20 rounded-lg p-2",children:[N.jsx("div",{className:"text-2xl font-bold",children:i.bestStreak}),N.jsx("div",{className:"text-xs text-yellow-100",children:"Besta röð"})]}),N.jsxs("div",{className:"bg-white/20 rounded-lg p-2",children:[N.jsx("div",{className:"text-2xl font-bold",children:i.totalProblemsSolved}),N.jsx("div",{className:"text-xs text-yellow-100",children:"Verkefni"})]})]})]}),N.jsxs("div",{className:"flex gap-1 p-2 bg-gray-100 overflow-x-auto",children:[N.jsx("button",{onClick:()=>s("all"),className:`px-3 py-1.5 rounded-lg text-sm font-medium transition-colors whitespace-nowrap ${r==="all"?"bg-white shadow text-gray-800":"text-gray-600 hover:bg-white/50"}`,children:"Allt"}),Object.keys(zC).map(u=>N.jsxs("button",{onClick:()=>s(u),className:`px-3 py-1.5 rounded-lg text-sm font-medium transition-colors whitespace-nowrap ${r===u?"bg-white shadow text-gray-800":"text-gray-600 hover:bg-white/50"}`,children:[zC[u].icon," ",zC[u].label]},u))]}),N.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:N.jsx("div",{className:"space-y-3",children:o.map(u=>{const h=ON(i,u),f=i.unlocked.includes(u.id);return u.secret&&!f?null:N.jsx("div",{className:`p-3 rounded-xl border-2 transition-all ${f?`${vS[u.rarity].bg} ${vS[u.rarity].border}`:"bg-gray-50 border-gray-200"}`,children:N.jsx(o$,{achievement:u,progress:h,size:"md"})},u.id)})})}),N.jsxs("div",{className:"p-4 bg-gray-50 border-t flex justify-between items-center",children:[N.jsxs("div",{className:"text-sm text-gray-500",children:["🔥 Núverandi röð: ",i.currentStreak]}),n&&N.jsx("button",{onClick:()=>{window.confirm("Ertu viss um að þú viljir endurstilla öll afrek?")&&n()},className:"text-sm text-red-500 hover:text-red-700 transition-colors",children:"Endurstilla"})]})]})})}function p$({achievements:i,onClick:e}){return N.jsxs("button",{onClick:e,className:"flex items-center gap-2 px-3 py-2 bg-yellow-100 hover:bg-yellow-200 border-2 border-yellow-400 rounded-xl transition-colors",title:"Skoða afrek",children:[N.jsx("span",{className:"text-lg",children:"🏆"}),N.jsx("span",{className:"font-semibold text-yellow-800",children:i.totalPoints}),i.currentStreak>0&&N.jsxs("span",{className:"flex items-center gap-1 text-sm text-orange-600",children:["🔥 ",i.currentStreak]})]})}const NN={H:{color:"#F3F4F6",radius:.6,name:"Hydrogen",mass:1.008,strokeColor:"#9CA3AF"},C:{color:"#4B5563",radius:1,name:"Carbon",mass:12.011,strokeColor:"#D1D5DB"},N:{color:"#3B82F6",radius:.95,name:"Nitrogen",mass:14.007},O:{color:"#EF4444",radius:.9,name:"Oxygen",mass:15.999},F:{color:"#84CC16",radius:.7,name:"Fluorine",mass:18.998},Cl:{color:"#22C55E",radius:1.15,name:"Chlorine",mass:35.453},Br:{color:"#991B1B",radius:1.25,name:"Bromine",mass:79.904},I:{color:"#7C3AED",radius:1.4,name:"Iodine",mass:126.904},Li:{color:"#A855F7",radius:1.2,name:"Lithium",mass:6.941},Na:{color:"#8B5CF6",radius:1.5,name:"Sodium",mass:22.99},K:{color:"#EC4899",radius:1.8,name:"Potassium",mass:39.098},Be:{color:"#A3E635",radius:.9,name:"Beryllium",mass:9.012},Mg:{color:"#14B8A6",radius:1.3,name:"Magnesium",mass:24.305},Ca:{color:"#F97316",radius:1.6,name:"Calcium",mass:40.078},S:{color:"#EAB308",radius:1.2,name:"Sulfur",mass:32.065},P:{color:"#F59E0B",radius:1.1,name:"Phosphorus",mass:30.974},Si:{color:"#D4A574",radius:1.15,name:"Silicon",mass:28.086},Al:{color:"#A1A1AA",radius:1.25,name:"Aluminum",mass:26.982},Fe:{color:"#78716C",radius:1.3,name:"Iron",mass:55.845},Cu:{color:"#B45309",radius:1.28,name:"Copper",mass:63.546},Zn:{color:"#71717A",radius:1.35,name:"Zinc",mass:65.38},Ag:{color:"#C0C0C0",radius:1.45,name:"Silver",mass:107.868},Au:{color:"#FFD700",radius:1.44,name:"Gold",mass:196.967},He:{color:"#00FFFF",radius:.5,name:"Helium",mass:4.003},Ne:{color:"#FF6347",radius:.7,name:"Neon",mass:20.18},Ar:{color:"#00CED1",radius:1,name:"Argon",mass:39.948}},UN={color:"#9CA3AF",radius:1,name:"Unknown",mass:0},m$={sm:{width:120,height:120,atomRadius:14,bondWidth:2,fontSize:10},md:{width:180,height:180,atomRadius:20,bondWidth:3,fontSize:12},lg:{width:240,height:240,atomRadius:26,bondWidth:4,fontSize:14},xl:{width:320,height:320,atomRadius:32,bondWidth:5,fontSize:16}},g$={single:{lines:1,gap:0},double:{lines:2,gap:4},triple:{lines:3,gap:3}},I3={fast:200,normal:400,build:800},zN={linear:[{x:-1,y:0,z:0},{x:1,y:0,z:0}],bent:[{x:-.7,y:-.5,z:0},{x:.7,y:-.5,z:0}],"trigonal-planar":[{x:0,y:-1,z:0},{x:-.87,y:.5,z:0},{x:.87,y:.5,z:0}],"trigonal-pyramidal":[{x:0,y:-.8,z:.3},{x:-.7,y:.4,z:.3},{x:.7,y:.4,z:.3}],tetrahedral:[{x:0,y:-.9,z:.3},{x:-.85,y:.3,z:.3},{x:.85,y:.3,z:.3},{x:0,y:.3,z:-.9}],"see-saw":[{x:-1,y:0,z:0},{x:1,y:0,z:0},{x:0,y:-.8,z:.3},{x:0,y:.8,z:-.3}],"t-shaped":[{x:-1,y:0,z:0},{x:1,y:0,z:0},{x:0,y:-1,z:0}],"square-planar":[{x:0,y:-1,z:0},{x:-1,y:0,z:0},{x:0,y:1,z:0},{x:1,y:0,z:0}],"trigonal-bipyramidal":[{x:0,y:-1,z:0},{x:0,y:1,z:0},{x:-.87,y:0,z:.3},{x:.87,y:0,z:.3},{x:0,y:0,z:-1}],"square-pyramidal":[{x:0,y:-1,z:0},{x:-.8,y:.3,z:.3},{x:.8,y:.3,z:.3},{x:-.8,y:.3,z:-.6},{x:.8,y:.3,z:-.6}],octahedral:[{x:0,y:-1,z:0},{x:0,y:1,z:0},{x:-1,y:0,z:0},{x:1,y:0,z:0},{x:0,y:0,z:1},{x:0,y:0,z:-1}]},$a={bond:"#374151",bondHighlight:"#3B82F6",bondPolar:"#6366F1",formalChargePositive:"#EF4444",formalChargeNegative:"#3B82F6",partialChargePositive:"#F97316",partialChargeNegative:"#0EA5E9",lonePair:"#6B7280",radical:"#EF4444",atomHighlight:"#FCD34D",dipole:"#8B5CF6"};function H_(i){return NN[i]||UN}function A$(i,e,t=0,n=0){return{x:t+(i.x+i.z*.3)*e,y:n+(i.y-i.z*.3)*e}}function y$(i){const e=(i+1)/2;return{opacity:.6+e*.4,scale:.8+e*.2}}function v$(i,e,t,n){const r=zN[i];return r?r.map(s=>A$(s,n,e,t)):[]}function GN(i,e,t,n){const r=new Map,s=e/2,o=t/2;if(i.atoms.some(c=>c.position)){for(const c of i.atoms)c.position&&r.set(c.id,{x:c.position.x*(e/2)+s,y:c.position.y*(t/2)+o});return r}if(i.geometry&&i.atoms.length>1){const c=Math.min(e,t)/3,u=v$(i.geometry,s,o,c);r.set(i.atoms[0].id,{x:s,y:o});for(let h=1;h<i.atoms.length&&h<=u.length;h++)r.set(i.atoms[h].id,u[h-1]);return r}const l=i.atoms.length;if(l===1)r.set(i.atoms[0].id,{x:s,y:o});else if(l===2){const c=n*3;r.set(i.atoms[0].id,{x:s-c,y:o}),r.set(i.atoms[1].id,{x:s+c,y:o})}else{const c=(l-1)*n*2.5,u=s-c/2;for(let h=0;h<l;h++)r.set(i.atoms[h].id,{x:u+h*n*2.5,y:o})}return r}function x$(i,e,t,n){const r=e.x-i.x,s=e.y-i.y,o=Math.sqrt(r*r+s*s);if(o===0)return{start:i,end:e};const a=r/o,l=s/o,c={x:i.x+a*t,y:i.y+l*t},u={x:e.x-a*n,y:e.y-l*n};return{start:c,end:u}}function rL(i,e){const t=e.x-i.x,n=e.y-i.y;return Math.atan2(n,t)*(180/Math.PI)}function GC(i,e,t){const n=e*(Math.PI/180);return{x:i.x+Math.cos(n)*t,y:i.y+Math.sin(n)*t}}function E$(i){return m$[i]}function _$(i){const e=i.replace("#",""),t=parseInt(e.substr(0,2),16),n=parseInt(e.substr(2,2),16),r=parseInt(e.substr(4,2),16);return(.299*t+.587*n+.114*r)/255>.5?"#1F2937":"#FFFFFF"}function S$(i){return i.map((e,t)=>({...e,id:e.id||`atom-${t}`}))}function w$(i,e,t,n){const r=new Map,s=t/2,o=i.atoms.filter(d=>d.symbol==="C"),a=i.atoms.filter(d=>d.symbol!=="C");if(o.length===0)return GN(i,e,t,n);const l=n*2,c=e-l*2,u=Math.min(n*3,c/Math.max(o.length-1,1)),h=(o.length-1)*u,f=(e-h)/2;o.forEach((d,m)=>{r.set(d.id,{x:f+m*u,y:s})});for(const d of a){const m=i.bonds.find(y=>y.from===d.id||y.to===d.id);if(m){const y=m.from===d.id?m.to:m.from,g=r.get(y);if(g){const A=n*1.5,E=a.indexOf(d)%2===0?-A:A;r.set(d.id,{x:g.x,y:g.y+E})}}}return r}function C$(i){switch(i){case"single":return"#4B5563";case"double":return"#16A34A";case"triple":return"#9333EA";default:return"#4B5563"}}function T$(i){switch(i){case"double":return"rgba(34, 197, 94, 0.4)";case"triple":return"rgba(168, 85, 247, 0.4)";default:return null}}function b$({atom:i,position:e,baseRadius:t,fontSize:n,mode:r,showLabel:s=!1,showFormalCharge:o=!0,showPartialCharge:a=!1,isHighlighted:l=!1,isInteractive:c=!1,onClick:u,animationDelay:h=0,reducedMotion:f=!1,depthOpacity:d=1,depthScale:m=1}){const y=H_(i.symbol),g=t*y.radius*m,A=_$(y.color),E=f?{}:{opacity:0,transform:"scale(0)",animation:`atomEnter 300ms ease-out ${h}ms forwards`},x=l?"url(#atomHighlightGlow)":void 0,w=y.strokeColor,T=w?2:0;return N.jsxs("g",{className:`molecule-atom ${c?"cursor-pointer":""}`,onClick:c?u:void 0,role:c?"button":void 0,"aria-label":`${y.name||i.symbol} atom`,style:{opacity:d},children:[N.jsx("circle",{cx:e.x,cy:e.y,r:g,fill:y.color,stroke:w||"transparent",strokeWidth:T,filter:x,style:E}),l&&N.jsx("circle",{cx:e.x,cy:e.y,r:g+4,fill:"none",stroke:$a.atomHighlight,strokeWidth:3,opacity:.7,style:E}),N.jsx("text",{x:e.x,y:e.y,textAnchor:"middle",dominantBaseline:"central",fontSize:n*m,fontWeight:"bold",fill:A,style:E,children:i.symbol}),s&&i.label&&N.jsx("text",{x:e.x,y:e.y-g-8,textAnchor:"middle",fontSize:n*.8,fill:"#6B7280",style:E,children:i.label}),o&&i.formalCharge!==void 0&&i.formalCharge!==0&&N.jsxs("g",{style:E,children:[N.jsx("circle",{cx:e.x+g*.7,cy:e.y-g*.7,r:n*.6,fill:i.formalCharge>0?$a.formalChargePositive:$a.formalChargeNegative}),N.jsx("text",{x:e.x+g*.7,y:e.y-g*.7,textAnchor:"middle",dominantBaseline:"central",fontSize:n*.7,fontWeight:"bold",fill:"white",children:i.formalCharge>0?`+${i.formalCharge}`:i.formalCharge})]}),a&&i.partialCharge&&i.partialCharge!=="none"&&N.jsx("text",{x:e.x+g*.8,y:e.y-g*.8,textAnchor:"middle",dominantBaseline:"central",fontSize:n*.9,fontWeight:"bold",fill:i.partialCharge==="positive"?$a.partialChargePositive:$a.partialChargeNegative,style:E,children:i.partialCharge==="positive"?"δ+":"δ−"}),i.isRadical&&N.jsx("circle",{cx:e.x+g*.9,cy:e.y,r:4,fill:$a.radical,style:E,children:!f&&N.jsx("animate",{attributeName:"opacity",values:"1;0.5;1",dur:"1s",repeatCount:"indefinite"})})]})}function I$(){return N.jsxs("defs",{children:[N.jsxs("filter",{id:"atomHighlightGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[N.jsx("feGaussianBlur",{stdDeviation:"3",result:"blur"}),N.jsx("feFlood",{floodColor:$a.atomHighlight,result:"color"}),N.jsx("feComposite",{in:"color",in2:"blur",operator:"in",result:"glow"}),N.jsxs("feMerge",{children:[N.jsx("feMergeNode",{in:"glow"}),N.jsx("feMergeNode",{in:"SourceGraphic"})]})]}),N.jsx("style",{children:`
          @keyframes atomEnter {
            from {
              opacity: 0;
              transform: scale(0);
            }
            to {
              opacity: 1;
              transform: scale(1);
            }
          }

          @media (prefers-reduced-motion: reduce) {
            .molecule-atom * {
              animation: none !important;
              transition: none !important;
              opacity: 1 !important;
              transform: scale(1) !important;
            }
          }
        `})]})}function sL(i,e,t){const n=e.x-i.x,r=e.y-i.y,s=Math.sqrt(n*n+r*r);return s===0?{dx:0,dy:0}:{dx:-r/s*t,dy:n/s*t}}function M$({bond:i,startPos:e,endPos:t,bondWidth:n,mode:r="simple",isHighlighted:s=!1,isInteractive:o=!1,onClick:a,animationDelay:l=0,reducedMotion:c=!1}){const u=g$[i.type];let h;s?h=$a.bondHighlight:r==="organic"?h=C$(i.type):i.polar?h=$a.bondPolar:h=$a.bond;const f=r==="organic"?T$(i.type):null,d=t.x-e.x,m=t.y-e.y,y=Math.sqrt(d*d+m*m),g=c?{}:{strokeDasharray:y,strokeDashoffset:y,animation:`bondDraw 300ms ease-out ${l}ms forwards`};if(i.type==="single")return N.jsx("g",{className:`molecule-bond ${o?"cursor-pointer":""}`,onClick:o?a:void 0,role:o?"button":void 0,"aria-label":`${i.type} bond`,children:N.jsx("line",{x1:e.x,y1:e.y,x2:t.x,y2:t.y,stroke:h,strokeWidth:n,strokeLinecap:"round",style:g})});if(i.type==="double"){const A=sL(e,t,u.gap/2),E=(e.x+t.x)/2,x=(e.y+t.y)/2;return N.jsxs("g",{className:`molecule-bond ${o?"cursor-pointer":""}`,onClick:o?a:void 0,role:o?"button":void 0,"aria-label":"double bond",children:[f&&N.jsx("ellipse",{cx:E,cy:x,rx:y/2+8,ry:12,fill:f,style:g}),N.jsx("line",{x1:e.x+A.dx,y1:e.y+A.dy,x2:t.x+A.dx,y2:t.y+A.dy,stroke:h,strokeWidth:n,strokeLinecap:"round",style:g}),N.jsx("line",{x1:e.x-A.dx,y1:e.y-A.dy,x2:t.x-A.dx,y2:t.y-A.dy,stroke:h,strokeWidth:n,strokeLinecap:"round",style:{...g,animationDelay:c?"0ms":`${l+50}ms`}})]})}if(i.type==="triple"){const A=sL(e,t,u.gap),E=(e.x+t.x)/2,x=(e.y+t.y)/2;return N.jsxs("g",{className:`molecule-bond ${o?"cursor-pointer":""}`,onClick:o?a:void 0,role:o?"button":void 0,"aria-label":"triple bond",children:[f&&N.jsx("ellipse",{cx:E,cy:x,rx:y/2+8,ry:14,fill:f,style:g}),N.jsx("line",{x1:e.x,y1:e.y,x2:t.x,y2:t.y,stroke:h,strokeWidth:n,strokeLinecap:"round",style:g}),N.jsx("line",{x1:e.x+A.dx,y1:e.y+A.dy,x2:t.x+A.dx,y2:t.y+A.dy,stroke:h,strokeWidth:n,strokeLinecap:"round",style:{...g,animationDelay:c?"0ms":`${l+50}ms`}}),N.jsx("line",{x1:e.x-A.dx,y1:e.y-A.dy,x2:t.x-A.dx,y2:t.y-A.dy,stroke:h,strokeWidth:n,strokeLinecap:"round",style:{...g,animationDelay:c?"0ms":`${l+100}ms`}})]})}return null}function R$(){return N.jsx("defs",{children:N.jsx("style",{children:`
          @keyframes bondDraw {
            to {
              stroke-dashoffset: 0;
            }
          }

          @media (prefers-reduced-motion: reduce) {
            .molecule-bond {
              animation: none !important;
              stroke-dashoffset: 0 !important;
            }
          }
        `})})}function P$({atomPosition:i,angle:e,distance:t,dotSize:n=4,color:r=$a.lonePair,animationDelay:s=0,reducedMotion:o=!1}){const a=GC(i,e,t),l=e+90,c=n*1.2,u=GC(a,l,c/2),h=GC(a,l+180,c/2),f=o?{}:{opacity:0,transform:"scale(0)",animation:`lonePairEnter 200ms ease-out ${s}ms forwards`};return N.jsxs("g",{className:"molecule-lone-pair","aria-label":"lone pair",children:[N.jsx("circle",{cx:u.x,cy:u.y,r:n/2,fill:r,style:f}),N.jsx("circle",{cx:h.x,cy:h.y,r:n/2,fill:r,style:{...f,animationDelay:o?"0ms":`${s+50}ms`}})]})}function L$(i,e){if(e===0)return[];if(i.length===0){const s=[],o=360/e;for(let a=0;a<e;a++)s.push(a*o-90);return s}const t=[...i].sort((s,o)=>s-o),n=[];for(let s=0;s<t.length;s++){const o=t[s];let l=t[(s+1)%t.length]-o;l<=0&&(l+=360);const c=o+l/2;n.push({midAngle:c%360,size:l})}n.sort((s,o)=>o.size-s.size);const r=[];for(let s=0;s<e&&s<n.length;s++)r.push(n[s].midAngle);return r}function B$(){return N.jsx("defs",{children:N.jsx("style",{children:`
          @keyframes lonePairEnter {
            from {
              opacity: 0;
              transform: scale(0);
            }
            to {
              opacity: 1;
              transform: scale(1);
            }
          }

          @media (prefers-reduced-motion: reduce) {
            .molecule-lone-pair circle {
              animation: none !important;
              opacity: 1 !important;
              transform: scale(1) !important;
            }
          }
        `})})}function D$(i){switch(i){case"right":return 0;case"down":return 90;case"left":return 180;case"up":return 270;default:return 0}}function M3(i,e,t){const n=e*Math.PI/180;return{x:i.x+Math.cos(n)*t,y:i.y+Math.sin(n)*t}}function k$({moleculeCenter:i,dipole:e,length:t=60,strokeWidth:n=3,color:r=$a.dipole,animationDelay:s=0,reducedMotion:o=!1,showLabels:a=!0}){const l=D$(e.direction),c=t/2,u=M3(i,l+180,c),h=M3(i,l,c),f=12,d=8,m=l*Math.PI/180,y=m+Math.PI/2,g={x:h.x-Math.cos(m)*f,y:h.y-Math.sin(m)*f},A={x:g.x+Math.cos(y)*d/2,y:g.y+Math.sin(y)*d/2},E={x:g.x-Math.cos(y)*d/2,y:g.y-Math.sin(y)*d/2},x=o?{}:{opacity:0,animation:`dipoleEnter 400ms ease-out ${s}ms forwards`},w=14,T=M3(u,l+180,w),I=M3(h,l,w);return N.jsxs("g",{className:"molecule-dipole","aria-label":"dipole moment arrow",style:x,children:[N.jsx("line",{x1:u.x,y1:u.y,x2:g.x,y2:g.y,stroke:r,strokeWidth:n,strokeLinecap:"round"}),N.jsx("polygon",{points:`${h.x},${h.y} ${A.x},${A.y} ${E.x},${E.y}`,fill:r}),N.jsx("line",{x1:u.x+Math.cos(y)*6,y1:u.y+Math.sin(y)*6,x2:u.x-Math.cos(y)*6,y2:u.y-Math.sin(y)*6,stroke:r,strokeWidth:n,strokeLinecap:"round"}),a&&N.jsxs(N.Fragment,{children:[N.jsx("text",{x:T.x,y:T.y,textAnchor:"middle",dominantBaseline:"central",fontSize:12,fontWeight:"bold",fill:$a.partialChargePositive,children:"δ+"}),N.jsx("text",{x:I.x,y:I.y,textAnchor:"middle",dominantBaseline:"central",fontSize:12,fontWeight:"bold",fill:$a.partialChargeNegative,children:"δ−"})]})]})}function F$(i,e){const t=i.filter(c=>c.partialCharge==="positive"),n=i.filter(c=>c.partialCharge==="negative");if(t.length===0||n.length===0)return;const r={x:t.reduce((c,u)=>c+u.position.x,0)/t.length,y:t.reduce((c,u)=>c+u.position.y,0)/t.length},s={x:n.reduce((c,u)=>c+u.position.x,0)/n.length,y:n.reduce((c,u)=>c+u.position.y,0)/n.length},o=s.x-r.x,a=s.y-r.y,l=Math.atan2(a,o)*(180/Math.PI);return l>=-45&&l<45?"right":l>=45&&l<135?"down":l>=-135&&l<-45?"up":"left"}function O$(i,e,t){const n=Math.min(i,e)*.6,r=t?n*Math.min(t,2):n;return Math.max(40,Math.min(r,100))}function N$(){return N.jsx("defs",{children:N.jsx("style",{children:`
          @keyframes dipoleEnter {
            from {
              opacity: 0;
              transform: scale(0.8);
            }
            to {
              opacity: 1;
              transform: scale(1);
            }
          }

          @media (prefers-reduced-motion: reduce) {
            .molecule-dipole {
              animation: none !important;
              opacity: 1 !important;
              transform: scale(1) !important;
            }
          }
        `})})}function U$({atomCount:i,bondCount:e,lonePairCount:t,animation:n,baseDuration:r,reducedMotion:s=!1,onAnimationComplete:o}){const[a,l]=C.useState("idle"),[c,u]=C.useState(0),h=s||n==="none",f=C.useMemo(()=>{if(r)return r;switch(n){case"none":return 0;case"fade-in":return I3.fast;case"scale-in":return I3.normal;case"build":return I3.build;default:return I3.normal}},[n,r]),d=C.useMemo(()=>{if(h)return{atomDelay:0,atomDuration:0,bondStartDelay:0,bondDelay:0,bondDuration:0,lonePairStartDelay:0,lonePairDelay:0,lonePairDuration:0};switch(n){case"build":const x=Math.max(50,f/Math.max(i,1)),w=Math.max(30,f*.5/Math.max(e,1));return{atomDelay:x,atomDuration:300,bondStartDelay:i*x,bondDelay:w,bondDuration:300,lonePairStartDelay:i*x+e*w,lonePairDelay:50,lonePairDuration:200};case"scale-in":return{atomDelay:30,atomDuration:f,bondStartDelay:50,bondDelay:20,bondDuration:f,lonePairStartDelay:100,lonePairDelay:30,lonePairDuration:f*.8};case"fade-in":default:return{atomDelay:20,atomDuration:f,bondStartDelay:30,bondDelay:15,bondDuration:f,lonePairStartDelay:50,lonePairDelay:25,lonePairDuration:f}}},[n,f,i,e,h]),m=C.useMemo(()=>{if(h)return 0;const x=i*d.atomDelay+d.atomDuration,w=d.bondStartDelay+e*d.bondDelay+d.bondDuration,T=d.lonePairStartDelay+t*d.lonePairDelay+d.lonePairDuration;return Math.max(x,w,T)},[i,e,t,d,h]),y=C.useCallback(x=>h?{delay:0,duration:0}:{delay:x*d.atomDelay,duration:d.atomDuration},[d,h]),g=C.useCallback(x=>h?{delay:0,duration:0}:{delay:d.bondStartDelay+x*d.bondDelay,duration:d.bondDuration},[d,h]),A=C.useCallback((x,w)=>{if(h)return{delay:0,duration:0};const T=x*2+w;return{delay:d.lonePairStartDelay+T*d.lonePairDelay,duration:d.lonePairDuration}},[d,h]),E=C.useCallback(()=>{u(x=>x+1),l("idle")},[]);return C.useEffect(()=>{if(h){l("complete");return}l("running");const x=setTimeout(()=>{l("complete"),o==null||o()},m+50);return()=>clearTimeout(x)},[c,m,h,o]),{state:a,getAtomTiming:y,getBondTiming:g,getLonePairTiming:A,totalDuration:m,shouldSkipAnimation:h,restart:E}}const z$=`
  @keyframes moleculeFadeIn {
    from {
      opacity: 0;
    }
    to {
      opacity: 1;
    }
  }

  @keyframes moleculeScaleIn {
    from {
      opacity: 0;
      transform: scale(0);
    }
    to {
      opacity: 1;
      transform: scale(1);
    }
  }

  @keyframes moleculeBuildAtom {
    0% {
      opacity: 0;
      transform: scale(0);
    }
    50% {
      opacity: 1;
      transform: scale(1.1);
    }
    100% {
      opacity: 1;
      transform: scale(1);
    }
  }

  @keyframes moleculeBuildBond {
    from {
      stroke-dashoffset: var(--bond-length, 100);
    }
    to {
      stroke-dashoffset: 0;
    }
  }

  @keyframes moleculePulse {
    0%, 100% {
      transform: scale(1);
    }
    50% {
      transform: scale(1.05);
    }
  }
`;function tM({molecule:i,mode:e="simple",size:t="md",animation:n="fade-in",animationDuration:r,showLonePairs:s=!1,showFormalCharges:o=!0,showPartialCharges:a=!1,showDipoleMoment:l=!1,showAtomLabels:c=!1,interactive:u=!1,onAtomClick:h,onBondClick:f,highlightedAtoms:d=[],highlightedBonds:m=[],className:y="",reducedMotion:g=!1,ariaLabel:A,onAnimationComplete:E}){const x=E$(t),{width:w,height:T,atomRadius:I,bondWidth:M,fontSize:L}=x,P=C.useMemo(()=>S$(i.atoms),[i.atoms]),R=C.useMemo(()=>!s||e!=="lewis"?0:P.reduce((q,J)=>q+(J.lonePairs||0),0),[P,s,e]),{getAtomTiming:U,getBondTiming:k,getLonePairTiming:H,shouldSkipAnimation:G}=U$({atomCount:P.length,bondCount:i.bonds.length,lonePairCount:R,animation:n,baseDuration:r,reducedMotion:g,onAnimationComplete:E}),X=C.useMemo(()=>e==="organic"?w$({...i,atoms:P},w,T,I):GN({...i,atoms:P},w,T,I),[i,P,w,T,I,e]),Z=C.useMemo(()=>{const q=new Map;for(const J of P){const re=X.get(J.id);if(!re)continue;const ie=[];for(const se of i.bonds)if(se.from===J.id){const ge=X.get(se.to);ge&&ie.push(rL(re,ge))}else if(se.to===J.id){const ge=X.get(se.from);ge&&ie.push(rL(re,ge))}q.set(J.id,ie)}return q},[P,X,i.bonds]),oe=C.useMemo(()=>{if(e!=="vsepr"||!i.geometry)return new Map;const q=zN[i.geometry];if(!q)return new Map;const J=new Map;P.length>0&&J.set(P[0].id,{opacity:1,scale:1});for(let re=1;re<P.length&&re<=q.length;re++){const ie=q[re-1].z;J.set(P[re].id,y$(ie))}return J},[e,i.geometry,P]),K=C.useMemo(()=>{var re,ie,se;if(!l)return null;let q=(re=i.dipoleMoment)==null?void 0:re.direction;if(!q&&i.isPolar){const ge=P.map(xe=>({position:X.get(xe.id),partialCharge:xe.partialCharge})).filter(xe=>xe.position);q=F$(ge)}if(!q)return null;const J=O$(w*.6,T*.6,(ie=i.dipoleMoment)==null?void 0:ie.magnitude);return{direction:q,magnitude:(se=i.dipoleMoment)==null?void 0:se.magnitude,length:J,center:{x:w/2,y:T/2}}},[l,i.dipoleMoment,i.isPolar,P,X,w,T]),V=q=>{if(!u||!h)return;const J=P.find(re=>re.id===q);h({type:"atom",atomId:q,atom:J})},W=q=>{if(!u||!f)return;const J=i.bonds[q];f({type:"bond",bondIndex:q,bond:J})},F=i.bonds.map((q,J)=>{const re=X.get(q.from),ie=X.get(q.to);if(!re||!ie)return null;const se=P.find(ve=>ve.id===q.from),ge=P.find(ve=>ve.id===q.to),xe=I*(se?H_(se.symbol).radius:1),pe=I*(ge?H_(ge.symbol).radius:1),{start:ue,end:Me}=x$(re,ie,xe,pe),Se=k(J);return N.jsx(M$,{bond:q,startPos:ue,endPos:Me,bondWidth:M,mode:e,isHighlighted:m.includes(J)||q.highlight,isInteractive:u,onClick:()=>W(J),animationDelay:Se.delay,reducedMotion:G},`bond-${J}`)}),Y=P.map((q,J)=>{const re=X.get(q.id);if(!re)return null;const ie=oe.get(q.id)||{opacity:1,scale:1},se=U(J);return N.jsx(b$,{atom:q,position:re,baseRadius:I,fontSize:L,mode:e,showLabel:c,showFormalCharge:o&&e==="lewis",showPartialCharge:a,isHighlighted:d.includes(q.id)||q.highlight,isInteractive:u,onClick:()=>V(q.id),animationDelay:se.delay,reducedMotion:G,depthOpacity:ie.opacity,depthScale:ie.scale},q.id)}),te=A||`${i.name||i.formula} molecule with ${P.length} atoms and ${i.bonds.length} bonds`;return N.jsxs("svg",{width:w,height:T,viewBox:`0 0 ${w} ${T}`,className:`animated-molecule ${y}`,role:"img","aria-label":te,children:[N.jsx("defs",{children:N.jsx("style",{children:z$})}),N.jsx(I$,{}),N.jsx(R$,{}),N.jsx(B$,{}),N.jsx(N$,{}),N.jsx("rect",{x:0,y:0,width:w,height:T,fill:"transparent",rx:8}),N.jsx("g",{className:"molecule-bonds",children:F}),N.jsx("g",{className:"molecule-atoms",children:Y}),s&&e==="lewis"&&N.jsx("g",{className:"molecule-lone-pairs",children:P.map((q,J)=>{if(!q.lonePairs||q.lonePairs===0)return null;const re=X.get(q.id);if(!re)return null;const ie=Z.get(q.id)||[],se=L$(ie,q.lonePairs),ge=H_(q.symbol),pe=I*ge.radius+8;return se.map((ue,Me)=>{const Se=H(J,Me);return N.jsx(P$,{atomPosition:re,angle:ue,distance:pe,dotSize:Math.max(4,L*.4),animationDelay:Se.delay,reducedMotion:G},`${q.id}-lp-${Me}`)})})}),l&&K&&N.jsx(k$,{moleculeCenter:K.center,dipole:{direction:K.direction,magnitude:K.magnitude},length:K.length,animationDelay:G?0:500,reducedMotion:G,showLabels:!a})]})}const G$={showExplanation:!0,showMisconceptions:!0,showRelatedConcepts:!0,showNextSteps:!0,autoCollapseMs:0};function H$(i){switch(i){case"success":return{container:"bg-green-50 border-green-200",icon:"text-green-500",text:"text-green-800"};case"error":return{container:"bg-red-50 border-red-200",icon:"text-red-500",text:"text-red-800"};case"warning":return{container:"bg-amber-50 border-amber-200",icon:"text-amber-500",text:"text-amber-800"};case"info":default:return{container:"bg-blue-50 border-blue-200",icon:"text-blue-500",text:"text-blue-800"}}}function Q$(i){switch(i){case"success":return"✓";case"error":return"✗";case"warning":return"⚠";case"info":default:return"ℹ"}}function V$({feedback:i,severity:e,config:t,onDismiss:n,onConceptClick:r,className:s=""}){const[o,a]=C.useState(!1),[l,c]=C.useState(!0),u={...G$,...t},h=e??(i.isCorrect?"success":"error"),f=H$(h),d=Q$(h);C.useEffect(()=>{if(u.autoCollapseMs&&u.autoCollapseMs>0){const g=setTimeout(()=>{a(!1)},u.autoCollapseMs);return()=>clearTimeout(g)}},[u.autoCollapseMs,o]);const m=C.useCallback(()=>{c(!1),n==null||n()},[n]),y=C.useCallback(g=>{r==null||r(g.toLowerCase().replace(/\s+/g,"-"))},[r]);return l?N.jsx("div",{className:`
        feedback-panel
        ${f.container}
        border rounded-xl p-4
        transition-all duration-300 ease-in-out
        ${s}
      `,role:"alert","aria-live":"polite",children:N.jsxs("div",{className:"flex items-start gap-3",children:[N.jsx("span",{className:`
            ${f.icon}
            text-2xl font-bold
            flex-shrink-0
          `,"aria-hidden":"true",children:d}),N.jsxs("div",{className:"flex-1 min-w-0",children:[N.jsx("p",{className:`${f.text} font-medium`,children:i.isCorrect?"Rétt!":"Rangt"}),u.showExplanation&&i.explanation&&N.jsxs("div",{className:"mt-2",children:[N.jsxs("button",{onClick:()=>a(!o),className:`
                  text-sm ${f.text} opacity-75
                  hover:opacity-100 transition-opacity
                  flex items-center gap-1
                `,type:"button","aria-expanded":o,children:[N.jsx("span",{className:"text-xs",children:o?"▼":"▶"}),N.jsx("span",{children:"Af hverju?"})]}),o&&N.jsx("div",{className:`
                    mt-2 p-3 rounded-lg
                    bg-white/50
                    ${f.text} text-sm
                    animate-fadeIn
                  `,children:i.explanation})]}),u.showMisconceptions&&i.misconception&&!i.isCorrect&&N.jsxs("div",{className:`
                mt-3 p-3 rounded-lg
                bg-amber-100 border border-amber-300
                text-amber-800 text-sm
              `,children:[N.jsx("span",{className:"font-medium",children:"Algeng villa: "}),i.misconception]}),u.showRelatedConcepts&&i.relatedConcepts&&i.relatedConcepts.length>0&&N.jsxs("div",{className:"mt-3",children:[N.jsx("span",{className:`text-xs ${f.text} opacity-75`,children:"Tengd efni:"}),N.jsx("div",{className:"flex flex-wrap gap-2 mt-1",children:i.relatedConcepts.map(g=>N.jsx("button",{onClick:()=>y(g),className:`
                        px-2 py-1 rounded-full
                        text-xs font-medium
                        bg-white/70 ${f.text}
                        hover:bg-white transition-colors
                      `,type:"button",children:g},g))})]}),u.showNextSteps&&i.nextSteps&&N.jsxs("div",{className:`
                mt-3 text-sm ${f.text} opacity-90
                flex items-center gap-2
              `,children:[N.jsx("span",{children:"→"}),N.jsx("span",{children:i.nextSteps})]})]}),n&&N.jsx("button",{onClick:m,className:`
              ${f.text} opacity-50
              hover:opacity-100 transition-opacity
              flex-shrink-0 p-1
            `,type:"button","aria-label":"Loka",children:"✕"})]})}):null}const j$="modulepreload",W$=function(i,e){return new URL(i,e).href},oL={},U1=function(e,t,n){let r=Promise.resolve();if(t&&t.length>0){let o=function(u){return Promise.all(u.map(h=>Promise.resolve(h).then(f=>({status:"fulfilled",value:f}),f=>({status:"rejected",reason:f}))))};const a=document.getElementsByTagName("link"),l=document.querySelector("meta[property=csp-nonce]"),c=(l==null?void 0:l.nonce)||(l==null?void 0:l.getAttribute("nonce"));r=o(t.map(u=>{if(u=W$(u,n),u in oL)return;oL[u]=!0;const h=u.endsWith(".css"),f=h?'[rel="stylesheet"]':"";if(!!n)for(let y=a.length-1;y>=0;y--){const g=a[y];if(g.href===u&&(!h||g.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${u}"]${f}`))return;const m=document.createElement("link");if(m.rel=h?"stylesheet":j$,h||(m.as="script"),m.crossOrigin="",m.href=u,c&&m.setAttribute("nonce",c),document.head.appendChild(m),h)return new Promise((y,g)=>{m.addEventListener("load",y),m.addEventListener("error",()=>g(new Error(`Unable to preload CSS for ${u}`)))})}))}function s(o){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=o,window.dispatchEvent(a),!a.defaultPrevented)throw o}return r.then(o=>{for(const a of o||[])a.status==="rejected"&&s(a.reason);return e().catch(s)})},K$=C.lazy(()=>U1(()=>Promise.resolve().then(()=>A3e),void 0,import.meta.url).then(i=>({default:i.MoleculeViewer3D})));function Y$({width:i,height:e}){return N.jsx("div",{className:`
        flex items-center justify-center
        bg-gray-100 rounded-xl
        text-gray-500 text-sm
      `,style:{width:typeof i=="number"?`${i}px`:i||"100%",height:typeof e=="number"?`${e}px`:e||"300px"},children:N.jsxs("div",{className:"text-center",children:[N.jsx("div",{className:"animate-spin w-6 h-6 border-2 border-gray-300 border-t-blue-500 rounded-full mx-auto mb-2"}),N.jsx("span",{children:"Loading 3D viewer..."})]})})}function $$({width:i,height:e,error:t}){return N.jsx("div",{className:`
        flex items-center justify-center
        bg-gray-100 rounded-xl
        text-gray-500 text-sm
      `,style:{width:typeof i=="number"?`${i}px`:i||"100%",height:typeof e=="number"?`${e}px`:e||"300px"},children:N.jsxs("div",{className:"text-center p-4",children:[N.jsx("span",{className:"block text-amber-500 text-lg mb-2",children:"⚠"}),N.jsx("span",{className:"block",children:"3D viewer not available"}),N.jsx("span",{className:"block text-xs text-gray-400 mt-1",children:t||"Three.js dependencies may not be installed"})]})})}function HN(i){const[e,t]=C.useState(!1),[n,r]=C.useState();return C.useEffect(()=>{(async()=>{try{await U1(()=>Promise.resolve().then(()=>nR),void 0,import.meta.url),await U1(()=>Promise.resolve().then(()=>ore),void 0,import.meta.url),await U1(()=>Promise.resolve().then(()=>u3e),void 0,import.meta.url)}catch(o){t(!0),r(o instanceof Error?o.message:"Failed to load 3D dependencies")}})()},[]),e?N.jsx($$,{width:i.width,height:i.height,error:n}):N.jsx(C.Suspense,{fallback:i.loadingFallback||N.jsx(Y$,{width:i.width,height:i.height}),children:N.jsx(K$,{...i})})}/**
 * @license
 * Copyright 2010-2023 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const dp="160",oc={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},Sf={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},QN=0,nM=1,VN=2,X$=3,jN=0,gw=1,Kv=2,fu=3,tl=0,ys=1,Li=2,q$=2,gc=0,Kd=1,xS=2,iM=3,rM=4,Aw=5,Nd=100,WN=101,KN=102,sM=103,oM=104,YN=200,yw=201,$N=202,XN=203,x2=204,ES=205,qN=206,JN=207,ZN=208,eU=209,tU=210,nU=211,iU=212,rU=213,sU=214,oU=0,aU=1,lU=2,E2=3,cU=4,uU=5,hU=6,fU=7,ix=0,dU=1,pU=2,yu=0,mU=1,gU=2,AU=3,v6=4,yU=5,vU=6,aM="attached",xU="detached",np=300,_u=301,ip=302,Xm=303,_2=304,SA=306,_o=1e3,Wi=1001,eA=1002,zn=1003,S2=1004,J$=1004,z1=1005,Z$=1005,Ln=1006,vw=1007,eX=1007,Bl=1008,lM=1008,Zi=1009,w2=1010,xw=1011,pp=1012,Um=1013,Zo=1014,fi=1015,Ni=1016,x6=1017,E6=1018,Yd=1020,EU=1021,gi=1023,_U=1024,SU=1025,vu=1026,qm=1027,hc=1028,Ew=1029,Gd=1030,rx=1031,Jm=1033,Yv=33776,Q_=33777,V_=33778,$v=33779,_S=35840,cM=35841,SS=35842,uM=35843,_w=36196,wS=37492,CS=37496,TS=37808,hM=37809,fM=37810,dM=37811,C2=37812,pM=37813,mM=37814,gM=37815,AM=37816,yM=37817,vM=37818,xM=37819,EM=37820,_M=37821,Xv=36492,SM=36494,wM=36495,wU=36283,CM=36284,TM=36285,bM=36286,CU=2200,TU=2201,bU=2202,tA=2300,Zm=2301,j_=2302,Mm=2400,Rm=2401,T2=2402,Sw=2500,_6=2501,IU=0,S6=1,bS=2,w6=3e3,$d=3001,MU=3200,ww=3201,mp=0,RU=1,Tl="",gs="srgb",Dl="srgb-linear",Cw="display-p3",sx="display-p3-linear",b2="linear",mr="srgb",I2="rec709",M2="p3",tX=0,hh=7680,W_=7681,nX=7682,iX=7683,rX=34055,sX=34056,oX=5386,aX=512,lX=513,PU=514,cX=515,uX=516,LU=517,hX=518,IS=519,BU=512,DU=513,kU=514,C6=515,FU=516,OU=517,NU=518,UU=519,R2=35044,No=35048,fX=35040,dX=35045,pX=35049,mX=35041,gX=35046,AX=35050,yX=35042,vX="100",IM="300 es",MS=1035,mu=2e3,nA=2001;let Ch=class{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const n=this._listeners;n[e]===void 0&&(n[e]=[]),n[e].indexOf(t)===-1&&n[e].push(t)}hasEventListener(e,t){if(this._listeners===void 0)return!1;const n=this._listeners;return n[e]!==void 0&&n[e].indexOf(t)!==-1}removeEventListener(e,t){if(this._listeners===void 0)return;const r=this._listeners[e];if(r!==void 0){const s=r.indexOf(t);s!==-1&&r.splice(s,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const n=this._listeners[e.type];if(n!==void 0){e.target=this;const r=n.slice(0);for(let s=0,o=r.length;s<o;s++)r[s].call(this,e);e.target=null}}};const Ko=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let aL=1234567;const zm=Math.PI/180,iA=180/Math.PI;function Pl(){const i=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,n=Math.random()*4294967295|0;return(Ko[i&255]+Ko[i>>8&255]+Ko[i>>16&255]+Ko[i>>24&255]+"-"+Ko[e&255]+Ko[e>>8&255]+"-"+Ko[e>>16&15|64]+Ko[e>>24&255]+"-"+Ko[t&63|128]+Ko[t>>8&255]+"-"+Ko[t>>16&255]+Ko[t>>24&255]+Ko[n&255]+Ko[n>>8&255]+Ko[n>>16&255]+Ko[n>>24&255]).toLowerCase()}function rs(i,e,t){return Math.max(e,Math.min(t,i))}function T6(i,e){return(i%e+e)%e}function xX(i,e,t,n,r){return n+(i-e)*(r-n)/(t-e)}function EX(i,e,t){return i!==e?(t-i)/(e-i):0}function qv(i,e,t){return(1-t)*i+t*e}function _X(i,e,t,n){return qv(i,e,1-Math.exp(-t*n))}function SX(i,e=1){return e-Math.abs(T6(i,e*2)-e)}function wX(i,e,t){return i<=e?0:i>=t?1:(i=(i-e)/(t-e),i*i*(3-2*i))}function CX(i,e,t){return i<=e?0:i>=t?1:(i=(i-e)/(t-e),i*i*i*(i*(i*6-15)+10))}function TX(i,e){return i+Math.floor(Math.random()*(e-i+1))}function bX(i,e){return i+Math.random()*(e-i)}function IX(i){return i*(.5-Math.random())}function MX(i){i!==void 0&&(aL=i);let e=aL+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function RX(i){return i*zm}function PX(i){return i*iA}function MM(i){return(i&i-1)===0&&i!==0}function LX(i){return Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))}function RS(i){return Math.pow(2,Math.floor(Math.log(i)/Math.LN2))}function BX(i,e,t,n,r){const s=Math.cos,o=Math.sin,a=s(t/2),l=o(t/2),c=s((e+n)/2),u=o((e+n)/2),h=s((e-n)/2),f=o((e-n)/2),d=s((n-e)/2),m=o((n-e)/2);switch(r){case"XYX":i.set(a*u,l*h,l*f,a*c);break;case"YZY":i.set(l*f,a*u,l*h,a*c);break;case"ZXZ":i.set(l*h,l*f,a*u,a*c);break;case"XZX":i.set(a*u,l*m,l*d,a*c);break;case"YXY":i.set(l*d,a*u,l*m,a*c);break;case"ZYZ":i.set(l*m,l*d,a*u,a*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+r)}}function qa(i,e){switch(e.constructor){case Float32Array:return i;case Uint32Array:return i/4294967295;case Uint16Array:return i/65535;case Uint8Array:return i/255;case Int32Array:return Math.max(i/2147483647,-1);case Int16Array:return Math.max(i/32767,-1);case Int8Array:return Math.max(i/127,-1);default:throw new Error("Invalid component type.")}}function ii(i,e){switch(e.constructor){case Float32Array:return i;case Uint32Array:return Math.round(i*4294967295);case Uint16Array:return Math.round(i*65535);case Uint8Array:return Math.round(i*255);case Int32Array:return Math.round(i*2147483647);case Int16Array:return Math.round(i*32767);case Int8Array:return Math.round(i*127);default:throw new Error("Invalid component type.")}}const un={DEG2RAD:zm,RAD2DEG:iA,generateUUID:Pl,clamp:rs,euclideanModulo:T6,mapLinear:xX,inverseLerp:EX,lerp:qv,damp:_X,pingpong:SX,smoothstep:wX,smootherstep:CX,randInt:TX,randFloat:bX,randFloatSpread:IX,seededRandom:MX,degToRad:RX,radToDeg:PX,isPowerOfTwo:MM,ceilPowerOfTwo:LX,floorPowerOfTwo:RS,setQuaternionFromProperEuler:BX,normalize:ii,denormalize:qa};class Ue{constructor(e=0,t=0){Ue.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,n=this.y,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6],this.y=r[1]*t+r[4]*n+r[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(rs(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y;return t*t+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const n=Math.cos(t),r=Math.sin(t),s=this.x-e.x,o=this.y-e.y;return this.x=s*n-o*r+e.x,this.y=s*r+o*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Tn{constructor(e,t,n,r,s,o,a,l,c){Tn.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,t,n,r,s,o,a,l,c)}set(e,t,n,r,s,o,a,l,c){const u=this.elements;return u[0]=e,u[1]=r,u[2]=a,u[3]=t,u[4]=s,u[5]=l,u[6]=n,u[7]=o,u[8]=c,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,r=t.elements,s=this.elements,o=n[0],a=n[3],l=n[6],c=n[1],u=n[4],h=n[7],f=n[2],d=n[5],m=n[8],y=r[0],g=r[3],A=r[6],E=r[1],x=r[4],w=r[7],T=r[2],I=r[5],M=r[8];return s[0]=o*y+a*E+l*T,s[3]=o*g+a*x+l*I,s[6]=o*A+a*w+l*M,s[1]=c*y+u*E+h*T,s[4]=c*g+u*x+h*I,s[7]=c*A+u*w+h*M,s[2]=f*y+d*E+m*T,s[5]=f*g+d*x+m*I,s[8]=f*A+d*w+m*M,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8];return t*o*u-t*a*c-n*s*u+n*a*l+r*s*c-r*o*l}invert(){const e=this.elements,t=e[0],n=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],h=u*o-a*c,f=a*l-u*s,d=c*s-o*l,m=t*h+n*f+r*d;if(m===0)return this.set(0,0,0,0,0,0,0,0,0);const y=1/m;return e[0]=h*y,e[1]=(r*c-u*n)*y,e[2]=(a*n-r*o)*y,e[3]=f*y,e[4]=(u*t-r*l)*y,e[5]=(r*s-a*t)*y,e[6]=d*y,e[7]=(n*l-c*t)*y,e[8]=(o*t-n*s)*y,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,r,s,o,a){const l=Math.cos(s),c=Math.sin(s);return this.set(n*l,n*c,-n*(l*o+c*a)+o+e,-r*c,r*l,-r*(-c*o+l*a)+a+t,0,0,1),this}scale(e,t){return this.premultiply(HC.makeScale(e,t)),this}rotate(e){return this.premultiply(HC.makeRotation(-e)),this}translate(e,t){return this.premultiply(HC.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,n,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,n=e.elements;for(let r=0;r<9;r++)if(t[r]!==n[r])return!1;return!0}fromArray(e,t=0){for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const HC=new Tn;function zU(i){for(let e=i.length-1;e>=0;--e)if(i[e]>=65535)return!0;return!1}const DX={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function R1(i,e){return new DX[i](e)}function P2(i){return document.createElementNS("http://www.w3.org/1999/xhtml",i)}function GU(){const i=P2("canvas");return i.style.display="block",i}const lL={};function Jv(i){i in lL||(lL[i]=!0,console.warn(i))}const cL=new Tn().set(.8224621,.177538,0,.0331941,.9668058,0,.0170827,.0723974,.9105199),uL=new Tn().set(1.2249401,-.2249404,0,-.0420569,1.0420571,0,-.0196376,-.0786361,1.0982735),R3={[Dl]:{transfer:b2,primaries:I2,toReference:i=>i,fromReference:i=>i},[gs]:{transfer:mr,primaries:I2,toReference:i=>i.convertSRGBToLinear(),fromReference:i=>i.convertLinearToSRGB()},[sx]:{transfer:b2,primaries:M2,toReference:i=>i.applyMatrix3(uL),fromReference:i=>i.applyMatrix3(cL)},[Cw]:{transfer:mr,primaries:M2,toReference:i=>i.convertSRGBToLinear().applyMatrix3(uL),fromReference:i=>i.applyMatrix3(cL).convertLinearToSRGB()}},kX=new Set([Dl,sx]),Vi={enabled:!0,_workingColorSpace:Dl,get workingColorSpace(){return this._workingColorSpace},set workingColorSpace(i){if(!kX.has(i))throw new Error(`Unsupported working color space, "${i}".`);this._workingColorSpace=i},convert:function(i,e,t){if(this.enabled===!1||e===t||!e||!t)return i;const n=R3[e].toReference,r=R3[t].fromReference;return r(n(i))},fromWorkingColorSpace:function(i,e){return this.convert(i,this._workingColorSpace,e)},toWorkingColorSpace:function(i,e){return this.convert(i,e,this._workingColorSpace)},getPrimaries:function(i){return R3[i].primaries},getTransfer:function(i){return i===Tl?b2:R3[i].transfer}};function G1(i){return i<.04045?i*.0773993808:Math.pow(i*.9478672986+.0521327014,2.4)}function QC(i){return i<.0031308?i*12.92:1.055*Math.pow(i,.41666)-.055}let hg;class b6{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{hg===void 0&&(hg=P2("canvas")),hg.width=e.width,hg.height=e.height;const n=hg.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),t=hg}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const t=P2("canvas");t.width=e.width,t.height=e.height;const n=t.getContext("2d");n.drawImage(e,0,0,e.width,e.height);const r=n.getImageData(0,0,e.width,e.height),s=r.data;for(let o=0;o<s.length;o++)s[o]=G1(s[o]/255)*255;return n.putImageData(r,0,0),t}else if(e.data){const t=e.data.slice(0);for(let n=0;n<t.length;n++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[n]=Math.floor(G1(t[n]/255)*255):t[n]=G1(t[n]);return{data:t,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let FX=0;class Pm{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:FX++}),this.uuid=Pl(),this.data=e,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const n={uuid:this.uuid,url:""},r=this.data;if(r!==null){let s;if(Array.isArray(r)){s=[];for(let o=0,a=r.length;o<a;o++)r[o].isDataTexture?s.push(VC(r[o].image)):s.push(VC(r[o]))}else s=VC(r);n.url=s}return t||(e.images[this.uuid]=n),n}}function VC(i){return typeof HTMLImageElement<"u"&&i instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&i instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&i instanceof ImageBitmap?b6.getDataURL(i):i.data?{data:Array.from(i.data),width:i.width,height:i.height,type:i.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let OX=0,vi=class K_ extends Ch{constructor(e=K_.DEFAULT_IMAGE,t=K_.DEFAULT_MAPPING,n=Wi,r=Wi,s=Ln,o=Bl,a=gi,l=Zi,c=K_.DEFAULT_ANISOTROPY,u=Tl){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:OX++}),this.uuid=Pl(),this.name="",this.source=new Pm(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=n,this.wrapT=r,this.magFilter=s,this.minFilter=o,this.anisotropy=c,this.format=a,this.internalFormat=null,this.type=l,this.offset=new Ue(0,0),this.repeat=new Ue(1,1),this.center=new Ue(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Tn,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,typeof u=="string"?this.colorSpace=u:(Jv("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=u===$d?gs:Tl),this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const n={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(n.userData=this.userData),t||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==np)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case _o:e.x=e.x-Math.floor(e.x);break;case Wi:e.x=e.x<0?0:1;break;case eA:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case _o:e.y=e.y-Math.floor(e.y);break;case Wi:e.y=e.y<0?0:1;break;case eA:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}get encoding(){return Jv("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace===gs?$d:w6}set encoding(e){Jv("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=e===$d?gs:Tl}};vi.DEFAULT_IMAGE=null;vi.DEFAULT_MAPPING=np;vi.DEFAULT_ANISOTROPY=1;class Rn{constructor(e=0,t=0,n=0,r=1){Rn.prototype.isVector4=!0,this.x=e,this.y=t,this.z=n,this.w=r}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,n,r){return this.x=e,this.y=t,this.z=n,this.w=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,n=this.y,r=this.z,s=this.w,o=e.elements;return this.x=o[0]*t+o[4]*n+o[8]*r+o[12]*s,this.y=o[1]*t+o[5]*n+o[9]*r+o[13]*s,this.z=o[2]*t+o[6]*n+o[10]*r+o[14]*s,this.w=o[3]*t+o[7]*n+o[11]*r+o[15]*s,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,n,r,s;const l=e.elements,c=l[0],u=l[4],h=l[8],f=l[1],d=l[5],m=l[9],y=l[2],g=l[6],A=l[10];if(Math.abs(u-f)<.01&&Math.abs(h-y)<.01&&Math.abs(m-g)<.01){if(Math.abs(u+f)<.1&&Math.abs(h+y)<.1&&Math.abs(m+g)<.1&&Math.abs(c+d+A-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const x=(c+1)/2,w=(d+1)/2,T=(A+1)/2,I=(u+f)/4,M=(h+y)/4,L=(m+g)/4;return x>w&&x>T?x<.01?(n=0,r=.707106781,s=.707106781):(n=Math.sqrt(x),r=I/n,s=M/n):w>T?w<.01?(n=.707106781,r=0,s=.707106781):(r=Math.sqrt(w),n=I/r,s=L/r):T<.01?(n=.707106781,r=.707106781,s=0):(s=Math.sqrt(T),n=M/s,r=L/s),this.set(n,r,s,t),this}let E=Math.sqrt((g-m)*(g-m)+(h-y)*(h-y)+(f-u)*(f-u));return Math.abs(E)<.001&&(E=1),this.x=(g-m)/E,this.y=(h-y)/E,this.z=(f-u)/E,this.w=Math.acos((c+d+A-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class HU extends Ch{constructor(e=1,t=1,n={}){super(),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new Rn(0,0,e,t),this.scissorTest=!1,this.viewport=new Rn(0,0,e,t);const r={width:e,height:t,depth:1};n.encoding!==void 0&&(Jv("THREE.WebGLRenderTarget: option.encoding has been replaced by option.colorSpace."),n.colorSpace=n.encoding===$d?gs:Tl),n=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:Ln,depthBuffer:!0,stencilBuffer:!1,depthTexture:null,samples:0},n),this.texture=new vi(r,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=n.generateMipmaps,this.texture.internalFormat=n.internalFormat,this.depthBuffer=n.depthBuffer,this.stencilBuffer=n.stencilBuffer,this.depthTexture=n.depthTexture,this.samples=n.samples}setSize(e,t,n=1){(this.width!==e||this.height!==t||this.depth!==n)&&(this.width=e,this.height=t,this.depth=n,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=n,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.isRenderTargetTexture=!0;const t=Object.assign({},e.texture.image);return this.texture.source=new Pm(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class Si extends HU{constructor(e=1,t=1,n={}){super(e,t,n),this.isWebGLRenderTarget=!0}}class Tw extends vi{constructor(e=null,t=1,n=1,r=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:n,depth:r},this.magFilter=zn,this.minFilter=zn,this.wrapR=Wi,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class NX extends Si{constructor(e=1,t=1,n=1,r={}){super(e,t,r),this.isWebGLArrayRenderTarget=!0,this.depth=n,this.texture=new Tw(null,e,t,n),this.texture.isRenderTargetTexture=!0}}let I6=class extends vi{constructor(e=null,t=1,n=1,r=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:n,depth:r},this.magFilter=zn,this.minFilter=zn,this.wrapR=Wi,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}};class UX extends Si{constructor(e=1,t=1,n=1,r={}){super(e,t,r),this.isWebGL3DRenderTarget=!0,this.depth=n,this.texture=new I6(null,e,t,n),this.texture.isRenderTargetTexture=!0}}class zX extends Si{constructor(e=1,t=1,n=1,r={}){super(e,t,r),this.isWebGLMultipleRenderTargets=!0;const s=this.texture;this.texture=[];for(let o=0;o<n;o++)this.texture[o]=s.clone(),this.texture[o].isRenderTargetTexture=!0}setSize(e,t,n=1){if(this.width!==e||this.height!==t||this.depth!==n){this.width=e,this.height=t,this.depth=n;for(let r=0,s=this.texture.length;r<s;r++)this.texture[r].image.width=e,this.texture[r].image.height=t,this.texture[r].image.depth=n;this.dispose()}this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}copy(e){this.dispose(),this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.texture.length=0;for(let t=0,n=e.texture.length;t<n;t++)this.texture[t]=e.texture[t].clone(),this.texture[t].isRenderTargetTexture=!0;return this}}class Xt{constructor(e=0,t=0,n=0,r=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=n,this._w=r}static slerpFlat(e,t,n,r,s,o,a){let l=n[r+0],c=n[r+1],u=n[r+2],h=n[r+3];const f=s[o+0],d=s[o+1],m=s[o+2],y=s[o+3];if(a===0){e[t+0]=l,e[t+1]=c,e[t+2]=u,e[t+3]=h;return}if(a===1){e[t+0]=f,e[t+1]=d,e[t+2]=m,e[t+3]=y;return}if(h!==y||l!==f||c!==d||u!==m){let g=1-a;const A=l*f+c*d+u*m+h*y,E=A>=0?1:-1,x=1-A*A;if(x>Number.EPSILON){const T=Math.sqrt(x),I=Math.atan2(T,A*E);g=Math.sin(g*I)/T,a=Math.sin(a*I)/T}const w=a*E;if(l=l*g+f*w,c=c*g+d*w,u=u*g+m*w,h=h*g+y*w,g===1-a){const T=1/Math.sqrt(l*l+c*c+u*u+h*h);l*=T,c*=T,u*=T,h*=T}}e[t]=l,e[t+1]=c,e[t+2]=u,e[t+3]=h}static multiplyQuaternionsFlat(e,t,n,r,s,o){const a=n[r],l=n[r+1],c=n[r+2],u=n[r+3],h=s[o],f=s[o+1],d=s[o+2],m=s[o+3];return e[t]=a*m+u*h+l*d-c*f,e[t+1]=l*m+u*f+c*h-a*d,e[t+2]=c*m+u*d+a*f-l*h,e[t+3]=u*m-a*h-l*f-c*d,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,n,r){return this._x=e,this._y=t,this._z=n,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t=!0){const n=e._x,r=e._y,s=e._z,o=e._order,a=Math.cos,l=Math.sin,c=a(n/2),u=a(r/2),h=a(s/2),f=l(n/2),d=l(r/2),m=l(s/2);switch(o){case"XYZ":this._x=f*u*h+c*d*m,this._y=c*d*h-f*u*m,this._z=c*u*m+f*d*h,this._w=c*u*h-f*d*m;break;case"YXZ":this._x=f*u*h+c*d*m,this._y=c*d*h-f*u*m,this._z=c*u*m-f*d*h,this._w=c*u*h+f*d*m;break;case"ZXY":this._x=f*u*h-c*d*m,this._y=c*d*h+f*u*m,this._z=c*u*m+f*d*h,this._w=c*u*h-f*d*m;break;case"ZYX":this._x=f*u*h-c*d*m,this._y=c*d*h+f*u*m,this._z=c*u*m-f*d*h,this._w=c*u*h+f*d*m;break;case"YZX":this._x=f*u*h+c*d*m,this._y=c*d*h+f*u*m,this._z=c*u*m-f*d*h,this._w=c*u*h-f*d*m;break;case"XZY":this._x=f*u*h-c*d*m,this._y=c*d*h-f*u*m,this._z=c*u*m+f*d*h,this._w=c*u*h+f*d*m;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return t===!0&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const n=t/2,r=Math.sin(n);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,n=t[0],r=t[4],s=t[8],o=t[1],a=t[5],l=t[9],c=t[2],u=t[6],h=t[10],f=n+a+h;if(f>0){const d=.5/Math.sqrt(f+1);this._w=.25/d,this._x=(u-l)*d,this._y=(s-c)*d,this._z=(o-r)*d}else if(n>a&&n>h){const d=2*Math.sqrt(1+n-a-h);this._w=(u-l)/d,this._x=.25*d,this._y=(r+o)/d,this._z=(s+c)/d}else if(a>h){const d=2*Math.sqrt(1+a-n-h);this._w=(s-c)/d,this._x=(r+o)/d,this._y=.25*d,this._z=(l+u)/d}else{const d=2*Math.sqrt(1+h-n-a);this._w=(o-r)/d,this._x=(s+c)/d,this._y=(l+u)/d,this._z=.25*d}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let n=e.dot(t)+1;return n<Number.EPSILON?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(rs(this.dot(e),-1,1)))}rotateTowards(e,t){const n=this.angleTo(e);if(n===0)return this;const r=Math.min(1,t/n);return this.slerp(e,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const n=e._x,r=e._y,s=e._z,o=e._w,a=t._x,l=t._y,c=t._z,u=t._w;return this._x=n*u+o*a+r*c-s*l,this._y=r*u+o*l+s*a-n*c,this._z=s*u+o*c+n*l-r*a,this._w=o*u-n*a-r*l-s*c,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);const n=this._x,r=this._y,s=this._z,o=this._w;let a=o*e._w+n*e._x+r*e._y+s*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=o,this._x=n,this._y=r,this._z=s,this;const l=1-a*a;if(l<=Number.EPSILON){const d=1-t;return this._w=d*o+t*this._w,this._x=d*n+t*this._x,this._y=d*r+t*this._y,this._z=d*s+t*this._z,this.normalize(),this}const c=Math.sqrt(l),u=Math.atan2(c,a),h=Math.sin((1-t)*u)/c,f=Math.sin(t*u)/c;return this._w=o*h+this._w*f,this._x=n*h+this._x*f,this._y=r*h+this._y*f,this._z=s*h+this._z*f,this._onChangeCallback(),this}slerpQuaternions(e,t,n){return this.copy(e).slerp(t,n)}random(){const e=Math.random(),t=Math.sqrt(1-e),n=Math.sqrt(e),r=2*Math.PI*Math.random(),s=2*Math.PI*Math.random();return this.set(t*Math.cos(r),n*Math.sin(s),n*Math.cos(s),t*Math.sin(r))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class Q{constructor(e=0,t=0,n=0){Q.prototype.isVector3=!0,this.x=e,this.y=t,this.z=n}set(e,t,n){return n===void 0&&(n=this.z),this.x=e,this.y=t,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(hL.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(hL.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,n=this.y,r=this.z,s=e.elements;return this.x=s[0]*t+s[3]*n+s[6]*r,this.y=s[1]*t+s[4]*n+s[7]*r,this.z=s[2]*t+s[5]*n+s[8]*r,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,n=this.y,r=this.z,s=e.elements,o=1/(s[3]*t+s[7]*n+s[11]*r+s[15]);return this.x=(s[0]*t+s[4]*n+s[8]*r+s[12])*o,this.y=(s[1]*t+s[5]*n+s[9]*r+s[13])*o,this.z=(s[2]*t+s[6]*n+s[10]*r+s[14])*o,this}applyQuaternion(e){const t=this.x,n=this.y,r=this.z,s=e.x,o=e.y,a=e.z,l=e.w,c=2*(o*r-a*n),u=2*(a*t-s*r),h=2*(s*n-o*t);return this.x=t+l*c+o*h-a*u,this.y=n+l*u+a*c-s*h,this.z=r+l*h+s*u-o*c,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,n=this.y,r=this.z,s=e.elements;return this.x=s[0]*t+s[4]*n+s[8]*r,this.y=s[1]*t+s[5]*n+s[9]*r,this.z=s[2]*t+s[6]*n+s[10]*r,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const n=e.x,r=e.y,s=e.z,o=t.x,a=t.y,l=t.z;return this.x=r*l-s*a,this.y=s*o-n*l,this.z=n*a-r*o,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return jC.copy(this).projectOnVector(e),this.sub(jC)}reflect(e){return this.sub(jC.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(rs(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y,r=this.z-e.z;return t*t+n*n+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,n){const r=Math.sin(t)*e;return this.x=r*Math.sin(n),this.y=Math.cos(t)*e,this.z=r*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=r,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=(Math.random()-.5)*2,t=Math.random()*Math.PI*2,n=Math.sqrt(1-e**2);return this.x=n*Math.cos(t),this.y=n*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const jC=new Q,hL=new Xt;class ti{constructor(e=new Q(1/0,1/0,1/0),t=new Q(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t+=3)this.expandByPoint(Jc.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,n=e.count;t<n;t++)this.expandByPoint(Jc.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=Jc.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const n=e.geometry;if(n!==void 0){const s=n.getAttribute("position");if(t===!0&&s!==void 0&&e.isInstancedMesh!==!0)for(let o=0,a=s.count;o<a;o++)e.isMesh===!0?e.getVertexPosition(o,Jc):Jc.fromBufferAttribute(s,o),Jc.applyMatrix4(e.matrixWorld),this.expandByPoint(Jc);else e.boundingBox!==void 0?(e.boundingBox===null&&e.computeBoundingBox(),P3.copy(e.boundingBox)):(n.boundingBox===null&&n.computeBoundingBox(),P3.copy(n.boundingBox)),P3.applyMatrix4(e.matrixWorld),this.union(P3)}const r=e.children;for(let s=0,o=r.length;s<o;s++)this.expandByObject(r[s],t);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,Jc),Jc.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(By),L3.subVectors(this.max,By),fg.subVectors(e.a,By),dg.subVectors(e.b,By),pg.subVectors(e.c,By),vd.subVectors(dg,fg),xd.subVectors(pg,dg),nm.subVectors(fg,pg);let t=[0,-vd.z,vd.y,0,-xd.z,xd.y,0,-nm.z,nm.y,vd.z,0,-vd.x,xd.z,0,-xd.x,nm.z,0,-nm.x,-vd.y,vd.x,0,-xd.y,xd.x,0,-nm.y,nm.x,0];return!WC(t,fg,dg,pg,L3)||(t=[1,0,0,0,1,0,0,0,1],!WC(t,fg,dg,pg,L3))?!1:(B3.crossVectors(vd,xd),t=[B3.x,B3.y,B3.z],WC(t,fg,dg,pg,L3))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,Jc).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=this.getSize(Jc).length()*.5),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(rf[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),rf[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),rf[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),rf[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),rf[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),rf[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),rf[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),rf[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(rf),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const rf=[new Q,new Q,new Q,new Q,new Q,new Q,new Q,new Q],Jc=new Q,P3=new ti,fg=new Q,dg=new Q,pg=new Q,vd=new Q,xd=new Q,nm=new Q,By=new Q,L3=new Q,B3=new Q,im=new Q;function WC(i,e,t,n,r){for(let s=0,o=i.length-3;s<=o;s+=3){im.fromArray(i,s);const a=r.x*Math.abs(im.x)+r.y*Math.abs(im.y)+r.z*Math.abs(im.z),l=e.dot(im),c=t.dot(im),u=n.dot(im);if(Math.max(-Math.max(l,c,u),Math.min(l,c,u))>a)return!1}return!0}const GX=new ti,Dy=new Q,KC=new Q;let Bi=class{constructor(e=new Q,t=-1){this.isSphere=!0,this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const n=this.center;t!==void 0?n.copy(t):GX.setFromPoints(e).getCenter(n);let r=0;for(let s=0,o=e.length;s<o;s++)r=Math.max(r,n.distanceToSquared(e[s]));return this.radius=Math.sqrt(r),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const n=this.center.distanceToSquared(e);return t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;Dy.subVectors(e,this.center);const t=Dy.lengthSq();if(t>this.radius*this.radius){const n=Math.sqrt(t),r=(n-this.radius)*.5;this.center.addScaledVector(Dy,r/n),this.radius+=r}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(KC.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(Dy.copy(e.center).add(KC)),this.expandByPoint(Dy.copy(e.center).sub(KC))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}};const sf=new Q,YC=new Q,D3=new Q,Ed=new Q,$C=new Q,k3=new Q,XC=new Q;class vc{constructor(e=new Q,t=new Q(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,sf)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,n)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=sf.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(sf.copy(this.origin).addScaledVector(this.direction,t),sf.distanceToSquared(e))}distanceSqToSegment(e,t,n,r){YC.copy(e).add(t).multiplyScalar(.5),D3.copy(t).sub(e).normalize(),Ed.copy(this.origin).sub(YC);const s=e.distanceTo(t)*.5,o=-this.direction.dot(D3),a=Ed.dot(this.direction),l=-Ed.dot(D3),c=Ed.lengthSq(),u=Math.abs(1-o*o);let h,f,d,m;if(u>0)if(h=o*l-a,f=o*a-l,m=s*u,h>=0)if(f>=-m)if(f<=m){const y=1/u;h*=y,f*=y,d=h*(h+o*f+2*a)+f*(o*h+f+2*l)+c}else f=s,h=Math.max(0,-(o*f+a)),d=-h*h+f*(f+2*l)+c;else f=-s,h=Math.max(0,-(o*f+a)),d=-h*h+f*(f+2*l)+c;else f<=-m?(h=Math.max(0,-(-o*s+a)),f=h>0?-s:Math.min(Math.max(-s,-l),s),d=-h*h+f*(f+2*l)+c):f<=m?(h=0,f=Math.min(Math.max(-s,-l),s),d=f*(f+2*l)+c):(h=Math.max(0,-(o*s+a)),f=h>0?s:Math.min(Math.max(-s,-l),s),d=-h*h+f*(f+2*l)+c);else f=o>0?-s:s,h=Math.max(0,-(o*f+a)),d=-h*h+f*(f+2*l)+c;return n&&n.copy(this.origin).addScaledVector(this.direction,h),r&&r.copy(YC).addScaledVector(D3,f),d}intersectSphere(e,t){sf.subVectors(e.center,this.origin);const n=sf.dot(this.direction),r=sf.dot(sf)-n*n,s=e.radius*e.radius;if(r>s)return null;const o=Math.sqrt(s-r),a=n-o,l=n+o;return l<0?null:a<0?this.at(l,t):this.at(a,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;const n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}intersectPlane(e,t){const n=this.distanceToPlane(e);return n===null?null:this.at(n,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let n,r,s,o,a,l;const c=1/this.direction.x,u=1/this.direction.y,h=1/this.direction.z,f=this.origin;return c>=0?(n=(e.min.x-f.x)*c,r=(e.max.x-f.x)*c):(n=(e.max.x-f.x)*c,r=(e.min.x-f.x)*c),u>=0?(s=(e.min.y-f.y)*u,o=(e.max.y-f.y)*u):(s=(e.max.y-f.y)*u,o=(e.min.y-f.y)*u),n>o||s>r||((s>n||isNaN(n))&&(n=s),(o<r||isNaN(r))&&(r=o),h>=0?(a=(e.min.z-f.z)*h,l=(e.max.z-f.z)*h):(a=(e.max.z-f.z)*h,l=(e.min.z-f.z)*h),n>l||a>r)||((a>n||n!==n)&&(n=a),(l<r||r!==r)&&(r=l),r<0)?null:this.at(n>=0?n:r,t)}intersectsBox(e){return this.intersectBox(e,sf)!==null}intersectTriangle(e,t,n,r,s){$C.subVectors(t,e),k3.subVectors(n,e),XC.crossVectors($C,k3);let o=this.direction.dot(XC),a;if(o>0){if(r)return null;a=1}else if(o<0)a=-1,o=-o;else return null;Ed.subVectors(this.origin,e);const l=a*this.direction.dot(k3.crossVectors(Ed,k3));if(l<0)return null;const c=a*this.direction.dot($C.cross(Ed));if(c<0||l+c>o)return null;const u=-a*Ed.dot(XC);return u<0?null:this.at(u/o,s)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class Xe{constructor(e,t,n,r,s,o,a,l,c,u,h,f,d,m,y,g){Xe.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,t,n,r,s,o,a,l,c,u,h,f,d,m,y,g)}set(e,t,n,r,s,o,a,l,c,u,h,f,d,m,y,g){const A=this.elements;return A[0]=e,A[4]=t,A[8]=n,A[12]=r,A[1]=s,A[5]=o,A[9]=a,A[13]=l,A[2]=c,A[6]=u,A[10]=h,A[14]=f,A[3]=d,A[7]=m,A[11]=y,A[15]=g,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new Xe().fromArray(this.elements)}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}copyPosition(e){const t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,n=e.elements,r=1/mg.setFromMatrixColumn(e,0).length(),s=1/mg.setFromMatrixColumn(e,1).length(),o=1/mg.setFromMatrixColumn(e,2).length();return t[0]=n[0]*r,t[1]=n[1]*r,t[2]=n[2]*r,t[3]=0,t[4]=n[4]*s,t[5]=n[5]*s,t[6]=n[6]*s,t[7]=0,t[8]=n[8]*o,t[9]=n[9]*o,t[10]=n[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,n=e.x,r=e.y,s=e.z,o=Math.cos(n),a=Math.sin(n),l=Math.cos(r),c=Math.sin(r),u=Math.cos(s),h=Math.sin(s);if(e.order==="XYZ"){const f=o*u,d=o*h,m=a*u,y=a*h;t[0]=l*u,t[4]=-l*h,t[8]=c,t[1]=d+m*c,t[5]=f-y*c,t[9]=-a*l,t[2]=y-f*c,t[6]=m+d*c,t[10]=o*l}else if(e.order==="YXZ"){const f=l*u,d=l*h,m=c*u,y=c*h;t[0]=f+y*a,t[4]=m*a-d,t[8]=o*c,t[1]=o*h,t[5]=o*u,t[9]=-a,t[2]=d*a-m,t[6]=y+f*a,t[10]=o*l}else if(e.order==="ZXY"){const f=l*u,d=l*h,m=c*u,y=c*h;t[0]=f-y*a,t[4]=-o*h,t[8]=m+d*a,t[1]=d+m*a,t[5]=o*u,t[9]=y-f*a,t[2]=-o*c,t[6]=a,t[10]=o*l}else if(e.order==="ZYX"){const f=o*u,d=o*h,m=a*u,y=a*h;t[0]=l*u,t[4]=m*c-d,t[8]=f*c+y,t[1]=l*h,t[5]=y*c+f,t[9]=d*c-m,t[2]=-c,t[6]=a*l,t[10]=o*l}else if(e.order==="YZX"){const f=o*l,d=o*c,m=a*l,y=a*c;t[0]=l*u,t[4]=y-f*h,t[8]=m*h+d,t[1]=h,t[5]=o*u,t[9]=-a*u,t[2]=-c*u,t[6]=d*h+m,t[10]=f-y*h}else if(e.order==="XZY"){const f=o*l,d=o*c,m=a*l,y=a*c;t[0]=l*u,t[4]=-h,t[8]=c*u,t[1]=f*h+y,t[5]=o*u,t[9]=d*h-m,t[2]=m*h-d,t[6]=a*u,t[10]=y*h+f}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(HX,e,QX)}lookAt(e,t,n){const r=this.elements;return yl.subVectors(e,t),yl.lengthSq()===0&&(yl.z=1),yl.normalize(),_d.crossVectors(n,yl),_d.lengthSq()===0&&(Math.abs(n.z)===1?yl.x+=1e-4:yl.z+=1e-4,yl.normalize(),_d.crossVectors(n,yl)),_d.normalize(),F3.crossVectors(yl,_d),r[0]=_d.x,r[4]=F3.x,r[8]=yl.x,r[1]=_d.y,r[5]=F3.y,r[9]=yl.y,r[2]=_d.z,r[6]=F3.z,r[10]=yl.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,r=t.elements,s=this.elements,o=n[0],a=n[4],l=n[8],c=n[12],u=n[1],h=n[5],f=n[9],d=n[13],m=n[2],y=n[6],g=n[10],A=n[14],E=n[3],x=n[7],w=n[11],T=n[15],I=r[0],M=r[4],L=r[8],P=r[12],R=r[1],U=r[5],k=r[9],H=r[13],G=r[2],X=r[6],Z=r[10],oe=r[14],K=r[3],V=r[7],W=r[11],F=r[15];return s[0]=o*I+a*R+l*G+c*K,s[4]=o*M+a*U+l*X+c*V,s[8]=o*L+a*k+l*Z+c*W,s[12]=o*P+a*H+l*oe+c*F,s[1]=u*I+h*R+f*G+d*K,s[5]=u*M+h*U+f*X+d*V,s[9]=u*L+h*k+f*Z+d*W,s[13]=u*P+h*H+f*oe+d*F,s[2]=m*I+y*R+g*G+A*K,s[6]=m*M+y*U+g*X+A*V,s[10]=m*L+y*k+g*Z+A*W,s[14]=m*P+y*H+g*oe+A*F,s[3]=E*I+x*R+w*G+T*K,s[7]=E*M+x*U+w*X+T*V,s[11]=E*L+x*k+w*Z+T*W,s[15]=E*P+x*H+w*oe+T*F,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[4],r=e[8],s=e[12],o=e[1],a=e[5],l=e[9],c=e[13],u=e[2],h=e[6],f=e[10],d=e[14],m=e[3],y=e[7],g=e[11],A=e[15];return m*(+s*l*h-r*c*h-s*a*f+n*c*f+r*a*d-n*l*d)+y*(+t*l*d-t*c*f+s*o*f-r*o*d+r*c*u-s*l*u)+g*(+t*c*h-t*a*d-s*o*h+n*o*d+s*a*u-n*c*u)+A*(-r*a*u-t*l*h+t*a*f+r*o*h-n*o*f+n*l*u)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,n){const r=this.elements;return e.isVector3?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=t,r[14]=n),this}invert(){const e=this.elements,t=e[0],n=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],h=e[9],f=e[10],d=e[11],m=e[12],y=e[13],g=e[14],A=e[15],E=h*g*c-y*f*c+y*l*d-a*g*d-h*l*A+a*f*A,x=m*f*c-u*g*c-m*l*d+o*g*d+u*l*A-o*f*A,w=u*y*c-m*h*c+m*a*d-o*y*d-u*a*A+o*h*A,T=m*h*l-u*y*l-m*a*f+o*y*f+u*a*g-o*h*g,I=t*E+n*x+r*w+s*T;if(I===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const M=1/I;return e[0]=E*M,e[1]=(y*f*s-h*g*s-y*r*d+n*g*d+h*r*A-n*f*A)*M,e[2]=(a*g*s-y*l*s+y*r*c-n*g*c-a*r*A+n*l*A)*M,e[3]=(h*l*s-a*f*s-h*r*c+n*f*c+a*r*d-n*l*d)*M,e[4]=x*M,e[5]=(u*g*s-m*f*s+m*r*d-t*g*d-u*r*A+t*f*A)*M,e[6]=(m*l*s-o*g*s-m*r*c+t*g*c+o*r*A-t*l*A)*M,e[7]=(o*f*s-u*l*s+u*r*c-t*f*c-o*r*d+t*l*d)*M,e[8]=w*M,e[9]=(m*h*s-u*y*s-m*n*d+t*y*d+u*n*A-t*h*A)*M,e[10]=(o*y*s-m*a*s+m*n*c-t*y*c-o*n*A+t*a*A)*M,e[11]=(u*a*s-o*h*s-u*n*c+t*h*c+o*n*d-t*a*d)*M,e[12]=T*M,e[13]=(u*y*r-m*h*r+m*n*f-t*y*f-u*n*g+t*h*g)*M,e[14]=(m*a*r-o*y*r-m*n*l+t*y*l+o*n*g-t*a*g)*M,e[15]=(o*h*r-u*a*r+u*n*l-t*h*l-o*n*f+t*a*f)*M,this}scale(e){const t=this.elements,n=e.x,r=e.y,s=e.z;return t[0]*=n,t[4]*=r,t[8]*=s,t[1]*=n,t[5]*=r,t[9]*=s,t[2]*=n,t[6]*=r,t[10]*=s,t[3]*=n,t[7]*=r,t[11]*=s,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,r))}makeTranslation(e,t,n){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const n=Math.cos(t),r=Math.sin(t),s=1-n,o=e.x,a=e.y,l=e.z,c=s*o,u=s*a;return this.set(c*o+n,c*a-r*l,c*l+r*a,0,c*a+r*l,u*a+n,u*l-r*o,0,c*l-r*a,u*l+r*o,s*l*l+n,0,0,0,0,1),this}makeScale(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,t,n,r,s,o){return this.set(1,n,s,0,e,1,o,0,t,r,1,0,0,0,0,1),this}compose(e,t,n){const r=this.elements,s=t._x,o=t._y,a=t._z,l=t._w,c=s+s,u=o+o,h=a+a,f=s*c,d=s*u,m=s*h,y=o*u,g=o*h,A=a*h,E=l*c,x=l*u,w=l*h,T=n.x,I=n.y,M=n.z;return r[0]=(1-(y+A))*T,r[1]=(d+w)*T,r[2]=(m-x)*T,r[3]=0,r[4]=(d-w)*I,r[5]=(1-(f+A))*I,r[6]=(g+E)*I,r[7]=0,r[8]=(m+x)*M,r[9]=(g-E)*M,r[10]=(1-(f+y))*M,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this}decompose(e,t,n){const r=this.elements;let s=mg.set(r[0],r[1],r[2]).length();const o=mg.set(r[4],r[5],r[6]).length(),a=mg.set(r[8],r[9],r[10]).length();this.determinant()<0&&(s=-s),e.x=r[12],e.y=r[13],e.z=r[14],Zc.copy(this);const c=1/s,u=1/o,h=1/a;return Zc.elements[0]*=c,Zc.elements[1]*=c,Zc.elements[2]*=c,Zc.elements[4]*=u,Zc.elements[5]*=u,Zc.elements[6]*=u,Zc.elements[8]*=h,Zc.elements[9]*=h,Zc.elements[10]*=h,t.setFromRotationMatrix(Zc),n.x=s,n.y=o,n.z=a,this}makePerspective(e,t,n,r,s,o,a=mu){const l=this.elements,c=2*s/(t-e),u=2*s/(n-r),h=(t+e)/(t-e),f=(n+r)/(n-r);let d,m;if(a===mu)d=-(o+s)/(o-s),m=-2*o*s/(o-s);else if(a===nA)d=-o/(o-s),m=-o*s/(o-s);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+a);return l[0]=c,l[4]=0,l[8]=h,l[12]=0,l[1]=0,l[5]=u,l[9]=f,l[13]=0,l[2]=0,l[6]=0,l[10]=d,l[14]=m,l[3]=0,l[7]=0,l[11]=-1,l[15]=0,this}makeOrthographic(e,t,n,r,s,o,a=mu){const l=this.elements,c=1/(t-e),u=1/(n-r),h=1/(o-s),f=(t+e)*c,d=(n+r)*u;let m,y;if(a===mu)m=(o+s)*h,y=-2*h;else if(a===nA)m=s*h,y=-1*h;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+a);return l[0]=2*c,l[4]=0,l[8]=0,l[12]=-f,l[1]=0,l[5]=2*u,l[9]=0,l[13]=-d,l[2]=0,l[6]=0,l[10]=y,l[14]=-m,l[3]=0,l[7]=0,l[11]=0,l[15]=1,this}equals(e){const t=this.elements,n=e.elements;for(let r=0;r<16;r++)if(t[r]!==n[r])return!1;return!0}fromArray(e,t=0){for(let n=0;n<16;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}const mg=new Q,Zc=new Xe,HX=new Q(0,0,0),QX=new Q(1,1,1),_d=new Q,F3=new Q,yl=new Q,fL=new Xe,dL=new Xt;class Eo{constructor(e=0,t=0,n=0,r=Eo.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=n,this._order=r}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,n,r=this._order){return this._x=e,this._y=t,this._z=n,this._order=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,n=!0){const r=e.elements,s=r[0],o=r[4],a=r[8],l=r[1],c=r[5],u=r[9],h=r[2],f=r[6],d=r[10];switch(t){case"XYZ":this._y=Math.asin(rs(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-u,d),this._z=Math.atan2(-o,s)):(this._x=Math.atan2(f,c),this._z=0);break;case"YXZ":this._x=Math.asin(-rs(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(a,d),this._z=Math.atan2(l,c)):(this._y=Math.atan2(-h,s),this._z=0);break;case"ZXY":this._x=Math.asin(rs(f,-1,1)),Math.abs(f)<.9999999?(this._y=Math.atan2(-h,d),this._z=Math.atan2(-o,c)):(this._y=0,this._z=Math.atan2(l,s));break;case"ZYX":this._y=Math.asin(-rs(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(f,d),this._z=Math.atan2(l,s)):(this._x=0,this._z=Math.atan2(-o,c));break;case"YZX":this._z=Math.asin(rs(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-u,c),this._y=Math.atan2(-h,s)):(this._x=0,this._y=Math.atan2(a,d));break;case"XZY":this._z=Math.asin(-rs(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(f,c),this._y=Math.atan2(a,s)):(this._x=Math.atan2(-u,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,n===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,n){return fL.makeRotationFromQuaternion(e),this.setFromRotationMatrix(fL,t,n)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return dL.setFromEuler(this),this.setFromQuaternion(dL,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}Eo.DEFAULT_ORDER="XYZ";class Gm{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}let VX=0;const pL=new Q,gg=new Xt,of=new Xe,O3=new Q,ky=new Q,jX=new Q,WX=new Xt,mL=new Q(1,0,0),gL=new Q(0,1,0),AL=new Q(0,0,1),KX={type:"added"},YX={type:"removed"};class _n extends Ch{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:VX++}),this.uuid=Pl(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=_n.DEFAULT_UP.clone();const e=new Q,t=new Eo,n=new Xt,r=new Q(1,1,1);function s(){n.setFromEuler(t,!1)}function o(){t.setFromQuaternion(n,void 0,!1)}t._onChange(s),n._onChange(o),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new Xe},normalMatrix:{value:new Tn}}),this.matrix=new Xe,this.matrixWorld=new Xe,this.matrixAutoUpdate=_n.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=_n.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new Gm,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return gg.setFromAxisAngle(e,t),this.quaternion.multiply(gg),this}rotateOnWorldAxis(e,t){return gg.setFromAxisAngle(e,t),this.quaternion.premultiply(gg),this}rotateX(e){return this.rotateOnAxis(mL,e)}rotateY(e){return this.rotateOnAxis(gL,e)}rotateZ(e){return this.rotateOnAxis(AL,e)}translateOnAxis(e,t){return pL.copy(e).applyQuaternion(this.quaternion),this.position.add(pL.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(mL,e)}translateY(e){return this.translateOnAxis(gL,e)}translateZ(e){return this.translateOnAxis(AL,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(of.copy(this.matrixWorld).invert())}lookAt(e,t,n){e.isVector3?O3.copy(e):O3.set(e,t,n);const r=this.parent;this.updateWorldMatrix(!0,!1),ky.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?of.lookAt(ky,O3,this.up):of.lookAt(O3,ky,this.up),this.quaternion.setFromRotationMatrix(of),r&&(of.extractRotation(r.matrixWorld),gg.setFromRotationMatrix(of),this.quaternion.premultiply(gg.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.parent!==null&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(KX)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let n=0;n<arguments.length;n++)this.remove(arguments[n]);return this}const t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(YX)),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),of.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),of.multiply(e.parent.matrixWorld)),e.applyMatrix4(of),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let n=0,r=this.children.length;n<r;n++){const o=this.children[n].getObjectByProperty(e,t);if(o!==void 0)return o}}getObjectsByProperty(e,t,n=[]){this[e]===t&&n.push(this);const r=this.children;for(let s=0,o=r.length;s<o;s++)r[s].getObjectsByProperty(e,t,n);return n}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(ky,e,jX),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(ky,WX,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let n=0,r=t.length;n<r;n++)t[n].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const t=this.children;for(let n=0,r=t.length;n<r;n++)t[n].traverseVisible(e)}traverseAncestors(e){const t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let n=0,r=t.length;n<r;n++){const s=t[n];(s.matrixWorldAutoUpdate===!0||e===!0)&&s.updateMatrixWorld(e)}}updateWorldMatrix(e,t){const n=this.parent;if(e===!0&&n!==null&&n.matrixWorldAutoUpdate===!0&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),t===!0){const r=this.children;for(let s=0,o=r.length;s<o;s++){const a=r[s];a.matrixWorldAutoUpdate===!0&&a.updateWorldMatrix(!1,!0)}}}toJSON(e){const t=e===void 0||typeof e=="string",n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const r={};r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),this.castShadow===!0&&(r.castShadow=!0),this.receiveShadow===!0&&(r.receiveShadow=!0),this.visible===!1&&(r.visible=!1),this.frustumCulled===!1&&(r.frustumCulled=!1),this.renderOrder!==0&&(r.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),r.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(r.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(r.type="BatchedMesh",r.perObjectFrustumCulled=this.perObjectFrustumCulled,r.sortObjects=this.sortObjects,r.drawRanges=this._drawRanges,r.reservedRanges=this._reservedRanges,r.visibility=this._visibility,r.active=this._active,r.bounds=this._bounds.map(a=>({boxInitialized:a.boxInitialized,boxMin:a.box.min.toArray(),boxMax:a.box.max.toArray(),sphereInitialized:a.sphereInitialized,sphereRadius:a.sphere.radius,sphereCenter:a.sphere.center.toArray()})),r.maxGeometryCount=this._maxGeometryCount,r.maxVertexCount=this._maxVertexCount,r.maxIndexCount=this._maxIndexCount,r.geometryInitialized=this._geometryInitialized,r.geometryCount=this._geometryCount,r.matricesTexture=this._matricesTexture.toJSON(e),this.boundingSphere!==null&&(r.boundingSphere={center:r.boundingSphere.center.toArray(),radius:r.boundingSphere.radius}),this.boundingBox!==null&&(r.boundingBox={min:r.boundingBox.min.toArray(),max:r.boundingBox.max.toArray()}));function s(a,l){return a[l.uuid]===void 0&&(a[l.uuid]=l.toJSON(e)),l.uuid}if(this.isScene)this.background&&(this.background.isColor?r.background=this.background.toJSON():this.background.isTexture&&(r.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(r.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){r.geometry=s(e.geometries,this.geometry);const a=this.geometry.parameters;if(a!==void 0&&a.shapes!==void 0){const l=a.shapes;if(Array.isArray(l))for(let c=0,u=l.length;c<u;c++){const h=l[c];s(e.shapes,h)}else s(e.shapes,l)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(s(e.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const a=[];for(let l=0,c=this.material.length;l<c;l++)a.push(s(e.materials,this.material[l]));r.material=a}else r.material=s(e.materials,this.material);if(this.children.length>0){r.children=[];for(let a=0;a<this.children.length;a++)r.children.push(this.children[a].toJSON(e).object)}if(this.animations.length>0){r.animations=[];for(let a=0;a<this.animations.length;a++){const l=this.animations[a];r.animations.push(s(e.animations,l))}}if(t){const a=o(e.geometries),l=o(e.materials),c=o(e.textures),u=o(e.images),h=o(e.shapes),f=o(e.skeletons),d=o(e.animations),m=o(e.nodes);a.length>0&&(n.geometries=a),l.length>0&&(n.materials=l),c.length>0&&(n.textures=c),u.length>0&&(n.images=u),h.length>0&&(n.shapes=h),f.length>0&&(n.skeletons=f),d.length>0&&(n.animations=d),m.length>0&&(n.nodes=m)}return n.object=r,n;function o(a){const l=[];for(const c in a){const u=a[c];delete u.metadata,l.push(u)}return l}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let n=0;n<e.children.length;n++){const r=e.children[n];this.add(r.clone())}return this}}_n.DEFAULT_UP=new Q(0,1,0);_n.DEFAULT_MATRIX_AUTO_UPDATE=!0;_n.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const eu=new Q,af=new Q,qC=new Q,lf=new Q,Ag=new Q,yg=new Q,yL=new Q,JC=new Q,ZC=new Q,eT=new Q;let N3=!1;class ks{constructor(e=new Q,t=new Q,n=new Q){this.a=e,this.b=t,this.c=n}static getNormal(e,t,n,r){r.subVectors(n,t),eu.subVectors(e,t),r.cross(eu);const s=r.lengthSq();return s>0?r.multiplyScalar(1/Math.sqrt(s)):r.set(0,0,0)}static getBarycoord(e,t,n,r,s){eu.subVectors(r,t),af.subVectors(n,t),qC.subVectors(e,t);const o=eu.dot(eu),a=eu.dot(af),l=eu.dot(qC),c=af.dot(af),u=af.dot(qC),h=o*c-a*a;if(h===0)return s.set(0,0,0),null;const f=1/h,d=(c*l-a*u)*f,m=(o*u-a*l)*f;return s.set(1-d-m,m,d)}static containsPoint(e,t,n,r){return this.getBarycoord(e,t,n,r,lf)===null?!1:lf.x>=0&&lf.y>=0&&lf.x+lf.y<=1}static getUV(e,t,n,r,s,o,a,l){return N3===!1&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),N3=!0),this.getInterpolation(e,t,n,r,s,o,a,l)}static getInterpolation(e,t,n,r,s,o,a,l){return this.getBarycoord(e,t,n,r,lf)===null?(l.x=0,l.y=0,"z"in l&&(l.z=0),"w"in l&&(l.w=0),null):(l.setScalar(0),l.addScaledVector(s,lf.x),l.addScaledVector(o,lf.y),l.addScaledVector(a,lf.z),l)}static isFrontFacing(e,t,n,r){return eu.subVectors(n,t),af.subVectors(e,t),eu.cross(af).dot(r)<0}set(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}setFromPointsAndIndices(e,t,n,r){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[r]),this}setFromAttributeAndIndices(e,t,n,r){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,n),this.c.fromBufferAttribute(e,r),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return eu.subVectors(this.c,this.b),af.subVectors(this.a,this.b),eu.cross(af).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return ks.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return ks.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,n,r,s){return N3===!1&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),N3=!0),ks.getInterpolation(e,this.a,this.b,this.c,t,n,r,s)}getInterpolation(e,t,n,r,s){return ks.getInterpolation(e,this.a,this.b,this.c,t,n,r,s)}containsPoint(e){return ks.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return ks.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const n=this.a,r=this.b,s=this.c;let o,a;Ag.subVectors(r,n),yg.subVectors(s,n),JC.subVectors(e,n);const l=Ag.dot(JC),c=yg.dot(JC);if(l<=0&&c<=0)return t.copy(n);ZC.subVectors(e,r);const u=Ag.dot(ZC),h=yg.dot(ZC);if(u>=0&&h<=u)return t.copy(r);const f=l*h-u*c;if(f<=0&&l>=0&&u<=0)return o=l/(l-u),t.copy(n).addScaledVector(Ag,o);eT.subVectors(e,s);const d=Ag.dot(eT),m=yg.dot(eT);if(m>=0&&d<=m)return t.copy(s);const y=d*c-l*m;if(y<=0&&c>=0&&m<=0)return a=c/(c-m),t.copy(n).addScaledVector(yg,a);const g=u*m-d*h;if(g<=0&&h-u>=0&&d-m>=0)return yL.subVectors(s,r),a=(h-u)/(h-u+(d-m)),t.copy(r).addScaledVector(yL,a);const A=1/(g+y+f);return o=y*A,a=f*A,t.copy(n).addScaledVector(Ag,o).addScaledVector(yg,a)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const QU={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Sd={h:0,s:0,l:0},U3={h:0,s:0,l:0};function tT(i,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?i+(e-i)*6*t:t<1/2?e:t<2/3?i+(e-i)*6*(2/3-t):i}class ut{constructor(e,t,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,n)}set(e,t,n){if(t===void 0&&n===void 0){const r=e;r&&r.isColor?this.copy(r):typeof r=="number"?this.setHex(r):typeof r=="string"&&this.setStyle(r)}else this.setRGB(e,t,n);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=gs){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,Vi.toWorkingColorSpace(this,t),this}setRGB(e,t,n,r=Vi.workingColorSpace){return this.r=e,this.g=t,this.b=n,Vi.toWorkingColorSpace(this,r),this}setHSL(e,t,n,r=Vi.workingColorSpace){if(e=T6(e,1),t=rs(t,0,1),n=rs(n,0,1),t===0)this.r=this.g=this.b=n;else{const s=n<=.5?n*(1+t):n+t-n*t,o=2*n-s;this.r=tT(o,s,e+1/3),this.g=tT(o,s,e),this.b=tT(o,s,e-1/3)}return Vi.toWorkingColorSpace(this,r),this}setStyle(e,t=gs){function n(s){s!==void 0&&parseFloat(s)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let r;if(r=/^(\w+)\(([^\)]*)\)/.exec(e)){let s;const o=r[1],a=r[2];switch(o){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return n(s[4]),this.setRGB(Math.min(255,parseInt(s[1],10))/255,Math.min(255,parseInt(s[2],10))/255,Math.min(255,parseInt(s[3],10))/255,t);if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return n(s[4]),this.setRGB(Math.min(100,parseInt(s[1],10))/100,Math.min(100,parseInt(s[2],10))/100,Math.min(100,parseInt(s[3],10))/100,t);break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return n(s[4]),this.setHSL(parseFloat(s[1])/360,parseFloat(s[2])/100,parseFloat(s[3])/100,t);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(r=/^\#([A-Fa-f\d]+)$/.exec(e)){const s=r[1],o=s.length;if(o===3)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,t);if(o===6)return this.setHex(parseInt(s,16),t);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=gs){const n=QU[e.toLowerCase()];return n!==void 0?this.setHex(n,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=G1(e.r),this.g=G1(e.g),this.b=G1(e.b),this}copyLinearToSRGB(e){return this.r=QC(e.r),this.g=QC(e.g),this.b=QC(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=gs){return Vi.fromWorkingColorSpace(Yo.copy(this),e),Math.round(rs(Yo.r*255,0,255))*65536+Math.round(rs(Yo.g*255,0,255))*256+Math.round(rs(Yo.b*255,0,255))}getHexString(e=gs){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=Vi.workingColorSpace){Vi.fromWorkingColorSpace(Yo.copy(this),t);const n=Yo.r,r=Yo.g,s=Yo.b,o=Math.max(n,r,s),a=Math.min(n,r,s);let l,c;const u=(a+o)/2;if(a===o)l=0,c=0;else{const h=o-a;switch(c=u<=.5?h/(o+a):h/(2-o-a),o){case n:l=(r-s)/h+(r<s?6:0);break;case r:l=(s-n)/h+2;break;case s:l=(n-r)/h+4;break}l/=6}return e.h=l,e.s=c,e.l=u,e}getRGB(e,t=Vi.workingColorSpace){return Vi.fromWorkingColorSpace(Yo.copy(this),t),e.r=Yo.r,e.g=Yo.g,e.b=Yo.b,e}getStyle(e=gs){Vi.fromWorkingColorSpace(Yo.copy(this),e);const t=Yo.r,n=Yo.g,r=Yo.b;return e!==gs?`color(${e} ${t.toFixed(3)} ${n.toFixed(3)} ${r.toFixed(3)})`:`rgb(${Math.round(t*255)},${Math.round(n*255)},${Math.round(r*255)})`}offsetHSL(e,t,n){return this.getHSL(Sd),this.setHSL(Sd.h+e,Sd.s+t,Sd.l+n)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}lerpHSL(e,t){this.getHSL(Sd),e.getHSL(U3);const n=qv(Sd.h,U3.h,t),r=qv(Sd.s,U3.s,t),s=qv(Sd.l,U3.l,t);return this.setHSL(n,r,s),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,n=this.g,r=this.b,s=e.elements;return this.r=s[0]*t+s[3]*n+s[6]*r,this.g=s[1]*t+s[4]*n+s[7]*r,this.b=s[2]*t+s[5]*n+s[8]*r,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const Yo=new ut;ut.NAMES=QU;let $X=0;class Us extends Ch{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:$X++}),this.uuid=Pl(),this.name="",this.type="Material",this.blending=Kd,this.side=tl,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=x2,this.blendDst=ES,this.blendEquation=Nd,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new ut(0,0,0),this.blendAlpha=0,this.depthFunc=E2,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=IS,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=hh,this.stencilZFail=hh,this.stencilZPass=hh,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const t in e){const n=e[t];if(n===void 0){console.warn(`THREE.Material: parameter '${t}' has value of undefined.`);continue}const r=this[t];if(r===void 0){console.warn(`THREE.Material: '${t}' is not a property of THREE.${this.type}.`);continue}r&&r.isColor?r.set(n):r&&r.isVector3&&n&&n.isVector3?r.copy(n):this[t]=n}}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});const n={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};n.uuid=this.uuid,n.type=this.type,this.name!==""&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),this.roughness!==void 0&&(n.roughness=this.roughness),this.metalness!==void 0&&(n.metalness=this.metalness),this.sheen!==void 0&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(n.shininess=this.shininess),this.clearcoat!==void 0&&(n.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.iridescence!==void 0&&(n.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(n.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.anisotropy!==void 0&&(n.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(n.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(n.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(n.combine=this.combine)),this.envMapIntensity!==void 0&&(n.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(n.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(n.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(n.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(n.size=this.size),this.shadowSide!==null&&(n.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==Kd&&(n.blending=this.blending),this.side!==tl&&(n.side=this.side),this.vertexColors===!0&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),this.transparent===!0&&(n.transparent=!0),this.blendSrc!==x2&&(n.blendSrc=this.blendSrc),this.blendDst!==ES&&(n.blendDst=this.blendDst),this.blendEquation!==Nd&&(n.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(n.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(n.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(n.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(n.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(n.blendAlpha=this.blendAlpha),this.depthFunc!==E2&&(n.depthFunc=this.depthFunc),this.depthTest===!1&&(n.depthTest=this.depthTest),this.depthWrite===!1&&(n.depthWrite=this.depthWrite),this.colorWrite===!1&&(n.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(n.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==IS&&(n.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(n.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(n.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==hh&&(n.stencilFail=this.stencilFail),this.stencilZFail!==hh&&(n.stencilZFail=this.stencilZFail),this.stencilZPass!==hh&&(n.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(n.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(n.rotation=this.rotation),this.polygonOffset===!0&&(n.polygonOffset=!0),this.polygonOffsetFactor!==0&&(n.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(n.linewidth=this.linewidth),this.dashSize!==void 0&&(n.dashSize=this.dashSize),this.gapSize!==void 0&&(n.gapSize=this.gapSize),this.scale!==void 0&&(n.scale=this.scale),this.dithering===!0&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),this.alphaHash===!0&&(n.alphaHash=!0),this.alphaToCoverage===!0&&(n.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(n.premultipliedAlpha=!0),this.forceSinglePass===!0&&(n.forceSinglePass=!0),this.wireframe===!0&&(n.wireframe=!0),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(n.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(n.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(n.flatShading=!0),this.visible===!1&&(n.visible=!1),this.toneMapped===!1&&(n.toneMapped=!1),this.fog===!1&&(n.fog=!1),Object.keys(this.userData).length>0&&(n.userData=this.userData);function r(s){const o=[];for(const a in s){const l=s[a];delete l.metadata,o.push(l)}return o}if(t){const s=r(e.textures),o=r(e.images);s.length>0&&(n.textures=s),o.length>0&&(n.images=o)}return n}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let n=null;if(t!==null){const r=t.length;n=new Array(r);for(let s=0;s!==r;++s)n[s]=t[s].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}}class no extends Us{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new ut(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=ix,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const Cf=XX();function XX(){const i=new ArrayBuffer(4),e=new Float32Array(i),t=new Uint32Array(i),n=new Uint32Array(512),r=new Uint32Array(512);for(let l=0;l<256;++l){const c=l-127;c<-27?(n[l]=0,n[l|256]=32768,r[l]=24,r[l|256]=24):c<-14?(n[l]=1024>>-c-14,n[l|256]=1024>>-c-14|32768,r[l]=-c-1,r[l|256]=-c-1):c<=15?(n[l]=c+15<<10,n[l|256]=c+15<<10|32768,r[l]=13,r[l|256]=13):c<128?(n[l]=31744,n[l|256]=64512,r[l]=24,r[l|256]=24):(n[l]=31744,n[l|256]=64512,r[l]=13,r[l|256]=13)}const s=new Uint32Array(2048),o=new Uint32Array(64),a=new Uint32Array(64);for(let l=1;l<1024;++l){let c=l<<13,u=0;for(;(c&8388608)===0;)c<<=1,u-=8388608;c&=-8388609,u+=947912704,s[l]=c|u}for(let l=1024;l<2048;++l)s[l]=939524096+(l-1024<<13);for(let l=1;l<31;++l)o[l]=l<<23;o[31]=1199570944,o[32]=2147483648;for(let l=33;l<63;++l)o[l]=2147483648+(l-32<<23);o[63]=3347054592;for(let l=1;l<64;++l)l!==32&&(a[l]=1024);return{floatView:e,uint32View:t,baseTable:n,shiftTable:r,mantissaTable:s,exponentTable:o,offsetTable:a}}function Ha(i){Math.abs(i)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),i=rs(i,-65504,65504),Cf.floatView[0]=i;const e=Cf.uint32View[0],t=e>>23&511;return Cf.baseTable[t]+((e&8388607)>>Cf.shiftTable[t])}function Ov(i){const e=i>>10;return Cf.uint32View[0]=Cf.mantissaTable[Cf.offsetTable[e]+(i&1023)]+Cf.exponentTable[e],Cf.floatView[0]}const Lm={toHalfFloat:Ha,fromHalfFloat:Ov},Ls=new Q,z3=new Ue;class mn{constructor(e,t,n=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=n,this.usage=R2,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.gpuType=fi,this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}get updateRange(){return console.warn("THREE.BufferAttribute: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,n){e*=this.itemSize,n*=t.itemSize;for(let r=0,s=this.itemSize;r<s;r++)this.array[e+r]=t.array[n+r];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,n=this.count;t<n;t++)z3.fromBufferAttribute(this,t),z3.applyMatrix3(e),this.setXY(t,z3.x,z3.y);else if(this.itemSize===3)for(let t=0,n=this.count;t<n;t++)Ls.fromBufferAttribute(this,t),Ls.applyMatrix3(e),this.setXYZ(t,Ls.x,Ls.y,Ls.z);return this}applyMatrix4(e){for(let t=0,n=this.count;t<n;t++)Ls.fromBufferAttribute(this,t),Ls.applyMatrix4(e),this.setXYZ(t,Ls.x,Ls.y,Ls.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)Ls.fromBufferAttribute(this,t),Ls.applyNormalMatrix(e),this.setXYZ(t,Ls.x,Ls.y,Ls.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)Ls.fromBufferAttribute(this,t),Ls.transformDirection(e),this.setXYZ(t,Ls.x,Ls.y,Ls.z);return this}set(e,t=0){return this.array.set(e,t),this}getComponent(e,t){let n=this.array[e*this.itemSize+t];return this.normalized&&(n=qa(n,this.array)),n}setComponent(e,t,n){return this.normalized&&(n=ii(n,this.array)),this.array[e*this.itemSize+t]=n,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=qa(t,this.array)),t}setX(e,t){return this.normalized&&(t=ii(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=qa(t,this.array)),t}setY(e,t){return this.normalized&&(t=ii(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=qa(t,this.array)),t}setZ(e,t){return this.normalized&&(t=ii(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=qa(t,this.array)),t}setW(e,t){return this.normalized&&(t=ii(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=ii(t,this.array),n=ii(n,this.array)),this.array[e+0]=t,this.array[e+1]=n,this}setXYZ(e,t,n,r){return e*=this.itemSize,this.normalized&&(t=ii(t,this.array),n=ii(n,this.array),r=ii(r,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this}setXYZW(e,t,n,r,s){return e*=this.itemSize,this.normalized&&(t=ii(t,this.array),n=ii(n,this.array),r=ii(r,this.array),s=ii(s,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this.array[e+3]=s,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==R2&&(e.usage=this.usage),e}}class qX extends mn{constructor(e,t,n){super(new Int8Array(e),t,n)}}class JX extends mn{constructor(e,t,n){super(new Uint8Array(e),t,n)}}class ZX extends mn{constructor(e,t,n){super(new Uint8ClampedArray(e),t,n)}}class eq extends mn{constructor(e,t,n){super(new Int16Array(e),t,n)}}class bw extends mn{constructor(e,t,n){super(new Uint16Array(e),t,n)}}class tq extends mn{constructor(e,t,n){super(new Int32Array(e),t,n)}}class M6 extends mn{constructor(e,t,n){super(new Uint32Array(e),t,n)}}class nq extends mn{constructor(e,t,n){super(new Uint16Array(e),t,n),this.isFloat16BufferAttribute=!0}getX(e){let t=Ov(this.array[e*this.itemSize]);return this.normalized&&(t=qa(t,this.array)),t}setX(e,t){return this.normalized&&(t=ii(t,this.array)),this.array[e*this.itemSize]=Ha(t),this}getY(e){let t=Ov(this.array[e*this.itemSize+1]);return this.normalized&&(t=qa(t,this.array)),t}setY(e,t){return this.normalized&&(t=ii(t,this.array)),this.array[e*this.itemSize+1]=Ha(t),this}getZ(e){let t=Ov(this.array[e*this.itemSize+2]);return this.normalized&&(t=qa(t,this.array)),t}setZ(e,t){return this.normalized&&(t=ii(t,this.array)),this.array[e*this.itemSize+2]=Ha(t),this}getW(e){let t=Ov(this.array[e*this.itemSize+3]);return this.normalized&&(t=qa(t,this.array)),t}setW(e,t){return this.normalized&&(t=ii(t,this.array)),this.array[e*this.itemSize+3]=Ha(t),this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=ii(t,this.array),n=ii(n,this.array)),this.array[e+0]=Ha(t),this.array[e+1]=Ha(n),this}setXYZ(e,t,n,r){return e*=this.itemSize,this.normalized&&(t=ii(t,this.array),n=ii(n,this.array),r=ii(r,this.array)),this.array[e+0]=Ha(t),this.array[e+1]=Ha(n),this.array[e+2]=Ha(r),this}setXYZW(e,t,n,r,s){return e*=this.itemSize,this.normalized&&(t=ii(t,this.array),n=ii(n,this.array),r=ii(r,this.array),s=ii(s,this.array)),this.array[e+0]=Ha(t),this.array[e+1]=Ha(n),this.array[e+2]=Ha(r),this.array[e+3]=Ha(s),this}}class Gt extends mn{constructor(e,t,n){super(new Float32Array(e),t,n)}}class iq extends mn{constructor(e,t,n){super(new Float64Array(e),t,n)}}let rq=0;const ql=new Xe,nT=new _n,vg=new Q,vl=new ti,Fy=new ti,go=new Q;class fn extends Ch{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:rq++}),this.uuid=Pl(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(zU(e)?M6:bw)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,n=0){this.groups.push({start:e,count:t,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);const n=this.attributes.normal;if(n!==void 0){const s=new Tn().getNormalMatrix(e);n.applyNormalMatrix(s),n.needsUpdate=!0}const r=this.attributes.tangent;return r!==void 0&&(r.transformDirection(e),r.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return ql.makeRotationFromQuaternion(e),this.applyMatrix4(ql),this}rotateX(e){return ql.makeRotationX(e),this.applyMatrix4(ql),this}rotateY(e){return ql.makeRotationY(e),this.applyMatrix4(ql),this}rotateZ(e){return ql.makeRotationZ(e),this.applyMatrix4(ql),this}translate(e,t,n){return ql.makeTranslation(e,t,n),this.applyMatrix4(ql),this}scale(e,t,n){return ql.makeScale(e,t,n),this.applyMatrix4(ql),this}lookAt(e){return nT.lookAt(e),nT.updateMatrix(),this.applyMatrix4(nT.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(vg).negate(),this.translate(vg.x,vg.y,vg.z),this}setFromPoints(e){const t=[];for(let n=0,r=e.length;n<r;n++){const s=e[n];t.push(s.x,s.y,s.z||0)}return this.setAttribute("position",new Gt(t,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new ti);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingBox.set(new Q(-1/0,-1/0,-1/0),new Q(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let n=0,r=t.length;n<r;n++){const s=t[n];vl.setFromBufferAttribute(s),this.morphTargetsRelative?(go.addVectors(this.boundingBox.min,vl.min),this.boundingBox.expandByPoint(go),go.addVectors(this.boundingBox.max,vl.max),this.boundingBox.expandByPoint(go)):(this.boundingBox.expandByPoint(vl.min),this.boundingBox.expandByPoint(vl.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Bi);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingSphere.set(new Q,1/0);return}if(e){const n=this.boundingSphere.center;if(vl.setFromBufferAttribute(e),t)for(let s=0,o=t.length;s<o;s++){const a=t[s];Fy.setFromBufferAttribute(a),this.morphTargetsRelative?(go.addVectors(vl.min,Fy.min),vl.expandByPoint(go),go.addVectors(vl.max,Fy.max),vl.expandByPoint(go)):(vl.expandByPoint(Fy.min),vl.expandByPoint(Fy.max))}vl.getCenter(n);let r=0;for(let s=0,o=e.count;s<o;s++)go.fromBufferAttribute(e,s),r=Math.max(r,n.distanceToSquared(go));if(t)for(let s=0,o=t.length;s<o;s++){const a=t[s],l=this.morphTargetsRelative;for(let c=0,u=a.count;c<u;c++)go.fromBufferAttribute(a,c),l&&(vg.fromBufferAttribute(e,c),go.add(vg)),r=Math.max(r,n.distanceToSquared(go))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const n=e.array,r=t.position.array,s=t.normal.array,o=t.uv.array,a=r.length/3;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new mn(new Float32Array(4*a),4));const l=this.getAttribute("tangent").array,c=[],u=[];for(let R=0;R<a;R++)c[R]=new Q,u[R]=new Q;const h=new Q,f=new Q,d=new Q,m=new Ue,y=new Ue,g=new Ue,A=new Q,E=new Q;function x(R,U,k){h.fromArray(r,R*3),f.fromArray(r,U*3),d.fromArray(r,k*3),m.fromArray(o,R*2),y.fromArray(o,U*2),g.fromArray(o,k*2),f.sub(h),d.sub(h),y.sub(m),g.sub(m);const H=1/(y.x*g.y-g.x*y.y);isFinite(H)&&(A.copy(f).multiplyScalar(g.y).addScaledVector(d,-y.y).multiplyScalar(H),E.copy(d).multiplyScalar(y.x).addScaledVector(f,-g.x).multiplyScalar(H),c[R].add(A),c[U].add(A),c[k].add(A),u[R].add(E),u[U].add(E),u[k].add(E))}let w=this.groups;w.length===0&&(w=[{start:0,count:n.length}]);for(let R=0,U=w.length;R<U;++R){const k=w[R],H=k.start,G=k.count;for(let X=H,Z=H+G;X<Z;X+=3)x(n[X+0],n[X+1],n[X+2])}const T=new Q,I=new Q,M=new Q,L=new Q;function P(R){M.fromArray(s,R*3),L.copy(M);const U=c[R];T.copy(U),T.sub(M.multiplyScalar(M.dot(U))).normalize(),I.crossVectors(L,U);const H=I.dot(u[R])<0?-1:1;l[R*4]=T.x,l[R*4+1]=T.y,l[R*4+2]=T.z,l[R*4+3]=H}for(let R=0,U=w.length;R<U;++R){const k=w[R],H=k.start,G=k.count;for(let X=H,Z=H+G;X<Z;X+=3)P(n[X+0]),P(n[X+1]),P(n[X+2])}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(t!==void 0){let n=this.getAttribute("normal");if(n===void 0)n=new mn(new Float32Array(t.count*3),3),this.setAttribute("normal",n);else for(let f=0,d=n.count;f<d;f++)n.setXYZ(f,0,0,0);const r=new Q,s=new Q,o=new Q,a=new Q,l=new Q,c=new Q,u=new Q,h=new Q;if(e)for(let f=0,d=e.count;f<d;f+=3){const m=e.getX(f+0),y=e.getX(f+1),g=e.getX(f+2);r.fromBufferAttribute(t,m),s.fromBufferAttribute(t,y),o.fromBufferAttribute(t,g),u.subVectors(o,s),h.subVectors(r,s),u.cross(h),a.fromBufferAttribute(n,m),l.fromBufferAttribute(n,y),c.fromBufferAttribute(n,g),a.add(u),l.add(u),c.add(u),n.setXYZ(m,a.x,a.y,a.z),n.setXYZ(y,l.x,l.y,l.z),n.setXYZ(g,c.x,c.y,c.z)}else for(let f=0,d=t.count;f<d;f+=3)r.fromBufferAttribute(t,f+0),s.fromBufferAttribute(t,f+1),o.fromBufferAttribute(t,f+2),u.subVectors(o,s),h.subVectors(r,s),u.cross(h),n.setXYZ(f+0,u.x,u.y,u.z),n.setXYZ(f+1,u.x,u.y,u.z),n.setXYZ(f+2,u.x,u.y,u.z);this.normalizeNormals(),n.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let t=0,n=e.count;t<n;t++)go.fromBufferAttribute(e,t),go.normalize(),e.setXYZ(t,go.x,go.y,go.z)}toNonIndexed(){function e(a,l){const c=a.array,u=a.itemSize,h=a.normalized,f=new c.constructor(l.length*u);let d=0,m=0;for(let y=0,g=l.length;y<g;y++){a.isInterleavedBufferAttribute?d=l[y]*a.data.stride+a.offset:d=l[y]*u;for(let A=0;A<u;A++)f[m++]=c[d++]}return new mn(f,u,h)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new fn,n=this.index.array,r=this.attributes;for(const a in r){const l=r[a],c=e(l,n);t.setAttribute(a,c)}const s=this.morphAttributes;for(const a in s){const l=[],c=s[a];for(let u=0,h=c.length;u<h;u++){const f=c[u],d=e(f,n);l.push(d)}t.morphAttributes[a]=l}t.morphTargetsRelative=this.morphTargetsRelative;const o=this.groups;for(let a=0,l=o.length;a<l;a++){const c=o[a];t.addGroup(c.start,c.count,c.materialIndex)}return t}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const l=this.parameters;for(const c in l)l[c]!==void 0&&(e[c]=l[c]);return e}e.data={attributes:{}};const t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const n=this.attributes;for(const l in n){const c=n[l];e.data.attributes[l]=c.toJSON(e.data)}const r={};let s=!1;for(const l in this.morphAttributes){const c=this.morphAttributes[l],u=[];for(let h=0,f=c.length;h<f;h++){const d=c[h];u.push(d.toJSON(e.data))}u.length>0&&(r[l]=u,s=!0)}s&&(e.data.morphAttributes=r,e.data.morphTargetsRelative=this.morphTargetsRelative);const o=this.groups;o.length>0&&(e.data.groups=JSON.parse(JSON.stringify(o)));const a=this.boundingSphere;return a!==null&&(e.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const n=e.index;n!==null&&this.setIndex(n.clone(t));const r=e.attributes;for(const c in r){const u=r[c];this.setAttribute(c,u.clone(t))}const s=e.morphAttributes;for(const c in s){const u=[],h=s[c];for(let f=0,d=h.length;f<d;f++)u.push(h[f].clone(t));this.morphAttributes[c]=u}this.morphTargetsRelative=e.morphTargetsRelative;const o=e.groups;for(let c=0,u=o.length;c<u;c++){const h=o[c];this.addGroup(h.start,h.count,h.materialIndex)}const a=e.boundingBox;a!==null&&(this.boundingBox=a.clone());const l=e.boundingSphere;return l!==null&&(this.boundingSphere=l.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const vL=new Xe,rm=new vc,G3=new Bi,xL=new Q,xg=new Q,Eg=new Q,_g=new Q,iT=new Q,H3=new Q,Q3=new Ue,V3=new Ue,j3=new Ue,EL=new Q,_L=new Q,SL=new Q,W3=new Q,K3=new Q;class It extends _n{constructor(e=new fn,t=new no){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,n=Object.keys(t);if(n.length>0){const r=t[n[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=r.length;s<o;s++){const a=r[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}getVertexPosition(e,t){const n=this.geometry,r=n.attributes.position,s=n.morphAttributes.position,o=n.morphTargetsRelative;t.fromBufferAttribute(r,e);const a=this.morphTargetInfluences;if(s&&a){H3.set(0,0,0);for(let l=0,c=s.length;l<c;l++){const u=a[l],h=s[l];u!==0&&(iT.fromBufferAttribute(h,e),o?H3.addScaledVector(iT,u):H3.addScaledVector(iT.sub(t),u))}t.add(H3)}return t}raycast(e,t){const n=this.geometry,r=this.material,s=this.matrixWorld;r!==void 0&&(n.boundingSphere===null&&n.computeBoundingSphere(),G3.copy(n.boundingSphere),G3.applyMatrix4(s),rm.copy(e.ray).recast(e.near),!(G3.containsPoint(rm.origin)===!1&&(rm.intersectSphere(G3,xL)===null||rm.origin.distanceToSquared(xL)>(e.far-e.near)**2))&&(vL.copy(s).invert(),rm.copy(e.ray).applyMatrix4(vL),!(n.boundingBox!==null&&rm.intersectsBox(n.boundingBox)===!1)&&this._computeIntersections(e,t,rm)))}_computeIntersections(e,t,n){let r;const s=this.geometry,o=this.material,a=s.index,l=s.attributes.position,c=s.attributes.uv,u=s.attributes.uv1,h=s.attributes.normal,f=s.groups,d=s.drawRange;if(a!==null)if(Array.isArray(o))for(let m=0,y=f.length;m<y;m++){const g=f[m],A=o[g.materialIndex],E=Math.max(g.start,d.start),x=Math.min(a.count,Math.min(g.start+g.count,d.start+d.count));for(let w=E,T=x;w<T;w+=3){const I=a.getX(w),M=a.getX(w+1),L=a.getX(w+2);r=Y3(this,A,e,n,c,u,h,I,M,L),r&&(r.faceIndex=Math.floor(w/3),r.face.materialIndex=g.materialIndex,t.push(r))}}else{const m=Math.max(0,d.start),y=Math.min(a.count,d.start+d.count);for(let g=m,A=y;g<A;g+=3){const E=a.getX(g),x=a.getX(g+1),w=a.getX(g+2);r=Y3(this,o,e,n,c,u,h,E,x,w),r&&(r.faceIndex=Math.floor(g/3),t.push(r))}}else if(l!==void 0)if(Array.isArray(o))for(let m=0,y=f.length;m<y;m++){const g=f[m],A=o[g.materialIndex],E=Math.max(g.start,d.start),x=Math.min(l.count,Math.min(g.start+g.count,d.start+d.count));for(let w=E,T=x;w<T;w+=3){const I=w,M=w+1,L=w+2;r=Y3(this,A,e,n,c,u,h,I,M,L),r&&(r.faceIndex=Math.floor(w/3),r.face.materialIndex=g.materialIndex,t.push(r))}}else{const m=Math.max(0,d.start),y=Math.min(l.count,d.start+d.count);for(let g=m,A=y;g<A;g+=3){const E=g,x=g+1,w=g+2;r=Y3(this,o,e,n,c,u,h,E,x,w),r&&(r.faceIndex=Math.floor(g/3),t.push(r))}}}}function sq(i,e,t,n,r,s,o,a){let l;if(e.side===ys?l=n.intersectTriangle(o,s,r,!0,a):l=n.intersectTriangle(r,s,o,e.side===tl,a),l===null)return null;K3.copy(a),K3.applyMatrix4(i.matrixWorld);const c=t.ray.origin.distanceTo(K3);return c<t.near||c>t.far?null:{distance:c,point:K3.clone(),object:i}}function Y3(i,e,t,n,r,s,o,a,l,c){i.getVertexPosition(a,xg),i.getVertexPosition(l,Eg),i.getVertexPosition(c,_g);const u=sq(i,e,t,n,xg,Eg,_g,W3);if(u){r&&(Q3.fromBufferAttribute(r,a),V3.fromBufferAttribute(r,l),j3.fromBufferAttribute(r,c),u.uv=ks.getInterpolation(W3,xg,Eg,_g,Q3,V3,j3,new Ue)),s&&(Q3.fromBufferAttribute(s,a),V3.fromBufferAttribute(s,l),j3.fromBufferAttribute(s,c),u.uv1=ks.getInterpolation(W3,xg,Eg,_g,Q3,V3,j3,new Ue),u.uv2=u.uv1),o&&(EL.fromBufferAttribute(o,a),_L.fromBufferAttribute(o,l),SL.fromBufferAttribute(o,c),u.normal=ks.getInterpolation(W3,xg,Eg,_g,EL,_L,SL,new Q),u.normal.dot(n.direction)>0&&u.normal.multiplyScalar(-1));const h={a,b:l,c,normal:new Q,materialIndex:0};ks.getNormal(xg,Eg,_g,h.normal),u.face=h}return u}class ya extends fn{constructor(e=1,t=1,n=1,r=1,s=1,o=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:r,heightSegments:s,depthSegments:o};const a=this;r=Math.floor(r),s=Math.floor(s),o=Math.floor(o);const l=[],c=[],u=[],h=[];let f=0,d=0;m("z","y","x",-1,-1,n,t,e,o,s,0),m("z","y","x",1,-1,n,t,-e,o,s,1),m("x","z","y",1,1,e,n,t,r,o,2),m("x","z","y",1,-1,e,n,-t,r,o,3),m("x","y","z",1,-1,e,t,n,r,s,4),m("x","y","z",-1,-1,e,t,-n,r,s,5),this.setIndex(l),this.setAttribute("position",new Gt(c,3)),this.setAttribute("normal",new Gt(u,3)),this.setAttribute("uv",new Gt(h,2));function m(y,g,A,E,x,w,T,I,M,L,P){const R=w/M,U=T/L,k=w/2,H=T/2,G=I/2,X=M+1,Z=L+1;let oe=0,K=0;const V=new Q;for(let W=0;W<Z;W++){const F=W*U-H;for(let Y=0;Y<X;Y++){const te=Y*R-k;V[y]=te*E,V[g]=F*x,V[A]=G,c.push(V.x,V.y,V.z),V[y]=0,V[g]=0,V[A]=I>0?1:-1,u.push(V.x,V.y,V.z),h.push(Y/M),h.push(1-W/L),oe+=1}}for(let W=0;W<L;W++)for(let F=0;F<M;F++){const Y=f+F+X*W,te=f+F+X*(W+1),q=f+(F+1)+X*(W+1),J=f+(F+1)+X*W;l.push(Y,te,J),l.push(te,q,J),K+=6}a.addGroup(d,K,P),d+=K,f+=oe}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new ya(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function rA(i){const e={};for(const t in i){e[t]={};for(const n in i[t]){const r=i[t][n];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?r.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[t][n]=null):e[t][n]=r.clone():Array.isArray(r)?e[t][n]=r.slice():e[t][n]=r}}return e}function Aa(i){const e={};for(let t=0;t<i.length;t++){const n=rA(i[t]);for(const r in n)e[r]=n[r]}return e}function oq(i){const e=[];for(let t=0;t<i.length;t++)e.push(i[t].clone());return e}function VU(i){return i.getRenderTarget()===null?i.outputColorSpace:Vi.workingColorSpace}const rp={clone:rA,merge:Aa};var aq=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,lq=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class Mi extends Us{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=aq,this.fragmentShader=lq,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1,clipCullDistance:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=rA(e.uniforms),this.uniformsGroups=oq(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const r in this.uniforms){const o=this.uniforms[r].value;o&&o.isTexture?t.uniforms[r]={type:"t",value:o.toJSON(e).uuid}:o&&o.isColor?t.uniforms[r]={type:"c",value:o.getHex()}:o&&o.isVector2?t.uniforms[r]={type:"v2",value:o.toArray()}:o&&o.isVector3?t.uniforms[r]={type:"v3",value:o.toArray()}:o&&o.isVector4?t.uniforms[r]={type:"v4",value:o.toArray()}:o&&o.isMatrix3?t.uniforms[r]={type:"m3",value:o.toArray()}:o&&o.isMatrix4?t.uniforms[r]={type:"m4",value:o.toArray()}:t.uniforms[r]={value:o}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;const n={};for(const r in this.extensions)this.extensions[r]===!0&&(n[r]=!0);return Object.keys(n).length>0&&(t.extensions=n),t}}class h0 extends _n{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Xe,this.projectionMatrix=new Xe,this.projectionMatrixInverse=new Xe,this.coordinateSystem=mu}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}let jn=class extends h0{constructor(e=50,t=1,n=.1,r=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=n,this.far=r,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=iA*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(zm*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return iA*2*Math.atan(Math.tan(zm*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,n,r,s,o){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=s,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(zm*.5*this.fov)/this.zoom,n=2*t,r=this.aspect*n,s=-.5*r;const o=this.view;if(this.view!==null&&this.view.enabled){const l=o.fullWidth,c=o.fullHeight;s+=o.offsetX*r/l,t-=o.offsetY*n/c,r*=o.width/l,n*=o.height/c}const a=this.filmOffset;a!==0&&(s+=e*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(s,s+r,t,t-n,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}};const Sg=-90,wg=1;let Iw=class extends _n{constructor(e,t,n){super(),this.type="CubeCamera",this.renderTarget=n,this.coordinateSystem=null,this.activeMipmapLevel=0;const r=new jn(Sg,wg,e,t);r.layers=this.layers,this.add(r);const s=new jn(Sg,wg,e,t);s.layers=this.layers,this.add(s);const o=new jn(Sg,wg,e,t);o.layers=this.layers,this.add(o);const a=new jn(Sg,wg,e,t);a.layers=this.layers,this.add(a);const l=new jn(Sg,wg,e,t);l.layers=this.layers,this.add(l);const c=new jn(Sg,wg,e,t);c.layers=this.layers,this.add(c)}updateCoordinateSystem(){const e=this.coordinateSystem,t=this.children.concat(),[n,r,s,o,a,l]=t;for(const c of t)this.remove(c);if(e===mu)n.up.set(0,1,0),n.lookAt(1,0,0),r.up.set(0,1,0),r.lookAt(-1,0,0),s.up.set(0,0,-1),s.lookAt(0,1,0),o.up.set(0,0,1),o.lookAt(0,-1,0),a.up.set(0,1,0),a.lookAt(0,0,1),l.up.set(0,1,0),l.lookAt(0,0,-1);else if(e===nA)n.up.set(0,-1,0),n.lookAt(-1,0,0),r.up.set(0,-1,0),r.lookAt(1,0,0),s.up.set(0,0,1),s.lookAt(0,1,0),o.up.set(0,0,-1),o.lookAt(0,-1,0),a.up.set(0,-1,0),a.lookAt(0,0,1),l.up.set(0,-1,0),l.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);for(const c of t)this.add(c),c.updateMatrixWorld()}update(e,t){this.parent===null&&this.updateMatrixWorld();const{renderTarget:n,activeMipmapLevel:r}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[s,o,a,l,c,u]=this.children,h=e.getRenderTarget(),f=e.getActiveCubeFace(),d=e.getActiveMipmapLevel(),m=e.xr.enabled;e.xr.enabled=!1;const y=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0,r),e.render(t,s),e.setRenderTarget(n,1,r),e.render(t,o),e.setRenderTarget(n,2,r),e.render(t,a),e.setRenderTarget(n,3,r),e.render(t,l),e.setRenderTarget(n,4,r),e.render(t,c),n.texture.generateMipmaps=y,e.setRenderTarget(n,5,r),e.render(t,u),e.setRenderTarget(h,f,d),e.xr.enabled=m,n.texture.needsPMREMUpdate=!0}},ox=class extends vi{constructor(e,t,n,r,s,o,a,l,c,u){e=e!==void 0?e:[],t=t!==void 0?t:_u,super(e,t,n,r,s,o,a,l,c,u),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}};class wA extends Si{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const n={width:e,height:e,depth:1},r=[n,n,n,n,n,n];t.encoding!==void 0&&(Jv("THREE.WebGLCubeRenderTarget: option.encoding has been replaced by option.colorSpace."),t.colorSpace=t.encoding===$d?gs:Tl),this.texture=new ox(r,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=t.generateMipmaps!==void 0?t.generateMipmaps:!1,this.texture.minFilter=t.minFilter!==void 0?t.minFilter:Ln}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const n={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},r=new ya(5,5,5),s=new Mi({name:"CubemapFromEquirect",uniforms:rA(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:ys,blending:gc});s.uniforms.tEquirect.value=t;const o=new It(r,s),a=t.minFilter;return t.minFilter===Bl&&(t.minFilter=Ln),new Iw(1,10,this).update(e,o),t.minFilter=a,o.geometry.dispose(),o.material.dispose(),this}clear(e,t,n,r){const s=e.getRenderTarget();for(let o=0;o<6;o++)e.setRenderTarget(this,o),e.clear(t,n,r);e.setRenderTarget(s)}}const rT=new Q,cq=new Q,uq=new Tn;let vo=class{constructor(e=new Q(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,n,r){return this.normal.set(e,t,n),this.constant=r,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,n){const r=rT.subVectors(n,t).cross(cq.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const n=e.delta(rT),r=this.normal.dot(n);if(r===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;const s=-(e.start.dot(this.normal)+this.constant)/r;return s<0||s>1?null:t.copy(e.start).addScaledVector(n,s)}intersectsLine(e){const t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const n=t||uq.getNormalMatrix(e),r=this.coplanarPoint(rT).applyMatrix4(e),s=this.normal.applyMatrix3(n).normalize();return this.constant=-r.dot(s),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}};const sm=new Bi,$3=new Q;class f0{constructor(e=new vo,t=new vo,n=new vo,r=new vo,s=new vo,o=new vo){this.planes=[e,t,n,r,s,o]}set(e,t,n,r,s,o){const a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(n),a[3].copy(r),a[4].copy(s),a[5].copy(o),this}copy(e){const t=this.planes;for(let n=0;n<6;n++)t[n].copy(e.planes[n]);return this}setFromProjectionMatrix(e,t=mu){const n=this.planes,r=e.elements,s=r[0],o=r[1],a=r[2],l=r[3],c=r[4],u=r[5],h=r[6],f=r[7],d=r[8],m=r[9],y=r[10],g=r[11],A=r[12],E=r[13],x=r[14],w=r[15];if(n[0].setComponents(l-s,f-c,g-d,w-A).normalize(),n[1].setComponents(l+s,f+c,g+d,w+A).normalize(),n[2].setComponents(l+o,f+u,g+m,w+E).normalize(),n[3].setComponents(l-o,f-u,g-m,w-E).normalize(),n[4].setComponents(l-a,f-h,g-y,w-x).normalize(),t===mu)n[5].setComponents(l+a,f+h,g+y,w+x).normalize();else if(t===nA)n[5].setComponents(a,h,y,x).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);return this}intersectsObject(e){if(e.boundingSphere!==void 0)e.boundingSphere===null&&e.computeBoundingSphere(),sm.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;t.boundingSphere===null&&t.computeBoundingSphere(),sm.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(sm)}intersectsSprite(e){return sm.center.set(0,0,0),sm.radius=.7071067811865476,sm.applyMatrix4(e.matrixWorld),this.intersectsSphere(sm)}intersectsSphere(e){const t=this.planes,n=e.center,r=-e.radius;for(let s=0;s<6;s++)if(t[s].distanceToPoint(n)<r)return!1;return!0}intersectsBox(e){const t=this.planes;for(let n=0;n<6;n++){const r=t[n];if($3.x=r.normal.x>0?e.max.x:e.min.x,$3.y=r.normal.y>0?e.max.y:e.min.y,$3.z=r.normal.z>0?e.max.z:e.min.z,r.distanceToPoint($3)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function jU(){let i=null,e=!1,t=null,n=null;function r(s,o){t(s,o),n=i.requestAnimationFrame(r)}return{start:function(){e!==!0&&t!==null&&(n=i.requestAnimationFrame(r),e=!0)},stop:function(){i.cancelAnimationFrame(n),e=!1},setAnimationLoop:function(s){t=s},setContext:function(s){i=s}}}function hq(i,e){const t=e.isWebGL2,n=new WeakMap;function r(c,u){const h=c.array,f=c.usage,d=h.byteLength,m=i.createBuffer();i.bindBuffer(u,m),i.bufferData(u,h,f),c.onUploadCallback();let y;if(h instanceof Float32Array)y=i.FLOAT;else if(h instanceof Uint16Array)if(c.isFloat16BufferAttribute)if(t)y=i.HALF_FLOAT;else throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");else y=i.UNSIGNED_SHORT;else if(h instanceof Int16Array)y=i.SHORT;else if(h instanceof Uint32Array)y=i.UNSIGNED_INT;else if(h instanceof Int32Array)y=i.INT;else if(h instanceof Int8Array)y=i.BYTE;else if(h instanceof Uint8Array)y=i.UNSIGNED_BYTE;else if(h instanceof Uint8ClampedArray)y=i.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+h);return{buffer:m,type:y,bytesPerElement:h.BYTES_PER_ELEMENT,version:c.version,size:d}}function s(c,u,h){const f=u.array,d=u._updateRange,m=u.updateRanges;if(i.bindBuffer(h,c),d.count===-1&&m.length===0&&i.bufferSubData(h,0,f),m.length!==0){for(let y=0,g=m.length;y<g;y++){const A=m[y];t?i.bufferSubData(h,A.start*f.BYTES_PER_ELEMENT,f,A.start,A.count):i.bufferSubData(h,A.start*f.BYTES_PER_ELEMENT,f.subarray(A.start,A.start+A.count))}u.clearUpdateRanges()}d.count!==-1&&(t?i.bufferSubData(h,d.offset*f.BYTES_PER_ELEMENT,f,d.offset,d.count):i.bufferSubData(h,d.offset*f.BYTES_PER_ELEMENT,f.subarray(d.offset,d.offset+d.count)),d.count=-1),u.onUploadCallback()}function o(c){return c.isInterleavedBufferAttribute&&(c=c.data),n.get(c)}function a(c){c.isInterleavedBufferAttribute&&(c=c.data);const u=n.get(c);u&&(i.deleteBuffer(u.buffer),n.delete(c))}function l(c,u){if(c.isGLBufferAttribute){const f=n.get(c);(!f||f.version<c.version)&&n.set(c,{buffer:c.buffer,type:c.type,bytesPerElement:c.elementSize,version:c.version});return}c.isInterleavedBufferAttribute&&(c=c.data);const h=n.get(c);if(h===void 0)n.set(c,r(c,u));else if(h.version<c.version){if(h.size!==c.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");s(h.buffer,c,u),h.version=c.version}}return{get:o,remove:a,update:l}}class Fs extends fn{constructor(e=1,t=1,n=1,r=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:r};const s=e/2,o=t/2,a=Math.floor(n),l=Math.floor(r),c=a+1,u=l+1,h=e/a,f=t/l,d=[],m=[],y=[],g=[];for(let A=0;A<u;A++){const E=A*f-o;for(let x=0;x<c;x++){const w=x*h-s;m.push(w,-E,0),y.push(0,0,1),g.push(x/a),g.push(1-A/l)}}for(let A=0;A<l;A++)for(let E=0;E<a;E++){const x=E+c*A,w=E+c*(A+1),T=E+1+c*(A+1),I=E+1+c*A;d.push(x,w,I),d.push(w,T,I)}this.setIndex(d),this.setAttribute("position",new Gt(m,3)),this.setAttribute("normal",new Gt(y,3)),this.setAttribute("uv",new Gt(g,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Fs(e.width,e.height,e.widthSegments,e.heightSegments)}}var fq=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,dq=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,pq=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,mq=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,gq=`#ifdef USE_ALPHATEST
	if ( diffuseColor.a < alphaTest ) discard;
#endif`,Aq=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,yq=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,vq=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,xq=`#ifdef USE_BATCHING
	attribute float batchId;
	uniform highp sampler2D batchingTexture;
	mat4 getBatchingMatrix( const in float i ) {
		int size = textureSize( batchingTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,Eq=`#ifdef USE_BATCHING
	mat4 batchingMatrix = getBatchingMatrix( batchId );
#endif`,_q=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,Sq=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,wq=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,Cq=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,Tq=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,bq=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,Iq=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,Mq=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,Rq=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,Pq=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,Lq=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,Bq=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,Dq=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,kq=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float luminance( const in vec3 rgb ) {
	const vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );
	return dot( weights, rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,Fq=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,Oq=`vec3 transformedNormal = objectNormal;
#ifdef USE_TANGENT
	vec3 transformedTangent = objectTangent;
#endif
#ifdef USE_BATCHING
	mat3 bm = mat3( batchingMatrix );
	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );
	transformedNormal = bm * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = bm * transformedTangent;
	#endif
#endif
#ifdef USE_INSTANCING
	mat3 im = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );
	transformedNormal = im * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = im * transformedTangent;
	#endif
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,Nq=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,Uq=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,zq=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,Gq=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,Hq="gl_FragColor = linearToOutputTexel( gl_FragColor );",Qq=`
const mat3 LINEAR_SRGB_TO_LINEAR_DISPLAY_P3 = mat3(
	vec3( 0.8224621, 0.177538, 0.0 ),
	vec3( 0.0331941, 0.9668058, 0.0 ),
	vec3( 0.0170827, 0.0723974, 0.9105199 )
);
const mat3 LINEAR_DISPLAY_P3_TO_LINEAR_SRGB = mat3(
	vec3( 1.2249401, - 0.2249404, 0.0 ),
	vec3( - 0.0420569, 1.0420571, 0.0 ),
	vec3( - 0.0196376, - 0.0786361, 1.0982735 )
);
vec4 LinearSRGBToLinearDisplayP3( in vec4 value ) {
	return vec4( value.rgb * LINEAR_SRGB_TO_LINEAR_DISPLAY_P3, value.a );
}
vec4 LinearDisplayP3ToLinearSRGB( in vec4 value ) {
	return vec4( value.rgb * LINEAR_DISPLAY_P3_TO_LINEAR_SRGB, value.a );
}
vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}
vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return sRGBTransferOETF( value );
}`,Vq=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,jq=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,Wq=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,Kq=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,Yq=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,$q=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,Xq=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,qq=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,Jq=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,Zq=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,eJ=`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
	vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
	reflectedLight.indirectDiffuse += lightMapIrradiance;
#endif`,tJ=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,nJ=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,iJ=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,rJ=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( LEGACY_LIGHTS )
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#else
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,sJ=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,oJ=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,aJ=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,lJ=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,cJ=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,uJ=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	if( material.anisotropy == 0.0 ) {
		anisotropyV = vec2( 1.0, 0.0 );
	} else {
		anisotropyV /= material.anisotropy;
		material.anisotropy = saturate( material.anisotropy );
	}
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;
#endif`,hJ=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,fJ=`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal = vec3( 0.0 );
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,dJ=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,pJ=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,mJ=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,gJ=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,AJ=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,yJ=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,vJ=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );
	
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,xJ=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,EJ=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,_J=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,SJ=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,wJ=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,CJ=`#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,TJ=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,bJ=`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		uniform sampler2DArray morphTargetsTexture;
		uniform ivec2 morphTargetsTextureSize;
		vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
			int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
			int y = texelIndex / morphTargetsTextureSize.x;
			int x = texelIndex - y * morphTargetsTextureSize.x;
			ivec3 morphUV = ivec3( x, y, morphTargetIndex );
			return texelFetch( morphTargetsTexture, morphUV, 0 );
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,IJ=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,MJ=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,RJ=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,PJ=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,LJ=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,BJ=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,DJ=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,kJ=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,FJ=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,OJ=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,NJ=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,UJ=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,zJ=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec2 packDepthToRG( in highp float v ) {
	return packDepthToRGBA( v ).yx;
}
float unpackRGToDepth( const in highp vec2 v ) {
	return unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,GJ=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,HJ=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_BATCHING
	mvPosition = batchingMatrix * mvPosition;
#endif
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,QJ=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,VJ=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,jJ=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,WJ=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,KJ=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,YJ=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,$J=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,XJ=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,qJ=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,JJ=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	mat4 getBoneMatrix( const in float i ) {
		int size = textureSize( boneTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,ZJ=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,eZ=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,tZ=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,nZ=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,iZ=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,rZ=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
const mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(
	vec3( 1.6605, - 0.1246, - 0.0182 ),
	vec3( - 0.5876, 1.1329, - 0.1006 ),
	vec3( - 0.0728, - 0.0083, 1.1187 )
);
const mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(
	vec3( 0.6274, 0.0691, 0.0164 ),
	vec3( 0.3293, 0.9195, 0.0880 ),
	vec3( 0.0433, 0.0113, 0.8956 )
);
vec3 agxDefaultContrastApprox( vec3 x ) {
	vec3 x2 = x * x;
	vec3 x4 = x2 * x2;
	return + 15.5 * x4 * x2
		- 40.14 * x4 * x
		+ 31.96 * x4
		- 6.868 * x2 * x
		+ 0.4298 * x2
		+ 0.1191 * x
		- 0.00232;
}
vec3 AgXToneMapping( vec3 color ) {
	const mat3 AgXInsetMatrix = mat3(
		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),
		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),
		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )
	);
	const mat3 AgXOutsetMatrix = mat3(
		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),
		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),
		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )
	);
	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;
	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;
	color *= toneMappingExposure;
	color = AgXInsetMatrix * color;
	color = max( color, 1e-10 );	color = log2( color );
	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );
	color = clamp( color, 0.0, 1.0 );
	color = agxDefaultContrastApprox( color );
	color = AgXOutsetMatrix * color;
	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );
	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;
	return color;
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,sZ=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,oZ=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
		vec3 transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,aZ=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,lZ=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,cZ=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,uZ=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_BATCHING
		worldPosition = batchingMatrix * worldPosition;
	#endif
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const hZ=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,fZ=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,dZ=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,pZ=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,mZ=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,gZ=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,AZ=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,yZ=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,vZ=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,xZ=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,EZ=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,_Z=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,SZ=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,wZ=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,CZ=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,TZ=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,bZ=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,IZ=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,MZ=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,RZ=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,PZ=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,LZ=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,BZ=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,DZ=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,kZ=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,FZ=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,OZ=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,NZ=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,UZ=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,zZ=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,GZ=`#include <common>
#include <batching_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,HZ=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,QZ=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,VZ=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,Un={alphahash_fragment:fq,alphahash_pars_fragment:dq,alphamap_fragment:pq,alphamap_pars_fragment:mq,alphatest_fragment:gq,alphatest_pars_fragment:Aq,aomap_fragment:yq,aomap_pars_fragment:vq,batching_pars_vertex:xq,batching_vertex:Eq,begin_vertex:_q,beginnormal_vertex:Sq,bsdfs:wq,iridescence_fragment:Cq,bumpmap_pars_fragment:Tq,clipping_planes_fragment:bq,clipping_planes_pars_fragment:Iq,clipping_planes_pars_vertex:Mq,clipping_planes_vertex:Rq,color_fragment:Pq,color_pars_fragment:Lq,color_pars_vertex:Bq,color_vertex:Dq,common:kq,cube_uv_reflection_fragment:Fq,defaultnormal_vertex:Oq,displacementmap_pars_vertex:Nq,displacementmap_vertex:Uq,emissivemap_fragment:zq,emissivemap_pars_fragment:Gq,colorspace_fragment:Hq,colorspace_pars_fragment:Qq,envmap_fragment:Vq,envmap_common_pars_fragment:jq,envmap_pars_fragment:Wq,envmap_pars_vertex:Kq,envmap_physical_pars_fragment:sJ,envmap_vertex:Yq,fog_vertex:$q,fog_pars_vertex:Xq,fog_fragment:qq,fog_pars_fragment:Jq,gradientmap_pars_fragment:Zq,lightmap_fragment:eJ,lightmap_pars_fragment:tJ,lights_lambert_fragment:nJ,lights_lambert_pars_fragment:iJ,lights_pars_begin:rJ,lights_toon_fragment:oJ,lights_toon_pars_fragment:aJ,lights_phong_fragment:lJ,lights_phong_pars_fragment:cJ,lights_physical_fragment:uJ,lights_physical_pars_fragment:hJ,lights_fragment_begin:fJ,lights_fragment_maps:dJ,lights_fragment_end:pJ,logdepthbuf_fragment:mJ,logdepthbuf_pars_fragment:gJ,logdepthbuf_pars_vertex:AJ,logdepthbuf_vertex:yJ,map_fragment:vJ,map_pars_fragment:xJ,map_particle_fragment:EJ,map_particle_pars_fragment:_J,metalnessmap_fragment:SJ,metalnessmap_pars_fragment:wJ,morphcolor_vertex:CJ,morphnormal_vertex:TJ,morphtarget_pars_vertex:bJ,morphtarget_vertex:IJ,normal_fragment_begin:MJ,normal_fragment_maps:RJ,normal_pars_fragment:PJ,normal_pars_vertex:LJ,normal_vertex:BJ,normalmap_pars_fragment:DJ,clearcoat_normal_fragment_begin:kJ,clearcoat_normal_fragment_maps:FJ,clearcoat_pars_fragment:OJ,iridescence_pars_fragment:NJ,opaque_fragment:UJ,packing:zJ,premultiplied_alpha_fragment:GJ,project_vertex:HJ,dithering_fragment:QJ,dithering_pars_fragment:VJ,roughnessmap_fragment:jJ,roughnessmap_pars_fragment:WJ,shadowmap_pars_fragment:KJ,shadowmap_pars_vertex:YJ,shadowmap_vertex:$J,shadowmask_pars_fragment:XJ,skinbase_vertex:qJ,skinning_pars_vertex:JJ,skinning_vertex:ZJ,skinnormal_vertex:eZ,specularmap_fragment:tZ,specularmap_pars_fragment:nZ,tonemapping_fragment:iZ,tonemapping_pars_fragment:rZ,transmission_fragment:sZ,transmission_pars_fragment:oZ,uv_pars_fragment:aZ,uv_pars_vertex:lZ,uv_vertex:cZ,worldpos_vertex:uZ,background_vert:hZ,background_frag:fZ,backgroundCube_vert:dZ,backgroundCube_frag:pZ,cube_vert:mZ,cube_frag:gZ,depth_vert:AZ,depth_frag:yZ,distanceRGBA_vert:vZ,distanceRGBA_frag:xZ,equirect_vert:EZ,equirect_frag:_Z,linedashed_vert:SZ,linedashed_frag:wZ,meshbasic_vert:CZ,meshbasic_frag:TZ,meshlambert_vert:bZ,meshlambert_frag:IZ,meshmatcap_vert:MZ,meshmatcap_frag:RZ,meshnormal_vert:PZ,meshnormal_frag:LZ,meshphong_vert:BZ,meshphong_frag:DZ,meshphysical_vert:kZ,meshphysical_frag:FZ,meshtoon_vert:OZ,meshtoon_frag:NZ,points_vert:UZ,points_frag:zZ,shadow_vert:GZ,shadow_frag:HZ,sprite_vert:QZ,sprite_frag:VZ},Ot={common:{diffuse:{value:new ut(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new Tn},alphaMap:{value:null},alphaMapTransform:{value:new Tn},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new Tn}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new Tn}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new Tn}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new Tn},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new Tn},normalScale:{value:new Ue(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new Tn},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new Tn}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new Tn}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new Tn}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new ut(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new ut(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new Tn},alphaTest:{value:0},uvTransform:{value:new Tn}},sprite:{diffuse:{value:new ut(16777215)},opacity:{value:1},center:{value:new Ue(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new Tn},alphaMap:{value:null},alphaMapTransform:{value:new Tn},alphaTest:{value:0}}},du={basic:{uniforms:Aa([Ot.common,Ot.specularmap,Ot.envmap,Ot.aomap,Ot.lightmap,Ot.fog]),vertexShader:Un.meshbasic_vert,fragmentShader:Un.meshbasic_frag},lambert:{uniforms:Aa([Ot.common,Ot.specularmap,Ot.envmap,Ot.aomap,Ot.lightmap,Ot.emissivemap,Ot.bumpmap,Ot.normalmap,Ot.displacementmap,Ot.fog,Ot.lights,{emissive:{value:new ut(0)}}]),vertexShader:Un.meshlambert_vert,fragmentShader:Un.meshlambert_frag},phong:{uniforms:Aa([Ot.common,Ot.specularmap,Ot.envmap,Ot.aomap,Ot.lightmap,Ot.emissivemap,Ot.bumpmap,Ot.normalmap,Ot.displacementmap,Ot.fog,Ot.lights,{emissive:{value:new ut(0)},specular:{value:new ut(1118481)},shininess:{value:30}}]),vertexShader:Un.meshphong_vert,fragmentShader:Un.meshphong_frag},standard:{uniforms:Aa([Ot.common,Ot.envmap,Ot.aomap,Ot.lightmap,Ot.emissivemap,Ot.bumpmap,Ot.normalmap,Ot.displacementmap,Ot.roughnessmap,Ot.metalnessmap,Ot.fog,Ot.lights,{emissive:{value:new ut(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Un.meshphysical_vert,fragmentShader:Un.meshphysical_frag},toon:{uniforms:Aa([Ot.common,Ot.aomap,Ot.lightmap,Ot.emissivemap,Ot.bumpmap,Ot.normalmap,Ot.displacementmap,Ot.gradientmap,Ot.fog,Ot.lights,{emissive:{value:new ut(0)}}]),vertexShader:Un.meshtoon_vert,fragmentShader:Un.meshtoon_frag},matcap:{uniforms:Aa([Ot.common,Ot.bumpmap,Ot.normalmap,Ot.displacementmap,Ot.fog,{matcap:{value:null}}]),vertexShader:Un.meshmatcap_vert,fragmentShader:Un.meshmatcap_frag},points:{uniforms:Aa([Ot.points,Ot.fog]),vertexShader:Un.points_vert,fragmentShader:Un.points_frag},dashed:{uniforms:Aa([Ot.common,Ot.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Un.linedashed_vert,fragmentShader:Un.linedashed_frag},depth:{uniforms:Aa([Ot.common,Ot.displacementmap]),vertexShader:Un.depth_vert,fragmentShader:Un.depth_frag},normal:{uniforms:Aa([Ot.common,Ot.bumpmap,Ot.normalmap,Ot.displacementmap,{opacity:{value:1}}]),vertexShader:Un.meshnormal_vert,fragmentShader:Un.meshnormal_frag},sprite:{uniforms:Aa([Ot.sprite,Ot.fog]),vertexShader:Un.sprite_vert,fragmentShader:Un.sprite_frag},background:{uniforms:{uvTransform:{value:new Tn},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:Un.background_vert,fragmentShader:Un.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1}},vertexShader:Un.backgroundCube_vert,fragmentShader:Un.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Un.cube_vert,fragmentShader:Un.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Un.equirect_vert,fragmentShader:Un.equirect_frag},distanceRGBA:{uniforms:Aa([Ot.common,Ot.displacementmap,{referencePosition:{value:new Q},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Un.distanceRGBA_vert,fragmentShader:Un.distanceRGBA_frag},shadow:{uniforms:Aa([Ot.lights,Ot.fog,{color:{value:new ut(0)},opacity:{value:1}}]),vertexShader:Un.shadow_vert,fragmentShader:Un.shadow_frag}};du.physical={uniforms:Aa([du.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new Tn},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new Tn},clearcoatNormalScale:{value:new Ue(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new Tn},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new Tn},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new Tn},sheen:{value:0},sheenColor:{value:new ut(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new Tn},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new Tn},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new Tn},transmissionSamplerSize:{value:new Ue},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new Tn},attenuationDistance:{value:0},attenuationColor:{value:new ut(0)},specularColor:{value:new ut(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new Tn},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new Tn},anisotropyVector:{value:new Ue},anisotropyMap:{value:null},anisotropyMapTransform:{value:new Tn}}]),vertexShader:Un.meshphysical_vert,fragmentShader:Un.meshphysical_frag};const X3={r:0,b:0,g:0};function jZ(i,e,t,n,r,s,o){const a=new ut(0);let l=s===!0?0:1,c,u,h=null,f=0,d=null;function m(g,A){let E=!1,x=A.isScene===!0?A.background:null;x&&x.isTexture&&(x=(A.backgroundBlurriness>0?t:e).get(x)),x===null?y(a,l):x&&x.isColor&&(y(x,1),E=!0);const w=i.xr.getEnvironmentBlendMode();w==="additive"?n.buffers.color.setClear(0,0,0,1,o):w==="alpha-blend"&&n.buffers.color.setClear(0,0,0,0,o),(i.autoClear||E)&&i.clear(i.autoClearColor,i.autoClearDepth,i.autoClearStencil),x&&(x.isCubeTexture||x.mapping===SA)?(u===void 0&&(u=new It(new ya(1,1,1),new Mi({name:"BackgroundCubeMaterial",uniforms:rA(du.backgroundCube.uniforms),vertexShader:du.backgroundCube.vertexShader,fragmentShader:du.backgroundCube.fragmentShader,side:ys,depthTest:!1,depthWrite:!1,fog:!1})),u.geometry.deleteAttribute("normal"),u.geometry.deleteAttribute("uv"),u.onBeforeRender=function(T,I,M){this.matrixWorld.copyPosition(M.matrixWorld)},Object.defineProperty(u.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(u)),u.material.uniforms.envMap.value=x,u.material.uniforms.flipEnvMap.value=x.isCubeTexture&&x.isRenderTargetTexture===!1?-1:1,u.material.uniforms.backgroundBlurriness.value=A.backgroundBlurriness,u.material.uniforms.backgroundIntensity.value=A.backgroundIntensity,u.material.toneMapped=Vi.getTransfer(x.colorSpace)!==mr,(h!==x||f!==x.version||d!==i.toneMapping)&&(u.material.needsUpdate=!0,h=x,f=x.version,d=i.toneMapping),u.layers.enableAll(),g.unshift(u,u.geometry,u.material,0,0,null)):x&&x.isTexture&&(c===void 0&&(c=new It(new Fs(2,2),new Mi({name:"BackgroundMaterial",uniforms:rA(du.background.uniforms),vertexShader:du.background.vertexShader,fragmentShader:du.background.fragmentShader,side:tl,depthTest:!1,depthWrite:!1,fog:!1})),c.geometry.deleteAttribute("normal"),Object.defineProperty(c.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(c)),c.material.uniforms.t2D.value=x,c.material.uniforms.backgroundIntensity.value=A.backgroundIntensity,c.material.toneMapped=Vi.getTransfer(x.colorSpace)!==mr,x.matrixAutoUpdate===!0&&x.updateMatrix(),c.material.uniforms.uvTransform.value.copy(x.matrix),(h!==x||f!==x.version||d!==i.toneMapping)&&(c.material.needsUpdate=!0,h=x,f=x.version,d=i.toneMapping),c.layers.enableAll(),g.unshift(c,c.geometry,c.material,0,0,null))}function y(g,A){g.getRGB(X3,VU(i)),n.buffers.color.setClear(X3.r,X3.g,X3.b,A,o)}return{getClearColor:function(){return a},setClearColor:function(g,A=1){a.set(g),l=A,y(a,l)},getClearAlpha:function(){return l},setClearAlpha:function(g){l=g,y(a,l)},render:m}}function WZ(i,e,t,n){const r=i.getParameter(i.MAX_VERTEX_ATTRIBS),s=n.isWebGL2?null:e.get("OES_vertex_array_object"),o=n.isWebGL2||s!==null,a={},l=g(null);let c=l,u=!1;function h(G,X,Z,oe,K){let V=!1;if(o){const W=y(oe,Z,X);c!==W&&(c=W,d(c.object)),V=A(G,oe,Z,K),V&&E(G,oe,Z,K)}else{const W=X.wireframe===!0;(c.geometry!==oe.id||c.program!==Z.id||c.wireframe!==W)&&(c.geometry=oe.id,c.program=Z.id,c.wireframe=W,V=!0)}K!==null&&t.update(K,i.ELEMENT_ARRAY_BUFFER),(V||u)&&(u=!1,L(G,X,Z,oe),K!==null&&i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,t.get(K).buffer))}function f(){return n.isWebGL2?i.createVertexArray():s.createVertexArrayOES()}function d(G){return n.isWebGL2?i.bindVertexArray(G):s.bindVertexArrayOES(G)}function m(G){return n.isWebGL2?i.deleteVertexArray(G):s.deleteVertexArrayOES(G)}function y(G,X,Z){const oe=Z.wireframe===!0;let K=a[G.id];K===void 0&&(K={},a[G.id]=K);let V=K[X.id];V===void 0&&(V={},K[X.id]=V);let W=V[oe];return W===void 0&&(W=g(f()),V[oe]=W),W}function g(G){const X=[],Z=[],oe=[];for(let K=0;K<r;K++)X[K]=0,Z[K]=0,oe[K]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:X,enabledAttributes:Z,attributeDivisors:oe,object:G,attributes:{},index:null}}function A(G,X,Z,oe){const K=c.attributes,V=X.attributes;let W=0;const F=Z.getAttributes();for(const Y in F)if(F[Y].location>=0){const q=K[Y];let J=V[Y];if(J===void 0&&(Y==="instanceMatrix"&&G.instanceMatrix&&(J=G.instanceMatrix),Y==="instanceColor"&&G.instanceColor&&(J=G.instanceColor)),q===void 0||q.attribute!==J||J&&q.data!==J.data)return!0;W++}return c.attributesNum!==W||c.index!==oe}function E(G,X,Z,oe){const K={},V=X.attributes;let W=0;const F=Z.getAttributes();for(const Y in F)if(F[Y].location>=0){let q=V[Y];q===void 0&&(Y==="instanceMatrix"&&G.instanceMatrix&&(q=G.instanceMatrix),Y==="instanceColor"&&G.instanceColor&&(q=G.instanceColor));const J={};J.attribute=q,q&&q.data&&(J.data=q.data),K[Y]=J,W++}c.attributes=K,c.attributesNum=W,c.index=oe}function x(){const G=c.newAttributes;for(let X=0,Z=G.length;X<Z;X++)G[X]=0}function w(G){T(G,0)}function T(G,X){const Z=c.newAttributes,oe=c.enabledAttributes,K=c.attributeDivisors;Z[G]=1,oe[G]===0&&(i.enableVertexAttribArray(G),oe[G]=1),K[G]!==X&&((n.isWebGL2?i:e.get("ANGLE_instanced_arrays"))[n.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](G,X),K[G]=X)}function I(){const G=c.newAttributes,X=c.enabledAttributes;for(let Z=0,oe=X.length;Z<oe;Z++)X[Z]!==G[Z]&&(i.disableVertexAttribArray(Z),X[Z]=0)}function M(G,X,Z,oe,K,V,W){W===!0?i.vertexAttribIPointer(G,X,Z,K,V):i.vertexAttribPointer(G,X,Z,oe,K,V)}function L(G,X,Z,oe){if(n.isWebGL2===!1&&(G.isInstancedMesh||oe.isInstancedBufferGeometry)&&e.get("ANGLE_instanced_arrays")===null)return;x();const K=oe.attributes,V=Z.getAttributes(),W=X.defaultAttributeValues;for(const F in V){const Y=V[F];if(Y.location>=0){let te=K[F];if(te===void 0&&(F==="instanceMatrix"&&G.instanceMatrix&&(te=G.instanceMatrix),F==="instanceColor"&&G.instanceColor&&(te=G.instanceColor)),te!==void 0){const q=te.normalized,J=te.itemSize,re=t.get(te);if(re===void 0)continue;const ie=re.buffer,se=re.type,ge=re.bytesPerElement,xe=n.isWebGL2===!0&&(se===i.INT||se===i.UNSIGNED_INT||te.gpuType===Um);if(te.isInterleavedBufferAttribute){const pe=te.data,ue=pe.stride,Me=te.offset;if(pe.isInstancedInterleavedBuffer){for(let Se=0;Se<Y.locationSize;Se++)T(Y.location+Se,pe.meshPerAttribute);G.isInstancedMesh!==!0&&oe._maxInstanceCount===void 0&&(oe._maxInstanceCount=pe.meshPerAttribute*pe.count)}else for(let Se=0;Se<Y.locationSize;Se++)w(Y.location+Se);i.bindBuffer(i.ARRAY_BUFFER,ie);for(let Se=0;Se<Y.locationSize;Se++)M(Y.location+Se,J/Y.locationSize,se,q,ue*ge,(Me+J/Y.locationSize*Se)*ge,xe)}else{if(te.isInstancedBufferAttribute){for(let pe=0;pe<Y.locationSize;pe++)T(Y.location+pe,te.meshPerAttribute);G.isInstancedMesh!==!0&&oe._maxInstanceCount===void 0&&(oe._maxInstanceCount=te.meshPerAttribute*te.count)}else for(let pe=0;pe<Y.locationSize;pe++)w(Y.location+pe);i.bindBuffer(i.ARRAY_BUFFER,ie);for(let pe=0;pe<Y.locationSize;pe++)M(Y.location+pe,J/Y.locationSize,se,q,J*ge,J/Y.locationSize*pe*ge,xe)}}else if(W!==void 0){const q=W[F];if(q!==void 0)switch(q.length){case 2:i.vertexAttrib2fv(Y.location,q);break;case 3:i.vertexAttrib3fv(Y.location,q);break;case 4:i.vertexAttrib4fv(Y.location,q);break;default:i.vertexAttrib1fv(Y.location,q)}}}}I()}function P(){k();for(const G in a){const X=a[G];for(const Z in X){const oe=X[Z];for(const K in oe)m(oe[K].object),delete oe[K];delete X[Z]}delete a[G]}}function R(G){if(a[G.id]===void 0)return;const X=a[G.id];for(const Z in X){const oe=X[Z];for(const K in oe)m(oe[K].object),delete oe[K];delete X[Z]}delete a[G.id]}function U(G){for(const X in a){const Z=a[X];if(Z[G.id]===void 0)continue;const oe=Z[G.id];for(const K in oe)m(oe[K].object),delete oe[K];delete Z[G.id]}}function k(){H(),u=!0,c!==l&&(c=l,d(c.object))}function H(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:h,reset:k,resetDefaultState:H,dispose:P,releaseStatesOfGeometry:R,releaseStatesOfProgram:U,initAttributes:x,enableAttribute:w,disableUnusedAttributes:I}}function KZ(i,e,t,n){const r=n.isWebGL2;let s;function o(u){s=u}function a(u,h){i.drawArrays(s,u,h),t.update(h,s,1)}function l(u,h,f){if(f===0)return;let d,m;if(r)d=i,m="drawArraysInstanced";else if(d=e.get("ANGLE_instanced_arrays"),m="drawArraysInstancedANGLE",d===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}d[m](s,u,h,f),t.update(h,s,f)}function c(u,h,f){if(f===0)return;const d=e.get("WEBGL_multi_draw");if(d===null)for(let m=0;m<f;m++)this.render(u[m],h[m]);else{d.multiDrawArraysWEBGL(s,u,0,h,0,f);let m=0;for(let y=0;y<f;y++)m+=h[y];t.update(m,s,1)}}this.setMode=o,this.render=a,this.renderInstances=l,this.renderMultiDraw=c}function YZ(i,e,t){let n;function r(){if(n!==void 0)return n;if(e.has("EXT_texture_filter_anisotropic")===!0){const M=e.get("EXT_texture_filter_anisotropic");n=i.getParameter(M.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else n=0;return n}function s(M){if(M==="highp"){if(i.getShaderPrecisionFormat(i.VERTEX_SHADER,i.HIGH_FLOAT).precision>0&&i.getShaderPrecisionFormat(i.FRAGMENT_SHADER,i.HIGH_FLOAT).precision>0)return"highp";M="mediump"}return M==="mediump"&&i.getShaderPrecisionFormat(i.VERTEX_SHADER,i.MEDIUM_FLOAT).precision>0&&i.getShaderPrecisionFormat(i.FRAGMENT_SHADER,i.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}const o=typeof WebGL2RenderingContext<"u"&&i.constructor.name==="WebGL2RenderingContext";let a=t.precision!==void 0?t.precision:"highp";const l=s(a);l!==a&&(console.warn("THREE.WebGLRenderer:",a,"not supported, using",l,"instead."),a=l);const c=o||e.has("WEBGL_draw_buffers"),u=t.logarithmicDepthBuffer===!0,h=i.getParameter(i.MAX_TEXTURE_IMAGE_UNITS),f=i.getParameter(i.MAX_VERTEX_TEXTURE_IMAGE_UNITS),d=i.getParameter(i.MAX_TEXTURE_SIZE),m=i.getParameter(i.MAX_CUBE_MAP_TEXTURE_SIZE),y=i.getParameter(i.MAX_VERTEX_ATTRIBS),g=i.getParameter(i.MAX_VERTEX_UNIFORM_VECTORS),A=i.getParameter(i.MAX_VARYING_VECTORS),E=i.getParameter(i.MAX_FRAGMENT_UNIFORM_VECTORS),x=f>0,w=o||e.has("OES_texture_float"),T=x&&w,I=o?i.getParameter(i.MAX_SAMPLES):0;return{isWebGL2:o,drawBuffers:c,getMaxAnisotropy:r,getMaxPrecision:s,precision:a,logarithmicDepthBuffer:u,maxTextures:h,maxVertexTextures:f,maxTextureSize:d,maxCubemapSize:m,maxAttributes:y,maxVertexUniforms:g,maxVaryings:A,maxFragmentUniforms:E,vertexTextures:x,floatFragmentTextures:w,floatVertexTextures:T,maxSamples:I}}function $Z(i){const e=this;let t=null,n=0,r=!1,s=!1;const o=new vo,a=new Tn,l={value:null,needsUpdate:!1};this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(h,f){const d=h.length!==0||f||n!==0||r;return r=f,n=h.length,d},this.beginShadows=function(){s=!0,u(null)},this.endShadows=function(){s=!1},this.setGlobalState=function(h,f){t=u(h,f,0)},this.setState=function(h,f,d){const m=h.clippingPlanes,y=h.clipIntersection,g=h.clipShadows,A=i.get(h);if(!r||m===null||m.length===0||s&&!g)s?u(null):c();else{const E=s?0:n,x=E*4;let w=A.clippingState||null;l.value=w,w=u(m,f,x,d);for(let T=0;T!==x;++T)w[T]=t[T];A.clippingState=w,this.numIntersection=y?this.numPlanes:0,this.numPlanes+=E}};function c(){l.value!==t&&(l.value=t,l.needsUpdate=n>0),e.numPlanes=n,e.numIntersection=0}function u(h,f,d,m){const y=h!==null?h.length:0;let g=null;if(y!==0){if(g=l.value,m!==!0||g===null){const A=d+y*4,E=f.matrixWorldInverse;a.getNormalMatrix(E),(g===null||g.length<A)&&(g=new Float32Array(A));for(let x=0,w=d;x!==y;++x,w+=4)o.copy(h[x]).applyMatrix4(E,a),o.normal.toArray(g,w),g[w+3]=o.constant}l.value=g,l.needsUpdate=!0}return e.numPlanes=y,e.numIntersection=0,g}}function XZ(i){let e=new WeakMap;function t(o,a){return a===Xm?o.mapping=_u:a===_2&&(o.mapping=ip),o}function n(o){if(o&&o.isTexture){const a=o.mapping;if(a===Xm||a===_2)if(e.has(o)){const l=e.get(o).texture;return t(l,o.mapping)}else{const l=o.image;if(l&&l.height>0){const c=new wA(l.height/2);return c.fromEquirectangularTexture(i,o),e.set(o,c),o.addEventListener("dispose",r),t(c.texture,o.mapping)}else return null}}return o}function r(o){const a=o.target;a.removeEventListener("dispose",r);const l=e.get(a);l!==void 0&&(e.delete(a),l.dispose())}function s(){e=new WeakMap}return{get:n,dispose:s}}let qi=class extends h0{constructor(e=-1,t=1,n=1,r=-1,s=.1,o=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=n,this.bottom=r,this.near=s,this.far=o,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,n,r,s,o){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=s,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,r=(this.top+this.bottom)/2;let s=n-e,o=n+e,a=r+t,l=r-t;if(this.view!==null&&this.view.enabled){const c=(this.right-this.left)/this.view.fullWidth/this.zoom,u=(this.top-this.bottom)/this.view.fullHeight/this.zoom;s+=c*this.view.offsetX,o=s+c*this.view.width,a-=u*this.view.offsetY,l=a-u*this.view.height}this.projectionMatrix.makeOrthographic(s,o,a,l,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}};const P1=4,wL=[.125,.215,.35,.446,.526,.582],bm=20,sT=new qi,CL=new ut;let oT=null,aT=0,lT=0;const wm=(1+Math.sqrt(5))/2,Cg=1/wm,TL=[new Q(1,1,1),new Q(-1,1,1),new Q(1,1,-1),new Q(-1,1,-1),new Q(0,wm,Cg),new Q(0,wm,-Cg),new Q(Cg,0,wm),new Q(-Cg,0,wm),new Q(wm,Cg,0),new Q(-wm,Cg,0)];class RM{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,n=.1,r=100){oT=this._renderer.getRenderTarget(),aT=this._renderer.getActiveCubeFace(),lT=this._renderer.getActiveMipmapLevel(),this._setSize(256);const s=this._allocateTargets();return s.depthBuffer=!0,this._sceneToCubeUV(e,n,r,s),t>0&&this._blur(s,0,0,t),this._applyPMREM(s),this._cleanup(s),s}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=ML(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=IL(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(oT,aT,lT),e.scissorTest=!1,q3(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===_u||e.mapping===ip?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),oT=this._renderer.getRenderTarget(),aT=this._renderer.getActiveCubeFace(),lT=this._renderer.getActiveMipmapLevel();const n=t||this._allocateTargets();return this._textureToCubeUV(e,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,n={magFilter:Ln,minFilter:Ln,generateMipmaps:!1,type:Ni,format:gi,colorSpace:Dl,depthBuffer:!1},r=bL(e,t,n);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=bL(e,t,n);const{_lodMax:s}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=qZ(s)),this._blurMaterial=JZ(s,e,t)}return r}_compileMaterial(e){const t=new It(this._lodPlanes[0],e);this._renderer.compile(t,sT)}_sceneToCubeUV(e,t,n,r){const a=new jn(90,1,t,n),l=[1,-1,1,1,1,1],c=[1,1,1,-1,-1,-1],u=this._renderer,h=u.autoClear,f=u.toneMapping;u.getClearColor(CL),u.toneMapping=yu,u.autoClear=!1;const d=new no({name:"PMREM.Background",side:ys,depthWrite:!1,depthTest:!1}),m=new It(new ya,d);let y=!1;const g=e.background;g?g.isColor&&(d.color.copy(g),e.background=null,y=!0):(d.color.copy(CL),y=!0);for(let A=0;A<6;A++){const E=A%3;E===0?(a.up.set(0,l[A],0),a.lookAt(c[A],0,0)):E===1?(a.up.set(0,0,l[A]),a.lookAt(0,c[A],0)):(a.up.set(0,l[A],0),a.lookAt(0,0,c[A]));const x=this._cubeSize;q3(r,E*x,A>2?x:0,x,x),u.setRenderTarget(r),y&&u.render(m,a),u.render(e,a)}m.geometry.dispose(),m.material.dispose(),u.toneMapping=f,u.autoClear=h,e.background=g}_textureToCubeUV(e,t){const n=this._renderer,r=e.mapping===_u||e.mapping===ip;r?(this._cubemapMaterial===null&&(this._cubemapMaterial=ML()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=IL());const s=r?this._cubemapMaterial:this._equirectMaterial,o=new It(this._lodPlanes[0],s),a=s.uniforms;a.envMap.value=e;const l=this._cubeSize;q3(t,0,0,3*l,2*l),n.setRenderTarget(t),n.render(o,sT)}_applyPMREM(e){const t=this._renderer,n=t.autoClear;t.autoClear=!1;for(let r=1;r<this._lodPlanes.length;r++){const s=Math.sqrt(this._sigmas[r]*this._sigmas[r]-this._sigmas[r-1]*this._sigmas[r-1]),o=TL[(r-1)%TL.length];this._blur(e,r-1,r,s,o)}t.autoClear=n}_blur(e,t,n,r,s){const o=this._pingPongRenderTarget;this._halfBlur(e,o,t,n,r,"latitudinal",s),this._halfBlur(o,e,n,n,r,"longitudinal",s)}_halfBlur(e,t,n,r,s,o,a){const l=this._renderer,c=this._blurMaterial;o!=="latitudinal"&&o!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const u=3,h=new It(this._lodPlanes[r],c),f=c.uniforms,d=this._sizeLods[n]-1,m=isFinite(s)?Math.PI/(2*d):2*Math.PI/(2*bm-1),y=s/m,g=isFinite(s)?1+Math.floor(u*y):bm;g>bm&&console.warn(`sigmaRadians, ${s}, is too large and will clip, as it requested ${g} samples when the maximum is set to ${bm}`);const A=[];let E=0;for(let M=0;M<bm;++M){const L=M/y,P=Math.exp(-L*L/2);A.push(P),M===0?E+=P:M<g&&(E+=2*P)}for(let M=0;M<A.length;M++)A[M]=A[M]/E;f.envMap.value=e.texture,f.samples.value=g,f.weights.value=A,f.latitudinal.value=o==="latitudinal",a&&(f.poleAxis.value=a);const{_lodMax:x}=this;f.dTheta.value=m,f.mipInt.value=x-n;const w=this._sizeLods[r],T=3*w*(r>x-P1?r-x+P1:0),I=4*(this._cubeSize-w);q3(t,T,I,3*w,2*w),l.setRenderTarget(t),l.render(h,sT)}}function qZ(i){const e=[],t=[],n=[];let r=i;const s=i-P1+1+wL.length;for(let o=0;o<s;o++){const a=Math.pow(2,r);t.push(a);let l=1/a;o>i-P1?l=wL[o-i+P1-1]:o===0&&(l=0),n.push(l);const c=1/(a-2),u=-c,h=1+c,f=[u,u,h,u,h,h,u,u,h,h,u,h],d=6,m=6,y=3,g=2,A=1,E=new Float32Array(y*m*d),x=new Float32Array(g*m*d),w=new Float32Array(A*m*d);for(let I=0;I<d;I++){const M=I%3*2/3-1,L=I>2?0:-1,P=[M,L,0,M+2/3,L,0,M+2/3,L+1,0,M,L,0,M+2/3,L+1,0,M,L+1,0];E.set(P,y*m*I),x.set(f,g*m*I);const R=[I,I,I,I,I,I];w.set(R,A*m*I)}const T=new fn;T.setAttribute("position",new mn(E,y)),T.setAttribute("uv",new mn(x,g)),T.setAttribute("faceIndex",new mn(w,A)),e.push(T),r>P1&&r--}return{lodPlanes:e,sizeLods:t,sigmas:n}}function bL(i,e,t){const n=new Si(i,e,t);return n.texture.mapping=SA,n.texture.name="PMREM.cubeUv",n.scissorTest=!0,n}function q3(i,e,t,n,r){i.viewport.set(e,t,n,r),i.scissor.set(e,t,n,r)}function JZ(i,e,t){const n=new Float32Array(bm),r=new Q(0,1,0);return new Mi({name:"SphericalGaussianBlur",defines:{n:bm,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:`${i}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:n},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:r}},vertexShader:R6(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:gc,depthTest:!1,depthWrite:!1})}function IL(){return new Mi({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:R6(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:gc,depthTest:!1,depthWrite:!1})}function ML(){return new Mi({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:R6(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:gc,depthTest:!1,depthWrite:!1})}function R6(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function ZZ(i){let e=new WeakMap,t=null;function n(a){if(a&&a.isTexture){const l=a.mapping,c=l===Xm||l===_2,u=l===_u||l===ip;if(c||u)if(a.isRenderTargetTexture&&a.needsPMREMUpdate===!0){a.needsPMREMUpdate=!1;let h=e.get(a);return t===null&&(t=new RM(i)),h=c?t.fromEquirectangular(a,h):t.fromCubemap(a,h),e.set(a,h),h.texture}else{if(e.has(a))return e.get(a).texture;{const h=a.image;if(c&&h&&h.height>0||u&&h&&r(h)){t===null&&(t=new RM(i));const f=c?t.fromEquirectangular(a):t.fromCubemap(a);return e.set(a,f),a.addEventListener("dispose",s),f.texture}else return null}}}return a}function r(a){let l=0;const c=6;for(let u=0;u<c;u++)a[u]!==void 0&&l++;return l===c}function s(a){const l=a.target;l.removeEventListener("dispose",s);const c=e.get(l);c!==void 0&&(e.delete(l),c.dispose())}function o(){e=new WeakMap,t!==null&&(t.dispose(),t=null)}return{get:n,dispose:o}}function eee(i){const e={};function t(n){if(e[n]!==void 0)return e[n];let r;switch(n){case"WEBGL_depth_texture":r=i.getExtension("WEBGL_depth_texture")||i.getExtension("MOZ_WEBGL_depth_texture")||i.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=i.getExtension("EXT_texture_filter_anisotropic")||i.getExtension("MOZ_EXT_texture_filter_anisotropic")||i.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=i.getExtension("WEBGL_compressed_texture_s3tc")||i.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||i.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=i.getExtension("WEBGL_compressed_texture_pvrtc")||i.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=i.getExtension(n)}return e[n]=r,r}return{has:function(n){return t(n)!==null},init:function(n){n.isWebGL2?(t("EXT_color_buffer_float"),t("WEBGL_clip_cull_distance")):(t("WEBGL_depth_texture"),t("OES_texture_float"),t("OES_texture_half_float"),t("OES_texture_half_float_linear"),t("OES_standard_derivatives"),t("OES_element_index_uint"),t("OES_vertex_array_object"),t("ANGLE_instanced_arrays")),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float"),t("WEBGL_multisampled_render_to_texture")},get:function(n){const r=t(n);return r===null&&console.warn("THREE.WebGLRenderer: "+n+" extension not supported."),r}}}function tee(i,e,t,n){const r={},s=new WeakMap;function o(h){const f=h.target;f.index!==null&&e.remove(f.index);for(const m in f.attributes)e.remove(f.attributes[m]);for(const m in f.morphAttributes){const y=f.morphAttributes[m];for(let g=0,A=y.length;g<A;g++)e.remove(y[g])}f.removeEventListener("dispose",o),delete r[f.id];const d=s.get(f);d&&(e.remove(d),s.delete(f)),n.releaseStatesOfGeometry(f),f.isInstancedBufferGeometry===!0&&delete f._maxInstanceCount,t.memory.geometries--}function a(h,f){return r[f.id]===!0||(f.addEventListener("dispose",o),r[f.id]=!0,t.memory.geometries++),f}function l(h){const f=h.attributes;for(const m in f)e.update(f[m],i.ARRAY_BUFFER);const d=h.morphAttributes;for(const m in d){const y=d[m];for(let g=0,A=y.length;g<A;g++)e.update(y[g],i.ARRAY_BUFFER)}}function c(h){const f=[],d=h.index,m=h.attributes.position;let y=0;if(d!==null){const E=d.array;y=d.version;for(let x=0,w=E.length;x<w;x+=3){const T=E[x+0],I=E[x+1],M=E[x+2];f.push(T,I,I,M,M,T)}}else if(m!==void 0){const E=m.array;y=m.version;for(let x=0,w=E.length/3-1;x<w;x+=3){const T=x+0,I=x+1,M=x+2;f.push(T,I,I,M,M,T)}}else return;const g=new(zU(f)?M6:bw)(f,1);g.version=y;const A=s.get(h);A&&e.remove(A),s.set(h,g)}function u(h){const f=s.get(h);if(f){const d=h.index;d!==null&&f.version<d.version&&c(h)}else c(h);return s.get(h)}return{get:a,update:l,getWireframeAttribute:u}}function nee(i,e,t,n){const r=n.isWebGL2;let s;function o(d){s=d}let a,l;function c(d){a=d.type,l=d.bytesPerElement}function u(d,m){i.drawElements(s,m,a,d*l),t.update(m,s,1)}function h(d,m,y){if(y===0)return;let g,A;if(r)g=i,A="drawElementsInstanced";else if(g=e.get("ANGLE_instanced_arrays"),A="drawElementsInstancedANGLE",g===null){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}g[A](s,m,a,d*l,y),t.update(m,s,y)}function f(d,m,y){if(y===0)return;const g=e.get("WEBGL_multi_draw");if(g===null)for(let A=0;A<y;A++)this.render(d[A]/l,m[A]);else{g.multiDrawElementsWEBGL(s,m,0,a,d,0,y);let A=0;for(let E=0;E<y;E++)A+=m[E];t.update(A,s,1)}}this.setMode=o,this.setIndex=c,this.render=u,this.renderInstances=h,this.renderMultiDraw=f}function iee(i){const e={geometries:0,textures:0},t={frame:0,calls:0,triangles:0,points:0,lines:0};function n(s,o,a){switch(t.calls++,o){case i.TRIANGLES:t.triangles+=a*(s/3);break;case i.LINES:t.lines+=a*(s/2);break;case i.LINE_STRIP:t.lines+=a*(s-1);break;case i.LINE_LOOP:t.lines+=a*s;break;case i.POINTS:t.points+=a*s;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",o);break}}function r(){t.calls=0,t.triangles=0,t.points=0,t.lines=0}return{memory:e,render:t,programs:null,autoReset:!0,reset:r,update:n}}function ree(i,e){return i[0]-e[0]}function see(i,e){return Math.abs(e[1])-Math.abs(i[1])}function oee(i,e,t){const n={},r=new Float32Array(8),s=new WeakMap,o=new Rn,a=[];for(let c=0;c<8;c++)a[c]=[c,0];function l(c,u,h){const f=c.morphTargetInfluences;if(e.isWebGL2===!0){const d=u.morphAttributes.position||u.morphAttributes.normal||u.morphAttributes.color,m=d!==void 0?d.length:0;let y=s.get(u);if(y===void 0||y.count!==m){let G=function(){k.dispose(),s.delete(u),u.removeEventListener("dispose",G)};y!==void 0&&y.texture.dispose();const E=u.morphAttributes.position!==void 0,x=u.morphAttributes.normal!==void 0,w=u.morphAttributes.color!==void 0,T=u.morphAttributes.position||[],I=u.morphAttributes.normal||[],M=u.morphAttributes.color||[];let L=0;E===!0&&(L=1),x===!0&&(L=2),w===!0&&(L=3);let P=u.attributes.position.count*L,R=1;P>e.maxTextureSize&&(R=Math.ceil(P/e.maxTextureSize),P=e.maxTextureSize);const U=new Float32Array(P*R*4*m),k=new Tw(U,P,R,m);k.type=fi,k.needsUpdate=!0;const H=L*4;for(let X=0;X<m;X++){const Z=T[X],oe=I[X],K=M[X],V=P*R*4*X;for(let W=0;W<Z.count;W++){const F=W*H;E===!0&&(o.fromBufferAttribute(Z,W),U[V+F+0]=o.x,U[V+F+1]=o.y,U[V+F+2]=o.z,U[V+F+3]=0),x===!0&&(o.fromBufferAttribute(oe,W),U[V+F+4]=o.x,U[V+F+5]=o.y,U[V+F+6]=o.z,U[V+F+7]=0),w===!0&&(o.fromBufferAttribute(K,W),U[V+F+8]=o.x,U[V+F+9]=o.y,U[V+F+10]=o.z,U[V+F+11]=K.itemSize===4?o.w:1)}}y={count:m,texture:k,size:new Ue(P,R)},s.set(u,y),u.addEventListener("dispose",G)}let g=0;for(let E=0;E<f.length;E++)g+=f[E];const A=u.morphTargetsRelative?1:1-g;h.getUniforms().setValue(i,"morphTargetBaseInfluence",A),h.getUniforms().setValue(i,"morphTargetInfluences",f),h.getUniforms().setValue(i,"morphTargetsTexture",y.texture,t),h.getUniforms().setValue(i,"morphTargetsTextureSize",y.size)}else{const d=f===void 0?0:f.length;let m=n[u.id];if(m===void 0||m.length!==d){m=[];for(let x=0;x<d;x++)m[x]=[x,0];n[u.id]=m}for(let x=0;x<d;x++){const w=m[x];w[0]=x,w[1]=f[x]}m.sort(see);for(let x=0;x<8;x++)x<d&&m[x][1]?(a[x][0]=m[x][0],a[x][1]=m[x][1]):(a[x][0]=Number.MAX_SAFE_INTEGER,a[x][1]=0);a.sort(ree);const y=u.morphAttributes.position,g=u.morphAttributes.normal;let A=0;for(let x=0;x<8;x++){const w=a[x],T=w[0],I=w[1];T!==Number.MAX_SAFE_INTEGER&&I?(y&&u.getAttribute("morphTarget"+x)!==y[T]&&u.setAttribute("morphTarget"+x,y[T]),g&&u.getAttribute("morphNormal"+x)!==g[T]&&u.setAttribute("morphNormal"+x,g[T]),r[x]=I,A+=I):(y&&u.hasAttribute("morphTarget"+x)===!0&&u.deleteAttribute("morphTarget"+x),g&&u.hasAttribute("morphNormal"+x)===!0&&u.deleteAttribute("morphNormal"+x),r[x]=0)}const E=u.morphTargetsRelative?1:1-A;h.getUniforms().setValue(i,"morphTargetBaseInfluence",E),h.getUniforms().setValue(i,"morphTargetInfluences",r)}}return{update:l}}function aee(i,e,t,n){let r=new WeakMap;function s(l){const c=n.render.frame,u=l.geometry,h=e.get(l,u);if(r.get(h)!==c&&(e.update(h),r.set(h,c)),l.isInstancedMesh&&(l.hasEventListener("dispose",a)===!1&&l.addEventListener("dispose",a),r.get(l)!==c&&(t.update(l.instanceMatrix,i.ARRAY_BUFFER),l.instanceColor!==null&&t.update(l.instanceColor,i.ARRAY_BUFFER),r.set(l,c))),l.isSkinnedMesh){const f=l.skeleton;r.get(f)!==c&&(f.update(),r.set(f,c))}return h}function o(){r=new WeakMap}function a(l){const c=l.target;c.removeEventListener("dispose",a),t.remove(c.instanceMatrix),c.instanceColor!==null&&t.remove(c.instanceColor)}return{update:s,dispose:o}}class d0 extends vi{constructor(e,t,n,r,s,o,a,l,c,u){if(u=u!==void 0?u:vu,u!==vu&&u!==qm)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");n===void 0&&u===vu&&(n=Zo),n===void 0&&u===qm&&(n=Yd),super(null,r,s,o,a,l,u,n,c),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=a!==void 0?a:zn,this.minFilter=l!==void 0?l:zn,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return this.compareFunction!==null&&(t.compareFunction=this.compareFunction),t}}const WU=new vi,KU=new d0(1,1);KU.compareFunction=C6;const YU=new Tw,$U=new I6,XU=new ox,RL=[],PL=[],LL=new Float32Array(16),BL=new Float32Array(9),DL=new Float32Array(4);function CA(i,e,t){const n=i[0];if(n<=0||n>0)return i;const r=e*t;let s=RL[r];if(s===void 0&&(s=new Float32Array(r),RL[r]=s),e!==0){n.toArray(s,0);for(let o=1,a=0;o!==e;++o)a+=t,i[o].toArray(s,a)}return s}function so(i,e){if(i.length!==e.length)return!1;for(let t=0,n=i.length;t<n;t++)if(i[t]!==e[t])return!1;return!0}function oo(i,e){for(let t=0,n=e.length;t<n;t++)i[t]=e[t]}function Mw(i,e){let t=PL[e];t===void 0&&(t=new Int32Array(e),PL[e]=t);for(let n=0;n!==e;++n)t[n]=i.allocateTextureUnit();return t}function lee(i,e){const t=this.cache;t[0]!==e&&(i.uniform1f(this.addr,e),t[0]=e)}function cee(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(i.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(so(t,e))return;i.uniform2fv(this.addr,e),oo(t,e)}}function uee(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(i.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(e.r!==void 0)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(i.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(so(t,e))return;i.uniform3fv(this.addr,e),oo(t,e)}}function hee(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(i.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(so(t,e))return;i.uniform4fv(this.addr,e),oo(t,e)}}function fee(i,e){const t=this.cache,n=e.elements;if(n===void 0){if(so(t,e))return;i.uniformMatrix2fv(this.addr,!1,e),oo(t,e)}else{if(so(t,n))return;DL.set(n),i.uniformMatrix2fv(this.addr,!1,DL),oo(t,n)}}function dee(i,e){const t=this.cache,n=e.elements;if(n===void 0){if(so(t,e))return;i.uniformMatrix3fv(this.addr,!1,e),oo(t,e)}else{if(so(t,n))return;BL.set(n),i.uniformMatrix3fv(this.addr,!1,BL),oo(t,n)}}function pee(i,e){const t=this.cache,n=e.elements;if(n===void 0){if(so(t,e))return;i.uniformMatrix4fv(this.addr,!1,e),oo(t,e)}else{if(so(t,n))return;LL.set(n),i.uniformMatrix4fv(this.addr,!1,LL),oo(t,n)}}function mee(i,e){const t=this.cache;t[0]!==e&&(i.uniform1i(this.addr,e),t[0]=e)}function gee(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(i.uniform2i(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(so(t,e))return;i.uniform2iv(this.addr,e),oo(t,e)}}function Aee(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(i.uniform3i(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(so(t,e))return;i.uniform3iv(this.addr,e),oo(t,e)}}function yee(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(i.uniform4i(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(so(t,e))return;i.uniform4iv(this.addr,e),oo(t,e)}}function vee(i,e){const t=this.cache;t[0]!==e&&(i.uniform1ui(this.addr,e),t[0]=e)}function xee(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(i.uniform2ui(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(so(t,e))return;i.uniform2uiv(this.addr,e),oo(t,e)}}function Eee(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(i.uniform3ui(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(so(t,e))return;i.uniform3uiv(this.addr,e),oo(t,e)}}function _ee(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(i.uniform4ui(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(so(t,e))return;i.uniform4uiv(this.addr,e),oo(t,e)}}function See(i,e,t){const n=this.cache,r=t.allocateTextureUnit();n[0]!==r&&(i.uniform1i(this.addr,r),n[0]=r);const s=this.type===i.SAMPLER_2D_SHADOW?KU:WU;t.setTexture2D(e||s,r)}function wee(i,e,t){const n=this.cache,r=t.allocateTextureUnit();n[0]!==r&&(i.uniform1i(this.addr,r),n[0]=r),t.setTexture3D(e||$U,r)}function Cee(i,e,t){const n=this.cache,r=t.allocateTextureUnit();n[0]!==r&&(i.uniform1i(this.addr,r),n[0]=r),t.setTextureCube(e||XU,r)}function Tee(i,e,t){const n=this.cache,r=t.allocateTextureUnit();n[0]!==r&&(i.uniform1i(this.addr,r),n[0]=r),t.setTexture2DArray(e||YU,r)}function bee(i){switch(i){case 5126:return lee;case 35664:return cee;case 35665:return uee;case 35666:return hee;case 35674:return fee;case 35675:return dee;case 35676:return pee;case 5124:case 35670:return mee;case 35667:case 35671:return gee;case 35668:case 35672:return Aee;case 35669:case 35673:return yee;case 5125:return vee;case 36294:return xee;case 36295:return Eee;case 36296:return _ee;case 35678:case 36198:case 36298:case 36306:case 35682:return See;case 35679:case 36299:case 36307:return wee;case 35680:case 36300:case 36308:case 36293:return Cee;case 36289:case 36303:case 36311:case 36292:return Tee}}function Iee(i,e){i.uniform1fv(this.addr,e)}function Mee(i,e){const t=CA(e,this.size,2);i.uniform2fv(this.addr,t)}function Ree(i,e){const t=CA(e,this.size,3);i.uniform3fv(this.addr,t)}function Pee(i,e){const t=CA(e,this.size,4);i.uniform4fv(this.addr,t)}function Lee(i,e){const t=CA(e,this.size,4);i.uniformMatrix2fv(this.addr,!1,t)}function Bee(i,e){const t=CA(e,this.size,9);i.uniformMatrix3fv(this.addr,!1,t)}function Dee(i,e){const t=CA(e,this.size,16);i.uniformMatrix4fv(this.addr,!1,t)}function kee(i,e){i.uniform1iv(this.addr,e)}function Fee(i,e){i.uniform2iv(this.addr,e)}function Oee(i,e){i.uniform3iv(this.addr,e)}function Nee(i,e){i.uniform4iv(this.addr,e)}function Uee(i,e){i.uniform1uiv(this.addr,e)}function zee(i,e){i.uniform2uiv(this.addr,e)}function Gee(i,e){i.uniform3uiv(this.addr,e)}function Hee(i,e){i.uniform4uiv(this.addr,e)}function Qee(i,e,t){const n=this.cache,r=e.length,s=Mw(t,r);so(n,s)||(i.uniform1iv(this.addr,s),oo(n,s));for(let o=0;o!==r;++o)t.setTexture2D(e[o]||WU,s[o])}function Vee(i,e,t){const n=this.cache,r=e.length,s=Mw(t,r);so(n,s)||(i.uniform1iv(this.addr,s),oo(n,s));for(let o=0;o!==r;++o)t.setTexture3D(e[o]||$U,s[o])}function jee(i,e,t){const n=this.cache,r=e.length,s=Mw(t,r);so(n,s)||(i.uniform1iv(this.addr,s),oo(n,s));for(let o=0;o!==r;++o)t.setTextureCube(e[o]||XU,s[o])}function Wee(i,e,t){const n=this.cache,r=e.length,s=Mw(t,r);so(n,s)||(i.uniform1iv(this.addr,s),oo(n,s));for(let o=0;o!==r;++o)t.setTexture2DArray(e[o]||YU,s[o])}function Kee(i){switch(i){case 5126:return Iee;case 35664:return Mee;case 35665:return Ree;case 35666:return Pee;case 35674:return Lee;case 35675:return Bee;case 35676:return Dee;case 5124:case 35670:return kee;case 35667:case 35671:return Fee;case 35668:case 35672:return Oee;case 35669:case 35673:return Nee;case 5125:return Uee;case 36294:return zee;case 36295:return Gee;case 36296:return Hee;case 35678:case 36198:case 36298:case 36306:case 35682:return Qee;case 35679:case 36299:case 36307:return Vee;case 35680:case 36300:case 36308:case 36293:return jee;case 36289:case 36303:case 36311:case 36292:return Wee}}class Yee{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.type=t.type,this.setValue=bee(t.type)}}class $ee{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.type=t.type,this.size=t.size,this.setValue=Kee(t.type)}}class Xee{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,n){const r=this.seq;for(let s=0,o=r.length;s!==o;++s){const a=r[s];a.setValue(e,t[a.id],n)}}}const cT=/(\w+)(\])?(\[|\.)?/g;function kL(i,e){i.seq.push(e),i.map[e.id]=e}function qee(i,e,t){const n=i.name,r=n.length;for(cT.lastIndex=0;;){const s=cT.exec(n),o=cT.lastIndex;let a=s[1];const l=s[2]==="]",c=s[3];if(l&&(a=a|0),c===void 0||c==="["&&o+2===r){kL(t,c===void 0?new Yee(a,i,e):new $ee(a,i,e));break}else{let h=t.map[a];h===void 0&&(h=new Xee(a),kL(t,h)),t=h}}}class Y_{constructor(e,t){this.seq=[],this.map={};const n=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let r=0;r<n;++r){const s=e.getActiveUniform(t,r),o=e.getUniformLocation(t,s.name);qee(s,o,this)}}setValue(e,t,n,r){const s=this.map[t];s!==void 0&&s.setValue(e,n,r)}setOptional(e,t,n){const r=t[n];r!==void 0&&this.setValue(e,n,r)}static upload(e,t,n,r){for(let s=0,o=t.length;s!==o;++s){const a=t[s],l=n[a.id];l.needsUpdate!==!1&&a.setValue(e,l.value,r)}}static seqWithValue(e,t){const n=[];for(let r=0,s=e.length;r!==s;++r){const o=e[r];o.id in t&&n.push(o)}return n}}function FL(i,e,t){const n=i.createShader(e);return i.shaderSource(n,t),i.compileShader(n),n}const Jee=37297;let Zee=0;function ete(i,e){const t=i.split(`
`),n=[],r=Math.max(e-6,0),s=Math.min(e+6,t.length);for(let o=r;o<s;o++){const a=o+1;n.push(`${a===e?">":" "} ${a}: ${t[o]}`)}return n.join(`
`)}function tte(i){const e=Vi.getPrimaries(Vi.workingColorSpace),t=Vi.getPrimaries(i);let n;switch(e===t?n="":e===M2&&t===I2?n="LinearDisplayP3ToLinearSRGB":e===I2&&t===M2&&(n="LinearSRGBToLinearDisplayP3"),i){case Dl:case sx:return[n,"LinearTransferOETF"];case gs:case Cw:return[n,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space:",i),[n,"LinearTransferOETF"]}}function OL(i,e,t){const n=i.getShaderParameter(e,i.COMPILE_STATUS),r=i.getShaderInfoLog(e).trim();if(n&&r==="")return"";const s=/ERROR: 0:(\d+)/.exec(r);if(s){const o=parseInt(s[1]);return t.toUpperCase()+`

`+r+`

`+ete(i.getShaderSource(e),o)}else return r}function nte(i,e){const t=tte(e);return`vec4 ${i}( vec4 value ) { return ${t[0]}( ${t[1]}( value ) ); }`}function ite(i,e){let t;switch(e){case mU:t="Linear";break;case gU:t="Reinhard";break;case AU:t="OptimizedCineon";break;case v6:t="ACESFilmic";break;case vU:t="AgX";break;case yU:t="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),t="Linear"}return"vec3 "+i+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}function rte(i){return[i.extensionDerivatives||i.envMapCubeUVHeight||i.bumpMap||i.normalMapTangentSpace||i.clearcoatNormalMap||i.flatShading||i.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(i.extensionFragDepth||i.logarithmicDepthBuffer)&&i.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",i.extensionDrawBuffers&&i.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(i.extensionShaderTextureLOD||i.envMap||i.transmission)&&i.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(L1).join(`
`)}function ste(i){return[i.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":""].filter(L1).join(`
`)}function ote(i){const e=[];for(const t in i){const n=i[t];n!==!1&&e.push("#define "+t+" "+n)}return e.join(`
`)}function ate(i,e){const t={},n=i.getProgramParameter(e,i.ACTIVE_ATTRIBUTES);for(let r=0;r<n;r++){const s=i.getActiveAttrib(e,r),o=s.name;let a=1;s.type===i.FLOAT_MAT2&&(a=2),s.type===i.FLOAT_MAT3&&(a=3),s.type===i.FLOAT_MAT4&&(a=4),t[o]={type:s.type,location:i.getAttribLocation(e,o),locationSize:a}}return t}function L1(i){return i!==""}function NL(i,e){const t=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return i.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,t).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function UL(i,e){return i.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const lte=/^[ \t]*#include +<([\w\d./]+)>/gm;function PM(i){return i.replace(lte,ute)}const cte=new Map([["encodings_fragment","colorspace_fragment"],["encodings_pars_fragment","colorspace_pars_fragment"],["output_fragment","opaque_fragment"]]);function ute(i,e){let t=Un[e];if(t===void 0){const n=cte.get(e);if(n!==void 0)t=Un[n],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,n);else throw new Error("Can not resolve #include <"+e+">")}return PM(t)}const hte=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function zL(i){return i.replace(hte,fte)}function fte(i,e,t,n){let r="";for(let s=parseInt(e);s<parseInt(t);s++)r+=n.replace(/\[\s*i\s*\]/g,"[ "+s+" ]").replace(/UNROLLED_LOOP_INDEX/g,s);return r}function GL(i){let e="precision "+i.precision+` float;
precision `+i.precision+" int;";return i.precision==="highp"?e+=`
#define HIGH_PRECISION`:i.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:i.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function dte(i){let e="SHADOWMAP_TYPE_BASIC";return i.shadowMapType===gw?e="SHADOWMAP_TYPE_PCF":i.shadowMapType===Kv?e="SHADOWMAP_TYPE_PCF_SOFT":i.shadowMapType===fu&&(e="SHADOWMAP_TYPE_VSM"),e}function pte(i){let e="ENVMAP_TYPE_CUBE";if(i.envMap)switch(i.envMapMode){case _u:case ip:e="ENVMAP_TYPE_CUBE";break;case SA:e="ENVMAP_TYPE_CUBE_UV";break}return e}function mte(i){let e="ENVMAP_MODE_REFLECTION";if(i.envMap)switch(i.envMapMode){case ip:e="ENVMAP_MODE_REFRACTION";break}return e}function gte(i){let e="ENVMAP_BLENDING_NONE";if(i.envMap)switch(i.combine){case ix:e="ENVMAP_BLENDING_MULTIPLY";break;case dU:e="ENVMAP_BLENDING_MIX";break;case pU:e="ENVMAP_BLENDING_ADD";break}return e}function Ate(i){const e=i.envMapCubeUVHeight;if(e===null)return null;const t=Math.log2(e)-2,n=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,t),112)),texelHeight:n,maxMip:t}}function yte(i,e,t,n){const r=i.getContext(),s=t.defines;let o=t.vertexShader,a=t.fragmentShader;const l=dte(t),c=pte(t),u=mte(t),h=gte(t),f=Ate(t),d=t.isWebGL2?"":rte(t),m=ste(t),y=ote(s),g=r.createProgram();let A,E,x=t.glslVersion?"#version "+t.glslVersion+`
`:"";t.isRawShaderMaterial?(A=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,y].filter(L1).join(`
`),A.length>0&&(A+=`
`),E=[d,"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,y].filter(L1).join(`
`),E.length>0&&(E+=`
`)):(A=[GL(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,y,t.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",t.batching?"#define USE_BATCHING":"",t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+u:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.displacementMap?"#define USE_DISPLACEMENTMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.mapUv?"#define MAP_UV "+t.mapUv:"",t.alphaMapUv?"#define ALPHAMAP_UV "+t.alphaMapUv:"",t.lightMapUv?"#define LIGHTMAP_UV "+t.lightMapUv:"",t.aoMapUv?"#define AOMAP_UV "+t.aoMapUv:"",t.emissiveMapUv?"#define EMISSIVEMAP_UV "+t.emissiveMapUv:"",t.bumpMapUv?"#define BUMPMAP_UV "+t.bumpMapUv:"",t.normalMapUv?"#define NORMALMAP_UV "+t.normalMapUv:"",t.displacementMapUv?"#define DISPLACEMENTMAP_UV "+t.displacementMapUv:"",t.metalnessMapUv?"#define METALNESSMAP_UV "+t.metalnessMapUv:"",t.roughnessMapUv?"#define ROUGHNESSMAP_UV "+t.roughnessMapUv:"",t.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+t.anisotropyMapUv:"",t.clearcoatMapUv?"#define CLEARCOATMAP_UV "+t.clearcoatMapUv:"",t.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+t.clearcoatNormalMapUv:"",t.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+t.clearcoatRoughnessMapUv:"",t.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+t.iridescenceMapUv:"",t.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+t.iridescenceThicknessMapUv:"",t.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+t.sheenColorMapUv:"",t.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+t.sheenRoughnessMapUv:"",t.specularMapUv?"#define SPECULARMAP_UV "+t.specularMapUv:"",t.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+t.specularColorMapUv:"",t.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+t.specularIntensityMapUv:"",t.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+t.transmissionMapUv:"",t.thicknessMapUv?"#define THICKNESSMAP_UV "+t.thicknessMapUv:"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&t.flatShading===!1?"#define USE_MORPHNORMALS":"",t.morphColors&&t.isWebGL2?"#define USE_MORPHCOLORS":"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+t.morphTextureStride:"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.useLegacyLights?"#define LEGACY_LIGHTS":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(L1).join(`
`),E=[d,GL(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,y,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+c:"",t.envMap?"#define "+u:"",t.envMap?"#define "+h:"",f?"#define CUBEUV_TEXEL_WIDTH "+f.texelWidth:"",f?"#define CUBEUV_TEXEL_HEIGHT "+f.texelHeight:"",f?"#define CUBEUV_MAX_MIP "+f.maxMip+".0":"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescence?"#define USE_IRIDESCENCE":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.sheen?"#define USE_SHEEN":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.useLegacyLights?"#define LEGACY_LIGHTS":"",t.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==yu?"#define TONE_MAPPING":"",t.toneMapping!==yu?Un.tonemapping_pars_fragment:"",t.toneMapping!==yu?ite("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.opaque?"#define OPAQUE":"",Un.colorspace_pars_fragment,nte("linearToOutputTexel",t.outputColorSpace),t.useDepthPacking?"#define DEPTH_PACKING "+t.depthPacking:"",`
`].filter(L1).join(`
`)),o=PM(o),o=NL(o,t),o=UL(o,t),a=PM(a),a=NL(a,t),a=UL(a,t),o=zL(o),a=zL(a),t.isWebGL2&&t.isRawShaderMaterial!==!0&&(x=`#version 300 es
`,A=[m,"precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+A,E=["precision mediump sampler2DArray;","#define varying in",t.glslVersion===IM?"":"layout(location = 0) out highp vec4 pc_fragColor;",t.glslVersion===IM?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+E);const w=x+A+o,T=x+E+a,I=FL(r,r.VERTEX_SHADER,w),M=FL(r,r.FRAGMENT_SHADER,T);r.attachShader(g,I),r.attachShader(g,M),t.index0AttributeName!==void 0?r.bindAttribLocation(g,0,t.index0AttributeName):t.morphTargets===!0&&r.bindAttribLocation(g,0,"position"),r.linkProgram(g);function L(k){if(i.debug.checkShaderErrors){const H=r.getProgramInfoLog(g).trim(),G=r.getShaderInfoLog(I).trim(),X=r.getShaderInfoLog(M).trim();let Z=!0,oe=!0;if(r.getProgramParameter(g,r.LINK_STATUS)===!1)if(Z=!1,typeof i.debug.onShaderError=="function")i.debug.onShaderError(r,g,I,M);else{const K=OL(r,I,"vertex"),V=OL(r,M,"fragment");console.error("THREE.WebGLProgram: Shader Error "+r.getError()+" - VALIDATE_STATUS "+r.getProgramParameter(g,r.VALIDATE_STATUS)+`

Program Info Log: `+H+`
`+K+`
`+V)}else H!==""?console.warn("THREE.WebGLProgram: Program Info Log:",H):(G===""||X==="")&&(oe=!1);oe&&(k.diagnostics={runnable:Z,programLog:H,vertexShader:{log:G,prefix:A},fragmentShader:{log:X,prefix:E}})}r.deleteShader(I),r.deleteShader(M),P=new Y_(r,g),R=ate(r,g)}let P;this.getUniforms=function(){return P===void 0&&L(this),P};let R;this.getAttributes=function(){return R===void 0&&L(this),R};let U=t.rendererExtensionParallelShaderCompile===!1;return this.isReady=function(){return U===!1&&(U=r.getProgramParameter(g,Jee)),U},this.destroy=function(){n.releaseStatesOfProgram(this),r.deleteProgram(g),this.program=void 0},this.type=t.shaderType,this.name=t.shaderName,this.id=Zee++,this.cacheKey=e,this.usedTimes=1,this.program=g,this.vertexShader=I,this.fragmentShader=M,this}let vte=0;class xte{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,n=e.fragmentShader,r=this._getShaderStage(t),s=this._getShaderStage(n),o=this._getShaderCacheForMaterial(e);return o.has(r)===!1&&(o.add(r),r.usedTimes++),o.has(s)===!1&&(o.add(s),s.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const n of t)n.usedTimes--,n.usedTimes===0&&this.shaderCache.delete(n.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let n=t.get(e);return n===void 0&&(n=new Set,t.set(e,n)),n}_getShaderStage(e){const t=this.shaderCache;let n=t.get(e);return n===void 0&&(n=new Ete(e),t.set(e,n)),n}}class Ete{constructor(e){this.id=vte++,this.code=e,this.usedTimes=0}}function _te(i,e,t,n,r,s,o){const a=new Gm,l=new xte,c=[],u=r.isWebGL2,h=r.logarithmicDepthBuffer,f=r.vertexTextures;let d=r.precision;const m={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function y(P){return P===0?"uv":`uv${P}`}function g(P,R,U,k,H){const G=k.fog,X=H.geometry,Z=P.isMeshStandardMaterial?k.environment:null,oe=(P.isMeshStandardMaterial?t:e).get(P.envMap||Z),K=oe&&oe.mapping===SA?oe.image.height:null,V=m[P.type];P.precision!==null&&(d=r.getMaxPrecision(P.precision),d!==P.precision&&console.warn("THREE.WebGLProgram.getParameters:",P.precision,"not supported, using",d,"instead."));const W=X.morphAttributes.position||X.morphAttributes.normal||X.morphAttributes.color,F=W!==void 0?W.length:0;let Y=0;X.morphAttributes.position!==void 0&&(Y=1),X.morphAttributes.normal!==void 0&&(Y=2),X.morphAttributes.color!==void 0&&(Y=3);let te,q,J,re;if(V){const Vn=du[V];te=Vn.vertexShader,q=Vn.fragmentShader}else te=P.vertexShader,q=P.fragmentShader,l.update(P),J=l.getVertexShaderID(P),re=l.getFragmentShaderID(P);const ie=i.getRenderTarget(),se=H.isInstancedMesh===!0,ge=H.isBatchedMesh===!0,xe=!!P.map,pe=!!P.matcap,ue=!!oe,Me=!!P.aoMap,Se=!!P.lightMap,ve=!!P.bumpMap,Ae=!!P.normalMap,ke=!!P.displacementMap,be=!!P.emissiveMap,ne=!!P.metalnessMap,j=!!P.roughnessMap,de=P.anisotropy>0,Re=P.clearcoat>0,Le=P.iridescence>0,Fe=P.sheen>0,He=P.transmission>0,it=de&&!!P.anisotropyMap,Ye=Re&&!!P.clearcoatMap,ct=Re&&!!P.clearcoatNormalMap,pt=Re&&!!P.clearcoatRoughnessMap,je=Le&&!!P.iridescenceMap,Mt=Le&&!!P.iridescenceThicknessMap,Ft=Fe&&!!P.sheenColorMap,St=Fe&&!!P.sheenRoughnessMap,gt=!!P.specularMap,ft=!!P.specularColorMap,Ce=!!P.specularIntensityMap,qe=He&&!!P.transmissionMap,At=He&&!!P.thicknessMap,yt=!!P.gradientMap,Be=!!P.alphaMap,we=P.alphaTest>0,_t=!!P.alphaHash,vt=!!P.extensions,bt=!!X.attributes.uv1,Lt=!!X.attributes.uv2,qt=!!X.attributes.uv3;let Nt=yu;return P.toneMapped&&(ie===null||ie.isXRRenderTarget===!0)&&(Nt=i.toneMapping),{isWebGL2:u,shaderID:V,shaderType:P.type,shaderName:P.name,vertexShader:te,fragmentShader:q,defines:P.defines,customVertexShaderID:J,customFragmentShaderID:re,isRawShaderMaterial:P.isRawShaderMaterial===!0,glslVersion:P.glslVersion,precision:d,batching:ge,instancing:se,instancingColor:se&&H.instanceColor!==null,supportsVertexTextures:f,outputColorSpace:ie===null?i.outputColorSpace:ie.isXRRenderTarget===!0?ie.texture.colorSpace:Dl,map:xe,matcap:pe,envMap:ue,envMapMode:ue&&oe.mapping,envMapCubeUVHeight:K,aoMap:Me,lightMap:Se,bumpMap:ve,normalMap:Ae,displacementMap:f&&ke,emissiveMap:be,normalMapObjectSpace:Ae&&P.normalMapType===RU,normalMapTangentSpace:Ae&&P.normalMapType===mp,metalnessMap:ne,roughnessMap:j,anisotropy:de,anisotropyMap:it,clearcoat:Re,clearcoatMap:Ye,clearcoatNormalMap:ct,clearcoatRoughnessMap:pt,iridescence:Le,iridescenceMap:je,iridescenceThicknessMap:Mt,sheen:Fe,sheenColorMap:Ft,sheenRoughnessMap:St,specularMap:gt,specularColorMap:ft,specularIntensityMap:Ce,transmission:He,transmissionMap:qe,thicknessMap:At,gradientMap:yt,opaque:P.transparent===!1&&P.blending===Kd,alphaMap:Be,alphaTest:we,alphaHash:_t,combine:P.combine,mapUv:xe&&y(P.map.channel),aoMapUv:Me&&y(P.aoMap.channel),lightMapUv:Se&&y(P.lightMap.channel),bumpMapUv:ve&&y(P.bumpMap.channel),normalMapUv:Ae&&y(P.normalMap.channel),displacementMapUv:ke&&y(P.displacementMap.channel),emissiveMapUv:be&&y(P.emissiveMap.channel),metalnessMapUv:ne&&y(P.metalnessMap.channel),roughnessMapUv:j&&y(P.roughnessMap.channel),anisotropyMapUv:it&&y(P.anisotropyMap.channel),clearcoatMapUv:Ye&&y(P.clearcoatMap.channel),clearcoatNormalMapUv:ct&&y(P.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:pt&&y(P.clearcoatRoughnessMap.channel),iridescenceMapUv:je&&y(P.iridescenceMap.channel),iridescenceThicknessMapUv:Mt&&y(P.iridescenceThicknessMap.channel),sheenColorMapUv:Ft&&y(P.sheenColorMap.channel),sheenRoughnessMapUv:St&&y(P.sheenRoughnessMap.channel),specularMapUv:gt&&y(P.specularMap.channel),specularColorMapUv:ft&&y(P.specularColorMap.channel),specularIntensityMapUv:Ce&&y(P.specularIntensityMap.channel),transmissionMapUv:qe&&y(P.transmissionMap.channel),thicknessMapUv:At&&y(P.thicknessMap.channel),alphaMapUv:Be&&y(P.alphaMap.channel),vertexTangents:!!X.attributes.tangent&&(Ae||de),vertexColors:P.vertexColors,vertexAlphas:P.vertexColors===!0&&!!X.attributes.color&&X.attributes.color.itemSize===4,vertexUv1s:bt,vertexUv2s:Lt,vertexUv3s:qt,pointsUvs:H.isPoints===!0&&!!X.attributes.uv&&(xe||Be),fog:!!G,useFog:P.fog===!0,fogExp2:G&&G.isFogExp2,flatShading:P.flatShading===!0,sizeAttenuation:P.sizeAttenuation===!0,logarithmicDepthBuffer:h,skinning:H.isSkinnedMesh===!0,morphTargets:X.morphAttributes.position!==void 0,morphNormals:X.morphAttributes.normal!==void 0,morphColors:X.morphAttributes.color!==void 0,morphTargetsCount:F,morphTextureStride:Y,numDirLights:R.directional.length,numPointLights:R.point.length,numSpotLights:R.spot.length,numSpotLightMaps:R.spotLightMap.length,numRectAreaLights:R.rectArea.length,numHemiLights:R.hemi.length,numDirLightShadows:R.directionalShadowMap.length,numPointLightShadows:R.pointShadowMap.length,numSpotLightShadows:R.spotShadowMap.length,numSpotLightShadowsWithMaps:R.numSpotLightShadowsWithMaps,numLightProbes:R.numLightProbes,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:P.dithering,shadowMapEnabled:i.shadowMap.enabled&&U.length>0,shadowMapType:i.shadowMap.type,toneMapping:Nt,useLegacyLights:i._useLegacyLights,decodeVideoTexture:xe&&P.map.isVideoTexture===!0&&Vi.getTransfer(P.map.colorSpace)===mr,premultipliedAlpha:P.premultipliedAlpha,doubleSided:P.side===Li,flipSided:P.side===ys,useDepthPacking:P.depthPacking>=0,depthPacking:P.depthPacking||0,index0AttributeName:P.index0AttributeName,extensionDerivatives:vt&&P.extensions.derivatives===!0,extensionFragDepth:vt&&P.extensions.fragDepth===!0,extensionDrawBuffers:vt&&P.extensions.drawBuffers===!0,extensionShaderTextureLOD:vt&&P.extensions.shaderTextureLOD===!0,extensionClipCullDistance:vt&&P.extensions.clipCullDistance&&n.has("WEBGL_clip_cull_distance"),rendererExtensionFragDepth:u||n.has("EXT_frag_depth"),rendererExtensionDrawBuffers:u||n.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:u||n.has("EXT_shader_texture_lod"),rendererExtensionParallelShaderCompile:n.has("KHR_parallel_shader_compile"),customProgramCacheKey:P.customProgramCacheKey()}}function A(P){const R=[];if(P.shaderID?R.push(P.shaderID):(R.push(P.customVertexShaderID),R.push(P.customFragmentShaderID)),P.defines!==void 0)for(const U in P.defines)R.push(U),R.push(P.defines[U]);return P.isRawShaderMaterial===!1&&(E(R,P),x(R,P),R.push(i.outputColorSpace)),R.push(P.customProgramCacheKey),R.join()}function E(P,R){P.push(R.precision),P.push(R.outputColorSpace),P.push(R.envMapMode),P.push(R.envMapCubeUVHeight),P.push(R.mapUv),P.push(R.alphaMapUv),P.push(R.lightMapUv),P.push(R.aoMapUv),P.push(R.bumpMapUv),P.push(R.normalMapUv),P.push(R.displacementMapUv),P.push(R.emissiveMapUv),P.push(R.metalnessMapUv),P.push(R.roughnessMapUv),P.push(R.anisotropyMapUv),P.push(R.clearcoatMapUv),P.push(R.clearcoatNormalMapUv),P.push(R.clearcoatRoughnessMapUv),P.push(R.iridescenceMapUv),P.push(R.iridescenceThicknessMapUv),P.push(R.sheenColorMapUv),P.push(R.sheenRoughnessMapUv),P.push(R.specularMapUv),P.push(R.specularColorMapUv),P.push(R.specularIntensityMapUv),P.push(R.transmissionMapUv),P.push(R.thicknessMapUv),P.push(R.combine),P.push(R.fogExp2),P.push(R.sizeAttenuation),P.push(R.morphTargetsCount),P.push(R.morphAttributeCount),P.push(R.numDirLights),P.push(R.numPointLights),P.push(R.numSpotLights),P.push(R.numSpotLightMaps),P.push(R.numHemiLights),P.push(R.numRectAreaLights),P.push(R.numDirLightShadows),P.push(R.numPointLightShadows),P.push(R.numSpotLightShadows),P.push(R.numSpotLightShadowsWithMaps),P.push(R.numLightProbes),P.push(R.shadowMapType),P.push(R.toneMapping),P.push(R.numClippingPlanes),P.push(R.numClipIntersection),P.push(R.depthPacking)}function x(P,R){a.disableAll(),R.isWebGL2&&a.enable(0),R.supportsVertexTextures&&a.enable(1),R.instancing&&a.enable(2),R.instancingColor&&a.enable(3),R.matcap&&a.enable(4),R.envMap&&a.enable(5),R.normalMapObjectSpace&&a.enable(6),R.normalMapTangentSpace&&a.enable(7),R.clearcoat&&a.enable(8),R.iridescence&&a.enable(9),R.alphaTest&&a.enable(10),R.vertexColors&&a.enable(11),R.vertexAlphas&&a.enable(12),R.vertexUv1s&&a.enable(13),R.vertexUv2s&&a.enable(14),R.vertexUv3s&&a.enable(15),R.vertexTangents&&a.enable(16),R.anisotropy&&a.enable(17),R.alphaHash&&a.enable(18),R.batching&&a.enable(19),P.push(a.mask),a.disableAll(),R.fog&&a.enable(0),R.useFog&&a.enable(1),R.flatShading&&a.enable(2),R.logarithmicDepthBuffer&&a.enable(3),R.skinning&&a.enable(4),R.morphTargets&&a.enable(5),R.morphNormals&&a.enable(6),R.morphColors&&a.enable(7),R.premultipliedAlpha&&a.enable(8),R.shadowMapEnabled&&a.enable(9),R.useLegacyLights&&a.enable(10),R.doubleSided&&a.enable(11),R.flipSided&&a.enable(12),R.useDepthPacking&&a.enable(13),R.dithering&&a.enable(14),R.transmission&&a.enable(15),R.sheen&&a.enable(16),R.opaque&&a.enable(17),R.pointsUvs&&a.enable(18),R.decodeVideoTexture&&a.enable(19),P.push(a.mask)}function w(P){const R=m[P.type];let U;if(R){const k=du[R];U=rp.clone(k.uniforms)}else U=P.uniforms;return U}function T(P,R){let U;for(let k=0,H=c.length;k<H;k++){const G=c[k];if(G.cacheKey===R){U=G,++U.usedTimes;break}}return U===void 0&&(U=new yte(i,R,P,s),c.push(U)),U}function I(P){if(--P.usedTimes===0){const R=c.indexOf(P);c[R]=c[c.length-1],c.pop(),P.destroy()}}function M(P){l.remove(P)}function L(){l.dispose()}return{getParameters:g,getProgramCacheKey:A,getUniforms:w,acquireProgram:T,releaseProgram:I,releaseShaderCache:M,programs:c,dispose:L}}function Ste(){let i=new WeakMap;function e(s){let o=i.get(s);return o===void 0&&(o={},i.set(s,o)),o}function t(s){i.delete(s)}function n(s,o,a){i.get(s)[o]=a}function r(){i=new WeakMap}return{get:e,remove:t,update:n,dispose:r}}function wte(i,e){return i.groupOrder!==e.groupOrder?i.groupOrder-e.groupOrder:i.renderOrder!==e.renderOrder?i.renderOrder-e.renderOrder:i.material.id!==e.material.id?i.material.id-e.material.id:i.z!==e.z?i.z-e.z:i.id-e.id}function HL(i,e){return i.groupOrder!==e.groupOrder?i.groupOrder-e.groupOrder:i.renderOrder!==e.renderOrder?i.renderOrder-e.renderOrder:i.z!==e.z?e.z-i.z:i.id-e.id}function QL(){const i=[];let e=0;const t=[],n=[],r=[];function s(){e=0,t.length=0,n.length=0,r.length=0}function o(h,f,d,m,y,g){let A=i[e];return A===void 0?(A={id:h.id,object:h,geometry:f,material:d,groupOrder:m,renderOrder:h.renderOrder,z:y,group:g},i[e]=A):(A.id=h.id,A.object=h,A.geometry=f,A.material=d,A.groupOrder=m,A.renderOrder=h.renderOrder,A.z=y,A.group=g),e++,A}function a(h,f,d,m,y,g){const A=o(h,f,d,m,y,g);d.transmission>0?n.push(A):d.transparent===!0?r.push(A):t.push(A)}function l(h,f,d,m,y,g){const A=o(h,f,d,m,y,g);d.transmission>0?n.unshift(A):d.transparent===!0?r.unshift(A):t.unshift(A)}function c(h,f){t.length>1&&t.sort(h||wte),n.length>1&&n.sort(f||HL),r.length>1&&r.sort(f||HL)}function u(){for(let h=e,f=i.length;h<f;h++){const d=i[h];if(d.id===null)break;d.id=null,d.object=null,d.geometry=null,d.material=null,d.group=null}}return{opaque:t,transmissive:n,transparent:r,init:s,push:a,unshift:l,finish:u,sort:c}}function Cte(){let i=new WeakMap;function e(n,r){const s=i.get(n);let o;return s===void 0?(o=new QL,i.set(n,[o])):r>=s.length?(o=new QL,s.push(o)):o=s[r],o}function t(){i=new WeakMap}return{get:e,dispose:t}}function Tte(){const i={};return{get:function(e){if(i[e.id]!==void 0)return i[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new Q,color:new ut};break;case"SpotLight":t={position:new Q,direction:new Q,color:new ut,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new Q,color:new ut,distance:0,decay:0};break;case"HemisphereLight":t={direction:new Q,skyColor:new ut,groundColor:new ut};break;case"RectAreaLight":t={color:new ut,position:new Q,halfWidth:new Q,halfHeight:new Q};break}return i[e.id]=t,t}}}function bte(){const i={};return{get:function(e){if(i[e.id]!==void 0)return i[e.id];let t;switch(e.type){case"DirectionalLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Ue};break;case"SpotLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Ue};break;case"PointLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Ue,shadowCameraNear:1,shadowCameraFar:1e3};break}return i[e.id]=t,t}}}let Ite=0;function Mte(i,e){return(e.castShadow?2:0)-(i.castShadow?2:0)+(e.map?1:0)-(i.map?1:0)}function Rte(i,e){const t=new Tte,n=bte(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let u=0;u<9;u++)r.probe.push(new Q);const s=new Q,o=new Xe,a=new Xe;function l(u,h){let f=0,d=0,m=0;for(let k=0;k<9;k++)r.probe[k].set(0,0,0);let y=0,g=0,A=0,E=0,x=0,w=0,T=0,I=0,M=0,L=0,P=0;u.sort(Mte);const R=h===!0?Math.PI:1;for(let k=0,H=u.length;k<H;k++){const G=u[k],X=G.color,Z=G.intensity,oe=G.distance,K=G.shadow&&G.shadow.map?G.shadow.map.texture:null;if(G.isAmbientLight)f+=X.r*Z*R,d+=X.g*Z*R,m+=X.b*Z*R;else if(G.isLightProbe){for(let V=0;V<9;V++)r.probe[V].addScaledVector(G.sh.coefficients[V],Z);P++}else if(G.isDirectionalLight){const V=t.get(G);if(V.color.copy(G.color).multiplyScalar(G.intensity*R),G.castShadow){const W=G.shadow,F=n.get(G);F.shadowBias=W.bias,F.shadowNormalBias=W.normalBias,F.shadowRadius=W.radius,F.shadowMapSize=W.mapSize,r.directionalShadow[y]=F,r.directionalShadowMap[y]=K,r.directionalShadowMatrix[y]=G.shadow.matrix,w++}r.directional[y]=V,y++}else if(G.isSpotLight){const V=t.get(G);V.position.setFromMatrixPosition(G.matrixWorld),V.color.copy(X).multiplyScalar(Z*R),V.distance=oe,V.coneCos=Math.cos(G.angle),V.penumbraCos=Math.cos(G.angle*(1-G.penumbra)),V.decay=G.decay,r.spot[A]=V;const W=G.shadow;if(G.map&&(r.spotLightMap[M]=G.map,M++,W.updateMatrices(G),G.castShadow&&L++),r.spotLightMatrix[A]=W.matrix,G.castShadow){const F=n.get(G);F.shadowBias=W.bias,F.shadowNormalBias=W.normalBias,F.shadowRadius=W.radius,F.shadowMapSize=W.mapSize,r.spotShadow[A]=F,r.spotShadowMap[A]=K,I++}A++}else if(G.isRectAreaLight){const V=t.get(G);V.color.copy(X).multiplyScalar(Z),V.halfWidth.set(G.width*.5,0,0),V.halfHeight.set(0,G.height*.5,0),r.rectArea[E]=V,E++}else if(G.isPointLight){const V=t.get(G);if(V.color.copy(G.color).multiplyScalar(G.intensity*R),V.distance=G.distance,V.decay=G.decay,G.castShadow){const W=G.shadow,F=n.get(G);F.shadowBias=W.bias,F.shadowNormalBias=W.normalBias,F.shadowRadius=W.radius,F.shadowMapSize=W.mapSize,F.shadowCameraNear=W.camera.near,F.shadowCameraFar=W.camera.far,r.pointShadow[g]=F,r.pointShadowMap[g]=K,r.pointShadowMatrix[g]=G.shadow.matrix,T++}r.point[g]=V,g++}else if(G.isHemisphereLight){const V=t.get(G);V.skyColor.copy(G.color).multiplyScalar(Z*R),V.groundColor.copy(G.groundColor).multiplyScalar(Z*R),r.hemi[x]=V,x++}}E>0&&(e.isWebGL2?i.has("OES_texture_float_linear")===!0?(r.rectAreaLTC1=Ot.LTC_FLOAT_1,r.rectAreaLTC2=Ot.LTC_FLOAT_2):(r.rectAreaLTC1=Ot.LTC_HALF_1,r.rectAreaLTC2=Ot.LTC_HALF_2):i.has("OES_texture_float_linear")===!0?(r.rectAreaLTC1=Ot.LTC_FLOAT_1,r.rectAreaLTC2=Ot.LTC_FLOAT_2):i.has("OES_texture_half_float_linear")===!0?(r.rectAreaLTC1=Ot.LTC_HALF_1,r.rectAreaLTC2=Ot.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),r.ambient[0]=f,r.ambient[1]=d,r.ambient[2]=m;const U=r.hash;(U.directionalLength!==y||U.pointLength!==g||U.spotLength!==A||U.rectAreaLength!==E||U.hemiLength!==x||U.numDirectionalShadows!==w||U.numPointShadows!==T||U.numSpotShadows!==I||U.numSpotMaps!==M||U.numLightProbes!==P)&&(r.directional.length=y,r.spot.length=A,r.rectArea.length=E,r.point.length=g,r.hemi.length=x,r.directionalShadow.length=w,r.directionalShadowMap.length=w,r.pointShadow.length=T,r.pointShadowMap.length=T,r.spotShadow.length=I,r.spotShadowMap.length=I,r.directionalShadowMatrix.length=w,r.pointShadowMatrix.length=T,r.spotLightMatrix.length=I+M-L,r.spotLightMap.length=M,r.numSpotLightShadowsWithMaps=L,r.numLightProbes=P,U.directionalLength=y,U.pointLength=g,U.spotLength=A,U.rectAreaLength=E,U.hemiLength=x,U.numDirectionalShadows=w,U.numPointShadows=T,U.numSpotShadows=I,U.numSpotMaps=M,U.numLightProbes=P,r.version=Ite++)}function c(u,h){let f=0,d=0,m=0,y=0,g=0;const A=h.matrixWorldInverse;for(let E=0,x=u.length;E<x;E++){const w=u[E];if(w.isDirectionalLight){const T=r.directional[f];T.direction.setFromMatrixPosition(w.matrixWorld),s.setFromMatrixPosition(w.target.matrixWorld),T.direction.sub(s),T.direction.transformDirection(A),f++}else if(w.isSpotLight){const T=r.spot[m];T.position.setFromMatrixPosition(w.matrixWorld),T.position.applyMatrix4(A),T.direction.setFromMatrixPosition(w.matrixWorld),s.setFromMatrixPosition(w.target.matrixWorld),T.direction.sub(s),T.direction.transformDirection(A),m++}else if(w.isRectAreaLight){const T=r.rectArea[y];T.position.setFromMatrixPosition(w.matrixWorld),T.position.applyMatrix4(A),a.identity(),o.copy(w.matrixWorld),o.premultiply(A),a.extractRotation(o),T.halfWidth.set(w.width*.5,0,0),T.halfHeight.set(0,w.height*.5,0),T.halfWidth.applyMatrix4(a),T.halfHeight.applyMatrix4(a),y++}else if(w.isPointLight){const T=r.point[d];T.position.setFromMatrixPosition(w.matrixWorld),T.position.applyMatrix4(A),d++}else if(w.isHemisphereLight){const T=r.hemi[g];T.direction.setFromMatrixPosition(w.matrixWorld),T.direction.transformDirection(A),g++}}}return{setup:l,setupView:c,state:r}}function VL(i,e){const t=new Rte(i,e),n=[],r=[];function s(){n.length=0,r.length=0}function o(h){n.push(h)}function a(h){r.push(h)}function l(h){t.setup(n,h)}function c(h){t.setupView(n,h)}return{init:s,state:{lightsArray:n,shadowsArray:r,lights:t},setupLights:l,setupLightsView:c,pushLight:o,pushShadow:a}}function Pte(i,e){let t=new WeakMap;function n(s,o=0){const a=t.get(s);let l;return a===void 0?(l=new VL(i,e),t.set(s,[l])):o>=a.length?(l=new VL(i,e),a.push(l)):l=a[o],l}function r(){t=new WeakMap}return{get:n,dispose:r}}class ax extends Us{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=MU,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class Rw extends Us{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}const Lte=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,Bte=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function Dte(i,e,t){let n=new f0;const r=new Ue,s=new Ue,o=new Rn,a=new ax({depthPacking:ww}),l=new Rw,c={},u=t.maxTextureSize,h={[tl]:ys,[ys]:tl,[Li]:Li},f=new Mi({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Ue},radius:{value:4}},vertexShader:Lte,fragmentShader:Bte}),d=f.clone();d.defines.HORIZONTAL_PASS=1;const m=new fn;m.setAttribute("position",new mn(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const y=new It(m,f),g=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=gw;let A=this.type;this.render=function(I,M,L){if(g.enabled===!1||g.autoUpdate===!1&&g.needsUpdate===!1||I.length===0)return;const P=i.getRenderTarget(),R=i.getActiveCubeFace(),U=i.getActiveMipmapLevel(),k=i.state;k.setBlending(gc),k.buffers.color.setClear(1,1,1,1),k.buffers.depth.setTest(!0),k.setScissorTest(!1);const H=A!==fu&&this.type===fu,G=A===fu&&this.type!==fu;for(let X=0,Z=I.length;X<Z;X++){const oe=I[X],K=oe.shadow;if(K===void 0){console.warn("THREE.WebGLShadowMap:",oe,"has no shadow.");continue}if(K.autoUpdate===!1&&K.needsUpdate===!1)continue;r.copy(K.mapSize);const V=K.getFrameExtents();if(r.multiply(V),s.copy(K.mapSize),(r.x>u||r.y>u)&&(r.x>u&&(s.x=Math.floor(u/V.x),r.x=s.x*V.x,K.mapSize.x=s.x),r.y>u&&(s.y=Math.floor(u/V.y),r.y=s.y*V.y,K.mapSize.y=s.y)),K.map===null||H===!0||G===!0){const F=this.type!==fu?{minFilter:zn,magFilter:zn}:{};K.map!==null&&K.map.dispose(),K.map=new Si(r.x,r.y,F),K.map.texture.name=oe.name+".shadowMap",K.camera.updateProjectionMatrix()}i.setRenderTarget(K.map),i.clear();const W=K.getViewportCount();for(let F=0;F<W;F++){const Y=K.getViewport(F);o.set(s.x*Y.x,s.y*Y.y,s.x*Y.z,s.y*Y.w),k.viewport(o),K.updateMatrices(oe,F),n=K.getFrustum(),w(M,L,K.camera,oe,this.type)}K.isPointLightShadow!==!0&&this.type===fu&&E(K,L),K.needsUpdate=!1}A=this.type,g.needsUpdate=!1,i.setRenderTarget(P,R,U)};function E(I,M){const L=e.update(y);f.defines.VSM_SAMPLES!==I.blurSamples&&(f.defines.VSM_SAMPLES=I.blurSamples,d.defines.VSM_SAMPLES=I.blurSamples,f.needsUpdate=!0,d.needsUpdate=!0),I.mapPass===null&&(I.mapPass=new Si(r.x,r.y)),f.uniforms.shadow_pass.value=I.map.texture,f.uniforms.resolution.value=I.mapSize,f.uniforms.radius.value=I.radius,i.setRenderTarget(I.mapPass),i.clear(),i.renderBufferDirect(M,null,L,f,y,null),d.uniforms.shadow_pass.value=I.mapPass.texture,d.uniforms.resolution.value=I.mapSize,d.uniforms.radius.value=I.radius,i.setRenderTarget(I.map),i.clear(),i.renderBufferDirect(M,null,L,d,y,null)}function x(I,M,L,P){let R=null;const U=L.isPointLight===!0?I.customDistanceMaterial:I.customDepthMaterial;if(U!==void 0)R=U;else if(R=L.isPointLight===!0?l:a,i.localClippingEnabled&&M.clipShadows===!0&&Array.isArray(M.clippingPlanes)&&M.clippingPlanes.length!==0||M.displacementMap&&M.displacementScale!==0||M.alphaMap&&M.alphaTest>0||M.map&&M.alphaTest>0){const k=R.uuid,H=M.uuid;let G=c[k];G===void 0&&(G={},c[k]=G);let X=G[H];X===void 0&&(X=R.clone(),G[H]=X,M.addEventListener("dispose",T)),R=X}if(R.visible=M.visible,R.wireframe=M.wireframe,P===fu?R.side=M.shadowSide!==null?M.shadowSide:M.side:R.side=M.shadowSide!==null?M.shadowSide:h[M.side],R.alphaMap=M.alphaMap,R.alphaTest=M.alphaTest,R.map=M.map,R.clipShadows=M.clipShadows,R.clippingPlanes=M.clippingPlanes,R.clipIntersection=M.clipIntersection,R.displacementMap=M.displacementMap,R.displacementScale=M.displacementScale,R.displacementBias=M.displacementBias,R.wireframeLinewidth=M.wireframeLinewidth,R.linewidth=M.linewidth,L.isPointLight===!0&&R.isMeshDistanceMaterial===!0){const k=i.properties.get(R);k.light=L}return R}function w(I,M,L,P,R){if(I.visible===!1)return;if(I.layers.test(M.layers)&&(I.isMesh||I.isLine||I.isPoints)&&(I.castShadow||I.receiveShadow&&R===fu)&&(!I.frustumCulled||n.intersectsObject(I))){I.modelViewMatrix.multiplyMatrices(L.matrixWorldInverse,I.matrixWorld);const H=e.update(I),G=I.material;if(Array.isArray(G)){const X=H.groups;for(let Z=0,oe=X.length;Z<oe;Z++){const K=X[Z],V=G[K.materialIndex];if(V&&V.visible){const W=x(I,V,P,R);I.onBeforeShadow(i,I,M,L,H,W,K),i.renderBufferDirect(L,null,H,W,I,K),I.onAfterShadow(i,I,M,L,H,W,K)}}}else if(G.visible){const X=x(I,G,P,R);I.onBeforeShadow(i,I,M,L,H,X,null),i.renderBufferDirect(L,null,H,X,I,null),I.onAfterShadow(i,I,M,L,H,X,null)}}const k=I.children;for(let H=0,G=k.length;H<G;H++)w(k[H],M,L,P,R)}function T(I){I.target.removeEventListener("dispose",T);for(const L in c){const P=c[L],R=I.target.uuid;R in P&&(P[R].dispose(),delete P[R])}}}function kte(i,e,t){const n=t.isWebGL2;function r(){let we=!1;const _t=new Rn;let vt=null;const bt=new Rn(0,0,0,0);return{setMask:function(Lt){vt!==Lt&&!we&&(i.colorMask(Lt,Lt,Lt,Lt),vt=Lt)},setLocked:function(Lt){we=Lt},setClear:function(Lt,qt,Nt,dn,Vn){Vn===!0&&(Lt*=dn,qt*=dn,Nt*=dn),_t.set(Lt,qt,Nt,dn),bt.equals(_t)===!1&&(i.clearColor(Lt,qt,Nt,dn),bt.copy(_t))},reset:function(){we=!1,vt=null,bt.set(-1,0,0,0)}}}function s(){let we=!1,_t=null,vt=null,bt=null;return{setTest:function(Lt){Lt?ge(i.DEPTH_TEST):xe(i.DEPTH_TEST)},setMask:function(Lt){_t!==Lt&&!we&&(i.depthMask(Lt),_t=Lt)},setFunc:function(Lt){if(vt!==Lt){switch(Lt){case oU:i.depthFunc(i.NEVER);break;case aU:i.depthFunc(i.ALWAYS);break;case lU:i.depthFunc(i.LESS);break;case E2:i.depthFunc(i.LEQUAL);break;case cU:i.depthFunc(i.EQUAL);break;case uU:i.depthFunc(i.GEQUAL);break;case hU:i.depthFunc(i.GREATER);break;case fU:i.depthFunc(i.NOTEQUAL);break;default:i.depthFunc(i.LEQUAL)}vt=Lt}},setLocked:function(Lt){we=Lt},setClear:function(Lt){bt!==Lt&&(i.clearDepth(Lt),bt=Lt)},reset:function(){we=!1,_t=null,vt=null,bt=null}}}function o(){let we=!1,_t=null,vt=null,bt=null,Lt=null,qt=null,Nt=null,dn=null,Vn=null;return{setTest:function(pn){we||(pn?ge(i.STENCIL_TEST):xe(i.STENCIL_TEST))},setMask:function(pn){_t!==pn&&!we&&(i.stencilMask(pn),_t=pn)},setFunc:function(pn,qn,Ci){(vt!==pn||bt!==qn||Lt!==Ci)&&(i.stencilFunc(pn,qn,Ci),vt=pn,bt=qn,Lt=Ci)},setOp:function(pn,qn,Ci){(qt!==pn||Nt!==qn||dn!==Ci)&&(i.stencilOp(pn,qn,Ci),qt=pn,Nt=qn,dn=Ci)},setLocked:function(pn){we=pn},setClear:function(pn){Vn!==pn&&(i.clearStencil(pn),Vn=pn)},reset:function(){we=!1,_t=null,vt=null,bt=null,Lt=null,qt=null,Nt=null,dn=null,Vn=null}}}const a=new r,l=new s,c=new o,u=new WeakMap,h=new WeakMap;let f={},d={},m=new WeakMap,y=[],g=null,A=!1,E=null,x=null,w=null,T=null,I=null,M=null,L=null,P=new ut(0,0,0),R=0,U=!1,k=null,H=null,G=null,X=null,Z=null;const oe=i.getParameter(i.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let K=!1,V=0;const W=i.getParameter(i.VERSION);W.indexOf("WebGL")!==-1?(V=parseFloat(/^WebGL (\d)/.exec(W)[1]),K=V>=1):W.indexOf("OpenGL ES")!==-1&&(V=parseFloat(/^OpenGL ES (\d)/.exec(W)[1]),K=V>=2);let F=null,Y={};const te=i.getParameter(i.SCISSOR_BOX),q=i.getParameter(i.VIEWPORT),J=new Rn().fromArray(te),re=new Rn().fromArray(q);function ie(we,_t,vt,bt){const Lt=new Uint8Array(4),qt=i.createTexture();i.bindTexture(we,qt),i.texParameteri(we,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(we,i.TEXTURE_MAG_FILTER,i.NEAREST);for(let Nt=0;Nt<vt;Nt++)n&&(we===i.TEXTURE_3D||we===i.TEXTURE_2D_ARRAY)?i.texImage3D(_t,0,i.RGBA,1,1,bt,0,i.RGBA,i.UNSIGNED_BYTE,Lt):i.texImage2D(_t+Nt,0,i.RGBA,1,1,0,i.RGBA,i.UNSIGNED_BYTE,Lt);return qt}const se={};se[i.TEXTURE_2D]=ie(i.TEXTURE_2D,i.TEXTURE_2D,1),se[i.TEXTURE_CUBE_MAP]=ie(i.TEXTURE_CUBE_MAP,i.TEXTURE_CUBE_MAP_POSITIVE_X,6),n&&(se[i.TEXTURE_2D_ARRAY]=ie(i.TEXTURE_2D_ARRAY,i.TEXTURE_2D_ARRAY,1,1),se[i.TEXTURE_3D]=ie(i.TEXTURE_3D,i.TEXTURE_3D,1,1)),a.setClear(0,0,0,1),l.setClear(1),c.setClear(0),ge(i.DEPTH_TEST),l.setFunc(E2),be(!1),ne(nM),ge(i.CULL_FACE),Ae(gc);function ge(we){f[we]!==!0&&(i.enable(we),f[we]=!0)}function xe(we){f[we]!==!1&&(i.disable(we),f[we]=!1)}function pe(we,_t){return d[we]!==_t?(i.bindFramebuffer(we,_t),d[we]=_t,n&&(we===i.DRAW_FRAMEBUFFER&&(d[i.FRAMEBUFFER]=_t),we===i.FRAMEBUFFER&&(d[i.DRAW_FRAMEBUFFER]=_t)),!0):!1}function ue(we,_t){let vt=y,bt=!1;if(we)if(vt=m.get(_t),vt===void 0&&(vt=[],m.set(_t,vt)),we.isWebGLMultipleRenderTargets){const Lt=we.texture;if(vt.length!==Lt.length||vt[0]!==i.COLOR_ATTACHMENT0){for(let qt=0,Nt=Lt.length;qt<Nt;qt++)vt[qt]=i.COLOR_ATTACHMENT0+qt;vt.length=Lt.length,bt=!0}}else vt[0]!==i.COLOR_ATTACHMENT0&&(vt[0]=i.COLOR_ATTACHMENT0,bt=!0);else vt[0]!==i.BACK&&(vt[0]=i.BACK,bt=!0);bt&&(t.isWebGL2?i.drawBuffers(vt):e.get("WEBGL_draw_buffers").drawBuffersWEBGL(vt))}function Me(we){return g!==we?(i.useProgram(we),g=we,!0):!1}const Se={[Nd]:i.FUNC_ADD,[WN]:i.FUNC_SUBTRACT,[KN]:i.FUNC_REVERSE_SUBTRACT};if(n)Se[sM]=i.MIN,Se[oM]=i.MAX;else{const we=e.get("EXT_blend_minmax");we!==null&&(Se[sM]=we.MIN_EXT,Se[oM]=we.MAX_EXT)}const ve={[YN]:i.ZERO,[yw]:i.ONE,[$N]:i.SRC_COLOR,[x2]:i.SRC_ALPHA,[tU]:i.SRC_ALPHA_SATURATE,[ZN]:i.DST_COLOR,[qN]:i.DST_ALPHA,[XN]:i.ONE_MINUS_SRC_COLOR,[ES]:i.ONE_MINUS_SRC_ALPHA,[eU]:i.ONE_MINUS_DST_COLOR,[JN]:i.ONE_MINUS_DST_ALPHA,[nU]:i.CONSTANT_COLOR,[iU]:i.ONE_MINUS_CONSTANT_COLOR,[rU]:i.CONSTANT_ALPHA,[sU]:i.ONE_MINUS_CONSTANT_ALPHA};function Ae(we,_t,vt,bt,Lt,qt,Nt,dn,Vn,pn){if(we===gc){A===!0&&(xe(i.BLEND),A=!1);return}if(A===!1&&(ge(i.BLEND),A=!0),we!==Aw){if(we!==E||pn!==U){if((x!==Nd||I!==Nd)&&(i.blendEquation(i.FUNC_ADD),x=Nd,I=Nd),pn)switch(we){case Kd:i.blendFuncSeparate(i.ONE,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA);break;case xS:i.blendFunc(i.ONE,i.ONE);break;case iM:i.blendFuncSeparate(i.ZERO,i.ONE_MINUS_SRC_COLOR,i.ZERO,i.ONE);break;case rM:i.blendFuncSeparate(i.ZERO,i.SRC_COLOR,i.ZERO,i.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",we);break}else switch(we){case Kd:i.blendFuncSeparate(i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA);break;case xS:i.blendFunc(i.SRC_ALPHA,i.ONE);break;case iM:i.blendFuncSeparate(i.ZERO,i.ONE_MINUS_SRC_COLOR,i.ZERO,i.ONE);break;case rM:i.blendFunc(i.ZERO,i.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",we);break}w=null,T=null,M=null,L=null,P.set(0,0,0),R=0,E=we,U=pn}return}Lt=Lt||_t,qt=qt||vt,Nt=Nt||bt,(_t!==x||Lt!==I)&&(i.blendEquationSeparate(Se[_t],Se[Lt]),x=_t,I=Lt),(vt!==w||bt!==T||qt!==M||Nt!==L)&&(i.blendFuncSeparate(ve[vt],ve[bt],ve[qt],ve[Nt]),w=vt,T=bt,M=qt,L=Nt),(dn.equals(P)===!1||Vn!==R)&&(i.blendColor(dn.r,dn.g,dn.b,Vn),P.copy(dn),R=Vn),E=we,U=!1}function ke(we,_t){we.side===Li?xe(i.CULL_FACE):ge(i.CULL_FACE);let vt=we.side===ys;_t&&(vt=!vt),be(vt),we.blending===Kd&&we.transparent===!1?Ae(gc):Ae(we.blending,we.blendEquation,we.blendSrc,we.blendDst,we.blendEquationAlpha,we.blendSrcAlpha,we.blendDstAlpha,we.blendColor,we.blendAlpha,we.premultipliedAlpha),l.setFunc(we.depthFunc),l.setTest(we.depthTest),l.setMask(we.depthWrite),a.setMask(we.colorWrite);const bt=we.stencilWrite;c.setTest(bt),bt&&(c.setMask(we.stencilWriteMask),c.setFunc(we.stencilFunc,we.stencilRef,we.stencilFuncMask),c.setOp(we.stencilFail,we.stencilZFail,we.stencilZPass)),de(we.polygonOffset,we.polygonOffsetFactor,we.polygonOffsetUnits),we.alphaToCoverage===!0?ge(i.SAMPLE_ALPHA_TO_COVERAGE):xe(i.SAMPLE_ALPHA_TO_COVERAGE)}function be(we){k!==we&&(we?i.frontFace(i.CW):i.frontFace(i.CCW),k=we)}function ne(we){we!==QN?(ge(i.CULL_FACE),we!==H&&(we===nM?i.cullFace(i.BACK):we===VN?i.cullFace(i.FRONT):i.cullFace(i.FRONT_AND_BACK))):xe(i.CULL_FACE),H=we}function j(we){we!==G&&(K&&i.lineWidth(we),G=we)}function de(we,_t,vt){we?(ge(i.POLYGON_OFFSET_FILL),(X!==_t||Z!==vt)&&(i.polygonOffset(_t,vt),X=_t,Z=vt)):xe(i.POLYGON_OFFSET_FILL)}function Re(we){we?ge(i.SCISSOR_TEST):xe(i.SCISSOR_TEST)}function Le(we){we===void 0&&(we=i.TEXTURE0+oe-1),F!==we&&(i.activeTexture(we),F=we)}function Fe(we,_t,vt){vt===void 0&&(F===null?vt=i.TEXTURE0+oe-1:vt=F);let bt=Y[vt];bt===void 0&&(bt={type:void 0,texture:void 0},Y[vt]=bt),(bt.type!==we||bt.texture!==_t)&&(F!==vt&&(i.activeTexture(vt),F=vt),i.bindTexture(we,_t||se[we]),bt.type=we,bt.texture=_t)}function He(){const we=Y[F];we!==void 0&&we.type!==void 0&&(i.bindTexture(we.type,null),we.type=void 0,we.texture=void 0)}function it(){try{i.compressedTexImage2D.apply(i,arguments)}catch(we){console.error("THREE.WebGLState:",we)}}function Ye(){try{i.compressedTexImage3D.apply(i,arguments)}catch(we){console.error("THREE.WebGLState:",we)}}function ct(){try{i.texSubImage2D.apply(i,arguments)}catch(we){console.error("THREE.WebGLState:",we)}}function pt(){try{i.texSubImage3D.apply(i,arguments)}catch(we){console.error("THREE.WebGLState:",we)}}function je(){try{i.compressedTexSubImage2D.apply(i,arguments)}catch(we){console.error("THREE.WebGLState:",we)}}function Mt(){try{i.compressedTexSubImage3D.apply(i,arguments)}catch(we){console.error("THREE.WebGLState:",we)}}function Ft(){try{i.texStorage2D.apply(i,arguments)}catch(we){console.error("THREE.WebGLState:",we)}}function St(){try{i.texStorage3D.apply(i,arguments)}catch(we){console.error("THREE.WebGLState:",we)}}function gt(){try{i.texImage2D.apply(i,arguments)}catch(we){console.error("THREE.WebGLState:",we)}}function ft(){try{i.texImage3D.apply(i,arguments)}catch(we){console.error("THREE.WebGLState:",we)}}function Ce(we){J.equals(we)===!1&&(i.scissor(we.x,we.y,we.z,we.w),J.copy(we))}function qe(we){re.equals(we)===!1&&(i.viewport(we.x,we.y,we.z,we.w),re.copy(we))}function At(we,_t){let vt=h.get(_t);vt===void 0&&(vt=new WeakMap,h.set(_t,vt));let bt=vt.get(we);bt===void 0&&(bt=i.getUniformBlockIndex(_t,we.name),vt.set(we,bt))}function yt(we,_t){const bt=h.get(_t).get(we);u.get(_t)!==bt&&(i.uniformBlockBinding(_t,bt,we.__bindingPointIndex),u.set(_t,bt))}function Be(){i.disable(i.BLEND),i.disable(i.CULL_FACE),i.disable(i.DEPTH_TEST),i.disable(i.POLYGON_OFFSET_FILL),i.disable(i.SCISSOR_TEST),i.disable(i.STENCIL_TEST),i.disable(i.SAMPLE_ALPHA_TO_COVERAGE),i.blendEquation(i.FUNC_ADD),i.blendFunc(i.ONE,i.ZERO),i.blendFuncSeparate(i.ONE,i.ZERO,i.ONE,i.ZERO),i.blendColor(0,0,0,0),i.colorMask(!0,!0,!0,!0),i.clearColor(0,0,0,0),i.depthMask(!0),i.depthFunc(i.LESS),i.clearDepth(1),i.stencilMask(4294967295),i.stencilFunc(i.ALWAYS,0,4294967295),i.stencilOp(i.KEEP,i.KEEP,i.KEEP),i.clearStencil(0),i.cullFace(i.BACK),i.frontFace(i.CCW),i.polygonOffset(0,0),i.activeTexture(i.TEXTURE0),i.bindFramebuffer(i.FRAMEBUFFER,null),n===!0&&(i.bindFramebuffer(i.DRAW_FRAMEBUFFER,null),i.bindFramebuffer(i.READ_FRAMEBUFFER,null)),i.useProgram(null),i.lineWidth(1),i.scissor(0,0,i.canvas.width,i.canvas.height),i.viewport(0,0,i.canvas.width,i.canvas.height),f={},F=null,Y={},d={},m=new WeakMap,y=[],g=null,A=!1,E=null,x=null,w=null,T=null,I=null,M=null,L=null,P=new ut(0,0,0),R=0,U=!1,k=null,H=null,G=null,X=null,Z=null,J.set(0,0,i.canvas.width,i.canvas.height),re.set(0,0,i.canvas.width,i.canvas.height),a.reset(),l.reset(),c.reset()}return{buffers:{color:a,depth:l,stencil:c},enable:ge,disable:xe,bindFramebuffer:pe,drawBuffers:ue,useProgram:Me,setBlending:Ae,setMaterial:ke,setFlipSided:be,setCullFace:ne,setLineWidth:j,setPolygonOffset:de,setScissorTest:Re,activeTexture:Le,bindTexture:Fe,unbindTexture:He,compressedTexImage2D:it,compressedTexImage3D:Ye,texImage2D:gt,texImage3D:ft,updateUBOMapping:At,uniformBlockBinding:yt,texStorage2D:Ft,texStorage3D:St,texSubImage2D:ct,texSubImage3D:pt,compressedTexSubImage2D:je,compressedTexSubImage3D:Mt,scissor:Ce,viewport:qe,reset:Be}}function Fte(i,e,t,n,r,s,o){const a=r.isWebGL2,l=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,c=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),u=new WeakMap;let h;const f=new WeakMap;let d=!1;try{d=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function m(ne,j){return d?new OffscreenCanvas(ne,j):P2("canvas")}function y(ne,j,de,Re){let Le=1;if((ne.width>Re||ne.height>Re)&&(Le=Re/Math.max(ne.width,ne.height)),Le<1||j===!0)if(typeof HTMLImageElement<"u"&&ne instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&ne instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&ne instanceof ImageBitmap){const Fe=j?RS:Math.floor,He=Fe(Le*ne.width),it=Fe(Le*ne.height);h===void 0&&(h=m(He,it));const Ye=de?m(He,it):h;return Ye.width=He,Ye.height=it,Ye.getContext("2d").drawImage(ne,0,0,He,it),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+ne.width+"x"+ne.height+") to ("+He+"x"+it+")."),Ye}else return"data"in ne&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+ne.width+"x"+ne.height+")."),ne;return ne}function g(ne){return MM(ne.width)&&MM(ne.height)}function A(ne){return a?!1:ne.wrapS!==Wi||ne.wrapT!==Wi||ne.minFilter!==zn&&ne.minFilter!==Ln}function E(ne,j){return ne.generateMipmaps&&j&&ne.minFilter!==zn&&ne.minFilter!==Ln}function x(ne){i.generateMipmap(ne)}function w(ne,j,de,Re,Le=!1){if(a===!1)return j;if(ne!==null){if(i[ne]!==void 0)return i[ne];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+ne+"'")}let Fe=j;if(j===i.RED&&(de===i.FLOAT&&(Fe=i.R32F),de===i.HALF_FLOAT&&(Fe=i.R16F),de===i.UNSIGNED_BYTE&&(Fe=i.R8)),j===i.RED_INTEGER&&(de===i.UNSIGNED_BYTE&&(Fe=i.R8UI),de===i.UNSIGNED_SHORT&&(Fe=i.R16UI),de===i.UNSIGNED_INT&&(Fe=i.R32UI),de===i.BYTE&&(Fe=i.R8I),de===i.SHORT&&(Fe=i.R16I),de===i.INT&&(Fe=i.R32I)),j===i.RG&&(de===i.FLOAT&&(Fe=i.RG32F),de===i.HALF_FLOAT&&(Fe=i.RG16F),de===i.UNSIGNED_BYTE&&(Fe=i.RG8)),j===i.RGBA){const He=Le?b2:Vi.getTransfer(Re);de===i.FLOAT&&(Fe=i.RGBA32F),de===i.HALF_FLOAT&&(Fe=i.RGBA16F),de===i.UNSIGNED_BYTE&&(Fe=He===mr?i.SRGB8_ALPHA8:i.RGBA8),de===i.UNSIGNED_SHORT_4_4_4_4&&(Fe=i.RGBA4),de===i.UNSIGNED_SHORT_5_5_5_1&&(Fe=i.RGB5_A1)}return(Fe===i.R16F||Fe===i.R32F||Fe===i.RG16F||Fe===i.RG32F||Fe===i.RGBA16F||Fe===i.RGBA32F)&&e.get("EXT_color_buffer_float"),Fe}function T(ne,j,de){return E(ne,de)===!0||ne.isFramebufferTexture&&ne.minFilter!==zn&&ne.minFilter!==Ln?Math.log2(Math.max(j.width,j.height))+1:ne.mipmaps!==void 0&&ne.mipmaps.length>0?ne.mipmaps.length:ne.isCompressedTexture&&Array.isArray(ne.image)?j.mipmaps.length:1}function I(ne){return ne===zn||ne===S2||ne===z1?i.NEAREST:i.LINEAR}function M(ne){const j=ne.target;j.removeEventListener("dispose",M),P(j),j.isVideoTexture&&u.delete(j)}function L(ne){const j=ne.target;j.removeEventListener("dispose",L),U(j)}function P(ne){const j=n.get(ne);if(j.__webglInit===void 0)return;const de=ne.source,Re=f.get(de);if(Re){const Le=Re[j.__cacheKey];Le.usedTimes--,Le.usedTimes===0&&R(ne),Object.keys(Re).length===0&&f.delete(de)}n.remove(ne)}function R(ne){const j=n.get(ne);i.deleteTexture(j.__webglTexture);const de=ne.source,Re=f.get(de);delete Re[j.__cacheKey],o.memory.textures--}function U(ne){const j=ne.texture,de=n.get(ne),Re=n.get(j);if(Re.__webglTexture!==void 0&&(i.deleteTexture(Re.__webglTexture),o.memory.textures--),ne.depthTexture&&ne.depthTexture.dispose(),ne.isWebGLCubeRenderTarget)for(let Le=0;Le<6;Le++){if(Array.isArray(de.__webglFramebuffer[Le]))for(let Fe=0;Fe<de.__webglFramebuffer[Le].length;Fe++)i.deleteFramebuffer(de.__webglFramebuffer[Le][Fe]);else i.deleteFramebuffer(de.__webglFramebuffer[Le]);de.__webglDepthbuffer&&i.deleteRenderbuffer(de.__webglDepthbuffer[Le])}else{if(Array.isArray(de.__webglFramebuffer))for(let Le=0;Le<de.__webglFramebuffer.length;Le++)i.deleteFramebuffer(de.__webglFramebuffer[Le]);else i.deleteFramebuffer(de.__webglFramebuffer);if(de.__webglDepthbuffer&&i.deleteRenderbuffer(de.__webglDepthbuffer),de.__webglMultisampledFramebuffer&&i.deleteFramebuffer(de.__webglMultisampledFramebuffer),de.__webglColorRenderbuffer)for(let Le=0;Le<de.__webglColorRenderbuffer.length;Le++)de.__webglColorRenderbuffer[Le]&&i.deleteRenderbuffer(de.__webglColorRenderbuffer[Le]);de.__webglDepthRenderbuffer&&i.deleteRenderbuffer(de.__webglDepthRenderbuffer)}if(ne.isWebGLMultipleRenderTargets)for(let Le=0,Fe=j.length;Le<Fe;Le++){const He=n.get(j[Le]);He.__webglTexture&&(i.deleteTexture(He.__webglTexture),o.memory.textures--),n.remove(j[Le])}n.remove(j),n.remove(ne)}let k=0;function H(){k=0}function G(){const ne=k;return ne>=r.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+ne+" texture units while this GPU supports only "+r.maxTextures),k+=1,ne}function X(ne){const j=[];return j.push(ne.wrapS),j.push(ne.wrapT),j.push(ne.wrapR||0),j.push(ne.magFilter),j.push(ne.minFilter),j.push(ne.anisotropy),j.push(ne.internalFormat),j.push(ne.format),j.push(ne.type),j.push(ne.generateMipmaps),j.push(ne.premultiplyAlpha),j.push(ne.flipY),j.push(ne.unpackAlignment),j.push(ne.colorSpace),j.join()}function Z(ne,j){const de=n.get(ne);if(ne.isVideoTexture&&ke(ne),ne.isRenderTargetTexture===!1&&ne.version>0&&de.__version!==ne.version){const Re=ne.image;if(Re===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(Re.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{J(de,ne,j);return}}t.bindTexture(i.TEXTURE_2D,de.__webglTexture,i.TEXTURE0+j)}function oe(ne,j){const de=n.get(ne);if(ne.version>0&&de.__version!==ne.version){J(de,ne,j);return}t.bindTexture(i.TEXTURE_2D_ARRAY,de.__webglTexture,i.TEXTURE0+j)}function K(ne,j){const de=n.get(ne);if(ne.version>0&&de.__version!==ne.version){J(de,ne,j);return}t.bindTexture(i.TEXTURE_3D,de.__webglTexture,i.TEXTURE0+j)}function V(ne,j){const de=n.get(ne);if(ne.version>0&&de.__version!==ne.version){re(de,ne,j);return}t.bindTexture(i.TEXTURE_CUBE_MAP,de.__webglTexture,i.TEXTURE0+j)}const W={[_o]:i.REPEAT,[Wi]:i.CLAMP_TO_EDGE,[eA]:i.MIRRORED_REPEAT},F={[zn]:i.NEAREST,[S2]:i.NEAREST_MIPMAP_NEAREST,[z1]:i.NEAREST_MIPMAP_LINEAR,[Ln]:i.LINEAR,[vw]:i.LINEAR_MIPMAP_NEAREST,[Bl]:i.LINEAR_MIPMAP_LINEAR},Y={[BU]:i.NEVER,[UU]:i.ALWAYS,[DU]:i.LESS,[C6]:i.LEQUAL,[kU]:i.EQUAL,[NU]:i.GEQUAL,[FU]:i.GREATER,[OU]:i.NOTEQUAL};function te(ne,j,de){if(de?(i.texParameteri(ne,i.TEXTURE_WRAP_S,W[j.wrapS]),i.texParameteri(ne,i.TEXTURE_WRAP_T,W[j.wrapT]),(ne===i.TEXTURE_3D||ne===i.TEXTURE_2D_ARRAY)&&i.texParameteri(ne,i.TEXTURE_WRAP_R,W[j.wrapR]),i.texParameteri(ne,i.TEXTURE_MAG_FILTER,F[j.magFilter]),i.texParameteri(ne,i.TEXTURE_MIN_FILTER,F[j.minFilter])):(i.texParameteri(ne,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(ne,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),(ne===i.TEXTURE_3D||ne===i.TEXTURE_2D_ARRAY)&&i.texParameteri(ne,i.TEXTURE_WRAP_R,i.CLAMP_TO_EDGE),(j.wrapS!==Wi||j.wrapT!==Wi)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),i.texParameteri(ne,i.TEXTURE_MAG_FILTER,I(j.magFilter)),i.texParameteri(ne,i.TEXTURE_MIN_FILTER,I(j.minFilter)),j.minFilter!==zn&&j.minFilter!==Ln&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),j.compareFunction&&(i.texParameteri(ne,i.TEXTURE_COMPARE_MODE,i.COMPARE_REF_TO_TEXTURE),i.texParameteri(ne,i.TEXTURE_COMPARE_FUNC,Y[j.compareFunction])),e.has("EXT_texture_filter_anisotropic")===!0){const Re=e.get("EXT_texture_filter_anisotropic");if(j.magFilter===zn||j.minFilter!==z1&&j.minFilter!==Bl||j.type===fi&&e.has("OES_texture_float_linear")===!1||a===!1&&j.type===Ni&&e.has("OES_texture_half_float_linear")===!1)return;(j.anisotropy>1||n.get(j).__currentAnisotropy)&&(i.texParameterf(ne,Re.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(j.anisotropy,r.getMaxAnisotropy())),n.get(j).__currentAnisotropy=j.anisotropy)}}function q(ne,j){let de=!1;ne.__webglInit===void 0&&(ne.__webglInit=!0,j.addEventListener("dispose",M));const Re=j.source;let Le=f.get(Re);Le===void 0&&(Le={},f.set(Re,Le));const Fe=X(j);if(Fe!==ne.__cacheKey){Le[Fe]===void 0&&(Le[Fe]={texture:i.createTexture(),usedTimes:0},o.memory.textures++,de=!0),Le[Fe].usedTimes++;const He=Le[ne.__cacheKey];He!==void 0&&(Le[ne.__cacheKey].usedTimes--,He.usedTimes===0&&R(j)),ne.__cacheKey=Fe,ne.__webglTexture=Le[Fe].texture}return de}function J(ne,j,de){let Re=i.TEXTURE_2D;(j.isDataArrayTexture||j.isCompressedArrayTexture)&&(Re=i.TEXTURE_2D_ARRAY),j.isData3DTexture&&(Re=i.TEXTURE_3D);const Le=q(ne,j),Fe=j.source;t.bindTexture(Re,ne.__webglTexture,i.TEXTURE0+de);const He=n.get(Fe);if(Fe.version!==He.__version||Le===!0){t.activeTexture(i.TEXTURE0+de);const it=Vi.getPrimaries(Vi.workingColorSpace),Ye=j.colorSpace===Tl?null:Vi.getPrimaries(j.colorSpace),ct=j.colorSpace===Tl||it===Ye?i.NONE:i.BROWSER_DEFAULT_WEBGL;i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,j.flipY),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,j.premultiplyAlpha),i.pixelStorei(i.UNPACK_ALIGNMENT,j.unpackAlignment),i.pixelStorei(i.UNPACK_COLORSPACE_CONVERSION_WEBGL,ct);const pt=A(j)&&g(j.image)===!1;let je=y(j.image,pt,!1,r.maxTextureSize);je=be(j,je);const Mt=g(je)||a,Ft=s.convert(j.format,j.colorSpace);let St=s.convert(j.type),gt=w(j.internalFormat,Ft,St,j.colorSpace,j.isVideoTexture);te(Re,j,Mt);let ft;const Ce=j.mipmaps,qe=a&&j.isVideoTexture!==!0&&gt!==_w,At=He.__version===void 0||Le===!0,yt=T(j,je,Mt);if(j.isDepthTexture)gt=i.DEPTH_COMPONENT,a?j.type===fi?gt=i.DEPTH_COMPONENT32F:j.type===Zo?gt=i.DEPTH_COMPONENT24:j.type===Yd?gt=i.DEPTH24_STENCIL8:gt=i.DEPTH_COMPONENT16:j.type===fi&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),j.format===vu&&gt===i.DEPTH_COMPONENT&&j.type!==pp&&j.type!==Zo&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),j.type=Zo,St=s.convert(j.type)),j.format===qm&&gt===i.DEPTH_COMPONENT&&(gt=i.DEPTH_STENCIL,j.type!==Yd&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),j.type=Yd,St=s.convert(j.type))),At&&(qe?t.texStorage2D(i.TEXTURE_2D,1,gt,je.width,je.height):t.texImage2D(i.TEXTURE_2D,0,gt,je.width,je.height,0,Ft,St,null));else if(j.isDataTexture)if(Ce.length>0&&Mt){qe&&At&&t.texStorage2D(i.TEXTURE_2D,yt,gt,Ce[0].width,Ce[0].height);for(let Be=0,we=Ce.length;Be<we;Be++)ft=Ce[Be],qe?t.texSubImage2D(i.TEXTURE_2D,Be,0,0,ft.width,ft.height,Ft,St,ft.data):t.texImage2D(i.TEXTURE_2D,Be,gt,ft.width,ft.height,0,Ft,St,ft.data);j.generateMipmaps=!1}else qe?(At&&t.texStorage2D(i.TEXTURE_2D,yt,gt,je.width,je.height),t.texSubImage2D(i.TEXTURE_2D,0,0,0,je.width,je.height,Ft,St,je.data)):t.texImage2D(i.TEXTURE_2D,0,gt,je.width,je.height,0,Ft,St,je.data);else if(j.isCompressedTexture)if(j.isCompressedArrayTexture){qe&&At&&t.texStorage3D(i.TEXTURE_2D_ARRAY,yt,gt,Ce[0].width,Ce[0].height,je.depth);for(let Be=0,we=Ce.length;Be<we;Be++)ft=Ce[Be],j.format!==gi?Ft!==null?qe?t.compressedTexSubImage3D(i.TEXTURE_2D_ARRAY,Be,0,0,0,ft.width,ft.height,je.depth,Ft,ft.data,0,0):t.compressedTexImage3D(i.TEXTURE_2D_ARRAY,Be,gt,ft.width,ft.height,je.depth,0,ft.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):qe?t.texSubImage3D(i.TEXTURE_2D_ARRAY,Be,0,0,0,ft.width,ft.height,je.depth,Ft,St,ft.data):t.texImage3D(i.TEXTURE_2D_ARRAY,Be,gt,ft.width,ft.height,je.depth,0,Ft,St,ft.data)}else{qe&&At&&t.texStorage2D(i.TEXTURE_2D,yt,gt,Ce[0].width,Ce[0].height);for(let Be=0,we=Ce.length;Be<we;Be++)ft=Ce[Be],j.format!==gi?Ft!==null?qe?t.compressedTexSubImage2D(i.TEXTURE_2D,Be,0,0,ft.width,ft.height,Ft,ft.data):t.compressedTexImage2D(i.TEXTURE_2D,Be,gt,ft.width,ft.height,0,ft.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):qe?t.texSubImage2D(i.TEXTURE_2D,Be,0,0,ft.width,ft.height,Ft,St,ft.data):t.texImage2D(i.TEXTURE_2D,Be,gt,ft.width,ft.height,0,Ft,St,ft.data)}else if(j.isDataArrayTexture)qe?(At&&t.texStorage3D(i.TEXTURE_2D_ARRAY,yt,gt,je.width,je.height,je.depth),t.texSubImage3D(i.TEXTURE_2D_ARRAY,0,0,0,0,je.width,je.height,je.depth,Ft,St,je.data)):t.texImage3D(i.TEXTURE_2D_ARRAY,0,gt,je.width,je.height,je.depth,0,Ft,St,je.data);else if(j.isData3DTexture)qe?(At&&t.texStorage3D(i.TEXTURE_3D,yt,gt,je.width,je.height,je.depth),t.texSubImage3D(i.TEXTURE_3D,0,0,0,0,je.width,je.height,je.depth,Ft,St,je.data)):t.texImage3D(i.TEXTURE_3D,0,gt,je.width,je.height,je.depth,0,Ft,St,je.data);else if(j.isFramebufferTexture){if(At)if(qe)t.texStorage2D(i.TEXTURE_2D,yt,gt,je.width,je.height);else{let Be=je.width,we=je.height;for(let _t=0;_t<yt;_t++)t.texImage2D(i.TEXTURE_2D,_t,gt,Be,we,0,Ft,St,null),Be>>=1,we>>=1}}else if(Ce.length>0&&Mt){qe&&At&&t.texStorage2D(i.TEXTURE_2D,yt,gt,Ce[0].width,Ce[0].height);for(let Be=0,we=Ce.length;Be<we;Be++)ft=Ce[Be],qe?t.texSubImage2D(i.TEXTURE_2D,Be,0,0,Ft,St,ft):t.texImage2D(i.TEXTURE_2D,Be,gt,Ft,St,ft);j.generateMipmaps=!1}else qe?(At&&t.texStorage2D(i.TEXTURE_2D,yt,gt,je.width,je.height),t.texSubImage2D(i.TEXTURE_2D,0,0,0,Ft,St,je)):t.texImage2D(i.TEXTURE_2D,0,gt,Ft,St,je);E(j,Mt)&&x(Re),He.__version=Fe.version,j.onUpdate&&j.onUpdate(j)}ne.__version=j.version}function re(ne,j,de){if(j.image.length!==6)return;const Re=q(ne,j),Le=j.source;t.bindTexture(i.TEXTURE_CUBE_MAP,ne.__webglTexture,i.TEXTURE0+de);const Fe=n.get(Le);if(Le.version!==Fe.__version||Re===!0){t.activeTexture(i.TEXTURE0+de);const He=Vi.getPrimaries(Vi.workingColorSpace),it=j.colorSpace===Tl?null:Vi.getPrimaries(j.colorSpace),Ye=j.colorSpace===Tl||He===it?i.NONE:i.BROWSER_DEFAULT_WEBGL;i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,j.flipY),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,j.premultiplyAlpha),i.pixelStorei(i.UNPACK_ALIGNMENT,j.unpackAlignment),i.pixelStorei(i.UNPACK_COLORSPACE_CONVERSION_WEBGL,Ye);const ct=j.isCompressedTexture||j.image[0].isCompressedTexture,pt=j.image[0]&&j.image[0].isDataTexture,je=[];for(let Be=0;Be<6;Be++)!ct&&!pt?je[Be]=y(j.image[Be],!1,!0,r.maxCubemapSize):je[Be]=pt?j.image[Be].image:j.image[Be],je[Be]=be(j,je[Be]);const Mt=je[0],Ft=g(Mt)||a,St=s.convert(j.format,j.colorSpace),gt=s.convert(j.type),ft=w(j.internalFormat,St,gt,j.colorSpace),Ce=a&&j.isVideoTexture!==!0,qe=Fe.__version===void 0||Re===!0;let At=T(j,Mt,Ft);te(i.TEXTURE_CUBE_MAP,j,Ft);let yt;if(ct){Ce&&qe&&t.texStorage2D(i.TEXTURE_CUBE_MAP,At,ft,Mt.width,Mt.height);for(let Be=0;Be<6;Be++){yt=je[Be].mipmaps;for(let we=0;we<yt.length;we++){const _t=yt[we];j.format!==gi?St!==null?Ce?t.compressedTexSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+Be,we,0,0,_t.width,_t.height,St,_t.data):t.compressedTexImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+Be,we,ft,_t.width,_t.height,0,_t.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):Ce?t.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+Be,we,0,0,_t.width,_t.height,St,gt,_t.data):t.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+Be,we,ft,_t.width,_t.height,0,St,gt,_t.data)}}}else{yt=j.mipmaps,Ce&&qe&&(yt.length>0&&At++,t.texStorage2D(i.TEXTURE_CUBE_MAP,At,ft,je[0].width,je[0].height));for(let Be=0;Be<6;Be++)if(pt){Ce?t.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+Be,0,0,0,je[Be].width,je[Be].height,St,gt,je[Be].data):t.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+Be,0,ft,je[Be].width,je[Be].height,0,St,gt,je[Be].data);for(let we=0;we<yt.length;we++){const vt=yt[we].image[Be].image;Ce?t.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+Be,we+1,0,0,vt.width,vt.height,St,gt,vt.data):t.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+Be,we+1,ft,vt.width,vt.height,0,St,gt,vt.data)}}else{Ce?t.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+Be,0,0,0,St,gt,je[Be]):t.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+Be,0,ft,St,gt,je[Be]);for(let we=0;we<yt.length;we++){const _t=yt[we];Ce?t.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+Be,we+1,0,0,St,gt,_t.image[Be]):t.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+Be,we+1,ft,St,gt,_t.image[Be])}}}E(j,Ft)&&x(i.TEXTURE_CUBE_MAP),Fe.__version=Le.version,j.onUpdate&&j.onUpdate(j)}ne.__version=j.version}function ie(ne,j,de,Re,Le,Fe){const He=s.convert(de.format,de.colorSpace),it=s.convert(de.type),Ye=w(de.internalFormat,He,it,de.colorSpace);if(!n.get(j).__hasExternalTextures){const pt=Math.max(1,j.width>>Fe),je=Math.max(1,j.height>>Fe);Le===i.TEXTURE_3D||Le===i.TEXTURE_2D_ARRAY?t.texImage3D(Le,Fe,Ye,pt,je,j.depth,0,He,it,null):t.texImage2D(Le,Fe,Ye,pt,je,0,He,it,null)}t.bindFramebuffer(i.FRAMEBUFFER,ne),Ae(j)?l.framebufferTexture2DMultisampleEXT(i.FRAMEBUFFER,Re,Le,n.get(de).__webglTexture,0,ve(j)):(Le===i.TEXTURE_2D||Le>=i.TEXTURE_CUBE_MAP_POSITIVE_X&&Le<=i.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&i.framebufferTexture2D(i.FRAMEBUFFER,Re,Le,n.get(de).__webglTexture,Fe),t.bindFramebuffer(i.FRAMEBUFFER,null)}function se(ne,j,de){if(i.bindRenderbuffer(i.RENDERBUFFER,ne),j.depthBuffer&&!j.stencilBuffer){let Re=a===!0?i.DEPTH_COMPONENT24:i.DEPTH_COMPONENT16;if(de||Ae(j)){const Le=j.depthTexture;Le&&Le.isDepthTexture&&(Le.type===fi?Re=i.DEPTH_COMPONENT32F:Le.type===Zo&&(Re=i.DEPTH_COMPONENT24));const Fe=ve(j);Ae(j)?l.renderbufferStorageMultisampleEXT(i.RENDERBUFFER,Fe,Re,j.width,j.height):i.renderbufferStorageMultisample(i.RENDERBUFFER,Fe,Re,j.width,j.height)}else i.renderbufferStorage(i.RENDERBUFFER,Re,j.width,j.height);i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.RENDERBUFFER,ne)}else if(j.depthBuffer&&j.stencilBuffer){const Re=ve(j);de&&Ae(j)===!1?i.renderbufferStorageMultisample(i.RENDERBUFFER,Re,i.DEPTH24_STENCIL8,j.width,j.height):Ae(j)?l.renderbufferStorageMultisampleEXT(i.RENDERBUFFER,Re,i.DEPTH24_STENCIL8,j.width,j.height):i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_STENCIL,j.width,j.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.RENDERBUFFER,ne)}else{const Re=j.isWebGLMultipleRenderTargets===!0?j.texture:[j.texture];for(let Le=0;Le<Re.length;Le++){const Fe=Re[Le],He=s.convert(Fe.format,Fe.colorSpace),it=s.convert(Fe.type),Ye=w(Fe.internalFormat,He,it,Fe.colorSpace),ct=ve(j);de&&Ae(j)===!1?i.renderbufferStorageMultisample(i.RENDERBUFFER,ct,Ye,j.width,j.height):Ae(j)?l.renderbufferStorageMultisampleEXT(i.RENDERBUFFER,ct,Ye,j.width,j.height):i.renderbufferStorage(i.RENDERBUFFER,Ye,j.width,j.height)}}i.bindRenderbuffer(i.RENDERBUFFER,null)}function ge(ne,j){if(j&&j.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(i.FRAMEBUFFER,ne),!(j.depthTexture&&j.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!n.get(j.depthTexture).__webglTexture||j.depthTexture.image.width!==j.width||j.depthTexture.image.height!==j.height)&&(j.depthTexture.image.width=j.width,j.depthTexture.image.height=j.height,j.depthTexture.needsUpdate=!0),Z(j.depthTexture,0);const Re=n.get(j.depthTexture).__webglTexture,Le=ve(j);if(j.depthTexture.format===vu)Ae(j)?l.framebufferTexture2DMultisampleEXT(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.TEXTURE_2D,Re,0,Le):i.framebufferTexture2D(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.TEXTURE_2D,Re,0);else if(j.depthTexture.format===qm)Ae(j)?l.framebufferTexture2DMultisampleEXT(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.TEXTURE_2D,Re,0,Le):i.framebufferTexture2D(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.TEXTURE_2D,Re,0);else throw new Error("Unknown depthTexture format")}function xe(ne){const j=n.get(ne),de=ne.isWebGLCubeRenderTarget===!0;if(ne.depthTexture&&!j.__autoAllocateDepthBuffer){if(de)throw new Error("target.depthTexture not supported in Cube render targets");ge(j.__webglFramebuffer,ne)}else if(de){j.__webglDepthbuffer=[];for(let Re=0;Re<6;Re++)t.bindFramebuffer(i.FRAMEBUFFER,j.__webglFramebuffer[Re]),j.__webglDepthbuffer[Re]=i.createRenderbuffer(),se(j.__webglDepthbuffer[Re],ne,!1)}else t.bindFramebuffer(i.FRAMEBUFFER,j.__webglFramebuffer),j.__webglDepthbuffer=i.createRenderbuffer(),se(j.__webglDepthbuffer,ne,!1);t.bindFramebuffer(i.FRAMEBUFFER,null)}function pe(ne,j,de){const Re=n.get(ne);j!==void 0&&ie(Re.__webglFramebuffer,ne,ne.texture,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,0),de!==void 0&&xe(ne)}function ue(ne){const j=ne.texture,de=n.get(ne),Re=n.get(j);ne.addEventListener("dispose",L),ne.isWebGLMultipleRenderTargets!==!0&&(Re.__webglTexture===void 0&&(Re.__webglTexture=i.createTexture()),Re.__version=j.version,o.memory.textures++);const Le=ne.isWebGLCubeRenderTarget===!0,Fe=ne.isWebGLMultipleRenderTargets===!0,He=g(ne)||a;if(Le){de.__webglFramebuffer=[];for(let it=0;it<6;it++)if(a&&j.mipmaps&&j.mipmaps.length>0){de.__webglFramebuffer[it]=[];for(let Ye=0;Ye<j.mipmaps.length;Ye++)de.__webglFramebuffer[it][Ye]=i.createFramebuffer()}else de.__webglFramebuffer[it]=i.createFramebuffer()}else{if(a&&j.mipmaps&&j.mipmaps.length>0){de.__webglFramebuffer=[];for(let it=0;it<j.mipmaps.length;it++)de.__webglFramebuffer[it]=i.createFramebuffer()}else de.__webglFramebuffer=i.createFramebuffer();if(Fe)if(r.drawBuffers){const it=ne.texture;for(let Ye=0,ct=it.length;Ye<ct;Ye++){const pt=n.get(it[Ye]);pt.__webglTexture===void 0&&(pt.__webglTexture=i.createTexture(),o.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(a&&ne.samples>0&&Ae(ne)===!1){const it=Fe?j:[j];de.__webglMultisampledFramebuffer=i.createFramebuffer(),de.__webglColorRenderbuffer=[],t.bindFramebuffer(i.FRAMEBUFFER,de.__webglMultisampledFramebuffer);for(let Ye=0;Ye<it.length;Ye++){const ct=it[Ye];de.__webglColorRenderbuffer[Ye]=i.createRenderbuffer(),i.bindRenderbuffer(i.RENDERBUFFER,de.__webglColorRenderbuffer[Ye]);const pt=s.convert(ct.format,ct.colorSpace),je=s.convert(ct.type),Mt=w(ct.internalFormat,pt,je,ct.colorSpace,ne.isXRRenderTarget===!0),Ft=ve(ne);i.renderbufferStorageMultisample(i.RENDERBUFFER,Ft,Mt,ne.width,ne.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+Ye,i.RENDERBUFFER,de.__webglColorRenderbuffer[Ye])}i.bindRenderbuffer(i.RENDERBUFFER,null),ne.depthBuffer&&(de.__webglDepthRenderbuffer=i.createRenderbuffer(),se(de.__webglDepthRenderbuffer,ne,!0)),t.bindFramebuffer(i.FRAMEBUFFER,null)}}if(Le){t.bindTexture(i.TEXTURE_CUBE_MAP,Re.__webglTexture),te(i.TEXTURE_CUBE_MAP,j,He);for(let it=0;it<6;it++)if(a&&j.mipmaps&&j.mipmaps.length>0)for(let Ye=0;Ye<j.mipmaps.length;Ye++)ie(de.__webglFramebuffer[it][Ye],ne,j,i.COLOR_ATTACHMENT0,i.TEXTURE_CUBE_MAP_POSITIVE_X+it,Ye);else ie(de.__webglFramebuffer[it],ne,j,i.COLOR_ATTACHMENT0,i.TEXTURE_CUBE_MAP_POSITIVE_X+it,0);E(j,He)&&x(i.TEXTURE_CUBE_MAP),t.unbindTexture()}else if(Fe){const it=ne.texture;for(let Ye=0,ct=it.length;Ye<ct;Ye++){const pt=it[Ye],je=n.get(pt);t.bindTexture(i.TEXTURE_2D,je.__webglTexture),te(i.TEXTURE_2D,pt,He),ie(de.__webglFramebuffer,ne,pt,i.COLOR_ATTACHMENT0+Ye,i.TEXTURE_2D,0),E(pt,He)&&x(i.TEXTURE_2D)}t.unbindTexture()}else{let it=i.TEXTURE_2D;if((ne.isWebGL3DRenderTarget||ne.isWebGLArrayRenderTarget)&&(a?it=ne.isWebGL3DRenderTarget?i.TEXTURE_3D:i.TEXTURE_2D_ARRAY:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),t.bindTexture(it,Re.__webglTexture),te(it,j,He),a&&j.mipmaps&&j.mipmaps.length>0)for(let Ye=0;Ye<j.mipmaps.length;Ye++)ie(de.__webglFramebuffer[Ye],ne,j,i.COLOR_ATTACHMENT0,it,Ye);else ie(de.__webglFramebuffer,ne,j,i.COLOR_ATTACHMENT0,it,0);E(j,He)&&x(it),t.unbindTexture()}ne.depthBuffer&&xe(ne)}function Me(ne){const j=g(ne)||a,de=ne.isWebGLMultipleRenderTargets===!0?ne.texture:[ne.texture];for(let Re=0,Le=de.length;Re<Le;Re++){const Fe=de[Re];if(E(Fe,j)){const He=ne.isWebGLCubeRenderTarget?i.TEXTURE_CUBE_MAP:i.TEXTURE_2D,it=n.get(Fe).__webglTexture;t.bindTexture(He,it),x(He),t.unbindTexture()}}}function Se(ne){if(a&&ne.samples>0&&Ae(ne)===!1){const j=ne.isWebGLMultipleRenderTargets?ne.texture:[ne.texture],de=ne.width,Re=ne.height;let Le=i.COLOR_BUFFER_BIT;const Fe=[],He=ne.stencilBuffer?i.DEPTH_STENCIL_ATTACHMENT:i.DEPTH_ATTACHMENT,it=n.get(ne),Ye=ne.isWebGLMultipleRenderTargets===!0;if(Ye)for(let ct=0;ct<j.length;ct++)t.bindFramebuffer(i.FRAMEBUFFER,it.__webglMultisampledFramebuffer),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+ct,i.RENDERBUFFER,null),t.bindFramebuffer(i.FRAMEBUFFER,it.__webglFramebuffer),i.framebufferTexture2D(i.DRAW_FRAMEBUFFER,i.COLOR_ATTACHMENT0+ct,i.TEXTURE_2D,null,0);t.bindFramebuffer(i.READ_FRAMEBUFFER,it.__webglMultisampledFramebuffer),t.bindFramebuffer(i.DRAW_FRAMEBUFFER,it.__webglFramebuffer);for(let ct=0;ct<j.length;ct++){Fe.push(i.COLOR_ATTACHMENT0+ct),ne.depthBuffer&&Fe.push(He);const pt=it.__ignoreDepthValues!==void 0?it.__ignoreDepthValues:!1;if(pt===!1&&(ne.depthBuffer&&(Le|=i.DEPTH_BUFFER_BIT),ne.stencilBuffer&&(Le|=i.STENCIL_BUFFER_BIT)),Ye&&i.framebufferRenderbuffer(i.READ_FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.RENDERBUFFER,it.__webglColorRenderbuffer[ct]),pt===!0&&(i.invalidateFramebuffer(i.READ_FRAMEBUFFER,[He]),i.invalidateFramebuffer(i.DRAW_FRAMEBUFFER,[He])),Ye){const je=n.get(j[ct]).__webglTexture;i.framebufferTexture2D(i.DRAW_FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,je,0)}i.blitFramebuffer(0,0,de,Re,0,0,de,Re,Le,i.NEAREST),c&&i.invalidateFramebuffer(i.READ_FRAMEBUFFER,Fe)}if(t.bindFramebuffer(i.READ_FRAMEBUFFER,null),t.bindFramebuffer(i.DRAW_FRAMEBUFFER,null),Ye)for(let ct=0;ct<j.length;ct++){t.bindFramebuffer(i.FRAMEBUFFER,it.__webglMultisampledFramebuffer),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+ct,i.RENDERBUFFER,it.__webglColorRenderbuffer[ct]);const pt=n.get(j[ct]).__webglTexture;t.bindFramebuffer(i.FRAMEBUFFER,it.__webglFramebuffer),i.framebufferTexture2D(i.DRAW_FRAMEBUFFER,i.COLOR_ATTACHMENT0+ct,i.TEXTURE_2D,pt,0)}t.bindFramebuffer(i.DRAW_FRAMEBUFFER,it.__webglMultisampledFramebuffer)}}function ve(ne){return Math.min(r.maxSamples,ne.samples)}function Ae(ne){const j=n.get(ne);return a&&ne.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&j.__useRenderToTexture!==!1}function ke(ne){const j=o.render.frame;u.get(ne)!==j&&(u.set(ne,j),ne.update())}function be(ne,j){const de=ne.colorSpace,Re=ne.format,Le=ne.type;return ne.isCompressedTexture===!0||ne.isVideoTexture===!0||ne.format===MS||de!==Dl&&de!==Tl&&(Vi.getTransfer(de)===mr?a===!1?e.has("EXT_sRGB")===!0&&Re===gi?(ne.format=MS,ne.minFilter=Ln,ne.generateMipmaps=!1):j=b6.sRGBToLinear(j):(Re!==gi||Le!==Zi)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",de)),j}this.allocateTextureUnit=G,this.resetTextureUnits=H,this.setTexture2D=Z,this.setTexture2DArray=oe,this.setTexture3D=K,this.setTextureCube=V,this.rebindTextures=pe,this.setupRenderTarget=ue,this.updateRenderTargetMipmap=Me,this.updateMultisampleRenderTarget=Se,this.setupDepthRenderbuffer=xe,this.setupFrameBufferTexture=ie,this.useMultisampledRTT=Ae}function qU(i,e,t){const n=t.isWebGL2;function r(s,o=Tl){let a;const l=Vi.getTransfer(o);if(s===Zi)return i.UNSIGNED_BYTE;if(s===x6)return i.UNSIGNED_SHORT_4_4_4_4;if(s===E6)return i.UNSIGNED_SHORT_5_5_5_1;if(s===w2)return i.BYTE;if(s===xw)return i.SHORT;if(s===pp)return i.UNSIGNED_SHORT;if(s===Um)return i.INT;if(s===Zo)return i.UNSIGNED_INT;if(s===fi)return i.FLOAT;if(s===Ni)return n?i.HALF_FLOAT:(a=e.get("OES_texture_half_float"),a!==null?a.HALF_FLOAT_OES:null);if(s===EU)return i.ALPHA;if(s===gi)return i.RGBA;if(s===_U)return i.LUMINANCE;if(s===SU)return i.LUMINANCE_ALPHA;if(s===vu)return i.DEPTH_COMPONENT;if(s===qm)return i.DEPTH_STENCIL;if(s===MS)return a=e.get("EXT_sRGB"),a!==null?a.SRGB_ALPHA_EXT:null;if(s===hc)return i.RED;if(s===Ew)return i.RED_INTEGER;if(s===Gd)return i.RG;if(s===rx)return i.RG_INTEGER;if(s===Jm)return i.RGBA_INTEGER;if(s===Yv||s===Q_||s===V_||s===$v)if(l===mr)if(a=e.get("WEBGL_compressed_texture_s3tc_srgb"),a!==null){if(s===Yv)return a.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(s===Q_)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(s===V_)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(s===$v)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(a=e.get("WEBGL_compressed_texture_s3tc"),a!==null){if(s===Yv)return a.COMPRESSED_RGB_S3TC_DXT1_EXT;if(s===Q_)return a.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(s===V_)return a.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(s===$v)return a.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(s===_S||s===cM||s===SS||s===uM)if(a=e.get("WEBGL_compressed_texture_pvrtc"),a!==null){if(s===_S)return a.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(s===cM)return a.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(s===SS)return a.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(s===uM)return a.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(s===_w)return a=e.get("WEBGL_compressed_texture_etc1"),a!==null?a.COMPRESSED_RGB_ETC1_WEBGL:null;if(s===wS||s===CS)if(a=e.get("WEBGL_compressed_texture_etc"),a!==null){if(s===wS)return l===mr?a.COMPRESSED_SRGB8_ETC2:a.COMPRESSED_RGB8_ETC2;if(s===CS)return l===mr?a.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:a.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(s===TS||s===hM||s===fM||s===dM||s===C2||s===pM||s===mM||s===gM||s===AM||s===yM||s===vM||s===xM||s===EM||s===_M)if(a=e.get("WEBGL_compressed_texture_astc"),a!==null){if(s===TS)return l===mr?a.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:a.COMPRESSED_RGBA_ASTC_4x4_KHR;if(s===hM)return l===mr?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:a.COMPRESSED_RGBA_ASTC_5x4_KHR;if(s===fM)return l===mr?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:a.COMPRESSED_RGBA_ASTC_5x5_KHR;if(s===dM)return l===mr?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:a.COMPRESSED_RGBA_ASTC_6x5_KHR;if(s===C2)return l===mr?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:a.COMPRESSED_RGBA_ASTC_6x6_KHR;if(s===pM)return l===mr?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:a.COMPRESSED_RGBA_ASTC_8x5_KHR;if(s===mM)return l===mr?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:a.COMPRESSED_RGBA_ASTC_8x6_KHR;if(s===gM)return l===mr?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:a.COMPRESSED_RGBA_ASTC_8x8_KHR;if(s===AM)return l===mr?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:a.COMPRESSED_RGBA_ASTC_10x5_KHR;if(s===yM)return l===mr?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:a.COMPRESSED_RGBA_ASTC_10x6_KHR;if(s===vM)return l===mr?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:a.COMPRESSED_RGBA_ASTC_10x8_KHR;if(s===xM)return l===mr?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:a.COMPRESSED_RGBA_ASTC_10x10_KHR;if(s===EM)return l===mr?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:a.COMPRESSED_RGBA_ASTC_12x10_KHR;if(s===_M)return l===mr?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:a.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(s===Xv||s===SM||s===wM)if(a=e.get("EXT_texture_compression_bptc"),a!==null){if(s===Xv)return l===mr?a.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:a.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(s===SM)return a.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(s===wM)return a.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}else return null;if(s===wU||s===CM||s===TM||s===bM)if(a=e.get("EXT_texture_compression_rgtc"),a!==null){if(s===Xv)return a.COMPRESSED_RED_RGTC1_EXT;if(s===CM)return a.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(s===TM)return a.COMPRESSED_RED_GREEN_RGTC2_EXT;if(s===bM)return a.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return s===Yd?n?i.UNSIGNED_INT_24_8:(a=e.get("WEBGL_depth_texture"),a!==null?a.UNSIGNED_INT_24_8_WEBGL:null):i[s]!==void 0?i[s]:null}return{convert:r}}class JU extends jn{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}}class xa extends _n{constructor(){super(),this.isGroup=!0,this.type="Group"}}const Ote={type:"move"};class uT{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new xa,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new xa,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new Q,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new Q),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new xa,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new Q,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new Q),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const n of e.hand.values())this._getHandJoint(t,n)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,n){let r=null,s=null,o=null;const a=this._targetRay,l=this._grip,c=this._hand;if(e&&t.session.visibilityState!=="visible-blurred"){if(c&&e.hand){o=!0;for(const y of e.hand.values()){const g=t.getJointPose(y,n),A=this._getHandJoint(c,y);g!==null&&(A.matrix.fromArray(g.transform.matrix),A.matrix.decompose(A.position,A.rotation,A.scale),A.matrixWorldNeedsUpdate=!0,A.jointRadius=g.radius),A.visible=g!==null}const u=c.joints["index-finger-tip"],h=c.joints["thumb-tip"],f=u.position.distanceTo(h.position),d=.02,m=.005;c.inputState.pinching&&f>d+m?(c.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!c.inputState.pinching&&f<=d-m&&(c.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else l!==null&&e.gripSpace&&(s=t.getPose(e.gripSpace,n),s!==null&&(l.matrix.fromArray(s.transform.matrix),l.matrix.decompose(l.position,l.rotation,l.scale),l.matrixWorldNeedsUpdate=!0,s.linearVelocity?(l.hasLinearVelocity=!0,l.linearVelocity.copy(s.linearVelocity)):l.hasLinearVelocity=!1,s.angularVelocity?(l.hasAngularVelocity=!0,l.angularVelocity.copy(s.angularVelocity)):l.hasAngularVelocity=!1));a!==null&&(r=t.getPose(e.targetRaySpace,n),r===null&&s!==null&&(r=s),r!==null&&(a.matrix.fromArray(r.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),a.matrixWorldNeedsUpdate=!0,r.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(r.linearVelocity)):a.hasLinearVelocity=!1,r.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(r.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(Ote)))}return a!==null&&(a.visible=r!==null),l!==null&&(l.visible=s!==null),c!==null&&(c.visible=o!==null),this}_getHandJoint(e,t){if(e.joints[t.jointName]===void 0){const n=new xa;n.matrixAutoUpdate=!1,n.visible=!1,e.joints[t.jointName]=n,e.add(n)}return e.joints[t.jointName]}}class Nte extends Ch{constructor(e,t){super();const n=this;let r=null,s=1,o=null,a="local-floor",l=1,c=null,u=null,h=null,f=null,d=null,m=null;const y=t.getContextAttributes();let g=null,A=null;const E=[],x=[],w=new Ue;let T=null;const I=new jn;I.layers.enable(1),I.viewport=new Rn;const M=new jn;M.layers.enable(2),M.viewport=new Rn;const L=[I,M],P=new JU;P.layers.enable(1),P.layers.enable(2);let R=null,U=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(te){let q=E[te];return q===void 0&&(q=new uT,E[te]=q),q.getTargetRaySpace()},this.getControllerGrip=function(te){let q=E[te];return q===void 0&&(q=new uT,E[te]=q),q.getGripSpace()},this.getHand=function(te){let q=E[te];return q===void 0&&(q=new uT,E[te]=q),q.getHandSpace()};function k(te){const q=x.indexOf(te.inputSource);if(q===-1)return;const J=E[q];J!==void 0&&(J.update(te.inputSource,te.frame,c||o),J.dispatchEvent({type:te.type,data:te.inputSource}))}function H(){r.removeEventListener("select",k),r.removeEventListener("selectstart",k),r.removeEventListener("selectend",k),r.removeEventListener("squeeze",k),r.removeEventListener("squeezestart",k),r.removeEventListener("squeezeend",k),r.removeEventListener("end",H),r.removeEventListener("inputsourceschange",G);for(let te=0;te<E.length;te++){const q=x[te];q!==null&&(x[te]=null,E[te].disconnect(q))}R=null,U=null,e.setRenderTarget(g),d=null,f=null,h=null,r=null,A=null,Y.stop(),n.isPresenting=!1,e.setPixelRatio(T),e.setSize(w.width,w.height,!1),n.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(te){s=te,n.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(te){a=te,n.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return c||o},this.setReferenceSpace=function(te){c=te},this.getBaseLayer=function(){return f!==null?f:d},this.getBinding=function(){return h},this.getFrame=function(){return m},this.getSession=function(){return r},this.setSession=async function(te){if(r=te,r!==null){if(g=e.getRenderTarget(),r.addEventListener("select",k),r.addEventListener("selectstart",k),r.addEventListener("selectend",k),r.addEventListener("squeeze",k),r.addEventListener("squeezestart",k),r.addEventListener("squeezeend",k),r.addEventListener("end",H),r.addEventListener("inputsourceschange",G),y.xrCompatible!==!0&&await t.makeXRCompatible(),T=e.getPixelRatio(),e.getSize(w),r.renderState.layers===void 0||e.capabilities.isWebGL2===!1){const q={antialias:r.renderState.layers===void 0?y.antialias:!0,alpha:!0,depth:y.depth,stencil:y.stencil,framebufferScaleFactor:s};d=new XRWebGLLayer(r,t,q),r.updateRenderState({baseLayer:d}),e.setPixelRatio(1),e.setSize(d.framebufferWidth,d.framebufferHeight,!1),A=new Si(d.framebufferWidth,d.framebufferHeight,{format:gi,type:Zi,colorSpace:e.outputColorSpace,stencilBuffer:y.stencil})}else{let q=null,J=null,re=null;y.depth&&(re=y.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,q=y.stencil?qm:vu,J=y.stencil?Yd:Zo);const ie={colorFormat:t.RGBA8,depthFormat:re,scaleFactor:s};h=new XRWebGLBinding(r,t),f=h.createProjectionLayer(ie),r.updateRenderState({layers:[f]}),e.setPixelRatio(1),e.setSize(f.textureWidth,f.textureHeight,!1),A=new Si(f.textureWidth,f.textureHeight,{format:gi,type:Zi,depthTexture:new d0(f.textureWidth,f.textureHeight,J,void 0,void 0,void 0,void 0,void 0,void 0,q),stencilBuffer:y.stencil,colorSpace:e.outputColorSpace,samples:y.antialias?4:0});const se=e.properties.get(A);se.__ignoreDepthValues=f.ignoreDepthValues}A.isXRRenderTarget=!0,this.setFoveation(l),c=null,o=await r.requestReferenceSpace(a),Y.setContext(r),Y.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(r!==null)return r.environmentBlendMode};function G(te){for(let q=0;q<te.removed.length;q++){const J=te.removed[q],re=x.indexOf(J);re>=0&&(x[re]=null,E[re].disconnect(J))}for(let q=0;q<te.added.length;q++){const J=te.added[q];let re=x.indexOf(J);if(re===-1){for(let se=0;se<E.length;se++)if(se>=x.length){x.push(J),re=se;break}else if(x[se]===null){x[se]=J,re=se;break}if(re===-1)break}const ie=E[re];ie&&ie.connect(J)}}const X=new Q,Z=new Q;function oe(te,q,J){X.setFromMatrixPosition(q.matrixWorld),Z.setFromMatrixPosition(J.matrixWorld);const re=X.distanceTo(Z),ie=q.projectionMatrix.elements,se=J.projectionMatrix.elements,ge=ie[14]/(ie[10]-1),xe=ie[14]/(ie[10]+1),pe=(ie[9]+1)/ie[5],ue=(ie[9]-1)/ie[5],Me=(ie[8]-1)/ie[0],Se=(se[8]+1)/se[0],ve=ge*Me,Ae=ge*Se,ke=re/(-Me+Se),be=ke*-Me;q.matrixWorld.decompose(te.position,te.quaternion,te.scale),te.translateX(be),te.translateZ(ke),te.matrixWorld.compose(te.position,te.quaternion,te.scale),te.matrixWorldInverse.copy(te.matrixWorld).invert();const ne=ge+ke,j=xe+ke,de=ve-be,Re=Ae+(re-be),Le=pe*xe/j*ne,Fe=ue*xe/j*ne;te.projectionMatrix.makePerspective(de,Re,Le,Fe,ne,j),te.projectionMatrixInverse.copy(te.projectionMatrix).invert()}function K(te,q){q===null?te.matrixWorld.copy(te.matrix):te.matrixWorld.multiplyMatrices(q.matrixWorld,te.matrix),te.matrixWorldInverse.copy(te.matrixWorld).invert()}this.updateCamera=function(te){if(r===null)return;P.near=M.near=I.near=te.near,P.far=M.far=I.far=te.far,(R!==P.near||U!==P.far)&&(r.updateRenderState({depthNear:P.near,depthFar:P.far}),R=P.near,U=P.far);const q=te.parent,J=P.cameras;K(P,q);for(let re=0;re<J.length;re++)K(J[re],q);J.length===2?oe(P,I,M):P.projectionMatrix.copy(I.projectionMatrix),V(te,P,q)};function V(te,q,J){J===null?te.matrix.copy(q.matrixWorld):(te.matrix.copy(J.matrixWorld),te.matrix.invert(),te.matrix.multiply(q.matrixWorld)),te.matrix.decompose(te.position,te.quaternion,te.scale),te.updateMatrixWorld(!0),te.projectionMatrix.copy(q.projectionMatrix),te.projectionMatrixInverse.copy(q.projectionMatrixInverse),te.isPerspectiveCamera&&(te.fov=iA*2*Math.atan(1/te.projectionMatrix.elements[5]),te.zoom=1)}this.getCamera=function(){return P},this.getFoveation=function(){if(!(f===null&&d===null))return l},this.setFoveation=function(te){l=te,f!==null&&(f.fixedFoveation=te),d!==null&&d.fixedFoveation!==void 0&&(d.fixedFoveation=te)};let W=null;function F(te,q){if(u=q.getViewerPose(c||o),m=q,u!==null){const J=u.views;d!==null&&(e.setRenderTargetFramebuffer(A,d.framebuffer),e.setRenderTarget(A));let re=!1;J.length!==P.cameras.length&&(P.cameras.length=0,re=!0);for(let ie=0;ie<J.length;ie++){const se=J[ie];let ge=null;if(d!==null)ge=d.getViewport(se);else{const pe=h.getViewSubImage(f,se);ge=pe.viewport,ie===0&&(e.setRenderTargetTextures(A,pe.colorTexture,f.ignoreDepthValues?void 0:pe.depthStencilTexture),e.setRenderTarget(A))}let xe=L[ie];xe===void 0&&(xe=new jn,xe.layers.enable(ie),xe.viewport=new Rn,L[ie]=xe),xe.matrix.fromArray(se.transform.matrix),xe.matrix.decompose(xe.position,xe.quaternion,xe.scale),xe.projectionMatrix.fromArray(se.projectionMatrix),xe.projectionMatrixInverse.copy(xe.projectionMatrix).invert(),xe.viewport.set(ge.x,ge.y,ge.width,ge.height),ie===0&&(P.matrix.copy(xe.matrix),P.matrix.decompose(P.position,P.quaternion,P.scale)),re===!0&&P.cameras.push(xe)}}for(let J=0;J<E.length;J++){const re=x[J],ie=E[J];re!==null&&ie!==void 0&&ie.update(re,q,c||o)}W&&W(te,q),q.detectedPlanes&&n.dispatchEvent({type:"planesdetected",data:q}),m=null}const Y=new jU;Y.setAnimationLoop(F),this.setAnimationLoop=function(te){W=te},this.dispose=function(){}}}function Ute(i,e){function t(g,A){g.matrixAutoUpdate===!0&&g.updateMatrix(),A.value.copy(g.matrix)}function n(g,A){A.color.getRGB(g.fogColor.value,VU(i)),A.isFog?(g.fogNear.value=A.near,g.fogFar.value=A.far):A.isFogExp2&&(g.fogDensity.value=A.density)}function r(g,A,E,x,w){A.isMeshBasicMaterial||A.isMeshLambertMaterial?s(g,A):A.isMeshToonMaterial?(s(g,A),h(g,A)):A.isMeshPhongMaterial?(s(g,A),u(g,A)):A.isMeshStandardMaterial?(s(g,A),f(g,A),A.isMeshPhysicalMaterial&&d(g,A,w)):A.isMeshMatcapMaterial?(s(g,A),m(g,A)):A.isMeshDepthMaterial?s(g,A):A.isMeshDistanceMaterial?(s(g,A),y(g,A)):A.isMeshNormalMaterial?s(g,A):A.isLineBasicMaterial?(o(g,A),A.isLineDashedMaterial&&a(g,A)):A.isPointsMaterial?l(g,A,E,x):A.isSpriteMaterial?c(g,A):A.isShadowMaterial?(g.color.value.copy(A.color),g.opacity.value=A.opacity):A.isShaderMaterial&&(A.uniformsNeedUpdate=!1)}function s(g,A){g.opacity.value=A.opacity,A.color&&g.diffuse.value.copy(A.color),A.emissive&&g.emissive.value.copy(A.emissive).multiplyScalar(A.emissiveIntensity),A.map&&(g.map.value=A.map,t(A.map,g.mapTransform)),A.alphaMap&&(g.alphaMap.value=A.alphaMap,t(A.alphaMap,g.alphaMapTransform)),A.bumpMap&&(g.bumpMap.value=A.bumpMap,t(A.bumpMap,g.bumpMapTransform),g.bumpScale.value=A.bumpScale,A.side===ys&&(g.bumpScale.value*=-1)),A.normalMap&&(g.normalMap.value=A.normalMap,t(A.normalMap,g.normalMapTransform),g.normalScale.value.copy(A.normalScale),A.side===ys&&g.normalScale.value.negate()),A.displacementMap&&(g.displacementMap.value=A.displacementMap,t(A.displacementMap,g.displacementMapTransform),g.displacementScale.value=A.displacementScale,g.displacementBias.value=A.displacementBias),A.emissiveMap&&(g.emissiveMap.value=A.emissiveMap,t(A.emissiveMap,g.emissiveMapTransform)),A.specularMap&&(g.specularMap.value=A.specularMap,t(A.specularMap,g.specularMapTransform)),A.alphaTest>0&&(g.alphaTest.value=A.alphaTest);const E=e.get(A).envMap;if(E&&(g.envMap.value=E,g.flipEnvMap.value=E.isCubeTexture&&E.isRenderTargetTexture===!1?-1:1,g.reflectivity.value=A.reflectivity,g.ior.value=A.ior,g.refractionRatio.value=A.refractionRatio),A.lightMap){g.lightMap.value=A.lightMap;const x=i._useLegacyLights===!0?Math.PI:1;g.lightMapIntensity.value=A.lightMapIntensity*x,t(A.lightMap,g.lightMapTransform)}A.aoMap&&(g.aoMap.value=A.aoMap,g.aoMapIntensity.value=A.aoMapIntensity,t(A.aoMap,g.aoMapTransform))}function o(g,A){g.diffuse.value.copy(A.color),g.opacity.value=A.opacity,A.map&&(g.map.value=A.map,t(A.map,g.mapTransform))}function a(g,A){g.dashSize.value=A.dashSize,g.totalSize.value=A.dashSize+A.gapSize,g.scale.value=A.scale}function l(g,A,E,x){g.diffuse.value.copy(A.color),g.opacity.value=A.opacity,g.size.value=A.size*E,g.scale.value=x*.5,A.map&&(g.map.value=A.map,t(A.map,g.uvTransform)),A.alphaMap&&(g.alphaMap.value=A.alphaMap,t(A.alphaMap,g.alphaMapTransform)),A.alphaTest>0&&(g.alphaTest.value=A.alphaTest)}function c(g,A){g.diffuse.value.copy(A.color),g.opacity.value=A.opacity,g.rotation.value=A.rotation,A.map&&(g.map.value=A.map,t(A.map,g.mapTransform)),A.alphaMap&&(g.alphaMap.value=A.alphaMap,t(A.alphaMap,g.alphaMapTransform)),A.alphaTest>0&&(g.alphaTest.value=A.alphaTest)}function u(g,A){g.specular.value.copy(A.specular),g.shininess.value=Math.max(A.shininess,1e-4)}function h(g,A){A.gradientMap&&(g.gradientMap.value=A.gradientMap)}function f(g,A){g.metalness.value=A.metalness,A.metalnessMap&&(g.metalnessMap.value=A.metalnessMap,t(A.metalnessMap,g.metalnessMapTransform)),g.roughness.value=A.roughness,A.roughnessMap&&(g.roughnessMap.value=A.roughnessMap,t(A.roughnessMap,g.roughnessMapTransform)),e.get(A).envMap&&(g.envMapIntensity.value=A.envMapIntensity)}function d(g,A,E){g.ior.value=A.ior,A.sheen>0&&(g.sheenColor.value.copy(A.sheenColor).multiplyScalar(A.sheen),g.sheenRoughness.value=A.sheenRoughness,A.sheenColorMap&&(g.sheenColorMap.value=A.sheenColorMap,t(A.sheenColorMap,g.sheenColorMapTransform)),A.sheenRoughnessMap&&(g.sheenRoughnessMap.value=A.sheenRoughnessMap,t(A.sheenRoughnessMap,g.sheenRoughnessMapTransform))),A.clearcoat>0&&(g.clearcoat.value=A.clearcoat,g.clearcoatRoughness.value=A.clearcoatRoughness,A.clearcoatMap&&(g.clearcoatMap.value=A.clearcoatMap,t(A.clearcoatMap,g.clearcoatMapTransform)),A.clearcoatRoughnessMap&&(g.clearcoatRoughnessMap.value=A.clearcoatRoughnessMap,t(A.clearcoatRoughnessMap,g.clearcoatRoughnessMapTransform)),A.clearcoatNormalMap&&(g.clearcoatNormalMap.value=A.clearcoatNormalMap,t(A.clearcoatNormalMap,g.clearcoatNormalMapTransform),g.clearcoatNormalScale.value.copy(A.clearcoatNormalScale),A.side===ys&&g.clearcoatNormalScale.value.negate())),A.iridescence>0&&(g.iridescence.value=A.iridescence,g.iridescenceIOR.value=A.iridescenceIOR,g.iridescenceThicknessMinimum.value=A.iridescenceThicknessRange[0],g.iridescenceThicknessMaximum.value=A.iridescenceThicknessRange[1],A.iridescenceMap&&(g.iridescenceMap.value=A.iridescenceMap,t(A.iridescenceMap,g.iridescenceMapTransform)),A.iridescenceThicknessMap&&(g.iridescenceThicknessMap.value=A.iridescenceThicknessMap,t(A.iridescenceThicknessMap,g.iridescenceThicknessMapTransform))),A.transmission>0&&(g.transmission.value=A.transmission,g.transmissionSamplerMap.value=E.texture,g.transmissionSamplerSize.value.set(E.width,E.height),A.transmissionMap&&(g.transmissionMap.value=A.transmissionMap,t(A.transmissionMap,g.transmissionMapTransform)),g.thickness.value=A.thickness,A.thicknessMap&&(g.thicknessMap.value=A.thicknessMap,t(A.thicknessMap,g.thicknessMapTransform)),g.attenuationDistance.value=A.attenuationDistance,g.attenuationColor.value.copy(A.attenuationColor)),A.anisotropy>0&&(g.anisotropyVector.value.set(A.anisotropy*Math.cos(A.anisotropyRotation),A.anisotropy*Math.sin(A.anisotropyRotation)),A.anisotropyMap&&(g.anisotropyMap.value=A.anisotropyMap,t(A.anisotropyMap,g.anisotropyMapTransform))),g.specularIntensity.value=A.specularIntensity,g.specularColor.value.copy(A.specularColor),A.specularColorMap&&(g.specularColorMap.value=A.specularColorMap,t(A.specularColorMap,g.specularColorMapTransform)),A.specularIntensityMap&&(g.specularIntensityMap.value=A.specularIntensityMap,t(A.specularIntensityMap,g.specularIntensityMapTransform))}function m(g,A){A.matcap&&(g.matcap.value=A.matcap)}function y(g,A){const E=e.get(A).light;g.referencePosition.value.setFromMatrixPosition(E.matrixWorld),g.nearDistance.value=E.shadow.camera.near,g.farDistance.value=E.shadow.camera.far}return{refreshFogUniforms:n,refreshMaterialUniforms:r}}function zte(i,e,t,n){let r={},s={},o=[];const a=t.isWebGL2?i.getParameter(i.MAX_UNIFORM_BUFFER_BINDINGS):0;function l(E,x){const w=x.program;n.uniformBlockBinding(E,w)}function c(E,x){let w=r[E.id];w===void 0&&(m(E),w=u(E),r[E.id]=w,E.addEventListener("dispose",g));const T=x.program;n.updateUBOMapping(E,T);const I=e.render.frame;s[E.id]!==I&&(f(E),s[E.id]=I)}function u(E){const x=h();E.__bindingPointIndex=x;const w=i.createBuffer(),T=E.__size,I=E.usage;return i.bindBuffer(i.UNIFORM_BUFFER,w),i.bufferData(i.UNIFORM_BUFFER,T,I),i.bindBuffer(i.UNIFORM_BUFFER,null),i.bindBufferBase(i.UNIFORM_BUFFER,x,w),w}function h(){for(let E=0;E<a;E++)if(o.indexOf(E)===-1)return o.push(E),E;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function f(E){const x=r[E.id],w=E.uniforms,T=E.__cache;i.bindBuffer(i.UNIFORM_BUFFER,x);for(let I=0,M=w.length;I<M;I++){const L=Array.isArray(w[I])?w[I]:[w[I]];for(let P=0,R=L.length;P<R;P++){const U=L[P];if(d(U,I,P,T)===!0){const k=U.__offset,H=Array.isArray(U.value)?U.value:[U.value];let G=0;for(let X=0;X<H.length;X++){const Z=H[X],oe=y(Z);typeof Z=="number"||typeof Z=="boolean"?(U.__data[0]=Z,i.bufferSubData(i.UNIFORM_BUFFER,k+G,U.__data)):Z.isMatrix3?(U.__data[0]=Z.elements[0],U.__data[1]=Z.elements[1],U.__data[2]=Z.elements[2],U.__data[3]=0,U.__data[4]=Z.elements[3],U.__data[5]=Z.elements[4],U.__data[6]=Z.elements[5],U.__data[7]=0,U.__data[8]=Z.elements[6],U.__data[9]=Z.elements[7],U.__data[10]=Z.elements[8],U.__data[11]=0):(Z.toArray(U.__data,G),G+=oe.storage/Float32Array.BYTES_PER_ELEMENT)}i.bufferSubData(i.UNIFORM_BUFFER,k,U.__data)}}}i.bindBuffer(i.UNIFORM_BUFFER,null)}function d(E,x,w,T){const I=E.value,M=x+"_"+w;if(T[M]===void 0)return typeof I=="number"||typeof I=="boolean"?T[M]=I:T[M]=I.clone(),!0;{const L=T[M];if(typeof I=="number"||typeof I=="boolean"){if(L!==I)return T[M]=I,!0}else if(L.equals(I)===!1)return L.copy(I),!0}return!1}function m(E){const x=E.uniforms;let w=0;const T=16;for(let M=0,L=x.length;M<L;M++){const P=Array.isArray(x[M])?x[M]:[x[M]];for(let R=0,U=P.length;R<U;R++){const k=P[R],H=Array.isArray(k.value)?k.value:[k.value];for(let G=0,X=H.length;G<X;G++){const Z=H[G],oe=y(Z),K=w%T;K!==0&&T-K<oe.boundary&&(w+=T-K),k.__data=new Float32Array(oe.storage/Float32Array.BYTES_PER_ELEMENT),k.__offset=w,w+=oe.storage}}}const I=w%T;return I>0&&(w+=T-I),E.__size=w,E.__cache={},this}function y(E){const x={boundary:0,storage:0};return typeof E=="number"||typeof E=="boolean"?(x.boundary=4,x.storage=4):E.isVector2?(x.boundary=8,x.storage=8):E.isVector3||E.isColor?(x.boundary=16,x.storage=12):E.isVector4?(x.boundary=16,x.storage=16):E.isMatrix3?(x.boundary=48,x.storage=48):E.isMatrix4?(x.boundary=64,x.storage=64):E.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",E),x}function g(E){const x=E.target;x.removeEventListener("dispose",g);const w=o.indexOf(x.__bindingPointIndex);o.splice(w,1),i.deleteBuffer(r[x.id]),delete r[x.id],delete s[x.id]}function A(){for(const E in r)i.deleteBuffer(r[E]);o=[],r={},s={}}return{bind:l,update:c,dispose:A}}class Pw{constructor(e={}){const{canvas:t=GU(),context:n=null,depth:r=!0,stencil:s=!0,alpha:o=!1,antialias:a=!1,premultipliedAlpha:l=!0,preserveDrawingBuffer:c=!1,powerPreference:u="default",failIfMajorPerformanceCaveat:h=!1}=e;this.isWebGLRenderer=!0;let f;n!==null?f=n.getContextAttributes().alpha:f=o;const d=new Uint32Array(4),m=new Int32Array(4);let y=null,g=null;const A=[],E=[];this.domElement=t,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=gs,this._useLegacyLights=!1,this.toneMapping=yu,this.toneMappingExposure=1;const x=this;let w=!1,T=0,I=0,M=null,L=-1,P=null;const R=new Rn,U=new Rn;let k=null;const H=new ut(0);let G=0,X=t.width,Z=t.height,oe=1,K=null,V=null;const W=new Rn(0,0,X,Z),F=new Rn(0,0,X,Z);let Y=!1;const te=new f0;let q=!1,J=!1,re=null;const ie=new Xe,se=new Ue,ge=new Q,xe={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function pe(){return M===null?oe:1}let ue=n;function Me(ce,ye){for(let Ee=0;Ee<ce.length;Ee++){const Pe=ce[Ee],Ie=t.getContext(Pe,ye);if(Ie!==null)return Ie}return null}try{const ce={alpha:!0,depth:r,stencil:s,antialias:a,premultipliedAlpha:l,preserveDrawingBuffer:c,powerPreference:u,failIfMajorPerformanceCaveat:h};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${dp}`),t.addEventListener("webglcontextlost",Be,!1),t.addEventListener("webglcontextrestored",we,!1),t.addEventListener("webglcontextcreationerror",_t,!1),ue===null){const ye=["webgl2","webgl","experimental-webgl"];if(x.isWebGL1Renderer===!0&&ye.shift(),ue=Me(ye,ce),ue===null)throw Me(ye)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}typeof WebGLRenderingContext<"u"&&ue instanceof WebGLRenderingContext&&console.warn("THREE.WebGLRenderer: WebGL 1 support was deprecated in r153 and will be removed in r163."),ue.getShaderPrecisionFormat===void 0&&(ue.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(ce){throw console.error("THREE.WebGLRenderer: "+ce.message),ce}let Se,ve,Ae,ke,be,ne,j,de,Re,Le,Fe,He,it,Ye,ct,pt,je,Mt,Ft,St,gt,ft,Ce,qe;function At(){Se=new eee(ue),ve=new YZ(ue,Se,e),Se.init(ve),ft=new qU(ue,Se,ve),Ae=new kte(ue,Se,ve),ke=new iee(ue),be=new Ste,ne=new Fte(ue,Se,Ae,be,ve,ft,ke),j=new XZ(x),de=new ZZ(x),Re=new hq(ue,ve),Ce=new WZ(ue,Se,Re,ve),Le=new tee(ue,Re,ke,Ce),Fe=new aee(ue,Le,Re,ke),Ft=new oee(ue,ve,ne),pt=new $Z(be),He=new _te(x,j,de,Se,ve,Ce,pt),it=new Ute(x,be),Ye=new Cte,ct=new Pte(Se,ve),Mt=new jZ(x,j,de,Ae,Fe,f,l),je=new Dte(x,Fe,ve),qe=new zte(ue,ke,ve,Ae),St=new KZ(ue,Se,ke,ve),gt=new nee(ue,Se,ke,ve),ke.programs=He.programs,x.capabilities=ve,x.extensions=Se,x.properties=be,x.renderLists=Ye,x.shadowMap=je,x.state=Ae,x.info=ke}At();const yt=new Nte(x,ue);this.xr=yt,this.getContext=function(){return ue},this.getContextAttributes=function(){return ue.getContextAttributes()},this.forceContextLoss=function(){const ce=Se.get("WEBGL_lose_context");ce&&ce.loseContext()},this.forceContextRestore=function(){const ce=Se.get("WEBGL_lose_context");ce&&ce.restoreContext()},this.getPixelRatio=function(){return oe},this.setPixelRatio=function(ce){ce!==void 0&&(oe=ce,this.setSize(X,Z,!1))},this.getSize=function(ce){return ce.set(X,Z)},this.setSize=function(ce,ye,Ee=!0){if(yt.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}X=ce,Z=ye,t.width=Math.floor(ce*oe),t.height=Math.floor(ye*oe),Ee===!0&&(t.style.width=ce+"px",t.style.height=ye+"px"),this.setViewport(0,0,ce,ye)},this.getDrawingBufferSize=function(ce){return ce.set(X*oe,Z*oe).floor()},this.setDrawingBufferSize=function(ce,ye,Ee){X=ce,Z=ye,oe=Ee,t.width=Math.floor(ce*Ee),t.height=Math.floor(ye*Ee),this.setViewport(0,0,ce,ye)},this.getCurrentViewport=function(ce){return ce.copy(R)},this.getViewport=function(ce){return ce.copy(W)},this.setViewport=function(ce,ye,Ee,Pe){ce.isVector4?W.set(ce.x,ce.y,ce.z,ce.w):W.set(ce,ye,Ee,Pe),Ae.viewport(R.copy(W).multiplyScalar(oe).floor())},this.getScissor=function(ce){return ce.copy(F)},this.setScissor=function(ce,ye,Ee,Pe){ce.isVector4?F.set(ce.x,ce.y,ce.z,ce.w):F.set(ce,ye,Ee,Pe),Ae.scissor(U.copy(F).multiplyScalar(oe).floor())},this.getScissorTest=function(){return Y},this.setScissorTest=function(ce){Ae.setScissorTest(Y=ce)},this.setOpaqueSort=function(ce){K=ce},this.setTransparentSort=function(ce){V=ce},this.getClearColor=function(ce){return ce.copy(Mt.getClearColor())},this.setClearColor=function(){Mt.setClearColor.apply(Mt,arguments)},this.getClearAlpha=function(){return Mt.getClearAlpha()},this.setClearAlpha=function(){Mt.setClearAlpha.apply(Mt,arguments)},this.clear=function(ce=!0,ye=!0,Ee=!0){let Pe=0;if(ce){let Ie=!1;if(M!==null){const Je=M.texture.format;Ie=Je===Jm||Je===rx||Je===Ew}if(Ie){const Je=M.texture.type,st=Je===Zi||Je===Zo||Je===pp||Je===Yd||Je===x6||Je===E6,lt=Mt.getClearColor(),Oe=Mt.getClearAlpha(),Ht=lt.r,xt=lt.g,Et=lt.b;st?(d[0]=Ht,d[1]=xt,d[2]=Et,d[3]=Oe,ue.clearBufferuiv(ue.COLOR,0,d)):(m[0]=Ht,m[1]=xt,m[2]=Et,m[3]=Oe,ue.clearBufferiv(ue.COLOR,0,m))}else Pe|=ue.COLOR_BUFFER_BIT}ye&&(Pe|=ue.DEPTH_BUFFER_BIT),Ee&&(Pe|=ue.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),ue.clear(Pe)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",Be,!1),t.removeEventListener("webglcontextrestored",we,!1),t.removeEventListener("webglcontextcreationerror",_t,!1),Ye.dispose(),ct.dispose(),be.dispose(),j.dispose(),de.dispose(),Fe.dispose(),Ce.dispose(),qe.dispose(),He.dispose(),yt.dispose(),yt.removeEventListener("sessionstart",Vn),yt.removeEventListener("sessionend",pn),re&&(re.dispose(),re=null),qn.stop()};function Be(ce){ce.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),w=!0}function we(){console.log("THREE.WebGLRenderer: Context Restored."),w=!1;const ce=ke.autoReset,ye=je.enabled,Ee=je.autoUpdate,Pe=je.needsUpdate,Ie=je.type;At(),ke.autoReset=ce,je.enabled=ye,je.autoUpdate=Ee,je.needsUpdate=Pe,je.type=Ie}function _t(ce){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",ce.statusMessage)}function vt(ce){const ye=ce.target;ye.removeEventListener("dispose",vt),bt(ye)}function bt(ce){Lt(ce),be.remove(ce)}function Lt(ce){const ye=be.get(ce).programs;ye!==void 0&&(ye.forEach(function(Ee){He.releaseProgram(Ee)}),ce.isShaderMaterial&&He.releaseShaderCache(ce))}this.renderBufferDirect=function(ce,ye,Ee,Pe,Ie,Je){ye===null&&(ye=xe);const st=Ie.isMesh&&Ie.matrixWorld.determinant()<0,lt=he(ce,ye,Ee,Pe,Ie);Ae.setMaterial(Pe,st);let Oe=Ee.index,Ht=1;if(Pe.wireframe===!0){if(Oe=Le.getWireframeAttribute(Ee),Oe===void 0)return;Ht=2}const xt=Ee.drawRange,Et=Ee.attributes.position;let Qt=xt.start*Ht,sn=(xt.start+xt.count)*Ht;Je!==null&&(Qt=Math.max(Qt,Je.start*Ht),sn=Math.min(sn,(Je.start+Je.count)*Ht)),Oe!==null?(Qt=Math.max(Qt,0),sn=Math.min(sn,Oe.count)):Et!=null&&(Qt=Math.max(Qt,0),sn=Math.min(sn,Et.count));const ln=sn-Qt;if(ln<0||ln===1/0)return;Ce.setup(Ie,Pe,lt,Ee,Oe);let vn,Dt=St;if(Oe!==null&&(vn=Re.get(Oe),Dt=gt,Dt.setIndex(vn)),Ie.isMesh)Pe.wireframe===!0?(Ae.setLineWidth(Pe.wireframeLinewidth*pe()),Dt.setMode(ue.LINES)):Dt.setMode(ue.TRIANGLES);else if(Ie.isLine){let Bt=Pe.linewidth;Bt===void 0&&(Bt=1),Ae.setLineWidth(Bt*pe()),Ie.isLineSegments?Dt.setMode(ue.LINES):Ie.isLineLoop?Dt.setMode(ue.LINE_LOOP):Dt.setMode(ue.LINE_STRIP)}else Ie.isPoints?Dt.setMode(ue.POINTS):Ie.isSprite&&Dt.setMode(ue.TRIANGLES);if(Ie.isBatchedMesh)Dt.renderMultiDraw(Ie._multiDrawStarts,Ie._multiDrawCounts,Ie._multiDrawCount);else if(Ie.isInstancedMesh)Dt.renderInstances(Qt,ln,Ie.count);else if(Ee.isInstancedBufferGeometry){const Bt=Ee._maxInstanceCount!==void 0?Ee._maxInstanceCount:1/0,yn=Math.min(Ee.instanceCount,Bt);Dt.renderInstances(Qt,ln,yn)}else Dt.render(Qt,ln)};function qt(ce,ye,Ee){ce.transparent===!0&&ce.side===Li&&ce.forceSinglePass===!1?(ce.side=ys,ce.needsUpdate=!0,An(ce,ye,Ee),ce.side=tl,ce.needsUpdate=!0,An(ce,ye,Ee),ce.side=Li):An(ce,ye,Ee)}this.compile=function(ce,ye,Ee=null){Ee===null&&(Ee=ce),g=ct.get(Ee),g.init(),E.push(g),Ee.traverseVisible(function(Ie){Ie.isLight&&Ie.layers.test(ye.layers)&&(g.pushLight(Ie),Ie.castShadow&&g.pushShadow(Ie))}),ce!==Ee&&ce.traverseVisible(function(Ie){Ie.isLight&&Ie.layers.test(ye.layers)&&(g.pushLight(Ie),Ie.castShadow&&g.pushShadow(Ie))}),g.setupLights(x._useLegacyLights);const Pe=new Set;return ce.traverse(function(Ie){const Je=Ie.material;if(Je)if(Array.isArray(Je))for(let st=0;st<Je.length;st++){const lt=Je[st];qt(lt,Ee,Ie),Pe.add(lt)}else qt(Je,Ee,Ie),Pe.add(Je)}),E.pop(),g=null,Pe},this.compileAsync=function(ce,ye,Ee=null){const Pe=this.compile(ce,ye,Ee);return new Promise(Ie=>{function Je(){if(Pe.forEach(function(st){be.get(st).currentProgram.isReady()&&Pe.delete(st)}),Pe.size===0){Ie(ce);return}setTimeout(Je,10)}Se.get("KHR_parallel_shader_compile")!==null?Je():setTimeout(Je,10)})};let Nt=null;function dn(ce){Nt&&Nt(ce)}function Vn(){qn.stop()}function pn(){qn.start()}const qn=new jU;qn.setAnimationLoop(dn),typeof self<"u"&&qn.setContext(self),this.setAnimationLoop=function(ce){Nt=ce,yt.setAnimationLoop(ce),ce===null?qn.stop():qn.start()},yt.addEventListener("sessionstart",Vn),yt.addEventListener("sessionend",pn),this.render=function(ce,ye){if(ye!==void 0&&ye.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(w===!0)return;ce.matrixWorldAutoUpdate===!0&&ce.updateMatrixWorld(),ye.parent===null&&ye.matrixWorldAutoUpdate===!0&&ye.updateMatrixWorld(),yt.enabled===!0&&yt.isPresenting===!0&&(yt.cameraAutoUpdate===!0&&yt.updateCamera(ye),ye=yt.getCamera()),ce.isScene===!0&&ce.onBeforeRender(x,ce,ye,M),g=ct.get(ce,E.length),g.init(),E.push(g),ie.multiplyMatrices(ye.projectionMatrix,ye.matrixWorldInverse),te.setFromProjectionMatrix(ie),J=this.localClippingEnabled,q=pt.init(this.clippingPlanes,J),y=Ye.get(ce,A.length),y.init(),A.push(y),Ci(ce,ye,0,x.sortObjects),y.finish(),x.sortObjects===!0&&y.sort(K,V),this.info.render.frame++,q===!0&&pt.beginShadows();const Ee=g.state.shadowsArray;if(je.render(Ee,ce,ye),q===!0&&pt.endShadows(),this.info.autoReset===!0&&this.info.reset(),Mt.render(y,ce),g.setupLights(x._useLegacyLights),ye.isArrayCamera){const Pe=ye.cameras;for(let Ie=0,Je=Pe.length;Ie<Je;Ie++){const st=Pe[Ie];as(y,ce,st,st.viewport)}}else as(y,ce,ye);M!==null&&(ne.updateMultisampleRenderTarget(M),ne.updateRenderTargetMipmap(M)),ce.isScene===!0&&ce.onAfterRender(x,ce,ye),Ce.resetDefaultState(),L=-1,P=null,E.pop(),E.length>0?g=E[E.length-1]:g=null,A.pop(),A.length>0?y=A[A.length-1]:y=null};function Ci(ce,ye,Ee,Pe){if(ce.visible===!1)return;if(ce.layers.test(ye.layers)){if(ce.isGroup)Ee=ce.renderOrder;else if(ce.isLOD)ce.autoUpdate===!0&&ce.update(ye);else if(ce.isLight)g.pushLight(ce),ce.castShadow&&g.pushShadow(ce);else if(ce.isSprite){if(!ce.frustumCulled||te.intersectsSprite(ce)){Pe&&ge.setFromMatrixPosition(ce.matrixWorld).applyMatrix4(ie);const st=Fe.update(ce),lt=ce.material;lt.visible&&y.push(ce,st,lt,Ee,ge.z,null)}}else if((ce.isMesh||ce.isLine||ce.isPoints)&&(!ce.frustumCulled||te.intersectsObject(ce))){const st=Fe.update(ce),lt=ce.material;if(Pe&&(ce.boundingSphere!==void 0?(ce.boundingSphere===null&&ce.computeBoundingSphere(),ge.copy(ce.boundingSphere.center)):(st.boundingSphere===null&&st.computeBoundingSphere(),ge.copy(st.boundingSphere.center)),ge.applyMatrix4(ce.matrixWorld).applyMatrix4(ie)),Array.isArray(lt)){const Oe=st.groups;for(let Ht=0,xt=Oe.length;Ht<xt;Ht++){const Et=Oe[Ht],Qt=lt[Et.materialIndex];Qt&&Qt.visible&&y.push(ce,st,Qt,Ee,ge.z,Et)}}else lt.visible&&y.push(ce,st,lt,Ee,ge.z,null)}}const Je=ce.children;for(let st=0,lt=Je.length;st<lt;st++)Ci(Je[st],ye,Ee,Pe)}function as(ce,ye,Ee,Pe){const Ie=ce.opaque,Je=ce.transmissive,st=ce.transparent;g.setupLightsView(Ee),q===!0&&pt.setGlobalState(x.clippingPlanes,Ee),Je.length>0&&Nr(Ie,Je,ye,Ee),Pe&&Ae.viewport(R.copy(Pe)),Ie.length>0&&ur(Ie,ye,Ee),Je.length>0&&ur(Je,ye,Ee),st.length>0&&ur(st,ye,Ee),Ae.buffers.depth.setTest(!0),Ae.buffers.depth.setMask(!0),Ae.buffers.color.setMask(!0),Ae.setPolygonOffset(!1)}function Nr(ce,ye,Ee,Pe){if((Ee.isScene===!0?Ee.overrideMaterial:null)!==null)return;const Je=ve.isWebGL2;re===null&&(re=new Si(1,1,{generateMipmaps:!0,type:Se.has("EXT_color_buffer_half_float")?Ni:Zi,minFilter:Bl,samples:Je?4:0})),x.getDrawingBufferSize(se),Je?re.setSize(se.x,se.y):re.setSize(RS(se.x),RS(se.y));const st=x.getRenderTarget();x.setRenderTarget(re),x.getClearColor(H),G=x.getClearAlpha(),G<1&&x.setClearColor(16777215,.5),x.clear();const lt=x.toneMapping;x.toneMapping=yu,ur(ce,Ee,Pe),ne.updateMultisampleRenderTarget(re),ne.updateRenderTargetMipmap(re);let Oe=!1;for(let Ht=0,xt=ye.length;Ht<xt;Ht++){const Et=ye[Ht],Qt=Et.object,sn=Et.geometry,ln=Et.material,vn=Et.group;if(ln.side===Li&&Qt.layers.test(Pe.layers)){const Dt=ln.side;ln.side=ys,ln.needsUpdate=!0,tr(Qt,Ee,Pe,sn,ln,vn),ln.side=Dt,ln.needsUpdate=!0,Oe=!0}}Oe===!0&&(ne.updateMultisampleRenderTarget(re),ne.updateRenderTargetMipmap(re)),x.setRenderTarget(st),x.setClearColor(H,G),x.toneMapping=lt}function ur(ce,ye,Ee){const Pe=ye.isScene===!0?ye.overrideMaterial:null;for(let Ie=0,Je=ce.length;Ie<Je;Ie++){const st=ce[Ie],lt=st.object,Oe=st.geometry,Ht=Pe===null?st.material:Pe,xt=st.group;lt.layers.test(Ee.layers)&&tr(lt,ye,Ee,Oe,Ht,xt)}}function tr(ce,ye,Ee,Pe,Ie,Je){ce.onBeforeRender(x,ye,Ee,Pe,Ie,Je),ce.modelViewMatrix.multiplyMatrices(Ee.matrixWorldInverse,ce.matrixWorld),ce.normalMatrix.getNormalMatrix(ce.modelViewMatrix),Ie.onBeforeRender(x,ye,Ee,Pe,ce,Je),Ie.transparent===!0&&Ie.side===Li&&Ie.forceSinglePass===!1?(Ie.side=ys,Ie.needsUpdate=!0,x.renderBufferDirect(Ee,ye,Pe,Ie,ce,Je),Ie.side=tl,Ie.needsUpdate=!0,x.renderBufferDirect(Ee,ye,Pe,Ie,ce,Je),Ie.side=Li):x.renderBufferDirect(Ee,ye,Pe,Ie,ce,Je),ce.onAfterRender(x,ye,Ee,Pe,Ie,Je)}function An(ce,ye,Ee){ye.isScene!==!0&&(ye=xe);const Pe=be.get(ce),Ie=g.state.lights,Je=g.state.shadowsArray,st=Ie.state.version,lt=He.getParameters(ce,Ie.state,Je,ye,Ee),Oe=He.getProgramCacheKey(lt);let Ht=Pe.programs;Pe.environment=ce.isMeshStandardMaterial?ye.environment:null,Pe.fog=ye.fog,Pe.envMap=(ce.isMeshStandardMaterial?de:j).get(ce.envMap||Pe.environment),Ht===void 0&&(ce.addEventListener("dispose",vt),Ht=new Map,Pe.programs=Ht);let xt=Ht.get(Oe);if(xt!==void 0){if(Pe.currentProgram===xt&&Pe.lightsStateVersion===st)return Uo(ce,lt),xt}else lt.uniforms=He.getUniforms(ce),ce.onBuild(Ee,lt,x),ce.onBeforeCompile(lt,x),xt=He.acquireProgram(lt,Oe),Ht.set(Oe,xt),Pe.uniforms=lt.uniforms;const Et=Pe.uniforms;return(!ce.isShaderMaterial&&!ce.isRawShaderMaterial||ce.clipping===!0)&&(Et.clippingPlanes=pt.uniform),Uo(ce,lt),Pe.needsLights=De(ce),Pe.lightsStateVersion=st,Pe.needsLights&&(Et.ambientLightColor.value=Ie.state.ambient,Et.lightProbe.value=Ie.state.probe,Et.directionalLights.value=Ie.state.directional,Et.directionalLightShadows.value=Ie.state.directionalShadow,Et.spotLights.value=Ie.state.spot,Et.spotLightShadows.value=Ie.state.spotShadow,Et.rectAreaLights.value=Ie.state.rectArea,Et.ltc_1.value=Ie.state.rectAreaLTC1,Et.ltc_2.value=Ie.state.rectAreaLTC2,Et.pointLights.value=Ie.state.point,Et.pointLightShadows.value=Ie.state.pointShadow,Et.hemisphereLights.value=Ie.state.hemi,Et.directionalShadowMap.value=Ie.state.directionalShadowMap,Et.directionalShadowMatrix.value=Ie.state.directionalShadowMatrix,Et.spotShadowMap.value=Ie.state.spotShadowMap,Et.spotLightMatrix.value=Ie.state.spotLightMatrix,Et.spotLightMap.value=Ie.state.spotLightMap,Et.pointShadowMap.value=Ie.state.pointShadowMap,Et.pointShadowMatrix.value=Ie.state.pointShadowMatrix),Pe.currentProgram=xt,Pe.uniformsList=null,xt}function vr(ce){if(ce.uniformsList===null){const ye=ce.currentProgram.getUniforms();ce.uniformsList=Y_.seqWithValue(ye.seq,ce.uniforms)}return ce.uniformsList}function Uo(ce,ye){const Ee=be.get(ce);Ee.outputColorSpace=ye.outputColorSpace,Ee.batching=ye.batching,Ee.instancing=ye.instancing,Ee.instancingColor=ye.instancingColor,Ee.skinning=ye.skinning,Ee.morphTargets=ye.morphTargets,Ee.morphNormals=ye.morphNormals,Ee.morphColors=ye.morphColors,Ee.morphTargetsCount=ye.morphTargetsCount,Ee.numClippingPlanes=ye.numClippingPlanes,Ee.numIntersection=ye.numClipIntersection,Ee.vertexAlphas=ye.vertexAlphas,Ee.vertexTangents=ye.vertexTangents,Ee.toneMapping=ye.toneMapping}function he(ce,ye,Ee,Pe,Ie){ye.isScene!==!0&&(ye=xe),ne.resetTextureUnits();const Je=ye.fog,st=Pe.isMeshStandardMaterial?ye.environment:null,lt=M===null?x.outputColorSpace:M.isXRRenderTarget===!0?M.texture.colorSpace:Dl,Oe=(Pe.isMeshStandardMaterial?de:j).get(Pe.envMap||st),Ht=Pe.vertexColors===!0&&!!Ee.attributes.color&&Ee.attributes.color.itemSize===4,xt=!!Ee.attributes.tangent&&(!!Pe.normalMap||Pe.anisotropy>0),Et=!!Ee.morphAttributes.position,Qt=!!Ee.morphAttributes.normal,sn=!!Ee.morphAttributes.color;let ln=yu;Pe.toneMapped&&(M===null||M.isXRRenderTarget===!0)&&(ln=x.toneMapping);const vn=Ee.morphAttributes.position||Ee.morphAttributes.normal||Ee.morphAttributes.color,Dt=vn!==void 0?vn.length:0,Bt=be.get(Pe),yn=g.state.lights;if(q===!0&&(J===!0||ce!==P)){const Bn=ce===P&&Pe.id===L;pt.setState(Pe,ce,Bn)}let xn=!1;Pe.version===Bt.__version?(Bt.needsLights&&Bt.lightsStateVersion!==yn.state.version||Bt.outputColorSpace!==lt||Ie.isBatchedMesh&&Bt.batching===!1||!Ie.isBatchedMesh&&Bt.batching===!0||Ie.isInstancedMesh&&Bt.instancing===!1||!Ie.isInstancedMesh&&Bt.instancing===!0||Ie.isSkinnedMesh&&Bt.skinning===!1||!Ie.isSkinnedMesh&&Bt.skinning===!0||Ie.isInstancedMesh&&Bt.instancingColor===!0&&Ie.instanceColor===null||Ie.isInstancedMesh&&Bt.instancingColor===!1&&Ie.instanceColor!==null||Bt.envMap!==Oe||Pe.fog===!0&&Bt.fog!==Je||Bt.numClippingPlanes!==void 0&&(Bt.numClippingPlanes!==pt.numPlanes||Bt.numIntersection!==pt.numIntersection)||Bt.vertexAlphas!==Ht||Bt.vertexTangents!==xt||Bt.morphTargets!==Et||Bt.morphNormals!==Qt||Bt.morphColors!==sn||Bt.toneMapping!==ln||ve.isWebGL2===!0&&Bt.morphTargetsCount!==Dt)&&(xn=!0):(xn=!0,Bt.__version=Pe.version);let Sn=Bt.currentProgram;xn===!0&&(Sn=An(Pe,ye,Ie));let Ai=!1,xi=!1,Ei=!1;const Dn=Sn.getUniforms(),kn=Bt.uniforms;if(Ae.useProgram(Sn.program)&&(Ai=!0,xi=!0,Ei=!0),Pe.id!==L&&(L=Pe.id,xi=!0),Ai||P!==ce){Dn.setValue(ue,"projectionMatrix",ce.projectionMatrix),Dn.setValue(ue,"viewMatrix",ce.matrixWorldInverse);const Bn=Dn.map.cameraPosition;Bn!==void 0&&Bn.setValue(ue,ge.setFromMatrixPosition(ce.matrixWorld)),ve.logarithmicDepthBuffer&&Dn.setValue(ue,"logDepthBufFC",2/(Math.log(ce.far+1)/Math.LN2)),(Pe.isMeshPhongMaterial||Pe.isMeshToonMaterial||Pe.isMeshLambertMaterial||Pe.isMeshBasicMaterial||Pe.isMeshStandardMaterial||Pe.isShaderMaterial)&&Dn.setValue(ue,"isOrthographic",ce.isOrthographicCamera===!0),P!==ce&&(P=ce,xi=!0,Ei=!0)}if(Ie.isSkinnedMesh){Dn.setOptional(ue,Ie,"bindMatrix"),Dn.setOptional(ue,Ie,"bindMatrixInverse");const Bn=Ie.skeleton;Bn&&(ve.floatVertexTextures?(Bn.boneTexture===null&&Bn.computeBoneTexture(),Dn.setValue(ue,"boneTexture",Bn.boneTexture,ne)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}Ie.isBatchedMesh&&(Dn.setOptional(ue,Ie,"batchingTexture"),Dn.setValue(ue,"batchingTexture",Ie._matricesTexture,ne));const zi=Ee.morphAttributes;if((zi.position!==void 0||zi.normal!==void 0||zi.color!==void 0&&ve.isWebGL2===!0)&&Ft.update(Ie,Ee,Sn),(xi||Bt.receiveShadow!==Ie.receiveShadow)&&(Bt.receiveShadow=Ie.receiveShadow,Dn.setValue(ue,"receiveShadow",Ie.receiveShadow)),Pe.isMeshGouraudMaterial&&Pe.envMap!==null&&(kn.envMap.value=Oe,kn.flipEnvMap.value=Oe.isCubeTexture&&Oe.isRenderTargetTexture===!1?-1:1),xi&&(Dn.setValue(ue,"toneMappingExposure",x.toneMappingExposure),Bt.needsLights&&me(kn,Ei),Je&&Pe.fog===!0&&it.refreshFogUniforms(kn,Je),it.refreshMaterialUniforms(kn,Pe,oe,Z,re),Y_.upload(ue,vr(Bt),kn,ne)),Pe.isShaderMaterial&&Pe.uniformsNeedUpdate===!0&&(Y_.upload(ue,vr(Bt),kn,ne),Pe.uniformsNeedUpdate=!1),Pe.isSpriteMaterial&&Dn.setValue(ue,"center",Ie.center),Dn.setValue(ue,"modelViewMatrix",Ie.modelViewMatrix),Dn.setValue(ue,"normalMatrix",Ie.normalMatrix),Dn.setValue(ue,"modelMatrix",Ie.matrixWorld),Pe.isShaderMaterial||Pe.isRawShaderMaterial){const Bn=Pe.uniformsGroups;for(let Pn=0,Ri=Bn.length;Pn<Ri;Pn++)if(ve.isWebGL2){const ls=Bn[Pn];qe.update(ls,Sn),qe.bind(ls,Sn)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return Sn}function me(ce,ye){ce.ambientLightColor.needsUpdate=ye,ce.lightProbe.needsUpdate=ye,ce.directionalLights.needsUpdate=ye,ce.directionalLightShadows.needsUpdate=ye,ce.pointLights.needsUpdate=ye,ce.pointLightShadows.needsUpdate=ye,ce.spotLights.needsUpdate=ye,ce.spotLightShadows.needsUpdate=ye,ce.rectAreaLights.needsUpdate=ye,ce.hemisphereLights.needsUpdate=ye}function De(ce){return ce.isMeshLambertMaterial||ce.isMeshToonMaterial||ce.isMeshPhongMaterial||ce.isMeshStandardMaterial||ce.isShadowMaterial||ce.isShaderMaterial&&ce.lights===!0}this.getActiveCubeFace=function(){return T},this.getActiveMipmapLevel=function(){return I},this.getRenderTarget=function(){return M},this.setRenderTargetTextures=function(ce,ye,Ee){be.get(ce.texture).__webglTexture=ye,be.get(ce.depthTexture).__webglTexture=Ee;const Pe=be.get(ce);Pe.__hasExternalTextures=!0,Pe.__hasExternalTextures&&(Pe.__autoAllocateDepthBuffer=Ee===void 0,Pe.__autoAllocateDepthBuffer||Se.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),Pe.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(ce,ye){const Ee=be.get(ce);Ee.__webglFramebuffer=ye,Ee.__useDefaultFramebuffer=ye===void 0},this.setRenderTarget=function(ce,ye=0,Ee=0){M=ce,T=ye,I=Ee;let Pe=!0,Ie=null,Je=!1,st=!1;if(ce){const Oe=be.get(ce);Oe.__useDefaultFramebuffer!==void 0?(Ae.bindFramebuffer(ue.FRAMEBUFFER,null),Pe=!1):Oe.__webglFramebuffer===void 0?ne.setupRenderTarget(ce):Oe.__hasExternalTextures&&ne.rebindTextures(ce,be.get(ce.texture).__webglTexture,be.get(ce.depthTexture).__webglTexture);const Ht=ce.texture;(Ht.isData3DTexture||Ht.isDataArrayTexture||Ht.isCompressedArrayTexture)&&(st=!0);const xt=be.get(ce).__webglFramebuffer;ce.isWebGLCubeRenderTarget?(Array.isArray(xt[ye])?Ie=xt[ye][Ee]:Ie=xt[ye],Je=!0):ve.isWebGL2&&ce.samples>0&&ne.useMultisampledRTT(ce)===!1?Ie=be.get(ce).__webglMultisampledFramebuffer:Array.isArray(xt)?Ie=xt[Ee]:Ie=xt,R.copy(ce.viewport),U.copy(ce.scissor),k=ce.scissorTest}else R.copy(W).multiplyScalar(oe).floor(),U.copy(F).multiplyScalar(oe).floor(),k=Y;if(Ae.bindFramebuffer(ue.FRAMEBUFFER,Ie)&&ve.drawBuffers&&Pe&&Ae.drawBuffers(ce,Ie),Ae.viewport(R),Ae.scissor(U),Ae.setScissorTest(k),Je){const Oe=be.get(ce.texture);ue.framebufferTexture2D(ue.FRAMEBUFFER,ue.COLOR_ATTACHMENT0,ue.TEXTURE_CUBE_MAP_POSITIVE_X+ye,Oe.__webglTexture,Ee)}else if(st){const Oe=be.get(ce.texture),Ht=ye||0;ue.framebufferTextureLayer(ue.FRAMEBUFFER,ue.COLOR_ATTACHMENT0,Oe.__webglTexture,Ee||0,Ht)}L=-1},this.readRenderTargetPixels=function(ce,ye,Ee,Pe,Ie,Je,st){if(!(ce&&ce.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let lt=be.get(ce).__webglFramebuffer;if(ce.isWebGLCubeRenderTarget&&st!==void 0&&(lt=lt[st]),lt){Ae.bindFramebuffer(ue.FRAMEBUFFER,lt);try{const Oe=ce.texture,Ht=Oe.format,xt=Oe.type;if(Ht!==gi&&ft.convert(Ht)!==ue.getParameter(ue.IMPLEMENTATION_COLOR_READ_FORMAT)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}const Et=xt===Ni&&(Se.has("EXT_color_buffer_half_float")||ve.isWebGL2&&Se.has("EXT_color_buffer_float"));if(xt!==Zi&&ft.convert(xt)!==ue.getParameter(ue.IMPLEMENTATION_COLOR_READ_TYPE)&&!(xt===fi&&(ve.isWebGL2||Se.has("OES_texture_float")||Se.has("WEBGL_color_buffer_float")))&&!Et){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}ye>=0&&ye<=ce.width-Pe&&Ee>=0&&Ee<=ce.height-Ie&&ue.readPixels(ye,Ee,Pe,Ie,ft.convert(Ht),ft.convert(xt),Je)}finally{const Oe=M!==null?be.get(M).__webglFramebuffer:null;Ae.bindFramebuffer(ue.FRAMEBUFFER,Oe)}}},this.copyFramebufferToTexture=function(ce,ye,Ee=0){const Pe=Math.pow(2,-Ee),Ie=Math.floor(ye.image.width*Pe),Je=Math.floor(ye.image.height*Pe);ne.setTexture2D(ye,0),ue.copyTexSubImage2D(ue.TEXTURE_2D,Ee,0,0,ce.x,ce.y,Ie,Je),Ae.unbindTexture()},this.copyTextureToTexture=function(ce,ye,Ee,Pe=0){const Ie=ye.image.width,Je=ye.image.height,st=ft.convert(Ee.format),lt=ft.convert(Ee.type);ne.setTexture2D(Ee,0),ue.pixelStorei(ue.UNPACK_FLIP_Y_WEBGL,Ee.flipY),ue.pixelStorei(ue.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Ee.premultiplyAlpha),ue.pixelStorei(ue.UNPACK_ALIGNMENT,Ee.unpackAlignment),ye.isDataTexture?ue.texSubImage2D(ue.TEXTURE_2D,Pe,ce.x,ce.y,Ie,Je,st,lt,ye.image.data):ye.isCompressedTexture?ue.compressedTexSubImage2D(ue.TEXTURE_2D,Pe,ce.x,ce.y,ye.mipmaps[0].width,ye.mipmaps[0].height,st,ye.mipmaps[0].data):ue.texSubImage2D(ue.TEXTURE_2D,Pe,ce.x,ce.y,st,lt,ye.image),Pe===0&&Ee.generateMipmaps&&ue.generateMipmap(ue.TEXTURE_2D),Ae.unbindTexture()},this.copyTextureToTexture3D=function(ce,ye,Ee,Pe,Ie=0){if(x.isWebGL1Renderer){console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");return}const Je=ce.max.x-ce.min.x+1,st=ce.max.y-ce.min.y+1,lt=ce.max.z-ce.min.z+1,Oe=ft.convert(Pe.format),Ht=ft.convert(Pe.type);let xt;if(Pe.isData3DTexture)ne.setTexture3D(Pe,0),xt=ue.TEXTURE_3D;else if(Pe.isDataArrayTexture||Pe.isCompressedArrayTexture)ne.setTexture2DArray(Pe,0),xt=ue.TEXTURE_2D_ARRAY;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}ue.pixelStorei(ue.UNPACK_FLIP_Y_WEBGL,Pe.flipY),ue.pixelStorei(ue.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Pe.premultiplyAlpha),ue.pixelStorei(ue.UNPACK_ALIGNMENT,Pe.unpackAlignment);const Et=ue.getParameter(ue.UNPACK_ROW_LENGTH),Qt=ue.getParameter(ue.UNPACK_IMAGE_HEIGHT),sn=ue.getParameter(ue.UNPACK_SKIP_PIXELS),ln=ue.getParameter(ue.UNPACK_SKIP_ROWS),vn=ue.getParameter(ue.UNPACK_SKIP_IMAGES),Dt=Ee.isCompressedTexture?Ee.mipmaps[Ie]:Ee.image;ue.pixelStorei(ue.UNPACK_ROW_LENGTH,Dt.width),ue.pixelStorei(ue.UNPACK_IMAGE_HEIGHT,Dt.height),ue.pixelStorei(ue.UNPACK_SKIP_PIXELS,ce.min.x),ue.pixelStorei(ue.UNPACK_SKIP_ROWS,ce.min.y),ue.pixelStorei(ue.UNPACK_SKIP_IMAGES,ce.min.z),Ee.isDataTexture||Ee.isData3DTexture?ue.texSubImage3D(xt,Ie,ye.x,ye.y,ye.z,Je,st,lt,Oe,Ht,Dt.data):Ee.isCompressedArrayTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),ue.compressedTexSubImage3D(xt,Ie,ye.x,ye.y,ye.z,Je,st,lt,Oe,Dt.data)):ue.texSubImage3D(xt,Ie,ye.x,ye.y,ye.z,Je,st,lt,Oe,Ht,Dt),ue.pixelStorei(ue.UNPACK_ROW_LENGTH,Et),ue.pixelStorei(ue.UNPACK_IMAGE_HEIGHT,Qt),ue.pixelStorei(ue.UNPACK_SKIP_PIXELS,sn),ue.pixelStorei(ue.UNPACK_SKIP_ROWS,ln),ue.pixelStorei(ue.UNPACK_SKIP_IMAGES,vn),Ie===0&&Pe.generateMipmaps&&ue.generateMipmap(xt),Ae.unbindTexture()},this.initTexture=function(ce){ce.isCubeTexture?ne.setTextureCube(ce,0):ce.isData3DTexture?ne.setTexture3D(ce,0):ce.isDataArrayTexture||ce.isCompressedArrayTexture?ne.setTexture2DArray(ce,0):ne.setTexture2D(ce,0),Ae.unbindTexture()},this.resetState=function(){T=0,I=0,M=null,Ae.reset(),Ce.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return mu}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const t=this.getContext();t.drawingBufferColorSpace=e===Cw?"display-p3":"srgb",t.unpackColorSpace=Vi.workingColorSpace===sx?"display-p3":"srgb"}get outputEncoding(){return console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace===gs?$d:w6}set outputEncoding(e){console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace=e===$d?gs:Dl}get useLegacyLights(){return console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights}set useLegacyLights(e){console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights=e}}class ZU extends Pw{}ZU.prototype.isWebGL1Renderer=!0;class Lw{constructor(e,t=25e-5){this.isFogExp2=!0,this.name="",this.color=new ut(e),this.density=t}clone(){return new Lw(this.color,this.density)}toJSON(){return{type:"FogExp2",name:this.name,color:this.color.getHex(),density:this.density}}}class Bw{constructor(e,t=1,n=1e3){this.isFog=!0,this.name="",this.color=new ut(e),this.near=t,this.far=n}clone(){return new Bw(this.color,this.near,this.far)}toJSON(){return{type:"Fog",name:this.name,color:this.color.getHex(),near:this.near,far:this.far}}}class Mu extends _n{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(t.object.backgroundIntensity=this.backgroundIntensity),t}}class lx{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=e!==void 0?e.length/t:0,this.usage=R2,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.version=0,this.uuid=Pl()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}get updateRange(){return console.warn("THREE.InterleavedBuffer: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,n){e*=this.stride,n*=t.stride;for(let r=0,s=this.stride;r<s;r++)this.array[e+r]=t.array[n+r];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Pl()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(t,this.stride);return n.setUsage(this.usage),n}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Pl()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const pa=new Q;class Ja{constructor(e,t,n,r=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=n,this.normalized=r}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,n=this.data.count;t<n;t++)pa.fromBufferAttribute(this,t),pa.applyMatrix4(e),this.setXYZ(t,pa.x,pa.y,pa.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)pa.fromBufferAttribute(this,t),pa.applyNormalMatrix(e),this.setXYZ(t,pa.x,pa.y,pa.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)pa.fromBufferAttribute(this,t),pa.transformDirection(e),this.setXYZ(t,pa.x,pa.y,pa.z);return this}setX(e,t){return this.normalized&&(t=ii(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=ii(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=ii(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=ii(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=qa(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=qa(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=qa(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=qa(t,this.array)),t}setXY(e,t,n){return e=e*this.data.stride+this.offset,this.normalized&&(t=ii(t,this.array),n=ii(n,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this}setXYZ(e,t,n,r){return e=e*this.data.stride+this.offset,this.normalized&&(t=ii(t,this.array),n=ii(n,this.array),r=ii(r,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=r,this}setXYZW(e,t,n,r,s){return e=e*this.data.stride+this.offset,this.normalized&&(t=ii(t,this.array),n=ii(n,this.array),r=ii(r,this.array),s=ii(s,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=r,this.data.array[e+3]=s,this}clone(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let n=0;n<this.count;n++){const r=n*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)t.push(this.data.array[r+s])}return new mn(new this.array.constructor(t),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new Ja(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let n=0;n<this.count;n++){const r=n*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)t.push(this.data.array[r+s])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class P6 extends Us{constructor(e){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new ut(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}let Tg;const Oy=new Q,bg=new Q,Ig=new Q,Mg=new Ue,Ny=new Ue,ez=new Xe,J3=new Q,Uy=new Q,Z3=new Q,jL=new Ue,hT=new Ue,WL=new Ue;class tz extends _n{constructor(e=new P6){if(super(),this.isSprite=!0,this.type="Sprite",Tg===void 0){Tg=new fn;const t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),n=new lx(t,5);Tg.setIndex([0,1,2,0,2,3]),Tg.setAttribute("position",new Ja(n,3,0,!1)),Tg.setAttribute("uv",new Ja(n,2,3,!1))}this.geometry=Tg,this.material=e,this.center=new Ue(.5,.5)}raycast(e,t){e.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),bg.setFromMatrixScale(this.matrixWorld),ez.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),Ig.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&bg.multiplyScalar(-Ig.z);const n=this.material.rotation;let r,s;n!==0&&(s=Math.cos(n),r=Math.sin(n));const o=this.center;eE(J3.set(-.5,-.5,0),Ig,o,bg,r,s),eE(Uy.set(.5,-.5,0),Ig,o,bg,r,s),eE(Z3.set(.5,.5,0),Ig,o,bg,r,s),jL.set(0,0),hT.set(1,0),WL.set(1,1);let a=e.ray.intersectTriangle(J3,Uy,Z3,!1,Oy);if(a===null&&(eE(Uy.set(-.5,.5,0),Ig,o,bg,r,s),hT.set(0,1),a=e.ray.intersectTriangle(J3,Z3,Uy,!1,Oy),a===null))return;const l=e.ray.origin.distanceTo(Oy);l<e.near||l>e.far||t.push({distance:l,point:Oy.clone(),uv:ks.getInterpolation(Oy,J3,Uy,Z3,jL,hT,WL,new Ue),face:null,object:this})}copy(e,t){return super.copy(e,t),e.center!==void 0&&this.center.copy(e.center),this.material=e.material,this}}function eE(i,e,t,n,r,s){Mg.subVectors(i,t).addScalar(.5).multiply(n),r!==void 0?(Ny.x=s*Mg.x-r*Mg.y,Ny.y=r*Mg.x+s*Mg.y):Ny.copy(Mg),i.copy(e),i.x+=Ny.x,i.y+=Ny.y,i.applyMatrix4(ez)}const tE=new Q,KL=new Q;class nz extends _n{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(e){super.copy(e,!1);const t=e.levels;for(let n=0,r=t.length;n<r;n++){const s=t[n];this.addLevel(s.object.clone(),s.distance,s.hysteresis)}return this.autoUpdate=e.autoUpdate,this}addLevel(e,t=0,n=0){t=Math.abs(t);const r=this.levels;let s;for(s=0;s<r.length&&!(t<r[s].distance);s++);return r.splice(s,0,{distance:t,hysteresis:n,object:e}),this.add(e),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(e){const t=this.levels;if(t.length>0){let n,r;for(n=1,r=t.length;n<r;n++){let s=t[n].distance;if(t[n].object.visible&&(s-=s*t[n].hysteresis),e<s)break}return t[n-1].object}return null}raycast(e,t){if(this.levels.length>0){tE.setFromMatrixPosition(this.matrixWorld);const r=e.ray.origin.distanceTo(tE);this.getObjectForDistance(r).raycast(e,t)}}update(e){const t=this.levels;if(t.length>1){tE.setFromMatrixPosition(e.matrixWorld),KL.setFromMatrixPosition(this.matrixWorld);const n=tE.distanceTo(KL)/e.zoom;t[0].object.visible=!0;let r,s;for(r=1,s=t.length;r<s;r++){let o=t[r].distance;if(t[r].object.visible&&(o-=o*t[r].hysteresis),n>=o)t[r-1].object.visible=!1,t[r].object.visible=!0;else break}for(this._currentLevel=r-1;r<s;r++)t[r].object.visible=!1}}toJSON(e){const t=super.toJSON(e);this.autoUpdate===!1&&(t.object.autoUpdate=!1),t.object.levels=[];const n=this.levels;for(let r=0,s=n.length;r<s;r++){const o=n[r];t.object.levels.push({object:o.object.uuid,distance:o.distance,hysteresis:o.hysteresis})}return t}}const YL=new Q,$L=new Rn,XL=new Rn,Gte=new Q,qL=new Xe,nE=new Q,fT=new Bi,JL=new Xe,dT=new vc;class cx extends It{constructor(e,t){super(e,t),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=aM,this.bindMatrix=new Xe,this.bindMatrixInverse=new Xe,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const e=this.geometry;this.boundingBox===null&&(this.boundingBox=new ti),this.boundingBox.makeEmpty();const t=e.getAttribute("position");for(let n=0;n<t.count;n++)this.getVertexPosition(n,nE),this.boundingBox.expandByPoint(nE)}computeBoundingSphere(){const e=this.geometry;this.boundingSphere===null&&(this.boundingSphere=new Bi),this.boundingSphere.makeEmpty();const t=e.getAttribute("position");for(let n=0;n<t.count;n++)this.getVertexPosition(n,nE),this.boundingSphere.expandByPoint(nE)}copy(e,t){return super.copy(e,t),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}raycast(e,t){const n=this.material,r=this.matrixWorld;n!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),fT.copy(this.boundingSphere),fT.applyMatrix4(r),e.ray.intersectsSphere(fT)!==!1&&(JL.copy(r).invert(),dT.copy(e.ray).applyMatrix4(JL),!(this.boundingBox!==null&&dT.intersectsBox(this.boundingBox)===!1)&&this._computeIntersections(e,t,dT)))}getVertexPosition(e,t){return super.getVertexPosition(e,t),this.applyBoneTransform(e,t),t}bind(e,t){this.skeleton=e,t===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new Rn,t=this.geometry.attributes.skinWeight;for(let n=0,r=t.count;n<r;n++){e.fromBufferAttribute(t,n);const s=1/e.manhattanLength();s!==1/0?e.multiplyScalar(s):e.set(1,0,0,0),t.setXYZW(n,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode===aM?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode===xU?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(e,t){const n=this.skeleton,r=this.geometry;$L.fromBufferAttribute(r.attributes.skinIndex,e),XL.fromBufferAttribute(r.attributes.skinWeight,e),YL.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let s=0;s<4;s++){const o=XL.getComponent(s);if(o!==0){const a=$L.getComponent(s);qL.multiplyMatrices(n.bones[a].matrixWorld,n.boneInverses[a]),t.addScaledVector(Gte.copy(YL).applyMatrix4(qL),o)}}return t.applyMatrix4(this.bindMatrixInverse)}boneTransform(e,t){return console.warn("THREE.SkinnedMesh: .boneTransform() was renamed to .applyBoneTransform() in r151."),this.applyBoneTransform(e,t)}}class sA extends _n{constructor(){super(),this.isBone=!0,this.type="Bone"}}class Sa extends vi{constructor(e=null,t=1,n=1,r,s,o,a,l,c=zn,u=zn,h,f){super(null,o,a,l,c,u,r,s,h,f),this.isDataTexture=!0,this.image={data:e,width:t,height:n},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const ZL=new Xe,Hte=new Xe;class TA{constructor(e=[],t=[]){this.uuid=Pl(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.init()}init(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(e.length*16),t.length===0)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let n=0,r=this.bones.length;n<r;n++)this.boneInverses.push(new Xe)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const n=new Xe;this.bones[e]&&n.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(n)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){const n=this.bones[e];n&&n.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const n=this.bones[e];n&&(n.parent&&n.parent.isBone?(n.matrix.copy(n.parent.matrixWorld).invert(),n.matrix.multiply(n.matrixWorld)):n.matrix.copy(n.matrixWorld),n.matrix.decompose(n.position,n.quaternion,n.scale))}}update(){const e=this.bones,t=this.boneInverses,n=this.boneMatrices,r=this.boneTexture;for(let s=0,o=e.length;s<o;s++){const a=e[s]?e[s].matrixWorld:Hte;ZL.multiplyMatrices(a,t[s]),ZL.toArray(n,s*16)}r!==null&&(r.needsUpdate=!0)}clone(){return new TA(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(this.bones.length*4);e=Math.ceil(e/4)*4,e=Math.max(e,4);const t=new Float32Array(e*e*4);t.set(this.boneMatrices);const n=new Sa(t,e,e,gi,fi);return n.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=n,this}getBoneByName(e){for(let t=0,n=this.bones.length;t<n;t++){const r=this.bones[t];if(r.name===e)return r}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let n=0,r=e.bones.length;n<r;n++){const s=e.bones[n];let o=t[s];o===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",s),o=new sA),this.bones.push(o),this.boneInverses.push(new Xe().fromArray(e.boneInverses[n]))}return this.init(),this}toJSON(){const e={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,n=this.boneInverses;for(let r=0,s=t.length;r<s;r++){const o=t[r];e.bones.push(o.uuid);const a=n[r];e.boneInverses.push(a.toArray())}return e}}class Su extends mn{constructor(e,t,n,r=1){super(e,t,n),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=r}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const Rg=new Xe,eB=new Xe,iE=[],tB=new ti,Qte=new Xe,zy=new It,Gy=new Bi;class ux extends It{constructor(e,t,n){super(e,t),this.isInstancedMesh=!0,this.instanceMatrix=new Su(new Float32Array(n*16),16),this.instanceColor=null,this.count=n,this.boundingBox=null,this.boundingSphere=null;for(let r=0;r<n;r++)this.setMatrixAt(r,Qte)}computeBoundingBox(){const e=this.geometry,t=this.count;this.boundingBox===null&&(this.boundingBox=new ti),e.boundingBox===null&&e.computeBoundingBox(),this.boundingBox.makeEmpty();for(let n=0;n<t;n++)this.getMatrixAt(n,Rg),tB.copy(e.boundingBox).applyMatrix4(Rg),this.boundingBox.union(tB)}computeBoundingSphere(){const e=this.geometry,t=this.count;this.boundingSphere===null&&(this.boundingSphere=new Bi),e.boundingSphere===null&&e.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let n=0;n<t;n++)this.getMatrixAt(n,Rg),Gy.copy(e.boundingSphere).applyMatrix4(Rg),this.boundingSphere.union(Gy)}copy(e,t){return super.copy(e,t),this.instanceMatrix.copy(e.instanceMatrix),e.instanceColor!==null&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}getColorAt(e,t){t.fromArray(this.instanceColor.array,e*3)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,e*16)}raycast(e,t){const n=this.matrixWorld,r=this.count;if(zy.geometry=this.geometry,zy.material=this.material,zy.material!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),Gy.copy(this.boundingSphere),Gy.applyMatrix4(n),e.ray.intersectsSphere(Gy)!==!1))for(let s=0;s<r;s++){this.getMatrixAt(s,Rg),eB.multiplyMatrices(n,Rg),zy.matrixWorld=eB,zy.raycast(e,iE);for(let o=0,a=iE.length;o<a;o++){const l=iE[o];l.instanceId=s,l.object=this,t.push(l)}iE.length=0}}setColorAt(e,t){this.instanceColor===null&&(this.instanceColor=new Su(new Float32Array(this.instanceMatrix.count*3),3)),t.toArray(this.instanceColor.array,e*3)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,e*16)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}function Vte(i,e){return i.z-e.z}function jte(i,e){return e.z-i.z}class Wte{constructor(){this.index=0,this.pool=[],this.list=[]}push(e,t){const n=this.pool,r=this.list;this.index>=n.length&&n.push({start:-1,count:-1,z:-1});const s=n[this.index];r.push(s),this.index++,s.start=e.start,s.count=e.count,s.z=t}reset(){this.list.length=0,this.index=0}}const Pg="batchId",wd=new Xe,nB=new Xe,Kte=new Xe,iB=new Xe,pT=new f0,rE=new ti,om=new Bi,Hy=new Q,mT=new Wte,$o=new It,sE=[];function Yte(i,e,t=0){const n=e.itemSize;if(i.isInterleavedBufferAttribute||i.array.constructor!==e.array.constructor){const r=i.count;for(let s=0;s<r;s++)for(let o=0;o<n;o++)e.setComponent(s+t,o,i.getComponent(s,o))}else e.array.set(i.array,t*n);e.needsUpdate=!0}let L6=class extends It{get maxGeometryCount(){return this._maxGeometryCount}constructor(e,t,n=t*2,r){super(new fn,r),this.isBatchedMesh=!0,this.perObjectFrustumCulled=!0,this.sortObjects=!0,this.boundingBox=null,this.boundingSphere=null,this.customSort=null,this._drawRanges=[],this._reservedRanges=[],this._visibility=[],this._active=[],this._bounds=[],this._maxGeometryCount=e,this._maxVertexCount=t,this._maxIndexCount=n,this._geometryInitialized=!1,this._geometryCount=0,this._multiDrawCounts=new Int32Array(e),this._multiDrawStarts=new Int32Array(e),this._multiDrawCount=0,this._visibilityChanged=!0,this._matricesTexture=null,this._initMatricesTexture()}_initMatricesTexture(){let e=Math.sqrt(this._maxGeometryCount*4);e=Math.ceil(e/4)*4,e=Math.max(e,4);const t=new Float32Array(e*e*4),n=new Sa(t,e,e,gi,fi);this._matricesTexture=n}_initializeGeometry(e){const t=this.geometry,n=this._maxVertexCount,r=this._maxGeometryCount,s=this._maxIndexCount;if(this._geometryInitialized===!1){for(const a in e.attributes){const l=e.getAttribute(a),{array:c,itemSize:u,normalized:h}=l,f=new c.constructor(n*u),d=new l.constructor(f,u,h);d.setUsage(l.usage),t.setAttribute(a,d)}if(e.getIndex()!==null){const a=n>65536?new Uint32Array(s):new Uint16Array(s);t.setIndex(new mn(a,1))}const o=r>65536?new Uint32Array(n):new Uint16Array(n);t.setAttribute(Pg,new mn(o,1)),this._geometryInitialized=!0}}_validateGeometry(e){if(e.getAttribute(Pg))throw new Error(`BatchedMesh: Geometry cannot use attribute "${Pg}"`);const t=this.geometry;if(!!e.getIndex()!=!!t.getIndex())throw new Error('BatchedMesh: All geometries must consistently have "index".');for(const n in t.attributes){if(n===Pg)continue;if(!e.hasAttribute(n))throw new Error(`BatchedMesh: Added geometry missing "${n}". All geometries must have consistent attributes.`);const r=e.getAttribute(n),s=t.getAttribute(n);if(r.itemSize!==s.itemSize||r.normalized!==s.normalized)throw new Error("BatchedMesh: All attributes must have a consistent itemSize and normalized value.")}}setCustomSort(e){return this.customSort=e,this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new ti);const e=this._geometryCount,t=this.boundingBox,n=this._active;t.makeEmpty();for(let r=0;r<e;r++)n[r]!==!1&&(this.getMatrixAt(r,wd),this.getBoundingBoxAt(r,rE).applyMatrix4(wd),t.union(rE))}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Bi);const e=this._geometryCount,t=this.boundingSphere,n=this._active;t.makeEmpty();for(let r=0;r<e;r++)n[r]!==!1&&(this.getMatrixAt(r,wd),this.getBoundingSphereAt(r,om).applyMatrix4(wd),t.union(om))}addGeometry(e,t=-1,n=-1){if(this._initializeGeometry(e),this._validateGeometry(e),this._geometryCount>=this._maxGeometryCount)throw new Error("BatchedMesh: Maximum geometry count reached.");const r={vertexStart:-1,vertexCount:-1,indexStart:-1,indexCount:-1};let s=null;const o=this._reservedRanges,a=this._drawRanges,l=this._bounds;this._geometryCount!==0&&(s=o[o.length-1]),t===-1?r.vertexCount=e.getAttribute("position").count:r.vertexCount=t,s===null?r.vertexStart=0:r.vertexStart=s.vertexStart+s.vertexCount;const c=e.getIndex(),u=c!==null;if(u&&(n===-1?r.indexCount=c.count:r.indexCount=n,s===null?r.indexStart=0:r.indexStart=s.indexStart+s.indexCount),r.indexStart!==-1&&r.indexStart+r.indexCount>this._maxIndexCount||r.vertexStart+r.vertexCount>this._maxVertexCount)throw new Error("BatchedMesh: Reserved space request exceeds the maximum buffer size.");const h=this._visibility,f=this._active,d=this._matricesTexture,m=this._matricesTexture.image.data;h.push(!0),f.push(!0);const y=this._geometryCount;this._geometryCount++,Kte.toArray(m,y*16),d.needsUpdate=!0,o.push(r),a.push({start:u?r.indexStart:r.vertexStart,count:-1}),l.push({boxInitialized:!1,box:new ti,sphereInitialized:!1,sphere:new Bi});const g=this.geometry.getAttribute(Pg);for(let A=0;A<r.vertexCount;A++)g.setX(r.vertexStart+A,y);return g.needsUpdate=!0,this.setGeometryAt(y,e),y}setGeometryAt(e,t){if(e>=this._geometryCount)throw new Error("BatchedMesh: Maximum geometry count reached.");this._validateGeometry(t);const n=this.geometry,r=n.getIndex()!==null,s=n.getIndex(),o=t.getIndex(),a=this._reservedRanges[e];if(r&&o.count>a.indexCount||t.attributes.position.count>a.vertexCount)throw new Error("BatchedMesh: Reserved space not large enough for provided geometry.");const l=a.vertexStart,c=a.vertexCount;for(const d in n.attributes){if(d===Pg)continue;const m=t.getAttribute(d),y=n.getAttribute(d);Yte(m,y,l);const g=m.itemSize;for(let A=m.count,E=c;A<E;A++){const x=l+A;for(let w=0;w<g;w++)y.setComponent(x,w,0)}y.needsUpdate=!0}if(r){const d=a.indexStart;for(let m=0;m<o.count;m++)s.setX(d+m,l+o.getX(m));for(let m=o.count,y=a.indexCount;m<y;m++)s.setX(d+m,l);s.needsUpdate=!0}const u=this._bounds[e];t.boundingBox!==null?(u.box.copy(t.boundingBox),u.boxInitialized=!0):u.boxInitialized=!1,t.boundingSphere!==null?(u.sphere.copy(t.boundingSphere),u.sphereInitialized=!0):u.sphereInitialized=!1;const h=this._drawRanges[e],f=t.getAttribute("position");return h.count=r?o.count:f.count,this._visibilityChanged=!0,e}deleteGeometry(e){const t=this._active;return e>=t.length||t[e]===!1?this:(t[e]=!1,this._visibilityChanged=!0,this)}getBoundingBoxAt(e,t){if(this._active[e]===!1)return this;const r=this._bounds[e],s=r.box,o=this.geometry;if(r.boxInitialized===!1){s.makeEmpty();const a=o.index,l=o.attributes.position,c=this._drawRanges[e];for(let u=c.start,h=c.start+c.count;u<h;u++){let f=u;a&&(f=a.getX(f)),s.expandByPoint(Hy.fromBufferAttribute(l,f))}r.boxInitialized=!0}return t.copy(s),t}getBoundingSphereAt(e,t){if(this._active[e]===!1)return this;const r=this._bounds[e],s=r.sphere,o=this.geometry;if(r.sphereInitialized===!1){s.makeEmpty(),this.getBoundingBoxAt(e,rE),rE.getCenter(s.center);const a=o.index,l=o.attributes.position,c=this._drawRanges[e];let u=0;for(let h=c.start,f=c.start+c.count;h<f;h++){let d=h;a&&(d=a.getX(d)),Hy.fromBufferAttribute(l,d),u=Math.max(u,s.center.distanceToSquared(Hy))}s.radius=Math.sqrt(u),r.sphereInitialized=!0}return t.copy(s),t}setMatrixAt(e,t){const n=this._active,r=this._matricesTexture,s=this._matricesTexture.image.data,o=this._geometryCount;return e>=o||n[e]===!1?this:(t.toArray(s,e*16),r.needsUpdate=!0,this)}getMatrixAt(e,t){const n=this._active,r=this._matricesTexture.image.data,s=this._geometryCount;return e>=s||n[e]===!1?null:t.fromArray(r,e*16)}setVisibleAt(e,t){const n=this._visibility,r=this._active,s=this._geometryCount;return e>=s||r[e]===!1||n[e]===t?this:(n[e]=t,this._visibilityChanged=!0,this)}getVisibleAt(e){const t=this._visibility,n=this._active,r=this._geometryCount;return e>=r||n[e]===!1?!1:t[e]}raycast(e,t){const n=this._visibility,r=this._active,s=this._drawRanges,o=this._geometryCount,a=this.matrixWorld,l=this.geometry;$o.material=this.material,$o.geometry.index=l.index,$o.geometry.attributes=l.attributes,$o.geometry.boundingBox===null&&($o.geometry.boundingBox=new ti),$o.geometry.boundingSphere===null&&($o.geometry.boundingSphere=new Bi);for(let c=0;c<o;c++){if(!n[c]||!r[c])continue;const u=s[c];$o.geometry.setDrawRange(u.start,u.count),this.getMatrixAt(c,$o.matrixWorld).premultiply(a),this.getBoundingBoxAt(c,$o.geometry.boundingBox),this.getBoundingSphereAt(c,$o.geometry.boundingSphere),$o.raycast(e,sE);for(let h=0,f=sE.length;h<f;h++){const d=sE[h];d.object=this,d.batchId=c,t.push(d)}sE.length=0}$o.material=null,$o.geometry.index=null,$o.geometry.attributes={},$o.geometry.setDrawRange(0,1/0)}copy(e){return super.copy(e),this.geometry=e.geometry.clone(),this.perObjectFrustumCulled=e.perObjectFrustumCulled,this.sortObjects=e.sortObjects,this.boundingBox=e.boundingBox!==null?e.boundingBox.clone():null,this.boundingSphere=e.boundingSphere!==null?e.boundingSphere.clone():null,this._drawRanges=e._drawRanges.map(t=>({...t})),this._reservedRanges=e._reservedRanges.map(t=>({...t})),this._visibility=e._visibility.slice(),this._active=e._active.slice(),this._bounds=e._bounds.map(t=>({boxInitialized:t.boxInitialized,box:t.box.clone(),sphereInitialized:t.sphereInitialized,sphere:t.sphere.clone()})),this._maxGeometryCount=e._maxGeometryCount,this._maxVertexCount=e._maxVertexCount,this._maxIndexCount=e._maxIndexCount,this._geometryInitialized=e._geometryInitialized,this._geometryCount=e._geometryCount,this._multiDrawCounts=e._multiDrawCounts.slice(),this._multiDrawStarts=e._multiDrawStarts.slice(),this._matricesTexture=e._matricesTexture.clone(),this._matricesTexture.image.data=this._matricesTexture.image.slice(),this}dispose(){return this.geometry.dispose(),this._matricesTexture.dispose(),this._matricesTexture=null,this}onBeforeRender(e,t,n,r,s){if(!this._visibilityChanged&&!this.perObjectFrustumCulled&&!this.sortObjects)return;const o=r.getIndex(),a=o===null?1:o.array.BYTES_PER_ELEMENT,l=this._visibility,c=this._multiDrawStarts,u=this._multiDrawCounts,h=this._drawRanges,f=this.perObjectFrustumCulled;f&&(iB.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse).multiply(this.matrixWorld),pT.setFromProjectionMatrix(iB,e.isWebGPURenderer?nA:mu));let d=0;if(this.sortObjects){nB.copy(this.matrixWorld).invert(),Hy.setFromMatrixPosition(n.matrixWorld).applyMatrix4(nB);for(let g=0,A=l.length;g<A;g++)if(l[g]){this.getMatrixAt(g,wd),this.getBoundingSphereAt(g,om).applyMatrix4(wd);let E=!1;if(f&&(E=!pT.intersectsSphere(om)),!E){const x=Hy.distanceTo(om.center);mT.push(h[g],x)}}const m=mT.list,y=this.customSort;y===null?m.sort(s.transparent?jte:Vte):y.call(this,m,n);for(let g=0,A=m.length;g<A;g++){const E=m[g];c[d]=E.start*a,u[d]=E.count,d++}mT.reset()}else for(let m=0,y=l.length;m<y;m++)if(l[m]){let g=!1;if(f&&(this.getMatrixAt(m,wd),this.getBoundingSphereAt(m,om).applyMatrix4(wd),g=!pT.intersectsSphere(om)),!g){const A=h[m];c[d]=A.start*a,u[d]=A.count,d++}}this._multiDrawCount=d,this._visibilityChanged=!1}onBeforeShadow(e,t,n,r,s,o){this.onBeforeRender(e,null,r,s,o)}};class vs extends Us{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new ut(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const rB=new Q,sB=new Q,oB=new Xe,gT=new vc,oE=new Bi;let $n=class extends _n{constructor(e=new fn,t=new vs){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,n=[0];for(let r=1,s=t.count;r<s;r++)rB.fromBufferAttribute(t,r-1),sB.fromBufferAttribute(t,r),n[r]=n[r-1],n[r]+=rB.distanceTo(sB);e.setAttribute("lineDistance",new Gt(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const n=this.geometry,r=this.matrixWorld,s=e.params.Line.threshold,o=n.drawRange;if(n.boundingSphere===null&&n.computeBoundingSphere(),oE.copy(n.boundingSphere),oE.applyMatrix4(r),oE.radius+=s,e.ray.intersectsSphere(oE)===!1)return;oB.copy(r).invert(),gT.copy(e.ray).applyMatrix4(oB);const a=s/((this.scale.x+this.scale.y+this.scale.z)/3),l=a*a,c=new Q,u=new Q,h=new Q,f=new Q,d=this.isLineSegments?2:1,m=n.index,g=n.attributes.position;if(m!==null){const A=Math.max(0,o.start),E=Math.min(m.count,o.start+o.count);for(let x=A,w=E-1;x<w;x+=d){const T=m.getX(x),I=m.getX(x+1);if(c.fromBufferAttribute(g,T),u.fromBufferAttribute(g,I),gT.distanceSqToSegment(c,u,f,h)>l)continue;f.applyMatrix4(this.matrixWorld);const L=e.ray.origin.distanceTo(f);L<e.near||L>e.far||t.push({distance:L,point:h.clone().applyMatrix4(this.matrixWorld),index:x,face:null,faceIndex:null,object:this})}}else{const A=Math.max(0,o.start),E=Math.min(g.count,o.start+o.count);for(let x=A,w=E-1;x<w;x+=d){if(c.fromBufferAttribute(g,x),u.fromBufferAttribute(g,x+1),gT.distanceSqToSegment(c,u,f,h)>l)continue;f.applyMatrix4(this.matrixWorld);const I=e.ray.origin.distanceTo(f);I<e.near||I>e.far||t.push({distance:I,point:h.clone().applyMatrix4(this.matrixWorld),index:x,face:null,faceIndex:null,object:this})}}}updateMorphTargets(){const t=this.geometry.morphAttributes,n=Object.keys(t);if(n.length>0){const r=t[n[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=r.length;s<o;s++){const a=r[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}};const aB=new Q,lB=new Q;class Ru extends $n{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,n=[];for(let r=0,s=t.count;r<s;r+=2)aB.fromBufferAttribute(t,r),lB.fromBufferAttribute(t,r+1),n[r]=r===0?0:n[r-1],n[r+1]=n[r]+aB.distanceTo(lB);e.setAttribute("lineDistance",new Gt(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class B6 extends $n{constructor(e,t){super(e,t),this.isLineLoop=!0,this.type="LineLoop"}}class hx extends Us{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new ut(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const cB=new Xe,LM=new vc,aE=new Bi,lE=new Q;let D6=class extends _n{constructor(e=new fn,t=new hx){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}raycast(e,t){const n=this.geometry,r=this.matrixWorld,s=e.params.Points.threshold,o=n.drawRange;if(n.boundingSphere===null&&n.computeBoundingSphere(),aE.copy(n.boundingSphere),aE.applyMatrix4(r),aE.radius+=s,e.ray.intersectsSphere(aE)===!1)return;cB.copy(r).invert(),LM.copy(e.ray).applyMatrix4(cB);const a=s/((this.scale.x+this.scale.y+this.scale.z)/3),l=a*a,c=n.index,h=n.attributes.position;if(c!==null){const f=Math.max(0,o.start),d=Math.min(c.count,o.start+o.count);for(let m=f,y=d;m<y;m++){const g=c.getX(m);lE.fromBufferAttribute(h,g),uB(lE,g,l,r,e,t,this)}}else{const f=Math.max(0,o.start),d=Math.min(h.count,o.start+o.count);for(let m=f,y=d;m<y;m++)lE.fromBufferAttribute(h,m),uB(lE,m,l,r,e,t,this)}}updateMorphTargets(){const t=this.geometry.morphAttributes,n=Object.keys(t);if(n.length>0){const r=t[n[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=r.length;s<o;s++){const a=r[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}};function uB(i,e,t,n,r,s,o){const a=LM.distanceSqToPoint(i);if(a<t){const l=new Q;LM.closestPointToPoint(i,l),l.applyMatrix4(n);const c=r.ray.origin.distanceTo(l);if(c<r.near||c>r.far)return;s.push({distance:c,distanceToRay:Math.sqrt(a),point:l,index:e,face:null,object:o})}}let iz=class extends vi{constructor(e,t,n,r,s,o,a,l,c){super(e,t,n,r,s,o,a,l,c),this.isVideoTexture=!0,this.minFilter=o!==void 0?o:Ln,this.magFilter=s!==void 0?s:Ln,this.generateMipmaps=!1;const u=this;function h(){u.needsUpdate=!0,e.requestVideoFrameCallback(h)}"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback(h)}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image;"requestVideoFrameCallback"in e===!1&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}};class $te extends vi{constructor(e,t){super({width:e,height:t}),this.isFramebufferTexture=!0,this.magFilter=zn,this.minFilter=zn,this.generateMipmaps=!1,this.needsUpdate=!0}}class gp extends vi{constructor(e,t,n,r,s,o,a,l,c,u,h,f){super(null,o,a,l,c,u,r,s,h,f),this.isCompressedTexture=!0,this.image={width:t,height:n},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}let Xte=class extends gp{constructor(e,t,n,r,s,o){super(e,t,n,s,o),this.isCompressedArrayTexture=!0,this.image.depth=r,this.wrapR=Wi}},qte=class extends gp{constructor(e,t,n){super(void 0,e[0].width,e[0].height,t,n,_u),this.isCompressedCubeTexture=!0,this.isCubeTexture=!0,this.image=e}};class k6 extends vi{constructor(e,t,n,r,s,o,a,l,c){super(e,t,n,r,s,o,a,l,c),this.isCanvasTexture=!0,this.needsUpdate=!0}}class xc{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){const n=this.getUtoTmapping(e);return this.getPoint(n,t)}getPoints(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return t}getSpacedPoints(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPointAt(n/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let n,r=this.getPoint(0),s=0;t.push(0);for(let o=1;o<=e;o++)n=this.getPoint(o/e),s+=n.distanceTo(r),t.push(s),r=n;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){const n=this.getLengths();let r=0;const s=n.length;let o;t?o=t:o=e*n[s-1];let a=0,l=s-1,c;for(;a<=l;)if(r=Math.floor(a+(l-a)/2),c=n[r]-o,c<0)a=r+1;else if(c>0)l=r-1;else{l=r;break}if(r=l,n[r]===o)return r/(s-1);const u=n[r],f=n[r+1]-u,d=(o-u)/f;return(r+d)/(s-1)}getTangent(e,t){let r=e-1e-4,s=e+1e-4;r<0&&(r=0),s>1&&(s=1);const o=this.getPoint(r),a=this.getPoint(s),l=t||(o.isVector2?new Ue:new Q);return l.copy(a).sub(o).normalize(),l}getTangentAt(e,t){const n=this.getUtoTmapping(e);return this.getTangent(n,t)}computeFrenetFrames(e,t){const n=new Q,r=[],s=[],o=[],a=new Q,l=new Xe;for(let d=0;d<=e;d++){const m=d/e;r[d]=this.getTangentAt(m,new Q)}s[0]=new Q,o[0]=new Q;let c=Number.MAX_VALUE;const u=Math.abs(r[0].x),h=Math.abs(r[0].y),f=Math.abs(r[0].z);u<=c&&(c=u,n.set(1,0,0)),h<=c&&(c=h,n.set(0,1,0)),f<=c&&n.set(0,0,1),a.crossVectors(r[0],n).normalize(),s[0].crossVectors(r[0],a),o[0].crossVectors(r[0],s[0]);for(let d=1;d<=e;d++){if(s[d]=s[d-1].clone(),o[d]=o[d-1].clone(),a.crossVectors(r[d-1],r[d]),a.length()>Number.EPSILON){a.normalize();const m=Math.acos(rs(r[d-1].dot(r[d]),-1,1));s[d].applyMatrix4(l.makeRotationAxis(a,m))}o[d].crossVectors(r[d],s[d])}if(t===!0){let d=Math.acos(rs(s[0].dot(s[e]),-1,1));d/=e,r[0].dot(a.crossVectors(s[0],s[e]))>0&&(d=-d);for(let m=1;m<=e;m++)s[m].applyMatrix4(l.makeRotationAxis(r[m],d*m)),o[m].crossVectors(r[m],s[m])}return{tangents:r,normals:s,binormals:o}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class Hm extends xc{constructor(e=0,t=0,n=1,r=1,s=0,o=Math.PI*2,a=!1,l=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=n,this.yRadius=r,this.aStartAngle=s,this.aEndAngle=o,this.aClockwise=a,this.aRotation=l}getPoint(e,t){const n=t||new Ue,r=Math.PI*2;let s=this.aEndAngle-this.aStartAngle;const o=Math.abs(s)<Number.EPSILON;for(;s<0;)s+=r;for(;s>r;)s-=r;s<Number.EPSILON&&(o?s=0:s=r),this.aClockwise===!0&&!o&&(s===r?s=-r:s=s-r);const a=this.aStartAngle+e*s;let l=this.aX+this.xRadius*Math.cos(a),c=this.aY+this.yRadius*Math.sin(a);if(this.aRotation!==0){const u=Math.cos(this.aRotation),h=Math.sin(this.aRotation),f=l-this.aX,d=c-this.aY;l=f*u-d*h+this.aX,c=f*h+d*u+this.aY}return n.set(l,c)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}class rz extends Hm{constructor(e,t,n,r,s,o){super(e,t,n,n,r,s,o),this.isArcCurve=!0,this.type="ArcCurve"}}function F6(){let i=0,e=0,t=0,n=0;function r(s,o,a,l){i=s,e=a,t=-3*s+3*o-2*a-l,n=2*s-2*o+a+l}return{initCatmullRom:function(s,o,a,l,c){r(o,a,c*(a-s),c*(l-o))},initNonuniformCatmullRom:function(s,o,a,l,c,u,h){let f=(o-s)/c-(a-s)/(c+u)+(a-o)/u,d=(a-o)/u-(l-o)/(u+h)+(l-a)/h;f*=u,d*=u,r(o,a,f,d)},calc:function(s){const o=s*s,a=o*s;return i+e*s+t*o+n*a}}}const cE=new Q,AT=new F6,yT=new F6,vT=new F6;class Dw extends xc{constructor(e=[],t=!1,n="centripetal",r=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=n,this.tension=r}getPoint(e,t=new Q){const n=t,r=this.points,s=r.length,o=(s-(this.closed?0:1))*e;let a=Math.floor(o),l=o-a;this.closed?a+=a>0?0:(Math.floor(Math.abs(a)/s)+1)*s:l===0&&a===s-1&&(a=s-2,l=1);let c,u;this.closed||a>0?c=r[(a-1)%s]:(cE.subVectors(r[0],r[1]).add(r[0]),c=cE);const h=r[a%s],f=r[(a+1)%s];if(this.closed||a+2<s?u=r[(a+2)%s]:(cE.subVectors(r[s-1],r[s-2]).add(r[s-1]),u=cE),this.curveType==="centripetal"||this.curveType==="chordal"){const d=this.curveType==="chordal"?.5:.25;let m=Math.pow(c.distanceToSquared(h),d),y=Math.pow(h.distanceToSquared(f),d),g=Math.pow(f.distanceToSquared(u),d);y<1e-4&&(y=1),m<1e-4&&(m=y),g<1e-4&&(g=y),AT.initNonuniformCatmullRom(c.x,h.x,f.x,u.x,m,y,g),yT.initNonuniformCatmullRom(c.y,h.y,f.y,u.y,m,y,g),vT.initNonuniformCatmullRom(c.z,h.z,f.z,u.z,m,y,g)}else this.curveType==="catmullrom"&&(AT.initCatmullRom(c.x,h.x,f.x,u.x,this.tension),yT.initCatmullRom(c.y,h.y,f.y,u.y,this.tension),vT.initCatmullRom(c.z,h.z,f.z,u.z,this.tension));return n.set(AT.calc(l),yT.calc(l),vT.calc(l)),n}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const r=e.points[t];this.points.push(r.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const r=this.points[t];e.points.push(r.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const r=e.points[t];this.points.push(new Q().fromArray(r))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function hB(i,e,t,n,r){const s=(n-e)*.5,o=(r-t)*.5,a=i*i,l=i*a;return(2*t-2*n+s+o)*l+(-3*t+3*n-2*s-o)*a+s*i+t}function Jte(i,e){const t=1-i;return t*t*e}function Zte(i,e){return 2*(1-i)*i*e}function ene(i,e){return i*i*e}function Zv(i,e,t,n){return Jte(i,e)+Zte(i,t)+ene(i,n)}function tne(i,e){const t=1-i;return t*t*t*e}function nne(i,e){const t=1-i;return 3*t*t*i*e}function ine(i,e){return 3*(1-i)*i*i*e}function rne(i,e){return i*i*i*e}function e2(i,e,t,n,r){return tne(i,e)+nne(i,t)+ine(i,n)+rne(i,r)}class O6 extends xc{constructor(e=new Ue,t=new Ue,n=new Ue,r=new Ue){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=n,this.v3=r}getPoint(e,t=new Ue){const n=t,r=this.v0,s=this.v1,o=this.v2,a=this.v3;return n.set(e2(e,r.x,s.x,o.x,a.x),e2(e,r.y,s.y,o.y,a.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class N6 extends xc{constructor(e=new Q,t=new Q,n=new Q,r=new Q){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=n,this.v3=r}getPoint(e,t=new Q){const n=t,r=this.v0,s=this.v1,o=this.v2,a=this.v3;return n.set(e2(e,r.x,s.x,o.x,a.x),e2(e,r.y,s.y,o.y,a.y),e2(e,r.z,s.z,o.z,a.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class U6 extends xc{constructor(e=new Ue,t=new Ue){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new Ue){const n=t;return e===1?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new Ue){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class sz extends xc{constructor(e=new Q,t=new Q){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=t}getPoint(e,t=new Q){const n=t;return e===1?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new Q){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class z6 extends xc{constructor(e=new Ue,t=new Ue,n=new Ue){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new Ue){const n=t,r=this.v0,s=this.v1,o=this.v2;return n.set(Zv(e,r.x,s.x,o.x),Zv(e,r.y,s.y,o.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class kw extends xc{constructor(e=new Q,t=new Q,n=new Q){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new Q){const n=t,r=this.v0,s=this.v1,o=this.v2;return n.set(Zv(e,r.x,s.x,o.x),Zv(e,r.y,s.y,o.y),Zv(e,r.z,s.z,o.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class G6 extends xc{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e,t=new Ue){const n=t,r=this.points,s=(r.length-1)*e,o=Math.floor(s),a=s-o,l=r[o===0?o:o-1],c=r[o],u=r[o>r.length-2?r.length-1:o+1],h=r[o>r.length-3?r.length-1:o+2];return n.set(hB(a,l.x,c.x,u.x,h.x),hB(a,l.y,c.y,u.y,h.y)),n}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const r=e.points[t];this.points.push(r.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const r=this.points[t];e.points.push(r.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const r=e.points[t];this.points.push(new Ue().fromArray(r))}return this}}var PS=Object.freeze({__proto__:null,ArcCurve:rz,CatmullRomCurve3:Dw,CubicBezierCurve:O6,CubicBezierCurve3:N6,EllipseCurve:Hm,LineCurve:U6,LineCurve3:sz,QuadraticBezierCurve:z6,QuadraticBezierCurve3:kw,SplineCurve:G6});class H6 extends xc{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);if(!e.equals(t)){const n=e.isVector2===!0?"LineCurve":"LineCurve3";this.curves.push(new PS[n](t,e))}return this}getPoint(e,t){const n=e*this.getLength(),r=this.getCurveLengths();let s=0;for(;s<r.length;){if(r[s]>=n){const o=r[s]-n,a=this.curves[s],l=a.getLength(),c=l===0?0:1-o/l;return a.getPointAt(c,t)}s++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let t=0;for(let n=0,r=this.curves.length;n<r;n++)t+=this.curves[n].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){const t=[];let n;for(let r=0,s=this.curves;r<s.length;r++){const o=s[r],a=o.isEllipseCurve?e*2:o.isLineCurve||o.isLineCurve3?1:o.isSplineCurve?e*o.points.length:e,l=o.getPoints(a);for(let c=0;c<l.length;c++){const u=l[c];n&&n.equals(u)||(t.push(u),n=u)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const r=e.curves[t];this.curves.push(r.clone())}return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,n=this.curves.length;t<n;t++){const r=this.curves[t];e.curves.push(r.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const r=e.curves[t];this.curves.push(new PS[r.type]().fromJSON(r))}return this}}class Xd extends H6{constructor(e){super(),this.type="Path",this.currentPoint=new Ue,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,n=e.length;t<n;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){const n=new U6(this.currentPoint.clone(),new Ue(e,t));return this.curves.push(n),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,n,r){const s=new z6(this.currentPoint.clone(),new Ue(e,t),new Ue(n,r));return this.curves.push(s),this.currentPoint.set(n,r),this}bezierCurveTo(e,t,n,r,s,o){const a=new O6(this.currentPoint.clone(),new Ue(e,t),new Ue(n,r),new Ue(s,o));return this.curves.push(a),this.currentPoint.set(s,o),this}splineThru(e){const t=[this.currentPoint.clone()].concat(e),n=new G6(t);return this.curves.push(n),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,n,r,s,o){const a=this.currentPoint.x,l=this.currentPoint.y;return this.absarc(e+a,t+l,n,r,s,o),this}absarc(e,t,n,r,s,o){return this.absellipse(e,t,n,n,r,s,o),this}ellipse(e,t,n,r,s,o,a,l){const c=this.currentPoint.x,u=this.currentPoint.y;return this.absellipse(e+c,t+u,n,r,s,o,a,l),this}absellipse(e,t,n,r,s,o,a,l){const c=new Hm(e,t,n,r,s,o,a,l);if(this.curves.length>0){const h=c.getPoint(0);h.equals(this.currentPoint)||this.lineTo(h.x,h.y)}this.curves.push(c);const u=c.getPoint(1);return this.currentPoint.copy(u),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class fx extends fn{constructor(e=[new Ue(0,-.5),new Ue(.5,0),new Ue(0,.5)],t=12,n=0,r=Math.PI*2){super(),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:n,phiLength:r},t=Math.floor(t),r=rs(r,0,Math.PI*2);const s=[],o=[],a=[],l=[],c=[],u=1/t,h=new Q,f=new Ue,d=new Q,m=new Q,y=new Q;let g=0,A=0;for(let E=0;E<=e.length-1;E++)switch(E){case 0:g=e[E+1].x-e[E].x,A=e[E+1].y-e[E].y,d.x=A*1,d.y=-g,d.z=A*0,y.copy(d),d.normalize(),l.push(d.x,d.y,d.z);break;case e.length-1:l.push(y.x,y.y,y.z);break;default:g=e[E+1].x-e[E].x,A=e[E+1].y-e[E].y,d.x=A*1,d.y=-g,d.z=A*0,m.copy(d),d.x+=y.x,d.y+=y.y,d.z+=y.z,d.normalize(),l.push(d.x,d.y,d.z),y.copy(m)}for(let E=0;E<=t;E++){const x=n+E*u*r,w=Math.sin(x),T=Math.cos(x);for(let I=0;I<=e.length-1;I++){h.x=e[I].x*w,h.y=e[I].y,h.z=e[I].x*T,o.push(h.x,h.y,h.z),f.x=E/t,f.y=I/(e.length-1),a.push(f.x,f.y);const M=l[3*I+0]*w,L=l[3*I+1],P=l[3*I+0]*T;c.push(M,L,P)}}for(let E=0;E<t;E++)for(let x=0;x<e.length-1;x++){const w=x+E*e.length,T=w,I=w+e.length,M=w+e.length+1,L=w+1;s.push(T,I,L),s.push(M,L,I)}this.setIndex(s),this.setAttribute("position",new Gt(o,3)),this.setAttribute("uv",new Gt(a,2)),this.setAttribute("normal",new Gt(c,3))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new fx(e.points,e.segments,e.phiStart,e.phiLength)}}class Fw extends fx{constructor(e=1,t=1,n=4,r=8){const s=new Xd;s.absarc(0,-t/2,e,Math.PI*1.5,0),s.absarc(0,t/2,e,0,Math.PI*.5),super(s.getPoints(n),r),this.type="CapsuleGeometry",this.parameters={radius:e,length:t,capSegments:n,radialSegments:r}}static fromJSON(e){return new Fw(e.radius,e.length,e.capSegments,e.radialSegments)}}class Ow extends fn{constructor(e=1,t=32,n=0,r=Math.PI*2){super(),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:n,thetaLength:r},t=Math.max(3,t);const s=[],o=[],a=[],l=[],c=new Q,u=new Ue;o.push(0,0,0),a.push(0,0,1),l.push(.5,.5);for(let h=0,f=3;h<=t;h++,f+=3){const d=n+h/t*r;c.x=e*Math.cos(d),c.y=e*Math.sin(d),o.push(c.x,c.y,c.z),a.push(0,0,1),u.x=(o[f]/e+1)/2,u.y=(o[f+1]/e+1)/2,l.push(u.x,u.y)}for(let h=1;h<=t;h++)s.push(h,h+1,0);this.setIndex(s),this.setAttribute("position",new Gt(o,3)),this.setAttribute("normal",new Gt(a,3)),this.setAttribute("uv",new Gt(l,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Ow(e.radius,e.segments,e.thetaStart,e.thetaLength)}}class yo extends fn{constructor(e=1,t=1,n=1,r=32,s=1,o=!1,a=0,l=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:r,heightSegments:s,openEnded:o,thetaStart:a,thetaLength:l};const c=this;r=Math.floor(r),s=Math.floor(s);const u=[],h=[],f=[],d=[];let m=0;const y=[],g=n/2;let A=0;E(),o===!1&&(e>0&&x(!0),t>0&&x(!1)),this.setIndex(u),this.setAttribute("position",new Gt(h,3)),this.setAttribute("normal",new Gt(f,3)),this.setAttribute("uv",new Gt(d,2));function E(){const w=new Q,T=new Q;let I=0;const M=(t-e)/n;for(let L=0;L<=s;L++){const P=[],R=L/s,U=R*(t-e)+e;for(let k=0;k<=r;k++){const H=k/r,G=H*l+a,X=Math.sin(G),Z=Math.cos(G);T.x=U*X,T.y=-R*n+g,T.z=U*Z,h.push(T.x,T.y,T.z),w.set(X,M,Z).normalize(),f.push(w.x,w.y,w.z),d.push(H,1-R),P.push(m++)}y.push(P)}for(let L=0;L<r;L++)for(let P=0;P<s;P++){const R=y[P][L],U=y[P+1][L],k=y[P+1][L+1],H=y[P][L+1];u.push(R,U,H),u.push(U,k,H),I+=6}c.addGroup(A,I,0),A+=I}function x(w){const T=m,I=new Ue,M=new Q;let L=0;const P=w===!0?e:t,R=w===!0?1:-1;for(let k=1;k<=r;k++)h.push(0,g*R,0),f.push(0,R,0),d.push(.5,.5),m++;const U=m;for(let k=0;k<=r;k++){const G=k/r*l+a,X=Math.cos(G),Z=Math.sin(G);M.x=P*Z,M.y=g*R,M.z=P*X,h.push(M.x,M.y,M.z),f.push(0,R,0),I.x=X*.5+.5,I.y=Z*.5*R+.5,d.push(I.x,I.y),m++}for(let k=0;k<r;k++){const H=T+k,G=U+k;w===!0?u.push(G,G+1,H):u.push(G+1,G,H),L+=3}c.addGroup(A,L,w===!0?1:2),A+=L}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new yo(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class Nw extends yo{constructor(e=1,t=1,n=32,r=1,s=!1,o=0,a=Math.PI*2){super(0,e,t,n,r,s,o,a),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:n,heightSegments:r,openEnded:s,thetaStart:o,thetaLength:a}}static fromJSON(e){return new Nw(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class Ap extends fn{constructor(e=[],t=[],n=1,r=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:n,detail:r};const s=[],o=[];a(r),c(n),u(),this.setAttribute("position",new Gt(s,3)),this.setAttribute("normal",new Gt(s.slice(),3)),this.setAttribute("uv",new Gt(o,2)),r===0?this.computeVertexNormals():this.normalizeNormals();function a(E){const x=new Q,w=new Q,T=new Q;for(let I=0;I<t.length;I+=3)d(t[I+0],x),d(t[I+1],w),d(t[I+2],T),l(x,w,T,E)}function l(E,x,w,T){const I=T+1,M=[];for(let L=0;L<=I;L++){M[L]=[];const P=E.clone().lerp(w,L/I),R=x.clone().lerp(w,L/I),U=I-L;for(let k=0;k<=U;k++)k===0&&L===I?M[L][k]=P:M[L][k]=P.clone().lerp(R,k/U)}for(let L=0;L<I;L++)for(let P=0;P<2*(I-L)-1;P++){const R=Math.floor(P/2);P%2===0?(f(M[L][R+1]),f(M[L+1][R]),f(M[L][R])):(f(M[L][R+1]),f(M[L+1][R+1]),f(M[L+1][R]))}}function c(E){const x=new Q;for(let w=0;w<s.length;w+=3)x.x=s[w+0],x.y=s[w+1],x.z=s[w+2],x.normalize().multiplyScalar(E),s[w+0]=x.x,s[w+1]=x.y,s[w+2]=x.z}function u(){const E=new Q;for(let x=0;x<s.length;x+=3){E.x=s[x+0],E.y=s[x+1],E.z=s[x+2];const w=g(E)/2/Math.PI+.5,T=A(E)/Math.PI+.5;o.push(w,1-T)}m(),h()}function h(){for(let E=0;E<o.length;E+=6){const x=o[E+0],w=o[E+2],T=o[E+4],I=Math.max(x,w,T),M=Math.min(x,w,T);I>.9&&M<.1&&(x<.2&&(o[E+0]+=1),w<.2&&(o[E+2]+=1),T<.2&&(o[E+4]+=1))}}function f(E){s.push(E.x,E.y,E.z)}function d(E,x){const w=E*3;x.x=e[w+0],x.y=e[w+1],x.z=e[w+2]}function m(){const E=new Q,x=new Q,w=new Q,T=new Q,I=new Ue,M=new Ue,L=new Ue;for(let P=0,R=0;P<s.length;P+=9,R+=6){E.set(s[P+0],s[P+1],s[P+2]),x.set(s[P+3],s[P+4],s[P+5]),w.set(s[P+6],s[P+7],s[P+8]),I.set(o[R+0],o[R+1]),M.set(o[R+2],o[R+3]),L.set(o[R+4],o[R+5]),T.copy(E).add(x).add(w).divideScalar(3);const U=g(T);y(I,R+0,E,U),y(M,R+2,x,U),y(L,R+4,w,U)}}function y(E,x,w,T){T<0&&E.x===1&&(o[x]=E.x-1),w.x===0&&w.z===0&&(o[x]=T/2/Math.PI+.5)}function g(E){return Math.atan2(E.z,-E.x)}function A(E){return Math.atan2(-E.y,Math.sqrt(E.x*E.x+E.z*E.z))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Ap(e.vertices,e.indices,e.radius,e.details)}}class Uw extends Ap{constructor(e=1,t=0){const n=(1+Math.sqrt(5))/2,r=1/n,s=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-r,-n,0,-r,n,0,r,-n,0,r,n,-r,-n,0,-r,n,0,r,-n,0,r,n,0,-n,0,-r,n,0,-r,-n,0,r,n,0,r],o=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];super(s,o,e,t),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Uw(e.radius,e.detail)}}const uE=new Q,hE=new Q,xT=new Q,fE=new ks;class Q6 extends fn{constructor(e=null,t=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:e,thresholdAngle:t},e!==null){const r=Math.pow(10,4),s=Math.cos(zm*t),o=e.getIndex(),a=e.getAttribute("position"),l=o?o.count:a.count,c=[0,0,0],u=["a","b","c"],h=new Array(3),f={},d=[];for(let m=0;m<l;m+=3){o?(c[0]=o.getX(m),c[1]=o.getX(m+1),c[2]=o.getX(m+2)):(c[0]=m,c[1]=m+1,c[2]=m+2);const{a:y,b:g,c:A}=fE;if(y.fromBufferAttribute(a,c[0]),g.fromBufferAttribute(a,c[1]),A.fromBufferAttribute(a,c[2]),fE.getNormal(xT),h[0]=`${Math.round(y.x*r)},${Math.round(y.y*r)},${Math.round(y.z*r)}`,h[1]=`${Math.round(g.x*r)},${Math.round(g.y*r)},${Math.round(g.z*r)}`,h[2]=`${Math.round(A.x*r)},${Math.round(A.y*r)},${Math.round(A.z*r)}`,!(h[0]===h[1]||h[1]===h[2]||h[2]===h[0]))for(let E=0;E<3;E++){const x=(E+1)%3,w=h[E],T=h[x],I=fE[u[E]],M=fE[u[x]],L=`${w}_${T}`,P=`${T}_${w}`;P in f&&f[P]?(xT.dot(f[P].normal)<=s&&(d.push(I.x,I.y,I.z),d.push(M.x,M.y,M.z)),f[P]=null):L in f||(f[L]={index0:c[E],index1:c[x],normal:xT.clone()})}}for(const m in f)if(f[m]){const{index0:y,index1:g}=f[m];uE.fromBufferAttribute(a,y),hE.fromBufferAttribute(a,g),d.push(uE.x,uE.y,uE.z),d.push(hE.x,hE.y,hE.z)}this.setAttribute("position",new Gt(d,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}let Pf=class extends Xd{constructor(e){super(e),this.uuid=Pl(),this.type="Shape",this.holes=[]}getPointsHoles(e){const t=[];for(let n=0,r=this.holes.length;n<r;n++)t[n]=this.holes[n].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const r=e.holes[t];this.holes.push(r.clone())}return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,n=this.holes.length;t<n;t++){const r=this.holes[t];e.holes.push(r.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const r=e.holes[t];this.holes.push(new Xd().fromJSON(r))}return this}};const sne={triangulate:function(i,e,t=2){const n=e&&e.length,r=n?e[0]*t:i.length;let s=oz(i,0,r,t,!0);const o=[];if(!s||s.next===s.prev)return o;let a,l,c,u,h,f,d;if(n&&(s=une(i,e,s,t)),i.length>80*t){a=c=i[0],l=u=i[1];for(let m=t;m<r;m+=t)h=i[m],f=i[m+1],h<a&&(a=h),f<l&&(l=f),h>c&&(c=h),f>u&&(u=f);d=Math.max(c-a,u-l),d=d!==0?32767/d:0}return L2(s,o,t,a,l,d,0),o}};function oz(i,e,t,n,r){let s,o;if(r===Ene(i,e,t,n)>0)for(s=e;s<t;s+=n)o=fB(s,i[s],i[s+1],o);else for(s=t-n;s>=e;s-=n)o=fB(s,i[s],i[s+1],o);return o&&zw(o,o.next)&&(D2(o),o=o.next),o}function e0(i,e){if(!i)return i;e||(e=i);let t=i,n;do if(n=!1,!t.steiner&&(zw(t,t.next)||jr(t.prev,t,t.next)===0)){if(D2(t),t=e=t.prev,t===t.next)break;n=!0}else t=t.next;while(n||t!==e);return e}function L2(i,e,t,n,r,s,o){if(!i)return;!o&&s&&mne(i,n,r,s);let a=i,l,c;for(;i.prev!==i.next;){if(l=i.prev,c=i.next,s?ane(i,n,r,s):one(i)){e.push(l.i/t|0),e.push(i.i/t|0),e.push(c.i/t|0),D2(i),i=c.next,a=c.next;continue}if(i=c,i===a){o?o===1?(i=lne(e0(i),e,t),L2(i,e,t,n,r,s,2)):o===2&&cne(i,e,t,n,r,s):L2(e0(i),e,t,n,r,s,1);break}}}function one(i){const e=i.prev,t=i,n=i.next;if(jr(e,t,n)>=0)return!1;const r=e.x,s=t.x,o=n.x,a=e.y,l=t.y,c=n.y,u=r<s?r<o?r:o:s<o?s:o,h=a<l?a<c?a:c:l<c?l:c,f=r>s?r>o?r:o:s>o?s:o,d=a>l?a>c?a:c:l>c?l:c;let m=n.next;for(;m!==e;){if(m.x>=u&&m.x<=f&&m.y>=h&&m.y<=d&&B1(r,a,s,l,o,c,m.x,m.y)&&jr(m.prev,m,m.next)>=0)return!1;m=m.next}return!0}function ane(i,e,t,n){const r=i.prev,s=i,o=i.next;if(jr(r,s,o)>=0)return!1;const a=r.x,l=s.x,c=o.x,u=r.y,h=s.y,f=o.y,d=a<l?a<c?a:c:l<c?l:c,m=u<h?u<f?u:f:h<f?h:f,y=a>l?a>c?a:c:l>c?l:c,g=u>h?u>f?u:f:h>f?h:f,A=BM(d,m,e,t,n),E=BM(y,g,e,t,n);let x=i.prevZ,w=i.nextZ;for(;x&&x.z>=A&&w&&w.z<=E;){if(x.x>=d&&x.x<=y&&x.y>=m&&x.y<=g&&x!==r&&x!==o&&B1(a,u,l,h,c,f,x.x,x.y)&&jr(x.prev,x,x.next)>=0||(x=x.prevZ,w.x>=d&&w.x<=y&&w.y>=m&&w.y<=g&&w!==r&&w!==o&&B1(a,u,l,h,c,f,w.x,w.y)&&jr(w.prev,w,w.next)>=0))return!1;w=w.nextZ}for(;x&&x.z>=A;){if(x.x>=d&&x.x<=y&&x.y>=m&&x.y<=g&&x!==r&&x!==o&&B1(a,u,l,h,c,f,x.x,x.y)&&jr(x.prev,x,x.next)>=0)return!1;x=x.prevZ}for(;w&&w.z<=E;){if(w.x>=d&&w.x<=y&&w.y>=m&&w.y<=g&&w!==r&&w!==o&&B1(a,u,l,h,c,f,w.x,w.y)&&jr(w.prev,w,w.next)>=0)return!1;w=w.nextZ}return!0}function lne(i,e,t){let n=i;do{const r=n.prev,s=n.next.next;!zw(r,s)&&az(r,n,n.next,s)&&B2(r,s)&&B2(s,r)&&(e.push(r.i/t|0),e.push(n.i/t|0),e.push(s.i/t|0),D2(n),D2(n.next),n=i=s),n=n.next}while(n!==i);return e0(n)}function cne(i,e,t,n,r,s){let o=i;do{let a=o.next.next;for(;a!==o.prev;){if(o.i!==a.i&&yne(o,a)){let l=lz(o,a);o=e0(o,o.next),l=e0(l,l.next),L2(o,e,t,n,r,s,0),L2(l,e,t,n,r,s,0);return}a=a.next}o=o.next}while(o!==i)}function une(i,e,t,n){const r=[];let s,o,a,l,c;for(s=0,o=e.length;s<o;s++)a=e[s]*n,l=s<o-1?e[s+1]*n:i.length,c=oz(i,a,l,n,!1),c===c.next&&(c.steiner=!0),r.push(Ane(c));for(r.sort(hne),s=0;s<r.length;s++)t=fne(r[s],t);return t}function hne(i,e){return i.x-e.x}function fne(i,e){const t=dne(i,e);if(!t)return e;const n=lz(t,i);return e0(n,n.next),e0(t,t.next)}function dne(i,e){let t=e,n=-1/0,r;const s=i.x,o=i.y;do{if(o<=t.y&&o>=t.next.y&&t.next.y!==t.y){const f=t.x+(o-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(f<=s&&f>n&&(n=f,r=t.x<t.next.x?t:t.next,f===s))return r}t=t.next}while(t!==e);if(!r)return null;const a=r,l=r.x,c=r.y;let u=1/0,h;t=r;do s>=t.x&&t.x>=l&&s!==t.x&&B1(o<c?s:n,o,l,c,o<c?n:s,o,t.x,t.y)&&(h=Math.abs(o-t.y)/(s-t.x),B2(t,i)&&(h<u||h===u&&(t.x>r.x||t.x===r.x&&pne(r,t)))&&(r=t,u=h)),t=t.next;while(t!==a);return r}function pne(i,e){return jr(i.prev,i,e.prev)<0&&jr(e.next,i,i.next)<0}function mne(i,e,t,n){let r=i;do r.z===0&&(r.z=BM(r.x,r.y,e,t,n)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next;while(r!==i);r.prevZ.nextZ=null,r.prevZ=null,gne(r)}function gne(i){let e,t,n,r,s,o,a,l,c=1;do{for(t=i,i=null,s=null,o=0;t;){for(o++,n=t,a=0,e=0;e<c&&(a++,n=n.nextZ,!!n);e++);for(l=c;a>0||l>0&&n;)a!==0&&(l===0||!n||t.z<=n.z)?(r=t,t=t.nextZ,a--):(r=n,n=n.nextZ,l--),s?s.nextZ=r:i=r,r.prevZ=s,s=r;t=n}s.nextZ=null,c*=2}while(o>1);return i}function BM(i,e,t,n,r){return i=(i-t)*r|0,e=(e-n)*r|0,i=(i|i<<8)&16711935,i=(i|i<<4)&252645135,i=(i|i<<2)&858993459,i=(i|i<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,i|e<<1}function Ane(i){let e=i,t=i;do(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next;while(e!==i);return t}function B1(i,e,t,n,r,s,o,a){return(r-o)*(e-a)>=(i-o)*(s-a)&&(i-o)*(n-a)>=(t-o)*(e-a)&&(t-o)*(s-a)>=(r-o)*(n-a)}function yne(i,e){return i.next.i!==e.i&&i.prev.i!==e.i&&!vne(i,e)&&(B2(i,e)&&B2(e,i)&&xne(i,e)&&(jr(i.prev,i,e.prev)||jr(i,e.prev,e))||zw(i,e)&&jr(i.prev,i,i.next)>0&&jr(e.prev,e,e.next)>0)}function jr(i,e,t){return(e.y-i.y)*(t.x-e.x)-(e.x-i.x)*(t.y-e.y)}function zw(i,e){return i.x===e.x&&i.y===e.y}function az(i,e,t,n){const r=pE(jr(i,e,t)),s=pE(jr(i,e,n)),o=pE(jr(t,n,i)),a=pE(jr(t,n,e));return!!(r!==s&&o!==a||r===0&&dE(i,t,e)||s===0&&dE(i,n,e)||o===0&&dE(t,i,n)||a===0&&dE(t,e,n))}function dE(i,e,t){return e.x<=Math.max(i.x,t.x)&&e.x>=Math.min(i.x,t.x)&&e.y<=Math.max(i.y,t.y)&&e.y>=Math.min(i.y,t.y)}function pE(i){return i>0?1:i<0?-1:0}function vne(i,e){let t=i;do{if(t.i!==i.i&&t.next.i!==i.i&&t.i!==e.i&&t.next.i!==e.i&&az(t,t.next,i,e))return!0;t=t.next}while(t!==i);return!1}function B2(i,e){return jr(i.prev,i,i.next)<0?jr(i,e,i.next)>=0&&jr(i,i.prev,e)>=0:jr(i,e,i.prev)<0||jr(i,i.next,e)<0}function xne(i,e){let t=i,n=!1;const r=(i.x+e.x)/2,s=(i.y+e.y)/2;do t.y>s!=t.next.y>s&&t.next.y!==t.y&&r<(t.next.x-t.x)*(s-t.y)/(t.next.y-t.y)+t.x&&(n=!n),t=t.next;while(t!==i);return n}function lz(i,e){const t=new DM(i.i,i.x,i.y),n=new DM(e.i,e.x,e.y),r=i.next,s=e.prev;return i.next=e,e.prev=i,t.next=r,r.prev=t,n.next=t,t.prev=n,s.next=n,n.prev=s,n}function fB(i,e,t,n){const r=new DM(i,e,t);return n?(r.next=n.next,r.prev=n,n.next.prev=r,n.next=r):(r.prev=r,r.next=r),r}function D2(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function DM(i,e,t){this.i=i,this.x=e,this.y=t,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Ene(i,e,t,n){let r=0;for(let s=e,o=t-n;s<t;s+=n)r+=(i[o]-i[s])*(i[s+1]+i[o+1]),o=s;return r}class xu{static area(e){const t=e.length;let n=0;for(let r=t-1,s=0;s<t;r=s++)n+=e[r].x*e[s].y-e[s].x*e[r].y;return n*.5}static isClockWise(e){return xu.area(e)<0}static triangulateShape(e,t){const n=[],r=[],s=[];dB(e),pB(n,e);let o=e.length;t.forEach(dB);for(let l=0;l<t.length;l++)r.push(o),o+=t[l].length,pB(n,t[l]);const a=sne.triangulate(n,r);for(let l=0;l<a.length;l+=3)s.push(a.slice(l,l+3));return s}}function dB(i){const e=i.length;e>2&&i[e-1].equals(i[0])&&i.pop()}function pB(i,e){for(let t=0;t<e.length;t++)i.push(e[t].x),i.push(e[t].y)}class dx extends fn{constructor(e=new Pf([new Ue(.5,.5),new Ue(-.5,.5),new Ue(-.5,-.5),new Ue(.5,-.5)]),t={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];const n=this,r=[],s=[];for(let a=0,l=e.length;a<l;a++){const c=e[a];o(c)}this.setAttribute("position",new Gt(r,3)),this.setAttribute("uv",new Gt(s,2)),this.computeVertexNormals();function o(a){const l=[],c=t.curveSegments!==void 0?t.curveSegments:12,u=t.steps!==void 0?t.steps:1,h=t.depth!==void 0?t.depth:1;let f=t.bevelEnabled!==void 0?t.bevelEnabled:!0,d=t.bevelThickness!==void 0?t.bevelThickness:.2,m=t.bevelSize!==void 0?t.bevelSize:d-.1,y=t.bevelOffset!==void 0?t.bevelOffset:0,g=t.bevelSegments!==void 0?t.bevelSegments:3;const A=t.extrudePath,E=t.UVGenerator!==void 0?t.UVGenerator:_ne;let x,w=!1,T,I,M,L;A&&(x=A.getSpacedPoints(u),w=!0,f=!1,T=A.computeFrenetFrames(u,!1),I=new Q,M=new Q,L=new Q),f||(g=0,d=0,m=0,y=0);const P=a.extractPoints(c);let R=P.shape;const U=P.holes;if(!xu.isClockWise(R)){R=R.reverse();for(let ue=0,Me=U.length;ue<Me;ue++){const Se=U[ue];xu.isClockWise(Se)&&(U[ue]=Se.reverse())}}const H=xu.triangulateShape(R,U),G=R;for(let ue=0,Me=U.length;ue<Me;ue++){const Se=U[ue];R=R.concat(Se)}function X(ue,Me,Se){return Me||console.error("THREE.ExtrudeGeometry: vec does not exist"),ue.clone().addScaledVector(Me,Se)}const Z=R.length,oe=H.length;function K(ue,Me,Se){let ve,Ae,ke;const be=ue.x-Me.x,ne=ue.y-Me.y,j=Se.x-ue.x,de=Se.y-ue.y,Re=be*be+ne*ne,Le=be*de-ne*j;if(Math.abs(Le)>Number.EPSILON){const Fe=Math.sqrt(Re),He=Math.sqrt(j*j+de*de),it=Me.x-ne/Fe,Ye=Me.y+be/Fe,ct=Se.x-de/He,pt=Se.y+j/He,je=((ct-it)*de-(pt-Ye)*j)/(be*de-ne*j);ve=it+be*je-ue.x,Ae=Ye+ne*je-ue.y;const Mt=ve*ve+Ae*Ae;if(Mt<=2)return new Ue(ve,Ae);ke=Math.sqrt(Mt/2)}else{let Fe=!1;be>Number.EPSILON?j>Number.EPSILON&&(Fe=!0):be<-Number.EPSILON?j<-Number.EPSILON&&(Fe=!0):Math.sign(ne)===Math.sign(de)&&(Fe=!0),Fe?(ve=-ne,Ae=be,ke=Math.sqrt(Re)):(ve=be,Ae=ne,ke=Math.sqrt(Re/2))}return new Ue(ve/ke,Ae/ke)}const V=[];for(let ue=0,Me=G.length,Se=Me-1,ve=ue+1;ue<Me;ue++,Se++,ve++)Se===Me&&(Se=0),ve===Me&&(ve=0),V[ue]=K(G[ue],G[Se],G[ve]);const W=[];let F,Y=V.concat();for(let ue=0,Me=U.length;ue<Me;ue++){const Se=U[ue];F=[];for(let ve=0,Ae=Se.length,ke=Ae-1,be=ve+1;ve<Ae;ve++,ke++,be++)ke===Ae&&(ke=0),be===Ae&&(be=0),F[ve]=K(Se[ve],Se[ke],Se[be]);W.push(F),Y=Y.concat(F)}for(let ue=0;ue<g;ue++){const Me=ue/g,Se=d*Math.cos(Me*Math.PI/2),ve=m*Math.sin(Me*Math.PI/2)+y;for(let Ae=0,ke=G.length;Ae<ke;Ae++){const be=X(G[Ae],V[Ae],ve);ie(be.x,be.y,-Se)}for(let Ae=0,ke=U.length;Ae<ke;Ae++){const be=U[Ae];F=W[Ae];for(let ne=0,j=be.length;ne<j;ne++){const de=X(be[ne],F[ne],ve);ie(de.x,de.y,-Se)}}}const te=m+y;for(let ue=0;ue<Z;ue++){const Me=f?X(R[ue],Y[ue],te):R[ue];w?(M.copy(T.normals[0]).multiplyScalar(Me.x),I.copy(T.binormals[0]).multiplyScalar(Me.y),L.copy(x[0]).add(M).add(I),ie(L.x,L.y,L.z)):ie(Me.x,Me.y,0)}for(let ue=1;ue<=u;ue++)for(let Me=0;Me<Z;Me++){const Se=f?X(R[Me],Y[Me],te):R[Me];w?(M.copy(T.normals[ue]).multiplyScalar(Se.x),I.copy(T.binormals[ue]).multiplyScalar(Se.y),L.copy(x[ue]).add(M).add(I),ie(L.x,L.y,L.z)):ie(Se.x,Se.y,h/u*ue)}for(let ue=g-1;ue>=0;ue--){const Me=ue/g,Se=d*Math.cos(Me*Math.PI/2),ve=m*Math.sin(Me*Math.PI/2)+y;for(let Ae=0,ke=G.length;Ae<ke;Ae++){const be=X(G[Ae],V[Ae],ve);ie(be.x,be.y,h+Se)}for(let Ae=0,ke=U.length;Ae<ke;Ae++){const be=U[Ae];F=W[Ae];for(let ne=0,j=be.length;ne<j;ne++){const de=X(be[ne],F[ne],ve);w?ie(de.x,de.y+x[u-1].y,x[u-1].x+Se):ie(de.x,de.y,h+Se)}}}q(),J();function q(){const ue=r.length/3;if(f){let Me=0,Se=Z*Me;for(let ve=0;ve<oe;ve++){const Ae=H[ve];se(Ae[2]+Se,Ae[1]+Se,Ae[0]+Se)}Me=u+g*2,Se=Z*Me;for(let ve=0;ve<oe;ve++){const Ae=H[ve];se(Ae[0]+Se,Ae[1]+Se,Ae[2]+Se)}}else{for(let Me=0;Me<oe;Me++){const Se=H[Me];se(Se[2],Se[1],Se[0])}for(let Me=0;Me<oe;Me++){const Se=H[Me];se(Se[0]+Z*u,Se[1]+Z*u,Se[2]+Z*u)}}n.addGroup(ue,r.length/3-ue,0)}function J(){const ue=r.length/3;let Me=0;re(G,Me),Me+=G.length;for(let Se=0,ve=U.length;Se<ve;Se++){const Ae=U[Se];re(Ae,Me),Me+=Ae.length}n.addGroup(ue,r.length/3-ue,1)}function re(ue,Me){let Se=ue.length;for(;--Se>=0;){const ve=Se;let Ae=Se-1;Ae<0&&(Ae=ue.length-1);for(let ke=0,be=u+g*2;ke<be;ke++){const ne=Z*ke,j=Z*(ke+1),de=Me+ve+ne,Re=Me+Ae+ne,Le=Me+Ae+j,Fe=Me+ve+j;ge(de,Re,Le,Fe)}}}function ie(ue,Me,Se){l.push(ue),l.push(Me),l.push(Se)}function se(ue,Me,Se){xe(ue),xe(Me),xe(Se);const ve=r.length/3,Ae=E.generateTopUV(n,r,ve-3,ve-2,ve-1);pe(Ae[0]),pe(Ae[1]),pe(Ae[2])}function ge(ue,Me,Se,ve){xe(ue),xe(Me),xe(ve),xe(Me),xe(Se),xe(ve);const Ae=r.length/3,ke=E.generateSideWallUV(n,r,Ae-6,Ae-3,Ae-2,Ae-1);pe(ke[0]),pe(ke[1]),pe(ke[3]),pe(ke[1]),pe(ke[2]),pe(ke[3])}function xe(ue){r.push(l[ue*3+0]),r.push(l[ue*3+1]),r.push(l[ue*3+2])}function pe(ue){s.push(ue.x),s.push(ue.y)}}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON(),t=this.parameters.shapes,n=this.parameters.options;return Sne(t,n,e)}static fromJSON(e,t){const n=[];for(let s=0,o=e.shapes.length;s<o;s++){const a=t[e.shapes[s]];n.push(a)}const r=e.options.extrudePath;return r!==void 0&&(e.options.extrudePath=new PS[r.type]().fromJSON(r)),new dx(n,e.options)}}const _ne={generateTopUV:function(i,e,t,n,r){const s=e[t*3],o=e[t*3+1],a=e[n*3],l=e[n*3+1],c=e[r*3],u=e[r*3+1];return[new Ue(s,o),new Ue(a,l),new Ue(c,u)]},generateSideWallUV:function(i,e,t,n,r,s){const o=e[t*3],a=e[t*3+1],l=e[t*3+2],c=e[n*3],u=e[n*3+1],h=e[n*3+2],f=e[r*3],d=e[r*3+1],m=e[r*3+2],y=e[s*3],g=e[s*3+1],A=e[s*3+2];return Math.abs(a-u)<Math.abs(o-c)?[new Ue(o,1-l),new Ue(c,1-h),new Ue(f,1-m),new Ue(y,1-A)]:[new Ue(a,1-l),new Ue(u,1-h),new Ue(d,1-m),new Ue(g,1-A)]}};function Sne(i,e,t){if(t.shapes=[],Array.isArray(i))for(let n=0,r=i.length;n<r;n++){const s=i[n];t.shapes.push(s.uuid)}else t.shapes.push(i.uuid);return t.options=Object.assign({},e),e.extrudePath!==void 0&&(t.options.extrudePath=e.extrudePath.toJSON()),t}class px extends Ap{constructor(e=1,t=0){const n=(1+Math.sqrt(5))/2,r=[-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1],s=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];super(r,s,e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new px(e.radius,e.detail)}}class rc extends Ap{constructor(e=1,t=0){const n=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],r=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];super(n,r,e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new rc(e.radius,e.detail)}}class Gw extends fn{constructor(e=.5,t=1,n=32,r=1,s=0,o=Math.PI*2){super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:n,phiSegments:r,thetaStart:s,thetaLength:o},n=Math.max(3,n),r=Math.max(1,r);const a=[],l=[],c=[],u=[];let h=e;const f=(t-e)/r,d=new Q,m=new Ue;for(let y=0;y<=r;y++){for(let g=0;g<=n;g++){const A=s+g/n*o;d.x=h*Math.cos(A),d.y=h*Math.sin(A),l.push(d.x,d.y,d.z),c.push(0,0,1),m.x=(d.x/t+1)/2,m.y=(d.y/t+1)/2,u.push(m.x,m.y)}h+=f}for(let y=0;y<r;y++){const g=y*(n+1);for(let A=0;A<n;A++){const E=A+g,x=E,w=E+n+1,T=E+n+2,I=E+1;a.push(x,w,I),a.push(w,T,I)}}this.setIndex(a),this.setAttribute("position",new Gt(l,3)),this.setAttribute("normal",new Gt(c,3)),this.setAttribute("uv",new Gt(u,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Gw(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}}class Hw extends fn{constructor(e=new Pf([new Ue(0,.5),new Ue(-.5,-.5),new Ue(.5,-.5)]),t=12){super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:t};const n=[],r=[],s=[],o=[];let a=0,l=0;if(Array.isArray(e)===!1)c(e);else for(let u=0;u<e.length;u++)c(e[u]),this.addGroup(a,l,u),a+=l,l=0;this.setIndex(n),this.setAttribute("position",new Gt(r,3)),this.setAttribute("normal",new Gt(s,3)),this.setAttribute("uv",new Gt(o,2));function c(u){const h=r.length/3,f=u.extractPoints(t);let d=f.shape;const m=f.holes;xu.isClockWise(d)===!1&&(d=d.reverse());for(let g=0,A=m.length;g<A;g++){const E=m[g];xu.isClockWise(E)===!0&&(m[g]=E.reverse())}const y=xu.triangulateShape(d,m);for(let g=0,A=m.length;g<A;g++){const E=m[g];d=d.concat(E)}for(let g=0,A=d.length;g<A;g++){const E=d[g];r.push(E.x,E.y,0),s.push(0,0,1),o.push(E.x,E.y)}for(let g=0,A=y.length;g<A;g++){const E=y[g],x=E[0]+h,w=E[1]+h,T=E[2]+h;n.push(x,w,T),l+=3}}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON(),t=this.parameters.shapes;return wne(t,e)}static fromJSON(e,t){const n=[];for(let r=0,s=e.shapes.length;r<s;r++){const o=t[e.shapes[r]];n.push(o)}return new Hw(n,e.curveSegments)}}function wne(i,e){if(e.shapes=[],Array.isArray(i))for(let t=0,n=i.length;t<n;t++){const r=i[t];e.shapes.push(r.uuid)}else e.shapes.push(i.uuid);return e}class p0 extends fn{constructor(e=1,t=32,n=16,r=0,s=Math.PI*2,o=0,a=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:r,phiLength:s,thetaStart:o,thetaLength:a},t=Math.max(3,Math.floor(t)),n=Math.max(2,Math.floor(n));const l=Math.min(o+a,Math.PI);let c=0;const u=[],h=new Q,f=new Q,d=[],m=[],y=[],g=[];for(let A=0;A<=n;A++){const E=[],x=A/n;let w=0;A===0&&o===0?w=.5/t:A===n&&l===Math.PI&&(w=-.5/t);for(let T=0;T<=t;T++){const I=T/t;h.x=-e*Math.cos(r+I*s)*Math.sin(o+x*a),h.y=e*Math.cos(o+x*a),h.z=e*Math.sin(r+I*s)*Math.sin(o+x*a),m.push(h.x,h.y,h.z),f.copy(h).normalize(),y.push(f.x,f.y,f.z),g.push(I+w,1-x),E.push(c++)}u.push(E)}for(let A=0;A<n;A++)for(let E=0;E<t;E++){const x=u[A][E+1],w=u[A][E],T=u[A+1][E],I=u[A+1][E+1];(A!==0||o>0)&&d.push(x,w,I),(A!==n-1||l<Math.PI)&&d.push(w,T,I)}this.setIndex(d),this.setAttribute("position",new Gt(m,3)),this.setAttribute("normal",new Gt(y,3)),this.setAttribute("uv",new Gt(g,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new p0(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class Qw extends Ap{constructor(e=1,t=0){const n=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],r=[2,1,0,0,3,2,1,3,0,2,3,1];super(n,r,e,t),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Qw(e.radius,e.detail)}}class Hd extends fn{constructor(e=1,t=.4,n=12,r=48,s=Math.PI*2){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:n,tubularSegments:r,arc:s},n=Math.floor(n),r=Math.floor(r);const o=[],a=[],l=[],c=[],u=new Q,h=new Q,f=new Q;for(let d=0;d<=n;d++)for(let m=0;m<=r;m++){const y=m/r*s,g=d/n*Math.PI*2;h.x=(e+t*Math.cos(g))*Math.cos(y),h.y=(e+t*Math.cos(g))*Math.sin(y),h.z=t*Math.sin(g),a.push(h.x,h.y,h.z),u.x=e*Math.cos(y),u.y=e*Math.sin(y),f.subVectors(h,u).normalize(),l.push(f.x,f.y,f.z),c.push(m/r),c.push(d/n)}for(let d=1;d<=n;d++)for(let m=1;m<=r;m++){const y=(r+1)*d+m-1,g=(r+1)*(d-1)+m-1,A=(r+1)*(d-1)+m,E=(r+1)*d+m;o.push(y,g,E),o.push(g,A,E)}this.setIndex(o),this.setAttribute("position",new Gt(a,3)),this.setAttribute("normal",new Gt(l,3)),this.setAttribute("uv",new Gt(c,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Hd(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}class Vw extends fn{constructor(e=1,t=.4,n=64,r=8,s=2,o=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:n,radialSegments:r,p:s,q:o},n=Math.floor(n),r=Math.floor(r);const a=[],l=[],c=[],u=[],h=new Q,f=new Q,d=new Q,m=new Q,y=new Q,g=new Q,A=new Q;for(let x=0;x<=n;++x){const w=x/n*s*Math.PI*2;E(w,s,o,e,d),E(w+.01,s,o,e,m),g.subVectors(m,d),A.addVectors(m,d),y.crossVectors(g,A),A.crossVectors(y,g),y.normalize(),A.normalize();for(let T=0;T<=r;++T){const I=T/r*Math.PI*2,M=-t*Math.cos(I),L=t*Math.sin(I);h.x=d.x+(M*A.x+L*y.x),h.y=d.y+(M*A.y+L*y.y),h.z=d.z+(M*A.z+L*y.z),l.push(h.x,h.y,h.z),f.subVectors(h,d).normalize(),c.push(f.x,f.y,f.z),u.push(x/n),u.push(T/r)}}for(let x=1;x<=n;x++)for(let w=1;w<=r;w++){const T=(r+1)*(x-1)+(w-1),I=(r+1)*x+(w-1),M=(r+1)*x+w,L=(r+1)*(x-1)+w;a.push(T,I,L),a.push(I,M,L)}this.setIndex(a),this.setAttribute("position",new Gt(l,3)),this.setAttribute("normal",new Gt(c,3)),this.setAttribute("uv",new Gt(u,2));function E(x,w,T,I,M){const L=Math.cos(x),P=Math.sin(x),R=T/w*x,U=Math.cos(R);M.x=I*(2+U)*.5*L,M.y=I*(2+U)*P*.5,M.z=I*Math.sin(R)*.5}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Vw(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}}class jw extends fn{constructor(e=new kw(new Q(-1,-1,0),new Q(-1,1,0),new Q(1,1,0)),t=64,n=1,r=8,s=!1){super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:n,radialSegments:r,closed:s};const o=e.computeFrenetFrames(t,s);this.tangents=o.tangents,this.normals=o.normals,this.binormals=o.binormals;const a=new Q,l=new Q,c=new Ue;let u=new Q;const h=[],f=[],d=[],m=[];y(),this.setIndex(m),this.setAttribute("position",new Gt(h,3)),this.setAttribute("normal",new Gt(f,3)),this.setAttribute("uv",new Gt(d,2));function y(){for(let x=0;x<t;x++)g(x);g(s===!1?t:0),E(),A()}function g(x){u=e.getPointAt(x/t,u);const w=o.normals[x],T=o.binormals[x];for(let I=0;I<=r;I++){const M=I/r*Math.PI*2,L=Math.sin(M),P=-Math.cos(M);l.x=P*w.x+L*T.x,l.y=P*w.y+L*T.y,l.z=P*w.z+L*T.z,l.normalize(),f.push(l.x,l.y,l.z),a.x=u.x+n*l.x,a.y=u.y+n*l.y,a.z=u.z+n*l.z,h.push(a.x,a.y,a.z)}}function A(){for(let x=1;x<=t;x++)for(let w=1;w<=r;w++){const T=(r+1)*(x-1)+(w-1),I=(r+1)*x+(w-1),M=(r+1)*x+w,L=(r+1)*(x-1)+w;m.push(T,I,L),m.push(I,M,L)}}function E(){for(let x=0;x<=t;x++)for(let w=0;w<=r;w++)c.x=x/t,c.y=w/r,d.push(c.x,c.y)}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new jw(new PS[e.path.type]().fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}class V6 extends fn{constructor(e=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:e},e!==null){const t=[],n=new Set,r=new Q,s=new Q;if(e.index!==null){const o=e.attributes.position,a=e.index;let l=e.groups;l.length===0&&(l=[{start:0,count:a.count,materialIndex:0}]);for(let c=0,u=l.length;c<u;++c){const h=l[c],f=h.start,d=h.count;for(let m=f,y=f+d;m<y;m+=3)for(let g=0;g<3;g++){const A=a.getX(m+g),E=a.getX(m+(g+1)%3);r.fromBufferAttribute(o,A),s.fromBufferAttribute(o,E),mB(r,s,n)===!0&&(t.push(r.x,r.y,r.z),t.push(s.x,s.y,s.z))}}}else{const o=e.attributes.position;for(let a=0,l=o.count/3;a<l;a++)for(let c=0;c<3;c++){const u=3*a+c,h=3*a+(c+1)%3;r.fromBufferAttribute(o,u),s.fromBufferAttribute(o,h),mB(r,s,n)===!0&&(t.push(r.x,r.y,r.z),t.push(s.x,s.y,s.z))}}this.setAttribute("position",new Gt(t,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}function mB(i,e,t){const n=`${i.x},${i.y},${i.z}-${e.x},${e.y},${e.z}`,r=`${e.x},${e.y},${e.z}-${i.x},${i.y},${i.z}`;return t.has(n)===!0||t.has(r)===!0?!1:(t.add(n),t.add(r),!0)}var gB=Object.freeze({__proto__:null,BoxGeometry:ya,CapsuleGeometry:Fw,CircleGeometry:Ow,ConeGeometry:Nw,CylinderGeometry:yo,DodecahedronGeometry:Uw,EdgesGeometry:Q6,ExtrudeGeometry:dx,IcosahedronGeometry:px,LatheGeometry:fx,OctahedronGeometry:rc,PlaneGeometry:Fs,PolyhedronGeometry:Ap,RingGeometry:Gw,ShapeGeometry:Hw,SphereGeometry:p0,TetrahedronGeometry:Qw,TorusGeometry:Hd,TorusKnotGeometry:Vw,TubeGeometry:jw,WireframeGeometry:V6});class cz extends Us{constructor(e){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new ut(0),this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.fog=e.fog,this}}class uz extends Mi{constructor(e){super(e),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class m0 extends Us{constructor(e){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new ut(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ut(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=mp,this.normalScale=new Ue(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class nl extends m0{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Ue(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return rs(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new ut(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new ut(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new ut(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(e)}get anisotropy(){return this._anisotropy}set anisotropy(e){this._anisotropy>0!=e>0&&this.version++,this._anisotropy=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=e.anisotropy,this.anisotropyRotation=e.anisotropyRotation,this.anisotropyMap=e.anisotropyMap,this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}class t2 extends Us{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new ut(16777215),this.specular=new ut(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ut(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=mp,this.normalScale=new Ue(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=ix,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class hz extends Us{constructor(e){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new ut(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ut(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=mp,this.normalScale=new Ue(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}class j6 extends Us{constructor(e){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=mp,this.normalScale=new Ue(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}class mx extends Us{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new ut(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ut(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=mp,this.normalScale=new Ue(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=ix,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class fz extends Us{constructor(e){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new ut(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=mp,this.normalScale=new Ue(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this.fog=e.fog,this}}class dz extends vs{constructor(e){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}function Bm(i,e,t){return!i||!t&&i.constructor===e?i:typeof e.BYTES_PER_ELEMENT=="number"?new e(i):Array.prototype.slice.call(i)}function pz(i){return ArrayBuffer.isView(i)&&!(i instanceof DataView)}function mz(i){function e(r,s){return i[r]-i[s]}const t=i.length,n=new Array(t);for(let r=0;r!==t;++r)n[r]=r;return n.sort(e),n}function kM(i,e,t){const n=i.length,r=new i.constructor(n);for(let s=0,o=0;o!==n;++s){const a=t[s]*e;for(let l=0;l!==e;++l)r[o++]=i[a+l]}return r}function W6(i,e,t,n){let r=1,s=i[0];for(;s!==void 0&&s[n]===void 0;)s=i[r++];if(s===void 0)return;let o=s[n];if(o!==void 0)if(Array.isArray(o))do o=s[n],o!==void 0&&(e.push(s.time),t.push.apply(t,o)),s=i[r++];while(s!==void 0);else if(o.toArray!==void 0)do o=s[n],o!==void 0&&(e.push(s.time),o.toArray(t,t.length)),s=i[r++];while(s!==void 0);else do o=s[n],o!==void 0&&(e.push(s.time),t.push(o)),s=i[r++];while(s!==void 0)}function Cne(i,e,t,n,r=30){const s=i.clone();s.name=e;const o=[];for(let l=0;l<s.tracks.length;++l){const c=s.tracks[l],u=c.getValueSize(),h=[],f=[];for(let d=0;d<c.times.length;++d){const m=c.times[d]*r;if(!(m<t||m>=n)){h.push(c.times[d]);for(let y=0;y<u;++y)f.push(c.values[d*u+y])}}h.length!==0&&(c.times=Bm(h,c.times.constructor),c.values=Bm(f,c.values.constructor),o.push(c))}s.tracks=o;let a=1/0;for(let l=0;l<s.tracks.length;++l)a>s.tracks[l].times[0]&&(a=s.tracks[l].times[0]);for(let l=0;l<s.tracks.length;++l)s.tracks[l].shift(-1*a);return s.resetDuration(),s}function Tne(i,e=0,t=i,n=30){n<=0&&(n=30);const r=t.tracks.length,s=e/n;for(let o=0;o<r;++o){const a=t.tracks[o],l=a.ValueTypeName;if(l==="bool"||l==="string")continue;const c=i.tracks.find(function(A){return A.name===a.name&&A.ValueTypeName===l});if(c===void 0)continue;let u=0;const h=a.getValueSize();a.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(u=h/3);let f=0;const d=c.getValueSize();c.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(f=d/3);const m=a.times.length-1;let y;if(s<=a.times[0]){const A=u,E=h-u;y=a.values.slice(A,E)}else if(s>=a.times[m]){const A=m*h+u,E=A+h-u;y=a.values.slice(A,E)}else{const A=a.createInterpolant(),E=u,x=h-u;A.evaluate(s),y=A.resultBuffer.slice(E,x)}l==="quaternion"&&new Xt().fromArray(y).normalize().conjugate().toArray(y);const g=c.times.length;for(let A=0;A<g;++A){const E=A*d+f;if(l==="quaternion")Xt.multiplyQuaternionsFlat(c.values,E,y,0,c.values,E);else{const x=d-f*2;for(let w=0;w<x;++w)c.values[E+w]-=y[w]}}}return i.blendMode=_6,i}const bne={convertArray:Bm,isTypedArray:pz,getKeyframeOrder:mz,sortedArray:kM,flattenJSON:W6,subclip:Cne,makeClipAdditive:Tne};class bA{constructor(e,t,n,r){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=r!==void 0?r:new t.constructor(n),this.sampleValues=t,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let n=this._cachedIndex,r=t[n],s=t[n-1];e:{t:{let o;n:{i:if(!(e<r)){for(let a=n+2;;){if(r===void 0){if(e<s)break i;return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}if(n===a)break;if(s=r,r=t[++n],e<r)break t}o=t.length;break n}if(!(e>=s)){const a=t[1];e<a&&(n=2,s=a);for(let l=n-2;;){if(s===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(n===l)break;if(r=s,s=t[--n-1],e>=s)break t}o=n,n=0;break n}break e}for(;n<o;){const a=n+o>>>1;e<t[a]?o=a:n=a+1}if(r=t[n],s=t[n-1],s===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(r===void 0)return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}this._cachedIndex=n,this.intervalChanged_(n,s,r)}return this.interpolate_(n,s,e,r)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,r=this.valueSize,s=e*r;for(let o=0;o!==r;++o)t[o]=n[s+o];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class gz extends bA{constructor(e,t,n,r){super(e,t,n,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:Mm,endingEnd:Mm}}intervalChanged_(e,t,n){const r=this.parameterPositions;let s=e-2,o=e+1,a=r[s],l=r[o];if(a===void 0)switch(this.getSettings_().endingStart){case Rm:s=e,a=2*t-n;break;case T2:s=r.length-2,a=t+r[s]-r[s+1];break;default:s=e,a=n}if(l===void 0)switch(this.getSettings_().endingEnd){case Rm:o=e,l=2*n-t;break;case T2:o=1,l=n+r[1]-r[0];break;default:o=e-1,l=t}const c=(n-t)*.5,u=this.valueSize;this._weightPrev=c/(t-a),this._weightNext=c/(l-n),this._offsetPrev=s*u,this._offsetNext=o*u}interpolate_(e,t,n,r){const s=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=e*a,c=l-a,u=this._offsetPrev,h=this._offsetNext,f=this._weightPrev,d=this._weightNext,m=(n-t)/(r-t),y=m*m,g=y*m,A=-f*g+2*f*y-f*m,E=(1+f)*g+(-1.5-2*f)*y+(-.5+f)*m+1,x=(-1-d)*g+(1.5+d)*y+.5*m,w=d*g-d*y;for(let T=0;T!==a;++T)s[T]=A*o[u+T]+E*o[c+T]+x*o[l+T]+w*o[h+T];return s}}class K6 extends bA{constructor(e,t,n,r){super(e,t,n,r)}interpolate_(e,t,n,r){const s=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=e*a,c=l-a,u=(n-t)/(r-t),h=1-u;for(let f=0;f!==a;++f)s[f]=o[c+f]*h+o[l+f]*u;return s}}class Az extends bA{constructor(e,t,n,r){super(e,t,n,r)}interpolate_(e){return this.copySampleValue_(e-1)}}class Pu{constructor(e,t,n,r){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(t===void 0||t.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=Bm(t,this.TimeBufferType),this.values=Bm(n,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let n;if(t.toJSON!==this.toJSON)n=t.toJSON(e);else{n={name:e.name,times:Bm(e.times,Array),values:Bm(e.values,Array)};const r=e.getInterpolation();r!==e.DefaultInterpolation&&(n.interpolation=r)}return n.type=e.ValueTypeName,n}InterpolantFactoryMethodDiscrete(e){return new Az(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new K6(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new gz(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case tA:t=this.InterpolantFactoryMethodDiscrete;break;case Zm:t=this.InterpolantFactoryMethodLinear;break;case j_:t=this.InterpolantFactoryMethodSmooth;break}if(t===void 0){const n="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(n);return console.warn("THREE.KeyframeTrack:",n),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return tA;case this.InterpolantFactoryMethodLinear:return Zm;case this.InterpolantFactoryMethodSmooth:return j_}}getValueSize(){return this.values.length/this.times.length}shift(e){if(e!==0){const t=this.times;for(let n=0,r=t.length;n!==r;++n)t[n]+=e}return this}scale(e){if(e!==1){const t=this.times;for(let n=0,r=t.length;n!==r;++n)t[n]*=e}return this}trim(e,t){const n=this.times,r=n.length;let s=0,o=r-1;for(;s!==r&&n[s]<e;)++s;for(;o!==-1&&n[o]>t;)--o;if(++o,s!==0||o!==r){s>=o&&(o=Math.max(o,1),s=o-1);const a=this.getValueSize();this.times=n.slice(s,o),this.values=this.values.slice(s*a,o*a)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const n=this.times,r=this.values,s=n.length;s===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let o=null;for(let a=0;a!==s;a++){const l=n[a];if(typeof l=="number"&&isNaN(l)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,a,l),e=!1;break}if(o!==null&&o>l){console.error("THREE.KeyframeTrack: Out of order keys.",this,a,l,o),e=!1;break}o=l}if(r!==void 0&&pz(r))for(let a=0,l=r.length;a!==l;++a){const c=r[a];if(isNaN(c)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,a,c),e=!1;break}}return e}optimize(){const e=this.times.slice(),t=this.values.slice(),n=this.getValueSize(),r=this.getInterpolation()===j_,s=e.length-1;let o=1;for(let a=1;a<s;++a){let l=!1;const c=e[a],u=e[a+1];if(c!==u&&(a!==1||c!==e[0]))if(r)l=!0;else{const h=a*n,f=h-n,d=h+n;for(let m=0;m!==n;++m){const y=t[h+m];if(y!==t[f+m]||y!==t[d+m]){l=!0;break}}}if(l){if(a!==o){e[o]=e[a];const h=a*n,f=o*n;for(let d=0;d!==n;++d)t[f+d]=t[h+d]}++o}}if(s>0){e[o]=e[s];for(let a=s*n,l=o*n,c=0;c!==n;++c)t[l+c]=t[a+c];++o}return o!==e.length?(this.times=e.slice(0,o),this.values=t.slice(0,o*n)):(this.times=e,this.values=t),this}clone(){const e=this.times.slice(),t=this.values.slice(),n=this.constructor,r=new n(this.name,e,t);return r.createInterpolant=this.createInterpolant,r}}Pu.prototype.TimeBufferType=Float32Array;Pu.prototype.ValueBufferType=Float32Array;Pu.prototype.DefaultInterpolation=Zm;class g0 extends Pu{}g0.prototype.ValueTypeName="bool";g0.prototype.ValueBufferType=Array;g0.prototype.DefaultInterpolation=tA;g0.prototype.InterpolantFactoryMethodLinear=void 0;g0.prototype.InterpolantFactoryMethodSmooth=void 0;class Y6 extends Pu{}Y6.prototype.ValueTypeName="color";class sp extends Pu{}sp.prototype.ValueTypeName="number";class yz extends bA{constructor(e,t,n,r){super(e,t,n,r)}interpolate_(e,t,n,r){const s=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=(n-t)/(r-t);let c=e*a;for(let u=c+a;c!==u;c+=4)Xt.slerpFlat(s,0,o,c-a,o,c,l);return s}}class vh extends Pu{InterpolantFactoryMethodLinear(e){return new yz(this.times,this.values,this.getValueSize(),e)}}vh.prototype.ValueTypeName="quaternion";vh.prototype.DefaultInterpolation=Zm;vh.prototype.InterpolantFactoryMethodSmooth=void 0;class A0 extends Pu{}A0.prototype.ValueTypeName="string";A0.prototype.ValueBufferType=Array;A0.prototype.DefaultInterpolation=tA;A0.prototype.InterpolantFactoryMethodLinear=void 0;A0.prototype.InterpolantFactoryMethodSmooth=void 0;class Of extends Pu{}Of.prototype.ValueTypeName="vector";class op{constructor(e,t=-1,n,r=Sw){this.name=e,this.tracks=n,this.duration=t,this.blendMode=r,this.uuid=Pl(),this.duration<0&&this.resetDuration()}static parse(e){const t=[],n=e.tracks,r=1/(e.fps||1);for(let o=0,a=n.length;o!==a;++o)t.push(Mne(n[o]).scale(r));const s=new this(e.name,e.duration,t,e.blendMode);return s.uuid=e.uuid,s}static toJSON(e){const t=[],n=e.tracks,r={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let s=0,o=n.length;s!==o;++s)t.push(Pu.toJSON(n[s]));return r}static CreateFromMorphTargetSequence(e,t,n,r){const s=t.length,o=[];for(let a=0;a<s;a++){let l=[],c=[];l.push((a+s-1)%s,a,(a+1)%s),c.push(0,1,0);const u=mz(l);l=kM(l,1,u),c=kM(c,1,u),!r&&l[0]===0&&(l.push(s),c.push(c[0])),o.push(new sp(".morphTargetInfluences["+t[a].name+"]",l,c).scale(1/n))}return new this(e,-1,o)}static findByName(e,t){let n=e;if(!Array.isArray(e)){const r=e;n=r.geometry&&r.geometry.animations||r.animations}for(let r=0;r<n.length;r++)if(n[r].name===t)return n[r];return null}static CreateClipsFromMorphTargetSequences(e,t,n){const r={},s=/^([\w-]*?)([\d]+)$/;for(let a=0,l=e.length;a<l;a++){const c=e[a],u=c.name.match(s);if(u&&u.length>1){const h=u[1];let f=r[h];f||(r[h]=f=[]),f.push(c)}}const o=[];for(const a in r)o.push(this.CreateFromMorphTargetSequence(a,r[a],t,n));return o}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const n=function(h,f,d,m,y){if(d.length!==0){const g=[],A=[];W6(d,g,A,m),g.length!==0&&y.push(new h(f,g,A))}},r=[],s=e.name||"default",o=e.fps||30,a=e.blendMode;let l=e.length||-1;const c=e.hierarchy||[];for(let h=0;h<c.length;h++){const f=c[h].keys;if(!(!f||f.length===0))if(f[0].morphTargets){const d={};let m;for(m=0;m<f.length;m++)if(f[m].morphTargets)for(let y=0;y<f[m].morphTargets.length;y++)d[f[m].morphTargets[y]]=-1;for(const y in d){const g=[],A=[];for(let E=0;E!==f[m].morphTargets.length;++E){const x=f[m];g.push(x.time),A.push(x.morphTarget===y?1:0)}r.push(new sp(".morphTargetInfluence["+y+"]",g,A))}l=d.length*o}else{const d=".bones["+t[h].name+"]";n(Of,d+".position",f,"pos",r),n(vh,d+".quaternion",f,"rot",r),n(Of,d+".scale",f,"scl",r)}}return r.length===0?null:new this(s,l,r,a)}resetDuration(){const e=this.tracks;let t=0;for(let n=0,r=e.length;n!==r;++n){const s=this.tracks[n];t=Math.max(t,s.times[s.times.length-1])}return this.duration=t,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function Ine(i){switch(i.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return sp;case"vector":case"vector2":case"vector3":case"vector4":return Of;case"color":return Y6;case"quaternion":return vh;case"bool":case"boolean":return g0;case"string":return A0}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+i)}function Mne(i){if(i.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=Ine(i.type);if(i.times===void 0){const t=[],n=[];W6(i.keys,t,n,"value"),i.times=t,i.values=n}return e.parse!==void 0?e.parse(i):new e(i.name,i.times,i.values,i.interpolation)}const Rf={enabled:!1,files:{},add:function(i,e){this.enabled!==!1&&(this.files[i]=e)},get:function(i){if(this.enabled!==!1)return this.files[i]},remove:function(i){delete this.files[i]},clear:function(){this.files={}}};class Ww{constructor(e,t,n){const r=this;let s=!1,o=0,a=0,l;const c=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=n,this.itemStart=function(u){a++,s===!1&&r.onStart!==void 0&&r.onStart(u,o,a),s=!0},this.itemEnd=function(u){o++,r.onProgress!==void 0&&r.onProgress(u,o,a),o===a&&(s=!1,r.onLoad!==void 0&&r.onLoad())},this.itemError=function(u){r.onError!==void 0&&r.onError(u)},this.resolveURL=function(u){return l?l(u):u},this.setURLModifier=function(u){return l=u,this},this.addHandler=function(u,h){return c.push(u,h),this},this.removeHandler=function(u){const h=c.indexOf(u);return h!==-1&&c.splice(h,2),this},this.getHandler=function(u){for(let h=0,f=c.length;h<f;h+=2){const d=c[h],m=c[h+1];if(d.global&&(d.lastIndex=0),d.test(u))return m}return null}}}const D1=new Ww;let os=class{constructor(e){this.manager=e!==void 0?e:D1,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const n=this;return new Promise(function(r,s){n.load(e,r,t,s)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}};os.DEFAULT_MATERIAL_NAME="__DEFAULT";const cf={};class Rne extends Error{constructor(e,t){super(e),this.response=t}}class Yr extends os{constructor(e){super(e)}load(e,t,n,r){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const s=Rf.get(e);if(s!==void 0)return this.manager.itemStart(e),setTimeout(()=>{t&&t(s),this.manager.itemEnd(e)},0),s;if(cf[e]!==void 0){cf[e].push({onLoad:t,onProgress:n,onError:r});return}cf[e]=[],cf[e].push({onLoad:t,onProgress:n,onError:r});const o=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),a=this.mimeType,l=this.responseType;fetch(o).then(c=>{if(c.status===200||c.status===0){if(c.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||c.body===void 0||c.body.getReader===void 0)return c;const u=cf[e],h=c.body.getReader(),f=c.headers.get("Content-Length")||c.headers.get("X-File-Size"),d=f?parseInt(f):0,m=d!==0;let y=0;const g=new ReadableStream({start(A){E();function E(){h.read().then(({done:x,value:w})=>{if(x)A.close();else{y+=w.byteLength;const T=new ProgressEvent("progress",{lengthComputable:m,loaded:y,total:d});for(let I=0,M=u.length;I<M;I++){const L=u[I];L.onProgress&&L.onProgress(T)}A.enqueue(w),E()}})}}});return new Response(g)}else throw new Rne(`fetch for "${c.url}" responded with ${c.status}: ${c.statusText}`,c)}).then(c=>{switch(l){case"arraybuffer":return c.arrayBuffer();case"blob":return c.blob();case"document":return c.text().then(u=>new DOMParser().parseFromString(u,a));case"json":return c.json();default:if(a===void 0)return c.text();{const h=/charset="?([^;"\s]*)"?/i.exec(a),f=h&&h[1]?h[1].toLowerCase():void 0,d=new TextDecoder(f);return c.arrayBuffer().then(m=>d.decode(m))}}}).then(c=>{Rf.add(e,c);const u=cf[e];delete cf[e];for(let h=0,f=u.length;h<f;h++){const d=u[h];d.onLoad&&d.onLoad(c)}}).catch(c=>{const u=cf[e];if(u===void 0)throw this.manager.itemError(e),c;delete cf[e];for(let h=0,f=u.length;h<f;h++){const d=u[h];d.onError&&d.onError(c)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class Pne extends os{constructor(e){super(e)}load(e,t,n,r){const s=this,o=new Yr(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(a){try{t(s.parse(JSON.parse(a)))}catch(l){r?r(l):console.error(l),s.manager.itemError(e)}},n,r)}parse(e){const t=[];for(let n=0;n<e.length;n++){const r=op.parse(e[n]);t.push(r)}return t}}class Lne extends os{constructor(e){super(e)}load(e,t,n,r){const s=this,o=[],a=new gp,l=new Yr(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(s.withCredentials);let c=0;function u(h){l.load(e[h],function(f){const d=s.parse(f,!0);o[h]={width:d.width,height:d.height,format:d.format,mipmaps:d.mipmaps},c+=1,c===6&&(d.mipmapCount===1&&(a.minFilter=Ln),a.image=o,a.format=d.format,a.needsUpdate=!0,t&&t(a))},n,r)}if(Array.isArray(e))for(let h=0,f=e.length;h<f;++h)u(h);else l.load(e,function(h){const f=s.parse(h,!0);if(f.isCubemap){const d=f.mipmaps.length/f.mipmapCount;for(let m=0;m<d;m++){o[m]={mipmaps:[]};for(let y=0;y<f.mipmapCount;y++)o[m].mipmaps.push(f.mipmaps[m*f.mipmapCount+y]),o[m].format=f.format,o[m].width=f.width,o[m].height=f.height}a.image=o}else a.image.width=f.width,a.image.height=f.height,a.mipmaps=f.mipmaps;f.mipmapCount===1&&(a.minFilter=Ln),a.format=f.format,a.needsUpdate=!0,t&&t(a)},n,r);return a}}class k2 extends os{constructor(e){super(e)}load(e,t,n,r){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const s=this,o=Rf.get(e);if(o!==void 0)return s.manager.itemStart(e),setTimeout(function(){t&&t(o),s.manager.itemEnd(e)},0),o;const a=P2("img");function l(){u(),Rf.add(e,this),t&&t(this),s.manager.itemEnd(e)}function c(h){u(),r&&r(h),s.manager.itemError(e),s.manager.itemEnd(e)}function u(){a.removeEventListener("load",l,!1),a.removeEventListener("error",c,!1)}return a.addEventListener("load",l,!1),a.addEventListener("error",c,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(a.crossOrigin=this.crossOrigin),s.manager.itemStart(e),a.src=e,a}}class Kw extends os{constructor(e){super(e)}load(e,t,n,r){const s=new ox;s.colorSpace=gs;const o=new k2(this.manager);o.setCrossOrigin(this.crossOrigin),o.setPath(this.path);let a=0;function l(c){o.load(e[c],function(u){s.images[c]=u,a++,a===6&&(s.needsUpdate=!0,t&&t(s))},void 0,r)}for(let c=0;c<e.length;++c)l(c);return s}}class $6 extends os{constructor(e){super(e)}load(e,t,n,r){const s=this,o=new Sa,a=new Yr(this.manager);return a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setPath(this.path),a.setWithCredentials(s.withCredentials),a.load(e,function(l){let c;try{c=s.parse(l)}catch(u){if(r!==void 0)r(u);else{console.error(u);return}}c.image!==void 0?o.image=c.image:c.data!==void 0&&(o.image.width=c.width,o.image.height=c.height,o.image.data=c.data),o.wrapS=c.wrapS!==void 0?c.wrapS:Wi,o.wrapT=c.wrapT!==void 0?c.wrapT:Wi,o.magFilter=c.magFilter!==void 0?c.magFilter:Ln,o.minFilter=c.minFilter!==void 0?c.minFilter:Ln,o.anisotropy=c.anisotropy!==void 0?c.anisotropy:1,c.colorSpace!==void 0?o.colorSpace=c.colorSpace:c.encoding!==void 0&&(o.encoding=c.encoding),c.flipY!==void 0&&(o.flipY=c.flipY),c.format!==void 0&&(o.format=c.format),c.type!==void 0&&(o.type=c.type),c.mipmaps!==void 0&&(o.mipmaps=c.mipmaps,o.minFilter=Bl),c.mipmapCount===1&&(o.minFilter=Ln),c.generateMipmaps!==void 0&&(o.generateMipmaps=c.generateMipmaps),o.needsUpdate=!0,t&&t(o,c)},n,r),o}}class xh extends os{constructor(e){super(e)}load(e,t,n,r){const s=new vi,o=new k2(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(e,function(a){s.image=a,s.needsUpdate=!0,t!==void 0&&t(s)},n,r),s}}class yp extends _n{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new ut(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,this.groundColor!==void 0&&(t.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(t.object.distance=this.distance),this.angle!==void 0&&(t.object.angle=this.angle),this.decay!==void 0&&(t.object.decay=this.decay),this.penumbra!==void 0&&(t.object.penumbra=this.penumbra),this.shadow!==void 0&&(t.object.shadow=this.shadow.toJSON()),t}}class vz extends yp{constructor(e,t,n){super(e,n),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(_n.DEFAULT_UP),this.updateMatrix(),this.groundColor=new ut(t)}copy(e,t){return super.copy(e,t),this.groundColor.copy(e.groundColor),this}}const ET=new Xe,AB=new Q,yB=new Q;class X6{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Ue(512,512),this.map=null,this.mapPass=null,this.matrix=new Xe,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new f0,this._frameExtents=new Ue(1,1),this._viewportCount=1,this._viewports=[new Rn(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,n=this.matrix;AB.setFromMatrixPosition(e.matrixWorld),t.position.copy(AB),yB.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(yB),t.updateMatrixWorld(),ET.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(ET),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(ET)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const e={};return this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}let Bne=class extends X6{constructor(){super(new jn(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){const t=this.camera,n=iA*2*e.angle*this.focus,r=this.mapSize.width/this.mapSize.height,s=e.distance||t.far;(n!==t.fov||r!==t.aspect||s!==t.far)&&(t.fov=n,t.aspect=r,t.far=s,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}},Yw=class extends yp{constructor(e,t,n=0,r=Math.PI/3,s=0,o=2){super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(_n.DEFAULT_UP),this.updateMatrix(),this.target=new _n,this.distance=n,this.angle=r,this.penumbra=s,this.decay=o,this.map=null,this.shadow=new Bne}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}};const vB=new Xe,Qy=new Q,_T=new Q;class Dne extends X6{constructor(){super(new jn(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new Ue(4,2),this._viewportCount=6,this._viewports=[new Rn(2,1,1,1),new Rn(0,1,1,1),new Rn(3,1,1,1),new Rn(1,1,1,1),new Rn(3,0,1,1),new Rn(1,0,1,1)],this._cubeDirections=[new Q(1,0,0),new Q(-1,0,0),new Q(0,0,1),new Q(0,0,-1),new Q(0,1,0),new Q(0,-1,0)],this._cubeUps=[new Q(0,1,0),new Q(0,1,0),new Q(0,1,0),new Q(0,1,0),new Q(0,0,1),new Q(0,0,-1)]}updateMatrices(e,t=0){const n=this.camera,r=this.matrix,s=e.distance||n.far;s!==n.far&&(n.far=s,n.updateProjectionMatrix()),Qy.setFromMatrixPosition(e.matrixWorld),n.position.copy(Qy),_T.copy(n.position),_T.add(this._cubeDirections[t]),n.up.copy(this._cubeUps[t]),n.lookAt(_T),n.updateMatrixWorld(),r.makeTranslation(-Qy.x,-Qy.y,-Qy.z),vB.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(vB)}}class F2 extends yp{constructor(e,t,n=0,r=2){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=n,this.decay=r,this.shadow=new Dne}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class kne extends X6{constructor(){super(new qi(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class $w extends yp{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(_n.DEFAULT_UP),this.updateMatrix(),this.target=new _n,this.shadow=new kne}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class q6 extends yp{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}}class xz extends yp{constructor(e,t,n=10,r=10){super(e,t),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=n,this.height=r}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}}class Ez{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new Q)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){const n=e.x,r=e.y,s=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.282095),t.addScaledVector(o[1],.488603*r),t.addScaledVector(o[2],.488603*s),t.addScaledVector(o[3],.488603*n),t.addScaledVector(o[4],1.092548*(n*r)),t.addScaledVector(o[5],1.092548*(r*s)),t.addScaledVector(o[6],.315392*(3*s*s-1)),t.addScaledVector(o[7],1.092548*(n*s)),t.addScaledVector(o[8],.546274*(n*n-r*r)),t}getIrradianceAt(e,t){const n=e.x,r=e.y,s=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.886227),t.addScaledVector(o[1],2*.511664*r),t.addScaledVector(o[2],2*.511664*s),t.addScaledVector(o[3],2*.511664*n),t.addScaledVector(o[4],2*.429043*n*r),t.addScaledVector(o[5],2*.429043*r*s),t.addScaledVector(o[6],.743125*s*s-.247708),t.addScaledVector(o[7],2*.429043*n*s),t.addScaledVector(o[8],.429043*(n*n-r*r)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let n=0;n<9;n++)this.coefficients[n].addScaledVector(e.coefficients[n],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let n=0;n<9;n++)this.coefficients[n].lerp(e.coefficients[n],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(e,t=0){const n=this.coefficients;for(let r=0;r<9;r++)n[r].fromArray(e,t+r*3);return this}toArray(e=[],t=0){const n=this.coefficients;for(let r=0;r<9;r++)n[r].toArray(e,t+r*3);return e}static getBasisAt(e,t){const n=e.x,r=e.y,s=e.z;t[0]=.282095,t[1]=.488603*r,t[2]=.488603*s,t[3]=.488603*n,t[4]=1.092548*n*r,t[5]=1.092548*r*s,t[6]=.315392*(3*s*s-1),t[7]=1.092548*n*s,t[8]=.546274*(n*n-r*r)}}class _z extends yp{constructor(e=new Ez,t=1){super(void 0,t),this.isLightProbe=!0,this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}}class Xw extends os{constructor(e){super(e),this.textures={}}load(e,t,n,r){const s=this,o=new Yr(s.manager);o.setPath(s.path),o.setRequestHeader(s.requestHeader),o.setWithCredentials(s.withCredentials),o.load(e,function(a){try{t(s.parse(JSON.parse(a)))}catch(l){r?r(l):console.error(l),s.manager.itemError(e)}},n,r)}parse(e){const t=this.textures;function n(s){return t[s]===void 0&&console.warn("THREE.MaterialLoader: Undefined texture",s),t[s]}const r=Xw.createMaterialFromType(e.type);if(e.uuid!==void 0&&(r.uuid=e.uuid),e.name!==void 0&&(r.name=e.name),e.color!==void 0&&r.color!==void 0&&r.color.setHex(e.color),e.roughness!==void 0&&(r.roughness=e.roughness),e.metalness!==void 0&&(r.metalness=e.metalness),e.sheen!==void 0&&(r.sheen=e.sheen),e.sheenColor!==void 0&&(r.sheenColor=new ut().setHex(e.sheenColor)),e.sheenRoughness!==void 0&&(r.sheenRoughness=e.sheenRoughness),e.emissive!==void 0&&r.emissive!==void 0&&r.emissive.setHex(e.emissive),e.specular!==void 0&&r.specular!==void 0&&r.specular.setHex(e.specular),e.specularIntensity!==void 0&&(r.specularIntensity=e.specularIntensity),e.specularColor!==void 0&&r.specularColor!==void 0&&r.specularColor.setHex(e.specularColor),e.shininess!==void 0&&(r.shininess=e.shininess),e.clearcoat!==void 0&&(r.clearcoat=e.clearcoat),e.clearcoatRoughness!==void 0&&(r.clearcoatRoughness=e.clearcoatRoughness),e.iridescence!==void 0&&(r.iridescence=e.iridescence),e.iridescenceIOR!==void 0&&(r.iridescenceIOR=e.iridescenceIOR),e.iridescenceThicknessRange!==void 0&&(r.iridescenceThicknessRange=e.iridescenceThicknessRange),e.transmission!==void 0&&(r.transmission=e.transmission),e.thickness!==void 0&&(r.thickness=e.thickness),e.attenuationDistance!==void 0&&(r.attenuationDistance=e.attenuationDistance),e.attenuationColor!==void 0&&r.attenuationColor!==void 0&&r.attenuationColor.setHex(e.attenuationColor),e.anisotropy!==void 0&&(r.anisotropy=e.anisotropy),e.anisotropyRotation!==void 0&&(r.anisotropyRotation=e.anisotropyRotation),e.fog!==void 0&&(r.fog=e.fog),e.flatShading!==void 0&&(r.flatShading=e.flatShading),e.blending!==void 0&&(r.blending=e.blending),e.combine!==void 0&&(r.combine=e.combine),e.side!==void 0&&(r.side=e.side),e.shadowSide!==void 0&&(r.shadowSide=e.shadowSide),e.opacity!==void 0&&(r.opacity=e.opacity),e.transparent!==void 0&&(r.transparent=e.transparent),e.alphaTest!==void 0&&(r.alphaTest=e.alphaTest),e.alphaHash!==void 0&&(r.alphaHash=e.alphaHash),e.depthFunc!==void 0&&(r.depthFunc=e.depthFunc),e.depthTest!==void 0&&(r.depthTest=e.depthTest),e.depthWrite!==void 0&&(r.depthWrite=e.depthWrite),e.colorWrite!==void 0&&(r.colorWrite=e.colorWrite),e.blendSrc!==void 0&&(r.blendSrc=e.blendSrc),e.blendDst!==void 0&&(r.blendDst=e.blendDst),e.blendEquation!==void 0&&(r.blendEquation=e.blendEquation),e.blendSrcAlpha!==void 0&&(r.blendSrcAlpha=e.blendSrcAlpha),e.blendDstAlpha!==void 0&&(r.blendDstAlpha=e.blendDstAlpha),e.blendEquationAlpha!==void 0&&(r.blendEquationAlpha=e.blendEquationAlpha),e.blendColor!==void 0&&r.blendColor!==void 0&&r.blendColor.setHex(e.blendColor),e.blendAlpha!==void 0&&(r.blendAlpha=e.blendAlpha),e.stencilWriteMask!==void 0&&(r.stencilWriteMask=e.stencilWriteMask),e.stencilFunc!==void 0&&(r.stencilFunc=e.stencilFunc),e.stencilRef!==void 0&&(r.stencilRef=e.stencilRef),e.stencilFuncMask!==void 0&&(r.stencilFuncMask=e.stencilFuncMask),e.stencilFail!==void 0&&(r.stencilFail=e.stencilFail),e.stencilZFail!==void 0&&(r.stencilZFail=e.stencilZFail),e.stencilZPass!==void 0&&(r.stencilZPass=e.stencilZPass),e.stencilWrite!==void 0&&(r.stencilWrite=e.stencilWrite),e.wireframe!==void 0&&(r.wireframe=e.wireframe),e.wireframeLinewidth!==void 0&&(r.wireframeLinewidth=e.wireframeLinewidth),e.wireframeLinecap!==void 0&&(r.wireframeLinecap=e.wireframeLinecap),e.wireframeLinejoin!==void 0&&(r.wireframeLinejoin=e.wireframeLinejoin),e.rotation!==void 0&&(r.rotation=e.rotation),e.linewidth!==void 0&&(r.linewidth=e.linewidth),e.dashSize!==void 0&&(r.dashSize=e.dashSize),e.gapSize!==void 0&&(r.gapSize=e.gapSize),e.scale!==void 0&&(r.scale=e.scale),e.polygonOffset!==void 0&&(r.polygonOffset=e.polygonOffset),e.polygonOffsetFactor!==void 0&&(r.polygonOffsetFactor=e.polygonOffsetFactor),e.polygonOffsetUnits!==void 0&&(r.polygonOffsetUnits=e.polygonOffsetUnits),e.dithering!==void 0&&(r.dithering=e.dithering),e.alphaToCoverage!==void 0&&(r.alphaToCoverage=e.alphaToCoverage),e.premultipliedAlpha!==void 0&&(r.premultipliedAlpha=e.premultipliedAlpha),e.forceSinglePass!==void 0&&(r.forceSinglePass=e.forceSinglePass),e.visible!==void 0&&(r.visible=e.visible),e.toneMapped!==void 0&&(r.toneMapped=e.toneMapped),e.userData!==void 0&&(r.userData=e.userData),e.vertexColors!==void 0&&(typeof e.vertexColors=="number"?r.vertexColors=e.vertexColors>0:r.vertexColors=e.vertexColors),e.uniforms!==void 0)for(const s in e.uniforms){const o=e.uniforms[s];switch(r.uniforms[s]={},o.type){case"t":r.uniforms[s].value=n(o.value);break;case"c":r.uniforms[s].value=new ut().setHex(o.value);break;case"v2":r.uniforms[s].value=new Ue().fromArray(o.value);break;case"v3":r.uniforms[s].value=new Q().fromArray(o.value);break;case"v4":r.uniforms[s].value=new Rn().fromArray(o.value);break;case"m3":r.uniforms[s].value=new Tn().fromArray(o.value);break;case"m4":r.uniforms[s].value=new Xe().fromArray(o.value);break;default:r.uniforms[s].value=o.value}}if(e.defines!==void 0&&(r.defines=e.defines),e.vertexShader!==void 0&&(r.vertexShader=e.vertexShader),e.fragmentShader!==void 0&&(r.fragmentShader=e.fragmentShader),e.glslVersion!==void 0&&(r.glslVersion=e.glslVersion),e.extensions!==void 0)for(const s in e.extensions)r.extensions[s]=e.extensions[s];if(e.lights!==void 0&&(r.lights=e.lights),e.clipping!==void 0&&(r.clipping=e.clipping),e.size!==void 0&&(r.size=e.size),e.sizeAttenuation!==void 0&&(r.sizeAttenuation=e.sizeAttenuation),e.map!==void 0&&(r.map=n(e.map)),e.matcap!==void 0&&(r.matcap=n(e.matcap)),e.alphaMap!==void 0&&(r.alphaMap=n(e.alphaMap)),e.bumpMap!==void 0&&(r.bumpMap=n(e.bumpMap)),e.bumpScale!==void 0&&(r.bumpScale=e.bumpScale),e.normalMap!==void 0&&(r.normalMap=n(e.normalMap)),e.normalMapType!==void 0&&(r.normalMapType=e.normalMapType),e.normalScale!==void 0){let s=e.normalScale;Array.isArray(s)===!1&&(s=[s,s]),r.normalScale=new Ue().fromArray(s)}return e.displacementMap!==void 0&&(r.displacementMap=n(e.displacementMap)),e.displacementScale!==void 0&&(r.displacementScale=e.displacementScale),e.displacementBias!==void 0&&(r.displacementBias=e.displacementBias),e.roughnessMap!==void 0&&(r.roughnessMap=n(e.roughnessMap)),e.metalnessMap!==void 0&&(r.metalnessMap=n(e.metalnessMap)),e.emissiveMap!==void 0&&(r.emissiveMap=n(e.emissiveMap)),e.emissiveIntensity!==void 0&&(r.emissiveIntensity=e.emissiveIntensity),e.specularMap!==void 0&&(r.specularMap=n(e.specularMap)),e.specularIntensityMap!==void 0&&(r.specularIntensityMap=n(e.specularIntensityMap)),e.specularColorMap!==void 0&&(r.specularColorMap=n(e.specularColorMap)),e.envMap!==void 0&&(r.envMap=n(e.envMap)),e.envMapIntensity!==void 0&&(r.envMapIntensity=e.envMapIntensity),e.reflectivity!==void 0&&(r.reflectivity=e.reflectivity),e.refractionRatio!==void 0&&(r.refractionRatio=e.refractionRatio),e.lightMap!==void 0&&(r.lightMap=n(e.lightMap)),e.lightMapIntensity!==void 0&&(r.lightMapIntensity=e.lightMapIntensity),e.aoMap!==void 0&&(r.aoMap=n(e.aoMap)),e.aoMapIntensity!==void 0&&(r.aoMapIntensity=e.aoMapIntensity),e.gradientMap!==void 0&&(r.gradientMap=n(e.gradientMap)),e.clearcoatMap!==void 0&&(r.clearcoatMap=n(e.clearcoatMap)),e.clearcoatRoughnessMap!==void 0&&(r.clearcoatRoughnessMap=n(e.clearcoatRoughnessMap)),e.clearcoatNormalMap!==void 0&&(r.clearcoatNormalMap=n(e.clearcoatNormalMap)),e.clearcoatNormalScale!==void 0&&(r.clearcoatNormalScale=new Ue().fromArray(e.clearcoatNormalScale)),e.iridescenceMap!==void 0&&(r.iridescenceMap=n(e.iridescenceMap)),e.iridescenceThicknessMap!==void 0&&(r.iridescenceThicknessMap=n(e.iridescenceThicknessMap)),e.transmissionMap!==void 0&&(r.transmissionMap=n(e.transmissionMap)),e.thicknessMap!==void 0&&(r.thicknessMap=n(e.thicknessMap)),e.anisotropyMap!==void 0&&(r.anisotropyMap=n(e.anisotropyMap)),e.sheenColorMap!==void 0&&(r.sheenColorMap=n(e.sheenColorMap)),e.sheenRoughnessMap!==void 0&&(r.sheenRoughnessMap=n(e.sheenRoughnessMap)),r}setTextures(e){return this.textures=e,this}static createMaterialFromType(e){const t={ShadowMaterial:cz,SpriteMaterial:P6,RawShaderMaterial:uz,ShaderMaterial:Mi,PointsMaterial:hx,MeshPhysicalMaterial:nl,MeshStandardMaterial:m0,MeshPhongMaterial:t2,MeshToonMaterial:hz,MeshNormalMaterial:j6,MeshLambertMaterial:mx,MeshDepthMaterial:ax,MeshDistanceMaterial:Rw,MeshBasicMaterial:no,MeshMatcapMaterial:fz,LineDashedMaterial:dz,LineBasicMaterial:vs,Material:Us};return new t[e]}}class Lf{static decodeText(e){if(typeof TextDecoder<"u")return new TextDecoder().decode(e);let t="";for(let n=0,r=e.length;n<r;n++)t+=String.fromCharCode(e[n]);try{return decodeURIComponent(escape(t))}catch{return t}}static extractUrlBase(e){const t=e.lastIndexOf("/");return t===-1?"./":e.slice(0,t+1)}static resolveURL(e,t){return typeof e!="string"||e===""?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}class gx extends fn{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}toJSON(){const e=super.toJSON();return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}class Sz extends os{constructor(e){super(e)}load(e,t,n,r){const s=this,o=new Yr(s.manager);o.setPath(s.path),o.setRequestHeader(s.requestHeader),o.setWithCredentials(s.withCredentials),o.load(e,function(a){try{t(s.parse(JSON.parse(a)))}catch(l){r?r(l):console.error(l),s.manager.itemError(e)}},n,r)}parse(e){const t={},n={};function r(d,m){if(t[m]!==void 0)return t[m];const g=d.interleavedBuffers[m],A=s(d,g.buffer),E=R1(g.type,A),x=new lx(E,g.stride);return x.uuid=g.uuid,t[m]=x,x}function s(d,m){if(n[m]!==void 0)return n[m];const g=d.arrayBuffers[m],A=new Uint32Array(g).buffer;return n[m]=A,A}const o=e.isInstancedBufferGeometry?new gx:new fn,a=e.data.index;if(a!==void 0){const d=R1(a.type,a.array);o.setIndex(new mn(d,1))}const l=e.data.attributes;for(const d in l){const m=l[d];let y;if(m.isInterleavedBufferAttribute){const g=r(e.data,m.data);y=new Ja(g,m.itemSize,m.offset,m.normalized)}else{const g=R1(m.type,m.array),A=m.isInstancedBufferAttribute?Su:mn;y=new A(g,m.itemSize,m.normalized)}m.name!==void 0&&(y.name=m.name),m.usage!==void 0&&y.setUsage(m.usage),o.setAttribute(d,y)}const c=e.data.morphAttributes;if(c)for(const d in c){const m=c[d],y=[];for(let g=0,A=m.length;g<A;g++){const E=m[g];let x;if(E.isInterleavedBufferAttribute){const w=r(e.data,E.data);x=new Ja(w,E.itemSize,E.offset,E.normalized)}else{const w=R1(E.type,E.array);x=new mn(w,E.itemSize,E.normalized)}E.name!==void 0&&(x.name=E.name),y.push(x)}o.morphAttributes[d]=y}e.data.morphTargetsRelative&&(o.morphTargetsRelative=!0);const h=e.data.groups||e.data.drawcalls||e.data.offsets;if(h!==void 0)for(let d=0,m=h.length;d!==m;++d){const y=h[d];o.addGroup(y.start,y.count,y.materialIndex)}const f=e.data.boundingSphere;if(f!==void 0){const d=new Q;f.center!==void 0&&d.fromArray(f.center),o.boundingSphere=new Bi(d,f.radius)}return e.name&&(o.name=e.name),e.userData&&(o.userData=e.userData),o}}class Fne extends os{constructor(e){super(e)}load(e,t,n,r){const s=this,o=this.path===""?Lf.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||o;const a=new Yr(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(l){let c=null;try{c=JSON.parse(l)}catch(h){r!==void 0&&r(h),console.error("THREE:ObjectLoader: Can't parse "+e+".",h.message);return}const u=c.metadata;if(u===void 0||u.type===void 0||u.type.toLowerCase()==="geometry"){r!==void 0&&r(new Error("THREE.ObjectLoader: Can't load "+e)),console.error("THREE.ObjectLoader: Can't load "+e);return}s.parse(c,t)},n,r)}async loadAsync(e,t){const n=this,r=this.path===""?Lf.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||r;const s=new Yr(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials);const o=await s.loadAsync(e,t),a=JSON.parse(o),l=a.metadata;if(l===void 0||l.type===void 0||l.type.toLowerCase()==="geometry")throw new Error("THREE.ObjectLoader: Can't load "+e);return await n.parseAsync(a)}parse(e,t){const n=this.parseAnimations(e.animations),r=this.parseShapes(e.shapes),s=this.parseGeometries(e.geometries,r),o=this.parseImages(e.images,function(){t!==void 0&&t(c)}),a=this.parseTextures(e.textures,o),l=this.parseMaterials(e.materials,a),c=this.parseObject(e.object,s,l,a,n),u=this.parseSkeletons(e.skeletons,c);if(this.bindSkeletons(c,u),t!==void 0){let h=!1;for(const f in o)if(o[f].data instanceof HTMLImageElement){h=!0;break}h===!1&&t(c)}return c}async parseAsync(e){const t=this.parseAnimations(e.animations),n=this.parseShapes(e.shapes),r=this.parseGeometries(e.geometries,n),s=await this.parseImagesAsync(e.images),o=this.parseTextures(e.textures,s),a=this.parseMaterials(e.materials,o),l=this.parseObject(e.object,r,a,o,t),c=this.parseSkeletons(e.skeletons,l);return this.bindSkeletons(l,c),l}parseShapes(e){const t={};if(e!==void 0)for(let n=0,r=e.length;n<r;n++){const s=new Pf().fromJSON(e[n]);t[s.uuid]=s}return t}parseSkeletons(e,t){const n={},r={};if(t.traverse(function(s){s.isBone&&(r[s.uuid]=s)}),e!==void 0)for(let s=0,o=e.length;s<o;s++){const a=new TA().fromJSON(e[s],r);n[a.uuid]=a}return n}parseGeometries(e,t){const n={};if(e!==void 0){const r=new Sz;for(let s=0,o=e.length;s<o;s++){let a;const l=e[s];switch(l.type){case"BufferGeometry":case"InstancedBufferGeometry":a=r.parse(l);break;default:l.type in gB?a=gB[l.type].fromJSON(l,t):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${l.type}"`)}a.uuid=l.uuid,l.name!==void 0&&(a.name=l.name),l.userData!==void 0&&(a.userData=l.userData),n[l.uuid]=a}}return n}parseMaterials(e,t){const n={},r={};if(e!==void 0){const s=new Xw;s.setTextures(t);for(let o=0,a=e.length;o<a;o++){const l=e[o];n[l.uuid]===void 0&&(n[l.uuid]=s.parse(l)),r[l.uuid]=n[l.uuid]}}return r}parseAnimations(e){const t={};if(e!==void 0)for(let n=0;n<e.length;n++){const r=e[n],s=op.parse(r);t[s.uuid]=s}return t}parseImages(e,t){const n=this,r={};let s;function o(l){return n.manager.itemStart(l),s.load(l,function(){n.manager.itemEnd(l)},void 0,function(){n.manager.itemError(l),n.manager.itemEnd(l)})}function a(l){if(typeof l=="string"){const c=l,u=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(c)?c:n.resourcePath+c;return o(u)}else return l.data?{data:R1(l.type,l.data),width:l.width,height:l.height}:null}if(e!==void 0&&e.length>0){const l=new Ww(t);s=new k2(l),s.setCrossOrigin(this.crossOrigin);for(let c=0,u=e.length;c<u;c++){const h=e[c],f=h.url;if(Array.isArray(f)){const d=[];for(let m=0,y=f.length;m<y;m++){const g=f[m],A=a(g);A!==null&&(A instanceof HTMLImageElement?d.push(A):d.push(new Sa(A.data,A.width,A.height)))}r[h.uuid]=new Pm(d)}else{const d=a(h.url);r[h.uuid]=new Pm(d)}}}return r}async parseImagesAsync(e){const t=this,n={};let r;async function s(o){if(typeof o=="string"){const a=o,l=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(a)?a:t.resourcePath+a;return await r.loadAsync(l)}else return o.data?{data:R1(o.type,o.data),width:o.width,height:o.height}:null}if(e!==void 0&&e.length>0){r=new k2(this.manager),r.setCrossOrigin(this.crossOrigin);for(let o=0,a=e.length;o<a;o++){const l=e[o],c=l.url;if(Array.isArray(c)){const u=[];for(let h=0,f=c.length;h<f;h++){const d=c[h],m=await s(d);m!==null&&(m instanceof HTMLImageElement?u.push(m):u.push(new Sa(m.data,m.width,m.height)))}n[l.uuid]=new Pm(u)}else{const u=await s(l.url);n[l.uuid]=new Pm(u)}}}return n}parseTextures(e,t){function n(s,o){return typeof s=="number"?s:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",s),o[s])}const r={};if(e!==void 0)for(let s=0,o=e.length;s<o;s++){const a=e[s];a.image===void 0&&console.warn('THREE.ObjectLoader: No "image" specified for',a.uuid),t[a.image]===void 0&&console.warn("THREE.ObjectLoader: Undefined image",a.image);const l=t[a.image],c=l.data;let u;Array.isArray(c)?(u=new ox,c.length===6&&(u.needsUpdate=!0)):(c&&c.data?u=new Sa:u=new vi,c&&(u.needsUpdate=!0)),u.source=l,u.uuid=a.uuid,a.name!==void 0&&(u.name=a.name),a.mapping!==void 0&&(u.mapping=n(a.mapping,One)),a.channel!==void 0&&(u.channel=a.channel),a.offset!==void 0&&u.offset.fromArray(a.offset),a.repeat!==void 0&&u.repeat.fromArray(a.repeat),a.center!==void 0&&u.center.fromArray(a.center),a.rotation!==void 0&&(u.rotation=a.rotation),a.wrap!==void 0&&(u.wrapS=n(a.wrap[0],xB),u.wrapT=n(a.wrap[1],xB)),a.format!==void 0&&(u.format=a.format),a.internalFormat!==void 0&&(u.internalFormat=a.internalFormat),a.type!==void 0&&(u.type=a.type),a.colorSpace!==void 0&&(u.colorSpace=a.colorSpace),a.encoding!==void 0&&(u.encoding=a.encoding),a.minFilter!==void 0&&(u.minFilter=n(a.minFilter,EB)),a.magFilter!==void 0&&(u.magFilter=n(a.magFilter,EB)),a.anisotropy!==void 0&&(u.anisotropy=a.anisotropy),a.flipY!==void 0&&(u.flipY=a.flipY),a.generateMipmaps!==void 0&&(u.generateMipmaps=a.generateMipmaps),a.premultiplyAlpha!==void 0&&(u.premultiplyAlpha=a.premultiplyAlpha),a.unpackAlignment!==void 0&&(u.unpackAlignment=a.unpackAlignment),a.compareFunction!==void 0&&(u.compareFunction=a.compareFunction),a.userData!==void 0&&(u.userData=a.userData),r[a.uuid]=u}return r}parseObject(e,t,n,r,s){let o;function a(f){return t[f]===void 0&&console.warn("THREE.ObjectLoader: Undefined geometry",f),t[f]}function l(f){if(f!==void 0){if(Array.isArray(f)){const d=[];for(let m=0,y=f.length;m<y;m++){const g=f[m];n[g]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",g),d.push(n[g])}return d}return n[f]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",f),n[f]}}function c(f){return r[f]===void 0&&console.warn("THREE.ObjectLoader: Undefined texture",f),r[f]}let u,h;switch(e.type){case"Scene":o=new Mu,e.background!==void 0&&(Number.isInteger(e.background)?o.background=new ut(e.background):o.background=c(e.background)),e.environment!==void 0&&(o.environment=c(e.environment)),e.fog!==void 0&&(e.fog.type==="Fog"?o.fog=new Bw(e.fog.color,e.fog.near,e.fog.far):e.fog.type==="FogExp2"&&(o.fog=new Lw(e.fog.color,e.fog.density)),e.fog.name!==""&&(o.fog.name=e.fog.name)),e.backgroundBlurriness!==void 0&&(o.backgroundBlurriness=e.backgroundBlurriness),e.backgroundIntensity!==void 0&&(o.backgroundIntensity=e.backgroundIntensity);break;case"PerspectiveCamera":o=new jn(e.fov,e.aspect,e.near,e.far),e.focus!==void 0&&(o.focus=e.focus),e.zoom!==void 0&&(o.zoom=e.zoom),e.filmGauge!==void 0&&(o.filmGauge=e.filmGauge),e.filmOffset!==void 0&&(o.filmOffset=e.filmOffset),e.view!==void 0&&(o.view=Object.assign({},e.view));break;case"OrthographicCamera":o=new qi(e.left,e.right,e.top,e.bottom,e.near,e.far),e.zoom!==void 0&&(o.zoom=e.zoom),e.view!==void 0&&(o.view=Object.assign({},e.view));break;case"AmbientLight":o=new q6(e.color,e.intensity);break;case"DirectionalLight":o=new $w(e.color,e.intensity);break;case"PointLight":o=new F2(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":o=new xz(e.color,e.intensity,e.width,e.height);break;case"SpotLight":o=new Yw(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":o=new vz(e.color,e.groundColor,e.intensity);break;case"LightProbe":o=new _z().fromJSON(e);break;case"SkinnedMesh":u=a(e.geometry),h=l(e.material),o=new cx(u,h),e.bindMode!==void 0&&(o.bindMode=e.bindMode),e.bindMatrix!==void 0&&o.bindMatrix.fromArray(e.bindMatrix),e.skeleton!==void 0&&(o.skeleton=e.skeleton);break;case"Mesh":u=a(e.geometry),h=l(e.material),o=new It(u,h);break;case"InstancedMesh":u=a(e.geometry),h=l(e.material);const f=e.count,d=e.instanceMatrix,m=e.instanceColor;o=new ux(u,h,f),o.instanceMatrix=new Su(new Float32Array(d.array),16),m!==void 0&&(o.instanceColor=new Su(new Float32Array(m.array),m.itemSize));break;case"BatchedMesh":u=a(e.geometry),h=l(e.material),o=new L6(e.maxGeometryCount,e.maxVertexCount,e.maxIndexCount,h),o.geometry=u,o.perObjectFrustumCulled=e.perObjectFrustumCulled,o.sortObjects=e.sortObjects,o._drawRanges=e.drawRanges,o._reservedRanges=e.reservedRanges,o._visibility=e.visibility,o._active=e.active,o._bounds=e.bounds.map(y=>{const g=new ti;g.min.fromArray(y.boxMin),g.max.fromArray(y.boxMax);const A=new Bi;return A.radius=y.sphereRadius,A.center.fromArray(y.sphereCenter),{boxInitialized:y.boxInitialized,box:g,sphereInitialized:y.sphereInitialized,sphere:A}}),o._maxGeometryCount=e.maxGeometryCount,o._maxVertexCount=e.maxVertexCount,o._maxIndexCount=e.maxIndexCount,o._geometryInitialized=e.geometryInitialized,o._geometryCount=e.geometryCount,o._matricesTexture=c(e.matricesTexture.uuid);break;case"LOD":o=new nz;break;case"Line":o=new $n(a(e.geometry),l(e.material));break;case"LineLoop":o=new B6(a(e.geometry),l(e.material));break;case"LineSegments":o=new Ru(a(e.geometry),l(e.material));break;case"PointCloud":case"Points":o=new D6(a(e.geometry),l(e.material));break;case"Sprite":o=new tz(l(e.material));break;case"Group":o=new xa;break;case"Bone":o=new sA;break;default:o=new _n}if(o.uuid=e.uuid,e.name!==void 0&&(o.name=e.name),e.matrix!==void 0?(o.matrix.fromArray(e.matrix),e.matrixAutoUpdate!==void 0&&(o.matrixAutoUpdate=e.matrixAutoUpdate),o.matrixAutoUpdate&&o.matrix.decompose(o.position,o.quaternion,o.scale)):(e.position!==void 0&&o.position.fromArray(e.position),e.rotation!==void 0&&o.rotation.fromArray(e.rotation),e.quaternion!==void 0&&o.quaternion.fromArray(e.quaternion),e.scale!==void 0&&o.scale.fromArray(e.scale)),e.up!==void 0&&o.up.fromArray(e.up),e.castShadow!==void 0&&(o.castShadow=e.castShadow),e.receiveShadow!==void 0&&(o.receiveShadow=e.receiveShadow),e.shadow&&(e.shadow.bias!==void 0&&(o.shadow.bias=e.shadow.bias),e.shadow.normalBias!==void 0&&(o.shadow.normalBias=e.shadow.normalBias),e.shadow.radius!==void 0&&(o.shadow.radius=e.shadow.radius),e.shadow.mapSize!==void 0&&o.shadow.mapSize.fromArray(e.shadow.mapSize),e.shadow.camera!==void 0&&(o.shadow.camera=this.parseObject(e.shadow.camera))),e.visible!==void 0&&(o.visible=e.visible),e.frustumCulled!==void 0&&(o.frustumCulled=e.frustumCulled),e.renderOrder!==void 0&&(o.renderOrder=e.renderOrder),e.userData!==void 0&&(o.userData=e.userData),e.layers!==void 0&&(o.layers.mask=e.layers),e.children!==void 0){const f=e.children;for(let d=0;d<f.length;d++)o.add(this.parseObject(f[d],t,n,r,s))}if(e.animations!==void 0){const f=e.animations;for(let d=0;d<f.length;d++){const m=f[d];o.animations.push(s[m])}}if(e.type==="LOD"){e.autoUpdate!==void 0&&(o.autoUpdate=e.autoUpdate);const f=e.levels;for(let d=0;d<f.length;d++){const m=f[d],y=o.getObjectByProperty("uuid",m.object);y!==void 0&&o.addLevel(y,m.distance,m.hysteresis)}}return o}bindSkeletons(e,t){Object.keys(t).length!==0&&e.traverse(function(n){if(n.isSkinnedMesh===!0&&n.skeleton!==void 0){const r=t[n.skeleton];r===void 0?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",n.skeleton):n.bind(r,n.bindMatrix)}})}}const One={UVMapping:np,CubeReflectionMapping:_u,CubeRefractionMapping:ip,EquirectangularReflectionMapping:Xm,EquirectangularRefractionMapping:_2,CubeUVReflectionMapping:SA},xB={RepeatWrapping:_o,ClampToEdgeWrapping:Wi,MirroredRepeatWrapping:eA},EB={NearestFilter:zn,NearestMipmapNearestFilter:S2,NearestMipmapLinearFilter:z1,LinearFilter:Ln,LinearMipmapNearestFilter:vw,LinearMipmapLinearFilter:Bl};class wz extends os{constructor(e){super(e),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,t,n,r){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const s=this,o=Rf.get(e);if(o!==void 0){if(s.manager.itemStart(e),o.then){o.then(c=>{t&&t(c),s.manager.itemEnd(e)}).catch(c=>{r&&r(c)});return}return setTimeout(function(){t&&t(o),s.manager.itemEnd(e)},0),o}const a={};a.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",a.headers=this.requestHeader;const l=fetch(e,a).then(function(c){return c.blob()}).then(function(c){return createImageBitmap(c,Object.assign(s.options,{colorSpaceConversion:"none"}))}).then(function(c){return Rf.add(e,c),t&&t(c),s.manager.itemEnd(e),c}).catch(function(c){r&&r(c),Rf.remove(e),s.manager.itemError(e),s.manager.itemEnd(e)});Rf.add(e,l),s.manager.itemStart(e)}}let mE;class J6{static getContext(){return mE===void 0&&(mE=new(window.AudioContext||window.webkitAudioContext)),mE}static setContext(e){mE=e}}class Cz extends os{constructor(e){super(e)}load(e,t,n,r){const s=this,o=new Yr(this.manager);o.setResponseType("arraybuffer"),o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(l){try{const c=l.slice(0);J6.getContext().decodeAudioData(c,function(h){t(h)}).catch(a)}catch(c){a(c)}},n,r);function a(l){r?r(l):console.error(l),s.manager.itemError(e)}}}const _B=new Xe,SB=new Xe,am=new Xe;class Nne{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new jn,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new jn,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(e){const t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep,am.copy(e.projectionMatrix);const r=t.eyeSep/2,s=r*t.near/t.focus,o=t.near*Math.tan(zm*t.fov*.5)/t.zoom;let a,l;SB.elements[12]=-r,_B.elements[12]=r,a=-o*t.aspect+s,l=o*t.aspect+s,am.elements[0]=2*t.near/(l-a),am.elements[8]=(l+a)/(l-a),this.cameraL.projectionMatrix.copy(am),a=-o*t.aspect-s,l=o*t.aspect-s,am.elements[0]=2*t.near/(l-a),am.elements[8]=(l+a)/(l-a),this.cameraR.projectionMatrix.copy(am)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(SB),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(_B)}}class qw{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=wB(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=wB();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}function wB(){return(typeof performance>"u"?Date:performance).now()}const lm=new Q,CB=new Xt,Une=new Q,cm=new Q;class Tz extends _n{constructor(){super(),this.type="AudioListener",this.context=J6.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new qw}getInput(){return this.gain}removeFilter(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(e){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}updateMatrixWorld(e){super.updateMatrixWorld(e);const t=this.context.listener,n=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(lm,CB,Une),cm.set(0,0,-1).applyQuaternion(CB),t.positionX){const r=this.context.currentTime+this.timeDelta;t.positionX.linearRampToValueAtTime(lm.x,r),t.positionY.linearRampToValueAtTime(lm.y,r),t.positionZ.linearRampToValueAtTime(lm.z,r),t.forwardX.linearRampToValueAtTime(cm.x,r),t.forwardY.linearRampToValueAtTime(cm.y,r),t.forwardZ.linearRampToValueAtTime(cm.z,r),t.upX.linearRampToValueAtTime(n.x,r),t.upY.linearRampToValueAtTime(n.y,r),t.upZ.linearRampToValueAtTime(n.z,r)}else t.setPosition(lm.x,lm.y,lm.z),t.setOrientation(cm.x,cm.y,cm.z,n.x,n.y,n.z)}}class bz extends _n{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(this.isPlaying===!0){console.warn("THREE.Audio: Audio is already playing.");return}if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}this._startedAt=this.context.currentTime+e;const t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this}stop(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this._progress=0,this.source!==null&&(this.source.stop(),this.source.onended=null),this.isPlaying=!1,this}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this._connected!==!1){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}}getFilters(){return this.filters}setFilters(e){return e||(e=[]),this._connected===!0?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){if(this.detune=e,this.source.detune!==void 0)return this.isPlaying===!0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.playbackRate=e,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.loop=e,this.isPlaying===!0&&(this.source.loop=this.loop),this}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}}const um=new Q,TB=new Xt,zne=new Q,hm=new Q;let Gne=class extends bz{constructor(e){super(e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}connect(){super.connect(),this.panner.connect(this.gain)}disconnect(){super.disconnect(),this.panner.disconnect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(e){return this.panner.refDistance=e,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(e){return this.panner.rolloffFactor=e,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(e){return this.panner.distanceModel=e,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(e){return this.panner.maxDistance=e,this}setDirectionalCone(e,t,n){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=n,this}updateMatrixWorld(e){if(super.updateMatrixWorld(e),this.hasPlaybackControl===!0&&this.isPlaying===!1)return;this.matrixWorld.decompose(um,TB,zne),hm.set(0,0,1).applyQuaternion(TB);const t=this.panner;if(t.positionX){const n=this.context.currentTime+this.listener.timeDelta;t.positionX.linearRampToValueAtTime(um.x,n),t.positionY.linearRampToValueAtTime(um.y,n),t.positionZ.linearRampToValueAtTime(um.z,n),t.orientationX.linearRampToValueAtTime(hm.x,n),t.orientationY.linearRampToValueAtTime(hm.y,n),t.orientationZ.linearRampToValueAtTime(hm.z,n)}else t.setPosition(um.x,um.y,um.z),t.setOrientation(hm.x,hm.y,hm.z)}};class Hne{constructor(e,t=2048){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=t,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let e=0;const t=this.getFrequencyData();for(let n=0;n<t.length;n++)e+=t[n];return e/t.length}}class Iz{constructor(e,t,n){this.binding=e,this.valueSize=n;let r,s,o;switch(t){case"quaternion":r=this._slerp,s=this._slerpAdditive,o=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(n*6),this._workIndex=5;break;case"string":case"bool":r=this._select,s=this._select,o=this._setAdditiveIdentityOther,this.buffer=new Array(n*5);break;default:r=this._lerp,s=this._lerpAdditive,o=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(n*5)}this._mixBufferRegion=r,this._mixBufferRegionAdditive=s,this._setIdentity=o,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){const n=this.buffer,r=this.valueSize,s=e*r+r;let o=this.cumulativeWeight;if(o===0){for(let a=0;a!==r;++a)n[s+a]=n[a];o=t}else{o+=t;const a=t/o;this._mixBufferRegion(n,s,0,a,r)}this.cumulativeWeight=o}accumulateAdditive(e){const t=this.buffer,n=this.valueSize,r=n*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(t,r,0,e,n),this.cumulativeWeightAdditive+=e}apply(e){const t=this.valueSize,n=this.buffer,r=e*t+t,s=this.cumulativeWeight,o=this.cumulativeWeightAdditive,a=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,s<1){const l=t*this._origIndex;this._mixBufferRegion(n,r,l,1-s,t)}o>0&&this._mixBufferRegionAdditive(n,r,this._addIndex*t,1,t);for(let l=t,c=t+t;l!==c;++l)if(n[l]!==n[l+t]){a.setValue(n,r);break}}saveOriginalState(){const e=this.binding,t=this.buffer,n=this.valueSize,r=n*this._origIndex;e.getValue(t,r);for(let s=n,o=r;s!==o;++s)t[s]=t[r+s%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const e=this.valueSize*3;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let n=e;n<t;n++)this.buffer[n]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let n=0;n<this.valueSize;n++)this.buffer[t+n]=this.buffer[e+n]}_select(e,t,n,r,s){if(r>=.5)for(let o=0;o!==s;++o)e[t+o]=e[n+o]}_slerp(e,t,n,r){Xt.slerpFlat(e,t,e,t,e,n,r)}_slerpAdditive(e,t,n,r,s){const o=this._workIndex*s;Xt.multiplyQuaternionsFlat(e,o,e,t,e,n),Xt.slerpFlat(e,t,e,t,e,o,r)}_lerp(e,t,n,r,s){const o=1-r;for(let a=0;a!==s;++a){const l=t+a;e[l]=e[l]*o+e[n+a]*r}}_lerpAdditive(e,t,n,r,s){for(let o=0;o!==s;++o){const a=t+o;e[a]=e[a]+e[n+o]*r}}}const Z6="\\[\\]\\.:\\/",Qne=new RegExp("["+Z6+"]","g"),eR="[^"+Z6+"]",Vne="[^"+Z6.replace("\\.","")+"]",jne=/((?:WC+[\/:])*)/.source.replace("WC",eR),Wne=/(WCOD+)?/.source.replace("WCOD",Vne),Kne=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",eR),Yne=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",eR),$ne=new RegExp("^"+jne+Wne+Kne+Yne+"$"),Xne=["material","materials","bones","map"];class qne{constructor(e,t,n){const r=n||li.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,r)}getValue(e,t){this.bind();const n=this._targetGroup.nCachedObjects_,r=this._bindings[n];r!==void 0&&r.getValue(e,t)}setValue(e,t){const n=this._bindings;for(let r=this._targetGroup.nCachedObjects_,s=n.length;r!==s;++r)n[r].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].unbind()}}class li{constructor(e,t,n){this.path=t,this.parsedPath=n||li.parseTrackName(t),this.node=li.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,n){return e&&e.isAnimationObjectGroup?new li.Composite(e,t,n):new li(e,t,n)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(Qne,"")}static parseTrackName(e){const t=$ne.exec(e);if(t===null)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const n={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},r=n.nodeName&&n.nodeName.lastIndexOf(".");if(r!==void 0&&r!==-1){const s=n.nodeName.substring(r+1);Xne.indexOf(s)!==-1&&(n.nodeName=n.nodeName.substring(0,r),n.objectName=s)}if(n.propertyName===null||n.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n}static findNode(e,t){if(t===void 0||t===""||t==="."||t===-1||t===e.name||t===e.uuid)return e;if(e.skeleton){const n=e.skeleton.getBoneByName(t);if(n!==void 0)return n}if(e.children){const n=function(s){for(let o=0;o<s.length;o++){const a=s[o];if(a.name===t||a.uuid===t)return a;const l=n(a.children);if(l)return l}return null},r=n(e.children);if(r)return r}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){const n=this.resolvedProperty;for(let r=0,s=n.length;r!==s;++r)e[t++]=n[r]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const n=this.resolvedProperty;for(let r=0,s=n.length;r!==s;++r)n[r]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const n=this.resolvedProperty;for(let r=0,s=n.length;r!==s;++r)n[r]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const n=this.resolvedProperty;for(let r=0,s=n.length;r!==s;++r)n[r]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,n=t.objectName,r=t.propertyName;let s=t.propertyIndex;if(e||(e=li.findNode(this.rootNode,t.nodeName),this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");return}if(n){let c=t.objectIndex;switch(n){case"materials":if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(let u=0;u<e.length;u++)if(e[u].name===c){c=u;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}e=e.material.map;break;default:if(e[n]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[n]}if(c!==void 0){if(e[c]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[c]}}const o=e[r];if(o===void 0){const c=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+c+"."+r+" but it wasn't found.",e);return}let a=this.Versioning.None;this.targetObject=e,e.needsUpdate!==void 0?a=this.Versioning.NeedsUpdate:e.matrixWorldNeedsUpdate!==void 0&&(a=this.Versioning.MatrixWorldNeedsUpdate);let l=this.BindingType.Direct;if(s!==void 0){if(r==="morphTargetInfluences"){if(!e.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!e.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}e.morphTargetDictionary[s]!==void 0&&(s=e.morphTargetDictionary[s])}l=this.BindingType.ArrayElement,this.resolvedProperty=o,this.propertyIndex=s}else o.fromArray!==void 0&&o.toArray!==void 0?(l=this.BindingType.HasFromToArray,this.resolvedProperty=o):Array.isArray(o)?(l=this.BindingType.EntireArray,this.resolvedProperty=o):this.propertyName=r;this.getValue=this.GetterByBindingType[l],this.setValue=this.SetterByBindingTypeAndVersioning[l][a]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}li.Composite=qne;li.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};li.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};li.prototype.GetterByBindingType=[li.prototype._getValue_direct,li.prototype._getValue_array,li.prototype._getValue_arrayElement,li.prototype._getValue_toArray];li.prototype.SetterByBindingTypeAndVersioning=[[li.prototype._setValue_direct,li.prototype._setValue_direct_setNeedsUpdate,li.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[li.prototype._setValue_array,li.prototype._setValue_array_setNeedsUpdate,li.prototype._setValue_array_setMatrixWorldNeedsUpdate],[li.prototype._setValue_arrayElement,li.prototype._setValue_arrayElement_setNeedsUpdate,li.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[li.prototype._setValue_fromArray,li.prototype._setValue_fromArray_setNeedsUpdate,li.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class Jne{constructor(){this.isAnimationObjectGroup=!0,this.uuid=Pl(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const e={};this._indicesByUUID=e;for(let n=0,r=arguments.length;n!==r;++n)e[arguments[n].uuid]=n;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const t=this;this.stats={objects:{get total(){return t._objects.length},get inUse(){return this.total-t.nCachedObjects_}},get bindingsPerObject(){return t._bindings.length}}}add(){const e=this._objects,t=this._indicesByUUID,n=this._paths,r=this._parsedPaths,s=this._bindings,o=s.length;let a,l=e.length,c=this.nCachedObjects_;for(let u=0,h=arguments.length;u!==h;++u){const f=arguments[u],d=f.uuid;let m=t[d];if(m===void 0){m=l++,t[d]=m,e.push(f);for(let y=0,g=o;y!==g;++y)s[y].push(new li(f,n[y],r[y]))}else if(m<c){a=e[m];const y=--c,g=e[y];t[g.uuid]=m,e[m]=g,t[d]=y,e[y]=f;for(let A=0,E=o;A!==E;++A){const x=s[A],w=x[y];let T=x[m];x[m]=w,T===void 0&&(T=new li(f,n[A],r[A])),x[y]=T}}else e[m]!==a&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=c}remove(){const e=this._objects,t=this._indicesByUUID,n=this._bindings,r=n.length;let s=this.nCachedObjects_;for(let o=0,a=arguments.length;o!==a;++o){const l=arguments[o],c=l.uuid,u=t[c];if(u!==void 0&&u>=s){const h=s++,f=e[h];t[f.uuid]=u,e[u]=f,t[c]=h,e[h]=l;for(let d=0,m=r;d!==m;++d){const y=n[d],g=y[h],A=y[u];y[u]=g,y[h]=A}}}this.nCachedObjects_=s}uncache(){const e=this._objects,t=this._indicesByUUID,n=this._bindings,r=n.length;let s=this.nCachedObjects_,o=e.length;for(let a=0,l=arguments.length;a!==l;++a){const c=arguments[a],u=c.uuid,h=t[u];if(h!==void 0)if(delete t[u],h<s){const f=--s,d=e[f],m=--o,y=e[m];t[d.uuid]=h,e[h]=d,t[y.uuid]=f,e[f]=y,e.pop();for(let g=0,A=r;g!==A;++g){const E=n[g],x=E[f],w=E[m];E[h]=x,E[f]=w,E.pop()}}else{const f=--o,d=e[f];f>0&&(t[d.uuid]=h),e[h]=d,e.pop();for(let m=0,y=r;m!==y;++m){const g=n[m];g[h]=g[f],g.pop()}}}this.nCachedObjects_=s}subscribe_(e,t){const n=this._bindingsIndicesByPath;let r=n[e];const s=this._bindings;if(r!==void 0)return s[r];const o=this._paths,a=this._parsedPaths,l=this._objects,c=l.length,u=this.nCachedObjects_,h=new Array(c);r=s.length,n[e]=r,o.push(e),a.push(t),s.push(h);for(let f=u,d=l.length;f!==d;++f){const m=l[f];h[f]=new li(m,e,t)}return h}unsubscribe_(e){const t=this._bindingsIndicesByPath,n=t[e];if(n!==void 0){const r=this._paths,s=this._parsedPaths,o=this._bindings,a=o.length-1,l=o[a],c=e[a];t[c]=n,o[n]=l,o.pop(),s[n]=s[a],s.pop(),r[n]=r[a],r.pop()}}}class Mz{constructor(e,t,n=null,r=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=n,this.blendMode=r;const s=t.tracks,o=s.length,a=new Array(o),l={endingStart:Mm,endingEnd:Mm};for(let c=0;c!==o;++c){const u=s[c].createInterpolant(null);a[c]=u,u.settings=l}this._interpolantSettings=l,this._interpolants=a,this._propertyBindings=new Array(o),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=TU,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,n){if(e.fadeOut(t),this.fadeIn(t),n){const r=this._clip.duration,s=e._clip.duration,o=s/r,a=r/s;e.warp(1,o,t),this.warp(a,1,t)}return this}crossFadeTo(e,t,n){return e.crossFadeFrom(this,t,n)}stopFading(){const e=this._weightInterpolant;return e!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,n){const r=this._mixer,s=r.time,o=this.timeScale;let a=this._timeScaleInterpolant;a===null&&(a=r._lendControlInterpolant(),this._timeScaleInterpolant=a);const l=a.parameterPositions,c=a.sampleValues;return l[0]=s,l[1]=s+n,c[0]=e/o,c[1]=t/o,this}stopWarping(){const e=this._timeScaleInterpolant;return e!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,n,r){if(!this.enabled){this._updateWeight(e);return}const s=this._startTime;if(s!==null){const l=(e-s)*n;l<0||n===0?t=0:(this._startTime=null,t=n*l)}t*=this._updateTimeScale(e);const o=this._updateTime(t),a=this._updateWeight(e);if(a>0){const l=this._interpolants,c=this._propertyBindings;switch(this.blendMode){case _6:for(let u=0,h=l.length;u!==h;++u)l[u].evaluate(o),c[u].accumulateAdditive(a);break;case Sw:default:for(let u=0,h=l.length;u!==h;++u)l[u].evaluate(o),c[u].accumulate(r,a)}}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;const n=this._weightInterpolant;if(n!==null){const r=n.evaluate(e)[0];t*=r,e>n.parameterPositions[1]&&(this.stopFading(),r===0&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;const n=this._timeScaleInterpolant;if(n!==null){const r=n.evaluate(e)[0];t*=r,e>n.parameterPositions[1]&&(this.stopWarping(),t===0?this.paused=!0:this.timeScale=t)}}return this._effectiveTimeScale=t,t}_updateTime(e){const t=this._clip.duration,n=this.loop;let r=this.time+e,s=this._loopCount;const o=n===bU;if(e===0)return s===-1?r:o&&(s&1)===1?t-r:r;if(n===CU){s===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(r>=t)r=t;else if(r<0)r=0;else{this.time=r;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(s===-1&&(e>=0?(s=0,this._setEndings(!0,this.repetitions===0,o)):this._setEndings(this.repetitions===0,!0,o)),r>=t||r<0){const a=Math.floor(r/t);r-=t*a,s+=Math.abs(a);const l=this.repetitions-s;if(l<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,r=e>0?t:0,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(l===1){const c=e<0;this._setEndings(c,!c,o)}else this._setEndings(!1,!1,o);this._loopCount=s,this.time=r,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:a})}}else this.time=r;if(o&&(s&1)===1)return t-r}return r}_setEndings(e,t,n){const r=this._interpolantSettings;n?(r.endingStart=Rm,r.endingEnd=Rm):(e?r.endingStart=this.zeroSlopeAtStart?Rm:Mm:r.endingStart=T2,t?r.endingEnd=this.zeroSlopeAtEnd?Rm:Mm:r.endingEnd=T2)}_scheduleFading(e,t,n){const r=this._mixer,s=r.time;let o=this._weightInterpolant;o===null&&(o=r._lendControlInterpolant(),this._weightInterpolant=o);const a=o.parameterPositions,l=o.sampleValues;return a[0]=s,l[0]=t,a[1]=s+e,l[1]=n,this}}const Zne=new Float32Array(1);class tR extends Ch{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){const n=e._localRoot||this._root,r=e._clip.tracks,s=r.length,o=e._propertyBindings,a=e._interpolants,l=n.uuid,c=this._bindingsByRootAndName;let u=c[l];u===void 0&&(u={},c[l]=u);for(let h=0;h!==s;++h){const f=r[h],d=f.name;let m=u[d];if(m!==void 0)++m.referenceCount,o[h]=m;else{if(m=o[h],m!==void 0){m._cacheIndex===null&&(++m.referenceCount,this._addInactiveBinding(m,l,d));continue}const y=t&&t._propertyBindings[h].binding.parsedPath;m=new Iz(li.create(n,d,y),f.ValueTypeName,f.getValueSize()),++m.referenceCount,this._addInactiveBinding(m,l,d),o[h]=m}a[h].resultBuffer=m.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(e._cacheIndex===null){const n=(e._localRoot||this._root).uuid,r=e._clip.uuid,s=this._actionsByClip[r];this._bindAction(e,s&&s.knownActions[0]),this._addInactiveAction(e,r,n)}const t=e._propertyBindings;for(let n=0,r=t.length;n!==r;++n){const s=t[n];s.useCount++===0&&(this._lendBinding(s),s.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const t=e._propertyBindings;for(let n=0,r=t.length;n!==r;++n){const s=t[n];--s.useCount===0&&(s.restoreOriginalState(),this._takeBackBinding(s))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const t=e._cacheIndex;return t!==null&&t<this._nActiveActions}_addInactiveAction(e,t,n){const r=this._actions,s=this._actionsByClip;let o=s[t];if(o===void 0)o={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,s[t]=o;else{const a=o.knownActions;e._byClipCacheIndex=a.length,a.push(e)}e._cacheIndex=r.length,r.push(e),o.actionByRoot[n]=e}_removeInactiveAction(e){const t=this._actions,n=t[t.length-1],r=e._cacheIndex;n._cacheIndex=r,t[r]=n,t.pop(),e._cacheIndex=null;const s=e._clip.uuid,o=this._actionsByClip,a=o[s],l=a.knownActions,c=l[l.length-1],u=e._byClipCacheIndex;c._byClipCacheIndex=u,l[u]=c,l.pop(),e._byClipCacheIndex=null;const h=a.actionByRoot,f=(e._localRoot||this._root).uuid;delete h[f],l.length===0&&delete o[s],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const t=e._propertyBindings;for(let n=0,r=t.length;n!==r;++n){const s=t[n];--s.referenceCount===0&&this._removeInactiveBinding(s)}}_lendAction(e){const t=this._actions,n=e._cacheIndex,r=this._nActiveActions++,s=t[r];e._cacheIndex=r,t[r]=e,s._cacheIndex=n,t[n]=s}_takeBackAction(e){const t=this._actions,n=e._cacheIndex,r=--this._nActiveActions,s=t[r];e._cacheIndex=r,t[r]=e,s._cacheIndex=n,t[n]=s}_addInactiveBinding(e,t,n){const r=this._bindingsByRootAndName,s=this._bindings;let o=r[t];o===void 0&&(o={},r[t]=o),o[n]=e,e._cacheIndex=s.length,s.push(e)}_removeInactiveBinding(e){const t=this._bindings,n=e.binding,r=n.rootNode.uuid,s=n.path,o=this._bindingsByRootAndName,a=o[r],l=t[t.length-1],c=e._cacheIndex;l._cacheIndex=c,t[c]=l,t.pop(),delete a[s],Object.keys(a).length===0&&delete o[r]}_lendBinding(e){const t=this._bindings,n=e._cacheIndex,r=this._nActiveBindings++,s=t[r];e._cacheIndex=r,t[r]=e,s._cacheIndex=n,t[n]=s}_takeBackBinding(e){const t=this._bindings,n=e._cacheIndex,r=--this._nActiveBindings,s=t[r];e._cacheIndex=r,t[r]=e,s._cacheIndex=n,t[n]=s}_lendControlInterpolant(){const e=this._controlInterpolants,t=this._nActiveControlInterpolants++;let n=e[t];return n===void 0&&(n=new K6(new Float32Array(2),new Float32Array(2),1,Zne),n.__cacheIndex=t,e[t]=n),n}_takeBackControlInterpolant(e){const t=this._controlInterpolants,n=e.__cacheIndex,r=--this._nActiveControlInterpolants,s=t[r];e.__cacheIndex=r,t[r]=e,s.__cacheIndex=n,t[n]=s}clipAction(e,t,n){const r=t||this._root,s=r.uuid;let o=typeof e=="string"?op.findByName(r,e):e;const a=o!==null?o.uuid:e,l=this._actionsByClip[a];let c=null;if(n===void 0&&(o!==null?n=o.blendMode:n=Sw),l!==void 0){const h=l.actionByRoot[s];if(h!==void 0&&h.blendMode===n)return h;c=l.knownActions[0],o===null&&(o=c._clip)}if(o===null)return null;const u=new Mz(this,o,t,n);return this._bindAction(u,c),this._addInactiveAction(u,a,s),u}existingAction(e,t){const n=t||this._root,r=n.uuid,s=typeof e=="string"?op.findByName(n,e):e,o=s?s.uuid:e,a=this._actionsByClip[o];return a!==void 0&&a.actionByRoot[r]||null}stopAllAction(){const e=this._actions,t=this._nActiveActions;for(let n=t-1;n>=0;--n)e[n].stop();return this}update(e){e*=this.timeScale;const t=this._actions,n=this._nActiveActions,r=this.time+=e,s=Math.sign(e),o=this._accuIndex^=1;for(let c=0;c!==n;++c)t[c]._update(r,e,s,o);const a=this._bindings,l=this._nActiveBindings;for(let c=0;c!==l;++c)a[c].apply(o);return this}setTime(e){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const t=this._actions,n=e.uuid,r=this._actionsByClip,s=r[n];if(s!==void 0){const o=s.knownActions;for(let a=0,l=o.length;a!==l;++a){const c=o[a];this._deactivateAction(c);const u=c._cacheIndex,h=t[t.length-1];c._cacheIndex=null,c._byClipCacheIndex=null,h._cacheIndex=u,t[u]=h,t.pop(),this._removeInactiveBindingsForAction(c)}delete r[n]}}uncacheRoot(e){const t=e.uuid,n=this._actionsByClip;for(const o in n){const a=n[o].actionByRoot,l=a[t];l!==void 0&&(this._deactivateAction(l),this._removeInactiveAction(l))}const r=this._bindingsByRootAndName,s=r[t];if(s!==void 0)for(const o in s){const a=s[o];a.restoreOriginalState(),this._removeInactiveBinding(a)}}uncacheAction(e,t){const n=this.existingAction(e,t);n!==null&&(this._deactivateAction(n),this._removeInactiveAction(n))}}class Xo{constructor(e){this.value=e}clone(){return new Xo(this.value.clone===void 0?this.value:this.value.clone())}}let eie=0;class tie extends Ch{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:eie++}),this.name="",this.usage=R2,this.uniforms=[]}add(e){return this.uniforms.push(e),this}remove(e){const t=this.uniforms.indexOf(e);return t!==-1&&this.uniforms.splice(t,1),this}setName(e){return this.name=e,this}setUsage(e){return this.usage=e,this}dispose(){return this.dispatchEvent({type:"dispose"}),this}copy(e){this.name=e.name,this.usage=e.usage;const t=e.uniforms;this.uniforms.length=0;for(let n=0,r=t.length;n<r;n++){const s=Array.isArray(t[n])?t[n]:[t[n]];for(let o=0;o<s.length;o++)this.uniforms.push(s[o].clone())}return this}clone(){return new this.constructor().copy(this)}}class LS extends lx{constructor(e,t,n=1){super(e,t),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=n}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){const t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}class nie{constructor(e,t,n,r,s){this.isGLBufferAttribute=!0,this.name="",this.buffer=e,this.type=t,this.itemSize=n,this.elementSize=r,this.count=s,this.version=0}set needsUpdate(e){e===!0&&this.version++}setBuffer(e){return this.buffer=e,this}setType(e,t){return this.type=e,this.elementSize=t,this}setItemSize(e){return this.itemSize=e,this}setCount(e){return this.count=e,this}}class y0{constructor(e,t,n=0,r=1/0){this.ray=new vc(e,t),this.near=n,this.far=r,this.camera=null,this.layers=new Gm,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}intersectObject(e,t=!0,n=[]){return FM(e,this,n,t),n.sort(bB),n}intersectObjects(e,t=!0,n=[]){for(let r=0,s=e.length;r<s;r++)FM(e[r],this,n,t);return n.sort(bB),n}}function bB(i,e){return i.distance-e.distance}function FM(i,e,t,n){if(i.layers.test(e.layers)&&i.raycast(e,t),n===!0){const r=i.children;for(let s=0,o=r.length;s<o;s++)FM(r[s],e,t,!0)}}class t0{constructor(e=1,t=0,n=0){return this.radius=e,this.phi=t,this.theta=n,this}set(e,t,n){return this.radius=e,this.phi=t,this.theta=n,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+t*t+n*n),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,n),this.phi=Math.acos(rs(t/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class iie{constructor(e=1,t=0,n=0){return this.radius=e,this.theta=t,this.y=n,this}set(e,t,n){return this.radius=e,this.theta=t,this.y=n,this}copy(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+n*n),this.theta=Math.atan2(e,n),this.y=t,this}clone(){return new this.constructor().copy(this)}}const IB=new Ue;class Rz{constructor(e=new Ue(1/0,1/0),t=new Ue(-1/0,-1/0)){this.isBox2=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=IB.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,IB).distanceTo(e)}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const MB=new Q,gE=new Q;class Eu{constructor(e=new Q,t=new Q){this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){MB.subVectors(e,this.start),gE.subVectors(this.end,this.start);const n=gE.dot(gE);let s=gE.dot(MB)/n;return t&&(s=rs(s,0,1)),s}closestPointToPoint(e,t,n){const r=this.closestPointToPointParameter(e,t);return this.delta(n).multiplyScalar(r).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return new this.constructor().copy(this)}}const RB=new Q;class rie extends _n{constructor(e,t){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t,this.type="SpotLightHelper";const n=new fn,r=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let o=0,a=1,l=32;o<l;o++,a++){const c=o/l*Math.PI*2,u=a/l*Math.PI*2;r.push(Math.cos(c),Math.sin(c),1,Math.cos(u),Math.sin(u),1)}n.setAttribute("position",new Gt(r,3));const s=new vs({fog:!1,toneMapped:!1});this.cone=new Ru(n,s),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1);const e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),RB.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(RB),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const Cd=new Q,AE=new Xe,ST=new Xe;class Pz extends Ru{constructor(e){const t=Lz(e),n=new fn,r=[],s=[],o=new ut(0,0,1),a=new ut(0,1,0);for(let c=0;c<t.length;c++){const u=t[c];u.parent&&u.parent.isBone&&(r.push(0,0,0),r.push(0,0,0),s.push(o.r,o.g,o.b),s.push(a.r,a.g,a.b))}n.setAttribute("position",new Gt(r,3)),n.setAttribute("color",new Gt(s,3));const l=new vs({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});super(n,l),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){const t=this.bones,n=this.geometry,r=n.getAttribute("position");ST.copy(this.root.matrixWorld).invert();for(let s=0,o=0;s<t.length;s++){const a=t[s];a.parent&&a.parent.isBone&&(AE.multiplyMatrices(ST,a.matrixWorld),Cd.setFromMatrixPosition(AE),r.setXYZ(o,Cd.x,Cd.y,Cd.z),AE.multiplyMatrices(ST,a.parent.matrixWorld),Cd.setFromMatrixPosition(AE),r.setXYZ(o+1,Cd.x,Cd.y,Cd.z),o+=2)}n.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose()}}function Lz(i){const e=[];i.isBone===!0&&e.push(i);for(let t=0;t<i.children.length;t++)e.push.apply(e,Lz(i.children[t]));return e}class sie extends It{constructor(e,t,n){const r=new p0(t,4,2),s=new no({wireframe:!0,fog:!1,toneMapped:!1});super(r,s),this.light=e,this.color=n,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const oie=new Q,PB=new ut,LB=new ut;class aie extends _n{constructor(e,t,n){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,this.type="HemisphereLightHelper";const r=new rc(t);r.rotateY(Math.PI*.5),this.material=new no({wireframe:!0,fog:!1,toneMapped:!1}),this.color===void 0&&(this.material.vertexColors=!0);const s=r.getAttribute("position"),o=new Float32Array(s.count*3);r.setAttribute("color",new mn(o,3)),this.add(new It(r,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const e=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{const t=e.geometry.getAttribute("color");PB.copy(this.light.color),LB.copy(this.light.groundColor);for(let n=0,r=t.count;n<r;n++){const s=n<r/2?PB:LB;t.setXYZ(n,s.r,s.g,s.b)}t.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),e.lookAt(oie.setFromMatrixPosition(this.light.matrixWorld).negate())}}class Bz extends Ru{constructor(e=10,t=10,n=4473924,r=8947848){n=new ut(n),r=new ut(r);const s=t/2,o=e/t,a=e/2,l=[],c=[];for(let f=0,d=0,m=-a;f<=t;f++,m+=o){l.push(-a,0,m,a,0,m),l.push(m,0,-a,m,0,a);const y=f===s?n:r;y.toArray(c,d),d+=3,y.toArray(c,d),d+=3,y.toArray(c,d),d+=3,y.toArray(c,d),d+=3}const u=new fn;u.setAttribute("position",new Gt(l,3)),u.setAttribute("color",new Gt(c,3));const h=new vs({vertexColors:!0,toneMapped:!1});super(u,h),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}class lie extends Ru{constructor(e=10,t=16,n=8,r=64,s=4473924,o=8947848){s=new ut(s),o=new ut(o);const a=[],l=[];if(t>1)for(let h=0;h<t;h++){const f=h/t*(Math.PI*2),d=Math.sin(f)*e,m=Math.cos(f)*e;a.push(0,0,0),a.push(d,0,m);const y=h&1?s:o;l.push(y.r,y.g,y.b),l.push(y.r,y.g,y.b)}for(let h=0;h<n;h++){const f=h&1?s:o,d=e-e/n*h;for(let m=0;m<r;m++){let y=m/r*(Math.PI*2),g=Math.sin(y)*d,A=Math.cos(y)*d;a.push(g,0,A),l.push(f.r,f.g,f.b),y=(m+1)/r*(Math.PI*2),g=Math.sin(y)*d,A=Math.cos(y)*d,a.push(g,0,A),l.push(f.r,f.g,f.b)}}const c=new fn;c.setAttribute("position",new Gt(a,3)),c.setAttribute("color",new Gt(l,3));const u=new vs({vertexColors:!0,toneMapped:!1});super(c,u),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}const BB=new Q,yE=new Q,DB=new Q;class cie extends _n{constructor(e,t,n){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,this.type="DirectionalLightHelper",t===void 0&&(t=1);let r=new fn;r.setAttribute("position",new Gt([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));const s=new vs({fog:!1,toneMapped:!1});this.lightPlane=new $n(r,s),this.add(this.lightPlane),r=new fn,r.setAttribute("position",new Gt([0,0,0,0,0,1],3)),this.targetLine=new $n(r,s),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),BB.setFromMatrixPosition(this.light.matrixWorld),yE.setFromMatrixPosition(this.light.target.matrixWorld),DB.subVectors(yE,BB),this.lightPlane.lookAt(yE),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(yE),this.targetLine.scale.z=DB.length()}}const vE=new Q,es=new h0;class Dz extends Ru{constructor(e){const t=new fn,n=new vs({color:16777215,vertexColors:!0,toneMapped:!1}),r=[],s=[],o={};a("n1","n2"),a("n2","n4"),a("n4","n3"),a("n3","n1"),a("f1","f2"),a("f2","f4"),a("f4","f3"),a("f3","f1"),a("n1","f1"),a("n2","f2"),a("n3","f3"),a("n4","f4"),a("p","n1"),a("p","n2"),a("p","n3"),a("p","n4"),a("u1","u2"),a("u2","u3"),a("u3","u1"),a("c","t"),a("p","c"),a("cn1","cn2"),a("cn3","cn4"),a("cf1","cf2"),a("cf3","cf4");function a(m,y){l(m),l(y)}function l(m){r.push(0,0,0),s.push(0,0,0),o[m]===void 0&&(o[m]=[]),o[m].push(r.length/3-1)}t.setAttribute("position",new Gt(r,3)),t.setAttribute("color",new Gt(s,3)),super(t,n),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=o,this.update();const c=new ut(16755200),u=new ut(16711680),h=new ut(43775),f=new ut(16777215),d=new ut(3355443);this.setColors(c,u,h,f,d)}setColors(e,t,n,r,s){const a=this.geometry.getAttribute("color");a.setXYZ(0,e.r,e.g,e.b),a.setXYZ(1,e.r,e.g,e.b),a.setXYZ(2,e.r,e.g,e.b),a.setXYZ(3,e.r,e.g,e.b),a.setXYZ(4,e.r,e.g,e.b),a.setXYZ(5,e.r,e.g,e.b),a.setXYZ(6,e.r,e.g,e.b),a.setXYZ(7,e.r,e.g,e.b),a.setXYZ(8,e.r,e.g,e.b),a.setXYZ(9,e.r,e.g,e.b),a.setXYZ(10,e.r,e.g,e.b),a.setXYZ(11,e.r,e.g,e.b),a.setXYZ(12,e.r,e.g,e.b),a.setXYZ(13,e.r,e.g,e.b),a.setXYZ(14,e.r,e.g,e.b),a.setXYZ(15,e.r,e.g,e.b),a.setXYZ(16,e.r,e.g,e.b),a.setXYZ(17,e.r,e.g,e.b),a.setXYZ(18,e.r,e.g,e.b),a.setXYZ(19,e.r,e.g,e.b),a.setXYZ(20,e.r,e.g,e.b),a.setXYZ(21,e.r,e.g,e.b),a.setXYZ(22,e.r,e.g,e.b),a.setXYZ(23,e.r,e.g,e.b),a.setXYZ(24,t.r,t.g,t.b),a.setXYZ(25,t.r,t.g,t.b),a.setXYZ(26,t.r,t.g,t.b),a.setXYZ(27,t.r,t.g,t.b),a.setXYZ(28,t.r,t.g,t.b),a.setXYZ(29,t.r,t.g,t.b),a.setXYZ(30,t.r,t.g,t.b),a.setXYZ(31,t.r,t.g,t.b),a.setXYZ(32,n.r,n.g,n.b),a.setXYZ(33,n.r,n.g,n.b),a.setXYZ(34,n.r,n.g,n.b),a.setXYZ(35,n.r,n.g,n.b),a.setXYZ(36,n.r,n.g,n.b),a.setXYZ(37,n.r,n.g,n.b),a.setXYZ(38,r.r,r.g,r.b),a.setXYZ(39,r.r,r.g,r.b),a.setXYZ(40,s.r,s.g,s.b),a.setXYZ(41,s.r,s.g,s.b),a.setXYZ(42,s.r,s.g,s.b),a.setXYZ(43,s.r,s.g,s.b),a.setXYZ(44,s.r,s.g,s.b),a.setXYZ(45,s.r,s.g,s.b),a.setXYZ(46,s.r,s.g,s.b),a.setXYZ(47,s.r,s.g,s.b),a.setXYZ(48,s.r,s.g,s.b),a.setXYZ(49,s.r,s.g,s.b),a.needsUpdate=!0}update(){const e=this.geometry,t=this.pointMap,n=1,r=1;es.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),ds("c",t,e,es,0,0,-1),ds("t",t,e,es,0,0,1),ds("n1",t,e,es,-n,-r,-1),ds("n2",t,e,es,n,-r,-1),ds("n3",t,e,es,-n,r,-1),ds("n4",t,e,es,n,r,-1),ds("f1",t,e,es,-n,-r,1),ds("f2",t,e,es,n,-r,1),ds("f3",t,e,es,-n,r,1),ds("f4",t,e,es,n,r,1),ds("u1",t,e,es,n*.7,r*1.1,-1),ds("u2",t,e,es,-n*.7,r*1.1,-1),ds("u3",t,e,es,0,r*2,-1),ds("cf1",t,e,es,-n,0,1),ds("cf2",t,e,es,n,0,1),ds("cf3",t,e,es,0,-r,1),ds("cf4",t,e,es,0,r,1),ds("cn1",t,e,es,-n,0,-1),ds("cn2",t,e,es,n,0,-1),ds("cn3",t,e,es,0,-r,-1),ds("cn4",t,e,es,0,r,-1),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function ds(i,e,t,n,r,s,o){vE.set(r,s,o).unproject(n);const a=e[i];if(a!==void 0){const l=t.getAttribute("position");for(let c=0,u=a.length;c<u;c++)l.setXYZ(a[c],vE.x,vE.y,vE.z)}}const xE=new ti;class uie extends Ru{constructor(e,t=16776960){const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=new Float32Array(24),s=new fn;s.setIndex(new mn(n,1)),s.setAttribute("position",new mn(r,3)),super(s,new vs({color:t,toneMapped:!1})),this.object=e,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(e){if(e!==void 0&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),this.object!==void 0&&xE.setFromObject(this.object),xE.isEmpty())return;const t=xE.min,n=xE.max,r=this.geometry.attributes.position,s=r.array;s[0]=n.x,s[1]=n.y,s[2]=n.z,s[3]=t.x,s[4]=n.y,s[5]=n.z,s[6]=t.x,s[7]=t.y,s[8]=n.z,s[9]=n.x,s[10]=t.y,s[11]=n.z,s[12]=n.x,s[13]=n.y,s[14]=t.z,s[15]=t.x,s[16]=n.y,s[17]=t.z,s[18]=t.x,s[19]=t.y,s[20]=t.z,s[21]=n.x,s[22]=t.y,s[23]=t.z,r.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(e){return this.object=e,this.update(),this}copy(e,t){return super.copy(e,t),this.object=e.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class hie extends Ru{constructor(e,t=16776960){const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],s=new fn;s.setIndex(new mn(n,1)),s.setAttribute("position",new Gt(r,3)),super(s,new vs({color:t,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){const t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}dispose(){this.geometry.dispose(),this.material.dispose()}}class fie extends $n{constructor(e,t=1,n=16776960){const r=n,s=[1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],o=new fn;o.setAttribute("position",new Gt(s,3)),o.computeBoundingSphere(),super(o,new vs({color:r,toneMapped:!1})),this.type="PlaneHelper",this.plane=e,this.size=t;const a=[1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],l=new fn;l.setAttribute("position",new Gt(a,3)),l.computeBoundingSphere(),this.add(new It(l,new no({color:r,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(e){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}const kB=new Q;let EE,wT;class die extends _n{constructor(e=new Q(0,0,1),t=new Q(0,0,0),n=1,r=16776960,s=n*.2,o=s*.2){super(),this.type="ArrowHelper",EE===void 0&&(EE=new fn,EE.setAttribute("position",new Gt([0,0,0,0,1,0],3)),wT=new yo(0,.5,1,5,1),wT.translate(0,-.5,0)),this.position.copy(t),this.line=new $n(EE,new vs({color:r,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new It(wT,new no({color:r,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(n,s,o)}setDirection(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{kB.set(e.z,0,-e.x).normalize();const t=Math.acos(e.y);this.quaternion.setFromAxisAngle(kB,t)}}setLength(e,t=e*.2,n=t*.2){this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(n,t,n),this.cone.position.y=e,this.cone.updateMatrix()}setColor(e){this.line.material.color.set(e),this.cone.material.color.set(e)}copy(e){return super.copy(e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}class pie extends Ru{constructor(e=1){const t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],n=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],r=new fn;r.setAttribute("position",new Gt(t,3)),r.setAttribute("color",new Gt(n,3));const s=new vs({vertexColors:!0,toneMapped:!1});super(r,s),this.type="AxesHelper"}setColors(e,t,n){const r=new ut,s=this.geometry.attributes.color.array;return r.set(e),r.toArray(s,0),r.toArray(s,3),r.set(t),r.toArray(s,6),r.toArray(s,9),r.set(n),r.toArray(s,12),r.toArray(s,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class yf{constructor(){this.type="ShapePath",this.color=new ut,this.subPaths=[],this.currentPath=null}moveTo(e,t){return this.currentPath=new Xd,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){return this.currentPath.lineTo(e,t),this}quadraticCurveTo(e,t,n,r){return this.currentPath.quadraticCurveTo(e,t,n,r),this}bezierCurveTo(e,t,n,r,s,o){return this.currentPath.bezierCurveTo(e,t,n,r,s,o),this}splineThru(e){return this.currentPath.splineThru(e),this}toShapes(e){function t(A){const E=[];for(let x=0,w=A.length;x<w;x++){const T=A[x],I=new Pf;I.curves=T.curves,E.push(I)}return E}function n(A,E){const x=E.length;let w=!1;for(let T=x-1,I=0;I<x;T=I++){let M=E[T],L=E[I],P=L.x-M.x,R=L.y-M.y;if(Math.abs(R)>Number.EPSILON){if(R<0&&(M=E[I],P=-P,L=E[T],R=-R),A.y<M.y||A.y>L.y)continue;if(A.y===M.y){if(A.x===M.x)return!0}else{const U=R*(A.x-M.x)-P*(A.y-M.y);if(U===0)return!0;if(U<0)continue;w=!w}}else{if(A.y!==M.y)continue;if(L.x<=A.x&&A.x<=M.x||M.x<=A.x&&A.x<=L.x)return!0}}return w}const r=xu.isClockWise,s=this.subPaths;if(s.length===0)return[];let o,a,l;const c=[];if(s.length===1)return a=s[0],l=new Pf,l.curves=a.curves,c.push(l),c;let u=!r(s[0].getPoints());u=e?!u:u;const h=[],f=[];let d=[],m=0,y;f[m]=void 0,d[m]=[];for(let A=0,E=s.length;A<E;A++)a=s[A],y=a.getPoints(),o=r(y),o=e?!o:o,o?(!u&&f[m]&&m++,f[m]={s:new Pf,p:y},f[m].s.curves=a.curves,u&&m++,d[m]=[]):d[m].push({h:a,p:y[0]});if(!f[0])return t(s);if(f.length>1){let A=!1,E=0;for(let x=0,w=f.length;x<w;x++)h[x]=[];for(let x=0,w=f.length;x<w;x++){const T=d[x];for(let I=0;I<T.length;I++){const M=T[I];let L=!0;for(let P=0;P<f.length;P++)n(M.p,f[P].p)&&(x!==P&&E++,L?(L=!1,h[P].push(M)):A=!0);L&&h[x].push(M)}}E>0&&A===!1&&(d=h)}let g;for(let A=0,E=f.length;A<E;A++){l=f[A].s,c.push(l),g=d[A];for(let x=0,w=g.length;x<w;x++)l.holes.push(g[x].h)}return c}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:dp}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=dp);const nR=Object.freeze(Object.defineProperty({__proto__:null,ACESFilmicToneMapping:v6,AddEquation:Nd,AddOperation:pU,AdditiveAnimationBlendMode:_6,AdditiveBlending:xS,AgXToneMapping:vU,AlphaFormat:EU,AlwaysCompare:UU,AlwaysDepth:aU,AlwaysStencilFunc:IS,AmbientLight:q6,AnimationAction:Mz,AnimationClip:op,AnimationLoader:Pne,AnimationMixer:tR,AnimationObjectGroup:Jne,AnimationUtils:bne,ArcCurve:rz,ArrayCamera:JU,ArrowHelper:die,AttachedBindMode:aM,Audio:bz,AudioAnalyser:Hne,AudioContext:J6,AudioListener:Tz,AudioLoader:Cz,AxesHelper:pie,BackSide:ys,BasicDepthPacking:MU,BasicShadowMap:jN,BatchedMesh:L6,Bone:sA,BooleanKeyframeTrack:g0,Box2:Rz,Box3:ti,Box3Helper:hie,BoxGeometry:ya,BoxHelper:uie,BufferAttribute:mn,BufferGeometry:fn,BufferGeometryLoader:Sz,ByteType:w2,Cache:Rf,Camera:h0,CameraHelper:Dz,CanvasTexture:k6,CapsuleGeometry:Fw,CatmullRomCurve3:Dw,CineonToneMapping:AU,CircleGeometry:Ow,ClampToEdgeWrapping:Wi,Clock:qw,Color:ut,ColorKeyframeTrack:Y6,ColorManagement:Vi,CompressedArrayTexture:Xte,CompressedCubeTexture:qte,CompressedTexture:gp,CompressedTextureLoader:Lne,ConeGeometry:Nw,ConstantAlphaFactor:rU,ConstantColorFactor:nU,CubeCamera:Iw,CubeReflectionMapping:_u,CubeRefractionMapping:ip,CubeTexture:ox,CubeTextureLoader:Kw,CubeUVReflectionMapping:SA,CubicBezierCurve:O6,CubicBezierCurve3:N6,CubicInterpolant:gz,CullFaceBack:nM,CullFaceFront:VN,CullFaceFrontBack:X$,CullFaceNone:QN,Curve:xc,CurvePath:H6,CustomBlending:Aw,CustomToneMapping:yU,CylinderGeometry:yo,Cylindrical:iie,Data3DTexture:I6,DataArrayTexture:Tw,DataTexture:Sa,DataTextureLoader:$6,DataUtils:Lm,DecrementStencilOp:iX,DecrementWrapStencilOp:sX,DefaultLoadingManager:D1,DepthFormat:vu,DepthStencilFormat:qm,DepthTexture:d0,DetachedBindMode:xU,DirectionalLight:$w,DirectionalLightHelper:cie,DiscreteInterpolant:Az,DisplayP3ColorSpace:Cw,DodecahedronGeometry:Uw,DoubleSide:Li,DstAlphaFactor:qN,DstColorFactor:ZN,DynamicCopyUsage:AX,DynamicDrawUsage:No,DynamicReadUsage:pX,EdgesGeometry:Q6,EllipseCurve:Hm,EqualCompare:kU,EqualDepth:cU,EqualStencilFunc:PU,EquirectangularReflectionMapping:Xm,EquirectangularRefractionMapping:_2,Euler:Eo,EventDispatcher:Ch,ExtrudeGeometry:dx,FileLoader:Yr,Float16BufferAttribute:nq,Float32BufferAttribute:Gt,Float64BufferAttribute:iq,FloatType:fi,Fog:Bw,FogExp2:Lw,FramebufferTexture:$te,FrontSide:tl,Frustum:f0,GLBufferAttribute:nie,GLSL1:vX,GLSL3:IM,GreaterCompare:FU,GreaterDepth:hU,GreaterEqualCompare:NU,GreaterEqualDepth:uU,GreaterEqualStencilFunc:hX,GreaterStencilFunc:uX,GridHelper:Bz,Group:xa,HalfFloatType:Ni,HemisphereLight:vz,HemisphereLightHelper:aie,IcosahedronGeometry:px,ImageBitmapLoader:wz,ImageLoader:k2,ImageUtils:b6,IncrementStencilOp:nX,IncrementWrapStencilOp:rX,InstancedBufferAttribute:Su,InstancedBufferGeometry:gx,InstancedInterleavedBuffer:LS,InstancedMesh:ux,Int16BufferAttribute:eq,Int32BufferAttribute:tq,Int8BufferAttribute:qX,IntType:Um,InterleavedBuffer:lx,InterleavedBufferAttribute:Ja,Interpolant:bA,InterpolateDiscrete:tA,InterpolateLinear:Zm,InterpolateSmooth:j_,InvertStencilOp:oX,KeepStencilOp:hh,KeyframeTrack:Pu,LOD:nz,LatheGeometry:fx,Layers:Gm,LessCompare:DU,LessDepth:lU,LessEqualCompare:C6,LessEqualDepth:E2,LessEqualStencilFunc:cX,LessStencilFunc:lX,Light:yp,LightProbe:_z,Line:$n,Line3:Eu,LineBasicMaterial:vs,LineCurve:U6,LineCurve3:sz,LineDashedMaterial:dz,LineLoop:B6,LineSegments:Ru,LinearDisplayP3ColorSpace:sx,LinearEncoding:w6,LinearFilter:Ln,LinearInterpolant:K6,LinearMipMapLinearFilter:lM,LinearMipMapNearestFilter:eX,LinearMipmapLinearFilter:Bl,LinearMipmapNearestFilter:vw,LinearSRGBColorSpace:Dl,LinearToneMapping:mU,LinearTransfer:b2,Loader:os,LoaderUtils:Lf,LoadingManager:Ww,LoopOnce:CU,LoopPingPong:bU,LoopRepeat:TU,LuminanceAlphaFormat:SU,LuminanceFormat:_U,MOUSE:oc,Material:Us,MaterialLoader:Xw,MathUtils:un,Matrix3:Tn,Matrix4:Xe,MaxEquation:oM,Mesh:It,MeshBasicMaterial:no,MeshDepthMaterial:ax,MeshDistanceMaterial:Rw,MeshLambertMaterial:mx,MeshMatcapMaterial:fz,MeshNormalMaterial:j6,MeshPhongMaterial:t2,MeshPhysicalMaterial:nl,MeshStandardMaterial:m0,MeshToonMaterial:hz,MinEquation:sM,MirroredRepeatWrapping:eA,MixOperation:dU,MultiplyBlending:rM,MultiplyOperation:ix,NearestFilter:zn,NearestMipMapLinearFilter:Z$,NearestMipMapNearestFilter:J$,NearestMipmapLinearFilter:z1,NearestMipmapNearestFilter:S2,NeverCompare:BU,NeverDepth:oU,NeverStencilFunc:aX,NoBlending:gc,NoColorSpace:Tl,NoToneMapping:yu,NormalAnimationBlendMode:Sw,NormalBlending:Kd,NotEqualCompare:OU,NotEqualDepth:fU,NotEqualStencilFunc:LU,NumberKeyframeTrack:sp,Object3D:_n,ObjectLoader:Fne,ObjectSpaceNormalMap:RU,OctahedronGeometry:rc,OneFactor:yw,OneMinusConstantAlphaFactor:sU,OneMinusConstantColorFactor:iU,OneMinusDstAlphaFactor:JN,OneMinusDstColorFactor:eU,OneMinusSrcAlphaFactor:ES,OneMinusSrcColorFactor:XN,OrthographicCamera:qi,P3Primaries:M2,PCFShadowMap:gw,PCFSoftShadowMap:Kv,PMREMGenerator:RM,Path:Xd,PerspectiveCamera:jn,Plane:vo,PlaneGeometry:Fs,PlaneHelper:fie,PointLight:F2,PointLightHelper:sie,Points:D6,PointsMaterial:hx,PolarGridHelper:lie,PolyhedronGeometry:Ap,PositionalAudio:Gne,PropertyBinding:li,PropertyMixer:Iz,QuadraticBezierCurve:z6,QuadraticBezierCurve3:kw,Quaternion:Xt,QuaternionKeyframeTrack:vh,QuaternionLinearInterpolant:yz,RED_GREEN_RGTC2_Format:TM,RED_RGTC1_Format:wU,REVISION:dp,RGBADepthPacking:ww,RGBAFormat:gi,RGBAIntegerFormat:Jm,RGBA_ASTC_10x10_Format:xM,RGBA_ASTC_10x5_Format:AM,RGBA_ASTC_10x6_Format:yM,RGBA_ASTC_10x8_Format:vM,RGBA_ASTC_12x10_Format:EM,RGBA_ASTC_12x12_Format:_M,RGBA_ASTC_4x4_Format:TS,RGBA_ASTC_5x4_Format:hM,RGBA_ASTC_5x5_Format:fM,RGBA_ASTC_6x5_Format:dM,RGBA_ASTC_6x6_Format:C2,RGBA_ASTC_8x5_Format:pM,RGBA_ASTC_8x6_Format:mM,RGBA_ASTC_8x8_Format:gM,RGBA_BPTC_Format:Xv,RGBA_ETC2_EAC_Format:CS,RGBA_PVRTC_2BPPV1_Format:uM,RGBA_PVRTC_4BPPV1_Format:SS,RGBA_S3TC_DXT1_Format:Q_,RGBA_S3TC_DXT3_Format:V_,RGBA_S3TC_DXT5_Format:$v,RGB_BPTC_SIGNED_Format:SM,RGB_BPTC_UNSIGNED_Format:wM,RGB_ETC1_Format:_w,RGB_ETC2_Format:wS,RGB_PVRTC_2BPPV1_Format:cM,RGB_PVRTC_4BPPV1_Format:_S,RGB_S3TC_DXT1_Format:Yv,RGFormat:Gd,RGIntegerFormat:rx,RawShaderMaterial:uz,Ray:vc,Raycaster:y0,Rec709Primaries:I2,RectAreaLight:xz,RedFormat:hc,RedIntegerFormat:Ew,ReinhardToneMapping:gU,RenderTarget:HU,RepeatWrapping:_o,ReplaceStencilOp:W_,ReverseSubtractEquation:KN,RingGeometry:Gw,SIGNED_RED_GREEN_RGTC2_Format:bM,SIGNED_RED_RGTC1_Format:CM,SRGBColorSpace:gs,SRGBTransfer:mr,Scene:Mu,ShaderChunk:Un,ShaderLib:du,ShaderMaterial:Mi,ShadowMaterial:cz,Shape:Pf,ShapeGeometry:Hw,ShapePath:yf,ShapeUtils:xu,ShortType:xw,Skeleton:TA,SkeletonHelper:Pz,SkinnedMesh:cx,Source:Pm,Sphere:Bi,SphereGeometry:p0,Spherical:t0,SphericalHarmonics3:Ez,SplineCurve:G6,SpotLight:Yw,SpotLightHelper:rie,Sprite:tz,SpriteMaterial:P6,SrcAlphaFactor:x2,SrcAlphaSaturateFactor:tU,SrcColorFactor:$N,StaticCopyUsage:gX,StaticDrawUsage:R2,StaticReadUsage:dX,StereoCamera:Nne,StreamCopyUsage:yX,StreamDrawUsage:fX,StreamReadUsage:mX,StringKeyframeTrack:A0,SubtractEquation:WN,SubtractiveBlending:iM,TOUCH:Sf,TangentSpaceNormalMap:mp,TetrahedronGeometry:Qw,Texture:vi,TextureLoader:xh,TorusGeometry:Hd,TorusKnotGeometry:Vw,Triangle:ks,TriangleFanDrawMode:bS,TriangleStripDrawMode:S6,TrianglesDrawMode:IU,TubeGeometry:jw,TwoPassDoubleSide:q$,UVMapping:np,Uint16BufferAttribute:bw,Uint32BufferAttribute:M6,Uint8BufferAttribute:JX,Uint8ClampedBufferAttribute:ZX,Uniform:Xo,UniformsGroup:tie,UniformsLib:Ot,UniformsUtils:rp,UnsignedByteType:Zi,UnsignedInt248Type:Yd,UnsignedIntType:Zo,UnsignedShort4444Type:x6,UnsignedShort5551Type:E6,UnsignedShortType:pp,VSMShadowMap:fu,Vector2:Ue,Vector3:Q,Vector4:Rn,VectorKeyframeTrack:Of,VideoTexture:iz,WebGL1Renderer:ZU,WebGL3DRenderTarget:UX,WebGLArrayRenderTarget:NX,WebGLCoordinateSystem:mu,WebGLCubeRenderTarget:wA,WebGLMultipleRenderTargets:zX,WebGLRenderTarget:Si,WebGLRenderer:Pw,WebGLUtils:qU,WebGPUCoordinateSystem:nA,WireframeGeometry:V6,WrapAroundEnding:T2,ZeroCurvatureEnding:Mm,ZeroFactor:YN,ZeroSlopeEnding:Rm,ZeroStencilOp:tX,_SRGBAFormat:MS,createCanvasElement:GU,sRGBEncoding:$d},Symbol.toStringTag,{value:"Module"}));var CT={exports:{}},Td={};/**
 * @license React
 * react-reconciler-constants.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var FB;function mie(){return FB||(FB=1,Td.ConcurrentRoot=1,Td.ContinuousEventPriority=4,Td.DefaultEventPriority=16,Td.DiscreteEventPriority=1,Td.IdleEventPriority=536870912,Td.LegacyRoot=0),Td}var OB;function gie(){return OB||(OB=1,CT.exports=mie()),CT.exports}var k1=gie();function Aie(i){let e;const t=new Set,n=(c,u)=>{const h=typeof c=="function"?c(e):c;if(h!==e){const f=e;e=u?h:Object.assign({},e,h),t.forEach(d=>d(e,f))}},r=()=>e,s=(c,u=r,h=Object.is)=>{console.warn("[DEPRECATED] Please use `subscribeWithSelector` middleware");let f=u(e);function d(){const m=u(e);if(!h(f,m)){const y=f;c(f=m,y)}}return t.add(d),()=>t.delete(d)},l={setState:n,getState:r,subscribe:(c,u,h)=>u||h?s(c,u,h):(t.add(c),()=>t.delete(c)),destroy:()=>t.clear()};return e=i(n,r,l),l}const yie=typeof window>"u"||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent),NB=yie?C.useEffect:C.useLayoutEffect;function kz(i){const e=typeof i=="function"?Aie(i):i,t=(n=e.getState,r=Object.is)=>{const[,s]=C.useReducer(g=>g+1,0),o=e.getState(),a=C.useRef(o),l=C.useRef(n),c=C.useRef(r),u=C.useRef(!1),h=C.useRef();h.current===void 0&&(h.current=n(o));let f,d=!1;(a.current!==o||l.current!==n||c.current!==r||u.current)&&(f=n(o),d=!r(h.current,f)),NB(()=>{d&&(h.current=f),a.current=o,l.current=n,c.current=r,u.current=!1});const m=C.useRef(o);NB(()=>{const g=()=>{try{const E=e.getState(),x=l.current(E);c.current(h.current,x)||(a.current=E,h.current=x,s())}catch{u.current=!0,s()}},A=e.subscribe(g);return e.getState()!==m.current&&g(),A},[]);const y=d?f:h.current;return C.useDebugValue(y),y};return Object.assign(t,e),t[Symbol.iterator]=function(){console.warn("[useStore, api] = create() is deprecated and will be removed in v4");const n=[t,e];return{next(){const r=n.length<=0;return{value:n.shift(),done:r}}}},t}const vie=i=>typeof i=="object"&&typeof i.then=="function",Dm=[];function Fz(i,e,t=(n,r)=>n===r){if(i===e)return!0;if(!i||!e)return!1;const n=i.length;if(e.length!==n)return!1;for(let r=0;r<n;r++)if(!t(i[r],e[r]))return!1;return!0}function Oz(i,e=null,t=!1,n={}){e===null&&(e=[i]);for(const s of Dm)if(Fz(e,s.keys,s.equal)){if(t)return;if(Object.prototype.hasOwnProperty.call(s,"error"))throw s.error;if(Object.prototype.hasOwnProperty.call(s,"response"))return n.lifespan&&n.lifespan>0&&(s.timeout&&clearTimeout(s.timeout),s.timeout=setTimeout(s.remove,n.lifespan)),s.response;if(!t)throw s.promise}const r={keys:e,equal:n.equal,remove:()=>{const s=Dm.indexOf(r);s!==-1&&Dm.splice(s,1)},promise:(vie(i)?i:i(...e)).then(s=>{r.response=s,n.lifespan&&n.lifespan>0&&(r.timeout=setTimeout(r.remove,n.lifespan))}).catch(s=>r.error=s)};if(Dm.push(r),!t)throw r.promise}const Th=(i,e,t)=>Oz(i,e,!1,t),Nz=(i,e,t)=>void Oz(i,e,!0,t),Ax=i=>{if(i===void 0||i.length===0)Dm.splice(0,Dm.length);else{const e=Dm.find(t=>Fz(i,t.keys,t.equal));e&&e.remove()}};var TT={exports:{}},bT={exports:{}},IT={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var UB;function xie(){return UB||(UB=1,(function(i){function e(K,V){var W=K.length;K.push(V);e:for(;0<W;){var F=W-1>>>1,Y=K[F];if(0<r(Y,V))K[F]=V,K[W]=Y,W=F;else break e}}function t(K){return K.length===0?null:K[0]}function n(K){if(K.length===0)return null;var V=K[0],W=K.pop();if(W!==V){K[0]=W;e:for(var F=0,Y=K.length,te=Y>>>1;F<te;){var q=2*(F+1)-1,J=K[q],re=q+1,ie=K[re];if(0>r(J,W))re<Y&&0>r(ie,J)?(K[F]=ie,K[re]=W,F=re):(K[F]=J,K[q]=W,F=q);else if(re<Y&&0>r(ie,W))K[F]=ie,K[re]=W,F=re;else break e}}return V}function r(K,V){var W=K.sortIndex-V.sortIndex;return W!==0?W:K.id-V.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;i.unstable_now=function(){return s.now()}}else{var o=Date,a=o.now();i.unstable_now=function(){return o.now()-a}}var l=[],c=[],u=1,h=null,f=3,d=!1,m=!1,y=!1,g=typeof setTimeout=="function"?setTimeout:null,A=typeof clearTimeout=="function"?clearTimeout:null,E=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function x(K){for(var V=t(c);V!==null;){if(V.callback===null)n(c);else if(V.startTime<=K)n(c),V.sortIndex=V.expirationTime,e(l,V);else break;V=t(c)}}function w(K){if(y=!1,x(K),!m)if(t(l)!==null)m=!0,Z(T);else{var V=t(c);V!==null&&oe(w,V.startTime-K)}}function T(K,V){m=!1,y&&(y=!1,A(L),L=-1),d=!0;var W=f;try{for(x(V),h=t(l);h!==null&&(!(h.expirationTime>V)||K&&!U());){var F=h.callback;if(typeof F=="function"){h.callback=null,f=h.priorityLevel;var Y=F(h.expirationTime<=V);V=i.unstable_now(),typeof Y=="function"?h.callback=Y:h===t(l)&&n(l),x(V)}else n(l);h=t(l)}if(h!==null)var te=!0;else{var q=t(c);q!==null&&oe(w,q.startTime-V),te=!1}return te}finally{h=null,f=W,d=!1}}var I=!1,M=null,L=-1,P=5,R=-1;function U(){return!(i.unstable_now()-R<P)}function k(){if(M!==null){var K=i.unstable_now();R=K;var V=!0;try{V=M(!0,K)}finally{V?H():(I=!1,M=null)}}else I=!1}var H;if(typeof E=="function")H=function(){E(k)};else if(typeof MessageChannel<"u"){var G=new MessageChannel,X=G.port2;G.port1.onmessage=k,H=function(){X.postMessage(null)}}else H=function(){g(k,0)};function Z(K){M=K,I||(I=!0,H())}function oe(K,V){L=g(function(){K(i.unstable_now())},V)}i.unstable_IdlePriority=5,i.unstable_ImmediatePriority=1,i.unstable_LowPriority=4,i.unstable_NormalPriority=3,i.unstable_Profiling=null,i.unstable_UserBlockingPriority=2,i.unstable_cancelCallback=function(K){K.callback=null},i.unstable_continueExecution=function(){m||d||(m=!0,Z(T))},i.unstable_forceFrameRate=function(K){0>K||125<K?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):P=0<K?Math.floor(1e3/K):5},i.unstable_getCurrentPriorityLevel=function(){return f},i.unstable_getFirstCallbackNode=function(){return t(l)},i.unstable_next=function(K){switch(f){case 1:case 2:case 3:var V=3;break;default:V=f}var W=f;f=V;try{return K()}finally{f=W}},i.unstable_pauseExecution=function(){},i.unstable_requestPaint=function(){},i.unstable_runWithPriority=function(K,V){switch(K){case 1:case 2:case 3:case 4:case 5:break;default:K=3}var W=f;f=K;try{return V()}finally{f=W}},i.unstable_scheduleCallback=function(K,V,W){var F=i.unstable_now();switch(typeof W=="object"&&W!==null?(W=W.delay,W=typeof W=="number"&&0<W?F+W:F):W=F,K){case 1:var Y=-1;break;case 2:Y=250;break;case 5:Y=1073741823;break;case 4:Y=1e4;break;default:Y=5e3}return Y=W+Y,K={id:u++,callback:V,priorityLevel:K,startTime:W,expirationTime:Y,sortIndex:-1},W>F?(K.sortIndex=W,e(c,K),t(l)===null&&K===t(c)&&(y?(A(L),L=-1):y=!0,oe(w,W-F))):(K.sortIndex=Y,e(l,K),m||d||(m=!0,Z(T))),K},i.unstable_shouldYield=U,i.unstable_wrapCallback=function(K){var V=f;return function(){var W=f;f=V;try{return K.apply(this,arguments)}finally{f=W}}}})(IT)),IT}var zB;function Uz(){return zB||(zB=1,bT.exports=xie()),bT.exports}/**
 * @license React
 * react-reconciler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var MT,GB;function Eie(){return GB||(GB=1,MT=function(e){var t={},n=_A(),r=Uz(),s=Object.assign;function o(_){for(var S="https://reactjs.org/docs/error-decoder.html?invariant="+_,B=1;B<arguments.length;B++)S+="&args[]="+encodeURIComponent(arguments[B]);return"Minified React error #"+_+"; visit "+S+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var a=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,l=Symbol.for("react.element"),c=Symbol.for("react.portal"),u=Symbol.for("react.fragment"),h=Symbol.for("react.strict_mode"),f=Symbol.for("react.profiler"),d=Symbol.for("react.provider"),m=Symbol.for("react.context"),y=Symbol.for("react.forward_ref"),g=Symbol.for("react.suspense"),A=Symbol.for("react.suspense_list"),E=Symbol.for("react.memo"),x=Symbol.for("react.lazy"),w=Symbol.for("react.offscreen"),T=Symbol.iterator;function I(_){return _===null||typeof _!="object"?null:(_=T&&_[T]||_["@@iterator"],typeof _=="function"?_:null)}function M(_){if(_==null)return null;if(typeof _=="function")return _.displayName||_.name||null;if(typeof _=="string")return _;switch(_){case u:return"Fragment";case c:return"Portal";case f:return"Profiler";case h:return"StrictMode";case g:return"Suspense";case A:return"SuspenseList"}if(typeof _=="object")switch(_.$$typeof){case m:return(_.displayName||"Context")+".Consumer";case d:return(_._context.displayName||"Context")+".Provider";case y:var S=_.render;return _=_.displayName,_||(_=S.displayName||S.name||"",_=_!==""?"ForwardRef("+_+")":"ForwardRef"),_;case E:return S=_.displayName||null,S!==null?S:M(_.type)||"Memo";case x:S=_._payload,_=_._init;try{return M(_(S))}catch{}}return null}function L(_){var S=_.type;switch(_.tag){case 24:return"Cache";case 9:return(S.displayName||"Context")+".Consumer";case 10:return(S._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return _=S.render,_=_.displayName||_.name||"",S.displayName||(_!==""?"ForwardRef("+_+")":"ForwardRef");case 7:return"Fragment";case 5:return S;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return M(S);case 8:return S===h?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof S=="function")return S.displayName||S.name||null;if(typeof S=="string")return S}return null}function P(_){var S=_,B=_;if(_.alternate)for(;S.return;)S=S.return;else{_=S;do S=_,(S.flags&4098)!==0&&(B=S.return),_=S.return;while(_)}return S.tag===3?B:null}function R(_){if(P(_)!==_)throw Error(o(188))}function U(_){var S=_.alternate;if(!S){if(S=P(_),S===null)throw Error(o(188));return S!==_?null:_}for(var B=_,O=S;;){var $=B.return;if($===null)break;var le=$.alternate;if(le===null){if(O=$.return,O!==null){B=O;continue}break}if($.child===le.child){for(le=$.child;le;){if(le===B)return R($),_;if(le===O)return R($),S;le=le.sibling}throw Error(o(188))}if(B.return!==O.return)B=$,O=le;else{for(var _e=!1,Ge=$.child;Ge;){if(Ge===B){_e=!0,B=$,O=le;break}if(Ge===O){_e=!0,O=$,B=le;break}Ge=Ge.sibling}if(!_e){for(Ge=le.child;Ge;){if(Ge===B){_e=!0,B=le,O=$;break}if(Ge===O){_e=!0,O=le,B=$;break}Ge=Ge.sibling}if(!_e)throw Error(o(189))}}if(B.alternate!==O)throw Error(o(190))}if(B.tag!==3)throw Error(o(188));return B.stateNode.current===B?_:S}function k(_){return _=U(_),_!==null?H(_):null}function H(_){if(_.tag===5||_.tag===6)return _;for(_=_.child;_!==null;){var S=H(_);if(S!==null)return S;_=_.sibling}return null}function G(_){if(_.tag===5||_.tag===6)return _;for(_=_.child;_!==null;){if(_.tag!==4){var S=G(_);if(S!==null)return S}_=_.sibling}return null}var X=Array.isArray,Z=e.getPublicInstance,oe=e.getRootHostContext,K=e.getChildHostContext,V=e.prepareForCommit,W=e.resetAfterCommit,F=e.createInstance,Y=e.appendInitialChild,te=e.finalizeInitialChildren,q=e.prepareUpdate,J=e.shouldSetTextContent,re=e.createTextInstance,ie=e.scheduleTimeout,se=e.cancelTimeout,ge=e.noTimeout,xe=e.isPrimaryRenderer,pe=e.supportsMutation,ue=e.supportsPersistence,Me=e.supportsHydration,Se=e.getInstanceFromNode,ve=e.preparePortalMount,Ae=e.getCurrentEventPriority,ke=e.detachDeletedInstance,be=e.supportsMicrotasks,ne=e.scheduleMicrotask,j=e.supportsTestSelectors,de=e.findFiberRoot,Re=e.getBoundingRect,Le=e.getTextContent,Fe=e.isHiddenSubtree,He=e.matchAccessibilityRole,it=e.setFocusIfFocusable,Ye=e.setupIntersectionObserver,ct=e.appendChild,pt=e.appendChildToContainer,je=e.commitTextUpdate,Mt=e.commitMount,Ft=e.commitUpdate,St=e.insertBefore,gt=e.insertInContainerBefore,ft=e.removeChild,Ce=e.removeChildFromContainer,qe=e.resetTextContent,At=e.hideInstance,yt=e.hideTextInstance,Be=e.unhideInstance,we=e.unhideTextInstance,_t=e.clearContainer,vt=e.cloneInstance,bt=e.createContainerChildSet,Lt=e.appendChildToContainerChildSet,qt=e.finalizeContainerChildren,Nt=e.replaceContainerChildren,dn=e.cloneHiddenInstance,Vn=e.cloneHiddenTextInstance,pn=e.canHydrateInstance,qn=e.canHydrateTextInstance,Ci=e.canHydrateSuspenseInstance,as=e.isSuspenseInstancePending,Nr=e.isSuspenseInstanceFallback,ur=e.registerSuspenseInstanceRetry,tr=e.getNextHydratableSibling,An=e.getFirstHydratableChild,vr=e.getFirstHydratableChildWithinContainer,Uo=e.getFirstHydratableChildWithinSuspenseInstance,he=e.hydrateInstance,me=e.hydrateTextInstance,De=e.hydrateSuspenseInstance,ce=e.getNextHydratableInstanceAfterSuspenseInstance,ye=e.commitHydratedContainer,Ee=e.commitHydratedSuspenseInstance,Pe=e.clearSuspenseBoundary,Ie=e.clearSuspenseBoundaryFromContainer,Je=e.shouldDeleteUnhydratedTailInstances,st=e.didNotMatchHydratedContainerTextInstance,lt=e.didNotMatchHydratedTextInstance,Oe;function Ht(_){if(Oe===void 0)try{throw Error()}catch(B){var S=B.stack.trim().match(/\n( *(at )?)/);Oe=S&&S[1]||""}return`
`+Oe+_}var xt=!1;function Et(_,S){if(!_||xt)return"";xt=!0;var B=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(S)if(S=function(){throw Error()},Object.defineProperty(S.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(S,[])}catch(Rt){var O=Rt}Reflect.construct(_,[],S)}else{try{S.call()}catch(Rt){O=Rt}_.call(S.prototype)}else{try{throw Error()}catch(Rt){O=Rt}_()}}catch(Rt){if(Rt&&O&&typeof Rt.stack=="string"){for(var $=Rt.stack.split(`
`),le=O.stack.split(`
`),_e=$.length-1,Ge=le.length-1;1<=_e&&0<=Ge&&$[_e]!==le[Ge];)Ge--;for(;1<=_e&&0<=Ge;_e--,Ge--)if($[_e]!==le[Ge]){if(_e!==1||Ge!==1)do if(_e--,Ge--,0>Ge||$[_e]!==le[Ge]){var ht=`
`+$[_e].replace(" at new "," at ");return _.displayName&&ht.includes("<anonymous>")&&(ht=ht.replace("<anonymous>",_.displayName)),ht}while(1<=_e&&0<=Ge);break}}}finally{xt=!1,Error.prepareStackTrace=B}return(_=_?_.displayName||_.name:"")?Ht(_):""}var Qt=Object.prototype.hasOwnProperty,sn=[],ln=-1;function vn(_){return{current:_}}function Dt(_){0>ln||(_.current=sn[ln],sn[ln]=null,ln--)}function Bt(_,S){ln++,sn[ln]=_.current,_.current=S}var yn={},xn=vn(yn),Sn=vn(!1),Ai=yn;function xi(_,S){var B=_.type.contextTypes;if(!B)return yn;var O=_.stateNode;if(O&&O.__reactInternalMemoizedUnmaskedChildContext===S)return O.__reactInternalMemoizedMaskedChildContext;var $={},le;for(le in B)$[le]=S[le];return O&&(_=_.stateNode,_.__reactInternalMemoizedUnmaskedChildContext=S,_.__reactInternalMemoizedMaskedChildContext=$),$}function Ei(_){return _=_.childContextTypes,_!=null}function Dn(){Dt(Sn),Dt(xn)}function kn(_,S,B){if(xn.current!==yn)throw Error(o(168));Bt(xn,S),Bt(Sn,B)}function zi(_,S,B){var O=_.stateNode;if(S=S.childContextTypes,typeof O.getChildContext!="function")return B;O=O.getChildContext();for(var $ in O)if(!($ in S))throw Error(o(108,L(_)||"Unknown",$));return s({},B,O)}function Bn(_){return _=(_=_.stateNode)&&_.__reactInternalMemoizedMergedChildContext||yn,Ai=xn.current,Bt(xn,_),Bt(Sn,Sn.current),!0}function Pn(_,S,B){var O=_.stateNode;if(!O)throw Error(o(169));B?(_=zi(_,S,Ai),O.__reactInternalMemoizedMergedChildContext=_,Dt(Sn),Dt(xn),Bt(xn,_)):Dt(Sn),Bt(Sn,B)}var Ri=Math.clz32?Math.clz32:ta,ls=Math.log,nr=Math.LN2;function ta(_){return _>>>=0,_===0?32:31-(ls(_)/nr|0)|0}var ol=64,ri=4194304;function Ul(_){switch(_&-_){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return _&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return _&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return _}}function ku(_,S){var B=_.pendingLanes;if(B===0)return 0;var O=0,$=_.suspendedLanes,le=_.pingedLanes,_e=B&268435455;if(_e!==0){var Ge=_e&~$;Ge!==0?O=Ul(Ge):(le&=_e,le!==0&&(O=Ul(le)))}else _e=B&~$,_e!==0?O=Ul(_e):le!==0&&(O=Ul(le));if(O===0)return 0;if(S!==0&&S!==O&&(S&$)===0&&($=O&-O,le=S&-S,$>=le||$===16&&(le&4194240)!==0))return S;if((O&4)!==0&&(O|=B&16),S=_.entangledLanes,S!==0)for(_=_.entanglements,S&=O;0<S;)B=31-Ri(S),$=1<<B,O|=_[B],S&=~$;return O}function Qf(_,S){switch(_){case 1:case 2:case 4:return S+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return S+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Vf(_,S){for(var B=_.suspendedLanes,O=_.pingedLanes,$=_.expirationTimes,le=_.pendingLanes;0<le;){var _e=31-Ri(le),Ge=1<<_e,ht=$[_e];ht===-1?((Ge&B)===0||(Ge&O)!==0)&&($[_e]=Qf(Ge,S)):ht<=S&&(_.expiredLanes|=Ge),le&=~Ge}}function zl(_){return _=_.pendingLanes&-1073741825,_!==0?_:_&1073741824?1073741824:0}function Mh(_){for(var S=[],B=0;31>B;B++)S.push(_);return S}function ba(_,S,B){_.pendingLanes|=S,S!==536870912&&(_.suspendedLanes=0,_.pingedLanes=0),_=_.eventTimes,S=31-Ri(S),_[S]=B}function al(_,S){var B=_.pendingLanes&~S;_.pendingLanes=S,_.suspendedLanes=0,_.pingedLanes=0,_.expiredLanes&=S,_.mutableReadLanes&=S,_.entangledLanes&=S,S=_.entanglements;var O=_.eventTimes;for(_=_.expirationTimes;0<B;){var $=31-Ri(B),le=1<<$;S[$]=0,O[$]=-1,_[$]=-1,B&=~le}}function zs(_,S){var B=_.entangledLanes|=S;for(_=_.entanglements;B;){var O=31-Ri(B),$=1<<O;$&S|_[O]&S&&(_[O]|=S),B&=~$}}var Fn=0;function Ia(_){return _&=-_,1<_?4<_?(_&268435455)!==0?16:536870912:4:1}var na=r.unstable_scheduleCallback,Gl=r.unstable_cancelCallback,Ma=r.unstable_shouldYield,E0=r.unstable_requestPaint,hr=r.unstable_now,ll=r.unstable_ImmediatePriority,_0=r.unstable_UserBlockingPriority,lo=r.unstable_NormalPriority,Fu=r.unstable_IdlePriority,Ou=null,ia=null;function Tc(_){if(ia&&typeof ia.onCommitFiberRoot=="function")try{ia.onCommitFiberRoot(Ou,_,void 0,(_.current.flags&128)===128)}catch{}}function Nu(_,S){return _===S&&(_!==0||1/_===1/S)||_!==_&&S!==S}var _s=typeof Object.is=="function"?Object.is:Nu,Ss=null,Hl=!1,Ra=!1;function Rh(_){Ss===null?Ss=[_]:Ss.push(_)}function Uu(_){Hl=!0,Rh(_)}function co(){if(!Ra&&Ss!==null){Ra=!0;var _=0,S=Fn;try{var B=Ss;for(Fn=1;_<B.length;_++){var O=B[_];do O=O(!0);while(O!==null)}Ss=null,Hl=!1}catch($){throw Ss!==null&&(Ss=Ss.slice(_+1)),na(ll,co),$}finally{Fn=S,Ra=!1}}return null}var zu=a.ReactCurrentBatchConfig;function zo(_,S){if(_s(_,S))return!0;if(typeof _!="object"||_===null||typeof S!="object"||S===null)return!1;var B=Object.keys(_),O=Object.keys(S);if(B.length!==O.length)return!1;for(O=0;O<B.length;O++){var $=B[O];if(!Qt.call(S,$)||!_s(_[$],S[$]))return!1}return!0}function bc(_){switch(_.tag){case 5:return Ht(_.type);case 16:return Ht("Lazy");case 13:return Ht("Suspense");case 19:return Ht("SuspenseList");case 0:case 2:case 15:return _=Et(_.type,!1),_;case 11:return _=Et(_.type.render,!1),_;case 1:return _=Et(_.type,!0),_;default:return""}}function ws(_,S){if(_&&_.defaultProps){S=s({},S),_=_.defaultProps;for(var B in _)S[B]===void 0&&(S[B]=_[B]);return S}return S}var cs=vn(null),Ic=null,Go=null,Mc=null;function Cs(){Mc=Go=Ic=null}function Rc(_,S,B){xe?(Bt(cs,S._currentValue),S._currentValue=B):(Bt(cs,S._currentValue2),S._currentValue2=B)}function $r(_){var S=cs.current;Dt(cs),xe?_._currentValue=S:_._currentValue2=S}function us(_,S,B){for(;_!==null;){var O=_.alternate;if((_.childLanes&S)!==S?(_.childLanes|=S,O!==null&&(O.childLanes|=S)):O!==null&&(O.childLanes&S)!==S&&(O.childLanes|=S),_===B)break;_=_.return}}function Ur(_,S){Ic=_,Mc=Go=null,_=_.dependencies,_!==null&&_.firstContext!==null&&((_.lanes&S)!==0&&(Ms=!0),_.firstContext=null)}function xr(_){var S=xe?_._currentValue:_._currentValue2;if(Mc!==_)if(_={context:_,memoizedValue:S,next:null},Go===null){if(Ic===null)throw Error(o(308));Go=_,Ic.dependencies={lanes:0,firstContext:_}}else Go=Go.next=_;return S}var So=null,Pa=!1;function jf(_){_.updateQueue={baseState:_.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function GA(_,S){_=_.updateQueue,S.updateQueue===_&&(S.updateQueue={baseState:_.baseState,firstBaseUpdate:_.firstBaseUpdate,lastBaseUpdate:_.lastBaseUpdate,shared:_.shared,effects:_.effects})}function Pc(_,S){return{eventTime:_,lane:S,tag:0,payload:null,callback:null,next:null}}function Gu(_,S){var B=_.updateQueue;B!==null&&(B=B.shared,Gr!==null&&(_.mode&1)!==0&&(Jn&2)===0?(_=B.interleaved,_===null?(S.next=S,So===null?So=[B]:So.push(B)):(S.next=_.next,_.next=S),B.interleaved=S):(_=B.pending,_===null?S.next=S:(S.next=_.next,_.next=S),B.pending=S))}function S0(_,S,B){if(S=S.updateQueue,S!==null&&(S=S.shared,(B&4194240)!==0)){var O=S.lanes;O&=_.pendingLanes,B|=O,S.lanes=B,zs(_,B)}}function w0(_,S){var B=_.updateQueue,O=_.alternate;if(O!==null&&(O=O.updateQueue,B===O)){var $=null,le=null;if(B=B.firstBaseUpdate,B!==null){do{var _e={eventTime:B.eventTime,lane:B.lane,tag:B.tag,payload:B.payload,callback:B.callback,next:null};le===null?$=le=_e:le=le.next=_e,B=B.next}while(B!==null);le===null?$=le=S:le=le.next=S}else $=le=S;B={baseState:O.baseState,firstBaseUpdate:$,lastBaseUpdate:le,shared:O.shared,effects:O.effects},_.updateQueue=B;return}_=B.lastBaseUpdate,_===null?B.firstBaseUpdate=S:_.next=S,B.lastBaseUpdate=S}function C0(_,S,B,O){var $=_.updateQueue;Pa=!1;var le=$.firstBaseUpdate,_e=$.lastBaseUpdate,Ge=$.shared.pending;if(Ge!==null){$.shared.pending=null;var ht=Ge,Rt=ht.next;ht.next=null,_e===null?le=Rt:_e.next=Rt,_e=ht;var Jt=_.alternate;Jt!==null&&(Jt=Jt.updateQueue,Ge=Jt.lastBaseUpdate,Ge!==_e&&(Ge===null?Jt.firstBaseUpdate=Rt:Ge.next=Rt,Jt.lastBaseUpdate=ht))}if(le!==null){var Hn=$.baseState;_e=0,Jt=Rt=ht=null,Ge=le;do{var wn=Ge.lane,Zn=Ge.eventTime;if((O&wn)===wn){Jt!==null&&(Jt=Jt.next={eventTime:Zn,lane:0,tag:Ge.tag,payload:Ge.payload,callback:Ge.callback,next:null});e:{var Wt=_,Ws=Ge;switch(wn=S,Zn=B,Ws.tag){case 1:if(Wt=Ws.payload,typeof Wt=="function"){Hn=Wt.call(Zn,Hn,wn);break e}Hn=Wt;break e;case 3:Wt.flags=Wt.flags&-65537|128;case 0:if(Wt=Ws.payload,wn=typeof Wt=="function"?Wt.call(Zn,Hn,wn):Wt,wn==null)break e;Hn=s({},Hn,wn);break e;case 2:Pa=!0}}Ge.callback!==null&&Ge.lane!==0&&(_.flags|=64,wn=$.effects,wn===null?$.effects=[Ge]:wn.push(Ge))}else Zn={eventTime:Zn,lane:wn,tag:Ge.tag,payload:Ge.payload,callback:Ge.callback,next:null},Jt===null?(Rt=Jt=Zn,ht=Hn):Jt=Jt.next=Zn,_e|=wn;if(Ge=Ge.next,Ge===null){if(Ge=$.shared.pending,Ge===null)break;wn=Ge,Ge=wn.next,wn.next=null,$.lastBaseUpdate=wn,$.shared.pending=null}}while(!0);if(Jt===null&&(ht=Hn),$.baseState=ht,$.firstBaseUpdate=Rt,$.lastBaseUpdate=Jt,S=$.shared.interleaved,S!==null){$=S;do _e|=$.lane,$=$.next;while($!==S)}else le===null&&($.shared.lanes=0);Wl|=_e,_.lanes=_e,_.memoizedState=Hn}}function kx(_,S,B){if(_=S.effects,S.effects=null,_!==null)for(S=0;S<_.length;S++){var O=_[S],$=O.callback;if($!==null){if(O.callback=null,O=B,typeof $!="function")throw Error(o(191,$));$.call(O)}}}var Fx=new n.Component().refs;function HA(_,S,B,O){S=_.memoizedState,B=B(O,S),B=B==null?S:s({},S,B),_.memoizedState=B,_.lanes===0&&(_.updateQueue.baseState=B)}var T0={isMounted:function(_){return(_=_._reactInternals)?P(_)===_:!1},enqueueSetState:function(_,S,B){_=_._reactInternals;var O=yi(),$=ml(_),le=Pc(O,$);le.payload=S,B!=null&&(le.callback=B),Gu(_,le),S=fo(_,$,O),S!==null&&S0(S,_,$)},enqueueReplaceState:function(_,S,B){_=_._reactInternals;var O=yi(),$=ml(_),le=Pc(O,$);le.tag=1,le.payload=S,B!=null&&(le.callback=B),Gu(_,le),S=fo(_,$,O),S!==null&&S0(S,_,$)},enqueueForceUpdate:function(_,S){_=_._reactInternals;var B=yi(),O=ml(_),$=Pc(B,O);$.tag=2,S!=null&&($.callback=S),Gu(_,$),S=fo(_,O,B),S!==null&&S0(S,_,O)}};function QA(_,S,B,O,$,le,_e){return _=_.stateNode,typeof _.shouldComponentUpdate=="function"?_.shouldComponentUpdate(O,le,_e):S.prototype&&S.prototype.isPureReactComponent?!zo(B,O)||!zo($,le):!0}function Ox(_,S,B){var O=!1,$=yn,le=S.contextType;return typeof le=="object"&&le!==null?le=xr(le):($=Ei(S)?Ai:xn.current,O=S.contextTypes,le=(O=O!=null)?xi(_,$):yn),S=new S(B,le),_.memoizedState=S.state!==null&&S.state!==void 0?S.state:null,S.updater=T0,_.stateNode=S,S._reactInternals=_,O&&(_=_.stateNode,_.__reactInternalMemoizedUnmaskedChildContext=$,_.__reactInternalMemoizedMaskedChildContext=le),S}function Nx(_,S,B,O){_=S.state,typeof S.componentWillReceiveProps=="function"&&S.componentWillReceiveProps(B,O),typeof S.UNSAFE_componentWillReceiveProps=="function"&&S.UNSAFE_componentWillReceiveProps(B,O),S.state!==_&&T0.enqueueReplaceState(S,S.state,null)}function VA(_,S,B,O){var $=_.stateNode;$.props=B,$.state=_.memoizedState,$.refs=Fx,jf(_);var le=S.contextType;typeof le=="object"&&le!==null?$.context=xr(le):(le=Ei(S)?Ai:xn.current,$.context=xi(_,le)),$.state=_.memoizedState,le=S.getDerivedStateFromProps,typeof le=="function"&&(HA(_,S,le,B),$.state=_.memoizedState),typeof S.getDerivedStateFromProps=="function"||typeof $.getSnapshotBeforeUpdate=="function"||typeof $.UNSAFE_componentWillMount!="function"&&typeof $.componentWillMount!="function"||(S=$.state,typeof $.componentWillMount=="function"&&$.componentWillMount(),typeof $.UNSAFE_componentWillMount=="function"&&$.UNSAFE_componentWillMount(),S!==$.state&&T0.enqueueReplaceState($,$.state,null),C0(_,B,$,O),$.state=_.memoizedState),typeof $.componentDidMount=="function"&&(_.flags|=4194308)}var Wf=[],Hu=0,b0=null,I0=0,La=[],ra=0,Ph=null,Lc=1,Bc="";function Lh(_,S){Wf[Hu++]=I0,Wf[Hu++]=b0,b0=_,I0=S}function Ux(_,S,B){La[ra++]=Lc,La[ra++]=Bc,La[ra++]=Ph,Ph=_;var O=Lc;_=Bc;var $=32-Ri(O)-1;O&=~(1<<$),B+=1;var le=32-Ri(S)+$;if(30<le){var _e=$-$%5;le=(O&(1<<_e)-1).toString(32),O>>=_e,$-=_e,Lc=1<<32-Ri(S)+$|B<<$|O,Bc=le+_}else Lc=1<<le|B<<$|O,Bc=_}function jA(_){_.return!==null&&(Lh(_,1),Ux(_,1,0))}function WA(_){for(;_===b0;)b0=Wf[--Hu],Wf[Hu]=null,I0=Wf[--Hu],Wf[Hu]=null;for(;_===Ph;)Ph=La[--ra],La[ra]=null,Bc=La[--ra],La[ra]=null,Lc=La[--ra],La[ra]=null}var wo=null,Gs=null,fr=!1,Kf=!1,Ba=null;function KA(_,S){var B=ha(5,null,null,0);B.elementType="DELETED",B.stateNode=S,B.return=_,S=_.deletions,S===null?(_.deletions=[B],_.flags|=16):S.push(B)}function YA(_,S){switch(_.tag){case 5:return S=pn(S,_.type,_.pendingProps),S!==null?(_.stateNode=S,wo=_,Gs=An(S),!0):!1;case 6:return S=qn(S,_.pendingProps),S!==null?(_.stateNode=S,wo=_,Gs=null,!0):!1;case 13:if(S=Ci(S),S!==null){var B=Ph!==null?{id:Lc,overflow:Bc}:null;return _.memoizedState={dehydrated:S,treeContext:B,retryLane:1073741824},B=ha(18,null,null,0),B.stateNode=S,B.return=_,_.child=B,wo=_,Gs=null,!0}return!1;default:return!1}}function M0(_){return(_.mode&1)!==0&&(_.flags&128)===0}function Qu(_){if(fr){var S=Gs;if(S){var B=S;if(!YA(_,S)){if(M0(_))throw Error(o(418));S=tr(B);var O=wo;S&&YA(_,S)?KA(O,B):(_.flags=_.flags&-4097|2,fr=!1,wo=_)}}else{if(M0(_))throw Error(o(418));_.flags=_.flags&-4097|2,fr=!1,wo=_}}}function zx(_){for(_=_.return;_!==null&&_.tag!==5&&_.tag!==3&&_.tag!==13;)_=_.return;wo=_}function Sp(_){if(!Me||_!==wo)return!1;if(!fr)return zx(_),fr=!0,!1;if(_.tag!==3&&(_.tag!==5||Je(_.type)&&!J(_.type,_.memoizedProps))){var S=Gs;if(S){if(M0(_)){for(_=Gs;_;)_=tr(_);throw Error(o(418))}for(;S;)KA(_,S),S=tr(S)}}if(zx(_),_.tag===13){if(!Me)throw Error(o(316));if(_=_.memoizedState,_=_!==null?_.dehydrated:null,!_)throw Error(o(317));Gs=ce(_)}else Gs=wo?tr(_.stateNode):null;return!0}function Yf(){Me&&(Gs=wo=null,Kf=fr=!1)}function R0(_){Ba===null?Ba=[_]:Ba.push(_)}function $f(_,S,B){if(_=B.ref,_!==null&&typeof _!="function"&&typeof _!="object"){if(B._owner){if(B=B._owner,B){if(B.tag!==1)throw Error(o(309));var O=B.stateNode}if(!O)throw Error(o(147,_));var $=O,le=""+_;return S!==null&&S.ref!==null&&typeof S.ref=="function"&&S.ref._stringRef===le?S.ref:(S=function(_e){var Ge=$.refs;Ge===Fx&&(Ge=$.refs={}),_e===null?delete Ge[le]:Ge[le]=_e},S._stringRef=le,S)}if(typeof _!="string")throw Error(o(284));if(!B._owner)throw Error(o(290,_))}return _}function Vu(_,S){throw _=Object.prototype.toString.call(S),Error(o(31,_==="[object Object]"?"object with keys {"+Object.keys(S).join(", ")+"}":_))}function Xf(_){var S=_._init;return S(_._payload)}function Gx(_){function S(et,Qe){if(_){var at=et.deletions;at===null?(et.deletions=[Qe],et.flags|=16):at.push(Qe)}}function B(et,Qe){if(!_)return null;for(;Qe!==null;)S(et,Qe),Qe=Qe.sibling;return null}function O(et,Qe){for(et=new Map;Qe!==null;)Qe.key!==null?et.set(Qe.key,Qe):et.set(Qe.index,Qe),Qe=Qe.sibling;return et}function $(et,Qe){return et=Kc(et,Qe),et.index=0,et.sibling=null,et}function le(et,Qe,at){return et.index=at,_?(at=et.alternate,at!==null?(at=at.index,at<Qe?(et.flags|=2,Qe):at):(et.flags|=2,Qe)):(et.flags|=1048576,Qe)}function _e(et){return _&&et.alternate===null&&(et.flags|=2),et}function Ge(et,Qe,at,Vt){return Qe===null||Qe.tag!==6?(Qe=ig(at,et.mode,Vt),Qe.return=et,Qe):(Qe=$(Qe,at),Qe.return=et,Qe)}function ht(et,Qe,at,Vt){var on=at.type;return on===u?Jt(et,Qe,at.props.children,Vt,at.key):Qe!==null&&(Qe.elementType===on||typeof on=="object"&&on!==null&&on.$$typeof===x&&Xf(on)===Qe.type)?(Vt=$(Qe,at.props),Vt.ref=$f(et,Qe,at),Vt.return=et,Vt):(Vt=ng(at.type,at.key,at.props,null,et.mode,Vt),Vt.ref=$f(et,Qe,at),Vt.return=et,Vt)}function Rt(et,Qe,at,Vt){return Qe===null||Qe.tag!==4||Qe.stateNode.containerInfo!==at.containerInfo||Qe.stateNode.implementation!==at.implementation?(Qe=rg(at,et.mode,Vt),Qe.return=et,Qe):(Qe=$(Qe,at.children||[]),Qe.return=et,Qe)}function Jt(et,Qe,at,Vt,on){return Qe===null||Qe.tag!==7?(Qe=ef(at,et.mode,Vt,on),Qe.return=et,Qe):(Qe=$(Qe,at),Qe.return=et,Qe)}function Hn(et,Qe,at){if(typeof Qe=="string"&&Qe!==""||typeof Qe=="number")return Qe=ig(""+Qe,et.mode,at),Qe.return=et,Qe;if(typeof Qe=="object"&&Qe!==null){switch(Qe.$$typeof){case l:return at=ng(Qe.type,Qe.key,Qe.props,null,et.mode,at),at.ref=$f(et,null,Qe),at.return=et,at;case c:return Qe=rg(Qe,et.mode,at),Qe.return=et,Qe;case x:var Vt=Qe._init;return Hn(et,Vt(Qe._payload),at)}if(X(Qe)||I(Qe))return Qe=ef(Qe,et.mode,at,null),Qe.return=et,Qe;Vu(et,Qe)}return null}function wn(et,Qe,at,Vt){var on=Qe!==null?Qe.key:null;if(typeof at=="string"&&at!==""||typeof at=="number")return on!==null?null:Ge(et,Qe,""+at,Vt);if(typeof at=="object"&&at!==null){switch(at.$$typeof){case l:return at.key===on?ht(et,Qe,at,Vt):null;case c:return at.key===on?Rt(et,Qe,at,Vt):null;case x:return on=at._init,wn(et,Qe,on(at._payload),Vt)}if(X(at)||I(at))return on!==null?null:Jt(et,Qe,at,Vt,null);Vu(et,at)}return null}function Zn(et,Qe,at,Vt,on){if(typeof Vt=="string"&&Vt!==""||typeof Vt=="number")return et=et.get(at)||null,Ge(Qe,et,""+Vt,on);if(typeof Vt=="object"&&Vt!==null){switch(Vt.$$typeof){case l:return et=et.get(Vt.key===null?at:Vt.key)||null,ht(Qe,et,Vt,on);case c:return et=et.get(Vt.key===null?at:Vt.key)||null,Rt(Qe,et,Vt,on);case x:var Kn=Vt._init;return Zn(et,Qe,at,Kn(Vt._payload),on)}if(X(Vt)||I(Vt))return et=et.get(at)||null,Jt(Qe,et,Vt,on,null);Vu(Qe,Vt)}return null}function Wt(et,Qe,at,Vt){for(var on=null,Kn=null,Qn=Qe,pi=Qe=0,qr=null;Qn!==null&&pi<at.length;pi++){Qn.index>pi?(qr=Qn,Qn=null):qr=Qn.sibling;var hi=wn(et,Qn,at[pi],Vt);if(hi===null){Qn===null&&(Qn=qr);break}_&&Qn&&hi.alternate===null&&S(et,Qn),Qe=le(hi,Qe,pi),Kn===null?on=hi:Kn.sibling=hi,Kn=hi,Qn=qr}if(pi===at.length)return B(et,Qn),fr&&Lh(et,pi),on;if(Qn===null){for(;pi<at.length;pi++)Qn=Hn(et,at[pi],Vt),Qn!==null&&(Qe=le(Qn,Qe,pi),Kn===null?on=Qn:Kn.sibling=Qn,Kn=Qn);return fr&&Lh(et,pi),on}for(Qn=O(et,Qn);pi<at.length;pi++)qr=Zn(Qn,et,pi,at[pi],Vt),qr!==null&&(_&&qr.alternate!==null&&Qn.delete(qr.key===null?pi:qr.key),Qe=le(qr,Qe,pi),Kn===null?on=qr:Kn.sibling=qr,Kn=qr);return _&&Qn.forEach(function(Yc){return S(et,Yc)}),fr&&Lh(et,pi),on}function Ws(et,Qe,at,Vt){var on=I(at);if(typeof on!="function")throw Error(o(150));if(at=on.call(at),at==null)throw Error(o(151));for(var Kn=on=null,Qn=Qe,pi=Qe=0,qr=null,hi=at.next();Qn!==null&&!hi.done;pi++,hi=at.next()){Qn.index>pi?(qr=Qn,Qn=null):qr=Qn.sibling;var Yc=wn(et,Qn,hi.value,Vt);if(Yc===null){Qn===null&&(Qn=qr);break}_&&Qn&&Yc.alternate===null&&S(et,Qn),Qe=le(Yc,Qe,pi),Kn===null?on=Yc:Kn.sibling=Yc,Kn=Yc,Qn=qr}if(hi.done)return B(et,Qn),fr&&Lh(et,pi),on;if(Qn===null){for(;!hi.done;pi++,hi=at.next())hi=Hn(et,hi.value,Vt),hi!==null&&(Qe=le(hi,Qe,pi),Kn===null?on=hi:Kn.sibling=hi,Kn=hi);return fr&&Lh(et,pi),on}for(Qn=O(et,Qn);!hi.done;pi++,hi=at.next())hi=Zn(Qn,et,pi,hi.value,Vt),hi!==null&&(_&&hi.alternate!==null&&Qn.delete(hi.key===null?pi:hi.key),Qe=le(hi,Qe,pi),Kn===null?on=hi:Kn.sibling=hi,Kn=hi);return _&&Qn.forEach(function(Cy){return S(et,Cy)}),fr&&Lh(et,pi),on}function fa(et,Qe,at,Vt){if(typeof at=="object"&&at!==null&&at.type===u&&at.key===null&&(at=at.props.children),typeof at=="object"&&at!==null){switch(at.$$typeof){case l:e:{for(var on=at.key,Kn=Qe;Kn!==null;){if(Kn.key===on){if(on=at.type,on===u){if(Kn.tag===7){B(et,Kn.sibling),Qe=$(Kn,at.props.children),Qe.return=et,et=Qe;break e}}else if(Kn.elementType===on||typeof on=="object"&&on!==null&&on.$$typeof===x&&Xf(on)===Kn.type){B(et,Kn.sibling),Qe=$(Kn,at.props),Qe.ref=$f(et,Kn,at),Qe.return=et,et=Qe;break e}B(et,Kn);break}else S(et,Kn);Kn=Kn.sibling}at.type===u?(Qe=ef(at.props.children,et.mode,Vt,at.key),Qe.return=et,et=Qe):(Vt=ng(at.type,at.key,at.props,null,et.mode,Vt),Vt.ref=$f(et,Qe,at),Vt.return=et,et=Vt)}return _e(et);case c:e:{for(Kn=at.key;Qe!==null;){if(Qe.key===Kn)if(Qe.tag===4&&Qe.stateNode.containerInfo===at.containerInfo&&Qe.stateNode.implementation===at.implementation){B(et,Qe.sibling),Qe=$(Qe,at.children||[]),Qe.return=et,et=Qe;break e}else{B(et,Qe);break}else S(et,Qe);Qe=Qe.sibling}Qe=rg(at,et.mode,Vt),Qe.return=et,et=Qe}return _e(et);case x:return Kn=at._init,fa(et,Qe,Kn(at._payload),Vt)}if(X(at))return Wt(et,Qe,at,Vt);if(I(at))return Ws(et,Qe,at,Vt);Vu(et,at)}return typeof at=="string"&&at!==""||typeof at=="number"?(at=""+at,Qe!==null&&Qe.tag===6?(B(et,Qe.sibling),Qe=$(Qe,at),Qe.return=et,et=Qe):(B(et,Qe),Qe=ig(at,et.mode,Vt),Qe.return=et,et=Qe),_e(et)):B(et,Qe)}return fa}var Dc=Gx(!0),Hx=Gx(!1),qf={},Ho=vn(qf),Bh=vn(qf),Dh=vn(qf);function cl(_){if(_===qf)throw Error(o(174));return _}function P0(_,S){Bt(Dh,S),Bt(Bh,_),Bt(Ho,qf),_=oe(S),Dt(Ho),Bt(Ho,_)}function Jf(){Dt(Ho),Dt(Bh),Dt(Dh)}function Qx(_){var S=cl(Dh.current),B=cl(Ho.current);S=K(B,_.type,S),B!==S&&(Bt(Bh,_),Bt(Ho,S))}function $A(_){Bh.current===_&&(Dt(Ho),Dt(Bh))}var Er=vn(0);function L0(_){for(var S=_;S!==null;){if(S.tag===13){var B=S.memoizedState;if(B!==null&&(B=B.dehydrated,B===null||as(B)||Nr(B)))return S}else if(S.tag===19&&S.memoizedProps.revealOrder!==void 0){if((S.flags&128)!==0)return S}else if(S.child!==null){S.child.return=S,S=S.child;continue}if(S===_)break;for(;S.sibling===null;){if(S.return===null||S.return===_)return null;S=S.return}S.sibling.return=S.return,S=S.sibling}return null}var sa=[];function kh(){for(var _=0;_<sa.length;_++){var S=sa[_];xe?S._workInProgressVersionPrimary=null:S._workInProgressVersionSecondary=null}sa.length=0}var wp=a.ReactCurrentDispatcher,oa=a.ReactCurrentBatchConfig,Fh=0,_r=null,Ts=null,bs=null,B0=!1,Ql=!1,Oh=0,Cp=0;function Is(){throw Error(o(321))}function D0(_,S){if(S===null)return!1;for(var B=0;B<S.length&&B<_.length;B++)if(!_s(_[B],S[B]))return!1;return!0}function Zf(_,S,B,O,$,le){if(Fh=le,_r=S,S.memoizedState=null,S.updateQueue=null,S.lanes=0,wp.current=_===null||_.memoizedState===null?ty:ny,_=B(O,$),Ql){le=0;do{if(Ql=!1,Oh=0,25<=le)throw Error(o(301));le+=1,bs=Ts=null,S.updateQueue=null,wp.current=iy,_=B(O,$)}while(Ql)}if(wp.current=id,S=Ts!==null&&Ts.next!==null,Fh=0,bs=Ts=_r=null,B0=!1,S)throw Error(o(300));return _}function ju(){var _=Oh!==0;return Oh=0,_}function ul(){var _={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return bs===null?_r.memoizedState=bs=_:bs=bs.next=_,bs}function hl(){if(Ts===null){var _=_r.alternate;_=_!==null?_.memoizedState:null}else _=Ts.next;var S=bs===null?_r.memoizedState:bs.next;if(S!==null)bs=S,Ts=_;else{if(_===null)throw Error(o(310));Ts=_,_={memoizedState:Ts.memoizedState,baseState:Ts.baseState,baseQueue:Ts.baseQueue,queue:Ts.queue,next:null},bs===null?_r.memoizedState=bs=_:bs=bs.next=_}return bs}function Vl(_,S){return typeof S=="function"?S(_):S}function Tp(_){var S=hl(),B=S.queue;if(B===null)throw Error(o(311));B.lastRenderedReducer=_;var O=Ts,$=O.baseQueue,le=B.pending;if(le!==null){if($!==null){var _e=$.next;$.next=le.next,le.next=_e}O.baseQueue=$=le,B.pending=null}if($!==null){le=$.next,O=O.baseState;var Ge=_e=null,ht=null,Rt=le;do{var Jt=Rt.lane;if((Fh&Jt)===Jt)ht!==null&&(ht=ht.next={lane:0,action:Rt.action,hasEagerState:Rt.hasEagerState,eagerState:Rt.eagerState,next:null}),O=Rt.hasEagerState?Rt.eagerState:_(O,Rt.action);else{var Hn={lane:Jt,action:Rt.action,hasEagerState:Rt.hasEagerState,eagerState:Rt.eagerState,next:null};ht===null?(Ge=ht=Hn,_e=O):ht=ht.next=Hn,_r.lanes|=Jt,Wl|=Jt}Rt=Rt.next}while(Rt!==null&&Rt!==le);ht===null?_e=O:ht.next=Ge,_s(O,S.memoizedState)||(Ms=!0),S.memoizedState=O,S.baseState=_e,S.baseQueue=ht,B.lastRenderedState=O}if(_=B.interleaved,_!==null){$=_;do le=$.lane,_r.lanes|=le,Wl|=le,$=$.next;while($!==_)}else $===null&&(B.lanes=0);return[S.memoizedState,B.dispatch]}function bp(_){var S=hl(),B=S.queue;if(B===null)throw Error(o(311));B.lastRenderedReducer=_;var O=B.dispatch,$=B.pending,le=S.memoizedState;if($!==null){B.pending=null;var _e=$=$.next;do le=_(le,_e.action),_e=_e.next;while(_e!==$);_s(le,S.memoizedState)||(Ms=!0),S.memoizedState=le,S.baseQueue===null&&(S.baseState=le),B.lastRenderedState=le}return[le,O]}function XA(){}function qA(_,S){var B=_r,O=hl(),$=S(),le=!_s(O.memoizedState,$);if(le&&(O.memoizedState=$,Ms=!0),O=O.queue,ed(kc.bind(null,B,O,_),[_]),O.getSnapshot!==S||le||bs!==null&&bs.memoizedState.tag&1){if(B.flags|=2048,Mp(9,ZA.bind(null,B,O,$,S),void 0,null),Gr===null)throw Error(o(349));(Fh&30)!==0||JA(B,S,$)}return $}function JA(_,S,B){_.flags|=16384,_={getSnapshot:S,value:B},S=_r.updateQueue,S===null?(S={lastEffect:null,stores:null},_r.updateQueue=S,S.stores=[_]):(B=S.stores,B===null?S.stores=[_]:B.push(_))}function ZA(_,S,B,O){S.value=B,S.getSnapshot=O,k0(S)&&fo(_,1,-1)}function kc(_,S,B){return B(function(){k0(S)&&fo(_,1,-1)})}function k0(_){var S=_.getSnapshot;_=_.value;try{var B=S();return!_s(_,B)}catch{return!0}}function Ip(_){var S=ul();return typeof _=="function"&&(_=_()),S.memoizedState=S.baseState=_,_={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Vl,lastRenderedState:_},S.queue=_,_=_.dispatch=lC.bind(null,_r,_),[S.memoizedState,_]}function Mp(_,S,B,O){return _={tag:_,create:S,destroy:B,deps:O,next:null},S=_r.updateQueue,S===null?(S={lastEffect:null,stores:null},_r.updateQueue=S,S.lastEffect=_.next=_):(B=S.lastEffect,B===null?S.lastEffect=_.next=_:(O=B.next,B.next=_,_.next=O,S.lastEffect=_)),_}function Vx(){return hl().memoizedState}function Wu(_,S,B,O){var $=ul();_r.flags|=_,$.memoizedState=Mp(1|S,B,void 0,O===void 0?null:O)}function F0(_,S,B,O){var $=hl();O=O===void 0?null:O;var le=void 0;if(Ts!==null){var _e=Ts.memoizedState;if(le=_e.destroy,O!==null&&D0(O,_e.deps)){$.memoizedState=Mp(S,B,le,O);return}}_r.flags|=_,$.memoizedState=Mp(1|S,B,le,O)}function O0(_,S){return Wu(8390656,8,_,S)}function ed(_,S){return F0(2048,8,_,S)}function Yi(_,S){return F0(4,2,_,S)}function N0(_,S){return F0(4,4,_,S)}function Rp(_,S){if(typeof S=="function")return _=_(),S(_),function(){S(null)};if(S!=null)return _=_(),S.current=_,function(){S.current=null}}function td(_,S,B){return B=B!=null?B.concat([_]):null,F0(4,4,Rp.bind(null,S,_),B)}function U0(){}function z0(_,S){var B=hl();S=S===void 0?null:S;var O=B.memoizedState;return O!==null&&S!==null&&D0(S,O[1])?O[0]:(B.memoizedState=[_,S],_)}function nd(_,S){var B=hl();S=S===void 0?null:S;var O=B.memoizedState;return O!==null&&S!==null&&D0(S,O[1])?O[0]:(_=_(),B.memoizedState=[_,S],_)}function G0(_,S){var B=Fn;Fn=B!==0&&4>B?B:4,_(!0);var O=oa.transition;oa.transition={};try{_(!1),S()}finally{Fn=B,oa.transition=O}}function Nh(){return hl().memoizedState}function jx(_,S,B){var O=ml(_);B={lane:O,action:B,hasEagerState:!1,eagerState:null,next:null},Wx(_)?ey(S,B):(Pp(_,S,B),B=yi(),_=fo(_,O,B),_!==null&&Lp(_,S,O))}function lC(_,S,B){var O=ml(_),$={lane:O,action:B,hasEagerState:!1,eagerState:null,next:null};if(Wx(_))ey(S,$);else{Pp(_,S,$);var le=_.alternate;if(_.lanes===0&&(le===null||le.lanes===0)&&(le=S.lastRenderedReducer,le!==null))try{var _e=S.lastRenderedState,Ge=le(_e,B);if($.hasEagerState=!0,$.eagerState=Ge,_s(Ge,_e))return}catch{}finally{}B=yi(),_=fo(_,O,B),_!==null&&Lp(_,S,O)}}function Wx(_){var S=_.alternate;return _===_r||S!==null&&S===_r}function ey(_,S){Ql=B0=!0;var B=_.pending;B===null?S.next=S:(S.next=B.next,B.next=S),_.pending=S}function Pp(_,S,B){Gr!==null&&(_.mode&1)!==0&&(Jn&2)===0?(_=S.interleaved,_===null?(B.next=B,So===null?So=[S]:So.push(S)):(B.next=_.next,_.next=B),S.interleaved=B):(_=S.pending,_===null?B.next=B:(B.next=_.next,_.next=B),S.pending=B)}function Lp(_,S,B){if((B&4194240)!==0){var O=S.lanes;O&=_.pendingLanes,B|=O,S.lanes=B,zs(_,B)}}var id={readContext:xr,useCallback:Is,useContext:Is,useEffect:Is,useImperativeHandle:Is,useInsertionEffect:Is,useLayoutEffect:Is,useMemo:Is,useReducer:Is,useRef:Is,useState:Is,useDebugValue:Is,useDeferredValue:Is,useTransition:Is,useMutableSource:Is,useSyncExternalStore:Is,useId:Is,unstable_isNewReconciler:!1},ty={readContext:xr,useCallback:function(_,S){return ul().memoizedState=[_,S===void 0?null:S],_},useContext:xr,useEffect:O0,useImperativeHandle:function(_,S,B){return B=B!=null?B.concat([_]):null,Wu(4194308,4,Rp.bind(null,S,_),B)},useLayoutEffect:function(_,S){return Wu(4194308,4,_,S)},useInsertionEffect:function(_,S){return Wu(4,2,_,S)},useMemo:function(_,S){var B=ul();return S=S===void 0?null:S,_=_(),B.memoizedState=[_,S],_},useReducer:function(_,S,B){var O=ul();return S=B!==void 0?B(S):S,O.memoizedState=O.baseState=S,_={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:_,lastRenderedState:S},O.queue=_,_=_.dispatch=jx.bind(null,_r,_),[O.memoizedState,_]},useRef:function(_){var S=ul();return _={current:_},S.memoizedState=_},useState:Ip,useDebugValue:U0,useDeferredValue:function(_){var S=Ip(_),B=S[0],O=S[1];return O0(function(){var $=oa.transition;oa.transition={};try{O(_)}finally{oa.transition=$}},[_]),B},useTransition:function(){var _=Ip(!1),S=_[0];return _=G0.bind(null,_[1]),ul().memoizedState=_,[S,_]},useMutableSource:function(){},useSyncExternalStore:function(_,S,B){var O=_r,$=ul();if(fr){if(B===void 0)throw Error(o(407));B=B()}else{if(B=S(),Gr===null)throw Error(o(349));(Fh&30)!==0||JA(O,S,B)}$.memoizedState=B;var le={value:B,getSnapshot:S};return $.queue=le,O0(kc.bind(null,O,le,_),[_]),O.flags|=2048,Mp(9,ZA.bind(null,O,le,B,S),void 0,null),B},useId:function(){var _=ul(),S=Gr.identifierPrefix;if(fr){var B=Bc,O=Lc;B=(O&~(1<<32-Ri(O)-1)).toString(32)+B,S=":"+S+"R"+B,B=Oh++,0<B&&(S+="H"+B.toString(32)),S+=":"}else B=Cp++,S=":"+S+"r"+B.toString(32)+":";return _.memoizedState=S},unstable_isNewReconciler:!1},ny={readContext:xr,useCallback:z0,useContext:xr,useEffect:ed,useImperativeHandle:td,useInsertionEffect:Yi,useLayoutEffect:N0,useMemo:nd,useReducer:Tp,useRef:Vx,useState:function(){return Tp(Vl)},useDebugValue:U0,useDeferredValue:function(_){var S=Tp(Vl),B=S[0],O=S[1];return ed(function(){var $=oa.transition;oa.transition={};try{O(_)}finally{oa.transition=$}},[_]),B},useTransition:function(){var _=Tp(Vl)[0],S=hl().memoizedState;return[_,S]},useMutableSource:XA,useSyncExternalStore:qA,useId:Nh,unstable_isNewReconciler:!1},iy={readContext:xr,useCallback:z0,useContext:xr,useEffect:ed,useImperativeHandle:td,useInsertionEffect:Yi,useLayoutEffect:N0,useMemo:nd,useReducer:bp,useRef:Vx,useState:function(){return bp(Vl)},useDebugValue:U0,useDeferredValue:function(_){var S=bp(Vl),B=S[0],O=S[1];return ed(function(){var $=oa.transition;oa.transition={};try{O(_)}finally{oa.transition=$}},[_]),B},useTransition:function(){var _=bp(Vl)[0],S=hl().memoizedState;return[_,S]},useMutableSource:XA,useSyncExternalStore:qA,useId:Nh,unstable_isNewReconciler:!1};function ry(_,S){try{var B="",O=S;do B+=bc(O),O=O.return;while(O);var $=B}catch(le){$=`
Error generating stack: `+le.message+`
`+le.stack}return{value:_,source:S,stack:$}}function H0(_,S){try{console.error(S.value)}catch(B){setTimeout(function(){throw B})}}var cC=typeof WeakMap=="function"?WeakMap:Map;function Kx(_,S,B){B=Pc(-1,B),B.tag=3,B.payload={element:null};var O=S.value;return B.callback=function(){cd||(cd=!0,rr=O),H0(_,S)},B}function Q0(_,S,B){B=Pc(-1,B),B.tag=3;var O=_.type.getDerivedStateFromError;if(typeof O=="function"){var $=S.value;B.payload=function(){return O($)},B.callback=function(){H0(_,S)}}var le=_.stateNode;return le!==null&&typeof le.componentDidCatch=="function"&&(B.callback=function(){H0(_,S),typeof O!="function"&&(pl===null?pl=new Set([this]):pl.add(this));var _e=S.stack;this.componentDidCatch(S.value,{componentStack:_e!==null?_e:""})}),B}function Fc(_,S,B){var O=_.pingCache;if(O===null){O=_.pingCache=new cC;var $=new Set;O.set(S,$)}else $=O.get(S),$===void 0&&($=new Set,O.set(S,$));$.has(B)||($.add(B),_=_y.bind(null,_,S,B),S.then(_,_))}function sy(_){do{var S;if((S=_.tag===13)&&(S=_.memoizedState,S=S!==null?S.dehydrated!==null:!0),S)return _;_=_.return}while(_!==null);return null}function Uh(_,S,B,O,$){return(_.mode&1)===0?(_===S?_.flags|=65536:(_.flags|=128,B.flags|=131072,B.flags&=-52805,B.tag===1&&(B.alternate===null?B.tag=17:(S=Pc(-1,1),S.tag=2,Gu(B,S))),B.lanes|=1),_):(_.flags|=65536,_.lanes=$,_)}function hs(_){_.flags|=4}function rd(_,S){if(_!==null&&_.child===S.child)return!0;if((S.flags&16)!==0)return!1;for(_=S.child;_!==null;){if((_.flags&12854)!==0||(_.subtreeFlags&12854)!==0)return!1;_=_.sibling}return!0}var aa,zh,V0,j0;if(pe)aa=function(_,S){for(var B=S.child;B!==null;){if(B.tag===5||B.tag===6)Y(_,B.stateNode);else if(B.tag!==4&&B.child!==null){B.child.return=B,B=B.child;continue}if(B===S)break;for(;B.sibling===null;){if(B.return===null||B.return===S)return;B=B.return}B.sibling.return=B.return,B=B.sibling}},zh=function(){},V0=function(_,S,B,O,$){if(_=_.memoizedProps,_!==O){var le=S.stateNode,_e=cl(Ho.current);B=q(le,B,_,O,$,_e),(S.updateQueue=B)&&hs(S)}},j0=function(_,S,B,O){B!==O&&hs(S)};else if(ue){aa=function(_,S,B,O){for(var $=S.child;$!==null;){if($.tag===5){var le=$.stateNode;B&&O&&(le=dn(le,$.type,$.memoizedProps,$)),Y(_,le)}else if($.tag===6)le=$.stateNode,B&&O&&(le=Vn(le,$.memoizedProps,$)),Y(_,le);else if($.tag!==4){if($.tag===22&&$.memoizedState!==null)le=$.child,le!==null&&(le.return=$),aa(_,$,!0,!0);else if($.child!==null){$.child.return=$,$=$.child;continue}}if($===S)break;for(;$.sibling===null;){if($.return===null||$.return===S)return;$=$.return}$.sibling.return=$.return,$=$.sibling}};var Ku=function(_,S,B,O){for(var $=S.child;$!==null;){if($.tag===5){var le=$.stateNode;B&&O&&(le=dn(le,$.type,$.memoizedProps,$)),Lt(_,le)}else if($.tag===6)le=$.stateNode,B&&O&&(le=Vn(le,$.memoizedProps,$)),Lt(_,le);else if($.tag!==4){if($.tag===22&&$.memoizedState!==null)le=$.child,le!==null&&(le.return=$),Ku(_,$,!0,!0);else if($.child!==null){$.child.return=$,$=$.child;continue}}if($===S)break;for(;$.sibling===null;){if($.return===null||$.return===S)return;$=$.return}$.sibling.return=$.return,$=$.sibling}};zh=function(_,S){var B=S.stateNode;if(!rd(_,S)){_=B.containerInfo;var O=bt(_);Ku(O,S,!1,!1),B.pendingChildren=O,hs(S),qt(_,O)}},V0=function(_,S,B,O,$){var le=_.stateNode,_e=_.memoizedProps;if((_=rd(_,S))&&_e===O)S.stateNode=le;else{var Ge=S.stateNode,ht=cl(Ho.current),Rt=null;_e!==O&&(Rt=q(Ge,B,_e,O,$,ht)),_&&Rt===null?S.stateNode=le:(le=vt(le,Rt,B,_e,O,S,_,Ge),te(le,B,O,$,ht)&&hs(S),S.stateNode=le,_?hs(S):aa(le,S,!1,!1))}},j0=function(_,S,B,O){B!==O?(_=cl(Dh.current),B=cl(Ho.current),S.stateNode=re(O,_,B,S),hs(S)):S.stateNode=_.stateNode}}else zh=function(){},V0=function(){},j0=function(){};function Oc(_,S){if(!fr)switch(_.tailMode){case"hidden":S=_.tail;for(var B=null;S!==null;)S.alternate!==null&&(B=S),S=S.sibling;B===null?_.tail=null:B.sibling=null;break;case"collapsed":B=_.tail;for(var O=null;B!==null;)B.alternate!==null&&(O=B),B=B.sibling;O===null?S||_.tail===null?_.tail=null:_.tail.sibling=null:O.sibling=null}}function zr(_){var S=_.alternate!==null&&_.alternate.child===_.child,B=0,O=0;if(S)for(var $=_.child;$!==null;)B|=$.lanes|$.childLanes,O|=$.subtreeFlags&14680064,O|=$.flags&14680064,$.return=_,$=$.sibling;else for($=_.child;$!==null;)B|=$.lanes|$.childLanes,O|=$.subtreeFlags,O|=$.flags,$.return=_,$=$.sibling;return _.subtreeFlags|=O,_.childLanes=B,S}function W0(_,S,B){var O=S.pendingProps;switch(WA(S),S.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return zr(S),null;case 1:return Ei(S.type)&&Dn(),zr(S),null;case 3:return O=S.stateNode,Jf(),Dt(Sn),Dt(xn),kh(),O.pendingContext&&(O.context=O.pendingContext,O.pendingContext=null),(_===null||_.child===null)&&(Sp(S)?hs(S):_===null||_.memoizedState.isDehydrated&&(S.flags&256)===0||(S.flags|=1024,Ba!==null&&(jp(Ba),Ba=null))),zh(_,S),zr(S),null;case 5:$A(S),B=cl(Dh.current);var $=S.type;if(_!==null&&S.stateNode!=null)V0(_,S,$,O,B),_.ref!==S.ref&&(S.flags|=512,S.flags|=2097152);else{if(!O){if(S.stateNode===null)throw Error(o(166));return zr(S),null}if(_=cl(Ho.current),Sp(S)){if(!Me)throw Error(o(175));_=he(S.stateNode,S.type,S.memoizedProps,B,_,S,!Kf),S.updateQueue=_,_!==null&&hs(S)}else{var le=F($,O,B,_,S);aa(le,S,!1,!1),S.stateNode=le,te(le,$,O,B,_)&&hs(S)}S.ref!==null&&(S.flags|=512,S.flags|=2097152)}return zr(S),null;case 6:if(_&&S.stateNode!=null)j0(_,S,_.memoizedProps,O);else{if(typeof O!="string"&&S.stateNode===null)throw Error(o(166));if(_=cl(Dh.current),B=cl(Ho.current),Sp(S)){if(!Me)throw Error(o(176));if(_=S.stateNode,O=S.memoizedProps,(B=me(_,O,S,!Kf))&&($=wo,$!==null))switch(le=($.mode&1)!==0,$.tag){case 3:st($.stateNode.containerInfo,_,O,le);break;case 5:lt($.type,$.memoizedProps,$.stateNode,_,O,le)}B&&hs(S)}else S.stateNode=re(O,_,B,S)}return zr(S),null;case 13:if(Dt(Er),O=S.memoizedState,fr&&Gs!==null&&(S.mode&1)!==0&&(S.flags&128)===0){for(_=Gs;_;)_=tr(_);return Yf(),S.flags|=98560,S}if(O!==null&&O.dehydrated!==null){if(O=Sp(S),_===null){if(!O)throw Error(o(318));if(!Me)throw Error(o(344));if(_=S.memoizedState,_=_!==null?_.dehydrated:null,!_)throw Error(o(317));De(_,S)}else Yf(),(S.flags&128)===0&&(S.memoizedState=null),S.flags|=4;return zr(S),null}return Ba!==null&&(jp(Ba),Ba=null),(S.flags&128)!==0?(S.lanes=B,S):(O=O!==null,B=!1,_===null?Sp(S):B=_.memoizedState!==null,O&&!B&&(S.child.flags|=8192,(S.mode&1)!==0&&(_===null||(Er.current&1)!==0?Pr===0&&(Pr=3):Z0())),S.updateQueue!==null&&(S.flags|=4),zr(S),null);case 4:return Jf(),zh(_,S),_===null&&ve(S.stateNode.containerInfo),zr(S),null;case 10:return $r(S.type._context),zr(S),null;case 17:return Ei(S.type)&&Dn(),zr(S),null;case 19:if(Dt(Er),$=S.memoizedState,$===null)return zr(S),null;if(O=(S.flags&128)!==0,le=$.rendering,le===null)if(O)Oc($,!1);else{if(Pr!==0||_!==null&&(_.flags&128)!==0)for(_=S.child;_!==null;){if(le=L0(_),le!==null){for(S.flags|=128,Oc($,!1),_=le.updateQueue,_!==null&&(S.updateQueue=_,S.flags|=4),S.subtreeFlags=0,_=B,O=S.child;O!==null;)B=O,$=_,B.flags&=14680066,le=B.alternate,le===null?(B.childLanes=0,B.lanes=$,B.child=null,B.subtreeFlags=0,B.memoizedProps=null,B.memoizedState=null,B.updateQueue=null,B.dependencies=null,B.stateNode=null):(B.childLanes=le.childLanes,B.lanes=le.lanes,B.child=le.child,B.subtreeFlags=0,B.deletions=null,B.memoizedProps=le.memoizedProps,B.memoizedState=le.memoizedState,B.updateQueue=le.updateQueue,B.type=le.type,$=le.dependencies,B.dependencies=$===null?null:{lanes:$.lanes,firstContext:$.firstContext}),O=O.sibling;return Bt(Er,Er.current&1|2),S.child}_=_.sibling}$.tail!==null&&hr()>Xu&&(S.flags|=128,O=!0,Oc($,!1),S.lanes=4194304)}else{if(!O)if(_=L0(le),_!==null){if(S.flags|=128,O=!0,_=_.updateQueue,_!==null&&(S.updateQueue=_,S.flags|=4),Oc($,!0),$.tail===null&&$.tailMode==="hidden"&&!le.alternate&&!fr)return zr(S),null}else 2*hr()-$.renderingStartTime>Xu&&B!==1073741824&&(S.flags|=128,O=!0,Oc($,!1),S.lanes=4194304);$.isBackwards?(le.sibling=S.child,S.child=le):(_=$.last,_!==null?_.sibling=le:S.child=le,$.last=le)}return $.tail!==null?(S=$.tail,$.rendering=S,$.tail=S.sibling,$.renderingStartTime=hr(),S.sibling=null,_=Er.current,Bt(Er,O?_&1|2:_&1),S):(zr(S),null);case 22:case 23:return Wp(),O=S.memoizedState!==null,_!==null&&_.memoizedState!==null!==O&&(S.flags|=8192),O&&(S.mode&1)!==0?(ho&1073741824)!==0&&(zr(S),pe&&S.subtreeFlags&6&&(S.flags|=8192)):zr(S),null;case 24:return null;case 25:return null}throw Error(o(156,S.tag))}var oy=a.ReactCurrentOwner,Ms=!1;function Rr(_,S,B,O){S.child=_===null?Hx(S,null,B,O):Dc(S,_.child,B,O)}function $i(_,S,B,O,$){B=B.render;var le=S.ref;return Ur(S,$),O=Zf(_,S,B,O,le,$),B=ju(),_!==null&&!Ms?(S.updateQueue=_.updateQueue,S.flags&=-2053,_.lanes&=~$,Qo(_,S,$)):(fr&&B&&jA(S),S.flags|=1,Rr(_,S,O,$),S.child)}function Gi(_,S,B,O,$){if(_===null){var le=B.type;return typeof le=="function"&&!tg(le)&&le.defaultProps===void 0&&B.compare===null&&B.defaultProps===void 0?(S.tag=15,S.type=le,Nc(_,S,le,O,$)):(_=ng(B.type,null,O,S,S.mode,$),_.ref=S.ref,_.return=S,S.child=_)}if(le=_.child,(_.lanes&$)===0){var _e=le.memoizedProps;if(B=B.compare,B=B!==null?B:zo,B(_e,O)&&_.ref===S.ref)return Qo(_,S,$)}return S.flags|=1,_=Kc(le,O),_.ref=S.ref,_.return=S,S.child=_}function Nc(_,S,B,O,$){if(_!==null&&zo(_.memoizedProps,O)&&_.ref===S.ref)if(Ms=!1,(_.lanes&$)!==0)(_.flags&131072)!==0&&(Ms=!0);else return S.lanes=_.lanes,Qo(_,S,$);return Uc(_,S,B,O,$)}function Hs(_,S,B){var O=S.pendingProps,$=O.children,le=_!==null?_.memoizedState:null;if(O.mode==="hidden")if((S.mode&1)===0)S.memoizedState={baseLanes:0,cachePool:null},Bt($h,ho),ho|=B;else if((B&1073741824)!==0)S.memoizedState={baseLanes:0,cachePool:null},O=le!==null?le.baseLanes:B,Bt($h,ho),ho|=O;else return _=le!==null?le.baseLanes|B:B,S.lanes=S.childLanes=1073741824,S.memoizedState={baseLanes:_,cachePool:null},S.updateQueue=null,Bt($h,ho),ho|=_,null;else le!==null?(O=le.baseLanes|B,S.memoizedState=null):O=B,Bt($h,ho),ho|=O;return Rr(_,S,$,B),S.child}function Co(_,S){var B=S.ref;(_===null&&B!==null||_!==null&&_.ref!==B)&&(S.flags|=512,S.flags|=2097152)}function Uc(_,S,B,O,$){var le=Ei(B)?Ai:xn.current;return le=xi(S,le),Ur(S,$),B=Zf(_,S,B,O,le,$),O=ju(),_!==null&&!Ms?(S.updateQueue=_.updateQueue,S.flags&=-2053,_.lanes&=~$,Qo(_,S,$)):(fr&&O&&jA(S),S.flags|=1,Rr(_,S,B,$),S.child)}function Gh(_,S,B,O,$){if(Ei(B)){var le=!0;Bn(S)}else le=!1;if(Ur(S,$),S.stateNode===null)_!==null&&(_.alternate=null,S.alternate=null,S.flags|=2),Ox(S,B,O),VA(S,B,O,$),O=!0;else if(_===null){var _e=S.stateNode,Ge=S.memoizedProps;_e.props=Ge;var ht=_e.context,Rt=B.contextType;typeof Rt=="object"&&Rt!==null?Rt=xr(Rt):(Rt=Ei(B)?Ai:xn.current,Rt=xi(S,Rt));var Jt=B.getDerivedStateFromProps,Hn=typeof Jt=="function"||typeof _e.getSnapshotBeforeUpdate=="function";Hn||typeof _e.UNSAFE_componentWillReceiveProps!="function"&&typeof _e.componentWillReceiveProps!="function"||(Ge!==O||ht!==Rt)&&Nx(S,_e,O,Rt),Pa=!1;var wn=S.memoizedState;_e.state=wn,C0(S,O,_e,$),ht=S.memoizedState,Ge!==O||wn!==ht||Sn.current||Pa?(typeof Jt=="function"&&(HA(S,B,Jt,O),ht=S.memoizedState),(Ge=Pa||QA(S,B,Ge,O,wn,ht,Rt))?(Hn||typeof _e.UNSAFE_componentWillMount!="function"&&typeof _e.componentWillMount!="function"||(typeof _e.componentWillMount=="function"&&_e.componentWillMount(),typeof _e.UNSAFE_componentWillMount=="function"&&_e.UNSAFE_componentWillMount()),typeof _e.componentDidMount=="function"&&(S.flags|=4194308)):(typeof _e.componentDidMount=="function"&&(S.flags|=4194308),S.memoizedProps=O,S.memoizedState=ht),_e.props=O,_e.state=ht,_e.context=Rt,O=Ge):(typeof _e.componentDidMount=="function"&&(S.flags|=4194308),O=!1)}else{_e=S.stateNode,GA(_,S),Ge=S.memoizedProps,Rt=S.type===S.elementType?Ge:ws(S.type,Ge),_e.props=Rt,Hn=S.pendingProps,wn=_e.context,ht=B.contextType,typeof ht=="object"&&ht!==null?ht=xr(ht):(ht=Ei(B)?Ai:xn.current,ht=xi(S,ht));var Zn=B.getDerivedStateFromProps;(Jt=typeof Zn=="function"||typeof _e.getSnapshotBeforeUpdate=="function")||typeof _e.UNSAFE_componentWillReceiveProps!="function"&&typeof _e.componentWillReceiveProps!="function"||(Ge!==Hn||wn!==ht)&&Nx(S,_e,O,ht),Pa=!1,wn=S.memoizedState,_e.state=wn,C0(S,O,_e,$);var Wt=S.memoizedState;Ge!==Hn||wn!==Wt||Sn.current||Pa?(typeof Zn=="function"&&(HA(S,B,Zn,O),Wt=S.memoizedState),(Rt=Pa||QA(S,B,Rt,O,wn,Wt,ht)||!1)?(Jt||typeof _e.UNSAFE_componentWillUpdate!="function"&&typeof _e.componentWillUpdate!="function"||(typeof _e.componentWillUpdate=="function"&&_e.componentWillUpdate(O,Wt,ht),typeof _e.UNSAFE_componentWillUpdate=="function"&&_e.UNSAFE_componentWillUpdate(O,Wt,ht)),typeof _e.componentDidUpdate=="function"&&(S.flags|=4),typeof _e.getSnapshotBeforeUpdate=="function"&&(S.flags|=1024)):(typeof _e.componentDidUpdate!="function"||Ge===_.memoizedProps&&wn===_.memoizedState||(S.flags|=4),typeof _e.getSnapshotBeforeUpdate!="function"||Ge===_.memoizedProps&&wn===_.memoizedState||(S.flags|=1024),S.memoizedProps=O,S.memoizedState=Wt),_e.props=O,_e.state=Wt,_e.context=ht,O=Rt):(typeof _e.componentDidUpdate!="function"||Ge===_.memoizedProps&&wn===_.memoizedState||(S.flags|=4),typeof _e.getSnapshotBeforeUpdate!="function"||Ge===_.memoizedProps&&wn===_.memoizedState||(S.flags|=1024),O=!1)}return uo(_,S,B,O,le,$)}function uo(_,S,B,O,$,le){Co(_,S);var _e=(S.flags&128)!==0;if(!O&&!_e)return $&&Pn(S,B,!1),Qo(_,S,le);O=S.stateNode,oy.current=S;var Ge=_e&&typeof B.getDerivedStateFromError!="function"?null:O.render();return S.flags|=1,_!==null&&_e?(S.child=Dc(S,_.child,null,le),S.child=Dc(S,null,Ge,le)):Rr(_,S,Ge,le),S.memoizedState=O.state,$&&Pn(S,B,!0),S.child}function Bp(_){var S=_.stateNode;S.pendingContext?kn(_,S.pendingContext,S.pendingContext!==S.context):S.context&&kn(_,S.context,!1),P0(_,S.containerInfo)}function ay(_,S,B,O,$){return Yf(),R0($),S.flags|=256,Rr(_,S,B,O),S.child}var Dp={dehydrated:null,treeContext:null,retryLane:0};function Hh(_){return{baseLanes:_,cachePool:null}}function ly(_,S,B){var O=S.pendingProps,$=Er.current,le=!1,_e=(S.flags&128)!==0,Ge;if((Ge=_e)||(Ge=_!==null&&_.memoizedState===null?!1:($&2)!==0),Ge?(le=!0,S.flags&=-129):(_===null||_.memoizedState!==null)&&($|=1),Bt(Er,$&1),_===null)return Qu(S),_=S.memoizedState,_!==null&&(_=_.dehydrated,_!==null)?((S.mode&1)===0?S.lanes=1:Nr(_)?S.lanes=8:S.lanes=1073741824,null):($=O.children,_=O.fallback,le?(O=S.mode,le=S.child,$={mode:"hidden",children:$},(O&1)===0&&le!==null?(le.childLanes=0,le.pendingProps=$):le=$p($,O,0,null),_=ef(_,O,B,null),le.return=S,_.return=S,le.sibling=_,S.child=le,S.child.memoizedState=Hh(B),S.memoizedState=Dp,_):fl(S,$));if($=_.memoizedState,$!==null){if(Ge=$.dehydrated,Ge!==null){if(_e)return S.flags&256?(S.flags&=-257,Fp(_,S,B,Error(o(422)))):S.memoizedState!==null?(S.child=_.child,S.flags|=128,null):(le=O.fallback,$=S.mode,O=$p({mode:"visible",children:O.children},$,0,null),le=ef(le,$,B,null),le.flags|=2,O.return=S,le.return=S,O.sibling=le,S.child=O,(S.mode&1)!==0&&Dc(S,_.child,null,B),S.child.memoizedState=Hh(B),S.memoizedState=Dp,le);if((S.mode&1)===0)S=Fp(_,S,B,null);else if(Nr(Ge))S=Fp(_,S,B,Error(o(419)));else if(O=(B&_.childLanes)!==0,Ms||O){if(O=Gr,O!==null){switch(B&-B){case 4:le=2;break;case 16:le=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:le=32;break;case 536870912:le=268435456;break;default:le=0}O=(le&(O.suspendedLanes|B))!==0?0:le,O!==0&&O!==$.retryLane&&($.retryLane=O,fo(_,O,-1))}Z0(),S=Fp(_,S,B,Error(o(421)))}else as(Ge)?(S.flags|=128,S.child=_.child,S=Jx.bind(null,_),ur(Ge,S),S=null):(B=$.treeContext,Me&&(Gs=Uo(Ge),wo=S,fr=!0,Ba=null,Kf=!1,B!==null&&(La[ra++]=Lc,La[ra++]=Bc,La[ra++]=Ph,Lc=B.id,Bc=B.overflow,Ph=S)),S=fl(S,S.pendingProps.children),S.flags|=4096);return S}return le?(O=K0(_,S,O.children,O.fallback,B),le=S.child,$=_.child.memoizedState,le.memoizedState=$===null?Hh(B):{baseLanes:$.baseLanes|B,cachePool:null},le.childLanes=_.childLanes&~B,S.memoizedState=Dp,O):(B=kp(_,S,O.children,B),S.memoizedState=null,B)}return le?(O=K0(_,S,O.children,O.fallback,B),le=S.child,$=_.child.memoizedState,le.memoizedState=$===null?Hh(B):{baseLanes:$.baseLanes|B,cachePool:null},le.childLanes=_.childLanes&~B,S.memoizedState=Dp,O):(B=kp(_,S,O.children,B),S.memoizedState=null,B)}function fl(_,S){return S=$p({mode:"visible",children:S},_.mode,0,null),S.return=_,_.child=S}function kp(_,S,B,O){var $=_.child;return _=$.sibling,B=Kc($,{mode:"visible",children:B}),(S.mode&1)===0&&(B.lanes=O),B.return=S,B.sibling=null,_!==null&&(O=S.deletions,O===null?(S.deletions=[_],S.flags|=16):O.push(_)),S.child=B}function K0(_,S,B,O,$){var le=S.mode;_=_.child;var _e=_.sibling,Ge={mode:"hidden",children:B};return(le&1)===0&&S.child!==_?(B=S.child,B.childLanes=0,B.pendingProps=Ge,S.deletions=null):(B=Kc(_,Ge),B.subtreeFlags=_.subtreeFlags&14680064),_e!==null?O=Kc(_e,O):(O=ef(O,le,$,null),O.flags|=2),O.return=S,B.return=S,B.sibling=O,S.child=B,O}function Fp(_,S,B,O){return O!==null&&R0(O),Dc(S,_.child,null,B),_=fl(S,S.pendingProps.children),_.flags|=2,S.memoizedState=null,_}function Yx(_,S,B){_.lanes|=S;var O=_.alternate;O!==null&&(O.lanes|=S),us(_.return,S,B)}function jl(_,S,B,O,$){var le=_.memoizedState;le===null?_.memoizedState={isBackwards:S,rendering:null,renderingStartTime:0,last:O,tail:B,tailMode:$}:(le.isBackwards=S,le.rendering=null,le.renderingStartTime=0,le.last=O,le.tail=B,le.tailMode=$)}function Qh(_,S,B){var O=S.pendingProps,$=O.revealOrder,le=O.tail;if(Rr(_,S,O.children,B),O=Er.current,(O&2)!==0)O=O&1|2,S.flags|=128;else{if(_!==null&&(_.flags&128)!==0)e:for(_=S.child;_!==null;){if(_.tag===13)_.memoizedState!==null&&Yx(_,B,S);else if(_.tag===19)Yx(_,B,S);else if(_.child!==null){_.child.return=_,_=_.child;continue}if(_===S)break e;for(;_.sibling===null;){if(_.return===null||_.return===S)break e;_=_.return}_.sibling.return=_.return,_=_.sibling}O&=1}if(Bt(Er,O),(S.mode&1)===0)S.memoizedState=null;else switch($){case"forwards":for(B=S.child,$=null;B!==null;)_=B.alternate,_!==null&&L0(_)===null&&($=B),B=B.sibling;B=$,B===null?($=S.child,S.child=null):($=B.sibling,B.sibling=null),jl(S,!1,$,B,le);break;case"backwards":for(B=null,$=S.child,S.child=null;$!==null;){if(_=$.alternate,_!==null&&L0(_)===null){S.child=$;break}_=$.sibling,$.sibling=B,B=$,$=_}jl(S,!0,B,null,le);break;case"together":jl(S,!1,null,null,void 0);break;default:S.memoizedState=null}return S.child}function Qo(_,S,B){if(_!==null&&(S.dependencies=_.dependencies),Wl|=S.lanes,(B&S.childLanes)===0)return null;if(_!==null&&S.child!==_.child)throw Error(o(153));if(S.child!==null){for(_=S.child,B=Kc(_,_.pendingProps),S.child=B,B.return=S;_.sibling!==null;)_=_.sibling,B=B.sibling=Kc(_,_.pendingProps),B.return=S;B.sibling=null}return S.child}function Y0(_,S,B){switch(S.tag){case 3:Bp(S),Yf();break;case 5:Qx(S);break;case 1:Ei(S.type)&&Bn(S);break;case 4:P0(S,S.stateNode.containerInfo);break;case 10:Rc(S,S.type._context,S.memoizedProps.value);break;case 13:var O=S.memoizedState;if(O!==null)return O.dehydrated!==null?(Bt(Er,Er.current&1),S.flags|=128,null):(B&S.child.childLanes)!==0?ly(_,S,B):(Bt(Er,Er.current&1),_=Qo(_,S,B),_!==null?_.sibling:null);Bt(Er,Er.current&1);break;case 19:if(O=(B&S.childLanes)!==0,(_.flags&128)!==0){if(O)return Qh(_,S,B);S.flags|=128}var $=S.memoizedState;if($!==null&&($.rendering=null,$.tail=null,$.lastEffect=null),Bt(Er,Er.current),O)break;return null;case 22:case 23:return S.lanes=0,Hs(_,S,B)}return Qo(_,S,B)}function $0(_,S){switch(WA(S),S.tag){case 1:return Ei(S.type)&&Dn(),_=S.flags,_&65536?(S.flags=_&-65537|128,S):null;case 3:return Jf(),Dt(Sn),Dt(xn),kh(),_=S.flags,(_&65536)!==0&&(_&128)===0?(S.flags=_&-65537|128,S):null;case 5:return $A(S),null;case 13:if(Dt(Er),_=S.memoizedState,_!==null&&_.dehydrated!==null){if(S.alternate===null)throw Error(o(340));Yf()}return _=S.flags,_&65536?(S.flags=_&-65537|128,S):null;case 19:return Dt(Er),null;case 4:return Jf(),null;case 10:return $r(S.type._context),null;case 22:case 23:return Wp(),null;case 24:return null;default:return null}}var To=!1,Rs=!1,Vh=typeof WeakSet=="function"?WeakSet:Set,kt=null;function Da(_,S){var B=_.ref;if(B!==null)if(typeof B=="function")try{B(null)}catch(O){Io(_,S,O)}else B.current=null}function zc(_,S,B){try{B()}catch(O){Io(_,S,O)}}var cy=!1;function uy(_,S){for(V(_.containerInfo),kt=S;kt!==null;)if(_=kt,S=_.child,(_.subtreeFlags&1028)!==0&&S!==null)S.return=_,kt=S;else for(;kt!==null;){_=kt;try{var B=_.alternate;if((_.flags&1024)!==0)switch(_.tag){case 0:case 11:case 15:break;case 1:if(B!==null){var O=B.memoizedProps,$=B.memoizedState,le=_.stateNode,_e=le.getSnapshotBeforeUpdate(_.elementType===_.type?O:ws(_.type,O),$);le.__reactInternalSnapshotBeforeUpdate=_e}break;case 3:pe&&_t(_.stateNode.containerInfo);break;case 5:case 6:case 4:case 17:break;default:throw Error(o(163))}}catch(Ge){Io(_,_.return,Ge)}if(S=_.sibling,S!==null){S.return=_.return,kt=S;break}kt=_.return}return B=cy,cy=!1,B}function Gc(_,S,B){var O=S.updateQueue;if(O=O!==null?O.lastEffect:null,O!==null){var $=O=O.next;do{if(($.tag&_)===_){var le=$.destroy;$.destroy=void 0,le!==void 0&&zc(S,B,le)}$=$.next}while($!==O)}}function Qs(_,S){if(S=S.updateQueue,S=S!==null?S.lastEffect:null,S!==null){var B=S=S.next;do{if((B.tag&_)===_){var O=B.create;B.destroy=O()}B=B.next}while(B!==S)}}function bo(_){var S=_.ref;if(S!==null){var B=_.stateNode;switch(_.tag){case 5:_=Z(B);break;default:_=B}typeof S=="function"?S(_):S.current=_}}function ir(_,S,B){if(ia&&typeof ia.onCommitFiberUnmount=="function")try{ia.onCommitFiberUnmount(Ou,S)}catch{}switch(S.tag){case 0:case 11:case 14:case 15:if(_=S.updateQueue,_!==null&&(_=_.lastEffect,_!==null)){var O=_=_.next;do{var $=O,le=$.destroy;$=$.tag,le!==void 0&&(($&2)!==0||($&4)!==0)&&zc(S,B,le),O=O.next}while(O!==_)}break;case 1:if(Da(S,B),_=S.stateNode,typeof _.componentWillUnmount=="function")try{_.props=S.memoizedProps,_.state=S.memoizedState,_.componentWillUnmount()}catch(_e){Io(S,B,_e)}break;case 5:Da(S,B);break;case 4:pe?dy(_,S,B):ue&&ue&&(S=S.stateNode.containerInfo,B=bt(S),Nt(S,B))}}function ka(_,S,B){for(var O=S;;)if(ir(_,O,B),O.child===null||pe&&O.tag===4){if(O===S)break;for(;O.sibling===null;){if(O.return===null||O.return===S)return;O=O.return}O.sibling.return=O.return,O=O.sibling}else O.child.return=O,O=O.child}function hy(_){var S=_.alternate;S!==null&&(_.alternate=null,hy(S)),_.child=null,_.deletions=null,_.sibling=null,_.tag===5&&(S=_.stateNode,S!==null&&ke(S)),_.stateNode=null,_.return=null,_.dependencies=null,_.memoizedProps=null,_.memoizedState=null,_.pendingProps=null,_.stateNode=null,_.updateQueue=null}function fy(_){return _.tag===5||_.tag===3||_.tag===4}function X0(_){e:for(;;){for(;_.sibling===null;){if(_.return===null||fy(_.return))return null;_=_.return}for(_.sibling.return=_.return,_=_.sibling;_.tag!==5&&_.tag!==6&&_.tag!==18;){if(_.flags&2||_.child===null||_.tag===4)continue e;_.child.return=_,_=_.child}if(!(_.flags&2))return _.stateNode}}function q0(_){if(pe){e:{for(var S=_.return;S!==null;){if(fy(S))break e;S=S.return}throw Error(o(160))}var B=S;switch(B.tag){case 5:S=B.stateNode,B.flags&32&&(qe(S),B.flags&=-33),B=X0(_),sd(_,B,S);break;case 3:case 4:S=B.stateNode.containerInfo,B=X0(_),J0(_,B,S);break;default:throw Error(o(161))}}}function J0(_,S,B){var O=_.tag;if(O===5||O===6)_=_.stateNode,S?gt(B,_,S):pt(B,_);else if(O!==4&&(_=_.child,_!==null))for(J0(_,S,B),_=_.sibling;_!==null;)J0(_,S,B),_=_.sibling}function sd(_,S,B){var O=_.tag;if(O===5||O===6)_=_.stateNode,S?St(B,_,S):ct(B,_);else if(O!==4&&(_=_.child,_!==null))for(sd(_,S,B),_=_.sibling;_!==null;)sd(_,S,B),_=_.sibling}function dy(_,S,B){for(var O=S,$=!1,le,_e;;){if(!$){$=O.return;e:for(;;){if($===null)throw Error(o(160));switch(le=$.stateNode,$.tag){case 5:_e=!1;break e;case 3:le=le.containerInfo,_e=!0;break e;case 4:le=le.containerInfo,_e=!0;break e}$=$.return}$=!0}if(O.tag===5||O.tag===6)ka(_,O,B),_e?Ce(le,O.stateNode):ft(le,O.stateNode);else if(O.tag===18)_e?Ie(le,O.stateNode):Pe(le,O.stateNode);else if(O.tag===4){if(O.child!==null){le=O.stateNode.containerInfo,_e=!0,O.child.return=O,O=O.child;continue}}else if(ir(_,O,B),O.child!==null){O.child.return=O,O=O.child;continue}if(O===S)break;for(;O.sibling===null;){if(O.return===null||O.return===S)return;O=O.return,O.tag===4&&($=!1)}O.sibling.return=O.return,O=O.sibling}}function Yu(_,S){if(pe){switch(S.tag){case 0:case 11:case 14:case 15:Gc(3,S,S.return),Qs(3,S),Gc(5,S,S.return);return;case 1:return;case 5:var B=S.stateNode;if(B!=null){var O=S.memoizedProps;_=_!==null?_.memoizedProps:O;var $=S.type,le=S.updateQueue;S.updateQueue=null,le!==null&&Ft(B,le,$,_,O,S)}return;case 6:if(S.stateNode===null)throw Error(o(162));B=S.memoizedProps,je(S.stateNode,_!==null?_.memoizedProps:B,B);return;case 3:Me&&_!==null&&_.memoizedState.isDehydrated&&ye(S.stateNode.containerInfo);return;case 12:return;case 13:od(S);return;case 19:od(S);return;case 17:return}throw Error(o(163))}switch(S.tag){case 0:case 11:case 14:case 15:Gc(3,S,S.return),Qs(3,S),Gc(5,S,S.return);return;case 12:return;case 13:od(S);return;case 19:od(S);return;case 3:Me&&_!==null&&_.memoizedState.isDehydrated&&ye(S.stateNode.containerInfo);break;case 22:case 23:return}e:if(ue){switch(S.tag){case 1:case 5:case 6:break e;case 3:case 4:S=S.stateNode,Nt(S.containerInfo,S.pendingChildren);break e}throw Error(o(163))}}function od(_){var S=_.updateQueue;if(S!==null){_.updateQueue=null;var B=_.stateNode;B===null&&(B=_.stateNode=new Vh),S.forEach(function(O){var $=Zx.bind(null,_,O);B.has(O)||(B.add(O),O.then($,$))})}}function uC(_,S){for(kt=S;kt!==null;){S=kt;var B=S.deletions;if(B!==null)for(var O=0;O<B.length;O++){var $=B[O];try{var le=_;pe?dy(le,$,S):ka(le,$,S);var _e=$.alternate;_e!==null&&(_e.return=null),$.return=null}catch(on){Io($,S,on)}}if(B=S.child,(S.subtreeFlags&12854)!==0&&B!==null)B.return=S,kt=B;else for(;kt!==null;){S=kt;try{var Ge=S.flags;if(Ge&32&&pe&&qe(S.stateNode),Ge&512){var ht=S.alternate;if(ht!==null){var Rt=ht.ref;Rt!==null&&(typeof Rt=="function"?Rt(null):Rt.current=null)}}if(Ge&8192)switch(S.tag){case 13:if(S.memoizedState!==null){var Jt=S.alternate;(Jt===null||Jt.memoizedState===null)&&(Qp=hr())}break;case 22:var Hn=S.memoizedState!==null,wn=S.alternate,Zn=wn!==null&&wn.memoizedState!==null;if(B=S,pe){e:if(O=B,$=Hn,le=null,pe)for(var Wt=O;;){if(Wt.tag===5){if(le===null){le=Wt;var Ws=Wt.stateNode;$?At(Ws):Be(Wt.stateNode,Wt.memoizedProps)}}else if(Wt.tag===6){if(le===null){var fa=Wt.stateNode;$?yt(fa):we(fa,Wt.memoizedProps)}}else if((Wt.tag!==22&&Wt.tag!==23||Wt.memoizedState===null||Wt===O)&&Wt.child!==null){Wt.child.return=Wt,Wt=Wt.child;continue}if(Wt===O)break;for(;Wt.sibling===null;){if(Wt.return===null||Wt.return===O)break e;le===Wt&&(le=null),Wt=Wt.return}le===Wt&&(le=null),Wt.sibling.return=Wt.return,Wt=Wt.sibling}}if(Hn&&!Zn&&(B.mode&1)!==0){kt=B;for(var et=B.child;et!==null;){for(B=kt=et;kt!==null;){O=kt;var Qe=O.child;switch(O.tag){case 0:case 11:case 14:case 15:Gc(4,O,O.return);break;case 1:Da(O,O.return);var at=O.stateNode;if(typeof at.componentWillUnmount=="function"){var Vt=O.return;try{at.props=O.memoizedProps,at.state=O.memoizedState,at.componentWillUnmount()}catch(on){Io(O,Vt,on)}}break;case 5:Da(O,O.return);break;case 22:if(O.memoizedState!==null){my(B);continue}}Qe!==null?(Qe.return=O,kt=Qe):my(B)}et=et.sibling}}}switch(Ge&4102){case 2:q0(S),S.flags&=-3;break;case 6:q0(S),S.flags&=-3,Yu(S.alternate,S);break;case 4096:S.flags&=-4097;break;case 4100:S.flags&=-4097,Yu(S.alternate,S);break;case 4:Yu(S.alternate,S)}}catch(on){Io(S,S.return,on)}if(B=S.sibling,B!==null){B.return=S.return,kt=B;break}kt=S.return}}}function Op(_,S,B){kt=_,Np(_)}function Np(_,S,B){for(var O=(_.mode&1)!==0;kt!==null;){var $=kt,le=$.child;if($.tag===22&&O){var _e=$.memoizedState!==null||To;if(!_e){var Ge=$.alternate,ht=Ge!==null&&Ge.memoizedState!==null||Rs;Ge=To;var Rt=Rs;if(To=_e,(Rs=ht)&&!Rt)for(kt=$;kt!==null;)_e=kt,ht=_e.child,_e.tag===22&&_e.memoizedState!==null?jh($):ht!==null?(ht.return=_e,kt=ht):jh($);for(;le!==null;)kt=le,Np(le),le=le.sibling;kt=$,To=Ge,Rs=Rt}py(_)}else($.subtreeFlags&8772)!==0&&le!==null?(le.return=$,kt=le):py(_)}}function py(_){for(;kt!==null;){var S=kt;if((S.flags&8772)!==0){var B=S.alternate;try{if((S.flags&8772)!==0)switch(S.tag){case 0:case 11:case 15:Rs||Qs(5,S);break;case 1:var O=S.stateNode;if(S.flags&4&&!Rs)if(B===null)O.componentDidMount();else{var $=S.elementType===S.type?B.memoizedProps:ws(S.type,B.memoizedProps);O.componentDidUpdate($,B.memoizedState,O.__reactInternalSnapshotBeforeUpdate)}var le=S.updateQueue;le!==null&&kx(S,le,O);break;case 3:var _e=S.updateQueue;if(_e!==null){if(B=null,S.child!==null)switch(S.child.tag){case 5:B=Z(S.child.stateNode);break;case 1:B=S.child.stateNode}kx(S,_e,B)}break;case 5:var Ge=S.stateNode;B===null&&S.flags&4&&Mt(Ge,S.type,S.memoizedProps,S);break;case 6:break;case 4:break;case 12:break;case 13:if(Me&&S.memoizedState===null){var ht=S.alternate;if(ht!==null){var Rt=ht.memoizedState;if(Rt!==null){var Jt=Rt.dehydrated;Jt!==null&&Ee(Jt)}}}break;case 19:case 17:case 21:case 22:case 23:break;default:throw Error(o(163))}Rs||S.flags&512&&bo(S)}catch(Hn){Io(S,S.return,Hn)}}if(S===_){kt=null;break}if(B=S.sibling,B!==null){B.return=S.return,kt=B;break}kt=S.return}}function my(_){for(;kt!==null;){var S=kt;if(S===_){kt=null;break}var B=S.sibling;if(B!==null){B.return=S.return,kt=B;break}kt=S.return}}function jh(_){for(;kt!==null;){var S=kt;try{switch(S.tag){case 0:case 11:case 15:var B=S.return;try{Qs(4,S)}catch(ht){Io(S,B,ht)}break;case 1:var O=S.stateNode;if(typeof O.componentDidMount=="function"){var $=S.return;try{O.componentDidMount()}catch(ht){Io(S,$,ht)}}var le=S.return;try{bo(S)}catch(ht){Io(S,le,ht)}break;case 5:var _e=S.return;try{bo(S)}catch(ht){Io(S,_e,ht)}}}catch(ht){Io(S,S.return,ht)}if(S===_){kt=null;break}var Ge=S.sibling;if(Ge!==null){Ge.return=S.return,kt=Ge;break}kt=S.return}}var Up=0,Wh=1,Kh=2,Hc=3,ad=4;if(typeof Symbol=="function"&&Symbol.for){var Yh=Symbol.for;Up=Yh("selector.component"),Wh=Yh("selector.has_pseudo_class"),Kh=Yh("selector.role"),Hc=Yh("selector.test_id"),ad=Yh("selector.text")}function zp(_){var S=Se(_);if(S!=null){if(typeof S.memoizedProps["data-testname"]!="string")throw Error(o(364));return S}if(_=de(_),_===null)throw Error(o(362));return _.stateNode.current}function Gp(_,S){switch(S.$$typeof){case Up:if(_.type===S.value)return!0;break;case Wh:e:{S=S.value,_=[_,0];for(var B=0;B<_.length;){var O=_[B++],$=_[B++],le=S[$];if(O.tag!==5||!Fe(O)){for(;le!=null&&Gp(O,le);)$++,le=S[$];if($===S.length){S=!0;break e}else for(O=O.child;O!==null;)_.push(O,$),O=O.sibling}}S=!1}return S;case Kh:if(_.tag===5&&He(_.stateNode,S.value))return!0;break;case ad:if((_.tag===5||_.tag===6)&&(_=Le(_),_!==null&&0<=_.indexOf(S.value)))return!0;break;case Hc:if(_.tag===5&&(_=_.memoizedProps["data-testname"],typeof _=="string"&&_.toLowerCase()===S.value.toLowerCase()))return!0;break;default:throw Error(o(365))}return!1}function $u(_){switch(_.$$typeof){case Up:return"<"+(M(_.value)||"Unknown")+">";case Wh:return":has("+($u(_)||"")+")";case Kh:return'[role="'+_.value+'"]';case ad:return'"'+_.value+'"';case Hc:return'[data-testname="'+_.value+'"]';default:throw Error(o(365))}}function la(_,S){var B=[];_=[_,0];for(var O=0;O<_.length;){var $=_[O++],le=_[O++],_e=S[le];if($.tag!==5||!Fe($)){for(;_e!=null&&Gp($,_e);)le++,_e=S[le];if(le===S.length)B.push($);else for($=$.child;$!==null;)_.push($,le),$=$.sibling}}return B}function Qc(_,S){if(!j)throw Error(o(363));_=zp(_),_=la(_,S),S=[],_=Array.from(_);for(var B=0;B<_.length;){var O=_[B++];if(O.tag===5)Fe(O)||S.push(O.stateNode);else for(O=O.child;O!==null;)_.push(O),O=O.sibling}return S}var gy=Math.ceil,Hp=a.ReactCurrentDispatcher,dl=a.ReactCurrentOwner,Di=a.ReactCurrentBatchConfig,Jn=0,Gr=null,ki=null,dr=0,ho=0,$h=vn(0),Pr=0,ld=null,Wl=0,ca=0,Xh=0,Vc=null,Xr=null,Qp=0,Xu=1/0;function qh(){Xu=hr()+500}var cd=!1,rr=null,pl=null,ud=!1,Kl=null,Jh=0,Zh=0,jc=null,Xi=-1,Lr=0;function yi(){return(Jn&6)!==0?hr():Xi!==-1?Xi:Xi=hr()}function ml(_){return(_.mode&1)===0?1:(Jn&2)!==0&&dr!==0?dr&-dr:zu.transition!==null?(Lr===0&&(_=ol,ol<<=1,(ol&4194240)===0&&(ol=64),Lr=_),Lr):(_=Fn,_!==0?_:Ae())}function fo(_,S,B){if(50<Zh)throw Zh=0,jc=null,Error(o(185));var O=qu(_,S);return O===null?null:(ba(O,S,B),((Jn&2)===0||O!==Gr)&&(O===Gr&&((Jn&2)===0&&(ca|=S),Pr===4&&js(O,dr)),Vo(O,B),S===1&&Jn===0&&(_.mode&1)===0&&(qh(),Hl&&co())),O)}function qu(_,S){_.lanes|=S;var B=_.alternate;for(B!==null&&(B.lanes|=S),B=_,_=_.return;_!==null;)_.childLanes|=S,B=_.alternate,B!==null&&(B.childLanes|=S),B=_,_=_.return;return B.tag===3?B.stateNode:null}function Vo(_,S){var B=_.callbackNode;Vf(_,S);var O=ku(_,_===Gr?dr:0);if(O===0)B!==null&&Gl(B),_.callbackNode=null,_.callbackPriority=0;else if(S=O&-O,_.callbackPriority!==S){if(B!=null&&Gl(B),S===1)_.tag===0?Uu(ua.bind(null,_)):Rh(ua.bind(null,_)),be?ne(function(){Jn===0&&co()}):na(ll,co),B=null;else{switch(Ia(O)){case 1:B=ll;break;case 4:B=_0;break;case 16:B=lo;break;case 536870912:B=Fu;break;default:B=lo}B=eg(B,Vs.bind(null,_))}_.callbackPriority=S,_.callbackNode=B}}function Vs(_,S){if(Xi=-1,Lr=0,(Jn&6)!==0)throw Error(o(327));var B=_.callbackNode;if(Yl()&&_.callbackNode!==B)return null;var O=ku(_,_===Gr?dr:0);if(O===0)return null;if((O&30)!==0||(O&_.expiredLanes)!==0||S)S=Kp(_,O);else{S=O;var $=Jn;Jn|=2;var le=vy();(Gr!==_||dr!==S)&&(qh(),Wc(_,S));do try{Xx();break}catch(Ge){yy(_,Ge)}while(!0);Cs(),Hp.current=le,Jn=$,ki!==null?S=0:(Gr=null,dr=0,S=Pr)}if(S!==0){if(S===2&&($=zl(_),$!==0&&(O=$,S=Vp(_,$))),S===1)throw B=ld,Wc(_,0),js(_,O),Vo(_,hr()),B;if(S===6)js(_,O);else{if($=_.current.alternate,(O&30)===0&&!Ay($)&&(S=Kp(_,O),S===2&&(le=zl(_),le!==0&&(O=le,S=Vp(_,le))),S===1))throw B=ld,Wc(_,0),js(_,O),Vo(_,hr()),B;switch(_.finishedWork=$,_.finishedLanes=O,S){case 0:case 1:throw Error(o(345));case 2:gl(_,Xr);break;case 3:if(js(_,O),(O&130023424)===O&&(S=Qp+500-hr(),10<S)){if(ku(_,0)!==0)break;if($=_.suspendedLanes,($&O)!==O){yi(),_.pingedLanes|=_.suspendedLanes&$;break}_.timeoutHandle=ie(gl.bind(null,_,Xr),S);break}gl(_,Xr);break;case 4:if(js(_,O),(O&4194240)===O)break;for(S=_.eventTimes,$=-1;0<O;){var _e=31-Ri(O);le=1<<_e,_e=S[_e],_e>$&&($=_e),O&=~le}if(O=$,O=hr()-O,O=(120>O?120:480>O?480:1080>O?1080:1920>O?1920:3e3>O?3e3:4320>O?4320:1960*gy(O/1960))-O,10<O){_.timeoutHandle=ie(gl.bind(null,_,Xr),O);break}gl(_,Xr);break;case 5:gl(_,Xr);break;default:throw Error(o(329))}}}return Vo(_,hr()),_.callbackNode===B?Vs.bind(null,_):null}function Vp(_,S){var B=Vc;return _.current.memoizedState.isDehydrated&&(Wc(_,S).flags|=256),_=Kp(_,S),_!==2&&(S=Xr,Xr=B,S!==null&&jp(S)),_}function jp(_){Xr===null?Xr=_:Xr.push.apply(Xr,_)}function Ay(_){for(var S=_;;){if(S.flags&16384){var B=S.updateQueue;if(B!==null&&(B=B.stores,B!==null))for(var O=0;O<B.length;O++){var $=B[O],le=$.getSnapshot;$=$.value;try{if(!_s(le(),$))return!1}catch{return!1}}}if(B=S.child,S.subtreeFlags&16384&&B!==null)B.return=S,S=B;else{if(S===_)break;for(;S.sibling===null;){if(S.return===null||S.return===_)return!0;S=S.return}S.sibling.return=S.return,S=S.sibling}}return!0}function js(_,S){for(S&=~Xh,S&=~ca,_.suspendedLanes|=S,_.pingedLanes&=~S,_=_.expirationTimes;0<S;){var B=31-Ri(S),O=1<<B;_[B]=-1,S&=~O}}function ua(_){if((Jn&6)!==0)throw Error(o(327));Yl();var S=ku(_,0);if((S&1)===0)return Vo(_,hr()),null;var B=Kp(_,S);if(_.tag!==0&&B===2){var O=zl(_);O!==0&&(S=O,B=Vp(_,O))}if(B===1)throw B=ld,Wc(_,0),js(_,S),Vo(_,hr()),B;if(B===6)throw Error(o(345));return _.finishedWork=_.current.alternate,_.finishedLanes=S,gl(_,Xr),Vo(_,hr()),null}function hd(_){Kl!==null&&Kl.tag===0&&(Jn&6)===0&&Yl();var S=Jn;Jn|=1;var B=Di.transition,O=Fn;try{if(Di.transition=null,Fn=1,_)return _()}finally{Fn=O,Di.transition=B,Jn=S,(Jn&6)===0&&co()}}function Wp(){ho=$h.current,Dt($h)}function Wc(_,S){_.finishedWork=null,_.finishedLanes=0;var B=_.timeoutHandle;if(B!==ge&&(_.timeoutHandle=ge,se(B)),ki!==null)for(B=ki.return;B!==null;){var O=B;switch(WA(O),O.tag){case 1:O=O.type.childContextTypes,O!=null&&Dn();break;case 3:Jf(),Dt(Sn),Dt(xn),kh();break;case 5:$A(O);break;case 4:Jf();break;case 13:Dt(Er);break;case 19:Dt(Er);break;case 10:$r(O.type._context);break;case 22:case 23:Wp()}B=B.return}if(Gr=_,ki=_=Kc(_.current,null),dr=ho=S,Pr=0,ld=null,Xh=ca=Wl=0,Xr=Vc=null,So!==null){for(S=0;S<So.length;S++)if(B=So[S],O=B.interleaved,O!==null){B.interleaved=null;var $=O.next,le=B.pending;if(le!==null){var _e=le.next;le.next=$,O.next=_e}B.pending=O}So=null}return _}function yy(_,S){do{var B=ki;try{if(Cs(),wp.current=id,B0){for(var O=_r.memoizedState;O!==null;){var $=O.queue;$!==null&&($.pending=null),O=O.next}B0=!1}if(Fh=0,bs=Ts=_r=null,Ql=!1,Oh=0,dl.current=null,B===null||B.return===null){Pr=1,ld=S,ki=null;break}e:{var le=_,_e=B.return,Ge=B,ht=S;if(S=dr,Ge.flags|=32768,ht!==null&&typeof ht=="object"&&typeof ht.then=="function"){var Rt=ht,Jt=Ge,Hn=Jt.tag;if((Jt.mode&1)===0&&(Hn===0||Hn===11||Hn===15)){var wn=Jt.alternate;wn?(Jt.updateQueue=wn.updateQueue,Jt.memoizedState=wn.memoizedState,Jt.lanes=wn.lanes):(Jt.updateQueue=null,Jt.memoizedState=null)}var Zn=sy(_e);if(Zn!==null){Zn.flags&=-257,Uh(Zn,_e,Ge,le,S),Zn.mode&1&&Fc(le,Rt,S),S=Zn,ht=Rt;var Wt=S.updateQueue;if(Wt===null){var Ws=new Set;Ws.add(ht),S.updateQueue=Ws}else Wt.add(ht);break e}else{if((S&1)===0){Fc(le,Rt,S),Z0();break e}ht=Error(o(426))}}else if(fr&&Ge.mode&1){var fa=sy(_e);if(fa!==null){(fa.flags&65536)===0&&(fa.flags|=256),Uh(fa,_e,Ge,le,S),R0(ht);break e}}le=ht,Pr!==4&&(Pr=2),Vc===null?Vc=[le]:Vc.push(le),ht=ry(ht,Ge),Ge=_e;do{switch(Ge.tag){case 3:Ge.flags|=65536,S&=-S,Ge.lanes|=S;var et=Kx(Ge,ht,S);w0(Ge,et);break e;case 1:le=ht;var Qe=Ge.type,at=Ge.stateNode;if((Ge.flags&128)===0&&(typeof Qe.getDerivedStateFromError=="function"||at!==null&&typeof at.componentDidCatch=="function"&&(pl===null||!pl.has(at)))){Ge.flags|=65536,S&=-S,Ge.lanes|=S;var Vt=Q0(Ge,le,S);w0(Ge,Vt);break e}}Ge=Ge.return}while(Ge!==null)}Ey(B)}catch(on){S=on,ki===B&&B!==null&&(ki=B=B.return);continue}break}while(!0)}function vy(){var _=Hp.current;return Hp.current=id,_===null?id:_}function Z0(){(Pr===0||Pr===3||Pr===2)&&(Pr=4),Gr===null||(Wl&268435455)===0&&(ca&268435455)===0||js(Gr,dr)}function Kp(_,S){var B=Jn;Jn|=2;var O=vy();Gr===_&&dr===S||Wc(_,S);do try{$x();break}catch($){yy(_,$)}while(!0);if(Cs(),Jn=B,Hp.current=O,ki!==null)throw Error(o(261));return Gr=null,dr=0,Pr}function $x(){for(;ki!==null;)xy(ki)}function Xx(){for(;ki!==null&&!Ma();)xy(ki)}function xy(_){var S=wy(_.alternate,_,ho);_.memoizedProps=_.pendingProps,S===null?Ey(_):ki=S,dl.current=null}function Ey(_){var S=_;do{var B=S.alternate;if(_=S.return,(S.flags&32768)===0){if(B=W0(B,S,ho),B!==null){ki=B;return}}else{if(B=$0(B,S),B!==null){B.flags&=32767,ki=B;return}if(_!==null)_.flags|=32768,_.subtreeFlags=0,_.deletions=null;else{Pr=6,ki=null;return}}if(S=S.sibling,S!==null){ki=S;return}ki=S=_}while(S!==null);Pr===0&&(Pr=5)}function gl(_,S){var B=Fn,O=Di.transition;try{Di.transition=null,Fn=1,qx(_,S,B)}finally{Di.transition=O,Fn=B}return null}function qx(_,S,B){do Yl();while(Kl!==null);if((Jn&6)!==0)throw Error(o(327));var O=_.finishedWork,$=_.finishedLanes;if(O===null)return null;if(_.finishedWork=null,_.finishedLanes=0,O===_.current)throw Error(o(177));_.callbackNode=null,_.callbackPriority=0;var le=O.lanes|O.childLanes;if(al(_,le),_===Gr&&(ki=Gr=null,dr=0),(O.subtreeFlags&2064)===0&&(O.flags&2064)===0||ud||(ud=!0,eg(lo,function(){return Yl(),null})),le=(O.flags&15990)!==0,(O.subtreeFlags&15990)!==0||le){le=Di.transition,Di.transition=null;var _e=Fn;Fn=1;var Ge=Jn;Jn|=4,dl.current=null,uy(_,O),uC(_,O),W(_.containerInfo),_.current=O,Op(O),E0(),Jn=Ge,Fn=_e,Di.transition=le}else _.current=O;if(ud&&(ud=!1,Kl=_,Jh=$),le=_.pendingLanes,le===0&&(pl=null),Tc(O.stateNode),Vo(_,hr()),S!==null)for(B=_.onRecoverableError,O=0;O<S.length;O++)B(S[O]);if(cd)throw cd=!1,_=rr,rr=null,_;return(Jh&1)!==0&&_.tag!==0&&Yl(),le=_.pendingLanes,(le&1)!==0?_===jc?Zh++:(Zh=0,jc=_):Zh=0,co(),null}function Yl(){if(Kl!==null){var _=Ia(Jh),S=Di.transition,B=Fn;try{if(Di.transition=null,Fn=16>_?16:_,Kl===null)var O=!1;else{if(_=Kl,Kl=null,Jh=0,(Jn&6)!==0)throw Error(o(331));var $=Jn;for(Jn|=4,kt=_.current;kt!==null;){var le=kt,_e=le.child;if((kt.flags&16)!==0){var Ge=le.deletions;if(Ge!==null){for(var ht=0;ht<Ge.length;ht++){var Rt=Ge[ht];for(kt=Rt;kt!==null;){var Jt=kt;switch(Jt.tag){case 0:case 11:case 15:Gc(8,Jt,le)}var Hn=Jt.child;if(Hn!==null)Hn.return=Jt,kt=Hn;else for(;kt!==null;){Jt=kt;var wn=Jt.sibling,Zn=Jt.return;if(hy(Jt),Jt===Rt){kt=null;break}if(wn!==null){wn.return=Zn,kt=wn;break}kt=Zn}}}var Wt=le.alternate;if(Wt!==null){var Ws=Wt.child;if(Ws!==null){Wt.child=null;do{var fa=Ws.sibling;Ws.sibling=null,Ws=fa}while(Ws!==null)}}kt=le}}if((le.subtreeFlags&2064)!==0&&_e!==null)_e.return=le,kt=_e;else e:for(;kt!==null;){if(le=kt,(le.flags&2048)!==0)switch(le.tag){case 0:case 11:case 15:Gc(9,le,le.return)}var et=le.sibling;if(et!==null){et.return=le.return,kt=et;break e}kt=le.return}}var Qe=_.current;for(kt=Qe;kt!==null;){_e=kt;var at=_e.child;if((_e.subtreeFlags&2064)!==0&&at!==null)at.return=_e,kt=at;else e:for(_e=Qe;kt!==null;){if(Ge=kt,(Ge.flags&2048)!==0)try{switch(Ge.tag){case 0:case 11:case 15:Qs(9,Ge)}}catch(on){Io(Ge,Ge.return,on)}if(Ge===_e){kt=null;break e}var Vt=Ge.sibling;if(Vt!==null){Vt.return=Ge.return,kt=Vt;break e}kt=Ge.return}}if(Jn=$,co(),ia&&typeof ia.onPostCommitFiberRoot=="function")try{ia.onPostCommitFiberRoot(Ou,_)}catch{}O=!0}return O}finally{Fn=B,Di.transition=S}}return!1}function Yp(_,S,B){S=ry(B,S),S=Kx(_,S,1),Gu(_,S),S=yi(),_=qu(_,1),_!==null&&(ba(_,1,S),Vo(_,S))}function Io(_,S,B){if(_.tag===3)Yp(_,_,B);else for(;S!==null;){if(S.tag===3){Yp(S,_,B);break}else if(S.tag===1){var O=S.stateNode;if(typeof S.type.getDerivedStateFromError=="function"||typeof O.componentDidCatch=="function"&&(pl===null||!pl.has(O))){_=ry(B,_),_=Q0(S,_,1),Gu(S,_),_=yi(),S=qu(S,1),S!==null&&(ba(S,1,_),Vo(S,_));break}}S=S.return}}function _y(_,S,B){var O=_.pingCache;O!==null&&O.delete(S),S=yi(),_.pingedLanes|=_.suspendedLanes&B,Gr===_&&(dr&B)===B&&(Pr===4||Pr===3&&(dr&130023424)===dr&&500>hr()-Qp?Wc(_,0):Xh|=B),Vo(_,S)}function Sy(_,S){S===0&&((_.mode&1)===0?S=1:(S=ri,ri<<=1,(ri&130023424)===0&&(ri=4194304)));var B=yi();_=qu(_,S),_!==null&&(ba(_,S,B),Vo(_,B))}function Jx(_){var S=_.memoizedState,B=0;S!==null&&(B=S.retryLane),Sy(_,B)}function Zx(_,S){var B=0;switch(_.tag){case 13:var O=_.stateNode,$=_.memoizedState;$!==null&&(B=$.retryLane);break;case 19:O=_.stateNode;break;default:throw Error(o(314))}O!==null&&O.delete(S),Sy(_,B)}var wy;wy=function(_,S,B){if(_!==null)if(_.memoizedProps!==S.pendingProps||Sn.current)Ms=!0;else{if((_.lanes&B)===0&&(S.flags&128)===0)return Ms=!1,Y0(_,S,B);Ms=(_.flags&131072)!==0}else Ms=!1,fr&&(S.flags&1048576)!==0&&Ux(S,I0,S.index);switch(S.lanes=0,S.tag){case 2:var O=S.type;_!==null&&(_.alternate=null,S.alternate=null,S.flags|=2),_=S.pendingProps;var $=xi(S,xn.current);Ur(S,B),$=Zf(null,S,O,_,$,B);var le=ju();return S.flags|=1,typeof $=="object"&&$!==null&&typeof $.render=="function"&&$.$$typeof===void 0?(S.tag=1,S.memoizedState=null,S.updateQueue=null,Ei(O)?(le=!0,Bn(S)):le=!1,S.memoizedState=$.state!==null&&$.state!==void 0?$.state:null,jf(S),$.updater=T0,S.stateNode=$,$._reactInternals=S,VA(S,O,_,B),S=uo(null,S,O,!0,le,B)):(S.tag=0,fr&&le&&jA(S),Rr(null,S,$,B),S=S.child),S;case 16:O=S.elementType;e:{switch(_!==null&&(_.alternate=null,S.alternate=null,S.flags|=2),_=S.pendingProps,$=O._init,O=$(O._payload),S.type=O,$=S.tag=hC(O),_=ws(O,_),$){case 0:S=Uc(null,S,O,_,B);break e;case 1:S=Gh(null,S,O,_,B);break e;case 11:S=$i(null,S,O,_,B);break e;case 14:S=Gi(null,S,O,ws(O.type,_),B);break e}throw Error(o(306,O,""))}return S;case 0:return O=S.type,$=S.pendingProps,$=S.elementType===O?$:ws(O,$),Uc(_,S,O,$,B);case 1:return O=S.type,$=S.pendingProps,$=S.elementType===O?$:ws(O,$),Gh(_,S,O,$,B);case 3:e:{if(Bp(S),_===null)throw Error(o(387));O=S.pendingProps,le=S.memoizedState,$=le.element,GA(_,S),C0(S,O,null,B);var _e=S.memoizedState;if(O=_e.element,Me&&le.isDehydrated)if(le={element:O,isDehydrated:!1,cache:_e.cache,transitions:_e.transitions},S.updateQueue.baseState=le,S.memoizedState=le,S.flags&256){$=Error(o(423)),S=ay(_,S,O,B,$);break e}else if(O!==$){$=Error(o(424)),S=ay(_,S,O,B,$);break e}else for(Me&&(Gs=vr(S.stateNode.containerInfo),wo=S,fr=!0,Ba=null,Kf=!1),B=Hx(S,null,O,B),S.child=B;B;)B.flags=B.flags&-3|4096,B=B.sibling;else{if(Yf(),O===$){S=Qo(_,S,B);break e}Rr(_,S,O,B)}S=S.child}return S;case 5:return Qx(S),_===null&&Qu(S),O=S.type,$=S.pendingProps,le=_!==null?_.memoizedProps:null,_e=$.children,J(O,$)?_e=null:le!==null&&J(O,le)&&(S.flags|=32),Co(_,S),Rr(_,S,_e,B),S.child;case 6:return _===null&&Qu(S),null;case 13:return ly(_,S,B);case 4:return P0(S,S.stateNode.containerInfo),O=S.pendingProps,_===null?S.child=Dc(S,null,O,B):Rr(_,S,O,B),S.child;case 11:return O=S.type,$=S.pendingProps,$=S.elementType===O?$:ws(O,$),$i(_,S,O,$,B);case 7:return Rr(_,S,S.pendingProps,B),S.child;case 8:return Rr(_,S,S.pendingProps.children,B),S.child;case 12:return Rr(_,S,S.pendingProps.children,B),S.child;case 10:e:{if(O=S.type._context,$=S.pendingProps,le=S.memoizedProps,_e=$.value,Rc(S,O,_e),le!==null)if(_s(le.value,_e)){if(le.children===$.children&&!Sn.current){S=Qo(_,S,B);break e}}else for(le=S.child,le!==null&&(le.return=S);le!==null;){var Ge=le.dependencies;if(Ge!==null){_e=le.child;for(var ht=Ge.firstContext;ht!==null;){if(ht.context===O){if(le.tag===1){ht=Pc(-1,B&-B),ht.tag=2;var Rt=le.updateQueue;if(Rt!==null){Rt=Rt.shared;var Jt=Rt.pending;Jt===null?ht.next=ht:(ht.next=Jt.next,Jt.next=ht),Rt.pending=ht}}le.lanes|=B,ht=le.alternate,ht!==null&&(ht.lanes|=B),us(le.return,B,S),Ge.lanes|=B;break}ht=ht.next}}else if(le.tag===10)_e=le.type===S.type?null:le.child;else if(le.tag===18){if(_e=le.return,_e===null)throw Error(o(341));_e.lanes|=B,Ge=_e.alternate,Ge!==null&&(Ge.lanes|=B),us(_e,B,S),_e=le.sibling}else _e=le.child;if(_e!==null)_e.return=le;else for(_e=le;_e!==null;){if(_e===S){_e=null;break}if(le=_e.sibling,le!==null){le.return=_e.return,_e=le;break}_e=_e.return}le=_e}Rr(_,S,$.children,B),S=S.child}return S;case 9:return $=S.type,O=S.pendingProps.children,Ur(S,B),$=xr($),O=O($),S.flags|=1,Rr(_,S,O,B),S.child;case 14:return O=S.type,$=ws(O,S.pendingProps),$=ws(O.type,$),Gi(_,S,O,$,B);case 15:return Nc(_,S,S.type,S.pendingProps,B);case 17:return O=S.type,$=S.pendingProps,$=S.elementType===O?$:ws(O,$),_!==null&&(_.alternate=null,S.alternate=null,S.flags|=2),S.tag=1,Ei(O)?(_=!0,Bn(S)):_=!1,Ur(S,B),Ox(S,O,$),VA(S,O,$,B),uo(null,S,O,!0,_,B);case 19:return Qh(_,S,B);case 22:return Hs(_,S,B)}throw Error(o(156,S.tag))};function eg(_,S){return na(_,S)}function e3(_,S,B,O){this.tag=_,this.key=B,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=S,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=O,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ha(_,S,B,O){return new e3(_,S,B,O)}function tg(_){return _=_.prototype,!(!_||!_.isReactComponent)}function hC(_){if(typeof _=="function")return tg(_)?1:0;if(_!=null){if(_=_.$$typeof,_===y)return 11;if(_===E)return 14}return 2}function Kc(_,S){var B=_.alternate;return B===null?(B=ha(_.tag,S,_.key,_.mode),B.elementType=_.elementType,B.type=_.type,B.stateNode=_.stateNode,B.alternate=_,_.alternate=B):(B.pendingProps=S,B.type=_.type,B.flags=0,B.subtreeFlags=0,B.deletions=null),B.flags=_.flags&14680064,B.childLanes=_.childLanes,B.lanes=_.lanes,B.child=_.child,B.memoizedProps=_.memoizedProps,B.memoizedState=_.memoizedState,B.updateQueue=_.updateQueue,S=_.dependencies,B.dependencies=S===null?null:{lanes:S.lanes,firstContext:S.firstContext},B.sibling=_.sibling,B.index=_.index,B.ref=_.ref,B}function ng(_,S,B,O,$,le){var _e=2;if(O=_,typeof _=="function")tg(_)&&(_e=1);else if(typeof _=="string")_e=5;else e:switch(_){case u:return ef(B.children,$,le,S);case h:_e=8,$|=8;break;case f:return _=ha(12,B,S,$|2),_.elementType=f,_.lanes=le,_;case g:return _=ha(13,B,S,$),_.elementType=g,_.lanes=le,_;case A:return _=ha(19,B,S,$),_.elementType=A,_.lanes=le,_;case w:return $p(B,$,le,S);default:if(typeof _=="object"&&_!==null)switch(_.$$typeof){case d:_e=10;break e;case m:_e=9;break e;case y:_e=11;break e;case E:_e=14;break e;case x:_e=16,O=null;break e}throw Error(o(130,_==null?_:typeof _,""))}return S=ha(_e,B,S,$),S.elementType=_,S.type=O,S.lanes=le,S}function ef(_,S,B,O){return _=ha(7,_,O,S),_.lanes=B,_}function $p(_,S,B,O){return _=ha(22,_,O,S),_.elementType=w,_.lanes=B,_.stateNode={},_}function ig(_,S,B){return _=ha(6,_,null,S),_.lanes=B,_}function rg(_,S,B){return S=ha(4,_.children!==null?_.children:[],_.key,S),S.lanes=B,S.stateNode={containerInfo:_.containerInfo,pendingChildren:null,implementation:_.implementation},S}function sg(_,S,B,O,$){this.tag=S,this.containerInfo=_,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=ge,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Mh(0),this.expirationTimes=Mh(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Mh(0),this.identifierPrefix=O,this.onRecoverableError=$,Me&&(this.mutableSourceEagerHydrationData=null)}function t3(_,S,B,O,$,le,_e,Ge,ht){return _=new sg(_,S,B,Ge,ht),S===1?(S=1,le===!0&&(S|=8)):S=0,le=ha(3,null,null,S),_.current=le,le.stateNode=_,le.memoizedState={element:O,isDehydrated:B,cache:null,transitions:null},jf(le),_}function n3(_){if(!_)return yn;_=_._reactInternals;e:{if(P(_)!==_||_.tag!==1)throw Error(o(170));var S=_;do{switch(S.tag){case 3:S=S.stateNode.context;break e;case 1:if(Ei(S.type)){S=S.stateNode.__reactInternalMemoizedMergedChildContext;break e}}S=S.return}while(S!==null);throw Error(o(171))}if(_.tag===1){var B=_.type;if(Ei(B))return zi(_,B,S)}return S}function i3(_){var S=_._reactInternals;if(S===void 0)throw typeof _.render=="function"?Error(o(188)):(_=Object.keys(_).join(","),Error(o(268,_)));return _=k(S),_===null?null:_.stateNode}function Fa(_,S){if(_=_.memoizedState,_!==null&&_.dehydrated!==null){var B=_.retryLane;_.retryLane=B!==0&&B<S?B:S}}function Xp(_,S){Fa(_,S),(_=_.alternate)&&Fa(_,S)}function og(_){return _=k(_),_===null?null:_.stateNode}function r3(){return null}return t.attemptContinuousHydration=function(_){if(_.tag===13){var S=yi();fo(_,134217728,S),Xp(_,134217728)}},t.attemptHydrationAtCurrentPriority=function(_){if(_.tag===13){var S=yi(),B=ml(_);fo(_,B,S),Xp(_,B)}},t.attemptSynchronousHydration=function(_){switch(_.tag){case 3:var S=_.stateNode;if(S.current.memoizedState.isDehydrated){var B=Ul(S.pendingLanes);B!==0&&(zs(S,B|1),Vo(S,hr()),(Jn&6)===0&&(qh(),co()))}break;case 13:var O=yi();hd(function(){return fo(_,1,O)}),Xp(_,1)}},t.batchedUpdates=function(_,S){var B=Jn;Jn|=1;try{return _(S)}finally{Jn=B,Jn===0&&(qh(),Hl&&co())}},t.createComponentSelector=function(_){return{$$typeof:Up,value:_}},t.createContainer=function(_,S,B,O,$,le,_e){return t3(_,S,!1,null,B,O,$,le,_e)},t.createHasPseudoClassSelector=function(_){return{$$typeof:Wh,value:_}},t.createHydrationContainer=function(_,S,B,O,$,le,_e,Ge,ht){return _=t3(B,O,!0,_,$,le,_e,Ge,ht),_.context=n3(null),B=_.current,O=yi(),$=ml(B),le=Pc(O,$),le.callback=S??null,Gu(B,le),_.current.lanes=$,ba(_,$,O),Vo(_,O),_},t.createPortal=function(_,S,B){var O=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:c,key:O==null?null:""+O,children:_,containerInfo:S,implementation:B}},t.createRoleSelector=function(_){return{$$typeof:Kh,value:_}},t.createTestNameSelector=function(_){return{$$typeof:Hc,value:_}},t.createTextSelector=function(_){return{$$typeof:ad,value:_}},t.deferredUpdates=function(_){var S=Fn,B=Di.transition;try{return Di.transition=null,Fn=16,_()}finally{Fn=S,Di.transition=B}},t.discreteUpdates=function(_,S,B,O,$){var le=Fn,_e=Di.transition;try{return Di.transition=null,Fn=1,_(S,B,O,$)}finally{Fn=le,Di.transition=_e,Jn===0&&qh()}},t.findAllNodes=Qc,t.findBoundingRects=function(_,S){if(!j)throw Error(o(363));S=Qc(_,S),_=[];for(var B=0;B<S.length;B++)_.push(Re(S[B]));for(S=_.length-1;0<S;S--){B=_[S];for(var O=B.x,$=O+B.width,le=B.y,_e=le+B.height,Ge=S-1;0<=Ge;Ge--)if(S!==Ge){var ht=_[Ge],Rt=ht.x,Jt=Rt+ht.width,Hn=ht.y,wn=Hn+ht.height;if(O>=Rt&&le>=Hn&&$<=Jt&&_e<=wn){_.splice(S,1);break}else if(O!==Rt||B.width!==ht.width||wn<le||Hn>_e){if(!(le!==Hn||B.height!==ht.height||Jt<O||Rt>$)){Rt>O&&(ht.width+=Rt-O,ht.x=O),Jt<$&&(ht.width=$-Rt),_.splice(S,1);break}}else{Hn>le&&(ht.height+=Hn-le,ht.y=le),wn<_e&&(ht.height=_e-Hn),_.splice(S,1);break}}}return _},t.findHostInstance=i3,t.findHostInstanceWithNoPortals=function(_){return _=U(_),_=_!==null?G(_):null,_===null?null:_.stateNode},t.findHostInstanceWithWarning=function(_){return i3(_)},t.flushControlled=function(_){var S=Jn;Jn|=1;var B=Di.transition,O=Fn;try{Di.transition=null,Fn=1,_()}finally{Fn=O,Di.transition=B,Jn=S,Jn===0&&(qh(),co())}},t.flushPassiveEffects=Yl,t.flushSync=hd,t.focusWithin=function(_,S){if(!j)throw Error(o(363));for(_=zp(_),S=la(_,S),S=Array.from(S),_=0;_<S.length;){var B=S[_++];if(!Fe(B)){if(B.tag===5&&it(B.stateNode))return!0;for(B=B.child;B!==null;)S.push(B),B=B.sibling}}return!1},t.getCurrentUpdatePriority=function(){return Fn},t.getFindAllNodesFailureDescription=function(_,S){if(!j)throw Error(o(363));var B=0,O=[];_=[zp(_),0];for(var $=0;$<_.length;){var le=_[$++],_e=_[$++],Ge=S[_e];if((le.tag!==5||!Fe(le))&&(Gp(le,Ge)&&(O.push($u(Ge)),_e++,_e>B&&(B=_e)),_e<S.length))for(le=le.child;le!==null;)_.push(le,_e),le=le.sibling}if(B<S.length){for(_=[];B<S.length;B++)_.push($u(S[B]));return`findAllNodes was able to match part of the selector:
  `+(O.join(" > ")+`

No matching component was found for:
  `)+_.join(" > ")}return null},t.getPublicRootInstance=function(_){if(_=_.current,!_.child)return null;switch(_.child.tag){case 5:return Z(_.child.stateNode);default:return _.child.stateNode}},t.injectIntoDevTools=function(_){if(_={bundleType:_.bundleType,version:_.version,rendererPackageName:_.rendererPackageName,rendererConfig:_.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:a.ReactCurrentDispatcher,findHostInstanceByFiber:og,findFiberByHostInstance:_.findFiberByHostInstance||r3,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.0.0-fc46dba67-20220329"},typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u")_=!1;else{var S=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(S.isDisabled||!S.supportsFiber)_=!0;else{try{Ou=S.inject(_),ia=S}catch{}_=!!S.checkDCE}}return _},t.isAlreadyRendering=function(){return!1},t.observeVisibleRects=function(_,S,B,O){if(!j)throw Error(o(363));_=Qc(_,S);var $=Ye(_,B,O).disconnect;return{disconnect:function(){$()}}},t.registerMutableSourceForHydration=function(_,S){var B=S._getVersion;B=B(S._source),_.mutableSourceEagerHydrationData==null?_.mutableSourceEagerHydrationData=[S,B]:_.mutableSourceEagerHydrationData.push(S,B)},t.runWithPriority=function(_,S){var B=Fn;try{return Fn=_,S()}finally{Fn=B}},t.shouldError=function(){return null},t.shouldSuspend=function(){return!1},t.updateContainer=function(_,S,B,O){var $=S.current,le=yi(),_e=ml($);return B=n3(B),S.context===null?S.context=B:S.pendingContext=B,S=Pc(le,_e),S.payload={element:_},O=O===void 0?null:O,O!==null&&(S.callback=O),Gu($,S),_=fo($,_e,le),_!==null&&S0(_,$,_e),_e},t}),MT}var HB;function _ie(){return HB||(HB=1,TT.exports=Eie()),TT.exports}var Sie=_ie();const wie=EA(Sie);var QB=Uz(),Cie=Object.freeze({__proto__:null});const iR={},Or=i=>void Object.assign(iR,i);function Tie(i,e){function t(u,{args:h=[],attach:f,...d},m){let y=`${u[0].toUpperCase()}${u.slice(1)}`,g;if(u==="primitive"){if(d.object===void 0)throw new Error("R3F: Primitives without 'object' are invalid!");const A=d.object;g=S1(A,{type:u,root:m,attach:f,primitive:!0})}else{const A=iR[y];if(!A)throw new Error(`R3F: ${y} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(!Array.isArray(h))throw new Error("R3F: The args prop must be an array!");g=S1(new A(...h),{type:u,root:m,attach:f,memoizedProps:{args:h}})}return g.__r3f.attach===void 0&&(g.isBufferGeometry?g.__r3f.attach="geometry":g.isMaterial&&(g.__r3f.attach="material")),y!=="inject"&&LT(g,d),g}function n(u,h){let f=!1;if(h){var d,m;(d=h.__r3f)!=null&&d.attach?PT(u,h,h.__r3f.attach):h.isObject3D&&u.isObject3D&&(u.add(h),f=!0),f||(m=u.__r3f)==null||m.objects.push(h),h.__r3f||S1(h,{}),h.__r3f.parent=u,NM(h),w1(h)}}function r(u,h,f){let d=!1;if(h){var m,y;if((m=h.__r3f)!=null&&m.attach)PT(u,h,h.__r3f.attach);else if(h.isObject3D&&u.isObject3D){h.parent=u,h.dispatchEvent({type:"added"}),u.dispatchEvent({type:"childadded",child:h});const g=u.children.filter(E=>E!==h),A=g.indexOf(f);u.children=[...g.slice(0,A),h,...g.slice(A)],d=!0}d||(y=u.__r3f)==null||y.objects.push(h),h.__r3f||S1(h,{}),h.__r3f.parent=u,NM(h),w1(h)}}function s(u,h,f=!1){u&&[...u].forEach(d=>o(h,d,f))}function o(u,h,f){if(h){var d,m,y;if(h.__r3f&&(h.__r3f.parent=null),(d=u.__r3f)!=null&&d.objects&&(u.__r3f.objects=u.__r3f.objects.filter(w=>w!==h)),(m=h.__r3f)!=null&&m.attach)YB(u,h,h.__r3f.attach);else if(h.isObject3D&&u.isObject3D){var g;u.remove(h),(g=h.__r3f)!=null&&g.root&&Pie($_(h),h)}const E=(y=h.__r3f)==null?void 0:y.primitive,x=!E&&(f===void 0?h.dispose!==null:f);if(!E){var A;s((A=h.__r3f)==null?void 0:A.objects,h,x),s(h.children,h,x)}if(delete h.__r3f,x&&h.dispose&&h.type!=="Scene"){const w=()=>{try{h.dispose()}catch{}};typeof IS_REACT_ACT_ENVIRONMENT>"u"?QB.unstable_scheduleCallback(QB.unstable_IdlePriority,w):w()}w1(u)}}function a(u,h,f,d){var m;const y=(m=u.__r3f)==null?void 0:m.parent;if(!y)return;const g=t(h,f,u.__r3f.root);if(u.children){for(const A of u.children)A.__r3f&&n(g,A);u.children=u.children.filter(A=>!A.__r3f)}u.__r3f.objects.forEach(A=>n(g,A)),u.__r3f.objects=[],u.__r3f.autoRemovedBeforeAppend||o(y,u),g.parent&&(g.__r3f.autoRemovedBeforeAppend=!0),n(y,g),g.raycast&&g.__r3f.eventCount&&$_(g).getState().internal.interaction.push(g),[d,d.alternate].forEach(A=>{A!==null&&(A.stateNode=g,A.ref&&(typeof A.ref=="function"?A.ref(g):A.ref.current=g))})}const l=()=>{};return{reconciler:wie({createInstance:t,removeChild:o,appendChild:n,appendInitialChild:n,insertBefore:r,supportsMutation:!0,isPrimaryRenderer:!1,supportsPersistence:!1,supportsHydration:!1,noTimeout:-1,appendChildToContainer:(u,h)=>{if(!h)return;const f=u.getState().scene;f.__r3f&&(f.__r3f.root=u,n(f,h))},removeChildFromContainer:(u,h)=>{h&&o(u.getState().scene,h)},insertInContainerBefore:(u,h,f)=>{if(!h||!f)return;const d=u.getState().scene;d.__r3f&&r(d,h,f)},getRootHostContext:()=>null,getChildHostContext:u=>u,finalizeInitialChildren(u){var h;return!!((h=u==null?void 0:u.__r3f)!=null?h:{}).handlers},prepareUpdate(u,h,f,d){var m;if(((m=u==null?void 0:u.__r3f)!=null?m:{}).primitive&&d.object&&d.object!==u)return[!0];{const{args:g=[],children:A,...E}=d,{args:x=[],children:w,...T}=f;if(!Array.isArray(g))throw new Error("R3F: the args prop must be an array!");if(g.some((M,L)=>M!==x[L]))return[!0];const I=Kz(u,E,T,!0);return I.changes.length?[!1,I]:null}},commitUpdate(u,[h,f],d,m,y,g){h?a(u,d,y,g):LT(u,f)},commitMount(u,h,f,d){var m;const y=(m=u.__r3f)!=null?m:{};u.raycast&&y.handlers&&y.eventCount&&$_(u).getState().internal.interaction.push(u)},getPublicInstance:u=>u,prepareForCommit:()=>null,preparePortalMount:u=>S1(u.getState().scene),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance(u){var h;const{attach:f,parent:d}=(h=u.__r3f)!=null?h:{};f&&d&&YB(d,u,f),u.isObject3D&&(u.visible=!1),w1(u)},unhideInstance(u,h){var f;const{attach:d,parent:m}=(f=u.__r3f)!=null?f:{};d&&m&&PT(m,u,d),(u.isObject3D&&h.visible==null||h.visible)&&(u.visible=!0),w1(u)},createTextInstance:l,hideTextInstance:l,unhideTextInstance:l,getCurrentEventPriority:()=>e?e():k1.DefaultEventPriority,beforeActiveInstanceBlur:()=>{},afterActiveInstanceBlur:()=>{},detachDeletedInstance:()=>{},now:typeof performance<"u"&&gr.fun(performance.now)?performance.now:gr.fun(Date.now)?Date.now:()=>0,scheduleTimeout:gr.fun(setTimeout)?setTimeout:void 0,cancelTimeout:gr.fun(clearTimeout)?clearTimeout:void 0}),applyProps:LT}}var VB,jB;const RT=i=>"colorSpace"in i||"outputColorSpace"in i,zz=()=>{var i;return(i=iR.ColorManagement)!=null?i:null},Gz=i=>i&&i.isOrthographicCamera,bie=i=>i&&i.hasOwnProperty("current"),IA=typeof window<"u"&&((VB=window.document)!=null&&VB.createElement||((jB=window.navigator)==null?void 0:jB.product)==="ReactNative")?C.useLayoutEffect:C.useEffect;function Hz(i){const e=C.useRef(i);return IA(()=>void(e.current=i),[i]),e}function Iie({set:i}){return IA(()=>(i(new Promise(()=>null)),()=>i(!1)),[i]),null}class Qz extends C.Component{constructor(...e){super(...e),this.state={error:!1}}componentDidCatch(e){this.props.set(e)}render(){return this.state.error?null:this.props.children}}Qz.getDerivedStateFromError=()=>({error:!0});const Vz="__default",WB=new Map,Mie=i=>i&&!!i.memoized&&!!i.changes;function jz(i){var e;const t=typeof window<"u"?(e=window.devicePixelRatio)!=null?e:2:1;return Array.isArray(i)?Math.min(Math.max(i[0],t),i[1]):i}const _1=i=>{var e;return(e=i.__r3f)==null?void 0:e.root.getState()};function $_(i){let e=i.__r3f.root;for(;e.getState().previousRoot;)e=e.getState().previousRoot;return e}const gr={obj:i=>i===Object(i)&&!gr.arr(i)&&typeof i!="function",fun:i=>typeof i=="function",str:i=>typeof i=="string",num:i=>typeof i=="number",boo:i=>typeof i=="boolean",und:i=>i===void 0,arr:i=>Array.isArray(i),equ(i,e,{arrays:t="shallow",objects:n="reference",strict:r=!0}={}){if(typeof i!=typeof e||!!i!=!!e)return!1;if(gr.str(i)||gr.num(i)||gr.boo(i))return i===e;const s=gr.obj(i);if(s&&n==="reference")return i===e;const o=gr.arr(i);if(o&&t==="reference")return i===e;if((o||s)&&i===e)return!0;let a;for(a in i)if(!(a in e))return!1;if(s&&t==="shallow"&&n==="shallow"){for(a in r?e:i)if(!gr.equ(i[a],e[a],{strict:r,objects:"reference"}))return!1}else for(a in r?e:i)if(i[a]!==e[a])return!1;if(gr.und(a)){if(o&&i.length===0&&e.length===0||s&&Object.keys(i).length===0&&Object.keys(e).length===0)return!0;if(i!==e)return!1}return!0}};function rR(i){const e={nodes:{},materials:{}};return i&&i.traverse(t=>{t.name&&(e.nodes[t.name]=t),t.material&&!e.materials[t.material.name]&&(e.materials[t.material.name]=t.material)}),e}function Wz(i){i.dispose&&i.type!=="Scene"&&i.dispose();for(const e in i)e.dispose==null||e.dispose(),delete i[e]}function S1(i,e){const t=i;return t.__r3f={type:"",root:null,previousAttach:null,memoizedProps:{},eventCount:0,handlers:{},objects:[],parent:null,...e},i}function OM(i,e){let t=i;if(e.includes("-")){const n=e.split("-"),r=n.pop();return t=n.reduce((s,o)=>s[o],i),{target:t,key:r}}else return{target:t,key:e}}const KB=/-\d+$/;function PT(i,e,t){if(gr.str(t)){if(KB.test(t)){const s=t.replace(KB,""),{target:o,key:a}=OM(i,s);Array.isArray(o[a])||(o[a]=[])}const{target:n,key:r}=OM(i,t);e.__r3f.previousAttach=n[r],n[r]=e}else e.__r3f.previousAttach=t(i,e)}function YB(i,e,t){var n,r;if(gr.str(t)){const{target:s,key:o}=OM(i,t),a=e.__r3f.previousAttach;a===void 0?delete s[o]:s[o]=a}else(n=e.__r3f)==null||n.previousAttach==null||n.previousAttach(i,e);(r=e.__r3f)==null||delete r.previousAttach}function Kz(i,{children:e,key:t,ref:n,...r},{children:s,key:o,ref:a,...l}={},c=!1){const u=i.__r3f,h=Object.entries(r),f=[];if(c){const m=Object.keys(l);for(let y=0;y<m.length;y++)r.hasOwnProperty(m[y])||h.unshift([m[y],Vz+"remove"])}h.forEach(([m,y])=>{var g;if((g=i.__r3f)!=null&&g.primitive&&m==="object"||gr.equ(y,l[m]))return;if(/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/.test(m))return f.push([m,y,!0,[]]);let A=[];m.includes("-")&&(A=m.split("-")),f.push([m,y,!1,A]);for(const E in r){const x=r[E];E.startsWith(`${m}-`)&&f.push([E,x,!1,E.split("-")])}});const d={...r};return u!=null&&u.memoizedProps&&u!=null&&u.memoizedProps.args&&(d.args=u.memoizedProps.args),u!=null&&u.memoizedProps&&u!=null&&u.memoizedProps.attach&&(d.attach=u.memoizedProps.attach),{memoized:d,changes:f}}function LT(i,e){var t;const n=i.__r3f,r=n==null?void 0:n.root,s=r==null||r.getState==null?void 0:r.getState(),{memoized:o,changes:a}=Mie(e)?e:Kz(i,e),l=n==null?void 0:n.eventCount;i.__r3f&&(i.__r3f.memoizedProps=o);for(let f=0;f<a.length;f++){let[d,m,y,g]=a[f];if(RT(i)){const w="srgb",T="srgb-linear";d==="encoding"?(d="colorSpace",m=m===3001?w:T):d==="outputEncoding"&&(d="outputColorSpace",m=m===3001?w:T)}let A=i,E=A[d];if(g.length&&(E=g.reduce((x,w)=>x[w],i),!(E&&E.set))){const[x,...w]=g.reverse();A=w.reverse().reduce((T,I)=>T[I],i),d=x}if(m===Vz+"remove")if(A.constructor){let x=WB.get(A.constructor);x||(x=new A.constructor,WB.set(A.constructor,x)),m=x[d]}else m=0;if(y&&n)m?n.handlers[d]=m:delete n.handlers[d],n.eventCount=Object.keys(n.handlers).length;else if(E&&E.set&&(E.copy||E instanceof Gm)){if(Array.isArray(m))E.fromArray?E.fromArray(m):E.set(...m);else if(E.copy&&m&&m.constructor&&E.constructor===m.constructor)E.copy(m);else if(m!==void 0){var c;const x=(c=E)==null?void 0:c.isColor;!x&&E.setScalar?E.setScalar(m):E instanceof Gm&&m instanceof Gm?E.mask=m.mask:E.set(m),!zz()&&s&&!s.linear&&x&&E.convertSRGBToLinear()}}else{var u;if(A[d]=m,(u=A[d])!=null&&u.isTexture&&A[d].format===gi&&A[d].type===Zi&&s){const x=A[d];RT(x)&&RT(s.gl)?x.colorSpace=s.gl.outputColorSpace:x.encoding=s.gl.outputEncoding}}w1(i)}if(n&&n.parent&&i.raycast&&l!==n.eventCount){const f=$_(i).getState().internal,d=f.interaction.indexOf(i);d>-1&&f.interaction.splice(d,1),n.eventCount&&f.interaction.push(i)}return!(a.length===1&&a[0][0]==="onUpdate")&&a.length&&(t=i.__r3f)!=null&&t.parent&&NM(i),i}function w1(i){var e,t;const n=(e=i.__r3f)==null||(t=e.root)==null||t.getState==null?void 0:t.getState();n&&n.internal.frames===0&&n.invalidate()}function NM(i){i.onUpdate==null||i.onUpdate(i)}function Yz(i,e){i.manual||(Gz(i)?(i.left=e.width/-2,i.right=e.width/2,i.top=e.height/2,i.bottom=e.height/-2):i.aspect=e.width/e.height,i.updateProjectionMatrix(),i.updateMatrixWorld())}function _E(i){return(i.eventObject||i.object).uuid+"/"+i.index+i.instanceId}function Rie(){var i;const e=typeof self<"u"&&self||typeof window<"u"&&window;if(!e)return k1.DefaultEventPriority;switch((i=e.event)==null?void 0:i.type){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return k1.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return k1.ContinuousEventPriority;default:return k1.DefaultEventPriority}}function $z(i,e,t,n){const r=t.get(e);r&&(t.delete(e),t.size===0&&(i.delete(n),r.target.releasePointerCapture(n)))}function Pie(i,e){const{internal:t}=i.getState();t.interaction=t.interaction.filter(n=>n!==e),t.initialHits=t.initialHits.filter(n=>n!==e),t.hovered.forEach((n,r)=>{(n.eventObject===e||n.object===e)&&t.hovered.delete(r)}),t.capturedMap.forEach((n,r)=>{$z(t.capturedMap,e,n,r)})}function Xz(i){function e(l){const{internal:c}=i.getState(),u=l.offsetX-c.initialClick[0],h=l.offsetY-c.initialClick[1];return Math.round(Math.sqrt(u*u+h*h))}function t(l){return l.filter(c=>["Move","Over","Enter","Out","Leave"].some(u=>{var h;return(h=c.__r3f)==null?void 0:h.handlers["onPointer"+u]}))}function n(l,c){const u=i.getState(),h=new Set,f=[],d=c?c(u.internal.interaction):u.internal.interaction;for(let A=0;A<d.length;A++){const E=_1(d[A]);E&&(E.raycaster.camera=void 0)}u.previousRoot||u.events.compute==null||u.events.compute(l,u);function m(A){const E=_1(A);if(!E||!E.events.enabled||E.raycaster.camera===null)return[];if(E.raycaster.camera===void 0){var x;E.events.compute==null||E.events.compute(l,E,(x=E.previousRoot)==null?void 0:x.getState()),E.raycaster.camera===void 0&&(E.raycaster.camera=null)}return E.raycaster.camera?E.raycaster.intersectObject(A,!0):[]}let y=d.flatMap(m).sort((A,E)=>{const x=_1(A.object),w=_1(E.object);return!x||!w?A.distance-E.distance:w.events.priority-x.events.priority||A.distance-E.distance}).filter(A=>{const E=_E(A);return h.has(E)?!1:(h.add(E),!0)});u.events.filter&&(y=u.events.filter(y,u));for(const A of y){let E=A.object;for(;E;){var g;(g=E.__r3f)!=null&&g.eventCount&&f.push({...A,eventObject:E}),E=E.parent}}if("pointerId"in l&&u.internal.capturedMap.has(l.pointerId))for(let A of u.internal.capturedMap.get(l.pointerId).values())h.has(_E(A.intersection))||f.push(A.intersection);return f}function r(l,c,u,h){const f=i.getState();if(l.length){const d={stopped:!1};for(const m of l){const y=_1(m.object)||f,{raycaster:g,pointer:A,camera:E,internal:x}=y,w=new Q(A.x,A.y,0).unproject(E),T=R=>{var U,k;return(U=(k=x.capturedMap.get(R))==null?void 0:k.has(m.eventObject))!=null?U:!1},I=R=>{const U={intersection:m,target:c.target};x.capturedMap.has(R)?x.capturedMap.get(R).set(m.eventObject,U):x.capturedMap.set(R,new Map([[m.eventObject,U]])),c.target.setPointerCapture(R)},M=R=>{const U=x.capturedMap.get(R);U&&$z(x.capturedMap,m.eventObject,U,R)};let L={};for(let R in c){let U=c[R];typeof U!="function"&&(L[R]=U)}let P={...m,...L,pointer:A,intersections:l,stopped:d.stopped,delta:u,unprojectedPoint:w,ray:g.ray,camera:E,stopPropagation(){const R="pointerId"in c&&x.capturedMap.get(c.pointerId);if((!R||R.has(m.eventObject))&&(P.stopped=d.stopped=!0,x.hovered.size&&Array.from(x.hovered.values()).find(U=>U.eventObject===m.eventObject))){const U=l.slice(0,l.indexOf(m));s([...U,m])}},target:{hasPointerCapture:T,setPointerCapture:I,releasePointerCapture:M},currentTarget:{hasPointerCapture:T,setPointerCapture:I,releasePointerCapture:M},nativeEvent:c};if(h(P),d.stopped===!0)break}}return l}function s(l){const{internal:c}=i.getState();for(const u of c.hovered.values())if(!l.length||!l.find(h=>h.object===u.object&&h.index===u.index&&h.instanceId===u.instanceId)){const f=u.eventObject.__r3f,d=f==null?void 0:f.handlers;if(c.hovered.delete(_E(u)),f!=null&&f.eventCount){const m={...u,intersections:l};d.onPointerOut==null||d.onPointerOut(m),d.onPointerLeave==null||d.onPointerLeave(m)}}}function o(l,c){for(let u=0;u<c.length;u++){const h=c[u].__r3f;h==null||h.handlers.onPointerMissed==null||h.handlers.onPointerMissed(l)}}function a(l){switch(l){case"onPointerLeave":case"onPointerCancel":return()=>s([]);case"onLostPointerCapture":return c=>{const{internal:u}=i.getState();"pointerId"in c&&u.capturedMap.has(c.pointerId)&&requestAnimationFrame(()=>{u.capturedMap.has(c.pointerId)&&(u.capturedMap.delete(c.pointerId),s([]))})}}return function(u){const{onPointerMissed:h,internal:f}=i.getState();f.lastEvent.current=u;const d=l==="onPointerMove",m=l==="onClick"||l==="onContextMenu"||l==="onDoubleClick",g=n(u,d?t:void 0),A=m?e(u):0;l==="onPointerDown"&&(f.initialClick=[u.offsetX,u.offsetY],f.initialHits=g.map(x=>x.eventObject)),m&&!g.length&&A<=2&&(o(u,f.interaction),h&&h(u)),d&&s(g);function E(x){const w=x.eventObject,T=w.__r3f,I=T==null?void 0:T.handlers;if(T!=null&&T.eventCount)if(d){if(I.onPointerOver||I.onPointerEnter||I.onPointerOut||I.onPointerLeave){const M=_E(x),L=f.hovered.get(M);L?L.stopped&&x.stopPropagation():(f.hovered.set(M,x),I.onPointerOver==null||I.onPointerOver(x),I.onPointerEnter==null||I.onPointerEnter(x))}I.onPointerMove==null||I.onPointerMove(x)}else{const M=I[l];M?(!m||f.initialHits.includes(w))&&(o(u,f.interaction.filter(L=>!f.initialHits.includes(L))),M(x)):m&&f.initialHits.includes(w)&&o(u,f.interaction.filter(L=>!f.initialHits.includes(L)))}}r(g,u,A,E)}}return{handlePointer:a}}const Lie=["set","get","setSize","setFrameloop","setDpr","events","invalidate","advance","size","viewport"],qz=i=>!!(i!=null&&i.render),n0=C.createContext(null),Bie=(i,e)=>{const t=kz((a,l)=>{const c=new Q,u=new Q,h=new Q;function f(A=l().camera,E=u,x=l().size){const{width:w,height:T,top:I,left:M}=x,L=w/T;E.isVector3?h.copy(E):h.set(...E);const P=A.getWorldPosition(c).distanceTo(h);if(Gz(A))return{width:w/A.zoom,height:T/A.zoom,top:I,left:M,factor:1,distance:P,aspect:L};{const R=A.fov*Math.PI/180,U=2*Math.tan(R/2)*P,k=U*(w/T);return{width:k,height:U,top:I,left:M,factor:w/k,distance:P,aspect:L}}}let d;const m=A=>a(E=>({performance:{...E.performance,current:A}})),y=new Ue;return{set:a,get:l,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},xr:null,scene:null,invalidate:(A=1)=>i(l(),A),advance:(A,E)=>e(A,E,l()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new qw,pointer:y,mouse:y,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const A=l();d&&clearTimeout(d),A.performance.current!==A.performance.min&&m(A.performance.min),d=setTimeout(()=>m(l().performance.max),A.performance.debounce)}},size:{width:0,height:0,top:0,left:0,updateStyle:!1},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:f},setEvents:A=>a(E=>({...E,events:{...E.events,...A}})),setSize:(A,E,x,w,T)=>{const I=l().camera,M={width:A,height:E,top:w||0,left:T||0,updateStyle:x};a(L=>({size:M,viewport:{...L.viewport,...f(I,u,M)}}))},setDpr:A=>a(E=>{const x=jz(A);return{viewport:{...E.viewport,dpr:x,initialDpr:E.viewport.initialDpr||x}}}),setFrameloop:(A="always")=>{const E=l().clock;E.stop(),E.elapsedTime=0,A!=="never"&&(E.start(),E.elapsedTime=0),a(()=>({frameloop:A}))},previousRoot:void 0,internal:{active:!1,priority:0,frames:0,lastEvent:C.createRef(),interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,subscribe:(A,E,x)=>{const w=l().internal;return w.priority=w.priority+(E>0?1:0),w.subscribers.push({ref:A,priority:E,store:x}),w.subscribers=w.subscribers.sort((T,I)=>T.priority-I.priority),()=>{const T=l().internal;T!=null&&T.subscribers&&(T.priority=T.priority-(E>0?1:0),T.subscribers=T.subscribers.filter(I=>I.ref!==A))}}}}}),n=t.getState();let r=n.size,s=n.viewport.dpr,o=n.camera;return t.subscribe(()=>{const{camera:a,size:l,viewport:c,gl:u,set:h}=t.getState();if(l.width!==r.width||l.height!==r.height||c.dpr!==s){var f;r=l,s=c.dpr,Yz(a,l),u.setPixelRatio(c.dpr);const d=(f=l.updateStyle)!=null?f:typeof HTMLCanvasElement<"u"&&u.domElement instanceof HTMLCanvasElement;u.setSize(l.width,l.height,d)}a!==o&&(o=a,h(d=>({viewport:{...d.viewport,...d.viewport.getCurrentViewport(a)}})))}),t.subscribe(a=>i(a)),t};function sR(i,e){const t={callback:i};return e.add(t),()=>void e.delete(t)}let SE,Jz=new Set,Zz=new Set,eG=new Set;const Jw=i=>sR(i,Jz),Zw=i=>sR(i,Zz),Die=i=>sR(i,eG);function BT(i,e){if(i.size)for(const{callback:t}of i.values())t(e)}function C1(i,e){switch(i){case"before":return BT(Jz,e);case"after":return BT(Zz,e);case"tail":return BT(eG,e)}}let DT,kT;function FT(i,e,t){let n=e.clock.getDelta();for(e.frameloop==="never"&&typeof i=="number"&&(n=i-e.clock.elapsedTime,e.clock.oldTime=e.clock.elapsedTime,e.clock.elapsedTime=i),DT=e.internal.subscribers,SE=0;SE<DT.length;SE++)kT=DT[SE],kT.ref.current(kT.store.getState(),n,t);return!e.internal.priority&&e.gl.render&&e.gl.render(e.scene,e.camera),e.internal.frames=Math.max(0,e.internal.frames-1),e.frameloop==="always"?1:e.internal.frames}function kie(i){let e=!1,t=!1,n,r,s;function o(c){r=requestAnimationFrame(o),e=!0,n=0,C1("before",c),t=!0;for(const h of i.values()){var u;s=h.store.getState(),s.internal.active&&(s.frameloop==="always"||s.internal.frames>0)&&!((u=s.gl.xr)!=null&&u.isPresenting)&&(n+=FT(c,s))}if(t=!1,C1("after",c),n===0)return C1("tail",c),e=!1,cancelAnimationFrame(r)}function a(c,u=1){var h;if(!c)return i.forEach(f=>a(f.store.getState(),u));(h=c.gl.xr)!=null&&h.isPresenting||!c.internal.active||c.frameloop==="never"||(u>1?c.internal.frames=Math.min(60,c.internal.frames+u):t?c.internal.frames=2:c.internal.frames=1,e||(e=!0,requestAnimationFrame(o)))}function l(c,u=!0,h,f){if(u&&C1("before",c),h)FT(c,h,f);else for(const d of i.values())FT(c,d.store.getState());u&&C1("after",c)}return{loop:o,invalidate:a,advance:l}}function Fie(i){const e=C.useRef(null);return IA(()=>void(e.current=i.current.__r3f),[i]),e}function e4(){const i=C.useContext(n0);if(!i)throw new Error("R3F: Hooks can only be used within the Canvas component!");return i}function Ve(i=t=>t,e){return e4()(i,e)}function Kt(i,e=0){const t=e4(),n=t.getState().internal.subscribe,r=Hz(i);return IA(()=>n(r,e,t),[e,n,t]),null}function Oie(i){return C.useMemo(()=>rR(i),[i])}const $B=new WeakMap;function tG(i,e){return function(t,...n){let r=$B.get(t);return r||(r=new t,$B.set(t,r)),i&&i(r),Promise.all(n.map(s=>new Promise((o,a)=>r.load(s,l=>{l.scene&&Object.assign(l,rR(l.scene)),o(l)},e,l=>a(new Error(`Could not load ${s}: ${l==null?void 0:l.message}`))))))}}function cr(i,e,t,n){const r=Array.isArray(e)?e:[e],s=Th(tG(t,n),[i,...r],{equal:gr.equ});return Array.isArray(e)?s:s[0]}cr.preload=function(i,e,t){const n=Array.isArray(e)?e:[e];return Nz(tG(t),[i,...n])};cr.clear=function(i,e){const t=Array.isArray(e)?e:[e];return Ax([i,...t])};const i0=new Map,{invalidate:UM,advance:zM}=kie(i0),{reconciler:r0,applyProps:Os}=Tie(i0,Rie),Lg={objects:"shallow",strict:!1},Nie=(i,e)=>{const t=typeof i=="function"?i(e):i;return qz(t)?t:new Pw({powerPreference:"high-performance",canvas:e,antialias:!0,alpha:!0,...i})};function Uie(i,e){const t=typeof HTMLCanvasElement<"u"&&i instanceof HTMLCanvasElement;if(e){const{width:n,height:r,top:s,left:o,updateStyle:a=t}=e;return{width:n,height:r,top:s,left:o,updateStyle:a}}else if(typeof HTMLCanvasElement<"u"&&i instanceof HTMLCanvasElement&&i.parentElement){const{width:n,height:r,top:s,left:o}=i.parentElement.getBoundingClientRect();return{width:n,height:r,top:s,left:o,updateStyle:t}}else if(typeof OffscreenCanvas<"u"&&i instanceof OffscreenCanvas)return{width:i.width,height:i.height,top:0,left:0,updateStyle:t};return{width:0,height:0,top:0,left:0}}function oR(i){const e=i0.get(i),t=e==null?void 0:e.fiber,n=e==null?void 0:e.store;e&&console.warn("R3F.createRoot should only be called once!");const r=typeof reportError=="function"?reportError:console.error,s=n||Bie(UM,zM),o=t||r0.createContainer(s,k1.ConcurrentRoot,null,!1,null,"",r,null);e||i0.set(i,{fiber:o,store:s});let a,l=!1,c;return{configure(u={}){let{gl:h,size:f,scene:d,events:m,onCreated:y,shadows:g=!1,linear:A=!1,flat:E=!1,legacy:x=!1,orthographic:w=!1,frameloop:T="always",dpr:I=[1,2],performance:M,raycaster:L,camera:P,onPointerMissed:R}=u,U=s.getState(),k=U.gl;U.gl||U.set({gl:k=Nie(h,i)});let H=U.raycaster;H||U.set({raycaster:H=new y0});const{params:G,...X}=L||{};if(gr.equ(X,H,Lg)||Os(H,{...X}),gr.equ(G,H.params,Lg)||Os(H,{params:{...H.params,...G}}),!U.camera||U.camera===c&&!gr.equ(c,P,Lg)){c=P;const W=P instanceof h0,F=W?P:w?new qi(0,0,0,0,.1,1e3):new jn(75,0,.1,1e3);W||(F.position.z=5,P&&(Os(F,P),("aspect"in P||"left"in P||"right"in P||"bottom"in P||"top"in P)&&(F.manual=!0,F.updateProjectionMatrix())),!U.camera&&!(P!=null&&P.rotation)&&F.lookAt(0,0,0)),U.set({camera:F}),H.camera=F}if(!U.scene){let W;d!=null&&d.isScene?W=d:(W=new Mu,d&&Os(W,d)),U.set({scene:S1(W)})}if(!U.xr){var Z;const W=(te,q)=>{const J=s.getState();J.frameloop!=="never"&&zM(te,!0,J,q)},F=()=>{const te=s.getState();te.gl.xr.enabled=te.gl.xr.isPresenting,te.gl.xr.setAnimationLoop(te.gl.xr.isPresenting?W:null),te.gl.xr.isPresenting||UM(te)},Y={connect(){const te=s.getState().gl;te.xr.addEventListener("sessionstart",F),te.xr.addEventListener("sessionend",F)},disconnect(){const te=s.getState().gl;te.xr.removeEventListener("sessionstart",F),te.xr.removeEventListener("sessionend",F)}};typeof((Z=k.xr)==null?void 0:Z.addEventListener)=="function"&&Y.connect(),U.set({xr:Y})}if(k.shadowMap){const W=k.shadowMap.enabled,F=k.shadowMap.type;if(k.shadowMap.enabled=!!g,gr.boo(g))k.shadowMap.type=Kv;else if(gr.str(g)){var oe;const Y={basic:jN,percentage:gw,soft:Kv,variance:fu};k.shadowMap.type=(oe=Y[g])!=null?oe:Kv}else gr.obj(g)&&Object.assign(k.shadowMap,g);(W!==k.shadowMap.enabled||F!==k.shadowMap.type)&&(k.shadowMap.needsUpdate=!0)}const K=zz();K&&("enabled"in K?K.enabled=!x:"legacyMode"in K&&(K.legacyMode=x)),l||Os(k,{outputEncoding:A?3e3:3001,toneMapping:E?yu:v6}),U.legacy!==x&&U.set(()=>({legacy:x})),U.linear!==A&&U.set(()=>({linear:A})),U.flat!==E&&U.set(()=>({flat:E})),h&&!gr.fun(h)&&!qz(h)&&!gr.equ(h,k,Lg)&&Os(k,h),m&&!U.events.handlers&&U.set({events:m(s)});const V=Uie(i,f);return gr.equ(V,U.size,Lg)||U.setSize(V.width,V.height,V.updateStyle,V.top,V.left),I&&U.viewport.dpr!==jz(I)&&U.setDpr(I),U.frameloop!==T&&U.setFrameloop(T),U.onPointerMissed||U.set({onPointerMissed:R}),M&&!gr.equ(M,U.performance,Lg)&&U.set(W=>({performance:{...W.performance,...M}})),a=y,l=!0,this},render(u){return l||this.configure(),r0.updateContainer(N.jsx(Gie,{store:s,children:u,onCreated:a,rootElement:i}),o,null,()=>{}),s},unmount(){aR(i)}}}function zie(i,e,t){console.warn("R3F.render is no longer supported in React 18. Use createRoot instead!");const n=oR(e);return n.configure(t),n.render(i)}function Gie({store:i,children:e,onCreated:t,rootElement:n}){return IA(()=>{const r=i.getState();r.set(s=>({internal:{...s.internal,active:!0}})),t&&t(r),i.getState().events.connected||r.events.connect==null||r.events.connect(n)},[]),N.jsx(n0.Provider,{value:i,children:e})}function aR(i,e){const t=i0.get(i),n=t==null?void 0:t.fiber;if(n){const r=t==null?void 0:t.store.getState();r&&(r.internal.active=!1),r0.updateContainer(null,n,null,()=>{r&&setTimeout(()=>{try{var s,o,a,l;r.events.disconnect==null||r.events.disconnect(),(s=r.gl)==null||(o=s.renderLists)==null||o.dispose==null||o.dispose(),(a=r.gl)==null||a.forceContextLoss==null||a.forceContextLoss(),(l=r.gl)!=null&&l.xr&&r.xr.disconnect(),Wz(r),i0.delete(i),e&&e(i)}catch{}},500)})}}function vp(i,e,t){return N.jsx(Hie,{children:i,container:e,state:t},e.uuid)}function Hie({state:i={},children:e,container:t}){const{events:n,size:r,...s}=i,o=e4(),[a]=C.useState(()=>new y0),[l]=C.useState(()=>new Ue),c=C.useCallback((h,f)=>{const d={...h};Object.keys(h).forEach(y=>{(Lie.includes(y)||h[y]!==f[y]&&f[y])&&delete d[y]});let m;if(f&&r){const y=f.camera;m=h.viewport.getCurrentViewport(y,new Q,r),y!==h.camera&&Yz(y,r)}return{...d,scene:t,raycaster:a,pointer:l,mouse:l,previousRoot:o,events:{...h.events,...f==null?void 0:f.events,...n},size:{...h.size,...r},viewport:{...h.viewport,...m},...s}},[i]),[u]=C.useState(()=>{const h=o.getState();return kz((d,m)=>({...h,scene:t,raycaster:a,pointer:l,mouse:l,previousRoot:o,events:{...h.events,...n},size:{...h.size,...r},...s,set:d,get:m,setEvents:y=>d(g=>({...g,events:{...g.events,...y}}))}))});return C.useEffect(()=>{const h=o.subscribe(f=>u.setState(d=>c(f,d)));return()=>{h()}},[c]),C.useEffect(()=>{u.setState(h=>c(o.getState(),h))},[c]),C.useEffect(()=>()=>{u.destroy()},[]),N.jsx(N.Fragment,{children:r0.createPortal(N.jsx(n0.Provider,{value:u,children:e}),u,null)})}function Qie(i){return r0.flushSync(i,void 0)}r0.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:C.version});const Vie=C.unstable_act,OT={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function GM(i){const{handlePointer:e}=Xz(i);return{priority:1,enabled:!0,compute(t,n,r){n.pointer.set(t.offsetX/n.size.width*2-1,-(t.offsetY/n.size.height)*2+1),n.raycaster.setFromCamera(n.pointer,n.camera)},connected:void 0,handlers:Object.keys(OT).reduce((t,n)=>({...t,[n]:e(n)}),{}),update:()=>{var t;const{events:n,internal:r}=i.getState();(t=r.lastEvent)!=null&&t.current&&n.handlers&&n.handlers.onPointerMove(r.lastEvent.current)},connect:t=>{var n;const{set:r,events:s}=i.getState();s.disconnect==null||s.disconnect(),r(o=>({events:{...o.events,connected:t}})),Object.entries((n=s.handlers)!=null?n:[]).forEach(([o,a])=>{const[l,c]=OT[o];t.addEventListener(l,a,{passive:c})})},disconnect:()=>{const{set:t,events:n}=i.getState();if(n.connected){var r;Object.entries((r=n.handlers)!=null?r:[]).forEach(([s,o])=>{if(n&&n.connected instanceof HTMLElement){const[a]=OT[s];n.connected.removeEventListener(a,o)}}),t(s=>({events:{...s.events,connected:void 0}}))}}}}function XB(i,e){let t;return(...n)=>{window.clearTimeout(t),t=window.setTimeout(()=>i(...n),e)}}function jie({debounce:i,scroll:e,polyfill:t,offsetSize:n}={debounce:0,scroll:!1,offsetSize:!1}){const r=t||(typeof window>"u"?class{}:window.ResizeObserver);if(!r)throw new Error("This browser does not support ResizeObserver out of the box. See: https://github.com/react-spring/react-use-measure/#resize-observer-polyfills");const[s,o]=C.useState({left:0,top:0,width:0,height:0,bottom:0,right:0,x:0,y:0}),a=C.useRef({element:null,scrollContainers:null,resizeObserver:null,lastBounds:s,orientationHandler:null}),l=i?typeof i=="number"?i:i.scroll:null,c=i?typeof i=="number"?i:i.resize:null,u=C.useRef(!1);C.useEffect(()=>(u.current=!0,()=>void(u.current=!1)));const[h,f,d]=C.useMemo(()=>{const A=()=>{if(!a.current.element)return;const{left:E,top:x,width:w,height:T,bottom:I,right:M,x:L,y:P}=a.current.element.getBoundingClientRect(),R={left:E,top:x,width:w,height:T,bottom:I,right:M,x:L,y:P};a.current.element instanceof HTMLElement&&n&&(R.height=a.current.element.offsetHeight,R.width=a.current.element.offsetWidth),Object.freeze(R),u.current&&!$ie(a.current.lastBounds,R)&&o(a.current.lastBounds=R)};return[A,c?XB(A,c):A,l?XB(A,l):A]},[o,n,l,c]);function m(){a.current.scrollContainers&&(a.current.scrollContainers.forEach(A=>A.removeEventListener("scroll",d,!0)),a.current.scrollContainers=null),a.current.resizeObserver&&(a.current.resizeObserver.disconnect(),a.current.resizeObserver=null),a.current.orientationHandler&&("orientation"in screen&&"removeEventListener"in screen.orientation?screen.orientation.removeEventListener("change",a.current.orientationHandler):"onorientationchange"in window&&window.removeEventListener("orientationchange",a.current.orientationHandler))}function y(){a.current.element&&(a.current.resizeObserver=new r(d),a.current.resizeObserver.observe(a.current.element),e&&a.current.scrollContainers&&a.current.scrollContainers.forEach(A=>A.addEventListener("scroll",d,{capture:!0,passive:!0})),a.current.orientationHandler=()=>{d()},"orientation"in screen&&"addEventListener"in screen.orientation?screen.orientation.addEventListener("change",a.current.orientationHandler):"onorientationchange"in window&&window.addEventListener("orientationchange",a.current.orientationHandler))}const g=A=>{!A||A===a.current.element||(m(),a.current.element=A,a.current.scrollContainers=nG(A),y())};return Kie(d,!!e),Wie(f),C.useEffect(()=>{m(),y()},[e,d,f]),C.useEffect(()=>m,[]),[g,s,h]}function Wie(i){C.useEffect(()=>{const e=i;return window.addEventListener("resize",e),()=>void window.removeEventListener("resize",e)},[i])}function Kie(i,e){C.useEffect(()=>{if(e){const t=i;return window.addEventListener("scroll",t,{capture:!0,passive:!0}),()=>void window.removeEventListener("scroll",t,!0)}},[i,e])}function nG(i){const e=[];if(!i||i===document.body)return e;const{overflow:t,overflowX:n,overflowY:r}=window.getComputedStyle(i);return[t,n,r].some(s=>s==="auto"||s==="scroll")&&e.push(i),[...e,...nG(i.parentElement)]}const Yie=["x","y","top","bottom","left","right","width","height"],$ie=(i,e)=>Yie.every(t=>i[t]===e[t]);var Xie=Object.defineProperty,qie=Object.defineProperties,Jie=Object.getOwnPropertyDescriptors,qB=Object.getOwnPropertySymbols,Zie=Object.prototype.hasOwnProperty,ere=Object.prototype.propertyIsEnumerable,JB=(i,e,t)=>e in i?Xie(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,ZB=(i,e)=>{for(var t in e||(e={}))Zie.call(e,t)&&JB(i,t,e[t]);if(qB)for(var t of qB(e))ere.call(e,t)&&JB(i,t,e[t]);return i},tre=(i,e)=>qie(i,Jie(e)),eD,tD;typeof window<"u"&&((eD=window.document)!=null&&eD.createElement||((tD=window.navigator)==null?void 0:tD.product)==="ReactNative")?C.useLayoutEffect:C.useEffect;function iG(i,e,t){if(!i)return;if(t(i)===!0)return i;let n=i.child;for(;n;){const r=iG(n,e,t);if(r)return r;n=n.sibling}}function rG(i){try{return Object.defineProperties(i,{_currentRenderer:{get(){return null},set(){}},_currentRenderer2:{get(){return null},set(){}}})}catch{return i}}const nD=console.error;console.error=function(){const i=[...arguments].join("");if(i!=null&&i.startsWith("Warning:")&&i.includes("useContext")){console.error=nD;return}return nD.apply(this,arguments)};const lR=rG(C.createContext(null));class sG extends C.Component{render(){return C.createElement(lR.Provider,{value:this._reactInternals},this.props.children)}}function nre(){const i=C.useContext(lR);if(i===null)throw new Error("its-fine: useFiber must be called within a <FiberProvider />!");const e=C.useId();return C.useMemo(()=>{for(const n of[i,i==null?void 0:i.alternate]){if(!n)continue;const r=iG(n,!1,s=>{let o=s.memoizedState;for(;o;){if(o.memoizedState===e)return!0;o=o.next}});if(r)return r}},[i,e])}function ire(){const i=nre(),[e]=C.useState(()=>new Map);e.clear();let t=i;for(;t;){if(t.type&&typeof t.type=="object"){const r=t.type._context===void 0&&t.type.Provider===t.type?t.type:t.type._context;r&&r!==lR&&!e.has(r)&&e.set(r,C.useContext(rG(r)))}t=t.return}return e}function rre(){const i=ire();return C.useMemo(()=>Array.from(i.keys()).reduce((e,t)=>n=>C.createElement(e,null,C.createElement(t.Provider,tre(ZB({},n),{value:i.get(t)}))),e=>C.createElement(sG,ZB({},e))),[i])}const sre=C.forwardRef(function({children:e,fallback:t,resize:n,style:r,gl:s,events:o=GM,eventSource:a,eventPrefix:l,shadows:c,linear:u,flat:h,legacy:f,orthographic:d,frameloop:m,dpr:y,performance:g,raycaster:A,camera:E,scene:x,onPointerMissed:w,onCreated:T,...I},M){C.useMemo(()=>Or(nR),[]);const L=rre(),[P,R]=jie({scroll:!0,debounce:{scroll:50,resize:0},...n}),U=C.useRef(null),k=C.useRef(null);C.useImperativeHandle(M,()=>U.current);const H=Hz(w),[G,X]=C.useState(!1),[Z,oe]=C.useState(!1);if(G)throw G;if(Z)throw Z;const K=C.useRef(null);IA(()=>{const W=U.current;R.width>0&&R.height>0&&W&&(K.current||(K.current=oR(W)),K.current.configure({gl:s,events:o,shadows:c,linear:u,flat:h,legacy:f,orthographic:d,frameloop:m,dpr:y,performance:g,raycaster:A,camera:E,scene:x,size:R,onPointerMissed:(...F)=>H.current==null?void 0:H.current(...F),onCreated:F=>{F.events.connect==null||F.events.connect(a?bie(a)?a.current:a:k.current),l&&F.setEvents({compute:(Y,te)=>{const q=Y[l+"X"],J=Y[l+"Y"];te.pointer.set(q/te.size.width*2-1,-(J/te.size.height)*2+1),te.raycaster.setFromCamera(te.pointer,te.camera)}}),T==null||T(F)}}),K.current.render(N.jsx(L,{children:N.jsx(Qz,{set:oe,children:N.jsx(C.Suspense,{fallback:N.jsx(Iie,{set:X}),children:e??null})})})))}),C.useEffect(()=>{const W=U.current;if(W)return()=>aR(W)},[]);const V=a?"none":"auto";return N.jsx("div",{ref:k,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:V,...r},...I,children:N.jsx("div",{ref:P,style:{width:"100%",height:"100%"},children:N.jsx("canvas",{ref:U,style:{display:"block"},children:t})})})}),oG=C.forwardRef(function(e,t){return N.jsx(sG,{children:N.jsx(sre,{...e,ref:t})})}),ore=Object.freeze(Object.defineProperty({__proto__:null,Canvas:oG,ReactThreeFiber:Cie,_roots:i0,act:Vie,addAfterEffect:Zw,addEffect:Jw,addTail:Die,advance:zM,applyProps:Os,buildGraph:rR,context:n0,createEvents:Xz,createPointerEvents:GM,createPortal:vp,createRoot:oR,dispose:Wz,events:GM,extend:Or,flushGlobalEffects:C1,flushSync:Qie,getRootState:_1,invalidate:UM,reconciler:r0,render:zie,unmountComponentAtNode:aR,useFrame:Kt,useGraph:Oie,useInstanceHandle:Fie,useLoader:cr,useStore:e4,useThree:Ve},Symbol.toStringTag,{value:"Module"}));function ot(){return ot=Object.assign?Object.assign.bind():function(i){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)({}).hasOwnProperty.call(t,n)&&(i[n]=t[n])}return i},ot.apply(null,arguments)}const yx=new Q,cR=new Q,are=new Q,iD=new Ue;function lre(i,e,t){const n=yx.setFromMatrixPosition(i.matrixWorld);n.project(e);const r=t.width/2,s=t.height/2;return[n.x*r+r,-(n.y*s)+s]}function cre(i,e){const t=yx.setFromMatrixPosition(i.matrixWorld),n=cR.setFromMatrixPosition(e.matrixWorld),r=t.sub(n),s=e.getWorldDirection(are);return r.angleTo(s)>Math.PI/2}function ure(i,e,t,n){const r=yx.setFromMatrixPosition(i.matrixWorld),s=r.clone();s.project(e),iD.set(s.x,s.y),t.setFromCamera(iD,e);const o=t.intersectObjects(n,!0);if(o.length){const a=o[0].distance;return r.distanceTo(t.ray.origin)<a}return!0}function hre(i,e){if(e instanceof qi)return e.zoom;if(e instanceof jn){const t=yx.setFromMatrixPosition(i.matrixWorld),n=cR.setFromMatrixPosition(e.matrixWorld),r=e.fov*Math.PI/180,s=t.distanceTo(n);return 1/(2*Math.tan(r/2)*s)}else return 1}function fre(i,e,t){if(e instanceof jn||e instanceof qi){const n=yx.setFromMatrixPosition(i.matrixWorld),r=cR.setFromMatrixPosition(e.matrixWorld),s=n.distanceTo(r),o=(t[1]-t[0])/(e.far-e.near),a=t[1]-o*e.far;return Math.round(o*s+a)}}const HM=i=>Math.abs(i)<1e-10?0:i;function aG(i,e,t=""){let n="matrix3d(";for(let r=0;r!==16;r++)n+=HM(e[r]*i.elements[r])+(r!==15?",":")");return t+n}const dre=(i=>e=>aG(e,i))([1,-1,1,1,1,-1,1,1,1,-1,1,1,1,-1,1,1]),pre=(i=>(e,t)=>aG(e,i(t),"translate(-50%,-50%)"))(i=>[1/i,1/i,1/i,1,-1/i,-1/i,-1/i,-1,1/i,1/i,1/i,1,1,1,1,1]);function mre(i){return i&&typeof i=="object"&&"current"in i}const MA=C.forwardRef(({children:i,eps:e=.001,style:t,className:n,prepend:r,center:s,fullscreen:o,portal:a,distanceFactor:l,sprite:c=!1,transform:u=!1,occlude:h,onOcclude:f,castShadow:d,receiveShadow:m,material:y,geometry:g,zIndexRange:A=[16777271,0],calculatePosition:E=lre,as:x="div",wrapperClass:w,pointerEvents:T="auto",...I},M)=>{const{gl:L,camera:P,scene:R,size:U,raycaster:k,events:H,viewport:G}=Ve(),[X]=C.useState(()=>document.createElement(x)),Z=C.useRef(),oe=C.useRef(null),K=C.useRef(0),V=C.useRef([0,0]),W=C.useRef(null),F=C.useRef(null),Y=(a==null?void 0:a.current)||H.connected||L.domElement.parentNode,te=C.useRef(null),q=C.useRef(!1),J=C.useMemo(()=>h&&h!=="blending"||Array.isArray(h)&&h.length&&mre(h[0]),[h]);C.useLayoutEffect(()=>{const xe=L.domElement;h&&h==="blending"?(xe.style.zIndex=`${Math.floor(A[0]/2)}`,xe.style.position="absolute",xe.style.pointerEvents="none"):(xe.style.zIndex=null,xe.style.position=null,xe.style.pointerEvents=null)},[h]),C.useLayoutEffect(()=>{if(oe.current){const xe=Z.current=A6.createRoot(X);if(R.updateMatrixWorld(),u)X.style.cssText="position:absolute;top:0;left:0;pointer-events:none;overflow:hidden;";else{const pe=E(oe.current,P,U);X.style.cssText=`position:absolute;top:0;left:0;transform:translate3d(${pe[0]}px,${pe[1]}px,0);transform-origin:0 0;`}return Y&&(r?Y.prepend(X):Y.appendChild(X)),()=>{Y&&Y.removeChild(X),xe.unmount()}}},[Y,u]),C.useLayoutEffect(()=>{w&&(X.className=w)},[w]);const re=C.useMemo(()=>u?{position:"absolute",top:0,left:0,width:U.width,height:U.height,transformStyle:"preserve-3d",pointerEvents:"none"}:{position:"absolute",transform:s?"translate3d(-50%,-50%,0)":"none",...o&&{top:-U.height/2,left:-U.width/2,width:U.width,height:U.height},...t},[t,s,o,U,u]),ie=C.useMemo(()=>({position:"absolute",pointerEvents:T}),[T]);C.useLayoutEffect(()=>{if(q.current=!1,u){var xe;(xe=Z.current)==null||xe.render(C.createElement("div",{ref:W,style:re},C.createElement("div",{ref:F,style:ie},C.createElement("div",{ref:M,className:n,style:t,children:i}))))}else{var pe;(pe=Z.current)==null||pe.render(C.createElement("div",{ref:M,style:re,className:n,children:i}))}});const se=C.useRef(!0);Kt(xe=>{if(oe.current){P.updateMatrixWorld(),oe.current.updateWorldMatrix(!0,!1);const pe=u?V.current:E(oe.current,P,U);if(u||Math.abs(K.current-P.zoom)>e||Math.abs(V.current[0]-pe[0])>e||Math.abs(V.current[1]-pe[1])>e){const ue=cre(oe.current,P);let Me=!1;J&&(Array.isArray(h)?Me=h.map(ke=>ke.current):h!=="blending"&&(Me=[R]));const Se=se.current;if(Me){const ke=ure(oe.current,P,k,Me);se.current=ke&&!ue}else se.current=!ue;Se!==se.current&&(f?f(!se.current):X.style.display=se.current?"block":"none");const ve=Math.floor(A[0]/2),Ae=h?J?[A[0],ve]:[ve-1,0]:A;if(X.style.zIndex=`${fre(oe.current,P,Ae)}`,u){const[ke,be]=[U.width/2,U.height/2],ne=P.projectionMatrix.elements[5]*be,{isOrthographicCamera:j,top:de,left:Re,bottom:Le,right:Fe}=P,He=dre(P.matrixWorldInverse),it=j?`scale(${ne})translate(${HM(-(Fe+Re)/2)}px,${HM((de+Le)/2)}px)`:`translateZ(${ne}px)`;let Ye=oe.current.matrixWorld;c&&(Ye=P.matrixWorldInverse.clone().transpose().copyPosition(Ye).scale(oe.current.scale),Ye.elements[3]=Ye.elements[7]=Ye.elements[11]=0,Ye.elements[15]=1),X.style.width=U.width+"px",X.style.height=U.height+"px",X.style.perspective=j?"":`${ne}px`,W.current&&F.current&&(W.current.style.transform=`${it}${He}translate(${ke}px,${be}px)`,F.current.style.transform=pre(Ye,1/((l||10)/400)))}else{const ke=l===void 0?1:hre(oe.current,P)*l;X.style.transform=`translate3d(${pe[0]}px,${pe[1]}px,0) scale(${ke})`}V.current=pe,K.current=P.zoom}}if(!J&&te.current&&!q.current)if(u){if(W.current){const pe=W.current.children[0];if(pe!=null&&pe.clientWidth&&pe!=null&&pe.clientHeight){const{isOrthographicCamera:ue}=P;if(ue||g)I.scale&&(Array.isArray(I.scale)?I.scale instanceof Q?te.current.scale.copy(I.scale.clone().divideScalar(1)):te.current.scale.set(1/I.scale[0],1/I.scale[1],1/I.scale[2]):te.current.scale.setScalar(1/I.scale));else{const Me=(l||10)/400,Se=pe.clientWidth*Me,ve=pe.clientHeight*Me;te.current.scale.set(Se,ve,1)}q.current=!0}}}else{const pe=X.children[0];if(pe!=null&&pe.clientWidth&&pe!=null&&pe.clientHeight){const ue=1/G.factor,Me=pe.clientWidth*ue,Se=pe.clientHeight*ue;te.current.scale.set(Me,Se,1),q.current=!0}te.current.lookAt(xe.camera.position)}});const ge=C.useMemo(()=>({vertexShader:u?void 0:`
          /*
            This shader is from the THREE's SpriteMaterial.
            We need to turn the backing plane into a Sprite
            (make it always face the camera) if "transfrom"
            is false.
          */
          #include <common>

          void main() {
            vec2 center = vec2(0., 1.);
            float rotation = 0.0;

            // This is somewhat arbitrary, but it seems to work well
            // Need to figure out how to derive this dynamically if it even matters
            float size = 0.03;

            vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
            vec2 scale;
            scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
            scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );

            bool isPerspective = isPerspectiveMatrix( projectionMatrix );
            if ( isPerspective ) scale *= - mvPosition.z;

            vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale * size;
            vec2 rotatedPosition;
            rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
            rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
            mvPosition.xy += rotatedPosition;

            gl_Position = projectionMatrix * mvPosition;
          }
      `,fragmentShader:`
        void main() {
          gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
        }
      `}),[u]);return C.createElement("group",ot({},I,{ref:oe}),h&&!J&&C.createElement("mesh",{castShadow:d,receiveShadow:m,ref:te},g||C.createElement("planeGeometry",null),y||C.createElement("shaderMaterial",{side:Li,vertexShader:ge.vertexShader,fragmentShader:ge.fragmentShader})))});function gre({onChanged:i,portal:e,preventDefault:t=!0,scroll:n=!0,keyCode:r=9}){const s=C.useRef(0),o=Ve(c=>c.setEvents),a=Ve(c=>c.get),l=Ve(c=>c.gl);return C.useEffect(()=>{var c;let u=[],h;const f=a().events.filter,d=(c=e==null?void 0:e.current)!==null&&c!==void 0?c:l.domElement.parentNode,m=()=>d&&i&&i(u,Math.round(s.current)%u.length);o({filter:(x,w)=>{let T=[...x];(T.length!==u.length||!u.every(I=>T.map(M=>M.object.uuid).includes(I.object.uuid)))&&(s.current=0,u=T,m()),f&&(T=f(T,w));for(let I=0;I<Math.round(s.current)%T.length;I++){const M=T.shift();T=[...T,M]}return T}});const y=x=>{var w,T;s.current=x(s.current),(w=a().events.handlers)==null||w.onPointerCancel(void 0),(T=a().events.handlers)==null||T.onPointerMove(h),m()},g=x=>{(x.keyCode||x.which)===r&&(t&&x.preventDefault(),u.length>1&&y(w=>w+1))},A=x=>{t&&x.preventDefault();let w=0;x||(x=window.event),x.wheelDelta?w=x.wheelDelta/120:x.detail&&(w=-x.detail/3),u.length>1&&y(T=>Math.abs(T-w))},E=x=>h=x;return document.addEventListener("pointermove",E,{passive:!0}),n&&document.addEventListener("wheel",A),r!==void 0&&document.addEventListener("keydown",g),()=>{o({filter:f}),r!==void 0&&document.removeEventListener("keydown",g),n&&document.removeEventListener("wheel",A),document.removeEventListener("pointermove",E)}},[l,a,o,t,n,r]),null}function Are(i,e="pointer",t="auto",n=document.body){C.useEffect(()=>{if(i)return n.style.cursor=e,()=>void(n.style.cursor=t)},[i])}const rD=i=>{let e;const t=new Set,n=(c,u)=>{const h=typeof c=="function"?c(e):c;if(!Object.is(h,e)){const f=e;e=u??(typeof h!="object"||h===null)?h:Object.assign({},e,h),t.forEach(d=>d(e,f))}},r=()=>e,a={setState:n,getState:r,getInitialState:()=>l,subscribe:c=>(t.add(c),()=>t.delete(c))},l=e=i(n,r,a);return a},yre=(i=>i?rD(i):rD),vre=i=>i;function xre(i,e=vre){const t=bl.useSyncExternalStore(i.subscribe,bl.useCallback(()=>e(i.getState()),[i,e]),bl.useCallback(()=>e(i.getInitialState()),[i,e]));return bl.useDebugValue(t),t}const sD=i=>{const e=yre(i),t=n=>xre(e,n);return Object.assign(t,e),t},lG=(i=>i?sD(i):sD);let Vy=0;const uR=lG(i=>(D1.onStart=(e,t,n)=>{i({active:!0,item:e,loaded:t,total:n,progress:(t-Vy)/(n-Vy)*100})},D1.onLoad=()=>{i({active:!1})},D1.onError=e=>i(t=>({errors:[...t.errors,e]})),D1.onProgress=(e,t,n)=>{t===n&&(Vy=n),i({active:!0,item:e,loaded:t,total:n,progress:(t-Vy)/(n-Vy)*100||100})},{errors:[],active:!1,progress:0,item:"",loaded:0,total:0}));function Ere({children:i}){const e=uR();return C.createElement(C.Fragment,null,i==null?void 0:i(e))}const _re=i=>`Loading ${i.toFixed(2)}%`;function Sre({containerStyles:i,innerStyles:e,barStyles:t,dataStyles:n,dataInterpolation:r=_re,initialState:s=o=>o}){const{active:o,progress:a}=uR(),l=C.useRef(0),c=C.useRef(0),u=C.useRef(null),[h,f]=C.useState(s(o));C.useEffect(()=>{let m;return o!==h&&(m=setTimeout(()=>f(o),300)),()=>clearTimeout(m)},[h,o]);const d=C.useCallback(()=>{u.current&&(l.current+=(a-l.current)/2,(l.current>.95*a||a===100)&&(l.current=a),u.current.innerText=r(l.current),l.current<a&&(c.current=requestAnimationFrame(d)))},[r,a]);return C.useEffect(()=>(d(),()=>cancelAnimationFrame(c.current)),[d]),h?C.createElement("div",{style:{...wE.container,opacity:o?1:0,...i}},C.createElement("div",null,C.createElement("div",{style:{...wE.inner,...e}},C.createElement("div",{style:{...wE.bar,transform:`scaleX(${a/100})`,...t}}),C.createElement("span",{ref:u,style:{...wE.data,...n}})))):null}const wE={container:{position:"absolute",top:0,left:0,width:"100%",height:"100%",background:"#171717",display:"flex",alignItems:"center",justifyContent:"center",transition:"opacity 300ms ease",zIndex:1e3},inner:{width:100,height:3,background:"#272727",textAlign:"center"},bar:{height:3,width:"100%",background:"white",transition:"transform 200ms",transformOrigin:"left center"},data:{display:"inline-block",position:"relative",fontVariantNumeric:"tabular-nums",marginTop:"0.8em",color:"#f0f0f0",fontSize:"0.6em",fontFamily:'-apple-system, BlinkMacSystemFont, "Inter", "Segoe UI", "Helvetica Neue", Helvetica, Arial, Roboto, Ubuntu, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',whiteSpace:"nowrap"}};function wre(i,e,t){return Math.max(e,Math.min(i,t))}const Tr={toVector(i,e){return i===void 0&&(i=e),Array.isArray(i)?i:[i,i]},add(i,e){return[i[0]+e[0],i[1]+e[1]]},sub(i,e){return[i[0]-e[0],i[1]-e[1]]},addTo(i,e){i[0]+=e[0],i[1]+=e[1]},subTo(i,e){i[0]-=e[0],i[1]-=e[1]}};function oD(i,e,t){return e===0||Math.abs(e)===1/0?Math.pow(i,t*5):i*e*t/(e+t*i)}function aD(i,e,t,n=.15){return n===0?wre(i,e,t):i<e?-oD(e-i,t-e,n)+e:i>t?+oD(i-t,t-e,n)+t:i}function Cre(i,[e,t],[n,r]){const[[s,o],[a,l]]=i;return[aD(e,s,o,n),aD(t,a,l,r)]}function Tre(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var n=t.call(i,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}function bre(i){var e=Tre(i,"string");return typeof e=="symbol"?e:String(e)}function Bs(i,e,t){return e=bre(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function lD(i,e){var t=Object.keys(i);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(i);e&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(i,r).enumerable})),t.push.apply(t,n)}return t}function Kr(i){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?lD(Object(t),!0).forEach(function(n){Bs(i,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(t)):lD(Object(t)).forEach(function(n){Object.defineProperty(i,n,Object.getOwnPropertyDescriptor(t,n))})}return i}const cG={pointer:{start:"down",change:"move",end:"up"},mouse:{start:"down",change:"move",end:"up"},touch:{start:"start",change:"move",end:"end"},gesture:{start:"start",change:"change",end:"end"}};function cD(i){return i?i[0].toUpperCase()+i.slice(1):""}const Ire=["enter","leave"];function Mre(i=!1,e){return i&&!Ire.includes(e)}function Rre(i,e="",t=!1){const n=cG[i],r=n&&n[e]||e;return"on"+cD(i)+cD(r)+(Mre(t,r)?"Capture":"")}const Pre=["gotpointercapture","lostpointercapture"];function Lre(i){let e=i.substring(2).toLowerCase();const t=!!~e.indexOf("passive");t&&(e=e.replace("passive",""));const n=Pre.includes(e)?"capturecapture":"capture",r=!!~e.indexOf(n);return r&&(e=e.replace("capture","")),{device:e,capture:r,passive:t}}function Bre(i,e=""){const t=cG[i],n=t&&t[e]||e;return i+n}function t4(i){return"touches"in i}function uG(i){return t4(i)?"touch":"pointerType"in i?i.pointerType:"mouse"}function Dre(i){return Array.from(i.touches).filter(e=>{var t,n;return e.target===i.currentTarget||((t=i.currentTarget)===null||t===void 0||(n=t.contains)===null||n===void 0?void 0:n.call(t,e.target))})}function kre(i){return i.type==="touchend"||i.type==="touchcancel"?i.changedTouches:i.targetTouches}function hG(i){return t4(i)?kre(i)[0]:i}function QM(i,e){try{const t=e.clientX-i.clientX,n=e.clientY-i.clientY,r=(e.clientX+i.clientX)/2,s=(e.clientY+i.clientY)/2,o=Math.hypot(t,n);return{angle:-(Math.atan2(t,n)*180)/Math.PI,distance:o,origin:[r,s]}}catch{}return null}function Fre(i){return Dre(i).map(e=>e.identifier)}function uD(i,e){const[t,n]=Array.from(i.touches).filter(r=>e.includes(r.identifier));return QM(t,n)}function NT(i){const e=hG(i);return t4(i)?e.identifier:e.pointerId}function oA(i){const e=hG(i);return[e.clientX,e.clientY]}const hD=40,fD=800;function fG(i){let{deltaX:e,deltaY:t,deltaMode:n}=i;return n===1?(e*=hD,t*=hD):n===2&&(e*=fD,t*=fD),[e,t]}function Ore(i){var e,t;const{scrollX:n,scrollY:r,scrollLeft:s,scrollTop:o}=i.currentTarget;return[(e=n??s)!==null&&e!==void 0?e:0,(t=r??o)!==null&&t!==void 0?t:0]}function Nre(i){const e={};if("buttons"in i&&(e.buttons=i.buttons),"shiftKey"in i){const{shiftKey:t,altKey:n,metaKey:r,ctrlKey:s}=i;Object.assign(e,{shiftKey:t,altKey:n,metaKey:r,ctrlKey:s})}return e}function BS(i,...e){return typeof i=="function"?i(...e):i}function Ure(){}function zre(...i){return i.length===0?Ure:i.length===1?i[0]:function(){let e;for(const t of i)e=t.apply(this,arguments)||e;return e}}function dD(i,e){return Object.assign({},e,i||{})}const Gre=32;class dG{constructor(e,t,n){this.ctrl=e,this.args=t,this.key=n,this.state||(this.state={},this.computeValues([0,0]),this.computeInitial(),this.init&&this.init(),this.reset())}get state(){return this.ctrl.state[this.key]}set state(e){this.ctrl.state[this.key]=e}get shared(){return this.ctrl.state.shared}get eventStore(){return this.ctrl.gestureEventStores[this.key]}get timeoutStore(){return this.ctrl.gestureTimeoutStores[this.key]}get config(){return this.ctrl.config[this.key]}get sharedConfig(){return this.ctrl.config.shared}get handler(){return this.ctrl.handlers[this.key]}reset(){const{state:e,shared:t,ingKey:n,args:r}=this;t[n]=e._active=e.active=e._blocked=e._force=!1,e._step=[!1,!1],e.intentional=!1,e._movement=[0,0],e._distance=[0,0],e._direction=[0,0],e._delta=[0,0],e._bounds=[[-1/0,1/0],[-1/0,1/0]],e.args=r,e.axis=void 0,e.memo=void 0,e.elapsedTime=e.timeDelta=0,e.direction=[0,0],e.distance=[0,0],e.overflow=[0,0],e._movementBound=[!1,!1],e.velocity=[0,0],e.movement=[0,0],e.delta=[0,0],e.timeStamp=0}start(e){const t=this.state,n=this.config;t._active||(this.reset(),this.computeInitial(),t._active=!0,t.target=e.target,t.currentTarget=e.currentTarget,t.lastOffset=n.from?BS(n.from,t):t.offset,t.offset=t.lastOffset,t.startTime=t.timeStamp=e.timeStamp)}computeValues(e){const t=this.state;t._values=e,t.values=this.config.transform(e)}computeInitial(){const e=this.state;e._initial=e._values,e.initial=e.values}compute(e){const{state:t,config:n,shared:r}=this;t.args=this.args;let s=0;if(e&&(t.event=e,n.preventDefault&&e.cancelable&&t.event.preventDefault(),t.type=e.type,r.touches=this.ctrl.pointerIds.size||this.ctrl.touchIds.size,r.locked=!!document.pointerLockElement,Object.assign(r,Nre(e)),r.down=r.pressed=r.buttons%2===1||r.touches>0,s=e.timeStamp-t.timeStamp,t.timeStamp=e.timeStamp,t.elapsedTime=t.timeStamp-t.startTime),t._active){const I=t._delta.map(Math.abs);Tr.addTo(t._distance,I)}this.axisIntent&&this.axisIntent(e);const[o,a]=t._movement,[l,c]=n.threshold,{_step:u,values:h}=t;if(n.hasCustomTransform?(u[0]===!1&&(u[0]=Math.abs(o)>=l&&h[0]),u[1]===!1&&(u[1]=Math.abs(a)>=c&&h[1])):(u[0]===!1&&(u[0]=Math.abs(o)>=l&&Math.sign(o)*l),u[1]===!1&&(u[1]=Math.abs(a)>=c&&Math.sign(a)*c)),t.intentional=u[0]!==!1||u[1]!==!1,!t.intentional)return;const f=[0,0];if(n.hasCustomTransform){const[I,M]=h;f[0]=u[0]!==!1?I-u[0]:0,f[1]=u[1]!==!1?M-u[1]:0}else f[0]=u[0]!==!1?o-u[0]:0,f[1]=u[1]!==!1?a-u[1]:0;this.restrictToAxis&&!t._blocked&&this.restrictToAxis(f);const d=t.offset,m=t._active&&!t._blocked||t.active;m&&(t.first=t._active&&!t.active,t.last=!t._active&&t.active,t.active=r[this.ingKey]=t._active,e&&(t.first&&("bounds"in n&&(t._bounds=BS(n.bounds,t)),this.setup&&this.setup()),t.movement=f,this.computeOffset()));const[y,g]=t.offset,[[A,E],[x,w]]=t._bounds;t.overflow=[y<A?-1:y>E?1:0,g<x?-1:g>w?1:0],t._movementBound[0]=t.overflow[0]?t._movementBound[0]===!1?t._movement[0]:t._movementBound[0]:!1,t._movementBound[1]=t.overflow[1]?t._movementBound[1]===!1?t._movement[1]:t._movementBound[1]:!1;const T=t._active?n.rubberband||[0,0]:[0,0];if(t.offset=Cre(t._bounds,t.offset,T),t.delta=Tr.sub(t.offset,d),this.computeMovement(),m&&(!t.last||s>Gre)){t.delta=Tr.sub(t.offset,d);const I=t.delta.map(Math.abs);Tr.addTo(t.distance,I),t.direction=t.delta.map(Math.sign),t._direction=t._delta.map(Math.sign),!t.first&&s>0&&(t.velocity=[I[0]/s,I[1]/s],t.timeDelta=s)}}emit(){const e=this.state,t=this.shared,n=this.config;if(e._active||this.clean(),(e._blocked||!e.intentional)&&!e._force&&!n.triggerAllEvents)return;const r=this.handler(Kr(Kr(Kr({},t),e),{},{[this.aliasKey]:e.values}));r!==void 0&&(e.memo=r)}clean(){this.eventStore.clean(),this.timeoutStore.clean()}}function Hre([i,e],t){const n=Math.abs(i),r=Math.abs(e);if(n>r&&n>t)return"x";if(r>n&&r>t)return"y"}class vx extends dG{constructor(...e){super(...e),Bs(this,"aliasKey","xy")}reset(){super.reset(),this.state.axis=void 0}init(){this.state.offset=[0,0],this.state.lastOffset=[0,0]}computeOffset(){this.state.offset=Tr.add(this.state.lastOffset,this.state.movement)}computeMovement(){this.state.movement=Tr.sub(this.state.offset,this.state.lastOffset)}axisIntent(e){const t=this.state,n=this.config;if(!t.axis&&e){const r=typeof n.axisThreshold=="object"?n.axisThreshold[uG(e)]:n.axisThreshold;t.axis=Hre(t._movement,r)}t._blocked=(n.lockDirection||!!n.axis)&&!t.axis||!!n.axis&&n.axis!==t.axis}restrictToAxis(e){if(this.config.axis||this.config.lockDirection)switch(this.state.axis){case"x":e[1]=0;break;case"y":e[0]=0;break}}}const Qre=i=>i,pD=.15,pG={enabled(i=!0){return i},eventOptions(i,e,t){return Kr(Kr({},t.shared.eventOptions),i)},preventDefault(i=!1){return i},triggerAllEvents(i=!1){return i},rubberband(i=0){switch(i){case!0:return[pD,pD];case!1:return[0,0];default:return Tr.toVector(i)}},from(i){if(typeof i=="function")return i;if(i!=null)return Tr.toVector(i)},transform(i,e,t){const n=i||t.shared.transform;return this.hasCustomTransform=!!n,n||Qre},threshold(i){return Tr.toVector(i,0)}},Vre=0,v0=Kr(Kr({},pG),{},{axis(i,e,{axis:t}){if(this.lockDirection=t==="lock",!this.lockDirection)return t},axisThreshold(i=Vre){return i},bounds(i={}){if(typeof i=="function")return s=>v0.bounds(i(s));if("current"in i)return()=>i.current;if(typeof HTMLElement=="function"&&i instanceof HTMLElement)return i;const{left:e=-1/0,right:t=1/0,top:n=-1/0,bottom:r=1/0}=i;return[[e,t],[n,r]]}}),mD={ArrowRight:(i,e=1)=>[i*e,0],ArrowLeft:(i,e=1)=>[-1*i*e,0],ArrowUp:(i,e=1)=>[0,-1*i*e],ArrowDown:(i,e=1)=>[0,i*e]};class jre extends vx{constructor(...e){super(...e),Bs(this,"ingKey","dragging")}reset(){super.reset();const e=this.state;e._pointerId=void 0,e._pointerActive=!1,e._keyboardActive=!1,e._preventScroll=!1,e._delayed=!1,e.swipe=[0,0],e.tap=!1,e.canceled=!1,e.cancel=this.cancel.bind(this)}setup(){const e=this.state;if(e._bounds instanceof HTMLElement){const t=e._bounds.getBoundingClientRect(),n=e.currentTarget.getBoundingClientRect(),r={left:t.left-n.left+e.offset[0],right:t.right-n.right+e.offset[0],top:t.top-n.top+e.offset[1],bottom:t.bottom-n.bottom+e.offset[1]};e._bounds=v0.bounds(r)}}cancel(){const e=this.state;e.canceled||(e.canceled=!0,e._active=!1,setTimeout(()=>{this.compute(),this.emit()},0))}setActive(){this.state._active=this.state._pointerActive||this.state._keyboardActive}clean(){this.pointerClean(),this.state._pointerActive=!1,this.state._keyboardActive=!1,super.clean()}pointerDown(e){const t=this.config,n=this.state;if(e.buttons!=null&&(Array.isArray(t.pointerButtons)?!t.pointerButtons.includes(e.buttons):t.pointerButtons!==-1&&t.pointerButtons!==e.buttons))return;const r=this.ctrl.setEventIds(e);t.pointerCapture&&e.target.setPointerCapture(e.pointerId),!(r&&r.size>1&&n._pointerActive)&&(this.start(e),this.setupPointer(e),n._pointerId=NT(e),n._pointerActive=!0,this.computeValues(oA(e)),this.computeInitial(),t.preventScrollAxis&&uG(e)!=="mouse"?(n._active=!1,this.setupScrollPrevention(e)):t.delay>0?(this.setupDelayTrigger(e),t.triggerAllEvents&&(this.compute(e),this.emit())):this.startPointerDrag(e))}startPointerDrag(e){const t=this.state;t._active=!0,t._preventScroll=!0,t._delayed=!1,this.compute(e),this.emit()}pointerMove(e){const t=this.state,n=this.config;if(!t._pointerActive)return;const r=NT(e);if(t._pointerId!==void 0&&r!==t._pointerId)return;const s=oA(e);if(document.pointerLockElement===e.target?t._delta=[e.movementX,e.movementY]:(t._delta=Tr.sub(s,t._values),this.computeValues(s)),Tr.addTo(t._movement,t._delta),this.compute(e),t._delayed&&t.intentional){this.timeoutStore.remove("dragDelay"),t.active=!1,this.startPointerDrag(e);return}if(n.preventScrollAxis&&!t._preventScroll)if(t.axis)if(t.axis===n.preventScrollAxis||n.preventScrollAxis==="xy"){t._active=!1,this.clean();return}else{this.timeoutStore.remove("startPointerDrag"),this.startPointerDrag(e);return}else return;this.emit()}pointerUp(e){this.ctrl.setEventIds(e);try{this.config.pointerCapture&&e.target.hasPointerCapture(e.pointerId)&&e.target.releasePointerCapture(e.pointerId)}catch{}const t=this.state,n=this.config;if(!t._active||!t._pointerActive)return;const r=NT(e);if(t._pointerId!==void 0&&r!==t._pointerId)return;this.state._pointerActive=!1,this.setActive(),this.compute(e);const[s,o]=t._distance;if(t.tap=s<=n.tapsThreshold&&o<=n.tapsThreshold,t.tap&&n.filterTaps)t._force=!0;else{const[a,l]=t._delta,[c,u]=t._movement,[h,f]=n.swipe.velocity,[d,m]=n.swipe.distance,y=n.swipe.duration;if(t.elapsedTime<y){const g=Math.abs(a/t.timeDelta),A=Math.abs(l/t.timeDelta);g>h&&Math.abs(c)>d&&(t.swipe[0]=Math.sign(a)),A>f&&Math.abs(u)>m&&(t.swipe[1]=Math.sign(l))}}this.emit()}pointerClick(e){!this.state.tap&&e.detail>0&&(e.preventDefault(),e.stopPropagation())}setupPointer(e){const t=this.config,n=t.device;t.pointerLock&&e.currentTarget.requestPointerLock(),t.pointerCapture||(this.eventStore.add(this.sharedConfig.window,n,"change",this.pointerMove.bind(this)),this.eventStore.add(this.sharedConfig.window,n,"end",this.pointerUp.bind(this)),this.eventStore.add(this.sharedConfig.window,n,"cancel",this.pointerUp.bind(this)))}pointerClean(){this.config.pointerLock&&document.pointerLockElement===this.state.currentTarget&&document.exitPointerLock()}preventScroll(e){this.state._preventScroll&&e.cancelable&&e.preventDefault()}setupScrollPrevention(e){this.state._preventScroll=!1,Wre(e);const t=this.eventStore.add(this.sharedConfig.window,"touch","change",this.preventScroll.bind(this),{passive:!1});this.eventStore.add(this.sharedConfig.window,"touch","end",t),this.eventStore.add(this.sharedConfig.window,"touch","cancel",t),this.timeoutStore.add("startPointerDrag",this.startPointerDrag.bind(this),this.config.preventScrollDelay,e)}setupDelayTrigger(e){this.state._delayed=!0,this.timeoutStore.add("dragDelay",()=>{this.state._step=[0,0],this.startPointerDrag(e)},this.config.delay)}keyDown(e){const t=mD[e.key];if(t){const n=this.state,r=e.shiftKey?10:e.altKey?.1:1;this.start(e),n._delta=t(this.config.keyboardDisplacement,r),n._keyboardActive=!0,Tr.addTo(n._movement,n._delta),this.compute(e),this.emit()}}keyUp(e){e.key in mD&&(this.state._keyboardActive=!1,this.setActive(),this.compute(e),this.emit())}bind(e){const t=this.config.device;e(t,"start",this.pointerDown.bind(this)),this.config.pointerCapture&&(e(t,"change",this.pointerMove.bind(this)),e(t,"end",this.pointerUp.bind(this)),e(t,"cancel",this.pointerUp.bind(this)),e("lostPointerCapture","",this.pointerUp.bind(this))),this.config.keys&&(e("key","down",this.keyDown.bind(this)),e("key","up",this.keyUp.bind(this))),this.config.filterTaps&&e("click","",this.pointerClick.bind(this),{capture:!0,passive:!1})}}function Wre(i){"persist"in i&&typeof i.persist=="function"&&i.persist()}const xx=typeof window<"u"&&window.document&&window.document.createElement;function mG(){return xx&&"ontouchstart"in window}function Kre(){return mG()||xx&&window.navigator.maxTouchPoints>1}function Yre(){return xx&&"onpointerdown"in window}function $re(){return xx&&"exitPointerLock"in window.document}function Xre(){try{return"constructor"in GestureEvent}catch{return!1}}const ac={isBrowser:xx,gesture:Xre(),touch:mG(),touchscreen:Kre(),pointer:Yre(),pointerLock:$re()},qre=250,Jre=180,Zre=.5,ese=50,tse=250,nse=10,gD={mouse:0,touch:0,pen:8},ise=Kr(Kr({},v0),{},{device(i,e,{pointer:{touch:t=!1,lock:n=!1,mouse:r=!1}={}}){return this.pointerLock=n&&ac.pointerLock,ac.touch&&t?"touch":this.pointerLock?"mouse":ac.pointer&&!r?"pointer":ac.touch?"touch":"mouse"},preventScrollAxis(i,e,{preventScroll:t}){if(this.preventScrollDelay=typeof t=="number"?t:t||t===void 0&&i?qre:void 0,!(!ac.touchscreen||t===!1))return i||(t!==void 0?"y":void 0)},pointerCapture(i,e,{pointer:{capture:t=!0,buttons:n=1,keys:r=!0}={}}){return this.pointerButtons=n,this.keys=r,!this.pointerLock&&this.device==="pointer"&&t},threshold(i,e,{filterTaps:t=!1,tapsThreshold:n=3,axis:r=void 0}){const s=Tr.toVector(i,t?n:r?1:0);return this.filterTaps=t,this.tapsThreshold=n,s},swipe({velocity:i=Zre,distance:e=ese,duration:t=tse}={}){return{velocity:this.transform(Tr.toVector(i)),distance:this.transform(Tr.toVector(e)),duration:t}},delay(i=0){switch(i){case!0:return Jre;case!1:return 0;default:return i}},axisThreshold(i){return i?Kr(Kr({},gD),i):gD},keyboardDisplacement(i=nse){return i}});function gG(i){const[e,t]=i.overflow,[n,r]=i._delta,[s,o]=i._direction;(e<0&&n>0&&s<0||e>0&&n<0&&s>0)&&(i._movement[0]=i._movementBound[0]),(t<0&&r>0&&o<0||t>0&&r<0&&o>0)&&(i._movement[1]=i._movementBound[1])}const rse=30,sse=100;class ose extends dG{constructor(...e){super(...e),Bs(this,"ingKey","pinching"),Bs(this,"aliasKey","da")}init(){this.state.offset=[1,0],this.state.lastOffset=[1,0],this.state._pointerEvents=new Map}reset(){super.reset();const e=this.state;e._touchIds=[],e.canceled=!1,e.cancel=this.cancel.bind(this),e.turns=0}computeOffset(){const{type:e,movement:t,lastOffset:n}=this.state;e==="wheel"?this.state.offset=Tr.add(t,n):this.state.offset=[(1+t[0])*n[0],t[1]+n[1]]}computeMovement(){const{offset:e,lastOffset:t}=this.state;this.state.movement=[e[0]/t[0],e[1]-t[1]]}axisIntent(){const e=this.state,[t,n]=e._movement;if(!e.axis){const r=Math.abs(t)*rse-Math.abs(n);r<0?e.axis="angle":r>0&&(e.axis="scale")}}restrictToAxis(e){this.config.lockDirection&&(this.state.axis==="scale"?e[1]=0:this.state.axis==="angle"&&(e[0]=0))}cancel(){const e=this.state;e.canceled||setTimeout(()=>{e.canceled=!0,e._active=!1,this.compute(),this.emit()},0)}touchStart(e){this.ctrl.setEventIds(e);const t=this.state,n=this.ctrl.touchIds;if(t._active&&t._touchIds.every(s=>n.has(s))||n.size<2)return;this.start(e),t._touchIds=Array.from(n).slice(0,2);const r=uD(e,t._touchIds);r&&this.pinchStart(e,r)}pointerStart(e){if(e.buttons!=null&&e.buttons%2!==1)return;this.ctrl.setEventIds(e),e.target.setPointerCapture(e.pointerId);const t=this.state,n=t._pointerEvents,r=this.ctrl.pointerIds;if(t._active&&Array.from(n.keys()).every(o=>r.has(o))||(n.size<2&&n.set(e.pointerId,e),t._pointerEvents.size<2))return;this.start(e);const s=QM(...Array.from(n.values()));s&&this.pinchStart(e,s)}pinchStart(e,t){const n=this.state;n.origin=t.origin,this.computeValues([t.distance,t.angle]),this.computeInitial(),this.compute(e),this.emit()}touchMove(e){if(!this.state._active)return;const t=uD(e,this.state._touchIds);t&&this.pinchMove(e,t)}pointerMove(e){const t=this.state._pointerEvents;if(t.has(e.pointerId)&&t.set(e.pointerId,e),!this.state._active)return;const n=QM(...Array.from(t.values()));n&&this.pinchMove(e,n)}pinchMove(e,t){const n=this.state,r=n._values[1],s=t.angle-r;let o=0;Math.abs(s)>270&&(o+=Math.sign(s)),this.computeValues([t.distance,t.angle-360*o]),n.origin=t.origin,n.turns=o,n._movement=[n._values[0]/n._initial[0]-1,n._values[1]-n._initial[1]],this.compute(e),this.emit()}touchEnd(e){this.ctrl.setEventIds(e),this.state._active&&this.state._touchIds.some(t=>!this.ctrl.touchIds.has(t))&&(this.state._active=!1,this.compute(e),this.emit())}pointerEnd(e){const t=this.state;this.ctrl.setEventIds(e);try{e.target.releasePointerCapture(e.pointerId)}catch{}t._pointerEvents.has(e.pointerId)&&t._pointerEvents.delete(e.pointerId),t._active&&t._pointerEvents.size<2&&(t._active=!1,this.compute(e),this.emit())}gestureStart(e){e.cancelable&&e.preventDefault();const t=this.state;t._active||(this.start(e),this.computeValues([e.scale,e.rotation]),t.origin=[e.clientX,e.clientY],this.compute(e),this.emit())}gestureMove(e){if(e.cancelable&&e.preventDefault(),!this.state._active)return;const t=this.state;this.computeValues([e.scale,e.rotation]),t.origin=[e.clientX,e.clientY];const n=t._movement;t._movement=[e.scale-1,e.rotation],t._delta=Tr.sub(t._movement,n),this.compute(e),this.emit()}gestureEnd(e){this.state._active&&(this.state._active=!1,this.compute(e),this.emit())}wheel(e){const t=this.config.modifierKey;t&&(Array.isArray(t)?!t.find(n=>e[n]):!e[t])||(this.state._active?this.wheelChange(e):this.wheelStart(e),this.timeoutStore.add("wheelEnd",this.wheelEnd.bind(this)))}wheelStart(e){this.start(e),this.wheelChange(e)}wheelChange(e){"uv"in e||e.cancelable&&e.preventDefault();const n=this.state;n._delta=[-fG(e)[1]/sse*n.offset[0],0],Tr.addTo(n._movement,n._delta),gG(n),this.state.origin=[e.clientX,e.clientY],this.compute(e),this.emit()}wheelEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(e){const t=this.config.device;t&&(e(t,"start",this[t+"Start"].bind(this)),e(t,"change",this[t+"Move"].bind(this)),e(t,"end",this[t+"End"].bind(this)),e(t,"cancel",this[t+"End"].bind(this)),e("lostPointerCapture","",this[t+"End"].bind(this))),this.config.pinchOnWheel&&e("wheel","",this.wheel.bind(this),{passive:!1})}}const ase=Kr(Kr({},pG),{},{device(i,e,{shared:t,pointer:{touch:n=!1}={}}){if(t.target&&!ac.touch&&ac.gesture)return"gesture";if(ac.touch&&n)return"touch";if(ac.touchscreen){if(ac.pointer)return"pointer";if(ac.touch)return"touch"}},bounds(i,e,{scaleBounds:t={},angleBounds:n={}}){const r=o=>{const a=dD(BS(t,o),{min:-1/0,max:1/0});return[a.min,a.max]},s=o=>{const a=dD(BS(n,o),{min:-1/0,max:1/0});return[a.min,a.max]};return typeof t!="function"&&typeof n!="function"?[r(),s()]:o=>[r(o),s(o)]},threshold(i,e,t){return this.lockDirection=t.axis==="lock",Tr.toVector(i,this.lockDirection?[.1,3]:0)},modifierKey(i){return i===void 0?"ctrlKey":i},pinchOnWheel(i=!0){return i}});class lse extends vx{constructor(...e){super(...e),Bs(this,"ingKey","moving")}move(e){this.config.mouseOnly&&e.pointerType!=="mouse"||(this.state._active?this.moveChange(e):this.moveStart(e),this.timeoutStore.add("moveEnd",this.moveEnd.bind(this)))}moveStart(e){this.start(e),this.computeValues(oA(e)),this.compute(e),this.computeInitial(),this.emit()}moveChange(e){if(!this.state._active)return;const t=oA(e),n=this.state;n._delta=Tr.sub(t,n._values),Tr.addTo(n._movement,n._delta),this.computeValues(t),this.compute(e),this.emit()}moveEnd(e){this.state._active&&(this.state._active=!1,this.compute(e),this.emit())}bind(e){e("pointer","change",this.move.bind(this)),e("pointer","leave",this.moveEnd.bind(this))}}const cse=Kr(Kr({},v0),{},{mouseOnly:(i=!0)=>i});class use extends vx{constructor(...e){super(...e),Bs(this,"ingKey","scrolling")}scroll(e){this.state._active||this.start(e),this.scrollChange(e),this.timeoutStore.add("scrollEnd",this.scrollEnd.bind(this))}scrollChange(e){e.cancelable&&e.preventDefault();const t=this.state,n=Ore(e);t._delta=Tr.sub(n,t._values),Tr.addTo(t._movement,t._delta),this.computeValues(n),this.compute(e),this.emit()}scrollEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(e){e("scroll","",this.scroll.bind(this))}}const hse=v0;class fse extends vx{constructor(...e){super(...e),Bs(this,"ingKey","wheeling")}wheel(e){this.state._active||this.start(e),this.wheelChange(e),this.timeoutStore.add("wheelEnd",this.wheelEnd.bind(this))}wheelChange(e){const t=this.state;t._delta=fG(e),Tr.addTo(t._movement,t._delta),gG(t),this.compute(e),this.emit()}wheelEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(e){e("wheel","",this.wheel.bind(this))}}const dse=v0;class pse extends vx{constructor(...e){super(...e),Bs(this,"ingKey","hovering")}enter(e){this.config.mouseOnly&&e.pointerType!=="mouse"||(this.start(e),this.computeValues(oA(e)),this.compute(e),this.emit())}leave(e){if(this.config.mouseOnly&&e.pointerType!=="mouse")return;const t=this.state;if(!t._active)return;t._active=!1;const n=oA(e);t._movement=t._delta=Tr.sub(n,t._values),this.computeValues(n),this.compute(e),t.delta=t.movement,this.emit()}bind(e){e("pointer","enter",this.enter.bind(this)),e("pointer","leave",this.leave.bind(this))}}const mse=Kr(Kr({},v0),{},{mouseOnly:(i=!0)=>i}),hR=new Map,VM=new Map;function gse(i){hR.set(i.key,i.engine),VM.set(i.key,i.resolver)}const Ase={key:"drag",engine:jre,resolver:ise},yse={key:"hover",engine:pse,resolver:mse},vse={key:"move",engine:lse,resolver:cse},xse={key:"pinch",engine:ose,resolver:ase},Ese={key:"scroll",engine:use,resolver:hse},_se={key:"wheel",engine:fse,resolver:dse};function Sse(i,e){if(i==null)return{};var t={},n=Object.keys(i),r,s;for(s=0;s<n.length;s++)r=n[s],!(e.indexOf(r)>=0)&&(t[r]=i[r]);return t}function wse(i,e){if(i==null)return{};var t=Sse(i,e),n,r;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);for(r=0;r<s.length;r++)n=s[r],!(e.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(i,n)&&(t[n]=i[n])}return t}const Cse={target(i){if(i)return()=>"current"in i?i.current:i},enabled(i=!0){return i},window(i=ac.isBrowser?window:void 0){return i},eventOptions({passive:i=!0,capture:e=!1}={}){return{passive:i,capture:e}},transform(i){return i}},Tse=["target","eventOptions","window","enabled","transform"];function X_(i={},e){const t={};for(const[n,r]of Object.entries(e))switch(typeof r){case"function":t[n]=r.call(t,i[n],n,i);break;case"object":t[n]=X_(i[n],r);break;case"boolean":r&&(t[n]=i[n]);break}return t}function bse(i,e,t={}){const n=i,{target:r,eventOptions:s,window:o,enabled:a,transform:l}=n,c=wse(n,Tse);if(t.shared=X_({target:r,eventOptions:s,window:o,enabled:a,transform:l},Cse),e){const u=VM.get(e);t[e]=X_(Kr({shared:t.shared},c),u)}else for(const u in c){const h=VM.get(u);h&&(t[u]=X_(Kr({shared:t.shared},c[u]),h))}return t}class AG{constructor(e,t){Bs(this,"_listeners",new Set),this._ctrl=e,this._gestureKey=t}add(e,t,n,r,s){const o=this._listeners,a=Bre(t,n),l=this._gestureKey?this._ctrl.config[this._gestureKey].eventOptions:{},c=Kr(Kr({},l),s);e.addEventListener(a,r,c);const u=()=>{e.removeEventListener(a,r,c),o.delete(u)};return o.add(u),u}clean(){this._listeners.forEach(e=>e()),this._listeners.clear()}}class Ise{constructor(){Bs(this,"_timeouts",new Map)}add(e,t,n=140,...r){this.remove(e),this._timeouts.set(e,window.setTimeout(t,n,...r))}remove(e){const t=this._timeouts.get(e);t&&window.clearTimeout(t)}clean(){this._timeouts.forEach(e=>void window.clearTimeout(e)),this._timeouts.clear()}}let Mse=class{constructor(e){Bs(this,"gestures",new Set),Bs(this,"_targetEventStore",new AG(this)),Bs(this,"gestureEventStores",{}),Bs(this,"gestureTimeoutStores",{}),Bs(this,"handlers",{}),Bs(this,"config",{}),Bs(this,"pointerIds",new Set),Bs(this,"touchIds",new Set),Bs(this,"state",{shared:{shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1}}),Rse(this,e)}setEventIds(e){if(t4(e))return this.touchIds=new Set(Fre(e)),this.touchIds;if("pointerId"in e)return e.type==="pointerup"||e.type==="pointercancel"?this.pointerIds.delete(e.pointerId):e.type==="pointerdown"&&this.pointerIds.add(e.pointerId),this.pointerIds}applyHandlers(e,t){this.handlers=e,this.nativeHandlers=t}applyConfig(e,t){this.config=bse(e,t,this.config)}clean(){this._targetEventStore.clean();for(const e of this.gestures)this.gestureEventStores[e].clean(),this.gestureTimeoutStores[e].clean()}effect(){return this.config.shared.target&&this.bind(),()=>this._targetEventStore.clean()}bind(...e){const t=this.config.shared,n={};let r;if(!(t.target&&(r=t.target(),!r))){if(t.enabled){for(const o of this.gestures){const a=this.config[o],l=AD(n,a.eventOptions,!!r);if(a.enabled){const c=hR.get(o);new c(this,e,o).bind(l)}}const s=AD(n,t.eventOptions,!!r);for(const o in this.nativeHandlers)s(o,"",a=>this.nativeHandlers[o](Kr(Kr({},this.state.shared),{},{event:a,args:e})),void 0,!0)}for(const s in n)n[s]=zre(...n[s]);if(!r)return n;for(const s in n){const{device:o,capture:a,passive:l}=Lre(s);this._targetEventStore.add(r,o,"",n[s],{capture:a,passive:l})}}}};function Bg(i,e){i.gestures.add(e),i.gestureEventStores[e]=new AG(i,e),i.gestureTimeoutStores[e]=new Ise}function Rse(i,e){e.drag&&Bg(i,"drag"),e.wheel&&Bg(i,"wheel"),e.scroll&&Bg(i,"scroll"),e.move&&Bg(i,"move"),e.pinch&&Bg(i,"pinch"),e.hover&&Bg(i,"hover")}const AD=(i,e,t)=>(n,r,s,o={},a=!1)=>{var l,c;const u=(l=o.capture)!==null&&l!==void 0?l:e.capture,h=(c=o.passive)!==null&&c!==void 0?c:e.passive;let f=a?n:Rre(n,r,u);t&&h&&(f+="Passive"),i[f]=i[f]||[],i[f].push(s)},Pse=/^on(Drag|Wheel|Scroll|Move|Pinch|Hover)/;function Lse(i){const e={},t={},n=new Set;for(let r in i)Pse.test(r)?(n.add(RegExp.lastMatch),t[r]=i[r]):e[r]=i[r];return[t,e,n]}function Dg(i,e,t,n,r,s){if(!i.has(t)||!hR.has(n))return;const o=t+"Start",a=t+"End",l=c=>{let u;return c.first&&o in e&&e[o](c),t in e&&(u=e[t](c)),c.last&&a in e&&e[a](c),u};r[n]=l,s[n]=s[n]||{}}function Bse(i,e){const[t,n,r]=Lse(i),s={};return Dg(r,t,"onDrag","drag",s,e),Dg(r,t,"onWheel","wheel",s,e),Dg(r,t,"onScroll","scroll",s,e),Dg(r,t,"onPinch","pinch",s,e),Dg(r,t,"onMove","move",s,e),Dg(r,t,"onHover","hover",s,e),{handlers:s,config:e,nativeHandlers:n}}function Dse(i,e={},t,n){const r=bl.useMemo(()=>new Mse(i),[]);if(r.applyHandlers(i,n),r.applyConfig(e,t),bl.useEffect(r.effect.bind(r)),bl.useEffect(()=>r.clean.bind(r),[]),e.target===void 0)return r.bind.bind(r)}function kse(i){return i.forEach(gse),function(t,n){const{handlers:r,nativeHandlers:s,config:o}=Bse(t,n||{});return Dse(r,o,void 0,s)}}function yG(i,e){return kse([Ase,xse,Ese,_se,vse,yse])(i,e||{})}const UT=new Q,yD=new Ue,fm=new Q,CE=new Q,jy=new Q,vD=new vo,Fse=C.forwardRef(({autoTransform:i=!0,matrix:e,axisLock:t,dragLimits:n,onHover:r,onDragStart:s,onDrag:o,onDragEnd:a,children:l,dragConfig:c,...u},h)=>{const f=Ve(x=>x.controls),{camera:d,size:m,raycaster:y,invalidate:g}=Ve(),A=C.useRef(null),E=yG({onHover:({hovering:x})=>r&&r(x??!1),onDragStart:({event:x})=>{f&&(f.enabled=!1);const{point:w}=x;A.current.matrix.decompose(UT,new Xt,new Q),fm.copy(w),CE.copy(fm).sub(UT),s&&s(UT),g()},onDrag:({xy:[x,w],intentional:T})=>{if(!T)return;const I=(x-m.left)/m.width*2-1,M=-((w-m.top)/m.height)*2+1;if(yD.set(I,M),y.setFromCamera(yD,d),!t)d.getWorldDirection(jy).negate();else switch(t){case"x":jy.set(1,0,0);break;case"y":jy.set(0,1,0);break;case"z":jy.set(0,0,1);break}vD.setFromNormalAndCoplanarPoint(jy,fm),y.ray.intersectPlane(vD,fm);const L=A.current.matrix.clone(),P=A.current.matrixWorld.clone(),R=new Q(fm.x-CE.x,fm.y-CE.y,fm.z-CE.z);if(n&&(R.x=n[0]?Math.max(Math.min(R.x,n[0][1]),n[0][0]):R.x,R.y=n[1]?Math.max(Math.min(R.y,n[1][1]),n[1][0]):R.y,R.z=n[2]?Math.max(Math.min(R.z,n[2][1]),n[2][0]):R.z),i){A.current.matrix.setPosition(R);const U=A.current.matrix.clone().multiply(L.invert()),k=A.current.matrix.clone().multiply(P.invert());o&&o(A.current.matrix,U,A.current.matrixWorld,k)}else{const U=new Xe().copy(A.current.matrix);U.setPosition(R);const k=U.clone().multiply(L.invert()),H=U.clone().multiply(P.invert());o&&o(U,k,A.current.matrixWorld,H)}g()},onDragEnd:()=>{f&&(f.enabled=!0),a&&a(),g()}},{drag:{filterTaps:!0,threshold:1,...typeof c=="object"?c:{}}});return C.useImperativeHandle(h,()=>A.current,[]),C.useLayoutEffect(()=>{e&&(A.current.matrix=e)},[e]),C.createElement("group",ot({ref:A},E(),{matrix:e,matrixAutoUpdate:!1},u),l)});function n2(i,e,t){return e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function jM(i,e){return jM=Object.setPrototypeOf||function(n,r){return n.__proto__=r,n},jM(i,e)}function Ose(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function Nse(){for(var i=arguments.length,e=new Array(i),t=0;t<i;t++)e[t]=arguments[t];var n=e[0],r=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=e[8];return n*a*h+r*l*c+s*o*u-s*a*c-r*o*h-n*l*u}function xD(i,e){for(var t=[],n=i.toArray(),r=e.toArray(),s=0;s<n.length;s++)t[s]=n[s]+r[s];return new Tn().fromArray(t)}function Use(i){if(Array.isArray(i))return i}function zse(i,e){var t=i==null?null:typeof Symbol<"u"&&i[Symbol.iterator]||i["@@iterator"];if(t!=null){var n=[],r=!0,s=!1,o,a;try{for(t=t.call(i);!(r=(o=t.next()).done)&&(n.push(o.value),!(e&&n.length===e));r=!0);}catch(l){s=!0,a=l}finally{try{!r&&t.return!=null&&t.return()}finally{if(s)throw a}}return n}}function WM(i,e){(e==null||e>i.length)&&(e=i.length);for(var t=0,n=new Array(e);t<e;t++)n[t]=i[t];return n}function vG(i,e){if(i){if(typeof i=="string")return WM(i,e);var t=Object.prototype.toString.call(i).slice(8,-1);if(t==="Object"&&i.constructor&&(t=i.constructor.name),t==="Map"||t==="Set")return Array.from(i);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return WM(i,e)}}function Gse(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function yh(i,e){return Use(i)||zse(i,e)||vG(i,e)||Gse()}function Hse(i){if(Array.isArray(i))return WM(i)}function Qse(i){if(typeof Symbol<"u"&&i[Symbol.iterator]!=null||i["@@iterator"]!=null)return Array.from(i)}function Vse(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function DS(i){return Hse(i)||Qse(i)||vG(i)||Vse()}function q_(i,e,t){return Ose()?q_=Reflect.construct:q_=function(r,s,o){var a=[null];a.push.apply(a,s);var l=Function.bind.apply(r,a),c=new l;return o&&jM(c,o.prototype),c},q_.apply(null,arguments)}function jse(i){var e=yh(i[0],2),t=e[0],n=e[1],r=yh(i[1],2),s=r[0],o=r[1],a=yh(i[2],2),l=a[0],c=a[1];return Nse(t,n,1,s,o,1,l,c,1)}function Wse(i){return jse(i)===0}var Kse=new Ue,Yse=new Ue;function ED(i){var e=i.map(function(c){return Array.isArray(c)?q_(Ue,DS(c)):c}),t=yh(e,3),n=t[0],r=t[1],s=t[2];if(Wse(i))return!1;var o=Kse.subVectors(r,n),a=Yse.subVectors(s,n),l=a.cross(o);return l>0}function xG(i,e,t){return Math.max(e,Math.min(t,i))}function EG(i,e){return xG(i-Math.floor(i/e)*e,0,e)}function _G(i,e){var t=EG(e-i,Math.PI*2);return t>Math.PI&&(t-=Math.PI*2),t}function $se(i){return i/180*Math.PI}function Xse(i){return i*180/Math.PI}function qse(i,e){for(var t=e.radius,n=t===void 0?1:t,r=i.length/3,s=2/r,o=Math.PI*(3-2.2360679775),a=0;a<i.length;a+=3){var l=a*s-1+s/2,c=Math.sqrt(1-Math.pow(l,2)),u=a%r*o,h=Math.cos(u)*c,f=Math.sin(u)*c;i[a]=h*n,i[a+1]=l*n,i[a+2]=f*n}}function Jse(i,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Number.EPSILON;return Math.abs(i.x-e.x)<t&&Math.abs(i.y-e.y)<t&&Math.abs(i.z-e.z)<t}function SG(i,e){return i.x===e.x?typeof i.z<"u"&&i.y===e.y?i.z-e.z:i.y-e.y:i.x-e.x}function Zse(i){for(var e=i.sort(SG),t=[e[0],e[1]],n=2;n<e.length;n++)for(t.push(e[n]);t.length>2&&ED(DS(t.slice(-3)));)t.splice(t.length-2,1);for(var r=[e[e.length-1],e[e.length-2]],s=e.length-3;s>=0;s--)for(r.push(e[s]);r.length>2&&ED(DS(r.slice(-3)));)r.splice(r.length-2,1);r.splice(0,1),r.splice(r.length-1,1);var o=[].concat(t,r);return o}function eoe(i,e,t){var n=yh(e,2),r=n[0],s=n[1],o=yh(t,2),a=o[0],l=o[1];return a+(i-r)*(l-a)/(s-r)}function toe(i){return i*i*i*(i*(i*6-15)+10)}function noe(i,e,t){return i*(1-t)+e*t}function wG(i,e,t){return(t-i)/(e-i)}function ioe(i,e,t){var n=Math.sqrt(i*i+e*e+t*t);return[i/n,e/n,t/n]}function roe(i,e,t){var n=i*i,r=e*e,s=t*t,o=i*Math.sqrt(1-(r+s)/2+r*s/3),a=e*Math.sqrt(1-(s+n)/2+s*n/3),l=t*Math.sqrt(1-(n+r)/2+n*r/3);return[o,a,l]}function CG(i,e){var t=new Q().crossVectors(i,e),n=i.dot(e),r=new Tn().identity(),s=new Tn().set(0,-t.z,t.y,t.z,0,-t.x,-t.y,t.x,0),o=new Tn().multiplyMatrices(s,s).multiplyScalar(1/(1+n)),a=xD(xD(r,s),o);return a}function soe(i,e,t){var n=Math.asin(e),r=Math.atan2(i,-t);return[n,r]}function ooe(i,e){var t=Math.sin(i),n=Math.cos(i),r=Math.sin(e)*n,s=-Math.cos(e)*n;return[r,t,s]}function aoe(i,e){var t=yh(e,2),n=t[0],r=t[1],s=CG(i.normal,new Q(0,1,0)),o=wG(n.clone().applyMatrix3(s).y,r.clone().applyMatrix3(s).y,0);return new Q().lerpVectors(n,r,o)}function loe(i,e){var t=e.normal.dot(i);return t}function coe(i,e){var t=yh(i,3),n=t[0],r=t[1],s=t[2],o=yh(e,2),a=o[0],l=o[1];return s*a*l+r*a+n}function uoe(i,e){var t=yh(e,2),n=t[0],r=t[1],s=n*r,o=i/s,a=i-s*o,l=a/n,c=a%n;return[c,l,o]}function hoe(i,e){return i[0]+e[0]*i[1]}function foe(i,e){var t=i%e,n=Math.floor(i/e);return[t,n]}var TE=Object.freeze({__proto__:null,clamp:xG,repeat:EG,deltaAngle:_G,degToRad:$se,radToDeg:Xse,fibonacciOnSphere:qse,vectorEquals:Jse,lexicographic:SG,convexHull:Zse,remap:eoe,fade:toe,lerp:noe,inverseLerp:wG,normalize:ioe,pointOnCubeToPointOnSphere:roe,rotateVectorOnVector:CG,pointToCoordinate:soe,coordinateToPoint:ooe,planeSegmentIntersection:aoe,pointToPlaneDistance:loe,getIndexFrom3D:coe,get3DFromIndex:uoe,getIndexFrom2D:hoe,get2DFromIndex:foe});function TG(i,e){if(!(i instanceof e))throw new TypeError("Cannot call a class as a function")}var Jl=function i(e,t,n){var r=this;TG(this,i),n2(this,"dot2",function(s,o){return r.x*s+r.y*o}),n2(this,"dot3",function(s,o,a){return r.x*s+r.y*o+r.z*a}),this.x=e,this.y=t,this.z=n},doe=[new Jl(1,1,0),new Jl(-1,1,0),new Jl(1,-1,0),new Jl(-1,-1,0),new Jl(1,0,1),new Jl(-1,0,1),new Jl(1,0,-1),new Jl(-1,0,-1),new Jl(0,1,1),new Jl(0,-1,1),new Jl(0,1,-1),new Jl(0,-1,-1)],_D=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],SD=new Array(512),wD=new Array(512),poe=function(e){e>0&&e<1&&(e*=65536),e=Math.floor(e),e<256&&(e|=e<<8);for(var t=0;t<256;t++){var n;t&1?n=_D[t]^e&255:n=_D[t]^e>>8&255,SD[t]=SD[t+256]=n,wD[t]=wD[t+256]=doe[n%12]}};poe(0);function moe(i){if(typeof i=="number")i=Math.abs(i);else if(typeof i=="string"){var e=i;i=0;for(var t=0;t<e.length;t++)i=(i+(t+1)*(e.charCodeAt(t)%96))%2147483647}return i===0&&(i=311),i}function CD(i){var e=moe(i);return function(){var t=e*48271%2147483647;return e=t,t/2147483647}}var goe=function i(e){var t=this;TG(this,i),n2(this,"seed",0),n2(this,"init",function(n){t.seed=n,t.value=CD(n)}),n2(this,"value",CD(this.seed)),this.init(e)};new goe(Math.random());var Aoe=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:.01,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1/(2*Math.PI);return n/Math.atan(1/t)*Math.atan(Math.sin(2*Math.PI*e*r)/t)},bG=function(e){return 1/(1+e+.48*e*e+.235*e*e*e)},yoe=function(e){return e},voe={in:function(e){return 1-Math.cos(e*Math.PI/2)},out:function(e){return Math.sin(e*Math.PI/2)},inOut:function(e){return-(Math.cos(Math.PI*e)-1)/2}},xoe={in:function(e){return e*e*e},out:function(e){return 1-Math.pow(1-e,3)},inOut:function(e){return e<.5?4*e*e*e:1-Math.pow(-2*e+2,3)/2}},Eoe={in:function(e){return e*e*e*e*e},out:function(e){return 1-Math.pow(1-e,5)},inOut:function(e){return e<.5?16*e*e*e*e*e:1-Math.pow(-2*e+2,5)/2}},_oe={in:function(e){return 1-Math.sqrt(1-Math.pow(e,2))},out:function(e){return Math.sqrt(1-Math.pow(e-1,2))},inOut:function(e){return e<.5?(1-Math.sqrt(1-Math.pow(2*e,2)))/2:(Math.sqrt(1-Math.pow(-2*e+2,2))+1)/2}},Soe={in:function(e){return e*e*e*e},out:function(e){return 1- --e*e*e*e},inOut:function(e){return e<.5?8*e*e*e*e:1-8*--e*e*e*e}},woe={in:function(e){return e===0?0:Math.pow(2,10*e-10)},out:function(e){return e===1?1:1-Math.pow(2,-10*e)},inOut:function(e){return e===0?0:e===1?1:e<.5?Math.pow(2,20*e-10)/2:(2-Math.pow(2,-20*e+10))/2}};function io(i,e,t){var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:.25,r=arguments.length>4&&arguments[4]!==void 0?arguments[4]:.01,s=arguments.length>5&&arguments[5]!==void 0?arguments[5]:1/0,o=arguments.length>6&&arguments[6]!==void 0?arguments[6]:bG,a=arguments.length>7&&arguments[7]!==void 0?arguments[7]:.001,l="velocity_"+e;if(i.__damp===void 0&&(i.__damp={}),i.__damp[l]===void 0&&(i.__damp[l]=0),Math.abs(i[e]-t)<=a)return i[e]=t,!1;n=Math.max(1e-4,n);var c=2/n,u=o(c*r),h=i[e]-t,f=t,d=s*n;h=Math.min(Math.max(h,-d),d),t=i[e]-h;var m=(i.__damp[l]+c*h)*r;i.__damp[l]=(i.__damp[l]-c*m)*u;var y=t+(h+m)*u;return f-i[e]>0==y>f&&(y=f,i.__damp[l]=(y-f)/r),i[e]=y,!0}var Coe=function(e){return e&&e.isCamera},Toe=function(e){return e&&e.isLight},Wy=new Q,TD=new Xt,bD=new Xt,Ky=new Xe,zT=new Q;function boe(i,e,t,n,r,s,o){typeof e=="number"?Wy.setScalar(e):Array.isArray(e)?Wy.set(e[0],e[1],e[2]):Wy.copy(e);var a=i.parent;i.updateWorldMatrix(!0,!1),zT.setFromMatrixPosition(i.matrixWorld),Coe(i)||Toe(i)?Ky.lookAt(zT,Wy,i.up):Ky.lookAt(Wy,zT,i.up),kS(i.quaternion,bD.setFromRotationMatrix(Ky),t,n,r,s,o),a&&(Ky.extractRotation(a.matrixWorld),TD.setFromRotationMatrix(Ky),kS(i.quaternion,bD.copy(i.quaternion).premultiply(TD.invert()),t,n,r,s,o))}function H1(i,e,t,n,r,s,o,a){return io(i,e,i[e]+_G(i[e],t),n,r,s,o,a)}var Yy=new Ue,ID,MD;function Ioe(i,e,t,n,r,s,o){return typeof e=="number"?Yy.setScalar(e):Array.isArray(e)?Yy.set(e[0],e[1]):Yy.copy(e),ID=io(i,"x",Yy.x,t,n,r,s,o),MD=io(i,"y",Yy.y,t,n,r,s,o),ID||MD}var kg=new Q,RD,PD,LD;function KM(i,e,t,n,r,s,o){return typeof e=="number"?kg.setScalar(e):Array.isArray(e)?kg.set(e[0],e[1],e[2]):kg.copy(e),RD=io(i,"x",kg.x,t,n,r,s,o),PD=io(i,"y",kg.y,t,n,r,s,o),LD=io(i,"z",kg.z,t,n,r,s,o),RD||PD||LD}var dm=new Rn,BD,DD,kD,FD;function Moe(i,e,t,n,r,s,o){return typeof e=="number"?dm.setScalar(e):Array.isArray(e)?dm.set(e[0],e[1],e[2],e[3]):dm.copy(e),BD=io(i,"x",dm.x,t,n,r,s,o),DD=io(i,"y",dm.y,t,n,r,s,o),kD=io(i,"z",dm.z,t,n,r,s,o),FD=io(i,"w",dm.w,t,n,r,s,o),BD||DD||kD||FD}var $y=new Eo,OD,ND,UD;function Roe(i,e,t,n,r,s,o){return Array.isArray(e)?$y.set(e[0],e[1],e[2],e[3]):$y.copy(e),OD=H1(i,"x",$y.x,t,n,r,s,o),ND=H1(i,"y",$y.y,t,n,r,s,o),UD=H1(i,"z",$y.z,t,n,r,s,o),OD||ND||UD}var Fg=new ut,zD,GD,HD;function Poe(i,e,t,n,r,s,o){return e instanceof ut?Fg.copy(e):Array.isArray(e)?Fg.setRGB(e[0],e[1],e[2]):Fg.set(e),zD=io(i,"r",Fg.r,t,n,r,s,o),GD=io(i,"g",Fg.g,t,n,r,s,o),HD=io(i,"b",Fg.b,t,n,r,s,o),zD||GD||HD}var tu=new Xt,uf=new Rn,QD=new Rn,Xy=new Rn,VD,jD,WD,KD;function kS(i,e,t,n,r,s,o){var a=i;Array.isArray(e)?tu.set(e[0],e[1],e[2],e[3]):tu.copy(e);var l=i.dot(tu)>0?1:-1;return tu.x*=l,tu.y*=l,tu.z*=l,tu.w*=l,VD=io(i,"x",tu.x,t,n,r,s,o),jD=io(i,"y",tu.y,t,n,r,s,o),WD=io(i,"z",tu.z,t,n,r,s,o),KD=io(i,"w",tu.w,t,n,r,s,o),uf.set(i.x,i.y,i.z,i.w).normalize(),QD.set(a.__damp.velocity_x,a.__damp.velocity_y,a.__damp.velocity_z,a.__damp.velocity_w),Xy.copy(uf).multiplyScalar(QD.dot(uf)/uf.dot(uf)),a.__damp.velocity_x-=Xy.x,a.__damp.velocity_y-=Xy.y,a.__damp.velocity_z-=Xy.z,a.__damp.velocity_w-=Xy.w,i.set(uf.x,uf.y,uf.z,uf.w),VD||jD||WD||KD}var qy=new t0,YD,$D,XD;function Loe(i,e,t,n,r,s,o){return Array.isArray(e)?qy.set(e[0],e[1],e[2]):qy.copy(e),YD=io(i,"radius",qy.radius,t,n,r,s,o),$D=H1(i,"phi",qy.phi,t,n,r,s,o),XD=H1(i,"theta",qy.theta,t,n,r,s,o),YD||$D||XD}var bE=new Xe,qD=new Q,JD=new Xt,ZD=new Q,e9,t9,n9;function Boe(i,e,t,n,r,s,o){var a=i;return a.__damp===void 0&&(a.__damp={position:new Q,rotation:new Xt,scale:new Q},i.decompose(a.__damp.position,a.__damp.rotation,a.__damp.scale)),Array.isArray(e)?bE.set.apply(bE,DS(e)):bE.copy(e),bE.decompose(qD,JD,ZD),e9=KM(a.__damp.position,qD,t,n,r,s,o),t9=kS(a.__damp.rotation,JD,t,n,r,s,o),n9=KM(a.__damp.scale,ZD,t,n,r,s,o),i.compose(a.__damp.position,a.__damp.rotation,a.__damp.scale),e9||t9||n9}var aA=Object.freeze({__proto__:null,rsqw:Aoe,exp:bG,linear:yoe,sine:voe,cubic:xoe,quint:Eoe,circ:_oe,quart:Soe,expo:woe,damp:io,dampLookAt:boe,dampAngle:H1,damp2:Ioe,damp3:KM,damp4:Moe,dampE:Roe,dampC:Poe,dampQ:kS,dampS:Loe,dampM:Boe});const fR=C.createContext(null);function dR(){return C.useContext(fR)}function Doe({eps:i=1e-5,enabled:e=!0,infinite:t,horizontal:n,pages:r=1,distance:s=1,damping:o=.25,maxSpeed:a=1/0,prepend:l=!1,style:c={},children:u}){const{get:h,setEvents:f,gl:d,size:m,invalidate:y,events:g}=Ve(),[A]=C.useState(()=>document.createElement("div")),[E]=C.useState(()=>document.createElement("div")),[x]=C.useState(()=>document.createElement("div")),w=d.domElement.parentNode,T=C.useRef(0),I=C.useMemo(()=>({el:A,eps:i,fill:E,fixed:x,horizontal:n,damping:o,offset:0,delta:0,scroll:T,pages:r,range(P,R,U=0){const k=P-U,H=k+R+U*2;return this.offset<k?0:this.offset>H?1:(this.offset-k)/(H-k)},curve(P,R,U=0){return Math.sin(this.range(P,R,U)*Math.PI)},visible(P,R,U=0){const k=P-U,H=k+R+U*2;return this.offset>=k&&this.offset<=H}}),[i,o,n,r]);C.useEffect(()=>{A.style.position="absolute",A.style.width="100%",A.style.height="100%",A.style[n?"overflowX":"overflowY"]="auto",A.style[n?"overflowY":"overflowX"]="hidden",A.style.top="0px",A.style.left="0px";for(const R in c)A.style[R]=c[R];x.style.position="sticky",x.style.top="0px",x.style.left="0px",x.style.width="100%",x.style.height="100%",x.style.overflow="hidden",A.appendChild(x),E.style.height=n?"100%":`${r*s*100}%`,E.style.width=n?`${r*s*100}%`:"100%",E.style.pointerEvents="none",A.appendChild(E),l?w.prepend(A):w.appendChild(A),A[n?"scrollLeft":"scrollTop"]=1;const L=g.connected||d.domElement;requestAnimationFrame(()=>g.connect==null?void 0:g.connect(A));const P=h().events.compute;return f({compute(R,U){const{left:k,top:H}=w.getBoundingClientRect(),G=R.clientX-k,X=R.clientY-H;U.pointer.set(G/U.size.width*2-1,-(X/U.size.height)*2+1),U.raycaster.setFromCamera(U.pointer,U.camera)}}),()=>{w.removeChild(A),f({compute:P}),g.connect==null||g.connect(L)}},[r,s,n,A,E,x,w]),C.useEffect(()=>{if(g.connected===A){const L=m[n?"width":"height"],P=A[n?"scrollWidth":"scrollHeight"],R=P-L;let U=0,k=!0,H=!0;const G=()=>{if(!(!e||H)&&(y(),U=A[n?"scrollLeft":"scrollTop"],T.current=U/R,t)){if(!k){if(U>=R){const Z=1-I.offset;A[n?"scrollLeft":"scrollTop"]=1,T.current=I.offset=-Z,k=!0}else if(U<=0){const Z=1+I.offset;A[n?"scrollLeft":"scrollTop"]=P,T.current=I.offset=Z,k=!0}}k&&setTimeout(()=>k=!1,40)}};A.addEventListener("scroll",G,{passive:!0}),requestAnimationFrame(()=>H=!1);const X=Z=>A.scrollLeft+=Z.deltaY/2;return n&&A.addEventListener("wheel",X,{passive:!0}),()=>{A.removeEventListener("scroll",G),n&&A.removeEventListener("wheel",X)}}},[A,g,m,t,I,y,n,e]);let M=0;return Kt((L,P)=>{M=I.offset,aA.damp(I,"offset",T.current,o,P,a,void 0,i),aA.damp(I,"delta",Math.abs(M-I.offset),o,P,a,void 0,i),I.delta>i&&y()}),C.createElement(fR.Provider,{value:I},u)}const koe=C.forwardRef(({children:i},e)=>{const t=C.useRef(null);C.useImperativeHandle(e,()=>t.current,[]);const n=dR(),{width:r,height:s}=Ve(o=>o.viewport);return Kt(()=>{t.current.position.x=n.horizontal?-r*(n.pages-1)*n.offset:0,t.current.position.y=n.horizontal?0:s*(n.pages-1)*n.offset}),C.createElement("group",{ref:t},i)}),Foe=C.forwardRef(({children:i,style:e,...t},n)=>{const r=dR(),s=C.useRef(null);C.useImperativeHandle(n,()=>s.current,[]);const{width:o,height:a}=Ve(u=>u.size),l=C.useContext(n0),c=C.useMemo(()=>A6.createRoot(r.fixed),[r.fixed]);return Kt(()=>{r.delta>r.eps&&(s.current.style.transform=`translate3d(${r.horizontal?-o*(r.pages-1)*r.offset:0}px,${r.horizontal?0:a*(r.pages-1)*-r.offset}px,0)`)}),c.render(C.createElement("div",ot({ref:s,style:{...e,position:"absolute",top:0,left:0,willChange:"transform"}},t),C.createElement(fR.Provider,{value:r},C.createElement(n0.Provider,{value:l},i)))),null}),Ooe=C.forwardRef(({html:i,...e},t)=>{const n=i?Foe:koe;return C.createElement(n,ot({ref:t},e))});var pR=_x(),Xn=i=>Ex(i,pR),mR=_x();Xn.write=i=>Ex(i,mR);var n4=_x();Xn.onStart=i=>Ex(i,n4);var gR=_x();Xn.onFrame=i=>Ex(i,gR);var AR=_x();Xn.onFinish=i=>Ex(i,AR);var Q1=[];Xn.setTimeout=(i,e)=>{const t=Xn.now()+e,n=()=>{const s=Q1.findIndex(o=>o.cancel==n);~s&&Q1.splice(s,1),Vd-=~s?1:0},r={time:t,handler:i,cancel:n};return Q1.splice(IG(t),0,r),Vd+=1,MG(),r};var IG=i=>~(~Q1.findIndex(e=>e.time>i)||~Q1.length);Xn.cancel=i=>{n4.delete(i),gR.delete(i),AR.delete(i),pR.delete(i),mR.delete(i)};Xn.sync=i=>{YM=!0,Xn.batchedUpdates(i),YM=!1};Xn.throttle=i=>{let e;function t(){try{i(...e)}finally{e=null}}function n(...r){e=r,Xn.onStart(t)}return n.handler=i,n.cancel=()=>{n4.delete(t),e=null},n};var yR=typeof window<"u"?window.requestAnimationFrame:(()=>{});Xn.use=i=>yR=i;Xn.now=typeof performance<"u"?()=>performance.now():Date.now;Xn.batchedUpdates=i=>i();Xn.catch=console.error;Xn.frameLoop="always";Xn.advance=()=>{Xn.frameLoop!=="demand"?console.warn("Cannot call the manual advancement of rafz whilst frameLoop is not set as demand"):PG()};var Qd=-1,Vd=0,YM=!1;function Ex(i,e){YM?(e.delete(i),i(0)):(e.add(i),MG())}function MG(){Qd<0&&(Qd=0,Xn.frameLoop!=="demand"&&yR(RG))}function Noe(){Qd=-1}function RG(){~Qd&&(yR(RG),Xn.batchedUpdates(PG))}function PG(){const i=Qd;Qd=Xn.now();const e=IG(Qd);if(e&&(LG(Q1.splice(0,e),t=>t.handler()),Vd-=e),!Vd){Noe();return}n4.flush(),pR.flush(i?Math.min(64,Qd-i):16.667),gR.flush(),mR.flush(),AR.flush()}function _x(){let i=new Set,e=i;return{add(t){Vd+=e==i&&!i.has(t)?1:0,i.add(t)},delete(t){return Vd-=e==i&&i.has(t)?1:0,i.delete(t)},flush(t){e.size&&(i=new Set,Vd-=e.size,LG(e,n=>n(t)&&i.add(n)),Vd+=i.size,e=i)}}}function LG(i,e){i.forEach(t=>{try{e(t)}catch(n){Xn.catch(n)}})}var Uoe=Object.defineProperty,zoe=(i,e)=>{for(var t in e)Uoe(i,t,{get:e[t],enumerable:!0})},wu={};zoe(wu,{assign:()=>Hoe,colors:()=>qd,createStringInterpolator:()=>xR,skipAnimation:()=>DG,to:()=>BG,willAdvance:()=>ER});function $M(){}var Goe=(i,e,t)=>Object.defineProperty(i,e,{value:t,writable:!0,configurable:!0}),zt={arr:Array.isArray,obj:i=>!!i&&i.constructor.name==="Object",fun:i=>typeof i=="function",str:i=>typeof i=="string",num:i=>typeof i=="number",und:i=>i===void 0};function vf(i,e){if(zt.arr(i)){if(!zt.arr(e)||i.length!==e.length)return!1;for(let t=0;t<i.length;t++)if(i[t]!==e[t])return!1;return!0}return i===e}var Oi=(i,e)=>i.forEach(e);function Nf(i,e,t){if(zt.arr(i)){for(let n=0;n<i.length;n++)e.call(t,i[n],`${n}`);return}for(const n in i)i.hasOwnProperty(n)&&e.call(t,i[n],n)}var fc=i=>zt.und(i)?[]:zt.arr(i)?i:[i];function i2(i,e){if(i.size){const t=Array.from(i);i.clear(),Oi(t,e)}}var Nv=(i,...e)=>i2(i,t=>t(...e)),vR=()=>typeof window>"u"||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent),xR,BG,qd=null,DG=!1,ER=$M,Hoe=i=>{i.to&&(BG=i.to),i.now&&(Xn.now=i.now),i.colors!==void 0&&(qd=i.colors),i.skipAnimation!=null&&(DG=i.skipAnimation),i.createStringInterpolator&&(xR=i.createStringInterpolator),i.requestAnimationFrame&&Xn.use(i.requestAnimationFrame),i.batchedUpdates&&(Xn.batchedUpdates=i.batchedUpdates),i.willAdvance&&(ER=i.willAdvance),i.frameLoop&&(Xn.frameLoop=i.frameLoop)},r2=new Set,cc=[],GT=[],FS=0,i4={get idle(){return!r2.size&&!cc.length},start(i){FS>i.priority?(r2.add(i),Xn.onStart(Qoe)):(kG(i),Xn(XM))},advance:XM,sort(i){if(FS)Xn.onFrame(()=>i4.sort(i));else{const e=cc.indexOf(i);~e&&(cc.splice(e,1),FG(i))}},clear(){cc=[],r2.clear()}};function Qoe(){r2.forEach(kG),r2.clear(),Xn(XM)}function kG(i){cc.includes(i)||FG(i)}function FG(i){cc.splice(Voe(cc,e=>e.priority>i.priority),0,i)}function XM(i){const e=GT;for(let t=0;t<cc.length;t++){const n=cc[t];FS=n.priority,n.idle||(ER(n),n.advance(i),n.idle||e.push(n))}return FS=0,GT=cc,GT.length=0,cc=e,cc.length>0}function Voe(i,e){const t=i.findIndex(e);return t<0?i.length:t}var joe={transparent:0,aliceblue:4042850303,antiquewhite:4209760255,aqua:16777215,aquamarine:2147472639,azure:4043309055,beige:4126530815,bisque:4293182719,black:255,blanchedalmond:4293643775,blue:65535,blueviolet:2318131967,brown:2771004159,burlywood:3736635391,burntsienna:3934150143,cadetblue:1604231423,chartreuse:2147418367,chocolate:3530104575,coral:4286533887,cornflowerblue:1687547391,cornsilk:4294499583,crimson:3692313855,cyan:16777215,darkblue:35839,darkcyan:9145343,darkgoldenrod:3095792639,darkgray:2846468607,darkgreen:6553855,darkgrey:2846468607,darkkhaki:3182914559,darkmagenta:2332068863,darkolivegreen:1433087999,darkorange:4287365375,darkorchid:2570243327,darkred:2332033279,darksalmon:3918953215,darkseagreen:2411499519,darkslateblue:1211993087,darkslategray:793726975,darkslategrey:793726975,darkturquoise:13554175,darkviolet:2483082239,deeppink:4279538687,deepskyblue:12582911,dimgray:1768516095,dimgrey:1768516095,dodgerblue:512819199,firebrick:2988581631,floralwhite:4294635775,forestgreen:579543807,fuchsia:4278255615,gainsboro:3705462015,ghostwhite:4177068031,gold:4292280575,goldenrod:3668254975,gray:2155905279,green:8388863,greenyellow:2919182335,grey:2155905279,honeydew:4043305215,hotpink:4285117695,indianred:3445382399,indigo:1258324735,ivory:4294963455,khaki:4041641215,lavender:3873897215,lavenderblush:4293981695,lawngreen:2096890111,lemonchiffon:4294626815,lightblue:2916673279,lightcoral:4034953471,lightcyan:3774873599,lightgoldenrodyellow:4210742015,lightgray:3553874943,lightgreen:2431553791,lightgrey:3553874943,lightpink:4290167295,lightsalmon:4288707327,lightseagreen:548580095,lightskyblue:2278488831,lightslategray:2005441023,lightslategrey:2005441023,lightsteelblue:2965692159,lightyellow:4294959359,lime:16711935,limegreen:852308735,linen:4210091775,magenta:4278255615,maroon:2147483903,mediumaquamarine:1724754687,mediumblue:52735,mediumorchid:3126187007,mediumpurple:2473647103,mediumseagreen:1018393087,mediumslateblue:2070474495,mediumspringgreen:16423679,mediumturquoise:1221709055,mediumvioletred:3340076543,midnightblue:421097727,mintcream:4127193855,mistyrose:4293190143,moccasin:4293178879,navajowhite:4292783615,navy:33023,oldlace:4260751103,olive:2155872511,olivedrab:1804477439,orange:4289003775,orangered:4282712319,orchid:3664828159,palegoldenrod:4008225535,palegreen:2566625535,paleturquoise:2951671551,palevioletred:3681588223,papayawhip:4293907967,peachpuff:4292524543,peru:3448061951,pink:4290825215,plum:3718307327,powderblue:2967529215,purple:2147516671,rebeccapurple:1714657791,red:4278190335,rosybrown:3163525119,royalblue:1097458175,saddlebrown:2336560127,salmon:4202722047,sandybrown:4104413439,seagreen:780883967,seashell:4294307583,sienna:2689740287,silver:3233857791,skyblue:2278484991,slateblue:1784335871,slategray:1887473919,slategrey:1887473919,snow:4294638335,springgreen:16744447,steelblue:1182971135,tan:3535047935,teal:8421631,thistle:3636451583,tomato:4284696575,turquoise:1088475391,violet:4001558271,wheat:4125012991,white:4294967295,whitesmoke:4126537215,yellow:4294902015,yellowgreen:2597139199},gu="[-+]?\\d*\\.?\\d+",OS=gu+"%";function r4(...i){return"\\(\\s*("+i.join(")\\s*,\\s*(")+")\\s*\\)"}var Woe=new RegExp("rgb"+r4(gu,gu,gu)),Koe=new RegExp("rgba"+r4(gu,gu,gu,gu)),Yoe=new RegExp("hsl"+r4(gu,OS,OS)),$oe=new RegExp("hsla"+r4(gu,OS,OS,gu)),Xoe=/^#([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,qoe=/^#([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,Joe=/^#([0-9a-fA-F]{6})$/,Zoe=/^#([0-9a-fA-F]{8})$/;function eae(i){let e;return typeof i=="number"?i>>>0===i&&i>=0&&i<=4294967295?i:null:(e=Joe.exec(i))?parseInt(e[1]+"ff",16)>>>0:qd&&qd[i]!==void 0?qd[i]:(e=Woe.exec(i))?(Og(e[1])<<24|Og(e[2])<<16|Og(e[3])<<8|255)>>>0:(e=Koe.exec(i))?(Og(e[1])<<24|Og(e[2])<<16|Og(e[3])<<8|s9(e[4]))>>>0:(e=Xoe.exec(i))?parseInt(e[1]+e[1]+e[2]+e[2]+e[3]+e[3]+"ff",16)>>>0:(e=Zoe.exec(i))?parseInt(e[1],16)>>>0:(e=qoe.exec(i))?parseInt(e[1]+e[1]+e[2]+e[2]+e[3]+e[3]+e[4]+e[4],16)>>>0:(e=Yoe.exec(i))?(i9(r9(e[1]),IE(e[2]),IE(e[3]))|255)>>>0:(e=$oe.exec(i))?(i9(r9(e[1]),IE(e[2]),IE(e[3]))|s9(e[4]))>>>0:null}function HT(i,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?i+(e-i)*6*t:t<1/2?e:t<2/3?i+(e-i)*(2/3-t)*6:i}function i9(i,e,t){const n=t<.5?t*(1+e):t+e-t*e,r=2*t-n,s=HT(r,n,i+1/3),o=HT(r,n,i),a=HT(r,n,i-1/3);return Math.round(s*255)<<24|Math.round(o*255)<<16|Math.round(a*255)<<8}function Og(i){const e=parseInt(i,10);return e<0?0:e>255?255:e}function r9(i){return(parseFloat(i)%360+360)%360/360}function s9(i){const e=parseFloat(i);return e<0?0:e>1?255:Math.round(e*255)}function IE(i){const e=parseFloat(i);return e<0?0:e>100?1:e/100}function o9(i){let e=eae(i);if(e===null)return i;e=e||0;const t=(e&4278190080)>>>24,n=(e&16711680)>>>16,r=(e&65280)>>>8,s=(e&255)/255;return`rgba(${t}, ${n}, ${r}, ${s})`}var O2=(i,e,t)=>{if(zt.fun(i))return i;if(zt.arr(i))return O2({range:i,output:e,extrapolate:t});if(zt.str(i.output[0]))return xR(i);const n=i,r=n.output,s=n.range||[0,1],o=n.extrapolateLeft||n.extrapolate||"extend",a=n.extrapolateRight||n.extrapolate||"extend",l=n.easing||(c=>c);return c=>{const u=nae(c,s);return tae(c,s[u],s[u+1],r[u],r[u+1],l,o,a,n.map)}};function tae(i,e,t,n,r,s,o,a,l){let c=l?l(i):i;if(c<e){if(o==="identity")return c;o==="clamp"&&(c=e)}if(c>t){if(a==="identity")return c;a==="clamp"&&(c=t)}return n===r?n:e===t?i<=e?n:r:(e===-1/0?c=-c:t===1/0?c=c-e:c=(c-e)/(t-e),c=s(c),n===-1/0?c=-c:r===1/0?c=c+n:c=c*(r-n)+n,c)}function nae(i,e){for(var t=1;t<e.length-1&&!(e[t]>=i);++t);return t-1}var iae={linear:i=>i},N2=Symbol.for("FluidValue.get"),lA=Symbol.for("FluidValue.observers"),fh=i=>!!(i&&i[N2]),sc=i=>i&&i[N2]?i[N2]():i,a9=i=>i[lA]||null;function rae(i,e){i.eventObserved?i.eventObserved(e):i(e)}function NS(i,e){const t=i[lA];t&&t.forEach(n=>{rae(n,e)})}var sae=class{constructor(i){if(!i&&!(i=this.get))throw Error("Unknown getter");oae(this,i)}},oae=(i,e)=>OG(i,N2,e);function Sx(i,e){if(i[N2]){let t=i[lA];t||OG(i,lA,t=new Set),t.has(e)||(t.add(e),i.observerAdded&&i.observerAdded(t.size,e))}return e}function US(i,e){const t=i[lA];if(t&&t.has(e)){const n=t.size-1;n?t.delete(e):i[lA]=null,i.observerRemoved&&i.observerRemoved(n,e)}}var OG=(i,e,t)=>Object.defineProperty(i,e,{value:t,writable:!0,configurable:!0}),J_=/[+\-]?(?:0|[1-9]\d*)(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,aae=/(#(?:[0-9a-f]{2}){2,4}|(#[0-9a-f]{3})|(rgb|hsl)a?\((-?\d+%?[,\s]+){2,3}\s*[\d\.]+%?\))/gi,l9=new RegExp(`(${J_.source})(%|[a-z]+)`,"i"),lae=/rgba\(([0-9\.-]+), ([0-9\.-]+), ([0-9\.-]+), ([0-9\.-]+)\)/gi,s4=/var\((--[a-zA-Z0-9-_]+),? ?([a-zA-Z0-9 ()%#.,-]+)?\)/,NG=i=>{const[e,t]=cae(i);if(!e||vR())return i;const n=window.getComputedStyle(document.documentElement).getPropertyValue(e);if(n)return n.trim();if(t&&t.startsWith("--")){const r=window.getComputedStyle(document.documentElement).getPropertyValue(t);return r||i}else{if(t&&s4.test(t))return NG(t);if(t)return t}return i},cae=i=>{const e=s4.exec(i);if(!e)return[,];const[,t,n]=e;return[t,n]},QT,uae=(i,e,t,n,r)=>`rgba(${Math.round(e)}, ${Math.round(t)}, ${Math.round(n)}, ${r})`,UG=i=>{QT||(QT=qd?new RegExp(`(${Object.keys(qd).join("|")})(?!\\w)`,"g"):/^\b$/);const e=i.output.map(s=>sc(s).replace(s4,NG).replace(aae,o9).replace(QT,o9)),t=e.map(s=>s.match(J_).map(Number)),r=t[0].map((s,o)=>t.map(a=>{if(!(o in a))throw Error('The arity of each "output" value must be equal');return a[o]})).map(s=>O2({...i,output:s}));return s=>{var l;const o=!l9.test(e[0])&&((l=e.find(c=>l9.test(c)))==null?void 0:l.replace(J_,""));let a=0;return e[0].replace(J_,()=>`${r[a++](s)}${o||""}`).replace(lae,uae)}},_R="react-spring: ",zG=i=>{const e=i;let t=!1;if(typeof e!="function")throw new TypeError(`${_R}once requires a function parameter`);return(...n)=>{t||(e(...n),t=!0)}},hae=zG(console.warn);function fae(){hae(`${_R}The "interpolate" function is deprecated in v9 (use "to" instead)`)}var dae=zG(console.warn);function pae(){dae(`${_R}Directly calling start instead of using the api object is deprecated in v9 (use ".start" instead), this will be removed in later 0.X.0 versions`)}function o4(i){return zt.str(i)&&(i[0]=="#"||/\d/.test(i)||!vR()&&s4.test(i)||i in(qd||{}))}var SR=vR()?C.useEffect:C.useLayoutEffect,mae=()=>{const i=C.useRef(!1);return SR(()=>(i.current=!0,()=>{i.current=!1}),[]),i};function GG(){const i=C.useState()[1],e=mae();return()=>{e.current&&i(Math.random())}}function gae(i,e){const[t]=C.useState(()=>({inputs:e,result:i()})),n=C.useRef(),r=n.current;let s=r;return s?e&&s.inputs&&Aae(e,s.inputs)||(s={inputs:e,result:i()}):s=t,C.useEffect(()=>{n.current=s,r==t&&(t.inputs=t.result=void 0)},[s]),s.result}function Aae(i,e){if(i.length!==e.length)return!1;for(let t=0;t<i.length;t++)if(i[t]!==e[t])return!1;return!0}var HG=i=>C.useEffect(i,yae),yae=[];function c9(i){const e=C.useRef();return C.useEffect(()=>{e.current=i}),e.current}var U2=Symbol.for("Animated:node"),vae=i=>!!i&&i[U2]===i,uh=i=>i&&i[U2],wR=(i,e)=>Goe(i,U2,e),a4=i=>i&&i[U2]&&i[U2].getPayload(),QG=class{constructor(){wR(this,this)}getPayload(){return this.payload||[]}},wx=class extends QG{constructor(i){super(),this._value=i,this.done=!0,this.durationProgress=0,zt.num(this._value)&&(this.lastPosition=this._value)}static create(i){return new wx(i)}getPayload(){return[this]}getValue(){return this._value}setValue(i,e){return zt.num(i)&&(this.lastPosition=i,e&&(i=Math.round(i/e)*e,this.done&&(this.lastPosition=i))),this._value===i?!1:(this._value=i,!0)}reset(){const{done:i}=this;this.done=!1,zt.num(this._value)&&(this.elapsedTime=0,this.durationProgress=0,this.lastPosition=this._value,i&&(this.lastVelocity=null),this.v0=null)}},z2=class extends wx{constructor(i){super(0),this._string=null,this._toString=O2({output:[i,i]})}static create(i){return new z2(i)}getValue(){const i=this._string;return i??(this._string=this._toString(this._value))}setValue(i){if(zt.str(i)){if(i==this._string)return!1;this._string=i,this._value=1}else if(super.setValue(i))this._string=null;else return!1;return!0}reset(i){i&&(this._toString=O2({output:[this.getValue(),i]})),this._value=0,super.reset()}},zS={dependencies:null},CR=class extends QG{constructor(i){super(),this.source=i,this.setValue(i)}getValue(i){const e={};return Nf(this.source,(t,n)=>{vae(t)?e[n]=t.getValue(i):fh(t)?e[n]=sc(t):i||(e[n]=t)}),e}setValue(i){this.source=i,this.payload=this._makePayload(i)}reset(){this.payload&&Oi(this.payload,i=>i.reset())}_makePayload(i){if(i){const e=new Set;return Nf(i,this._addToPayload,e),Array.from(e)}}_addToPayload(i){zS.dependencies&&fh(i)&&zS.dependencies.add(i);const e=a4(i);e&&Oi(e,t=>this.add(t))}},VG=class extends CR{constructor(i){super(i)}static create(i){return new VG(i)}getValue(){return this.source.map(i=>i.getValue())}setValue(i){const e=this.getPayload();return i.length==e.length?e.map((t,n)=>t.setValue(i[n])).some(Boolean):(super.setValue(i.map(xae)),!0)}};function xae(i){return(o4(i)?z2:wx).create(i)}function qM(i){const e=uh(i);return e?e.constructor:zt.arr(i)?VG:o4(i)?z2:wx}var u9=(i,e)=>{const t=!zt.fun(i)||i.prototype&&i.prototype.isReactComponent;return C.forwardRef((n,r)=>{const s=C.useRef(null),o=t&&C.useCallback(m=>{s.current=Sae(r,m)},[r]),[a,l]=_ae(n,e),c=GG(),u=()=>{const m=s.current;if(t&&!m)return;(m?e.applyAnimatedValues(m,a.getValue(!0)):!1)===!1&&c()},h=new Eae(u,l),f=C.useRef();SR(()=>(f.current=h,Oi(l,m=>Sx(m,h)),()=>{f.current&&(Oi(f.current.deps,m=>US(m,f.current)),Xn.cancel(f.current.update))})),C.useEffect(u,[]),HG(()=>()=>{const m=f.current;Oi(m.deps,y=>US(y,m))});const d=e.getComponentProps(a.getValue());return C.createElement(i,{...d,ref:o})})},Eae=class{constructor(i,e){this.update=i,this.deps=e}eventObserved(i){i.type=="change"&&Xn.write(this.update)}};function _ae(i,e){const t=new Set;return zS.dependencies=t,i.style&&(i={...i,style:e.createAnimatedStyle(i.style)}),i=new CR(i),zS.dependencies=null,[i,t]}function Sae(i,e){return i&&(zt.fun(i)?i(e):i.current=e),e}var h9=Symbol.for("AnimatedComponent"),wae=(i,{applyAnimatedValues:e=()=>!1,createAnimatedStyle:t=r=>new CR(r),getComponentProps:n=r=>r}={})=>{const r={applyAnimatedValues:e,createAnimatedStyle:t,getComponentProps:n},s=o=>{const a=f9(o)||"Anonymous";return zt.str(o)?o=s[o]||(s[o]=u9(o,r)):o=o[h9]||(o[h9]=u9(o,r)),o.displayName=`Animated(${a})`,o};return Nf(i,(o,a)=>{zt.arr(i)&&(a=f9(o)),s[a]=s(o)}),{animated:s}},f9=i=>zt.str(i)?i:i&&zt.str(i.displayName)?i.displayName:zt.fun(i)&&i.name||null;function Im(i,...e){return zt.fun(i)?i(...e):i}var s2=(i,e)=>i===!0||!!(e&&i&&(zt.fun(i)?i(e):fc(i).includes(e))),jG=(i,e)=>zt.obj(i)?e&&i[e]:i,WG=(i,e)=>i.default===!0?i[e]:i.default?i.default[e]:void 0,Cae=i=>i,TR=(i,e=Cae)=>{let t=Tae;i.default&&i.default!==!0&&(i=i.default,t=Object.keys(i));const n={};for(const r of t){const s=e(i[r],r);zt.und(s)||(n[r]=s)}return n},Tae=["config","onProps","onStart","onChange","onPause","onResume","onRest"],bae={config:1,from:1,to:1,ref:1,loop:1,reset:1,pause:1,cancel:1,reverse:1,immediate:1,default:1,delay:1,onProps:1,onStart:1,onChange:1,onPause:1,onResume:1,onRest:1,onResolve:1,items:1,trail:1,sort:1,expires:1,initial:1,enter:1,update:1,leave:1,children:1,onDestroyed:1,keys:1,callId:1,parentId:1};function Iae(i){const e={};let t=0;if(Nf(i,(n,r)=>{bae[r]||(e[r]=n,t++)}),t)return e}function KG(i){const e=Iae(i);if(e){const t={to:e};return Nf(i,(n,r)=>r in e||(t[r]=n)),t}return{...i}}function G2(i){return i=sc(i),zt.arr(i)?i.map(G2):o4(i)?wu.createStringInterpolator({range:[0,1],output:[i,i]})(1):i}function Mae(i){for(const e in i)return!0;return!1}function JM(i){return zt.fun(i)||zt.arr(i)&&zt.obj(i[0])}function Rae(i,e){var t;(t=i.ref)==null||t.delete(i),e==null||e.delete(i)}function Pae(i,e){var t;e&&i.ref!==e&&((t=i.ref)==null||t.delete(i),e.add(i),i.ref=e)}var Lae={default:{tension:170,friction:26}},ZM={...Lae.default,mass:1,damping:1,easing:iae.linear,clamp:!1},Bae=class{constructor(){this.velocity=0,Object.assign(this,ZM)}};function Dae(i,e,t){t&&(t={...t},d9(t,e),e={...t,...e}),d9(i,e),Object.assign(i,e);for(const o in ZM)i[o]==null&&(i[o]=ZM[o]);let{frequency:n,damping:r}=i;const{mass:s}=i;return zt.und(n)||(n<.01&&(n=.01),r<0&&(r=0),i.tension=Math.pow(2*Math.PI/n,2)*s,i.friction=4*Math.PI*r*s/n),i}function d9(i,e){if(!zt.und(e.decay))i.duration=void 0;else{const t=!zt.und(e.tension)||!zt.und(e.friction);(t||!zt.und(e.frequency)||!zt.und(e.damping)||!zt.und(e.mass))&&(i.duration=void 0,i.decay=void 0),t&&(i.frequency=void 0)}}var p9=[],kae=class{constructor(){this.changed=!1,this.values=p9,this.toValues=null,this.fromValues=p9,this.config=new Bae,this.immediate=!1}};function YG(i,{key:e,props:t,defaultProps:n,state:r,actions:s}){return new Promise((o,a)=>{let l,c,u=s2(t.cancel??(n==null?void 0:n.cancel),e);if(u)d();else{zt.und(t.pause)||(r.paused=s2(t.pause,e));let m=n==null?void 0:n.pause;m!==!0&&(m=r.paused||s2(m,e)),l=Im(t.delay||0,e),m?(r.resumeQueue.add(f),s.pause()):(s.resume(),f())}function h(){r.resumeQueue.add(f),r.timeouts.delete(c),c.cancel(),l=c.time-Xn.now()}function f(){l>0&&!wu.skipAnimation?(r.delayed=!0,c=Xn.setTimeout(d,l),r.pauseQueue.add(h),r.timeouts.add(c)):d()}function d(){r.delayed&&(r.delayed=!1),r.pauseQueue.delete(h),r.timeouts.delete(c),i<=(r.cancelId||0)&&(u=!0);try{s.start({...t,callId:i,cancel:u},o)}catch(m){a(m)}}})}var bR=(i,e)=>e.length==1?e[0]:e.some(t=>t.cancelled)?V1(i.get()):e.every(t=>t.noop)?$G(i.get()):pu(i.get(),e.every(t=>t.finished)),$G=i=>({value:i,noop:!0,finished:!0,cancelled:!1}),pu=(i,e,t=!1)=>({value:i,finished:e,cancelled:t}),V1=i=>({value:i,cancelled:!0,finished:!1});function XG(i,e,t,n){const{callId:r,parentId:s,onRest:o}=e,{asyncTo:a,promise:l}=t;return!s&&i===a&&!e.reset?l:t.promise=(async()=>{t.asyncId=r,t.asyncTo=i;const c=TR(e,(g,A)=>A==="onRest"?void 0:g);let u,h;const f=new Promise((g,A)=>(u=g,h=A)),d=g=>{const A=r<=(t.cancelId||0)&&V1(n)||r!==t.asyncId&&pu(n,!1);if(A)throw g.result=A,h(g),g},m=(g,A)=>{const E=new m9,x=new g9;return(async()=>{if(wu.skipAnimation)throw H2(t),x.result=pu(n,!1),h(x),x;d(E);const w=zt.obj(g)?{...g}:{...A,to:g};w.parentId=r,Nf(c,(I,M)=>{zt.und(w[M])&&(w[M]=I)});const T=await n.start(w);return d(E),t.paused&&await new Promise(I=>{t.resumeQueue.add(I)}),T})()};let y;if(wu.skipAnimation)return H2(t),pu(n,!1);try{let g;zt.arr(i)?g=(async A=>{for(const E of A)await m(E)})(i):g=Promise.resolve(i(m,n.stop.bind(n))),await Promise.all([g.then(u),f]),y=pu(n.get(),!0,!1)}catch(g){if(g instanceof m9)y=g.result;else if(g instanceof g9)y=g.result;else throw g}finally{r==t.asyncId&&(t.asyncId=s,t.asyncTo=s?a:void 0,t.promise=s?l:void 0)}return zt.fun(o)&&Xn.batchedUpdates(()=>{o(y,n,n.item)}),y})()}function H2(i,e){i2(i.timeouts,t=>t.cancel()),i.pauseQueue.clear(),i.resumeQueue.clear(),i.asyncId=i.asyncTo=i.promise=void 0,e&&(i.cancelId=e)}var m9=class extends Error{constructor(){super("An async animation has been interrupted. You see this error because you forgot to use `await` or `.catch(...)` on its returned promise.")}},g9=class extends Error{constructor(){super("SkipAnimationSignal")}},e5=i=>i instanceof IR,Fae=1,IR=class extends sae{constructor(){super(...arguments),this.id=Fae++,this._priority=0}get priority(){return this._priority}set priority(i){this._priority!=i&&(this._priority=i,this._onPriorityChange(i))}get(){const i=uh(this);return i&&i.getValue()}to(...i){return wu.to(this,i)}interpolate(...i){return fae(),wu.to(this,i)}toJSON(){return this.get()}observerAdded(i){i==1&&this._attach()}observerRemoved(i){i==0&&this._detach()}_attach(){}_detach(){}_onChange(i,e=!1){NS(this,{type:"change",parent:this,value:i,idle:e})}_onPriorityChange(i){this.idle||i4.sort(this),NS(this,{type:"priority",parent:this,priority:i})}},s0=Symbol.for("SpringPhase"),qG=1,t5=2,n5=4,VT=i=>(i[s0]&qG)>0,bd=i=>(i[s0]&t5)>0,Jy=i=>(i[s0]&n5)>0,A9=(i,e)=>e?i[s0]|=t5|qG:i[s0]&=~t5,y9=(i,e)=>e?i[s0]|=n5:i[s0]&=~n5,Oae=class extends IR{constructor(i,e){if(super(),this.animation=new kae,this.defaultProps={},this._state={paused:!1,delayed:!1,pauseQueue:new Set,resumeQueue:new Set,timeouts:new Set},this._pendingCalls=new Set,this._lastCallId=0,this._lastToId=0,this._memoizedDuration=0,!zt.und(i)||!zt.und(e)){const t=zt.obj(i)?{...i}:{...e,from:i};zt.und(t.default)&&(t.default=!0),this.start(t)}}get idle(){return!(bd(this)||this._state.asyncTo)||Jy(this)}get goal(){return sc(this.animation.to)}get velocity(){const i=uh(this);return i instanceof wx?i.lastVelocity||0:i.getPayload().map(e=>e.lastVelocity||0)}get hasAnimated(){return VT(this)}get isAnimating(){return bd(this)}get isPaused(){return Jy(this)}get isDelayed(){return this._state.delayed}advance(i){let e=!0,t=!1;const n=this.animation;let{toValues:r}=n;const{config:s}=n,o=a4(n.to);!o&&fh(n.to)&&(r=fc(sc(n.to))),n.values.forEach((c,u)=>{if(c.done)return;const h=c.constructor==z2?1:o?o[u].lastPosition:r[u];let f=n.immediate,d=h;if(!f){if(d=c.lastPosition,s.tension<=0){c.done=!0;return}let m=c.elapsedTime+=i;const y=n.fromValues[u],g=c.v0!=null?c.v0:c.v0=zt.arr(s.velocity)?s.velocity[u]:s.velocity;let A;const E=s.precision||(y==h?.005:Math.min(1,Math.abs(h-y)*.001));if(zt.und(s.duration))if(s.decay){const x=s.decay===!0?.998:s.decay,w=Math.exp(-(1-x)*m);d=y+g/(1-x)*(1-w),f=Math.abs(c.lastPosition-d)<=E,A=g*w}else{A=c.lastVelocity==null?g:c.lastVelocity;const x=s.restVelocity||E/10,w=s.clamp?0:s.bounce,T=!zt.und(w),I=y==h?c.v0>0:y<h;let M,L=!1;const P=1,R=Math.ceil(i/P);for(let U=0;U<R&&(M=Math.abs(A)>x,!(!M&&(f=Math.abs(h-d)<=E,f)));++U){T&&(L=d==h||d>h==I,L&&(A=-A*w,d=h));const k=-s.tension*1e-6*(d-h),H=-s.friction*.001*A,G=(k+H)/s.mass;A=A+G*P,d=d+A*P}}else{let x=1;s.duration>0&&(this._memoizedDuration!==s.duration&&(this._memoizedDuration=s.duration,c.durationProgress>0&&(c.elapsedTime=s.duration*c.durationProgress,m=c.elapsedTime+=i)),x=(s.progress||0)+m/this._memoizedDuration,x=x>1?1:x<0?0:x,c.durationProgress=x),d=y+s.easing(x)*(h-y),A=(d-c.lastPosition)/i,f=x==1}c.lastVelocity=A,Number.isNaN(d)&&(console.warn("Got NaN while animating:",this),f=!0)}o&&!o[u].done&&(f=!1),f?c.done=!0:e=!1,c.setValue(d,s.round)&&(t=!0)});const a=uh(this),l=a.getValue();if(e){const c=sc(n.to);(l!==c||t)&&!s.decay?(a.setValue(c),this._onChange(c)):t&&s.decay&&this._onChange(l),this._stop()}else t&&this._onChange(l)}set(i){return Xn.batchedUpdates(()=>{this._stop(),this._focus(i),this._set(i)}),this}pause(){this._update({pause:!0})}resume(){this._update({pause:!1})}finish(){if(bd(this)){const{to:i,config:e}=this.animation;Xn.batchedUpdates(()=>{this._onStart(),e.decay||this._set(i,!1),this._stop()})}return this}update(i){return(this.queue||(this.queue=[])).push(i),this}start(i,e){let t;return zt.und(i)?(t=this.queue||[],this.queue=[]):t=[zt.obj(i)?i:{...e,to:i}],Promise.all(t.map(n=>this._update(n))).then(n=>bR(this,n))}stop(i){const{to:e}=this.animation;return this._focus(this.get()),H2(this._state,i&&this._lastCallId),Xn.batchedUpdates(()=>this._stop(e,i)),this}reset(){this._update({reset:!0})}eventObserved(i){i.type=="change"?this._start():i.type=="priority"&&(this.priority=i.priority+1)}_prepareNode(i){const e=this.key||"";let{to:t,from:n}=i;t=zt.obj(t)?t[e]:t,(t==null||JM(t))&&(t=void 0),n=zt.obj(n)?n[e]:n,n==null&&(n=void 0);const r={to:t,from:n};return VT(this)||(i.reverse&&([t,n]=[n,t]),n=sc(n),zt.und(n)?uh(this)||this._set(t):this._set(n)),r}_update({...i},e){const{key:t,defaultProps:n}=this;i.default&&Object.assign(n,TR(i,(o,a)=>/^on/.test(a)?jG(o,t):o)),x9(this,i,"onProps"),ev(this,"onProps",i,this);const r=this._prepareNode(i);if(Object.isFrozen(this))throw Error("Cannot animate a `SpringValue` object that is frozen. Did you forget to pass your component to `animated(...)` before animating its props?");const s=this._state;return YG(++this._lastCallId,{key:t,props:i,defaultProps:n,state:s,actions:{pause:()=>{Jy(this)||(y9(this,!0),Nv(s.pauseQueue),ev(this,"onPause",pu(this,Zy(this,this.animation.to)),this))},resume:()=>{Jy(this)&&(y9(this,!1),bd(this)&&this._resume(),Nv(s.resumeQueue),ev(this,"onResume",pu(this,Zy(this,this.animation.to)),this))},start:this._merge.bind(this,r)}}).then(o=>{if(i.loop&&o.finished&&!(e&&o.noop)){const a=JG(i);if(a)return this._update(a,!0)}return o})}_merge(i,e,t){if(e.cancel)return this.stop(!0),t(V1(this));const n=!zt.und(i.to),r=!zt.und(i.from);if(n||r)if(e.callId>this._lastToId)this._lastToId=e.callId;else return t(V1(this));const{key:s,defaultProps:o,animation:a}=this,{to:l,from:c}=a;let{to:u=l,from:h=c}=i;r&&!n&&(!e.default||zt.und(u))&&(u=h),e.reverse&&([u,h]=[h,u]);const f=!vf(h,c);f&&(a.from=h),h=sc(h);const d=!vf(u,l);d&&this._focus(u);const m=JM(e.to),{config:y}=a,{decay:g,velocity:A}=y;(n||r)&&(y.velocity=0),e.config&&!m&&Dae(y,Im(e.config,s),e.config!==o.config?Im(o.config,s):void 0);let E=uh(this);if(!E||zt.und(u))return t(pu(this,!0));const x=zt.und(e.reset)?r&&!e.default:!zt.und(h)&&s2(e.reset,s),w=x?h:this.get(),T=G2(u),I=zt.num(T)||zt.arr(T)||o4(T),M=!m&&(!I||s2(o.immediate||e.immediate,s));if(d){const U=qM(u);if(U!==E.constructor)if(M)E=this._set(T);else throw Error(`Cannot animate between ${E.constructor.name} and ${U.name}, as the "to" prop suggests`)}const L=E.constructor;let P=fh(u),R=!1;if(!P){const U=x||!VT(this)&&f;(d||U)&&(R=vf(G2(w),T),P=!R),(!vf(a.immediate,M)&&!M||!vf(y.decay,g)||!vf(y.velocity,A))&&(P=!0)}if(R&&bd(this)&&(a.changed&&!x?P=!0:P||this._stop(l)),!m&&((P||fh(l))&&(a.values=E.getPayload(),a.toValues=fh(u)?null:L==z2?[1]:fc(T)),a.immediate!=M&&(a.immediate=M,!M&&!x&&this._set(l)),P)){const{onRest:U}=a;Oi(Uae,H=>x9(this,e,H));const k=pu(this,Zy(this,l));Nv(this._pendingCalls,k),this._pendingCalls.add(t),a.changed&&Xn.batchedUpdates(()=>{var H;a.changed=!x,U==null||U(k,this),x?Im(o.onRest,k):(H=a.onStart)==null||H.call(a,k,this)})}x&&this._set(w),m?t(XG(e.to,e,this._state,this)):P?this._start():bd(this)&&!d?this._pendingCalls.add(t):t($G(w))}_focus(i){const e=this.animation;i!==e.to&&(a9(this)&&this._detach(),e.to=i,a9(this)&&this._attach())}_attach(){let i=0;const{to:e}=this.animation;fh(e)&&(Sx(e,this),e5(e)&&(i=e.priority+1)),this.priority=i}_detach(){const{to:i}=this.animation;fh(i)&&US(i,this)}_set(i,e=!0){const t=sc(i);if(!zt.und(t)){const n=uh(this);if(!n||!vf(t,n.getValue())){const r=qM(t);!n||n.constructor!=r?wR(this,r.create(t)):n.setValue(t),n&&Xn.batchedUpdates(()=>{this._onChange(t,e)})}}return uh(this)}_onStart(){const i=this.animation;i.changed||(i.changed=!0,ev(this,"onStart",pu(this,Zy(this,i.to)),this))}_onChange(i,e){e||(this._onStart(),Im(this.animation.onChange,i,this)),Im(this.defaultProps.onChange,i,this),super._onChange(i,e)}_start(){const i=this.animation;uh(this).reset(sc(i.to)),i.immediate||(i.fromValues=i.values.map(e=>e.lastPosition)),bd(this)||(A9(this,!0),Jy(this)||this._resume())}_resume(){wu.skipAnimation?this.finish():i4.start(this)}_stop(i,e){if(bd(this)){A9(this,!1);const t=this.animation;Oi(t.values,r=>{r.done=!0}),t.toValues&&(t.onChange=t.onPause=t.onResume=void 0),NS(this,{type:"idle",parent:this});const n=e?V1(this.get()):pu(this.get(),Zy(this,i??t.to));Nv(this._pendingCalls,n),t.changed&&(t.changed=!1,ev(this,"onRest",n,this))}}};function Zy(i,e){const t=G2(e),n=G2(i.get());return vf(n,t)}function JG(i,e=i.loop,t=i.to){const n=Im(e);if(n){const r=n!==!0&&KG(n),s=(r||i).reverse,o=!r||r.reset;return Q2({...i,loop:e,default:!1,pause:void 0,to:!s||JM(t)?t:void 0,from:o?i.from:void 0,reset:o,...r})}}function Q2(i){const{to:e,from:t}=i=KG(i),n=new Set;return zt.obj(e)&&v9(e,n),zt.obj(t)&&v9(t,n),i.keys=n.size?Array.from(n):null,i}function Nae(i){const e=Q2(i);return zt.und(e.default)&&(e.default=TR(e)),e}function v9(i,e){Nf(i,(t,n)=>t!=null&&e.add(n))}var Uae=["onStart","onRest","onChange","onPause","onResume"];function x9(i,e,t){i.animation[t]=e[t]!==WG(e,t)?jG(e[t],i.key):void 0}function ev(i,e,...t){var n,r,s,o;(r=(n=i.animation)[e])==null||r.call(n,...t),(o=(s=i.defaultProps)[e])==null||o.call(s,...t)}var zae=["onStart","onChange","onRest"],Gae=1,Hae=class{constructor(i,e){this.id=Gae++,this.springs={},this.queue=[],this._lastAsyncId=0,this._active=new Set,this._changed=new Set,this._started=!1,this._state={paused:!1,pauseQueue:new Set,resumeQueue:new Set,timeouts:new Set},this._events={onStart:new Map,onChange:new Map,onRest:new Map},this._onFrame=this._onFrame.bind(this),e&&(this._flush=e),i&&this.start({default:!0,...i})}get idle(){return!this._state.asyncTo&&Object.values(this.springs).every(i=>i.idle&&!i.isDelayed&&!i.isPaused)}get item(){return this._item}set item(i){this._item=i}get(){const i={};return this.each((e,t)=>i[t]=e.get()),i}set(i){for(const e in i){const t=i[e];zt.und(t)||this.springs[e].set(t)}}update(i){return i&&this.queue.push(Q2(i)),this}start(i){let{queue:e}=this;return i?e=fc(i).map(Q2):this.queue=[],this._flush?this._flush(this,e):(iH(this,e),i5(this,e))}stop(i,e){if(i!==!!i&&(e=i),e){const t=this.springs;Oi(fc(e),n=>t[n].stop(!!i))}else H2(this._state,this._lastAsyncId),this.each(t=>t.stop(!!i));return this}pause(i){if(zt.und(i))this.start({pause:!0});else{const e=this.springs;Oi(fc(i),t=>e[t].pause())}return this}resume(i){if(zt.und(i))this.start({pause:!1});else{const e=this.springs;Oi(fc(i),t=>e[t].resume())}return this}each(i){Nf(this.springs,i)}_onFrame(){const{onStart:i,onChange:e,onRest:t}=this._events,n=this._active.size>0,r=this._changed.size>0;(n&&!this._started||r&&!this._started)&&(this._started=!0,i2(i,([a,l])=>{l.value=this.get(),a(l,this,this._item)}));const s=!n&&this._started,o=r||s&&t.size?this.get():null;r&&e.size&&i2(e,([a,l])=>{l.value=o,a(l,this,this._item)}),s&&(this._started=!1,i2(t,([a,l])=>{l.value=o,a(l,this,this._item)}))}eventObserved(i){if(i.type=="change")this._changed.add(i.parent),i.idle||this._active.add(i.parent);else if(i.type=="idle")this._active.delete(i.parent);else return;Xn.onFrame(this._onFrame)}};function i5(i,e){return Promise.all(e.map(t=>ZG(i,t))).then(t=>bR(i,t))}async function ZG(i,e,t){const{keys:n,to:r,from:s,loop:o,onRest:a,onResolve:l}=e,c=zt.obj(e.default)&&e.default;o&&(e.loop=!1),r===!1&&(e.to=null),s===!1&&(e.from=null);const u=zt.arr(r)||zt.fun(r)?r:void 0;u?(e.to=void 0,e.onRest=void 0,c&&(c.onRest=void 0)):Oi(zae,y=>{const g=e[y];if(zt.fun(g)){const A=i._events[y];e[y]=({finished:E,cancelled:x})=>{const w=A.get(g);w?(E||(w.finished=!1),x&&(w.cancelled=!0)):A.set(g,{value:null,finished:E||!1,cancelled:x||!1})},c&&(c[y]=e[y])}});const h=i._state;e.pause===!h.paused?(h.paused=e.pause,Nv(e.pause?h.pauseQueue:h.resumeQueue)):h.paused&&(e.pause=!0);const f=(n||Object.keys(i.springs)).map(y=>i.springs[y].start(e)),d=e.cancel===!0||WG(e,"cancel")===!0;(u||d&&h.asyncId)&&f.push(YG(++i._lastAsyncId,{props:e,state:h,actions:{pause:$M,resume:$M,start(y,g){d?(H2(h,i._lastAsyncId),g(V1(i))):(y.onRest=a,g(XG(u,y,h,i)))}}})),h.paused&&await new Promise(y=>{h.resumeQueue.add(y)});const m=bR(i,await Promise.all(f));if(o&&m.finished&&!(t&&m.noop)){const y=JG(e,o,r);if(y)return iH(i,[y]),ZG(i,y,!0)}return l&&Xn.batchedUpdates(()=>l(m,i,i.item)),m}function E9(i,e){const t={...i.springs};return e&&Oi(fc(e),n=>{zt.und(n.keys)&&(n=Q2(n)),zt.obj(n.to)||(n={...n,to:void 0}),nH(t,n,r=>tH(r))}),eH(i,t),t}function eH(i,e){Nf(e,(t,n)=>{i.springs[n]||(i.springs[n]=t,Sx(t,i))})}function tH(i,e){const t=new Oae;return t.key=i,e&&Sx(t,e),t}function nH(i,e,t){e.keys&&Oi(e.keys,n=>{(i[n]||(i[n]=t(n)))._prepareNode(e)})}function iH(i,e){Oi(e,t=>{nH(i.springs,t,n=>tH(n,i))})}var l4=({children:i,...e})=>{const t=C.useContext(GS),n=e.pause||!!t.pause,r=e.immediate||!!t.immediate;e=gae(()=>({pause:n,immediate:r}),[n,r]);const{Provider:s}=GS;return C.createElement(s,{value:e},i)},GS=Qae(l4,{});l4.Provider=GS.Provider;l4.Consumer=GS.Consumer;function Qae(i,e){return Object.assign(i,C.createContext(e)),i.Provider._context=i,i.Consumer._context=i,i}var Vae=()=>{const i=[],e=function(n){pae();const r=[];return Oi(i,(s,o)=>{if(zt.und(n))r.push(s.start());else{const a=t(n,s,o);a&&r.push(s.start(a))}}),r};e.current=i,e.add=function(n){i.includes(n)||i.push(n)},e.delete=function(n){const r=i.indexOf(n);~r&&i.splice(r,1)},e.pause=function(){return Oi(i,n=>n.pause(...arguments)),this},e.resume=function(){return Oi(i,n=>n.resume(...arguments)),this},e.set=function(n){Oi(i,(r,s)=>{const o=zt.fun(n)?n(s,r):n;o&&r.set(o)})},e.start=function(n){const r=[];return Oi(i,(s,o)=>{if(zt.und(n))r.push(s.start());else{const a=this._getProps(n,s,o);a&&r.push(s.start(a))}}),r},e.stop=function(){return Oi(i,n=>n.stop(...arguments)),this},e.update=function(n){return Oi(i,(r,s)=>r.update(this._getProps(n,r,s))),this};const t=function(n,r,s){return zt.fun(n)?n(s,r):n};return e._getProps=t,e};function jae(i,e,t){const n=zt.fun(e)&&e;n&&!t&&(t=[]);const r=C.useMemo(()=>n||arguments.length==3?Vae():void 0,[]),s=C.useRef(0),o=GG(),a=C.useMemo(()=>({ctrls:[],queue:[],flush(A,E){const x=E9(A,E);return s.current>0&&!a.queue.length&&!Object.keys(x).some(T=>!A.springs[T])?i5(A,E):new Promise(T=>{eH(A,x),a.queue.push(()=>{T(i5(A,E))}),o()})}}),[]),l=C.useRef([...a.ctrls]),c=[],u=c9(i)||0;C.useMemo(()=>{Oi(l.current.slice(i,u),A=>{Rae(A,r),A.stop(!0)}),l.current.length=i,h(u,i)},[i]),C.useMemo(()=>{h(0,Math.min(u,i))},t);function h(A,E){for(let x=A;x<E;x++){const w=l.current[x]||(l.current[x]=new Hae(null,a.flush)),T=n?n(x,w):e[x];T&&(c[x]=Nae(T))}}const f=l.current.map((A,E)=>E9(A,c[E])),d=C.useContext(l4),m=c9(d),y=d!==m&&Mae(d);SR(()=>{s.current++,a.ctrls=l.current;const{queue:A}=a;A.length&&(a.queue=[],Oi(A,E=>E())),Oi(l.current,(E,x)=>{r==null||r.add(E),y&&E.start({default:d});const w=c[x];w&&(Pae(E,w.ref),E.ref?E.queue.push(w):E.start(w))})}),HG(()=>()=>{Oi(a.ctrls,A=>A.stop(!0))});const g=f.map(A=>({...A}));return r?[g,r]:g}function Wae(i,e){const t=zt.fun(i),[[n],r]=jae(1,t?i:[i],t?[]:e);return t||arguments.length==2?[n,r]:n}var Kae=class extends IR{constructor(i,e){super(),this.source=i,this.idle=!0,this._active=new Set,this.calc=O2(...e);const t=this._get(),n=qM(t);wR(this,n.create(t))}advance(i){const e=this._get(),t=this.get();vf(e,t)||(uh(this).setValue(e),this._onChange(e,this.idle)),!this.idle&&_9(this._active)&&jT(this)}_get(){const i=zt.arr(this.source)?this.source.map(sc):fc(sc(this.source));return this.calc(...i)}_start(){this.idle&&!_9(this._active)&&(this.idle=!1,Oi(a4(this),i=>{i.done=!1}),wu.skipAnimation?(Xn.batchedUpdates(()=>this.advance()),jT(this)):i4.start(this))}_attach(){let i=1;Oi(fc(this.source),e=>{fh(e)&&Sx(e,this),e5(e)&&(e.idle||this._active.add(e),i=Math.max(i,e.priority+1))}),this.priority=i,this._start()}_detach(){Oi(fc(this.source),i=>{fh(i)&&US(i,this)}),this._active.clear(),jT(this)}eventObserved(i){i.type=="change"?i.idle?this.advance():(this._active.add(i.parent),this._start()):i.type=="idle"?this._active.delete(i.parent):i.type=="priority"&&(this.priority=fc(this.source).reduce((e,t)=>Math.max(e,(e5(t)?t.priority:0)+1),0))}};function Yae(i){return i.idle!==!1}function _9(i){return!i.size||Array.from(i).every(Yae)}function jT(i){i.idle||(i.idle=!0,Oi(a4(i),e=>{e.done=!0}),NS(i,{type:"idle",parent:i}))}wu.assign({createStringInterpolator:UG,to:(i,e)=>new Kae(i,e)});var $ae=["primitive"].concat(Object.keys(nR).filter(i=>/^[A-Z]/.test(i)).map(i=>i[0].toLowerCase()+i.slice(1)));wu.assign({createStringInterpolator:UG,colors:joe,frameLoop:"demand"});Jw(()=>{Xn.advance()});var Xae=wae($ae,{applyAnimatedValues:Os}),qae=Xae.animated;function Jae({enabled:i=!0,snap:e,global:t,domElement:n,cursor:r=!0,children:s,speed:o=1,rotation:a=[0,0,0],zoom:l=1,polar:c=[0,Math.PI/2],azimuth:u=[-1/0,1/0],config:h={mass:1,tension:170,friction:26}}){const f=Ve(I=>I.events),d=Ve(I=>I.gl),m=n||f.connected||d.domElement,{size:y}=Ve(),g=C.useMemo(()=>[a[0]+c[0],a[0]+c[1]],[a[0],c[0],c[1]]),A=C.useMemo(()=>[a[1]+u[0],a[1]+u[1]],[a[1],u[0],u[1]]),E=C.useMemo(()=>[un.clamp(a[0],...g),un.clamp(a[1],...A),a[2]],[a[0],a[1],a[2],g,A]),[x,w]=Wae(()=>({scale:1,rotation:E,config:h}));C.useEffect(()=>void w.start({scale:1,rotation:E,config:h}),[E]),C.useEffect(()=>{if(t&&r&&i)return m.style.cursor="grab",d.domElement.style.cursor="",()=>{m.style.cursor="default",d.domElement.style.cursor="default"}},[t,r,m,i]);const T=yG({onHover:({last:I})=>{r&&!t&&i&&(m.style.cursor=I?"auto":"grab")},onDrag:({down:I,delta:[M,L],memo:[P,R]=x.rotation.animation.to||E})=>{if(!i)return[L,M];r&&(m.style.cursor=I?"grabbing":"grab"),M=un.clamp(R+M/y.width*Math.PI*o,...A),L=un.clamp(P+L/y.height*Math.PI*o,...g);const U=e&&!I&&typeof e!="boolean"?e:h;return w.start({scale:I&&L>g[1]/2?l:1,rotation:e&&!I?E:[L,M,0],config:k=>k==="scale"?{...U,friction:U.friction*3}:U}),[L,M]}},{target:t?m:void 0});return C.createElement(qae.group,ot({},T==null?void 0:T(),x),s)}const Zae=i=>(e,t,n)=>{const r=n.subscribe;return n.subscribe=((o,a,l)=>{let c=o;if(a){const u=(l==null?void 0:l.equalityFn)||Object.is;let h=o(n.getState());c=f=>{const d=o(f);if(!u(h,d)){const m=h;a(h=d,m)}},l!=null&&l.fireImmediately&&a(h,h)}return r(c)}),i(e,t,n)},ele=Zae,rH=C.createContext(null);function tle({map:i,children:e,onChange:t,domElement:n}){const r=i.map(l=>l.name+l.keys).join("-"),s=C.useMemo(()=>lG(ele(()=>i.reduce((l,c)=>({...l,[c.name]:!1}),{}))),[r]),o=C.useMemo(()=>[s.subscribe,s.getState,s],[r]),a=s.setState;return C.useEffect(()=>{const c=i.map(({name:d,keys:m,up:y})=>({keys:m,up:y,fn:g=>{a({[d]:g}),t&&t(d,g,o[1]())}})).reduce((d,{keys:m,fn:y,up:g=!0})=>(m.forEach(A=>d[A]={fn:y,pressed:!1,up:g}),d),{}),u=({key:d,code:m})=>{const y=c[d]||c[m];if(!y)return;const{fn:g,pressed:A,up:E}=y;y.pressed=!0,(E||!A)&&g(!0)},h=({key:d,code:m})=>{const y=c[d]||c[m];if(!y)return;const{fn:g,up:A}=y;y.pressed=!1,A&&g(!1)},f=n||window;return f.addEventListener("keydown",u,{passive:!0}),f.addEventListener("keyup",h,{passive:!0}),()=>{f.removeEventListener("keydown",u),f.removeEventListener("keyup",h)}},[n,r]),C.createElement(rH.Provider,{value:o,children:e})}function nle(i){const[e,t,n]=C.useContext(rH);return i?n(i):[e,t]}const RA=parseInt(dp.replace(/\D+/g,"")),MR=RA>=125?"uv1":"uv2";var ile=Object.defineProperty,rle=(i,e,t)=>e in i?ile(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,tv=(i,e,t)=>(rle(i,typeof e!="symbol"?e+"":e,t),t);const T1=4,j1=1024,mh=4,sle=(i=1)=>{const e=new Float32Array(j1*mh*i*T1),t=new Sa(e,j1,mh*i,gi,fi);return t.wrapS=_o,t.wrapT=_o,t.magFilter=zn,t.needsUpdate=!0,t},ole=(i,e,t=0)=>{const n=Math.floor(j1*(mh/4));e.arcLengthDivisions=n/2,e.updateArcLengths();const r=e.getSpacedPoints(n),s=e.computeFrenetFrames(n,!0);for(let o=0;o<n;o++){const a=Math.floor(o/j1),l=o%j1;let c=r[o];ME(i,l,c.x,c.y,c.z,0+a+mh*t),c=s.tangents[o],ME(i,l,c.x,c.y,c.z,1+a+mh*t),c=s.normals[o],ME(i,l,c.x,c.y,c.z,2+a+mh*t),c=s.binormals[o],ME(i,l,c.x,c.y,c.z,3+a+mh*t)}i.needsUpdate=!0},ME=(i,e,t,n,r,s)=>{const o=i.image,{data:a}=o,l=T1*j1*s;a[e*T1+l+0]=t,a[e*T1+l+1]=n,a[e*T1+l+2]=r,a[e*T1+l+3]=1},ale=i=>({spineTexture:{value:i},pathOffset:{type:"f",value:0},pathSegment:{type:"f",value:1},spineOffset:{type:"f",value:161},spineLength:{type:"f",value:400},flow:{type:"i",value:1}});function lle(i,e,t=1){i.__ok||(i.__ok=!0,i.onBeforeCompile=n=>{if(n.__modified)return;n.__modified=!0,Object.assign(n.uniforms,e);const r=`
		uniform sampler2D spineTexture;
		uniform float pathOffset;
		uniform float pathSegment;
		uniform float spineOffset;
		uniform float spineLength;
		uniform int flow;

		float textureLayers = ${mh*t}.;
		float textureStacks = ${mh/4}.;

		${n.vertexShader}
		`.replace("#include <beginnormal_vertex>","").replace("#include <defaultnormal_vertex>","").replace("#include <begin_vertex>","").replace(/void\s*main\s*\(\)\s*\{/,`
        void main() {
        #include <beginnormal_vertex>

        vec4 worldPos = modelMatrix * vec4(position, 1.);

        bool bend = flow > 0;
        float xWeight = bend ? 0. : 1.;

        #ifdef USE_INSTANCING
        float pathOffsetFromInstanceMatrix = instanceMatrix[3][2];
        float spineLengthFromInstanceMatrix = instanceMatrix[3][0];
        float spinePortion = bend ? (worldPos.x + spineOffset) / spineLengthFromInstanceMatrix : 0.;
        float mt = (spinePortion * pathSegment + pathOffset + pathOffsetFromInstanceMatrix)*textureStacks;
        #else
        float spinePortion = bend ? (worldPos.x + spineOffset) / spineLength : 0.;
        float mt = (spinePortion * pathSegment + pathOffset)*textureStacks;
        #endif

        mt = mod(mt, textureStacks);
        float rowOffset = floor(mt);

        #ifdef USE_INSTANCING
        rowOffset += instanceMatrix[3][1] * ${mh}.;
        #endif

        vec3 spinePos = texture2D(spineTexture, vec2(mt, (0. + rowOffset + 0.5) / textureLayers)).xyz;
        vec3 a =        texture2D(spineTexture, vec2(mt, (1. + rowOffset + 0.5) / textureLayers)).xyz;
        vec3 b =        texture2D(spineTexture, vec2(mt, (2. + rowOffset + 0.5) / textureLayers)).xyz;
        vec3 c =        texture2D(spineTexture, vec2(mt, (3. + rowOffset + 0.5) / textureLayers)).xyz;
        mat3 basis = mat3(a, b, c);

        vec3 transformed = basis
          * vec3(worldPos.x * xWeight, worldPos.y * 1., worldPos.z * 1.)
          + spinePos;

        vec3 transformedNormal = normalMatrix * (basis * objectNormal);
			`).replace("#include <project_vertex>",`vec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );
				gl_Position = projectionMatrix * mvPosition;`);n.vertexShader=r})}class cle{constructor(e,t=1){tv(this,"curveArray"),tv(this,"curveLengthArray"),tv(this,"object3D"),tv(this,"splineTexure"),tv(this,"uniforms");const n=e.clone(),r=sle(t),s=ale(r);n.traverse(o=>{(o instanceof It||o instanceof ux)&&(o.material=o.material.clone(),lle(o.material,s,t))}),this.curveArray=new Array(t),this.curveLengthArray=new Array(t),this.object3D=n,this.splineTexure=r,this.uniforms=s}updateCurve(e,t){if(e>=this.curveArray.length)throw Error("Index out of range for Flow");const n=t.getLength();this.uniforms.spineLength.value=n,this.curveLengthArray[e]=n,this.curveArray[e]=t,ole(this.splineTexure,t,e)}moveAlongCurve(e){this.uniforms.pathOffset.value+=e}}function ule(i,e=1e-4){e=Math.max(e,Number.EPSILON);const t={},n=i.getIndex(),r=i.getAttribute("position"),s=n?n.count:r.count;let o=0;const a=Object.keys(i.attributes),l={},c={},u=[],h=["getX","getY","getZ","getW"];for(let y=0,g=a.length;y<g;y++){const A=a[y];l[A]=[];const E=i.morphAttributes[A];E&&(c[A]=new Array(E.length).fill(0).map(()=>[]))}const f=Math.log10(1/e),d=Math.pow(10,f);for(let y=0;y<s;y++){const g=n?n.getX(y):y;let A="";for(let E=0,x=a.length;E<x;E++){const w=a[E],T=i.getAttribute(w),I=T.itemSize;for(let M=0;M<I;M++)A+=`${~~(T[h[M]](g)*d)},`}if(A in t)u.push(t[A]);else{for(let E=0,x=a.length;E<x;E++){const w=a[E],T=i.getAttribute(w),I=i.morphAttributes[w],M=T.itemSize,L=l[w],P=c[w];for(let R=0;R<M;R++){const U=h[R];if(L.push(T[U](g)),I)for(let k=0,H=I.length;k<H;k++)P[k].push(I[k][U](g))}}t[A]=o,u.push(o),o++}}const m=i.clone();for(let y=0,g=a.length;y<g;y++){const A=a[y],E=i.getAttribute(A),x=new E.array.constructor(l[A]),w=new mn(x,E.itemSize,E.normalized);if(m.setAttribute(A,w),A in c)for(let T=0;T<c[A].length;T++){const I=i.morphAttributes[A][T],M=new I.array.constructor(c[A][T]),L=new mn(M,I.itemSize,I.normalized);m.morphAttributes[A][T]=L}}return m.setIndex(u),m}function S9(i,e){if(e===IU)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),i;if(e===bS||e===S6){let t=i.getIndex();if(t===null){const o=[],a=i.getAttribute("position");if(a!==void 0){for(let l=0;l<a.count;l++)o.push(l);i.setIndex(o),t=i.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),i}const n=t.count-2,r=[];if(t)if(e===bS)for(let o=1;o<=n;o++)r.push(t.getX(0)),r.push(t.getX(o)),r.push(t.getX(o+1));else for(let o=0;o<n;o++)o%2===0?(r.push(t.getX(o)),r.push(t.getX(o+1)),r.push(t.getX(o+2))):(r.push(t.getX(o+2)),r.push(t.getX(o+1)),r.push(t.getX(o)));r.length/3!==n&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const s=i.clone();return s.setIndex(r),s.clearGroups(),s}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),i}function sH(i,e=Math.PI/3){const t=Math.cos(e),n=(1+1e-10)*100,r=[new Q,new Q,new Q],s=new Q,o=new Q,a=new Q,l=new Q;function c(y){const g=~~(y.x*n),A=~~(y.y*n),E=~~(y.z*n);return`${g},${A},${E}`}const u=i.index?i.toNonIndexed():i,h=u.attributes.position,f={};for(let y=0,g=h.count/3;y<g;y++){const A=3*y,E=r[0].fromBufferAttribute(h,A+0),x=r[1].fromBufferAttribute(h,A+1),w=r[2].fromBufferAttribute(h,A+2);s.subVectors(w,x),o.subVectors(E,x);const T=new Q().crossVectors(s,o).normalize();for(let I=0;I<3;I++){const M=r[I],L=c(M);L in f||(f[L]=[]),f[L].push(T)}}const d=new Float32Array(h.count*3),m=new mn(d,3,!1);for(let y=0,g=h.count/3;y<g;y++){const A=3*y,E=r[0].fromBufferAttribute(h,A+0),x=r[1].fromBufferAttribute(h,A+1),w=r[2].fromBufferAttribute(h,A+2);s.subVectors(w,x),o.subVectors(E,x),a.crossVectors(s,o).normalize();for(let T=0;T<3;T++){const I=r[T],M=c(I),L=f[M];l.set(0,0,0);for(let P=0,R=L.length;P<R;P++){const U=L[P];a.dot(U)>t&&l.add(U)}l.normalize(),m.setXYZ(A+T,l.x,l.y,l.z)}}return u.setAttribute("normal",m),u}var uc=Uint8Array,jd=Uint16Array,r5=Uint32Array,oH=new uc([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),aH=new uc([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),hle=new uc([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),lH=function(i,e){for(var t=new jd(31),n=0;n<31;++n)t[n]=e+=1<<i[n-1];for(var r=new r5(t[30]),n=1;n<30;++n)for(var s=t[n];s<t[n+1];++s)r[s]=s-t[n]<<5|n;return[t,r]},cH=lH(oH,2),uH=cH[0],fle=cH[1];uH[28]=258,fle[258]=28;var dle=lH(aH,0),ple=dle[0],s5=new jd(32768);for(var Cr=0;Cr<32768;++Cr){var Id=(Cr&43690)>>>1|(Cr&21845)<<1;Id=(Id&52428)>>>2|(Id&13107)<<2,Id=(Id&61680)>>>4|(Id&3855)<<4,s5[Cr]=((Id&65280)>>>8|(Id&255)<<8)>>>1}var o2=(function(i,e,t){for(var n=i.length,r=0,s=new jd(e);r<n;++r)++s[i[r]-1];var o=new jd(e);for(r=0;r<e;++r)o[r]=o[r-1]+s[r-1]<<1;var a;if(t){a=new jd(1<<e);var l=15-e;for(r=0;r<n;++r)if(i[r])for(var c=r<<4|i[r],u=e-i[r],h=o[i[r]-1]++<<u,f=h|(1<<u)-1;h<=f;++h)a[s5[h]>>>l]=c}else for(a=new jd(n),r=0;r<n;++r)i[r]&&(a[r]=s5[o[i[r]-1]++]>>>15-i[r]);return a}),Cx=new uc(288);for(var Cr=0;Cr<144;++Cr)Cx[Cr]=8;for(var Cr=144;Cr<256;++Cr)Cx[Cr]=9;for(var Cr=256;Cr<280;++Cr)Cx[Cr]=7;for(var Cr=280;Cr<288;++Cr)Cx[Cr]=8;var hH=new uc(32);for(var Cr=0;Cr<32;++Cr)hH[Cr]=5;var mle=o2(Cx,9,1),gle=o2(hH,5,1),WT=function(i){for(var e=i[0],t=1;t<i.length;++t)i[t]>e&&(e=i[t]);return e},nu=function(i,e,t){var n=e/8|0;return(i[n]|i[n+1]<<8)>>(e&7)&t},KT=function(i,e){var t=e/8|0;return(i[t]|i[t+1]<<8|i[t+2]<<16)>>(e&7)},Ale=function(i){return(i/8|0)+(i&7&&1)},yle=function(i,e,t){(t==null||t>i.length)&&(t=i.length);var n=new(i instanceof jd?jd:i instanceof r5?r5:uc)(t-e);return n.set(i.subarray(e,t)),n},vle=function(i,e,t){var n=i.length;if(!n||t&&!t.l&&n<5)return e||new uc(0);var r=!e||t,s=!t||t.i;t||(t={}),e||(e=new uc(n*3));var o=function(re){var ie=e.length;if(re>ie){var se=new uc(Math.max(ie*2,re));se.set(e),e=se}},a=t.f||0,l=t.p||0,c=t.b||0,u=t.l,h=t.d,f=t.m,d=t.n,m=n*8;do{if(!u){t.f=a=nu(i,l,1);var y=nu(i,l+1,3);if(l+=3,y)if(y==1)u=mle,h=gle,f=9,d=5;else if(y==2){var x=nu(i,l,31)+257,w=nu(i,l+10,15)+4,T=x+nu(i,l+5,31)+1;l+=14;for(var I=new uc(T),M=new uc(19),L=0;L<w;++L)M[hle[L]]=nu(i,l+L*3,7);l+=w*3;for(var P=WT(M),R=(1<<P)-1,U=o2(M,P,1),L=0;L<T;){var k=U[nu(i,l,R)];l+=k&15;var g=k>>>4;if(g<16)I[L++]=g;else{var H=0,G=0;for(g==16?(G=3+nu(i,l,3),l+=2,H=I[L-1]):g==17?(G=3+nu(i,l,7),l+=3):g==18&&(G=11+nu(i,l,127),l+=7);G--;)I[L++]=H}}var X=I.subarray(0,x),Z=I.subarray(x);f=WT(X),d=WT(Z),u=o2(X,f,1),h=o2(Z,d,1)}else throw"invalid block type";else{var g=Ale(l)+4,A=i[g-4]|i[g-3]<<8,E=g+A;if(E>n){if(s)throw"unexpected EOF";break}r&&o(c+A),e.set(i.subarray(g,E),c),t.b=c+=A,t.p=l=E*8;continue}if(l>m){if(s)throw"unexpected EOF";break}}r&&o(c+131072);for(var oe=(1<<f)-1,K=(1<<d)-1,V=l;;V=l){var H=u[KT(i,l)&oe],W=H>>>4;if(l+=H&15,l>m){if(s)throw"unexpected EOF";break}if(!H)throw"invalid length/literal";if(W<256)e[c++]=W;else if(W==256){V=l,u=null;break}else{var F=W-254;if(W>264){var L=W-257,Y=oH[L];F=nu(i,l,(1<<Y)-1)+uH[L],l+=Y}var te=h[KT(i,l)&K],q=te>>>4;if(!te)throw"invalid distance";l+=te&15;var Z=ple[q];if(q>3){var Y=aH[q];Z+=KT(i,l)&(1<<Y)-1,l+=Y}if(l>m){if(s)throw"unexpected EOF";break}r&&o(c+131072);for(var J=c+F;c<J;c+=4)e[c]=e[c-Z],e[c+1]=e[c+1-Z],e[c+2]=e[c+2-Z],e[c+3]=e[c+3-Z];c=J}}t.l=u,t.p=V,t.b=c,u&&(a=1,t.m=f,t.d=h,t.n=d)}while(!a);return c==e.length?e:yle(e,0,c)},xle=new uc(0),Ele=function(i){if((i[0]&15)!=8||i[0]>>>4>7||(i[0]<<8|i[1])%31)throw"invalid zlib data";if(i[1]&32)throw"invalid zlib data: preset dictionaries not supported"};function Uv(i,e){return vle((Ele(i),i.subarray(2,-4)),e)}var _le=typeof TextDecoder<"u"&&new TextDecoder,Sle=0;try{_le.decode(xle,{stream:!0}),Sle=1}catch{}let wle=class extends It{constructor(e,t,n=!1,r=!1,s=1e4){const o=new fn;super(o,t),this.isMarchingCubes=!0;const a=this,l=new Float32Array(36),c=new Float32Array(36),u=new Float32Array(36);this.enableUvs=n,this.enableColors=r,this.init=function(E){this.resolution=E,this.isolation=80,this.size=E,this.size2=this.size*this.size,this.size3=this.size2*this.size,this.halfsize=this.size/2,this.delta=2/this.size,this.yd=this.size,this.zd=this.size2,this.field=new Float32Array(this.size3),this.normal_cache=new Float32Array(this.size3*3),this.palette=new Float32Array(this.size3*3),this.count=0;const x=s*3;this.positionArray=new Float32Array(x*3);const w=new mn(this.positionArray,3);w.setUsage(No),o.setAttribute("position",w),this.normalArray=new Float32Array(x*3);const T=new mn(this.normalArray,3);if(T.setUsage(No),o.setAttribute("normal",T),this.enableUvs){this.uvArray=new Float32Array(x*2);const I=new mn(this.uvArray,2);I.setUsage(No),o.setAttribute("uv",I)}if(this.enableColors){this.colorArray=new Float32Array(x*3);const I=new mn(this.colorArray,3);I.setUsage(No),o.setAttribute("color",I)}o.boundingSphere=new Bi(new Q,1)};function h(E,x,w){return E+(x-E)*w}function f(E,x,w,T,I,M,L,P,R,U){const k=(w-L)/(P-L),H=a.normal_cache;l[x+0]=T+k*a.delta,l[x+1]=I,l[x+2]=M,c[x+0]=h(H[E+0],H[E+3],k),c[x+1]=h(H[E+1],H[E+4],k),c[x+2]=h(H[E+2],H[E+5],k),u[x+0]=h(a.palette[R*3+0],a.palette[U*3+0],k),u[x+1]=h(a.palette[R*3+1],a.palette[U*3+1],k),u[x+2]=h(a.palette[R*3+2],a.palette[U*3+2],k)}function d(E,x,w,T,I,M,L,P,R,U){const k=(w-L)/(P-L),H=a.normal_cache;l[x+0]=T,l[x+1]=I+k*a.delta,l[x+2]=M;const G=E+a.yd*3;c[x+0]=h(H[E+0],H[G+0],k),c[x+1]=h(H[E+1],H[G+1],k),c[x+2]=h(H[E+2],H[G+2],k),u[x+0]=h(a.palette[R*3+0],a.palette[U*3+0],k),u[x+1]=h(a.palette[R*3+1],a.palette[U*3+1],k),u[x+2]=h(a.palette[R*3+2],a.palette[U*3+2],k)}function m(E,x,w,T,I,M,L,P,R,U){const k=(w-L)/(P-L),H=a.normal_cache;l[x+0]=T,l[x+1]=I,l[x+2]=M+k*a.delta;const G=E+a.zd*3;c[x+0]=h(H[E+0],H[G+0],k),c[x+1]=h(H[E+1],H[G+1],k),c[x+2]=h(H[E+2],H[G+2],k),u[x+0]=h(a.palette[R*3+0],a.palette[U*3+0],k),u[x+1]=h(a.palette[R*3+1],a.palette[U*3+1],k),u[x+2]=h(a.palette[R*3+2],a.palette[U*3+2],k)}function y(E){const x=E*3;a.normal_cache[x]===0&&(a.normal_cache[x+0]=a.field[E-1]-a.field[E+1],a.normal_cache[x+1]=a.field[E-a.yd]-a.field[E+a.yd],a.normal_cache[x+2]=a.field[E-a.zd]-a.field[E+a.zd])}function g(E,x,w,T,I){const M=T+1,L=T+a.yd,P=T+a.zd,R=M+a.yd,U=M+a.zd,k=T+a.yd+a.zd,H=M+a.yd+a.zd;let G=0;const X=a.field[T],Z=a.field[M],oe=a.field[L],K=a.field[R],V=a.field[P],W=a.field[U],F=a.field[k],Y=a.field[H];X<I&&(G|=1),Z<I&&(G|=2),oe<I&&(G|=8),K<I&&(G|=4),V<I&&(G|=16),W<I&&(G|=32),F<I&&(G|=128),Y<I&&(G|=64);const te=Cle[G];if(te===0)return 0;const q=a.delta,J=E+q,re=x+q,ie=w+q;te&1&&(y(T),y(M),f(T*3,0,I,E,x,w,X,Z,T,M)),te&2&&(y(M),y(R),d(M*3,3,I,J,x,w,Z,K,M,R)),te&4&&(y(L),y(R),f(L*3,6,I,E,re,w,oe,K,L,R)),te&8&&(y(T),y(L),d(T*3,9,I,E,x,w,X,oe,T,L)),te&16&&(y(P),y(U),f(P*3,12,I,E,x,ie,V,W,P,U)),te&32&&(y(U),y(H),d(U*3,15,I,J,x,ie,W,Y,U,H)),te&64&&(y(k),y(H),f(k*3,18,I,E,re,ie,F,Y,k,H)),te&128&&(y(P),y(k),d(P*3,21,I,E,x,ie,V,F,P,k)),te&256&&(y(T),y(P),m(T*3,24,I,E,x,w,X,V,T,P)),te&512&&(y(M),y(U),m(M*3,27,I,J,x,w,Z,W,M,U)),te&1024&&(y(R),y(H),m(R*3,30,I,J,re,w,K,Y,R,H)),te&2048&&(y(L),y(k),m(L*3,33,I,E,re,w,oe,F,L,k)),G<<=4;let se,ge,xe,pe=0,ue=0;for(;RE[G+ue]!=-1;)se=G+ue,ge=se+1,xe=se+2,A(l,c,u,3*RE[se],3*RE[ge],3*RE[xe]),ue+=3,pe++;return pe}function A(E,x,w,T,I,M){const L=a.count*3;if(a.positionArray[L+0]=E[T],a.positionArray[L+1]=E[T+1],a.positionArray[L+2]=E[T+2],a.positionArray[L+3]=E[I],a.positionArray[L+4]=E[I+1],a.positionArray[L+5]=E[I+2],a.positionArray[L+6]=E[M],a.positionArray[L+7]=E[M+1],a.positionArray[L+8]=E[M+2],a.material.flatShading===!0){const P=(x[T+0]+x[I+0]+x[M+0])/3,R=(x[T+1]+x[I+1]+x[M+1])/3,U=(x[T+2]+x[I+2]+x[M+2])/3;a.normalArray[L+0]=P,a.normalArray[L+1]=R,a.normalArray[L+2]=U,a.normalArray[L+3]=P,a.normalArray[L+4]=R,a.normalArray[L+5]=U,a.normalArray[L+6]=P,a.normalArray[L+7]=R,a.normalArray[L+8]=U}else a.normalArray[L+0]=x[T+0],a.normalArray[L+1]=x[T+1],a.normalArray[L+2]=x[T+2],a.normalArray[L+3]=x[I+0],a.normalArray[L+4]=x[I+1],a.normalArray[L+5]=x[I+2],a.normalArray[L+6]=x[M+0],a.normalArray[L+7]=x[M+1],a.normalArray[L+8]=x[M+2];if(a.enableUvs){const P=a.count*2;a.uvArray[P+0]=E[T+0],a.uvArray[P+1]=E[T+2],a.uvArray[P+2]=E[I+0],a.uvArray[P+3]=E[I+2],a.uvArray[P+4]=E[M+0],a.uvArray[P+5]=E[M+2]}a.enableColors&&(a.colorArray[L+0]=w[T+0],a.colorArray[L+1]=w[T+1],a.colorArray[L+2]=w[T+2],a.colorArray[L+3]=w[I+0],a.colorArray[L+4]=w[I+1],a.colorArray[L+5]=w[I+2],a.colorArray[L+6]=w[M+0],a.colorArray[L+7]=w[M+1],a.colorArray[L+8]=w[M+2]),a.count+=3}this.addBall=function(E,x,w,T,I,M){const L=Math.sign(T);T=Math.abs(T);const P=M!=null;let R=new ut(E,x,w);if(P)try{R=M instanceof ut?M:Array.isArray(M)?new ut(Math.min(Math.abs(M[0]),1),Math.min(Math.abs(M[1]),1),Math.min(Math.abs(M[2]),1)):new ut(M)}catch{R=new ut(E,x,w)}const U=this.size*Math.sqrt(T/I),k=w*this.size,H=x*this.size,G=E*this.size;let X=Math.floor(k-U);X<1&&(X=1);let Z=Math.floor(k+U);Z>this.size-1&&(Z=this.size-1);let oe=Math.floor(H-U);oe<1&&(oe=1);let K=Math.floor(H+U);K>this.size-1&&(K=this.size-1);let V=Math.floor(G-U);V<1&&(V=1);let W=Math.floor(G+U);W>this.size-1&&(W=this.size-1);let F,Y,te,q,J,re,ie,se,ge,xe,pe;for(te=X;te<Z;te++)for(J=this.size2*te,se=te/this.size-w,ge=se*se,Y=oe;Y<K;Y++)for(q=J+this.size*Y,ie=Y/this.size-x,xe=ie*ie,F=V;F<W;F++)if(re=F/this.size-E,pe=T/(1e-6+re*re+xe+ge)-I,pe>0){this.field[q+F]+=pe*L;const ue=Math.sqrt((F-G)*(F-G)+(Y-H)*(Y-H)+(te-k)*(te-k))/U,Me=1-ue*ue*ue*(ue*(ue*6-15)+10);this.palette[(q+F)*3+0]+=R.r*Me,this.palette[(q+F)*3+1]+=R.g*Me,this.palette[(q+F)*3+2]+=R.b*Me}},this.addPlaneX=function(E,x){const w=this.size,T=this.yd,I=this.zd,M=this.field;let L,P,R,U,k,H,G,X=w*Math.sqrt(E/x);for(X>w&&(X=w),L=0;L<X;L++)if(H=L/w,U=H*H,k=E/(1e-4+U)-x,k>0)for(P=0;P<w;P++)for(G=L+P*T,R=0;R<w;R++)M[I*R+G]+=k},this.addPlaneY=function(E,x){const w=this.size,T=this.yd,I=this.zd,M=this.field;let L,P,R,U,k,H,G,X,Z=w*Math.sqrt(E/x);for(Z>w&&(Z=w),P=0;P<Z;P++)if(H=P/w,U=H*H,k=E/(1e-4+U)-x,k>0)for(G=P*T,L=0;L<w;L++)for(X=G+L,R=0;R<w;R++)M[I*R+X]+=k},this.addPlaneZ=function(E,x){const w=this.size,T=this.yd,I=this.zd,M=this.field;let L,P,R,U,k,H,G,X,Z=w*Math.sqrt(E/x);for(Z>w&&(Z=w),R=0;R<Z;R++)if(H=R/w,U=H*H,k=E/(1e-4+U)-x,k>0)for(G=I*R,P=0;P<w;P++)for(X=G+P*T,L=0;L<w;L++)M[X+L]+=k},this.setCell=function(E,x,w,T){const I=this.size2*w+this.size*x+E;this.field[I]=T},this.getCell=function(E,x,w){const T=this.size2*w+this.size*x+E;return this.field[T]},this.blur=function(E=1){const x=this.field,w=x.slice(),T=this.size,I=this.size2;for(let M=0;M<T;M++)for(let L=0;L<T;L++)for(let P=0;P<T;P++){const R=I*P+T*L+M;let U=w[R],k=1;for(let H=-1;H<=1;H+=2){const G=H+M;if(!(G<0||G>=T))for(let X=-1;X<=1;X+=2){const Z=X+L;if(!(Z<0||Z>=T))for(let oe=-1;oe<=1;oe+=2){const K=oe+P;if(K<0||K>=T)continue;const V=I*K+T*Z+G,W=w[V];k++,U+=E*(W-U)/k}}}x[R]=U}},this.reset=function(){for(let E=0;E<this.size3;E++)this.normal_cache[E*3]=0,this.field[E]=0,this.palette[E*3]=this.palette[E*3+1]=this.palette[E*3+2]=0},this.update=function(){this.count=0;const E=this.size-2;for(let x=1;x<E;x++){const w=this.size2*x,T=(x-this.halfsize)/this.halfsize;for(let I=1;I<E;I++){const M=w+this.size*I,L=(I-this.halfsize)/this.halfsize;for(let P=1;P<E;P++){const R=(P-this.halfsize)/this.halfsize,U=M+P;g(R,L,T,U,this.isolation)}}}this.geometry.setDrawRange(0,this.count),o.getAttribute("position").needsUpdate=!0,o.getAttribute("normal").needsUpdate=!0,this.enableUvs&&(o.getAttribute("uv").needsUpdate=!0),this.enableColors&&(o.getAttribute("color").needsUpdate=!0),this.count/3>s&&console.warn("THREE.MarchingCubes: Geometry buffers too small for rendering. Please create an instance with a higher poly count.")},this.init(e)}};const Cle=new Int32Array([0,265,515,778,1030,1295,1541,1804,2060,2309,2575,2822,3082,3331,3593,3840,400,153,915,666,1430,1183,1941,1692,2460,2197,2975,2710,3482,3219,3993,3728,560,825,51,314,1590,1855,1077,1340,2620,2869,2111,2358,3642,3891,3129,3376,928,681,419,170,1958,1711,1445,1196,2988,2725,2479,2214,4010,3747,3497,3232,1120,1385,1635,1898,102,367,613,876,3180,3429,3695,3942,2154,2403,2665,2912,1520,1273,2035,1786,502,255,1013,764,3580,3317,4095,3830,2554,2291,3065,2800,1616,1881,1107,1370,598,863,85,348,3676,3925,3167,3414,2650,2899,2137,2384,1984,1737,1475,1226,966,719,453,204,4044,3781,3535,3270,3018,2755,2505,2240,2240,2505,2755,3018,3270,3535,3781,4044,204,453,719,966,1226,1475,1737,1984,2384,2137,2899,2650,3414,3167,3925,3676,348,85,863,598,1370,1107,1881,1616,2800,3065,2291,2554,3830,4095,3317,3580,764,1013,255,502,1786,2035,1273,1520,2912,2665,2403,2154,3942,3695,3429,3180,876,613,367,102,1898,1635,1385,1120,3232,3497,3747,4010,2214,2479,2725,2988,1196,1445,1711,1958,170,419,681,928,3376,3129,3891,3642,2358,2111,2869,2620,1340,1077,1855,1590,314,51,825,560,3728,3993,3219,3482,2710,2975,2197,2460,1692,1941,1183,1430,666,915,153,400,3840,3593,3331,3082,2822,2575,2309,2060,1804,1541,1295,1030,778,515,265,0]),RE=new Int32Array([-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,9,8,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,2,10,0,2,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,8,3,2,10,8,10,9,8,-1,-1,-1,-1,-1,-1,-1,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,8,11,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,11,2,1,9,11,9,8,11,-1,-1,-1,-1,-1,-1,-1,3,10,1,11,10,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,10,1,0,8,10,8,11,10,-1,-1,-1,-1,-1,-1,-1,3,9,0,3,11,9,11,10,9,-1,-1,-1,-1,-1,-1,-1,9,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,7,3,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,1,9,4,7,1,7,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,4,7,3,0,4,1,2,10,-1,-1,-1,-1,-1,-1,-1,9,2,10,9,0,2,8,4,7,-1,-1,-1,-1,-1,-1,-1,2,10,9,2,9,7,2,7,3,7,9,4,-1,-1,-1,-1,8,4,7,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,4,7,11,2,4,2,0,4,-1,-1,-1,-1,-1,-1,-1,9,0,1,8,4,7,2,3,11,-1,-1,-1,-1,-1,-1,-1,4,7,11,9,4,11,9,11,2,9,2,1,-1,-1,-1,-1,3,10,1,3,11,10,7,8,4,-1,-1,-1,-1,-1,-1,-1,1,11,10,1,4,11,1,0,4,7,11,4,-1,-1,-1,-1,4,7,8,9,0,11,9,11,10,11,0,3,-1,-1,-1,-1,4,7,11,4,11,9,9,11,10,-1,-1,-1,-1,-1,-1,-1,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,5,4,1,5,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,5,4,8,3,5,3,1,5,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,10,4,9,5,-1,-1,-1,-1,-1,-1,-1,5,2,10,5,4,2,4,0,2,-1,-1,-1,-1,-1,-1,-1,2,10,5,3,2,5,3,5,4,3,4,8,-1,-1,-1,-1,9,5,4,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,0,8,11,4,9,5,-1,-1,-1,-1,-1,-1,-1,0,5,4,0,1,5,2,3,11,-1,-1,-1,-1,-1,-1,-1,2,1,5,2,5,8,2,8,11,4,8,5,-1,-1,-1,-1,10,3,11,10,1,3,9,5,4,-1,-1,-1,-1,-1,-1,-1,4,9,5,0,8,1,8,10,1,8,11,10,-1,-1,-1,-1,5,4,0,5,0,11,5,11,10,11,0,3,-1,-1,-1,-1,5,4,8,5,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,9,7,8,5,7,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,3,0,9,5,3,5,7,3,-1,-1,-1,-1,-1,-1,-1,0,7,8,0,1,7,1,5,7,-1,-1,-1,-1,-1,-1,-1,1,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,7,8,9,5,7,10,1,2,-1,-1,-1,-1,-1,-1,-1,10,1,2,9,5,0,5,3,0,5,7,3,-1,-1,-1,-1,8,0,2,8,2,5,8,5,7,10,5,2,-1,-1,-1,-1,2,10,5,2,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,7,9,5,7,8,9,3,11,2,-1,-1,-1,-1,-1,-1,-1,9,5,7,9,7,2,9,2,0,2,7,11,-1,-1,-1,-1,2,3,11,0,1,8,1,7,8,1,5,7,-1,-1,-1,-1,11,2,1,11,1,7,7,1,5,-1,-1,-1,-1,-1,-1,-1,9,5,8,8,5,7,10,1,3,10,3,11,-1,-1,-1,-1,5,7,0,5,0,9,7,11,0,1,0,10,11,10,0,-1,11,10,0,11,0,3,10,5,0,8,0,7,5,7,0,-1,11,10,5,7,11,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,0,1,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,1,9,8,5,10,6,-1,-1,-1,-1,-1,-1,-1,1,6,5,2,6,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,6,5,1,2,6,3,0,8,-1,-1,-1,-1,-1,-1,-1,9,6,5,9,0,6,0,2,6,-1,-1,-1,-1,-1,-1,-1,5,9,8,5,8,2,5,2,6,3,2,8,-1,-1,-1,-1,2,3,11,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,0,8,11,2,0,10,6,5,-1,-1,-1,-1,-1,-1,-1,0,1,9,2,3,11,5,10,6,-1,-1,-1,-1,-1,-1,-1,5,10,6,1,9,2,9,11,2,9,8,11,-1,-1,-1,-1,6,3,11,6,5,3,5,1,3,-1,-1,-1,-1,-1,-1,-1,0,8,11,0,11,5,0,5,1,5,11,6,-1,-1,-1,-1,3,11,6,0,3,6,0,6,5,0,5,9,-1,-1,-1,-1,6,5,9,6,9,11,11,9,8,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,4,7,3,6,5,10,-1,-1,-1,-1,-1,-1,-1,1,9,0,5,10,6,8,4,7,-1,-1,-1,-1,-1,-1,-1,10,6,5,1,9,7,1,7,3,7,9,4,-1,-1,-1,-1,6,1,2,6,5,1,4,7,8,-1,-1,-1,-1,-1,-1,-1,1,2,5,5,2,6,3,0,4,3,4,7,-1,-1,-1,-1,8,4,7,9,0,5,0,6,5,0,2,6,-1,-1,-1,-1,7,3,9,7,9,4,3,2,9,5,9,6,2,6,9,-1,3,11,2,7,8,4,10,6,5,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,2,4,2,0,2,7,11,-1,-1,-1,-1,0,1,9,4,7,8,2,3,11,5,10,6,-1,-1,-1,-1,9,2,1,9,11,2,9,4,11,7,11,4,5,10,6,-1,8,4,7,3,11,5,3,5,1,5,11,6,-1,-1,-1,-1,5,1,11,5,11,6,1,0,11,7,11,4,0,4,11,-1,0,5,9,0,6,5,0,3,6,11,6,3,8,4,7,-1,6,5,9,6,9,11,4,7,9,7,11,9,-1,-1,-1,-1,10,4,9,6,4,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,10,6,4,9,10,0,8,3,-1,-1,-1,-1,-1,-1,-1,10,0,1,10,6,0,6,4,0,-1,-1,-1,-1,-1,-1,-1,8,3,1,8,1,6,8,6,4,6,1,10,-1,-1,-1,-1,1,4,9,1,2,4,2,6,4,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,9,2,4,9,2,6,4,-1,-1,-1,-1,0,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,2,8,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,10,4,9,10,6,4,11,2,3,-1,-1,-1,-1,-1,-1,-1,0,8,2,2,8,11,4,9,10,4,10,6,-1,-1,-1,-1,3,11,2,0,1,6,0,6,4,6,1,10,-1,-1,-1,-1,6,4,1,6,1,10,4,8,1,2,1,11,8,11,1,-1,9,6,4,9,3,6,9,1,3,11,6,3,-1,-1,-1,-1,8,11,1,8,1,0,11,6,1,9,1,4,6,4,1,-1,3,11,6,3,6,0,0,6,4,-1,-1,-1,-1,-1,-1,-1,6,4,8,11,6,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,10,6,7,8,10,8,9,10,-1,-1,-1,-1,-1,-1,-1,0,7,3,0,10,7,0,9,10,6,7,10,-1,-1,-1,-1,10,6,7,1,10,7,1,7,8,1,8,0,-1,-1,-1,-1,10,6,7,10,7,1,1,7,3,-1,-1,-1,-1,-1,-1,-1,1,2,6,1,6,8,1,8,9,8,6,7,-1,-1,-1,-1,2,6,9,2,9,1,6,7,9,0,9,3,7,3,9,-1,7,8,0,7,0,6,6,0,2,-1,-1,-1,-1,-1,-1,-1,7,3,2,6,7,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,11,10,6,8,10,8,9,8,6,7,-1,-1,-1,-1,2,0,7,2,7,11,0,9,7,6,7,10,9,10,7,-1,1,8,0,1,7,8,1,10,7,6,7,10,2,3,11,-1,11,2,1,11,1,7,10,6,1,6,7,1,-1,-1,-1,-1,8,9,6,8,6,7,9,1,6,11,6,3,1,3,6,-1,0,9,1,11,6,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,8,0,7,0,6,3,11,0,11,6,0,-1,-1,-1,-1,7,11,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,1,9,8,3,1,11,7,6,-1,-1,-1,-1,-1,-1,-1,10,1,2,6,11,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,8,6,11,7,-1,-1,-1,-1,-1,-1,-1,2,9,0,2,10,9,6,11,7,-1,-1,-1,-1,-1,-1,-1,6,11,7,2,10,3,10,8,3,10,9,8,-1,-1,-1,-1,7,2,3,6,2,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,0,8,7,6,0,6,2,0,-1,-1,-1,-1,-1,-1,-1,2,7,6,2,3,7,0,1,9,-1,-1,-1,-1,-1,-1,-1,1,6,2,1,8,6,1,9,8,8,7,6,-1,-1,-1,-1,10,7,6,10,1,7,1,3,7,-1,-1,-1,-1,-1,-1,-1,10,7,6,1,7,10,1,8,7,1,0,8,-1,-1,-1,-1,0,3,7,0,7,10,0,10,9,6,10,7,-1,-1,-1,-1,7,6,10,7,10,8,8,10,9,-1,-1,-1,-1,-1,-1,-1,6,8,4,11,8,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,6,11,3,0,6,0,4,6,-1,-1,-1,-1,-1,-1,-1,8,6,11,8,4,6,9,0,1,-1,-1,-1,-1,-1,-1,-1,9,4,6,9,6,3,9,3,1,11,3,6,-1,-1,-1,-1,6,8,4,6,11,8,2,10,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,11,0,6,11,0,4,6,-1,-1,-1,-1,4,11,8,4,6,11,0,2,9,2,10,9,-1,-1,-1,-1,10,9,3,10,3,2,9,4,3,11,3,6,4,6,3,-1,8,2,3,8,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,0,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,4,2,4,6,4,3,8,-1,-1,-1,-1,1,9,4,1,4,2,2,4,6,-1,-1,-1,-1,-1,-1,-1,8,1,3,8,6,1,8,4,6,6,10,1,-1,-1,-1,-1,10,1,0,10,0,6,6,0,4,-1,-1,-1,-1,-1,-1,-1,4,6,3,4,3,8,6,10,3,0,3,9,10,9,3,-1,10,9,4,6,10,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,5,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,5,11,7,6,-1,-1,-1,-1,-1,-1,-1,5,0,1,5,4,0,7,6,11,-1,-1,-1,-1,-1,-1,-1,11,7,6,8,3,4,3,5,4,3,1,5,-1,-1,-1,-1,9,5,4,10,1,2,7,6,11,-1,-1,-1,-1,-1,-1,-1,6,11,7,1,2,10,0,8,3,4,9,5,-1,-1,-1,-1,7,6,11,5,4,10,4,2,10,4,0,2,-1,-1,-1,-1,3,4,8,3,5,4,3,2,5,10,5,2,11,7,6,-1,7,2,3,7,6,2,5,4,9,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,6,0,6,2,6,8,7,-1,-1,-1,-1,3,6,2,3,7,6,1,5,0,5,4,0,-1,-1,-1,-1,6,2,8,6,8,7,2,1,8,4,8,5,1,5,8,-1,9,5,4,10,1,6,1,7,6,1,3,7,-1,-1,-1,-1,1,6,10,1,7,6,1,0,7,8,7,0,9,5,4,-1,4,0,10,4,10,5,0,3,10,6,10,7,3,7,10,-1,7,6,10,7,10,8,5,4,10,4,8,10,-1,-1,-1,-1,6,9,5,6,11,9,11,8,9,-1,-1,-1,-1,-1,-1,-1,3,6,11,0,6,3,0,5,6,0,9,5,-1,-1,-1,-1,0,11,8,0,5,11,0,1,5,5,6,11,-1,-1,-1,-1,6,11,3,6,3,5,5,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,11,9,11,8,11,5,6,-1,-1,-1,-1,0,11,3,0,6,11,0,9,6,5,6,9,1,2,10,-1,11,8,5,11,5,6,8,0,5,10,5,2,0,2,5,-1,6,11,3,6,3,5,2,10,3,10,5,3,-1,-1,-1,-1,5,8,9,5,2,8,5,6,2,3,8,2,-1,-1,-1,-1,9,5,6,9,6,0,0,6,2,-1,-1,-1,-1,-1,-1,-1,1,5,8,1,8,0,5,6,8,3,8,2,6,2,8,-1,1,5,6,2,1,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,6,1,6,10,3,8,6,5,6,9,8,9,6,-1,10,1,0,10,0,6,9,5,0,5,6,0,-1,-1,-1,-1,0,3,8,5,6,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,5,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,7,5,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,11,7,5,8,3,0,-1,-1,-1,-1,-1,-1,-1,5,11,7,5,10,11,1,9,0,-1,-1,-1,-1,-1,-1,-1,10,7,5,10,11,7,9,8,1,8,3,1,-1,-1,-1,-1,11,1,2,11,7,1,7,5,1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,7,1,7,5,7,2,11,-1,-1,-1,-1,9,7,5,9,2,7,9,0,2,2,11,7,-1,-1,-1,-1,7,5,2,7,2,11,5,9,2,3,2,8,9,8,2,-1,2,5,10,2,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,8,2,0,8,5,2,8,7,5,10,2,5,-1,-1,-1,-1,9,0,1,5,10,3,5,3,7,3,10,2,-1,-1,-1,-1,9,8,2,9,2,1,8,7,2,10,2,5,7,5,2,-1,1,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,7,0,7,1,1,7,5,-1,-1,-1,-1,-1,-1,-1,9,0,3,9,3,5,5,3,7,-1,-1,-1,-1,-1,-1,-1,9,8,7,5,9,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,8,4,5,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,5,0,4,5,11,0,5,10,11,11,3,0,-1,-1,-1,-1,0,1,9,8,4,10,8,10,11,10,4,5,-1,-1,-1,-1,10,11,4,10,4,5,11,3,4,9,4,1,3,1,4,-1,2,5,1,2,8,5,2,11,8,4,5,8,-1,-1,-1,-1,0,4,11,0,11,3,4,5,11,2,11,1,5,1,11,-1,0,2,5,0,5,9,2,11,5,4,5,8,11,8,5,-1,9,4,5,2,11,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,5,10,3,5,2,3,4,5,3,8,4,-1,-1,-1,-1,5,10,2,5,2,4,4,2,0,-1,-1,-1,-1,-1,-1,-1,3,10,2,3,5,10,3,8,5,4,5,8,0,1,9,-1,5,10,2,5,2,4,1,9,2,9,4,2,-1,-1,-1,-1,8,4,5,8,5,3,3,5,1,-1,-1,-1,-1,-1,-1,-1,0,4,5,1,0,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,4,5,8,5,3,9,0,5,0,3,5,-1,-1,-1,-1,9,4,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,11,7,4,9,11,9,10,11,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,7,9,11,7,9,10,11,-1,-1,-1,-1,1,10,11,1,11,4,1,4,0,7,4,11,-1,-1,-1,-1,3,1,4,3,4,8,1,10,4,7,4,11,10,11,4,-1,4,11,7,9,11,4,9,2,11,9,1,2,-1,-1,-1,-1,9,7,4,9,11,7,9,1,11,2,11,1,0,8,3,-1,11,7,4,11,4,2,2,4,0,-1,-1,-1,-1,-1,-1,-1,11,7,4,11,4,2,8,3,4,3,2,4,-1,-1,-1,-1,2,9,10,2,7,9,2,3,7,7,4,9,-1,-1,-1,-1,9,10,7,9,7,4,10,2,7,8,7,0,2,0,7,-1,3,7,10,3,10,2,7,4,10,1,10,0,4,0,10,-1,1,10,2,8,7,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,7,1,3,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,0,8,1,8,7,1,-1,-1,-1,-1,4,0,3,7,4,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,8,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,11,9,10,-1,-1,-1,-1,-1,-1,-1,0,1,10,0,10,8,8,10,11,-1,-1,-1,-1,-1,-1,-1,3,1,10,11,3,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,11,1,11,9,9,11,8,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,1,2,9,2,11,9,-1,-1,-1,-1,0,2,11,8,0,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,2,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,10,8,9,-1,-1,-1,-1,-1,-1,-1,9,10,2,0,9,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,0,1,8,1,10,8,-1,-1,-1,-1,1,10,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,8,9,1,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,9,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,3,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1]);var Tle=Object.defineProperty,ble=(i,e,t)=>e in i?Tle(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,iu=(i,e,t)=>(ble(i,typeof e!="symbol"?e+"":e,t),t);class YT{constructor(e=Math){iu(this,"grad3",[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]]),iu(this,"grad4",[[0,1,1,1],[0,1,1,-1],[0,1,-1,1],[0,1,-1,-1],[0,-1,1,1],[0,-1,1,-1],[0,-1,-1,1],[0,-1,-1,-1],[1,0,1,1],[1,0,1,-1],[1,0,-1,1],[1,0,-1,-1],[-1,0,1,1],[-1,0,1,-1],[-1,0,-1,1],[-1,0,-1,-1],[1,1,0,1],[1,1,0,-1],[1,-1,0,1],[1,-1,0,-1],[-1,1,0,1],[-1,1,0,-1],[-1,-1,0,1],[-1,-1,0,-1],[1,1,1,0],[1,1,-1,0],[1,-1,1,0],[1,-1,-1,0],[-1,1,1,0],[-1,1,-1,0],[-1,-1,1,0],[-1,-1,-1,0]]),iu(this,"p",[]),iu(this,"perm",[]),iu(this,"simplex",[[0,1,2,3],[0,1,3,2],[0,0,0,0],[0,2,3,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,3,0],[0,2,1,3],[0,0,0,0],[0,3,1,2],[0,3,2,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,3,2,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,0,3],[0,0,0,0],[1,3,0,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,3,0,1],[2,3,1,0],[1,0,2,3],[1,0,3,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,3,1],[0,0,0,0],[2,1,3,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,1,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,0,1,2],[3,0,2,1],[0,0,0,0],[3,1,2,0],[2,1,0,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,1,0,2],[0,0,0,0],[3,2,0,1],[3,2,1,0]]),iu(this,"dot",(t,n,r)=>t[0]*n+t[1]*r),iu(this,"dot3",(t,n,r,s)=>t[0]*n+t[1]*r+t[2]*s),iu(this,"dot4",(t,n,r,s,o)=>t[0]*n+t[1]*r+t[2]*s+t[3]*o),iu(this,"noise",(t,n)=>{let r,s,o;const a=.5*(Math.sqrt(3)-1),l=(t+n)*a,c=Math.floor(t+l),u=Math.floor(n+l),h=(3-Math.sqrt(3))/6,f=(c+u)*h,d=c-f,m=u-f,y=t-d,g=n-m;let A=0,E=1;y>g&&(A=1,E=0);const x=y-A+h,w=g-E+h,T=y-1+2*h,I=g-1+2*h,M=c&255,L=u&255,P=this.perm[M+this.perm[L]]%12,R=this.perm[M+A+this.perm[L+E]]%12,U=this.perm[M+1+this.perm[L+1]]%12;let k=.5-y*y-g*g;k<0?r=0:(k*=k,r=k*k*this.dot(this.grad3[P],y,g));let H=.5-x*x-w*w;H<0?s=0:(H*=H,s=H*H*this.dot(this.grad3[R],x,w));let G=.5-T*T-I*I;return G<0?o=0:(G*=G,o=G*G*this.dot(this.grad3[U],T,I)),70*(r+s+o)}),iu(this,"noise3d",(t,n,r)=>{let s,o,a,l;const u=(t+n+r)*.3333333333333333,h=Math.floor(t+u),f=Math.floor(n+u),d=Math.floor(r+u),m=1/6,y=(h+f+d)*m,g=h-y,A=f-y,E=d-y,x=t-g,w=n-A,T=r-E;let I,M,L,P,R,U;x>=w?w>=T?(I=1,M=0,L=0,P=1,R=1,U=0):x>=T?(I=1,M=0,L=0,P=1,R=0,U=1):(I=0,M=0,L=1,P=1,R=0,U=1):w<T?(I=0,M=0,L=1,P=0,R=1,U=1):x<T?(I=0,M=1,L=0,P=0,R=1,U=1):(I=0,M=1,L=0,P=1,R=1,U=0);const k=x-I+m,H=w-M+m,G=T-L+m,X=x-P+2*m,Z=w-R+2*m,oe=T-U+2*m,K=x-1+3*m,V=w-1+3*m,W=T-1+3*m,F=h&255,Y=f&255,te=d&255,q=this.perm[F+this.perm[Y+this.perm[te]]]%12,J=this.perm[F+I+this.perm[Y+M+this.perm[te+L]]]%12,re=this.perm[F+P+this.perm[Y+R+this.perm[te+U]]]%12,ie=this.perm[F+1+this.perm[Y+1+this.perm[te+1]]]%12;let se=.6-x*x-w*w-T*T;se<0?s=0:(se*=se,s=se*se*this.dot3(this.grad3[q],x,w,T));let ge=.6-k*k-H*H-G*G;ge<0?o=0:(ge*=ge,o=ge*ge*this.dot3(this.grad3[J],k,H,G));let xe=.6-X*X-Z*Z-oe*oe;xe<0?a=0:(xe*=xe,a=xe*xe*this.dot3(this.grad3[re],X,Z,oe));let pe=.6-K*K-V*V-W*W;return pe<0?l=0:(pe*=pe,l=pe*pe*this.dot3(this.grad3[ie],K,V,W)),32*(s+o+a+l)}),iu(this,"noise4d",(t,n,r,s)=>{const o=this.grad4,a=this.simplex,l=this.perm,c=(Math.sqrt(5)-1)/4,u=(5-Math.sqrt(5))/20;let h,f,d,m,y;const g=(t+n+r+s)*c,A=Math.floor(t+g),E=Math.floor(n+g),x=Math.floor(r+g),w=Math.floor(s+g),T=(A+E+x+w)*u,I=A-T,M=E-T,L=x-T,P=w-T,R=t-I,U=n-M,k=r-L,H=s-P,G=R>U?32:0,X=R>k?16:0,Z=U>k?8:0,oe=R>H?4:0,K=U>H?2:0,V=k>H?1:0,W=G+X+Z+oe+K+V;let F,Y,te,q,J,re,ie,se,ge,xe,pe,ue;F=a[W][0]>=3?1:0,Y=a[W][1]>=3?1:0,te=a[W][2]>=3?1:0,q=a[W][3]>=3?1:0,J=a[W][0]>=2?1:0,re=a[W][1]>=2?1:0,ie=a[W][2]>=2?1:0,se=a[W][3]>=2?1:0,ge=a[W][0]>=1?1:0,xe=a[W][1]>=1?1:0,pe=a[W][2]>=1?1:0,ue=a[W][3]>=1?1:0;const Me=R-F+u,Se=U-Y+u,ve=k-te+u,Ae=H-q+u,ke=R-J+2*u,be=U-re+2*u,ne=k-ie+2*u,j=H-se+2*u,de=R-ge+3*u,Re=U-xe+3*u,Le=k-pe+3*u,Fe=H-ue+3*u,He=R-1+4*u,it=U-1+4*u,Ye=k-1+4*u,ct=H-1+4*u,pt=A&255,je=E&255,Mt=x&255,Ft=w&255,St=l[pt+l[je+l[Mt+l[Ft]]]]%32,gt=l[pt+F+l[je+Y+l[Mt+te+l[Ft+q]]]]%32,ft=l[pt+J+l[je+re+l[Mt+ie+l[Ft+se]]]]%32,Ce=l[pt+ge+l[je+xe+l[Mt+pe+l[Ft+ue]]]]%32,qe=l[pt+1+l[je+1+l[Mt+1+l[Ft+1]]]]%32;let At=.6-R*R-U*U-k*k-H*H;At<0?h=0:(At*=At,h=At*At*this.dot4(o[St],R,U,k,H));let yt=.6-Me*Me-Se*Se-ve*ve-Ae*Ae;yt<0?f=0:(yt*=yt,f=yt*yt*this.dot4(o[gt],Me,Se,ve,Ae));let Be=.6-ke*ke-be*be-ne*ne-j*j;Be<0?d=0:(Be*=Be,d=Be*Be*this.dot4(o[ft],ke,be,ne,j));let we=.6-de*de-Re*Re-Le*Le-Fe*Fe;we<0?m=0:(we*=we,m=we*we*this.dot4(o[Ce],de,Re,Le,Fe));let _t=.6-He*He-it*it-Ye*Ye-ct*ct;return _t<0?y=0:(_t*=_t,y=_t*_t*this.dot4(o[qe],He,it,Ye,ct)),27*(h+f+d+m+y)});for(let t=0;t<256;t++)this.p[t]=Math.floor(e.random()*256);for(let t=0;t<512;t++)this.perm[t]=this.p[t&255]}}var Ile=Object.defineProperty,Mle=(i,e,t)=>e in i?Ile(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,w9=(i,e,t)=>(Mle(i,typeof e!="symbol"?e+"":e,t),t);const Rle=(()=>{const i={uniforms:{turbidity:{value:2},rayleigh:{value:1},mieCoefficient:{value:.005},mieDirectionalG:{value:.8},sunPosition:{value:new Q},up:{value:new Q(0,1,0)}},vertexShader:`
      uniform vec3 sunPosition;
      uniform float rayleigh;
      uniform float turbidity;
      uniform float mieCoefficient;
      uniform vec3 up;

      varying vec3 vWorldPosition;
      varying vec3 vSunDirection;
      varying float vSunfade;
      varying vec3 vBetaR;
      varying vec3 vBetaM;
      varying float vSunE;

      // constants for atmospheric scattering
      const float e = 2.71828182845904523536028747135266249775724709369995957;
      const float pi = 3.141592653589793238462643383279502884197169;

      // wavelength of used primaries, according to preetham
      const vec3 lambda = vec3( 680E-9, 550E-9, 450E-9 );
      // this pre-calcuation replaces older TotalRayleigh(vec3 lambda) function:
      // (8.0 * pow(pi, 3.0) * pow(pow(n, 2.0) - 1.0, 2.0) * (6.0 + 3.0 * pn)) / (3.0 * N * pow(lambda, vec3(4.0)) * (6.0 - 7.0 * pn))
      const vec3 totalRayleigh = vec3( 5.804542996261093E-6, 1.3562911419845635E-5, 3.0265902468824876E-5 );

      // mie stuff
      // K coefficient for the primaries
      const float v = 4.0;
      const vec3 K = vec3( 0.686, 0.678, 0.666 );
      // MieConst = pi * pow( ( 2.0 * pi ) / lambda, vec3( v - 2.0 ) ) * K
      const vec3 MieConst = vec3( 1.8399918514433978E14, 2.7798023919660528E14, 4.0790479543861094E14 );

      // earth shadow hack
      // cutoffAngle = pi / 1.95;
      const float cutoffAngle = 1.6110731556870734;
      const float steepness = 1.5;
      const float EE = 1000.0;

      float sunIntensity( float zenithAngleCos ) {
        zenithAngleCos = clamp( zenithAngleCos, -1.0, 1.0 );
        return EE * max( 0.0, 1.0 - pow( e, -( ( cutoffAngle - acos( zenithAngleCos ) ) / steepness ) ) );
      }

      vec3 totalMie( float T ) {
        float c = ( 0.2 * T ) * 10E-18;
        return 0.434 * c * MieConst;
      }

      void main() {

        vec4 worldPosition = modelMatrix * vec4( position, 1.0 );
        vWorldPosition = worldPosition.xyz;

        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        gl_Position.z = gl_Position.w; // set z to camera.far

        vSunDirection = normalize( sunPosition );

        vSunE = sunIntensity( dot( vSunDirection, up ) );

        vSunfade = 1.0 - clamp( 1.0 - exp( ( sunPosition.y / 450000.0 ) ), 0.0, 1.0 );

        float rayleighCoefficient = rayleigh - ( 1.0 * ( 1.0 - vSunfade ) );

      // extinction (absorbtion + out scattering)
      // rayleigh coefficients
        vBetaR = totalRayleigh * rayleighCoefficient;

      // mie coefficients
        vBetaM = totalMie( turbidity ) * mieCoefficient;

      }
    `,fragmentShader:`
      varying vec3 vWorldPosition;
      varying vec3 vSunDirection;
      varying float vSunfade;
      varying vec3 vBetaR;
      varying vec3 vBetaM;
      varying float vSunE;

      uniform float mieDirectionalG;
      uniform vec3 up;

      const vec3 cameraPos = vec3( 0.0, 0.0, 0.0 );

      // constants for atmospheric scattering
      const float pi = 3.141592653589793238462643383279502884197169;

      const float n = 1.0003; // refractive index of air
      const float N = 2.545E25; // number of molecules per unit volume for air at 288.15K and 1013mb (sea level -45 celsius)

      // optical length at zenith for molecules
      const float rayleighZenithLength = 8.4E3;
      const float mieZenithLength = 1.25E3;
      // 66 arc seconds -> degrees, and the cosine of that
      const float sunAngularDiameterCos = 0.999956676946448443553574619906976478926848692873900859324;

      // 3.0 / ( 16.0 * pi )
      const float THREE_OVER_SIXTEENPI = 0.05968310365946075;
      // 1.0 / ( 4.0 * pi )
      const float ONE_OVER_FOURPI = 0.07957747154594767;

      float rayleighPhase( float cosTheta ) {
        return THREE_OVER_SIXTEENPI * ( 1.0 + pow( cosTheta, 2.0 ) );
      }

      float hgPhase( float cosTheta, float g ) {
        float g2 = pow( g, 2.0 );
        float inverse = 1.0 / pow( 1.0 - 2.0 * g * cosTheta + g2, 1.5 );
        return ONE_OVER_FOURPI * ( ( 1.0 - g2 ) * inverse );
      }

      void main() {

        vec3 direction = normalize( vWorldPosition - cameraPos );

      // optical length
      // cutoff angle at 90 to avoid singularity in next formula.
        float zenithAngle = acos( max( 0.0, dot( up, direction ) ) );
        float inverse = 1.0 / ( cos( zenithAngle ) + 0.15 * pow( 93.885 - ( ( zenithAngle * 180.0 ) / pi ), -1.253 ) );
        float sR = rayleighZenithLength * inverse;
        float sM = mieZenithLength * inverse;

      // combined extinction factor
        vec3 Fex = exp( -( vBetaR * sR + vBetaM * sM ) );

      // in scattering
        float cosTheta = dot( direction, vSunDirection );

        float rPhase = rayleighPhase( cosTheta * 0.5 + 0.5 );
        vec3 betaRTheta = vBetaR * rPhase;

        float mPhase = hgPhase( cosTheta, mieDirectionalG );
        vec3 betaMTheta = vBetaM * mPhase;

        vec3 Lin = pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * ( 1.0 - Fex ), vec3( 1.5 ) );
        Lin *= mix( vec3( 1.0 ), pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * Fex, vec3( 1.0 / 2.0 ) ), clamp( pow( 1.0 - dot( up, vSunDirection ), 5.0 ), 0.0, 1.0 ) );

      // nightsky
        float theta = acos( direction.y ); // elevation --> y-axis, [-pi/2, pi/2]
        float phi = atan( direction.z, direction.x ); // azimuth --> x-axis [-pi/2, pi/2]
        vec2 uv = vec2( phi, theta ) / vec2( 2.0 * pi, pi ) + vec2( 0.5, 0.0 );
        vec3 L0 = vec3( 0.1 ) * Fex;

      // composition + solar disc
        float sundisk = smoothstep( sunAngularDiameterCos, sunAngularDiameterCos + 0.00002, cosTheta );
        L0 += ( vSunE * 19000.0 * Fex ) * sundisk;

        vec3 texColor = ( Lin + L0 ) * 0.04 + vec3( 0.0, 0.0003, 0.00075 );

        vec3 retColor = pow( texColor, vec3( 1.0 / ( 1.2 + ( 1.2 * vSunfade ) ) ) );

        gl_FragColor = vec4( retColor, 1.0 );

      #include <tonemapping_fragment>
      #include <${RA>=154?"colorspace_fragment":"encodings_fragment"}>

      }
    `},e=new Mi({name:"SkyShader",fragmentShader:i.fragmentShader,vertexShader:i.vertexShader,uniforms:rp.clone(i.uniforms),side:ys,depthWrite:!1});class t extends It{constructor(){super(new ya(1,1,1),e)}}return w9(t,"SkyShader",i),w9(t,"material",e),t})(),Ple=i=>i&&i.isCubeTexture;class Lle extends It{constructor(e,t){var n,r;const s=Ple(e),a=((r=s?(n=e.image[0])==null?void 0:n.width:e.image.width)!=null?r:1024)/4,l=Math.floor(Math.log2(a)),c=Math.pow(2,l),u=3*Math.max(c,112),h=4*c,f=[s?"#define ENVMAP_TYPE_CUBE":"",`#define CUBEUV_TEXEL_WIDTH ${1/u}`,`#define CUBEUV_TEXEL_HEIGHT ${1/h}`,`#define CUBEUV_MAX_MIP ${l}.0`],d=`
        varying vec3 vWorldPosition;
        void main() 
        {
            vec4 worldPosition = ( modelMatrix * vec4( position, 1.0 ) );
            vWorldPosition = worldPosition.xyz;
            
            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        }
        `,m=f.join(`
`)+`
        #define ENVMAP_TYPE_CUBE_UV
        varying vec3 vWorldPosition;
        uniform float radius;
        uniform float height;
        uniform float angle;
        #ifdef ENVMAP_TYPE_CUBE
            uniform samplerCube map;
        #else
            uniform sampler2D map;
        #endif
        // From: https://www.shadertoy.com/view/4tsBD7
        float diskIntersectWithBackFaceCulling( vec3 ro, vec3 rd, vec3 c, vec3 n, float r ) 
        {
            float d = dot ( rd, n );
            
            if( d > 0.0 ) { return 1e6; }
            
            vec3  o = ro - c;
            float t = - dot( n, o ) / d;
            vec3  q = o + rd * t;
            
            return ( dot( q, q ) < r * r ) ? t : 1e6;
        }
        // From: https://www.iquilezles.org/www/articles/intersectors/intersectors.htm
        float sphereIntersect( vec3 ro, vec3 rd, vec3 ce, float ra ) 
        {
            vec3 oc = ro - ce;
            float b = dot( oc, rd );
            float c = dot( oc, oc ) - ra * ra;
            float h = b * b - c;
            
            if( h < 0.0 ) { return -1.0; }
            
            h = sqrt( h );
            
            return - b + h;
        }
        vec3 project() 
        {
            vec3 p = normalize( vWorldPosition );
            vec3 camPos = cameraPosition;
            camPos.y -= height;
            float intersection = sphereIntersect( camPos, p, vec3( 0.0 ), radius );
            if( intersection > 0.0 ) {
                
                vec3 h = vec3( 0.0, - height, 0.0 );
                float intersection2 = diskIntersectWithBackFaceCulling( camPos, p, h, vec3( 0.0, 1.0, 0.0 ), radius );
                p = ( camPos + min( intersection, intersection2 ) * p ) / radius;
            } else {
                p = vec3( 0.0, 1.0, 0.0 );
            }
            return p;
        }
        #include <common>
        #include <cube_uv_reflection_fragment>
        void main() 
        {
            vec3 projectedWorldPosition = project();
            
            #ifdef ENVMAP_TYPE_CUBE
                vec3 outcolor = textureCube( map, projectedWorldPosition ).rgb;
            #else
                vec3 direction = normalize( projectedWorldPosition );
                vec2 uv = equirectUv( direction );
                vec3 outcolor = texture2D( map, uv ).rgb;
            #endif
            gl_FragColor = vec4( outcolor, 1.0 );
            #include <tonemapping_fragment>
            #include <${RA>=154?"colorspace_fragment":"encodings_fragment"}>
        }
        `,y={map:{value:e},height:{value:(t==null?void 0:t.height)||15},radius:{value:(t==null?void 0:t.radius)||100}},g=new px(1,16),A=new Mi({uniforms:y,fragmentShader:m,vertexShader:d,side:Li});super(g,A)}set radius(e){this.material.uniforms.radius.value=e}get radius(){return this.material.uniforms.radius.value}set height(e){this.material.uniforms.height.value=e}get height(){return this.material.uniforms.height.value}}function fH(i,e,t={}){const n=new Q,r=new Xt,s=new Q,o=new Xe,a=new Xe,l=new Xe;t.preserveMatrix=t.preserveMatrix!==void 0?t.preserveMatrix:!0,t.preservePosition=t.preservePosition!==void 0?t.preservePosition:!0,t.preserveHipPosition=t.preserveHipPosition!==void 0?t.preserveHipPosition:!1,t.useTargetMatrix=t.useTargetMatrix!==void 0?t.useTargetMatrix:!1,t.hip=t.hip!==void 0?t.hip:"hip",t.names=t.names||{};const c=e.isObject3D?e.skeleton.bones:HS(e),u=i.isObject3D?i.skeleton.bones:HS(i);let h,f,d,m,y;if(i.isObject3D?i.skeleton.pose():(t.useTargetMatrix=!0,t.preserveMatrix=!1),t.preservePosition){y=[];for(let g=0;g<u.length;g++)y.push(u[g].position.clone())}if(t.preserveMatrix){i.updateMatrixWorld(),i.matrixWorld.identity();for(let g=0;g<i.children.length;++g)i.children[g].updateMatrixWorld(!0)}if(t.offsets){h=[];for(let g=0;g<u.length;++g)f=u[g],d=t.names[f.name]||f.name,t.offsets[d]&&(f.matrix.multiply(t.offsets[d]),f.matrix.decompose(f.position,f.quaternion,f.scale),f.updateMatrixWorld()),h.push(f.matrixWorld.clone())}for(let g=0;g<u.length;++g){if(f=u[g],d=t.names[f.name]||f.name,m=dH(d,c),l.copy(f.matrixWorld),m){if(m.updateMatrixWorld(),t.useTargetMatrix?a.copy(m.matrixWorld):(a.copy(i.matrixWorld).invert(),a.multiply(m.matrixWorld)),s.setFromMatrixScale(a),a.scale(s.set(1/s.x,1/s.y,1/s.z)),l.makeRotationFromQuaternion(r.setFromRotationMatrix(a)),i.isObject3D){const A=u.indexOf(f),E=h?h[A]:o.copy(i.skeleton.boneInverses[A]).invert();l.multiply(E)}l.copyPosition(a)}f.parent&&f.parent.isBone?(f.matrix.copy(f.parent.matrixWorld).invert(),f.matrix.multiply(l)):f.matrix.copy(l),t.preserveHipPosition&&d===t.hip&&f.matrix.setPosition(n.set(0,f.position.y,0)),f.matrix.decompose(f.position,f.quaternion,f.scale),f.updateMatrixWorld()}if(t.preservePosition)for(let g=0;g<u.length;++g)f=u[g],d=t.names[f.name]||f.name,d!==t.hip&&f.position.copy(y[g]);t.preserveMatrix&&i.updateMatrixWorld(!0)}function Ble(i,e,t,n={}){n.useFirstFramePosition=n.useFirstFramePosition!==void 0?n.useFirstFramePosition:!1,n.fps=n.fps!==void 0?n.fps:30,n.names=n.names||[],e.isObject3D||(e=kle(e));const r=Math.round(t.duration*(n.fps/1e3)*1e3),s=1/n.fps,o=[],a=new tR(e),l=HS(i.skeleton),c=[];let u,h,f,d,m;a.clipAction(t).play(),a.update(0),e.updateMatrixWorld();for(let y=0;y<r;++y){const g=y*s;fH(i,e,n);for(let A=0;A<l.length;++A)m=n.names[l[A].name]||l[A].name,f=dH(m,e.skeleton),f&&(h=l[A],d=c[A]=c[A]||{bone:h},n.hip===m&&(d.pos||(d.pos={times:new Float32Array(r),values:new Float32Array(r*3)}),n.useFirstFramePosition&&(y===0&&(u=h.position.clone()),h.position.sub(u)),d.pos.times[y]=g,h.position.toArray(d.pos.values,y*3)),d.quat||(d.quat={times:new Float32Array(r),values:new Float32Array(r*4)}),d.quat.times[y]=g,h.quaternion.toArray(d.quat.values,y*4));a.update(s),e.updateMatrixWorld()}for(let y=0;y<c.length;++y)d=c[y],d&&(d.pos&&o.push(new Of(".bones["+d.bone.name+"].position",d.pos.times,d.pos.values)),o.push(new vh(".bones["+d.bone.name+"].quaternion",d.quat.times,d.quat.values)));return a.uncacheAction(t),new op(t.name,-1,o)}function Dle(i){const e=new Map,t=new Map,n=i.clone();return pH(i,n,function(r,s){e.set(s,r),t.set(r,s)}),n.traverse(function(r){if(!r.isSkinnedMesh)return;const s=r,o=e.get(r),a=o.skeleton.bones;s.skeleton=o.skeleton.clone(),s.bindMatrix.copy(o.bindMatrix),s.skeleton.bones=a.map(function(l){return t.get(l)}),s.bind(s.skeleton,s.bindMatrix)}),n}function dH(i,e){for(let t=0,n=HS(e);t<n.length;t++)if(i===n[t].name)return n[t]}function HS(i){return Array.isArray(i)?i:i.bones}function kle(i){const e=new Pz(i.bones[0]);return e.skeleton=i,e}function pH(i,e,t){t(i,e);for(let n=0;n<i.children.length;n++)pH(i.children[n],e.children[n],t)}const Fle={retarget:fH,retargetClip:Ble,clone:Dle},Po=new ks,PE=new Q;class Ole{constructor(e){let t=e.geometry;t.index&&(console.warn("THREE.MeshSurfaceSampler: Converting geometry to non-indexed BufferGeometry."),t=t.toNonIndexed()),this.geometry=t,this.randomFunction=Math.random,this.positionAttribute=this.geometry.getAttribute("position"),this.colorAttribute=this.geometry.getAttribute("color"),this.weightAttribute=null,this.distribution=null}setWeightAttribute(e){return this.weightAttribute=e?this.geometry.getAttribute(e):null,this}build(){const e=this.positionAttribute,t=this.weightAttribute,n=new Float32Array(e.count/3);for(let s=0;s<e.count;s+=3){let o=1;t&&(o=t.getX(s)+t.getX(s+1)+t.getX(s+2)),Po.a.fromBufferAttribute(e,s),Po.b.fromBufferAttribute(e,s+1),Po.c.fromBufferAttribute(e,s+2),o*=Po.getArea(),n[s/3]=o}this.distribution=new Float32Array(e.count/3);let r=0;for(let s=0;s<n.length;s++)r+=n[s],this.distribution[s]=r;return this}setRandomGenerator(e){return this.randomFunction=e,this}sample(e,t,n){const r=this.sampleFaceIndex();return this.sampleFace(r,e,t,n)}sampleFaceIndex(){const e=this.distribution[this.distribution.length-1];return this.binarySearch(this.randomFunction()*e)}binarySearch(e){const t=this.distribution;let n=0,r=t.length-1,s=-1;for(;n<=r;){const o=Math.ceil((n+r)/2);if(o===0||t[o-1]<=e&&t[o]>e){s=o;break}else e<t[o]?r=o-1:n=o+1}return s}sampleFace(e,t,n,r){let s=this.randomFunction(),o=this.randomFunction();return s+o>1&&(s=1-s,o=1-o),Po.a.fromBufferAttribute(this.positionAttribute,e*3),Po.b.fromBufferAttribute(this.positionAttribute,e*3+1),Po.c.fromBufferAttribute(this.positionAttribute,e*3+2),t.set(0,0,0).addScaledVector(Po.a,s).addScaledVector(Po.b,o).addScaledVector(Po.c,1-(s+o)),n!==void 0&&Po.getNormal(n),r!==void 0&&this.colorAttribute!==void 0&&(Po.a.fromBufferAttribute(this.colorAttribute,e*3),Po.b.fromBufferAttribute(this.colorAttribute,e*3+1),Po.c.fromBufferAttribute(this.colorAttribute,e*3+2),PE.set(0,0,0).addScaledVector(Po.a,s).addScaledVector(Po.b,o).addScaledVector(Po.c,1-(s+o)),r.r=PE.x,r.g=PE.y,r.b=PE.z),this}}var Nle=Object.defineProperty,Ule=(i,e,t)=>e in i?Nle(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,zle=(i,e,t)=>(Ule(i,e+"",t),t);let x0=class{constructor(){zle(this,"_listeners")}addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const n=this._listeners;n[e]===void 0&&(n[e]=[]),n[e].indexOf(t)===-1&&n[e].push(t)}hasEventListener(e,t){if(this._listeners===void 0)return!1;const n=this._listeners;return n[e]!==void 0&&n[e].indexOf(t)!==-1}removeEventListener(e,t){if(this._listeners===void 0)return;const r=this._listeners[e];if(r!==void 0){const s=r.indexOf(t);s!==-1&&r.splice(s,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const n=this._listeners[e.type];if(n!==void 0){e.target=this;const r=n.slice(0);for(let s=0,o=r.length;s<o;s++)r[s].call(this,e);e.target=null}}};var Gle=Object.defineProperty,Hle=(i,e,t)=>e in i?Gle(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Yn=(i,e,t)=>(Hle(i,typeof e!="symbol"?e+"":e,t),t);const C9=new Q;let Qle=class extends x0{constructor(e,t){super(),Yn(this,"object"),Yn(this,"domElement"),Yn(this,"enabled",!0),Yn(this,"movementSpeed",1),Yn(this,"lookSpeed",.005),Yn(this,"lookVertical",!0),Yn(this,"autoForward",!1),Yn(this,"activeLook",!0),Yn(this,"heightSpeed",!1),Yn(this,"heightCoef",1),Yn(this,"heightMin",0),Yn(this,"heightMax",1),Yn(this,"constrainVertical",!1),Yn(this,"verticalMin",0),Yn(this,"verticalMax",Math.PI),Yn(this,"mouseDragOn",!1),Yn(this,"autoSpeedFactor",0),Yn(this,"mouseX",0),Yn(this,"mouseY",0),Yn(this,"moveForward",!1),Yn(this,"moveBackward",!1),Yn(this,"moveLeft",!1),Yn(this,"moveRight",!1),Yn(this,"moveUp",!1),Yn(this,"moveDown",!1),Yn(this,"viewHalfX",0),Yn(this,"viewHalfY",0),Yn(this,"lat",0),Yn(this,"lon",0),Yn(this,"lookDirection",new Q),Yn(this,"spherical",new t0),Yn(this,"target",new Q),Yn(this,"connect",n=>{n.setAttribute("tabindex","-1"),n.style.touchAction="none",n.addEventListener("contextmenu",this.contextmenu),n.addEventListener("mousemove",this.onMouseMove),n.addEventListener("mousedown",this.onMouseDown),n.addEventListener("mouseup",this.onMouseUp),this.domElement=n,window.addEventListener("keydown",this.onKeyDown),window.addEventListener("keyup",this.onKeyUp),this.handleResize()}),Yn(this,"dispose",()=>{var n,r,s,o;(n=this.domElement)==null||n.removeEventListener("contextmenu",this.contextmenu),(r=this.domElement)==null||r.removeEventListener("mousedown",this.onMouseDown),(s=this.domElement)==null||s.removeEventListener("mousemove",this.onMouseMove),(o=this.domElement)==null||o.removeEventListener("mouseup",this.onMouseUp),window.removeEventListener("keydown",this.onKeyDown),window.removeEventListener("keyup",this.onKeyUp)}),Yn(this,"handleResize",()=>{this.domElement&&(this.viewHalfX=this.domElement.offsetWidth/2,this.viewHalfY=this.domElement.offsetHeight/2)}),Yn(this,"onMouseDown",n=>{var r;if((r=this.domElement)==null||r.focus(),this.activeLook)switch(n.button){case 0:this.moveForward=!0;break;case 2:this.moveBackward=!0;break}this.mouseDragOn=!0}),Yn(this,"onMouseUp",n=>{if(this.activeLook)switch(n.button){case 0:this.moveForward=!1;break;case 2:this.moveBackward=!1;break}this.mouseDragOn=!1}),Yn(this,"onMouseMove",n=>{this.domElement&&(this.mouseX=n.pageX-this.domElement.offsetLeft-this.viewHalfX,this.mouseY=n.pageY-this.domElement.offsetTop-this.viewHalfY)}),Yn(this,"onKeyDown",n=>{switch(n.code){case"ArrowUp":case"KeyW":this.moveForward=!0;break;case"ArrowLeft":case"KeyA":this.moveLeft=!0;break;case"ArrowDown":case"KeyS":this.moveBackward=!0;break;case"ArrowRight":case"KeyD":this.moveRight=!0;break;case"KeyR":this.moveUp=!0;break;case"KeyF":this.moveDown=!0;break}}),Yn(this,"onKeyUp",n=>{switch(n.code){case"ArrowUp":case"KeyW":this.moveForward=!1;break;case"ArrowLeft":case"KeyA":this.moveLeft=!1;break;case"ArrowDown":case"KeyS":this.moveBackward=!1;break;case"ArrowRight":case"KeyD":this.moveRight=!1;break;case"KeyR":this.moveUp=!1;break;case"KeyF":this.moveDown=!1;break}}),Yn(this,"lookAt",(n,r,s)=>(n instanceof Q?this.target.copy(n):r&&s&&this.target.set(n,r,s),this.object.lookAt(this.target),this.setOrientation(),this)),Yn(this,"update",n=>{if(!this.enabled)return;if(this.heightSpeed){const h=un.clamp(this.object.position.y,this.heightMin,this.heightMax)-this.heightMin;this.autoSpeedFactor=n*(h*this.heightCoef)}else this.autoSpeedFactor=0;const r=n*this.movementSpeed;(this.moveForward||this.autoForward&&!this.moveBackward)&&this.object.translateZ(-(r+this.autoSpeedFactor)),this.moveBackward&&this.object.translateZ(r),this.moveLeft&&this.object.translateX(-r),this.moveRight&&this.object.translateX(r),this.moveUp&&this.object.translateY(r),this.moveDown&&this.object.translateY(-r);let s=n*this.lookSpeed;this.activeLook||(s=0);let o=1;this.constrainVertical&&(o=Math.PI/(this.verticalMax-this.verticalMin)),this.lon-=this.mouseX*s,this.lookVertical&&(this.lat-=this.mouseY*s*o),this.lat=Math.max(-85,Math.min(85,this.lat));let a=un.degToRad(90-this.lat);const l=un.degToRad(this.lon);this.constrainVertical&&(a=un.mapLinear(a,0,Math.PI,this.verticalMin,this.verticalMax));const c=this.object.position;C9.setFromSphericalCoords(1,a,l).add(c),this.object.lookAt(C9)}),Yn(this,"contextmenu",n=>n.preventDefault()),Yn(this,"setOrientation",()=>{this.lookDirection.set(0,0,-1).applyQuaternion(this.object.quaternion),this.spherical.setFromVector3(this.lookDirection),this.lat=90-un.radToDeg(this.spherical.phi),this.lon=un.radToDeg(this.spherical.theta)}),this.object=e,this.domElement=t,this.setOrientation(),t&&this.connect(t)}};var Vle=Object.defineProperty,jle=(i,e,t)=>e in i?Vle(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,dt=(i,e,t)=>(jle(i,typeof e!="symbol"?e+"":e,t),t);let Wle=class extends _n{constructor(e,t){super(),dt(this,"isTransformControls",!0),dt(this,"visible",!1),dt(this,"domElement"),dt(this,"raycaster",new y0),dt(this,"gizmo"),dt(this,"plane"),dt(this,"tempVector",new Q),dt(this,"tempVector2",new Q),dt(this,"tempQuaternion",new Xt),dt(this,"unit",{X:new Q(1,0,0),Y:new Q(0,1,0),Z:new Q(0,0,1)}),dt(this,"pointStart",new Q),dt(this,"pointEnd",new Q),dt(this,"offset",new Q),dt(this,"rotationAxis",new Q),dt(this,"startNorm",new Q),dt(this,"endNorm",new Q),dt(this,"rotationAngle",0),dt(this,"cameraPosition",new Q),dt(this,"cameraQuaternion",new Xt),dt(this,"cameraScale",new Q),dt(this,"parentPosition",new Q),dt(this,"parentQuaternion",new Xt),dt(this,"parentQuaternionInv",new Xt),dt(this,"parentScale",new Q),dt(this,"worldPositionStart",new Q),dt(this,"worldQuaternionStart",new Xt),dt(this,"worldScaleStart",new Q),dt(this,"worldPosition",new Q),dt(this,"worldQuaternion",new Xt),dt(this,"worldQuaternionInv",new Xt),dt(this,"worldScale",new Q),dt(this,"eye",new Q),dt(this,"positionStart",new Q),dt(this,"quaternionStart",new Xt),dt(this,"scaleStart",new Q),dt(this,"camera"),dt(this,"object"),dt(this,"enabled",!0),dt(this,"axis",null),dt(this,"mode","translate"),dt(this,"translationSnap",null),dt(this,"rotationSnap",null),dt(this,"scaleSnap",null),dt(this,"space","world"),dt(this,"size",1),dt(this,"dragging",!1),dt(this,"showX",!0),dt(this,"showY",!0),dt(this,"showZ",!0),dt(this,"changeEvent",{type:"change"}),dt(this,"mouseDownEvent",{type:"mouseDown",mode:this.mode}),dt(this,"mouseUpEvent",{type:"mouseUp",mode:this.mode}),dt(this,"objectChangeEvent",{type:"objectChange"}),dt(this,"intersectObjectWithRay",(r,s,o)=>{const a=s.intersectObject(r,!0);for(let l=0;l<a.length;l++)if(a[l].object.visible||o)return a[l];return!1}),dt(this,"attach",r=>(this.object=r,this.visible=!0,this)),dt(this,"detach",()=>(this.object=void 0,this.visible=!1,this.axis=null,this)),dt(this,"reset",()=>this.enabled?(this.dragging&&this.object!==void 0&&(this.object.position.copy(this.positionStart),this.object.quaternion.copy(this.quaternionStart),this.object.scale.copy(this.scaleStart),this.dispatchEvent(this.changeEvent),this.dispatchEvent(this.objectChangeEvent),this.pointStart.copy(this.pointEnd)),this):this),dt(this,"updateMatrixWorld",()=>{this.object!==void 0&&(this.object.updateMatrixWorld(),this.object.parent===null?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):this.object.parent.matrixWorld.decompose(this.parentPosition,this.parentQuaternion,this.parentScale),this.object.matrixWorld.decompose(this.worldPosition,this.worldQuaternion,this.worldScale),this.parentQuaternionInv.copy(this.parentQuaternion).invert(),this.worldQuaternionInv.copy(this.worldQuaternion).invert()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(this.cameraPosition,this.cameraQuaternion,this.cameraScale),this.eye.copy(this.cameraPosition).sub(this.worldPosition).normalize(),super.updateMatrixWorld()}),dt(this,"pointerHover",r=>{if(this.object===void 0||this.dragging===!0)return;this.raycaster.setFromCamera(r,this.camera);const s=this.intersectObjectWithRay(this.gizmo.picker[this.mode],this.raycaster);s?this.axis=s.object.name:this.axis=null}),dt(this,"pointerDown",r=>{if(!(this.object===void 0||this.dragging===!0||r.button!==0)&&this.axis!==null){this.raycaster.setFromCamera(r,this.camera);const s=this.intersectObjectWithRay(this.plane,this.raycaster,!0);if(s){let o=this.space;if(this.mode==="scale"?o="local":(this.axis==="E"||this.axis==="XYZE"||this.axis==="XYZ")&&(o="world"),o==="local"&&this.mode==="rotate"){const a=this.rotationSnap;this.axis==="X"&&a&&(this.object.rotation.x=Math.round(this.object.rotation.x/a)*a),this.axis==="Y"&&a&&(this.object.rotation.y=Math.round(this.object.rotation.y/a)*a),this.axis==="Z"&&a&&(this.object.rotation.z=Math.round(this.object.rotation.z/a)*a)}this.object.updateMatrixWorld(),this.object.parent&&this.object.parent.updateMatrixWorld(),this.positionStart.copy(this.object.position),this.quaternionStart.copy(this.object.quaternion),this.scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this.worldScaleStart),this.pointStart.copy(s.point).sub(this.worldPositionStart)}this.dragging=!0,this.mouseDownEvent.mode=this.mode,this.dispatchEvent(this.mouseDownEvent)}}),dt(this,"pointerMove",r=>{const s=this.axis,o=this.mode,a=this.object;let l=this.space;if(o==="scale"?l="local":(s==="E"||s==="XYZE"||s==="XYZ")&&(l="world"),a===void 0||s===null||this.dragging===!1||r.button!==-1)return;this.raycaster.setFromCamera(r,this.camera);const c=this.intersectObjectWithRay(this.plane,this.raycaster,!0);if(c){if(this.pointEnd.copy(c.point).sub(this.worldPositionStart),o==="translate")this.offset.copy(this.pointEnd).sub(this.pointStart),l==="local"&&s!=="XYZ"&&this.offset.applyQuaternion(this.worldQuaternionInv),s.indexOf("X")===-1&&(this.offset.x=0),s.indexOf("Y")===-1&&(this.offset.y=0),s.indexOf("Z")===-1&&(this.offset.z=0),l==="local"&&s!=="XYZ"?this.offset.applyQuaternion(this.quaternionStart).divide(this.parentScale):this.offset.applyQuaternion(this.parentQuaternionInv).divide(this.parentScale),a.position.copy(this.offset).add(this.positionStart),this.translationSnap&&(l==="local"&&(a.position.applyQuaternion(this.tempQuaternion.copy(this.quaternionStart).invert()),s.search("X")!==-1&&(a.position.x=Math.round(a.position.x/this.translationSnap)*this.translationSnap),s.search("Y")!==-1&&(a.position.y=Math.round(a.position.y/this.translationSnap)*this.translationSnap),s.search("Z")!==-1&&(a.position.z=Math.round(a.position.z/this.translationSnap)*this.translationSnap),a.position.applyQuaternion(this.quaternionStart)),l==="world"&&(a.parent&&a.position.add(this.tempVector.setFromMatrixPosition(a.parent.matrixWorld)),s.search("X")!==-1&&(a.position.x=Math.round(a.position.x/this.translationSnap)*this.translationSnap),s.search("Y")!==-1&&(a.position.y=Math.round(a.position.y/this.translationSnap)*this.translationSnap),s.search("Z")!==-1&&(a.position.z=Math.round(a.position.z/this.translationSnap)*this.translationSnap),a.parent&&a.position.sub(this.tempVector.setFromMatrixPosition(a.parent.matrixWorld))));else if(o==="scale"){if(s.search("XYZ")!==-1){let u=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(u*=-1),this.tempVector2.set(u,u,u)}else this.tempVector.copy(this.pointStart),this.tempVector2.copy(this.pointEnd),this.tempVector.applyQuaternion(this.worldQuaternionInv),this.tempVector2.applyQuaternion(this.worldQuaternionInv),this.tempVector2.divide(this.tempVector),s.search("X")===-1&&(this.tempVector2.x=1),s.search("Y")===-1&&(this.tempVector2.y=1),s.search("Z")===-1&&(this.tempVector2.z=1);a.scale.copy(this.scaleStart).multiply(this.tempVector2),this.scaleSnap&&this.object&&(s.search("X")!==-1&&(this.object.scale.x=Math.round(a.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),s.search("Y")!==-1&&(a.scale.y=Math.round(a.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),s.search("Z")!==-1&&(a.scale.z=Math.round(a.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if(o==="rotate"){this.offset.copy(this.pointEnd).sub(this.pointStart);const u=20/this.worldPosition.distanceTo(this.tempVector.setFromMatrixPosition(this.camera.matrixWorld));s==="E"?(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this.startNorm.copy(this.pointStart).normalize(),this.endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this.endNorm.cross(this.startNorm).dot(this.eye)<0?1:-1):s==="XYZE"?(this.rotationAxis.copy(this.offset).cross(this.eye).normalize(),this.rotationAngle=this.offset.dot(this.tempVector.copy(this.rotationAxis).cross(this.eye))*u):(s==="X"||s==="Y"||s==="Z")&&(this.rotationAxis.copy(this.unit[s]),this.tempVector.copy(this.unit[s]),l==="local"&&this.tempVector.applyQuaternion(this.worldQuaternion),this.rotationAngle=this.offset.dot(this.tempVector.cross(this.eye).normalize())*u),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),l==="local"&&s!=="E"&&s!=="XYZE"?(a.quaternion.copy(this.quaternionStart),a.quaternion.multiply(this.tempQuaternion.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this.parentQuaternionInv),a.quaternion.copy(this.tempQuaternion.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),a.quaternion.multiply(this.quaternionStart).normalize())}this.dispatchEvent(this.changeEvent),this.dispatchEvent(this.objectChangeEvent)}}),dt(this,"pointerUp",r=>{r.button===0&&(this.dragging&&this.axis!==null&&(this.mouseUpEvent.mode=this.mode,this.dispatchEvent(this.mouseUpEvent)),this.dragging=!1,this.axis=null)}),dt(this,"getPointer",r=>{var s;if(this.domElement&&((s=this.domElement.ownerDocument)!=null&&s.pointerLockElement))return{x:0,y:0,button:r.button};{const o=r.changedTouches?r.changedTouches[0]:r,a=this.domElement.getBoundingClientRect();return{x:(o.clientX-a.left)/a.width*2-1,y:-(o.clientY-a.top)/a.height*2+1,button:r.button}}}),dt(this,"onPointerHover",r=>{if(this.enabled)switch(r.pointerType){case"mouse":case"pen":this.pointerHover(this.getPointer(r));break}}),dt(this,"onPointerDown",r=>{!this.enabled||!this.domElement||(this.domElement.style.touchAction="none",this.domElement.ownerDocument.addEventListener("pointermove",this.onPointerMove),this.pointerHover(this.getPointer(r)),this.pointerDown(this.getPointer(r)))}),dt(this,"onPointerMove",r=>{this.enabled&&this.pointerMove(this.getPointer(r))}),dt(this,"onPointerUp",r=>{!this.enabled||!this.domElement||(this.domElement.style.touchAction="",this.domElement.ownerDocument.removeEventListener("pointermove",this.onPointerMove),this.pointerUp(this.getPointer(r)))}),dt(this,"getMode",()=>this.mode),dt(this,"setMode",r=>{this.mode=r}),dt(this,"setTranslationSnap",r=>{this.translationSnap=r}),dt(this,"setRotationSnap",r=>{this.rotationSnap=r}),dt(this,"setScaleSnap",r=>{this.scaleSnap=r}),dt(this,"setSize",r=>{this.size=r}),dt(this,"setSpace",r=>{this.space=r}),dt(this,"update",()=>{console.warn("THREE.TransformControls: update function has no more functionality and therefore has been deprecated.")}),dt(this,"connect",r=>{r===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.domElement=r,this.domElement.addEventListener("pointerdown",this.onPointerDown),this.domElement.addEventListener("pointermove",this.onPointerHover),this.domElement.ownerDocument.addEventListener("pointerup",this.onPointerUp)}),dt(this,"dispose",()=>{var r,s,o,a,l,c;(r=this.domElement)==null||r.removeEventListener("pointerdown",this.onPointerDown),(s=this.domElement)==null||s.removeEventListener("pointermove",this.onPointerHover),(a=(o=this.domElement)==null?void 0:o.ownerDocument)==null||a.removeEventListener("pointermove",this.onPointerMove),(c=(l=this.domElement)==null?void 0:l.ownerDocument)==null||c.removeEventListener("pointerup",this.onPointerUp),this.traverse(u=>{const h=u;h.geometry&&h.geometry.dispose(),h.material&&h.material.dispose()})}),this.domElement=t,this.camera=e,this.gizmo=new Kle,this.add(this.gizmo),this.plane=new Yle,this.add(this.plane);const n=(r,s)=>{let o=s;Object.defineProperty(this,r,{get:function(){return o!==void 0?o:s},set:function(a){o!==a&&(o=a,this.plane[r]=a,this.gizmo[r]=a,this.dispatchEvent({type:r+"-changed",value:a}),this.dispatchEvent(this.changeEvent))}}),this[r]=s,this.plane[r]=s,this.gizmo[r]=s};n("camera",this.camera),n("object",this.object),n("enabled",this.enabled),n("axis",this.axis),n("mode",this.mode),n("translationSnap",this.translationSnap),n("rotationSnap",this.rotationSnap),n("scaleSnap",this.scaleSnap),n("space",this.space),n("size",this.size),n("dragging",this.dragging),n("showX",this.showX),n("showY",this.showY),n("showZ",this.showZ),n("worldPosition",this.worldPosition),n("worldPositionStart",this.worldPositionStart),n("worldQuaternion",this.worldQuaternion),n("worldQuaternionStart",this.worldQuaternionStart),n("cameraPosition",this.cameraPosition),n("cameraQuaternion",this.cameraQuaternion),n("pointStart",this.pointStart),n("pointEnd",this.pointEnd),n("rotationAxis",this.rotationAxis),n("rotationAngle",this.rotationAngle),n("eye",this.eye),t!==void 0&&this.connect(t)}};class Kle extends _n{constructor(){super(),dt(this,"isTransformControlsGizmo",!0),dt(this,"type","TransformControlsGizmo"),dt(this,"tempVector",new Q(0,0,0)),dt(this,"tempEuler",new Eo),dt(this,"alignVector",new Q(0,1,0)),dt(this,"zeroVector",new Q(0,0,0)),dt(this,"lookAtMatrix",new Xe),dt(this,"tempQuaternion",new Xt),dt(this,"tempQuaternion2",new Xt),dt(this,"identityQuaternion",new Xt),dt(this,"unitX",new Q(1,0,0)),dt(this,"unitY",new Q(0,1,0)),dt(this,"unitZ",new Q(0,0,1)),dt(this,"gizmo"),dt(this,"picker"),dt(this,"helper"),dt(this,"rotationAxis",new Q),dt(this,"cameraPosition",new Q),dt(this,"worldPositionStart",new Q),dt(this,"worldQuaternionStart",new Xt),dt(this,"worldPosition",new Q),dt(this,"worldQuaternion",new Xt),dt(this,"eye",new Q),dt(this,"camera",null),dt(this,"enabled",!0),dt(this,"axis",null),dt(this,"mode","translate"),dt(this,"space","world"),dt(this,"size",1),dt(this,"dragging",!1),dt(this,"showX",!0),dt(this,"showY",!0),dt(this,"showZ",!0),dt(this,"updateMatrixWorld",()=>{let W=this.space;this.mode==="scale"&&(W="local");const F=W==="local"?this.worldQuaternion:this.identityQuaternion;this.gizmo.translate.visible=this.mode==="translate",this.gizmo.rotate.visible=this.mode==="rotate",this.gizmo.scale.visible=this.mode==="scale",this.helper.translate.visible=this.mode==="translate",this.helper.rotate.visible=this.mode==="rotate",this.helper.scale.visible=this.mode==="scale";let Y=[];Y=Y.concat(this.picker[this.mode].children),Y=Y.concat(this.gizmo[this.mode].children),Y=Y.concat(this.helper[this.mode].children);for(let te=0;te<Y.length;te++){const q=Y[te];q.visible=!0,q.rotation.set(0,0,0),q.position.copy(this.worldPosition);let J;if(this.camera.isOrthographicCamera?J=(this.camera.top-this.camera.bottom)/this.camera.zoom:J=this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),q.scale.set(1,1,1).multiplyScalar(J*this.size/7),q.tag==="helper"){q.visible=!1,q.name==="AXIS"?(q.position.copy(this.worldPositionStart),q.visible=!!this.axis,this.axis==="X"&&(this.tempQuaternion.setFromEuler(this.tempEuler.set(0,0,0)),q.quaternion.copy(F).multiply(this.tempQuaternion),Math.abs(this.alignVector.copy(this.unitX).applyQuaternion(F).dot(this.eye))>.9&&(q.visible=!1)),this.axis==="Y"&&(this.tempQuaternion.setFromEuler(this.tempEuler.set(0,0,Math.PI/2)),q.quaternion.copy(F).multiply(this.tempQuaternion),Math.abs(this.alignVector.copy(this.unitY).applyQuaternion(F).dot(this.eye))>.9&&(q.visible=!1)),this.axis==="Z"&&(this.tempQuaternion.setFromEuler(this.tempEuler.set(0,Math.PI/2,0)),q.quaternion.copy(F).multiply(this.tempQuaternion),Math.abs(this.alignVector.copy(this.unitZ).applyQuaternion(F).dot(this.eye))>.9&&(q.visible=!1)),this.axis==="XYZE"&&(this.tempQuaternion.setFromEuler(this.tempEuler.set(0,Math.PI/2,0)),this.alignVector.copy(this.rotationAxis),q.quaternion.setFromRotationMatrix(this.lookAtMatrix.lookAt(this.zeroVector,this.alignVector,this.unitY)),q.quaternion.multiply(this.tempQuaternion),q.visible=this.dragging),this.axis==="E"&&(q.visible=!1)):q.name==="START"?(q.position.copy(this.worldPositionStart),q.visible=this.dragging):q.name==="END"?(q.position.copy(this.worldPosition),q.visible=this.dragging):q.name==="DELTA"?(q.position.copy(this.worldPositionStart),q.quaternion.copy(this.worldQuaternionStart),this.tempVector.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),this.tempVector.applyQuaternion(this.worldQuaternionStart.clone().invert()),q.scale.copy(this.tempVector),q.visible=this.dragging):(q.quaternion.copy(F),this.dragging?q.position.copy(this.worldPositionStart):q.position.copy(this.worldPosition),this.axis&&(q.visible=this.axis.search(q.name)!==-1));continue}q.quaternion.copy(F),this.mode==="translate"||this.mode==="scale"?((q.name==="X"||q.name==="XYZX")&&Math.abs(this.alignVector.copy(this.unitX).applyQuaternion(F).dot(this.eye))>.99&&(q.scale.set(1e-10,1e-10,1e-10),q.visible=!1),(q.name==="Y"||q.name==="XYZY")&&Math.abs(this.alignVector.copy(this.unitY).applyQuaternion(F).dot(this.eye))>.99&&(q.scale.set(1e-10,1e-10,1e-10),q.visible=!1),(q.name==="Z"||q.name==="XYZZ")&&Math.abs(this.alignVector.copy(this.unitZ).applyQuaternion(F).dot(this.eye))>.99&&(q.scale.set(1e-10,1e-10,1e-10),q.visible=!1),q.name==="XY"&&Math.abs(this.alignVector.copy(this.unitZ).applyQuaternion(F).dot(this.eye))<.2&&(q.scale.set(1e-10,1e-10,1e-10),q.visible=!1),q.name==="YZ"&&Math.abs(this.alignVector.copy(this.unitX).applyQuaternion(F).dot(this.eye))<.2&&(q.scale.set(1e-10,1e-10,1e-10),q.visible=!1),q.name==="XZ"&&Math.abs(this.alignVector.copy(this.unitY).applyQuaternion(F).dot(this.eye))<.2&&(q.scale.set(1e-10,1e-10,1e-10),q.visible=!1),q.name.search("X")!==-1&&(this.alignVector.copy(this.unitX).applyQuaternion(F).dot(this.eye)<0?q.tag==="fwd"?q.visible=!1:q.scale.x*=-1:q.tag==="bwd"&&(q.visible=!1)),q.name.search("Y")!==-1&&(this.alignVector.copy(this.unitY).applyQuaternion(F).dot(this.eye)<0?q.tag==="fwd"?q.visible=!1:q.scale.y*=-1:q.tag==="bwd"&&(q.visible=!1)),q.name.search("Z")!==-1&&(this.alignVector.copy(this.unitZ).applyQuaternion(F).dot(this.eye)<0?q.tag==="fwd"?q.visible=!1:q.scale.z*=-1:q.tag==="bwd"&&(q.visible=!1))):this.mode==="rotate"&&(this.tempQuaternion2.copy(F),this.alignVector.copy(this.eye).applyQuaternion(this.tempQuaternion.copy(F).invert()),q.name.search("E")!==-1&&q.quaternion.setFromRotationMatrix(this.lookAtMatrix.lookAt(this.eye,this.zeroVector,this.unitY)),q.name==="X"&&(this.tempQuaternion.setFromAxisAngle(this.unitX,Math.atan2(-this.alignVector.y,this.alignVector.z)),this.tempQuaternion.multiplyQuaternions(this.tempQuaternion2,this.tempQuaternion),q.quaternion.copy(this.tempQuaternion)),q.name==="Y"&&(this.tempQuaternion.setFromAxisAngle(this.unitY,Math.atan2(this.alignVector.x,this.alignVector.z)),this.tempQuaternion.multiplyQuaternions(this.tempQuaternion2,this.tempQuaternion),q.quaternion.copy(this.tempQuaternion)),q.name==="Z"&&(this.tempQuaternion.setFromAxisAngle(this.unitZ,Math.atan2(this.alignVector.y,this.alignVector.x)),this.tempQuaternion.multiplyQuaternions(this.tempQuaternion2,this.tempQuaternion),q.quaternion.copy(this.tempQuaternion))),q.visible=q.visible&&(q.name.indexOf("X")===-1||this.showX),q.visible=q.visible&&(q.name.indexOf("Y")===-1||this.showY),q.visible=q.visible&&(q.name.indexOf("Z")===-1||this.showZ),q.visible=q.visible&&(q.name.indexOf("E")===-1||this.showX&&this.showY&&this.showZ),q.material.tempOpacity=q.material.tempOpacity||q.material.opacity,q.material.tempColor=q.material.tempColor||q.material.color.clone(),q.material.color.copy(q.material.tempColor),q.material.opacity=q.material.tempOpacity,this.enabled?this.axis&&(q.name===this.axis?(q.material.opacity=1,q.material.color.lerp(new ut(1,1,1),.5)):this.axis.split("").some(function(re){return q.name===re})?(q.material.opacity=1,q.material.color.lerp(new ut(1,1,1),.5)):(q.material.opacity*=.25,q.material.color.lerp(new ut(1,1,1),.5))):(q.material.opacity*=.5,q.material.color.lerp(new ut(1,1,1),.5))}super.updateMatrixWorld()});const e=new no({depthTest:!1,depthWrite:!1,transparent:!0,side:Li,fog:!1,toneMapped:!1}),t=new vs({depthTest:!1,depthWrite:!1,transparent:!0,linewidth:1,fog:!1,toneMapped:!1}),n=e.clone();n.opacity=.15;const r=e.clone();r.opacity=.33;const s=e.clone();s.color.set(16711680);const o=e.clone();o.color.set(65280);const a=e.clone();a.color.set(255);const l=e.clone();l.opacity=.25;const c=l.clone();c.color.set(16776960);const u=l.clone();u.color.set(65535);const h=l.clone();h.color.set(16711935),e.clone().color.set(16776960);const d=t.clone();d.color.set(16711680);const m=t.clone();m.color.set(65280);const y=t.clone();y.color.set(255);const g=t.clone();g.color.set(65535);const A=t.clone();A.color.set(16711935);const E=t.clone();E.color.set(16776960);const x=t.clone();x.color.set(7895160);const w=E.clone();w.opacity=.25;const T=new yo(0,.05,.2,12,1,!1),I=new ya(.125,.125,.125),M=new fn;M.setAttribute("position",new Gt([0,0,0,1,0,0],3));const L=(W,F)=>{const Y=new fn,te=[];for(let q=0;q<=64*F;++q)te.push(0,Math.cos(q/32*Math.PI)*W,Math.sin(q/32*Math.PI)*W);return Y.setAttribute("position",new Gt(te,3)),Y},P=()=>{const W=new fn;return W.setAttribute("position",new Gt([0,0,0,1,1,1],3)),W},R={X:[[new It(T,s),[1,0,0],[0,0,-Math.PI/2],null,"fwd"],[new It(T,s),[1,0,0],[0,0,Math.PI/2],null,"bwd"],[new $n(M,d)]],Y:[[new It(T,o),[0,1,0],null,null,"fwd"],[new It(T,o),[0,1,0],[Math.PI,0,0],null,"bwd"],[new $n(M,m),null,[0,0,Math.PI/2]]],Z:[[new It(T,a),[0,0,1],[Math.PI/2,0,0],null,"fwd"],[new It(T,a),[0,0,1],[-Math.PI/2,0,0],null,"bwd"],[new $n(M,y),null,[0,-Math.PI/2,0]]],XYZ:[[new It(new rc(.1,0),l.clone()),[0,0,0],[0,0,0]]],XY:[[new It(new Fs(.295,.295),c.clone()),[.15,.15,0]],[new $n(M,E),[.18,.3,0],null,[.125,1,1]],[new $n(M,E),[.3,.18,0],[0,0,Math.PI/2],[.125,1,1]]],YZ:[[new It(new Fs(.295,.295),u.clone()),[0,.15,.15],[0,Math.PI/2,0]],[new $n(M,g),[0,.18,.3],[0,0,Math.PI/2],[.125,1,1]],[new $n(M,g),[0,.3,.18],[0,-Math.PI/2,0],[.125,1,1]]],XZ:[[new It(new Fs(.295,.295),h.clone()),[.15,0,.15],[-Math.PI/2,0,0]],[new $n(M,A),[.18,0,.3],null,[.125,1,1]],[new $n(M,A),[.3,0,.18],[0,-Math.PI/2,0],[.125,1,1]]]},U={X:[[new It(new yo(.2,0,1,4,1,!1),n),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new It(new yo(.2,0,1,4,1,!1),n),[0,.6,0]]],Z:[[new It(new yo(.2,0,1,4,1,!1),n),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new It(new rc(.2,0),n)]],XY:[[new It(new Fs(.4,.4),n),[.2,.2,0]]],YZ:[[new It(new Fs(.4,.4),n),[0,.2,.2],[0,Math.PI/2,0]]],XZ:[[new It(new Fs(.4,.4),n),[.2,0,.2],[-Math.PI/2,0,0]]]},k={START:[[new It(new rc(.01,2),r),null,null,null,"helper"]],END:[[new It(new rc(.01,2),r),null,null,null,"helper"]],DELTA:[[new $n(P(),r),null,null,null,"helper"]],X:[[new $n(M,r.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new $n(M,r.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new $n(M,r.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},H={X:[[new $n(L(1,.5),d)],[new It(new rc(.04,0),s),[0,0,.99],null,[1,3,1]]],Y:[[new $n(L(1,.5),m),null,[0,0,-Math.PI/2]],[new It(new rc(.04,0),o),[0,0,.99],null,[3,1,1]]],Z:[[new $n(L(1,.5),y),null,[0,Math.PI/2,0]],[new It(new rc(.04,0),a),[.99,0,0],null,[1,3,1]]],E:[[new $n(L(1.25,1),w),null,[0,Math.PI/2,0]],[new It(new yo(.03,0,.15,4,1,!1),w),[1.17,0,0],[0,0,-Math.PI/2],[1,1,.001]],[new It(new yo(.03,0,.15,4,1,!1),w),[-1.17,0,0],[0,0,Math.PI/2],[1,1,.001]],[new It(new yo(.03,0,.15,4,1,!1),w),[0,-1.17,0],[Math.PI,0,0],[1,1,.001]],[new It(new yo(.03,0,.15,4,1,!1),w),[0,1.17,0],[0,0,0],[1,1,.001]]],XYZE:[[new $n(L(1,1),x),null,[0,Math.PI/2,0]]]},G={AXIS:[[new $n(M,r.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},X={X:[[new It(new Hd(1,.1,4,24),n),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new It(new Hd(1,.1,4,24),n),[0,0,0],[Math.PI/2,0,0]]],Z:[[new It(new Hd(1,.1,4,24),n),[0,0,0],[0,0,-Math.PI/2]]],E:[[new It(new Hd(1.25,.1,2,24),n)]],XYZE:[[new It(new p0(.7,10,8),n)]]},Z={X:[[new It(I,s),[.8,0,0],[0,0,-Math.PI/2]],[new $n(M,d),null,null,[.8,1,1]]],Y:[[new It(I,o),[0,.8,0]],[new $n(M,m),null,[0,0,Math.PI/2],[.8,1,1]]],Z:[[new It(I,a),[0,0,.8],[Math.PI/2,0,0]],[new $n(M,y),null,[0,-Math.PI/2,0],[.8,1,1]]],XY:[[new It(I,c),[.85,.85,0],null,[2,2,.2]],[new $n(M,E),[.855,.98,0],null,[.125,1,1]],[new $n(M,E),[.98,.855,0],[0,0,Math.PI/2],[.125,1,1]]],YZ:[[new It(I,u),[0,.85,.85],null,[.2,2,2]],[new $n(M,g),[0,.855,.98],[0,0,Math.PI/2],[.125,1,1]],[new $n(M,g),[0,.98,.855],[0,-Math.PI/2,0],[.125,1,1]]],XZ:[[new It(I,h),[.85,0,.85],null,[2,.2,2]],[new $n(M,A),[.855,0,.98],null,[.125,1,1]],[new $n(M,A),[.98,0,.855],[0,-Math.PI/2,0],[.125,1,1]]],XYZX:[[new It(new ya(.125,.125,.125),l.clone()),[1.1,0,0]]],XYZY:[[new It(new ya(.125,.125,.125),l.clone()),[0,1.1,0]]],XYZZ:[[new It(new ya(.125,.125,.125),l.clone()),[0,0,1.1]]]},oe={X:[[new It(new yo(.2,0,.8,4,1,!1),n),[.5,0,0],[0,0,-Math.PI/2]]],Y:[[new It(new yo(.2,0,.8,4,1,!1),n),[0,.5,0]]],Z:[[new It(new yo(.2,0,.8,4,1,!1),n),[0,0,.5],[Math.PI/2,0,0]]],XY:[[new It(I,n),[.85,.85,0],null,[3,3,.2]]],YZ:[[new It(I,n),[0,.85,.85],null,[.2,3,3]]],XZ:[[new It(I,n),[.85,0,.85],null,[3,.2,3]]],XYZX:[[new It(new ya(.2,.2,.2),n),[1.1,0,0]]],XYZY:[[new It(new ya(.2,.2,.2),n),[0,1.1,0]]],XYZZ:[[new It(new ya(.2,.2,.2),n),[0,0,1.1]]]},K={X:[[new $n(M,r.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new $n(M,r.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new $n(M,r.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},V=W=>{const F=new _n;for(let Y in W)for(let te=W[Y].length;te--;){const q=W[Y][te][0].clone(),J=W[Y][te][1],re=W[Y][te][2],ie=W[Y][te][3],se=W[Y][te][4];q.name=Y,q.tag=se,J&&q.position.set(J[0],J[1],J[2]),re&&q.rotation.set(re[0],re[1],re[2]),ie&&q.scale.set(ie[0],ie[1],ie[2]),q.updateMatrix();const ge=q.geometry.clone();ge.applyMatrix4(q.matrix),q.geometry=ge,q.renderOrder=1/0,q.position.set(0,0,0),q.rotation.set(0,0,0),q.scale.set(1,1,1),F.add(q)}return F};this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=V(R)),this.add(this.gizmo.rotate=V(H)),this.add(this.gizmo.scale=V(Z)),this.add(this.picker.translate=V(U)),this.add(this.picker.rotate=V(X)),this.add(this.picker.scale=V(oe)),this.add(this.helper.translate=V(k)),this.add(this.helper.rotate=V(G)),this.add(this.helper.scale=V(K)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}}class Yle extends It{constructor(){super(new Fs(1e5,1e5,2,2),new no({visible:!1,wireframe:!0,side:Li,transparent:!0,opacity:.1,toneMapped:!1})),dt(this,"isTransformControlsPlane",!0),dt(this,"type","TransformControlsPlane"),dt(this,"unitX",new Q(1,0,0)),dt(this,"unitY",new Q(0,1,0)),dt(this,"unitZ",new Q(0,0,1)),dt(this,"tempVector",new Q),dt(this,"dirVector",new Q),dt(this,"alignVector",new Q),dt(this,"tempMatrix",new Xe),dt(this,"identityQuaternion",new Xt),dt(this,"cameraQuaternion",new Xt),dt(this,"worldPosition",new Q),dt(this,"worldQuaternion",new Xt),dt(this,"eye",new Q),dt(this,"axis",null),dt(this,"mode","translate"),dt(this,"space","world"),dt(this,"updateMatrixWorld",()=>{let e=this.space;switch(this.position.copy(this.worldPosition),this.mode==="scale"&&(e="local"),this.unitX.set(1,0,0).applyQuaternion(e==="local"?this.worldQuaternion:this.identityQuaternion),this.unitY.set(0,1,0).applyQuaternion(e==="local"?this.worldQuaternion:this.identityQuaternion),this.unitZ.set(0,0,1).applyQuaternion(e==="local"?this.worldQuaternion:this.identityQuaternion),this.alignVector.copy(this.unitY),this.mode){case"translate":case"scale":switch(this.axis){case"X":this.alignVector.copy(this.eye).cross(this.unitX),this.dirVector.copy(this.unitX).cross(this.alignVector);break;case"Y":this.alignVector.copy(this.eye).cross(this.unitY),this.dirVector.copy(this.unitY).cross(this.alignVector);break;case"Z":this.alignVector.copy(this.eye).cross(this.unitZ),this.dirVector.copy(this.unitZ).cross(this.alignVector);break;case"XY":this.dirVector.copy(this.unitZ);break;case"YZ":this.dirVector.copy(this.unitX);break;case"XZ":this.alignVector.copy(this.unitZ),this.dirVector.copy(this.unitY);break;case"XYZ":case"E":this.dirVector.set(0,0,0);break}break;case"rotate":default:this.dirVector.set(0,0,0)}this.dirVector.length()===0?this.quaternion.copy(this.cameraQuaternion):(this.tempMatrix.lookAt(this.tempVector.set(0,0,0),this.dirVector,this.alignVector),this.quaternion.setFromRotationMatrix(this.tempMatrix)),super.updateMatrixWorld()})}}var $le=Object.defineProperty,Xle=(i,e,t)=>e in i?$le(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Ys=(i,e,t)=>(Xle(i,typeof e!="symbol"?e+"":e,t),t);const Ng=new Eo(0,0,0,"YXZ"),Ug=new Q,qle={type:"change"},Jle={type:"lock"},Zle={type:"unlock"},T9=.002,b9=Math.PI/2;let ece=class extends x0{constructor(e,t){super(),Ys(this,"camera"),Ys(this,"domElement"),Ys(this,"isLocked"),Ys(this,"minPolarAngle"),Ys(this,"maxPolarAngle"),Ys(this,"pointerSpeed"),Ys(this,"onMouseMove",n=>{!this.domElement||this.isLocked===!1||(Ng.setFromQuaternion(this.camera.quaternion),Ng.y-=n.movementX*T9*this.pointerSpeed,Ng.x-=n.movementY*T9*this.pointerSpeed,Ng.x=Math.max(b9-this.maxPolarAngle,Math.min(b9-this.minPolarAngle,Ng.x)),this.camera.quaternion.setFromEuler(Ng),this.dispatchEvent(qle))}),Ys(this,"onPointerlockChange",()=>{this.domElement&&(this.domElement.ownerDocument.pointerLockElement===this.domElement?(this.dispatchEvent(Jle),this.isLocked=!0):(this.dispatchEvent(Zle),this.isLocked=!1))}),Ys(this,"onPointerlockError",()=>{console.error("THREE.PointerLockControls: Unable to use Pointer Lock API")}),Ys(this,"connect",n=>{this.domElement=n||this.domElement,this.domElement&&(this.domElement.ownerDocument.addEventListener("mousemove",this.onMouseMove),this.domElement.ownerDocument.addEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.addEventListener("pointerlockerror",this.onPointerlockError))}),Ys(this,"disconnect",()=>{this.domElement&&(this.domElement.ownerDocument.removeEventListener("mousemove",this.onMouseMove),this.domElement.ownerDocument.removeEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.removeEventListener("pointerlockerror",this.onPointerlockError))}),Ys(this,"dispose",()=>{this.disconnect()}),Ys(this,"getObject",()=>this.camera),Ys(this,"direction",new Q(0,0,-1)),Ys(this,"getDirection",n=>n.copy(this.direction).applyQuaternion(this.camera.quaternion)),Ys(this,"moveForward",n=>{Ug.setFromMatrixColumn(this.camera.matrix,0),Ug.crossVectors(this.camera.up,Ug),this.camera.position.addScaledVector(Ug,n)}),Ys(this,"moveRight",n=>{Ug.setFromMatrixColumn(this.camera.matrix,0),this.camera.position.addScaledVector(Ug,n)}),Ys(this,"lock",()=>{this.domElement&&this.domElement.requestPointerLock()}),Ys(this,"unlock",()=>{this.domElement&&this.domElement.ownerDocument.exitPointerLock()}),this.camera=e,this.domElement=t,this.isLocked=!1,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.pointerSpeed=1,t&&this.connect(t)}};var tce=Object.defineProperty,nce=(i,e,t)=>e in i?tce(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,$s=(i,e,t)=>(nce(i,typeof e!="symbol"?e+"":e,t),t);let ice=class extends x0{constructor(e){super(),$s(this,"object"),$s(this,"changeEvent",{type:"change"}),$s(this,"EPS",1e-6),$s(this,"enabled",!0),$s(this,"deviceOrientation",{alpha:0,beta:0,gamma:0}),$s(this,"screenOrientation",0),$s(this,"alphaOffset",0),$s(this,"onDeviceOrientationChangeEvent",t=>{this.deviceOrientation=t}),$s(this,"onScreenOrientationChangeEvent",()=>{this.screenOrientation=window.orientation||0}),$s(this,"zee",new Q(0,0,1)),$s(this,"euler",new Eo),$s(this,"q0",new Xt),$s(this,"q1",new Xt(-Math.sqrt(.5),0,0,Math.sqrt(.5))),$s(this,"setObjectQuaternion",(t,n,r,s,o)=>{this.euler.set(r,n,-s,"YXZ"),t.setFromEuler(this.euler),t.multiply(this.q1),t.multiply(this.q0.setFromAxisAngle(this.zee,-o))}),$s(this,"connect",()=>{this.onScreenOrientationChangeEvent(),window.DeviceOrientationEvent!==void 0&&typeof window.DeviceOrientationEvent.requestPermission=="function"?window.DeviceOrientationEvent.requestPermission().then(t=>{t=="granted"&&(window.addEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.addEventListener("deviceorientation",this.onDeviceOrientationChangeEvent))}).catch(t=>{console.error("THREE.DeviceOrientationControls: Unable to use DeviceOrientation API:",t)}):(window.addEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.addEventListener("deviceorientation",this.onDeviceOrientationChangeEvent)),this.enabled=!0}),$s(this,"disconnect",()=>{window.removeEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.removeEventListener("deviceorientation",this.onDeviceOrientationChangeEvent),this.enabled=!1}),$s(this,"lastQuaternion",new Xt),$s(this,"update",()=>{if(this.enabled===!1)return;const t=this.deviceOrientation;if(t){const n=t.alpha?un.degToRad(t.alpha)+this.alphaOffset:0,r=t.beta?un.degToRad(t.beta):0,s=t.gamma?un.degToRad(t.gamma):0,o=this.screenOrientation?un.degToRad(this.screenOrientation):0;this.setObjectQuaternion(this.object.quaternion,n,r,s,o),8*(1-this.lastQuaternion.dot(this.object.quaternion))>this.EPS&&(this.lastQuaternion.copy(this.object.quaternion),this.dispatchEvent(this.changeEvent))}}),$s(this,"dispose",()=>this.disconnect()),this.object=e,this.object.rotation.reorder("YXZ"),this.connect()}};var rce=Object.defineProperty,sce=(i,e,t)=>e in i?rce(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Ut=(i,e,t)=>(sce(i,typeof e!="symbol"?e+"":e,t),t);let oce=class extends x0{constructor(e,t){super(),Ut(this,"enabled",!0),Ut(this,"screen",{left:0,top:0,width:0,height:0}),Ut(this,"rotateSpeed",1),Ut(this,"zoomSpeed",1.2),Ut(this,"panSpeed",.3),Ut(this,"noRotate",!1),Ut(this,"noZoom",!1),Ut(this,"noPan",!1),Ut(this,"staticMoving",!1),Ut(this,"dynamicDampingFactor",.2),Ut(this,"minDistance",0),Ut(this,"maxDistance",1/0),Ut(this,"keys",["KeyA","KeyS","KeyD"]),Ut(this,"mouseButtons",{LEFT:oc.ROTATE,MIDDLE:oc.DOLLY,RIGHT:oc.PAN}),Ut(this,"object"),Ut(this,"domElement"),Ut(this,"cursorZoom",!1),Ut(this,"target",new Q),Ut(this,"mousePosition",new Ue),Ut(this,"STATE",{NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4}),Ut(this,"EPS",1e-6),Ut(this,"lastZoom",1),Ut(this,"lastPosition",new Q),Ut(this,"cursorVector",new Q),Ut(this,"targetVector",new Q),Ut(this,"_state",this.STATE.NONE),Ut(this,"_keyState",this.STATE.NONE),Ut(this,"_eye",new Q),Ut(this,"_movePrev",new Ue),Ut(this,"_moveCurr",new Ue),Ut(this,"_lastAxis",new Q),Ut(this,"_lastAngle",0),Ut(this,"_zoomStart",new Ue),Ut(this,"_zoomEnd",new Ue),Ut(this,"_touchZoomDistanceStart",0),Ut(this,"_touchZoomDistanceEnd",0),Ut(this,"_panStart",new Ue),Ut(this,"_panEnd",new Ue),Ut(this,"target0"),Ut(this,"position0"),Ut(this,"up0"),Ut(this,"zoom0"),Ut(this,"changeEvent",{type:"change"}),Ut(this,"startEvent",{type:"start"}),Ut(this,"endEvent",{type:"end"}),Ut(this,"onScreenVector",new Ue),Ut(this,"getMouseOnScreen",(n,r)=>(this.onScreenVector.set((n-this.screen.left)/this.screen.width,(r-this.screen.top)/this.screen.height),this.onScreenVector)),Ut(this,"onCircleVector",new Ue),Ut(this,"getMouseOnCircle",(n,r)=>(this.onCircleVector.set((n-this.screen.width*.5-this.screen.left)/(this.screen.width*.5),(this.screen.height+2*(this.screen.top-r))/this.screen.width),this.onCircleVector)),Ut(this,"axis",new Q),Ut(this,"quaternion",new Xt),Ut(this,"eyeDirection",new Q),Ut(this,"objectUpDirection",new Q),Ut(this,"objectSidewaysDirection",new Q),Ut(this,"moveDirection",new Q),Ut(this,"angle",0),Ut(this,"rotateCamera",()=>{this.moveDirection.set(this._moveCurr.x-this._movePrev.x,this._moveCurr.y-this._movePrev.y,0),this.angle=this.moveDirection.length(),this.angle?(this._eye.copy(this.object.position).sub(this.target),this.eyeDirection.copy(this._eye).normalize(),this.objectUpDirection.copy(this.object.up).normalize(),this.objectSidewaysDirection.crossVectors(this.objectUpDirection,this.eyeDirection).normalize(),this.objectUpDirection.setLength(this._moveCurr.y-this._movePrev.y),this.objectSidewaysDirection.setLength(this._moveCurr.x-this._movePrev.x),this.moveDirection.copy(this.objectUpDirection.add(this.objectSidewaysDirection)),this.axis.crossVectors(this.moveDirection,this._eye).normalize(),this.angle*=this.rotateSpeed,this.quaternion.setFromAxisAngle(this.axis,this.angle),this._eye.applyQuaternion(this.quaternion),this.object.up.applyQuaternion(this.quaternion),this._lastAxis.copy(this.axis),this._lastAngle=this.angle):!this.staticMoving&&this._lastAngle&&(this._lastAngle*=Math.sqrt(1-this.dynamicDampingFactor),this._eye.copy(this.object.position).sub(this.target),this.quaternion.setFromAxisAngle(this._lastAxis,this._lastAngle),this._eye.applyQuaternion(this.quaternion),this.object.up.applyQuaternion(this.quaternion)),this._movePrev.copy(this._moveCurr)}),Ut(this,"zoomCamera",()=>{let n;if(this._state===this.STATE.TOUCH_ZOOM_PAN)n=this._touchZoomDistanceStart/this._touchZoomDistanceEnd,this._touchZoomDistanceStart=this._touchZoomDistanceEnd,this.object.isPerspectiveCamera?this._eye.multiplyScalar(n):this.object.isOrthographicCamera?(this.object.zoom/=n,this.object.updateProjectionMatrix()):console.warn("THREE.TrackballControls: Unsupported camera type");else{if(n=1+(this._zoomEnd.y-this._zoomStart.y)*this.zoomSpeed,Math.abs(n-1)>this.EPS&&n>0&&(this.object.isPerspectiveCamera?(n>1&&this._eye.length()>=this.maxDistance-this.EPS&&(n=1),this._eye.multiplyScalar(n)):this.object.isOrthographicCamera?(n>1&&this.object.zoom<this.maxDistance*this.maxDistance&&(n=1),this.object.zoom/=n):console.warn("THREE.TrackballControls: Unsupported camera type")),this.staticMoving?this._zoomStart.copy(this._zoomEnd):this._zoomStart.y+=(this._zoomEnd.y-this._zoomStart.y)*this.dynamicDampingFactor,this.cursorZoom){this.targetVector.copy(this.target).project(this.object);let r=this.cursorVector.set(this.mousePosition.x,this.mousePosition.y,this.targetVector.z).unproject(this.object);this.target.lerpVectors(r,this.target,n)}this.object.isOrthographicCamera&&this.object.updateProjectionMatrix()}}),Ut(this,"mouseChange",new Ue),Ut(this,"objectUp",new Q),Ut(this,"pan",new Q),Ut(this,"panCamera",()=>{if(this.domElement&&(this.mouseChange.copy(this._panEnd).sub(this._panStart),this.mouseChange.lengthSq()>this.EPS)){if(this.object.isOrthographicCamera){const n=this.object,r=(n.right-n.left)/this.object.zoom,s=(n.top-n.bottom)/this.object.zoom;this.mouseChange.x*=r,this.mouseChange.y*=s}else this.mouseChange.multiplyScalar(this._eye.length()*this.panSpeed);this.pan.copy(this._eye).cross(this.object.up).setLength(this.mouseChange.x),this.pan.add(this.objectUp.copy(this.object.up).setLength(this.mouseChange.y)),this.object.position.add(this.pan),this.target.add(this.pan),this.staticMoving?this._panStart.copy(this._panEnd):this._panStart.add(this.mouseChange.subVectors(this._panEnd,this._panStart).multiplyScalar(this.dynamicDampingFactor))}}),Ut(this,"checkDistances",()=>{(!this.noZoom||!this.noPan)&&(this._eye.lengthSq()>this.maxDistance*this.maxDistance&&(this.object.position.addVectors(this.target,this._eye.setLength(this.maxDistance)),this._zoomStart.copy(this._zoomEnd)),this._eye.lengthSq()<this.minDistance*this.minDistance&&(this.object.position.addVectors(this.target,this._eye.setLength(this.minDistance)),this._zoomStart.copy(this._zoomEnd)))}),Ut(this,"handleResize",()=>{if(!this.domElement)return;const n=this.domElement.getBoundingClientRect(),r=this.domElement.ownerDocument.documentElement;this.screen.left=n.left+window.pageXOffset-r.clientLeft,this.screen.top=n.top+window.pageYOffset-r.clientTop,this.screen.width=n.width,this.screen.height=n.height}),Ut(this,"update",()=>{this._eye.subVectors(this.object.position,this.target),this.noRotate||this.rotateCamera(),this.noZoom||this.zoomCamera(),this.noPan||this.panCamera(),this.object.position.addVectors(this.target,this._eye),this.object.isPerspectiveCamera?(this.checkDistances(),this.object.lookAt(this.target),this.lastPosition.distanceToSquared(this.object.position)>this.EPS&&(this.dispatchEvent(this.changeEvent),this.lastPosition.copy(this.object.position))):this.object.isOrthographicCamera?(this.object.lookAt(this.target),(this.lastPosition.distanceToSquared(this.object.position)>this.EPS||this.lastZoom!==this.object.zoom)&&(this.dispatchEvent(this.changeEvent),this.lastPosition.copy(this.object.position),this.lastZoom=this.object.zoom)):console.warn("THREE.TrackballControls: Unsupported camera type")}),Ut(this,"reset",()=>{this._state=this.STATE.NONE,this._keyState=this.STATE.NONE,this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.up.copy(this.up0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this._eye.subVectors(this.object.position,this.target),this.object.lookAt(this.target),this.dispatchEvent(this.changeEvent),this.lastPosition.copy(this.object.position),this.lastZoom=this.object.zoom}),Ut(this,"keydown",n=>{this.enabled!==!1&&(window.removeEventListener("keydown",this.keydown),this._keyState===this.STATE.NONE&&(n.code===this.keys[this.STATE.ROTATE]&&!this.noRotate?this._keyState=this.STATE.ROTATE:n.code===this.keys[this.STATE.ZOOM]&&!this.noZoom?this._keyState=this.STATE.ZOOM:n.code===this.keys[this.STATE.PAN]&&!this.noPan&&(this._keyState=this.STATE.PAN)))}),Ut(this,"onPointerDown",n=>{if(this.enabled!==!1)switch(n.pointerType){case"mouse":case"pen":this.onMouseDown(n);break}}),Ut(this,"onPointerMove",n=>{if(this.enabled!==!1)switch(n.pointerType){case"mouse":case"pen":this.onMouseMove(n);break}}),Ut(this,"onPointerUp",n=>{if(this.enabled!==!1)switch(n.pointerType){case"mouse":case"pen":this.onMouseUp();break}}),Ut(this,"keyup",()=>{this.enabled!==!1&&(this._keyState=this.STATE.NONE,window.addEventListener("keydown",this.keydown))}),Ut(this,"onMouseDown",n=>{if(!this.domElement)return;if(this._state===this.STATE.NONE)switch(n.button){case this.mouseButtons.LEFT:this._state=this.STATE.ROTATE;break;case this.mouseButtons.MIDDLE:this._state=this.STATE.ZOOM;break;case this.mouseButtons.RIGHT:this._state=this.STATE.PAN;break}const r=this._keyState!==this.STATE.NONE?this._keyState:this._state;r===this.STATE.ROTATE&&!this.noRotate?(this._moveCurr.copy(this.getMouseOnCircle(n.pageX,n.pageY)),this._movePrev.copy(this._moveCurr)):r===this.STATE.ZOOM&&!this.noZoom?(this._zoomStart.copy(this.getMouseOnScreen(n.pageX,n.pageY)),this._zoomEnd.copy(this._zoomStart)):r===this.STATE.PAN&&!this.noPan&&(this._panStart.copy(this.getMouseOnScreen(n.pageX,n.pageY)),this._panEnd.copy(this._panStart)),this.domElement.ownerDocument.addEventListener("pointermove",this.onPointerMove),this.domElement.ownerDocument.addEventListener("pointerup",this.onPointerUp),this.dispatchEvent(this.startEvent)}),Ut(this,"onMouseMove",n=>{if(this.enabled===!1)return;const r=this._keyState!==this.STATE.NONE?this._keyState:this._state;r===this.STATE.ROTATE&&!this.noRotate?(this._movePrev.copy(this._moveCurr),this._moveCurr.copy(this.getMouseOnCircle(n.pageX,n.pageY))):r===this.STATE.ZOOM&&!this.noZoom?this._zoomEnd.copy(this.getMouseOnScreen(n.pageX,n.pageY)):r===this.STATE.PAN&&!this.noPan&&this._panEnd.copy(this.getMouseOnScreen(n.pageX,n.pageY))}),Ut(this,"onMouseUp",()=>{this.domElement&&this.enabled!==!1&&(this._state=this.STATE.NONE,this.domElement.ownerDocument.removeEventListener("pointermove",this.onPointerMove),this.domElement.ownerDocument.removeEventListener("pointerup",this.onPointerUp),this.dispatchEvent(this.endEvent))}),Ut(this,"mousewheel",n=>{if(this.enabled!==!1&&this.noZoom!==!0){switch(n.preventDefault(),n.deltaMode){case 2:this._zoomStart.y-=n.deltaY*.025;break;case 1:this._zoomStart.y-=n.deltaY*.01;break;default:this._zoomStart.y-=n.deltaY*25e-5;break}this.mousePosition.x=n.offsetX/this.screen.width*2-1,this.mousePosition.y=-(n.offsetY/this.screen.height)*2+1,this.dispatchEvent(this.startEvent),this.dispatchEvent(this.endEvent)}}),Ut(this,"touchstart",n=>{if(this.enabled!==!1){switch(n.preventDefault(),n.touches.length){case 1:this._state=this.STATE.TOUCH_ROTATE,this._moveCurr.copy(this.getMouseOnCircle(n.touches[0].pageX,n.touches[0].pageY)),this._movePrev.copy(this._moveCurr);break;default:this._state=this.STATE.TOUCH_ZOOM_PAN;const r=n.touches[0].pageX-n.touches[1].pageX,s=n.touches[0].pageY-n.touches[1].pageY;this._touchZoomDistanceEnd=this._touchZoomDistanceStart=Math.sqrt(r*r+s*s);const o=(n.touches[0].pageX+n.touches[1].pageX)/2,a=(n.touches[0].pageY+n.touches[1].pageY)/2;this._panStart.copy(this.getMouseOnScreen(o,a)),this._panEnd.copy(this._panStart);break}this.dispatchEvent(this.startEvent)}}),Ut(this,"touchmove",n=>{if(this.enabled!==!1)switch(n.preventDefault(),n.touches.length){case 1:this._movePrev.copy(this._moveCurr),this._moveCurr.copy(this.getMouseOnCircle(n.touches[0].pageX,n.touches[0].pageY));break;default:const r=n.touches[0].pageX-n.touches[1].pageX,s=n.touches[0].pageY-n.touches[1].pageY;this._touchZoomDistanceEnd=Math.sqrt(r*r+s*s);const o=(n.touches[0].pageX+n.touches[1].pageX)/2,a=(n.touches[0].pageY+n.touches[1].pageY)/2;this._panEnd.copy(this.getMouseOnScreen(o,a));break}}),Ut(this,"touchend",n=>{if(this.enabled!==!1){switch(n.touches.length){case 0:this._state=this.STATE.NONE;break;case 1:this._state=this.STATE.TOUCH_ROTATE,this._moveCurr.copy(this.getMouseOnCircle(n.touches[0].pageX,n.touches[0].pageY)),this._movePrev.copy(this._moveCurr);break}this.dispatchEvent(this.endEvent)}}),Ut(this,"contextmenu",n=>{this.enabled!==!1&&n.preventDefault()}),Ut(this,"connect",n=>{n===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.domElement=n,this.domElement.addEventListener("contextmenu",this.contextmenu),this.domElement.addEventListener("pointerdown",this.onPointerDown),this.domElement.addEventListener("wheel",this.mousewheel),this.domElement.addEventListener("touchstart",this.touchstart),this.domElement.addEventListener("touchend",this.touchend),this.domElement.addEventListener("touchmove",this.touchmove),this.domElement.ownerDocument.addEventListener("pointermove",this.onPointerMove),this.domElement.ownerDocument.addEventListener("pointerup",this.onPointerUp),window.addEventListener("keydown",this.keydown),window.addEventListener("keyup",this.keyup),this.handleResize()}),Ut(this,"dispose",()=>{this.domElement&&(this.domElement.removeEventListener("contextmenu",this.contextmenu),this.domElement.removeEventListener("pointerdown",this.onPointerDown),this.domElement.removeEventListener("wheel",this.mousewheel),this.domElement.removeEventListener("touchstart",this.touchstart),this.domElement.removeEventListener("touchend",this.touchend),this.domElement.removeEventListener("touchmove",this.touchmove),this.domElement.ownerDocument.removeEventListener("pointermove",this.onPointerMove),this.domElement.ownerDocument.removeEventListener("pointerup",this.onPointerUp),window.removeEventListener("keydown",this.keydown),window.removeEventListener("keyup",this.keyup))}),this.object=e,this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.up0=this.object.up.clone(),this.zoom0=this.object.zoom,t!==void 0&&this.connect(t),this.update()}};var ace=Object.defineProperty,lce=(i,e,t)=>e in i?ace(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Mn=(i,e,t)=>(lce(i,typeof e!="symbol"?e+"":e,t),t);const LE=new vc,I9=new vo,cce=Math.cos(70*(Math.PI/180)),M9=(i,e)=>(i%e+e)%e;let mH=class extends x0{constructor(e,t){super(),Mn(this,"object"),Mn(this,"domElement"),Mn(this,"enabled",!0),Mn(this,"target",new Q),Mn(this,"minDistance",0),Mn(this,"maxDistance",1/0),Mn(this,"minZoom",0),Mn(this,"maxZoom",1/0),Mn(this,"minPolarAngle",0),Mn(this,"maxPolarAngle",Math.PI),Mn(this,"minAzimuthAngle",-1/0),Mn(this,"maxAzimuthAngle",1/0),Mn(this,"enableDamping",!1),Mn(this,"dampingFactor",.05),Mn(this,"enableZoom",!0),Mn(this,"zoomSpeed",1),Mn(this,"enableRotate",!0),Mn(this,"rotateSpeed",1),Mn(this,"enablePan",!0),Mn(this,"panSpeed",1),Mn(this,"screenSpacePanning",!0),Mn(this,"keyPanSpeed",7),Mn(this,"zoomToCursor",!1),Mn(this,"autoRotate",!1),Mn(this,"autoRotateSpeed",2),Mn(this,"reverseOrbit",!1),Mn(this,"reverseHorizontalOrbit",!1),Mn(this,"reverseVerticalOrbit",!1),Mn(this,"keys",{LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"}),Mn(this,"mouseButtons",{LEFT:oc.ROTATE,MIDDLE:oc.DOLLY,RIGHT:oc.PAN}),Mn(this,"touches",{ONE:Sf.ROTATE,TWO:Sf.DOLLY_PAN}),Mn(this,"target0"),Mn(this,"position0"),Mn(this,"zoom0"),Mn(this,"_domElementKeyEvents",null),Mn(this,"getPolarAngle"),Mn(this,"getAzimuthalAngle"),Mn(this,"setPolarAngle"),Mn(this,"setAzimuthalAngle"),Mn(this,"getDistance"),Mn(this,"getZoomScale"),Mn(this,"listenToKeyEvents"),Mn(this,"stopListenToKeyEvents"),Mn(this,"saveState"),Mn(this,"reset"),Mn(this,"update"),Mn(this,"connect"),Mn(this,"dispose"),Mn(this,"dollyIn"),Mn(this,"dollyOut"),Mn(this,"getScale"),Mn(this,"setScale"),this.object=e,this.domElement=t,this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=()=>u.phi,this.getAzimuthalAngle=()=>u.theta,this.setPolarAngle=Ce=>{let qe=M9(Ce,2*Math.PI),At=u.phi;At<0&&(At+=2*Math.PI),qe<0&&(qe+=2*Math.PI);let yt=Math.abs(qe-At);2*Math.PI-yt<yt&&(qe<At?qe+=2*Math.PI:At+=2*Math.PI),h.phi=qe-At,n.update()},this.setAzimuthalAngle=Ce=>{let qe=M9(Ce,2*Math.PI),At=u.theta;At<0&&(At+=2*Math.PI),qe<0&&(qe+=2*Math.PI);let yt=Math.abs(qe-At);2*Math.PI-yt<yt&&(qe<At?qe+=2*Math.PI:At+=2*Math.PI),h.theta=qe-At,n.update()},this.getDistance=()=>n.object.position.distanceTo(n.target),this.listenToKeyEvents=Ce=>{Ce.addEventListener("keydown",ct),this._domElementKeyEvents=Ce},this.stopListenToKeyEvents=()=>{this._domElementKeyEvents.removeEventListener("keydown",ct),this._domElementKeyEvents=null},this.saveState=()=>{n.target0.copy(n.target),n.position0.copy(n.object.position),n.zoom0=n.object.zoom},this.reset=()=>{n.target.copy(n.target0),n.object.position.copy(n.position0),n.object.zoom=n.zoom0,n.object.updateProjectionMatrix(),n.dispatchEvent(r),n.update(),l=a.NONE},this.update=(()=>{const Ce=new Q,qe=new Q(0,1,0),At=new Xt().setFromUnitVectors(e.up,qe),yt=At.clone().invert(),Be=new Q,we=new Xt,_t=2*Math.PI;return function(){const bt=n.object.position;At.setFromUnitVectors(e.up,qe),yt.copy(At).invert(),Ce.copy(bt).sub(n.target),Ce.applyQuaternion(At),u.setFromVector3(Ce),n.autoRotate&&l===a.NONE&&G(k()),n.enableDamping?(u.theta+=h.theta*n.dampingFactor,u.phi+=h.phi*n.dampingFactor):(u.theta+=h.theta,u.phi+=h.phi);let Lt=n.minAzimuthAngle,qt=n.maxAzimuthAngle;isFinite(Lt)&&isFinite(qt)&&(Lt<-Math.PI?Lt+=_t:Lt>Math.PI&&(Lt-=_t),qt<-Math.PI?qt+=_t:qt>Math.PI&&(qt-=_t),Lt<=qt?u.theta=Math.max(Lt,Math.min(qt,u.theta)):u.theta=u.theta>(Lt+qt)/2?Math.max(Lt,u.theta):Math.min(qt,u.theta)),u.phi=Math.max(n.minPolarAngle,Math.min(n.maxPolarAngle,u.phi)),u.makeSafe(),n.enableDamping===!0?n.target.addScaledVector(d,n.dampingFactor):n.target.add(d),n.zoomToCursor&&P||n.object.isOrthographicCamera?u.radius=te(u.radius):u.radius=te(u.radius*f),Ce.setFromSpherical(u),Ce.applyQuaternion(yt),bt.copy(n.target).add(Ce),n.object.matrixAutoUpdate||n.object.updateMatrix(),n.object.lookAt(n.target),n.enableDamping===!0?(h.theta*=1-n.dampingFactor,h.phi*=1-n.dampingFactor,d.multiplyScalar(1-n.dampingFactor)):(h.set(0,0,0),d.set(0,0,0));let Nt=!1;if(n.zoomToCursor&&P){let dn=null;if(n.object instanceof jn&&n.object.isPerspectiveCamera){const Vn=Ce.length();dn=te(Vn*f);const pn=Vn-dn;n.object.position.addScaledVector(M,pn),n.object.updateMatrixWorld()}else if(n.object.isOrthographicCamera){const Vn=new Q(L.x,L.y,0);Vn.unproject(n.object),n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/f)),n.object.updateProjectionMatrix(),Nt=!0;const pn=new Q(L.x,L.y,0);pn.unproject(n.object),n.object.position.sub(pn).add(Vn),n.object.updateMatrixWorld(),dn=Ce.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),n.zoomToCursor=!1;dn!==null&&(n.screenSpacePanning?n.target.set(0,0,-1).transformDirection(n.object.matrix).multiplyScalar(dn).add(n.object.position):(LE.origin.copy(n.object.position),LE.direction.set(0,0,-1).transformDirection(n.object.matrix),Math.abs(n.object.up.dot(LE.direction))<cce?e.lookAt(n.target):(I9.setFromNormalAndCoplanarPoint(n.object.up,n.target),LE.intersectPlane(I9,n.target))))}else n.object instanceof qi&&n.object.isOrthographicCamera&&(Nt=f!==1,Nt&&(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/f)),n.object.updateProjectionMatrix()));return f=1,P=!1,Nt||Be.distanceToSquared(n.object.position)>c||8*(1-we.dot(n.object.quaternion))>c?(n.dispatchEvent(r),Be.copy(n.object.position),we.copy(n.object.quaternion),Nt=!1,!0):!1}})(),this.connect=Ce=>{n.domElement=Ce,n.domElement.style.touchAction="none",n.domElement.addEventListener("contextmenu",Mt),n.domElement.addEventListener("pointerdown",Re),n.domElement.addEventListener("pointercancel",Fe),n.domElement.addEventListener("wheel",Ye)},this.dispose=()=>{var Ce,qe,At,yt,Be,we;n.domElement&&(n.domElement.style.touchAction="auto"),(Ce=n.domElement)==null||Ce.removeEventListener("contextmenu",Mt),(qe=n.domElement)==null||qe.removeEventListener("pointerdown",Re),(At=n.domElement)==null||At.removeEventListener("pointercancel",Fe),(yt=n.domElement)==null||yt.removeEventListener("wheel",Ye),(Be=n.domElement)==null||Be.ownerDocument.removeEventListener("pointermove",Le),(we=n.domElement)==null||we.ownerDocument.removeEventListener("pointerup",Fe),n._domElementKeyEvents!==null&&n._domElementKeyEvents.removeEventListener("keydown",ct)};const n=this,r={type:"change"},s={type:"start"},o={type:"end"},a={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let l=a.NONE;const c=1e-6,u=new t0,h=new t0;let f=1;const d=new Q,m=new Ue,y=new Ue,g=new Ue,A=new Ue,E=new Ue,x=new Ue,w=new Ue,T=new Ue,I=new Ue,M=new Q,L=new Ue;let P=!1;const R=[],U={};function k(){return 2*Math.PI/60/60*n.autoRotateSpeed}function H(){return Math.pow(.95,n.zoomSpeed)}function G(Ce){n.reverseOrbit||n.reverseHorizontalOrbit?h.theta+=Ce:h.theta-=Ce}function X(Ce){n.reverseOrbit||n.reverseVerticalOrbit?h.phi+=Ce:h.phi-=Ce}const Z=(()=>{const Ce=new Q;return function(At,yt){Ce.setFromMatrixColumn(yt,0),Ce.multiplyScalar(-At),d.add(Ce)}})(),oe=(()=>{const Ce=new Q;return function(At,yt){n.screenSpacePanning===!0?Ce.setFromMatrixColumn(yt,1):(Ce.setFromMatrixColumn(yt,0),Ce.crossVectors(n.object.up,Ce)),Ce.multiplyScalar(At),d.add(Ce)}})(),K=(()=>{const Ce=new Q;return function(At,yt){const Be=n.domElement;if(Be&&n.object instanceof jn&&n.object.isPerspectiveCamera){const we=n.object.position;Ce.copy(we).sub(n.target);let _t=Ce.length();_t*=Math.tan(n.object.fov/2*Math.PI/180),Z(2*At*_t/Be.clientHeight,n.object.matrix),oe(2*yt*_t/Be.clientHeight,n.object.matrix)}else Be&&n.object instanceof qi&&n.object.isOrthographicCamera?(Z(At*(n.object.right-n.object.left)/n.object.zoom/Be.clientWidth,n.object.matrix),oe(yt*(n.object.top-n.object.bottom)/n.object.zoom/Be.clientHeight,n.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),n.enablePan=!1)}})();function V(Ce){n.object instanceof jn&&n.object.isPerspectiveCamera||n.object instanceof qi&&n.object.isOrthographicCamera?f=Ce:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function W(Ce){V(f/Ce)}function F(Ce){V(f*Ce)}function Y(Ce){if(!n.zoomToCursor||!n.domElement)return;P=!0;const qe=n.domElement.getBoundingClientRect(),At=Ce.clientX-qe.left,yt=Ce.clientY-qe.top,Be=qe.width,we=qe.height;L.x=At/Be*2-1,L.y=-(yt/we)*2+1,M.set(L.x,L.y,1).unproject(n.object).sub(n.object.position).normalize()}function te(Ce){return Math.max(n.minDistance,Math.min(n.maxDistance,Ce))}function q(Ce){m.set(Ce.clientX,Ce.clientY)}function J(Ce){Y(Ce),w.set(Ce.clientX,Ce.clientY)}function re(Ce){A.set(Ce.clientX,Ce.clientY)}function ie(Ce){y.set(Ce.clientX,Ce.clientY),g.subVectors(y,m).multiplyScalar(n.rotateSpeed);const qe=n.domElement;qe&&(G(2*Math.PI*g.x/qe.clientHeight),X(2*Math.PI*g.y/qe.clientHeight)),m.copy(y),n.update()}function se(Ce){T.set(Ce.clientX,Ce.clientY),I.subVectors(T,w),I.y>0?W(H()):I.y<0&&F(H()),w.copy(T),n.update()}function ge(Ce){E.set(Ce.clientX,Ce.clientY),x.subVectors(E,A).multiplyScalar(n.panSpeed),K(x.x,x.y),A.copy(E),n.update()}function xe(Ce){Y(Ce),Ce.deltaY<0?F(H()):Ce.deltaY>0&&W(H()),n.update()}function pe(Ce){let qe=!1;switch(Ce.code){case n.keys.UP:K(0,n.keyPanSpeed),qe=!0;break;case n.keys.BOTTOM:K(0,-n.keyPanSpeed),qe=!0;break;case n.keys.LEFT:K(n.keyPanSpeed,0),qe=!0;break;case n.keys.RIGHT:K(-n.keyPanSpeed,0),qe=!0;break}qe&&(Ce.preventDefault(),n.update())}function ue(){if(R.length==1)m.set(R[0].pageX,R[0].pageY);else{const Ce=.5*(R[0].pageX+R[1].pageX),qe=.5*(R[0].pageY+R[1].pageY);m.set(Ce,qe)}}function Me(){if(R.length==1)A.set(R[0].pageX,R[0].pageY);else{const Ce=.5*(R[0].pageX+R[1].pageX),qe=.5*(R[0].pageY+R[1].pageY);A.set(Ce,qe)}}function Se(){const Ce=R[0].pageX-R[1].pageX,qe=R[0].pageY-R[1].pageY,At=Math.sqrt(Ce*Ce+qe*qe);w.set(0,At)}function ve(){n.enableZoom&&Se(),n.enablePan&&Me()}function Ae(){n.enableZoom&&Se(),n.enableRotate&&ue()}function ke(Ce){if(R.length==1)y.set(Ce.pageX,Ce.pageY);else{const At=ft(Ce),yt=.5*(Ce.pageX+At.x),Be=.5*(Ce.pageY+At.y);y.set(yt,Be)}g.subVectors(y,m).multiplyScalar(n.rotateSpeed);const qe=n.domElement;qe&&(G(2*Math.PI*g.x/qe.clientHeight),X(2*Math.PI*g.y/qe.clientHeight)),m.copy(y)}function be(Ce){if(R.length==1)E.set(Ce.pageX,Ce.pageY);else{const qe=ft(Ce),At=.5*(Ce.pageX+qe.x),yt=.5*(Ce.pageY+qe.y);E.set(At,yt)}x.subVectors(E,A).multiplyScalar(n.panSpeed),K(x.x,x.y),A.copy(E)}function ne(Ce){const qe=ft(Ce),At=Ce.pageX-qe.x,yt=Ce.pageY-qe.y,Be=Math.sqrt(At*At+yt*yt);T.set(0,Be),I.set(0,Math.pow(T.y/w.y,n.zoomSpeed)),W(I.y),w.copy(T)}function j(Ce){n.enableZoom&&ne(Ce),n.enablePan&&be(Ce)}function de(Ce){n.enableZoom&&ne(Ce),n.enableRotate&&ke(Ce)}function Re(Ce){var qe,At;n.enabled!==!1&&(R.length===0&&((qe=n.domElement)==null||qe.ownerDocument.addEventListener("pointermove",Le),(At=n.domElement)==null||At.ownerDocument.addEventListener("pointerup",Fe)),Ft(Ce),Ce.pointerType==="touch"?pt(Ce):He(Ce))}function Le(Ce){n.enabled!==!1&&(Ce.pointerType==="touch"?je(Ce):it(Ce))}function Fe(Ce){var qe,At,yt;St(Ce),R.length===0&&((qe=n.domElement)==null||qe.releasePointerCapture(Ce.pointerId),(At=n.domElement)==null||At.ownerDocument.removeEventListener("pointermove",Le),(yt=n.domElement)==null||yt.ownerDocument.removeEventListener("pointerup",Fe)),n.dispatchEvent(o),l=a.NONE}function He(Ce){let qe;switch(Ce.button){case 0:qe=n.mouseButtons.LEFT;break;case 1:qe=n.mouseButtons.MIDDLE;break;case 2:qe=n.mouseButtons.RIGHT;break;default:qe=-1}switch(qe){case oc.DOLLY:if(n.enableZoom===!1)return;J(Ce),l=a.DOLLY;break;case oc.ROTATE:if(Ce.ctrlKey||Ce.metaKey||Ce.shiftKey){if(n.enablePan===!1)return;re(Ce),l=a.PAN}else{if(n.enableRotate===!1)return;q(Ce),l=a.ROTATE}break;case oc.PAN:if(Ce.ctrlKey||Ce.metaKey||Ce.shiftKey){if(n.enableRotate===!1)return;q(Ce),l=a.ROTATE}else{if(n.enablePan===!1)return;re(Ce),l=a.PAN}break;default:l=a.NONE}l!==a.NONE&&n.dispatchEvent(s)}function it(Ce){if(n.enabled!==!1)switch(l){case a.ROTATE:if(n.enableRotate===!1)return;ie(Ce);break;case a.DOLLY:if(n.enableZoom===!1)return;se(Ce);break;case a.PAN:if(n.enablePan===!1)return;ge(Ce);break}}function Ye(Ce){n.enabled===!1||n.enableZoom===!1||l!==a.NONE&&l!==a.ROTATE||(Ce.preventDefault(),n.dispatchEvent(s),xe(Ce),n.dispatchEvent(o))}function ct(Ce){n.enabled===!1||n.enablePan===!1||pe(Ce)}function pt(Ce){switch(gt(Ce),R.length){case 1:switch(n.touches.ONE){case Sf.ROTATE:if(n.enableRotate===!1)return;ue(),l=a.TOUCH_ROTATE;break;case Sf.PAN:if(n.enablePan===!1)return;Me(),l=a.TOUCH_PAN;break;default:l=a.NONE}break;case 2:switch(n.touches.TWO){case Sf.DOLLY_PAN:if(n.enableZoom===!1&&n.enablePan===!1)return;ve(),l=a.TOUCH_DOLLY_PAN;break;case Sf.DOLLY_ROTATE:if(n.enableZoom===!1&&n.enableRotate===!1)return;Ae(),l=a.TOUCH_DOLLY_ROTATE;break;default:l=a.NONE}break;default:l=a.NONE}l!==a.NONE&&n.dispatchEvent(s)}function je(Ce){switch(gt(Ce),l){case a.TOUCH_ROTATE:if(n.enableRotate===!1)return;ke(Ce),n.update();break;case a.TOUCH_PAN:if(n.enablePan===!1)return;be(Ce),n.update();break;case a.TOUCH_DOLLY_PAN:if(n.enableZoom===!1&&n.enablePan===!1)return;j(Ce),n.update();break;case a.TOUCH_DOLLY_ROTATE:if(n.enableZoom===!1&&n.enableRotate===!1)return;de(Ce),n.update();break;default:l=a.NONE}}function Mt(Ce){n.enabled!==!1&&Ce.preventDefault()}function Ft(Ce){R.push(Ce)}function St(Ce){delete U[Ce.pointerId];for(let qe=0;qe<R.length;qe++)if(R[qe].pointerId==Ce.pointerId){R.splice(qe,1);return}}function gt(Ce){let qe=U[Ce.pointerId];qe===void 0&&(qe=new Ue,U[Ce.pointerId]=qe),qe.set(Ce.pageX,Ce.pageY)}function ft(Ce){const qe=Ce.pointerId===R[0].pointerId?R[1]:R[0];return U[qe.pointerId]}this.dollyIn=(Ce=H())=>{F(Ce),n.update()},this.dollyOut=(Ce=H())=>{W(Ce),n.update()},this.getScale=()=>f,this.setScale=Ce=>{V(Ce),n.update()},this.getZoomScale=()=>H(),t!==void 0&&this.connect(t),this.update()}},uce=class extends mH{constructor(e,t){super(e,t),this.screenSpacePanning=!1,this.mouseButtons.LEFT=oc.PAN,this.mouseButtons.RIGHT=oc.ROTATE,this.touches.ONE=Sf.PAN,this.touches.TWO=Sf.DOLLY_ROTATE}};var hce=Object.defineProperty,fce=(i,e,t)=>e in i?hce(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,tt=(i,e,t)=>(fce(i,typeof e!="symbol"?e+"":e,t),t);const En={IDLE:Symbol(),ROTATE:Symbol(),PAN:Symbol(),SCALE:Symbol(),FOV:Symbol(),FOCUS:Symbol(),ZROTATE:Symbol(),ANIMATION_FOCUS:Symbol(),ANIMATION_ROTATE:Symbol()},Hi={NONE:Symbol(),ONE_FINGER:Symbol(),ONE_FINGER_SWITCHED:Symbol(),TWO_FINGER:Symbol(),MULT_FINGER:Symbol(),CURSOR:Symbol()},ei={x:0,y:0},xl={camera:new Xe,gizmos:new Xe},Sr={type:"change"},ru={type:"start"},Zl={type:"end"};let dce=class extends x0{constructor(e,t=null,n=null){super(),tt(this,"camera"),tt(this,"domElement"),tt(this,"scene"),tt(this,"mouseActions"),tt(this,"_mouseOp"),tt(this,"_v2_1"),tt(this,"_v3_1"),tt(this,"_v3_2"),tt(this,"_m4_1"),tt(this,"_m4_2"),tt(this,"_quat"),tt(this,"_translationMatrix"),tt(this,"_rotationMatrix"),tt(this,"_scaleMatrix"),tt(this,"_rotationAxis"),tt(this,"_cameraMatrixState"),tt(this,"_cameraProjectionState"),tt(this,"_fovState"),tt(this,"_upState"),tt(this,"_zoomState"),tt(this,"_nearPos"),tt(this,"_farPos"),tt(this,"_gizmoMatrixState"),tt(this,"_up0"),tt(this,"_zoom0"),tt(this,"_fov0"),tt(this,"_initialNear"),tt(this,"_nearPos0"),tt(this,"_initialFar"),tt(this,"_farPos0"),tt(this,"_cameraMatrixState0"),tt(this,"_gizmoMatrixState0"),tt(this,"_button"),tt(this,"_touchStart"),tt(this,"_touchCurrent"),tt(this,"_input"),tt(this,"_switchSensibility"),tt(this,"_startFingerDistance"),tt(this,"_currentFingerDistance"),tt(this,"_startFingerRotation"),tt(this,"_currentFingerRotation"),tt(this,"_devPxRatio"),tt(this,"_downValid"),tt(this,"_nclicks"),tt(this,"_downEvents"),tt(this,"_clickStart"),tt(this,"_maxDownTime"),tt(this,"_maxInterval"),tt(this,"_posThreshold"),tt(this,"_movementThreshold"),tt(this,"_currentCursorPosition"),tt(this,"_startCursorPosition"),tt(this,"_grid"),tt(this,"_gridPosition"),tt(this,"_gizmos"),tt(this,"_curvePts"),tt(this,"_timeStart"),tt(this,"_animationId"),tt(this,"focusAnimationTime"),tt(this,"_timePrev"),tt(this,"_timeCurrent"),tt(this,"_anglePrev"),tt(this,"_angleCurrent"),tt(this,"_cursorPosPrev"),tt(this,"_cursorPosCurr"),tt(this,"_wPrev"),tt(this,"_wCurr"),tt(this,"adjustNearFar"),tt(this,"scaleFactor"),tt(this,"dampingFactor"),tt(this,"wMax"),tt(this,"enableAnimations"),tt(this,"enableGrid"),tt(this,"cursorZoom"),tt(this,"minFov"),tt(this,"maxFov"),tt(this,"enabled"),tt(this,"enablePan"),tt(this,"enableRotate"),tt(this,"enableZoom"),tt(this,"minDistance"),tt(this,"maxDistance"),tt(this,"minZoom"),tt(this,"maxZoom"),tt(this,"target"),tt(this,"_currentTarget"),tt(this,"_tbRadius"),tt(this,"_state"),tt(this,"onWindowResize",()=>{const r=(this._gizmos.scale.x+this._gizmos.scale.y+this._gizmos.scale.z)/3;if(this.camera){const c=this.calculateTbRadius(this.camera);c!==void 0&&(this._tbRadius=c)}const s=this._tbRadius/r,a=new Hm(0,0,s,s).getPoints(this._curvePts),l=new fn().setFromPoints(a);for(const c in this._gizmos.children){const u=this._gizmos.children[c];u.geometry=l}this.dispatchEvent(Sr)}),tt(this,"onContextMenu",r=>{if(this.enabled){for(let s=0;s<this.mouseActions.length;s++)if(this.mouseActions[s].mouse==2){r.preventDefault();break}}}),tt(this,"onPointerCancel",()=>{this._touchStart.splice(0,this._touchStart.length),this._touchCurrent.splice(0,this._touchCurrent.length),this._input=Hi.NONE}),tt(this,"onPointerDown",r=>{if(r.button==0&&r.isPrimary?(this._downValid=!0,this._downEvents.push(r)):this._downValid=!1,r.pointerType=="touch"&&this._input!=Hi.CURSOR)switch(this._touchStart.push(r),this._touchCurrent.push(r),this._input){case Hi.NONE:this._input=Hi.ONE_FINGER,this.onSinglePanStart(r,"ROTATE"),window.addEventListener("pointermove",this.onPointerMove),window.addEventListener("pointerup",this.onPointerUp);break;case Hi.ONE_FINGER:case Hi.ONE_FINGER_SWITCHED:this._input=Hi.TWO_FINGER,this.onRotateStart(),this.onPinchStart(),this.onDoublePanStart();break;case Hi.TWO_FINGER:this._input=Hi.MULT_FINGER,this.onTriplePanStart();break}else if(r.pointerType!="touch"&&this._input==Hi.NONE){let s=null;r.ctrlKey||r.metaKey?s="CTRL":r.shiftKey&&(s="SHIFT"),this._mouseOp=this.getOpFromAction(r.button,s),this._mouseOp&&(window.addEventListener("pointermove",this.onPointerMove),window.addEventListener("pointerup",this.onPointerUp),this._input=Hi.CURSOR,this._button=r.button,this.onSinglePanStart(r,this._mouseOp))}}),tt(this,"onPointerMove",r=>{if(r.pointerType=="touch"&&this._input!=Hi.CURSOR)switch(this._input){case Hi.ONE_FINGER:this.updateTouchEvent(r),this.onSinglePanMove(r,En.ROTATE);break;case Hi.ONE_FINGER_SWITCHED:if(this.calculatePointersDistance(this._touchCurrent[0],r)*this._devPxRatio>=this._switchSensibility){this._input=Hi.ONE_FINGER,this.updateTouchEvent(r),this.onSinglePanStart(r,"ROTATE");break}break;case Hi.TWO_FINGER:this.updateTouchEvent(r),this.onRotateMove(),this.onPinchMove(),this.onDoublePanMove();break;case Hi.MULT_FINGER:this.updateTouchEvent(r),this.onTriplePanMove();break}else if(r.pointerType!="touch"&&this._input==Hi.CURSOR){let s=null;r.ctrlKey||r.metaKey?s="CTRL":r.shiftKey&&(s="SHIFT");const o=this.getOpStateFromAction(this._button,s);o&&this.onSinglePanMove(r,o)}this._downValid&&this.calculatePointersDistance(this._downEvents[this._downEvents.length-1],r)*this._devPxRatio>this._movementThreshold&&(this._downValid=!1)}),tt(this,"onPointerUp",r=>{if(r.pointerType=="touch"&&this._input!=Hi.CURSOR){const s=this._touchCurrent.length;for(let o=0;o<s;o++)if(this._touchCurrent[o].pointerId==r.pointerId){this._touchCurrent.splice(o,1),this._touchStart.splice(o,1);break}switch(this._input){case Hi.ONE_FINGER:case Hi.ONE_FINGER_SWITCHED:window.removeEventListener("pointermove",this.onPointerMove),window.removeEventListener("pointerup",this.onPointerUp),this._input=Hi.NONE,this.onSinglePanEnd();break;case Hi.TWO_FINGER:this.onDoublePanEnd(),this.onPinchEnd(),this.onRotateEnd(),this._input=Hi.ONE_FINGER_SWITCHED;break;case Hi.MULT_FINGER:this._touchCurrent.length==0&&(window.removeEventListener("pointermove",this.onPointerMove),window.removeEventListener("pointerup",this.onPointerUp),this._input=Hi.NONE,this.onTriplePanEnd());break}}else r.pointerType!="touch"&&this._input==Hi.CURSOR&&(window.removeEventListener("pointermove",this.onPointerMove),window.removeEventListener("pointerup",this.onPointerUp),this._input=Hi.NONE,this.onSinglePanEnd(),this._button=-1);if(r.isPrimary)if(this._downValid)if(r.timeStamp-this._downEvents[this._downEvents.length-1].timeStamp<=this._maxDownTime)if(this._nclicks==0)this._nclicks=1,this._clickStart=performance.now();else{const o=r.timeStamp-this._clickStart,a=this.calculatePointersDistance(this._downEvents[1],this._downEvents[0])*this._devPxRatio;o<=this._maxInterval&&a<=this._posThreshold?(this._nclicks=0,this._downEvents.splice(0,this._downEvents.length),this.onDoubleTap(r)):(this._nclicks=1,this._downEvents.shift(),this._clickStart=performance.now())}else this._downValid=!1,this._nclicks=0,this._downEvents.splice(0,this._downEvents.length);else this._nclicks=0,this._downEvents.splice(0,this._downEvents.length)}),tt(this,"onWheel",r=>{var s,o;if(this.enabled&&this.enableZoom&&this.domElement){let a=null;r.ctrlKey||r.metaKey?a="CTRL":r.shiftKey&&(a="SHIFT");const l=this.getOpFromAction("WHEEL",a);if(l){r.preventDefault(),this.dispatchEvent(ru);const c=125;let u=r.deltaY/c,h=1;switch(u>0?h=1/this.scaleFactor:u<0&&(h=this.scaleFactor),l){case"ZOOM":if(this.updateTbState(En.SCALE,!0),u>0?h=1/Math.pow(this.scaleFactor,u):u<0&&(h=Math.pow(this.scaleFactor,-u)),this.cursorZoom&&this.enablePan){let f;this.camera instanceof qi&&(f=(s=this.unprojectOnTbPlane(this.camera,r.clientX,r.clientY,this.domElement))==null?void 0:s.applyQuaternion(this.camera.quaternion).multiplyScalar(1/this.camera.zoom).add(this._gizmos.position)),this.camera instanceof jn&&(f=(o=this.unprojectOnTbPlane(this.camera,r.clientX,r.clientY,this.domElement))==null?void 0:o.applyQuaternion(this.camera.quaternion).add(this._gizmos.position)),f!==void 0&&this.applyTransformMatrix(this.applyScale(h,f))}else this.applyTransformMatrix(this.applyScale(h,this._gizmos.position));this._grid&&(this.disposeGrid(),this.drawGrid()),this.updateTbState(En.IDLE,!1),this.dispatchEvent(Sr),this.dispatchEvent(Zl);break;case"FOV":if(this.camera instanceof jn){this.updateTbState(En.FOV,!0),r.deltaX!=0&&(u=r.deltaX/c,h=1,u>0?h=1/Math.pow(this.scaleFactor,u):u<0&&(h=Math.pow(this.scaleFactor,-u))),this._v3_1.setFromMatrixPosition(this._cameraMatrixState);const f=this._v3_1.distanceTo(this._gizmos.position);let d=f/h;d=un.clamp(d,this.minDistance,this.maxDistance);const m=f*Math.tan(un.DEG2RAD*this.camera.fov*.5);let y=un.RAD2DEG*(Math.atan(m/d)*2);y>this.maxFov?y=this.maxFov:y<this.minFov&&(y=this.minFov);const g=m/Math.tan(un.DEG2RAD*(y/2));h=f/g,this.setFov(y),this.applyTransformMatrix(this.applyScale(h,this._gizmos.position,!1))}this._grid&&(this.disposeGrid(),this.drawGrid()),this.updateTbState(En.IDLE,!1),this.dispatchEvent(Sr),this.dispatchEvent(Zl);break}}}}),tt(this,"onSinglePanStart",(r,s)=>{if(this.enabled&&this.domElement)switch(this.dispatchEvent(ru),this.setCenter(r.clientX,r.clientY),s){case"PAN":if(!this.enablePan)return;if(this._animationId!=-1&&(cancelAnimationFrame(this._animationId),this._animationId=-1,this._timeStart=-1,this.activateGizmos(!1),this.dispatchEvent(Sr)),this.camera){this.updateTbState(En.PAN,!0);const o=this.unprojectOnTbPlane(this.camera,ei.x,ei.y,this.domElement);o!==void 0&&this._startCursorPosition.copy(o),this.enableGrid&&(this.drawGrid(),this.dispatchEvent(Sr))}break;case"ROTATE":if(!this.enableRotate)return;if(this._animationId!=-1&&(cancelAnimationFrame(this._animationId),this._animationId=-1,this._timeStart=-1),this.camera){this.updateTbState(En.ROTATE,!0);const o=this.unprojectOnTbSurface(this.camera,ei.x,ei.y,this.domElement,this._tbRadius);o!==void 0&&this._startCursorPosition.copy(o),this.activateGizmos(!0),this.enableAnimations&&(this._timePrev=this._timeCurrent=performance.now(),this._angleCurrent=this._anglePrev=0,this._cursorPosPrev.copy(this._startCursorPosition),this._cursorPosCurr.copy(this._cursorPosPrev),this._wCurr=0,this._wPrev=this._wCurr)}this.dispatchEvent(Sr);break;case"FOV":if(!this.enableZoom)return;this.camera instanceof jn&&(this._animationId!=-1&&(cancelAnimationFrame(this._animationId),this._animationId=-1,this._timeStart=-1,this.activateGizmos(!1),this.dispatchEvent(Sr)),this.updateTbState(En.FOV,!0),this._startCursorPosition.setY(this.getCursorNDC(ei.x,ei.y,this.domElement).y*.5),this._currentCursorPosition.copy(this._startCursorPosition));break;case"ZOOM":if(!this.enableZoom)return;this._animationId!=-1&&(cancelAnimationFrame(this._animationId),this._animationId=-1,this._timeStart=-1,this.activateGizmos(!1),this.dispatchEvent(Sr)),this.updateTbState(En.SCALE,!0),this._startCursorPosition.setY(this.getCursorNDC(ei.x,ei.y,this.domElement).y*.5),this._currentCursorPosition.copy(this._startCursorPosition);break}}),tt(this,"onSinglePanMove",(r,s)=>{if(this.enabled&&this.domElement){const o=s!=this._state;switch(this.setCenter(r.clientX,r.clientY),s){case En.PAN:if(this.enablePan&&this.camera)if(o){this.dispatchEvent(Zl),this.dispatchEvent(ru),this.updateTbState(s,!0);const a=this.unprojectOnTbPlane(this.camera,ei.x,ei.y,this.domElement);a!==void 0&&this._startCursorPosition.copy(a),this.enableGrid&&this.drawGrid(),this.activateGizmos(!1)}else{const a=this.unprojectOnTbPlane(this.camera,ei.x,ei.y,this.domElement);a!==void 0&&this._currentCursorPosition.copy(a),this.applyTransformMatrix(this.pan(this._startCursorPosition,this._currentCursorPosition))}break;case En.ROTATE:if(this.enableRotate&&this.camera)if(o){this.dispatchEvent(Zl),this.dispatchEvent(ru),this.updateTbState(s,!0);const a=this.unprojectOnTbSurface(this.camera,ei.x,ei.y,this.domElement,this._tbRadius);a!==void 0&&this._startCursorPosition.copy(a),this.enableGrid&&this.disposeGrid(),this.activateGizmos(!0)}else{const a=this.unprojectOnTbSurface(this.camera,ei.x,ei.y,this.domElement,this._tbRadius);a!==void 0&&this._currentCursorPosition.copy(a);const l=this._startCursorPosition.distanceTo(this._currentCursorPosition),c=this._startCursorPosition.angleTo(this._currentCursorPosition),u=Math.max(l/this._tbRadius,c);this.applyTransformMatrix(this.rotate(this.calculateRotationAxis(this._startCursorPosition,this._currentCursorPosition),u)),this.enableAnimations&&(this._timePrev=this._timeCurrent,this._timeCurrent=performance.now(),this._anglePrev=this._angleCurrent,this._angleCurrent=u,this._cursorPosPrev.copy(this._cursorPosCurr),this._cursorPosCurr.copy(this._currentCursorPosition),this._wPrev=this._wCurr,this._wCurr=this.calculateAngularSpeed(this._anglePrev,this._angleCurrent,this._timePrev,this._timeCurrent))}break;case En.SCALE:if(this.enableZoom)if(o)this.dispatchEvent(Zl),this.dispatchEvent(ru),this.updateTbState(s,!0),this._startCursorPosition.setY(this.getCursorNDC(ei.x,ei.y,this.domElement).y*.5),this._currentCursorPosition.copy(this._startCursorPosition),this.enableGrid&&this.disposeGrid(),this.activateGizmos(!1);else{this._currentCursorPosition.setY(this.getCursorNDC(ei.x,ei.y,this.domElement).y*.5);const l=this._currentCursorPosition.y-this._startCursorPosition.y;let c=1;l<0?c=1/Math.pow(this.scaleFactor,-l*8):l>0&&(c=Math.pow(this.scaleFactor,l*8)),this.applyTransformMatrix(this.applyScale(c,this._gizmos.position))}break;case En.FOV:if(this.enableZoom&&this.camera instanceof jn)if(o)this.dispatchEvent(Zl),this.dispatchEvent(ru),this.updateTbState(s,!0),this._startCursorPosition.setY(this.getCursorNDC(ei.x,ei.y,this.domElement).y*.5),this._currentCursorPosition.copy(this._startCursorPosition),this.enableGrid&&this.disposeGrid(),this.activateGizmos(!1);else{this._currentCursorPosition.setY(this.getCursorNDC(ei.x,ei.y,this.domElement).y*.5);const l=this._currentCursorPosition.y-this._startCursorPosition.y;let c=1;l<0?c=1/Math.pow(this.scaleFactor,-l*8):l>0&&(c=Math.pow(this.scaleFactor,l*8)),this._v3_1.setFromMatrixPosition(this._cameraMatrixState);const u=this._v3_1.distanceTo(this._gizmos.position);let h=u/c;h=un.clamp(h,this.minDistance,this.maxDistance);const f=u*Math.tan(un.DEG2RAD*this._fovState*.5);let d=un.RAD2DEG*(Math.atan(f/h)*2);d=un.clamp(d,this.minFov,this.maxFov);const m=f/Math.tan(un.DEG2RAD*(d/2));c=u/m,this._v3_2.setFromMatrixPosition(this._gizmoMatrixState),this.setFov(d),this.applyTransformMatrix(this.applyScale(c,this._v3_2,!1));const y=this._gizmos.position.clone().sub(this.camera.position).normalize().multiplyScalar(m/u);this._m4_1.makeTranslation(y.x,y.y,y.z)}break}this.dispatchEvent(Sr)}}),tt(this,"onSinglePanEnd",()=>{if(this._state==En.ROTATE){if(!this.enableRotate)return;if(this.enableAnimations)if(performance.now()-this._timeCurrent<120){const s=Math.abs((this._wPrev+this._wCurr)/2),o=this;this._animationId=window.requestAnimationFrame(function(a){o.updateTbState(En.ANIMATION_ROTATE,!0);const l=o.calculateRotationAxis(o._cursorPosPrev,o._cursorPosCurr);o.onRotationAnim(a,l,Math.min(s,o.wMax))})}else this.updateTbState(En.IDLE,!1),this.activateGizmos(!1),this.dispatchEvent(Sr);else this.updateTbState(En.IDLE,!1),this.activateGizmos(!1),this.dispatchEvent(Sr)}else(this._state==En.PAN||this._state==En.IDLE)&&(this.updateTbState(En.IDLE,!1),this.enableGrid&&this.disposeGrid(),this.activateGizmos(!1),this.dispatchEvent(Sr));this.dispatchEvent(Zl)}),tt(this,"onDoubleTap",r=>{if(this.enabled&&this.enablePan&&this.scene&&this.camera&&this.domElement){this.dispatchEvent(ru),this.setCenter(r.clientX,r.clientY);const s=this.unprojectOnObj(this.getCursorNDC(ei.x,ei.y,this.domElement),this.camera);if(s&&this.enableAnimations){const o=this;this._animationId!=-1&&window.cancelAnimationFrame(this._animationId),this._timeStart=-1,this._animationId=window.requestAnimationFrame(function(a){o.updateTbState(En.ANIMATION_FOCUS,!0),o.onFocusAnim(a,s,o._cameraMatrixState,o._gizmoMatrixState)})}else s&&!this.enableAnimations&&(this.updateTbState(En.FOCUS,!0),this.focus(s,this.scaleFactor),this.updateTbState(En.IDLE,!1),this.dispatchEvent(Sr))}this.dispatchEvent(Zl)}),tt(this,"onDoublePanStart",()=>{if(this.enabled&&this.enablePan&&this.camera&&this.domElement){this.dispatchEvent(ru),this.updateTbState(En.PAN,!0),this.setCenter((this._touchCurrent[0].clientX+this._touchCurrent[1].clientX)/2,(this._touchCurrent[0].clientY+this._touchCurrent[1].clientY)/2);const r=this.unprojectOnTbPlane(this.camera,ei.x,ei.y,this.domElement,!0);r!==void 0&&this._startCursorPosition.copy(r),this._currentCursorPosition.copy(this._startCursorPosition),this.activateGizmos(!1)}}),tt(this,"onDoublePanMove",()=>{if(this.enabled&&this.enablePan&&this.camera&&this.domElement){this.setCenter((this._touchCurrent[0].clientX+this._touchCurrent[1].clientX)/2,(this._touchCurrent[0].clientY+this._touchCurrent[1].clientY)/2),this._state!=En.PAN&&(this.updateTbState(En.PAN,!0),this._startCursorPosition.copy(this._currentCursorPosition));const r=this.unprojectOnTbPlane(this.camera,ei.x,ei.y,this.domElement,!0);r!==void 0&&this._currentCursorPosition.copy(r),this.applyTransformMatrix(this.pan(this._startCursorPosition,this._currentCursorPosition,!0)),this.dispatchEvent(Sr)}}),tt(this,"onDoublePanEnd",()=>{this.updateTbState(En.IDLE,!1),this.dispatchEvent(Zl)}),tt(this,"onRotateStart",()=>{var r;this.enabled&&this.enableRotate&&(this.dispatchEvent(ru),this.updateTbState(En.ZROTATE,!0),this._startFingerRotation=this.getAngle(this._touchCurrent[1],this._touchCurrent[0])+this.getAngle(this._touchStart[1],this._touchStart[0]),this._currentFingerRotation=this._startFingerRotation,(r=this.camera)==null||r.getWorldDirection(this._rotationAxis),!this.enablePan&&!this.enableZoom&&this.activateGizmos(!0))}),tt(this,"onRotateMove",()=>{var r;if(this.enabled&&this.enableRotate&&this.camera&&this.domElement){this.setCenter((this._touchCurrent[0].clientX+this._touchCurrent[1].clientX)/2,(this._touchCurrent[0].clientY+this._touchCurrent[1].clientY)/2);let s;this._state!=En.ZROTATE&&(this.updateTbState(En.ZROTATE,!0),this._startFingerRotation=this._currentFingerRotation),this._currentFingerRotation=this.getAngle(this._touchCurrent[1],this._touchCurrent[0])+this.getAngle(this._touchStart[1],this._touchStart[0]),this.enablePan?this.camera&&(this._v3_2.setFromMatrixPosition(this._gizmoMatrixState),s=(r=this.unprojectOnTbPlane(this.camera,ei.x,ei.y,this.domElement))==null?void 0:r.applyQuaternion(this.camera.quaternion).multiplyScalar(1/this.camera.zoom).add(this._v3_2)):s=new Q().setFromMatrixPosition(this._gizmoMatrixState);const o=un.DEG2RAD*(this._startFingerRotation-this._currentFingerRotation);s!==void 0&&this.applyTransformMatrix(this.zRotate(s,o)),this.dispatchEvent(Sr)}}),tt(this,"onRotateEnd",()=>{this.updateTbState(En.IDLE,!1),this.activateGizmos(!1),this.dispatchEvent(Zl)}),tt(this,"onPinchStart",()=>{this.enabled&&this.enableZoom&&(this.dispatchEvent(ru),this.updateTbState(En.SCALE,!0),this._startFingerDistance=this.calculatePointersDistance(this._touchCurrent[0],this._touchCurrent[1]),this._currentFingerDistance=this._startFingerDistance,this.activateGizmos(!1))}),tt(this,"onPinchMove",()=>{var r,s;if(this.enabled&&this.enableZoom&&this.domElement){this.setCenter((this._touchCurrent[0].clientX+this._touchCurrent[1].clientX)/2,(this._touchCurrent[0].clientY+this._touchCurrent[1].clientY)/2);const o=12;this._state!=En.SCALE&&(this._startFingerDistance=this._currentFingerDistance,this.updateTbState(En.SCALE,!0)),this._currentFingerDistance=Math.max(this.calculatePointersDistance(this._touchCurrent[0],this._touchCurrent[1]),o*this._devPxRatio);const a=this._currentFingerDistance/this._startFingerDistance;let l;this.enablePan?this.camera instanceof qi?l=(r=this.unprojectOnTbPlane(this.camera,ei.x,ei.y,this.domElement))==null?void 0:r.applyQuaternion(this.camera.quaternion).multiplyScalar(1/this.camera.zoom).add(this._gizmos.position):this.camera instanceof jn&&(l=(s=this.unprojectOnTbPlane(this.camera,ei.x,ei.y,this.domElement))==null?void 0:s.applyQuaternion(this.camera.quaternion).add(this._gizmos.position)):l=this._gizmos.position,l!==void 0&&this.applyTransformMatrix(this.applyScale(a,l)),this.dispatchEvent(Sr)}}),tt(this,"onPinchEnd",()=>{this.updateTbState(En.IDLE,!1),this.dispatchEvent(Zl)}),tt(this,"onTriplePanStart",()=>{if(this.enabled&&this.enableZoom&&this.domElement){this.dispatchEvent(ru),this.updateTbState(En.SCALE,!0);let r=0,s=0;const o=this._touchCurrent.length;for(let a=0;a<o;a++)r+=this._touchCurrent[a].clientX,s+=this._touchCurrent[a].clientY;this.setCenter(r/o,s/o),this._startCursorPosition.setY(this.getCursorNDC(ei.x,ei.y,this.domElement).y*.5),this._currentCursorPosition.copy(this._startCursorPosition)}}),tt(this,"onTriplePanMove",()=>{if(this.enabled&&this.enableZoom&&this.camera&&this.domElement){let r=0,s=0;const o=this._touchCurrent.length;for(let g=0;g<o;g++)r+=this._touchCurrent[g].clientX,s+=this._touchCurrent[g].clientY;this.setCenter(r/o,s/o);const a=8;this._currentCursorPosition.setY(this.getCursorNDC(ei.x,ei.y,this.domElement).y*.5);const l=this._currentCursorPosition.y-this._startCursorPosition.y;let c=1;l<0?c=1/Math.pow(this.scaleFactor,-l*a):l>0&&(c=Math.pow(this.scaleFactor,l*a)),this._v3_1.setFromMatrixPosition(this._cameraMatrixState);const u=this._v3_1.distanceTo(this._gizmos.position);let h=u/c;h=un.clamp(h,this.minDistance,this.maxDistance);const f=u*Math.tan(un.DEG2RAD*this._fovState*.5);let d=un.RAD2DEG*(Math.atan(f/h)*2);d=un.clamp(d,this.minFov,this.maxFov);const m=f/Math.tan(un.DEG2RAD*(d/2));c=u/m,this._v3_2.setFromMatrixPosition(this._gizmoMatrixState),this.setFov(d),this.applyTransformMatrix(this.applyScale(c,this._v3_2,!1));const y=this._gizmos.position.clone().sub(this.camera.position).normalize().multiplyScalar(m/u);this._m4_1.makeTranslation(y.x,y.y,y.z),this.dispatchEvent(Sr)}}),tt(this,"onTriplePanEnd",()=>{this.updateTbState(En.IDLE,!1),this.dispatchEvent(Zl)}),tt(this,"setCenter",(r,s)=>{ei.x=r,ei.y=s}),tt(this,"initializeMouseActions",()=>{this.setMouseAction("PAN",0,"CTRL"),this.setMouseAction("PAN",2),this.setMouseAction("ROTATE",0),this.setMouseAction("ZOOM","WHEEL"),this.setMouseAction("ZOOM",1),this.setMouseAction("FOV","WHEEL","SHIFT"),this.setMouseAction("FOV",1,"SHIFT")}),tt(this,"setMouseAction",(r,s,o=null)=>{const a=["PAN","ROTATE","ZOOM","FOV"],l=[0,1,2,"WHEEL"],c=["CTRL","SHIFT",null];let u;if(!a.includes(r)||!l.includes(s)||!c.includes(o)||s=="WHEEL"&&r!="ZOOM"&&r!="FOV")return!1;switch(r){case"PAN":u=En.PAN;break;case"ROTATE":u=En.ROTATE;break;case"ZOOM":u=En.SCALE;break;case"FOV":u=En.FOV;break}const h={operation:r,mouse:s,key:o,state:u};for(let f=0;f<this.mouseActions.length;f++)if(this.mouseActions[f].mouse==h.mouse&&this.mouseActions[f].key==h.key)return this.mouseActions.splice(f,1,h),!0;return this.mouseActions.push(h),!0}),tt(this,"getOpFromAction",(r,s)=>{let o;for(let a=0;a<this.mouseActions.length;a++)if(o=this.mouseActions[a],o.mouse==r&&o.key==s)return o.operation;if(s){for(let a=0;a<this.mouseActions.length;a++)if(o=this.mouseActions[a],o.mouse==r&&o.key==null)return o.operation}return null}),tt(this,"getOpStateFromAction",(r,s)=>{let o;for(let a=0;a<this.mouseActions.length;a++)if(o=this.mouseActions[a],o.mouse==r&&o.key==s)return o.state;if(s){for(let a=0;a<this.mouseActions.length;a++)if(o=this.mouseActions[a],o.mouse==r&&o.key==null)return o.state}return null}),tt(this,"getAngle",(r,s)=>Math.atan2(s.clientY-r.clientY,s.clientX-r.clientX)*180/Math.PI),tt(this,"updateTouchEvent",r=>{for(let s=0;s<this._touchCurrent.length;s++)if(this._touchCurrent[s].pointerId==r.pointerId){this._touchCurrent.splice(s,1,r);break}}),tt(this,"calculateAngularSpeed",(r,s,o,a)=>{const l=s-r,c=(a-o)/1e3;return c==0?0:l/c}),tt(this,"calculatePointersDistance",(r,s)=>Math.sqrt(Math.pow(s.clientX-r.clientX,2)+Math.pow(s.clientY-r.clientY,2))),tt(this,"calculateRotationAxis",(r,s)=>(this._rotationMatrix.extractRotation(this._cameraMatrixState),this._quat.setFromRotationMatrix(this._rotationMatrix),this._rotationAxis.crossVectors(r,s).applyQuaternion(this._quat),this._rotationAxis.normalize().clone())),tt(this,"calculateTbRadius",r=>{const o=r.position.distanceTo(this._gizmos.position);if(r instanceof jn){const a=un.DEG2RAD*r.fov*.5,l=Math.atan(r.aspect*Math.tan(a));return Math.tan(Math.min(a,l))*o*.67}else if(r instanceof qi)return Math.min(r.top,r.right)*.67}),tt(this,"focus",(r,s,o=1)=>{if(this.camera){const a=r.clone();a.sub(this._gizmos.position).multiplyScalar(o),this._translationMatrix.makeTranslation(a.x,a.y,a.z);const l=this._gizmoMatrixState.clone();this._gizmoMatrixState.premultiply(this._translationMatrix),this._gizmoMatrixState.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale);const c=this._cameraMatrixState.clone();this._cameraMatrixState.premultiply(this._translationMatrix),this._cameraMatrixState.decompose(this.camera.position,this.camera.quaternion,this.camera.scale),this.enableZoom&&this.applyTransformMatrix(this.applyScale(s,this._gizmos.position)),this._gizmoMatrixState.copy(l),this._cameraMatrixState.copy(c)}}),tt(this,"drawGrid",()=>{if(this.scene){let o,a,l,c;if(this.camera instanceof qi){const u=this.camera.right-this.camera.left,h=this.camera.bottom-this.camera.top;l=Math.max(u,h),c=l/20,o=l/this.camera.zoom*3,a=o/c*this.camera.zoom}else if(this.camera instanceof jn){const u=this.camera.position.distanceTo(this._gizmos.position),h=un.DEG2RAD*this.camera.fov*.5,f=Math.atan(this.camera.aspect*Math.tan(h));l=Math.tan(Math.max(h,f))*u*2,c=l/20,o=l*3,a=o/c}this._grid==null&&this.camera&&(this._grid=new Bz(o,a,8947848,8947848),this._grid.position.copy(this._gizmos.position),this._gridPosition.copy(this._grid.position),this._grid.quaternion.copy(this.camera.quaternion),this._grid.rotateX(Math.PI*.5),this.scene.add(this._grid))}}),tt(this,"connect",r=>{r===document&&console.error('THREE.ArcballControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.domElement=r,this.domElement.style.touchAction="none",this.domElement.addEventListener("contextmenu",this.onContextMenu),this.domElement.addEventListener("pointerdown",this.onPointerDown),this.domElement.addEventListener("pointercancel",this.onPointerCancel),this.domElement.addEventListener("wheel",this.onWheel)}),tt(this,"dispose",()=>{var r,s,o,a,l;this._animationId!=-1&&window.cancelAnimationFrame(this._animationId),(r=this.domElement)==null||r.removeEventListener("pointerdown",this.onPointerDown),(s=this.domElement)==null||s.removeEventListener("pointercancel",this.onPointerCancel),(o=this.domElement)==null||o.removeEventListener("wheel",this.onWheel),(a=this.domElement)==null||a.removeEventListener("contextmenu",this.onContextMenu),window.removeEventListener("pointermove",this.onPointerMove),window.removeEventListener("pointerup",this.onPointerUp),window.removeEventListener("resize",this.onWindowResize),(l=this.scene)==null||l.remove(this._gizmos),this.disposeGrid()}),tt(this,"disposeGrid",()=>{this._grid&&this.scene&&(this.scene.remove(this._grid),this._grid=null)}),tt(this,"easeOutCubic",r=>1-Math.pow(1-r,3)),tt(this,"activateGizmos",r=>{for(const s of this._gizmos.children)s.material.setValues({opacity:r?1:.6})}),tt(this,"getCursorNDC",(r,s,o)=>{const a=o.getBoundingClientRect();return this._v2_1.setX((r-a.left)/a.width*2-1),this._v2_1.setY((a.bottom-s)/a.height*2-1),this._v2_1.clone()}),tt(this,"getCursorPosition",(r,s,o)=>(this._v2_1.copy(this.getCursorNDC(r,s,o)),this.camera instanceof qi&&(this._v2_1.x*=(this.camera.right-this.camera.left)*.5,this._v2_1.y*=(this.camera.top-this.camera.bottom)*.5),this._v2_1.clone())),tt(this,"setCamera",r=>{if(r){r.lookAt(this.target),r.updateMatrix(),r instanceof jn&&(this._fov0=r.fov,this._fovState=r.fov),this._cameraMatrixState0.copy(r.matrix),this._cameraMatrixState.copy(this._cameraMatrixState0),this._cameraProjectionState.copy(r.projectionMatrix),this._zoom0=r.zoom,this._zoomState=this._zoom0,this._initialNear=r.near,this._nearPos0=r.position.distanceTo(this.target)-r.near,this._nearPos=this._initialNear,this._initialFar=r.far,this._farPos0=r.position.distanceTo(this.target)-r.far,this._farPos=this._initialFar,this._up0.copy(r.up),this._upState.copy(r.up),this.camera=r,this.camera.updateProjectionMatrix();const s=this.calculateTbRadius(r);s!==void 0&&(this._tbRadius=s),this.makeGizmos(this.target,this._tbRadius)}}),tt(this,"makeGizmos",(r,s)=>{const a=new Hm(0,0,s,s).getPoints(this._curvePts),l=new fn().setFromPoints(a),c=new vs({color:16744576,fog:!1,transparent:!0,opacity:.6}),u=new vs({color:8454016,fog:!1,transparent:!0,opacity:.6}),h=new vs({color:8421631,fog:!1,transparent:!0,opacity:.6}),f=new $n(l,c),d=new $n(l,u),m=new $n(l,h),y=Math.PI*.5;if(f.rotation.x=y,d.rotation.y=y,this._gizmoMatrixState0.identity().setPosition(r),this._gizmoMatrixState.copy(this._gizmoMatrixState0),this.camera&&this.camera.zoom!=1){const g=1/this.camera.zoom;this._scaleMatrix.makeScale(g,g,g),this._translationMatrix.makeTranslation(-r.x,-r.y,-r.z),this._gizmoMatrixState.premultiply(this._translationMatrix).premultiply(this._scaleMatrix),this._translationMatrix.makeTranslation(r.x,r.y,r.z),this._gizmoMatrixState.premultiply(this._translationMatrix)}this._gizmoMatrixState.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale),this._gizmos.clear(),this._gizmos.add(f),this._gizmos.add(d),this._gizmos.add(m)}),tt(this,"onFocusAnim",(r,s,o,a)=>{if(this._timeStart==-1&&(this._timeStart=r),this._state==En.ANIMATION_FOCUS){const c=(r-this._timeStart)/this.focusAnimationTime;if(this._gizmoMatrixState.copy(a),c>=1)this._gizmoMatrixState.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale),this.focus(s,this.scaleFactor),this._timeStart=-1,this.updateTbState(En.IDLE,!1),this.activateGizmos(!1),this.dispatchEvent(Sr);else{const u=this.easeOutCubic(c),h=1-u+this.scaleFactor*u;this._gizmoMatrixState.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale),this.focus(s,h,u),this.dispatchEvent(Sr);const f=this;this._animationId=window.requestAnimationFrame(function(d){f.onFocusAnim(d,s,o,a.clone())})}}else this._animationId=-1,this._timeStart=-1}),tt(this,"onRotationAnim",(r,s,o)=>{if(this._timeStart==-1&&(this._anglePrev=0,this._angleCurrent=0,this._timeStart=r),this._state==En.ANIMATION_ROTATE){const a=(r-this._timeStart)/1e3;if(o+-this.dampingFactor*a>0){this._angleCurrent=.5*-this.dampingFactor*Math.pow(a,2)+o*a+0,this.applyTransformMatrix(this.rotate(s,this._angleCurrent)),this.dispatchEvent(Sr);const c=this;this._animationId=window.requestAnimationFrame(function(u){c.onRotationAnim(u,s,o)})}else this._animationId=-1,this._timeStart=-1,this.updateTbState(En.IDLE,!1),this.activateGizmos(!1),this.dispatchEvent(Sr)}else this._animationId=-1,this._timeStart=-1,this._state!=En.ROTATE&&(this.activateGizmos(!1),this.dispatchEvent(Sr))}),tt(this,"pan",(r,s,o=!1)=>{if(this.camera){const a=r.clone().sub(s);if(this.camera instanceof qi&&a.multiplyScalar(1/this.camera.zoom),this.camera instanceof jn&&o){this._v3_1.setFromMatrixPosition(this._cameraMatrixState0),this._v3_2.setFromMatrixPosition(this._gizmoMatrixState0);const l=this._v3_1.distanceTo(this._v3_2)/this.camera.position.distanceTo(this._gizmos.position);a.multiplyScalar(1/l)}this._v3_1.set(a.x,a.y,0).applyQuaternion(this.camera.quaternion),this._m4_1.makeTranslation(this._v3_1.x,this._v3_1.y,this._v3_1.z),this.setTransformationMatrices(this._m4_1,this._m4_1)}return xl}),tt(this,"reset",()=>{if(this.camera){this.camera.zoom=this._zoom0,this.camera instanceof jn&&(this.camera.fov=this._fov0),this.camera.near=this._nearPos,this.camera.far=this._farPos,this._cameraMatrixState.copy(this._cameraMatrixState0),this._cameraMatrixState.decompose(this.camera.position,this.camera.quaternion,this.camera.scale),this.camera.up.copy(this._up0),this.camera.updateMatrix(),this.camera.updateProjectionMatrix(),this._gizmoMatrixState.copy(this._gizmoMatrixState0),this._gizmoMatrixState0.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale),this._gizmos.updateMatrix();const r=this.calculateTbRadius(this.camera);r!==void 0&&(this._tbRadius=r),this.makeGizmos(this._gizmos.position,this._tbRadius),this.camera.lookAt(this._gizmos.position),this.updateTbState(En.IDLE,!1),this.dispatchEvent(Sr)}}),tt(this,"rotate",(r,s)=>{const o=this._gizmos.position;return this._translationMatrix.makeTranslation(-o.x,-o.y,-o.z),this._rotationMatrix.makeRotationAxis(r,-s),this._m4_1.makeTranslation(o.x,o.y,o.z),this._m4_1.multiply(this._rotationMatrix),this._m4_1.multiply(this._translationMatrix),this.setTransformationMatrices(this._m4_1),xl}),tt(this,"copyState",()=>{if(this.camera){const r=JSON.stringify(this.camera instanceof qi?{arcballState:{cameraFar:this.camera.far,cameraMatrix:this.camera.matrix,cameraNear:this.camera.near,cameraUp:this.camera.up,cameraZoom:this.camera.zoom,gizmoMatrix:this._gizmos.matrix}}:{arcballState:{cameraFar:this.camera.far,cameraFov:this.camera.fov,cameraMatrix:this.camera.matrix,cameraNear:this.camera.near,cameraUp:this.camera.up,cameraZoom:this.camera.zoom,gizmoMatrix:this._gizmos.matrix}});navigator.clipboard.writeText(r)}}),tt(this,"pasteState",()=>{const r=this;navigator.clipboard.readText().then(function(o){r.setStateFromJSON(o)})}),tt(this,"saveState",()=>{this.camera&&(this._cameraMatrixState0.copy(this.camera.matrix),this._gizmoMatrixState0.copy(this._gizmos.matrix),this._nearPos=this.camera.near,this._farPos=this.camera.far,this._zoom0=this.camera.zoom,this._up0.copy(this.camera.up),this.camera instanceof jn&&(this._fov0=this.camera.fov))}),tt(this,"applyScale",(r,s,o=!0)=>{if(!this.camera)return;const a=s.clone();let l=1/r;if(this.camera instanceof qi){this.camera.zoom=this._zoomState,this.camera.zoom*=r,this.camera.zoom>this.maxZoom?(this.camera.zoom=this.maxZoom,l=this._zoomState/this.maxZoom):this.camera.zoom<this.minZoom&&(this.camera.zoom=this.minZoom,l=this._zoomState/this.minZoom),this.camera.updateProjectionMatrix(),this._v3_1.setFromMatrixPosition(this._gizmoMatrixState),this._scaleMatrix.makeScale(l,l,l),this._translationMatrix.makeTranslation(-this._v3_1.x,-this._v3_1.y,-this._v3_1.z),this._m4_2.makeTranslation(this._v3_1.x,this._v3_1.y,this._v3_1.z).multiply(this._scaleMatrix),this._m4_2.multiply(this._translationMatrix),a.sub(this._v3_1);const c=a.clone().multiplyScalar(l);return a.sub(c),this._m4_1.makeTranslation(a.x,a.y,a.z),this._m4_2.premultiply(this._m4_1),this.setTransformationMatrices(this._m4_1,this._m4_2),xl}if(this.camera instanceof jn){this._v3_1.setFromMatrixPosition(this._cameraMatrixState),this._v3_2.setFromMatrixPosition(this._gizmoMatrixState);let c=this._v3_1.distanceTo(a),u=c-c*l;const h=c-u;h<this.minDistance?(l=this.minDistance/c,u=c-c*l):h>this.maxDistance&&(l=this.maxDistance/c,u=c-c*l);let f=a.clone().sub(this._v3_1).normalize().multiplyScalar(u);if(this._m4_1.makeTranslation(f.x,f.y,f.z),o){const d=this._v3_2;c=d.distanceTo(a),u=c-c*l,f=a.clone().sub(this._v3_2).normalize().multiplyScalar(u),this._translationMatrix.makeTranslation(d.x,d.y,d.z),this._scaleMatrix.makeScale(l,l,l),this._m4_2.makeTranslation(f.x,f.y,f.z).multiply(this._translationMatrix),this._m4_2.multiply(this._scaleMatrix),this._translationMatrix.makeTranslation(-d.x,-d.y,-d.z),this._m4_2.multiply(this._translationMatrix),this.setTransformationMatrices(this._m4_1,this._m4_2)}else this.setTransformationMatrices(this._m4_1);return xl}}),tt(this,"setFov",r=>{this.camera instanceof jn&&(this.camera.fov=un.clamp(r,this.minFov,this.maxFov),this.camera.updateProjectionMatrix())}),tt(this,"setTarget",(r,s,o)=>{if(this.camera){this.target.set(r,s,o),this._gizmos.position.set(r,s,o);const a=this.calculateTbRadius(this.camera);a!==void 0&&(this._tbRadius=a),this.makeGizmos(this.target,this._tbRadius),this.camera.lookAt(this.target)}}),tt(this,"zRotate",(r,s)=>(this._rotationMatrix.makeRotationAxis(this._rotationAxis,s),this._translationMatrix.makeTranslation(-r.x,-r.y,-r.z),this._m4_1.makeTranslation(r.x,r.y,r.z),this._m4_1.multiply(this._rotationMatrix),this._m4_1.multiply(this._translationMatrix),this._v3_1.setFromMatrixPosition(this._gizmoMatrixState).sub(r),this._v3_2.copy(this._v3_1).applyAxisAngle(this._rotationAxis,s),this._v3_2.sub(this._v3_1),this._m4_2.makeTranslation(this._v3_2.x,this._v3_2.y,this._v3_2.z),this.setTransformationMatrices(this._m4_1,this._m4_2),xl)),tt(this,"unprojectOnObj",(r,s)=>{if(!this.scene)return null;const o=new y0;o.near=s.near,o.far=s.far,o.setFromCamera(r,s);const a=o.intersectObjects(this.scene.children,!0);for(let l=0;l<a.length;l++)if(a[l].object.uuid!=this._gizmos.uuid&&a[l].face)return a[l].point.clone();return null}),tt(this,"unprojectOnTbSurface",(r,s,o,a,l)=>{if(r instanceof qi){this._v2_1.copy(this.getCursorPosition(s,o,a)),this._v3_1.set(this._v2_1.x,this._v2_1.y,0);const c=Math.pow(this._v2_1.x,2),u=Math.pow(this._v2_1.y,2),h=Math.pow(this._tbRadius,2);return c+u<=h*.5?this._v3_1.setZ(Math.sqrt(h-(c+u))):this._v3_1.setZ(h*.5/Math.sqrt(c+u)),this._v3_1}if(r instanceof jn){this._v2_1.copy(this.getCursorNDC(s,o,a)),this._v3_1.set(this._v2_1.x,this._v2_1.y,-1),this._v3_1.applyMatrix4(r.projectionMatrixInverse);const c=this._v3_1.clone().normalize(),u=r.position.distanceTo(this._gizmos.position),h=Math.pow(l,2),f=this._v3_1.z,d=Math.sqrt(Math.pow(this._v3_1.x,2)+Math.pow(this._v3_1.y,2));if(d==0)return c.set(this._v3_1.x,this._v3_1.y,l),c;const m=f/d,y=u;let g=Math.pow(m,2)+1,A=2*m*y,E=Math.pow(y,2)-h,x=Math.pow(A,2)-4*g*E;if(x>=0&&(this._v2_1.setX((-A-Math.sqrt(x))/(2*g)),this._v2_1.setY(m*this._v2_1.x+y),un.RAD2DEG*this._v2_1.angle()>=45)){const I=Math.sqrt(Math.pow(this._v2_1.x,2)+Math.pow(u-this._v2_1.y,2));return c.multiplyScalar(I),c.z+=u,c}g=m,A=y,E=-h*.5,x=Math.pow(A,2)-4*g*E,this._v2_1.setX((-A-Math.sqrt(x))/(2*g)),this._v2_1.setY(m*this._v2_1.x+y);const w=Math.sqrt(Math.pow(this._v2_1.x,2)+Math.pow(u-this._v2_1.y,2));return c.multiplyScalar(w),c.z+=u,c}}),tt(this,"unprojectOnTbPlane",(r,s,o,a,l=!1)=>{if(r instanceof qi)return this._v2_1.copy(this.getCursorPosition(s,o,a)),this._v3_1.set(this._v2_1.x,this._v2_1.y,0),this._v3_1.clone();if(r instanceof jn){this._v2_1.copy(this.getCursorNDC(s,o,a)),this._v3_1.set(this._v2_1.x,this._v2_1.y,-1),this._v3_1.applyMatrix4(r.projectionMatrixInverse);const c=this._v3_1.clone().normalize(),u=this._v3_1.z,h=Math.sqrt(Math.pow(this._v3_1.x,2)+Math.pow(this._v3_1.y,2));let f;if(l?f=this._v3_1.setFromMatrixPosition(this._cameraMatrixState0).distanceTo(this._v3_2.setFromMatrixPosition(this._gizmoMatrixState0)):f=r.position.distanceTo(this._gizmos.position),h==0)return c.set(0,0,0),c;const d=u/h,m=f,y=-m/d,g=Math.sqrt(Math.pow(m,2)+Math.pow(y,2));return c.multiplyScalar(g),c.z=0,c}}),tt(this,"updateMatrixState",()=>{this.camera&&(this._cameraMatrixState.copy(this.camera.matrix),this._gizmoMatrixState.copy(this._gizmos.matrix),this.camera instanceof qi&&(this._cameraProjectionState.copy(this.camera.projectionMatrix),this.camera.updateProjectionMatrix(),this._zoomState=this.camera.zoom),this.camera instanceof jn&&(this._fovState=this.camera.fov))}),tt(this,"updateTbState",(r,s)=>{this._state=r,s&&this.updateMatrixState()}),tt(this,"update",()=>{if(!this.target.equals(this._currentTarget)&&this.camera){this._gizmos.position.set(this.target.x,this.target.y,this.target.z);const s=this.calculateTbRadius(this.camera);s!==void 0&&(this._tbRadius=s),this.makeGizmos(this.target,this._tbRadius),this._currentTarget.copy(this.target)}if(this.camera){if(this.camera instanceof qi&&(this.camera.zoom>this.maxZoom||this.camera.zoom<this.minZoom)){const s=un.clamp(this.camera.zoom,this.minZoom,this.maxZoom);this.applyTransformMatrix(this.applyScale(s/this.camera.zoom,this._gizmos.position,!0))}if(this.camera instanceof jn){const s=this.camera.position.distanceTo(this._gizmos.position);if(s>this.maxDistance+1e-6||s<this.minDistance-1e-6){const l=un.clamp(s,this.minDistance,this.maxDistance);this.applyTransformMatrix(this.applyScale(l/s,this._gizmos.position)),this.updateMatrixState()}(this.camera.fov<this.minFov||this.camera.fov>this.maxFov)&&(this.camera.fov=un.clamp(this.camera.fov,this.minFov,this.maxFov),this.camera.updateProjectionMatrix());const o=this._tbRadius,a=this.calculateTbRadius(this.camera);if(a!==void 0&&(this._tbRadius=a),o<this._tbRadius-1e-6||o>this._tbRadius+1e-6){const l=(this._gizmos.scale.x+this._gizmos.scale.y+this._gizmos.scale.z)/3,c=this._tbRadius/l,h=new Hm(0,0,c,c).getPoints(this._curvePts),f=new fn().setFromPoints(h);for(const d in this._gizmos.children){const m=this._gizmos.children[d];m.geometry=f}}}this.camera.lookAt(this._gizmos.position)}}),tt(this,"setStateFromJSON",r=>{const s=JSON.parse(r);if(s.arcballState&&this.camera){this._cameraMatrixState.fromArray(s.arcballState.cameraMatrix.elements),this._cameraMatrixState.decompose(this.camera.position,this.camera.quaternion,this.camera.scale),this.camera.up.copy(s.arcballState.cameraUp),this.camera.near=s.arcballState.cameraNear,this.camera.far=s.arcballState.cameraFar,this.camera.zoom=s.arcballState.cameraZoom,this.camera instanceof jn&&(this.camera.fov=s.arcballState.cameraFov),this._gizmoMatrixState.fromArray(s.arcballState.gizmoMatrix.elements),this._gizmoMatrixState.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale),this.camera.updateMatrix(),this.camera.updateProjectionMatrix(),this._gizmos.updateMatrix();const o=this.calculateTbRadius(this.camera);o!==void 0&&(this._tbRadius=o);const a=new Xe().copy(this._gizmoMatrixState0);this.makeGizmos(this._gizmos.position,this._tbRadius),this._gizmoMatrixState0.copy(a),this.camera.lookAt(this._gizmos.position),this.updateTbState(En.IDLE,!1),this.dispatchEvent(Sr)}}),this.camera=null,this.domElement=t,this.scene=n,this.mouseActions=[],this._mouseOp=null,this._v2_1=new Ue,this._v3_1=new Q,this._v3_2=new Q,this._m4_1=new Xe,this._m4_2=new Xe,this._quat=new Xt,this._translationMatrix=new Xe,this._rotationMatrix=new Xe,this._scaleMatrix=new Xe,this._rotationAxis=new Q,this._cameraMatrixState=new Xe,this._cameraProjectionState=new Xe,this._fovState=1,this._upState=new Q,this._zoomState=1,this._nearPos=0,this._farPos=0,this._gizmoMatrixState=new Xe,this._up0=new Q,this._zoom0=1,this._fov0=0,this._initialNear=0,this._nearPos0=0,this._initialFar=0,this._farPos0=0,this._cameraMatrixState0=new Xe,this._gizmoMatrixState0=new Xe,this._button=-1,this._touchStart=[],this._touchCurrent=[],this._input=Hi.NONE,this._switchSensibility=32,this._startFingerDistance=0,this._currentFingerDistance=0,this._startFingerRotation=0,this._currentFingerRotation=0,this._devPxRatio=0,this._downValid=!0,this._nclicks=0,this._downEvents=[],this._clickStart=0,this._maxDownTime=250,this._maxInterval=300,this._posThreshold=24,this._movementThreshold=24,this._currentCursorPosition=new Q,this._startCursorPosition=new Q,this._grid=null,this._gridPosition=new Q,this._gizmos=new xa,this._curvePts=128,this._timeStart=-1,this._animationId=-1,this.focusAnimationTime=500,this._timePrev=0,this._timeCurrent=0,this._anglePrev=0,this._angleCurrent=0,this._cursorPosPrev=new Q,this._cursorPosCurr=new Q,this._wPrev=0,this._wCurr=0,this.adjustNearFar=!1,this.scaleFactor=1.1,this.dampingFactor=25,this.wMax=20,this.enableAnimations=!0,this.enableGrid=!1,this.cursorZoom=!1,this.minFov=5,this.maxFov=90,this.enabled=!0,this.enablePan=!0,this.enableRotate=!0,this.enableZoom=!0,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.target=new Q(0,0,0),this._currentTarget=new Q(0,0,0),this._tbRadius=1,this._state=En.IDLE,this.setCamera(e),this.scene&&this.scene.add(this._gizmos),this._devPxRatio=window.devicePixelRatio,this.initializeMouseActions(),this.domElement&&this.connect(this.domElement),window.addEventListener("resize",this.onWindowResize)}applyTransformMatrix(e){if(e!=null&&e.camera&&this.camera&&(this._m4_1.copy(this._cameraMatrixState).premultiply(e.camera),this._m4_1.decompose(this.camera.position,this.camera.quaternion,this.camera.scale),this.camera.updateMatrix(),(this._state==En.ROTATE||this._state==En.ZROTATE||this._state==En.ANIMATION_ROTATE)&&this.camera.up.copy(this._upState).applyQuaternion(this.camera.quaternion)),e!=null&&e.gizmos&&(this._m4_1.copy(this._gizmoMatrixState).premultiply(e.gizmos),this._m4_1.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale),this._gizmos.updateMatrix()),(this._state==En.SCALE||this._state==En.FOCUS||this._state==En.ANIMATION_FOCUS)&&this.camera){const t=this.calculateTbRadius(this.camera);if(t!==void 0&&(this._tbRadius=t),this.adjustNearFar){const n=this.camera.position.distanceTo(this._gizmos.position),r=new ti;r.setFromObject(this._gizmos);const s=new Bi;r.getBoundingSphere(s);const o=Math.max(this._nearPos0,s.radius+s.center.length()),a=n-this._initialNear,l=Math.min(o,a);this.camera.near=n-l;const c=Math.min(this._farPos0,-s.radius+s.center.length()),u=n-this._initialFar,h=Math.min(c,u);this.camera.far=n-h,this.camera.updateProjectionMatrix()}else{let n=!1;this.camera.near!=this._initialNear&&(this.camera.near=this._initialNear,n=!0),this.camera.far!=this._initialFar&&(this.camera.far=this._initialFar,n=!0),n&&this.camera.updateProjectionMatrix()}}}setGizmosVisible(e){this._gizmos.visible=e,this.dispatchEvent(Sr)}setTransformationMatrices(e=null,t=null){e?xl.camera?xl.camera.copy(e):xl.camera=e.clone():xl.camera=null,t?xl.gizmos?xl.gizmos.copy(t):xl.gizmos=t.clone():xl.gizmos=null}};var pce=Object.defineProperty,mce=(i,e,t)=>e in i?pce(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,sr=(i,e,t)=>(mce(i,typeof e!="symbol"?e+"":e,t),t);function R9(i){i.preventDefault()}let gce=class extends x0{constructor(e,t){super(),sr(this,"object"),sr(this,"domElement",null),sr(this,"movementSpeed",1),sr(this,"rollSpeed",.005),sr(this,"dragToLook",!1),sr(this,"autoForward",!1),sr(this,"changeEvent",{type:"change"}),sr(this,"EPS",1e-6),sr(this,"tmpQuaternion",new Xt),sr(this,"mouseStatus",0),sr(this,"movementSpeedMultiplier",1),sr(this,"moveState",{up:0,down:0,left:0,right:0,forward:0,back:0,pitchUp:0,pitchDown:0,yawLeft:0,yawRight:0,rollLeft:0,rollRight:0}),sr(this,"moveVector",new Q(0,0,0)),sr(this,"rotationVector",new Q(0,0,0)),sr(this,"keydown",n=>{if(!n.altKey){switch(n.code){case"ShiftLeft":case"ShiftRight":this.movementSpeedMultiplier=.1;break;case"KeyW":this.moveState.forward=1;break;case"KeyS":this.moveState.back=1;break;case"KeyA":this.moveState.left=1;break;case"KeyD":this.moveState.right=1;break;case"KeyR":this.moveState.up=1;break;case"KeyF":this.moveState.down=1;break;case"ArrowUp":this.moveState.pitchUp=1;break;case"ArrowDown":this.moveState.pitchDown=1;break;case"ArrowLeft":this.moveState.yawLeft=1;break;case"ArrowRight":this.moveState.yawRight=1;break;case"KeyQ":this.moveState.rollLeft=1;break;case"KeyE":this.moveState.rollRight=1;break}this.updateMovementVector(),this.updateRotationVector()}}),sr(this,"keyup",n=>{switch(n.code){case"ShiftLeft":case"ShiftRight":this.movementSpeedMultiplier=1;break;case"KeyW":this.moveState.forward=0;break;case"KeyS":this.moveState.back=0;break;case"KeyA":this.moveState.left=0;break;case"KeyD":this.moveState.right=0;break;case"KeyR":this.moveState.up=0;break;case"KeyF":this.moveState.down=0;break;case"ArrowUp":this.moveState.pitchUp=0;break;case"ArrowDown":this.moveState.pitchDown=0;break;case"ArrowLeft":this.moveState.yawLeft=0;break;case"ArrowRight":this.moveState.yawRight=0;break;case"KeyQ":this.moveState.rollLeft=0;break;case"KeyE":this.moveState.rollRight=0;break}this.updateMovementVector(),this.updateRotationVector()}),sr(this,"pointerdown",n=>{if(this.dragToLook)this.mouseStatus++;else{switch(n.button){case 0:this.moveState.forward=1;break;case 2:this.moveState.back=1;break}this.updateMovementVector()}}),sr(this,"pointermove",n=>{if(!this.dragToLook||this.mouseStatus>0){const r=this.getContainerDimensions(),s=r.size[0]/2,o=r.size[1]/2;this.moveState.yawLeft=-(n.pageX-r.offset[0]-s)/s,this.moveState.pitchDown=(n.pageY-r.offset[1]-o)/o,this.updateRotationVector()}}),sr(this,"pointerup",n=>{if(this.dragToLook)this.mouseStatus--,this.moveState.yawLeft=this.moveState.pitchDown=0;else{switch(n.button){case 0:this.moveState.forward=0;break;case 2:this.moveState.back=0;break}this.updateMovementVector()}this.updateRotationVector()}),sr(this,"lastQuaternion",new Xt),sr(this,"lastPosition",new Q),sr(this,"update",n=>{const r=n*this.movementSpeed,s=n*this.rollSpeed;this.object.translateX(this.moveVector.x*r),this.object.translateY(this.moveVector.y*r),this.object.translateZ(this.moveVector.z*r),this.tmpQuaternion.set(this.rotationVector.x*s,this.rotationVector.y*s,this.rotationVector.z*s,1).normalize(),this.object.quaternion.multiply(this.tmpQuaternion),(this.lastPosition.distanceToSquared(this.object.position)>this.EPS||8*(1-this.lastQuaternion.dot(this.object.quaternion))>this.EPS)&&(this.dispatchEvent(this.changeEvent),this.lastQuaternion.copy(this.object.quaternion),this.lastPosition.copy(this.object.position))}),sr(this,"updateMovementVector",()=>{const n=this.moveState.forward||this.autoForward&&!this.moveState.back?1:0;this.moveVector.x=-this.moveState.left+this.moveState.right,this.moveVector.y=-this.moveState.down+this.moveState.up,this.moveVector.z=-n+this.moveState.back}),sr(this,"updateRotationVector",()=>{this.rotationVector.x=-this.moveState.pitchDown+this.moveState.pitchUp,this.rotationVector.y=-this.moveState.yawRight+this.moveState.yawLeft,this.rotationVector.z=-this.moveState.rollRight+this.moveState.rollLeft}),sr(this,"getContainerDimensions",()=>this.domElement!=document&&!(this.domElement instanceof Document)?{size:[this.domElement.offsetWidth,this.domElement.offsetHeight],offset:[this.domElement.offsetLeft,this.domElement.offsetTop]}:{size:[window.innerWidth,window.innerHeight],offset:[0,0]}),sr(this,"connect",n=>{this.domElement=n,n instanceof Document||n.setAttribute("tabindex",-1),this.domElement.addEventListener("contextmenu",R9),this.domElement.addEventListener("pointermove",this.pointermove),this.domElement.addEventListener("pointerdown",this.pointerdown),this.domElement.addEventListener("pointerup",this.pointerup),window.addEventListener("keydown",this.keydown),window.addEventListener("keyup",this.keyup)}),sr(this,"dispose",()=>{this.domElement.removeEventListener("contextmenu",R9),this.domElement.removeEventListener("pointermove",this.pointermove),this.domElement.removeEventListener("pointerdown",this.pointerdown),this.domElement.removeEventListener("pointerup",this.pointerup),window.removeEventListener("keydown",this.keydown),window.removeEventListener("keyup",this.keyup)}),this.object=e,t!==void 0&&this.connect(t),this.updateMovementVector(),this.updateRotationVector()}};var Ace=Object.defineProperty,yce=(i,e,t)=>e in i?Ace(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,km=(i,e,t)=>(yce(i,typeof e!="symbol"?e+"":e,t),t);class c4{constructor(){km(this,"enabled",!0),km(this,"needsSwap",!0),km(this,"clear",!1),km(this,"renderToScreen",!1)}setSize(e,t){}render(e,t,n,r,s){console.error("THREE.Pass: .render() must be implemented in derived pass.")}dispose(){}}class Tf{constructor(e){km(this,"camera",new qi(-1,1,1,-1,0,1)),km(this,"geometry",new Fs(2,2)),km(this,"mesh"),this.mesh=new It(this.geometry,e)}get material(){return this.mesh.material}set material(e){this.mesh.material=e}dispose(){this.mesh.geometry.dispose()}render(e){e.render(this.mesh,this.camera)}}var vce=Object.defineProperty,xce=(i,e,t)=>e in i?vce(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,BE=(i,e,t)=>(xce(i,typeof e!="symbol"?e+"":e,t),t);class o5 extends c4{constructor(e,t="tDiffuse"){super(),BE(this,"textureID"),BE(this,"uniforms"),BE(this,"material"),BE(this,"fsQuad"),this.textureID=t,e instanceof Mi?(this.uniforms=e.uniforms,this.material=e):(this.uniforms=rp.clone(e.uniforms),this.material=new Mi({defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new Tf(this.material)}render(e,t,n){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=n.texture),this.fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e))}dispose(){this.fsQuad.dispose(),this.material.dispose()}}const P9={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:`
    varying vec2 vUv;

    void main() {

    	vUv = uv;
    	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

    }
  `,fragmentShader:`
    uniform float opacity;

    uniform sampler2D tDiffuse;

    varying vec2 vUv;

    void main() {

    	vec4 texel = texture2D( tDiffuse, vUv );
    	gl_FragColor = opacity * texel;

    }
  `};var Ece=Object.defineProperty,_ce=(i,e,t)=>e in i?Ece(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,$T=(i,e,t)=>(_ce(i,typeof e!="symbol"?e+"":e,t),t);class L9 extends c4{constructor(e,t){super(),$T(this,"scene"),$T(this,"camera"),$T(this,"inverse"),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(e,t,n){const r=e.getContext(),s=e.state;s.buffers.color.setMask(!1),s.buffers.depth.setMask(!1),s.buffers.color.setLocked(!0),s.buffers.depth.setLocked(!0);let o,a;this.inverse?(o=0,a=1):(o=1,a=0),s.buffers.stencil.setTest(!0),s.buffers.stencil.setOp(r.REPLACE,r.REPLACE,r.REPLACE),s.buffers.stencil.setFunc(r.ALWAYS,o,4294967295),s.buffers.stencil.setClear(a),s.buffers.stencil.setLocked(!0),e.setRenderTarget(n),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera),s.buffers.color.setLocked(!1),s.buffers.depth.setLocked(!1),s.buffers.stencil.setLocked(!1),s.buffers.stencil.setFunc(r.EQUAL,1,4294967295),s.buffers.stencil.setOp(r.KEEP,r.KEEP,r.KEEP),s.buffers.stencil.setLocked(!0)}}class Sce extends c4{constructor(){super(),this.needsSwap=!1}render(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}}var wce=Object.defineProperty,Cce=(i,e,t)=>e in i?wce(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,ec=(i,e,t)=>(Cce(i,typeof e!="symbol"?e+"":e,t),t);class Tce{constructor(e,t){if(ec(this,"renderer"),ec(this,"_pixelRatio"),ec(this,"_width"),ec(this,"_height"),ec(this,"renderTarget1"),ec(this,"renderTarget2"),ec(this,"writeBuffer"),ec(this,"readBuffer"),ec(this,"renderToScreen"),ec(this,"passes",[]),ec(this,"copyPass"),ec(this,"clock"),this.renderer=e,t===void 0){const n={minFilter:Ln,magFilter:Ln,format:gi},r=e.getSize(new Ue);this._pixelRatio=e.getPixelRatio(),this._width=r.width,this._height=r.height,t=new Si(this._width*this._pixelRatio,this._height*this._pixelRatio,n),t.texture.name="EffectComposer.rt1"}else this._pixelRatio=1,this._width=t.width,this._height=t.height;this.renderTarget1=t,this.renderTarget2=t.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,P9===void 0&&console.error("THREE.EffectComposer relies on CopyShader"),o5===void 0&&console.error("THREE.EffectComposer relies on ShaderPass"),this.copyPass=new o5(P9),this.copyPass.material.blending=gc,this.clock=new qw}swapBuffers(){const e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}addPass(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(e,t){this.passes.splice(t,0,e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(e){const t=this.passes.indexOf(e);t!==-1&&this.passes.splice(t,1)}isLastEnabledPass(e){for(let t=e+1;t<this.passes.length;t++)if(this.passes[t].enabled)return!1;return!0}render(e){e===void 0&&(e=this.clock.getDelta());const t=this.renderer.getRenderTarget();let n=!1;const r=this.passes.length;for(let s=0;s<r;s++){const o=this.passes[s];if(o.enabled!==!1){if(o.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(s),o.render(this.renderer,this.writeBuffer,this.readBuffer,e,n),o.needsSwap){if(n){const a=this.renderer.getContext(),l=this.renderer.state.buffers.stencil;l.setFunc(a.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),l.setFunc(a.EQUAL,1,4294967295)}this.swapBuffers()}L9!==void 0&&(o instanceof L9?n=!0:o instanceof Sce&&(n=!1))}}this.renderer.setRenderTarget(t)}reset(e){if(e===void 0){const t=this.renderer.getSize(new Ue);this._pixelRatio=this.renderer.getPixelRatio(),this._width=t.width,this._height=t.height,e=this.renderTarget1.clone(),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(e,t){this._width=e,this._height=t;const n=this._width*this._pixelRatio,r=this._height*this._pixelRatio;this.renderTarget1.setSize(n,r),this.renderTarget2.setSize(n,r);for(let s=0;s<this.passes.length;s++)this.passes[s].setSize(n,r)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.copyPass.dispose()}}var bce=Object.defineProperty,Ice=(i,e,t)=>e in i?bce(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,pm=(i,e,t)=>(Ice(i,typeof e!="symbol"?e+"":e,t),t);class Mce extends c4{constructor(e,t,n,r,s=0){super(),pm(this,"scene"),pm(this,"camera"),pm(this,"overrideMaterial"),pm(this,"clearColor"),pm(this,"clearAlpha"),pm(this,"clearDepth",!1),pm(this,"_oldClearColor",new ut),this.scene=e,this.camera=t,this.overrideMaterial=n,this.clearColor=r,this.clearAlpha=s,this.clear=!0,this.needsSwap=!1}render(e,t,n){let r=e.autoClear;e.autoClear=!1;let s,o=null;this.overrideMaterial!==void 0&&(o=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor&&(e.getClearColor(this._oldClearColor),s=e.getClearAlpha(),e.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:n),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),this.clearColor&&e.setClearColor(this._oldClearColor,s),this.overrideMaterial!==void 0&&(this.scene.overrideMaterial=o),e.autoClear=r}}function cA(i){if(typeof TextDecoder<"u")return new TextDecoder().decode(i);let e="";for(let t=0,n=i.length;t<n;t++)e+=String.fromCharCode(i[t]);try{return decodeURIComponent(escape(e))}catch{return e}}const Fm="srgb",Bf="srgb-linear",B9=3001,Rce=3e3;class RR extends os{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(t){return new kce(t)}),this.register(function(t){return new Fce(t)}),this.register(function(t){return new jce(t)}),this.register(function(t){return new Wce(t)}),this.register(function(t){return new Kce(t)}),this.register(function(t){return new Nce(t)}),this.register(function(t){return new Uce(t)}),this.register(function(t){return new zce(t)}),this.register(function(t){return new Gce(t)}),this.register(function(t){return new Dce(t)}),this.register(function(t){return new Hce(t)}),this.register(function(t){return new Oce(t)}),this.register(function(t){return new Vce(t)}),this.register(function(t){return new Qce(t)}),this.register(function(t){return new Lce(t)}),this.register(function(t){return new Yce(t)}),this.register(function(t){return new $ce(t)})}load(e,t,n,r){const s=this;let o;if(this.resourcePath!=="")o=this.resourcePath;else if(this.path!==""){const c=Lf.extractUrlBase(e);o=Lf.resolveURL(c,this.path)}else o=Lf.extractUrlBase(e);this.manager.itemStart(e);const a=function(c){r?r(c):console.error(c),s.manager.itemError(e),s.manager.itemEnd(e)},l=new Yr(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials),l.load(e,function(c){try{s.parse(c,o,function(u){t(u),s.manager.itemEnd(e)},a)}catch(u){a(u)}},n,a)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,n,r){let s;const o={},a={};if(typeof e=="string")s=JSON.parse(e);else if(e instanceof ArrayBuffer)if(cA(new Uint8Array(e.slice(0,4)))===gH){try{o[ui.KHR_BINARY_GLTF]=new Xce(e)}catch(u){r&&r(u);return}s=JSON.parse(o[ui.KHR_BINARY_GLTF].content)}else s=JSON.parse(cA(new Uint8Array(e)));else s=e;if(s.asset===void 0||s.asset.version[0]<2){r&&r(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const l=new cue(s,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});l.fileLoader.setRequestHeader(this.requestHeader);for(let c=0;c<this.pluginCallbacks.length;c++){const u=this.pluginCallbacks[c](l);u.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),a[u.name]=u,o[u.name]=!0}if(s.extensionsUsed)for(let c=0;c<s.extensionsUsed.length;++c){const u=s.extensionsUsed[c],h=s.extensionsRequired||[];switch(u){case ui.KHR_MATERIALS_UNLIT:o[u]=new Bce;break;case ui.KHR_DRACO_MESH_COMPRESSION:o[u]=new qce(s,this.dracoLoader);break;case ui.KHR_TEXTURE_TRANSFORM:o[u]=new Jce;break;case ui.KHR_MESH_QUANTIZATION:o[u]=new Zce;break;default:h.indexOf(u)>=0&&a[u]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+u+'".')}}l.setExtensions(o),l.setPlugins(a),l.parse(n,r)}parseAsync(e,t){const n=this;return new Promise(function(r,s){n.parse(e,t,r,s)})}}function Pce(){let i={};return{get:function(e){return i[e]},add:function(e,t){i[e]=t},remove:function(e){delete i[e]},removeAll:function(){i={}}}}const ui={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class Lce{constructor(e){this.parser=e,this.name=ui.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let n=0,r=t.length;n<r;n++){const s=t[n];s.extensions&&s.extensions[this.name]&&s.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,s.extensions[this.name].light)}}_loadLight(e){const t=this.parser,n="light:"+e;let r=t.cache.get(n);if(r)return r;const s=t.json,l=((s.extensions&&s.extensions[this.name]||{}).lights||[])[e];let c;const u=new ut(16777215);l.color!==void 0&&u.setRGB(l.color[0],l.color[1],l.color[2],Bf);const h=l.range!==void 0?l.range:0;switch(l.type){case"directional":c=new $w(u),c.target.position.set(0,0,-1),c.add(c.target);break;case"point":c=new F2(u),c.distance=h;break;case"spot":c=new Yw(u),c.distance=h,l.spot=l.spot||{},l.spot.innerConeAngle=l.spot.innerConeAngle!==void 0?l.spot.innerConeAngle:0,l.spot.outerConeAngle=l.spot.outerConeAngle!==void 0?l.spot.outerConeAngle:Math.PI/4,c.angle=l.spot.outerConeAngle,c.penumbra=1-l.spot.innerConeAngle/l.spot.outerConeAngle,c.target.position.set(0,0,-1),c.add(c.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+l.type)}return c.position.set(0,0,0),c.decay=2,xf(c,l),l.intensity!==void 0&&(c.intensity=l.intensity),c.name=t.createUniqueName(l.name||"light_"+e),r=Promise.resolve(c),t.cache.add(n,r),r}getDependency(e,t){if(e==="light")return this._loadLight(t)}createNodeAttachment(e){const t=this,n=this.parser,s=n.json.nodes[e],a=(s.extensions&&s.extensions[this.name]||{}).light;return a===void 0?null:this._loadLight(a).then(function(l){return n._getNodeRef(t.cache,a,l)})}}class Bce{constructor(){this.name=ui.KHR_MATERIALS_UNLIT}getMaterialType(){return no}extendParams(e,t,n){const r=[];e.color=new ut(1,1,1),e.opacity=1;const s=t.pbrMetallicRoughness;if(s){if(Array.isArray(s.baseColorFactor)){const o=s.baseColorFactor;e.color.setRGB(o[0],o[1],o[2],Bf),e.opacity=o[3]}s.baseColorTexture!==void 0&&r.push(n.assignTexture(e,"map",s.baseColorTexture,Fm))}return Promise.all(r)}}class Dce{constructor(e){this.parser=e,this.name=ui.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=r.extensions[this.name].emissiveStrength;return s!==void 0&&(t.emissiveIntensity=s),Promise.resolve()}}class kce{constructor(e){this.parser=e,this.name=ui.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:nl}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];if(o.clearcoatFactor!==void 0&&(t.clearcoat=o.clearcoatFactor),o.clearcoatTexture!==void 0&&s.push(n.assignTexture(t,"clearcoatMap",o.clearcoatTexture)),o.clearcoatRoughnessFactor!==void 0&&(t.clearcoatRoughness=o.clearcoatRoughnessFactor),o.clearcoatRoughnessTexture!==void 0&&s.push(n.assignTexture(t,"clearcoatRoughnessMap",o.clearcoatRoughnessTexture)),o.clearcoatNormalTexture!==void 0&&(s.push(n.assignTexture(t,"clearcoatNormalMap",o.clearcoatNormalTexture)),o.clearcoatNormalTexture.scale!==void 0)){const a=o.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new Ue(a,a)}return Promise.all(s)}}class Fce{constructor(e){this.parser=e,this.name=ui.KHR_MATERIALS_DISPERSION}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:nl}extendMaterialParams(e,t){const r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=r.extensions[this.name];return t.dispersion=s.dispersion!==void 0?s.dispersion:0,Promise.resolve()}}class Oce{constructor(e){this.parser=e,this.name=ui.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:nl}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];return o.iridescenceFactor!==void 0&&(t.iridescence=o.iridescenceFactor),o.iridescenceTexture!==void 0&&s.push(n.assignTexture(t,"iridescenceMap",o.iridescenceTexture)),o.iridescenceIor!==void 0&&(t.iridescenceIOR=o.iridescenceIor),t.iridescenceThicknessRange===void 0&&(t.iridescenceThicknessRange=[100,400]),o.iridescenceThicknessMinimum!==void 0&&(t.iridescenceThicknessRange[0]=o.iridescenceThicknessMinimum),o.iridescenceThicknessMaximum!==void 0&&(t.iridescenceThicknessRange[1]=o.iridescenceThicknessMaximum),o.iridescenceThicknessTexture!==void 0&&s.push(n.assignTexture(t,"iridescenceThicknessMap",o.iridescenceThicknessTexture)),Promise.all(s)}}class Nce{constructor(e){this.parser=e,this.name=ui.KHR_MATERIALS_SHEEN}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:nl}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[];t.sheenColor=new ut(0,0,0),t.sheenRoughness=0,t.sheen=1;const o=r.extensions[this.name];if(o.sheenColorFactor!==void 0){const a=o.sheenColorFactor;t.sheenColor.setRGB(a[0],a[1],a[2],Bf)}return o.sheenRoughnessFactor!==void 0&&(t.sheenRoughness=o.sheenRoughnessFactor),o.sheenColorTexture!==void 0&&s.push(n.assignTexture(t,"sheenColorMap",o.sheenColorTexture,Fm)),o.sheenRoughnessTexture!==void 0&&s.push(n.assignTexture(t,"sheenRoughnessMap",o.sheenRoughnessTexture)),Promise.all(s)}}class Uce{constructor(e){this.parser=e,this.name=ui.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:nl}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];return o.transmissionFactor!==void 0&&(t.transmission=o.transmissionFactor),o.transmissionTexture!==void 0&&s.push(n.assignTexture(t,"transmissionMap",o.transmissionTexture)),Promise.all(s)}}class zce{constructor(e){this.parser=e,this.name=ui.KHR_MATERIALS_VOLUME}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:nl}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];t.thickness=o.thicknessFactor!==void 0?o.thicknessFactor:0,o.thicknessTexture!==void 0&&s.push(n.assignTexture(t,"thicknessMap",o.thicknessTexture)),t.attenuationDistance=o.attenuationDistance||1/0;const a=o.attenuationColor||[1,1,1];return t.attenuationColor=new ut().setRGB(a[0],a[1],a[2],Bf),Promise.all(s)}}class Gce{constructor(e){this.parser=e,this.name=ui.KHR_MATERIALS_IOR}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:nl}extendMaterialParams(e,t){const r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=r.extensions[this.name];return t.ior=s.ior!==void 0?s.ior:1.5,Promise.resolve()}}class Hce{constructor(e){this.parser=e,this.name=ui.KHR_MATERIALS_SPECULAR}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:nl}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];t.specularIntensity=o.specularFactor!==void 0?o.specularFactor:1,o.specularTexture!==void 0&&s.push(n.assignTexture(t,"specularIntensityMap",o.specularTexture));const a=o.specularColorFactor||[1,1,1];return t.specularColor=new ut().setRGB(a[0],a[1],a[2],Bf),o.specularColorTexture!==void 0&&s.push(n.assignTexture(t,"specularColorMap",o.specularColorTexture,Fm)),Promise.all(s)}}class Qce{constructor(e){this.parser=e,this.name=ui.EXT_MATERIALS_BUMP}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:nl}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];return t.bumpScale=o.bumpFactor!==void 0?o.bumpFactor:1,o.bumpTexture!==void 0&&s.push(n.assignTexture(t,"bumpMap",o.bumpTexture)),Promise.all(s)}}class Vce{constructor(e){this.parser=e,this.name=ui.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:nl}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];return o.anisotropyStrength!==void 0&&(t.anisotropy=o.anisotropyStrength),o.anisotropyRotation!==void 0&&(t.anisotropyRotation=o.anisotropyRotation),o.anisotropyTexture!==void 0&&s.push(n.assignTexture(t,"anisotropyMap",o.anisotropyTexture)),Promise.all(s)}}class jce{constructor(e){this.parser=e,this.name=ui.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,n=t.json,r=n.textures[e];if(!r.extensions||!r.extensions[this.name])return null;const s=r.extensions[this.name],o=t.options.ktx2Loader;if(!o){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,s.source,o)}}class Wce{constructor(e){this.parser=e,this.name=ui.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,n=this.parser,r=n.json,s=r.textures[e];if(!s.extensions||!s.extensions[t])return null;const o=s.extensions[t],a=r.images[o.source];let l=n.textureLoader;if(a.uri){const c=n.options.manager.getHandler(a.uri);c!==null&&(l=c)}return this.detectSupport().then(function(c){if(c)return n.loadTextureImage(e,o.source,l);if(r.extensionsRequired&&r.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return n.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class Kce{constructor(e){this.parser=e,this.name=ui.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const t=this.name,n=this.parser,r=n.json,s=r.textures[e];if(!s.extensions||!s.extensions[t])return null;const o=s.extensions[t],a=r.images[o.source];let l=n.textureLoader;if(a.uri){const c=n.options.manager.getHandler(a.uri);c!==null&&(l=c)}return this.detectSupport().then(function(c){if(c)return n.loadTextureImage(e,o.source,l);if(r.extensionsRequired&&r.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return n.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class Yce{constructor(e){this.name=ui.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,n=t.bufferViews[e];if(n.extensions&&n.extensions[this.name]){const r=n.extensions[this.name],s=this.parser.getDependency("buffer",r.buffer),o=this.parser.options.meshoptDecoder;if(!o||!o.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return s.then(function(a){const l=r.byteOffset||0,c=r.byteLength||0,u=r.count,h=r.byteStride,f=new Uint8Array(a,l,c);return o.decodeGltfBufferAsync?o.decodeGltfBufferAsync(u,h,f,r.mode,r.filter).then(function(d){return d.buffer}):o.ready.then(function(){const d=new ArrayBuffer(u*h);return o.decodeGltfBuffer(new Uint8Array(d),u,h,f,r.mode,r.filter),d})})}else return null}}class $ce{constructor(e){this.name=ui.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const t=this.parser.json,n=t.nodes[e];if(!n.extensions||!n.extensions[this.name]||n.mesh===void 0)return null;const r=t.meshes[n.mesh];for(const c of r.primitives)if(c.mode!==ic.TRIANGLES&&c.mode!==ic.TRIANGLE_STRIP&&c.mode!==ic.TRIANGLE_FAN&&c.mode!==void 0)return null;const o=n.extensions[this.name].attributes,a=[],l={};for(const c in o)a.push(this.parser.getDependency("accessor",o[c]).then(u=>(l[c]=u,l[c])));return a.length<1?null:(a.push(this.parser.createNodeMesh(e)),Promise.all(a).then(c=>{const u=c.pop(),h=u.isGroup?u.children:[u],f=c[0].count,d=[];for(const m of h){const y=new Xe,g=new Q,A=new Xt,E=new Q(1,1,1),x=new ux(m.geometry,m.material,f);for(let w=0;w<f;w++)l.TRANSLATION&&g.fromBufferAttribute(l.TRANSLATION,w),l.ROTATION&&A.fromBufferAttribute(l.ROTATION,w),l.SCALE&&E.fromBufferAttribute(l.SCALE,w),x.setMatrixAt(w,y.compose(g,A,E));for(const w in l)if(w==="_COLOR_0"){const T=l[w];x.instanceColor=new Su(T.array,T.itemSize,T.normalized)}else w!=="TRANSLATION"&&w!=="ROTATION"&&w!=="SCALE"&&m.geometry.setAttribute(w,l[w]);_n.prototype.copy.call(x,m),this.parser.assignFinalMaterial(x),d.push(x)}return u.isGroup?(u.clear(),u.add(...d),u):d[0]}))}}const gH="glTF",nv=12,D9={JSON:1313821514,BIN:5130562};class Xce{constructor(e){this.name=ui.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,nv);if(this.header={magic:cA(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==gH)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const n=this.header.length-nv,r=new DataView(e,nv);let s=0;for(;s<n;){const o=r.getUint32(s,!0);s+=4;const a=r.getUint32(s,!0);if(s+=4,a===D9.JSON){const l=new Uint8Array(e,nv+s,o);this.content=cA(l)}else if(a===D9.BIN){const l=nv+s;this.body=e.slice(l,l+o)}s+=o}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class qce{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=ui.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const n=this.json,r=this.dracoLoader,s=e.extensions[this.name].bufferView,o=e.extensions[this.name].attributes,a={},l={},c={};for(const u in o){const h=a5[u]||u.toLowerCase();a[h]=o[u]}for(const u in e.attributes){const h=a5[u]||u.toLowerCase();if(o[u]!==void 0){const f=n.accessors[e.attributes[u]],d=W1[f.componentType];c[h]=d.name,l[h]=f.normalized===!0}}return t.getDependency("bufferView",s).then(function(u){return new Promise(function(h,f){r.decodeDracoFile(u,function(d){for(const m in d.attributes){const y=d.attributes[m],g=l[m];g!==void 0&&(y.normalized=g)}h(d)},a,c,Bf,f)})})}}class Jce{constructor(){this.name=ui.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return(t.texCoord===void 0||t.texCoord===e.channel)&&t.offset===void 0&&t.rotation===void 0&&t.scale===void 0||(e=e.clone(),t.texCoord!==void 0&&(e.channel=t.texCoord),t.offset!==void 0&&e.offset.fromArray(t.offset),t.rotation!==void 0&&(e.rotation=t.rotation),t.scale!==void 0&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class Zce{constructor(){this.name=ui.KHR_MESH_QUANTIZATION}}class AH extends bA{constructor(e,t,n,r){super(e,t,n,r)}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,r=this.valueSize,s=e*r*3+r;for(let o=0;o!==r;o++)t[o]=n[s+o];return t}interpolate_(e,t,n,r){const s=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=a*2,c=a*3,u=r-t,h=(n-t)/u,f=h*h,d=f*h,m=e*c,y=m-c,g=-2*d+3*f,A=d-f,E=1-g,x=A-f+h;for(let w=0;w!==a;w++){const T=o[y+w+a],I=o[y+w+l]*u,M=o[m+w+a],L=o[m+w]*u;s[w]=E*T+x*I+g*M+A*L}return s}}const eue=new Xt;class tue extends AH{interpolate_(e,t,n,r){const s=super.interpolate_(e,t,n,r);return eue.fromArray(s).normalize().toArray(s),s}}const ic={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},W1={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},k9={9728:zn,9729:Ln,9984:S2,9985:vw,9986:z1,9987:Bl},F9={33071:Wi,33648:eA,10497:_o},XT={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},a5={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",...RA>=152?{TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3"}:{TEXCOORD_0:"uv",TEXCOORD_1:"uv2"},COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},Md={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},nue={CUBICSPLINE:void 0,LINEAR:Zm,STEP:tA},qT={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function iue(i){return i.DefaultMaterial===void 0&&(i.DefaultMaterial=new m0({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:tl})),i.DefaultMaterial}function mm(i,e,t){for(const n in t.extensions)i[n]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[n]=t.extensions[n])}function xf(i,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(i.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function rue(i,e,t){let n=!1,r=!1,s=!1;for(let c=0,u=e.length;c<u;c++){const h=e[c];if(h.POSITION!==void 0&&(n=!0),h.NORMAL!==void 0&&(r=!0),h.COLOR_0!==void 0&&(s=!0),n&&r&&s)break}if(!n&&!r&&!s)return Promise.resolve(i);const o=[],a=[],l=[];for(let c=0,u=e.length;c<u;c++){const h=e[c];if(n){const f=h.POSITION!==void 0?t.getDependency("accessor",h.POSITION):i.attributes.position;o.push(f)}if(r){const f=h.NORMAL!==void 0?t.getDependency("accessor",h.NORMAL):i.attributes.normal;a.push(f)}if(s){const f=h.COLOR_0!==void 0?t.getDependency("accessor",h.COLOR_0):i.attributes.color;l.push(f)}}return Promise.all([Promise.all(o),Promise.all(a),Promise.all(l)]).then(function(c){const u=c[0],h=c[1],f=c[2];return n&&(i.morphAttributes.position=u),r&&(i.morphAttributes.normal=h),s&&(i.morphAttributes.color=f),i.morphTargetsRelative=!0,i})}function sue(i,e){if(i.updateMorphTargets(),e.weights!==void 0)for(let t=0,n=e.weights.length;t<n;t++)i.morphTargetInfluences[t]=e.weights[t];if(e.extras&&Array.isArray(e.extras.targetNames)){const t=e.extras.targetNames;if(i.morphTargetInfluences.length===t.length){i.morphTargetDictionary={};for(let n=0,r=t.length;n<r;n++)i.morphTargetDictionary[t[n]]=n}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function oue(i){let e;const t=i.extensions&&i.extensions[ui.KHR_DRACO_MESH_COMPRESSION];if(t?e="draco:"+t.bufferView+":"+t.indices+":"+JT(t.attributes):e=i.indices+":"+JT(i.attributes)+":"+i.mode,i.targets!==void 0)for(let n=0,r=i.targets.length;n<r;n++)e+=":"+JT(i.targets[n]);return e}function JT(i){let e="";const t=Object.keys(i).sort();for(let n=0,r=t.length;n<r;n++)e+=t[n]+":"+i[t[n]]+";";return e}function l5(i){switch(i){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function aue(i){return i.search(/\.jpe?g($|\?)/i)>0||i.search(/^data\:image\/jpeg/)===0?"image/jpeg":i.search(/\.webp($|\?)/i)>0||i.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}const lue=new Xe;class cue{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new Pce,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let n=!1,r=!1,s=-1;typeof navigator<"u"&&typeof navigator.userAgent<"u"&&(n=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,r=navigator.userAgent.indexOf("Firefox")>-1,s=r?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),typeof createImageBitmap>"u"||n||r&&s<98?this.textureLoader=new xh(this.options.manager):this.textureLoader=new wz(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new Yr(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const n=this,r=this.json,s=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(o){return o._markDefs&&o._markDefs()}),Promise.all(this._invokeAll(function(o){return o.beforeRoot&&o.beforeRoot()})).then(function(){return Promise.all([n.getDependencies("scene"),n.getDependencies("animation"),n.getDependencies("camera")])}).then(function(o){const a={scene:o[0][r.scene||0],scenes:o[0],animations:o[1],cameras:o[2],asset:r.asset,parser:n,userData:{}};return mm(s,a,r),xf(a,r),Promise.all(n._invokeAll(function(l){return l.afterRoot&&l.afterRoot(a)})).then(function(){for(const l of a.scenes)l.updateMatrixWorld();e(a)})}).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],n=this.json.meshes||[];for(let r=0,s=t.length;r<s;r++){const o=t[r].joints;for(let a=0,l=o.length;a<l;a++)e[o[a]].isBone=!0}for(let r=0,s=e.length;r<s;r++){const o=e[r];o.mesh!==void 0&&(this._addNodeRef(this.meshCache,o.mesh),o.skin!==void 0&&(n[o.mesh].isSkinnedMesh=!0)),o.camera!==void 0&&this._addNodeRef(this.cameraCache,o.camera)}}_addNodeRef(e,t){t!==void 0&&(e.refs[t]===void 0&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,n){if(e.refs[t]<=1)return n;const r=n.clone(),s=(o,a)=>{const l=this.associations.get(o);l!=null&&this.associations.set(a,l);for(const[c,u]of o.children.entries())s(u,a.children[c])};return s(n,r),r.name+="_instance_"+e.uses[t]++,r}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let n=0;n<t.length;n++){const r=e(t[n]);if(r)return r}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const n=[];for(let r=0;r<t.length;r++){const s=e(t[r]);s&&n.push(s)}return n}getDependency(e,t){const n=e+":"+t;let r=this.cache.get(n);if(!r){switch(e){case"scene":r=this.loadScene(t);break;case"node":r=this._invokeOne(function(s){return s.loadNode&&s.loadNode(t)});break;case"mesh":r=this._invokeOne(function(s){return s.loadMesh&&s.loadMesh(t)});break;case"accessor":r=this.loadAccessor(t);break;case"bufferView":r=this._invokeOne(function(s){return s.loadBufferView&&s.loadBufferView(t)});break;case"buffer":r=this.loadBuffer(t);break;case"material":r=this._invokeOne(function(s){return s.loadMaterial&&s.loadMaterial(t)});break;case"texture":r=this._invokeOne(function(s){return s.loadTexture&&s.loadTexture(t)});break;case"skin":r=this.loadSkin(t);break;case"animation":r=this._invokeOne(function(s){return s.loadAnimation&&s.loadAnimation(t)});break;case"camera":r=this.loadCamera(t);break;default:if(r=this._invokeOne(function(s){return s!=this&&s.getDependency&&s.getDependency(e,t)}),!r)throw new Error("Unknown type: "+e);break}this.cache.add(n,r)}return r}getDependencies(e){let t=this.cache.get(e);if(!t){const n=this,r=this.json[e+(e==="mesh"?"es":"s")]||[];t=Promise.all(r.map(function(s,o){return n.getDependency(e,o)})),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],n=this.fileLoader;if(t.type&&t.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(t.uri===void 0&&e===0)return Promise.resolve(this.extensions[ui.KHR_BINARY_GLTF].body);const r=this.options;return new Promise(function(s,o){n.load(Lf.resolveURL(t.uri,r.path),s,void 0,function(){o(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(n){const r=t.byteLength||0,s=t.byteOffset||0;return n.slice(s,s+r)})}loadAccessor(e){const t=this,n=this.json,r=this.json.accessors[e];if(r.bufferView===void 0&&r.sparse===void 0){const o=XT[r.type],a=W1[r.componentType],l=r.normalized===!0,c=new a(r.count*o);return Promise.resolve(new mn(c,o,l))}const s=[];return r.bufferView!==void 0?s.push(this.getDependency("bufferView",r.bufferView)):s.push(null),r.sparse!==void 0&&(s.push(this.getDependency("bufferView",r.sparse.indices.bufferView)),s.push(this.getDependency("bufferView",r.sparse.values.bufferView))),Promise.all(s).then(function(o){const a=o[0],l=XT[r.type],c=W1[r.componentType],u=c.BYTES_PER_ELEMENT,h=u*l,f=r.byteOffset||0,d=r.bufferView!==void 0?n.bufferViews[r.bufferView].byteStride:void 0,m=r.normalized===!0;let y,g;if(d&&d!==h){const A=Math.floor(f/d),E="InterleavedBuffer:"+r.bufferView+":"+r.componentType+":"+A+":"+r.count;let x=t.cache.get(E);x||(y=new c(a,A*d,r.count*d/u),x=new lx(y,d/u),t.cache.add(E,x)),g=new Ja(x,l,f%d/u,m)}else a===null?y=new c(r.count*l):y=new c(a,f,r.count*l),g=new mn(y,l,m);if(r.sparse!==void 0){const A=XT.SCALAR,E=W1[r.sparse.indices.componentType],x=r.sparse.indices.byteOffset||0,w=r.sparse.values.byteOffset||0,T=new E(o[1],x,r.sparse.count*A),I=new c(o[2],w,r.sparse.count*l);a!==null&&(g=new mn(g.array.slice(),g.itemSize,g.normalized));for(let M=0,L=T.length;M<L;M++){const P=T[M];if(g.setX(P,I[M*l]),l>=2&&g.setY(P,I[M*l+1]),l>=3&&g.setZ(P,I[M*l+2]),l>=4&&g.setW(P,I[M*l+3]),l>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return g})}loadTexture(e){const t=this.json,n=this.options,s=t.textures[e].source,o=t.images[s];let a=this.textureLoader;if(o.uri){const l=n.manager.getHandler(o.uri);l!==null&&(a=l)}return this.loadTextureImage(e,s,a)}loadTextureImage(e,t,n){const r=this,s=this.json,o=s.textures[e],a=s.images[t],l=(a.uri||a.bufferView)+":"+o.sampler;if(this.textureCache[l])return this.textureCache[l];const c=this.loadImageSource(t,n).then(function(u){u.flipY=!1,u.name=o.name||a.name||"",u.name===""&&typeof a.uri=="string"&&a.uri.startsWith("data:image/")===!1&&(u.name=a.uri);const f=(s.samplers||{})[o.sampler]||{};return u.magFilter=k9[f.magFilter]||Ln,u.minFilter=k9[f.minFilter]||Bl,u.wrapS=F9[f.wrapS]||_o,u.wrapT=F9[f.wrapT]||_o,r.associations.set(u,{textures:e}),u}).catch(function(){return null});return this.textureCache[l]=c,c}loadImageSource(e,t){const n=this,r=this.json,s=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(h=>h.clone());const o=r.images[e],a=self.URL||self.webkitURL;let l=o.uri||"",c=!1;if(o.bufferView!==void 0)l=n.getDependency("bufferView",o.bufferView).then(function(h){c=!0;const f=new Blob([h],{type:o.mimeType});return l=a.createObjectURL(f),l});else if(o.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const u=Promise.resolve(l).then(function(h){return new Promise(function(f,d){let m=f;t.isImageBitmapLoader===!0&&(m=function(y){const g=new vi(y);g.needsUpdate=!0,f(g)}),t.load(Lf.resolveURL(h,s.path),m,void 0,d)})}).then(function(h){return c===!0&&a.revokeObjectURL(l),xf(h,o),h.userData.mimeType=o.mimeType||aue(o.uri),h}).catch(function(h){throw console.error("THREE.GLTFLoader: Couldn't load texture",l),h});return this.sourceCache[e]=u,u}assignTexture(e,t,n,r){const s=this;return this.getDependency("texture",n.index).then(function(o){if(!o)return null;if(n.texCoord!==void 0&&n.texCoord>0&&(o=o.clone(),o.channel=n.texCoord),s.extensions[ui.KHR_TEXTURE_TRANSFORM]){const a=n.extensions!==void 0?n.extensions[ui.KHR_TEXTURE_TRANSFORM]:void 0;if(a){const l=s.associations.get(o);o=s.extensions[ui.KHR_TEXTURE_TRANSFORM].extendTexture(o,a),s.associations.set(o,l)}}return r!==void 0&&(typeof r=="number"&&(r=r===B9?Fm:Bf),"colorSpace"in o?o.colorSpace=r:o.encoding=r===Fm?B9:Rce),e[t]=o,o})}assignFinalMaterial(e){const t=e.geometry;let n=e.material;const r=t.attributes.tangent===void 0,s=t.attributes.color!==void 0,o=t.attributes.normal===void 0;if(e.isPoints){const a="PointsMaterial:"+n.uuid;let l=this.cache.get(a);l||(l=new hx,Us.prototype.copy.call(l,n),l.color.copy(n.color),l.map=n.map,l.sizeAttenuation=!1,this.cache.add(a,l)),n=l}else if(e.isLine){const a="LineBasicMaterial:"+n.uuid;let l=this.cache.get(a);l||(l=new vs,Us.prototype.copy.call(l,n),l.color.copy(n.color),l.map=n.map,this.cache.add(a,l)),n=l}if(r||s||o){let a="ClonedMaterial:"+n.uuid+":";r&&(a+="derivative-tangents:"),s&&(a+="vertex-colors:"),o&&(a+="flat-shading:");let l=this.cache.get(a);l||(l=n.clone(),s&&(l.vertexColors=!0),o&&(l.flatShading=!0),r&&(l.normalScale&&(l.normalScale.y*=-1),l.clearcoatNormalScale&&(l.clearcoatNormalScale.y*=-1)),this.cache.add(a,l),this.associations.set(l,this.associations.get(n))),n=l}e.material=n}getMaterialType(){return m0}loadMaterial(e){const t=this,n=this.json,r=this.extensions,s=n.materials[e];let o;const a={},l=s.extensions||{},c=[];if(l[ui.KHR_MATERIALS_UNLIT]){const h=r[ui.KHR_MATERIALS_UNLIT];o=h.getMaterialType(),c.push(h.extendParams(a,s,t))}else{const h=s.pbrMetallicRoughness||{};if(a.color=new ut(1,1,1),a.opacity=1,Array.isArray(h.baseColorFactor)){const f=h.baseColorFactor;a.color.setRGB(f[0],f[1],f[2],Bf),a.opacity=f[3]}h.baseColorTexture!==void 0&&c.push(t.assignTexture(a,"map",h.baseColorTexture,Fm)),a.metalness=h.metallicFactor!==void 0?h.metallicFactor:1,a.roughness=h.roughnessFactor!==void 0?h.roughnessFactor:1,h.metallicRoughnessTexture!==void 0&&(c.push(t.assignTexture(a,"metalnessMap",h.metallicRoughnessTexture)),c.push(t.assignTexture(a,"roughnessMap",h.metallicRoughnessTexture))),o=this._invokeOne(function(f){return f.getMaterialType&&f.getMaterialType(e)}),c.push(Promise.all(this._invokeAll(function(f){return f.extendMaterialParams&&f.extendMaterialParams(e,a)})))}s.doubleSided===!0&&(a.side=Li);const u=s.alphaMode||qT.OPAQUE;if(u===qT.BLEND?(a.transparent=!0,a.depthWrite=!1):(a.transparent=!1,u===qT.MASK&&(a.alphaTest=s.alphaCutoff!==void 0?s.alphaCutoff:.5)),s.normalTexture!==void 0&&o!==no&&(c.push(t.assignTexture(a,"normalMap",s.normalTexture)),a.normalScale=new Ue(1,1),s.normalTexture.scale!==void 0)){const h=s.normalTexture.scale;a.normalScale.set(h,h)}if(s.occlusionTexture!==void 0&&o!==no&&(c.push(t.assignTexture(a,"aoMap",s.occlusionTexture)),s.occlusionTexture.strength!==void 0&&(a.aoMapIntensity=s.occlusionTexture.strength)),s.emissiveFactor!==void 0&&o!==no){const h=s.emissiveFactor;a.emissive=new ut().setRGB(h[0],h[1],h[2],Bf)}return s.emissiveTexture!==void 0&&o!==no&&c.push(t.assignTexture(a,"emissiveMap",s.emissiveTexture,Fm)),Promise.all(c).then(function(){const h=new o(a);return s.name&&(h.name=s.name),xf(h,s),t.associations.set(h,{materials:e}),s.extensions&&mm(r,h,s),h})}createUniqueName(e){const t=li.sanitizeNodeName(e||"");return t in this.nodeNamesUsed?t+"_"+ ++this.nodeNamesUsed[t]:(this.nodeNamesUsed[t]=0,t)}loadGeometries(e){const t=this,n=this.extensions,r=this.primitiveCache;function s(a){return n[ui.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(a,t).then(function(l){return O9(l,a,t)})}const o=[];for(let a=0,l=e.length;a<l;a++){const c=e[a],u=oue(c),h=r[u];if(h)o.push(h.promise);else{let f;c.extensions&&c.extensions[ui.KHR_DRACO_MESH_COMPRESSION]?f=s(c):f=O9(new fn,c,t),r[u]={primitive:c,promise:f},o.push(f)}}return Promise.all(o)}loadMesh(e){const t=this,n=this.json,r=this.extensions,s=n.meshes[e],o=s.primitives,a=[];for(let l=0,c=o.length;l<c;l++){const u=o[l].material===void 0?iue(this.cache):this.getDependency("material",o[l].material);a.push(u)}return a.push(t.loadGeometries(o)),Promise.all(a).then(function(l){const c=l.slice(0,l.length-1),u=l[l.length-1],h=[];for(let d=0,m=u.length;d<m;d++){const y=u[d],g=o[d];let A;const E=c[d];if(g.mode===ic.TRIANGLES||g.mode===ic.TRIANGLE_STRIP||g.mode===ic.TRIANGLE_FAN||g.mode===void 0)A=s.isSkinnedMesh===!0?new cx(y,E):new It(y,E),A.isSkinnedMesh===!0&&A.normalizeSkinWeights(),g.mode===ic.TRIANGLE_STRIP?A.geometry=S9(A.geometry,S6):g.mode===ic.TRIANGLE_FAN&&(A.geometry=S9(A.geometry,bS));else if(g.mode===ic.LINES)A=new Ru(y,E);else if(g.mode===ic.LINE_STRIP)A=new $n(y,E);else if(g.mode===ic.LINE_LOOP)A=new B6(y,E);else if(g.mode===ic.POINTS)A=new D6(y,E);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+g.mode);Object.keys(A.geometry.morphAttributes).length>0&&sue(A,s),A.name=t.createUniqueName(s.name||"mesh_"+e),xf(A,s),g.extensions&&mm(r,A,g),t.assignFinalMaterial(A),h.push(A)}for(let d=0,m=h.length;d<m;d++)t.associations.set(h[d],{meshes:e,primitives:d});if(h.length===1)return s.extensions&&mm(r,h[0],s),h[0];const f=new xa;s.extensions&&mm(r,f,s),t.associations.set(f,{meshes:e});for(let d=0,m=h.length;d<m;d++)f.add(h[d]);return f})}loadCamera(e){let t;const n=this.json.cameras[e],r=n[n.type];if(!r){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return n.type==="perspective"?t=new jn(un.radToDeg(r.yfov),r.aspectRatio||1,r.znear||1,r.zfar||2e6):n.type==="orthographic"&&(t=new qi(-r.xmag,r.xmag,r.ymag,-r.ymag,r.znear,r.zfar)),n.name&&(t.name=this.createUniqueName(n.name)),xf(t,n),Promise.resolve(t)}loadSkin(e){const t=this.json.skins[e],n=[];for(let r=0,s=t.joints.length;r<s;r++)n.push(this._loadNodeShallow(t.joints[r]));return t.inverseBindMatrices!==void 0?n.push(this.getDependency("accessor",t.inverseBindMatrices)):n.push(null),Promise.all(n).then(function(r){const s=r.pop(),o=r,a=[],l=[];for(let c=0,u=o.length;c<u;c++){const h=o[c];if(h){a.push(h);const f=new Xe;s!==null&&f.fromArray(s.array,c*16),l.push(f)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[c])}return new TA(a,l)})}loadAnimation(e){const t=this.json,n=this,r=t.animations[e],s=r.name?r.name:"animation_"+e,o=[],a=[],l=[],c=[],u=[];for(let h=0,f=r.channels.length;h<f;h++){const d=r.channels[h],m=r.samplers[d.sampler],y=d.target,g=y.node,A=r.parameters!==void 0?r.parameters[m.input]:m.input,E=r.parameters!==void 0?r.parameters[m.output]:m.output;y.node!==void 0&&(o.push(this.getDependency("node",g)),a.push(this.getDependency("accessor",A)),l.push(this.getDependency("accessor",E)),c.push(m),u.push(y))}return Promise.all([Promise.all(o),Promise.all(a),Promise.all(l),Promise.all(c),Promise.all(u)]).then(function(h){const f=h[0],d=h[1],m=h[2],y=h[3],g=h[4],A=[];for(let E=0,x=f.length;E<x;E++){const w=f[E],T=d[E],I=m[E],M=y[E],L=g[E];if(w===void 0)continue;w.updateMatrix&&w.updateMatrix();const P=n._createAnimationTracks(w,T,I,M,L);if(P)for(let R=0;R<P.length;R++)A.push(P[R])}return new op(s,void 0,A)})}createNodeMesh(e){const t=this.json,n=this,r=t.nodes[e];return r.mesh===void 0?null:n.getDependency("mesh",r.mesh).then(function(s){const o=n._getNodeRef(n.meshCache,r.mesh,s);return r.weights!==void 0&&o.traverse(function(a){if(a.isMesh)for(let l=0,c=r.weights.length;l<c;l++)a.morphTargetInfluences[l]=r.weights[l]}),o})}loadNode(e){const t=this.json,n=this,r=t.nodes[e],s=n._loadNodeShallow(e),o=[],a=r.children||[];for(let c=0,u=a.length;c<u;c++)o.push(n.getDependency("node",a[c]));const l=r.skin===void 0?Promise.resolve(null):n.getDependency("skin",r.skin);return Promise.all([s,Promise.all(o),l]).then(function(c){const u=c[0],h=c[1],f=c[2];f!==null&&u.traverse(function(d){d.isSkinnedMesh&&d.bind(f,lue)});for(let d=0,m=h.length;d<m;d++)u.add(h[d]);return u})}_loadNodeShallow(e){const t=this.json,n=this.extensions,r=this;if(this.nodeCache[e]!==void 0)return this.nodeCache[e];const s=t.nodes[e],o=s.name?r.createUniqueName(s.name):"",a=[],l=r._invokeOne(function(c){return c.createNodeMesh&&c.createNodeMesh(e)});return l&&a.push(l),s.camera!==void 0&&a.push(r.getDependency("camera",s.camera).then(function(c){return r._getNodeRef(r.cameraCache,s.camera,c)})),r._invokeAll(function(c){return c.createNodeAttachment&&c.createNodeAttachment(e)}).forEach(function(c){a.push(c)}),this.nodeCache[e]=Promise.all(a).then(function(c){let u;if(s.isBone===!0?u=new sA:c.length>1?u=new xa:c.length===1?u=c[0]:u=new _n,u!==c[0])for(let h=0,f=c.length;h<f;h++)u.add(c[h]);if(s.name&&(u.userData.name=s.name,u.name=o),xf(u,s),s.extensions&&mm(n,u,s),s.matrix!==void 0){const h=new Xe;h.fromArray(s.matrix),u.applyMatrix4(h)}else s.translation!==void 0&&u.position.fromArray(s.translation),s.rotation!==void 0&&u.quaternion.fromArray(s.rotation),s.scale!==void 0&&u.scale.fromArray(s.scale);return r.associations.has(u)||r.associations.set(u,{}),r.associations.get(u).nodes=e,u}),this.nodeCache[e]}loadScene(e){const t=this.extensions,n=this.json.scenes[e],r=this,s=new xa;n.name&&(s.name=r.createUniqueName(n.name)),xf(s,n),n.extensions&&mm(t,s,n);const o=n.nodes||[],a=[];for(let l=0,c=o.length;l<c;l++)a.push(r.getDependency("node",o[l]));return Promise.all(a).then(function(l){for(let u=0,h=l.length;u<h;u++)s.add(l[u]);const c=u=>{const h=new Map;for(const[f,d]of r.associations)(f instanceof Us||f instanceof vi)&&h.set(f,d);return u.traverse(f=>{const d=r.associations.get(f);d!=null&&h.set(f,d)}),h};return r.associations=c(s),s})}_createAnimationTracks(e,t,n,r,s){const o=[],a=e.name?e.name:e.uuid,l=[];Md[s.path]===Md.weights?e.traverse(function(f){f.morphTargetInfluences&&l.push(f.name?f.name:f.uuid)}):l.push(a);let c;switch(Md[s.path]){case Md.weights:c=sp;break;case Md.rotation:c=vh;break;case Md.position:case Md.scale:c=Of;break;default:switch(n.itemSize){case 1:c=sp;break;case 2:case 3:default:c=Of;break}break}const u=r.interpolation!==void 0?nue[r.interpolation]:Zm,h=this._getArrayFromAccessor(n);for(let f=0,d=l.length;f<d;f++){const m=new c(l[f]+"."+Md[s.path],t.array,h,u);r.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(m),o.push(m)}return o}_getArrayFromAccessor(e){let t=e.array;if(e.normalized){const n=l5(t.constructor),r=new Float32Array(t.length);for(let s=0,o=t.length;s<o;s++)r[s]=t[s]*n;t=r}return t}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(n){const r=this instanceof vh?tue:AH;return new r(this.times,this.values,this.getValueSize()/3,n)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function uue(i,e,t){const n=e.attributes,r=new ti;if(n.POSITION!==void 0){const a=t.json.accessors[n.POSITION],l=a.min,c=a.max;if(l!==void 0&&c!==void 0){if(r.set(new Q(l[0],l[1],l[2]),new Q(c[0],c[1],c[2])),a.normalized){const u=l5(W1[a.componentType]);r.min.multiplyScalar(u),r.max.multiplyScalar(u)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const s=e.targets;if(s!==void 0){const a=new Q,l=new Q;for(let c=0,u=s.length;c<u;c++){const h=s[c];if(h.POSITION!==void 0){const f=t.json.accessors[h.POSITION],d=f.min,m=f.max;if(d!==void 0&&m!==void 0){if(l.setX(Math.max(Math.abs(d[0]),Math.abs(m[0]))),l.setY(Math.max(Math.abs(d[1]),Math.abs(m[1]))),l.setZ(Math.max(Math.abs(d[2]),Math.abs(m[2]))),f.normalized){const y=l5(W1[f.componentType]);l.multiplyScalar(y)}a.max(l)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}r.expandByVector(a)}i.boundingBox=r;const o=new Bi;r.getCenter(o.center),o.radius=r.min.distanceTo(r.max)/2,i.boundingSphere=o}function O9(i,e,t){const n=e.attributes,r=[];function s(o,a){return t.getDependency("accessor",o).then(function(l){i.setAttribute(a,l)})}for(const o in n){const a=a5[o]||o.toLowerCase();a in i.attributes||r.push(s(n[o],a))}if(e.indices!==void 0&&!i.index){const o=t.getDependency("accessor",e.indices).then(function(a){i.setIndex(a)});r.push(o)}return xf(i,e),uue(i,e,t),Promise.all(r).then(function(){return e.targets!==void 0?rue(i,e.targets,t):i})}class hue extends fn{constructor(e,t,n,r){super();const s=[],o=[],a=[],l=new Q,c=new Xe;c.makeRotationFromEuler(n),c.setPosition(t);const u=new Xe;u.copy(c).invert(),h(),this.setAttribute("position",new Gt(s,3)),this.setAttribute("normal",new Gt(o,3)),this.setAttribute("uv",new Gt(a,2));function h(){let y,g=[];const A=new Q,E=new Q;if(e.geometry.isGeometry===!0){console.error("THREE.DecalGeometry no longer supports THREE.Geometry. Use BufferGeometry instead.");return}const x=e.geometry,w=x.attributes.position,T=x.attributes.normal;if(x.index!==null){const I=x.index;for(y=0;y<I.count;y++)A.fromBufferAttribute(w,I.getX(y)),E.fromBufferAttribute(T,I.getX(y)),f(g,A,E)}else for(y=0;y<w.count;y++)A.fromBufferAttribute(w,y),E.fromBufferAttribute(T,y),f(g,A,E);for(g=d(g,l.set(1,0,0)),g=d(g,l.set(-1,0,0)),g=d(g,l.set(0,1,0)),g=d(g,l.set(0,-1,0)),g=d(g,l.set(0,0,1)),g=d(g,l.set(0,0,-1)),y=0;y<g.length;y++){const I=g[y];a.push(.5+I.position.x/r.x,.5+I.position.y/r.y),I.position.applyMatrix4(c),s.push(I.position.x,I.position.y,I.position.z),o.push(I.normal.x,I.normal.y,I.normal.z)}}function f(y,g,A){g.applyMatrix4(e.matrixWorld),g.applyMatrix4(u),A.transformDirection(e.matrixWorld),y.push(new N9(g.clone(),A.clone()))}function d(y,g){const A=[],E=.5*Math.abs(r.dot(g));for(let x=0;x<y.length;x+=3){let w,T,I,M=0,L,P,R,U;const k=y[x+0].position.dot(g)-E,H=y[x+1].position.dot(g)-E,G=y[x+2].position.dot(g)-E;switch(w=k>0,T=H>0,I=G>0,M=(w?1:0)+(T?1:0)+(I?1:0),M){case 0:{A.push(y[x]),A.push(y[x+1]),A.push(y[x+2]);break}case 1:{if(w&&(L=y[x+1],P=y[x+2],R=m(y[x],L,g,E),U=m(y[x],P,g,E)),T){L=y[x],P=y[x+2],R=m(y[x+1],L,g,E),U=m(y[x+1],P,g,E),A.push(R),A.push(P.clone()),A.push(L.clone()),A.push(P.clone()),A.push(R.clone()),A.push(U);break}I&&(L=y[x],P=y[x+1],R=m(y[x+2],L,g,E),U=m(y[x+2],P,g,E)),A.push(L.clone()),A.push(P.clone()),A.push(R),A.push(U),A.push(R.clone()),A.push(P.clone());break}case 2:{w||(L=y[x].clone(),P=m(L,y[x+1],g,E),R=m(L,y[x+2],g,E),A.push(L),A.push(P),A.push(R)),T||(L=y[x+1].clone(),P=m(L,y[x+2],g,E),R=m(L,y[x],g,E),A.push(L),A.push(P),A.push(R)),I||(L=y[x+2].clone(),P=m(L,y[x],g,E),R=m(L,y[x+1],g,E),A.push(L),A.push(P),A.push(R));break}}}return A}function m(y,g,A,E){const x=y.position.dot(A)-E,w=g.position.dot(A)-E,T=x/(x-w);return new N9(new Q(y.position.x+T*(g.position.x-y.position.x),y.position.y+T*(g.position.y-y.position.y),y.position.z+T*(g.position.z-y.position.z)),new Q(y.normal.x+T*(g.normal.x-y.normal.x),y.normal.y+T*(g.normal.y-y.normal.y),y.normal.z+T*(g.normal.z-y.normal.z)))}}}class N9{constructor(e,t){this.position=e,this.normal=t}clone(){return new this.constructor(this.position.clone(),this.normal.clone())}}class fue extends dx{constructor(e,t={}){const{bevelEnabled:n=!1,bevelSize:r=8,bevelThickness:s=10,font:o,height:a=50,size:l=100,lineHeight:c=1,letterSpacing:u=0,...h}=t;if(o===void 0)super();else{const f=o.generateShapes(e,l,{lineHeight:c,letterSpacing:u});super(f,{...h,bevelEnabled:n,bevelSize:r,bevelThickness:s,depth:a})}this.type="TextGeometry"}}const due={uniforms:{tDiffuse:{value:null}},vertexShader:`
    varying vec2 vUv;

    void main() {

    	vUv = uv;
    	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

    }
  `,fragmentShader:`
    uniform sampler2D tDiffuse;

    varying vec2 vUv;

    void main() {

    	vec4 tex = texture2D( tDiffuse, vUv );

    	#ifdef LinearTosRGB
    		gl_FragColor = LinearTosRGB( tex );
    	#else
    		gl_FragColor = sRGBTransferOETF( tex );
    	#endif

    }
  `},pue={uniforms:{tDiffuse:{value:null},h:{value:1/512}},vertexShader:`
      varying vec2 vUv;

      void main() {

        vUv = uv;
        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

      }
  `,fragmentShader:`
    uniform sampler2D tDiffuse;
    uniform float h;

    varying vec2 vUv;

    void main() {

    	vec4 sum = vec4( 0.0 );

    	sum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * h, vUv.y ) ) * 0.051;
    	sum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * h, vUv.y ) ) * 0.0918;
    	sum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * h, vUv.y ) ) * 0.12245;
    	sum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * h, vUv.y ) ) * 0.1531;
    	sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
    	sum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * h, vUv.y ) ) * 0.1531;
    	sum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * h, vUv.y ) ) * 0.12245;
    	sum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * h, vUv.y ) ) * 0.0918;
    	sum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * h, vUv.y ) ) * 0.051;

    	gl_FragColor = sum;

    }
  `},mue={uniforms:{tDiffuse:{value:null},v:{value:1/512}},vertexShader:`
    varying vec2 vUv;

    void main() {

      vUv = uv;
      gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

    }
  `,fragmentShader:`

  uniform sampler2D tDiffuse;
  uniform float v;

  varying vec2 vUv;

  void main() {

    vec4 sum = vec4( 0.0 );

    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * v ) ) * 0.051;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * v ) ) * 0.0918;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * v ) ) * 0.12245;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * v ) ) * 0.1531;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * v ) ) * 0.1531;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * v ) ) * 0.12245;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * v ) ) * 0.0918;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * v ) ) * 0.051;

    gl_FragColor = sum;

  }
  `},ZT=new f0,eb=new Q,zg=new Q,su=new Q,hf=new Q,Zu=new Q,ff=new Q,df=new Q,iv=new Q,rv=new Q,sv=new Q,DE=new Q,ov=new Q,av=new Q,lv=new Q;class gue{constructor(e,t,n){this.camera=e,this.scene=t,this.startPoint=new Q,this.endPoint=new Q,this.collection=[],this.deep=n||Number.MAX_VALUE}select(e,t){return this.startPoint=e||this.startPoint,this.endPoint=t||this.endPoint,this.collection=[],this.updateFrustum(this.startPoint,this.endPoint),this.searchChildInFrustum(ZT,this.scene),this.collection}updateFrustum(e,t){if(e=e||this.startPoint,t=t||this.endPoint,e.x===t.x&&(t.x+=Number.EPSILON),e.y===t.y&&(t.y+=Number.EPSILON),this.camera.updateProjectionMatrix(),this.camera.updateMatrixWorld(),this.camera.isPerspectiveCamera){zg.copy(e),zg.x=Math.min(e.x,t.x),zg.y=Math.max(e.y,t.y),t.x=Math.max(e.x,t.x),t.y=Math.min(e.y,t.y),su.setFromMatrixPosition(this.camera.matrixWorld),hf.copy(zg),Zu.set(t.x,zg.y,0),ff.copy(t),df.set(zg.x,t.y,0),hf.unproject(this.camera),Zu.unproject(this.camera),ff.unproject(this.camera),df.unproject(this.camera),ov.copy(hf).sub(su),av.copy(Zu).sub(su),lv.copy(ff).sub(su),ov.normalize(),av.normalize(),lv.normalize(),ov.multiplyScalar(this.deep),av.multiplyScalar(this.deep),lv.multiplyScalar(this.deep),ov.add(su),av.add(su),lv.add(su);var n=ZT.planes;n[0].setFromCoplanarPoints(su,hf,Zu),n[1].setFromCoplanarPoints(su,Zu,ff),n[2].setFromCoplanarPoints(ff,df,su),n[3].setFromCoplanarPoints(df,hf,su),n[4].setFromCoplanarPoints(Zu,ff,df),n[5].setFromCoplanarPoints(lv,av,ov),n[5].normal.multiplyScalar(-1)}else if(this.camera.isOrthographicCamera){const r=Math.min(e.x,t.x),s=Math.max(e.y,t.y),o=Math.max(e.x,t.x),a=Math.min(e.y,t.y);hf.set(r,s,-1),Zu.set(o,s,-1),ff.set(o,a,-1),df.set(r,a,-1),iv.set(r,s,1),rv.set(o,s,1),sv.set(o,a,1),DE.set(r,a,1),hf.unproject(this.camera),Zu.unproject(this.camera),ff.unproject(this.camera),df.unproject(this.camera),iv.unproject(this.camera),rv.unproject(this.camera),sv.unproject(this.camera),DE.unproject(this.camera);var n=ZT.planes;n[0].setFromCoplanarPoints(hf,iv,rv),n[1].setFromCoplanarPoints(Zu,rv,sv),n[2].setFromCoplanarPoints(sv,DE,df),n[3].setFromCoplanarPoints(DE,iv,hf),n[4].setFromCoplanarPoints(Zu,ff,df),n[5].setFromCoplanarPoints(sv,rv,iv),n[5].normal.multiplyScalar(-1)}else console.error("THREE.SelectionBox: Unsupported camera type.")}searchChildInFrustum(e,t){if((t.isMesh||t.isLine||t.isPoints)&&t.material!==void 0&&(t.geometry.boundingSphere===null&&t.geometry.computeBoundingSphere(),eb.copy(t.geometry.boundingSphere.center),eb.applyMatrix4(t.matrixWorld),e.containsPoint(eb)&&this.collection.push(t)),t.children.length>0)for(let n=0;n<t.children.length;n++)this.searchChildInFrustum(e,t.children[n])}}class Aue{constructor(e,t=" .:-=+*#%@",n={}){const r=n.resolution||.15,s=n.scale||1,o=n.color||!1,a=n.alpha||!1,l=n.block||!1,c=n.invert||!1,u=n.strResolution||"low";let h,f;const d=document.createElement("div");d.style.cursor="default";const m=document.createElement("table");d.appendChild(m);let y,g,A;this.setSize=function(G,X){h=G,f=X,e.setSize(G,X),E()},this.render=function(G,X){e.render(G,X),H(m)},this.domElement=d;function E(){y=Math.floor(h*r),g=Math.floor(f*r),M.width=y,M.height=g,A=e.domElement,A.style.backgroundColor&&(m.rows[0].cells[0].style.backgroundColor=A.style.backgroundColor,m.rows[0].cells[0].style.color=A.style.color),m.cellSpacing=0,m.cellPadding=0;const G=m.style;G.whiteSpace="pre",G.margin="0px",G.padding="0px",G.letterSpacing=k+"px",G.fontFamily=T,G.fontSize=R+"px",G.lineHeight=U+"px",G.textAlign="left",G.textDecoration="none"}const x=" .,:;i1tfLCG08@".split(""),w=" CGO08@".split(""),T="courier new, monospace",I=e.domElement,M=document.createElement("canvas");if(!M.getContext)return;const L=M.getContext("2d");if(!L.getImageData)return;let P=o?w:x;t&&(P=t);const R=2/r*s,U=2/r*s;let k=0;if(u=="low")switch(s){case 1:k=-1;break;case 2:case 3:k=-2.1;break;case 4:k=-3.1;break;case 5:k=-4.15;break}if(u=="medium")switch(s){case 1:k=0;break;case 2:k=-1;break;case 3:k=-1.04;break;case 4:case 5:k=-2.1;break}if(u=="high")switch(s){case 1:case 2:k=0;break;case 3:case 4:case 5:k=-1;break}function H(G){L.clearRect(0,0,y,g),L.drawImage(I,0,0,y,g);const X=L.getImageData(0,0,y,g).data;let Z="";for(let oe=0;oe<g;oe+=2){for(let K=0;K<y;K++){const V=(oe*y+K)*4,W=X[V],F=X[V+1],Y=X[V+2],te=X[V+3];let q,J;J=(.3*W+.59*F+.11*Y)/255,te==0&&(J=1),q=Math.floor((1-J)*(P.length-1)),c&&(q=P.length-q-1);let re=P[q];(re===void 0||re==" ")&&(re="&nbsp;"),o?Z+="<span style='color:rgb("+W+","+F+","+Y+");"+(l?"background-color:rgb("+W+","+F+","+Y+");":"")+(a?"opacity:"+te/255+";":"")+"'>"+re+"</span>":Z+=re}Z+="<br/>"}G.innerHTML=`<tr><td style="display:block;width:${h}px;height:${f}px;overflow:hidden">${Z}</td></tr>`}}}function yH(i,e,t){const n=t.length-i-1;if(e>=t[n])return n-1;if(e<=t[i])return i;let r=i,s=n,o=Math.floor((r+s)/2);for(;e<t[o]||e>=t[o+1];)e<t[o]?s=o:r=o,o=Math.floor((r+s)/2);return o}function yue(i,e,t,n){const r=[],s=[],o=[];r[0]=1;for(let a=1;a<=t;++a){s[a]=e-n[i+1-a],o[a]=n[i+a]-e;let l=0;for(let c=0;c<a;++c){const u=o[c+1],h=s[a-c],f=r[c]/(u+h);r[c]=l+u*f,l=h*f}r[a]=l}return r}function vue(i,e,t,n){const r=yH(i,n,e),s=yue(r,n,i,e),o=new Rn(0,0,0,0);for(let a=0;a<=i;++a){const l=t[r-i+a],c=s[a],u=l.w*c;o.x+=l.x*u,o.y+=l.y*u,o.z+=l.z*u,o.w+=l.w*c}return o}function xue(i,e,t,n,r){const s=[];for(let h=0;h<=t;++h)s[h]=0;const o=[];for(let h=0;h<=n;++h)o[h]=s.slice(0);const a=[];for(let h=0;h<=t;++h)a[h]=s.slice(0);a[0][0]=1;const l=s.slice(0),c=s.slice(0);for(let h=1;h<=t;++h){l[h]=e-r[i+1-h],c[h]=r[i+h]-e;let f=0;for(let d=0;d<h;++d){const m=c[d+1],y=l[h-d];a[h][d]=m+y;const g=a[d][h-1]/a[h][d];a[d][h]=f+m*g,f=y*g}a[h][h]=f}for(let h=0;h<=t;++h)o[0][h]=a[h][t];for(let h=0;h<=t;++h){let f=0,d=1;const m=[];for(let y=0;y<=t;++y)m[y]=s.slice(0);m[0][0]=1;for(let y=1;y<=n;++y){let g=0;const A=h-y,E=t-y;h>=y&&(m[d][0]=m[f][0]/a[E+1][A],g=m[d][0]*a[A][E]);const x=A>=-1?1:-A,w=h-1<=E?y-1:t-h;for(let I=x;I<=w;++I)m[d][I]=(m[f][I]-m[f][I-1])/a[E+1][A+I],g+=m[d][I]*a[A+I][E];h<=E&&(m[d][y]=-m[f][y-1]/a[E+1][h],g+=m[d][y]*a[h][E]),o[y][h]=g;const T=f;f=d,d=T}}let u=t;for(let h=1;h<=n;++h){for(let f=0;f<=t;++f)o[h][f]*=u;u*=t-h}return o}function Eue(i,e,t,n,r){const s=r<i?r:i,o=[],a=yH(i,n,e),l=xue(a,n,i,s,e),c=[];for(let u=0;u<t.length;++u){const h=t[u].clone(),f=h.w;h.x*=f,h.y*=f,h.z*=f,c[u]=h}for(let u=0;u<=s;++u){const h=c[a-i].clone().multiplyScalar(l[u][0]);for(let f=1;f<=i;++f)h.add(c[a-i+f].clone().multiplyScalar(l[u][f]));o[u]=h}for(let u=s+1;u<=r+1;++u)o[u]=new Rn(0,0,0);return o}function _ue(i,e){let t=1;for(let r=2;r<=i;++r)t*=r;let n=1;for(let r=2;r<=e;++r)n*=r;for(let r=2;r<=i-e;++r)n*=r;return t/n}function Sue(i){const e=i.length,t=[],n=[];for(let s=0;s<e;++s){const o=i[s];t[s]=new Q(o.x,o.y,o.z),n[s]=o.w}const r=[];for(let s=0;s<e;++s){const o=t[s].clone();for(let a=1;a<=s;++a)o.sub(r[s-a].clone().multiplyScalar(_ue(s,a)*n[a]));r[s]=o.divideScalar(n[0])}return r}function wue(i,e,t,n,r){const s=Eue(i,e,t,n,r);return Sue(s)}class U9 extends xc{constructor(e,t,n,r,s){super(),this.degree=e,this.knots=t,this.controlPoints=[],this.startKnot=r||0,this.endKnot=s||this.knots.length-1;for(let o=0;o<n.length;++o){const a=n[o];this.controlPoints[o]=new Rn(a.x,a.y,a.z,a.w)}}getPoint(e,t){const n=t||new Q,r=this.knots[this.startKnot]+e*(this.knots[this.endKnot]-this.knots[this.startKnot]),s=vue(this.degree,this.knots,this.controlPoints,r);return s.w!=1&&s.divideScalar(s.w),n.set(s.x,s.y,s.z)}getTangent(e,t){const n=t||new Q,r=this.knots[0]+e*(this.knots[this.knots.length-1]-this.knots[0]),s=wue(this.degree,this.knots,this.controlPoints,r,1);return n.copy(s[1]).normalize(),n}}let ci,ps,Ka;class PR extends os{constructor(e){super(e)}load(e,t,n,r){const s=this,o=s.path===""?Lf.extractUrlBase(e):s.path,a=new Yr(this.manager);a.setPath(s.path),a.setResponseType("arraybuffer"),a.setRequestHeader(s.requestHeader),a.setWithCredentials(s.withCredentials),a.load(e,function(l){try{t(s.parse(l,o))}catch(c){r?r(c):console.error(c),s.manager.itemError(e)}},n,r)}parse(e,t){if(Rue(e))ci=new Mue().parse(e);else{const r=_H(e);if(!Pue(r))throw new Error("THREE.FBXLoader: Unknown format.");if(G9(r)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+G9(r));ci=new Iue().parse(r)}const n=new xh(this.manager).setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin);return new Cue(n,this.manager).parse(ci)}}class Cue{constructor(e,t){this.textureLoader=e,this.manager=t}parse(){ps=this.parseConnections();const e=this.parseImages(),t=this.parseTextures(e),n=this.parseMaterials(t),r=this.parseDeformers(),s=new Tue().parse(r);return this.parseScene(r,s,n),Ka}parseConnections(){const e=new Map;return"Connections"in ci&&ci.Connections.connections.forEach(function(n){const r=n[0],s=n[1],o=n[2];e.has(r)||e.set(r,{parents:[],children:[]});const a={ID:s,relationship:o};e.get(r).parents.push(a),e.has(s)||e.set(s,{parents:[],children:[]});const l={ID:r,relationship:o};e.get(s).children.push(l)}),e}parseImages(){const e={},t={};if("Video"in ci.Objects){const n=ci.Objects.Video;for(const r in n){const s=n[r],o=parseInt(r);if(e[o]=s.RelativeFilename||s.Filename,"Content"in s){const a=s.Content instanceof ArrayBuffer&&s.Content.byteLength>0,l=typeof s.Content=="string"&&s.Content!=="";if(a||l){const c=this.parseImage(n[r]);t[s.RelativeFilename||s.Filename]=c}}}}for(const n in e){const r=e[n];t[r]!==void 0?e[n]=t[r]:e[n]=e[n].split("\\").pop()}return e}parseImage(e){const t=e.Content,n=e.RelativeFilename||e.Filename,r=n.slice(n.lastIndexOf(".")+1).toLowerCase();let s;switch(r){case"bmp":s="image/bmp";break;case"jpg":case"jpeg":s="image/jpeg";break;case"png":s="image/png";break;case"tif":s="image/tiff";break;case"tga":this.manager.getHandler(".tga")===null&&console.warn("FBXLoader: TGA loader not found, skipping ",n),s="image/tga";break;default:console.warn('FBXLoader: Image type "'+r+'" is not supported.');return}if(typeof t=="string")return"data:"+s+";base64,"+t;{const o=new Uint8Array(t);return window.URL.createObjectURL(new Blob([o],{type:s}))}}parseTextures(e){const t=new Map;if("Texture"in ci.Objects){const n=ci.Objects.Texture;for(const r in n){const s=this.parseTexture(n[r],e);t.set(parseInt(r),s)}}return t}parseTexture(e,t){const n=this.loadTexture(e,t);n.ID=e.id,n.name=e.attrName;const r=e.WrapModeU,s=e.WrapModeV,o=r!==void 0?r.value:0,a=s!==void 0?s.value:0;if(n.wrapS=o===0?_o:Wi,n.wrapT=a===0?_o:Wi,"Scaling"in e){const l=e.Scaling.value;n.repeat.x=l[0],n.repeat.y=l[1]}return n}loadTexture(e,t){let n;const r=this.textureLoader.path,s=ps.get(e.id).children;s!==void 0&&s.length>0&&t[s[0].ID]!==void 0&&(n=t[s[0].ID],(n.indexOf("blob:")===0||n.indexOf("data:")===0)&&this.textureLoader.setPath(void 0));let o;const a=e.FileName.slice(-3).toLowerCase();if(a==="tga"){const l=this.manager.getHandler(".tga");l===null?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",e.RelativeFilename),o=new vi):(l.setPath(this.textureLoader.path),o=l.load(n))}else a==="psd"?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",e.RelativeFilename),o=new vi):o=this.textureLoader.load(n);return this.textureLoader.setPath(r),o}parseMaterials(e){const t=new Map;if("Material"in ci.Objects){const n=ci.Objects.Material;for(const r in n){const s=this.parseMaterial(n[r],e);s!==null&&t.set(parseInt(r),s)}}return t}parseMaterial(e,t){const n=e.id,r=e.attrName;let s=e.ShadingModel;if(typeof s=="object"&&(s=s.value),!ps.has(n))return null;const o=this.parseParameters(e,t,n);let a;switch(s.toLowerCase()){case"phong":a=new t2;break;case"lambert":a=new mx;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',s),a=new t2;break}return a.setValues(o),a.name=r,a}parseParameters(e,t,n){const r={};e.BumpFactor&&(r.bumpScale=e.BumpFactor.value),e.Diffuse?r.color=new ut().fromArray(e.Diffuse.value):e.DiffuseColor&&(e.DiffuseColor.type==="Color"||e.DiffuseColor.type==="ColorRGB")&&(r.color=new ut().fromArray(e.DiffuseColor.value)),e.DisplacementFactor&&(r.displacementScale=e.DisplacementFactor.value),e.Emissive?r.emissive=new ut().fromArray(e.Emissive.value):e.EmissiveColor&&(e.EmissiveColor.type==="Color"||e.EmissiveColor.type==="ColorRGB")&&(r.emissive=new ut().fromArray(e.EmissiveColor.value)),e.EmissiveFactor&&(r.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),e.Opacity&&(r.opacity=parseFloat(e.Opacity.value)),r.opacity<1&&(r.transparent=!0),e.ReflectionFactor&&(r.reflectivity=e.ReflectionFactor.value),e.Shininess&&(r.shininess=e.Shininess.value),e.Specular?r.specular=new ut().fromArray(e.Specular.value):e.SpecularColor&&e.SpecularColor.type==="Color"&&(r.specular=new ut().fromArray(e.SpecularColor.value));const s=this;return ps.get(n).children.forEach(function(o){const a=o.relationship;switch(a){case"Bump":r.bumpMap=s.getTexture(t,o.ID);break;case"Maya|TEX_ao_map":r.aoMap=s.getTexture(t,o.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":r.map=s.getTexture(t,o.ID),r.map!==void 0&&("colorSpace"in r.map?r.map.colorSpace="srgb":r.map.encoding=3001);break;case"DisplacementColor":r.displacementMap=s.getTexture(t,o.ID);break;case"EmissiveColor":r.emissiveMap=s.getTexture(t,o.ID),r.emissiveMap!==void 0&&("colorSpace"in r.emissiveMap?r.emissiveMap.colorSpace="srgb":r.emissiveMap.encoding=3001);break;case"NormalMap":case"Maya|TEX_normal_map":r.normalMap=s.getTexture(t,o.ID);break;case"ReflectionColor":r.envMap=s.getTexture(t,o.ID),r.envMap!==void 0&&(r.envMap.mapping=Xm,"colorSpace"in r.envMap?r.envMap.colorSpace="srgb":r.envMap.encoding=3001);break;case"SpecularColor":r.specularMap=s.getTexture(t,o.ID),r.specularMap!==void 0&&("colorSpace"in r.specularMap?r.specularMap.colorSpace="srgb":r.specularMap.encoding=3001);break;case"TransparentColor":case"TransparencyFactor":r.alphaMap=s.getTexture(t,o.ID),r.transparent=!0;break;case"AmbientColor":case"ShininessExponent":case"SpecularFactor":case"VectorDisplacementColor":default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",a);break}}),r}getTexture(e,t){return"LayeredTexture"in ci.Objects&&t in ci.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),t=ps.get(t).children[0].ID),e.get(t)}parseDeformers(){const e={},t={};if("Deformer"in ci.Objects){const n=ci.Objects.Deformer;for(const r in n){const s=n[r],o=ps.get(parseInt(r));if(s.attrType==="Skin"){const a=this.parseSkeleton(o,n);a.ID=r,o.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),a.geometryID=o.parents[0].ID,e[r]=a}else if(s.attrType==="BlendShape"){const a={id:r};a.rawTargets=this.parseMorphTargets(o,n),a.id=r,o.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),t[r]=a}}}return{skeletons:e,morphTargets:t}}parseSkeleton(e,t){const n=[];return e.children.forEach(function(r){const s=t[r.ID];if(s.attrType!=="Cluster")return;const o={ID:r.ID,indices:[],weights:[],transformLink:new Xe().fromArray(s.TransformLink.a)};"Indexes"in s&&(o.indices=s.Indexes.a,o.weights=s.Weights.a),n.push(o)}),{rawBones:n,bones:[]}}parseMorphTargets(e,t){const n=[];for(let r=0;r<e.children.length;r++){const s=e.children[r],o=t[s.ID],a={name:o.attrName,initialWeight:o.DeformPercent,id:o.id,fullWeights:o.FullWeights.a};if(o.attrType!=="BlendShapeChannel")return;a.geoID=ps.get(parseInt(s.ID)).children.filter(function(l){return l.relationship===void 0})[0].ID,n.push(a)}return n}parseScene(e,t,n){Ka=new xa;const r=this.parseModels(e.skeletons,t,n),s=ci.Objects.Model,o=this;r.forEach(function(l){const c=s[l.ID];o.setLookAtProperties(l,c),ps.get(l.ID).parents.forEach(function(h){const f=r.get(h.ID);f!==void 0&&f.add(l)}),l.parent===null&&Ka.add(l)}),this.bindSkeleton(e.skeletons,t,r),this.createAmbientLight(),Ka.traverse(function(l){if(l.userData.transformData){l.parent&&(l.userData.transformData.parentMatrix=l.parent.matrix,l.userData.transformData.parentMatrixWorld=l.parent.matrixWorld);const c=xH(l.userData.transformData);l.applyMatrix4(c),l.updateWorldMatrix()}});const a=new bue().parse();Ka.children.length===1&&Ka.children[0].isGroup&&(Ka.children[0].animations=a,Ka=Ka.children[0]),Ka.animations=a}parseModels(e,t,n){const r=new Map,s=ci.Objects.Model;for(const o in s){const a=parseInt(o),l=s[o],c=ps.get(a);let u=this.buildSkeleton(c,e,a,l.attrName);if(!u){switch(l.attrType){case"Camera":u=this.createCamera(c);break;case"Light":u=this.createLight(c);break;case"Mesh":u=this.createMesh(c,t,n);break;case"NurbsCurve":u=this.createCurve(c,t);break;case"LimbNode":case"Root":u=new sA;break;case"Null":default:u=new xa;break}u.name=l.attrName?li.sanitizeNodeName(l.attrName):"",u.ID=a}this.getTransformData(u,l),r.set(a,u)}return r}buildSkeleton(e,t,n,r){let s=null;return e.parents.forEach(function(o){for(const a in t){const l=t[a];l.rawBones.forEach(function(c,u){if(c.ID===o.ID){const h=s;s=new sA,s.matrixWorld.copy(c.transformLink),s.name=r?li.sanitizeNodeName(r):"",s.ID=n,l.bones[u]=s,h!==null&&s.add(h)}})}}),s}createCamera(e){let t,n;if(e.children.forEach(function(r){const s=ci.Objects.NodeAttribute[r.ID];s!==void 0&&(n=s)}),n===void 0)t=new _n;else{let r=0;n.CameraProjectionType!==void 0&&n.CameraProjectionType.value===1&&(r=1);let s=1;n.NearPlane!==void 0&&(s=n.NearPlane.value/1e3);let o=1e3;n.FarPlane!==void 0&&(o=n.FarPlane.value/1e3);let a=window.innerWidth,l=window.innerHeight;n.AspectWidth!==void 0&&n.AspectHeight!==void 0&&(a=n.AspectWidth.value,l=n.AspectHeight.value);const c=a/l;let u=45;n.FieldOfView!==void 0&&(u=n.FieldOfView.value);const h=n.FocalLength?n.FocalLength.value:null;switch(r){case 0:t=new jn(u,c,s,o),h!==null&&t.setFocalLength(h);break;case 1:t=new qi(-a/2,a/2,l/2,-l/2,s,o);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+r+"."),t=new _n;break}}return t}createLight(e){let t,n;if(e.children.forEach(function(r){const s=ci.Objects.NodeAttribute[r.ID];s!==void 0&&(n=s)}),n===void 0)t=new _n;else{let r;n.LightType===void 0?r=0:r=n.LightType.value;let s=16777215;n.Color!==void 0&&(s=new ut().fromArray(n.Color.value));let o=n.Intensity===void 0?1:n.Intensity.value/100;n.CastLightOnObject!==void 0&&n.CastLightOnObject.value===0&&(o=0);let a=0;n.FarAttenuationEnd!==void 0&&(n.EnableFarAttenuation!==void 0&&n.EnableFarAttenuation.value===0?a=0:a=n.FarAttenuationEnd.value);const l=1;switch(r){case 0:t=new F2(s,o,a,l);break;case 1:t=new $w(s,o);break;case 2:let c=Math.PI/3;n.InnerAngle!==void 0&&(c=un.degToRad(n.InnerAngle.value));let u=0;n.OuterAngle!==void 0&&(u=un.degToRad(n.OuterAngle.value),u=Math.max(u,1)),t=new Yw(s,o,a,c,u,l);break;default:console.warn("THREE.FBXLoader: Unknown light type "+n.LightType.value+", defaulting to a PointLight."),t=new F2(s,o);break}n.CastShadows!==void 0&&n.CastShadows.value===1&&(t.castShadow=!0)}return t}createMesh(e,t,n){let r,s=null,o=null;const a=[];return e.children.forEach(function(l){t.has(l.ID)&&(s=t.get(l.ID)),n.has(l.ID)&&a.push(n.get(l.ID))}),a.length>1?o=a:a.length>0?o=a[0]:(o=new t2({color:13421772}),a.push(o)),"color"in s.attributes&&a.forEach(function(l){l.vertexColors=!0}),s.FBX_Deformer?(r=new cx(s,o),r.normalizeSkinWeights()):r=new It(s,o),r}createCurve(e,t){const n=e.children.reduce(function(s,o){return t.has(o.ID)&&(s=t.get(o.ID)),s},null),r=new vs({color:3342591,linewidth:1});return new $n(n,r)}getTransformData(e,t){const n={};"InheritType"in t&&(n.inheritType=parseInt(t.InheritType.value)),"RotationOrder"in t?n.eulerOrder=EH(t.RotationOrder.value):n.eulerOrder="ZYX","Lcl_Translation"in t&&(n.translation=t.Lcl_Translation.value),"PreRotation"in t&&(n.preRotation=t.PreRotation.value),"Lcl_Rotation"in t&&(n.rotation=t.Lcl_Rotation.value),"PostRotation"in t&&(n.postRotation=t.PostRotation.value),"Lcl_Scaling"in t&&(n.scale=t.Lcl_Scaling.value),"ScalingOffset"in t&&(n.scalingOffset=t.ScalingOffset.value),"ScalingPivot"in t&&(n.scalingPivot=t.ScalingPivot.value),"RotationOffset"in t&&(n.rotationOffset=t.RotationOffset.value),"RotationPivot"in t&&(n.rotationPivot=t.RotationPivot.value),e.userData.transformData=n}setLookAtProperties(e,t){"LookAtProperty"in t&&ps.get(e.ID).children.forEach(function(r){if(r.relationship==="LookAtProperty"){const s=ci.Objects.Model[r.ID];if("Lcl_Translation"in s){const o=s.Lcl_Translation.value;e.target!==void 0?(e.target.position.fromArray(o),Ka.add(e.target)):e.lookAt(new Q().fromArray(o))}}})}bindSkeleton(e,t,n){const r=this.parsePoseNodes();for(const s in e){const o=e[s];ps.get(parseInt(o.ID)).parents.forEach(function(l){if(t.has(l.ID)){const c=l.ID;ps.get(c).parents.forEach(function(h){n.has(h.ID)&&n.get(h.ID).bind(new TA(o.bones),r[h.ID])})}})}}parsePoseNodes(){const e={};if("Pose"in ci.Objects){const t=ci.Objects.Pose;for(const n in t)if(t[n].attrType==="BindPose"&&t[n].NbPoseNodes>0){const r=t[n].PoseNode;Array.isArray(r)?r.forEach(function(s){e[s.Node]=new Xe().fromArray(s.Matrix.a)}):e[r.Node]=new Xe().fromArray(r.Matrix.a)}}return e}createAmbientLight(){if("GlobalSettings"in ci&&"AmbientColor"in ci.GlobalSettings){const e=ci.GlobalSettings.AmbientColor.value,t=e[0],n=e[1],r=e[2];if(t!==0||n!==0||r!==0){const s=new ut(t,n,r);Ka.add(new q6(s,1))}}}}class Tue{parse(e){const t=new Map;if("Geometry"in ci.Objects){const n=ci.Objects.Geometry;for(const r in n){const s=ps.get(parseInt(r)),o=this.parseGeometry(s,n[r],e);t.set(parseInt(r),o)}}return t}parseGeometry(e,t,n){switch(t.attrType){case"Mesh":return this.parseMeshGeometry(e,t,n);case"NurbsCurve":return this.parseNurbsGeometry(t)}}parseMeshGeometry(e,t,n){const r=n.skeletons,s=[],o=e.parents.map(function(h){return ci.Objects.Model[h.ID]});if(o.length===0)return;const a=e.children.reduce(function(h,f){return r[f.ID]!==void 0&&(h=r[f.ID]),h},null);e.children.forEach(function(h){n.morphTargets[h.ID]!==void 0&&s.push(n.morphTargets[h.ID])});const l=o[0],c={};"RotationOrder"in l&&(c.eulerOrder=EH(l.RotationOrder.value)),"InheritType"in l&&(c.inheritType=parseInt(l.InheritType.value)),"GeometricTranslation"in l&&(c.translation=l.GeometricTranslation.value),"GeometricRotation"in l&&(c.rotation=l.GeometricRotation.value),"GeometricScaling"in l&&(c.scale=l.GeometricScaling.value);const u=xH(c);return this.genGeometry(t,a,s,u)}genGeometry(e,t,n,r){const s=new fn;e.attrName&&(s.name=e.attrName);const o=this.parseGeoNode(e,t),a=this.genBuffers(o),l=new Gt(a.vertex,3);if(l.applyMatrix4(r),s.setAttribute("position",l),a.colors.length>0&&s.setAttribute("color",new Gt(a.colors,3)),t&&(s.setAttribute("skinIndex",new bw(a.weightsIndices,4)),s.setAttribute("skinWeight",new Gt(a.vertexWeights,4)),s.FBX_Deformer=t),a.normal.length>0){const c=new Tn().getNormalMatrix(r),u=new Gt(a.normal,3);u.applyNormalMatrix(c),s.setAttribute("normal",u)}if(a.uvs.forEach(function(c,u){MR==="uv2"&&u++;const h=u===0?"uv":`uv${u}`;s.setAttribute(h,new Gt(a.uvs[u],2))}),o.material&&o.material.mappingType!=="AllSame"){let c=a.materialIndex[0],u=0;if(a.materialIndex.forEach(function(h,f){h!==c&&(s.addGroup(u,f-u,c),c=h,u=f)}),s.groups.length>0){const h=s.groups[s.groups.length-1],f=h.start+h.count;f!==a.materialIndex.length&&s.addGroup(f,a.materialIndex.length-f,c)}s.groups.length===0&&s.addGroup(0,a.materialIndex.length,a.materialIndex[0])}return this.addMorphTargets(s,e,n,r),s}parseGeoNode(e,t){const n={};if(n.vertexPositions=e.Vertices!==void 0?e.Vertices.a:[],n.vertexIndices=e.PolygonVertexIndex!==void 0?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(n.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(n.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(n.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){n.uv=[];let r=0;for(;e.LayerElementUV[r];)e.LayerElementUV[r].UV&&n.uv.push(this.parseUVs(e.LayerElementUV[r])),r++}return n.weightTable={},t!==null&&(n.skeleton=t,t.rawBones.forEach(function(r,s){r.indices.forEach(function(o,a){n.weightTable[o]===void 0&&(n.weightTable[o]=[]),n.weightTable[o].push({id:s,weight:r.weights[a]})})})),n}genBuffers(e){const t={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]};let n=0,r=0,s=!1,o=[],a=[],l=[],c=[],u=[],h=[];const f=this;return e.vertexIndices.forEach(function(d,m){let y,g=!1;d<0&&(d=d^-1,g=!0);let A=[],E=[];if(o.push(d*3,d*3+1,d*3+2),e.color){const x=kE(m,n,d,e.color);l.push(x[0],x[1],x[2])}if(e.skeleton){if(e.weightTable[d]!==void 0&&e.weightTable[d].forEach(function(x){E.push(x.weight),A.push(x.id)}),E.length>4){s||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),s=!0);const x=[0,0,0,0],w=[0,0,0,0];E.forEach(function(T,I){let M=T,L=A[I];w.forEach(function(P,R,U){if(M>P){U[R]=M,M=P;const k=x[R];x[R]=L,L=k}})}),A=x,E=w}for(;E.length<4;)E.push(0),A.push(0);for(let x=0;x<4;++x)u.push(E[x]),h.push(A[x])}if(e.normal){const x=kE(m,n,d,e.normal);a.push(x[0],x[1],x[2])}e.material&&e.material.mappingType!=="AllSame"&&(y=kE(m,n,d,e.material)[0]),e.uv&&e.uv.forEach(function(x,w){const T=kE(m,n,d,x);c[w]===void 0&&(c[w]=[]),c[w].push(T[0]),c[w].push(T[1])}),r++,g&&(f.genFace(t,e,o,y,a,l,c,u,h,r),n++,r=0,o=[],a=[],l=[],c=[],u=[],h=[])}),t}genFace(e,t,n,r,s,o,a,l,c,u){for(let h=2;h<u;h++)e.vertex.push(t.vertexPositions[n[0]]),e.vertex.push(t.vertexPositions[n[1]]),e.vertex.push(t.vertexPositions[n[2]]),e.vertex.push(t.vertexPositions[n[(h-1)*3]]),e.vertex.push(t.vertexPositions[n[(h-1)*3+1]]),e.vertex.push(t.vertexPositions[n[(h-1)*3+2]]),e.vertex.push(t.vertexPositions[n[h*3]]),e.vertex.push(t.vertexPositions[n[h*3+1]]),e.vertex.push(t.vertexPositions[n[h*3+2]]),t.skeleton&&(e.vertexWeights.push(l[0]),e.vertexWeights.push(l[1]),e.vertexWeights.push(l[2]),e.vertexWeights.push(l[3]),e.vertexWeights.push(l[(h-1)*4]),e.vertexWeights.push(l[(h-1)*4+1]),e.vertexWeights.push(l[(h-1)*4+2]),e.vertexWeights.push(l[(h-1)*4+3]),e.vertexWeights.push(l[h*4]),e.vertexWeights.push(l[h*4+1]),e.vertexWeights.push(l[h*4+2]),e.vertexWeights.push(l[h*4+3]),e.weightsIndices.push(c[0]),e.weightsIndices.push(c[1]),e.weightsIndices.push(c[2]),e.weightsIndices.push(c[3]),e.weightsIndices.push(c[(h-1)*4]),e.weightsIndices.push(c[(h-1)*4+1]),e.weightsIndices.push(c[(h-1)*4+2]),e.weightsIndices.push(c[(h-1)*4+3]),e.weightsIndices.push(c[h*4]),e.weightsIndices.push(c[h*4+1]),e.weightsIndices.push(c[h*4+2]),e.weightsIndices.push(c[h*4+3])),t.color&&(e.colors.push(o[0]),e.colors.push(o[1]),e.colors.push(o[2]),e.colors.push(o[(h-1)*3]),e.colors.push(o[(h-1)*3+1]),e.colors.push(o[(h-1)*3+2]),e.colors.push(o[h*3]),e.colors.push(o[h*3+1]),e.colors.push(o[h*3+2])),t.material&&t.material.mappingType!=="AllSame"&&(e.materialIndex.push(r),e.materialIndex.push(r),e.materialIndex.push(r)),t.normal&&(e.normal.push(s[0]),e.normal.push(s[1]),e.normal.push(s[2]),e.normal.push(s[(h-1)*3]),e.normal.push(s[(h-1)*3+1]),e.normal.push(s[(h-1)*3+2]),e.normal.push(s[h*3]),e.normal.push(s[h*3+1]),e.normal.push(s[h*3+2])),t.uv&&t.uv.forEach(function(f,d){e.uvs[d]===void 0&&(e.uvs[d]=[]),e.uvs[d].push(a[d][0]),e.uvs[d].push(a[d][1]),e.uvs[d].push(a[d][(h-1)*2]),e.uvs[d].push(a[d][(h-1)*2+1]),e.uvs[d].push(a[d][h*2]),e.uvs[d].push(a[d][h*2+1])})}addMorphTargets(e,t,n,r){if(n.length===0)return;e.morphTargetsRelative=!0,e.morphAttributes.position=[];const s=this;n.forEach(function(o){o.rawTargets.forEach(function(a){const l=ci.Objects.Geometry[a.geoID];l!==void 0&&s.genMorphGeometry(e,t,l,r,a.name)})})}genMorphGeometry(e,t,n,r,s){const o=t.PolygonVertexIndex!==void 0?t.PolygonVertexIndex.a:[],a=n.Vertices!==void 0?n.Vertices.a:[],l=n.Indexes!==void 0?n.Indexes.a:[],c=e.attributes.position.count*3,u=new Float32Array(c);for(let m=0;m<l.length;m++){const y=l[m]*3;u[y]=a[m*3],u[y+1]=a[m*3+1],u[y+2]=a[m*3+2]}const h={vertexIndices:o,vertexPositions:u},f=this.genBuffers(h),d=new Gt(f.vertex,3);d.name=s||n.attrName,d.applyMatrix4(r),e.morphAttributes.position.push(d)}parseNormals(e){const t=e.MappingInformationType,n=e.ReferenceInformationType,r=e.Normals.a;let s=[];return n==="IndexToDirect"&&("NormalIndex"in e?s=e.NormalIndex.a:"NormalsIndex"in e&&(s=e.NormalsIndex.a)),{dataSize:3,buffer:r,indices:s,mappingType:t,referenceType:n}}parseUVs(e){const t=e.MappingInformationType,n=e.ReferenceInformationType,r=e.UV.a;let s=[];return n==="IndexToDirect"&&(s=e.UVIndex.a),{dataSize:2,buffer:r,indices:s,mappingType:t,referenceType:n}}parseVertexColors(e){const t=e.MappingInformationType,n=e.ReferenceInformationType,r=e.Colors.a;let s=[];return n==="IndexToDirect"&&(s=e.ColorIndex.a),{dataSize:4,buffer:r,indices:s,mappingType:t,referenceType:n}}parseMaterialIndices(e){const t=e.MappingInformationType,n=e.ReferenceInformationType;if(t==="NoMappingInformation")return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:n};const r=e.Materials.a,s=[];for(let o=0;o<r.length;++o)s.push(o);return{dataSize:1,buffer:r,indices:s,mappingType:t,referenceType:n}}parseNurbsGeometry(e){if(U9===void 0)return console.error("THREE.FBXLoader: The loader relies on NURBSCurve for any nurbs present in the model. Nurbs will show up as empty geometry."),new fn;const t=parseInt(e.Order);if(isNaN(t))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",e.Order,e.id),new fn;const n=t-1,r=e.KnotVector.a,s=[],o=e.Points.a;for(let h=0,f=o.length;h<f;h+=4)s.push(new Rn().fromArray(o,h));let a,l;if(e.Form==="Closed")s.push(s[0]);else if(e.Form==="Periodic"){a=n,l=r.length-1-a;for(let h=0;h<n;++h)s.push(s[h])}const u=new U9(n,r,s,a,l).getPoints(s.length*12);return new fn().setFromPoints(u)}}class bue{parse(){const e=[],t=this.parseClips();if(t!==void 0)for(const n in t){const r=t[n],s=this.addClip(r);e.push(s)}return e}parseClips(){if(ci.Objects.AnimationCurve===void 0)return;const e=this.parseAnimationCurveNodes();this.parseAnimationCurves(e);const t=this.parseAnimationLayers(e);return this.parseAnimStacks(t)}parseAnimationCurveNodes(){const e=ci.Objects.AnimationCurveNode,t=new Map;for(const n in e){const r=e[n];if(r.attrName.match(/S|R|T|DeformPercent/)!==null){const s={id:r.id,attr:r.attrName,curves:{}};t.set(s.id,s)}}return t}parseAnimationCurves(e){const t=ci.Objects.AnimationCurve;for(const n in t){const r={id:t[n].id,times:t[n].KeyTime.a.map(Lue),values:t[n].KeyValueFloat.a},s=ps.get(r.id);if(s!==void 0){const o=s.parents[0].ID,a=s.parents[0].relationship;a.match(/X/)?e.get(o).curves.x=r:a.match(/Y/)?e.get(o).curves.y=r:a.match(/Z/)?e.get(o).curves.z=r:a.match(/d|DeformPercent/)&&e.has(o)&&(e.get(o).curves.morph=r)}}}parseAnimationLayers(e){const t=ci.Objects.AnimationLayer,n=new Map;for(const r in t){const s=[],o=ps.get(parseInt(r));o!==void 0&&(o.children.forEach(function(l,c){if(e.has(l.ID)){const u=e.get(l.ID);if(u.curves.x!==void 0||u.curves.y!==void 0||u.curves.z!==void 0){if(s[c]===void 0){const h=ps.get(l.ID).parents.filter(function(f){return f.relationship!==void 0})[0].ID;if(h!==void 0){const f=ci.Objects.Model[h.toString()];if(f===void 0){console.warn("THREE.FBXLoader: Encountered a unused curve.",l);return}const d={modelName:f.attrName?li.sanitizeNodeName(f.attrName):"",ID:f.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};Ka.traverse(function(m){m.ID===f.id&&(d.transform=m.matrix,m.userData.transformData&&(d.eulerOrder=m.userData.transformData.eulerOrder))}),d.transform||(d.transform=new Xe),"PreRotation"in f&&(d.preRotation=f.PreRotation.value),"PostRotation"in f&&(d.postRotation=f.PostRotation.value),s[c]=d}}s[c]&&(s[c][u.attr]=u)}else if(u.curves.morph!==void 0){if(s[c]===void 0){const h=ps.get(l.ID).parents.filter(function(A){return A.relationship!==void 0})[0].ID,f=ps.get(h).parents[0].ID,d=ps.get(f).parents[0].ID,m=ps.get(d).parents[0].ID,y=ci.Objects.Model[m],g={modelName:y.attrName?li.sanitizeNodeName(y.attrName):"",morphName:ci.Objects.Deformer[h].attrName};s[c]=g}s[c][u.attr]=u}}}),n.set(parseInt(r),s))}return n}parseAnimStacks(e){const t=ci.Objects.AnimationStack,n={};for(const r in t){const s=ps.get(parseInt(r)).children;s.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");const o=e.get(s[0].ID);n[r]={name:t[r].attrName,layer:o}}return n}addClip(e){let t=[];const n=this;return e.layer.forEach(function(r){t=t.concat(n.generateTracks(r))}),new op(e.name,-1,t)}generateTracks(e){const t=[];let n=new Q,r=new Xt,s=new Q;if(e.transform&&e.transform.decompose(n,r,s),n=n.toArray(),r=new Eo().setFromQuaternion(r,e.eulerOrder).toArray(),s=s.toArray(),e.T!==void 0&&Object.keys(e.T.curves).length>0){const o=this.generateVectorTrack(e.modelName,e.T.curves,n,"position");o!==void 0&&t.push(o)}if(e.R!==void 0&&Object.keys(e.R.curves).length>0){const o=this.generateRotationTrack(e.modelName,e.R.curves,r,e.preRotation,e.postRotation,e.eulerOrder);o!==void 0&&t.push(o)}if(e.S!==void 0&&Object.keys(e.S.curves).length>0){const o=this.generateVectorTrack(e.modelName,e.S.curves,s,"scale");o!==void 0&&t.push(o)}if(e.DeformPercent!==void 0){const o=this.generateMorphTrack(e);o!==void 0&&t.push(o)}return t}generateVectorTrack(e,t,n,r){const s=this.getTimesForAllAxes(t),o=this.getKeyframeTrackValues(s,t,n);return new Of(e+"."+r,s,o)}generateRotationTrack(e,t,n,r,s,o){t.x!==void 0&&(this.interpolateRotations(t.x),t.x.values=t.x.values.map(un.degToRad)),t.y!==void 0&&(this.interpolateRotations(t.y),t.y.values=t.y.values.map(un.degToRad)),t.z!==void 0&&(this.interpolateRotations(t.z),t.z.values=t.z.values.map(un.degToRad));const a=this.getTimesForAllAxes(t),l=this.getKeyframeTrackValues(a,t,n);r!==void 0&&(r=r.map(un.degToRad),r.push(o),r=new Eo().fromArray(r),r=new Xt().setFromEuler(r)),s!==void 0&&(s=s.map(un.degToRad),s.push(o),s=new Eo().fromArray(s),s=new Xt().setFromEuler(s).invert());const c=new Xt,u=new Eo,h=[];for(let f=0;f<l.length;f+=3)u.set(l[f],l[f+1],l[f+2],o),c.setFromEuler(u),r!==void 0&&c.premultiply(r),s!==void 0&&c.multiply(s),c.toArray(h,f/3*4);return new vh(e+".quaternion",a,h)}generateMorphTrack(e){const t=e.DeformPercent.curves.morph,n=t.values.map(function(s){return s/100}),r=Ka.getObjectByName(e.modelName).morphTargetDictionary[e.morphName];return new sp(e.modelName+".morphTargetInfluences["+r+"]",t.times,n)}getTimesForAllAxes(e){let t=[];if(e.x!==void 0&&(t=t.concat(e.x.times)),e.y!==void 0&&(t=t.concat(e.y.times)),e.z!==void 0&&(t=t.concat(e.z.times)),t=t.sort(function(n,r){return n-r}),t.length>1){let n=1,r=t[0];for(let s=1;s<t.length;s++){const o=t[s];o!==r&&(t[n]=o,r=o,n++)}t=t.slice(0,n)}return t}getKeyframeTrackValues(e,t,n){const r=n,s=[];let o=-1,a=-1,l=-1;return e.forEach(function(c){if(t.x&&(o=t.x.times.indexOf(c)),t.y&&(a=t.y.times.indexOf(c)),t.z&&(l=t.z.times.indexOf(c)),o!==-1){const u=t.x.values[o];s.push(u),r[0]=u}else s.push(r[0]);if(a!==-1){const u=t.y.values[a];s.push(u),r[1]=u}else s.push(r[1]);if(l!==-1){const u=t.z.values[l];s.push(u),r[2]=u}else s.push(r[2])}),s}interpolateRotations(e){for(let t=1;t<e.values.length;t++){const n=e.values[t-1],r=e.values[t]-n,s=Math.abs(r);if(s>=180){const o=s/180,a=r/o;let l=n+a;const c=e.times[t-1],h=(e.times[t]-c)/o;let f=c+h;const d=[],m=[];for(;f<e.times[t];)d.push(f),f+=h,m.push(l),l+=a;e.times=H9(e.times,t,d),e.values=H9(e.values,t,m)}}}}class Iue{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(e){this.nodeStack.push(e),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(e,t){this.currentProp=e,this.currentPropName=t}parse(e){this.currentIndent=0,this.allNodes=new vH,this.nodeStack=[],this.currentProp=[],this.currentPropName="";const t=this,n=e.split(/[\r\n]+/);return n.forEach(function(r,s){const o=r.match(/^[\s\t]*;/),a=r.match(/^[\s\t]*$/);if(o||a)return;const l=r.match("^\\t{"+t.currentIndent+"}(\\w+):(.*){",""),c=r.match("^\\t{"+t.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),u=r.match("^\\t{"+(t.currentIndent-1)+"}}");l?t.parseNodeBegin(r,l):c?t.parseNodeProperty(r,c,n[++s]):u?t.popStack():r.match(/^[^\s\t}]/)&&t.parseNodePropertyContinued(r)}),this.allNodes}parseNodeBegin(e,t){const n=t[1].trim().replace(/^"/,"").replace(/"$/,""),r=t[2].split(",").map(function(l){return l.trim().replace(/^"/,"").replace(/"$/,"")}),s={name:n},o=this.parseNodeAttr(r),a=this.getCurrentNode();this.currentIndent===0?this.allNodes.add(n,s):n in a?(n==="PoseNode"?a.PoseNode.push(s):a[n].id!==void 0&&(a[n]={},a[n][a[n].id]=a[n]),o.id!==""&&(a[n][o.id]=s)):typeof o.id=="number"?(a[n]={},a[n][o.id]=s):n!=="Properties70"&&(n==="PoseNode"?a[n]=[s]:a[n]=s),typeof o.id=="number"&&(s.id=o.id),o.name!==""&&(s.attrName=o.name),o.type!==""&&(s.attrType=o.type),this.pushStack(s)}parseNodeAttr(e){let t=e[0];e[0]!==""&&(t=parseInt(e[0]),isNaN(t)&&(t=e[0]));let n="",r="";return e.length>1&&(n=e[1].replace(/^(\w+)::/,""),r=e[2]),{id:t,name:n,type:r}}parseNodeProperty(e,t,n){let r=t[1].replace(/^"/,"").replace(/"$/,"").trim(),s=t[2].replace(/^"/,"").replace(/"$/,"").trim();r==="Content"&&s===","&&(s=n.replace(/"/g,"").replace(/,$/,"").trim());const o=this.getCurrentNode();if(o.name==="Properties70"){this.parseNodeSpecialProperty(e,r,s);return}if(r==="C"){const l=s.split(",").slice(1),c=parseInt(l[0]),u=parseInt(l[1]);let h=s.split(",").slice(3);h=h.map(function(f){return f.trim().replace(/^"/,"")}),r="connections",s=[c,u],Due(s,h),o[r]===void 0&&(o[r]=[])}r==="Node"&&(o.id=s),r in o&&Array.isArray(o[r])?o[r].push(s):r!=="a"?o[r]=s:o.a=s,this.setCurrentProp(o,r),r==="a"&&s.slice(-1)!==","&&(o.a=nb(s))}parseNodePropertyContinued(e){const t=this.getCurrentNode();t.a+=e,e.slice(-1)!==","&&(t.a=nb(t.a))}parseNodeSpecialProperty(e,t,n){const r=n.split('",').map(function(u){return u.trim().replace(/^\"/,"").replace(/\s/,"_")}),s=r[0],o=r[1],a=r[2],l=r[3];let c=r[4];switch(o){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":c=parseFloat(c);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":c=nb(c);break}this.getPrevNode()[s]={type:o,type2:a,flag:l,value:c},this.setCurrentProp(this.getPrevNode(),s)}}class Mue{parse(e){const t=new z9(e);t.skip(23);const n=t.getUint32();if(n<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+n);const r=new vH;for(;!this.endOfContent(t);){const s=this.parseNode(t,n);s!==null&&r.add(s.name,s)}return r}endOfContent(e){return e.size()%16===0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()}parseNode(e,t){const n={},r=t>=7500?e.getUint64():e.getUint32(),s=t>=7500?e.getUint64():e.getUint32();t>=7500?e.getUint64():e.getUint32();const o=e.getUint8(),a=e.getString(o);if(r===0)return null;const l=[];for(let f=0;f<s;f++)l.push(this.parseProperty(e));const c=l.length>0?l[0]:"",u=l.length>1?l[1]:"",h=l.length>2?l[2]:"";for(n.singleProperty=s===1&&e.getOffset()===r;r>e.getOffset();){const f=this.parseNode(e,t);f!==null&&this.parseSubNode(a,n,f)}return n.propertyList=l,typeof c=="number"&&(n.id=c),u!==""&&(n.attrName=u),h!==""&&(n.attrType=h),a!==""&&(n.name=a),n}parseSubNode(e,t,n){if(n.singleProperty===!0){const r=n.propertyList[0];Array.isArray(r)?(t[n.name]=n,n.a=r):t[n.name]=r}else if(e==="Connections"&&n.name==="C"){const r=[];n.propertyList.forEach(function(s,o){o!==0&&r.push(s)}),t.connections===void 0&&(t.connections=[]),t.connections.push(r)}else if(n.name==="Properties70")Object.keys(n).forEach(function(s){t[s]=n[s]});else if(e==="Properties70"&&n.name==="P"){let r=n.propertyList[0],s=n.propertyList[1];const o=n.propertyList[2],a=n.propertyList[3];let l;r.indexOf("Lcl ")===0&&(r=r.replace("Lcl ","Lcl_")),s.indexOf("Lcl ")===0&&(s=s.replace("Lcl ","Lcl_")),s==="Color"||s==="ColorRGB"||s==="Vector"||s==="Vector3D"||s.indexOf("Lcl_")===0?l=[n.propertyList[4],n.propertyList[5],n.propertyList[6]]:l=n.propertyList[4],t[r]={type:s,type2:o,flag:a,value:l}}else t[n.name]===void 0?typeof n.id=="number"?(t[n.name]={},t[n.name][n.id]=n):t[n.name]=n:n.name==="PoseNode"?(Array.isArray(t[n.name])||(t[n.name]=[t[n.name]]),t[n.name].push(n)):t[n.name][n.id]===void 0&&(t[n.name][n.id]=n)}parseProperty(e){const t=e.getString(1);let n;switch(t){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":return n=e.getUint32(),e.getArrayBuffer(n);case"S":return n=e.getUint32(),e.getString(n);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":const r=e.getUint32(),s=e.getUint32(),o=e.getUint32();if(s===0)switch(t){case"b":case"c":return e.getBooleanArray(r);case"d":return e.getFloat64Array(r);case"f":return e.getFloat32Array(r);case"i":return e.getInt32Array(r);case"l":return e.getInt64Array(r)}const a=Uv(new Uint8Array(e.getArrayBuffer(o))),l=new z9(a.buffer);switch(t){case"b":case"c":return l.getBooleanArray(r);case"d":return l.getFloat64Array(r);case"f":return l.getFloat32Array(r);case"i":return l.getInt32Array(r);case"l":return l.getInt64Array(r)}default:throw new Error("THREE.FBXLoader: Unknown property type "+t)}}}class z9{constructor(e,t){this.dv=new DataView(e),this.offset=0,this.littleEndian=t!==void 0?t:!0}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(e){this.offset+=e}getBoolean(){return(this.getUint8()&1)===1}getBooleanArray(e){const t=[];for(let n=0;n<e;n++)t.push(this.getBoolean());return t}getUint8(){const e=this.dv.getUint8(this.offset);return this.offset+=1,e}getInt16(){const e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}getInt32(){const e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}getInt32Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getInt32());return t}getUint32(){const e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}getInt64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),t&2147483648?(t=~t&4294967295,e=~e&4294967295,e===4294967295&&(t=t+1&4294967295),e=e+1&4294967295,-(t*4294967296+e)):t*4294967296+e}getInt64Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getInt64());return t}getUint64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),t*4294967296+e}getFloat32(){const e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}getFloat32Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getFloat32());return t}getFloat64(){const e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}getFloat64Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getFloat64());return t}getArrayBuffer(e){const t=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t}getString(e){let t=[];for(let r=0;r<e;r++)t[r]=this.getUint8();const n=t.indexOf(0);return n>=0&&(t=t.slice(0,n)),cA(new Uint8Array(t))}}class vH{add(e,t){this[e]=t}}function Rue(i){const e="Kaydara FBX Binary  \0";return i.byteLength>=e.length&&e===_H(i,0,e.length)}function Pue(i){const e=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"];let t=0;function n(r){const s=i[r-1];return i=i.slice(t+r),t++,s}for(let r=0;r<e.length;++r)if(n(1)===e[r])return!1;return!0}function G9(i){const e=/FBXVersion: (\d+)/,t=i.match(e);if(t)return parseInt(t[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function Lue(i){return i/46186158e3}const Bue=[];function kE(i,e,t,n){let r;switch(n.mappingType){case"ByPolygonVertex":r=i;break;case"ByPolygon":r=e;break;case"ByVertice":r=t;break;case"AllSame":r=n.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+n.mappingType)}n.referenceType==="IndexToDirect"&&(r=n.indices[r]);const s=r*n.dataSize,o=s+n.dataSize;return kue(Bue,n.buffer,s,o)}const tb=new Eo,Gg=new Q;function xH(i){const e=new Xe,t=new Xe,n=new Xe,r=new Xe,s=new Xe,o=new Xe,a=new Xe,l=new Xe,c=new Xe,u=new Xe,h=new Xe,f=new Xe,d=i.inheritType?i.inheritType:0;if(i.translation&&e.setPosition(Gg.fromArray(i.translation)),i.preRotation){const R=i.preRotation.map(un.degToRad);R.push(i.eulerOrder),t.makeRotationFromEuler(tb.fromArray(R))}if(i.rotation){const R=i.rotation.map(un.degToRad);R.push(i.eulerOrder),n.makeRotationFromEuler(tb.fromArray(R))}if(i.postRotation){const R=i.postRotation.map(un.degToRad);R.push(i.eulerOrder),r.makeRotationFromEuler(tb.fromArray(R)),r.invert()}i.scale&&s.scale(Gg.fromArray(i.scale)),i.scalingOffset&&a.setPosition(Gg.fromArray(i.scalingOffset)),i.scalingPivot&&o.setPosition(Gg.fromArray(i.scalingPivot)),i.rotationOffset&&l.setPosition(Gg.fromArray(i.rotationOffset)),i.rotationPivot&&c.setPosition(Gg.fromArray(i.rotationPivot)),i.parentMatrixWorld&&(h.copy(i.parentMatrix),u.copy(i.parentMatrixWorld));const m=t.clone().multiply(n).multiply(r),y=new Xe;y.extractRotation(u);const g=new Xe;g.copyPosition(u);const A=g.clone().invert().multiply(u),E=y.clone().invert().multiply(A),x=s,w=new Xe;if(d===0)w.copy(y).multiply(m).multiply(E).multiply(x);else if(d===1)w.copy(y).multiply(E).multiply(m).multiply(x);else{const U=new Xe().scale(new Q().setFromMatrixScale(h)).clone().invert(),k=E.clone().multiply(U);w.copy(y).multiply(m).multiply(k).multiply(x)}const T=c.clone().invert(),I=o.clone().invert();let M=e.clone().multiply(l).multiply(c).multiply(t).multiply(n).multiply(r).multiply(T).multiply(a).multiply(o).multiply(s).multiply(I);const L=new Xe().copyPosition(M),P=u.clone().multiply(L);return f.copyPosition(P),M=f.clone().multiply(w),M.premultiply(u.invert()),M}function EH(i){i=i||0;const e=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return i===6?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),e[0]):e[i]}function nb(i){return i.split(",").map(function(t){return parseFloat(t)})}function _H(i,e,t){return e===void 0&&(e=0),t===void 0&&(t=i.byteLength),cA(new Uint8Array(i,e,t))}function Due(i,e){for(let t=0,n=i.length,r=e.length;t<r;t++,n++)i[n]=e[t]}function kue(i,e,t,n){for(let r=t,s=0;r<n;r++,s++)i[s]=e[r];return i}function H9(i,e,t){return i.slice(0,e).concat(t).concat(i.slice(e))}var Fue=Object.defineProperty,Oue=(i,e,t)=>e in i?Fue(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,ib=(i,e,t)=>(Oue(i,typeof e!="symbol"?e+"":e,t),t);class Nue extends os{constructor(e){super(e)}load(e,t,n,r){const s=new Yr(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,o=>{if(typeof o!="string")throw new Error("unsupported data type");const a=JSON.parse(o),l=this.parse(a);t&&t(l)},n,r)}loadAsync(e,t){return super.loadAsync(e,t)}parse(e){return new Uue(e)}}class Uue{constructor(e){ib(this,"data"),ib(this,"isFont",!0),ib(this,"type","Font"),this.data=e}generateShapes(e,t=100,n){const r=[],s={letterSpacing:0,lineHeight:1,...n},o=zue(e,t,this.data,s);for(let a=0,l=o.length;a<l;a++)Array.prototype.push.apply(r,o[a].toShapes(!1));return r}}function zue(i,e,t,n){const r=Array.from(i),s=e/t.resolution,o=(t.boundingBox.yMax-t.boundingBox.yMin+t.underlineThickness)*s,a=[];let l=0,c=0;for(let u=0;u<r.length;u++){const h=r[u];if(h===`
`)l=0,c-=o*n.lineHeight;else{const f=Gue(h,s,l,c,t);f&&(l+=f.offsetX+n.letterSpacing,a.push(f.path))}}return a}function Gue(i,e,t,n,r){const s=r.glyphs[i]||r.glyphs["?"];if(!s){console.error('THREE.Font: character "'+i+'" does not exists in font family '+r.familyName+".");return}const o=new yf;let a,l,c,u,h,f,d,m;if(s.o){const y=s._cachedOutline||(s._cachedOutline=s.o.split(" "));for(let g=0,A=y.length;g<A;)switch(y[g++]){case"m":a=parseInt(y[g++])*e+t,l=parseInt(y[g++])*e+n,o.moveTo(a,l);break;case"l":a=parseInt(y[g++])*e+t,l=parseInt(y[g++])*e+n,o.lineTo(a,l);break;case"q":c=parseInt(y[g++])*e+t,u=parseInt(y[g++])*e+n,h=parseInt(y[g++])*e+t,f=parseInt(y[g++])*e+n,o.quadraticCurveTo(h,f,c,u);break;case"b":c=parseInt(y[g++])*e+t,u=parseInt(y[g++])*e+n,h=parseInt(y[g++])*e+t,f=parseInt(y[g++])*e+n,d=parseInt(y[g++])*e+t,m=parseInt(y[g++])*e+n,o.bezierCurveTo(h,f,d,m,c,u);break}}return{offsetX:s.ha*e,path:o}}class Hue extends vi{constructor(e=null,t=1,n=1,r=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:n,depth:r},this.magFilter=zn,this.minFilter=zn,this.wrapR=Wi,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Que{constructor(e=4){this.pool=e,this.queue=[],this.workers=[],this.workersResolve=[],this.workerStatus=0}_initWorker(e){if(!this.workers[e]){const t=this.workerCreator();t.addEventListener("message",this._onMessage.bind(this,e)),this.workers[e]=t}}_getIdleWorker(){for(let e=0;e<this.pool;e++)if(!(this.workerStatus&1<<e))return e;return-1}_onMessage(e,t){const n=this.workersResolve[e];if(n&&n(t),this.queue.length){const{resolve:r,msg:s,transfer:o}=this.queue.shift();this.workersResolve[e]=r,this.workers[e].postMessage(s,o)}else this.workerStatus^=1<<e}setWorkerCreator(e){this.workerCreator=e}setWorkerLimit(e){this.pool=e}postMessage(e,t){return new Promise(n=>{const r=this._getIdleWorker();r!==-1?(this._initWorker(r),this.workerStatus|=1<<r,this.workersResolve[r]=n,this.workers[r].postMessage(e,t)):this.queue.push({resolve:n,msg:e,transfer:t})})}dispose(){this.workers.forEach(e=>e.terminate()),this.workersResolve.length=0,this.workers.length=0,this.queue.length=0,this.workerStatus=0}}const SH=0,Q9=2,Vue=0,jue=0,Wue=2,Kue=0,Yue=0,$ue=1,c5=2,Xue=0,wH=1,que=10,Jue=64,CH=0,TH=9,bH=15,IH=16,MH=22,RH=37,PH=43,LH=76,BH=83,DH=97,kH=100,FH=103,OH=109,NH=165,UH=166;class Zue{constructor(){this.vkFormat=CH,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=SH,this.levels=[],this.dataFormatDescriptor=[{vendorId:jue,descriptorType:Vue,descriptorBlockSize:0,versionNumber:Wue,colorModel:Kue,colorPrimaries:wH,transferFunction:c5,flags:Yue,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],this.keyValue={},this.globalData=null}}class cv{constructor(e,t,n,r){this._dataView=void 0,this._littleEndian=void 0,this._offset=void 0,this._dataView=new DataView(e.buffer,e.byteOffset+t,n),this._littleEndian=r,this._offset=0}_nextUint8(){const e=this._dataView.getUint8(this._offset);return this._offset+=1,e}_nextUint16(){const e=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,e}_nextUint32(){const e=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint64(){const e=this._dataView.getUint32(this._offset,this._littleEndian),t=this._dataView.getUint32(this._offset+4,this._littleEndian),n=e+2**32*t;return this._offset+=8,n}_nextInt32(){const e=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint8Array(e){const t=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._offset,e);return this._offset+=e,t}_skip(e){return this._offset+=e,this}_scan(e,t){t===void 0&&(t=0);const n=this._offset;let r=0;for(;this._dataView.getUint8(this._offset)!==t&&r<e;)r++,this._offset++;return r<e&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+n,r)}}const ma=[171,75,84,88,32,50,48,187,13,10,26,10];function V9(i){return typeof TextDecoder<"u"?new TextDecoder().decode(i):Buffer.from(i).toString("utf8")}function ehe(i){const e=new Uint8Array(i.buffer,i.byteOffset,ma.length);if(e[0]!==ma[0]||e[1]!==ma[1]||e[2]!==ma[2]||e[3]!==ma[3]||e[4]!==ma[4]||e[5]!==ma[5]||e[6]!==ma[6]||e[7]!==ma[7]||e[8]!==ma[8]||e[9]!==ma[9]||e[10]!==ma[10]||e[11]!==ma[11])throw new Error("Missing KTX 2.0 identifier.");const t=new Zue,n=17*Uint32Array.BYTES_PER_ELEMENT,r=new cv(i,ma.length,n,!0);t.vkFormat=r._nextUint32(),t.typeSize=r._nextUint32(),t.pixelWidth=r._nextUint32(),t.pixelHeight=r._nextUint32(),t.pixelDepth=r._nextUint32(),t.layerCount=r._nextUint32(),t.faceCount=r._nextUint32();const s=r._nextUint32();t.supercompressionScheme=r._nextUint32();const o=r._nextUint32(),a=r._nextUint32(),l=r._nextUint32(),c=r._nextUint32(),u=r._nextUint64(),h=r._nextUint64(),f=s*3*8,d=new cv(i,ma.length+n,f,!0);for(let W=0;W<s;W++)t.levels.push({levelData:new Uint8Array(i.buffer,i.byteOffset+d._nextUint64(),d._nextUint64()),uncompressedByteLength:d._nextUint64()});const m=new cv(i,o,a,!0),y={vendorId:m._skip(4)._nextUint16(),descriptorType:m._nextUint16(),versionNumber:m._nextUint16(),descriptorBlockSize:m._nextUint16(),colorModel:m._nextUint8(),colorPrimaries:m._nextUint8(),transferFunction:m._nextUint8(),flags:m._nextUint8(),texelBlockDimension:[m._nextUint8(),m._nextUint8(),m._nextUint8(),m._nextUint8()],bytesPlane:[m._nextUint8(),m._nextUint8(),m._nextUint8(),m._nextUint8(),m._nextUint8(),m._nextUint8(),m._nextUint8(),m._nextUint8()],samples:[]},E=(y.descriptorBlockSize/4-6)/4;for(let W=0;W<E;W++){const F={bitOffset:m._nextUint16(),bitLength:m._nextUint8(),channelType:m._nextUint8(),samplePosition:[m._nextUint8(),m._nextUint8(),m._nextUint8(),m._nextUint8()],sampleLower:-1/0,sampleUpper:1/0};F.channelType&Jue?(F.sampleLower=m._nextInt32(),F.sampleUpper=m._nextInt32()):(F.sampleLower=m._nextUint32(),F.sampleUpper=m._nextUint32()),y.samples[W]=F}t.dataFormatDescriptor.length=0,t.dataFormatDescriptor.push(y);const x=new cv(i,l,c,!0);for(;x._offset<c;){const W=x._nextUint32(),F=x._scan(W),Y=V9(F);if(t.keyValue[Y]=x._nextUint8Array(W-F.byteLength-1),Y.match(/^ktx/i)){const q=V9(t.keyValue[Y]);t.keyValue[Y]=q.substring(0,q.lastIndexOf("\0"))}const te=W%4?4-W%4:0;x._skip(te)}if(h<=0)return t;const w=new cv(i,u,h,!0),T=w._nextUint16(),I=w._nextUint16(),M=w._nextUint32(),L=w._nextUint32(),P=w._nextUint32(),R=w._nextUint32(),U=[];for(let W=0;W<s;W++)U.push({imageFlags:w._nextUint32(),rgbSliceByteOffset:w._nextUint32(),rgbSliceByteLength:w._nextUint32(),alphaSliceByteOffset:w._nextUint32(),alphaSliceByteLength:w._nextUint32()});const k=u+w._offset,H=k+M,G=H+L,X=G+P,Z=new Uint8Array(i.buffer,i.byteOffset+k,M),oe=new Uint8Array(i.buffer,i.byteOffset+H,L),K=new Uint8Array(i.buffer,i.byteOffset+G,P),V=new Uint8Array(i.buffer,i.byteOffset+X,R);return t.globalData={endpointCount:T,selectorCount:I,imageDescs:U,endpointsData:Z,selectorsData:oe,tablesData:K,extendedData:V},t}let uv,gf,u5;const rb={env:{emscripten_notify_memory_growth:function(i){u5=new Uint8Array(gf.exports.memory.buffer)}}};class the{init(){return uv||(typeof fetch<"u"?uv=fetch("data:application/wasm;base64,"+j9).then(e=>e.arrayBuffer()).then(e=>WebAssembly.instantiate(e,rb)).then(this._init):uv=WebAssembly.instantiate(Buffer.from(j9,"base64"),rb).then(this._init),uv)}_init(e){gf=e.instance,rb.env.emscripten_notify_memory_growth(0)}decode(e,t=0){if(!gf)throw new Error("ZSTDDecoder: Await .init() before decoding.");const n=e.byteLength,r=gf.exports.malloc(n);u5.set(e,r),t=t||Number(gf.exports.ZSTD_findDecompressedSize(r,n));const s=gf.exports.malloc(t),o=gf.exports.ZSTD_decompress(s,t,r,n),a=u5.slice(s,s+o);return gf.exports.free(r),gf.exports.free(s),a}}const j9="AGFzbQEAAAABpQEVYAF/AX9gAn9/AGADf39/AX9gBX9/f39/AX9gAX8AYAJ/fwF/YAR/f39/AX9gA39/fwBgBn9/f39/fwF/YAd/f39/f39/AX9gAn9/AX5gAn5+AX5gAABgBX9/f39/AGAGf39/f39/AGAIf39/f39/f38AYAl/f39/f39/f38AYAABf2AIf39/f39/f38Bf2ANf39/f39/f39/f39/fwF/YAF/AX4CJwEDZW52H2Vtc2NyaXB0ZW5fbm90aWZ5X21lbW9yeV9ncm93dGgABANpaAEFAAAFAgEFCwACAQABAgIFBQcAAwABDgsBAQcAEhMHAAUBDAQEAAANBwQCAgYCBAgDAwMDBgEACQkHBgICAAYGAgQUBwYGAwIGAAMCAQgBBwUGCgoEEQAEBAEIAwgDBQgDEA8IAAcABAUBcAECAgUEAQCAAgYJAX8BQaCgwAILB2AHBm1lbW9yeQIABm1hbGxvYwAoBGZyZWUAJgxaU1REX2lzRXJyb3IAaBlaU1REX2ZpbmREZWNvbXByZXNzZWRTaXplAFQPWlNURF9kZWNvbXByZXNzAEoGX3N0YXJ0ACQJBwEAQQELASQKussBaA8AIAAgACgCBCABajYCBAsZACAAKAIAIAAoAgRBH3F0QQAgAWtBH3F2CwgAIABBiH9LC34BBH9BAyEBIAAoAgQiA0EgTQRAIAAoAggiASAAKAIQTwRAIAAQDQ8LIAAoAgwiAiABRgRAQQFBAiADQSBJGw8LIAAgASABIAJrIANBA3YiBCABIARrIAJJIgEbIgJrIgQ2AgggACADIAJBA3RrNgIEIAAgBCgAADYCAAsgAQsUAQF/IAAgARACIQIgACABEAEgAgv3AQECfyACRQRAIABCADcCACAAQQA2AhAgAEIANwIIQbh/DwsgACABNgIMIAAgAUEEajYCECACQQRPBEAgACABIAJqIgFBfGoiAzYCCCAAIAMoAAA2AgAgAUF/ai0AACIBBEAgAEEIIAEQFGs2AgQgAg8LIABBADYCBEF/DwsgACABNgIIIAAgAS0AACIDNgIAIAJBfmoiBEEBTQRAIARBAWtFBEAgACABLQACQRB0IANyIgM2AgALIAAgAS0AAUEIdCADajYCAAsgASACakF/ai0AACIBRQRAIABBADYCBEFsDwsgAEEoIAEQFCACQQN0ams2AgQgAgsWACAAIAEpAAA3AAAgACABKQAINwAICy8BAX8gAUECdEGgHWooAgAgACgCAEEgIAEgACgCBGprQR9xdnEhAiAAIAEQASACCyEAIAFCz9bTvtLHq9lCfiAAfEIfiUKHla+vmLbem55/fgsdAQF/IAAoAgggACgCDEYEfyAAKAIEQSBGBUEACwuCBAEDfyACQYDAAE8EQCAAIAEgAhBnIAAPCyAAIAJqIQMCQCAAIAFzQQNxRQRAAkAgAkEBSARAIAAhAgwBCyAAQQNxRQRAIAAhAgwBCyAAIQIDQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADTw0BIAJBA3ENAAsLAkAgA0F8cSIEQcAASQ0AIAIgBEFAaiIFSw0AA0AgAiABKAIANgIAIAIgASgCBDYCBCACIAEoAgg2AgggAiABKAIMNgIMIAIgASgCEDYCECACIAEoAhQ2AhQgAiABKAIYNgIYIAIgASgCHDYCHCACIAEoAiA2AiAgAiABKAIkNgIkIAIgASgCKDYCKCACIAEoAiw2AiwgAiABKAIwNgIwIAIgASgCNDYCNCACIAEoAjg2AjggAiABKAI8NgI8IAFBQGshASACQUBrIgIgBU0NAAsLIAIgBE8NAQNAIAIgASgCADYCACABQQRqIQEgAkEEaiICIARJDQALDAELIANBBEkEQCAAIQIMAQsgA0F8aiIEIABJBEAgACECDAELIAAhAgNAIAIgAS0AADoAACACIAEtAAE6AAEgAiABLQACOgACIAIgAS0AAzoAAyABQQRqIQEgAkEEaiICIARNDQALCyACIANJBEADQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADRw0ACwsgAAsMACAAIAEpAAA3AAALQQECfyAAKAIIIgEgACgCEEkEQEEDDwsgACAAKAIEIgJBB3E2AgQgACABIAJBA3ZrIgE2AgggACABKAAANgIAQQALDAAgACABKAIANgAAC/cCAQJ/AkAgACABRg0AAkAgASACaiAASwRAIAAgAmoiBCABSw0BCyAAIAEgAhALDwsgACABc0EDcSEDAkACQCAAIAFJBEAgAwRAIAAhAwwDCyAAQQNxRQRAIAAhAwwCCyAAIQMDQCACRQ0EIAMgAS0AADoAACABQQFqIQEgAkF/aiECIANBAWoiA0EDcQ0ACwwBCwJAIAMNACAEQQNxBEADQCACRQ0FIAAgAkF/aiICaiIDIAEgAmotAAA6AAAgA0EDcQ0ACwsgAkEDTQ0AA0AgACACQXxqIgJqIAEgAmooAgA2AgAgAkEDSw0ACwsgAkUNAgNAIAAgAkF/aiICaiABIAJqLQAAOgAAIAINAAsMAgsgAkEDTQ0AIAIhBANAIAMgASgCADYCACABQQRqIQEgA0EEaiEDIARBfGoiBEEDSw0ACyACQQNxIQILIAJFDQADQCADIAEtAAA6AAAgA0EBaiEDIAFBAWohASACQX9qIgINAAsLIAAL8wICAn8BfgJAIAJFDQAgACACaiIDQX9qIAE6AAAgACABOgAAIAJBA0kNACADQX5qIAE6AAAgACABOgABIANBfWogAToAACAAIAE6AAIgAkEHSQ0AIANBfGogAToAACAAIAE6AAMgAkEJSQ0AIABBACAAa0EDcSIEaiIDIAFB/wFxQYGChAhsIgE2AgAgAyACIARrQXxxIgRqIgJBfGogATYCACAEQQlJDQAgAyABNgIIIAMgATYCBCACQXhqIAE2AgAgAkF0aiABNgIAIARBGUkNACADIAE2AhggAyABNgIUIAMgATYCECADIAE2AgwgAkFwaiABNgIAIAJBbGogATYCACACQWhqIAE2AgAgAkFkaiABNgIAIAQgA0EEcUEYciIEayICQSBJDQAgAa0iBUIghiAFhCEFIAMgBGohAQNAIAEgBTcDGCABIAU3AxAgASAFNwMIIAEgBTcDACABQSBqIQEgAkFgaiICQR9LDQALCyAACy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAIajYCACADCy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAFajYCACADCx8AIAAgASACKAIEEAg2AgAgARAEGiAAIAJBCGo2AgQLCAAgAGdBH3MLugUBDX8jAEEQayIKJAACfyAEQQNNBEAgCkEANgIMIApBDGogAyAEEAsaIAAgASACIApBDGpBBBAVIgBBbCAAEAMbIAAgACAESxsMAQsgAEEAIAEoAgBBAXRBAmoQECENQVQgAygAACIGQQ9xIgBBCksNABogAiAAQQVqNgIAIAMgBGoiAkF8aiEMIAJBeWohDiACQXtqIRAgAEEGaiELQQQhBSAGQQR2IQRBICAAdCIAQQFyIQkgASgCACEPQQAhAiADIQYCQANAIAlBAkggAiAPS3JFBEAgAiEHAkAgCARAA0AgBEH//wNxQf//A0YEQCAHQRhqIQcgBiAQSQR/IAZBAmoiBigAACAFdgUgBUEQaiEFIARBEHYLIQQMAQsLA0AgBEEDcSIIQQNGBEAgBUECaiEFIARBAnYhBCAHQQNqIQcMAQsLIAcgCGoiByAPSw0EIAVBAmohBQNAIAIgB0kEQCANIAJBAXRqQQA7AQAgAkEBaiECDAELCyAGIA5LQQAgBiAFQQN1aiIHIAxLG0UEQCAHKAAAIAVBB3EiBXYhBAwCCyAEQQJ2IQQLIAYhBwsCfyALQX9qIAQgAEF/anEiBiAAQQF0QX9qIgggCWsiEUkNABogBCAIcSIEQQAgESAEIABIG2shBiALCyEIIA0gAkEBdGogBkF/aiIEOwEAIAlBASAGayAEIAZBAUgbayEJA0AgCSAASARAIABBAXUhACALQX9qIQsMAQsLAn8gByAOS0EAIAcgBSAIaiIFQQN1aiIGIAxLG0UEQCAFQQdxDAELIAUgDCIGIAdrQQN0awshBSACQQFqIQIgBEUhCCAGKAAAIAVBH3F2IQQMAQsLQWwgCUEBRyAFQSBKcg0BGiABIAJBf2o2AgAgBiAFQQdqQQN1aiADawwBC0FQCyEAIApBEGokACAACwkAQQFBBSAAGwsMACAAIAEoAAA2AAALqgMBCn8jAEHwAGsiCiQAIAJBAWohDiAAQQhqIQtBgIAEIAVBf2p0QRB1IQxBACECQQEhBkEBIAV0IglBf2oiDyEIA0AgAiAORkUEQAJAIAEgAkEBdCINai8BACIHQf//A0YEQCALIAhBA3RqIAI2AgQgCEF/aiEIQQEhBwwBCyAGQQAgDCAHQRB0QRB1ShshBgsgCiANaiAHOwEAIAJBAWohAgwBCwsgACAFNgIEIAAgBjYCACAJQQN2IAlBAXZqQQNqIQxBACEAQQAhBkEAIQIDQCAGIA5GBEADQAJAIAAgCUYNACAKIAsgAEEDdGoiASgCBCIGQQF0aiICIAIvAQAiAkEBajsBACABIAUgAhAUayIIOgADIAEgAiAIQf8BcXQgCWs7AQAgASAEIAZBAnQiAmooAgA6AAIgASACIANqKAIANgIEIABBAWohAAwBCwsFIAEgBkEBdGouAQAhDUEAIQcDQCAHIA1ORQRAIAsgAkEDdGogBjYCBANAIAIgDGogD3EiAiAISw0ACyAHQQFqIQcMAQsLIAZBAWohBgwBCwsgCkHwAGokAAsjAEIAIAEQCSAAhUKHla+vmLbem55/fkLj3MqV/M7y9YV/fAsQACAAQn43AwggACABNgIACyQBAX8gAARAIAEoAgQiAgRAIAEoAgggACACEQEADwsgABAmCwsfACAAIAEgAi8BABAINgIAIAEQBBogACACQQRqNgIEC0oBAX9BoCAoAgAiASAAaiIAQX9MBEBBiCBBMDYCAEF/DwsCQCAAPwBBEHRNDQAgABBmDQBBiCBBMDYCAEF/DwtBoCAgADYCACABC9cBAQh/Qbp/IQoCQCACKAIEIgggAigCACIJaiIOIAEgAGtLDQBBbCEKIAkgBCADKAIAIgtrSw0AIAAgCWoiBCACKAIIIgxrIQ0gACABQWBqIg8gCyAJQQAQKSADIAkgC2o2AgACQAJAIAwgBCAFa00EQCANIQUMAQsgDCAEIAZrSw0CIAcgDSAFayIAaiIBIAhqIAdNBEAgBCABIAgQDxoMAgsgBCABQQAgAGsQDyEBIAIgACAIaiIINgIEIAEgAGshBAsgBCAPIAUgCEEBECkLIA4hCgsgCgubAgEBfyMAQYABayINJAAgDSADNgJ8AkAgAkEDSwRAQX8hCQwBCwJAAkACQAJAIAJBAWsOAwADAgELIAZFBEBBuH8hCQwEC0FsIQkgBS0AACICIANLDQMgACAHIAJBAnQiAmooAgAgAiAIaigCABA7IAEgADYCAEEBIQkMAwsgASAJNgIAQQAhCQwCCyAKRQRAQWwhCQwCC0EAIQkgC0UgDEEZSHINAUEIIAR0QQhqIQBBACECA0AgAiAATw0CIAJBQGshAgwAAAsAC0FsIQkgDSANQfwAaiANQfgAaiAFIAYQFSICEAMNACANKAJ4IgMgBEsNACAAIA0gDSgCfCAHIAggAxAYIAEgADYCACACIQkLIA1BgAFqJAAgCQsLACAAIAEgAhALGgsQACAALwAAIAAtAAJBEHRyCy8AAn9BuH8gAUEISQ0AGkFyIAAoAAQiAEF3Sw0AGkG4fyAAQQhqIgAgACABSxsLCwkAIAAgATsAAAsDAAELigYBBX8gACAAKAIAIgVBfnE2AgBBACAAIAVBAXZqQYQgKAIAIgQgAEYbIQECQAJAIAAoAgQiAkUNACACKAIAIgNBAXENACACQQhqIgUgA0EBdkF4aiIDQQggA0EISxtnQR9zQQJ0QYAfaiIDKAIARgRAIAMgAigCDDYCAAsgAigCCCIDBEAgAyACKAIMNgIECyACKAIMIgMEQCADIAIoAgg2AgALIAIgAigCACAAKAIAQX5xajYCAEGEICEAAkACQCABRQ0AIAEgAjYCBCABKAIAIgNBAXENASADQQF2QXhqIgNBCCADQQhLG2dBH3NBAnRBgB9qIgMoAgAgAUEIakYEQCADIAEoAgw2AgALIAEoAggiAwRAIAMgASgCDDYCBAsgASgCDCIDBEAgAyABKAIINgIAQYQgKAIAIQQLIAIgAigCACABKAIAQX5xajYCACABIARGDQAgASABKAIAQQF2akEEaiEACyAAIAI2AgALIAIoAgBBAXZBeGoiAEEIIABBCEsbZ0Efc0ECdEGAH2oiASgCACEAIAEgBTYCACACIAA2AgwgAkEANgIIIABFDQEgACAFNgIADwsCQCABRQ0AIAEoAgAiAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAigCACABQQhqRgRAIAIgASgCDDYCAAsgASgCCCICBEAgAiABKAIMNgIECyABKAIMIgIEQCACIAEoAgg2AgBBhCAoAgAhBAsgACAAKAIAIAEoAgBBfnFqIgI2AgACQCABIARHBEAgASABKAIAQQF2aiAANgIEIAAoAgAhAgwBC0GEICAANgIACyACQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgIoAgAhASACIABBCGoiAjYCACAAIAE2AgwgAEEANgIIIAFFDQEgASACNgIADwsgBUEBdkF4aiIBQQggAUEISxtnQR9zQQJ0QYAfaiICKAIAIQEgAiAAQQhqIgI2AgAgACABNgIMIABBADYCCCABRQ0AIAEgAjYCAAsLDgAgAARAIABBeGoQJQsLgAIBA38CQCAAQQ9qQXhxQYQgKAIAKAIAQQF2ayICEB1Bf0YNAAJAQYQgKAIAIgAoAgAiAUEBcQ0AIAFBAXZBeGoiAUEIIAFBCEsbZ0Efc0ECdEGAH2oiASgCACAAQQhqRgRAIAEgACgCDDYCAAsgACgCCCIBBEAgASAAKAIMNgIECyAAKAIMIgFFDQAgASAAKAIINgIAC0EBIQEgACAAKAIAIAJBAXRqIgI2AgAgAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAygCACECIAMgAEEIaiIDNgIAIAAgAjYCDCAAQQA2AgggAkUNACACIAM2AgALIAELtwIBA38CQAJAIABBASAAGyICEDgiAA0AAkACQEGEICgCACIARQ0AIAAoAgAiA0EBcQ0AIAAgA0EBcjYCACADQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgAgAEEIakYEQCABIAAoAgw2AgALIAAoAggiAQRAIAEgACgCDDYCBAsgACgCDCIBBEAgASAAKAIINgIACyACECchAkEAIQFBhCAoAgAhACACDQEgACAAKAIAQX5xNgIAQQAPCyACQQ9qQXhxIgMQHSICQX9GDQIgAkEHakF4cSIAIAJHBEAgACACaxAdQX9GDQMLAkBBhCAoAgAiAUUEQEGAICAANgIADAELIAAgATYCBAtBhCAgADYCACAAIANBAXRBAXI2AgAMAQsgAEUNAQsgAEEIaiEBCyABC7kDAQJ/IAAgA2ohBQJAIANBB0wEQANAIAAgBU8NAiAAIAItAAA6AAAgAEEBaiEAIAJBAWohAgwAAAsACyAEQQFGBEACQCAAIAJrIgZBB00EQCAAIAItAAA6AAAgACACLQABOgABIAAgAi0AAjoAAiAAIAItAAM6AAMgAEEEaiACIAZBAnQiBkHAHmooAgBqIgIQFyACIAZB4B5qKAIAayECDAELIAAgAhAMCyACQQhqIQIgAEEIaiEACwJAAkACQAJAIAUgAU0EQCAAIANqIQEgBEEBRyAAIAJrQQ9Kcg0BA0AgACACEAwgAkEIaiECIABBCGoiACABSQ0ACwwFCyAAIAFLBEAgACEBDAQLIARBAUcgACACa0EPSnINASAAIQMgAiEEA0AgAyAEEAwgBEEIaiEEIANBCGoiAyABSQ0ACwwCCwNAIAAgAhAHIAJBEGohAiAAQRBqIgAgAUkNAAsMAwsgACEDIAIhBANAIAMgBBAHIARBEGohBCADQRBqIgMgAUkNAAsLIAIgASAAa2ohAgsDQCABIAVPDQEgASACLQAAOgAAIAFBAWohASACQQFqIQIMAAALAAsLQQECfyAAIAAoArjgASIDNgLE4AEgACgCvOABIQQgACABNgK84AEgACABIAJqNgK44AEgACABIAQgA2tqNgLA4AELpgEBAX8gACAAKALs4QEQFjYCyOABIABCADcD+OABIABCADcDuOABIABBwOABakIANwMAIABBqNAAaiIBQYyAgOAANgIAIABBADYCmOIBIABCADcDiOEBIABCAzcDgOEBIABBrNABakHgEikCADcCACAAQbTQAWpB6BIoAgA2AgAgACABNgIMIAAgAEGYIGo2AgggACAAQaAwajYCBCAAIABBEGo2AgALYQEBf0G4fyEDAkAgAUEDSQ0AIAIgABAhIgFBA3YiADYCCCACIAFBAXE2AgQgAiABQQF2QQNxIgM2AgACQCADQX9qIgFBAksNAAJAIAFBAWsOAgEAAgtBbA8LIAAhAwsgAwsMACAAIAEgAkEAEC4LiAQCA38CfiADEBYhBCAAQQBBKBAQIQAgBCACSwRAIAQPCyABRQRAQX8PCwJAAkAgA0EBRg0AIAEoAAAiBkGo6r5pRg0AQXYhAyAGQXBxQdDUtMIBRw0BQQghAyACQQhJDQEgAEEAQSgQECEAIAEoAAQhASAAQQE2AhQgACABrTcDAEEADwsgASACIAMQLyIDIAJLDQAgACADNgIYQXIhAyABIARqIgVBf2otAAAiAkEIcQ0AIAJBIHEiBkUEQEFwIQMgBS0AACIFQacBSw0BIAVBB3GtQgEgBUEDdkEKaq2GIgdCA4h+IAd8IQggBEEBaiEECyACQQZ2IQMgAkECdiEFAkAgAkEDcUF/aiICQQJLBEBBACECDAELAkACQAJAIAJBAWsOAgECAAsgASAEai0AACECIARBAWohBAwCCyABIARqLwAAIQIgBEECaiEEDAELIAEgBGooAAAhAiAEQQRqIQQLIAVBAXEhBQJ+AkACQAJAIANBf2oiA0ECTQRAIANBAWsOAgIDAQtCfyAGRQ0DGiABIARqMQAADAMLIAEgBGovAACtQoACfAwCCyABIARqKAAArQwBCyABIARqKQAACyEHIAAgBTYCICAAIAI2AhwgACAHNwMAQQAhAyAAQQA2AhQgACAHIAggBhsiBzcDCCAAIAdCgIAIIAdCgIAIVBs+AhALIAMLWwEBf0G4fyEDIAIQFiICIAFNBH8gACACakF/ai0AACIAQQNxQQJ0QaAeaigCACACaiAAQQZ2IgFBAnRBsB5qKAIAaiAAQSBxIgBFaiABRSAAQQV2cWoFQbh/CwsdACAAKAKQ4gEQWiAAQQA2AqDiASAAQgA3A5DiAQu1AwEFfyMAQZACayIKJABBuH8hBgJAIAVFDQAgBCwAACIIQf8BcSEHAkAgCEF/TARAIAdBgn9qQQF2IgggBU8NAkFsIQYgB0GBf2oiBUGAAk8NAiAEQQFqIQdBACEGA0AgBiAFTwRAIAUhBiAIIQcMAwUgACAGaiAHIAZBAXZqIgQtAABBBHY6AAAgACAGQQFyaiAELQAAQQ9xOgAAIAZBAmohBgwBCwAACwALIAcgBU8NASAAIARBAWogByAKEFMiBhADDQELIAYhBEEAIQYgAUEAQTQQECEJQQAhBQNAIAQgBkcEQCAAIAZqIggtAAAiAUELSwRAQWwhBgwDBSAJIAFBAnRqIgEgASgCAEEBajYCACAGQQFqIQZBASAILQAAdEEBdSAFaiEFDAILAAsLQWwhBiAFRQ0AIAUQFEEBaiIBQQxLDQAgAyABNgIAQQFBASABdCAFayIDEBQiAXQgA0cNACAAIARqIAFBAWoiADoAACAJIABBAnRqIgAgACgCAEEBajYCACAJKAIEIgBBAkkgAEEBcXINACACIARBAWo2AgAgB0EBaiEGCyAKQZACaiQAIAYLxhEBDH8jAEHwAGsiBSQAQWwhCwJAIANBCkkNACACLwAAIQogAi8AAiEJIAIvAAQhByAFQQhqIAQQDgJAIAMgByAJIApqakEGaiIMSQ0AIAUtAAohCCAFQdgAaiACQQZqIgIgChAGIgsQAw0BIAVBQGsgAiAKaiICIAkQBiILEAMNASAFQShqIAIgCWoiAiAHEAYiCxADDQEgBUEQaiACIAdqIAMgDGsQBiILEAMNASAAIAFqIg9BfWohECAEQQRqIQZBASELIAAgAUEDakECdiIDaiIMIANqIgIgA2oiDiEDIAIhBCAMIQcDQCALIAMgEElxBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgCS0AAyELIAcgBiAFQUBrIAgQAkECdGoiCS8BADsAACAFQUBrIAktAAIQASAJLQADIQogBCAGIAVBKGogCBACQQJ0aiIJLwEAOwAAIAVBKGogCS0AAhABIAktAAMhCSADIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgDS0AAyENIAAgC2oiCyAGIAVB2ABqIAgQAkECdGoiAC8BADsAACAFQdgAaiAALQACEAEgAC0AAyEAIAcgCmoiCiAGIAVBQGsgCBACQQJ0aiIHLwEAOwAAIAVBQGsgBy0AAhABIActAAMhByAEIAlqIgkgBiAFQShqIAgQAkECdGoiBC8BADsAACAFQShqIAQtAAIQASAELQADIQQgAyANaiIDIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgACALaiEAIAcgCmohByAEIAlqIQQgAyANLQADaiEDIAVB2ABqEA0gBUFAaxANciAFQShqEA1yIAVBEGoQDXJFIQsMAQsLIAQgDksgByACS3INAEFsIQsgACAMSw0BIAxBfWohCQNAQQAgACAJSSAFQdgAahAEGwRAIAAgBiAFQdgAaiAIEAJBAnRqIgovAQA7AAAgBUHYAGogCi0AAhABIAAgCi0AA2oiACAGIAVB2ABqIAgQAkECdGoiCi8BADsAACAFQdgAaiAKLQACEAEgACAKLQADaiEADAEFIAxBfmohCgNAIAVB2ABqEAQgACAKS3JFBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgACAJLQADaiEADAELCwNAIAAgCk0EQCAAIAYgBUHYAGogCBACQQJ0aiIJLwEAOwAAIAVB2ABqIAktAAIQASAAIAktAANqIQAMAQsLAkAgACAMTw0AIAAgBiAFQdgAaiAIEAIiAEECdGoiDC0AADoAACAMLQADQQFGBEAgBUHYAGogDC0AAhABDAELIAUoAlxBH0sNACAFQdgAaiAGIABBAnRqLQACEAEgBSgCXEEhSQ0AIAVBIDYCXAsgAkF9aiEMA0BBACAHIAxJIAVBQGsQBBsEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiIAIAYgBUFAayAIEAJBAnRqIgcvAQA7AAAgBUFAayAHLQACEAEgACAHLQADaiEHDAEFIAJBfmohDANAIAVBQGsQBCAHIAxLckUEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwNAIAcgDE0EQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwJAIAcgAk8NACAHIAYgBUFAayAIEAIiAEECdGoiAi0AADoAACACLQADQQFGBEAgBUFAayACLQACEAEMAQsgBSgCREEfSw0AIAVBQGsgBiAAQQJ0ai0AAhABIAUoAkRBIUkNACAFQSA2AkQLIA5BfWohAgNAQQAgBCACSSAFQShqEAQbBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2oiACAGIAVBKGogCBACQQJ0aiIELwEAOwAAIAVBKGogBC0AAhABIAAgBC0AA2ohBAwBBSAOQX5qIQIDQCAFQShqEAQgBCACS3JFBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsDQCAEIAJNBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsCQCAEIA5PDQAgBCAGIAVBKGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBKGogAi0AAhABDAELIAUoAixBH0sNACAFQShqIAYgAEECdGotAAIQASAFKAIsQSFJDQAgBUEgNgIsCwNAQQAgAyAQSSAFQRBqEAQbBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2oiACAGIAVBEGogCBACQQJ0aiICLwEAOwAAIAVBEGogAi0AAhABIAAgAi0AA2ohAwwBBSAPQX5qIQIDQCAFQRBqEAQgAyACS3JFBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsDQCADIAJNBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsCQCADIA9PDQAgAyAGIAVBEGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBEGogAi0AAhABDAELIAUoAhRBH0sNACAFQRBqIAYgAEECdGotAAIQASAFKAIUQSFJDQAgBUEgNgIUCyABQWwgBUHYAGoQCiAFQUBrEApxIAVBKGoQCnEgBUEQahAKcRshCwwJCwAACwALAAALAAsAAAsACwAACwALQWwhCwsgBUHwAGokACALC7UEAQ5/IwBBEGsiBiQAIAZBBGogABAOQVQhBQJAIARB3AtJDQAgBi0ABCEHIANB8ARqQQBB7AAQECEIIAdBDEsNACADQdwJaiIJIAggBkEIaiAGQQxqIAEgAhAxIhAQA0UEQCAGKAIMIgQgB0sNASADQdwFaiEPIANBpAVqIREgAEEEaiESIANBqAVqIQEgBCEFA0AgBSICQX9qIQUgCCACQQJ0aigCAEUNAAsgAkEBaiEOQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgASALaiAKNgIAIAVBAWohBSAKIAxqIQoMAQsLIAEgCjYCAEEAIQUgBigCCCELA0AgBSALRkUEQCABIAUgCWotAAAiDEECdGoiDSANKAIAIg1BAWo2AgAgDyANQQF0aiINIAw6AAEgDSAFOgAAIAVBAWohBQwBCwtBACEBIANBADYCqAUgBEF/cyAHaiEJQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgAyALaiABNgIAIAwgBSAJanQgAWohASAFQQFqIQUMAQsLIAcgBEEBaiIBIAJrIgRrQQFqIQgDQEEBIQUgBCAIT0UEQANAIAUgDk9FBEAgBUECdCIJIAMgBEE0bGpqIAMgCWooAgAgBHY2AgAgBUEBaiEFDAELCyAEQQFqIQQMAQsLIBIgByAPIAogESADIAIgARBkIAZBAToABSAGIAc6AAYgACAGKAIENgIACyAQIQULIAZBEGokACAFC8ENAQt/IwBB8ABrIgUkAEFsIQkCQCADQQpJDQAgAi8AACEKIAIvAAIhDCACLwAEIQYgBUEIaiAEEA4CQCADIAYgCiAMampBBmoiDUkNACAFLQAKIQcgBUHYAGogAkEGaiICIAoQBiIJEAMNASAFQUBrIAIgCmoiAiAMEAYiCRADDQEgBUEoaiACIAxqIgIgBhAGIgkQAw0BIAVBEGogAiAGaiADIA1rEAYiCRADDQEgACABaiIOQX1qIQ8gBEEEaiEGQQEhCSAAIAFBA2pBAnYiAmoiCiACaiIMIAJqIg0hAyAMIQQgCiECA0AgCSADIA9JcQRAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAACAGIAVBQGsgBxACQQF0aiIILQAAIQsgBUFAayAILQABEAEgAiALOgAAIAYgBUEoaiAHEAJBAXRqIggtAAAhCyAFQShqIAgtAAEQASAEIAs6AAAgBiAFQRBqIAcQAkEBdGoiCC0AACELIAVBEGogCC0AARABIAMgCzoAACAGIAVB2ABqIAcQAkEBdGoiCC0AACELIAVB2ABqIAgtAAEQASAAIAs6AAEgBiAFQUBrIAcQAkEBdGoiCC0AACELIAVBQGsgCC0AARABIAIgCzoAASAGIAVBKGogBxACQQF0aiIILQAAIQsgBUEoaiAILQABEAEgBCALOgABIAYgBUEQaiAHEAJBAXRqIggtAAAhCyAFQRBqIAgtAAEQASADIAs6AAEgA0ECaiEDIARBAmohBCACQQJqIQIgAEECaiEAIAkgBUHYAGoQDUVxIAVBQGsQDUVxIAVBKGoQDUVxIAVBEGoQDUVxIQkMAQsLIAQgDUsgAiAMS3INAEFsIQkgACAKSw0BIApBfWohCQNAIAVB2ABqEAQgACAJT3JFBEAgBiAFQdgAaiAHEAJBAXRqIggtAAAhCyAFQdgAaiAILQABEAEgACALOgAAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAASAAQQJqIQAMAQsLA0AgBUHYAGoQBCAAIApPckUEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCwNAIAAgCkkEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCyAMQX1qIQADQCAFQUBrEAQgAiAAT3JFBEAgBiAFQUBrIAcQAkEBdGoiCi0AACEJIAVBQGsgCi0AARABIAIgCToAACAGIAVBQGsgBxACQQF0aiIKLQAAIQkgBUFAayAKLQABEAEgAiAJOgABIAJBAmohAgwBCwsDQCAFQUBrEAQgAiAMT3JFBEAgBiAFQUBrIAcQAkEBdGoiAC0AACEKIAVBQGsgAC0AARABIAIgCjoAACACQQFqIQIMAQsLA0AgAiAMSQRAIAYgBUFAayAHEAJBAXRqIgAtAAAhCiAFQUBrIAAtAAEQASACIAo6AAAgAkEBaiECDAELCyANQX1qIQADQCAFQShqEAQgBCAAT3JFBEAgBiAFQShqIAcQAkEBdGoiAi0AACEKIAVBKGogAi0AARABIAQgCjoAACAGIAVBKGogBxACQQF0aiICLQAAIQogBUEoaiACLQABEAEgBCAKOgABIARBAmohBAwBCwsDQCAFQShqEAQgBCANT3JFBEAgBiAFQShqIAcQAkEBdGoiAC0AACECIAVBKGogAC0AARABIAQgAjoAACAEQQFqIQQMAQsLA0AgBCANSQRAIAYgBUEoaiAHEAJBAXRqIgAtAAAhAiAFQShqIAAtAAEQASAEIAI6AAAgBEEBaiEEDAELCwNAIAVBEGoQBCADIA9PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIAYgBUEQaiAHEAJBAXRqIgAtAAAhAiAFQRBqIAAtAAEQASADIAI6AAEgA0ECaiEDDAELCwNAIAVBEGoQBCADIA5PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIANBAWohAwwBCwsDQCADIA5JBEAgBiAFQRBqIAcQAkEBdGoiAC0AACECIAVBEGogAC0AARABIAMgAjoAACADQQFqIQMMAQsLIAFBbCAFQdgAahAKIAVBQGsQCnEgBUEoahAKcSAFQRBqEApxGyEJDAELQWwhCQsgBUHwAGokACAJC8oCAQR/IwBBIGsiBSQAIAUgBBAOIAUtAAIhByAFQQhqIAIgAxAGIgIQA0UEQCAEQQRqIQIgACABaiIDQX1qIQQDQCAFQQhqEAQgACAET3JFBEAgAiAFQQhqIAcQAkEBdGoiBi0AACEIIAVBCGogBi0AARABIAAgCDoAACACIAVBCGogBxACQQF0aiIGLQAAIQggBUEIaiAGLQABEAEgACAIOgABIABBAmohAAwBCwsDQCAFQQhqEAQgACADT3JFBEAgAiAFQQhqIAcQAkEBdGoiBC0AACEGIAVBCGogBC0AARABIAAgBjoAACAAQQFqIQAMAQsLA0AgACADT0UEQCACIAVBCGogBxACQQF0aiIELQAAIQYgBUEIaiAELQABEAEgACAGOgAAIABBAWohAAwBCwsgAUFsIAVBCGoQChshAgsgBUEgaiQAIAILtgMBCX8jAEEQayIGJAAgBkEANgIMIAZBADYCCEFUIQQCQAJAIANBQGsiDCADIAZBCGogBkEMaiABIAIQMSICEAMNACAGQQRqIAAQDiAGKAIMIgcgBi0ABEEBaksNASAAQQRqIQogBkEAOgAFIAYgBzoABiAAIAYoAgQ2AgAgB0EBaiEJQQEhBANAIAQgCUkEQCADIARBAnRqIgEoAgAhACABIAU2AgAgACAEQX9qdCAFaiEFIARBAWohBAwBCwsgB0EBaiEHQQAhBSAGKAIIIQkDQCAFIAlGDQEgAyAFIAxqLQAAIgRBAnRqIgBBASAEdEEBdSILIAAoAgAiAWoiADYCACAHIARrIQhBACEEAkAgC0EDTQRAA0AgBCALRg0CIAogASAEakEBdGoiACAIOgABIAAgBToAACAEQQFqIQQMAAALAAsDQCABIABPDQEgCiABQQF0aiIEIAg6AAEgBCAFOgAAIAQgCDoAAyAEIAU6AAIgBCAIOgAFIAQgBToABCAEIAg6AAcgBCAFOgAGIAFBBGohAQwAAAsACyAFQQFqIQUMAAALAAsgAiEECyAGQRBqJAAgBAutAQECfwJAQYQgKAIAIABHIAAoAgBBAXYiAyABa0F4aiICQXhxQQhHcgR/IAIFIAMQJ0UNASACQQhqC0EQSQ0AIAAgACgCACICQQFxIAAgAWpBD2pBeHEiASAAa0EBdHI2AgAgASAANgIEIAEgASgCAEEBcSAAIAJBAXZqIAFrIgJBAXRyNgIAQYQgIAEgAkH/////B3FqQQRqQYQgKAIAIABGGyABNgIAIAEQJQsLygIBBX8CQAJAAkAgAEEIIABBCEsbZ0EfcyAAaUEBR2oiAUEESSAAIAF2cg0AIAFBAnRB/B5qKAIAIgJFDQADQCACQXhqIgMoAgBBAXZBeGoiBSAATwRAIAIgBUEIIAVBCEsbZ0Efc0ECdEGAH2oiASgCAEYEQCABIAIoAgQ2AgALDAMLIARBHksNASAEQQFqIQQgAigCBCICDQALC0EAIQMgAUEgTw0BA0AgAUECdEGAH2ooAgAiAkUEQCABQR5LIQIgAUEBaiEBIAJFDQEMAwsLIAIgAkF4aiIDKAIAQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgBGBEAgASACKAIENgIACwsgAigCACIBBEAgASACKAIENgIECyACKAIEIgEEQCABIAIoAgA2AgALIAMgAygCAEEBcjYCACADIAAQNwsgAwvhCwINfwV+IwBB8ABrIgckACAHIAAoAvDhASIINgJcIAEgAmohDSAIIAAoAoDiAWohDwJAAkAgBUUEQCABIQQMAQsgACgCxOABIRAgACgCwOABIREgACgCvOABIQ4gAEEBNgKM4QFBACEIA0AgCEEDRwRAIAcgCEECdCICaiAAIAJqQazQAWooAgA2AkQgCEEBaiEIDAELC0FsIQwgB0EYaiADIAQQBhADDQEgB0EsaiAHQRhqIAAoAgAQEyAHQTRqIAdBGGogACgCCBATIAdBPGogB0EYaiAAKAIEEBMgDUFgaiESIAEhBEEAIQwDQCAHKAIwIAcoAixBA3RqKQIAIhRCEIinQf8BcSEIIAcoAkAgBygCPEEDdGopAgAiFUIQiKdB/wFxIQsgBygCOCAHKAI0QQN0aikCACIWQiCIpyEJIBVCIIghFyAUQiCIpyECAkAgFkIQiKdB/wFxIgNBAk8EQAJAIAZFIANBGUlyRQRAIAkgB0EYaiADQSAgBygCHGsiCiAKIANLGyIKEAUgAyAKayIDdGohCSAHQRhqEAQaIANFDQEgB0EYaiADEAUgCWohCQwBCyAHQRhqIAMQBSAJaiEJIAdBGGoQBBoLIAcpAkQhGCAHIAk2AkQgByAYNwNIDAELAkAgA0UEQCACBEAgBygCRCEJDAMLIAcoAkghCQwBCwJAAkAgB0EYakEBEAUgCSACRWpqIgNBA0YEQCAHKAJEQX9qIgMgA0VqIQkMAQsgA0ECdCAHaigCRCIJIAlFaiEJIANBAUYNAQsgByAHKAJINgJMCwsgByAHKAJENgJIIAcgCTYCRAsgF6chAyALBEAgB0EYaiALEAUgA2ohAwsgCCALakEUTwRAIAdBGGoQBBoLIAgEQCAHQRhqIAgQBSACaiECCyAHQRhqEAQaIAcgB0EYaiAUQhiIp0H/AXEQCCAUp0H//wNxajYCLCAHIAdBGGogFUIYiKdB/wFxEAggFadB//8DcWo2AjwgB0EYahAEGiAHIAdBGGogFkIYiKdB/wFxEAggFqdB//8DcWo2AjQgByACNgJgIAcoAlwhCiAHIAk2AmggByADNgJkAkACQAJAIAQgAiADaiILaiASSw0AIAIgCmoiEyAPSw0AIA0gBGsgC0Egak8NAQsgByAHKQNoNwMQIAcgBykDYDcDCCAEIA0gB0EIaiAHQdwAaiAPIA4gESAQEB4hCwwBCyACIARqIQggBCAKEAcgAkERTwRAIARBEGohAgNAIAIgCkEQaiIKEAcgAkEQaiICIAhJDQALCyAIIAlrIQIgByATNgJcIAkgCCAOa0sEQCAJIAggEWtLBEBBbCELDAILIBAgAiAOayICaiIKIANqIBBNBEAgCCAKIAMQDxoMAgsgCCAKQQAgAmsQDyEIIAcgAiADaiIDNgJkIAggAmshCCAOIQILIAlBEE8EQCADIAhqIQMDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALDAELAkAgCUEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgCUECdCIDQcAeaigCAGoiAhAXIAIgA0HgHmooAgBrIQIgBygCZCEDDAELIAggAhAMCyADQQlJDQAgAyAIaiEDIAhBCGoiCCACQQhqIgJrQQ9MBEADQCAIIAIQDCACQQhqIQIgCEEIaiIIIANJDQAMAgALAAsDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALCyAHQRhqEAQaIAsgDCALEAMiAhshDCAEIAQgC2ogAhshBCAFQX9qIgUNAAsgDBADDQFBbCEMIAdBGGoQBEECSQ0BQQAhCANAIAhBA0cEQCAAIAhBAnQiAmpBrNABaiACIAdqKAJENgIAIAhBAWohCAwBCwsgBygCXCEIC0G6fyEMIA8gCGsiACANIARrSw0AIAQEfyAEIAggABALIABqBUEACyABayEMCyAHQfAAaiQAIAwLkRcCFn8FfiMAQdABayIHJAAgByAAKALw4QEiCDYCvAEgASACaiESIAggACgCgOIBaiETAkACQCAFRQRAIAEhAwwBCyAAKALE4AEhESAAKALA4AEhFSAAKAK84AEhDyAAQQE2AozhAUEAIQgDQCAIQQNHBEAgByAIQQJ0IgJqIAAgAmpBrNABaigCADYCVCAIQQFqIQgMAQsLIAcgETYCZCAHIA82AmAgByABIA9rNgJoQWwhECAHQShqIAMgBBAGEAMNASAFQQQgBUEESBshFyAHQTxqIAdBKGogACgCABATIAdBxABqIAdBKGogACgCCBATIAdBzABqIAdBKGogACgCBBATQQAhBCAHQeAAaiEMIAdB5ABqIQoDQCAHQShqEARBAksgBCAXTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEJIAcoAkggBygCREEDdGopAgAiH0IgiKchCCAeQiCIISAgHUIgiKchAgJAIB9CEIinQf8BcSIDQQJPBEACQCAGRSADQRlJckUEQCAIIAdBKGogA0EgIAcoAixrIg0gDSADSxsiDRAFIAMgDWsiA3RqIQggB0EoahAEGiADRQ0BIAdBKGogAxAFIAhqIQgMAQsgB0EoaiADEAUgCGohCCAHQShqEAQaCyAHKQJUISEgByAINgJUIAcgITcDWAwBCwJAIANFBEAgAgRAIAcoAlQhCAwDCyAHKAJYIQgMAQsCQAJAIAdBKGpBARAFIAggAkVqaiIDQQNGBEAgBygCVEF/aiIDIANFaiEIDAELIANBAnQgB2ooAlQiCCAIRWohCCADQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAg2AlQLICCnIQMgCQRAIAdBKGogCRAFIANqIQMLIAkgC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgAmohAgsgB0EoahAEGiAHIAcoAmggAmoiCSADajYCaCAKIAwgCCAJSxsoAgAhDSAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogB0EoaiAfQhiIp0H/AXEQCCEOIAdB8ABqIARBBHRqIgsgCSANaiAIazYCDCALIAg2AgggCyADNgIEIAsgAjYCACAHIA4gH6dB//8DcWo2AkQgBEEBaiEEDAELCyAEIBdIDQEgEkFgaiEYIAdB4ABqIRogB0HkAGohGyABIQMDQCAHQShqEARBAksgBCAFTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEIIAcoAkggBygCREEDdGopAgAiH0IgiKchCSAeQiCIISAgHUIgiKchDAJAIB9CEIinQf8BcSICQQJPBEACQCAGRSACQRlJckUEQCAJIAdBKGogAkEgIAcoAixrIgogCiACSxsiChAFIAIgCmsiAnRqIQkgB0EoahAEGiACRQ0BIAdBKGogAhAFIAlqIQkMAQsgB0EoaiACEAUgCWohCSAHQShqEAQaCyAHKQJUISEgByAJNgJUIAcgITcDWAwBCwJAIAJFBEAgDARAIAcoAlQhCQwDCyAHKAJYIQkMAQsCQAJAIAdBKGpBARAFIAkgDEVqaiICQQNGBEAgBygCVEF/aiICIAJFaiEJDAELIAJBAnQgB2ooAlQiCSAJRWohCSACQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAk2AlQLICCnIRQgCARAIAdBKGogCBAFIBRqIRQLIAggC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgDGohDAsgB0EoahAEGiAHIAcoAmggDGoiGSAUajYCaCAbIBogCSAZSxsoAgAhHCAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogByAHQShqIB9CGIinQf8BcRAIIB+nQf//A3FqNgJEIAcgB0HwAGogBEEDcUEEdGoiDSkDCCIdNwPIASAHIA0pAwAiHjcDwAECQAJAAkAgBygCvAEiDiAepyICaiIWIBNLDQAgAyAHKALEASIKIAJqIgtqIBhLDQAgEiADayALQSBqTw0BCyAHIAcpA8gBNwMQIAcgBykDwAE3AwggAyASIAdBCGogB0G8AWogEyAPIBUgERAeIQsMAQsgAiADaiEIIAMgDhAHIAJBEU8EQCADQRBqIQIDQCACIA5BEGoiDhAHIAJBEGoiAiAISQ0ACwsgCCAdpyIOayECIAcgFjYCvAEgDiAIIA9rSwRAIA4gCCAVa0sEQEFsIQsMAgsgESACIA9rIgJqIhYgCmogEU0EQCAIIBYgChAPGgwCCyAIIBZBACACaxAPIQggByACIApqIgo2AsQBIAggAmshCCAPIQILIA5BEE8EQCAIIApqIQoDQCAIIAIQByACQRBqIQIgCEEQaiIIIApJDQALDAELAkAgDkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgDkECdCIKQcAeaigCAGoiAhAXIAIgCkHgHmooAgBrIQIgBygCxAEhCgwBCyAIIAIQDAsgCkEJSQ0AIAggCmohCiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAKSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAKSQ0ACwsgCxADBEAgCyEQDAQFIA0gDDYCACANIBkgHGogCWs2AgwgDSAJNgIIIA0gFDYCBCAEQQFqIQQgAyALaiEDDAILAAsLIAQgBUgNASAEIBdrIQtBACEEA0AgCyAFSARAIAcgB0HwAGogC0EDcUEEdGoiAikDCCIdNwPIASAHIAIpAwAiHjcDwAECQAJAAkAgBygCvAEiDCAepyICaiIKIBNLDQAgAyAHKALEASIJIAJqIhBqIBhLDQAgEiADayAQQSBqTw0BCyAHIAcpA8gBNwMgIAcgBykDwAE3AxggAyASIAdBGGogB0G8AWogEyAPIBUgERAeIRAMAQsgAiADaiEIIAMgDBAHIAJBEU8EQCADQRBqIQIDQCACIAxBEGoiDBAHIAJBEGoiAiAISQ0ACwsgCCAdpyIGayECIAcgCjYCvAEgBiAIIA9rSwRAIAYgCCAVa0sEQEFsIRAMAgsgESACIA9rIgJqIgwgCWogEU0EQCAIIAwgCRAPGgwCCyAIIAxBACACaxAPIQggByACIAlqIgk2AsQBIAggAmshCCAPIQILIAZBEE8EQCAIIAlqIQYDQCAIIAIQByACQRBqIQIgCEEQaiIIIAZJDQALDAELAkAgBkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgBkECdCIGQcAeaigCAGoiAhAXIAIgBkHgHmooAgBrIQIgBygCxAEhCQwBCyAIIAIQDAsgCUEJSQ0AIAggCWohBiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAGSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAGSQ0ACwsgEBADDQMgC0EBaiELIAMgEGohAwwBCwsDQCAEQQNHBEAgACAEQQJ0IgJqQazQAWogAiAHaigCVDYCACAEQQFqIQQMAQsLIAcoArwBIQgLQbp/IRAgEyAIayIAIBIgA2tLDQAgAwR/IAMgCCAAEAsgAGoFQQALIAFrIRALIAdB0AFqJAAgEAslACAAQgA3AgAgAEEAOwEIIABBADoACyAAIAE2AgwgACACOgAKC7QFAQN/IwBBMGsiBCQAIABB/wFqIgVBfWohBgJAIAMvAQIEQCAEQRhqIAEgAhAGIgIQAw0BIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahASOgAAIAMgBEEIaiAEQRhqEBI6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0FIAEgBEEQaiAEQRhqEBI6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBSABIARBCGogBEEYahASOgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEjoAACABIAJqIABrIQIMAwsgAyAEQRBqIARBGGoQEjoAAiADIARBCGogBEEYahASOgADIANBBGohAwwAAAsACyAEQRhqIAEgAhAGIgIQAw0AIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahAROgAAIAMgBEEIaiAEQRhqEBE6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0EIAEgBEEQaiAEQRhqEBE6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBCABIARBCGogBEEYahAROgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEToAACABIAJqIABrIQIMAgsgAyAEQRBqIARBGGoQEToAAiADIARBCGogBEEYahAROgADIANBBGohAwwAAAsACyAEQTBqJAAgAgtpAQF/An8CQAJAIAJBB00NACABKAAAQbfIwuF+Rw0AIAAgASgABDYCmOIBQWIgAEEQaiABIAIQPiIDEAMNAhogAEKBgICAEDcDiOEBIAAgASADaiACIANrECoMAQsgACABIAIQKgtBAAsLrQMBBn8jAEGAAWsiAyQAQWIhCAJAIAJBCUkNACAAQZjQAGogAUEIaiIEIAJBeGogAEGY0AAQMyIFEAMiBg0AIANBHzYCfCADIANB/ABqIANB+ABqIAQgBCAFaiAGGyIEIAEgAmoiAiAEaxAVIgUQAw0AIAMoAnwiBkEfSw0AIAMoAngiB0EJTw0AIABBiCBqIAMgBkGAC0GADCAHEBggA0E0NgJ8IAMgA0H8AGogA0H4AGogBCAFaiIEIAIgBGsQFSIFEAMNACADKAJ8IgZBNEsNACADKAJ4IgdBCk8NACAAQZAwaiADIAZBgA1B4A4gBxAYIANBIzYCfCADIANB/ABqIANB+ABqIAQgBWoiBCACIARrEBUiBRADDQAgAygCfCIGQSNLDQAgAygCeCIHQQpPDQAgACADIAZBwBBB0BEgBxAYIAQgBWoiBEEMaiIFIAJLDQAgAiAFayEFQQAhAgNAIAJBA0cEQCAEKAAAIgZBf2ogBU8NAiAAIAJBAnRqQZzQAWogBjYCACACQQFqIQIgBEEEaiEEDAELCyAEIAFrIQgLIANBgAFqJAAgCAtGAQN/IABBCGohAyAAKAIEIQJBACEAA0AgACACdkUEQCABIAMgAEEDdGotAAJBFktqIQEgAEEBaiEADAELCyABQQggAmt0C4YDAQV/Qbh/IQcCQCADRQ0AIAItAAAiBEUEQCABQQA2AgBBAUG4fyADQQFGGw8LAn8gAkEBaiIFIARBGHRBGHUiBkF/Sg0AGiAGQX9GBEAgA0EDSA0CIAUvAABBgP4BaiEEIAJBA2oMAQsgA0ECSA0BIAItAAEgBEEIdHJBgIB+aiEEIAJBAmoLIQUgASAENgIAIAVBAWoiASACIANqIgNLDQBBbCEHIABBEGogACAFLQAAIgVBBnZBI0EJIAEgAyABa0HAEEHQEUHwEiAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBmCBqIABBCGogBUEEdkEDcUEfQQggASABIAZqIAgbIgEgAyABa0GAC0GADEGAFyAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBoDBqIABBBGogBUECdkEDcUE0QQkgASABIAZqIAgbIgEgAyABa0GADUHgDkGQGSAAKAKM4QEgACgCnOIBIAQQHyIAEAMNACAAIAFqIAJrIQcLIAcLrQMBCn8jAEGABGsiCCQAAn9BUiACQf8BSw0AGkFUIANBDEsNABogAkEBaiELIABBBGohCUGAgAQgA0F/anRBEHUhCkEAIQJBASEEQQEgA3QiB0F/aiIMIQUDQCACIAtGRQRAAkAgASACQQF0Ig1qLwEAIgZB//8DRgRAIAkgBUECdGogAjoAAiAFQX9qIQVBASEGDAELIARBACAKIAZBEHRBEHVKGyEECyAIIA1qIAY7AQAgAkEBaiECDAELCyAAIAQ7AQIgACADOwEAIAdBA3YgB0EBdmpBA2ohBkEAIQRBACECA0AgBCALRkUEQCABIARBAXRqLgEAIQpBACEAA0AgACAKTkUEQCAJIAJBAnRqIAQ6AAIDQCACIAZqIAxxIgIgBUsNAAsgAEEBaiEADAELCyAEQQFqIQQMAQsLQX8gAg0AGkEAIQIDfyACIAdGBH9BAAUgCCAJIAJBAnRqIgAtAAJBAXRqIgEgAS8BACIBQQFqOwEAIAAgAyABEBRrIgU6AAMgACABIAVB/wFxdCAHazsBACACQQFqIQIMAQsLCyEFIAhBgARqJAAgBQvjBgEIf0FsIQcCQCACQQNJDQACQAJAAkACQCABLQAAIgNBA3EiCUEBaw4DAwEAAgsgACgCiOEBDQBBYg8LIAJBBUkNAkEDIQYgASgAACEFAn8CQAJAIANBAnZBA3EiCEF+aiIEQQFNBEAgBEEBaw0BDAILIAVBDnZB/wdxIQQgBUEEdkH/B3EhAyAIRQwCCyAFQRJ2IQRBBCEGIAVBBHZB//8AcSEDQQAMAQsgBUEEdkH//w9xIgNBgIAISw0DIAEtAARBCnQgBUEWdnIhBEEFIQZBAAshBSAEIAZqIgogAksNAgJAIANBgQZJDQAgACgCnOIBRQ0AQQAhAgNAIAJBg4ABSw0BIAJBQGshAgwAAAsACwJ/IAlBA0YEQCABIAZqIQEgAEHw4gFqIQIgACgCDCEGIAUEQCACIAMgASAEIAYQXwwCCyACIAMgASAEIAYQXQwBCyAAQbjQAWohAiABIAZqIQEgAEHw4gFqIQYgAEGo0ABqIQggBQRAIAggBiADIAEgBCACEF4MAQsgCCAGIAMgASAEIAIQXAsQAw0CIAAgAzYCgOIBIABBATYCiOEBIAAgAEHw4gFqNgLw4QEgCUECRgRAIAAgAEGo0ABqNgIMCyAAIANqIgBBiOMBakIANwAAIABBgOMBakIANwAAIABB+OIBakIANwAAIABB8OIBakIANwAAIAoPCwJ/AkACQAJAIANBAnZBA3FBf2oiBEECSw0AIARBAWsOAgACAQtBASEEIANBA3YMAgtBAiEEIAEvAABBBHYMAQtBAyEEIAEQIUEEdgsiAyAEaiIFQSBqIAJLBEAgBSACSw0CIABB8OIBaiABIARqIAMQCyEBIAAgAzYCgOIBIAAgATYC8OEBIAEgA2oiAEIANwAYIABCADcAECAAQgA3AAggAEIANwAAIAUPCyAAIAM2AoDiASAAIAEgBGo2AvDhASAFDwsCfwJAAkACQCADQQJ2QQNxQX9qIgRBAksNACAEQQFrDgIAAgELQQEhByADQQN2DAILQQIhByABLwAAQQR2DAELIAJBBEkgARAhIgJBj4CAAUtyDQFBAyEHIAJBBHYLIQIgAEHw4gFqIAEgB2otAAAgAkEgahAQIQEgACACNgKA4gEgACABNgLw4QEgB0EBaiEHCyAHC0sAIABC+erQ0OfJoeThADcDICAAQgA3AxggAELP1tO+0ser2UI3AxAgAELW64Lu6v2J9eAANwMIIABCADcDACAAQShqQQBBKBAQGgviAgICfwV+IABBKGoiASAAKAJIaiECAn4gACkDACIDQiBaBEAgACkDECIEQgeJIAApAwgiBUIBiXwgACkDGCIGQgyJfCAAKQMgIgdCEol8IAUQGSAEEBkgBhAZIAcQGQwBCyAAKQMYQsXP2bLx5brqJ3wLIAN8IQMDQCABQQhqIgAgAk0EQEIAIAEpAAAQCSADhUIbiUKHla+vmLbem55/fkLj3MqV/M7y9YV/fCEDIAAhAQwBCwsCQCABQQRqIgAgAksEQCABIQAMAQsgASgAAK1Ch5Wvr5i23puef34gA4VCF4lCz9bTvtLHq9lCfkL5893xmfaZqxZ8IQMLA0AgACACSQRAIAAxAABCxc/ZsvHluuonfiADhUILiUKHla+vmLbem55/fiEDIABBAWohAAwBCwsgA0IhiCADhULP1tO+0ser2UJ+IgNCHYggA4VC+fPd8Zn2masWfiIDQiCIIAOFC+8CAgJ/BH4gACAAKQMAIAKtfDcDAAJAAkAgACgCSCIDIAJqIgRBH00EQCABRQ0BIAAgA2pBKGogASACECAgACgCSCACaiEEDAELIAEgAmohAgJ/IAMEQCAAQShqIgQgA2ogAUEgIANrECAgACAAKQMIIAQpAAAQCTcDCCAAIAApAxAgACkAMBAJNwMQIAAgACkDGCAAKQA4EAk3AxggACAAKQMgIABBQGspAAAQCTcDICAAKAJIIQMgAEEANgJIIAEgA2tBIGohAQsgAUEgaiACTQsEQCACQWBqIQMgACkDICEFIAApAxghBiAAKQMQIQcgACkDCCEIA0AgCCABKQAAEAkhCCAHIAEpAAgQCSEHIAYgASkAEBAJIQYgBSABKQAYEAkhBSABQSBqIgEgA00NAAsgACAFNwMgIAAgBjcDGCAAIAc3AxAgACAINwMICyABIAJPDQEgAEEoaiABIAIgAWsiBBAgCyAAIAQ2AkgLCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQEBogAwVBun8LCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQCxogAwVBun8LC6gCAQZ/IwBBEGsiByQAIABB2OABaikDAEKAgIAQViEIQbh/IQUCQCAEQf//B0sNACAAIAMgBBBCIgUQAyIGDQAgACgCnOIBIQkgACAHQQxqIAMgAyAFaiAGGyIKIARBACAFIAYbayIGEEAiAxADBEAgAyEFDAELIAcoAgwhBCABRQRAQbp/IQUgBEEASg0BCyAGIANrIQUgAyAKaiEDAkAgCQRAIABBADYCnOIBDAELAkACQAJAIARBBUgNACAAQdjgAWopAwBCgICACFgNAAwBCyAAQQA2ApziAQwBCyAAKAIIED8hBiAAQQA2ApziASAGQRRPDQELIAAgASACIAMgBSAEIAgQOSEFDAELIAAgASACIAMgBSAEIAgQOiEFCyAHQRBqJAAgBQtnACAAQdDgAWogASACIAAoAuzhARAuIgEQAwRAIAEPC0G4fyECAkAgAQ0AIABB7OABaigCACIBBEBBYCECIAAoApjiASABRw0BC0EAIQIgAEHw4AFqKAIARQ0AIABBkOEBahBDCyACCycBAX8QVyIERQRAQUAPCyAEIAAgASACIAMgBBBLEE8hACAEEFYgAAs/AQF/AkACQAJAIAAoAqDiAUEBaiIBQQJLDQAgAUEBaw4CAAECCyAAEDBBAA8LIABBADYCoOIBCyAAKAKU4gELvAMCB38BfiMAQRBrIgkkAEG4fyEGAkAgBCgCACIIQQVBCSAAKALs4QEiBRtJDQAgAygCACIHQQFBBSAFGyAFEC8iBRADBEAgBSEGDAELIAggBUEDakkNACAAIAcgBRBJIgYQAw0AIAEgAmohCiAAQZDhAWohCyAIIAVrIQIgBSAHaiEHIAEhBQNAIAcgAiAJECwiBhADDQEgAkF9aiICIAZJBEBBuH8hBgwCCyAJKAIAIghBAksEQEFsIQYMAgsgB0EDaiEHAn8CQAJAAkAgCEEBaw4CAgABCyAAIAUgCiAFayAHIAYQSAwCCyAFIAogBWsgByAGEEcMAQsgBSAKIAVrIActAAAgCSgCCBBGCyIIEAMEQCAIIQYMAgsgACgC8OABBEAgCyAFIAgQRQsgAiAGayECIAYgB2ohByAFIAhqIQUgCSgCBEUNAAsgACkD0OABIgxCf1IEQEFsIQYgDCAFIAFrrFINAQsgACgC8OABBEBBaiEGIAJBBEkNASALEEQhDCAHKAAAIAynRw0BIAdBBGohByACQXxqIQILIAMgBzYCACAEIAI2AgAgBSABayEGCyAJQRBqJAAgBgsuACAAECsCf0EAQQAQAw0AGiABRSACRXJFBEBBYiAAIAEgAhA9EAMNARoLQQALCzcAIAEEQCAAIAAoAsTgASABKAIEIAEoAghqRzYCnOIBCyAAECtBABADIAFFckUEQCAAIAEQWwsL0QIBB38jAEEQayIGJAAgBiAENgIIIAYgAzYCDCAFBEAgBSgCBCEKIAUoAgghCQsgASEIAkACQANAIAAoAuzhARAWIQsCQANAIAQgC0kNASADKAAAQXBxQdDUtMIBRgRAIAMgBBAiIgcQAw0EIAQgB2shBCADIAdqIQMMAQsLIAYgAzYCDCAGIAQ2AggCQCAFBEAgACAFEE5BACEHQQAQA0UNAQwFCyAAIAogCRBNIgcQAw0ECyAAIAgQUCAMQQFHQQAgACAIIAIgBkEMaiAGQQhqEEwiByIDa0EAIAMQAxtBCkdyRQRAQbh/IQcMBAsgBxADDQMgAiAHayECIAcgCGohCEEBIQwgBigCDCEDIAYoAgghBAwBCwsgBiADNgIMIAYgBDYCCEG4fyEHIAQNASAIIAFrIQcMAQsgBiADNgIMIAYgBDYCCAsgBkEQaiQAIAcLRgECfyABIAAoArjgASICRwRAIAAgAjYCxOABIAAgATYCuOABIAAoArzgASEDIAAgATYCvOABIAAgASADIAJrajYCwOABCwutAgIEfwF+IwBBQGoiBCQAAkACQCACQQhJDQAgASgAAEFwcUHQ1LTCAUcNACABIAIQIiEBIABCADcDCCAAQQA2AgQgACABNgIADAELIARBGGogASACEC0iAxADBEAgACADEBoMAQsgAwRAIABBuH8QGgwBCyACIAQoAjAiA2shAiABIANqIQMDQAJAIAAgAyACIARBCGoQLCIFEAMEfyAFBSACIAVBA2oiBU8NAUG4fwsQGgwCCyAGQQFqIQYgAiAFayECIAMgBWohAyAEKAIMRQ0ACyAEKAI4BEAgAkEDTQRAIABBuH8QGgwCCyADQQRqIQMLIAQoAighAiAEKQMYIQcgAEEANgIEIAAgAyABazYCACAAIAIgBmytIAcgB0J/URs3AwgLIARBQGskAAslAQF/IwBBEGsiAiQAIAIgACABEFEgAigCACEAIAJBEGokACAAC30BBH8jAEGQBGsiBCQAIARB/wE2AggCQCAEQRBqIARBCGogBEEMaiABIAIQFSIGEAMEQCAGIQUMAQtBVCEFIAQoAgwiB0EGSw0AIAMgBEEQaiAEKAIIIAcQQSIFEAMNACAAIAEgBmogAiAGayADEDwhBQsgBEGQBGokACAFC4cBAgJ/An5BABAWIQMCQANAIAEgA08EQAJAIAAoAABBcHFB0NS0wgFGBEAgACABECIiAhADRQ0BQn4PCyAAIAEQVSIEQn1WDQMgBCAFfCIFIARUIQJCfiEEIAINAyAAIAEQUiICEAMNAwsgASACayEBIAAgAmohAAwBCwtCfiAFIAEbIQQLIAQLPwIBfwF+IwBBMGsiAiQAAn5CfiACQQhqIAAgARAtDQAaQgAgAigCHEEBRg0AGiACKQMICyEDIAJBMGokACADC40BAQJ/IwBBMGsiASQAAkAgAEUNACAAKAKI4gENACABIABB/OEBaigCADYCKCABIAApAvThATcDICAAEDAgACgCqOIBIQIgASABKAIoNgIYIAEgASkDIDcDECACIAFBEGoQGyAAQQA2AqjiASABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALKgECfyMAQRBrIgAkACAAQQA2AgggAEIANwMAIAAQWCEBIABBEGokACABC4cBAQN/IwBBEGsiAiQAAkAgACgCAEUgACgCBEVzDQAgAiAAKAIINgIIIAIgACkCADcDAAJ/IAIoAgAiAQRAIAIoAghBqOMJIAERBQAMAQtBqOMJECgLIgFFDQAgASAAKQIANwL04QEgAUH84QFqIAAoAgg2AgAgARBZIAEhAwsgAkEQaiQAIAMLywEBAn8jAEEgayIBJAAgAEGBgIDAADYCtOIBIABBADYCiOIBIABBADYC7OEBIABCADcDkOIBIABBADYCpOMJIABBADYC3OIBIABCADcCzOIBIABBADYCvOIBIABBADYCxOABIABCADcCnOIBIABBpOIBakIANwIAIABBrOIBakEANgIAIAFCADcCECABQgA3AhggASABKQMYNwMIIAEgASkDEDcDACABKAIIQQh2QQFxIQIgAEEANgLg4gEgACACNgKM4gEgAUEgaiQAC3YBA38jAEEwayIBJAAgAARAIAEgAEHE0AFqIgIoAgA2AiggASAAKQK80AE3AyAgACgCACEDIAEgAigCADYCGCABIAApArzQATcDECADIAFBEGoQGyABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALzAEBAX8gACABKAK00AE2ApjiASAAIAEoAgQiAjYCwOABIAAgAjYCvOABIAAgAiABKAIIaiICNgK44AEgACACNgLE4AEgASgCuNABBEAgAEKBgICAEDcDiOEBIAAgAUGk0ABqNgIMIAAgAUGUIGo2AgggACABQZwwajYCBCAAIAFBDGo2AgAgAEGs0AFqIAFBqNABaigCADYCACAAQbDQAWogAUGs0AFqKAIANgIAIABBtNABaiABQbDQAWooAgA2AgAPCyAAQgA3A4jhAQs7ACACRQRAQbp/DwsgBEUEQEFsDwsgAiAEEGAEQCAAIAEgAiADIAQgBRBhDwsgACABIAIgAyAEIAUQZQtGAQF/IwBBEGsiBSQAIAVBCGogBBAOAn8gBS0ACQRAIAAgASACIAMgBBAyDAELIAAgASACIAMgBBA0CyEAIAVBEGokACAACzQAIAAgAyAEIAUQNiIFEAMEQCAFDwsgBSAESQR/IAEgAiADIAVqIAQgBWsgABA1BUG4fwsLRgEBfyMAQRBrIgUkACAFQQhqIAQQDgJ/IAUtAAkEQCAAIAEgAiADIAQQYgwBCyAAIAEgAiADIAQQNQshACAFQRBqJAAgAAtZAQF/QQ8hAiABIABJBEAgAUEEdCAAbiECCyAAQQh2IgEgAkEYbCIAQYwIaigCAGwgAEGICGooAgBqIgJBA3YgAmogAEGACGooAgAgAEGECGooAgAgAWxqSQs3ACAAIAMgBCAFQYAQEDMiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQMgVBuH8LC78DAQN/IwBBIGsiBSQAIAVBCGogAiADEAYiAhADRQRAIAAgAWoiB0F9aiEGIAUgBBAOIARBBGohAiAFLQACIQMDQEEAIAAgBkkgBUEIahAEGwRAIAAgAiAFQQhqIAMQAkECdGoiBC8BADsAACAFQQhqIAQtAAIQASAAIAQtAANqIgQgAiAFQQhqIAMQAkECdGoiAC8BADsAACAFQQhqIAAtAAIQASAEIAAtAANqIQAMAQUgB0F+aiEEA0AgBUEIahAEIAAgBEtyRQRAIAAgAiAFQQhqIAMQAkECdGoiBi8BADsAACAFQQhqIAYtAAIQASAAIAYtAANqIQAMAQsLA0AgACAES0UEQCAAIAIgBUEIaiADEAJBAnRqIgYvAQA7AAAgBUEIaiAGLQACEAEgACAGLQADaiEADAELCwJAIAAgB08NACAAIAIgBUEIaiADEAIiA0ECdGoiAC0AADoAACAALQADQQFGBEAgBUEIaiAALQACEAEMAQsgBSgCDEEfSw0AIAVBCGogAiADQQJ0ai0AAhABIAUoAgxBIUkNACAFQSA2AgwLIAFBbCAFQQhqEAobIQILCwsgBUEgaiQAIAILkgIBBH8jAEFAaiIJJAAgCSADQTQQCyEDAkAgBEECSA0AIAMgBEECdGooAgAhCSADQTxqIAgQIyADQQE6AD8gAyACOgA+QQAhBCADKAI8IQoDQCAEIAlGDQEgACAEQQJ0aiAKNgEAIARBAWohBAwAAAsAC0EAIQkDQCAGIAlGRQRAIAMgBSAJQQF0aiIKLQABIgtBAnRqIgwoAgAhBCADQTxqIAotAABBCHQgCGpB//8DcRAjIANBAjoAPyADIAcgC2siCiACajoAPiAEQQEgASAKa3RqIQogAygCPCELA0AgACAEQQJ0aiALNgEAIARBAWoiBCAKSQ0ACyAMIAo2AgAgCUEBaiEJDAELCyADQUBrJAALowIBCX8jAEHQAGsiCSQAIAlBEGogBUE0EAsaIAcgBmshDyAHIAFrIRADQAJAIAMgCkcEQEEBIAEgByACIApBAXRqIgYtAAEiDGsiCGsiC3QhDSAGLQAAIQ4gCUEQaiAMQQJ0aiIMKAIAIQYgCyAPTwRAIAAgBkECdGogCyAIIAUgCEE0bGogCCAQaiIIQQEgCEEBShsiCCACIAQgCEECdGooAgAiCEEBdGogAyAIayAHIA4QYyAGIA1qIQgMAgsgCUEMaiAOECMgCUEBOgAPIAkgCDoADiAGIA1qIQggCSgCDCELA0AgBiAITw0CIAAgBkECdGogCzYBACAGQQFqIQYMAAALAAsgCUHQAGokAA8LIAwgCDYCACAKQQFqIQoMAAALAAs0ACAAIAMgBCAFEDYiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQNAVBuH8LCyMAIAA/AEEQdGtB//8DakEQdkAAQX9GBEBBAA8LQQAQAEEBCzsBAX8gAgRAA0AgACABIAJBgCAgAkGAIEkbIgMQCyEAIAFBgCBqIQEgAEGAIGohACACIANrIgINAAsLCwYAIAAQAwsLqBUJAEGICAsNAQAAAAEAAAACAAAAAgBBoAgLswYBAAAAAQAAAAIAAAACAAAAJgAAAIIAAAAhBQAASgAAAGcIAAAmAAAAwAEAAIAAAABJBQAASgAAAL4IAAApAAAALAIAAIAAAABJBQAASgAAAL4IAAAvAAAAygIAAIAAAACKBQAASgAAAIQJAAA1AAAAcwMAAIAAAACdBQAASgAAAKAJAAA9AAAAgQMAAIAAAADrBQAASwAAAD4KAABEAAAAngMAAIAAAABNBgAASwAAAKoKAABLAAAAswMAAIAAAADBBgAATQAAAB8NAABNAAAAUwQAAIAAAAAjCAAAUQAAAKYPAABUAAAAmQQAAIAAAABLCQAAVwAAALESAABYAAAA2gQAAIAAAABvCQAAXQAAACMUAABUAAAARQUAAIAAAABUCgAAagAAAIwUAABqAAAArwUAAIAAAAB2CQAAfAAAAE4QAAB8AAAA0gIAAIAAAABjBwAAkQAAAJAHAACSAAAAAAAAAAEAAAABAAAABQAAAA0AAAAdAAAAPQAAAH0AAAD9AAAA/QEAAP0DAAD9BwAA/Q8AAP0fAAD9PwAA/X8AAP3/AAD9/wEA/f8DAP3/BwD9/w8A/f8fAP3/PwD9/38A/f//AP3//wH9//8D/f//B/3//w/9//8f/f//P/3//38AAAAAAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABEAAAASAAAAEwAAABQAAAAVAAAAFgAAABcAAAAYAAAAGQAAABoAAAAbAAAAHAAAAB0AAAAeAAAAHwAAAAMAAAAEAAAABQAAAAYAAAAHAAAACAAAAAkAAAAKAAAACwAAAAwAAAANAAAADgAAAA8AAAAQAAAAEQAAABIAAAATAAAAFAAAABUAAAAWAAAAFwAAABgAAAAZAAAAGgAAABsAAAAcAAAAHQAAAB4AAAAfAAAAIAAAACEAAAAiAAAAIwAAACUAAAAnAAAAKQAAACsAAAAvAAAAMwAAADsAAABDAAAAUwAAAGMAAACDAAAAAwEAAAMCAAADBAAAAwgAAAMQAAADIAAAA0AAAAOAAAADAAEAQeAPC1EBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAEAAAABQAAAAcAAAAIAAAACQAAAAoAAAALAAAADAAAAA0AAAAOAAAADwAAABAAQcQQC4sBAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABIAAAAUAAAAFgAAABgAAAAcAAAAIAAAACgAAAAwAAAAQAAAAIAAAAAAAQAAAAIAAAAEAAAACAAAABAAAAAgAAAAQAAAAIAAAAAAAQBBkBIL5gQBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAAAEAAAAEAAAACAAAAAAAAAABAAEBBgAAAAAAAAQAAAAAEAAABAAAAAAgAAAFAQAAAAAAAAUDAAAAAAAABQQAAAAAAAAFBgAAAAAAAAUHAAAAAAAABQkAAAAAAAAFCgAAAAAAAAUMAAAAAAAABg4AAAAAAAEFEAAAAAAAAQUUAAAAAAABBRYAAAAAAAIFHAAAAAAAAwUgAAAAAAAEBTAAAAAgAAYFQAAAAAAABwWAAAAAAAAIBgABAAAAAAoGAAQAAAAADAYAEAAAIAAABAAAAAAAAAAEAQAAAAAAAAUCAAAAIAAABQQAAAAAAAAFBQAAACAAAAUHAAAAAAAABQgAAAAgAAAFCgAAAAAAAAULAAAAAAAABg0AAAAgAAEFEAAAAAAAAQUSAAAAIAABBRYAAAAAAAIFGAAAACAAAwUgAAAAAAADBSgAAAAAAAYEQAAAABAABgRAAAAAIAAHBYAAAAAAAAkGAAIAAAAACwYACAAAMAAABAAAAAAQAAAEAQAAACAAAAUCAAAAIAAABQMAAAAgAAAFBQAAACAAAAUGAAAAIAAABQgAAAAgAAAFCQAAACAAAAULAAAAIAAABQwAAAAAAAAGDwAAACAAAQUSAAAAIAABBRQAAAAgAAIFGAAAACAAAgUcAAAAIAADBSgAAAAgAAQFMAAAAAAAEAYAAAEAAAAPBgCAAAAAAA4GAEAAAAAADQYAIABBgBcLhwIBAAEBBQAAAAAAAAUAAAAAAAAGBD0AAAAAAAkF/QEAAAAADwX9fwAAAAAVBf3/HwAAAAMFBQAAAAAABwR9AAAAAAAMBf0PAAAAABIF/f8DAAAAFwX9/38AAAAFBR0AAAAAAAgE/QAAAAAADgX9PwAAAAAUBf3/DwAAAAIFAQAAABAABwR9AAAAAAALBf0HAAAAABEF/f8BAAAAFgX9/z8AAAAEBQ0AAAAQAAgE/QAAAAAADQX9HwAAAAATBf3/BwAAAAEFAQAAABAABgQ9AAAAAAAKBf0DAAAAABAF/f8AAAAAHAX9//8PAAAbBf3//wcAABoF/f//AwAAGQX9//8BAAAYBf3//wBBkBkLhgQBAAEBBgAAAAAAAAYDAAAAAAAABAQAAAAgAAAFBQAAAAAAAAUGAAAAAAAABQgAAAAAAAAFCQAAAAAAAAULAAAAAAAABg0AAAAAAAAGEAAAAAAAAAYTAAAAAAAABhYAAAAAAAAGGQAAAAAAAAYcAAAAAAAABh8AAAAAAAAGIgAAAAAAAQYlAAAAAAABBikAAAAAAAIGLwAAAAAAAwY7AAAAAAAEBlMAAAAAAAcGgwAAAAAACQYDAgAAEAAABAQAAAAAAAAEBQAAACAAAAUGAAAAAAAABQcAAAAgAAAFCQAAAAAAAAUKAAAAAAAABgwAAAAAAAAGDwAAAAAAAAYSAAAAAAAABhUAAAAAAAAGGAAAAAAAAAYbAAAAAAAABh4AAAAAAAAGIQAAAAAAAQYjAAAAAAABBicAAAAAAAIGKwAAAAAAAwYzAAAAAAAEBkMAAAAAAAUGYwAAAAAACAYDAQAAIAAABAQAAAAwAAAEBAAAABAAAAQFAAAAIAAABQcAAAAgAAAFCAAAACAAAAUKAAAAIAAABQsAAAAAAAAGDgAAAAAAAAYRAAAAAAAABhQAAAAAAAAGFwAAAAAAAAYaAAAAAAAABh0AAAAAAAAGIAAAAAAAEAYDAAEAAAAPBgOAAAAAAA4GA0AAAAAADQYDIAAAAAAMBgMQAAAAAAsGAwgAAAAACgYDBABBpB0L2QEBAAAAAwAAAAcAAAAPAAAAHwAAAD8AAAB/AAAA/wAAAP8BAAD/AwAA/wcAAP8PAAD/HwAA/z8AAP9/AAD//wAA//8BAP//AwD//wcA//8PAP//HwD//z8A//9/AP///wD///8B////A////wf///8P////H////z////9/AAAAAAEAAAACAAAABAAAAAAAAAACAAAABAAAAAgAAAAAAAAAAQAAAAIAAAABAAAABAAAAAQAAAAEAAAABAAAAAgAAAAIAAAACAAAAAcAAAAIAAAACQAAAAoAAAALAEGgIAsDwBBQ";class nhe extends gp{constructor(e,t,n){super(void 0,e[0].width,e[0].height,t,n,_u),this.isCompressedCubeTexture=!0,this.isCubeTexture=!0,this.image=e}}class ihe extends gp{constructor(e,t,n,r,s,o){super(e,t,n,s,o),this.isCompressedArrayTexture=!0,this.image.depth=r,this.wrapR=Wi}}var rhe=Object.defineProperty,she=(i,e,t)=>e in i?rhe(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,FE=(i,e,t)=>(she(i,typeof e!="symbol"?e+"":e,t),t);const zH=3e3,GH=3001,W9="",ohe="display-p3",ahe="display-p3-linear",lhe="srgb-linear",LR="srgb",sb=new WeakMap;let ob=0,ab;const BR=(()=>{const i=class extends os{constructor(t){super(t),this.transcoderPath="",this.transcoderBinary=null,this.transcoderPending=null,this.workerPool=new Que,this.workerSourceURL="",this.workerConfig=null,typeof MSC_TRANSCODER<"u"&&console.warn('THREE.KTX2Loader: Please update to latest "basis_transcoder". "msc_basis_transcoder" is no longer supported in three.js r125+.')}setTranscoderPath(t){return this.transcoderPath=t,this}setWorkerLimit(t){return this.workerPool.setWorkerLimit(t),this}detectSupport(t){return this.workerConfig={astcSupported:t.extensions.has("WEBGL_compressed_texture_astc"),etc1Supported:t.extensions.has("WEBGL_compressed_texture_etc1"),etc2Supported:t.extensions.has("WEBGL_compressed_texture_etc"),dxtSupported:t.extensions.has("WEBGL_compressed_texture_s3tc"),bptcSupported:t.extensions.has("EXT_texture_compression_bptc"),pvrtcSupported:t.extensions.has("WEBGL_compressed_texture_pvrtc")||t.extensions.has("WEBKIT_WEBGL_compressed_texture_pvrtc")},t.capabilities.isWebGL2&&(this.workerConfig.etc1Supported=!1),this}init(){if(!this.transcoderPending){const t=new Yr(this.manager);t.setPath(this.transcoderPath),t.setWithCredentials(this.withCredentials);const n=t.loadAsync("basis_transcoder.js"),r=new Yr(this.manager);r.setPath(this.transcoderPath),r.setResponseType("arraybuffer"),r.setWithCredentials(this.withCredentials);const s=r.loadAsync("basis_transcoder.wasm");this.transcoderPending=Promise.all([n,s]).then(([o,a])=>{const l=i.BasisWorker.toString(),c=["/* constants */","let _EngineFormat = "+JSON.stringify(i.EngineFormat),"let _TranscoderFormat = "+JSON.stringify(i.TranscoderFormat),"let _BasisFormat = "+JSON.stringify(i.BasisFormat),"/* basis_transcoder.js */",o,"/* worker */",l.substring(l.indexOf("{")+1,l.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([c])),this.transcoderBinary=a,this.workerPool.setWorkerCreator(()=>{const u=new Worker(this.workerSourceURL),h=this.transcoderBinary.slice(0);return u.postMessage({type:"init",config:this.workerConfig,transcoderBinary:h},[h]),u})}),ob>0&&console.warn("THREE.KTX2Loader: Multiple active KTX2 loaders may cause performance issues. Use a single KTX2Loader instance, or call .dispose() on old instances."),ob++}return this.transcoderPending}load(t,n,r,s){if(this.workerConfig===null)throw new Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");const o=new Yr(this.manager);o.setResponseType("arraybuffer"),o.setWithCredentials(this.withCredentials),o.load(t,a=>{if(sb.has(a))return sb.get(a).promise.then(n).catch(s);this._createTexture(a).then(l=>n?n(l):null).catch(s)},r,s)}_createTextureFrom(t,n){const{faces:r,width:s,height:o,format:a,type:l,error:c,dfdFlags:u}=t;if(l==="error")return Promise.reject(c);let h;if(n.faceCount===6)h=new nhe(r,a,Zi);else{const d=r[0].mipmaps;h=n.layerCount>1?new ihe(d,s,o,n.layerCount,a,Zi):new gp(d,s,o,a,Zi)}h.minFilter=r[0].mipmaps.length===1?Ln:Bl,h.magFilter=Ln,h.generateMipmaps=!1,h.needsUpdate=!0;const f=HH(n);return"colorSpace"in h?h.colorSpace=f:h.encoding=f===LR?GH:zH,h.premultiplyAlpha=!!(u&$ue),h}async _createTexture(t,n={}){const r=ehe(new Uint8Array(t));if(r.vkFormat!==CH)return uhe(r);const s=n,o=this.init().then(()=>this.workerPool.postMessage({type:"transcode",buffer:t,taskConfig:s},[t])).then(a=>this._createTextureFrom(a.data,r));return sb.set(t,{promise:o}),o}dispose(){return this.workerPool.dispose(),this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),ob--,this}};let e=i;return FE(e,"BasisFormat",{ETC1S:0,UASTC_4x4:1}),FE(e,"TranscoderFormat",{ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16}),FE(e,"EngineFormat",{RGBAFormat:gi,RGBA_ASTC_4x4_Format:TS,RGBA_BPTC_Format:Xv,RGBA_ETC2_EAC_Format:CS,RGBA_PVRTC_4BPPV1_Format:SS,RGBA_S3TC_DXT5_Format:$v,RGB_ETC1_Format:_w,RGB_ETC2_Format:wS,RGB_PVRTC_4BPPV1_Format:_S,RGB_S3TC_DXT1_Format:Yv}),FE(e,"BasisWorker",function(){let t,n,r;const s=_EngineFormat,o=_TranscoderFormat,a=_BasisFormat;self.addEventListener("message",function(g){const A=g.data;switch(A.type){case"init":t=A.config,l(A.transcoderBinary);break;case"transcode":n.then(()=>{try{const{faces:E,buffers:x,width:w,height:T,hasAlpha:I,format:M,dfdFlags:L}=c(A.buffer);self.postMessage({type:"transcode",id:A.id,faces:E,width:w,height:T,hasAlpha:I,format:M,dfdFlags:L},x)}catch(E){console.error(E),self.postMessage({type:"error",id:A.id,error:E.message})}});break}});function l(g){n=new Promise(A=>{r={wasmBinary:g,onRuntimeInitialized:A},BASIS(r)}).then(()=>{r.initializeBasis(),r.KTX2File===void 0&&console.warn("THREE.KTX2Loader: Please update Basis Universal transcoder.")})}function c(g){const A=new r.KTX2File(new Uint8Array(g));function E(){A.close(),A.delete()}if(!A.isValid())throw E(),new Error("THREE.KTX2Loader:	Invalid or unsupported .ktx2 file");const x=A.isUASTC()?a.UASTC_4x4:a.ETC1S,w=A.getWidth(),T=A.getHeight(),I=A.getLayers()||1,M=A.getLevels(),L=A.getFaces(),P=A.getHasAlpha(),R=A.getDFDFlags(),{transcoderFormat:U,engineFormat:k}=d(x,w,T,P);if(!w||!T||!M)throw E(),new Error("THREE.KTX2Loader:	Invalid texture");if(!A.startTranscoding())throw E(),new Error("THREE.KTX2Loader: .startTranscoding failed");const H=[],G=[];for(let X=0;X<L;X++){const Z=[];for(let oe=0;oe<M;oe++){const K=[];let V,W;for(let Y=0;Y<I;Y++){const te=A.getImageLevelInfo(oe,Y,X);X===0&&oe===0&&Y===0&&(te.origWidth%4!==0||te.origHeight%4!==0)&&console.warn("THREE.KTX2Loader: ETC1S and UASTC textures should use multiple-of-four dimensions."),M>1?(V=te.origWidth,W=te.origHeight):(V=te.width,W=te.height);const q=new Uint8Array(A.getImageTranscodedSizeInBytes(oe,Y,0,U));if(!A.transcodeImage(q,oe,Y,X,U,0,-1,-1))throw E(),new Error("THREE.KTX2Loader: .transcodeImage failed.");K.push(q)}const F=y(K);Z.push({data:F,width:V,height:W}),G.push(F.buffer)}H.push({mipmaps:Z,width:w,height:T,format:k})}return E(),{faces:H,buffers:G,width:w,height:T,hasAlpha:P,format:k,dfdFlags:R}}const u=[{if:"astcSupported",basisFormat:[a.UASTC_4x4],transcoderFormat:[o.ASTC_4x4,o.ASTC_4x4],engineFormat:[s.RGBA_ASTC_4x4_Format,s.RGBA_ASTC_4x4_Format],priorityETC1S:1/0,priorityUASTC:1,needsPowerOfTwo:!1},{if:"bptcSupported",basisFormat:[a.ETC1S,a.UASTC_4x4],transcoderFormat:[o.BC7_M5,o.BC7_M5],engineFormat:[s.RGBA_BPTC_Format,s.RGBA_BPTC_Format],priorityETC1S:3,priorityUASTC:2,needsPowerOfTwo:!1},{if:"dxtSupported",basisFormat:[a.ETC1S,a.UASTC_4x4],transcoderFormat:[o.BC1,o.BC3],engineFormat:[s.RGB_S3TC_DXT1_Format,s.RGBA_S3TC_DXT5_Format],priorityETC1S:4,priorityUASTC:5,needsPowerOfTwo:!1},{if:"etc2Supported",basisFormat:[a.ETC1S,a.UASTC_4x4],transcoderFormat:[o.ETC1,o.ETC2],engineFormat:[s.RGB_ETC2_Format,s.RGBA_ETC2_EAC_Format],priorityETC1S:1,priorityUASTC:3,needsPowerOfTwo:!1},{if:"etc1Supported",basisFormat:[a.ETC1S,a.UASTC_4x4],transcoderFormat:[o.ETC1],engineFormat:[s.RGB_ETC1_Format],priorityETC1S:2,priorityUASTC:4,needsPowerOfTwo:!1},{if:"pvrtcSupported",basisFormat:[a.ETC1S,a.UASTC_4x4],transcoderFormat:[o.PVRTC1_4_RGB,o.PVRTC1_4_RGBA],engineFormat:[s.RGB_PVRTC_4BPPV1_Format,s.RGBA_PVRTC_4BPPV1_Format],priorityETC1S:5,priorityUASTC:6,needsPowerOfTwo:!0}],h=u.sort(function(g,A){return g.priorityETC1S-A.priorityETC1S}),f=u.sort(function(g,A){return g.priorityUASTC-A.priorityUASTC});function d(g,A,E,x){let w,T;const I=g===a.ETC1S?h:f;for(let M=0;M<I.length;M++){const L=I[M];if(t[L.if]&&L.basisFormat.includes(g)&&!(x&&L.transcoderFormat.length<2)&&!(L.needsPowerOfTwo&&!(m(A)&&m(E))))return w=L.transcoderFormat[x?1:0],T=L.engineFormat[x?1:0],{transcoderFormat:w,engineFormat:T}}return console.warn("THREE.KTX2Loader: No suitable compressed texture format found. Decoding to RGBA32."),w=o.RGBA32,T=s.RGBAFormat,{transcoderFormat:w,engineFormat:T}}function m(g){return g<=2?!0:(g&g-1)===0&&g!==0}function y(g){if(g.length===1)return g[0];let A=0;for(let w=0;w<g.length;w++){const T=g[w];A+=T.byteLength}const E=new Uint8Array(A);let x=0;for(let w=0;w<g.length;w++){const T=g[w];E.set(T,x),x+=T.byteLength}return E}}),e})(),che=new Set([gi,Gd,hc]),lb={[OH]:gi,[DH]:gi,[RH]:gi,[PH]:gi,[FH]:Gd,[BH]:Gd,[IH]:Gd,[MH]:Gd,[kH]:hc,[LH]:hc,[bH]:hc,[TH]:hc,[UH]:C2,[NH]:C2},cb={[OH]:fi,[DH]:Ni,[RH]:Zi,[PH]:Zi,[FH]:fi,[BH]:Ni,[IH]:Zi,[MH]:Zi,[kH]:fi,[LH]:Ni,[bH]:Zi,[TH]:Zi,[UH]:Zi,[NH]:Zi};async function uhe(i){const{vkFormat:e}=i;if(lb[e]===void 0)throw new Error("THREE.KTX2Loader: Unsupported vkFormat.");let t;i.supercompressionScheme===Q9&&(ab||(ab=new Promise(async o=>{const a=new the;await a.init(),o(a)})),t=await ab);const n=[];for(let o=0;o<i.levels.length;o++){const a=Math.max(1,i.pixelWidth>>o),l=Math.max(1,i.pixelHeight>>o),c=i.pixelDepth?Math.max(1,i.pixelDepth>>o):0,u=i.levels[o];let h;if(i.supercompressionScheme===SH)h=u.levelData;else if(i.supercompressionScheme===Q9)h=t.decode(u.levelData,u.uncompressedByteLength);else throw new Error("THREE.KTX2Loader: Unsupported supercompressionScheme.");let f;cb[e]===fi?f=new Float32Array(h.buffer,h.byteOffset,h.byteLength/Float32Array.BYTES_PER_ELEMENT):cb[e]===Ni?f=new Uint16Array(h.buffer,h.byteOffset,h.byteLength/Uint16Array.BYTES_PER_ELEMENT):f=h,n.push({data:f,width:a,height:l,depth:c})}let r;if(che.has(lb[e]))r=i.pixelDepth===0?new Sa(n[0].data,i.pixelWidth,i.pixelHeight):new Hue(n[0].data,i.pixelWidth,i.pixelHeight,i.pixelDepth);else{if(i.pixelDepth>0)throw new Error("THREE.KTX2Loader: Unsupported pixelDepth.");r=new gp(n,i.pixelWidth,i.pixelHeight)}r.mipmaps=n,r.type=cb[e],r.format=lb[e],r.needsUpdate=!0;const s=HH(i);return"colorSpace"in r?r.colorSpace=s:r.encoding=s===LR?GH:zH,Promise.resolve(r)}function HH(i){const e=i.dataFormatDescriptor[0];return e.colorPrimaries===wH?e.transferFunction===c5?LR:lhe:e.colorPrimaries===que?e.transferFunction===c5?ohe:ahe:(e.colorPrimaries===Xue||console.warn(`THREE.KTX2Loader: Unsupported color primaries, "${e.colorPrimaries}"`),W9)}class hhe extends $6{constructor(e){super(e),this.type=Ni}parse(e){const o=function(L,P){switch(L){case 1:throw new Error("THREE.RGBELoader: Read Error: "+(P||""));case 2:throw new Error("THREE.RGBELoader: Write Error: "+(P||""));case 3:throw new Error("THREE.RGBELoader: Bad File Format: "+(P||""));default:case 4:throw new Error("THREE.RGBELoader: Memory Error: "+(P||""))}},h=function(L,P,R){P=P||1024;let k=L.pos,H=-1,G=0,X="",Z=String.fromCharCode.apply(null,new Uint16Array(L.subarray(k,k+128)));for(;0>(H=Z.indexOf(`
`))&&G<P&&k<L.byteLength;)X+=Z,G+=Z.length,k+=128,Z+=String.fromCharCode.apply(null,new Uint16Array(L.subarray(k,k+128)));return-1<H?(L.pos+=G+H+1,X+Z.slice(0,H)):!1},f=function(L){const P=/^#\?(\S+)/,R=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,U=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,k=/^\s*FORMAT=(\S+)\s*$/,H=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,G={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let X,Z;for((L.pos>=L.byteLength||!(X=h(L)))&&o(1,"no header found"),(Z=X.match(P))||o(3,"bad initial token"),G.valid|=1,G.programtype=Z[1],G.string+=X+`
`;X=h(L),X!==!1;){if(G.string+=X+`
`,X.charAt(0)==="#"){G.comments+=X+`
`;continue}if((Z=X.match(R))&&(G.gamma=parseFloat(Z[1])),(Z=X.match(U))&&(G.exposure=parseFloat(Z[1])),(Z=X.match(k))&&(G.valid|=2,G.format=Z[1]),(Z=X.match(H))&&(G.valid|=4,G.height=parseInt(Z[1],10),G.width=parseInt(Z[2],10)),G.valid&2&&G.valid&4)break}return G.valid&2||o(3,"missing format specifier"),G.valid&4||o(3,"missing image size specifier"),G},d=function(L,P,R){const U=P;if(U<8||U>32767||L[0]!==2||L[1]!==2||L[2]&128)return new Uint8Array(L);U!==(L[2]<<8|L[3])&&o(3,"wrong scanline width");const k=new Uint8Array(4*P*R);k.length||o(4,"unable to allocate buffer space");let H=0,G=0;const X=4*U,Z=new Uint8Array(4),oe=new Uint8Array(X);let K=R;for(;K>0&&G<L.byteLength;){G+4>L.byteLength&&o(1),Z[0]=L[G++],Z[1]=L[G++],Z[2]=L[G++],Z[3]=L[G++],(Z[0]!=2||Z[1]!=2||(Z[2]<<8|Z[3])!=U)&&o(3,"bad rgbe scanline format");let V=0,W;for(;V<X&&G<L.byteLength;){W=L[G++];const Y=W>128;if(Y&&(W-=128),(W===0||V+W>X)&&o(3,"bad scanline data"),Y){const te=L[G++];for(let q=0;q<W;q++)oe[V++]=te}else oe.set(L.subarray(G,G+W),V),V+=W,G+=W}const F=U;for(let Y=0;Y<F;Y++){let te=0;k[H]=oe[Y+te],te+=U,k[H+1]=oe[Y+te],te+=U,k[H+2]=oe[Y+te],te+=U,k[H+3]=oe[Y+te],H+=4}K--}return k},m=function(L,P,R,U){const k=L[P+3],H=Math.pow(2,k-128)/255;R[U+0]=L[P+0]*H,R[U+1]=L[P+1]*H,R[U+2]=L[P+2]*H,R[U+3]=1},y=function(L,P,R,U){const k=L[P+3],H=Math.pow(2,k-128)/255;R[U+0]=Lm.toHalfFloat(Math.min(L[P+0]*H,65504)),R[U+1]=Lm.toHalfFloat(Math.min(L[P+1]*H,65504)),R[U+2]=Lm.toHalfFloat(Math.min(L[P+2]*H,65504)),R[U+3]=Lm.toHalfFloat(1)},g=new Uint8Array(e);g.pos=0;const A=f(g),E=A.width,x=A.height,w=d(g.subarray(g.pos),E,x);let T,I,M;switch(this.type){case fi:M=w.length/4;const L=new Float32Array(M*4);for(let R=0;R<M;R++)m(w,R*4,L,R*4);T=L,I=fi;break;case Ni:M=w.length/4;const P=new Uint16Array(M*4);for(let R=0;R<M;R++)y(w,R*4,P,R*4);T=P,I=Ni;break;default:throw new Error("THREE.RGBELoader: Unsupported type: "+this.type)}return{width:E,height:x,data:T,header:A.string,gamma:A.gamma,exposure:A.exposure,type:I}}setDataType(e){return this.type=e,this}load(e,t,n,r){function s(o,a){switch(o.type){case fi:case Ni:"colorSpace"in o?o.colorSpace="srgb-linear":o.encoding=3e3,o.minFilter=Ln,o.magFilter=Ln,o.generateMipmaps=!1,o.flipY=!0;break}t&&t(o,a)}return super.load(e,s,n,r)}}const hv=RA>=152;class fhe extends $6{constructor(e){super(e),this.type=Ni}parse(e){const P=Math.pow(2.7182818,2.2);function R(he,me){for(var De=0,ce=0;ce<65536;++ce)(ce==0||he[ce>>3]&1<<(ce&7))&&(me[De++]=ce);for(var ye=De-1;De<65536;)me[De++]=0;return ye}function U(he){for(var me=0;me<16384;me++)he[me]={},he[me].len=0,he[me].lit=0,he[me].p=null}const k={l:0,c:0,lc:0};function H(he,me,De,ce,ye){for(;De<he;)me=me<<8|ft(ce,ye),De+=8;De-=he,k.l=me>>De&(1<<he)-1,k.c=me,k.lc=De}const G=new Array(59);function X(he){for(var me=0;me<=58;++me)G[me]=0;for(var me=0;me<65537;++me)G[he[me]]+=1;for(var De=0,me=58;me>0;--me){var ce=De+G[me]>>1;G[me]=De,De=ce}for(var me=0;me<65537;++me){var ye=he[me];ye>0&&(he[me]=ye|G[ye]++<<6)}}function Z(he,me,De,ce,ye,Ee,Pe){for(var Ie=De,Je=0,st=0;ye<=Ee;ye++){if(Ie.value-De.value>ce)return!1;H(6,Je,st,he,Ie);var lt=k.l;if(Je=k.c,st=k.lc,Pe[ye]=lt,lt==63){if(Ie.value-De.value>ce)throw"Something wrong with hufUnpackEncTable";H(8,Je,st,he,Ie);var Oe=k.l+6;if(Je=k.c,st=k.lc,ye+Oe>Ee+1)throw"Something wrong with hufUnpackEncTable";for(;Oe--;)Pe[ye++]=0;ye--}else if(lt>=59){var Oe=lt-59+2;if(ye+Oe>Ee+1)throw"Something wrong with hufUnpackEncTable";for(;Oe--;)Pe[ye++]=0;ye--}}X(Pe)}function oe(he){return he&63}function K(he){return he>>6}function V(he,me,De,ce){for(;me<=De;me++){var ye=K(he[me]),Ee=oe(he[me]);if(ye>>Ee)throw"Invalid table entry";if(Ee>14){var Pe=ce[ye>>Ee-14];if(Pe.len)throw"Invalid table entry";if(Pe.lit++,Pe.p){var Ie=Pe.p;Pe.p=new Array(Pe.lit);for(var Je=0;Je<Pe.lit-1;++Je)Pe.p[Je]=Ie[Je]}else Pe.p=new Array(1);Pe.p[Pe.lit-1]=me}else if(Ee)for(var st=0,Je=1<<14-Ee;Je>0;Je--){var Pe=ce[(ye<<14-Ee)+st];if(Pe.len||Pe.p)throw"Invalid table entry";Pe.len=Ee,Pe.lit=me,st++}}return!0}const W={c:0,lc:0};function F(he,me,De,ce){he=he<<8|ft(De,ce),me+=8,W.c=he,W.lc=me}const Y={c:0,lc:0};function te(he,me,De,ce,ye,Ee,Pe,Ie,Je,st){if(he==me){ce<8&&(F(De,ce,ye,Pe),De=W.c,ce=W.lc),ce-=8;var lt=De>>ce,lt=new Uint8Array([lt])[0];if(Je.value+lt>st)return!1;for(var Oe=Ie[Je.value-1];lt-- >0;)Ie[Je.value++]=Oe}else if(Je.value<st)Ie[Je.value++]=he;else return!1;Y.c=De,Y.lc=ce}function q(he){return he&65535}function J(he){var me=q(he);return me>32767?me-65536:me}const re={a:0,b:0};function ie(he,me){var De=J(he),ce=J(me),ye=ce,Ee=De+(ye&1)+(ye>>1),Pe=Ee,Ie=Ee-ye;re.a=Pe,re.b=Ie}function se(he,me){var De=q(he),ce=q(me),ye=De-(ce>>1)&65535,Ee=ce+ye-32768&65535;re.a=Ee,re.b=ye}function ge(he,me,De,ce,ye,Ee,Pe){for(var Ie=Pe<16384,Je=De>ye?ye:De,st=1,lt;st<=Je;)st<<=1;for(st>>=1,lt=st,st>>=1;st>=1;){for(var Oe=0,Ht=Oe+Ee*(ye-lt),xt=Ee*st,Et=Ee*lt,Qt=ce*st,sn=ce*lt,ln,vn,Dt,Bt;Oe<=Ht;Oe+=Et){for(var yn=Oe,xn=Oe+ce*(De-lt);yn<=xn;yn+=sn){var Sn=yn+Qt,Ai=yn+xt,xi=Ai+Qt;Ie?(ie(he[yn+me],he[Ai+me]),ln=re.a,Dt=re.b,ie(he[Sn+me],he[xi+me]),vn=re.a,Bt=re.b,ie(ln,vn),he[yn+me]=re.a,he[Sn+me]=re.b,ie(Dt,Bt),he[Ai+me]=re.a,he[xi+me]=re.b):(se(he[yn+me],he[Ai+me]),ln=re.a,Dt=re.b,se(he[Sn+me],he[xi+me]),vn=re.a,Bt=re.b,se(ln,vn),he[yn+me]=re.a,he[Sn+me]=re.b,se(Dt,Bt),he[Ai+me]=re.a,he[xi+me]=re.b)}if(De&st){var Ai=yn+xt;Ie?ie(he[yn+me],he[Ai+me]):se(he[yn+me],he[Ai+me]),ln=re.a,he[Ai+me]=re.b,he[yn+me]=ln}}if(ye&st)for(var yn=Oe,xn=Oe+ce*(De-lt);yn<=xn;yn+=sn){var Sn=yn+Qt;Ie?ie(he[yn+me],he[Sn+me]):se(he[yn+me],he[Sn+me]),ln=re.a,he[Sn+me]=re.b,he[yn+me]=ln}lt=st,st>>=1}return Oe}function xe(he,me,De,ce,ye,Ee,Pe,Ie,Je,st){for(var lt=0,Oe=0,Ht=Ie,xt=Math.trunc(ye.value+(Ee+7)/8);ye.value<xt;)for(F(lt,Oe,De,ye),lt=W.c,Oe=W.lc;Oe>=14;){var Et=lt>>Oe-14&16383,Qt=me[Et];if(Qt.len)Oe-=Qt.len,te(Qt.lit,Pe,lt,Oe,De,ce,ye,Je,st,Ht),lt=Y.c,Oe=Y.lc;else{if(!Qt.p)throw"hufDecode issues";var sn;for(sn=0;sn<Qt.lit;sn++){for(var ln=oe(he[Qt.p[sn]]);Oe<ln&&ye.value<xt;)F(lt,Oe,De,ye),lt=W.c,Oe=W.lc;if(Oe>=ln&&K(he[Qt.p[sn]])==(lt>>Oe-ln&(1<<ln)-1)){Oe-=ln,te(Qt.p[sn],Pe,lt,Oe,De,ce,ye,Je,st,Ht),lt=Y.c,Oe=Y.lc;break}}if(sn==Qt.lit)throw"hufDecode issues"}}var vn=8-Ee&7;for(lt>>=vn,Oe-=vn;Oe>0;){var Qt=me[lt<<14-Oe&16383];if(Qt.len)Oe-=Qt.len,te(Qt.lit,Pe,lt,Oe,De,ce,ye,Je,st,Ht),lt=Y.c,Oe=Y.lc;else throw"hufDecode issues"}return!0}function pe(he,me,De,ce,ye,Ee){var Pe={value:0},Ie=De.value,Je=gt(me,De),st=gt(me,De);De.value+=4;var lt=gt(me,De);if(De.value+=4,Je<0||Je>=65537||st<0||st>=65537)throw"Something wrong with HUF_ENCSIZE";var Oe=new Array(65537),Ht=new Array(16384);U(Ht);var xt=ce-(De.value-Ie);if(Z(he,me,De,xt,Je,st,Oe),lt>8*(ce-(De.value-Ie)))throw"Something wrong with hufUncompress";V(Oe,Je,st,Ht),xe(Oe,Ht,he,me,De,lt,st,Ee,ye,Pe)}function ue(he,me,De){for(var ce=0;ce<De;++ce)me[ce]=he[me[ce]]}function Me(he){for(var me=1;me<he.length;me++){var De=he[me-1]+he[me]-128;he[me]=De}}function Se(he,me){for(var De=0,ce=Math.floor((he.length+1)/2),ye=0,Ee=he.length-1;!(ye>Ee||(me[ye++]=he[De++],ye>Ee));)me[ye++]=he[ce++]}function ve(he){for(var me=he.byteLength,De=new Array,ce=0,ye=new DataView(he);me>0;){var Ee=ye.getInt8(ce++);if(Ee<0){var Pe=-Ee;me-=Pe+1;for(var Ie=0;Ie<Pe;Ie++)De.push(ye.getUint8(ce++))}else{var Pe=Ee;me-=2;for(var Je=ye.getUint8(ce++),Ie=0;Ie<Pe+1;Ie++)De.push(Je)}}return De}function Ae(he,me,De,ce,ye,Ee){var Sn=new DataView(Ee.buffer),Pe=De[he.idx[0]].width,Ie=De[he.idx[0]].height,Je=3,st=Math.floor(Pe/8),lt=Math.ceil(Pe/8),Oe=Math.ceil(Ie/8),Ht=Pe-(lt-1)*8,xt=Ie-(Oe-1)*8,Et={value:0},Qt=new Array(Je),sn=new Array(Je),ln=new Array(Je),vn=new Array(Je),Dt=new Array(Je);for(let kn=0;kn<Je;++kn)Dt[kn]=me[he.idx[kn]],Qt[kn]=kn<1?0:Qt[kn-1]+lt*Oe,sn[kn]=new Float32Array(64),ln[kn]=new Uint16Array(64),vn[kn]=new Uint16Array(lt*64);for(let kn=0;kn<Oe;++kn){var Bt=8;kn==Oe-1&&(Bt=xt);var yn=8;for(let Bn=0;Bn<lt;++Bn){Bn==lt-1&&(yn=Ht);for(let Pn=0;Pn<Je;++Pn)ln[Pn].fill(0),ln[Pn][0]=ye[Qt[Pn]++],ke(Et,ce,ln[Pn]),be(ln[Pn],sn[Pn]),ne(sn[Pn]);j(sn);for(let Pn=0;Pn<Je;++Pn)de(sn[Pn],vn[Pn],Bn*64)}let zi=0;for(let Bn=0;Bn<Je;++Bn){const Pn=De[he.idx[Bn]].type;for(let Ri=8*kn;Ri<8*kn+Bt;++Ri){zi=Dt[Bn][Ri];for(let ls=0;ls<st;++ls){const nr=ls*64+(Ri&7)*8;Sn.setUint16(zi+0*Pn,vn[Bn][nr+0],!0),Sn.setUint16(zi+2*Pn,vn[Bn][nr+1],!0),Sn.setUint16(zi+4*Pn,vn[Bn][nr+2],!0),Sn.setUint16(zi+6*Pn,vn[Bn][nr+3],!0),Sn.setUint16(zi+8*Pn,vn[Bn][nr+4],!0),Sn.setUint16(zi+10*Pn,vn[Bn][nr+5],!0),Sn.setUint16(zi+12*Pn,vn[Bn][nr+6],!0),Sn.setUint16(zi+14*Pn,vn[Bn][nr+7],!0),zi+=16*Pn}}if(st!=lt)for(let Ri=8*kn;Ri<8*kn+Bt;++Ri){const ls=Dt[Bn][Ri]+8*st*2*Pn,nr=st*64+(Ri&7)*8;for(let ta=0;ta<yn;++ta)Sn.setUint16(ls+ta*2*Pn,vn[Bn][nr+ta],!0)}}}for(var xn=new Uint16Array(Pe),Sn=new DataView(Ee.buffer),Ai=0;Ai<Je;++Ai){De[he.idx[Ai]].decoded=!0;var xi=De[he.idx[Ai]].type;if(De[Ai].type==2)for(var Ei=0;Ei<Ie;++Ei){const kn=Dt[Ai][Ei];for(var Dn=0;Dn<Pe;++Dn)xn[Dn]=Sn.getUint16(kn+Dn*2*xi,!0);for(var Dn=0;Dn<Pe;++Dn)Sn.setFloat32(kn+Dn*2*xi,Be(xn[Dn]),!0)}}}function ke(he,me,De){for(var ce,ye=1;ye<64;)ce=me[he.value],ce==65280?ye=64:ce>>8==255?ye+=ce&255:(De[ye]=ce,ye++),he.value++}function be(he,me){me[0]=Be(he[0]),me[1]=Be(he[1]),me[2]=Be(he[5]),me[3]=Be(he[6]),me[4]=Be(he[14]),me[5]=Be(he[15]),me[6]=Be(he[27]),me[7]=Be(he[28]),me[8]=Be(he[2]),me[9]=Be(he[4]),me[10]=Be(he[7]),me[11]=Be(he[13]),me[12]=Be(he[16]),me[13]=Be(he[26]),me[14]=Be(he[29]),me[15]=Be(he[42]),me[16]=Be(he[3]),me[17]=Be(he[8]),me[18]=Be(he[12]),me[19]=Be(he[17]),me[20]=Be(he[25]),me[21]=Be(he[30]),me[22]=Be(he[41]),me[23]=Be(he[43]),me[24]=Be(he[9]),me[25]=Be(he[11]),me[26]=Be(he[18]),me[27]=Be(he[24]),me[28]=Be(he[31]),me[29]=Be(he[40]),me[30]=Be(he[44]),me[31]=Be(he[53]),me[32]=Be(he[10]),me[33]=Be(he[19]),me[34]=Be(he[23]),me[35]=Be(he[32]),me[36]=Be(he[39]),me[37]=Be(he[45]),me[38]=Be(he[52]),me[39]=Be(he[54]),me[40]=Be(he[20]),me[41]=Be(he[22]),me[42]=Be(he[33]),me[43]=Be(he[38]),me[44]=Be(he[46]),me[45]=Be(he[51]),me[46]=Be(he[55]),me[47]=Be(he[60]),me[48]=Be(he[21]),me[49]=Be(he[34]),me[50]=Be(he[37]),me[51]=Be(he[47]),me[52]=Be(he[50]),me[53]=Be(he[56]),me[54]=Be(he[59]),me[55]=Be(he[61]),me[56]=Be(he[35]),me[57]=Be(he[36]),me[58]=Be(he[48]),me[59]=Be(he[49]),me[60]=Be(he[57]),me[61]=Be(he[58]),me[62]=Be(he[62]),me[63]=Be(he[63])}function ne(he){const me=.5*Math.cos(.7853975),De=.5*Math.cos(3.14159/16),ce=.5*Math.cos(3.14159/8),ye=.5*Math.cos(3*3.14159/16),Ee=.5*Math.cos(5*3.14159/16),Pe=.5*Math.cos(3*3.14159/8),Ie=.5*Math.cos(7*3.14159/16);for(var Je=new Array(4),st=new Array(4),lt=new Array(4),Oe=new Array(4),Ht=0;Ht<8;++Ht){var xt=Ht*8;Je[0]=ce*he[xt+2],Je[1]=Pe*he[xt+2],Je[2]=ce*he[xt+6],Je[3]=Pe*he[xt+6],st[0]=De*he[xt+1]+ye*he[xt+3]+Ee*he[xt+5]+Ie*he[xt+7],st[1]=ye*he[xt+1]-Ie*he[xt+3]-De*he[xt+5]-Ee*he[xt+7],st[2]=Ee*he[xt+1]-De*he[xt+3]+Ie*he[xt+5]+ye*he[xt+7],st[3]=Ie*he[xt+1]-Ee*he[xt+3]+ye*he[xt+5]-De*he[xt+7],lt[0]=me*(he[xt+0]+he[xt+4]),lt[3]=me*(he[xt+0]-he[xt+4]),lt[1]=Je[0]+Je[3],lt[2]=Je[1]-Je[2],Oe[0]=lt[0]+lt[1],Oe[1]=lt[3]+lt[2],Oe[2]=lt[3]-lt[2],Oe[3]=lt[0]-lt[1],he[xt+0]=Oe[0]+st[0],he[xt+1]=Oe[1]+st[1],he[xt+2]=Oe[2]+st[2],he[xt+3]=Oe[3]+st[3],he[xt+4]=Oe[3]-st[3],he[xt+5]=Oe[2]-st[2],he[xt+6]=Oe[1]-st[1],he[xt+7]=Oe[0]-st[0]}for(var Et=0;Et<8;++Et)Je[0]=ce*he[16+Et],Je[1]=Pe*he[16+Et],Je[2]=ce*he[48+Et],Je[3]=Pe*he[48+Et],st[0]=De*he[8+Et]+ye*he[24+Et]+Ee*he[40+Et]+Ie*he[56+Et],st[1]=ye*he[8+Et]-Ie*he[24+Et]-De*he[40+Et]-Ee*he[56+Et],st[2]=Ee*he[8+Et]-De*he[24+Et]+Ie*he[40+Et]+ye*he[56+Et],st[3]=Ie*he[8+Et]-Ee*he[24+Et]+ye*he[40+Et]-De*he[56+Et],lt[0]=me*(he[Et]+he[32+Et]),lt[3]=me*(he[Et]-he[32+Et]),lt[1]=Je[0]+Je[3],lt[2]=Je[1]-Je[2],Oe[0]=lt[0]+lt[1],Oe[1]=lt[3]+lt[2],Oe[2]=lt[3]-lt[2],Oe[3]=lt[0]-lt[1],he[0+Et]=Oe[0]+st[0],he[8+Et]=Oe[1]+st[1],he[16+Et]=Oe[2]+st[2],he[24+Et]=Oe[3]+st[3],he[32+Et]=Oe[3]-st[3],he[40+Et]=Oe[2]-st[2],he[48+Et]=Oe[1]-st[1],he[56+Et]=Oe[0]-st[0]}function j(he){for(var me=0;me<64;++me){var De=he[0][me],ce=he[1][me],ye=he[2][me];he[0][me]=De+1.5747*ye,he[1][me]=De-.1873*ce-.4682*ye,he[2][me]=De+1.8556*ce}}function de(he,me,De){for(var ce=0;ce<64;++ce)me[De+ce]=Lm.toHalfFloat(Re(he[ce]))}function Re(he){return he<=1?Math.sign(he)*Math.pow(Math.abs(he),2.2):Math.sign(he)*Math.pow(P,Math.abs(he)-1)}function Le(he){return new DataView(he.array.buffer,he.offset.value,he.size)}function Fe(he){var me=he.viewer.buffer.slice(he.offset.value,he.offset.value+he.size),De=new Uint8Array(ve(me)),ce=new Uint8Array(De.length);return Me(De),Se(De,ce),new DataView(ce.buffer)}function He(he){var me=he.array.slice(he.offset.value,he.offset.value+he.size),De=Uv(me),ce=new Uint8Array(De.length);return Me(De),Se(De,ce),new DataView(ce.buffer)}function it(he){for(var me=he.viewer,De={value:he.offset.value},ce=new Uint16Array(he.width*he.scanlineBlockSize*(he.channels*he.type)),ye=new Uint8Array(8192),Ee=0,Pe=new Array(he.channels),Ie=0;Ie<he.channels;Ie++)Pe[Ie]={},Pe[Ie].start=Ee,Pe[Ie].end=Pe[Ie].start,Pe[Ie].nx=he.width,Pe[Ie].ny=he.lines,Pe[Ie].size=he.type,Ee+=Pe[Ie].nx*Pe[Ie].ny*Pe[Ie].size;var Je=we(me,De),st=we(me,De);if(st>=8192)throw"Something is wrong with PIZ_COMPRESSION BITMAP_SIZE";if(Je<=st)for(var Ie=0;Ie<st-Je+1;Ie++)ye[Ie+Je]=Ce(me,De);var lt=new Uint16Array(65536),Oe=R(ye,lt),Ht=gt(me,De);pe(he.array,me,De,Ht,ce,Ee);for(var Ie=0;Ie<he.channels;++Ie)for(var xt=Pe[Ie],Et=0;Et<Pe[Ie].size;++Et)ge(ce,xt.start+Et,xt.nx,xt.size,xt.ny,xt.nx*xt.size,Oe);ue(lt,ce,Ee);for(var Qt=0,sn=new Uint8Array(ce.buffer.byteLength),ln=0;ln<he.lines;ln++)for(var vn=0;vn<he.channels;vn++){var xt=Pe[vn],Dt=xt.nx*xt.size,Bt=new Uint8Array(ce.buffer,xt.end*2,Dt*2);sn.set(Bt,Qt),Qt+=Dt*2,xt.end+=Dt}return new DataView(sn.buffer)}function Ye(he){var me=he.array.slice(he.offset.value,he.offset.value+he.size),De=Uv(me);const ce=he.lines*he.channels*he.width,ye=he.type==1?new Uint16Array(ce):new Uint32Array(ce);let Ee=0,Pe=0;const Ie=new Array(4);for(let Je=0;Je<he.lines;Je++)for(let st=0;st<he.channels;st++){let lt=0;switch(he.type){case 1:Ie[0]=Ee,Ie[1]=Ie[0]+he.width,Ee=Ie[1]+he.width;for(let Oe=0;Oe<he.width;++Oe){const Ht=De[Ie[0]++]<<8|De[Ie[1]++];lt+=Ht,ye[Pe]=lt,Pe++}break;case 2:Ie[0]=Ee,Ie[1]=Ie[0]+he.width,Ie[2]=Ie[1]+he.width,Ee=Ie[2]+he.width;for(let Oe=0;Oe<he.width;++Oe){const Ht=De[Ie[0]++]<<24|De[Ie[1]++]<<16|De[Ie[2]++]<<8;lt+=Ht,ye[Pe]=lt,Pe++}break}}return new DataView(ye.buffer)}function ct(he){var me=he.viewer,De={value:he.offset.value},ce=new Uint8Array(he.width*he.lines*(he.channels*he.type*2)),ye={version:qe(me,De),unknownUncompressedSize:qe(me,De),unknownCompressedSize:qe(me,De),acCompressedSize:qe(me,De),dcCompressedSize:qe(me,De),rleCompressedSize:qe(me,De),rleUncompressedSize:qe(me,De),rleRawSize:qe(me,De),totalAcUncompressedCount:qe(me,De),totalDcUncompressedCount:qe(me,De),acCompression:qe(me,De)};if(ye.version<2)throw"EXRLoader.parse: "+tr.compression+" version "+ye.version+" is unsupported";for(var Ee=new Array,Pe=we(me,De)-2;Pe>0;){var Ie=pt(me.buffer,De),Je=Ce(me,De),st=Je>>2&3,lt=(Je>>4)-1,Oe=new Int8Array([lt])[0],Ht=Ce(me,De);Ee.push({name:Ie,index:Oe,type:Ht,compression:st}),Pe-=Ie.length+3}for(var xt=tr.channels,Et=new Array(he.channels),Qt=0;Qt<he.channels;++Qt){var sn=Et[Qt]={},ln=xt[Qt];sn.name=ln.name,sn.compression=0,sn.decoded=!1,sn.type=ln.pixelType,sn.pLinear=ln.pLinear,sn.width=he.width,sn.height=he.lines}for(var vn={idx:new Array(3)},Dt=0;Dt<he.channels;++Dt)for(var sn=Et[Dt],Qt=0;Qt<Ee.length;++Qt){var Bt=Ee[Qt];sn.name==Bt.name&&(sn.compression=Bt.compression,Bt.index>=0&&(vn.idx[Bt.index]=Dt),sn.offset=Dt)}if(ye.acCompressedSize>0)switch(ye.acCompression){case 0:var Sn=new Uint16Array(ye.totalAcUncompressedCount);pe(he.array,me,De,ye.acCompressedSize,Sn,ye.totalAcUncompressedCount);break;case 1:var yn=he.array.slice(De.value,De.value+ye.totalAcUncompressedCount),xn=Uv(yn),Sn=new Uint16Array(xn.buffer);De.value+=ye.totalAcUncompressedCount;break}if(ye.dcCompressedSize>0){var Ai={array:he.array,offset:De,size:ye.dcCompressedSize},xi=new Uint16Array(He(Ai).buffer);De.value+=ye.dcCompressedSize}if(ye.rleRawSize>0){var yn=he.array.slice(De.value,De.value+ye.rleCompressedSize),xn=Uv(yn),Ei=ve(xn.buffer);De.value+=ye.rleCompressedSize}for(var Dn=0,kn=new Array(Et.length),Qt=0;Qt<kn.length;++Qt)kn[Qt]=new Array;for(var zi=0;zi<he.lines;++zi)for(var Bn=0;Bn<Et.length;++Bn)kn[Bn].push(Dn),Dn+=Et[Bn].width*he.type*2;Ae(vn,kn,Et,Sn,xi,ce);for(var Qt=0;Qt<Et.length;++Qt){var sn=Et[Qt];if(!sn.decoded)switch(sn.compression){case 2:for(var Pn=0,Ri=0,zi=0;zi<he.lines;++zi){for(var ls=kn[Qt][Pn],nr=0;nr<sn.width;++nr){for(var ta=0;ta<2*sn.type;++ta)ce[ls++]=Ei[Ri+ta*sn.width*sn.height];Ri++}Pn++}break;case 1:default:throw"EXRLoader.parse: unsupported channel compression"}}return new DataView(ce.buffer)}function pt(he,me){for(var De=new Uint8Array(he),ce=0;De[me.value+ce]!=0;)ce+=1;var ye=new TextDecoder().decode(De.slice(me.value,me.value+ce));return me.value=me.value+ce+1,ye}function je(he,me,De){var ce=new TextDecoder().decode(new Uint8Array(he).slice(me.value,me.value+De));return me.value=me.value+De,ce}function Mt(he,me){var De=St(he,me),ce=gt(he,me);return[De,ce]}function Ft(he,me){var De=gt(he,me),ce=gt(he,me);return[De,ce]}function St(he,me){var De=he.getInt32(me.value,!0);return me.value=me.value+4,De}function gt(he,me){var De=he.getUint32(me.value,!0);return me.value=me.value+4,De}function ft(he,me){var De=he[me.value];return me.value=me.value+1,De}function Ce(he,me){var De=he.getUint8(me.value);return me.value=me.value+1,De}const qe=function(he,me){let De;return"getBigInt64"in DataView.prototype?De=Number(he.getBigInt64(me.value,!0)):De=he.getUint32(me.value+4,!0)+Number(he.getUint32(me.value,!0)<<32),me.value+=8,De};function At(he,me){var De=he.getFloat32(me.value,!0);return me.value+=4,De}function yt(he,me){return Lm.toHalfFloat(At(he,me))}function Be(he){var me=(he&31744)>>10,De=he&1023;return(he>>15?-1:1)*(me?me===31?De?NaN:1/0:Math.pow(2,me-15)*(1+De/1024):6103515625e-14*(De/1024))}function we(he,me){var De=he.getUint16(me.value,!0);return me.value+=2,De}function _t(he,me){return Be(we(he,me))}function vt(he,me,De,ce){for(var ye=De.value,Ee=[];De.value<ye+ce-1;){var Pe=pt(me,De),Ie=St(he,De),Je=Ce(he,De);De.value+=3;var st=St(he,De),lt=St(he,De);Ee.push({name:Pe,pixelType:Ie,pLinear:Je,xSampling:st,ySampling:lt})}return De.value+=1,Ee}function bt(he,me){var De=At(he,me),ce=At(he,me),ye=At(he,me),Ee=At(he,me),Pe=At(he,me),Ie=At(he,me),Je=At(he,me),st=At(he,me);return{redX:De,redY:ce,greenX:ye,greenY:Ee,blueX:Pe,blueY:Ie,whiteX:Je,whiteY:st}}function Lt(he,me){var De=["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"],ce=Ce(he,me);return De[ce]}function qt(he,me){var De=gt(he,me),ce=gt(he,me),ye=gt(he,me),Ee=gt(he,me);return{xMin:De,yMin:ce,xMax:ye,yMax:Ee}}function Nt(he,me){var De=["INCREASING_Y"],ce=Ce(he,me);return De[ce]}function dn(he,me){var De=At(he,me),ce=At(he,me);return[De,ce]}function Vn(he,me){var De=At(he,me),ce=At(he,me),ye=At(he,me);return[De,ce,ye]}function pn(he,me,De,ce,ye){if(ce==="string"||ce==="stringvector"||ce==="iccProfile")return je(me,De,ye);if(ce==="chlist")return vt(he,me,De,ye);if(ce==="chromaticities")return bt(he,De);if(ce==="compression")return Lt(he,De);if(ce==="box2i")return qt(he,De);if(ce==="lineOrder")return Nt(he,De);if(ce==="float")return At(he,De);if(ce==="v2f")return dn(he,De);if(ce==="v3f")return Vn(he,De);if(ce==="int")return St(he,De);if(ce==="rational")return Mt(he,De);if(ce==="timecode")return Ft(he,De);if(ce==="preview")return De.value+=ye,"skipped";De.value+=ye}function qn(he,me,De){const ce={};if(he.getUint32(0,!0)!=20000630)throw"THREE.EXRLoader: provided file doesn't appear to be in OpenEXR format.";ce.version=he.getUint8(4);const ye=he.getUint8(5);ce.spec={singleTile:!!(ye&2),longName:!!(ye&4),deepFormat:!!(ye&8),multiPart:!!(ye&16)},De.value=8;for(var Ee=!0;Ee;){var Pe=pt(me,De);if(Pe==0)Ee=!1;else{var Ie=pt(me,De),Je=gt(he,De),st=pn(he,me,De,Ie,Je);st===void 0?console.warn(`EXRLoader.parse: skipped unknown header attribute type '${Ie}'.`):ce[Pe]=st}}if((ye&-5)!=0)throw console.error("EXRHeader:",ce),"THREE.EXRLoader: provided file is currently unsupported.";return ce}function Ci(he,me,De,ce,ye){const Ee={size:0,viewer:me,array:De,offset:ce,width:he.dataWindow.xMax-he.dataWindow.xMin+1,height:he.dataWindow.yMax-he.dataWindow.yMin+1,channels:he.channels.length,bytesPerLine:null,lines:null,inputSize:null,type:he.channels[0].pixelType,uncompress:null,getter:null,format:null,[hv?"colorSpace":"encoding"]:null};switch(he.compression){case"NO_COMPRESSION":Ee.lines=1,Ee.uncompress=Le;break;case"RLE_COMPRESSION":Ee.lines=1,Ee.uncompress=Fe;break;case"ZIPS_COMPRESSION":Ee.lines=1,Ee.uncompress=He;break;case"ZIP_COMPRESSION":Ee.lines=16,Ee.uncompress=He;break;case"PIZ_COMPRESSION":Ee.lines=32,Ee.uncompress=it;break;case"PXR24_COMPRESSION":Ee.lines=16,Ee.uncompress=Ye;break;case"DWAA_COMPRESSION":Ee.lines=32,Ee.uncompress=ct;break;case"DWAB_COMPRESSION":Ee.lines=256,Ee.uncompress=ct;break;default:throw"EXRLoader.parse: "+he.compression+" is unsupported"}if(Ee.scanlineBlockSize=Ee.lines,Ee.type==1)switch(ye){case fi:Ee.getter=_t,Ee.inputSize=2;break;case Ni:Ee.getter=we,Ee.inputSize=2;break}else if(Ee.type==2)switch(ye){case fi:Ee.getter=At,Ee.inputSize=4;break;case Ni:Ee.getter=yt,Ee.inputSize=4}else throw"EXRLoader.parse: unsupported pixelType "+Ee.type+" for "+he.compression+".";Ee.blockCount=(he.dataWindow.yMax+1)/Ee.scanlineBlockSize;for(var Pe=0;Pe<Ee.blockCount;Pe++)qe(me,ce);Ee.outputChannels=Ee.channels==3?4:Ee.channels;const Ie=Ee.width*Ee.height*Ee.outputChannels;switch(ye){case fi:Ee.byteArray=new Float32Array(Ie),Ee.channels<Ee.outputChannels&&Ee.byteArray.fill(1,0,Ie);break;case Ni:Ee.byteArray=new Uint16Array(Ie),Ee.channels<Ee.outputChannels&&Ee.byteArray.fill(15360,0,Ie);break;default:console.error("THREE.EXRLoader: unsupported type: ",ye);break}return Ee.bytesPerLine=Ee.width*Ee.inputSize*Ee.channels,Ee.outputChannels==4?Ee.format=gi:Ee.format=hc,hv?Ee.colorSpace="srgb-linear":Ee.encoding=3e3,Ee}const as=new DataView(e),Nr=new Uint8Array(e),ur={value:0},tr=qn(as,e,ur),An=Ci(tr,as,Nr,ur,this.type),vr={value:0},Uo={R:0,G:1,B:2,A:3,Y:0};for(let he=0;he<An.height/An.scanlineBlockSize;he++){const me=gt(as,ur);An.size=gt(as,ur),An.lines=me+An.scanlineBlockSize>An.height?An.height-me:An.scanlineBlockSize;const ce=An.size<An.lines*An.bytesPerLine?An.uncompress(An):Le(An);ur.value+=An.size;for(let ye=0;ye<An.scanlineBlockSize;ye++){const Ee=ye+he*An.scanlineBlockSize;if(Ee>=An.height)break;for(let Pe=0;Pe<An.channels;Pe++){const Ie=Uo[tr.channels[Pe].name];for(let Je=0;Je<An.width;Je++){vr.value=(ye*(An.channels*An.width)+Pe*An.width+Je)*An.inputSize;const st=(An.height-1-Ee)*(An.width*An.outputChannels)+Je*An.outputChannels+Ie;An.byteArray[st]=An.getter(ce,vr)}}}}return{header:tr,width:An.width,height:An.height,data:An.byteArray,format:An.format,[hv?"colorSpace":"encoding"]:An[hv?"colorSpace":"encoding"],type:this.type}}setDataType(e){return this.type=e,this}load(e,t,n,r){function s(o,a){hv?o.colorSpace=a.colorSpace:o.encoding=a.encoding,o.minFilter=Ln,o.magFilter=Ln,o.generateMipmaps=!1,o.flipY=!1,t&&t(o,a)}return super.load(e,s,n,r)}}const dhe="srgb",ub=(()=>{class i extends os{constructor(t){super(t),this.defaultDPI=90,this.defaultUnit="px"}load(t,n,r,s){const o=this,a=new Yr(o.manager);a.setPath(o.path),a.setRequestHeader(o.requestHeader),a.setWithCredentials(o.withCredentials),a.load(t,function(l){try{n(o.parse(l))}catch(c){s?s(c):console.error(c),o.manager.itemError(t)}},r,s)}parse(t){const n=this;function r(J,re){if(J.nodeType!==1)return;const ie=T(J);let se=!1,ge=null;switch(J.nodeName){case"svg":re=y(J,re);break;case"style":o(J);break;case"g":re=y(J,re);break;case"path":re=y(J,re),J.hasAttribute("d")&&(ge=s(J));break;case"rect":re=y(J,re),ge=c(J);break;case"polygon":re=y(J,re),ge=u(J);break;case"polyline":re=y(J,re),ge=h(J);break;case"circle":re=y(J,re),ge=f(J);break;case"ellipse":re=y(J,re),ge=d(J);break;case"line":re=y(J,re),ge=m(J);break;case"defs":se=!0;break;case"use":re=y(J,re);const ue=(J.getAttributeNS("http://www.w3.org/1999/xlink","href")||"").substring(1),Me=J.viewportElement.getElementById(ue);Me?r(Me,re):console.warn("SVGLoader: 'use node' references non-existent node id: "+ue);break}ge&&(re.fill!==void 0&&re.fill!=="none"&&ge.color.setStyle(re.fill,dhe),M(ge,Y),H.push(ge),ge.userData={node:J,style:re});const xe=J.childNodes;for(let pe=0;pe<xe.length;pe++){const ue=xe[pe];se&&ue.nodeName!=="style"&&ue.nodeName!=="defs"||r(ue,re)}ie&&(X.pop(),X.length>0?Y.copy(X[X.length-1]):Y.identity())}function s(J){const re=new yf,ie=new Ue,se=new Ue,ge=new Ue;let xe=!0,pe=!1;const ue=J.getAttribute("d");if(ue===""||ue==="none")return null;const Me=ue.match(/[a-df-z][^a-df-z]*/gi);for(let Se=0,ve=Me.length;Se<ve;Se++){const Ae=Me[Se],ke=Ae.charAt(0),be=Ae.slice(1).trim();xe===!0&&(pe=!0,xe=!1);let ne;switch(ke){case"M":ne=A(be);for(let j=0,de=ne.length;j<de;j+=2)ie.x=ne[j+0],ie.y=ne[j+1],se.x=ie.x,se.y=ie.y,j===0?re.moveTo(ie.x,ie.y):re.lineTo(ie.x,ie.y),j===0&&ge.copy(ie);break;case"H":ne=A(be);for(let j=0,de=ne.length;j<de;j++)ie.x=ne[j],se.x=ie.x,se.y=ie.y,re.lineTo(ie.x,ie.y),j===0&&pe===!0&&ge.copy(ie);break;case"V":ne=A(be);for(let j=0,de=ne.length;j<de;j++)ie.y=ne[j],se.x=ie.x,se.y=ie.y,re.lineTo(ie.x,ie.y),j===0&&pe===!0&&ge.copy(ie);break;case"L":ne=A(be);for(let j=0,de=ne.length;j<de;j+=2)ie.x=ne[j+0],ie.y=ne[j+1],se.x=ie.x,se.y=ie.y,re.lineTo(ie.x,ie.y),j===0&&pe===!0&&ge.copy(ie);break;case"C":ne=A(be);for(let j=0,de=ne.length;j<de;j+=6)re.bezierCurveTo(ne[j+0],ne[j+1],ne[j+2],ne[j+3],ne[j+4],ne[j+5]),se.x=ne[j+2],se.y=ne[j+3],ie.x=ne[j+4],ie.y=ne[j+5],j===0&&pe===!0&&ge.copy(ie);break;case"S":ne=A(be);for(let j=0,de=ne.length;j<de;j+=4)re.bezierCurveTo(g(ie.x,se.x),g(ie.y,se.y),ne[j+0],ne[j+1],ne[j+2],ne[j+3]),se.x=ne[j+0],se.y=ne[j+1],ie.x=ne[j+2],ie.y=ne[j+3],j===0&&pe===!0&&ge.copy(ie);break;case"Q":ne=A(be);for(let j=0,de=ne.length;j<de;j+=4)re.quadraticCurveTo(ne[j+0],ne[j+1],ne[j+2],ne[j+3]),se.x=ne[j+0],se.y=ne[j+1],ie.x=ne[j+2],ie.y=ne[j+3],j===0&&pe===!0&&ge.copy(ie);break;case"T":ne=A(be);for(let j=0,de=ne.length;j<de;j+=2){const Re=g(ie.x,se.x),Le=g(ie.y,se.y);re.quadraticCurveTo(Re,Le,ne[j+0],ne[j+1]),se.x=Re,se.y=Le,ie.x=ne[j+0],ie.y=ne[j+1],j===0&&pe===!0&&ge.copy(ie)}break;case"A":ne=A(be,[3,4],7);for(let j=0,de=ne.length;j<de;j+=7){if(ne[j+5]==ie.x&&ne[j+6]==ie.y)continue;const Re=ie.clone();ie.x=ne[j+5],ie.y=ne[j+6],se.x=ie.x,se.y=ie.y,a(re,ne[j],ne[j+1],ne[j+2],ne[j+3],ne[j+4],Re,ie),j===0&&pe===!0&&ge.copy(ie)}break;case"m":ne=A(be);for(let j=0,de=ne.length;j<de;j+=2)ie.x+=ne[j+0],ie.y+=ne[j+1],se.x=ie.x,se.y=ie.y,j===0?re.moveTo(ie.x,ie.y):re.lineTo(ie.x,ie.y),j===0&&ge.copy(ie);break;case"h":ne=A(be);for(let j=0,de=ne.length;j<de;j++)ie.x+=ne[j],se.x=ie.x,se.y=ie.y,re.lineTo(ie.x,ie.y),j===0&&pe===!0&&ge.copy(ie);break;case"v":ne=A(be);for(let j=0,de=ne.length;j<de;j++)ie.y+=ne[j],se.x=ie.x,se.y=ie.y,re.lineTo(ie.x,ie.y),j===0&&pe===!0&&ge.copy(ie);break;case"l":ne=A(be);for(let j=0,de=ne.length;j<de;j+=2)ie.x+=ne[j+0],ie.y+=ne[j+1],se.x=ie.x,se.y=ie.y,re.lineTo(ie.x,ie.y),j===0&&pe===!0&&ge.copy(ie);break;case"c":ne=A(be);for(let j=0,de=ne.length;j<de;j+=6)re.bezierCurveTo(ie.x+ne[j+0],ie.y+ne[j+1],ie.x+ne[j+2],ie.y+ne[j+3],ie.x+ne[j+4],ie.y+ne[j+5]),se.x=ie.x+ne[j+2],se.y=ie.y+ne[j+3],ie.x+=ne[j+4],ie.y+=ne[j+5],j===0&&pe===!0&&ge.copy(ie);break;case"s":ne=A(be);for(let j=0,de=ne.length;j<de;j+=4)re.bezierCurveTo(g(ie.x,se.x),g(ie.y,se.y),ie.x+ne[j+0],ie.y+ne[j+1],ie.x+ne[j+2],ie.y+ne[j+3]),se.x=ie.x+ne[j+0],se.y=ie.y+ne[j+1],ie.x+=ne[j+2],ie.y+=ne[j+3],j===0&&pe===!0&&ge.copy(ie);break;case"q":ne=A(be);for(let j=0,de=ne.length;j<de;j+=4)re.quadraticCurveTo(ie.x+ne[j+0],ie.y+ne[j+1],ie.x+ne[j+2],ie.y+ne[j+3]),se.x=ie.x+ne[j+0],se.y=ie.y+ne[j+1],ie.x+=ne[j+2],ie.y+=ne[j+3],j===0&&pe===!0&&ge.copy(ie);break;case"t":ne=A(be);for(let j=0,de=ne.length;j<de;j+=2){const Re=g(ie.x,se.x),Le=g(ie.y,se.y);re.quadraticCurveTo(Re,Le,ie.x+ne[j+0],ie.y+ne[j+1]),se.x=Re,se.y=Le,ie.x=ie.x+ne[j+0],ie.y=ie.y+ne[j+1],j===0&&pe===!0&&ge.copy(ie)}break;case"a":ne=A(be,[3,4],7);for(let j=0,de=ne.length;j<de;j+=7){if(ne[j+5]==0&&ne[j+6]==0)continue;const Re=ie.clone();ie.x+=ne[j+5],ie.y+=ne[j+6],se.x=ie.x,se.y=ie.y,a(re,ne[j],ne[j+1],ne[j+2],ne[j+3],ne[j+4],Re,ie),j===0&&pe===!0&&ge.copy(ie)}break;case"Z":case"z":re.currentPath.autoClose=!0,re.currentPath.curves.length>0&&(ie.copy(ge),re.currentPath.currentPoint.copy(ie),xe=!0);break;default:console.warn(Ae)}pe=!1}return re}function o(J){if(!(!J.sheet||!J.sheet.cssRules||!J.sheet.cssRules.length))for(let re=0;re<J.sheet.cssRules.length;re++){const ie=J.sheet.cssRules[re];if(ie.type!==1)continue;const se=ie.selectorText.split(/,/gm).filter(Boolean).map(ge=>ge.trim());for(let ge=0;ge<se.length;ge++){const xe=Object.fromEntries(Object.entries(ie.style).filter(([,pe])=>pe!==""));G[se[ge]]=Object.assign(G[se[ge]]||{},xe)}}}function a(J,re,ie,se,ge,xe,pe,ue){if(re==0||ie==0){J.lineTo(ue.x,ue.y);return}se=se*Math.PI/180,re=Math.abs(re),ie=Math.abs(ie);const Me=(pe.x-ue.x)/2,Se=(pe.y-ue.y)/2,ve=Math.cos(se)*Me+Math.sin(se)*Se,Ae=-Math.sin(se)*Me+Math.cos(se)*Se;let ke=re*re,be=ie*ie;const ne=ve*ve,j=Ae*Ae,de=ne/ke+j/be;if(de>1){const Mt=Math.sqrt(de);re=Mt*re,ie=Mt*ie,ke=re*re,be=ie*ie}const Re=ke*j+be*ne,Le=(ke*be-Re)/Re;let Fe=Math.sqrt(Math.max(0,Le));ge===xe&&(Fe=-Fe);const He=Fe*re*Ae/ie,it=-Fe*ie*ve/re,Ye=Math.cos(se)*He-Math.sin(se)*it+(pe.x+ue.x)/2,ct=Math.sin(se)*He+Math.cos(se)*it+(pe.y+ue.y)/2,pt=l(1,0,(ve-He)/re,(Ae-it)/ie),je=l((ve-He)/re,(Ae-it)/ie,(-ve-He)/re,(-Ae-it)/ie)%(Math.PI*2);J.currentPath.absellipse(Ye,ct,re,ie,pt,pt+je,xe===0,se)}function l(J,re,ie,se){const ge=J*ie+re*se,xe=Math.sqrt(J*J+re*re)*Math.sqrt(ie*ie+se*se);let pe=Math.acos(Math.max(-1,Math.min(1,ge/xe)));return J*se-re*ie<0&&(pe=-pe),pe}function c(J){const re=w(J.getAttribute("x")||0),ie=w(J.getAttribute("y")||0),se=w(J.getAttribute("rx")||J.getAttribute("ry")||0),ge=w(J.getAttribute("ry")||J.getAttribute("rx")||0),xe=w(J.getAttribute("width")),pe=w(J.getAttribute("height")),ue=1-.551915024494,Me=new yf;return Me.moveTo(re+se,ie),Me.lineTo(re+xe-se,ie),(se!==0||ge!==0)&&Me.bezierCurveTo(re+xe-se*ue,ie,re+xe,ie+ge*ue,re+xe,ie+ge),Me.lineTo(re+xe,ie+pe-ge),(se!==0||ge!==0)&&Me.bezierCurveTo(re+xe,ie+pe-ge*ue,re+xe-se*ue,ie+pe,re+xe-se,ie+pe),Me.lineTo(re+se,ie+pe),(se!==0||ge!==0)&&Me.bezierCurveTo(re+se*ue,ie+pe,re,ie+pe-ge*ue,re,ie+pe-ge),Me.lineTo(re,ie+ge),(se!==0||ge!==0)&&Me.bezierCurveTo(re,ie+ge*ue,re+se*ue,ie,re+se,ie),Me}function u(J){function re(xe,pe,ue){const Me=w(pe),Se=w(ue);ge===0?se.moveTo(Me,Se):se.lineTo(Me,Se),ge++}const ie=/([+-]?\d*\.?\d+(?:e[+-]?\d+)?)(?:,|\s)([+-]?\d*\.?\d+(?:e[+-]?\d+)?)/g,se=new yf;let ge=0;return J.getAttribute("points").replace(ie,re),se.currentPath.autoClose=!0,se}function h(J){function re(xe,pe,ue){const Me=w(pe),Se=w(ue);ge===0?se.moveTo(Me,Se):se.lineTo(Me,Se),ge++}const ie=/([+-]?\d*\.?\d+(?:e[+-]?\d+)?)(?:,|\s)([+-]?\d*\.?\d+(?:e[+-]?\d+)?)/g,se=new yf;let ge=0;return J.getAttribute("points").replace(ie,re),se.currentPath.autoClose=!1,se}function f(J){const re=w(J.getAttribute("cx")||0),ie=w(J.getAttribute("cy")||0),se=w(J.getAttribute("r")||0),ge=new Xd;ge.absarc(re,ie,se,0,Math.PI*2);const xe=new yf;return xe.subPaths.push(ge),xe}function d(J){const re=w(J.getAttribute("cx")||0),ie=w(J.getAttribute("cy")||0),se=w(J.getAttribute("rx")||0),ge=w(J.getAttribute("ry")||0),xe=new Xd;xe.absellipse(re,ie,se,ge,0,Math.PI*2);const pe=new yf;return pe.subPaths.push(xe),pe}function m(J){const re=w(J.getAttribute("x1")||0),ie=w(J.getAttribute("y1")||0),se=w(J.getAttribute("x2")||0),ge=w(J.getAttribute("y2")||0),xe=new yf;return xe.moveTo(re,ie),xe.lineTo(se,ge),xe.currentPath.autoClose=!1,xe}function y(J,re){re=Object.assign({},re);let ie={};if(J.hasAttribute("class")){const pe=J.getAttribute("class").split(/\s/).filter(Boolean).map(ue=>ue.trim());for(let ue=0;ue<pe.length;ue++)ie=Object.assign(ie,G["."+pe[ue]])}J.hasAttribute("id")&&(ie=Object.assign(ie,G["#"+J.getAttribute("id")]));function se(pe,ue,Me){Me===void 0&&(Me=function(ve){return ve.startsWith("url")&&console.warn("SVGLoader: url access in attributes is not implemented."),ve}),J.hasAttribute(pe)&&(re[ue]=Me(J.getAttribute(pe))),ie[pe]&&(re[ue]=Me(ie[pe])),J.style&&J.style[pe]!==""&&(re[ue]=Me(J.style[pe]))}function ge(pe){return Math.max(0,Math.min(1,w(pe)))}function xe(pe){return Math.max(0,w(pe))}return se("fill","fill"),se("fill-opacity","fillOpacity",ge),se("fill-rule","fillRule"),se("opacity","opacity",ge),se("stroke","stroke"),se("stroke-opacity","strokeOpacity",ge),se("stroke-width","strokeWidth",xe),se("stroke-linejoin","strokeLineJoin"),se("stroke-linecap","strokeLineCap"),se("stroke-miterlimit","strokeMiterLimit",xe),se("visibility","visibility"),re}function g(J,re){return J-(re-J)}function A(J,re,ie){if(typeof J!="string")throw new TypeError("Invalid input: "+typeof J);const se={WHITESPACE:/[ \t\r\n]/,DIGIT:/[\d]/,SIGN:/[-+]/,POINT:/\./,COMMA:/,/,EXP:/e/i,FLAGS:/[01]/},ge=0,xe=1,pe=2,ue=3;let Me=ge,Se=!0,ve="",Ae="";const ke=[];function be(Re,Le,Fe){const He=new SyntaxError('Unexpected character "'+Re+'" at index '+Le+".");throw He.partial=Fe,He}function ne(){ve!==""&&(Ae===""?ke.push(Number(ve)):ke.push(Number(ve)*Math.pow(10,Number(Ae)))),ve="",Ae=""}let j;const de=J.length;for(let Re=0;Re<de;Re++){if(j=J[Re],Array.isArray(re)&&re.includes(ke.length%ie)&&se.FLAGS.test(j)){Me=xe,ve=j,ne();continue}if(Me===ge){if(se.WHITESPACE.test(j))continue;if(se.DIGIT.test(j)||se.SIGN.test(j)){Me=xe,ve=j;continue}if(se.POINT.test(j)){Me=pe,ve=j;continue}se.COMMA.test(j)&&(Se&&be(j,Re,ke),Se=!0)}if(Me===xe){if(se.DIGIT.test(j)){ve+=j;continue}if(se.POINT.test(j)){ve+=j,Me=pe;continue}if(se.EXP.test(j)){Me=ue;continue}se.SIGN.test(j)&&ve.length===1&&se.SIGN.test(ve[0])&&be(j,Re,ke)}if(Me===pe){if(se.DIGIT.test(j)){ve+=j;continue}if(se.EXP.test(j)){Me=ue;continue}se.POINT.test(j)&&ve[ve.length-1]==="."&&be(j,Re,ke)}if(Me===ue){if(se.DIGIT.test(j)){Ae+=j;continue}if(se.SIGN.test(j)){if(Ae===""){Ae+=j;continue}Ae.length===1&&se.SIGN.test(Ae)&&be(j,Re,ke)}}se.WHITESPACE.test(j)?(ne(),Me=ge,Se=!1):se.COMMA.test(j)?(ne(),Me=ge,Se=!0):se.SIGN.test(j)?(ne(),Me=xe,ve=j):se.POINT.test(j)?(ne(),Me=pe,ve=j):be(j,Re,ke)}return ne(),ke}const E=["mm","cm","in","pt","pc","px"],x={mm:{mm:1,cm:.1,in:1/25.4,pt:72/25.4,pc:6/25.4,px:-1},cm:{mm:10,cm:1,in:1/2.54,pt:72/2.54,pc:6/2.54,px:-1},in:{mm:25.4,cm:2.54,in:1,pt:72,pc:6,px:-1},pt:{mm:25.4/72,cm:2.54/72,in:1/72,pt:1,pc:6/72,px:-1},pc:{mm:25.4/6,cm:2.54/6,in:1/6,pt:72/6,pc:1,px:-1},px:{px:1}};function w(J){let re="px";if(typeof J=="string"||J instanceof String)for(let se=0,ge=E.length;se<ge;se++){const xe=E[se];if(J.endsWith(xe)){re=xe,J=J.substring(0,J.length-xe.length);break}}let ie;return re==="px"&&n.defaultUnit!=="px"?ie=x.in[n.defaultUnit]/n.defaultDPI:(ie=x[re][n.defaultUnit],ie<0&&(ie=x[re].in*n.defaultDPI)),ie*parseFloat(J)}function T(J){if(!(J.hasAttribute("transform")||J.nodeName==="use"&&(J.hasAttribute("x")||J.hasAttribute("y"))))return null;const re=I(J);return X.length>0&&re.premultiply(X[X.length-1]),Y.copy(re),X.push(re),re}function I(J){const re=new Tn,ie=Z;if(J.nodeName==="use"&&(J.hasAttribute("x")||J.hasAttribute("y"))){const se=w(J.getAttribute("x")),ge=w(J.getAttribute("y"));re.translate(se,ge)}if(J.hasAttribute("transform")){const se=J.getAttribute("transform").split(")");for(let ge=se.length-1;ge>=0;ge--){const xe=se[ge].trim();if(xe==="")continue;const pe=xe.indexOf("("),ue=xe.length;if(pe>0&&pe<ue){const Me=xe.slice(0,pe),Se=A(xe.slice(pe+1));switch(ie.identity(),Me){case"translate":if(Se.length>=1){const ve=Se[0];let Ae=0;Se.length>=2&&(Ae=Se[1]),ie.translate(ve,Ae)}break;case"rotate":if(Se.length>=1){let ve=0,Ae=0,ke=0;ve=Se[0]*Math.PI/180,Se.length>=3&&(Ae=Se[1],ke=Se[2]),oe.makeTranslation(-Ae,-ke),K.makeRotation(ve),V.multiplyMatrices(K,oe),oe.makeTranslation(Ae,ke),ie.multiplyMatrices(oe,V)}break;case"scale":if(Se.length>=1){const ve=Se[0];let Ae=ve;Se.length>=2&&(Ae=Se[1]),ie.scale(ve,Ae)}break;case"skewX":Se.length===1&&ie.set(1,Math.tan(Se[0]*Math.PI/180),0,0,1,0,0,0,1);break;case"skewY":Se.length===1&&ie.set(1,0,0,Math.tan(Se[0]*Math.PI/180),1,0,0,0,1);break;case"matrix":Se.length===6&&ie.set(Se[0],Se[2],Se[4],Se[1],Se[3],Se[5],0,0,1);break}}re.premultiply(ie)}}return re}function M(J,re){function ie(pe){F.set(pe.x,pe.y,1).applyMatrix3(re),pe.set(F.x,F.y)}function se(pe){const ue=pe.xRadius,Me=pe.yRadius,Se=Math.cos(pe.aRotation),ve=Math.sin(pe.aRotation),Ae=new Q(ue*Se,ue*ve,0),ke=new Q(-Me*ve,Me*Se,0),be=Ae.applyMatrix3(re),ne=ke.applyMatrix3(re),j=Z.set(be.x,ne.x,0,be.y,ne.y,0,0,0,1),de=oe.copy(j).invert(),Fe=K.copy(de).transpose().multiply(de).elements,He=k(Fe[0],Fe[1],Fe[4]),it=Math.sqrt(He.rt1),Ye=Math.sqrt(He.rt2);if(pe.xRadius=1/it,pe.yRadius=1/Ye,pe.aRotation=Math.atan2(He.sn,He.cs),!((pe.aEndAngle-pe.aStartAngle)%(2*Math.PI)<Number.EPSILON)){const pt=oe.set(it,0,0,0,Ye,0,0,0,1),je=K.set(He.cs,He.sn,0,-He.sn,He.cs,0,0,0,1),Mt=pt.multiply(je).multiply(j),Ft=St=>{const{x:gt,y:ft}=new Q(Math.cos(St),Math.sin(St),0).applyMatrix3(Mt);return Math.atan2(ft,gt)};pe.aStartAngle=Ft(pe.aStartAngle),pe.aEndAngle=Ft(pe.aEndAngle),L(re)&&(pe.aClockwise=!pe.aClockwise)}}function ge(pe){const ue=R(re),Me=U(re);pe.xRadius*=ue,pe.yRadius*=Me;const Se=ue>Number.EPSILON?Math.atan2(re.elements[1],re.elements[0]):Math.atan2(-re.elements[3],re.elements[4]);pe.aRotation+=Se,L(re)&&(pe.aStartAngle*=-1,pe.aEndAngle*=-1,pe.aClockwise=!pe.aClockwise)}const xe=J.subPaths;for(let pe=0,ue=xe.length;pe<ue;pe++){const Se=xe[pe].curves;for(let ve=0;ve<Se.length;ve++){const Ae=Se[ve];Ae.isLineCurve?(ie(Ae.v1),ie(Ae.v2)):Ae.isCubicBezierCurve?(ie(Ae.v0),ie(Ae.v1),ie(Ae.v2),ie(Ae.v3)):Ae.isQuadraticBezierCurve?(ie(Ae.v0),ie(Ae.v1),ie(Ae.v2)):Ae.isEllipseCurve&&(W.set(Ae.aX,Ae.aY),ie(W),Ae.aX=W.x,Ae.aY=W.y,P(re)?se(Ae):ge(Ae))}}}function L(J){const re=J.elements;return re[0]*re[4]-re[1]*re[3]<0}function P(J){const re=J.elements,ie=re[0]*re[3]+re[1]*re[4];if(ie===0)return!1;const se=R(J),ge=U(J);return Math.abs(ie/(se*ge))>Number.EPSILON}function R(J){const re=J.elements;return Math.sqrt(re[0]*re[0]+re[1]*re[1])}function U(J){const re=J.elements;return Math.sqrt(re[3]*re[3]+re[4]*re[4])}function k(J,re,ie){let se,ge,xe,pe,ue;const Me=J+ie,Se=J-ie,ve=Math.sqrt(Se*Se+4*re*re);return Me>0?(se=.5*(Me+ve),ue=1/se,ge=J*ue*ie-re*ue*re):Me<0?ge=.5*(Me-ve):(se=.5*ve,ge=-.5*ve),Se>0?xe=Se+ve:xe=Se-ve,Math.abs(xe)>2*Math.abs(re)?(ue=-2*re/xe,pe=1/Math.sqrt(1+ue*ue),xe=ue*pe):Math.abs(re)===0?(xe=1,pe=0):(ue=-.5*xe/re,xe=1/Math.sqrt(1+ue*ue),pe=ue*xe),Se>0&&(ue=xe,xe=-pe,pe=ue),{rt1:se,rt2:ge,cs:xe,sn:pe}}const H=[],G={},X=[],Z=new Tn,oe=new Tn,K=new Tn,V=new Tn,W=new Ue,F=new Q,Y=new Tn,te=new DOMParser().parseFromString(t,"image/svg+xml");return r(te.documentElement,{fill:"#000",fillOpacity:1,strokeOpacity:1,strokeWidth:1,strokeLineJoin:"miter",strokeLineCap:"butt",strokeMiterLimit:4}),{paths:H,xml:te.documentElement}}static createShapes(t){const r={ORIGIN:0,DESTINATION:1,BETWEEN:2,LEFT:3,RIGHT:4,BEHIND:5,BEYOND:6},s={loc:r.ORIGIN,t:0};function o(g,A,E,x){const w=g.x,T=A.x,I=E.x,M=x.x,L=g.y,P=A.y,R=E.y,U=x.y,k=(M-I)*(L-R)-(U-R)*(w-I),H=(T-w)*(L-R)-(P-L)*(w-I),G=(U-R)*(T-w)-(M-I)*(P-L),X=k/G,Z=H/G;if(G===0&&k!==0||X<=0||X>=1||Z<0||Z>1)return null;if(k===0&&G===0){for(let oe=0;oe<2;oe++)if(a(oe===0?E:x,g,A),s.loc==r.ORIGIN){const K=oe===0?E:x;return{x:K.x,y:K.y,t:s.t}}else if(s.loc==r.BETWEEN){const K=+(w+s.t*(T-w)).toPrecision(10),V=+(L+s.t*(P-L)).toPrecision(10);return{x:K,y:V,t:s.t}}return null}else{for(let V=0;V<2;V++)if(a(V===0?E:x,g,A),s.loc==r.ORIGIN){const W=V===0?E:x;return{x:W.x,y:W.y,t:s.t}}const oe=+(w+X*(T-w)).toPrecision(10),K=+(L+X*(P-L)).toPrecision(10);return{x:oe,y:K,t:X}}}function a(g,A,E){const x=E.x-A.x,w=E.y-A.y,T=g.x-A.x,I=g.y-A.y,M=x*I-T*w;if(g.x===A.x&&g.y===A.y){s.loc=r.ORIGIN,s.t=0;return}if(g.x===E.x&&g.y===E.y){s.loc=r.DESTINATION,s.t=1;return}if(M<-Number.EPSILON){s.loc=r.LEFT;return}if(M>Number.EPSILON){s.loc=r.RIGHT;return}if(x*T<0||w*I<0){s.loc=r.BEHIND;return}if(Math.sqrt(x*x+w*w)<Math.sqrt(T*T+I*I)){s.loc=r.BEYOND;return}let L;x!==0?L=T/x:L=I/w,s.loc=r.BETWEEN,s.t=L}function l(g,A){const E=[],x=[];for(let w=1;w<g.length;w++){const T=g[w-1],I=g[w];for(let M=1;M<A.length;M++){const L=A[M-1],P=A[M],R=o(T,I,L,P);R!==null&&E.find(U=>U.t<=R.t+Number.EPSILON&&U.t>=R.t-Number.EPSILON)===void 0&&(E.push(R),x.push(new Ue(R.x,R.y)))}}return x}function c(g,A,E){const x=new Ue;A.getCenter(x);const w=[];return E.forEach(T=>{T.boundingBox.containsPoint(x)&&l(g,T.points).forEach(M=>{w.push({identifier:T.identifier,isCW:T.isCW,point:M})})}),w.sort((T,I)=>T.point.x-I.point.x),w}function u(g,A,E,x,w){(w==null||w==="")&&(w="nonzero");const T=new Ue;g.boundingBox.getCenter(T);const I=[new Ue(E,T.y),new Ue(x,T.y)],M=c(I,g.boundingBox,A);M.sort((H,G)=>H.point.x-G.point.x);const L=[],P=[];M.forEach(H=>{H.identifier===g.identifier?L.push(H):P.push(H)});const R=L[0].point.x,U=[];let k=0;for(;k<P.length&&P[k].point.x<R;)U.length>0&&U[U.length-1]===P[k].identifier?U.pop():U.push(P[k].identifier),k++;if(U.push(g.identifier),w==="evenodd"){const H=U.length%2===0,G=U[U.length-2];return{identifier:g.identifier,isHole:H,for:G}}else if(w==="nonzero"){let H=!0,G=null,X=null;for(let Z=0;Z<U.length;Z++){const oe=U[Z];H?(X=A[oe].isCW,H=!1,G=oe):X!==A[oe].isCW&&(X=A[oe].isCW,H=!0)}return{identifier:g.identifier,isHole:H,for:G}}else console.warn('fill-rule: "'+w+'" is currently not implemented.')}let h=999999999,f=-999999999,d=t.subPaths.map(g=>{const A=g.getPoints();let E=-999999999,x=999999999,w=-999999999,T=999999999;for(let I=0;I<A.length;I++){const M=A[I];M.y>E&&(E=M.y),M.y<x&&(x=M.y),M.x>w&&(w=M.x),M.x<T&&(T=M.x)}return f<=w&&(f=w+1),h>=T&&(h=T-1),{curves:g.curves,points:A,isCW:xu.isClockWise(A),identifier:-1,boundingBox:new Rz(new Ue(T,x),new Ue(w,E))}});d=d.filter(g=>g.points.length>1);for(let g=0;g<d.length;g++)d[g].identifier=g;const m=d.map(g=>u(g,d,h,f,t.userData?t.userData.style.fillRule:void 0)),y=[];return d.forEach(g=>{if(!m[g.identifier].isHole){const E=new Pf;E.curves=g.curves,m.filter(w=>w.isHole&&w.for===g.identifier).forEach(w=>{const T=d[w.identifier],I=new Xd;I.curves=T.curves,E.holes.push(I)}),y.push(E)}}),y}static getStrokeStyle(t,n,r,s,o){return t=t!==void 0?t:1,n=n!==void 0?n:"#000",r=r!==void 0?r:"miter",s=s!==void 0?s:"butt",o=o!==void 0?o:4,{strokeColor:n,strokeWidth:t,strokeLineJoin:r,strokeLineCap:s,strokeMiterLimit:o}}static pointsToStroke(t,n,r,s){const o=[],a=[],l=[];if(i.pointsToStrokeWithBuffers(t,n,r,s,o,a,l)===0)return null;const c=new fn;return c.setAttribute("position",new Gt(o,3)),c.setAttribute("normal",new Gt(a,3)),c.setAttribute("uv",new Gt(l,2)),c}static pointsToStrokeWithBuffers(t,n,r,s,o,a,l,c){const u=new Ue,h=new Ue,f=new Ue,d=new Ue,m=new Ue,y=new Ue,g=new Ue,A=new Ue,E=new Ue,x=new Ue,w=new Ue,T=new Ue,I=new Ue,M=new Ue,L=new Ue,P=new Ue,R=new Ue;r=r!==void 0?r:12,s=s!==void 0?s:.001,c=c!==void 0?c:0,t=Se(t);const U=t.length;if(U<2)return 0;const k=t[0].equals(t[U-1]);let H,G=t[0],X;const Z=n.strokeWidth/2,oe=1/(U-1);let K=0,V,W,F,Y,te=!1,q=0,J=c*3,re=c*2;ie(t[0],t[1],u).multiplyScalar(Z),A.copy(t[0]).sub(u),E.copy(t[0]).add(u),x.copy(A),w.copy(E);for(let ve=1;ve<U;ve++){H=t[ve],ve===U-1?k?X=t[1]:X=void 0:X=t[ve+1];const Ae=u;if(ie(G,H,Ae),f.copy(Ae).multiplyScalar(Z),T.copy(H).sub(f),I.copy(H).add(f),V=K+oe,W=!1,X!==void 0){ie(H,X,h),f.copy(h).multiplyScalar(Z),M.copy(H).sub(f),L.copy(H).add(f),F=!0,f.subVectors(X,G),Ae.dot(f)<0&&(F=!1),ve===1&&(te=F),f.subVectors(X,H),f.normalize();const ke=Math.abs(Ae.dot(f));if(ke>Number.EPSILON){const be=Z/ke;f.multiplyScalar(-be),d.subVectors(H,G),m.copy(d).setLength(be).add(f),P.copy(m).negate();const ne=m.length(),j=d.length();d.divideScalar(j),y.subVectors(X,H);const de=y.length();switch(y.divideScalar(de),d.dot(P)<j&&y.dot(P)<de&&(W=!0),R.copy(m).add(H),P.add(H),Y=!1,W?F?(L.copy(P),I.copy(P)):(M.copy(P),T.copy(P)):xe(),n.strokeLineJoin){case"bevel":pe(F,W,V);break;case"round":ue(F,W),F?ge(H,T,M,V,0):ge(H,L,I,V,1);break;case"miter":case"miter-clip":default:const Re=Z*n.strokeMiterLimit/ne;if(Re<1)if(n.strokeLineJoin!=="miter-clip"){pe(F,W,V);break}else ue(F,W),F?(y.subVectors(R,T).multiplyScalar(Re).add(T),g.subVectors(R,M).multiplyScalar(Re).add(M),se(T,V,0),se(y,V,0),se(H,V,.5),se(H,V,.5),se(y,V,0),se(g,V,0),se(H,V,.5),se(g,V,0),se(M,V,0)):(y.subVectors(R,I).multiplyScalar(Re).add(I),g.subVectors(R,L).multiplyScalar(Re).add(L),se(I,V,1),se(y,V,1),se(H,V,.5),se(H,V,.5),se(y,V,1),se(g,V,1),se(H,V,.5),se(g,V,1),se(L,V,1));else W?(F?(se(E,K,1),se(A,K,0),se(R,V,0),se(E,K,1),se(R,V,0),se(P,V,1)):(se(E,K,1),se(A,K,0),se(R,V,1),se(A,K,0),se(P,V,0),se(R,V,1)),F?M.copy(R):L.copy(R)):F?(se(T,V,0),se(R,V,0),se(H,V,.5),se(H,V,.5),se(R,V,0),se(M,V,0)):(se(I,V,1),se(R,V,1),se(H,V,.5),se(H,V,.5),se(R,V,1),se(L,V,1)),Y=!0;break}}else xe()}else xe();!k&&ve===U-1&&Me(t[0],x,w,F,!0,K),K=V,G=H,A.copy(M),E.copy(L)}if(!k)Me(H,T,I,F,!1,V);else if(W&&o){let ve=R,Ae=P;te!==F&&(ve=P,Ae=R),F?(Y||te)&&(Ae.toArray(o,0),Ae.toArray(o,9),Y&&ve.toArray(o,3)):(Y||!te)&&(Ae.toArray(o,3),Ae.toArray(o,9),Y&&ve.toArray(o,0))}return q;function ie(ve,Ae,ke){return ke.subVectors(Ae,ve),ke.set(-ke.y,ke.x).normalize()}function se(ve,Ae,ke){o&&(o[J]=ve.x,o[J+1]=ve.y,o[J+2]=0,a&&(a[J]=0,a[J+1]=0,a[J+2]=1),J+=3,l&&(l[re]=Ae,l[re+1]=ke,re+=2)),q+=3}function ge(ve,Ae,ke,be,ne){u.copy(Ae).sub(ve).normalize(),h.copy(ke).sub(ve).normalize();let j=Math.PI;const de=u.dot(h);Math.abs(de)<1&&(j=Math.abs(Math.acos(de))),j/=r,f.copy(Ae);for(let Re=0,Le=r-1;Re<Le;Re++)d.copy(f).rotateAround(ve,j),se(f,be,ne),se(d,be,ne),se(ve,be,.5),f.copy(d);se(d,be,ne),se(ke,be,ne),se(ve,be,.5)}function xe(){se(E,K,1),se(A,K,0),se(T,V,0),se(E,K,1),se(T,V,0),se(I,V,1)}function pe(ve,Ae,ke){Ae?ve?(se(E,K,1),se(A,K,0),se(T,V,0),se(E,K,1),se(T,V,0),se(P,V,1),se(T,ke,0),se(M,ke,0),se(P,ke,.5)):(se(E,K,1),se(A,K,0),se(I,V,1),se(A,K,0),se(P,V,0),se(I,V,1),se(I,ke,1),se(P,ke,0),se(L,ke,1)):ve?(se(T,ke,0),se(M,ke,0),se(H,ke,.5)):(se(I,ke,1),se(L,ke,0),se(H,ke,.5))}function ue(ve,Ae){Ae&&(ve?(se(E,K,1),se(A,K,0),se(T,V,0),se(E,K,1),se(T,V,0),se(P,V,1),se(T,K,0),se(H,V,.5),se(P,V,1),se(H,V,.5),se(M,K,0),se(P,V,1)):(se(E,K,1),se(A,K,0),se(I,V,1),se(A,K,0),se(P,V,0),se(I,V,1),se(I,K,1),se(P,V,0),se(H,V,.5),se(H,V,.5),se(P,V,0),se(L,K,1)))}function Me(ve,Ae,ke,be,ne,j){switch(n.strokeLineCap){case"round":ne?ge(ve,ke,Ae,j,.5):ge(ve,Ae,ke,j,.5);break;case"square":if(ne)u.subVectors(Ae,ve),h.set(u.y,-u.x),f.addVectors(u,h).add(ve),d.subVectors(h,u).add(ve),be?(f.toArray(o,3),d.toArray(o,0),d.toArray(o,9)):(f.toArray(o,3),l[7]===1?d.toArray(o,9):f.toArray(o,9),d.toArray(o,0));else{u.subVectors(ke,ve),h.set(u.y,-u.x),f.addVectors(u,h).add(ve),d.subVectors(h,u).add(ve);const de=o.length;be?(f.toArray(o,de-3),d.toArray(o,de-6),d.toArray(o,de-12)):(d.toArray(o,de-6),f.toArray(o,de-3),d.toArray(o,de-12))}break}}function Se(ve){let Ae=!1;for(let be=1,ne=ve.length-1;be<ne;be++)if(ve[be].distanceTo(ve[be+1])<s){Ae=!0;break}if(!Ae)return ve;const ke=[];ke.push(ve[0]);for(let be=1,ne=ve.length-1;be<ne;be++)ve[be].distanceTo(ve[be+1])>=s&&ke.push(ve[be]);return ke.push(ve[ve.length-1]),ke}}}return i})(),hb=new WeakMap;class phe extends os{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,n,r){const s=new Yr(this.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,o=>{const a={attributeIDs:this.defaultAttributeIDs,attributeTypes:this.defaultAttributeTypes,useUniqueIDs:!1};this.decodeGeometry(o,a).then(t).catch(r)},n,r)}decodeDracoFile(e,t,n,r){const s={attributeIDs:n||this.defaultAttributeIDs,attributeTypes:r||this.defaultAttributeTypes,useUniqueIDs:!!n};this.decodeGeometry(e,s).then(t)}decodeGeometry(e,t){for(const l in t.attributeTypes){const c=t.attributeTypes[l];c.BYTES_PER_ELEMENT!==void 0&&(t.attributeTypes[l]=c.name)}const n=JSON.stringify(t);if(hb.has(e)){const l=hb.get(e);if(l.key===n)return l.promise;if(e.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let r;const s=this.workerNextTaskID++,o=e.byteLength,a=this._getWorker(s,o).then(l=>(r=l,new Promise((c,u)=>{r._callbacks[s]={resolve:c,reject:u},r.postMessage({type:"decode",id:s,taskConfig:t,buffer:e},[e])}))).then(l=>this._createGeometry(l.geometry));return a.catch(()=>!0).then(()=>{r&&s&&this._releaseTask(r,s)}),hb.set(e,{key:n,promise:a}),a}_createGeometry(e){const t=new fn;e.index&&t.setIndex(new mn(e.index.array,1));for(let n=0;n<e.attributes.length;n++){const r=e.attributes[n],s=r.name,o=r.array,a=r.itemSize;t.setAttribute(s,new mn(o,a))}return t}_loadLibrary(e,t){const n=new Yr(this.manager);return n.setPath(this.decoderPath),n.setResponseType(t),n.setWithCredentials(this.withCredentials),new Promise((r,s)=>{n.load(e,r,void 0,s)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const e=typeof WebAssembly!="object"||this.decoderConfig.type==="js",t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then(n=>{const r=n[0];e||(this.decoderConfig.wasmBinary=n[1]);const s=mhe.toString(),o=["/* draco decoder */",r,"","/* worker */",s.substring(s.indexOf("{")+1,s.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([o]))}),this.decoderPending}_getWorker(e,t){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const r=new Worker(this.workerSourceURL);r._callbacks={},r._taskCosts={},r._taskLoad=0,r.postMessage({type:"init",decoderConfig:this.decoderConfig}),r.onmessage=function(s){const o=s.data;switch(o.type){case"decode":r._callbacks[o.id].resolve(o);break;case"error":r._callbacks[o.id].reject(o);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+o.type+'"')}},this.workerPool.push(r)}else this.workerPool.sort(function(r,s){return r._taskLoad>s._taskLoad?-1:1});const n=this.workerPool[this.workerPool.length-1];return n._taskCosts[e]=t,n._taskLoad+=t,n})}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this}}function mhe(){let i,e;onmessage=function(o){const a=o.data;switch(a.type){case"init":i=a.decoderConfig,e=new Promise(function(u){i.onModuleLoaded=function(h){u({draco:h})},DracoDecoderModule(i)});break;case"decode":const l=a.buffer,c=a.taskConfig;e.then(u=>{const h=u.draco,f=new h.Decoder,d=new h.DecoderBuffer;d.Init(new Int8Array(l),l.byteLength);try{const m=t(h,f,d,c),y=m.attributes.map(g=>g.array.buffer);m.index&&y.push(m.index.array.buffer),self.postMessage({type:"decode",id:a.id,geometry:m},y)}catch(m){console.error(m),self.postMessage({type:"error",id:a.id,error:m.message})}finally{h.destroy(d),h.destroy(f)}});break}};function t(o,a,l,c){const u=c.attributeIDs,h=c.attributeTypes;let f,d;const m=a.GetEncodedGeometryType(l);if(m===o.TRIANGULAR_MESH)f=new o.Mesh,d=a.DecodeBufferToMesh(l,f);else if(m===o.POINT_CLOUD)f=new o.PointCloud,d=a.DecodeBufferToPointCloud(l,f);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!d.ok()||f.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+d.error_msg());const y={index:null,attributes:[]};for(const g in u){const A=self[h[g]];let E,x;if(c.useUniqueIDs)x=u[g],E=a.GetAttributeByUniqueId(f,x);else{if(x=a.GetAttributeId(f,o[u[g]]),x===-1)continue;E=a.GetAttribute(f,x)}y.attributes.push(r(o,a,f,g,A,E))}return m===o.TRIANGULAR_MESH&&(y.index=n(o,a,f)),o.destroy(f),y}function n(o,a,l){const u=l.num_faces()*3,h=u*4,f=o._malloc(h);a.GetTrianglesUInt32Array(l,h,f);const d=new Uint32Array(o.HEAPF32.buffer,f,u).slice();return o._free(f),{array:d,itemSize:1}}function r(o,a,l,c,u,h){const f=h.num_components(),m=l.num_points()*f,y=m*u.BYTES_PER_ELEMENT,g=s(o,u),A=o._malloc(y);a.GetAttributeDataArrayForAllPoints(l,h,g,y,A);const E=new u(o.HEAPF32.buffer,A,m).slice();return o._free(A),{name:c,array:E,itemSize:f}}function s(o,a){switch(a){case Float32Array:return o.DT_FLOAT32;case Int8Array:return o.DT_INT8;case Int16Array:return o.DT_INT16;case Int32Array:return o.DT_INT32;case Uint8Array:return o.DT_UINT8;case Uint16Array:return o.DT_UINT16;case Uint32Array:return o.DT_UINT32}}}const K9=new ti,OE=new Q;class u4 extends gx{constructor(){super(),this.isLineSegmentsGeometry=!0,this.type="LineSegmentsGeometry";const e=[-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],t=[-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],n=[0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5];this.setIndex(n),this.setAttribute("position",new Gt(e,3)),this.setAttribute("uv",new Gt(t,2))}applyMatrix4(e){const t=this.attributes.instanceStart,n=this.attributes.instanceEnd;return t!==void 0&&(t.applyMatrix4(e),n.applyMatrix4(e),t.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}setPositions(e){let t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));const n=new LS(t,6,1);return this.setAttribute("instanceStart",new Ja(n,3,0)),this.setAttribute("instanceEnd",new Ja(n,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this}setColors(e,t=3){let n;e instanceof Float32Array?n=e:Array.isArray(e)&&(n=new Float32Array(e));const r=new LS(n,t*2,1);return this.setAttribute("instanceColorStart",new Ja(r,t,0)),this.setAttribute("instanceColorEnd",new Ja(r,t,t)),this}fromWireframeGeometry(e){return this.setPositions(e.attributes.position.array),this}fromEdgesGeometry(e){return this.setPositions(e.attributes.position.array),this}fromMesh(e){return this.fromWireframeGeometry(new V6(e.geometry)),this}fromLineSegments(e){const t=e.geometry;return this.setPositions(t.attributes.position.array),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new ti);const e=this.attributes.instanceStart,t=this.attributes.instanceEnd;e!==void 0&&t!==void 0&&(this.boundingBox.setFromBufferAttribute(e),K9.setFromBufferAttribute(t),this.boundingBox.union(K9))}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Bi),this.boundingBox===null&&this.computeBoundingBox();const e=this.attributes.instanceStart,t=this.attributes.instanceEnd;if(e!==void 0&&t!==void 0){const n=this.boundingSphere.center;this.boundingBox.getCenter(n);let r=0;for(let s=0,o=e.count;s<o;s++)OE.fromBufferAttribute(e,s),r=Math.max(r,n.distanceToSquared(OE)),OE.fromBufferAttribute(t,s),r=Math.max(r,n.distanceToSquared(OE));this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error("THREE.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}toJSON(){}applyMatrix(e){return console.warn("THREE.LineSegmentsGeometry: applyMatrix() has been renamed to applyMatrix4()."),this.applyMatrix4(e)}}class QH extends u4{constructor(){super(),this.isLineGeometry=!0,this.type="LineGeometry"}setPositions(e){const t=e.length-3,n=new Float32Array(2*t);for(let r=0;r<t;r+=3)n[2*r]=e[r],n[2*r+1]=e[r+1],n[2*r+2]=e[r+2],n[2*r+3]=e[r+3],n[2*r+4]=e[r+4],n[2*r+5]=e[r+5];return super.setPositions(n),this}setColors(e,t=3){const n=e.length-t,r=new Float32Array(2*n);if(t===3)for(let s=0;s<n;s+=t)r[2*s]=e[s],r[2*s+1]=e[s+1],r[2*s+2]=e[s+2],r[2*s+3]=e[s+3],r[2*s+4]=e[s+4],r[2*s+5]=e[s+5];else for(let s=0;s<n;s+=t)r[2*s]=e[s],r[2*s+1]=e[s+1],r[2*s+2]=e[s+2],r[2*s+3]=e[s+3],r[2*s+4]=e[s+4],r[2*s+5]=e[s+5],r[2*s+6]=e[s+6],r[2*s+7]=e[s+7];return super.setColors(r,t),this}fromLine(e){const t=e.geometry;return this.setPositions(t.attributes.position.array),this}}class h4 extends Mi{constructor(e){super({type:"LineMaterial",uniforms:rp.clone(rp.merge([Ot.common,Ot.fog,{worldUnits:{value:1},linewidth:{value:1},resolution:{value:new Ue(1,1)},dashOffset:{value:0},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}}])),vertexShader:`
				#include <common>
				#include <fog_pars_vertex>
				#include <logdepthbuf_pars_vertex>
				#include <clipping_planes_pars_vertex>

				uniform float linewidth;
				uniform vec2 resolution;

				attribute vec3 instanceStart;
				attribute vec3 instanceEnd;

				#ifdef USE_COLOR
					#ifdef USE_LINE_COLOR_ALPHA
						varying vec4 vLineColor;
						attribute vec4 instanceColorStart;
						attribute vec4 instanceColorEnd;
					#else
						varying vec3 vLineColor;
						attribute vec3 instanceColorStart;
						attribute vec3 instanceColorEnd;
					#endif
				#endif

				#ifdef WORLD_UNITS

					varying vec4 worldPos;
					varying vec3 worldStart;
					varying vec3 worldEnd;

					#ifdef USE_DASH

						varying vec2 vUv;

					#endif

				#else

					varying vec2 vUv;

				#endif

				#ifdef USE_DASH

					uniform float dashScale;
					attribute float instanceDistanceStart;
					attribute float instanceDistanceEnd;
					varying float vLineDistance;

				#endif

				void trimSegment( const in vec4 start, inout vec4 end ) {

					// trim end segment so it terminates between the camera plane and the near plane

					// conservative estimate of the near plane
					float a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column
					float b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column
					float nearEstimate = - 0.5 * b / a;

					float alpha = ( nearEstimate - start.z ) / ( end.z - start.z );

					end.xyz = mix( start.xyz, end.xyz, alpha );

				}

				void main() {

					#ifdef USE_COLOR

						vLineColor = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;

					#endif

					#ifdef USE_DASH

						vLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;
						vUv = uv;

					#endif

					float aspect = resolution.x / resolution.y;

					// camera space
					vec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );
					vec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );

					#ifdef WORLD_UNITS

						worldStart = start.xyz;
						worldEnd = end.xyz;

					#else

						vUv = uv;

					#endif

					// special case for perspective projection, and segments that terminate either in, or behind, the camera plane
					// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space
					// but we need to perform ndc-space calculations in the shader, so we must address this issue directly
					// perhaps there is a more elegant solution -- WestLangley

					bool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column

					if ( perspective ) {

						if ( start.z < 0.0 && end.z >= 0.0 ) {

							trimSegment( start, end );

						} else if ( end.z < 0.0 && start.z >= 0.0 ) {

							trimSegment( end, start );

						}

					}

					// clip space
					vec4 clipStart = projectionMatrix * start;
					vec4 clipEnd = projectionMatrix * end;

					// ndc space
					vec3 ndcStart = clipStart.xyz / clipStart.w;
					vec3 ndcEnd = clipEnd.xyz / clipEnd.w;

					// direction
					vec2 dir = ndcEnd.xy - ndcStart.xy;

					// account for clip-space aspect ratio
					dir.x *= aspect;
					dir = normalize( dir );

					#ifdef WORLD_UNITS

						// get the offset direction as perpendicular to the view vector
						vec3 worldDir = normalize( end.xyz - start.xyz );
						vec3 offset;
						if ( position.y < 0.5 ) {

							offset = normalize( cross( start.xyz, worldDir ) );

						} else {

							offset = normalize( cross( end.xyz, worldDir ) );

						}

						// sign flip
						if ( position.x < 0.0 ) offset *= - 1.0;

						float forwardOffset = dot( worldDir, vec3( 0.0, 0.0, 1.0 ) );

						// don't extend the line if we're rendering dashes because we
						// won't be rendering the endcaps
						#ifndef USE_DASH

							// extend the line bounds to encompass  endcaps
							start.xyz += - worldDir * linewidth * 0.5;
							end.xyz += worldDir * linewidth * 0.5;

							// shift the position of the quad so it hugs the forward edge of the line
							offset.xy -= dir * forwardOffset;
							offset.z += 0.5;

						#endif

						// endcaps
						if ( position.y > 1.0 || position.y < 0.0 ) {

							offset.xy += dir * 2.0 * forwardOffset;

						}

						// adjust for linewidth
						offset *= linewidth * 0.5;

						// set the world position
						worldPos = ( position.y < 0.5 ) ? start : end;
						worldPos.xyz += offset;

						// project the worldpos
						vec4 clip = projectionMatrix * worldPos;

						// shift the depth of the projected points so the line
						// segments overlap neatly
						vec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;
						clip.z = clipPose.z * clip.w;

					#else

						vec2 offset = vec2( dir.y, - dir.x );
						// undo aspect ratio adjustment
						dir.x /= aspect;
						offset.x /= aspect;

						// sign flip
						if ( position.x < 0.0 ) offset *= - 1.0;

						// endcaps
						if ( position.y < 0.0 ) {

							offset += - dir;

						} else if ( position.y > 1.0 ) {

							offset += dir;

						}

						// adjust for linewidth
						offset *= linewidth;

						// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...
						offset /= resolution.y;

						// select end
						vec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;

						// back to clip space
						offset *= clip.w;

						clip.xy += offset;

					#endif

					gl_Position = clip;

					vec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation

					#include <logdepthbuf_vertex>
					#include <clipping_planes_vertex>
					#include <fog_vertex>

				}
			`,fragmentShader:`
				uniform vec3 diffuse;
				uniform float opacity;
				uniform float linewidth;

				#ifdef USE_DASH

					uniform float dashOffset;
					uniform float dashSize;
					uniform float gapSize;

				#endif

				varying float vLineDistance;

				#ifdef WORLD_UNITS

					varying vec4 worldPos;
					varying vec3 worldStart;
					varying vec3 worldEnd;

					#ifdef USE_DASH

						varying vec2 vUv;

					#endif

				#else

					varying vec2 vUv;

				#endif

				#include <common>
				#include <fog_pars_fragment>
				#include <logdepthbuf_pars_fragment>
				#include <clipping_planes_pars_fragment>

				#ifdef USE_COLOR
					#ifdef USE_LINE_COLOR_ALPHA
						varying vec4 vLineColor;
					#else
						varying vec3 vLineColor;
					#endif
				#endif

				vec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {

					float mua;
					float mub;

					vec3 p13 = p1 - p3;
					vec3 p43 = p4 - p3;

					vec3 p21 = p2 - p1;

					float d1343 = dot( p13, p43 );
					float d4321 = dot( p43, p21 );
					float d1321 = dot( p13, p21 );
					float d4343 = dot( p43, p43 );
					float d2121 = dot( p21, p21 );

					float denom = d2121 * d4343 - d4321 * d4321;

					float numer = d1343 * d4321 - d1321 * d4343;

					mua = numer / denom;
					mua = clamp( mua, 0.0, 1.0 );
					mub = ( d1343 + d4321 * ( mua ) ) / d4343;
					mub = clamp( mub, 0.0, 1.0 );

					return vec2( mua, mub );

				}

				void main() {

					#include <clipping_planes_fragment>

					#ifdef USE_DASH

						if ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps

						if ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX

					#endif

					float alpha = opacity;

					#ifdef WORLD_UNITS

						// Find the closest points on the view ray and the line segment
						vec3 rayEnd = normalize( worldPos.xyz ) * 1e5;
						vec3 lineDir = worldEnd - worldStart;
						vec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );

						vec3 p1 = worldStart + lineDir * params.x;
						vec3 p2 = rayEnd * params.y;
						vec3 delta = p1 - p2;
						float len = length( delta );
						float norm = len / linewidth;

						#ifndef USE_DASH

							#ifdef USE_ALPHA_TO_COVERAGE

								float dnorm = fwidth( norm );
								alpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );

							#else

								if ( norm > 0.5 ) {

									discard;

								}

							#endif

						#endif

					#else

						#ifdef USE_ALPHA_TO_COVERAGE

							// artifacts appear on some hardware if a derivative is taken within a conditional
							float a = vUv.x;
							float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
							float len2 = a * a + b * b;
							float dlen = fwidth( len2 );

							if ( abs( vUv.y ) > 1.0 ) {

								alpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );

							}

						#else

							if ( abs( vUv.y ) > 1.0 ) {

								float a = vUv.x;
								float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
								float len2 = a * a + b * b;

								if ( len2 > 1.0 ) discard;

							}

						#endif

					#endif

					vec4 diffuseColor = vec4( diffuse, alpha );
					#ifdef USE_COLOR
						#ifdef USE_LINE_COLOR_ALPHA
							diffuseColor *= vLineColor;
						#else
							diffuseColor.rgb *= vLineColor;
						#endif
					#endif

					#include <logdepthbuf_fragment>

					gl_FragColor = diffuseColor;

					#include <tonemapping_fragment>
					#include <${RA>=154?"colorspace_fragment":"encodings_fragment"}>
					#include <fog_fragment>
					#include <premultiplied_alpha_fragment>

				}
			`,clipping:!0}),this.isLineMaterial=!0,this.onBeforeCompile=function(){this.transparent?this.defines.USE_LINE_COLOR_ALPHA="1":delete this.defines.USE_LINE_COLOR_ALPHA},Object.defineProperties(this,{color:{enumerable:!0,get:function(){return this.uniforms.diffuse.value},set:function(t){this.uniforms.diffuse.value=t}},worldUnits:{enumerable:!0,get:function(){return"WORLD_UNITS"in this.defines},set:function(t){t===!0?this.defines.WORLD_UNITS="":delete this.defines.WORLD_UNITS}},linewidth:{enumerable:!0,get:function(){return this.uniforms.linewidth.value},set:function(t){this.uniforms.linewidth.value=t}},dashed:{enumerable:!0,get:function(){return"USE_DASH"in this.defines},set(t){!!t!="USE_DASH"in this.defines&&(this.needsUpdate=!0),t===!0?this.defines.USE_DASH="":delete this.defines.USE_DASH}},dashScale:{enumerable:!0,get:function(){return this.uniforms.dashScale.value},set:function(t){this.uniforms.dashScale.value=t}},dashSize:{enumerable:!0,get:function(){return this.uniforms.dashSize.value},set:function(t){this.uniforms.dashSize.value=t}},dashOffset:{enumerable:!0,get:function(){return this.uniforms.dashOffset.value},set:function(t){this.uniforms.dashOffset.value=t}},gapSize:{enumerable:!0,get:function(){return this.uniforms.gapSize.value},set:function(t){this.uniforms.gapSize.value=t}},opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(t){this.uniforms.opacity.value=t}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function(t){this.uniforms.resolution.value.copy(t)}},alphaToCoverage:{enumerable:!0,get:function(){return"USE_ALPHA_TO_COVERAGE"in this.defines},set:function(t){!!t!="USE_ALPHA_TO_COVERAGE"in this.defines&&(this.needsUpdate=!0),t===!0?(this.defines.USE_ALPHA_TO_COVERAGE="",this.extensions.derivatives=!0):(delete this.defines.USE_ALPHA_TO_COVERAGE,this.extensions.derivatives=!1)}}}),this.setValues(e)}}const fb=new Rn,Y9=new Q,$9=new Q,Lo=new Rn,Bo=new Rn,eh=new Rn,db=new Q,pb=new Xe,Fo=new Eu,X9=new Q,NE=new ti,UE=new Bi,th=new Rn;let gh,Qm;function q9(i,e,t){return th.set(0,0,-e,1).applyMatrix4(i.projectionMatrix),th.multiplyScalar(1/th.w),th.x=Qm/t.width,th.y=Qm/t.height,th.applyMatrix4(i.projectionMatrixInverse),th.multiplyScalar(1/th.w),Math.abs(Math.max(th.x,th.y))}function ghe(i,e){const t=i.matrixWorld,n=i.geometry,r=n.attributes.instanceStart,s=n.attributes.instanceEnd,o=Math.min(n.instanceCount,r.count);for(let a=0,l=o;a<l;a++){Fo.start.fromBufferAttribute(r,a),Fo.end.fromBufferAttribute(s,a),Fo.applyMatrix4(t);const c=new Q,u=new Q;gh.distanceSqToSegment(Fo.start,Fo.end,u,c),u.distanceTo(c)<Qm*.5&&e.push({point:u,pointOnLine:c,distance:gh.origin.distanceTo(u),object:i,face:null,faceIndex:a,uv:null,[MR]:null})}}function Ahe(i,e,t){const n=e.projectionMatrix,s=i.material.resolution,o=i.matrixWorld,a=i.geometry,l=a.attributes.instanceStart,c=a.attributes.instanceEnd,u=Math.min(a.instanceCount,l.count),h=-e.near;gh.at(1,eh),eh.w=1,eh.applyMatrix4(e.matrixWorldInverse),eh.applyMatrix4(n),eh.multiplyScalar(1/eh.w),eh.x*=s.x/2,eh.y*=s.y/2,eh.z=0,db.copy(eh),pb.multiplyMatrices(e.matrixWorldInverse,o);for(let f=0,d=u;f<d;f++){if(Lo.fromBufferAttribute(l,f),Bo.fromBufferAttribute(c,f),Lo.w=1,Bo.w=1,Lo.applyMatrix4(pb),Bo.applyMatrix4(pb),Lo.z>h&&Bo.z>h)continue;if(Lo.z>h){const x=Lo.z-Bo.z,w=(Lo.z-h)/x;Lo.lerp(Bo,w)}else if(Bo.z>h){const x=Bo.z-Lo.z,w=(Bo.z-h)/x;Bo.lerp(Lo,w)}Lo.applyMatrix4(n),Bo.applyMatrix4(n),Lo.multiplyScalar(1/Lo.w),Bo.multiplyScalar(1/Bo.w),Lo.x*=s.x/2,Lo.y*=s.y/2,Bo.x*=s.x/2,Bo.y*=s.y/2,Fo.start.copy(Lo),Fo.start.z=0,Fo.end.copy(Bo),Fo.end.z=0;const y=Fo.closestPointToPointParameter(db,!0);Fo.at(y,X9);const g=un.lerp(Lo.z,Bo.z,y),A=g>=-1&&g<=1,E=db.distanceTo(X9)<Qm*.5;if(A&&E){Fo.start.fromBufferAttribute(l,f),Fo.end.fromBufferAttribute(c,f),Fo.start.applyMatrix4(o),Fo.end.applyMatrix4(o);const x=new Q,w=new Q;gh.distanceSqToSegment(Fo.start,Fo.end,w,x),t.push({point:w,pointOnLine:x,distance:gh.origin.distanceTo(w),object:i,face:null,faceIndex:f,uv:null,[MR]:null})}}}class VH extends It{constructor(e=new u4,t=new h4({color:Math.random()*16777215})){super(e,t),this.isLineSegments2=!0,this.type="LineSegments2"}computeLineDistances(){const e=this.geometry,t=e.attributes.instanceStart,n=e.attributes.instanceEnd,r=new Float32Array(2*t.count);for(let o=0,a=0,l=t.count;o<l;o++,a+=2)Y9.fromBufferAttribute(t,o),$9.fromBufferAttribute(n,o),r[a]=a===0?0:r[a-1],r[a+1]=r[a]+Y9.distanceTo($9);const s=new LS(r,2,1);return e.setAttribute("instanceDistanceStart",new Ja(s,1,0)),e.setAttribute("instanceDistanceEnd",new Ja(s,1,1)),this}raycast(e,t){const n=this.material.worldUnits,r=e.camera;r===null&&!n&&console.error('LineSegments2: "Raycaster.camera" needs to be set in order to raycast against LineSegments2 while worldUnits is set to false.');const s=e.params.Line2!==void 0&&e.params.Line2.threshold||0;gh=e.ray;const o=this.matrixWorld,a=this.geometry,l=this.material;Qm=l.linewidth+s,a.boundingSphere===null&&a.computeBoundingSphere(),UE.copy(a.boundingSphere).applyMatrix4(o);let c;if(n)c=Qm*.5;else{const h=Math.max(r.near,UE.distanceToPoint(gh.origin));c=q9(r,h,l.resolution)}if(UE.radius+=c,gh.intersectsSphere(UE)===!1)return;a.boundingBox===null&&a.computeBoundingBox(),NE.copy(a.boundingBox).applyMatrix4(o);let u;if(n)u=Qm*.5;else{const h=Math.max(r.near,NE.distanceToPoint(gh.origin));u=q9(r,h,l.resolution)}NE.expandByScalar(u),gh.intersectsBox(NE)!==!1&&(n?ghe(this,t):Ahe(this,r,t))}onBeforeRender(e){const t=this.material.uniforms;t&&t.resolution&&(e.getViewport(fb),this.material.uniforms.resolution.value.set(fb.z,fb.w))}}class jH extends VH{constructor(e=new QH,t=new h4({color:Math.random()*16777215})){super(e,t),this.isLine2=!0,this.type="Line2"}}let zE;const mb=()=>{if(zE)return zE;const i="B9h9z9tFBBBF8fL9gBB9gLaaaaaFa9gEaaaB9gFaFa9gEaaaFaEMcBFFFGGGEIIILF9wFFFLEFBFKNFaFCx/IFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBF8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBGy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBEn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBIi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBKI9z9iqlBOc+x8ycGBM/qQFTa8jUUUUBCU/EBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAGTkUUUBRNCUoBAG9uC/wgBZHKCUGAKCUG9JyRVAECFJRICBRcGXEXAcAF9PQFAVAFAclAcAVJAF9JyRMGXGXAG9FQBAMCbJHKC9wZRSAKCIrCEJCGrRQANCUGJRfCBRbAIRTEXGXAOATlAQ9PQBCBRISEMATAQJRIGXAS9FQBCBRtCBREEXGXAOAIlCi9PQBCBRISLMANCU/CBJAEJRKGXGXGXGXGXATAECKrJ2BBAtCKZrCEZfIBFGEBMAKhB83EBAKCNJhB83EBSEMAKAI2BIAI2BBHmCKrHYAYCE6HYy86BBAKCFJAICIJAYJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCGJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCEJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCIJAYAmJHY2BBAI2BFHmCKrHPAPCE6HPy86BBAKCLJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCKJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCOJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCNJAYAmJHY2BBAI2BGHmCKrHPAPCE6HPy86BBAKCVJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCcJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCMJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCSJAYAmJHm2BBAI2BEHICKrHYAYCE6HYy86BBAKCQJAmAYJHm2BBAICIrCEZHYAYCE6HYy86BBAKCfJAmAYJHm2BBAICGrCEZHYAYCE6HYy86BBAKCbJAmAYJHK2BBAICEZHIAICE6HIy86BBAKAIJRISGMAKAI2BNAI2BBHmCIrHYAYCb6HYy86BBAKCFJAICNJAYJHY2BBAmCbZHmAmCb6Hmy86BBAKCGJAYAmJHm2BBAI2BFHYCIrHPAPCb6HPy86BBAKCEJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCIJAmAYJHm2BBAI2BGHYCIrHPAPCb6HPy86BBAKCLJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCKJAmAYJHm2BBAI2BEHYCIrHPAPCb6HPy86BBAKCOJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCNJAmAYJHm2BBAI2BIHYCIrHPAPCb6HPy86BBAKCVJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCcJAmAYJHm2BBAI2BLHYCIrHPAPCb6HPy86BBAKCMJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCSJAmAYJHm2BBAI2BKHYCIrHPAPCb6HPy86BBAKCQJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCfJAmAYJHm2BBAI2BOHICIrHYAYCb6HYy86BBAKCbJAmAYJHK2BBAICbZHIAICb6HIy86BBAKAIJRISFMAKAI8pBB83BBAKCNJAICNJ8pBB83BBAICTJRIMAtCGJRtAECTJHEAS9JQBMMGXAIQBCBRISEMGXAM9FQBANAbJ2BBRtCBRKAfREEXAEANCU/CBJAKJ2BBHTCFrCBATCFZl9zAtJHt86BBAEAGJREAKCFJHKAM9HQBMMAfCFJRfAIRTAbCFJHbAG9HQBMMABAcAG9sJANCUGJAMAG9sTkUUUBpANANCUGJAMCaJAG9sJAGTkUUUBpMAMCBAIyAcJRcAIQBMC9+RKSFMCBC99AOAIlAGCAAGCA9Ly6yRKMALCU/EBJ8kUUUUBAKM+OmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUFT+JUUUBpALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM+lLKFaF99GaG99FaG99GXGXAGCI9HQBAF9FQFEXGXGX9DBBB8/9DBBB+/ABCGJHG1BB+yAB1BBHE+yHI+L+TABCFJHL1BBHK+yHO+L+THN9DBBBB9gHVyAN9DBB/+hANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE86BBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG86BBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG86BBABCIJRBAFCaJHFQBSGMMAF9FQBEXGXGX9DBBB8/9DBBB+/ABCIJHG8uFB+yAB8uFBHE+yHI+L+TABCGJHL8uFBHK+yHO+L+THN9DBBBB9gHVyAN9DB/+g6ANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE87FBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG87FBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG87FBABCNJRBAFCaJHFQBMMM/SEIEaE99EaF99GXAF9FQBCBREABRIEXGXGX9D/zI818/AICKJ8uFBHLCEq+y+VHKAI8uFB+y+UHO9DB/+g6+U9DBBB8/9DBBB+/AO9DBBBB9gy+SHN+L9DBBB9P9d9FQBAN+oRVSFMCUUUU94RVMAICIJ8uFBRcAICGJ8uFBRMABALCFJCEZAEqCFWJAV87FBGXGXAKAM+y+UHN9DB/+g6+U9DBBB8/9DBBB+/AN9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRMSFMCUUUU94RMMABALCGJCEZAEqCFWJAM87FBGXGXAKAc+y+UHK9DB/+g6+U9DBBB8/9DBBB+/AK9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRcSFMCUUUU94RcMABALCaJCEZAEqCFWJAc87FBGXGX9DBBU8/AOAO+U+TANAN+U+TAKAK+U+THO9DBBBBAO9DBBBB9gy+R9DB/+g6+U9DBBB8/+SHO+L9DBBB9P9d9FQBAO+oRcSFMCUUUU94RcMABALCEZAEqCFWJAc87FBAICNJRIAECIJREAFCaJHFQBMMM9JBGXAGCGrAF9sHF9FQBEXABAB8oGBHGCNWCN91+yAGCi91CnWCUUU/8EJ+++U84GBABCIJRBAFCaJHFQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEM/lFFFaGXGXAFABqCEZ9FQBABRESFMGXGXAGCT9PQBABRESFMABREEXAEAF8oGBjGBAECIJAFCIJ8oGBjGBAECNJAFCNJ8oGBjGBAECSJAFCSJ8oGBjGBAECTJREAFCTJRFAGC9wJHGCb9LQBMMAGCI9JQBEXAEAF8oGBjGBAFCIJRFAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF2BB86BBAECFJREAFCFJRFAGCaJHGQBMMABMoFFGaGXGXABCEZ9FQBABRESFMAFCgFZC+BwsN9sRIGXGXAGCT9PQBABRESFMABREEXAEAIjGBAECSJAIjGBAECNJAIjGBAECIJAIjGBAECTJREAGC9wJHGCb9LQBMMAGCI9JQBEXAEAIjGBAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF86BBAECFJREAGCaJHGQBMMABMMMFBCUNMIT9kBB",e="B9h9z9tFBBBFiI9gBB9gLaaaaaFa9gEaaaB9gFaFaEMcBBFBFFGGGEILF9wFFFLEFBFKNFaFCx/aFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBG8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBIy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBKi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBOn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBNI9z9iqlBVc+N9IcIBTEM9+FLa8jUUUUBCTlRBCBRFEXCBRGCBREEXABCNJAGJAECUaAFAGrCFZHIy86BBAEAIJREAGCFJHGCN9HQBMAFCx+YUUBJAE86BBAFCEWCxkUUBJAB8pEN83EBAFCFJHFCUG9HQBMMk8lLbaE97F9+FaL978jUUUUBCU/KBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAG/8cBBCUoBAG9uC/wgBZHKCUGAKCUG9JyRNAECFJRKCBRVGXEXAVAF9PQFANAFAVlAVANJAF9JyRcGXGXAG9FQBAcCbJHIC9wZHMCE9sRSAMCFWRQAICIrCEJCGrRfCBRbEXAKRTCBRtGXEXGXAOATlAf9PQBCBRKSLMALCU/CBJAtAM9sJRmATAfJRKCBREGXAMCoB9JQBAOAKlC/gB9JQBCBRIEXAmAIJREGXGXGXGXGXATAICKrJ2BBHYCEZfIBFGEBMAECBDtDMIBSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAEAKDBBBDMIBAKCTJRKMGXGXGXGXGXAYCGrCEZfIBFGEBMAECBDtDMITSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAEAKDBBBDMITAKCTJRKMGXGXGXGXGXAYCIrCEZfIBFGEBMAECBDtDMIASEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAEAKDBBBDMIAAKCTJRKMGXGXGXGXGXAYCKrfIBFGEBMAECBDtDMI8wSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCIJAeDeBJAYCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCNJAeDeBJAYCx+YUUBJ2BBJRKSFMAEAKDBBBDMI8wAKCTJRKMAICoBJREAICUFJAM9LQFAERIAOAKlC/fB9LQBMMGXAEAM9PQBAECErRIEXGXAOAKlCi9PQBCBRKSOMAmAEJRYGXGXGXGXGXATAECKrJ2BBAICKZrCEZfIBFGEBMAYCBDtDMIBSEMAYAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAYAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAYAKDBBBDMIBAKCTJRKMAICGJRIAECTJHEAM9JQBMMGXAK9FQBAKRTAtCFJHtCI6QGSFMMCBRKSEMGXAM9FQBALCUGJAbJREALAbJDBGBReCBRYEXAEALCU/CBJAYJHIDBIBHdCFD9tAdCFDbHPD9OD9hD9RHdAIAMJDBIBH8ZCFD9tA8ZAPD9OD9hD9RH8ZDQBTFtGmEYIPLdKeOnHpAIAQJDBIBHyCFD9tAyAPD9OD9hD9RHyAIASJDBIBH8cCFD9tA8cAPD9OD9hD9RH8cDQBTFtGmEYIPLdKeOnH8dDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGEAeD9uHeDyBjGBAEAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJHIAeApA8dDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHeDyBjGBAIAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJHIAeAdA8ZDQNiV8ZcpMyS8cQ8df8eb8fHdAyA8cDQNiV8ZcpMyS8cQ8df8eb8fH8ZDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGED9uHeDyBjGBAIAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJHIAeAdA8ZDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHeDyBjGBAIAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJREAYCTJHYAM9JQBMMAbCIJHbAG9JQBMMABAVAG9sJALCUGJAcAG9s/8cBBALALCUGJAcCaJAG9sJAG/8cBBMAcCBAKyAVJRVAKQBMC9+RKSFMCBC99AOAKlAGCAAGCA9Ly6yRKMALCU/KBJ8kUUUUBAKMNBT+BUUUBM+KmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUF/8MBALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM/dLEK97FaF97GXGXAGCI9HQBAF9FQFCBRGEXABABDBBBHECiD+rFCiD+sFD/6FHIAECND+rFCiD+sFD/6FAID/gFAECTD+rFCiD+sFD/6FHLD/gFD/kFD/lFHKCBDtD+2FHOAICUUUU94DtHND9OD9RD/kFHI9DBB/+hDYAIAID/mFAKAKD/mFALAOALAND9OD9RD/kFHIAID/mFD/kFD/kFD/jFD/nFHLD/mF9DBBX9LDYHOD/kFCgFDtD9OAECUUU94DtD9OD9QAIALD/mFAOD/kFCND+rFCU/+EDtD9OD9QAKALD/mFAOD/kFCTD+rFCUU/8ODtD9OD9QDMBBABCTJRBAGCIJHGAF9JQBSGMMAF9FQBCBRGEXABCTJHVAVDBBBHECBDtHOCUU98D8cFCUU98D8cEHND9OABDBBBHKAEDQILKOSQfbPden8c8d8e8fCggFDtD9OD/6FAKAEDQBFGENVcMTtmYi8ZpyHECTD+sFD/6FHID/gFAECTD+rFCTD+sFD/6FHLD/gFD/kFD/lFHE9DB/+g6DYALAEAOD+2FHOALCUUUU94DtHcD9OD9RD/kFHLALD/mFAEAED/mFAIAOAIAcD9OD9RD/kFHEAED/mFD/kFD/kFD/jFD/nFHID/mF9DBBX9LDYHOD/kFCTD+rFALAID/mFAOD/kFCggEDtD9OD9QHLAEAID/mFAOD/kFCaDbCBDnGCBDnECBDnKCBDnOCBDncCBDnMCBDnfCBDnbD9OHEDQNVi8ZcMpySQ8c8dfb8e8fD9QDMBBABAKAND9OALAEDQBFTtGEmYILPdKOenD9QDMBBABCAJRBAGCIJHGAF9JQBMMM/hEIGaF97FaL978jUUUUBCTlREGXAF9FQBCBRIEXAEABDBBBHLABCTJHKDBBBHODQILKOSQfbPden8c8d8e8fHNCTD+sFHVCID+rFDMIBAB9DBBU8/DY9D/zI818/DYAVCEDtD9QD/6FD/nFHVALAODQBFGENVcMTtmYi8ZpyHLCTD+rFCTD+sFD/6FD/mFHOAOD/mFAVALCTD+sFD/6FD/mFHcAcD/mFAVANCTD+rFCTD+sFD/6FD/mFHNAND/mFD/kFD/kFD/lFCBDtD+4FD/jF9DB/+g6DYHVD/mF9DBBX9LDYHLD/kFCggEDtHMD9OAcAVD/mFALD/kFCTD+rFD9QHcANAVD/mFALD/kFCTD+rFAOAVD/mFALD/kFAMD9OD9QHVDQBFTtGEmYILPdKOenHLD8dBAEDBIBDyB+t+J83EBABCNJALD8dFAEDBIBDyF+t+J83EBAKAcAVDQNVi8ZcMpySQ8c8dfb8e8fHVD8dBAEDBIBDyG+t+J83EBABCiJAVD8dFAEDBIBDyE+t+J83EBABCAJRBAICIJHIAF9JQBMMM9jFF97GXAGCGrAF9sHG9FQBCBRFEXABABDBBBHECND+rFCND+sFD/6FAECiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMBBABCTJRBAFCIJHFAG9JQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEMMMFBCUNMIT9tBB",t=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),n=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]);if(typeof WebAssembly!="object")return{supported:!1};let r=i;WebAssembly.validate(t)&&(r=e);let s;const o=WebAssembly.instantiate(a(r),{}).then(h=>{s=h.instance,s.exports.__wasm_call_ctors()});function a(h){const f=new Uint8Array(h.length);for(let m=0;m<h.length;++m){const y=h.charCodeAt(m);f[m]=y>96?y-71:y>64?y-65:y>47?y+4:y>46?63:62}let d=0;for(let m=0;m<h.length;++m)f[d++]=f[m]<60?n[f[m]]:(f[m]-60)*64+f[++m];return f.buffer.slice(0,d)}function l(h,f,d,m,y,g){const A=s.exports.sbrk,E=d+3&-4,x=A(E*m),w=A(y.length),T=new Uint8Array(s.exports.memory.buffer);T.set(y,w);const I=h(x,d,m,w,y.length);if(I===0&&g&&g(x,E,m),f.set(T.subarray(x,x+d*m)),A(x-A(0)),I!==0)throw new Error(`Malformed buffer data: ${I}`)}const c={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},u={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return zE={ready:o,supported:!0,decodeVertexBuffer(h,f,d,m,y){l(s.exports.meshopt_decodeVertexBuffer,h,f,d,m,s.exports[c[y]])},decodeIndexBuffer(h,f,d,m){l(s.exports.meshopt_decodeIndexBuffer,h,f,d,m)},decodeIndexSequence(h,f,d,m){l(s.exports.meshopt_decodeIndexSequence,h,f,d,m)},decodeGltfBuffer(h,f,d,m,y,g){l(s.exports[u[y]],h,f,d,m,s.exports[c[g]])}},zE},J9=i=>Symbol.iterator in i,Z9=i=>"entries"in i,e7=(i,e)=>{const t=i instanceof Map?i:new Map(i.entries()),n=e instanceof Map?e:new Map(e.entries());if(t.size!==n.size)return!1;for(const[r,s]of t)if(!n.has(r)||!Object.is(s,n.get(r)))return!1;return!0},yhe=(i,e)=>{const t=i[Symbol.iterator](),n=e[Symbol.iterator]();let r=t.next(),s=n.next();for(;!r.done&&!s.done;){if(!Object.is(r.value,s.value))return!1;r=t.next(),s=n.next()}return!!r.done&&!!s.done};function vhe(i,e){return Object.is(i,e)?!0:typeof i!="object"||i===null||typeof e!="object"||e===null||Object.getPrototypeOf(i)!==Object.getPrototypeOf(e)?!1:J9(i)&&J9(e)?Z9(i)&&Z9(e)?e7(i,e):yhe(i,e):e7({entries:()=>Object.entries(i)},{entries:()=>Object.entries(e)})}const WH=C.createContext([]);function xhe({box:i,multiple:e,children:t,onChange:n,onChangePointerUp:r,border:s="1px solid #55aaff",backgroundColor:o="rgba(75, 160, 255, 0.1)",filter:a=c=>c,...l}){const[c,u]=C.useState(!1),{setEvents:h,camera:f,raycaster:d,gl:m,controls:y,size:g,get:A}=Ve(),[E,x]=C.useState(!1),[w,T]=C.useReducer((P,{object:R,shift:U})=>R===void 0?[]:Array.isArray(R)?R:U?P.includes(R)?P.filter(k=>k!==R):[R,...P]:P[0]===R?[]:[R],[]);C.useEffect(()=>{c?n==null||n(w):r==null||r(w)},[w,c]);const I=C.useCallback(P=>{P.stopPropagation(),T({object:a([P.object])[0],shift:e&&P.shiftKey})},[]),M=C.useCallback(P=>!E&&T({}),[E]),L=C.useRef(null);return C.useEffect(()=>{if(!i||!e)return;const P=new gue(f,L.current),R=document.createElement("div");R.style.pointerEvents="none",R.style.border=s,R.style.backgroundColor=o,R.style.position="fixed";const U=new Ue,k=new Ue,H=new Ue,G=A().events.enabled,X=y==null?void 0:y.enabled;let Z=!1;function oe(J,re){const{offsetX:ie,offsetY:se}=J,{width:ge,height:xe}=g;re.set(ie/ge*2-1,-(se/xe)*2+1)}function K(J){var re;y&&(y.enabled=!1),h({enabled:!1}),u(Z=!0),(re=m.domElement.parentElement)==null||re.appendChild(R),R.style.left=`${J.clientX}px`,R.style.top=`${J.clientY}px`,R.style.width="0px",R.style.height="0px",U.x=J.clientX,U.y=J.clientY}function V(J){H.x=Math.max(U.x,J.clientX),H.y=Math.max(U.y,J.clientY),k.x=Math.min(U.x,J.clientX),k.y=Math.min(U.y,J.clientY),R.style.left=`${k.x}px`,R.style.top=`${k.y}px`,R.style.width=`${H.x-k.x}px`,R.style.height=`${H.y-k.y}px`}function W(){if(Z){var J;y&&(y.enabled=X),h({enabled:G}),u(Z=!1),(J=R.parentElement)==null||J.removeChild(R)}}function F(J){J.shiftKey&&(K(J),oe(J,P.startPoint))}let Y=[];function te(J){if(Z){V(J),oe(J,P.endPoint);const re=P.select().sort(ie=>ie.uuid).filter(ie=>ie.isMesh);vhe(re,Y)||(Y=re,T({object:a(re)}))}}function q(J){Z&&W()}return document.addEventListener("pointerdown",F,{passive:!0}),document.addEventListener("pointermove",te,{passive:!0,capture:!0}),document.addEventListener("pointerup",q,{passive:!0}),()=>{document.removeEventListener("pointerdown",F),document.removeEventListener("pointermove",te,!0),document.removeEventListener("pointerup",q)}},[g.width,g.height,d,f,y,m]),C.createElement("group",ot({ref:L,onClick:I,onPointerOver:()=>x(!0),onPointerOut:()=>x(!1),onPointerMissed:M},l),C.createElement(WH.Provider,{value:w},t))}function Ehe(){return C.useContext(WH)}const KH=C.forwardRef(function({children:e,follow:t=!0,lockX:n=!1,lockY:r=!1,lockZ:s=!1,...o},a){const l=C.useRef(null),c=C.useRef(null),u=new Xt;return Kt(({camera:h})=>{if(!t||!c.current)return;const f=l.current.rotation.clone();c.current.updateMatrix(),c.current.updateWorldMatrix(!1,!1),c.current.getWorldQuaternion(u),h.getWorldQuaternion(l.current.quaternion).premultiply(u.invert()),n&&(l.current.rotation.x=f.x),r&&(l.current.rotation.y=f.y),s&&(l.current.rotation.z=f.z)}),C.useImperativeHandle(a,()=>c.current,[]),C.createElement("group",ot({ref:c},o),C.createElement("group",{ref:l},e))}),_he=C.forwardRef(({children:i,depth:e=-1,...t},n)=>{const r=C.useRef(null);return C.useImperativeHandle(n,()=>r.current,[]),Kt(({camera:s})=>{r.current.quaternion.copy(s.quaternion),r.current.position.copy(s.position)}),C.createElement("group",ot({ref:r},t),C.createElement("group",{"position-z":-e},i))}),She=new Q,whe=new Q,Che=new Q,The=(i,e,t)=>{const n=t.width/2,r=t.height/2;e.updateMatrixWorld(!1);const s=i.project(e);return s.x=s.x*n+n,s.y=-(s.y*r)+r,s},bhe=(i,e,t,n=1)=>{const r=She.set(i.x/t.width*2-1,-(i.y/t.height)*2+1,n);return r.unproject(e),r},f4=(i,e,t,n)=>{const r=The(Che.copy(i),t,n);let s=0;for(let o=0;o<2;++o){const a=whe.copy(r).setComponent(o,r.getComponent(o)+e),l=bhe(a,t,n,a.z);s=Math.max(s,i.distanceTo(l))}return s},Ihe=new Q,Mhe=C.forwardRef(({scale:i=1,...e},t)=>{const n=C.useRef(null);return C.useImperativeHandle(t,()=>n.current,[]),Kt(r=>{const s=n.current;if(!s)return;const o=f4(s.getWorldPosition(Ihe),i,r.camera,r.size);s.scale.setScalar(o*i)}),C.createElement("object3D",ot({ref:n},e))}),Cu=C.forwardRef(function({points:e,color:t=16777215,vertexColors:n,linewidth:r,lineWidth:s,segments:o,dashed:a,...l},c){var u,h;const f=Ve(A=>A.size),d=C.useMemo(()=>o?new VH:new jH,[o]),[m]=C.useState(()=>new h4),y=(n==null||(u=n[0])==null?void 0:u.length)===4?4:3,g=C.useMemo(()=>{const A=o?new u4:new QH,E=e.map(x=>{const w=Array.isArray(x);return x instanceof Q||x instanceof Rn?[x.x,x.y,x.z]:x instanceof Ue?[x.x,x.y,0]:w&&x.length===3?[x[0],x[1],x[2]]:w&&x.length===2?[x[0],x[1],0]:x});if(A.setPositions(E.flat()),n){t=16777215;const x=n.map(w=>w instanceof ut?w.toArray():w);A.setColors(x.flat(),y)}return A},[e,o,n,y]);return C.useLayoutEffect(()=>{d.computeLineDistances()},[e,d]),C.useLayoutEffect(()=>{a?m.defines.USE_DASH="":delete m.defines.USE_DASH,m.needsUpdate=!0},[a,m]),C.useEffect(()=>()=>{g.dispose(),m.dispose()},[g]),C.createElement("primitive",ot({object:d,ref:c},l),C.createElement("primitive",{object:g,attach:"geometry"}),C.createElement("primitive",ot({object:m,attach:"material",color:t,vertexColors:!!n,resolution:[f.width,f.height],linewidth:(h=r??s)!==null&&h!==void 0?h:1,dashed:a,transparent:y===4},l)))}),Rhe=new Q,Phe=C.forwardRef(function({start:e=[0,0,0],end:t=[0,0,0],mid:n,segments:r=20,...s},o){const a=C.useRef(null);C.useImperativeHandle(o,()=>a.current);const[l]=C.useState(()=>new kw(void 0,void 0,void 0)),c=C.useCallback((h,f,d,m=20)=>(h instanceof Q?l.v0.copy(h):l.v0.set(...h),f instanceof Q?l.v2.copy(f):l.v2.set(...f),d instanceof Q?l.v1.copy(d):Array.isArray(d)?l.v1.set(...d):l.v1.copy(l.v0.clone().add(l.v2.clone().sub(l.v0)).add(Rhe.set(0,l.v0.y-l.v2.y,0))),l.getPoints(m)),[]);C.useLayoutEffect(()=>{a.current.setPoints=(h,f,d)=>{const m=c(h,f,d);a.current.geometry&&a.current.geometry.setPositions(m.map(y=>y.toArray()).flat())}},[]);const u=C.useMemo(()=>c(e,t,n,r),[e,t,n,r]);return C.createElement(Cu,ot({ref:a,points:u},s))}),Lhe=C.forwardRef(function({start:e,end:t,midA:n,midB:r,segments:s=20,...o},a){const l=C.useMemo(()=>{const c=e instanceof Q?e:new Q(...e),u=t instanceof Q?t:new Q(...t),h=n instanceof Q?n:new Q(...n),f=r instanceof Q?r:new Q(...r);return new N6(c,h,f,u).getPoints(s)},[e,t,n,r,s]);return C.createElement(Cu,ot({ref:a,points:l},o))}),Bhe=C.forwardRef(function({points:e,closed:t=!1,curveType:n="centripetal",tension:r=.5,segments:s=20,vertexColors:o,...a},l){const c=C.useMemo(()=>{const f=e.map(d=>d instanceof Q?d:new Q(...d));return new Dw(f,t,n,r)},[e,t,n,r]),u=C.useMemo(()=>c.getPoints(s),[c,s]),h=C.useMemo(()=>{if(!o||o.length<2)return;if(o.length===s+1)return o;const f=o.map(y=>y instanceof ut?y:new ut(...y));t&&f.push(f[0].clone());const d=[f[0]],m=s/(f.length-1);for(let y=1;y<s;y++){const g=y%m/m,A=Math.floor(y/m);d.push(f[A].clone().lerp(f[A+1],g))}return d.push(f[f.length-1]),d},[o,s]);return C.createElement(Cu,ot({ref:l,points:u,vertexColors:h},a))}),Dhe=C.forwardRef(({url:i,distance:e=1,loop:t=!0,autoplay:n,...r},s)=>{const o=C.useRef(null);C.useImperativeHandle(s,()=>o.current,[]);const a=Ve(({camera:u})=>u),[l]=C.useState(()=>new Tz),c=cr(Cz,i);return C.useEffect(()=>{const u=o.current;u&&(u.setBuffer(c),u.setRefDistance(e),u.setLoop(t),n&&!u.isPlaying&&u.play())},[c,a,e,t]),C.useEffect(()=>{const u=o.current;return a.add(l),()=>{a.remove(l),u&&(u.isPlaying&&u.stop(),u.source&&u.source._connected&&u.disconnect())}},[]),C.createElement("positionalAudio",ot({ref:o,args:[l]},r))});function khe(){var i=Object.create(null);function e(r,s){var o=r.id,a=r.name,l=r.dependencies;l===void 0&&(l=[]);var c=r.init;c===void 0&&(c=function(){});var u=r.getTransferables;if(u===void 0&&(u=null),!i[o])try{l=l.map(function(f){return f&&f.isWorkerModule&&(e(f,function(d){if(d instanceof Error)throw d}),f=i[f.id].value),f}),c=n("<"+a+">.init",c),u&&(u=n("<"+a+">.getTransferables",u));var h=null;typeof c=="function"?h=c.apply(void 0,l):console.error("worker module init function failed to rehydrate"),i[o]={id:o,value:h,getTransferables:u},s(h)}catch(f){f&&f.noLog||console.error(f),s(f)}}function t(r,s){var o,a=r.id,l=r.args;(!i[a]||typeof i[a].value!="function")&&s(new Error("Worker module "+a+": not found or its 'init' did not return a function"));try{var c=(o=i[a]).value.apply(o,l);c&&typeof c.then=="function"?c.then(u,function(h){return s(h instanceof Error?h:new Error(""+h))}):u(c)}catch(h){s(h)}function u(h){try{var f=i[a].getTransferables&&i[a].getTransferables(h);(!f||!Array.isArray(f)||!f.length)&&(f=void 0),s(h,f)}catch(d){console.error(d),s(d)}}}function n(r,s){var o=void 0;self.troikaDefine=function(l){return o=l};var a=URL.createObjectURL(new Blob(["/** "+r.replace(/\*/g,"")+` **/

troikaDefine(
`+s+`
)`],{type:"application/javascript"}));try{importScripts(a)}catch(l){console.error(l)}return URL.revokeObjectURL(a),delete self.troikaDefine,o}self.addEventListener("message",function(r){var s=r.data,o=s.messageId,a=s.action,l=s.data;try{a==="registerModule"&&e(l,function(c){c instanceof Error?postMessage({messageId:o,success:!1,error:c.message}):postMessage({messageId:o,success:!0,result:{isCallable:typeof c=="function"}})}),a==="callModule"&&t(l,function(c,u){c instanceof Error?postMessage({messageId:o,success:!1,error:c.message}):postMessage({messageId:o,success:!0,result:c},u||void 0)})}catch(c){postMessage({messageId:o,success:!1,error:c.stack})}})}function Fhe(i){var e=function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];return e._getInitResult().then(function(r){if(typeof r=="function")return r.apply(void 0,t);throw new Error("Worker module function was called but `init` did not return a callable function")})};return e._getInitResult=function(){var t=i.dependencies,n=i.init;t=Array.isArray(t)?t.map(function(s){return s&&(s=s.onMainThread||s,s._getInitResult&&(s=s._getInitResult())),s}):[];var r=Promise.all(t).then(function(s){return n.apply(null,s)});return e._getInitResult=function(){return r},r},e}var YH=function(){var i=!1;if(typeof window<"u"&&typeof window.document<"u")try{var e=new Worker(URL.createObjectURL(new Blob([""],{type:"application/javascript"})));e.terminate(),i=!0}catch(t){console.log("Troika createWorkerModule: web workers not allowed; falling back to main thread execution. Cause: ["+t.message+"]")}return YH=function(){return i},i},Ohe=0,Nhe=0,gb=!1,a2=Object.create(null),l2=Object.create(null),h5=Object.create(null);function PA(i){if((!i||typeof i.init!="function")&&!gb)throw new Error("requires `options.init` function");var e=i.dependencies,t=i.init,n=i.getTransferables,r=i.workerId,s=Fhe(i);r==null&&(r="#default");var o="workerModule"+ ++Ohe,a=i.name||o,l=null;e=e&&e.map(function(u){return typeof u=="function"&&!u.workerModuleData&&(gb=!0,u=PA({workerId:r,name:"<"+a+"> function dependency: "+u.name,init:`function(){return (
`+Z_(u)+`
)}`}),gb=!1),u&&u.workerModuleData&&(u=u.workerModuleData),u});function c(){for(var u=[],h=arguments.length;h--;)u[h]=arguments[h];if(!YH())return s.apply(void 0,u);if(!l){l=t7(r,"registerModule",c.workerModuleData);var f=function(){l=null,l2[r].delete(f)};(l2[r]||(l2[r]=new Set)).add(f)}return l.then(function(d){var m=d.isCallable;if(m)return t7(r,"callModule",{id:o,args:u});throw new Error("Worker module function was called but `init` did not return a callable function")})}return c.workerModuleData={isWorkerModule:!0,id:o,name:a,dependencies:e,init:Z_(t),getTransferables:n&&Z_(n)},c.onMainThread=s,c}function Uhe(i){l2[i]&&l2[i].forEach(function(e){e()}),a2[i]&&(a2[i].terminate(),delete a2[i])}function Z_(i){var e=i.toString();return!/^function/.test(e)&&/^\w+\s*\(/.test(e)&&(e="function "+e),e}function zhe(i){var e=a2[i];if(!e){var t=Z_(khe);e=a2[i]=new Worker(URL.createObjectURL(new Blob(["/** Worker Module Bootstrap: "+i.replace(/\*/g,"")+` **/

;(`+t+")()"],{type:"application/javascript"}))),e.onmessage=function(n){var r=n.data,s=r.messageId,o=h5[s];if(!o)throw new Error("WorkerModule response with empty or unknown messageId");delete h5[s],o(r)}}return e}function t7(i,e,t){return new Promise(function(n,r){var s=++Nhe;h5[s]=function(o){o.success?n(o.result):r(new Error("Error in worker "+e+" call: "+o.error))},zhe(i).postMessage({messageId:s,action:e,data:t})})}function $H(){var i=(function(e){function t(V,W,F,Y,te,q,J,re){var ie=1-J;re.x=ie*ie*V+2*ie*J*F+J*J*te,re.y=ie*ie*W+2*ie*J*Y+J*J*q}function n(V,W,F,Y,te,q,J,re,ie,se){var ge=1-ie;se.x=ge*ge*ge*V+3*ge*ge*ie*F+3*ge*ie*ie*te+ie*ie*ie*J,se.y=ge*ge*ge*W+3*ge*ge*ie*Y+3*ge*ie*ie*q+ie*ie*ie*re}function r(V,W){for(var F=/([MLQCZ])([^MLQCZ]*)/g,Y,te,q,J,re;Y=F.exec(V);){var ie=Y[2].replace(/^\s*|\s*$/g,"").split(/[,\s]+/).map(function(se){return parseFloat(se)});switch(Y[1]){case"M":J=te=ie[0],re=q=ie[1];break;case"L":(ie[0]!==J||ie[1]!==re)&&W("L",J,re,J=ie[0],re=ie[1]);break;case"Q":{W("Q",J,re,J=ie[2],re=ie[3],ie[0],ie[1]);break}case"C":{W("C",J,re,J=ie[4],re=ie[5],ie[0],ie[1],ie[2],ie[3]);break}case"Z":(J!==te||re!==q)&&W("L",J,re,te,q);break}}}function s(V,W,F){F===void 0&&(F=16);var Y={x:0,y:0};r(V,function(te,q,J,re,ie,se,ge,xe,pe){switch(te){case"L":W(q,J,re,ie);break;case"Q":{for(var ue=q,Me=J,Se=1;Se<F;Se++)t(q,J,se,ge,re,ie,Se/(F-1),Y),W(ue,Me,Y.x,Y.y),ue=Y.x,Me=Y.y;break}case"C":{for(var ve=q,Ae=J,ke=1;ke<F;ke++)n(q,J,se,ge,xe,pe,re,ie,ke/(F-1),Y),W(ve,Ae,Y.x,Y.y),ve=Y.x,Ae=Y.y;break}}})}var o="precision highp float;attribute vec2 aUV;varying vec2 vUV;void main(){vUV=aUV;gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}",a="precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){gl_FragColor=texture2D(tex,vUV);}",l=new WeakMap,c={premultipliedAlpha:!1,preserveDrawingBuffer:!0,antialias:!1,depth:!1};function u(V,W){var F=V.getContext?V.getContext("webgl",c):V,Y=l.get(F);if(!Y){let ge=function(ve){var Ae=q[ve];if(!Ae&&(Ae=q[ve]=F.getExtension(ve),!Ae))throw new Error(ve+" not supported");return Ae},xe=function(ve,Ae){var ke=F.createShader(Ae);return F.shaderSource(ke,ve),F.compileShader(ke),ke},pe=function(ve,Ae,ke,be){if(!J[ve]){var ne={},j={},de=F.createProgram();F.attachShader(de,xe(Ae,F.VERTEX_SHADER)),F.attachShader(de,xe(ke,F.FRAGMENT_SHADER)),F.linkProgram(de),J[ve]={program:de,transaction:function(Le){F.useProgram(de),Le({setUniform:function(He,it){for(var Ye=[],ct=arguments.length-2;ct-- >0;)Ye[ct]=arguments[ct+2];var pt=j[it]||(j[it]=F.getUniformLocation(de,it));F["uniform"+He].apply(F,[pt].concat(Ye))},setAttribute:function(He,it,Ye,ct,pt){var je=ne[He];je||(je=ne[He]={buf:F.createBuffer(),loc:F.getAttribLocation(de,He),data:null}),F.bindBuffer(F.ARRAY_BUFFER,je.buf),F.vertexAttribPointer(je.loc,it,F.FLOAT,!1,0,0),F.enableVertexAttribArray(je.loc),te?F.vertexAttribDivisor(je.loc,ct):ge("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(je.loc,ct),pt!==je.data&&(F.bufferData(F.ARRAY_BUFFER,pt,Ye),je.data=pt)}})}}}J[ve].transaction(be)},ue=function(ve,Ae){ie++;try{F.activeTexture(F.TEXTURE0+ie);var ke=re[ve];ke||(ke=re[ve]=F.createTexture(),F.bindTexture(F.TEXTURE_2D,ke),F.texParameteri(F.TEXTURE_2D,F.TEXTURE_MIN_FILTER,F.NEAREST),F.texParameteri(F.TEXTURE_2D,F.TEXTURE_MAG_FILTER,F.NEAREST)),F.bindTexture(F.TEXTURE_2D,ke),Ae(ke,ie)}finally{ie--}},Me=function(ve,Ae,ke){var be=F.createFramebuffer();se.push(be),F.bindFramebuffer(F.FRAMEBUFFER,be),F.activeTexture(F.TEXTURE0+Ae),F.bindTexture(F.TEXTURE_2D,ve),F.framebufferTexture2D(F.FRAMEBUFFER,F.COLOR_ATTACHMENT0,F.TEXTURE_2D,ve,0);try{ke(be)}finally{F.deleteFramebuffer(be),F.bindFramebuffer(F.FRAMEBUFFER,se[--se.length-1]||null)}},Se=function(){q={},J={},re={},ie=-1,se.length=0};var te=typeof WebGL2RenderingContext<"u"&&F instanceof WebGL2RenderingContext,q={},J={},re={},ie=-1,se=[];F.canvas.addEventListener("webglcontextlost",function(ve){Se(),ve.preventDefault()},!1),l.set(F,Y={gl:F,isWebGL2:te,getExtension:ge,withProgram:pe,withTexture:ue,withTextureFramebuffer:Me,handleContextLoss:Se})}W(Y)}function h(V,W,F,Y,te,q,J,re){J===void 0&&(J=15),re===void 0&&(re=null),u(V,function(ie){var se=ie.gl,ge=ie.withProgram,xe=ie.withTexture;xe("copy",function(pe,ue){se.texImage2D(se.TEXTURE_2D,0,se.RGBA,te,q,0,se.RGBA,se.UNSIGNED_BYTE,W),ge("copy",o,a,function(Me){var Se=Me.setUniform,ve=Me.setAttribute;ve("aUV",2,se.STATIC_DRAW,0,new Float32Array([0,0,2,0,0,2])),Se("1i","image",ue),se.bindFramebuffer(se.FRAMEBUFFER,re||null),se.disable(se.BLEND),se.colorMask(J&8,J&4,J&2,J&1),se.viewport(F,Y,te,q),se.scissor(F,Y,te,q),se.drawArrays(se.TRIANGLES,0,3)})})})}function f(V,W,F){var Y=V.width,te=V.height;u(V,function(q){var J=q.gl,re=new Uint8Array(Y*te*4);J.readPixels(0,0,Y,te,J.RGBA,J.UNSIGNED_BYTE,re),V.width=W,V.height=F,h(J,re,0,0,Y,te)})}var d=Object.freeze({__proto__:null,withWebGLContext:u,renderImageData:h,resizeWebGLCanvasWithoutClearing:f});function m(V,W,F,Y,te,q){q===void 0&&(q=1);var J=new Uint8Array(V*W),re=Y[2]-Y[0],ie=Y[3]-Y[1],se=[];s(F,function(ve,Ae,ke,be){se.push({x1:ve,y1:Ae,x2:ke,y2:be,minX:Math.min(ve,ke),minY:Math.min(Ae,be),maxX:Math.max(ve,ke),maxY:Math.max(Ae,be)})}),se.sort(function(ve,Ae){return ve.maxX-Ae.maxX});for(var ge=0;ge<V;ge++)for(var xe=0;xe<W;xe++){var pe=Me(Y[0]+re*(ge+.5)/V,Y[1]+ie*(xe+.5)/W),ue=Math.pow(1-Math.abs(pe)/te,q)/2;pe<0&&(ue=1-ue),ue=Math.max(0,Math.min(255,Math.round(ue*255))),J[xe*V+ge]=ue}return J;function Me(ve,Ae){for(var ke=1/0,be=1/0,ne=se.length;ne--;){var j=se[ne];if(j.maxX+be<=ve)break;if(ve+be>j.minX&&Ae-be<j.maxY&&Ae+be>j.minY){var de=A(ve,Ae,j.x1,j.y1,j.x2,j.y2);de<ke&&(ke=de,be=Math.sqrt(ke))}}return Se(ve,Ae)&&(be=-be),be}function Se(ve,Ae){for(var ke=0,be=se.length;be--;){var ne=se[be];if(ne.maxX<=ve)break;var j=ne.y1>Ae!=ne.y2>Ae&&ve<(ne.x2-ne.x1)*(Ae-ne.y1)/(ne.y2-ne.y1)+ne.x1;j&&(ke+=ne.y1<ne.y2?1:-1)}return ke!==0}}function y(V,W,F,Y,te,q,J,re,ie,se){q===void 0&&(q=1),re===void 0&&(re=0),ie===void 0&&(ie=0),se===void 0&&(se=0),g(V,W,F,Y,te,q,J,null,re,ie,se)}function g(V,W,F,Y,te,q,J,re,ie,se,ge){q===void 0&&(q=1),ie===void 0&&(ie=0),se===void 0&&(se=0),ge===void 0&&(ge=0);for(var xe=m(V,W,F,Y,te,q),pe=new Uint8Array(xe.length*4),ue=0;ue<xe.length;ue++)pe[ue*4+ge]=xe[ue];h(J,pe,ie,se,V,W,1<<3-ge,re)}function A(V,W,F,Y,te,q){var J=te-F,re=q-Y,ie=J*J+re*re,se=ie?Math.max(0,Math.min(1,((V-F)*J+(W-Y)*re)/ie)):0,ge=V-(F+se*J),xe=W-(Y+se*re);return ge*ge+xe*xe}var E=Object.freeze({__proto__:null,generate:m,generateIntoCanvas:y,generateIntoFramebuffer:g}),x="precision highp float;uniform vec4 uGlyphBounds;attribute vec2 aUV;attribute vec4 aLineSegment;varying vec4 vLineSegment;varying vec2 vGlyphXY;void main(){vLineSegment=aLineSegment;vGlyphXY=mix(uGlyphBounds.xy,uGlyphBounds.zw,aUV);gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}",w="precision highp float;uniform vec4 uGlyphBounds;uniform float uMaxDistance;uniform float uExponent;varying vec4 vLineSegment;varying vec2 vGlyphXY;float absDistToSegment(vec2 point,vec2 lineA,vec2 lineB){vec2 lineDir=lineB-lineA;float lenSq=dot(lineDir,lineDir);float t=lenSq==0.0 ? 0.0 : clamp(dot(point-lineA,lineDir)/lenSq,0.0,1.0);vec2 linePt=lineA+t*lineDir;return distance(point,linePt);}void main(){vec4 seg=vLineSegment;vec2 p=vGlyphXY;float dist=absDistToSegment(p,seg.xy,seg.zw);float val=pow(1.0-clamp(dist/uMaxDistance,0.0,1.0),uExponent)*0.5;bool crossing=(seg.y>p.y!=seg.w>p.y)&&(p.x<(seg.z-seg.x)*(p.y-seg.y)/(seg.w-seg.y)+seg.x);bool crossingUp=crossing&&vLineSegment.y<vLineSegment.w;gl_FragColor=vec4(crossingUp ? 1.0/255.0 : 0.0,crossing&&!crossingUp ? 1.0/255.0 : 0.0,0.0,val);}",T="precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){vec4 color=texture2D(tex,vUV);bool inside=color.r!=color.g;float val=inside ? 1.0-color.a : color.a;gl_FragColor=vec4(val);}",I=new Float32Array([0,0,2,0,0,2]),M=null,L=!1,P={},R=new WeakMap;function U(V){if(!L&&!X(V))throw new Error("WebGL generation not supported")}function k(V,W,F,Y,te,q,J){if(q===void 0&&(q=1),J===void 0&&(J=null),!J&&(J=M,!J)){var re=typeof OffscreenCanvas=="function"?new OffscreenCanvas(1,1):typeof document<"u"?document.createElement("canvas"):null;if(!re)throw new Error("OffscreenCanvas or DOM canvas not supported");J=M=re.getContext("webgl",{depth:!1})}U(J);var ie=new Uint8Array(V*W*4);u(J,function(pe){var ue=pe.gl,Me=pe.withTexture,Se=pe.withTextureFramebuffer;Me("readable",function(ve,Ae){ue.texImage2D(ue.TEXTURE_2D,0,ue.RGBA,V,W,0,ue.RGBA,ue.UNSIGNED_BYTE,null),Se(ve,Ae,function(ke){G(V,W,F,Y,te,q,ue,ke,0,0,0),ue.readPixels(0,0,V,W,ue.RGBA,ue.UNSIGNED_BYTE,ie)})})});for(var se=new Uint8Array(V*W),ge=0,xe=0;ge<ie.length;ge+=4)se[xe++]=ie[ge];return se}function H(V,W,F,Y,te,q,J,re,ie,se){q===void 0&&(q=1),re===void 0&&(re=0),ie===void 0&&(ie=0),se===void 0&&(se=0),G(V,W,F,Y,te,q,J,null,re,ie,se)}function G(V,W,F,Y,te,q,J,re,ie,se,ge){q===void 0&&(q=1),ie===void 0&&(ie=0),se===void 0&&(se=0),ge===void 0&&(ge=0),U(J);var xe=[];s(F,function(pe,ue,Me,Se){xe.push(pe,ue,Me,Se)}),xe=new Float32Array(xe),u(J,function(pe){var ue=pe.gl,Me=pe.isWebGL2,Se=pe.getExtension,ve=pe.withProgram,Ae=pe.withTexture,ke=pe.withTextureFramebuffer,be=pe.handleContextLoss;if(Ae("rawDistances",function(ne,j){(V!==ne._lastWidth||W!==ne._lastHeight)&&ue.texImage2D(ue.TEXTURE_2D,0,ue.RGBA,ne._lastWidth=V,ne._lastHeight=W,0,ue.RGBA,ue.UNSIGNED_BYTE,null),ve("main",x,w,function(de){var Re=de.setAttribute,Le=de.setUniform,Fe=!Me&&Se("ANGLE_instanced_arrays"),He=!Me&&Se("EXT_blend_minmax");Re("aUV",2,ue.STATIC_DRAW,0,I),Re("aLineSegment",4,ue.DYNAMIC_DRAW,1,xe),Le.apply(void 0,["4f","uGlyphBounds"].concat(Y)),Le("1f","uMaxDistance",te),Le("1f","uExponent",q),ke(ne,j,function(it){ue.enable(ue.BLEND),ue.colorMask(!0,!0,!0,!0),ue.viewport(0,0,V,W),ue.scissor(0,0,V,W),ue.blendFunc(ue.ONE,ue.ONE),ue.blendEquationSeparate(ue.FUNC_ADD,Me?ue.MAX:He.MAX_EXT),ue.clear(ue.COLOR_BUFFER_BIT),Me?ue.drawArraysInstanced(ue.TRIANGLES,0,3,xe.length/4):Fe.drawArraysInstancedANGLE(ue.TRIANGLES,0,3,xe.length/4)})}),ve("post",o,T,function(de){de.setAttribute("aUV",2,ue.STATIC_DRAW,0,I),de.setUniform("1i","tex",j),ue.bindFramebuffer(ue.FRAMEBUFFER,re),ue.disable(ue.BLEND),ue.colorMask(ge===0,ge===1,ge===2,ge===3),ue.viewport(ie,se,V,W),ue.scissor(ie,se,V,W),ue.drawArrays(ue.TRIANGLES,0,3)})}),ue.isContextLost())throw be(),new Error("webgl context lost")})}function X(V){var W=!V||V===M?P:V.canvas||V,F=R.get(W);if(F===void 0){L=!0;var Y=null;try{var te=[97,106,97,61,99,137,118,80,80,118,137,99,61,97,106,97],q=k(4,4,"M8,8L16,8L24,24L16,24Z",[0,0,32,32],24,1,V);F=q&&te.length===q.length&&q.every(function(J,re){return J===te[re]}),F||(Y="bad trial run results",console.info(te,q))}catch(J){F=!1,Y=J.message}Y&&console.warn("WebGL SDF generation not supported:",Y),L=!1,R.set(W,F)}return F}var Z=Object.freeze({__proto__:null,generate:k,generateIntoCanvas:H,generateIntoFramebuffer:G,isSupported:X});function oe(V,W,F,Y,te,q){te===void 0&&(te=Math.max(Y[2]-Y[0],Y[3]-Y[1])/2),q===void 0&&(q=1);try{return k.apply(Z,arguments)}catch(J){return console.info("WebGL SDF generation failed, falling back to JS",J),m.apply(E,arguments)}}function K(V,W,F,Y,te,q,J,re,ie,se){te===void 0&&(te=Math.max(Y[2]-Y[0],Y[3]-Y[1])/2),q===void 0&&(q=1),re===void 0&&(re=0),ie===void 0&&(ie=0),se===void 0&&(se=0);try{return H.apply(Z,arguments)}catch(ge){return console.info("WebGL SDF generation failed, falling back to JS",ge),y.apply(E,arguments)}}return e.forEachPathCommand=r,e.generate=oe,e.generateIntoCanvas=K,e.javascript=E,e.pathToLineSegments=s,e.webgl=Z,e.webglUtils=d,Object.defineProperty(e,"__esModule",{value:!0}),e})({});return i}function Ghe(){var i=(function(e){var t={R:"13k,1a,2,3,3,2+1j,ch+16,a+1,5+2,2+n,5,a,4,6+16,4+3,h+1b,4mo,179q,2+9,2+11,2i9+7y,2+68,4,3+4,5+13,4+3,2+4k,3+29,8+cf,1t+7z,w+17,3+3m,1t+3z,16o1+5r,8+30,8+mc,29+1r,29+4v,75+73",EN:"1c+9,3d+1,6,187+9,513,4+5,7+9,sf+j,175h+9,qw+q,161f+1d,4xt+a,25i+9",ES:"17,2,6dp+1,f+1,av,16vr,mx+1,4o,2",ET:"z+2,3h+3,b+1,ym,3e+1,2o,p4+1,8,6u,7c,g6,1wc,1n9+4,30+1b,2n,6d,qhx+1,h0m,a+1,49+2,63+1,4+1,6bb+3,12jj",AN:"16o+5,2j+9,2+1,35,ed,1ff2+9,87+u",CS:"18,2+1,b,2u,12k,55v,l,17v0,2,3,53,2+1,b",B:"a,3,f+2,2v,690",S:"9,2,k",WS:"c,k,4f4,1vk+a,u,1j,335",ON:"x+1,4+4,h+5,r+5,r+3,z,5+3,2+1,2+1,5,2+2,3+4,o,w,ci+1,8+d,3+d,6+8,2+g,39+1,9,6+1,2,33,b8,3+1,3c+1,7+1,5r,b,7h+3,sa+5,2,3i+6,jg+3,ur+9,2v,ij+1,9g+9,7+a,8m,4+1,49+x,14u,2+2,c+2,e+2,e+2,e+1,i+n,e+e,2+p,u+2,e+2,36+1,2+3,2+1,b,2+2,6+5,2,2,2,h+1,5+4,6+3,3+f,16+2,5+3l,3+81,1y+p,2+40,q+a,m+13,2r+ch,2+9e,75+hf,3+v,2+2w,6e+5,f+6,75+2a,1a+p,2+2g,d+5x,r+b,6+3,4+o,g,6+1,6+2,2k+1,4,2j,5h+z,1m+1,1e+f,t+2,1f+e,d+3,4o+3,2s+1,w,535+1r,h3l+1i,93+2,2s,b+1,3l+x,2v,4g+3,21+3,kz+1,g5v+1,5a,j+9,n+v,2,3,2+8,2+1,3+2,2,3,46+1,4+4,h+5,r+5,r+a,3h+2,4+6,b+4,78,1r+24,4+c,4,1hb,ey+6,103+j,16j+c,1ux+7,5+g,fsh,jdq+1t,4,57+2e,p1,1m,1m,1m,1m,4kt+1,7j+17,5+2r,d+e,3+e,2+e,2+10,m+4,w,1n+5,1q,4z+5,4b+rb,9+c,4+c,4+37,d+2g,8+b,l+b,5+1j,9+9,7+13,9+t,3+1,27+3c,2+29,2+3q,d+d,3+4,4+2,6+6,a+o,8+6,a+2,e+6,16+42,2+1i",BN:"0+8,6+d,2s+5,2+p,e,4m9,1kt+2,2b+5,5+5,17q9+v,7k,6p+8,6+1,119d+3,440+7,96s+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+75,6p+2rz,1ben+1,1ekf+1,1ekf+1",NSM:"lc+33,7o+6,7c+18,2,2+1,2+1,2,21+a,1d+k,h,2u+6,3+5,3+1,2+3,10,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,g+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+g,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,k1+w,2db+2,3y,2p+v,ff+3,30+1,n9x+3,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,r2,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+5,3+1,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2d+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,f0c+4,1o+6,t5,1s+3,2a,f5l+1,43t+2,i+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,gzhy+6n",AL:"16w,3,2,e+1b,z+2,2+2s,g+1,8+1,b+m,2+t,s+2i,c+e,4h+f,1d+1e,1bwe+dp,3+3z,x+c,2+1,35+3y,2rm+z,5+7,b+5,dt+l,c+u,17nl+27,1t+27,4x+6n,3+d",LRO:"6ct",RLO:"6cu",LRE:"6cq",RLE:"6cr",PDF:"6cs",LRI:"6ee",RLI:"6ef",FSI:"6eg",PDI:"6eh"},n={},r={};n.L=1,r[1]="L",Object.keys(t).forEach(function(be,ne){n[be]=1<<ne+1,r[n[be]]=be}),Object.freeze(n);var s=n.LRI|n.RLI|n.FSI,o=n.L|n.R|n.AL,a=n.B|n.S|n.WS|n.ON|n.FSI|n.LRI|n.RLI|n.PDI,l=n.BN|n.RLE|n.LRE|n.RLO|n.LRO|n.PDF,c=n.S|n.WS|n.B|s|n.PDI|l,u=null;function h(){if(!u){u=new Map;var be=function(j){if(t.hasOwnProperty(j)){var de=0;t[j].split(",").forEach(function(Re){var Le=Re.split("+"),Fe=Le[0],He=Le[1];Fe=parseInt(Fe,36),He=He?parseInt(He,36):0,u.set(de+=Fe,n[j]);for(var it=0;it<He;it++)u.set(++de,n[j])})}};for(var ne in t)be(ne)}}function f(be){return h(),u.get(be.codePointAt(0))||n.L}function d(be){return r[f(be)]}var m={pairs:"14>1,1e>2,u>2,2wt>1,1>1,1ge>1,1wp>1,1j>1,f>1,hm>1,1>1,u>1,u6>1,1>1,+5,28>1,w>1,1>1,+3,b8>1,1>1,+3,1>3,-1>-1,3>1,1>1,+2,1s>1,1>1,x>1,th>1,1>1,+2,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,4q>1,1e>2,u>2,2>1,+1",canonical:"6f1>-6dx,6dy>-6dx,6ec>-6ed,6ee>-6ed,6ww>2jj,-2ji>2jj,14r4>-1e7l,1e7m>-1e7l,1e7m>-1e5c,1e5d>-1e5b,1e5c>-14qx,14qy>-14qx,14vn>-1ecg,1ech>-1ecg,1edu>-1ecg,1eci>-1ecg,1eda>-1ecg,1eci>-1ecg,1eci>-168q,168r>-168q,168s>-14ye,14yf>-14ye"};function y(be,ne){var j=36,de=0,Re=new Map,Le=ne&&new Map,Fe;return be.split(",").forEach(function He(it){if(it.indexOf("+")!==-1)for(var Ye=+it;Ye--;)He(Fe);else{Fe=it;var ct=it.split(">"),pt=ct[0],je=ct[1];pt=String.fromCodePoint(de+=parseInt(pt,j)),je=String.fromCodePoint(de+=parseInt(je,j)),Re.set(pt,je),ne&&Le.set(je,pt)}}),{map:Re,reverseMap:Le}}var g,A,E;function x(){if(!g){var be=y(m.pairs,!0),ne=be.map,j=be.reverseMap;g=ne,A=j,E=y(m.canonical,!1).map}}function w(be){return x(),g.get(be)||null}function T(be){return x(),A.get(be)||null}function I(be){return x(),E.get(be)||null}var M=n.L,L=n.R,P=n.EN,R=n.ES,U=n.ET,k=n.AN,H=n.CS,G=n.B,X=n.S,Z=n.ON,oe=n.BN,K=n.NSM,V=n.AL,W=n.LRO,F=n.RLO,Y=n.LRE,te=n.RLE,q=n.PDF,J=n.LRI,re=n.RLI,ie=n.FSI,se=n.PDI;function ge(be,ne){for(var j=125,de=new Uint32Array(be.length),Re=0;Re<be.length;Re++)de[Re]=f(be[Re]);var Le=new Map;function Fe($r,us){var Ur=de[$r];de[$r]=us,Le.set(Ur,Le.get(Ur)-1),Ur&a&&Le.set(a,Le.get(a)-1),Le.set(us,(Le.get(us)||0)+1),us&a&&Le.set(a,(Le.get(a)||0)+1)}for(var He=new Uint8Array(be.length),it=new Map,Ye=[],ct=null,pt=0;pt<be.length;pt++)ct||Ye.push(ct={start:pt,end:be.length-1,level:ne==="rtl"?1:ne==="ltr"?0:Cs(pt,!1)}),de[pt]&G&&(ct.end=pt,ct=null);for(var je=te|Y|F|W|s|se|q|G,Mt=function($r){return $r+($r&1?1:2)},Ft=function($r){return $r+($r&1?2:1)},St=0;St<Ye.length;St++){ct=Ye[St];var gt=[{_level:ct.level,_override:0,_isolate:0}],ft=void 0,Ce=0,qe=0,At=0;Le.clear();for(var yt=ct.start;yt<=ct.end;yt++){var Be=de[yt];if(ft=gt[gt.length-1],Le.set(Be,(Le.get(Be)||0)+1),Be&a&&Le.set(a,(Le.get(a)||0)+1),Be&je)if(Be&(te|Y)){He[yt]=ft._level;var we=(Be===te?Ft:Mt)(ft._level);we<=j&&!Ce&&!qe?gt.push({_level:we,_override:0,_isolate:0}):Ce||qe++}else if(Be&(F|W)){He[yt]=ft._level;var _t=(Be===F?Ft:Mt)(ft._level);_t<=j&&!Ce&&!qe?gt.push({_level:_t,_override:Be&F?L:M,_isolate:0}):Ce||qe++}else if(Be&s){Be&ie&&(Be=Cs(yt+1,!0)===1?re:J),He[yt]=ft._level,ft._override&&Fe(yt,ft._override);var vt=(Be===re?Ft:Mt)(ft._level);vt<=j&&Ce===0&&qe===0?(At++,gt.push({_level:vt,_override:0,_isolate:1,_isolInitIndex:yt})):Ce++}else if(Be&se){if(Ce>0)Ce--;else if(At>0){for(qe=0;!gt[gt.length-1]._isolate;)gt.pop();var bt=gt[gt.length-1]._isolInitIndex;bt!=null&&(it.set(bt,yt),it.set(yt,bt)),gt.pop(),At--}ft=gt[gt.length-1],He[yt]=ft._level,ft._override&&Fe(yt,ft._override)}else Be&q?(Ce===0&&(qe>0?qe--:!ft._isolate&&gt.length>1&&(gt.pop(),ft=gt[gt.length-1])),He[yt]=ft._level):Be&G&&(He[yt]=ct.level);else He[yt]=ft._level,ft._override&&Be!==oe&&Fe(yt,ft._override)}for(var Lt=[],qt=null,Nt=ct.start;Nt<=ct.end;Nt++){var dn=de[Nt];if(!(dn&l)){var Vn=He[Nt],pn=dn&s,qn=dn===se;qt&&Vn===qt._level?(qt._end=Nt,qt._endsWithIsolInit=pn):Lt.push(qt={_start:Nt,_end:Nt,_level:Vn,_startsWithPDI:qn,_endsWithIsolInit:pn})}}for(var Ci=[],as=0;as<Lt.length;as++){var Nr=Lt[as];if(!Nr._startsWithPDI||Nr._startsWithPDI&&!it.has(Nr._start)){for(var ur=[qt=Nr],tr=void 0;qt&&qt._endsWithIsolInit&&(tr=it.get(qt._end))!=null;)for(var An=as+1;An<Lt.length;An++)if(Lt[An]._start===tr){ur.push(qt=Lt[An]);break}for(var vr=[],Uo=0;Uo<ur.length;Uo++)for(var he=ur[Uo],me=he._start;me<=he._end;me++)vr.push(me);for(var De=He[vr[0]],ce=ct.level,ye=vr[0]-1;ye>=0;ye--)if(!(de[ye]&l)){ce=He[ye];break}var Ee=vr[vr.length-1],Pe=He[Ee],Ie=ct.level;if(!(de[Ee]&s)){for(var Je=Ee+1;Je<=ct.end;Je++)if(!(de[Je]&l)){Ie=He[Je];break}}Ci.push({_seqIndices:vr,_sosType:Math.max(ce,De)%2?L:M,_eosType:Math.max(Ie,Pe)%2?L:M})}}for(var st=0;st<Ci.length;st++){var lt=Ci[st],Oe=lt._seqIndices,Ht=lt._sosType,xt=lt._eosType,Et=He[Oe[0]]&1?L:M;if(Le.get(K))for(var Qt=0;Qt<Oe.length;Qt++){var sn=Oe[Qt];if(de[sn]&K){for(var ln=Ht,vn=Qt-1;vn>=0;vn--)if(!(de[Oe[vn]]&l)){ln=de[Oe[vn]];break}Fe(sn,ln&(s|se)?Z:ln)}}if(Le.get(P))for(var Dt=0;Dt<Oe.length;Dt++){var Bt=Oe[Dt];if(de[Bt]&P)for(var yn=Dt-1;yn>=-1;yn--){var xn=yn===-1?Ht:de[Oe[yn]];if(xn&o){xn===V&&Fe(Bt,k);break}}}if(Le.get(V))for(var Sn=0;Sn<Oe.length;Sn++){var Ai=Oe[Sn];de[Ai]&V&&Fe(Ai,L)}if(Le.get(R)||Le.get(H))for(var xi=1;xi<Oe.length-1;xi++){var Ei=Oe[xi];if(de[Ei]&(R|H)){for(var Dn=0,kn=0,zi=xi-1;zi>=0&&(Dn=de[Oe[zi]],!!(Dn&l));zi--);for(var Bn=xi+1;Bn<Oe.length&&(kn=de[Oe[Bn]],!!(kn&l));Bn++);Dn===kn&&(de[Ei]===R?Dn===P:Dn&(P|k))&&Fe(Ei,Dn)}}if(Le.get(P))for(var Pn=0;Pn<Oe.length;Pn++){var Ri=Oe[Pn];if(de[Ri]&P){for(var ls=Pn-1;ls>=0&&de[Oe[ls]]&(U|l);ls--)Fe(Oe[ls],P);for(Pn++;Pn<Oe.length&&de[Oe[Pn]]&(U|l|P);Pn++)de[Oe[Pn]]!==P&&Fe(Oe[Pn],P)}}if(Le.get(U)||Le.get(R)||Le.get(H))for(var nr=0;nr<Oe.length;nr++){var ta=Oe[nr];if(de[ta]&(U|R|H)){Fe(ta,Z);for(var ol=nr-1;ol>=0&&de[Oe[ol]]&l;ol--)Fe(Oe[ol],Z);for(var ri=nr+1;ri<Oe.length&&de[Oe[ri]]&l;ri++)Fe(Oe[ri],Z)}}if(Le.get(P))for(var Ul=0,ku=Ht;Ul<Oe.length;Ul++){var Qf=Oe[Ul],Vf=de[Qf];Vf&P?ku===M&&Fe(Qf,M):Vf&o&&(ku=Vf)}if(Le.get(a)){var zl=L|P|k,Mh=zl|M,ba=[];{for(var al=[],zs=0;zs<Oe.length;zs++)if(de[Oe[zs]]&a){var Fn=be[Oe[zs]],Ia=void 0;if(w(Fn)!==null)if(al.length<63)al.push({char:Fn,seqIndex:zs});else break;else if((Ia=T(Fn))!==null)for(var na=al.length-1;na>=0;na--){var Gl=al[na].char;if(Gl===Ia||Gl===T(I(Fn))||w(I(Gl))===Fn){ba.push([al[na].seqIndex,zs]),al.length=na;break}}}ba.sort(function($r,us){return $r[0]-us[0]})}for(var Ma=0;Ma<ba.length;Ma++){for(var E0=ba[Ma],hr=E0[0],ll=E0[1],_0=!1,lo=0,Fu=hr+1;Fu<ll;Fu++){var Ou=Oe[Fu];if(de[Ou]&Mh){_0=!0;var ia=de[Ou]&zl?L:M;if(ia===Et){lo=ia;break}}}if(_0&&!lo){lo=Ht;for(var Tc=hr-1;Tc>=0;Tc--){var Nu=Oe[Tc];if(de[Nu]&Mh){var _s=de[Nu]&zl?L:M;_s!==Et?lo=_s:lo=Et;break}}}if(lo){if(de[Oe[hr]]=de[Oe[ll]]=lo,lo!==Et){for(var Ss=hr+1;Ss<Oe.length;Ss++)if(!(de[Oe[Ss]]&l)){f(be[Oe[Ss]])&K&&(de[Oe[Ss]]=lo);break}}if(lo!==Et){for(var Hl=ll+1;Hl<Oe.length;Hl++)if(!(de[Oe[Hl]]&l)){f(be[Oe[Hl]])&K&&(de[Oe[Hl]]=lo);break}}}}for(var Ra=0;Ra<Oe.length;Ra++)if(de[Oe[Ra]]&a){for(var Rh=Ra,Uu=Ra,co=Ht,zu=Ra-1;zu>=0;zu--)if(de[Oe[zu]]&l)Rh=zu;else{co=de[Oe[zu]]&zl?L:M;break}for(var zo=xt,bc=Ra+1;bc<Oe.length;bc++)if(de[Oe[bc]]&(a|l))Uu=bc;else{zo=de[Oe[bc]]&zl?L:M;break}for(var ws=Rh;ws<=Uu;ws++)de[Oe[ws]]=co===zo?co:Et;Ra=Uu}}}for(var cs=ct.start;cs<=ct.end;cs++){var Ic=He[cs],Go=de[cs];if(Ic&1?Go&(M|P|k)&&He[cs]++:Go&L?He[cs]++:Go&(k|P)&&(He[cs]+=2),Go&l&&(He[cs]=cs===0?ct.level:He[cs-1]),cs===ct.end||f(be[cs])&(X|G))for(var Mc=cs;Mc>=0&&f(be[Mc])&c;Mc--)He[Mc]=ct.level}}return{levels:He,paragraphs:Ye};function Cs($r,us){for(var Ur=$r;Ur<be.length;Ur++){var xr=de[Ur];if(xr&(L|V))return 1;if(xr&(G|M)||us&&xr===se)return 0;if(xr&s){var So=Rc(Ur);Ur=So===-1?be.length:So}}return 0}function Rc($r){for(var us=1,Ur=$r+1;Ur<be.length;Ur++){var xr=de[Ur];if(xr&G)break;if(xr&se){if(--us===0)return Ur}else xr&s&&us++}return-1}}var xe="14>1,j>2,t>2,u>2,1a>g,2v3>1,1>1,1ge>1,1wd>1,b>1,1j>1,f>1,ai>3,-2>3,+1,8>1k0,-1jq>1y7,-1y6>1hf,-1he>1h6,-1h5>1ha,-1h8>1qi,-1pu>1,6>3u,-3s>7,6>1,1>1,f>1,1>1,+2,3>1,1>1,+13,4>1,1>1,6>1eo,-1ee>1,3>1mg,-1me>1mk,-1mj>1mi,-1mg>1mi,-1md>1,1>1,+2,1>10k,-103>1,1>1,4>1,5>1,1>1,+10,3>1,1>8,-7>8,+1,-6>7,+1,a>1,1>1,u>1,u6>1,1>1,+5,26>1,1>1,2>1,2>2,8>1,7>1,4>1,1>1,+5,b8>1,1>1,+3,1>3,-2>1,2>1,1>1,+2,c>1,3>1,1>1,+2,h>1,3>1,a>1,1>1,2>1,3>1,1>1,d>1,f>1,3>1,1a>1,1>1,6>1,7>1,13>1,k>1,1>1,+19,4>1,1>1,+2,2>1,1>1,+18,m>1,a>1,1>1,lk>1,1>1,4>1,2>1,f>1,3>1,1>1,+3,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,6>1,4j>1,j>2,t>2,u>2,2>1,+1",pe;function ue(){if(!pe){var be=y(xe,!0),ne=be.map,j=be.reverseMap;j.forEach(function(de,Re){ne.set(Re,de)}),pe=ne}}function Me(be){return ue(),pe.get(be)||null}function Se(be,ne,j,de){var Re=be.length;j=Math.max(0,j==null?0:+j),de=Math.min(Re-1,de==null?Re-1:+de);for(var Le=new Map,Fe=j;Fe<=de;Fe++)if(ne[Fe]&1){var He=Me(be[Fe]);He!==null&&Le.set(Fe,He)}return Le}function ve(be,ne,j,de){var Re=be.length;j=Math.max(0,j==null?0:+j),de=Math.min(Re-1,de==null?Re-1:+de);var Le=[];return ne.paragraphs.forEach(function(Fe){var He=Math.max(j,Fe.start),it=Math.min(de,Fe.end);if(He<it){for(var Ye=ne.levels.slice(He,it+1),ct=it;ct>=He&&f(be[ct])&c;ct--)Ye[ct]=Fe.level;for(var pt=Fe.level,je=1/0,Mt=0;Mt<Ye.length;Mt++){var Ft=Ye[Mt];Ft>pt&&(pt=Ft),Ft<je&&(je=Ft|1)}for(var St=pt;St>=je;St--)for(var gt=0;gt<Ye.length;gt++)if(Ye[gt]>=St){for(var ft=gt;gt+1<Ye.length&&Ye[gt+1]>=St;)gt++;gt>ft&&Le.push([ft+He,gt+He])}}}),Le}function Ae(be,ne,j,de){var Re=ke(be,ne,j,de),Le=[].concat(be);return Re.forEach(function(Fe,He){Le[He]=(ne.levels[Fe]&1?Me(be[Fe]):null)||be[Fe]}),Le.join("")}function ke(be,ne,j,de){for(var Re=ve(be,ne,j,de),Le=[],Fe=0;Fe<be.length;Fe++)Le[Fe]=Fe;return Re.forEach(function(He){for(var it=He[0],Ye=He[1],ct=Le.slice(it,Ye+1),pt=ct.length;pt--;)Le[Ye-pt]=ct[pt]}),Le}return e.closingToOpeningBracket=T,e.getBidiCharType=f,e.getBidiCharTypeName=d,e.getCanonicalBracket=I,e.getEmbeddingLevels=ge,e.getMirroredCharacter=Me,e.getMirroredCharactersMap=Se,e.getReorderSegments=ve,e.getReorderedIndices=ke,e.getReorderedString=Ae,e.openingToClosingBracket=w,Object.defineProperty(e,"__esModule",{value:!0}),e})({});return i}const XH=/\bvoid\s+main\s*\(\s*\)\s*{/g;function f5(i){const e=/^[ \t]*#include +<([\w\d./]+)>/gm;function t(n,r){let s=Un[r];return s?f5(s):n}return i.replace(e,t)}const ko=[];for(let i=0;i<256;i++)ko[i]=(i<16?"0":"")+i.toString(16);function Hhe(){const i=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,n=Math.random()*4294967295|0;return(ko[i&255]+ko[i>>8&255]+ko[i>>16&255]+ko[i>>24&255]+"-"+ko[e&255]+ko[e>>8&255]+"-"+ko[e>>16&15|64]+ko[e>>24&255]+"-"+ko[t&63|128]+ko[t>>8&255]+"-"+ko[t>>16&255]+ko[t>>24&255]+ko[n&255]+ko[n>>8&255]+ko[n>>16&255]+ko[n>>24&255]).toUpperCase()}const gm=Object.assign||function(){let i=arguments[0];for(let e=1,t=arguments.length;e<t;e++){let n=arguments[e];if(n)for(let r in n)Object.prototype.hasOwnProperty.call(n,r)&&(i[r]=n[r])}return i},Qhe=Date.now(),n7=new WeakMap,i7=new Map;let Vhe=1e10;function d5(i,e){const t=Yhe(e);let n=n7.get(i);if(n||n7.set(i,n=Object.create(null)),n[t])return new n[t];const r=`_onBeforeCompile${t}`,s=function(c,u){i.onBeforeCompile.call(this,c,u);const h=this.customProgramCacheKey()+"|"+c.vertexShader+"|"+c.fragmentShader;let f=i7[h];if(!f){const d=jhe(this,c,e,t);f=i7[h]=d}c.vertexShader=f.vertexShader,c.fragmentShader=f.fragmentShader,gm(c.uniforms,this.uniforms),e.timeUniform&&(c.uniforms[e.timeUniform]={get value(){return Date.now()-Qhe}}),this[r]&&this[r](c)},o=function(){return a(e.chained?i:i.clone())},a=function(c){const u=Object.create(c,l);return Object.defineProperty(u,"baseMaterial",{value:i}),Object.defineProperty(u,"id",{value:Vhe++}),u.uuid=Hhe(),u.uniforms=gm({},c.uniforms,e.uniforms),u.defines=gm({},c.defines,e.defines),u.defines[`TROIKA_DERIVED_MATERIAL_${t}`]="",u.extensions=gm({},c.extensions,e.extensions),u._listeners=void 0,u},l={constructor:{value:o},isDerivedMaterial:{value:!0},type:{get:()=>i.type,set:c=>{i.type=c}},isDerivedFrom:{writable:!0,configurable:!0,value:function(c){const u=this.baseMaterial;return c===u||u.isDerivedMaterial&&u.isDerivedFrom(c)||!1}},customProgramCacheKey:{writable:!0,configurable:!0,value:function(){return i.customProgramCacheKey()+"|"+t}},onBeforeCompile:{get(){return s},set(c){this[r]=c}},copy:{writable:!0,configurable:!0,value:function(c){return i.copy.call(this,c),!i.isShaderMaterial&&!i.isDerivedMaterial&&(gm(this.extensions,c.extensions),gm(this.defines,c.defines),gm(this.uniforms,rp.clone(c.uniforms))),this}},clone:{writable:!0,configurable:!0,value:function(){const c=new i.constructor;return a(c).copy(this)}},getDepthMaterial:{writable:!0,configurable:!0,value:function(){let c=this._depthMaterial;return c||(c=this._depthMaterial=d5(i.isDerivedMaterial?i.getDepthMaterial():new ax({depthPacking:ww}),e),c.defines.IS_DEPTH_MATERIAL="",c.uniforms=this.uniforms),c}},getDistanceMaterial:{writable:!0,configurable:!0,value:function(){let c=this._distanceMaterial;return c||(c=this._distanceMaterial=d5(i.isDerivedMaterial?i.getDistanceMaterial():new Rw,e),c.defines.IS_DISTANCE_MATERIAL="",c.uniforms=this.uniforms),c}},dispose:{writable:!0,configurable:!0,value(){const{_depthMaterial:c,_distanceMaterial:u}=this;c&&c.dispose(),u&&u.dispose(),i.dispose.call(this)}}};return n[t]=o,new o}function jhe(i,{vertexShader:e,fragmentShader:t},n,r){let{vertexDefs:s,vertexMainIntro:o,vertexMainOutro:a,vertexTransform:l,fragmentDefs:c,fragmentMainIntro:u,fragmentMainOutro:h,fragmentColorTransform:f,customRewriter:d,timeUniform:m}=n;if(s=s||"",o=o||"",a=a||"",c=c||"",u=u||"",h=h||"",(l||d)&&(e=f5(e)),(f||d)&&(t=t.replace(/^[ \t]*#include <((?:tonemapping|encodings|colorspace|fog|premultiplied_alpha|dithering)_fragment)>/gm,`
//!BEGIN_POST_CHUNK $1
$&
//!END_POST_CHUNK
`),t=f5(t)),d){let y=d({vertexShader:e,fragmentShader:t});e=y.vertexShader,t=y.fragmentShader}if(f){let y=[];t=t.replace(/^\/\/!BEGIN_POST_CHUNK[^]+?^\/\/!END_POST_CHUNK/gm,g=>(y.push(g),"")),h=`${f}
${y.join(`
`)}
${h}`}if(m){const y=`
uniform float ${m};
`;s=y+s,c=y+c}return l&&(e=`vec3 troika_position_${r};
vec3 troika_normal_${r};
vec2 troika_uv_${r};
${e}
`,s=`${s}
void troikaVertexTransform${r}(inout vec3 position, inout vec3 normal, inout vec2 uv) {
  ${l}
}
`,o=`
troika_position_${r} = vec3(position);
troika_normal_${r} = vec3(normal);
troika_uv_${r} = vec2(uv);
troikaVertexTransform${r}(troika_position_${r}, troika_normal_${r}, troika_uv_${r});
${o}
`,e=e.replace(/\b(position|normal|uv)\b/g,(y,g,A,E)=>/\battribute\s+vec[23]\s+$/.test(E.substr(0,A))?g:`troika_${g}_${r}`),i.map&&i.map.channel>0||(e=e.replace(/\bMAP_UV\b/g,`troika_uv_${r}`))),e=r7(e,r,s,o,a),t=r7(t,r,c,u,h),{vertexShader:e,fragmentShader:t}}function r7(i,e,t,n,r){return(n||r||t)&&(i=i.replace(XH,`
${t}
void troikaOrigMain${e}() {`),i+=`
void main() {
  ${n}
  troikaOrigMain${e}();
  ${r}
}`),i}function Whe(i,e){return i==="uniforms"?void 0:typeof e=="function"?e.toString():e}let Khe=0;const s7=new Map;function Yhe(i){const e=JSON.stringify(i,Whe);let t=s7.get(e);return t==null&&s7.set(e,t=++Khe),t}/*!
Custom build of Typr.ts (https://github.com/fredli74/Typr.ts) for use in Troika text rendering.
Original MIT license applies: https://github.com/fredli74/Typr.ts/blob/master/LICENSE
*/function $he(){return typeof window>"u"&&(self.window=self),(function(i){var e={parse:function(r){var s=e._bin,o=new Uint8Array(r);if(s.readASCII(o,0,4)=="ttcf"){var a=4;s.readUshort(o,a),a+=2,s.readUshort(o,a),a+=2;var l=s.readUint(o,a);a+=4;for(var c=[],u=0;u<l;u++){var h=s.readUint(o,a);a+=4,c.push(e._readFont(o,h))}return c}return[e._readFont(o,0)]},_readFont:function(r,s){var o=e._bin,a=s;o.readFixed(r,s),s+=4;var l=o.readUshort(r,s);s+=2,o.readUshort(r,s),s+=2,o.readUshort(r,s),s+=2,o.readUshort(r,s),s+=2;for(var c=["cmap","head","hhea","maxp","hmtx","name","OS/2","post","loca","glyf","kern","CFF ","GDEF","GPOS","GSUB","SVG "],u={_data:r,_offset:a},h={},f=0;f<l;f++){var d=o.readASCII(r,s,4);s+=4,o.readUint(r,s),s+=4;var m=o.readUint(r,s);s+=4;var y=o.readUint(r,s);s+=4,h[d]={offset:m,length:y}}for(f=0;f<c.length;f++){var g=c[f];h[g]&&(u[g.trim()]=e[g.trim()].parse(r,h[g].offset,h[g].length,u))}return u},_tabOffset:function(r,s,o){for(var a=e._bin,l=a.readUshort(r,o+4),c=o+12,u=0;u<l;u++){var h=a.readASCII(r,c,4);c+=4,a.readUint(r,c),c+=4;var f=a.readUint(r,c);if(c+=4,a.readUint(r,c),c+=4,h==s)return f}return 0}};e._bin={readFixed:function(r,s){return(r[s]<<8|r[s+1])+(r[s+2]<<8|r[s+3])/65540},readF2dot14:function(r,s){return e._bin.readShort(r,s)/16384},readInt:function(r,s){return e._bin._view(r).getInt32(s)},readInt8:function(r,s){return e._bin._view(r).getInt8(s)},readShort:function(r,s){return e._bin._view(r).getInt16(s)},readUshort:function(r,s){return e._bin._view(r).getUint16(s)},readUshorts:function(r,s,o){for(var a=[],l=0;l<o;l++)a.push(e._bin.readUshort(r,s+2*l));return a},readUint:function(r,s){return e._bin._view(r).getUint32(s)},readUint64:function(r,s){return 4294967296*e._bin.readUint(r,s)+e._bin.readUint(r,s+4)},readASCII:function(r,s,o){for(var a="",l=0;l<o;l++)a+=String.fromCharCode(r[s+l]);return a},readUnicode:function(r,s,o){for(var a="",l=0;l<o;l++){var c=r[s++]<<8|r[s++];a+=String.fromCharCode(c)}return a},_tdec:typeof window<"u"&&window.TextDecoder?new window.TextDecoder:null,readUTF8:function(r,s,o){var a=e._bin._tdec;return a&&s==0&&o==r.length?a.decode(r):e._bin.readASCII(r,s,o)},readBytes:function(r,s,o){for(var a=[],l=0;l<o;l++)a.push(r[s+l]);return a},readASCIIArray:function(r,s,o){for(var a=[],l=0;l<o;l++)a.push(String.fromCharCode(r[s+l]));return a},_view:function(r){return r._dataView||(r._dataView=r.buffer?new DataView(r.buffer,r.byteOffset,r.byteLength):new DataView(new Uint8Array(r).buffer))}},e._lctf={},e._lctf.parse=function(r,s,o,a,l){var c=e._bin,u={},h=s;c.readFixed(r,s),s+=4;var f=c.readUshort(r,s);s+=2;var d=c.readUshort(r,s);s+=2;var m=c.readUshort(r,s);return s+=2,u.scriptList=e._lctf.readScriptList(r,h+f),u.featureList=e._lctf.readFeatureList(r,h+d),u.lookupList=e._lctf.readLookupList(r,h+m,l),u},e._lctf.readLookupList=function(r,s,o){var a=e._bin,l=s,c=[],u=a.readUshort(r,s);s+=2;for(var h=0;h<u;h++){var f=a.readUshort(r,s);s+=2;var d=e._lctf.readLookupTable(r,l+f,o);c.push(d)}return c},e._lctf.readLookupTable=function(r,s,o){var a=e._bin,l=s,c={tabs:[]};c.ltype=a.readUshort(r,s),s+=2,c.flag=a.readUshort(r,s),s+=2;var u=a.readUshort(r,s);s+=2;for(var h=c.ltype,f=0;f<u;f++){var d=a.readUshort(r,s);s+=2;var m=o(r,h,l+d,c);c.tabs.push(m)}return c},e._lctf.numOfOnes=function(r){for(var s=0,o=0;o<32;o++)(r>>>o&1)!=0&&s++;return s},e._lctf.readClassDef=function(r,s){var o=e._bin,a=[],l=o.readUshort(r,s);if(s+=2,l==1){var c=o.readUshort(r,s);s+=2;var u=o.readUshort(r,s);s+=2;for(var h=0;h<u;h++)a.push(c+h),a.push(c+h),a.push(o.readUshort(r,s)),s+=2}if(l==2){var f=o.readUshort(r,s);for(s+=2,h=0;h<f;h++)a.push(o.readUshort(r,s)),s+=2,a.push(o.readUshort(r,s)),s+=2,a.push(o.readUshort(r,s)),s+=2}return a},e._lctf.getInterval=function(r,s){for(var o=0;o<r.length;o+=3){var a=r[o],l=r[o+1];if(r[o+2],a<=s&&s<=l)return o}return-1},e._lctf.readCoverage=function(r,s){var o=e._bin,a={};a.fmt=o.readUshort(r,s),s+=2;var l=o.readUshort(r,s);return s+=2,a.fmt==1&&(a.tab=o.readUshorts(r,s,l)),a.fmt==2&&(a.tab=o.readUshorts(r,s,3*l)),a},e._lctf.coverageIndex=function(r,s){var o=r.tab;if(r.fmt==1)return o.indexOf(s);if(r.fmt==2){var a=e._lctf.getInterval(o,s);if(a!=-1)return o[a+2]+(s-o[a])}return-1},e._lctf.readFeatureList=function(r,s){var o=e._bin,a=s,l=[],c=o.readUshort(r,s);s+=2;for(var u=0;u<c;u++){var h=o.readASCII(r,s,4);s+=4;var f=o.readUshort(r,s);s+=2;var d=e._lctf.readFeatureTable(r,a+f);d.tag=h.trim(),l.push(d)}return l},e._lctf.readFeatureTable=function(r,s){var o=e._bin,a=s,l={},c=o.readUshort(r,s);s+=2,c>0&&(l.featureParams=a+c);var u=o.readUshort(r,s);s+=2,l.tab=[];for(var h=0;h<u;h++)l.tab.push(o.readUshort(r,s+2*h));return l},e._lctf.readScriptList=function(r,s){var o=e._bin,a=s,l={},c=o.readUshort(r,s);s+=2;for(var u=0;u<c;u++){var h=o.readASCII(r,s,4);s+=4;var f=o.readUshort(r,s);s+=2,l[h.trim()]=e._lctf.readScriptTable(r,a+f)}return l},e._lctf.readScriptTable=function(r,s){var o=e._bin,a=s,l={},c=o.readUshort(r,s);s+=2,c>0&&(l.default=e._lctf.readLangSysTable(r,a+c));var u=o.readUshort(r,s);s+=2;for(var h=0;h<u;h++){var f=o.readASCII(r,s,4);s+=4;var d=o.readUshort(r,s);s+=2,l[f.trim()]=e._lctf.readLangSysTable(r,a+d)}return l},e._lctf.readLangSysTable=function(r,s){var o=e._bin,a={};o.readUshort(r,s),s+=2,a.reqFeature=o.readUshort(r,s),s+=2;var l=o.readUshort(r,s);return s+=2,a.features=o.readUshorts(r,s,l),a},e.CFF={},e.CFF.parse=function(r,s,o){var a=e._bin;(r=new Uint8Array(r.buffer,s,o))[s=0],r[++s],r[++s],r[++s],s++;var l=[];s=e.CFF.readIndex(r,s,l);for(var c=[],u=0;u<l.length-1;u++)c.push(a.readASCII(r,s+l[u],l[u+1]-l[u]));s+=l[l.length-1];var h=[];s=e.CFF.readIndex(r,s,h);var f=[];for(u=0;u<h.length-1;u++)f.push(e.CFF.readDict(r,s+h[u],s+h[u+1]));s+=h[h.length-1];var d=f[0],m=[];s=e.CFF.readIndex(r,s,m);var y=[];for(u=0;u<m.length-1;u++)y.push(a.readASCII(r,s+m[u],m[u+1]-m[u]));if(s+=m[m.length-1],e.CFF.readSubrs(r,s,d),d.CharStrings){s=d.CharStrings,m=[],s=e.CFF.readIndex(r,s,m);var g=[];for(u=0;u<m.length-1;u++)g.push(a.readBytes(r,s+m[u],m[u+1]-m[u]));d.CharStrings=g}if(d.ROS){s=d.FDArray;var A=[];for(s=e.CFF.readIndex(r,s,A),d.FDArray=[],u=0;u<A.length-1;u++){var E=e.CFF.readDict(r,s+A[u],s+A[u+1]);e.CFF._readFDict(r,E,y),d.FDArray.push(E)}s+=A[A.length-1],s=d.FDSelect,d.FDSelect=[];var x=r[s];if(s++,x!=3)throw x;var w=a.readUshort(r,s);for(s+=2,u=0;u<w+1;u++)d.FDSelect.push(a.readUshort(r,s),r[s+2]),s+=3}return d.Encoding&&(d.Encoding=e.CFF.readEncoding(r,d.Encoding,d.CharStrings.length)),d.charset&&(d.charset=e.CFF.readCharset(r,d.charset,d.CharStrings.length)),e.CFF._readFDict(r,d,y),d},e.CFF._readFDict=function(r,s,o){var a;for(var l in s.Private&&(a=s.Private[1],s.Private=e.CFF.readDict(r,a,a+s.Private[0]),s.Private.Subrs&&e.CFF.readSubrs(r,a+s.Private.Subrs,s.Private)),s)["FamilyName","FontName","FullName","Notice","version","Copyright"].indexOf(l)!=-1&&(s[l]=o[s[l]-426+35])},e.CFF.readSubrs=function(r,s,o){var a=e._bin,l=[];s=e.CFF.readIndex(r,s,l);var c,u=l.length;c=u<1240?107:u<33900?1131:32768,o.Bias=c,o.Subrs=[];for(var h=0;h<l.length-1;h++)o.Subrs.push(a.readBytes(r,s+l[h],l[h+1]-l[h]))},e.CFF.tableSE=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,0,111,112,113,114,0,115,116,117,118,119,120,121,122,0,123,0,124,125,126,127,128,129,130,131,0,132,133,0,134,135,136,137,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,138,0,139,0,0,0,0,140,141,142,143,0,0,0,0,0,144,0,0,0,145,0,0,146,147,148,149,0,0,0,0],e.CFF.glyphByUnicode=function(r,s){for(var o=0;o<r.charset.length;o++)if(r.charset[o]==s)return o;return-1},e.CFF.glyphBySE=function(r,s){return s<0||s>255?-1:e.CFF.glyphByUnicode(r,e.CFF.tableSE[s])},e.CFF.readEncoding=function(r,s,o){e._bin;var a=[".notdef"],l=r[s];if(s++,l!=0)throw"error: unknown encoding format: "+l;var c=r[s];s++;for(var u=0;u<c;u++)a.push(r[s+u]);return a},e.CFF.readCharset=function(r,s,o){var a=e._bin,l=[".notdef"],c=r[s];if(s++,c==0)for(var u=0;u<o;u++){var h=a.readUshort(r,s);s+=2,l.push(h)}else{if(c!=1&&c!=2)throw"error: format: "+c;for(;l.length<o;){h=a.readUshort(r,s),s+=2;var f=0;for(c==1?(f=r[s],s++):(f=a.readUshort(r,s),s+=2),u=0;u<=f;u++)l.push(h),h++}}return l},e.CFF.readIndex=function(r,s,o){var a=e._bin,l=a.readUshort(r,s)+1,c=r[s+=2];if(s++,c==1)for(var u=0;u<l;u++)o.push(r[s+u]);else if(c==2)for(u=0;u<l;u++)o.push(a.readUshort(r,s+2*u));else if(c==3)for(u=0;u<l;u++)o.push(16777215&a.readUint(r,s+3*u-1));else if(l!=1)throw"unsupported offset size: "+c+", count: "+l;return(s+=l*c)-1},e.CFF.getCharString=function(r,s,o){var a=e._bin,l=r[s],c=r[s+1];r[s+2],r[s+3],r[s+4];var u=1,h=null,f=null;l<=20&&(h=l,u=1),l==12&&(h=100*l+c,u=2),21<=l&&l<=27&&(h=l,u=1),l==28&&(f=a.readShort(r,s+1),u=3),29<=l&&l<=31&&(h=l,u=1),32<=l&&l<=246&&(f=l-139,u=1),247<=l&&l<=250&&(f=256*(l-247)+c+108,u=2),251<=l&&l<=254&&(f=256*-(l-251)-c-108,u=2),l==255&&(f=a.readInt(r,s+1)/65535,u=5),o.val=f??"o"+h,o.size=u},e.CFF.readCharString=function(r,s,o){for(var a=s+o,l=e._bin,c=[];s<a;){var u=r[s],h=r[s+1];r[s+2],r[s+3],r[s+4];var f=1,d=null,m=null;u<=20&&(d=u,f=1),u==12&&(d=100*u+h,f=2),u!=19&&u!=20||(d=u,f=2),21<=u&&u<=27&&(d=u,f=1),u==28&&(m=l.readShort(r,s+1),f=3),29<=u&&u<=31&&(d=u,f=1),32<=u&&u<=246&&(m=u-139,f=1),247<=u&&u<=250&&(m=256*(u-247)+h+108,f=2),251<=u&&u<=254&&(m=256*-(u-251)-h-108,f=2),u==255&&(m=l.readInt(r,s+1)/65535,f=5),c.push(m??"o"+d),s+=f}return c},e.CFF.readDict=function(r,s,o){for(var a=e._bin,l={},c=[];s<o;){var u=r[s],h=r[s+1];r[s+2],r[s+3],r[s+4];var f=1,d=null,m=null;if(u==28&&(m=a.readShort(r,s+1),f=3),u==29&&(m=a.readInt(r,s+1),f=5),32<=u&&u<=246&&(m=u-139,f=1),247<=u&&u<=250&&(m=256*(u-247)+h+108,f=2),251<=u&&u<=254&&(m=256*-(u-251)-h-108,f=2),u==255)throw m=a.readInt(r,s+1)/65535,f=5,"unknown number";if(u==30){var y=[];for(f=1;;){var g=r[s+f];f++;var A=g>>4,E=15&g;if(A!=15&&y.push(A),E!=15&&y.push(E),E==15)break}for(var x="",w=[0,1,2,3,4,5,6,7,8,9,".","e","e-","reserved","-","endOfNumber"],T=0;T<y.length;T++)x+=w[y[T]];m=parseFloat(x)}u<=21&&(d=["version","Notice","FullName","FamilyName","Weight","FontBBox","BlueValues","OtherBlues","FamilyBlues","FamilyOtherBlues","StdHW","StdVW","escape","UniqueID","XUID","charset","Encoding","CharStrings","Private","Subrs","defaultWidthX","nominalWidthX"][u],f=1,u==12&&(d=["Copyright","isFixedPitch","ItalicAngle","UnderlinePosition","UnderlineThickness","PaintType","CharstringType","FontMatrix","StrokeWidth","BlueScale","BlueShift","BlueFuzz","StemSnapH","StemSnapV","ForceBold",0,0,"LanguageGroup","ExpansionFactor","initialRandomSeed","SyntheticBase","PostScript","BaseFontName","BaseFontBlend",0,0,0,0,0,0,"ROS","CIDFontVersion","CIDFontRevision","CIDFontType","CIDCount","UIDBase","FDArray","FDSelect","FontName"][h],f=2)),d!=null?(l[d]=c.length==1?c[0]:c,c=[]):c.push(m),s+=f}return l},e.cmap={},e.cmap.parse=function(r,s,o){r=new Uint8Array(r.buffer,s,o),s=0;var a=e._bin,l={};a.readUshort(r,s),s+=2;var c=a.readUshort(r,s);s+=2;var u=[];l.tables=[];for(var h=0;h<c;h++){var f=a.readUshort(r,s);s+=2;var d=a.readUshort(r,s);s+=2;var m=a.readUint(r,s);s+=4;var y="p"+f+"e"+d,g=u.indexOf(m);if(g==-1){var A;g=l.tables.length,u.push(m);var E=a.readUshort(r,m);E==0?A=e.cmap.parse0(r,m):E==4?A=e.cmap.parse4(r,m):E==6?A=e.cmap.parse6(r,m):E==12?A=e.cmap.parse12(r,m):console.debug("unknown format: "+E,f,d,m),l.tables.push(A)}if(l[y]!=null)throw"multiple tables for one platform+encoding";l[y]=g}return l},e.cmap.parse0=function(r,s){var o=e._bin,a={};a.format=o.readUshort(r,s),s+=2;var l=o.readUshort(r,s);s+=2,o.readUshort(r,s),s+=2,a.map=[];for(var c=0;c<l-6;c++)a.map.push(r[s+c]);return a},e.cmap.parse4=function(r,s){var o=e._bin,a=s,l={};l.format=o.readUshort(r,s),s+=2;var c=o.readUshort(r,s);s+=2,o.readUshort(r,s),s+=2;var u=o.readUshort(r,s);s+=2;var h=u/2;l.searchRange=o.readUshort(r,s),s+=2,l.entrySelector=o.readUshort(r,s),s+=2,l.rangeShift=o.readUshort(r,s),s+=2,l.endCount=o.readUshorts(r,s,h),s+=2*h,s+=2,l.startCount=o.readUshorts(r,s,h),s+=2*h,l.idDelta=[];for(var f=0;f<h;f++)l.idDelta.push(o.readShort(r,s)),s+=2;for(l.idRangeOffset=o.readUshorts(r,s,h),s+=2*h,l.glyphIdArray=[];s<a+c;)l.glyphIdArray.push(o.readUshort(r,s)),s+=2;return l},e.cmap.parse6=function(r,s){var o=e._bin,a={};a.format=o.readUshort(r,s),s+=2,o.readUshort(r,s),s+=2,o.readUshort(r,s),s+=2,a.firstCode=o.readUshort(r,s),s+=2;var l=o.readUshort(r,s);s+=2,a.glyphIdArray=[];for(var c=0;c<l;c++)a.glyphIdArray.push(o.readUshort(r,s)),s+=2;return a},e.cmap.parse12=function(r,s){var o=e._bin,a={};a.format=o.readUshort(r,s),s+=2,s+=2,o.readUint(r,s),s+=4,o.readUint(r,s),s+=4;var l=o.readUint(r,s);s+=4,a.groups=[];for(var c=0;c<l;c++){var u=s+12*c,h=o.readUint(r,u+0),f=o.readUint(r,u+4),d=o.readUint(r,u+8);a.groups.push([h,f,d])}return a},e.glyf={},e.glyf.parse=function(r,s,o,a){for(var l=[],c=0;c<a.maxp.numGlyphs;c++)l.push(null);return l},e.glyf._parseGlyf=function(r,s){var o=e._bin,a=r._data,l=e._tabOffset(a,"glyf",r._offset)+r.loca[s];if(r.loca[s]==r.loca[s+1])return null;var c={};if(c.noc=o.readShort(a,l),l+=2,c.xMin=o.readShort(a,l),l+=2,c.yMin=o.readShort(a,l),l+=2,c.xMax=o.readShort(a,l),l+=2,c.yMax=o.readShort(a,l),l+=2,c.xMin>=c.xMax||c.yMin>=c.yMax)return null;if(c.noc>0){c.endPts=[];for(var u=0;u<c.noc;u++)c.endPts.push(o.readUshort(a,l)),l+=2;var h=o.readUshort(a,l);if(l+=2,a.length-l<h)return null;c.instructions=o.readBytes(a,l,h),l+=h;var f=c.endPts[c.noc-1]+1;for(c.flags=[],u=0;u<f;u++){var d=a[l];if(l++,c.flags.push(d),(8&d)!=0){var m=a[l];l++;for(var y=0;y<m;y++)c.flags.push(d),u++}}for(c.xs=[],u=0;u<f;u++){var g=(2&c.flags[u])!=0,A=(16&c.flags[u])!=0;g?(c.xs.push(A?a[l]:-a[l]),l++):A?c.xs.push(0):(c.xs.push(o.readShort(a,l)),l+=2)}for(c.ys=[],u=0;u<f;u++)g=(4&c.flags[u])!=0,A=(32&c.flags[u])!=0,g?(c.ys.push(A?a[l]:-a[l]),l++):A?c.ys.push(0):(c.ys.push(o.readShort(a,l)),l+=2);var E=0,x=0;for(u=0;u<f;u++)E+=c.xs[u],x+=c.ys[u],c.xs[u]=E,c.ys[u]=x}else{var w;c.parts=[];do{w=o.readUshort(a,l),l+=2;var T={m:{a:1,b:0,c:0,d:1,tx:0,ty:0},p1:-1,p2:-1};if(c.parts.push(T),T.glyphIndex=o.readUshort(a,l),l+=2,1&w){var I=o.readShort(a,l);l+=2;var M=o.readShort(a,l);l+=2}else I=o.readInt8(a,l),l++,M=o.readInt8(a,l),l++;2&w?(T.m.tx=I,T.m.ty=M):(T.p1=I,T.p2=M),8&w?(T.m.a=T.m.d=o.readF2dot14(a,l),l+=2):64&w?(T.m.a=o.readF2dot14(a,l),l+=2,T.m.d=o.readF2dot14(a,l),l+=2):128&w&&(T.m.a=o.readF2dot14(a,l),l+=2,T.m.b=o.readF2dot14(a,l),l+=2,T.m.c=o.readF2dot14(a,l),l+=2,T.m.d=o.readF2dot14(a,l),l+=2)}while(32&w);if(256&w){var L=o.readUshort(a,l);for(l+=2,c.instr=[],u=0;u<L;u++)c.instr.push(a[l]),l++}}return c},e.GDEF={},e.GDEF.parse=function(r,s,o,a){var l=s;s+=4;var c=e._bin.readUshort(r,s);return{glyphClassDef:c===0?null:e._lctf.readClassDef(r,l+c)}},e.GPOS={},e.GPOS.parse=function(r,s,o,a){return e._lctf.parse(r,s,o,a,e.GPOS.subt)},e.GPOS.subt=function(r,s,o,a){var l=e._bin,c=o,u={};if(u.fmt=l.readUshort(r,o),o+=2,s==1||s==2||s==3||s==7||s==8&&u.fmt<=2){var h=l.readUshort(r,o);o+=2,u.coverage=e._lctf.readCoverage(r,h+c)}if(s==1&&u.fmt==1){var f=l.readUshort(r,o);o+=2,f!=0&&(u.pos=e.GPOS.readValueRecord(r,o,f))}else if(s==2&&u.fmt>=1&&u.fmt<=2){f=l.readUshort(r,o),o+=2;var d=l.readUshort(r,o);o+=2;var m=e._lctf.numOfOnes(f),y=e._lctf.numOfOnes(d);if(u.fmt==1){u.pairsets=[];var g=l.readUshort(r,o);o+=2;for(var A=0;A<g;A++){var E=c+l.readUshort(r,o);o+=2;var x=l.readUshort(r,E);E+=2;for(var w=[],T=0;T<x;T++){var I=l.readUshort(r,E);E+=2,f!=0&&(k=e.GPOS.readValueRecord(r,E,f),E+=2*m),d!=0&&(H=e.GPOS.readValueRecord(r,E,d),E+=2*y),w.push({gid2:I,val1:k,val2:H})}u.pairsets.push(w)}}if(u.fmt==2){var M=l.readUshort(r,o);o+=2;var L=l.readUshort(r,o);o+=2;var P=l.readUshort(r,o);o+=2;var R=l.readUshort(r,o);for(o+=2,u.classDef1=e._lctf.readClassDef(r,c+M),u.classDef2=e._lctf.readClassDef(r,c+L),u.matrix=[],A=0;A<P;A++){var U=[];for(T=0;T<R;T++){var k=null,H=null;f!=0&&(k=e.GPOS.readValueRecord(r,o,f),o+=2*m),d!=0&&(H=e.GPOS.readValueRecord(r,o,d),o+=2*y),U.push({val1:k,val2:H})}u.matrix.push(U)}}}else if(s==4&&u.fmt==1)u.markCoverage=e._lctf.readCoverage(r,l.readUshort(r,o)+c),u.baseCoverage=e._lctf.readCoverage(r,l.readUshort(r,o+2)+c),u.markClassCount=l.readUshort(r,o+4),u.markArray=e.GPOS.readMarkArray(r,l.readUshort(r,o+6)+c),u.baseArray=e.GPOS.readBaseArray(r,l.readUshort(r,o+8)+c,u.markClassCount);else if(s==6&&u.fmt==1)u.mark1Coverage=e._lctf.readCoverage(r,l.readUshort(r,o)+c),u.mark2Coverage=e._lctf.readCoverage(r,l.readUshort(r,o+2)+c),u.markClassCount=l.readUshort(r,o+4),u.mark1Array=e.GPOS.readMarkArray(r,l.readUshort(r,o+6)+c),u.mark2Array=e.GPOS.readBaseArray(r,l.readUshort(r,o+8)+c,u.markClassCount);else{if(s==9&&u.fmt==1){var G=l.readUshort(r,o);o+=2;var X=l.readUint(r,o);if(o+=4,a.ltype==9)a.ltype=G;else if(a.ltype!=G)throw"invalid extension substitution";return e.GPOS.subt(r,a.ltype,c+X)}console.debug("unsupported GPOS table LookupType",s,"format",u.fmt)}return u},e.GPOS.readValueRecord=function(r,s,o){var a=e._bin,l=[];return l.push(1&o?a.readShort(r,s):0),s+=1&o?2:0,l.push(2&o?a.readShort(r,s):0),s+=2&o?2:0,l.push(4&o?a.readShort(r,s):0),s+=4&o?2:0,l.push(8&o?a.readShort(r,s):0),s+=8&o?2:0,l},e.GPOS.readBaseArray=function(r,s,o){var a=e._bin,l=[],c=s,u=a.readUshort(r,s);s+=2;for(var h=0;h<u;h++){for(var f=[],d=0;d<o;d++)f.push(e.GPOS.readAnchorRecord(r,c+a.readUshort(r,s))),s+=2;l.push(f)}return l},e.GPOS.readMarkArray=function(r,s){var o=e._bin,a=[],l=s,c=o.readUshort(r,s);s+=2;for(var u=0;u<c;u++){var h=e.GPOS.readAnchorRecord(r,o.readUshort(r,s+2)+l);h.markClass=o.readUshort(r,s),a.push(h),s+=4}return a},e.GPOS.readAnchorRecord=function(r,s){var o=e._bin,a={};return a.fmt=o.readUshort(r,s),a.x=o.readShort(r,s+2),a.y=o.readShort(r,s+4),a},e.GSUB={},e.GSUB.parse=function(r,s,o,a){return e._lctf.parse(r,s,o,a,e.GSUB.subt)},e.GSUB.subt=function(r,s,o,a){var l=e._bin,c=o,u={};if(u.fmt=l.readUshort(r,o),o+=2,s!=1&&s!=2&&s!=4&&s!=5&&s!=6)return null;if(s==1||s==2||s==4||s==5&&u.fmt<=2||s==6&&u.fmt<=2){var h=l.readUshort(r,o);o+=2,u.coverage=e._lctf.readCoverage(r,c+h)}if(s==1&&u.fmt>=1&&u.fmt<=2){if(u.fmt==1)u.delta=l.readShort(r,o),o+=2;else if(u.fmt==2){var f=l.readUshort(r,o);o+=2,u.newg=l.readUshorts(r,o,f),o+=2*u.newg.length}}else if(s==2&&u.fmt==1){f=l.readUshort(r,o),o+=2,u.seqs=[];for(var d=0;d<f;d++){var m=l.readUshort(r,o)+c;o+=2;var y=l.readUshort(r,m);u.seqs.push(l.readUshorts(r,m+2,y))}}else if(s==4)for(u.vals=[],f=l.readUshort(r,o),o+=2,d=0;d<f;d++){var g=l.readUshort(r,o);o+=2,u.vals.push(e.GSUB.readLigatureSet(r,c+g))}else if(s==5&&u.fmt==2){if(u.fmt==2){var A=l.readUshort(r,o);o+=2,u.cDef=e._lctf.readClassDef(r,c+A),u.scset=[];var E=l.readUshort(r,o);for(o+=2,d=0;d<E;d++){var x=l.readUshort(r,o);o+=2,u.scset.push(x==0?null:e.GSUB.readSubClassSet(r,c+x))}}}else if(s==6&&u.fmt==3){if(u.fmt==3){for(d=0;d<3;d++){f=l.readUshort(r,o),o+=2;for(var w=[],T=0;T<f;T++)w.push(e._lctf.readCoverage(r,c+l.readUshort(r,o+2*T)));o+=2*f,d==0&&(u.backCvg=w),d==1&&(u.inptCvg=w),d==2&&(u.ahedCvg=w)}f=l.readUshort(r,o),o+=2,u.lookupRec=e.GSUB.readSubstLookupRecords(r,o,f)}}else{if(s==7&&u.fmt==1){var I=l.readUshort(r,o);o+=2;var M=l.readUint(r,o);if(o+=4,a.ltype==9)a.ltype=I;else if(a.ltype!=I)throw"invalid extension substitution";return e.GSUB.subt(r,a.ltype,c+M)}console.debug("unsupported GSUB table LookupType",s,"format",u.fmt)}return u},e.GSUB.readSubClassSet=function(r,s){var o=e._bin.readUshort,a=s,l=[],c=o(r,s);s+=2;for(var u=0;u<c;u++){var h=o(r,s);s+=2,l.push(e.GSUB.readSubClassRule(r,a+h))}return l},e.GSUB.readSubClassRule=function(r,s){var o=e._bin.readUshort,a={},l=o(r,s),c=o(r,s+=2);s+=2,a.input=[];for(var u=0;u<l-1;u++)a.input.push(o(r,s)),s+=2;return a.substLookupRecords=e.GSUB.readSubstLookupRecords(r,s,c),a},e.GSUB.readSubstLookupRecords=function(r,s,o){for(var a=e._bin.readUshort,l=[],c=0;c<o;c++)l.push(a(r,s),a(r,s+2)),s+=4;return l},e.GSUB.readChainSubClassSet=function(r,s){var o=e._bin,a=s,l=[],c=o.readUshort(r,s);s+=2;for(var u=0;u<c;u++){var h=o.readUshort(r,s);s+=2,l.push(e.GSUB.readChainSubClassRule(r,a+h))}return l},e.GSUB.readChainSubClassRule=function(r,s){for(var o=e._bin,a={},l=["backtrack","input","lookahead"],c=0;c<l.length;c++){var u=o.readUshort(r,s);s+=2,c==1&&u--,a[l[c]]=o.readUshorts(r,s,u),s+=2*a[l[c]].length}return u=o.readUshort(r,s),s+=2,a.subst=o.readUshorts(r,s,2*u),s+=2*a.subst.length,a},e.GSUB.readLigatureSet=function(r,s){var o=e._bin,a=s,l=[],c=o.readUshort(r,s);s+=2;for(var u=0;u<c;u++){var h=o.readUshort(r,s);s+=2,l.push(e.GSUB.readLigature(r,a+h))}return l},e.GSUB.readLigature=function(r,s){var o=e._bin,a={chain:[]};a.nglyph=o.readUshort(r,s),s+=2;var l=o.readUshort(r,s);s+=2;for(var c=0;c<l-1;c++)a.chain.push(o.readUshort(r,s)),s+=2;return a},e.head={},e.head.parse=function(r,s,o){var a=e._bin,l={};return a.readFixed(r,s),s+=4,l.fontRevision=a.readFixed(r,s),s+=4,a.readUint(r,s),s+=4,a.readUint(r,s),s+=4,l.flags=a.readUshort(r,s),s+=2,l.unitsPerEm=a.readUshort(r,s),s+=2,l.created=a.readUint64(r,s),s+=8,l.modified=a.readUint64(r,s),s+=8,l.xMin=a.readShort(r,s),s+=2,l.yMin=a.readShort(r,s),s+=2,l.xMax=a.readShort(r,s),s+=2,l.yMax=a.readShort(r,s),s+=2,l.macStyle=a.readUshort(r,s),s+=2,l.lowestRecPPEM=a.readUshort(r,s),s+=2,l.fontDirectionHint=a.readShort(r,s),s+=2,l.indexToLocFormat=a.readShort(r,s),s+=2,l.glyphDataFormat=a.readShort(r,s),s+=2,l},e.hhea={},e.hhea.parse=function(r,s,o){var a=e._bin,l={};return a.readFixed(r,s),s+=4,l.ascender=a.readShort(r,s),s+=2,l.descender=a.readShort(r,s),s+=2,l.lineGap=a.readShort(r,s),s+=2,l.advanceWidthMax=a.readUshort(r,s),s+=2,l.minLeftSideBearing=a.readShort(r,s),s+=2,l.minRightSideBearing=a.readShort(r,s),s+=2,l.xMaxExtent=a.readShort(r,s),s+=2,l.caretSlopeRise=a.readShort(r,s),s+=2,l.caretSlopeRun=a.readShort(r,s),s+=2,l.caretOffset=a.readShort(r,s),s+=2,s+=8,l.metricDataFormat=a.readShort(r,s),s+=2,l.numberOfHMetrics=a.readUshort(r,s),s+=2,l},e.hmtx={},e.hmtx.parse=function(r,s,o,a){for(var l=e._bin,c={aWidth:[],lsBearing:[]},u=0,h=0,f=0;f<a.maxp.numGlyphs;f++)f<a.hhea.numberOfHMetrics&&(u=l.readUshort(r,s),s+=2,h=l.readShort(r,s),s+=2),c.aWidth.push(u),c.lsBearing.push(h);return c},e.kern={},e.kern.parse=function(r,s,o,a){var l=e._bin,c=l.readUshort(r,s);if(s+=2,c==1)return e.kern.parseV1(r,s-2,o,a);var u=l.readUshort(r,s);s+=2;for(var h={glyph1:[],rval:[]},f=0;f<u;f++){s+=2,o=l.readUshort(r,s),s+=2;var d=l.readUshort(r,s);s+=2;var m=d>>>8;if((m&=15)!=0)throw"unknown kern table format: "+m;s=e.kern.readFormat0(r,s,h)}return h},e.kern.parseV1=function(r,s,o,a){var l=e._bin;l.readFixed(r,s),s+=4;var c=l.readUint(r,s);s+=4;for(var u={glyph1:[],rval:[]},h=0;h<c;h++){l.readUint(r,s),s+=4;var f=l.readUshort(r,s);s+=2,l.readUshort(r,s),s+=2;var d=f>>>8;if((d&=15)!=0)throw"unknown kern table format: "+d;s=e.kern.readFormat0(r,s,u)}return u},e.kern.readFormat0=function(r,s,o){var a=e._bin,l=-1,c=a.readUshort(r,s);s+=2,a.readUshort(r,s),s+=2,a.readUshort(r,s),s+=2,a.readUshort(r,s),s+=2;for(var u=0;u<c;u++){var h=a.readUshort(r,s);s+=2;var f=a.readUshort(r,s);s+=2;var d=a.readShort(r,s);s+=2,h!=l&&(o.glyph1.push(h),o.rval.push({glyph2:[],vals:[]}));var m=o.rval[o.rval.length-1];m.glyph2.push(f),m.vals.push(d),l=h}return s},e.loca={},e.loca.parse=function(r,s,o,a){var l=e._bin,c=[],u=a.head.indexToLocFormat,h=a.maxp.numGlyphs+1;if(u==0)for(var f=0;f<h;f++)c.push(l.readUshort(r,s+(f<<1))<<1);if(u==1)for(f=0;f<h;f++)c.push(l.readUint(r,s+(f<<2)));return c},e.maxp={},e.maxp.parse=function(r,s,o){var a=e._bin,l={},c=a.readUint(r,s);return s+=4,l.numGlyphs=a.readUshort(r,s),s+=2,c==65536&&(l.maxPoints=a.readUshort(r,s),s+=2,l.maxContours=a.readUshort(r,s),s+=2,l.maxCompositePoints=a.readUshort(r,s),s+=2,l.maxCompositeContours=a.readUshort(r,s),s+=2,l.maxZones=a.readUshort(r,s),s+=2,l.maxTwilightPoints=a.readUshort(r,s),s+=2,l.maxStorage=a.readUshort(r,s),s+=2,l.maxFunctionDefs=a.readUshort(r,s),s+=2,l.maxInstructionDefs=a.readUshort(r,s),s+=2,l.maxStackElements=a.readUshort(r,s),s+=2,l.maxSizeOfInstructions=a.readUshort(r,s),s+=2,l.maxComponentElements=a.readUshort(r,s),s+=2,l.maxComponentDepth=a.readUshort(r,s),s+=2),l},e.name={},e.name.parse=function(r,s,o){var a=e._bin,l={};a.readUshort(r,s),s+=2;var c=a.readUshort(r,s);s+=2,a.readUshort(r,s);for(var u,h=["copyright","fontFamily","fontSubfamily","ID","fullName","version","postScriptName","trademark","manufacturer","designer","description","urlVendor","urlDesigner","licence","licenceURL","---","typoFamilyName","typoSubfamilyName","compatibleFull","sampleText","postScriptCID","wwsFamilyName","wwsSubfamilyName","lightPalette","darkPalette"],f=s+=2,d=0;d<c;d++){var m=a.readUshort(r,s);s+=2;var y=a.readUshort(r,s);s+=2;var g=a.readUshort(r,s);s+=2;var A=a.readUshort(r,s);s+=2;var E=a.readUshort(r,s);s+=2;var x=a.readUshort(r,s);s+=2;var w,T=h[A],I=f+12*c+x;if(m==0)w=a.readUnicode(r,I,E/2);else if(m==3&&y==0)w=a.readUnicode(r,I,E/2);else if(y==0)w=a.readASCII(r,I,E);else if(y==1)w=a.readUnicode(r,I,E/2);else if(y==3)w=a.readUnicode(r,I,E/2);else{if(m!=1)throw"unknown encoding "+y+", platformID: "+m;w=a.readASCII(r,I,E),console.debug("reading unknown MAC encoding "+y+" as ASCII")}var M="p"+m+","+g.toString(16);l[M]==null&&(l[M]={}),l[M][T!==void 0?T:A]=w,l[M]._lang=g}for(var L in l)if(l[L].postScriptName!=null&&l[L]._lang==1033)return l[L];for(var L in l)if(l[L].postScriptName!=null&&l[L]._lang==0)return l[L];for(var L in l)if(l[L].postScriptName!=null&&l[L]._lang==3084)return l[L];for(var L in l)if(l[L].postScriptName!=null)return l[L];for(var L in l){u=L;break}return console.debug("returning name table with languageID "+l[u]._lang),l[u]},e["OS/2"]={},e["OS/2"].parse=function(r,s,o){var a=e._bin.readUshort(r,s);s+=2;var l={};if(a==0)e["OS/2"].version0(r,s,l);else if(a==1)e["OS/2"].version1(r,s,l);else if(a==2||a==3||a==4)e["OS/2"].version2(r,s,l);else{if(a!=5)throw"unknown OS/2 table version: "+a;e["OS/2"].version5(r,s,l)}return l},e["OS/2"].version0=function(r,s,o){var a=e._bin;return o.xAvgCharWidth=a.readShort(r,s),s+=2,o.usWeightClass=a.readUshort(r,s),s+=2,o.usWidthClass=a.readUshort(r,s),s+=2,o.fsType=a.readUshort(r,s),s+=2,o.ySubscriptXSize=a.readShort(r,s),s+=2,o.ySubscriptYSize=a.readShort(r,s),s+=2,o.ySubscriptXOffset=a.readShort(r,s),s+=2,o.ySubscriptYOffset=a.readShort(r,s),s+=2,o.ySuperscriptXSize=a.readShort(r,s),s+=2,o.ySuperscriptYSize=a.readShort(r,s),s+=2,o.ySuperscriptXOffset=a.readShort(r,s),s+=2,o.ySuperscriptYOffset=a.readShort(r,s),s+=2,o.yStrikeoutSize=a.readShort(r,s),s+=2,o.yStrikeoutPosition=a.readShort(r,s),s+=2,o.sFamilyClass=a.readShort(r,s),s+=2,o.panose=a.readBytes(r,s,10),s+=10,o.ulUnicodeRange1=a.readUint(r,s),s+=4,o.ulUnicodeRange2=a.readUint(r,s),s+=4,o.ulUnicodeRange3=a.readUint(r,s),s+=4,o.ulUnicodeRange4=a.readUint(r,s),s+=4,o.achVendID=[a.readInt8(r,s),a.readInt8(r,s+1),a.readInt8(r,s+2),a.readInt8(r,s+3)],s+=4,o.fsSelection=a.readUshort(r,s),s+=2,o.usFirstCharIndex=a.readUshort(r,s),s+=2,o.usLastCharIndex=a.readUshort(r,s),s+=2,o.sTypoAscender=a.readShort(r,s),s+=2,o.sTypoDescender=a.readShort(r,s),s+=2,o.sTypoLineGap=a.readShort(r,s),s+=2,o.usWinAscent=a.readUshort(r,s),s+=2,o.usWinDescent=a.readUshort(r,s),s+=2},e["OS/2"].version1=function(r,s,o){var a=e._bin;return s=e["OS/2"].version0(r,s,o),o.ulCodePageRange1=a.readUint(r,s),s+=4,o.ulCodePageRange2=a.readUint(r,s),s+=4},e["OS/2"].version2=function(r,s,o){var a=e._bin;return s=e["OS/2"].version1(r,s,o),o.sxHeight=a.readShort(r,s),s+=2,o.sCapHeight=a.readShort(r,s),s+=2,o.usDefault=a.readUshort(r,s),s+=2,o.usBreak=a.readUshort(r,s),s+=2,o.usMaxContext=a.readUshort(r,s),s+=2},e["OS/2"].version5=function(r,s,o){var a=e._bin;return s=e["OS/2"].version2(r,s,o),o.usLowerOpticalPointSize=a.readUshort(r,s),s+=2,o.usUpperOpticalPointSize=a.readUshort(r,s),s+=2},e.post={},e.post.parse=function(r,s,o){var a=e._bin,l={};return l.version=a.readFixed(r,s),s+=4,l.italicAngle=a.readFixed(r,s),s+=4,l.underlinePosition=a.readShort(r,s),s+=2,l.underlineThickness=a.readShort(r,s),s+=2,l},e==null&&(e={}),e.U==null&&(e.U={}),e.U.codeToGlyph=function(r,s){var o=r.cmap,a=-1;if(o.p0e4!=null?a=o.p0e4:o.p3e1!=null?a=o.p3e1:o.p1e0!=null?a=o.p1e0:o.p0e3!=null&&(a=o.p0e3),a==-1)throw"no familiar platform and encoding!";var l=o.tables[a];if(l.format==0)return s>=l.map.length?0:l.map[s];if(l.format==4){for(var c=-1,u=0;u<l.endCount.length;u++)if(s<=l.endCount[u]){c=u;break}return c==-1||l.startCount[c]>s?0:65535&(l.idRangeOffset[c]!=0?l.glyphIdArray[s-l.startCount[c]+(l.idRangeOffset[c]>>1)-(l.idRangeOffset.length-c)]:s+l.idDelta[c])}if(l.format==12){if(s>l.groups[l.groups.length-1][1])return 0;for(u=0;u<l.groups.length;u++){var h=l.groups[u];if(h[0]<=s&&s<=h[1])return h[2]+(s-h[0])}return 0}throw"unknown cmap table format "+l.format},e.U.glyphToPath=function(r,s){var o={cmds:[],crds:[]};if(r.SVG&&r.SVG.entries[s]){var a=r.SVG.entries[s];return a==null?o:(typeof a=="string"&&(a=e.SVG.toPath(a),r.SVG.entries[s]=a),a)}if(r.CFF){var l={x:0,y:0,stack:[],nStems:0,haveWidth:!1,width:r.CFF.Private?r.CFF.Private.defaultWidthX:0,open:!1},c=r.CFF,u=r.CFF.Private;if(c.ROS){for(var h=0;c.FDSelect[h+2]<=s;)h+=2;u=c.FDArray[c.FDSelect[h+1]].Private}e.U._drawCFF(r.CFF.CharStrings[s],l,c,u,o)}else r.glyf&&e.U._drawGlyf(s,r,o);return o},e.U._drawGlyf=function(r,s,o){var a=s.glyf[r];a==null&&(a=s.glyf[r]=e.glyf._parseGlyf(s,r)),a!=null&&(a.noc>-1?e.U._simpleGlyph(a,o):e.U._compoGlyph(a,s,o))},e.U._simpleGlyph=function(r,s){for(var o=0;o<r.noc;o++){for(var a=o==0?0:r.endPts[o-1]+1,l=r.endPts[o],c=a;c<=l;c++){var u=c==a?l:c-1,h=c==l?a:c+1,f=1&r.flags[c],d=1&r.flags[u],m=1&r.flags[h],y=r.xs[c],g=r.ys[c];if(c==a)if(f){if(!d){e.U.P.moveTo(s,y,g);continue}e.U.P.moveTo(s,r.xs[u],r.ys[u])}else d?e.U.P.moveTo(s,r.xs[u],r.ys[u]):e.U.P.moveTo(s,(r.xs[u]+y)/2,(r.ys[u]+g)/2);f?d&&e.U.P.lineTo(s,y,g):m?e.U.P.qcurveTo(s,y,g,r.xs[h],r.ys[h]):e.U.P.qcurveTo(s,y,g,(y+r.xs[h])/2,(g+r.ys[h])/2)}e.U.P.closePath(s)}},e.U._compoGlyph=function(r,s,o){for(var a=0;a<r.parts.length;a++){var l={cmds:[],crds:[]},c=r.parts[a];e.U._drawGlyf(c.glyphIndex,s,l);for(var u=c.m,h=0;h<l.crds.length;h+=2){var f=l.crds[h],d=l.crds[h+1];o.crds.push(f*u.a+d*u.b+u.tx),o.crds.push(f*u.c+d*u.d+u.ty)}for(h=0;h<l.cmds.length;h++)o.cmds.push(l.cmds[h])}},e.U._getGlyphClass=function(r,s){var o=e._lctf.getInterval(s,r);return o==-1?0:s[o+2]},e.U._applySubs=function(r,s,o,a){for(var l=r.length-s-1,c=0;c<o.tabs.length;c++)if(o.tabs[c]!=null){var u,h=o.tabs[c];if(!h.coverage||(u=e._lctf.coverageIndex(h.coverage,r[s]))!=-1){if(o.ltype==1)r[s],h.fmt==1?r[s]=r[s]+h.delta:r[s]=h.newg[u];else if(o.ltype==4)for(var f=h.vals[u],d=0;d<f.length;d++){var m=f[d],y=m.chain.length;if(!(y>l)){for(var g=!0,A=0,E=0;E<y;E++){for(;r[s+A+(1+E)]==-1;)A++;m.chain[E]!=r[s+A+(1+E)]&&(g=!1)}if(g){for(r[s]=m.nglyph,E=0;E<y+A;E++)r[s+E+1]=-1;break}}}else if(o.ltype==5&&h.fmt==2)for(var x=e._lctf.getInterval(h.cDef,r[s]),w=h.cDef[x+2],T=h.scset[w],I=0;I<T.length;I++){var M=T[I],L=M.input;if(!(L.length>l)){for(g=!0,E=0;E<L.length;E++){var P=e._lctf.getInterval(h.cDef,r[s+1+E]);if(x==-1&&h.cDef[P+2]!=L[E]){g=!1;break}}if(g){var R=M.substLookupRecords;for(d=0;d<R.length;d+=2)R[d],R[d+1]}}}else if(o.ltype==6&&h.fmt==3){if(!e.U._glsCovered(r,h.backCvg,s-h.backCvg.length)||!e.U._glsCovered(r,h.inptCvg,s)||!e.U._glsCovered(r,h.ahedCvg,s+h.inptCvg.length))continue;var U=h.lookupRec;for(I=0;I<U.length;I+=2){x=U[I];var k=a[U[I+1]];e.U._applySubs(r,s+x,k,a)}}}}},e.U._glsCovered=function(r,s,o){for(var a=0;a<s.length;a++)if(e._lctf.coverageIndex(s[a],r[o+a])==-1)return!1;return!0},e.U.glyphsToPath=function(r,s,o){for(var a={cmds:[],crds:[]},l=0,c=0;c<s.length;c++){var u=s[c];if(u!=-1){for(var h=c<s.length-1&&s[c+1]!=-1?s[c+1]:0,f=e.U.glyphToPath(r,u),d=0;d<f.crds.length;d+=2)a.crds.push(f.crds[d]+l),a.crds.push(f.crds[d+1]);for(o&&a.cmds.push(o),d=0;d<f.cmds.length;d++)a.cmds.push(f.cmds[d]);o&&a.cmds.push("X"),l+=r.hmtx.aWidth[u],c<s.length-1&&(l+=e.U.getPairAdjustment(r,u,h))}}return a},e.U.P={},e.U.P.moveTo=function(r,s,o){r.cmds.push("M"),r.crds.push(s,o)},e.U.P.lineTo=function(r,s,o){r.cmds.push("L"),r.crds.push(s,o)},e.U.P.curveTo=function(r,s,o,a,l,c,u){r.cmds.push("C"),r.crds.push(s,o,a,l,c,u)},e.U.P.qcurveTo=function(r,s,o,a,l){r.cmds.push("Q"),r.crds.push(s,o,a,l)},e.U.P.closePath=function(r){r.cmds.push("Z")},e.U._drawCFF=function(r,s,o,a,l){for(var c=s.stack,u=s.nStems,h=s.haveWidth,f=s.width,d=s.open,m=0,y=s.x,g=s.y,A=0,E=0,x=0,w=0,T=0,I=0,M=0,L=0,P=0,R=0,U={val:0,size:0};m<r.length;){e.CFF.getCharString(r,m,U);var k=U.val;if(m+=U.size,k=="o1"||k=="o18")c.length%2!=0&&!h&&(f=c.shift()+a.nominalWidthX),u+=c.length>>1,c.length=0,h=!0;else if(k=="o3"||k=="o23")c.length%2!=0&&!h&&(f=c.shift()+a.nominalWidthX),u+=c.length>>1,c.length=0,h=!0;else if(k=="o4")c.length>1&&!h&&(f=c.shift()+a.nominalWidthX,h=!0),d&&e.U.P.closePath(l),g+=c.pop(),e.U.P.moveTo(l,y,g),d=!0;else if(k=="o5")for(;c.length>0;)y+=c.shift(),g+=c.shift(),e.U.P.lineTo(l,y,g);else if(k=="o6"||k=="o7")for(var H=c.length,G=k=="o6",X=0;X<H;X++){var Z=c.shift();G?y+=Z:g+=Z,G=!G,e.U.P.lineTo(l,y,g)}else if(k=="o8"||k=="o24"){H=c.length;for(var oe=0;oe+6<=H;)A=y+c.shift(),E=g+c.shift(),x=A+c.shift(),w=E+c.shift(),y=x+c.shift(),g=w+c.shift(),e.U.P.curveTo(l,A,E,x,w,y,g),oe+=6;k=="o24"&&(y+=c.shift(),g+=c.shift(),e.U.P.lineTo(l,y,g))}else{if(k=="o11")break;if(k=="o1234"||k=="o1235"||k=="o1236"||k=="o1237")k=="o1234"&&(E=g,x=(A=y+c.shift())+c.shift(),R=w=E+c.shift(),I=w,L=g,y=(M=(T=(P=x+c.shift())+c.shift())+c.shift())+c.shift(),e.U.P.curveTo(l,A,E,x,w,P,R),e.U.P.curveTo(l,T,I,M,L,y,g)),k=="o1235"&&(A=y+c.shift(),E=g+c.shift(),x=A+c.shift(),w=E+c.shift(),P=x+c.shift(),R=w+c.shift(),T=P+c.shift(),I=R+c.shift(),M=T+c.shift(),L=I+c.shift(),y=M+c.shift(),g=L+c.shift(),c.shift(),e.U.P.curveTo(l,A,E,x,w,P,R),e.U.P.curveTo(l,T,I,M,L,y,g)),k=="o1236"&&(A=y+c.shift(),E=g+c.shift(),x=A+c.shift(),R=w=E+c.shift(),I=w,M=(T=(P=x+c.shift())+c.shift())+c.shift(),L=I+c.shift(),y=M+c.shift(),e.U.P.curveTo(l,A,E,x,w,P,R),e.U.P.curveTo(l,T,I,M,L,y,g)),k=="o1237"&&(A=y+c.shift(),E=g+c.shift(),x=A+c.shift(),w=E+c.shift(),P=x+c.shift(),R=w+c.shift(),T=P+c.shift(),I=R+c.shift(),M=T+c.shift(),L=I+c.shift(),Math.abs(M-y)>Math.abs(L-g)?y=M+c.shift():g=L+c.shift(),e.U.P.curveTo(l,A,E,x,w,P,R),e.U.P.curveTo(l,T,I,M,L,y,g));else if(k=="o14"){if(c.length>0&&!h&&(f=c.shift()+o.nominalWidthX,h=!0),c.length==4){var K=c.shift(),V=c.shift(),W=c.shift(),F=c.shift(),Y=e.CFF.glyphBySE(o,W),te=e.CFF.glyphBySE(o,F);e.U._drawCFF(o.CharStrings[Y],s,o,a,l),s.x=K,s.y=V,e.U._drawCFF(o.CharStrings[te],s,o,a,l)}d&&(e.U.P.closePath(l),d=!1)}else if(k=="o19"||k=="o20")c.length%2!=0&&!h&&(f=c.shift()+a.nominalWidthX),u+=c.length>>1,c.length=0,h=!0,m+=u+7>>3;else if(k=="o21")c.length>2&&!h&&(f=c.shift()+a.nominalWidthX,h=!0),g+=c.pop(),y+=c.pop(),d&&e.U.P.closePath(l),e.U.P.moveTo(l,y,g),d=!0;else if(k=="o22")c.length>1&&!h&&(f=c.shift()+a.nominalWidthX,h=!0),y+=c.pop(),d&&e.U.P.closePath(l),e.U.P.moveTo(l,y,g),d=!0;else if(k=="o25"){for(;c.length>6;)y+=c.shift(),g+=c.shift(),e.U.P.lineTo(l,y,g);A=y+c.shift(),E=g+c.shift(),x=A+c.shift(),w=E+c.shift(),y=x+c.shift(),g=w+c.shift(),e.U.P.curveTo(l,A,E,x,w,y,g)}else if(k=="o26")for(c.length%2&&(y+=c.shift());c.length>0;)A=y,E=g+c.shift(),y=x=A+c.shift(),g=(w=E+c.shift())+c.shift(),e.U.P.curveTo(l,A,E,x,w,y,g);else if(k=="o27")for(c.length%2&&(g+=c.shift());c.length>0;)E=g,x=(A=y+c.shift())+c.shift(),w=E+c.shift(),y=x+c.shift(),g=w,e.U.P.curveTo(l,A,E,x,w,y,g);else if(k=="o10"||k=="o29"){var q=k=="o10"?a:o;if(c.length==0)console.debug("error: empty stack");else{var J=c.pop(),re=q.Subrs[J+q.Bias];s.x=y,s.y=g,s.nStems=u,s.haveWidth=h,s.width=f,s.open=d,e.U._drawCFF(re,s,o,a,l),y=s.x,g=s.y,u=s.nStems,h=s.haveWidth,f=s.width,d=s.open}}else if(k=="o30"||k=="o31"){var ie=c.length,se=(oe=0,k=="o31");for(oe+=ie-(H=-3&ie);oe<H;)se?(E=g,x=(A=y+c.shift())+c.shift(),g=(w=E+c.shift())+c.shift(),H-oe==5?(y=x+c.shift(),oe++):y=x,se=!1):(A=y,E=g+c.shift(),x=A+c.shift(),w=E+c.shift(),y=x+c.shift(),H-oe==5?(g=w+c.shift(),oe++):g=w,se=!0),e.U.P.curveTo(l,A,E,x,w,y,g),oe+=4}else{if((k+"").charAt(0)=="o")throw console.debug("Unknown operation: "+k,r),k;c.push(k)}}}s.x=y,s.y=g,s.nStems=u,s.haveWidth=h,s.width=f,s.open=d};var t=e,n={Typr:t};return i.Typr=t,i.default=n,Object.defineProperty(i,"__esModule",{value:!0}),i})({}).Typr}/*!
Custom bundle of woff2otf (https://github.com/arty-name/woff2otf) with fflate
(https://github.com/101arrowz/fflate) for use in Troika text rendering. 
Original licenses apply: 
- fflate: https://github.com/101arrowz/fflate/blob/master/LICENSE (MIT)
- woff2otf.js: https://github.com/arty-name/woff2otf/blob/master/woff2otf.js (Apache2)
*/function Xhe(){return(function(i){var e=Uint8Array,t=Uint16Array,n=Uint32Array,r=new e([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),s=new e([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),o=new e([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),a=function(k,H){for(var G=new t(31),X=0;X<31;++X)G[X]=H+=1<<k[X-1];var Z=new n(G[30]);for(X=1;X<30;++X)for(var oe=G[X];oe<G[X+1];++oe)Z[oe]=oe-G[X]<<5|X;return[G,Z]},l=a(r,2),c=l[0],u=l[1];c[28]=258,u[258]=28;for(var h=a(s,0)[0],f=new t(32768),d=0;d<32768;++d){var m=(43690&d)>>>1|(21845&d)<<1;m=(61680&(m=(52428&m)>>>2|(13107&m)<<2))>>>4|(3855&m)<<4,f[d]=((65280&m)>>>8|(255&m)<<8)>>>1}var y=function(k,H,G){for(var X=k.length,Z=0,oe=new t(H);Z<X;++Z)++oe[k[Z]-1];var K,V=new t(H);for(Z=0;Z<H;++Z)V[Z]=V[Z-1]+oe[Z-1]<<1;{K=new t(1<<H);var W=15-H;for(Z=0;Z<X;++Z)if(k[Z])for(var F=Z<<4|k[Z],Y=H-k[Z],te=V[k[Z]-1]++<<Y,q=te|(1<<Y)-1;te<=q;++te)K[f[te]>>>W]=F}return K},g=new e(288);for(d=0;d<144;++d)g[d]=8;for(d=144;d<256;++d)g[d]=9;for(d=256;d<280;++d)g[d]=7;for(d=280;d<288;++d)g[d]=8;var A=new e(32);for(d=0;d<32;++d)A[d]=5;var E=y(g,9),x=y(A,5),w=function(k){for(var H=k[0],G=1;G<k.length;++G)k[G]>H&&(H=k[G]);return H},T=function(k,H,G){var X=H/8|0;return(k[X]|k[X+1]<<8)>>(7&H)&G},I=function(k,H){var G=H/8|0;return(k[G]|k[G+1]<<8|k[G+2]<<16)>>(7&H)},M=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],L=function(k,H,G){var X=new Error(H||M[k]);if(X.code=k,Error.captureStackTrace&&Error.captureStackTrace(X,L),!G)throw X;return X},P=function(k,H,G){var X=k.length;if(!X||G&&!G.l&&X<5)return H||new e(0);var Z=!H||G,oe=!G||G.i;G||(G={}),H||(H=new e(3*X));var K,V=function(ft){var Ce=H.length;if(ft>Ce){var qe=new e(Math.max(2*Ce,ft));qe.set(H),H=qe}},W=G.f||0,F=G.p||0,Y=G.b||0,te=G.l,q=G.d,J=G.m,re=G.n,ie=8*X;do{if(!te){G.f=W=T(k,F,1);var se=T(k,F+1,3);if(F+=3,!se){var ge=k[(j=((K=F)/8|0)+(7&K&&1)+4)-4]|k[j-3]<<8,xe=j+ge;if(xe>X){oe&&L(0);break}Z&&V(Y+ge),H.set(k.subarray(j,xe),Y),G.b=Y+=ge,G.p=F=8*xe;continue}if(se==1)te=E,q=x,J=9,re=5;else if(se==2){var pe=T(k,F,31)+257,ue=T(k,F+10,15)+4,Me=pe+T(k,F+5,31)+1;F+=14;for(var Se=new e(Me),ve=new e(19),Ae=0;Ae<ue;++Ae)ve[o[Ae]]=T(k,F+3*Ae,7);F+=3*ue;var ke=w(ve),be=(1<<ke)-1,ne=y(ve,ke);for(Ae=0;Ae<Me;){var j,de=ne[T(k,F,be)];if(F+=15&de,(j=de>>>4)<16)Se[Ae++]=j;else{var Re=0,Le=0;for(j==16?(Le=3+T(k,F,3),F+=2,Re=Se[Ae-1]):j==17?(Le=3+T(k,F,7),F+=3):j==18&&(Le=11+T(k,F,127),F+=7);Le--;)Se[Ae++]=Re}}var Fe=Se.subarray(0,pe),He=Se.subarray(pe);J=w(Fe),re=w(He),te=y(Fe,J),q=y(He,re)}else L(1);if(F>ie){oe&&L(0);break}}Z&&V(Y+131072);for(var it=(1<<J)-1,Ye=(1<<re)-1,ct=F;;ct=F){var pt=(Re=te[I(k,F)&it])>>>4;if((F+=15&Re)>ie){oe&&L(0);break}if(Re||L(2),pt<256)H[Y++]=pt;else{if(pt==256){ct=F,te=null;break}var je=pt-254;if(pt>264){var Mt=r[Ae=pt-257];je=T(k,F,(1<<Mt)-1)+c[Ae],F+=Mt}var Ft=q[I(k,F)&Ye],St=Ft>>>4;if(Ft||L(3),F+=15&Ft,He=h[St],St>3&&(Mt=s[St],He+=I(k,F)&(1<<Mt)-1,F+=Mt),F>ie){oe&&L(0);break}Z&&V(Y+131072);for(var gt=Y+je;Y<gt;Y+=4)H[Y]=H[Y-He],H[Y+1]=H[Y+1-He],H[Y+2]=H[Y+2-He],H[Y+3]=H[Y+3-He];Y=gt}}G.l=te,G.p=ct,G.b=Y,te&&(W=1,G.m=J,G.d=q,G.n=re)}while(!W);return Y==H.length?H:(function(ft,Ce,qe){(qe==null||qe>ft.length)&&(qe=ft.length);var At=new(ft instanceof t?t:ft instanceof n?n:e)(qe-Ce);return At.set(ft.subarray(Ce,qe)),At})(H,0,Y)},R=new e(0),U=typeof TextDecoder<"u"&&new TextDecoder;try{U.decode(R,{stream:!0})}catch{}return i.convert_streams=function(k){var H=new DataView(k),G=0;function X(){var pe=H.getUint16(G);return G+=2,pe}function Z(){var pe=H.getUint32(G);return G+=4,pe}function oe(pe){ge.setUint16(xe,pe),xe+=2}function K(pe){ge.setUint32(xe,pe),xe+=4}for(var V={signature:Z(),flavor:Z(),length:Z(),numTables:X(),reserved:X(),totalSfntSize:Z(),majorVersion:X(),minorVersion:X(),metaOffset:Z(),metaLength:Z(),metaOrigLength:Z(),privOffset:Z(),privLength:Z()},W=0;Math.pow(2,W)<=V.numTables;)W++;W--;for(var F=16*Math.pow(2,W),Y=16*V.numTables-F,te=12,q=[],J=0;J<V.numTables;J++)q.push({tag:Z(),offset:Z(),compLength:Z(),origLength:Z(),origChecksum:Z()}),te+=16;var re,ie=new Uint8Array(12+16*q.length+q.reduce((function(pe,ue){return pe+ue.origLength+4}),0)),se=ie.buffer,ge=new DataView(se),xe=0;return K(V.flavor),oe(V.numTables),oe(F),oe(W),oe(Y),q.forEach((function(pe){K(pe.tag),K(pe.origChecksum),K(te),K(pe.origLength),pe.outOffset=te,(te+=pe.origLength)%4!=0&&(te+=4-te%4)})),q.forEach((function(pe){var ue,Me=k.slice(pe.offset,pe.offset+pe.compLength);if(pe.compLength!=pe.origLength){var Se=new Uint8Array(pe.origLength);ue=new Uint8Array(Me,2),P(ue,Se)}else Se=new Uint8Array(Me);ie.set(Se,pe.outOffset);var ve=0;(te=pe.outOffset+pe.origLength)%4!=0&&(ve=4-te%4),ie.set(new Uint8Array(ve).buffer,pe.outOffset+pe.origLength),re=te+ve})),se.slice(0,re)},Object.defineProperty(i,"__esModule",{value:!0}),i})({}).convert_streams}function qhe(i,e){const t={M:2,L:2,Q:4,C:6,Z:0},n={C:"18g,ca,368,1kz",D:"17k,6,2,2+4,5+c,2+6,2+1,10+1,9+f,j+11,2+1,a,2,2+1,15+2,3,j+2,6+3,2+8,2,2,2+1,w+a,4+e,3+3,2,3+2,3+5,23+w,2f+4,3,2+9,2,b,2+3,3,1k+9,6+1,3+1,2+2,2+d,30g,p+y,1,1+1g,f+x,2,sd2+1d,jf3+4,f+3,2+4,2+2,b+3,42,2,4+2,2+1,2,3,t+1,9f+w,2,el+2,2+g,d+2,2l,2+1,5,3+1,2+1,2,3,6,16wm+1v",R:"17m+3,2,2,6+3,m,15+2,2+2,h+h,13,3+8,2,2,3+1,2,p+1,x,5+4,5,a,2,2,3,u,c+2,g+1,5,2+1,4+1,5j,6+1,2,b,2+2,f,2+1,1s+2,2,3+1,7,1ez0,2,2+1,4+4,b,4,3,b,42,2+2,4,3,2+1,2,o+3,ae,ep,x,2o+2,3+1,3,5+1,6",L:"x9u,jff,a,fd,jv",T:"4t,gj+33,7o+4,1+1,7c+18,2,2+1,2+1,2,21+a,2,1b+k,h,2u+6,3+5,3+1,2+3,y,2,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,3,7,6+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+d,1,1+1,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,ek,3+1,r+4,1e+4,6+5,2p+c,1+3,1,1+2,1+b,2db+2,3y,2p+v,ff+3,30+1,n9x,1+2,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,5s,6y+2,ea,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+9,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2,2b+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,470+8,at4+4,1o+6,t5,1s+3,2a,f5l+1,2+3,43o+2,a+7,1+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,1,gzau,v+2n,3l+6n"},r=1,s=2,o=4,a=8,l=16,c=32;let u;function h(M){if(!u){const L={R:s,L:r,D:o,C:l,U:c,T:a};u=new Map;for(let P in n){let R=0;n[P].split(",").forEach(U=>{let[k,H]=U.split("+");k=parseInt(k,36),H=H?parseInt(H,36):0,u.set(R+=k,L[P]);for(let G=H;G--;)u.set(++R,L[P])})}}return u.get(M)||c}const f=1,d=2,m=3,y=4,g=[null,"isol","init","fina","medi"];function A(M){const L=new Uint8Array(M.length);let P=c,R=f,U=-1;for(let k=0;k<M.length;k++){const H=M.codePointAt(k);let G=h(H)|0,X=f;G&a||(P&(r|o|l)?G&(s|o|l)?(X=m,(R===f||R===m)&&L[U]++):G&(r|c)&&(R===d||R===y)&&L[U]--:P&(s|c)&&(R===d||R===y)&&L[U]--,R=L[k]=X,P=G,U=k,H>65535&&k++)}return L}function E(M,L){const P=[];for(let U=0;U<L.length;U++){const k=L.codePointAt(U);k>65535&&U++,P.push(i.U.codeToGlyph(M,k))}const R=M.GSUB;if(R){const{lookupList:U,featureList:k}=R;let H;const G=/^(rlig|liga|mset|isol|init|fina|medi|half|pres|blws|ccmp)$/,X=[];k.forEach(Z=>{if(G.test(Z.tag))for(let oe=0;oe<Z.tab.length;oe++){if(X[Z.tab[oe]])continue;X[Z.tab[oe]]=!0;const K=U[Z.tab[oe]],V=/^(isol|init|fina|medi)$/.test(Z.tag);V&&!H&&(H=A(L));for(let W=0;W<P.length;W++)(!H||!V||g[H[W]]===Z.tag)&&i.U._applySubs(P,W,K,U)}})}return P}function x(M,L){const P=new Int16Array(L.length*3);let R=0;for(;R<L.length;R++){const G=L[R];if(G===-1)continue;P[R*3+2]=M.hmtx.aWidth[G];const X=M.GPOS;if(X){const Z=X.lookupList;for(let oe=0;oe<Z.length;oe++){const K=Z[oe];for(let V=0;V<K.tabs.length;V++){const W=K.tabs[V];if(K.ltype===1){if(i._lctf.coverageIndex(W.coverage,G)!==-1&&W.pos){H(W.pos,R);break}}else if(K.ltype===2){let F=null,Y=U();if(Y!==-1){const te=i._lctf.coverageIndex(W.coverage,L[Y]);if(te!==-1){if(W.fmt===1){const q=W.pairsets[te];for(let J=0;J<q.length;J++)q[J].gid2===G&&(F=q[J])}else if(W.fmt===2){const q=i.U._getGlyphClass(L[Y],W.classDef1),J=i.U._getGlyphClass(G,W.classDef2);F=W.matrix[q][J]}if(F){F.val1&&H(F.val1,Y),F.val2&&H(F.val2,R);break}}}}else if(K.ltype===4){const F=i._lctf.coverageIndex(W.markCoverage,G);if(F!==-1){const Y=U(k),te=Y===-1?-1:i._lctf.coverageIndex(W.baseCoverage,L[Y]);if(te!==-1){const q=W.markArray[F],J=W.baseArray[te][q.markClass];P[R*3]=J.x-q.x+P[Y*3]-P[Y*3+2],P[R*3+1]=J.y-q.y+P[Y*3+1];break}}}else if(K.ltype===6){const F=i._lctf.coverageIndex(W.mark1Coverage,G);if(F!==-1){const Y=U();if(Y!==-1){const te=L[Y];if(w(M,te)===3){const q=i._lctf.coverageIndex(W.mark2Coverage,te);if(q!==-1){const J=W.mark1Array[F],re=W.mark2Array[q][J.markClass];P[R*3]=re.x-J.x+P[Y*3]-P[Y*3+2],P[R*3+1]=re.y-J.y+P[Y*3+1];break}}}}}}}}else if(M.kern&&!M.cff){const Z=U();if(Z!==-1){const oe=M.kern.glyph1.indexOf(L[Z]);if(oe!==-1){const K=M.kern.rval[oe].glyph2.indexOf(G);K!==-1&&(P[Z*3+2]+=M.kern.rval[oe].vals[K])}}}}return P;function U(G){for(let X=R-1;X>=0;X--)if(L[X]!==-1&&(!G||G(L[X])))return X;return-1}function k(G){return w(M,G)===1}function H(G,X){for(let Z=0;Z<3;Z++)P[X*3+Z]+=G[Z]||0}}function w(M,L){const P=M.GDEF&&M.GDEF.glyphClassDef;return P?i.U._getGlyphClass(L,P):0}function T(...M){for(let L=0;L<M.length;L++)if(typeof M[L]=="number")return M[L]}function I(M){const L=Object.create(null),P=M["OS/2"],R=M.hhea,U=M.head.unitsPerEm,k=T(P&&P.sTypoAscender,R&&R.ascender,U),H={unitsPerEm:U,ascender:k,descender:T(P&&P.sTypoDescender,R&&R.descender,0),capHeight:T(P&&P.sCapHeight,k),xHeight:T(P&&P.sxHeight,k),lineGap:T(P&&P.sTypoLineGap,R&&R.lineGap),supportsCodePoint(G){return i.U.codeToGlyph(M,G)>0},forEachGlyph(G,X,Z,oe){let K=0;const V=1/H.unitsPerEm*X,W=E(M,G);let F=0;const Y=x(M,W);return W.forEach((te,q)=>{if(te!==-1){let J=L[te];if(!J){const{cmds:re,crds:ie}=i.U.glyphToPath(M,te);let se="",ge=0;for(let Se=0,ve=re.length;Se<ve;Se++){const Ae=t[re[Se]];se+=re[Se];for(let ke=1;ke<=Ae;ke++)se+=(ke>1?",":"")+ie[ge++]}let xe,pe,ue,Me;if(ie.length){xe=pe=1/0,ue=Me=-1/0;for(let Se=0,ve=ie.length;Se<ve;Se+=2){let Ae=ie[Se],ke=ie[Se+1];Ae<xe&&(xe=Ae),ke<pe&&(pe=ke),Ae>ue&&(ue=Ae),ke>Me&&(Me=ke)}}else xe=ue=pe=Me=0;J=L[te]={index:te,advanceWidth:M.hmtx.aWidth[te],xMin:xe,yMin:pe,xMax:ue,yMax:Me,path:se}}oe.call(null,J,K+Y[q*3]*V,Y[q*3+1]*V,F),K+=Y[q*3+2]*V,Z&&(K+=Z*X)}F+=G.codePointAt(F)>65535?2:1}),K}};return H}return function(L){const P=new Uint8Array(L,0,4),R=i._bin.readASCII(P,0,4);if(R==="wOFF")L=e(L);else if(R==="wOF2")throw new Error("woff2 fonts not supported");return I(i.parse(L)[0])}}const Jhe=PA({name:"Typr Font Parser",dependencies:[$he,Xhe,qhe],init(i,e,t){const n=i(),r=e();return t(n,r)}});/*!
Custom bundle of @unicode-font-resolver/client v1.0.2 (https://github.com/lojjic/unicode-font-resolver)
for use in Troika text rendering. 
Original MIT license applies
*/function Zhe(){return(function(i){var e=function(){this.buckets=new Map};e.prototype.add=function(x){var w=x>>5;this.buckets.set(w,(this.buckets.get(w)||0)|1<<(31&x))},e.prototype.has=function(x){var w=this.buckets.get(x>>5);return w!==void 0&&(w&1<<(31&x))!=0},e.prototype.serialize=function(){var x=[];return this.buckets.forEach((function(w,T){x.push((+T).toString(36)+":"+w.toString(36))})),x.join(",")},e.prototype.deserialize=function(x){var w=this;this.buckets.clear(),x.split(",").forEach((function(T){var I=T.split(":");w.buckets.set(parseInt(I[0],36),parseInt(I[1],36))}))};var t=Math.pow(2,8),n=t-1,r=~n;function s(x){var w=(function(I){return I&r})(x).toString(16),T=(function(I){return(I&r)+t-1})(x).toString(16);return"codepoint-index/plane"+(x>>16)+"/"+w+"-"+T+".json"}function o(x,w){var T=x&n,I=w.codePointAt(T/6|0);return((I=(I||48)-48)&1<<T%6)!=0}function a(x,w){var T;(T=x,T.replace(/U\+/gi,"").replace(/^,+|,+$/g,"").split(/,+/).map((function(I){return I.split("-").map((function(M){return parseInt(M.trim(),16)}))}))).forEach((function(I){var M=I[0],L=I[1];L===void 0&&(L=M),w(M,L)}))}function l(x,w){a(x,(function(T,I){for(var M=T;M<=I;M++)w(M)}))}var c={},u={},h=new WeakMap,f="https://cdn.jsdelivr.net/gh/lojjic/unicode-font-resolver@v1.0.1/packages/data";function d(x){var w=h.get(x);return w||(w=new e,l(x.ranges,(function(T){return w.add(T)})),h.set(x,w)),w}var m,y=new Map;function g(x,w,T){return x[w]?w:x[T]?T:(function(I){for(var M in I)return M})(x)}function A(x,w){var T=w;if(!x.includes(T)){T=1/0;for(var I=0;I<x.length;I++)Math.abs(x[I]-w)<Math.abs(T-w)&&(T=x[I])}return T}function E(x){return m||(m=new Set,l("9-D,20,85,A0,1680,2000-200A,2028-202F,205F,3000",(function(w){m.add(w)}))),m.has(x)}return i.CodePointSet=e,i.clearCache=function(){c={},u={}},i.getFontsForString=function(x,w){w===void 0&&(w={});var T,I=w.lang;I===void 0&&(I=new RegExp("\\p{Script=Hangul}","u").test(T=x)?"ko":new RegExp("\\p{Script=Hiragana}|\\p{Script=Katakana}","u").test(T)?"ja":"en");var M=w.category;M===void 0&&(M="sans-serif");var L=w.style;L===void 0&&(L="normal");var P=w.weight;P===void 0&&(P=400);var R=(w.dataUrl||f).replace(/\/$/g,""),U=new Map,k=new Uint8Array(x.length),H={},G={},X=new Array(x.length),Z=new Map,oe=!1;function K(F){var Y=y.get(F);return Y||(Y=fetch(R+"/"+F).then((function(te){if(!te.ok)throw new Error(te.statusText);return te.json().then((function(q){if(!Array.isArray(q)||q[0]!==1)throw new Error("Incorrect schema version; need 1, got "+q[0]);return q[1]}))})).catch((function(te){if(R!==f)return oe||(console.error('unicode-font-resolver: Failed loading from dataUrl "'+R+'", trying default CDN. '+te.message),oe=!0),R=f,y.delete(F),K(F);throw te})),y.set(F,Y)),Y}for(var V=function(F){var Y=x.codePointAt(F),te=s(Y);X[F]=te,c[te]||Z.has(te)||Z.set(te,K(te).then((function(q){c[te]=q}))),Y>65535&&(F++,W=F)},W=0;W<x.length;W++)V(W);return Promise.all(Z.values()).then((function(){Z.clear();for(var F=function(te){var q=x.codePointAt(te),J=null,re=c[X[te]],ie=void 0;for(var se in re){var ge=G[se];if(ge===void 0&&(ge=G[se]=new RegExp(se).test(I||"en")),ge){for(var xe in ie=se,re[se])if(o(q,re[se][xe])){J=xe;break}break}}if(!J){e:for(var pe in re)if(pe!==ie){for(var ue in re[pe])if(o(q,re[pe][ue])){J=ue;break e}}}J||(console.debug("No font coverage for U+"+q.toString(16)),J="latin"),X[te]=J,u[J]||Z.has(J)||Z.set(J,K("font-meta/"+J+".json").then((function(Me){u[J]=Me}))),q>65535&&(te++,Y=te)},Y=0;Y<x.length;Y++)F(Y);return Promise.all(Z.values())})).then((function(){for(var F,Y=null,te=0;te<x.length;te++){var q=x.codePointAt(te);if(Y&&(E(q)||d(Y).has(q)))k[te]=k[te-1];else{Y=u[X[te]];var J=H[Y.id];if(!J){var re=Y.typeforms,ie=g(re,M,"sans-serif"),se=g(re[ie],L,"normal"),ge=A((F=re[ie])===null||F===void 0?void 0:F[se],P);J=H[Y.id]=R+"/font-files/"+Y.id+"/"+ie+"."+se+"."+ge+".woff"}var xe=U.get(J);xe==null&&(xe=U.size,U.set(J,xe)),k[te]=xe}q>65535&&(te++,k[te]=k[te-1])}return{fontUrls:Array.from(U.keys()),chars:k}}))},Object.defineProperty(i,"__esModule",{value:!0}),i})({})}function efe(i,e){const t=Object.create(null),n=Object.create(null);function r(o,a){const l=c=>{console.error(`Failure loading font ${o}`,c)};try{const c=new XMLHttpRequest;c.open("get",o,!0),c.responseType="arraybuffer",c.onload=function(){if(c.status>=400)l(new Error(c.statusText));else if(c.status>0)try{const u=i(c.response);u.src=o,a(u)}catch(u){l(u)}},c.onerror=l,c.send()}catch(c){l(c)}}function s(o,a){let l=t[o];l?a(l):n[o]?n[o].push(a):(n[o]=[a],r(o,c=>{c.src=o,t[o]=c,n[o].forEach(u=>u(c)),delete n[o]}))}return function(o,a,{lang:l,fonts:c=[],style:u="normal",weight:h="normal",unicodeFontsURL:f}={}){const d=new Uint8Array(o.length),m=[];o.length||E();const y=new Map,g=[];if(u!=="italic"&&(u="normal"),typeof h!="number"&&(h=h==="bold"?700:400),c&&!Array.isArray(c)&&(c=[c]),c=c.slice().filter(w=>!w.lang||w.lang.test(l)).reverse(),c.length){let M=0;(function L(P=0){for(let R=P,U=o.length;R<U;R++){const k=o.codePointAt(R);if(M===1&&m[d[R-1]].supportsCodePoint(k)||R>0&&/\s/.test(o[R]))d[R]=d[R-1],M===2&&(g[g.length-1][1]=R);else for(let H=d[R],G=c.length;H<=G;H++)if(H===G){const X=M===2?g[g.length-1]:g[g.length]=[R,R];X[1]=R,M=2}else{d[R]=H;const{src:X,unicodeRange:Z}=c[H];if(!Z||x(k,Z)){const oe=t[X];if(!oe){s(X,()=>{L(R)});return}if(oe.supportsCodePoint(k)){let K=y.get(oe);typeof K!="number"&&(K=m.length,m.push(oe),y.set(oe,K)),d[R]=K,M=1;break}}}k>65535&&R+1<U&&(d[R+1]=d[R],R++,M===2&&(g[g.length-1][1]=R))}A()})()}else g.push([0,o.length-1]),A();function A(){if(g.length){const w=g.map(T=>o.substring(T[0],T[1]+1)).join(`
`);e.getFontsForString(w,{lang:l||void 0,style:u,weight:h,dataUrl:f}).then(({fontUrls:T,chars:I})=>{const M=m.length;let L=0;g.forEach(R=>{for(let U=0,k=R[1]-R[0];U<=k;U++)d[R[0]+U]=I[L++]+M;L++});let P=0;T.forEach((R,U)=>{s(R,k=>{m[U+M]=k,++P===T.length&&E()})})})}else E()}function E(){a({chars:d,fonts:m})}function x(w,T){for(let I=0;I<T.length;I++){const[M,L=M]=T[I];if(M<=w&&w<=L)return!0}return!1}}}const tfe=PA({name:"FontResolver",dependencies:[efe,Jhe,Zhe],init(i,e,t){return i(e,t())}});function nfe(i,e){const n=/[\u00AD\u034F\u061C\u115F-\u1160\u17B4-\u17B5\u180B-\u180E\u200B-\u200F\u202A-\u202E\u2060-\u206F\u3164\uFE00-\uFE0F\uFEFF\uFFA0\uFFF0-\uFFF8]/,r="[^\\S\\u00A0]",s=new RegExp(`${r}|[\\-\\u007C\\u00AD\\u2010\\u2012-\\u2014\\u2027\\u2056\\u2E17\\u2E40]`);function o({text:m,lang:y,fonts:g,style:A,weight:E,preResolvedFonts:x,unicodeFontsURL:w},T){const I=({chars:M,fonts:L})=>{let P,R;const U=[];for(let k=0;k<M.length;k++)M[k]!==R?(R=M[k],U.push(P={start:k,end:k,fontObj:L[M[k]]})):P.end=k;T(U)};x?I(x):i(m,I,{lang:y,fonts:g,style:A,weight:E,unicodeFontsURL:w})}function a({text:m="",font:y,lang:g,sdfGlyphSize:A=64,fontSize:E=400,fontWeight:x=1,fontStyle:w="normal",letterSpacing:T=0,lineHeight:I="normal",maxWidth:M=1/0,direction:L,textAlign:P="left",textIndent:R=0,whiteSpace:U="normal",overflowWrap:k="normal",anchorX:H=0,anchorY:G=0,metricsOnly:X=!1,unicodeFontsURL:Z,preResolvedFonts:oe=null,includeCaretPositions:K=!1,chunkedBoundsSize:V=8192,colorRanges:W=null},F){const Y=h(),te={fontLoad:0,typesetting:0};m.indexOf("\r")>-1&&(console.info("Typesetter: got text with \\r chars; normalizing to \\n"),m=m.replace(/\r\n/g,`
`).replace(/\r/g,`
`)),E=+E,T=+T,M=+M,I=I||"normal",R=+R,o({text:m,lang:g,style:w,weight:x,fonts:typeof y=="string"?[{src:y}]:y,unicodeFontsURL:Z,preResolvedFonts:oe},q=>{te.fontLoad=h()-Y;const J=isFinite(M);let re=null,ie=null,se=null,ge=null,xe=null,pe=null,ue=null,Me=null,Se=0,ve=0,Ae=U!=="nowrap";const ke=new Map,be=h();let ne=R,j=0,de=new f;const Re=[de];q.forEach(Ye=>{const{fontObj:ct}=Ye,{ascender:pt,descender:je,unitsPerEm:Mt,lineGap:Ft,capHeight:St,xHeight:gt}=ct;let ft=ke.get(ct);if(!ft){const Be=E/Mt,we=I==="normal"?(pt-je+Ft)*Be:I*E,_t=(we-(pt-je)*Be)/2,vt=Math.min(we,(pt-je)*Be),bt=(pt+je)/2*Be+vt/2;ft={index:ke.size,src:ct.src,fontObj:ct,fontSizeMult:Be,unitsPerEm:Mt,ascender:pt*Be,descender:je*Be,capHeight:St*Be,xHeight:gt*Be,lineHeight:we,baseline:-_t-pt*Be,caretTop:bt,caretBottom:bt-vt},ke.set(ct,ft)}const{fontSizeMult:Ce}=ft,qe=m.slice(Ye.start,Ye.end+1);let At,yt;ct.forEachGlyph(qe,E,T,(Be,we,_t,vt)=>{we+=j,vt+=Ye.start,At=we,yt=Be;const bt=m.charAt(vt),Lt=Be.advanceWidth*Ce,qt=de.count;let Nt;if("isEmpty"in Be||(Be.isWhitespace=!!bt&&new RegExp(r).test(bt),Be.canBreakAfter=!!bt&&s.test(bt),Be.isEmpty=Be.xMin===Be.xMax||Be.yMin===Be.yMax||n.test(bt)),!Be.isWhitespace&&!Be.isEmpty&&ve++,Ae&&J&&!Be.isWhitespace&&we+Lt+ne>M&&qt){if(de.glyphAt(qt-1).glyphObj.canBreakAfter)Nt=new f,ne=-we;else for(let Vn=qt;Vn--;)if(Vn===0&&k==="break-word"){Nt=new f,ne=-we;break}else if(de.glyphAt(Vn).glyphObj.canBreakAfter){Nt=de.splitAt(Vn+1);const pn=Nt.glyphAt(0).x;ne-=pn;for(let qn=Nt.count;qn--;)Nt.glyphAt(qn).x-=pn;break}Nt&&(de.isSoftWrapped=!0,de=Nt,Re.push(de),Se=M)}let dn=de.glyphAt(de.count);dn.glyphObj=Be,dn.x=we+ne,dn.y=_t,dn.width=Lt,dn.charIndex=vt,dn.fontData=ft,bt===`
`&&(de=new f,Re.push(de),ne=-(we+Lt+T*E)+R)}),j=At+yt.advanceWidth*Ce+T*E});let Le=0;Re.forEach(Ye=>{let ct=!0;for(let pt=Ye.count;pt--;){const je=Ye.glyphAt(pt);ct&&!je.glyphObj.isWhitespace&&(Ye.width=je.x+je.width,Ye.width>Se&&(Se=Ye.width),ct=!1);let{lineHeight:Mt,capHeight:Ft,xHeight:St,baseline:gt}=je.fontData;Mt>Ye.lineHeight&&(Ye.lineHeight=Mt);const ft=gt-Ye.baseline;ft<0&&(Ye.baseline+=ft,Ye.cap+=ft,Ye.ex+=ft),Ye.cap=Math.max(Ye.cap,Ye.baseline+Ft),Ye.ex=Math.max(Ye.ex,Ye.baseline+St)}Ye.baseline-=Le,Ye.cap-=Le,Ye.ex-=Le,Le+=Ye.lineHeight});let Fe=0,He=0;if(H&&(typeof H=="number"?Fe=-H:typeof H=="string"&&(Fe=-Se*(H==="left"?0:H==="center"?.5:H==="right"?1:c(H)))),G&&(typeof G=="number"?He=-G:typeof G=="string"&&(He=G==="top"?0:G==="top-baseline"?-Re[0].baseline:G==="top-cap"?-Re[0].cap:G==="top-ex"?-Re[0].ex:G==="middle"?Le/2:G==="bottom"?Le:G==="bottom-baseline"?-Re[Re.length-1].baseline:c(G)*Le)),!X){const Ye=e.getEmbeddingLevels(m,L);re=new Uint16Array(ve),ie=new Uint8Array(ve),se=new Float32Array(ve*2),ge={},ue=[1/0,1/0,-1/0,-1/0],Me=[],K&&(pe=new Float32Array(m.length*4)),W&&(xe=new Uint8Array(ve*3));let ct=0,pt=-1,je=-1,Mt,Ft;if(Re.forEach((St,gt)=>{let{count:ft,width:Ce}=St;if(ft>0){let qe=0;for(let vt=ft;vt--&&St.glyphAt(vt).glyphObj.isWhitespace;)qe++;let At=0,yt=0;if(P==="center")At=(Se-Ce)/2;else if(P==="right")At=Se-Ce;else if(P==="justify"&&St.isSoftWrapped){let vt=0;for(let bt=ft-qe;bt--;)St.glyphAt(bt).glyphObj.isWhitespace&&vt++;yt=(Se-Ce)/vt}if(yt||At){let vt=0;for(let bt=0;bt<ft;bt++){let Lt=St.glyphAt(bt);const qt=Lt.glyphObj;Lt.x+=At+vt,yt!==0&&qt.isWhitespace&&bt<ft-qe&&(vt+=yt,Lt.width+=yt)}}const Be=e.getReorderSegments(m,Ye,St.glyphAt(0).charIndex,St.glyphAt(St.count-1).charIndex);for(let vt=0;vt<Be.length;vt++){const[bt,Lt]=Be[vt];let qt=1/0,Nt=-1/0;for(let dn=0;dn<ft;dn++)if(St.glyphAt(dn).charIndex>=bt){let Vn=dn,pn=dn;for(;pn<ft;pn++){let qn=St.glyphAt(pn);if(qn.charIndex>Lt)break;pn<ft-qe&&(qt=Math.min(qt,qn.x),Nt=Math.max(Nt,qn.x+qn.width))}for(let qn=Vn;qn<pn;qn++){const Ci=St.glyphAt(qn);Ci.x=Nt-(Ci.x+Ci.width-qt)}break}}let we;const _t=vt=>we=vt;for(let vt=0;vt<ft;vt++){const bt=St.glyphAt(vt);we=bt.glyphObj;const Lt=we.index,qt=Ye.levels[bt.charIndex]&1;if(qt){const Nt=e.getMirroredCharacter(m[bt.charIndex]);Nt&&bt.fontData.fontObj.forEachGlyph(Nt,0,0,_t)}if(K){const{charIndex:Nt,fontData:dn}=bt,Vn=bt.x+Fe,pn=bt.x+bt.width+Fe;pe[Nt*4]=qt?pn:Vn,pe[Nt*4+1]=qt?Vn:pn,pe[Nt*4+2]=St.baseline+dn.caretBottom+He,pe[Nt*4+3]=St.baseline+dn.caretTop+He;const qn=Nt-pt;qn>1&&u(pe,pt,qn),pt=Nt}if(W){const{charIndex:Nt}=bt;for(;Nt>je;)je++,W.hasOwnProperty(je)&&(Ft=W[je])}if(!we.isWhitespace&&!we.isEmpty){const Nt=ct++,{fontSizeMult:dn,src:Vn,index:pn}=bt.fontData,qn=ge[Vn]||(ge[Vn]={});qn[Lt]||(qn[Lt]={path:we.path,pathBounds:[we.xMin,we.yMin,we.xMax,we.yMax]});const Ci=bt.x+Fe,as=bt.y+St.baseline+He;se[Nt*2]=Ci,se[Nt*2+1]=as;const Nr=Ci+we.xMin*dn,ur=as+we.yMin*dn,tr=Ci+we.xMax*dn,An=as+we.yMax*dn;Nr<ue[0]&&(ue[0]=Nr),ur<ue[1]&&(ue[1]=ur),tr>ue[2]&&(ue[2]=tr),An>ue[3]&&(ue[3]=An),Nt%V===0&&(Mt={start:Nt,end:Nt,rect:[1/0,1/0,-1/0,-1/0]},Me.push(Mt)),Mt.end++;const vr=Mt.rect;if(Nr<vr[0]&&(vr[0]=Nr),ur<vr[1]&&(vr[1]=ur),tr>vr[2]&&(vr[2]=tr),An>vr[3]&&(vr[3]=An),re[Nt]=Lt,ie[Nt]=pn,W){const Uo=Nt*3;xe[Uo]=Ft>>16&255,xe[Uo+1]=Ft>>8&255,xe[Uo+2]=Ft&255}}}}}),pe){const St=m.length-pt;St>1&&u(pe,pt,St)}}const it=[];ke.forEach(({index:Ye,src:ct,unitsPerEm:pt,ascender:je,descender:Mt,lineHeight:Ft,capHeight:St,xHeight:gt})=>{it[Ye]={src:ct,unitsPerEm:pt,ascender:je,descender:Mt,lineHeight:Ft,capHeight:St,xHeight:gt}}),te.typesetting=h()-be,F({glyphIds:re,glyphFontIndices:ie,glyphPositions:se,glyphData:ge,fontData:it,caretPositions:pe,glyphColors:xe,chunkedBounds:Me,fontSize:E,topBaseline:He+Re[0].baseline,blockBounds:[Fe,He-Le,Fe+Se,He],visibleBounds:ue,timings:te})})}function l(m,y){a({...m,metricsOnly:!0},g=>{const[A,E,x,w]=g.blockBounds;y({width:x-A,height:w-E})})}function c(m){let y=m.match(/^([\d.]+)%$/),g=y?parseFloat(y[1]):NaN;return isNaN(g)?0:g/100}function u(m,y,g){const A=m[y*4],E=m[y*4+1],x=m[y*4+2],w=m[y*4+3],T=(E-A)/g;for(let I=0;I<g;I++){const M=(y+I)*4;m[M]=A+T*I,m[M+1]=A+T*(I+1),m[M+2]=x,m[M+3]=w}}function h(){return(self.performance||Date).now()}function f(){this.data=[]}const d=["glyphObj","x","y","width","charIndex","fontData"];return f.prototype={width:0,lineHeight:0,baseline:0,cap:0,ex:0,isSoftWrapped:!1,get count(){return Math.ceil(this.data.length/d.length)},glyphAt(m){let y=f.flyweight;return y.data=this.data,y.index=m,y},splitAt(m){let y=new f;return y.data=this.data.splice(m*d.length),y}},f.flyweight=d.reduce((m,y,g,A)=>(Object.defineProperty(m,y,{get(){return this.data[this.index*d.length+g]},set(E){this.data[this.index*d.length+g]=E}}),m),{data:null,index:0}),{typeset:a,measure:l}}const Vm=()=>(self.performance||Date).now(),d4=$H();let o7;function ife(i,e,t,n,r,s,o,a,l,c,u=!0){return u?sfe(i,e,t,n,r,s,o,a,l,c).then(null,h=>(o7||(console.warn("WebGL SDF generation failed, falling back to JS",h),o7=!0),l7(i,e,t,n,r,s,o,a,l,c))):l7(i,e,t,n,r,s,o,a,l,c)}const eS=[],rfe=5;let p5=0;function qH(){const i=Vm();for(;eS.length&&Vm()-i<rfe;)eS.shift()();p5=eS.length?setTimeout(qH,0):0}const sfe=(...i)=>new Promise((e,t)=>{eS.push(()=>{const n=Vm();try{d4.webgl.generateIntoCanvas(...i),e({timing:Vm()-n})}catch(r){t(r)}}),p5||(p5=setTimeout(qH,0))}),ofe=4,afe=2e3,a7={};let lfe=0;function l7(i,e,t,n,r,s,o,a,l,c){const u="TroikaTextSDFGenerator_JS_"+lfe++%ofe;let h=a7[u];return h||(h=a7[u]={workerModule:PA({name:u,workerId:u,dependencies:[$H,Vm],init(f,d){const m=f().javascript.generate;return function(...y){const g=d();return{textureData:m(...y),timing:d()-g}}},getTransferables(f){return[f.textureData.buffer]}}),requests:0,idleTimer:null}),h.requests++,clearTimeout(h.idleTimer),h.workerModule(i,e,t,n,r,s).then(({textureData:f,timing:d})=>{const m=Vm(),y=new Uint8Array(f.length*4);for(let g=0;g<f.length;g++)y[g*4+c]=f[g];return d4.webglUtils.renderImageData(o,y,a,l,i,e,1<<3-c),d+=Vm()-m,--h.requests===0&&(h.idleTimer=setTimeout(()=>{Uhe(u)},afe)),{timing:d}})}function cfe(i){i._warm||(d4.webgl.isSupported(i),i._warm=!0)}const ufe=d4.webglUtils.resizeWebGLCanvasWithoutClearing,zv={unicodeFontsURL:null,sdfGlyphSize:64,sdfMargin:1/16,sdfExponent:9,textureWidth:2048},hfe=new ut;function Hg(){return(self.performance||Date).now()}const c7=Object.create(null);function JH(i,e){i=pfe({},i);const t=Hg(),n=[];if(i.font&&n.push({label:"user",src:mfe(i.font)}),i.font=n,i.text=""+i.text,i.sdfGlyphSize=i.sdfGlyphSize||zv.sdfGlyphSize,i.unicodeFontsURL=i.unicodeFontsURL||zv.unicodeFontsURL,i.colorRanges!=null){let f={};for(let d in i.colorRanges)if(i.colorRanges.hasOwnProperty(d)){let m=i.colorRanges[d];typeof m!="number"&&(m=hfe.set(m).getHex()),f[d]=m}i.colorRanges=f}Object.freeze(i);const{textureWidth:r,sdfExponent:s}=zv,{sdfGlyphSize:o}=i,a=r/o*4;let l=c7[o];if(!l){const f=document.createElement("canvas");f.width=r,f.height=o*256/a,l=c7[o]={glyphCount:0,sdfGlyphSize:o,sdfCanvas:f,sdfTexture:new vi(f,void 0,void 0,void 0,Ln,Ln),contextLost:!1,glyphsByFont:new Map},l.sdfTexture.generateMipmaps=!1,ffe(l)}const{sdfTexture:c,sdfCanvas:u}=l;tQ(i).then(f=>{const{glyphIds:d,glyphFontIndices:m,fontData:y,glyphPositions:g,fontSize:A,timings:E}=f,x=[],w=new Float32Array(d.length*4);let T=0,I=0;const M=Hg(),L=y.map(H=>{let G=l.glyphsByFont.get(H.src);return G||l.glyphsByFont.set(H.src,G=new Map),G});d.forEach((H,G)=>{const X=m[G],{src:Z,unitsPerEm:oe}=y[X];let K=L[X].get(H);if(!K){const{path:te,pathBounds:q}=f.glyphData[Z][H],J=Math.max(q[2]-q[0],q[3]-q[1])/o*(zv.sdfMargin*o+.5),re=l.glyphCount++,ie=[q[0]-J,q[1]-J,q[2]+J,q[3]+J];L[X].set(H,K={path:te,atlasIndex:re,sdfViewBox:ie}),x.push(K)}const{sdfViewBox:V}=K,W=g[I++],F=g[I++],Y=A/oe;w[T++]=W+V[0]*Y,w[T++]=F+V[1]*Y,w[T++]=W+V[2]*Y,w[T++]=F+V[3]*Y,d[G]=K.atlasIndex}),E.quads=(E.quads||0)+(Hg()-M);const P=Hg();E.sdf={};const R=u.height,U=Math.ceil(l.glyphCount/a),k=Math.pow(2,Math.ceil(Math.log2(U*o)));k>R&&(console.info(`Increasing SDF texture size ${R}->${k}`),ufe(u,r,k),c.dispose()),Promise.all(x.map(H=>ZH(H,l,i.gpuAccelerateSDF).then(({timing:G})=>{E.sdf[H.atlasIndex]=G}))).then(()=>{x.length&&!l.contextLost&&(eQ(l),c.needsUpdate=!0),E.sdfTotal=Hg()-P,E.total=Hg()-t,e(Object.freeze({parameters:i,sdfTexture:c,sdfGlyphSize:o,sdfExponent:s,glyphBounds:w,glyphAtlasIndices:d,glyphColors:f.glyphColors,caretPositions:f.caretPositions,chunkedBounds:f.chunkedBounds,ascender:f.ascender,descender:f.descender,lineHeight:f.lineHeight,capHeight:f.capHeight,xHeight:f.xHeight,topBaseline:f.topBaseline,blockBounds:f.blockBounds,visibleBounds:f.visibleBounds,timings:f.timings}))})}),Promise.resolve().then(()=>{l.contextLost||cfe(u)})}function ZH({path:i,atlasIndex:e,sdfViewBox:t},{sdfGlyphSize:n,sdfCanvas:r,contextLost:s},o){if(s)return Promise.resolve({timing:-1});const{textureWidth:a,sdfExponent:l}=zv,c=Math.max(t[2]-t[0],t[3]-t[1]),u=Math.floor(e/4),h=u%(a/n)*n,f=Math.floor(u/(a/n))*n,d=e%4;return ife(n,n,i,t,c,l,r,h,f,d,o)}function ffe(i){const e=i.sdfCanvas;e.addEventListener("webglcontextlost",t=>{console.log("Context Lost",t),t.preventDefault(),i.contextLost=!0}),e.addEventListener("webglcontextrestored",t=>{console.log("Context Restored",t),i.contextLost=!1;const n=[];i.glyphsByFont.forEach(r=>{r.forEach(s=>{n.push(ZH(s,i,!0))})}),Promise.all(n).then(()=>{eQ(i),i.sdfTexture.needsUpdate=!0})})}function dfe({font:i,characters:e,sdfGlyphSize:t},n){let r=Array.isArray(e)?e.join(`
`):""+e;JH({font:i,sdfGlyphSize:t,text:r},n)}function pfe(i,e){for(let t in e)e.hasOwnProperty(t)&&(i[t]=e[t]);return i}let GE;function mfe(i){return GE||(GE=typeof document>"u"?{}:document.createElement("a")),GE.href=i,GE.href}function eQ(i){if(typeof createImageBitmap!="function"){console.info("Safari<15: applying SDF canvas workaround");const{sdfCanvas:e,sdfTexture:t}=i,{width:n,height:r}=e,s=i.sdfCanvas.getContext("webgl");let o=t.image.data;(!o||o.length!==n*r*4)&&(o=new Uint8Array(n*r*4),t.image={width:n,height:r,data:o},t.flipY=!1,t.isDataTexture=!0),s.readPixels(0,0,n,r,s.RGBA,s.UNSIGNED_BYTE,o)}}const gfe=PA({name:"Typesetter",dependencies:[nfe,tfe,Ghe],init(i,e,t){return i(e,t())}}),tQ=PA({name:"Typesetter",dependencies:[gfe],init(i){return function(e){return new Promise(t=>{i.typeset(e,t)})}},getTransferables(i){const e=[];for(let t in i)i[t]&&i[t].buffer&&e.push(i[t].buffer);return e}});tQ.onMainThread;const u7={};function Afe(i){let e=u7[i];return e||(e=u7[i]=new Fs(1,1,i,i).translate(.5,.5,0)),e}const yfe="aTroikaGlyphBounds",h7="aTroikaGlyphIndex",vfe="aTroikaGlyphColor";class xfe extends gx{constructor(){super(),this.detail=1,this.curveRadius=0,this.groups=[{start:0,count:1/0,materialIndex:0},{start:0,count:1/0,materialIndex:1}],this.boundingSphere=new Bi,this.boundingBox=new ti}computeBoundingSphere(){}computeBoundingBox(){}set detail(e){if(e!==this._detail){this._detail=e,(typeof e!="number"||e<1)&&(e=1);let t=Afe(e);["position","normal","uv"].forEach(n=>{this.attributes[n]=t.attributes[n].clone()}),this.setIndex(t.getIndex().clone())}}get detail(){return this._detail}set curveRadius(e){e!==this._curveRadius&&(this._curveRadius=e,this._updateBounds())}get curveRadius(){return this._curveRadius}updateGlyphs(e,t,n,r,s){this.updateAttributeData(yfe,e,4),this.updateAttributeData(h7,t,1),this.updateAttributeData(vfe,s,3),this._blockBounds=n,this._chunkedBounds=r,this.instanceCount=t.length,this._updateBounds()}_updateBounds(){const e=this._blockBounds;if(e){const{curveRadius:t,boundingBox:n}=this;if(t){const{PI:r,floor:s,min:o,max:a,sin:l,cos:c}=Math,u=r/2,h=r*2,f=Math.abs(t),d=e[0]/f,m=e[2]/f,y=s((d+u)/h)!==s((m+u)/h)?-f:o(l(d)*f,l(m)*f),g=s((d-u)/h)!==s((m-u)/h)?f:a(l(d)*f,l(m)*f),A=s((d+r)/h)!==s((m+r)/h)?f*2:a(f-c(d)*f,f-c(m)*f);n.min.set(y,e[1],t<0?-A:0),n.max.set(g,e[3],t<0?0:A)}else n.min.set(e[0],e[1],0),n.max.set(e[2],e[3],0);n.getBoundingSphere(this.boundingSphere)}}applyClipRect(e){let t=this.getAttribute(h7).count,n=this._chunkedBounds;if(n)for(let r=n.length;r--;){t=n[r].end;let s=n[r].rect;if(s[1]<e.w&&s[3]>e.y&&s[0]<e.z&&s[2]>e.x)break}this.instanceCount=t}updateAttributeData(e,t,n){const r=this.getAttribute(e);t?r&&r.array.length===t.length?(r.array.set(t),r.needsUpdate=!0):(this.setAttribute(e,new Su(t,n)),delete this._maxInstanceCount,this.dispose()):r&&this.deleteAttribute(e)}}const Efe=`
uniform vec2 uTroikaSDFTextureSize;
uniform float uTroikaSDFGlyphSize;
uniform vec4 uTroikaTotalBounds;
uniform vec4 uTroikaClipRect;
uniform mat3 uTroikaOrient;
uniform bool uTroikaUseGlyphColors;
uniform float uTroikaEdgeOffset;
uniform float uTroikaBlurRadius;
uniform vec2 uTroikaPositionOffset;
uniform float uTroikaCurveRadius;
attribute vec4 aTroikaGlyphBounds;
attribute float aTroikaGlyphIndex;
attribute vec3 aTroikaGlyphColor;
varying vec2 vTroikaGlyphUV;
varying vec4 vTroikaTextureUVBounds;
varying float vTroikaTextureChannel;
varying vec3 vTroikaGlyphColor;
varying vec2 vTroikaGlyphDimensions;
`,_fe=`
vec4 bounds = aTroikaGlyphBounds;
bounds.xz += uTroikaPositionOffset.x;
bounds.yw -= uTroikaPositionOffset.y;

vec4 outlineBounds = vec4(
  bounds.xy - uTroikaEdgeOffset - uTroikaBlurRadius,
  bounds.zw + uTroikaEdgeOffset + uTroikaBlurRadius
);
vec4 clippedBounds = vec4(
  clamp(outlineBounds.xy, uTroikaClipRect.xy, uTroikaClipRect.zw),
  clamp(outlineBounds.zw, uTroikaClipRect.xy, uTroikaClipRect.zw)
);

vec2 clippedXY = (mix(clippedBounds.xy, clippedBounds.zw, position.xy) - bounds.xy) / (bounds.zw - bounds.xy);

position.xy = mix(bounds.xy, bounds.zw, clippedXY);

uv = (position.xy - uTroikaTotalBounds.xy) / (uTroikaTotalBounds.zw - uTroikaTotalBounds.xy);

float rad = uTroikaCurveRadius;
if (rad != 0.0) {
  float angle = position.x / rad;
  position.xz = vec2(sin(angle) * rad, rad - cos(angle) * rad);
  normal.xz = vec2(sin(angle), cos(angle));
}
  
position = uTroikaOrient * position;
normal = uTroikaOrient * normal;

vTroikaGlyphUV = clippedXY.xy;
vTroikaGlyphDimensions = vec2(bounds[2] - bounds[0], bounds[3] - bounds[1]);


float txCols = uTroikaSDFTextureSize.x / uTroikaSDFGlyphSize;
vec2 txUvPerSquare = uTroikaSDFGlyphSize / uTroikaSDFTextureSize;
vec2 txStartUV = txUvPerSquare * vec2(
  mod(floor(aTroikaGlyphIndex / 4.0), txCols),
  floor(floor(aTroikaGlyphIndex / 4.0) / txCols)
);
vTroikaTextureUVBounds = vec4(txStartUV, vec2(txStartUV) + txUvPerSquare);
vTroikaTextureChannel = mod(aTroikaGlyphIndex, 4.0);
`,Sfe=`
uniform sampler2D uTroikaSDFTexture;
uniform vec2 uTroikaSDFTextureSize;
uniform float uTroikaSDFGlyphSize;
uniform float uTroikaSDFExponent;
uniform float uTroikaEdgeOffset;
uniform float uTroikaFillOpacity;
uniform float uTroikaBlurRadius;
uniform vec3 uTroikaStrokeColor;
uniform float uTroikaStrokeWidth;
uniform float uTroikaStrokeOpacity;
uniform bool uTroikaSDFDebug;
varying vec2 vTroikaGlyphUV;
varying vec4 vTroikaTextureUVBounds;
varying float vTroikaTextureChannel;
varying vec2 vTroikaGlyphDimensions;

float troikaSdfValueToSignedDistance(float alpha) {
  // Inverse of exponential encoding in webgl-sdf-generator
  
  float maxDimension = max(vTroikaGlyphDimensions.x, vTroikaGlyphDimensions.y);
  float absDist = (1.0 - pow(2.0 * (alpha > 0.5 ? 1.0 - alpha : alpha), 1.0 / uTroikaSDFExponent)) * maxDimension;
  float signedDist = absDist * (alpha > 0.5 ? -1.0 : 1.0);
  return signedDist;
}

float troikaGlyphUvToSdfValue(vec2 glyphUV) {
  vec2 textureUV = mix(vTroikaTextureUVBounds.xy, vTroikaTextureUVBounds.zw, glyphUV);
  vec4 rgba = texture2D(uTroikaSDFTexture, textureUV);
  float ch = floor(vTroikaTextureChannel + 0.5); //NOTE: can't use round() in WebGL1
  return ch == 0.0 ? rgba.r : ch == 1.0 ? rgba.g : ch == 2.0 ? rgba.b : rgba.a;
}

float troikaGlyphUvToDistance(vec2 uv) {
  return troikaSdfValueToSignedDistance(troikaGlyphUvToSdfValue(uv));
}

float troikaGetAADist() {
  
  #if defined(GL_OES_standard_derivatives) || __VERSION__ >= 300
  return length(fwidth(vTroikaGlyphUV * vTroikaGlyphDimensions)) * 0.5;
  #else
  return vTroikaGlyphDimensions.x / 64.0;
  #endif
}

float troikaGetFragDistValue() {
  vec2 clampedGlyphUV = clamp(vTroikaGlyphUV, 0.5 / uTroikaSDFGlyphSize, 1.0 - 0.5 / uTroikaSDFGlyphSize);
  float distance = troikaGlyphUvToDistance(clampedGlyphUV);
 
  // Extrapolate distance when outside bounds:
  distance += clampedGlyphUV == vTroikaGlyphUV ? 0.0 : 
    length((vTroikaGlyphUV - clampedGlyphUV) * vTroikaGlyphDimensions);

  

  return distance;
}

float troikaGetEdgeAlpha(float distance, float distanceOffset, float aaDist) {
  #if defined(IS_DEPTH_MATERIAL) || defined(IS_DISTANCE_MATERIAL)
  float alpha = step(-distanceOffset, -distance);
  #else

  float alpha = smoothstep(
    distanceOffset + aaDist,
    distanceOffset - aaDist,
    distance
  );
  #endif

  return alpha;
}
`,wfe=`
float aaDist = troikaGetAADist();
float fragDistance = troikaGetFragDistValue();
float edgeAlpha = uTroikaSDFDebug ?
  troikaGlyphUvToSdfValue(vTroikaGlyphUV) :
  troikaGetEdgeAlpha(fragDistance, uTroikaEdgeOffset, max(aaDist, uTroikaBlurRadius));

#if !defined(IS_DEPTH_MATERIAL) && !defined(IS_DISTANCE_MATERIAL)
vec4 fillRGBA = gl_FragColor;
fillRGBA.a *= uTroikaFillOpacity;
vec4 strokeRGBA = uTroikaStrokeWidth == 0.0 ? fillRGBA : vec4(uTroikaStrokeColor, uTroikaStrokeOpacity);
if (fillRGBA.a == 0.0) fillRGBA.rgb = strokeRGBA.rgb;
gl_FragColor = mix(fillRGBA, strokeRGBA, smoothstep(
  -uTroikaStrokeWidth - aaDist,
  -uTroikaStrokeWidth + aaDist,
  fragDistance
));
gl_FragColor.a *= edgeAlpha;
#endif

if (edgeAlpha == 0.0) {
  discard;
}
`;function Cfe(i){const e=d5(i,{chained:!0,extensions:{derivatives:!0},uniforms:{uTroikaSDFTexture:{value:null},uTroikaSDFTextureSize:{value:new Ue},uTroikaSDFGlyphSize:{value:0},uTroikaSDFExponent:{value:0},uTroikaTotalBounds:{value:new Rn(0,0,0,0)},uTroikaClipRect:{value:new Rn(0,0,0,0)},uTroikaEdgeOffset:{value:0},uTroikaFillOpacity:{value:1},uTroikaPositionOffset:{value:new Ue},uTroikaCurveRadius:{value:0},uTroikaBlurRadius:{value:0},uTroikaStrokeWidth:{value:0},uTroikaStrokeColor:{value:new ut},uTroikaStrokeOpacity:{value:1},uTroikaOrient:{value:new Tn},uTroikaUseGlyphColors:{value:!0},uTroikaSDFDebug:{value:!1}},vertexDefs:Efe,vertexTransform:_fe,fragmentDefs:Sfe,fragmentColorTransform:wfe,customRewriter({vertexShader:t,fragmentShader:n}){let r=/\buniform\s+vec3\s+diffuse\b/;return r.test(n)&&(n=n.replace(r,"varying vec3 vTroikaGlyphColor").replace(/\bdiffuse\b/g,"vTroikaGlyphColor"),r.test(t)||(t=t.replace(XH,`uniform vec3 diffuse;
$&
vTroikaGlyphColor = uTroikaUseGlyphColors ? aTroikaGlyphColor / 255.0 : diffuse;
`))),{vertexShader:t,fragmentShader:n}}});return e.transparent=!0,e.forceSinglePass=!0,Object.defineProperties(e,{isTroikaTextMaterial:{value:!0},shadowSide:{get(){return this.side},set(){}}}),e}const DR=new no({color:16777215,side:Li,transparent:!0}),f7=8421504,d7=new Xe,HE=new Q,Ab=new Q,fv=[],Tfe=new Q,yb="+x+y";function p7(i){return Array.isArray(i)?i[0]:i}let nQ=()=>{const i=new It(new Fs(1,1),DR);return nQ=()=>i,i},iQ=()=>{const i=new It(new Fs(1,1,32,1),DR);return iQ=()=>i,i};const bfe={type:"syncstart"},Ife={type:"synccomplete"},rQ=["font","fontSize","fontStyle","fontWeight","lang","letterSpacing","lineHeight","maxWidth","overflowWrap","text","direction","textAlign","textIndent","whiteSpace","anchorX","anchorY","colorRanges","sdfGlyphSize"],Mfe=rQ.concat("material","color","depthOffset","clipRect","curveRadius","orientation","glyphGeometryDetail");let sQ=class extends It{constructor(){const e=new xfe;super(e,null),this.text="",this.anchorX=0,this.anchorY=0,this.curveRadius=0,this.direction="auto",this.font=null,this.unicodeFontsURL=null,this.fontSize=.1,this.fontWeight="normal",this.fontStyle="normal",this.lang=null,this.letterSpacing=0,this.lineHeight="normal",this.maxWidth=1/0,this.overflowWrap="normal",this.textAlign="left",this.textIndent=0,this.whiteSpace="normal",this.material=null,this.color=null,this.colorRanges=null,this.outlineWidth=0,this.outlineColor=0,this.outlineOpacity=1,this.outlineBlur=0,this.outlineOffsetX=0,this.outlineOffsetY=0,this.strokeWidth=0,this.strokeColor=f7,this.strokeOpacity=1,this.fillOpacity=1,this.depthOffset=0,this.clipRect=null,this.orientation=yb,this.glyphGeometryDetail=1,this.sdfGlyphSize=null,this.gpuAccelerateSDF=!0,this.debugSDF=!1}sync(e){this._needsSync&&(this._needsSync=!1,this._isSyncing?(this._queuedSyncs||(this._queuedSyncs=[])).push(e):(this._isSyncing=!0,this.dispatchEvent(bfe),JH({text:this.text,font:this.font,lang:this.lang,fontSize:this.fontSize||.1,fontWeight:this.fontWeight||"normal",fontStyle:this.fontStyle||"normal",letterSpacing:this.letterSpacing||0,lineHeight:this.lineHeight||"normal",maxWidth:this.maxWidth,direction:this.direction||"auto",textAlign:this.textAlign,textIndent:this.textIndent,whiteSpace:this.whiteSpace,overflowWrap:this.overflowWrap,anchorX:this.anchorX,anchorY:this.anchorY,colorRanges:this.colorRanges,includeCaretPositions:!0,sdfGlyphSize:this.sdfGlyphSize,gpuAccelerateSDF:this.gpuAccelerateSDF,unicodeFontsURL:this.unicodeFontsURL},t=>{this._isSyncing=!1,this._textRenderInfo=t,this.geometry.updateGlyphs(t.glyphBounds,t.glyphAtlasIndices,t.blockBounds,t.chunkedBounds,t.glyphColors);const n=this._queuedSyncs;n&&(this._queuedSyncs=null,this._needsSync=!0,this.sync(()=>{n.forEach(r=>r&&r())})),this.dispatchEvent(Ife),e&&e()})))}onBeforeRender(e,t,n,r,s,o){this.sync(),s.isTroikaTextMaterial&&this._prepareForRender(s)}dispose(){this.geometry.dispose()}get textRenderInfo(){return this._textRenderInfo||null}createDerivedMaterial(e){return Cfe(e)}get material(){let e=this._derivedMaterial;const t=this._baseMaterial||this._defaultMaterial||(this._defaultMaterial=DR.clone());if((!e||!e.isDerivedFrom(t))&&(e=this._derivedMaterial=this.createDerivedMaterial(t),t.addEventListener("dispose",function n(){t.removeEventListener("dispose",n),e.dispose()})),this.hasOutline()){let n=e._outlineMtl;return n||(n=e._outlineMtl=Object.create(e,{id:{value:e.id+.1}}),n.isTextOutlineMaterial=!0,n.depthWrite=!1,n.map=null,e.addEventListener("dispose",function r(){e.removeEventListener("dispose",r),n.dispose()})),[n,e]}else return e}set material(e){e&&e.isTroikaTextMaterial?(this._derivedMaterial=e,this._baseMaterial=e.baseMaterial):this._baseMaterial=e}hasOutline(){return!!(this.outlineWidth||this.outlineBlur||this.outlineOffsetX||this.outlineOffsetY)}get glyphGeometryDetail(){return this.geometry.detail}set glyphGeometryDetail(e){this.geometry.detail=e}get curveRadius(){return this.geometry.curveRadius}set curveRadius(e){this.geometry.curveRadius=e}get customDepthMaterial(){return p7(this.material).getDepthMaterial()}set customDepthMaterial(e){}get customDistanceMaterial(){return p7(this.material).getDistanceMaterial()}set customDistanceMaterial(e){}_prepareForRender(e){const t=e.isTextOutlineMaterial,n=e.uniforms,r=this.textRenderInfo;if(r){const{sdfTexture:a,blockBounds:l}=r;n.uTroikaSDFTexture.value=a,n.uTroikaSDFTextureSize.value.set(a.image.width,a.image.height),n.uTroikaSDFGlyphSize.value=r.sdfGlyphSize,n.uTroikaSDFExponent.value=r.sdfExponent,n.uTroikaTotalBounds.value.fromArray(l),n.uTroikaUseGlyphColors.value=!t&&!!r.glyphColors;let c=0,u=0,h=0,f,d,m,y=0,g=0;if(t){let{outlineWidth:E,outlineOffsetX:x,outlineOffsetY:w,outlineBlur:T,outlineOpacity:I}=this;c=this._parsePercent(E)||0,u=Math.max(0,this._parsePercent(T)||0),f=I,y=this._parsePercent(x)||0,g=this._parsePercent(w)||0}else h=Math.max(0,this._parsePercent(this.strokeWidth)||0),h&&(m=this.strokeColor,n.uTroikaStrokeColor.value.set(m??f7),d=this.strokeOpacity,d==null&&(d=1)),f=this.fillOpacity;n.uTroikaEdgeOffset.value=c,n.uTroikaPositionOffset.value.set(y,g),n.uTroikaBlurRadius.value=u,n.uTroikaStrokeWidth.value=h,n.uTroikaStrokeOpacity.value=d,n.uTroikaFillOpacity.value=f??1,n.uTroikaCurveRadius.value=this.curveRadius||0;let A=this.clipRect;if(A&&Array.isArray(A)&&A.length===4)n.uTroikaClipRect.value.fromArray(A);else{const E=(this.fontSize||.1)*100;n.uTroikaClipRect.value.set(l[0]-E,l[1]-E,l[2]+E,l[3]+E)}this.geometry.applyClipRect(n.uTroikaClipRect.value)}n.uTroikaSDFDebug.value=!!this.debugSDF,e.polygonOffset=!!this.depthOffset,e.polygonOffsetFactor=e.polygonOffsetUnits=this.depthOffset||0;const s=t?this.outlineColor||0:this.color;if(s==null)delete e.color;else{const a=e.hasOwnProperty("color")?e.color:e.color=new ut;(s!==a._input||typeof s=="object")&&a.set(a._input=s)}let o=this.orientation||yb;if(o!==e._orientation){let a=n.uTroikaOrient.value;o=o.replace(/[^-+xyz]/g,"");let l=o!==yb&&o.match(/^([-+])([xyz])([-+])([xyz])$/);if(l){let[,c,u,h,f]=l;HE.set(0,0,0)[u]=c==="-"?1:-1,Ab.set(0,0,0)[f]=h==="-"?-1:1,d7.lookAt(Tfe,HE.cross(Ab),Ab),a.setFromMatrix4(d7)}else a.identity();e._orientation=o}}_parsePercent(e){if(typeof e=="string"){let t=e.match(/^(-?[\d.]+)%$/),n=t?parseFloat(t[1]):NaN;e=(isNaN(n)?0:n/100)*this.fontSize}return e}localPositionToTextCoords(e,t=new Ue){t.copy(e);const n=this.curveRadius;return n&&(t.x=Math.atan2(e.x,Math.abs(n)-Math.abs(e.z))*Math.abs(n)),t}worldPositionToTextCoords(e,t=new Ue){return HE.copy(e),this.localPositionToTextCoords(this.worldToLocal(HE),t)}raycast(e,t){const{textRenderInfo:n,curveRadius:r}=this;if(n){const s=n.blockBounds,o=r?iQ():nQ(),a=o.geometry,{position:l,uv:c}=a.attributes;for(let u=0;u<c.count;u++){let h=s[0]+c.getX(u)*(s[2]-s[0]);const f=s[1]+c.getY(u)*(s[3]-s[1]);let d=0;r&&(d=r-Math.cos(h/r)*r,h=Math.sin(h/r)*r),l.setXYZ(u,h,f,d)}a.boundingSphere=this.geometry.boundingSphere,a.boundingBox=this.geometry.boundingBox,o.matrixWorld=this.matrixWorld,o.material.side=this.material.side,fv.length=0,o.raycast(e,fv);for(let u=0;u<fv.length;u++)fv[u].object=this,t.push(fv[u])}}copy(e){const t=this.geometry;return super.copy(e),this.geometry=t,Mfe.forEach(n=>{this[n]=e[n]}),this}clone(){return new this.constructor().copy(this)}};rQ.forEach(i=>{const e="_private_"+i;Object.defineProperty(sQ.prototype,i,{get(){return this[e]},set(t){t!==this[e]&&(this[e]=t,this._needsSync=!0)}})});new ti;new ut;const oQ=C.forwardRef(({sdfGlyphSize:i=64,anchorX:e="center",anchorY:t="middle",font:n,fontSize:r=1,children:s,characters:o,onSync:a,...l},c)=>{const u=Ve(({invalidate:m})=>m),[h]=C.useState(()=>new sQ),[f,d]=C.useMemo(()=>{const m=[];let y="";return C.Children.forEach(s,g=>{typeof g=="string"||typeof g=="number"?y+=g:m.push(g)}),[m,y]},[s]);return Th(()=>new Promise(m=>dfe({font:n,characters:o},m)),["troika-text",n,o]),C.useLayoutEffect(()=>void h.sync(()=>{u(),a&&a(h)})),C.useEffect(()=>()=>h.dispose(),[h]),C.createElement("primitive",ot({object:h,ref:c,font:n,text:d,anchorX:e,anchorY:t,fontSize:r,sdfGlyphSize:i},l),f)});let vb=null;async function Rfe(i){return typeof i=="string"?await(await fetch(i)).json():i}function Pfe(i){return vb||(vb=new Nue),vb.parse(i)}async function aQ(i){const e=await Rfe(i);return Pfe(e)}function p4(i){return Th(aQ,[i])}p4.preload=i=>Nz(aQ,[i]);p4.clear=i=>Ax([i]);const Lfe=["string","number"],Bfe=i=>{let e="";const t=[];return C.Children.forEach(i,n=>{Lfe.includes(typeof n)?e+=n+"":t.push(n)}),[e,...t]},lQ=C.forwardRef(({font:i,letterSpacing:e=0,lineHeight:t=1,size:n=1,height:r=.2,bevelThickness:s=.1,bevelSize:o=.01,bevelEnabled:a=!1,bevelOffset:l=0,bevelSegments:c=4,curveSegments:u=8,smooth:h,children:f,...d},m)=>{C.useMemo(()=>Or({RenamedTextGeometry:fue}),[]);const y=C.useRef(null),g=p4(i),A=C.useMemo(()=>({font:g,size:n,height:r,bevelThickness:s,bevelSize:o,bevelEnabled:a,bevelSegments:c,bevelOffset:l,curveSegments:u,letterSpacing:e,lineHeight:t}),[g,n,r,s,o,a,c,l,u,e,t]),[E,...x]=C.useMemo(()=>Bfe(f),[f]),w=C.useMemo(()=>[E,A],[E,A]);return C.useLayoutEffect(()=>{h&&(y.current.geometry=ule(y.current.geometry,h),y.current.geometry.computeVertexNormals())},[w,h]),C.useImperativeHandle(m,()=>y.current,[]),C.createElement("mesh",ot({},d,{ref:y}),C.createElement("renamedTextGeometry",{args:w}),x)}),Dfe=()=>{try{var i=document.createElement("canvas");return!!(window.WebGL2RenderingContext&&i.getContext("webgl2"))}catch{return!1}},kfe=C.forwardRef(({children:i,multisamping:e=8,renderIndex:t=1,disableRender:n,disableGamma:r,disableRenderPass:s,depthBuffer:o=!0,stencilBuffer:a=!1,anisotropy:l=1,encoding:c,type:u,...h},f)=>{C.useMemo(()=>Or({EffectComposer:Tce,RenderPass:Mce,ShaderPass:o5}),[]);const d=C.useRef(null);C.useImperativeHandle(f,()=>d.current,[]);const{scene:m,camera:y,gl:g,size:A,viewport:E}=Ve(),[x]=C.useState(()=>{const T=new Si(A.width,A.height,{type:u||Ni,format:gi,depthBuffer:o,stencilBuffer:a,anisotropy:l});return u===Zi&&c!=null&&("colorSpace"in T?T.texture.colorSpace=c:T.texture.encoding=c),T.samples=e,T});C.useEffect(()=>{var T,I;(T=d.current)==null||T.setSize(A.width,A.height),(I=d.current)==null||I.setPixelRatio(E.dpr)},[g,A,E.dpr]),Kt(()=>{var T;n||(T=d.current)==null||T.render()},t);const w=[];return s||w.push(C.createElement("renderPass",{key:"renderpass",attach:`passes-${w.length}`,args:[m,y]})),r||w.push(C.createElement("shaderPass",{attach:`passes-${w.length}`,key:"gammapass",args:[due]})),C.Children.forEach(i,T=>{T&&w.push(C.cloneElement(T,{key:w.length,attach:`passes-${w.length}`}))}),C.createElement("effectComposer",ot({ref:d,args:[g,x]},h),w)});let m5=(function(i){return i.Linear="linear",i.Radial="radial",i})({});function Ffe({stops:i,colors:e,size:t=1024,width:n=16,type:r=m5.Linear,innerCircleRadius:s=0,outerCircleRadius:o="auto",...a}){const l=Ve(u=>u.gl),c=C.useMemo(()=>{const u=document.createElement("canvas"),h=u.getContext("2d");u.width=n,u.height=t;let f;if(r===m5.Linear)f=h.createLinearGradient(0,0,0,t);else{const y=u.width/2,g=u.height/2,A=o!=="auto"?Math.abs(Number(o)):Math.sqrt(y**2+g**2);f=h.createRadialGradient(y,g,Math.abs(s),y,g,A)}const d=new ut;let m=i.length;for(;m--;)f.addColorStop(i[m],d.set(e[m]).getStyle());return h.save(),h.fillStyle=f,h.fillRect(0,0,n,t),h.restore(),u},[i]);return C.createElement("canvasTexture",ot({colorSpace:l.outputColorSpace,args:[c],attach:"map"},a))}function Ec(i,e,t,n){const r=class extends Mi{constructor(o={}){const a=Object.entries(i);super({uniforms:a.reduce((l,[c,u])=>{const h=rp.clone({[c]:{value:u}});return{...l,...h}},{}),vertexShader:e,fragmentShader:t}),this.key="",a.forEach(([l])=>Object.defineProperty(this,l,{get:()=>this.uniforms[l].value,set:c=>this.uniforms[l].value=c})),Object.assign(this,o),n&&n(this)}};return r.key=un.generateUUID(),r}const K1=i=>i===Object(i)&&!Array.isArray(i)&&typeof i!="function";function xp(i,e){const t=Ve(s=>s.gl),n=cr(xh,K1(i)?Object.values(i):i);return C.useLayoutEffect(()=>{e==null||e(n)},[e]),C.useEffect(()=>{if("initTexture"in t){let s=[];Array.isArray(n)?s=n:n instanceof vi?s=[n]:K1(n)&&(s=Object.values(n)),s.forEach(o=>{o instanceof vi&&t.initTexture(o)})}},[t,n]),C.useMemo(()=>{if(K1(i)){const s={};let o=0;for(const a in i)s[a]=n[o++];return s}else return n},[i,n])}xp.preload=i=>cr.preload(xh,i);xp.clear=i=>cr.clear(xh,i);const Ofe=({children:i,input:e,onLoad:t})=>{const n=xp(e,t);return C.createElement(C.Fragment,null,i==null?void 0:i(n))},Nfe=()=>parseInt(dp.replace(/\D+/g,"")),ea=Nfe(),m7=Ec({color:new ut("white"),scale:new Ue(1,1),imageBounds:new Ue(1,1),resolution:1024,map:null,zoom:1,radius:0,grayscale:0,opacity:1},`
  varying vec2 vUv;
  varying vec2 vPos;
  void main() {
    gl_Position = projectionMatrix * viewMatrix * modelMatrix * vec4(position, 1.);
    vUv = uv;
    vPos = position.xy;
  }
`,`
  // mostly from https://gist.github.com/statico/df64c5d167362ecf7b34fca0b1459a44
  varying vec2 vUv;
  varying vec2 vPos;
  uniform vec2 scale;
  uniform vec2 imageBounds;
  uniform float resolution;
  uniform vec3 color;
  uniform sampler2D map;
  uniform float radius;
  uniform float zoom;
  uniform float grayscale;
  uniform float opacity;
  const vec3 luma = vec3(.299, 0.587, 0.114);
  vec4 toGrayscale(vec4 color, float intensity) {
    return vec4(mix(color.rgb, vec3(dot(color.rgb, luma)), intensity), color.a);
  }
  vec2 aspect(vec2 size) {
    return size / min(size.x, size.y);
  }
  
  const float PI = 3.14159265;
    
  // from https://iquilezles.org/articles/distfunctions
  float udRoundBox( vec2 p, vec2 b, float r ) {
    return length(max(abs(p)-b+r,0.0))-r;
  }

  void main() {
    vec2 s = aspect(scale);
    vec2 i = aspect(imageBounds);
    float rs = s.x / s.y;
    float ri = i.x / i.y;
    vec2 new = rs < ri ? vec2(i.x * s.y / i.y, s.y) : vec2(s.x, i.y * s.x / i.x);
    vec2 offset = (rs < ri ? vec2((new.x - s.x) / 2.0, 0.0) : vec2(0.0, (new.y - s.y) / 2.0)) / new;
    vec2 uv = vUv * s / new + offset;
    vec2 zUv = (uv - vec2(0.5, 0.5)) / zoom + vec2(0.5, 0.5);

    vec2 res = vec2(scale * resolution);
    vec2 halfRes = 0.5 * res;
    float b = udRoundBox(vUv.xy * res - halfRes, halfRes, resolution * radius);    
	  vec3 a = mix(vec3(1.0,0.0,0.0), vec3(0.0,0.0,0.0), smoothstep(0.0, 1.0, b));
    gl_FragColor = toGrayscale(texture2D(map, zUv) * vec4(color, opacity * a), grayscale);
    
    #include <tonemapping_fragment>
    #include <${ea>=154?"colorspace_fragment":"encodings_fragment"}>
  }
`),cQ=C.forwardRef(({children:i,color:e,segments:t=1,scale:n=1,zoom:r=1,grayscale:s=0,opacity:o=1,radius:a=0,texture:l,toneMapped:c,transparent:u,side:h,...f},d)=>{Or({ImageMaterial:m7});const m=C.useRef(null),y=Ve(x=>x.size),g=Array.isArray(n)?[n[0],n[1]]:[n,n],A=[l.image.width,l.image.height],E=Math.max(y.width,y.height);return C.useImperativeHandle(d,()=>m.current,[]),C.useLayoutEffect(()=>{m.current.geometry.parameters&&m.current.material.scale.set(g[0]*m.current.geometry.parameters.width,g[1]*m.current.geometry.parameters.height)},[g[0],g[1]]),C.createElement("mesh",ot({ref:m,scale:Array.isArray(n)?[...n,1]:n},f),C.createElement("planeGeometry",{args:[1,1,t,t]}),C.createElement("imageMaterial",{color:e,map:l,zoom:r,grayscale:s,opacity:o,scale:g,imageBounds:A,resolution:E,radius:a,toneMapped:c,transparent:u,side:h,key:m7.key}),i)}),Ufe=C.forwardRef(({url:i,...e},t)=>{const n=xp(i);return C.createElement(cQ,ot({},e,{texture:n,ref:t}))}),zfe=C.forwardRef(({url:i,...e},t)=>C.createElement(cQ,ot({},e,{ref:t}))),Gfe=C.forwardRef((i,e)=>{if(i.url)return C.createElement(Ufe,ot({},i,{ref:e}));if(i.texture)return C.createElement(zfe,ot({},i,{ref:e}));throw new Error("<Image /> requires a url or texture")}),uQ=C.forwardRef(({threshold:i=15,geometry:e,...t},n)=>{const r=C.useRef(null);C.useImperativeHandle(n,()=>r.current,[]);const s=C.useMemo(()=>[0,0,0,1,0,0],[]),o=C.useRef(),a=C.useRef();return C.useLayoutEffect(()=>{const l=r.current.parent,c=e??(l==null?void 0:l.geometry);if(!c||o.current===c&&a.current===i)return;o.current=c,a.current=i;const h=new Q6(c,i).attributes.position.array;r.current.geometry.setPositions(h),r.current.geometry.attributes.instanceStart.needsUpdate=!0,r.current.geometry.attributes.instanceEnd.needsUpdate=!0,r.current.computeLineDistances()}),C.createElement(Cu,ot({segments:!0,points:s,ref:r,raycast:()=>null},t))}),g7=Ec({screenspace:!1,color:new ut("black"),opacity:1,thickness:.05,size:new Ue},`#include <common>
   #include <morphtarget_pars_vertex>
   #include <skinning_pars_vertex>
   #include <clipping_planes_pars_vertex>
   uniform float thickness;
   uniform bool screenspace;
   uniform vec2 size;
   void main() {
     #if defined (USE_SKINNING)
	     #include <beginnormal_vertex>
       #include <morphnormal_vertex>
       #include <skinbase_vertex>
       #include <skinnormal_vertex>
       #include <defaultnormal_vertex>
     #endif
     #include <begin_vertex>
	   #include <morphtarget_vertex>
	   #include <skinning_vertex>
     #include <project_vertex>
     #include <clipping_planes_vertex>
     vec4 tNormal = vec4(normal, 0.0);
     vec4 tPosition = vec4(transformed, 1.0);
     #ifdef USE_INSTANCING
       tNormal = instanceMatrix * tNormal;
       tPosition = instanceMatrix * tPosition;
     #endif
     if (screenspace) {
       vec3 newPosition = tPosition.xyz + tNormal.xyz * thickness;
       gl_Position = projectionMatrix * modelViewMatrix * vec4(newPosition, 1.0); 
     } else {
       vec4 clipPosition = projectionMatrix * modelViewMatrix * tPosition;
       vec4 clipNormal = projectionMatrix * modelViewMatrix * tNormal;
       vec2 offset = normalize(clipNormal.xy) * thickness / size * clipPosition.w * 2.0;
       clipPosition.xy += offset;
       gl_Position = clipPosition;
     }
   }`,`uniform vec3 color;
   uniform float opacity;
   #include <clipping_planes_pars_fragment>
   void main(){
     #include <clipping_planes_fragment>
     gl_FragColor = vec4(color, opacity);
     #include <tonemapping_fragment>
     #include <${ea>=154?"colorspace_fragment":"encodings_fragment"}>
   }`);function Hfe({color:i="black",opacity:e=1,transparent:t=!1,screenspace:n=!1,toneMapped:r=!0,polygonOffset:s=!1,polygonOffsetFactor:o=0,renderOrder:a=0,thickness:l=.05,angle:c=Math.PI,clippingPlanes:u,...h}){const f=C.useRef(),[d]=C.useState(()=>new g7({side:ys})),{gl:m}=Ve(),y=m.getDrawingBufferSize(new Ue);C.useMemo(()=>Or({OutlinesMaterial:g7}),[]);const g=C.useRef(0),A=C.useRef();return C.useLayoutEffect(()=>{const E=f.current;if(!E)return;const x=E.parent;if(x&&x.geometry&&(g.current!==c||A.current!==x.geometry)){var w;g.current=c,A.current=x.geometry;let T=(w=E.children)==null?void 0:w[0];T&&(c&&T.geometry.dispose(),E.remove(T)),x.skeleton?(T=new cx,T.material=d,T.bind(x.skeleton,x.bindMatrix),E.add(T)):x.isInstancedMesh?(T=new ux(x.geometry,d,x.count),T.instanceMatrix=x.instanceMatrix,E.add(T)):(T=new It,T.material=d,E.add(T)),T.geometry=c?sH(x.geometry,c):x.geometry,T.morphTargetInfluences=x.morphTargetInfluences,T.morphTargetDictionary=x.morphTargetDictionary}}),C.useLayoutEffect(()=>{const E=f.current;if(!E)return;const x=E.children[0];if(x){x.renderOrder=a;const w=E.parent;Os(x,{morphTargetInfluences:w.morphTargetInfluences,morphTargetDictionary:w.morphTargetDictionary}),Os(x.material,{transparent:t,thickness:l,color:i,opacity:e,size:y,screenspace:n,toneMapped:r,polygonOffset:s,polygonOffsetFactor:o,clippingPlanes:u,clipping:u&&u.length>0})}}),C.useEffect(()=>()=>{const E=f.current;if(!E)return;const x=E.children[0];x&&(c&&x.geometry.dispose(),E.remove(x))},[]),C.createElement("group",ot({ref:f},h))}var Qfe=Object.defineProperty,Vfe=(i,e,t)=>e in i?Qfe(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Pi=(i,e,t)=>(Vfe(i,typeof e!="symbol"?e+"":e,t),t);function xb(i,e,t,n,r){let s;if(i=i.subarray||i.slice?i:i.buffer,t=t.subarray||t.slice?t:t.buffer,i=e?i.subarray?i.subarray(e,r&&e+r):i.slice(e,r&&e+r):i,t.set)t.set(i,n);else for(s=0;s<i.length;s++)t[s+n]=i[s];return t}function jfe(i){return i instanceof Float32Array?i:i instanceof fn?i.getAttribute("position").array:i.map(e=>{const t=Array.isArray(e);return e instanceof Q?[e.x,e.y,e.z]:e instanceof Ue?[e.x,e.y,0]:t&&e.length===3?[e[0],e[1],e[2]]:t&&e.length===2?[e[0],e[1],0]:e}).flat()}class Wfe extends fn{constructor(){super(),Pi(this,"type","MeshLine"),Pi(this,"isMeshLine",!0),Pi(this,"positions",[]),Pi(this,"previous",[]),Pi(this,"next",[]),Pi(this,"side",[]),Pi(this,"width",[]),Pi(this,"indices_array",[]),Pi(this,"uvs",[]),Pi(this,"counters",[]),Pi(this,"widthCallback",null),Pi(this,"_attributes"),Pi(this,"_points",[]),Pi(this,"points"),Pi(this,"matrixWorld",new Xe),Object.defineProperties(this,{points:{enumerable:!0,get(){return this._points},set(e){this.setPoints(e,this.widthCallback)}}})}setMatrixWorld(e){this.matrixWorld=e}setPoints(e,t){if(e=jfe(e),this._points=e,this.widthCallback=t??null,this.positions=[],this.counters=[],e.length&&e[0]instanceof Q)for(let n=0;n<e.length;n++){const r=e[n],s=n/(e.length-1);this.positions.push(r.x,r.y,r.z),this.positions.push(r.x,r.y,r.z),this.counters.push(s),this.counters.push(s)}else for(let n=0;n<e.length;n+=3){const r=n/(e.length-1);this.positions.push(e[n],e[n+1],e[n+2]),this.positions.push(e[n],e[n+1],e[n+2]),this.counters.push(r),this.counters.push(r)}this.process()}compareV3(e,t){const n=e*6,r=t*6;return this.positions[n]===this.positions[r]&&this.positions[n+1]===this.positions[r+1]&&this.positions[n+2]===this.positions[r+2]}copyV3(e){const t=e*6;return[this.positions[t],this.positions[t+1],this.positions[t+2]]}process(){const e=this.positions.length/6;this.previous=[],this.next=[],this.side=[],this.width=[],this.indices_array=[],this.uvs=[];let t,n;this.compareV3(0,e-1)?n=this.copyV3(e-2):n=this.copyV3(0),this.previous.push(n[0],n[1],n[2]),this.previous.push(n[0],n[1],n[2]);for(let r=0;r<e;r++){if(this.side.push(1),this.side.push(-1),this.widthCallback?t=this.widthCallback(r/(e-1)):t=1,this.width.push(t),this.width.push(t),this.uvs.push(r/(e-1),0),this.uvs.push(r/(e-1),1),r<e-1){n=this.copyV3(r),this.previous.push(n[0],n[1],n[2]),this.previous.push(n[0],n[1],n[2]);const s=r*2;this.indices_array.push(s,s+1,s+2),this.indices_array.push(s+2,s+1,s+3)}r>0&&(n=this.copyV3(r),this.next.push(n[0],n[1],n[2]),this.next.push(n[0],n[1],n[2]))}this.compareV3(e-1,0)?n=this.copyV3(1):n=this.copyV3(e-1),this.next.push(n[0],n[1],n[2]),this.next.push(n[0],n[1],n[2]),!this._attributes||this._attributes.position.count!==this.counters.length?this._attributes={position:new mn(new Float32Array(this.positions),3),previous:new mn(new Float32Array(this.previous),3),next:new mn(new Float32Array(this.next),3),side:new mn(new Float32Array(this.side),1),width:new mn(new Float32Array(this.width),1),uv:new mn(new Float32Array(this.uvs),2),index:new mn(new Uint16Array(this.indices_array),1),counters:new mn(new Float32Array(this.counters),1)}:(this._attributes.position.copyArray(new Float32Array(this.positions)),this._attributes.position.needsUpdate=!0,this._attributes.previous.copyArray(new Float32Array(this.previous)),this._attributes.previous.needsUpdate=!0,this._attributes.next.copyArray(new Float32Array(this.next)),this._attributes.next.needsUpdate=!0,this._attributes.side.copyArray(new Float32Array(this.side)),this._attributes.side.needsUpdate=!0,this._attributes.width.copyArray(new Float32Array(this.width)),this._attributes.width.needsUpdate=!0,this._attributes.uv.copyArray(new Float32Array(this.uvs)),this._attributes.uv.needsUpdate=!0,this._attributes.index.copyArray(new Uint16Array(this.indices_array)),this._attributes.index.needsUpdate=!0),this.setAttribute("position",this._attributes.position),this.setAttribute("previous",this._attributes.previous),this.setAttribute("next",this._attributes.next),this.setAttribute("side",this._attributes.side),this.setAttribute("width",this._attributes.width),this.setAttribute("uv",this._attributes.uv),this.setAttribute("counters",this._attributes.counters),this.setAttribute("position",this._attributes.position),this.setAttribute("previous",this._attributes.previous),this.setAttribute("next",this._attributes.next),this.setAttribute("side",this._attributes.side),this.setAttribute("width",this._attributes.width),this.setAttribute("uv",this._attributes.uv),this.setAttribute("counters",this._attributes.counters),this.setIndex(this._attributes.index),this.computeBoundingSphere(),this.computeBoundingBox()}advance({x:e,y:t,z:n}){const r=this._attributes.position.array,s=this._attributes.previous.array,o=this._attributes.next.array,a=r.length;xb(r,0,s,0,a),xb(r,6,r,0,a-6),r[a-6]=e,r[a-5]=t,r[a-4]=n,r[a-3]=e,r[a-2]=t,r[a-1]=n,xb(r,6,o,0,a-6),o[a-6]=e,o[a-5]=t,o[a-4]=n,o[a-3]=e,o[a-2]=t,o[a-1]=n,this._attributes.position.needsUpdate=!0,this._attributes.previous.needsUpdate=!0,this._attributes.next.needsUpdate=!0}}const Kfe=`
  #include <common>
  #include <logdepthbuf_pars_vertex>
  #include <fog_pars_vertex>
  #include <clipping_planes_pars_vertex>

  attribute vec3 previous;
  attribute vec3 next;
  attribute float side;
  attribute float width;
  attribute float counters;
  
  uniform vec2 resolution;
  uniform float lineWidth;
  uniform vec3 color;
  uniform float opacity;
  uniform float sizeAttenuation;
  
  varying vec2 vUV;
  varying vec4 vColor;
  varying float vCounters;
  
  vec2 fix(vec4 i, float aspect) {
    vec2 res = i.xy / i.w;
    res.x *= aspect;
    return res;
  }
  
  void main() {
    float aspect = resolution.x / resolution.y;
    vColor = vec4(color, opacity);
    vUV = uv;
    vCounters = counters;
  
    mat4 m = projectionMatrix * modelViewMatrix;
    vec4 finalPosition = m * vec4(position, 1.0) * aspect;
    vec4 prevPos = m * vec4(previous, 1.0);
    vec4 nextPos = m * vec4(next, 1.0);
  
    vec2 currentP = fix(finalPosition, aspect);
    vec2 prevP = fix(prevPos, aspect);
    vec2 nextP = fix(nextPos, aspect);
  
    float w = lineWidth * width;
  
    vec2 dir;
    if (nextP == currentP) dir = normalize(currentP - prevP);
    else if (prevP == currentP) dir = normalize(nextP - currentP);
    else {
      vec2 dir1 = normalize(currentP - prevP);
      vec2 dir2 = normalize(nextP - currentP);
      dir = normalize(dir1 + dir2);
  
      vec2 perp = vec2(-dir1.y, dir1.x);
      vec2 miter = vec2(-dir.y, dir.x);
      //w = clamp(w / dot(miter, perp), 0., 4. * lineWidth * width);
    }
  
    //vec2 normal = (cross(vec3(dir, 0.), vec3(0., 0., 1.))).xy;
    vec4 normal = vec4(-dir.y, dir.x, 0., 1.);
    normal.xy *= .5 * w;
    //normal *= projectionMatrix;
    if (sizeAttenuation == 0.) {
      normal.xy *= finalPosition.w;
      normal.xy /= (vec4(resolution, 0., 1.) * projectionMatrix).xy * aspect;
    }
  
    finalPosition.xy += normal.xy * side;
    gl_Position = finalPosition;
    #include <logdepthbuf_vertex>
    #include <fog_vertex>
    vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);
    #include <clipping_planes_vertex>
    #include <fog_vertex>
  }
`,Yfe=parseInt(dp.replace(/\D+/g,"")),$fe=Yfe>=154?"colorspace_fragment":"encodings_fragment",Xfe=`
  #include <fog_pars_fragment>
  #include <logdepthbuf_pars_fragment>
  #include <clipping_planes_pars_fragment>
  
  uniform sampler2D map;
  uniform sampler2D alphaMap;
  uniform float useGradient;
  uniform float useMap;
  uniform float useAlphaMap;
  uniform float useDash;
  uniform float dashArray;
  uniform float dashOffset;
  uniform float dashRatio;
  uniform float visibility;
  uniform float alphaTest;
  uniform vec2 repeat;
  uniform vec3 gradient[2];
  
  varying vec2 vUV;
  varying vec4 vColor;
  varying float vCounters;
  
  void main() {
    #include <logdepthbuf_fragment>
    vec4 diffuseColor = vColor;
    if (useGradient == 1.) diffuseColor = vec4(mix(gradient[0], gradient[1], vCounters), 1.0);
    if (useMap == 1.) diffuseColor *= texture2D(map, vUV * repeat);
    if (useAlphaMap == 1.) diffuseColor.a *= texture2D(alphaMap, vUV * repeat).a;
    if (diffuseColor.a < alphaTest) discard;
    if (useDash == 1.) diffuseColor.a *= ceil(mod(vCounters + dashOffset, dashArray) - (dashArray * dashRatio));
    diffuseColor.a *= step(vCounters, visibility);
    #include <clipping_planes_fragment>
    gl_FragColor = diffuseColor;     
    #include <fog_fragment>
    #include <tonemapping_fragment>
    #include <${$fe}>
  }
`;class qfe extends Mi{constructor(e){super({uniforms:{...Ot.fog,lineWidth:{value:1},map:{value:null},useMap:{value:0},alphaMap:{value:null},useAlphaMap:{value:0},color:{value:new ut(16777215)},gradient:{value:[new ut(16711680),new ut(65280)]},opacity:{value:1},resolution:{value:new Ue(1,1)},sizeAttenuation:{value:1},dashArray:{value:0},dashOffset:{value:0},dashRatio:{value:.5},useDash:{value:0},useGradient:{value:0},visibility:{value:1},alphaTest:{value:0},repeat:{value:new Ue(1,1)}},vertexShader:Kfe,fragmentShader:Xfe}),Pi(this,"lineWidth"),Pi(this,"map"),Pi(this,"useMap"),Pi(this,"alphaMap"),Pi(this,"useAlphaMap"),Pi(this,"color"),Pi(this,"gradient"),Pi(this,"resolution"),Pi(this,"sizeAttenuation"),Pi(this,"dashArray"),Pi(this,"dashOffset"),Pi(this,"dashRatio"),Pi(this,"useDash"),Pi(this,"useGradient"),Pi(this,"visibility"),Pi(this,"repeat"),this.type="MeshLineMaterial",Object.defineProperties(this,{lineWidth:{enumerable:!0,get(){return this.uniforms.lineWidth.value},set(t){this.uniforms.lineWidth.value=t}},map:{enumerable:!0,get(){return this.uniforms.map.value},set(t){this.uniforms.map.value=t}},useMap:{enumerable:!0,get(){return this.uniforms.useMap.value},set(t){this.uniforms.useMap.value=t}},alphaMap:{enumerable:!0,get(){return this.uniforms.alphaMap.value},set(t){this.uniforms.alphaMap.value=t}},useAlphaMap:{enumerable:!0,get(){return this.uniforms.useAlphaMap.value},set(t){this.uniforms.useAlphaMap.value=t}},color:{enumerable:!0,get(){return this.uniforms.color.value},set(t){this.uniforms.color.value=t}},gradient:{enumerable:!0,get(){return this.uniforms.gradient.value},set(t){this.uniforms.gradient.value=t}},opacity:{enumerable:!0,get(){return this.uniforms.opacity.value},set(t){this.uniforms.opacity.value=t}},resolution:{enumerable:!0,get(){return this.uniforms.resolution.value},set(t){this.uniforms.resolution.value.copy(t)}},sizeAttenuation:{enumerable:!0,get(){return this.uniforms.sizeAttenuation.value},set(t){this.uniforms.sizeAttenuation.value=t}},dashArray:{enumerable:!0,get(){return this.uniforms.dashArray.value},set(t){this.uniforms.dashArray.value=t,this.useDash=t!==0?1:0}},dashOffset:{enumerable:!0,get(){return this.uniforms.dashOffset.value},set(t){this.uniforms.dashOffset.value=t}},dashRatio:{enumerable:!0,get(){return this.uniforms.dashRatio.value},set(t){this.uniforms.dashRatio.value=t}},useDash:{enumerable:!0,get(){return this.uniforms.useDash.value},set(t){this.uniforms.useDash.value=t}},useGradient:{enumerable:!0,get(){return this.uniforms.useGradient.value},set(t){this.uniforms.useGradient.value=t}},visibility:{enumerable:!0,get(){return this.uniforms.visibility.value},set(t){this.uniforms.visibility.value=t}},alphaTest:{enumerable:!0,get(){return this.uniforms.alphaTest.value},set(t){this.uniforms.alphaTest.value=t}},repeat:{enumerable:!0,get(){return this.uniforms.repeat.value},set(t){this.uniforms.repeat.value.copy(t)}}}),this.setValues(e)}copy(e){return super.copy(e),this.lineWidth=e.lineWidth,this.map=e.map,this.useMap=e.useMap,this.alphaMap=e.alphaMap,this.useAlphaMap=e.useAlphaMap,this.color.copy(e.color),this.gradient=e.gradient,this.opacity=e.opacity,this.resolution.copy(e.resolution),this.sizeAttenuation=e.sizeAttenuation,this.dashArray=e.dashArray,this.dashOffset=e.dashOffset,this.dashRatio=e.dashRatio,this.useDash=e.useDash,this.useGradient=e.useGradient,this.visibility=e.visibility,this.alphaTest=e.alphaTest,this.repeat.copy(e.repeat),this}}const hQ={width:.2,length:1,decay:1,local:!1,stride:0,interval:1},Jfe=(i,e=1)=>(i.set(i.subarray(e)),i.fill(-1/0,-e),i);function fQ(i,e){const{length:t,local:n,decay:r,interval:s,stride:o}={...hQ,...e},a=C.useRef(),[l]=C.useState(()=>new Q);C.useLayoutEffect(()=>{i&&(a.current=Float32Array.from({length:t*10*3},(h,f)=>i.position.getComponent(f%3)))},[t,i]);const c=C.useRef(new Q),u=C.useRef(0);return Kt(()=>{if(i&&a.current){if(u.current===0){let h;n?h=i.position:(i.getWorldPosition(l),h=l);const f=1*r;for(let d=0;d<f;d++)h.distanceTo(c.current)<o||(Jfe(a.current,3),a.current.set(h.toArray(),a.current.length-3));c.current.copy(h)}u.current++,u.current=u.current%s}}),a}const Zfe=C.forwardRef((i,e)=>{const{children:t}=i,{width:n,length:r,decay:s,local:o,stride:a,interval:l}={...hQ,...i},{color:c="hotpink",attenuation:u,target:h}=i,f=Ve(w=>w.size),d=Ve(w=>w.scene),m=C.useRef(null),[y,g]=C.useState(null),A=fQ(y,{length:r,decay:s,local:o,stride:a,interval:l});C.useEffect(()=>{const w=(h==null?void 0:h.current)||m.current.children.find(T=>T instanceof _n);w&&g(w)},[A,h]);const E=C.useMemo(()=>new Wfe,[]),x=C.useMemo(()=>{var w;const T=new qfe({lineWidth:.1*n,color:c,sizeAttenuation:1,resolution:new Ue(f.width,f.height)});let I;if(t)if(Array.isArray(t))I=t.find(M=>{const L=M;return typeof L.type=="string"&&L.type==="meshLineMaterial"});else{const M=t;typeof M.type=="string"&&M.type==="meshLineMaterial"&&(I=M)}return typeof((w=I)==null?void 0:w.props)=="object"&&T.setValues(I.props),T},[n,c,f,t]);return C.useEffect(()=>{x.uniforms.resolution.value.set(f.width,f.height)},[f]),Kt(()=>{A.current&&E.setPoints(A.current,u)}),C.createElement("group",null,vp(C.createElement("mesh",{ref:e,geometry:E,material:x}),d),C.createElement("group",{ref:m},t))});function dQ(i,e=16,t,n,r){const[s,o]=C.useState(()=>{const a=Array.from({length:e},()=>[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]).flat();return new Su(Float32Array.from(a),16)});return C.useLayoutEffect(()=>{if(typeof i.current>"u")return;const a=new Ole(i.current);n&&a.setWeightAttribute(n),a.build();const l=new Q,c=new Q,u=new ut,h=new _n;i.current.updateMatrixWorld(!0);for(let f=0;f<e;f++)a.sample(l,c,u),typeof t=="function"?t({dummy:h,sampledMesh:i.current,position:l,normal:c,color:u},f):h.position.copy(l),h.updateMatrix(),r!=null&&r.current&&r.current.setMatrixAt(f,h.matrix),h.matrix.toArray(s.array,f*16);r!=null&&r.current&&(r.current.instanceMatrix.needsUpdate=!0),s.needsUpdate=!0,o(new Su(s.array,s.itemSize).copy(s))},[i,r,n,e,t]),s}function ede({children:i,weight:e,transform:t,instances:n,mesh:r,count:s=16,...o}){const a=C.useRef(null),l=C.useRef(null),c=C.useRef(null);return C.useLayoutEffect(()=>{var u,h;l.current=(u=n==null?void 0:n.current)!==null&&u!==void 0?u:a.current.children.find(f=>f.hasOwnProperty("instanceMatrix")),c.current=(h=r==null?void 0:r.current)!==null&&h!==void 0?h:a.current.children.find(f=>f.type==="Mesh")},[i,r==null?void 0:r.current,n==null?void 0:n.current]),dQ(c,s,t,e,l),C.createElement("group",ot({ref:a},o),i)}const tde=({compute:i,name:e,...t})=>{const[n]=C.useState(()=>new mn(new Float32Array(0),1)),r=C.useRef(null);return C.useLayoutEffect(()=>{if(r.current){var s;const o=(s=r.current.parent)!==null&&s!==void 0?s:r.current.__r3f.parent,a=i(o);r.current.copy(a)}},[i]),C.createElement("primitive",ot({ref:r,object:n,attach:`attributes-${e}`},t))};function nde(i,{keys:e=["near","far","color","distance","decay","penumbra","angle","intensity","skeleton","visible","castShadow","receiveShadow","morphTargetDictionary","morphTargetInfluences","name","geometry","material","position","rotation","scale","up","userData","bindMode","bindMatrix","bindMatrixInverse","skeleton"],deep:t,inject:n,castShadow:r,receiveShadow:s}){let o={};for(const a of e)o[a]=i[a];return t&&(o.geometry&&t!=="materialsOnly"&&(o.geometry=o.geometry.clone()),o.material&&t!=="geometriesOnly"&&(o.material=o.material.clone())),n&&(typeof n=="function"?o={...o,children:n(i)}:C.isValidElement(n)?o={...o,children:n}:o={...o,...n}),i instanceof It&&(r&&(o.castShadow=!0),s&&(o.receiveShadow=!0)),o}const V2=C.forwardRef(({isChild:i=!1,object:e,children:t,deep:n,castShadow:r,receiveShadow:s,inject:o,keys:a,...l},c)=>{const u={keys:a,deep:n,inject:o,castShadow:r,receiveShadow:s};if(e=C.useMemo(()=>{if(i===!1&&!Array.isArray(e)){let m=!1;if(e.traverse(y=>{y.isSkinnedMesh&&(m=!0)}),m)return Fle.clone(e)}return e},[e,i]),Array.isArray(e))return C.createElement("group",ot({},l,{ref:c}),e.map(m=>C.createElement(V2,ot({key:m.uuid,object:m},u))),t);const{children:h,...f}=nde(e,u),d=e.type[0].toLowerCase()+e.type.slice(1);return C.createElement(d,ot({},f,l,{ref:c}),e.children.map(m=>m.type==="Bone"?C.createElement("primitive",ot({key:m.uuid,object:m},u)):C.createElement(V2,ot({key:m.uuid,object:m},u,{isChild:!0}))),t,h)}),kR=C.createContext(null),ide=C.forwardRef(({resolution:i=28,maxPolyCount:e=1e4,enableUvs:t=!1,enableColors:n=!1,children:r,...s},o)=>{const a=C.useRef(null);C.useImperativeHandle(o,()=>a.current,[]);const l=C.useMemo(()=>new wle(i,null,t,n,e),[i,e,t,n]),c=C.useMemo(()=>({getParent:()=>a}),[]);return Kt(()=>{l.update(),l.reset()},-1),C.createElement(C.Fragment,null,C.createElement("primitive",ot({object:l,ref:a},s),C.createElement(kR.Provider,{value:c},r)))}),rde=C.forwardRef(({strength:i=.5,subtract:e=12,color:t,...n},r)=>{const{getParent:s}=C.useContext(kR),o=C.useMemo(()=>s(),[s]),a=C.useRef(null);C.useImperativeHandle(r,()=>a.current,[]);const l=new Q;return Kt(c=>{!o.current||!a.current||(a.current.getWorldPosition(l),o.current.addBall(.5+l.x*.5,.5+l.y*.5,.5+l.z*.5,i,e,t))}),C.createElement("group",ot({ref:a},n))}),sde=C.forwardRef(({planeType:i="x",strength:e=.5,subtract:t=12,...n},r)=>{const{getParent:s}=C.useContext(kR),o=C.useMemo(()=>s(),[s]),a=C.useRef(null);C.useImperativeHandle(r,()=>a.current,[]);const l=C.useMemo(()=>i==="x"?"addPlaneX":i==="y"?"addPlaneY":"addPlaneZ",[i]);return Kt(()=>{!o.current||!a.current||o.current[l](e,t)}),C.createElement("group",ot({ref:a},n))});function ode(i){return Array.isArray(i)}function Eb(i=[0,0,0]){return ode(i)?i:i instanceof Q||i instanceof Eo?[i.x,i.y,i.z]:[i,i,i]}const ade=C.forwardRef(function({debug:e,depthTest:t=!1,polygonOffsetFactor:n=-10,map:r,mesh:s,children:o,position:a,rotation:l,scale:c,...u},h){const f=C.useRef(null);C.useImperativeHandle(h,()=>f.current);const d=C.useRef(null),m=C.useRef({position:new Q,rotation:new Eo,scale:new Q(1,1,1)});return C.useLayoutEffect(()=>{const y=(s==null?void 0:s.current)||f.current.parent,g=f.current;if(!(y instanceof It))throw new Error('Decal must have a Mesh as parent or specify its "mesh" prop');if(y){Os(m.current,{position:a,scale:c});const A=y.matrixWorld.clone();if(y.matrixWorld.identity(),!l||typeof l=="number"){const E=new _n;E.position.copy(m.current.position);const x=y.geometry.attributes.position.array;y.geometry.attributes.normal===void 0&&y.geometry.computeVertexNormals();const w=y.geometry.attributes.normal.array;let T=1/0;new Q;let I=new Q;const M=E.position.x,L=E.position.y,P=E.position.z,R=x.length;let U=-1;for(let k=0;k<R;k+=3){const H=x[k],G=x[k+1],X=x[k+2],Z=H-M,oe=G-L,K=X-P,V=Z*Z+oe*oe+K*K;V<T&&(T=V,U=k)}I.fromArray(w,U),E.lookAt(E.position.clone().add(I)),E.rotateZ(Math.PI),E.rotateY(Math.PI),typeof l=="number"&&E.rotateZ(l),Os(m.current,{rotation:E.rotation})}else Os(m.current,{rotation:l});return g.geometry=new hue(y,m.current.position,m.current.rotation,m.current.scale),y.matrixWorld=A,()=>{g.geometry.dispose()}}},[s,...Eb(a),...Eb(c),...Eb(l)]),C.useLayoutEffect(()=>{d.current&&(Os(d.current,m.current),d.current.traverse(y=>y.raycast=()=>null))},[e]),C.createElement("mesh",ot({ref:f,"material-transparent":!0,"material-polygonOffset":!0,"material-polygonOffsetFactor":n,"material-depthTest":t,"material-map":r},u),o,e&&C.createElement("mesh",{ref:d},C.createElement("boxGeometry",null),C.createElement("meshNormalMaterial",{wireframe:!0}),C.createElement("axesHelper",null)))}),lde=C.forwardRef(function({src:e,skipFill:t,skipStrokes:n,fillMaterial:r,strokeMaterial:s,fillMeshProps:o,strokeMeshProps:a,...l},c){const u=cr(ub,e.startsWith("<svg")?`data:image/svg+xml;utf8,${e}`:e),h=C.useMemo(()=>n?[]:u.paths.map(d=>{var m;return((m=d.userData)==null?void 0:m.style.stroke)===void 0||d.userData.style.stroke==="none"?null:d.subPaths.map(y=>ub.pointsToStroke(y.getPoints(),d.userData.style))}),[u,n]);C.useEffect(()=>()=>h.forEach(d=>d&&d.map(m=>m.dispose())),[h]);let f=0;return C.createElement("object3D",ot({ref:c},l),C.createElement("object3D",{scale:[1,-1,1]},u.paths.map((d,m)=>{var y,g;return C.createElement(C.Fragment,{key:m},!t&&((y=d.userData)==null?void 0:y.style.fill)!==void 0&&d.userData.style.fill!=="none"&&ub.createShapes(d).map((A,E)=>C.createElement("mesh",ot({key:E},o,{renderOrder:f++}),C.createElement("shapeGeometry",{args:[A]}),C.createElement("meshBasicMaterial",ot({color:d.userData.style.fill,opacity:d.userData.style.fillOpacity,transparent:!0,side:Li,depthWrite:!1},r)))),!n&&((g=d.userData)==null?void 0:g.style.stroke)!==void 0&&d.userData.style.stroke!=="none"&&d.subPaths.map((A,E)=>C.createElement("mesh",ot({key:E,geometry:h[m][E]},a,{renderOrder:f++}),C.createElement("meshBasicMaterial",ot({color:d.userData.style.stroke,opacity:d.userData.style.strokeOpacity,transparent:!0,side:Li,depthWrite:!1},s)))))})))});let QE=null,pQ="https://www.gstatic.com/draco/versioned/decoders/1.5.5/";function mQ(i=!0,e=!0,t){return n=>{t&&t(n),i&&(QE||(QE=new phe),QE.setDecoderPath(typeof i=="string"?i:pQ),n.setDRACOLoader(QE)),e&&n.setMeshoptDecoder(typeof mb=="function"?mb():mb)}}const Tx=(i,e,t,n)=>cr(RR,i,mQ(e,t,n));Tx.preload=(i,e,t,n)=>cr.preload(RR,i,mQ(e,t,n));Tx.clear=i=>cr.clear(RR,i);Tx.setDecoderPath=i=>{pQ=i};const cde=C.forwardRef(({src:i,useDraco:e,useMeshOpt:t,extendLoader:n,...r},s)=>{const{scene:o}=Tx(i,e,t,n);return C.createElement(V2,ot({ref:s},r,{object:o}))});function ude({renderIndex:i=1,bgColor:e="black",fgColor:t="white",characters:n=" .:-+*=%@#",invert:r=!0,color:s=!1,resolution:o=.15}){const{size:a,gl:l,scene:c,camera:u}=Ve(),h=C.useMemo(()=>{const f=new Aue(l,n,{invert:r,color:s,resolution:o});return f.domElement.style.position="absolute",f.domElement.style.top="0px",f.domElement.style.left="0px",f.domElement.style.pointerEvents="none",f},[n,r,s,o]);return C.useLayoutEffect(()=>{h.domElement.style.color=t,h.domElement.style.backgroundColor=e},[t,e]),C.useEffect(()=>(l.domElement.style.opacity="0",l.domElement.parentNode.appendChild(h.domElement),()=>{l.domElement.style.opacity="1",l.domElement.parentNode.removeChild(h.domElement)}),[h]),C.useEffect(()=>{h.setSize(a.width,a.height)},[h,a]),Kt(f=>{h.render(c,u)},i),C.createElement(C.Fragment,null)}const A7=Ec({alphaTest:0,viewport:new Ue(1980,1080),focal:1e3,centerAndScaleTexture:null,covAndColorTexture:null},`
    precision highp sampler2D;
    precision highp usampler2D;
    out vec4 vColor;
    out vec3 vPosition;
    uniform vec2 resolution;
    uniform vec2 viewport;
    uniform float focal;
    attribute uint splatIndex;
    uniform sampler2D centerAndScaleTexture;
    uniform usampler2D covAndColorTexture;    

    vec2 unpackInt16(in uint value) {
      int v = int(value);
      int v0 = v >> 16;
      int v1 = (v & 0xFFFF);
      if((v & 0x8000) != 0)
        v1 |= 0xFFFF0000;
      return vec2(float(v1), float(v0));
    }

    void main () {
      ivec2 texSize = textureSize(centerAndScaleTexture, 0);
      ivec2 texPos = ivec2(splatIndex%uint(texSize.x), splatIndex/uint(texSize.x));
      vec4 centerAndScaleData = texelFetch(centerAndScaleTexture, texPos, 0);
      vec4 center = vec4(centerAndScaleData.xyz, 1);
      vec4 camspace = modelViewMatrix * center;
      vec4 pos2d = projectionMatrix * camspace;

      float bounds = 1.2 * pos2d.w;
      if (pos2d.z < -pos2d.w || pos2d.x < -bounds || pos2d.x > bounds
        || pos2d.y < -bounds || pos2d.y > bounds) {
        gl_Position = vec4(0.0, 0.0, 2.0, 1.0);
        return;
      }

      uvec4 covAndColorData = texelFetch(covAndColorTexture, texPos, 0);
      vec2 cov3D_M11_M12 = unpackInt16(covAndColorData.x) * centerAndScaleData.w;
      vec2 cov3D_M13_M22 = unpackInt16(covAndColorData.y) * centerAndScaleData.w;
      vec2 cov3D_M23_M33 = unpackInt16(covAndColorData.z) * centerAndScaleData.w;
      mat3 Vrk = mat3(
        cov3D_M11_M12.x, cov3D_M11_M12.y, cov3D_M13_M22.x,
        cov3D_M11_M12.y, cov3D_M13_M22.y, cov3D_M23_M33.x,
        cov3D_M13_M22.x, cov3D_M23_M33.x, cov3D_M23_M33.y
      );

      mat3 J = mat3(
        focal / camspace.z, 0., -(focal * camspace.x) / (camspace.z * camspace.z),
        0., focal / camspace.z, -(focal * camspace.y) / (camspace.z * camspace.z),
        0., 0., 0.
      );

      mat3 W = transpose(mat3(modelViewMatrix));
      mat3 T = W * J;
      mat3 cov = transpose(T) * Vrk * T;
      vec2 vCenter = vec2(pos2d) / pos2d.w;
      float diagonal1 = cov[0][0] + 0.3;
      float offDiagonal = cov[0][1];
      float diagonal2 = cov[1][1] + 0.3;
      float mid = 0.5 * (diagonal1 + diagonal2);
      float radius = length(vec2((diagonal1 - diagonal2) / 2.0, offDiagonal));
      float lambda1 = mid + radius;
      float lambda2 = max(mid - radius, 0.1);
      vec2 diagonalVector = normalize(vec2(offDiagonal, lambda1 - diagonal1));
      vec2 v1 = min(sqrt(2.0 * lambda1), 1024.0) * diagonalVector;
      vec2 v2 = min(sqrt(2.0 * lambda2), 1024.0) * vec2(diagonalVector.y, -diagonalVector.x);
      uint colorUint = covAndColorData.w;
      vColor = vec4(
        float(colorUint & uint(0xFF)) / 255.0,
        float((colorUint >> uint(8)) & uint(0xFF)) / 255.0,
        float((colorUint >> uint(16)) & uint(0xFF)) / 255.0,
        float(colorUint >> uint(24)) / 255.0
      );
      vPosition = position;

      gl_Position = vec4(
        vCenter 
          + position.x * v2 / viewport * 2.0 
          + position.y * v1 / viewport * 2.0, pos2d.z / pos2d.w, 1.0);
    }
    `,`
    #include <alphatest_pars_fragment>
    #include <alphahash_pars_fragment>
    in vec4 vColor;
    in vec3 vPosition;
    void main () {
      float A = -dot(vPosition.xy, vPosition.xy);
      if (A < -4.0) discard;
      float B = exp(A) * vColor.a;
      vec4 diffuseColor = vec4(vColor.rgb, B);
      #include <alphatest_fragment>
      #include <alphahash_fragment>
      gl_FragColor = diffuseColor;
      #include <tonemapping_fragment>
      #include <${ea>=154?"colorspace_fragment":"encodings_fragment"}>
    }
  `);function hde(i){let e=null,t=0;function n(r,s=!1){const o=e.length/16,a=-1e-4;let l=-1/0,c=1/0;const u=new Float32Array(o),h=new Int32Array(u.buffer),f=new Int32Array(o);let d=0;for(let E=0;E<o;E++){const x=r[0]*e[E*16+12]+r[1]*e[E*16+13]+r[2]*e[E*16+14]+r[3];(s||x<0&&e[E*16+15]>a*x)&&(u[d]=x,f[d]=E,d++,x>l&&(l=x),x<c&&(c=x))}const m=(256*256-1)/(l-c),y=new Uint32Array(256*256);for(let E=0;E<d;E++)h[E]=(u[E]-c)*m|0,y[h[E]]++;const g=new Uint32Array(256*256);for(let E=1;E<256*256;E++)g[E]=g[E-1]+y[E-1];const A=new Uint32Array(d);for(let E=0;E<d;E++)A[g[h[E]]++]=f[E];return A}i.onmessage=r=>{if(r.data.method=="push"){t===0&&(e=new Float32Array(r.data.length));const s=new Float32Array(r.data.matrices);e.set(s,t),t+=s.length}else if(r.data.method=="sort"&&e!==null){const s=n(new Float32Array(r.data.view),r.data.hashed);i.postMessage({indices:s,key:r.data.key},[s.buffer])}}}class fde extends os{constructor(...e){super(...e),this.gl=null,this.chunkSize=25e3}load(e,t,n,r){const s={gl:this.gl,url:this.manager.resolveURL(e),worker:new Worker(URL.createObjectURL(new Blob(["(",hde.toString(),")(self)"],{type:"application/javascript"}))),manager:this.manager,update:(o,a,l)=>mde(a,s,o,l),connect:o=>gde(s,o),loading:!1,loaded:!1,loadedVertexCount:0,chunkSize:this.chunkSize,totalDownloadBytes:0,numVertices:0,rowLength:32,maxVertexes:0,bufferTextureWidth:0,bufferTextureHeight:0,stream:null,centerAndScaleData:null,covAndColorData:null,covAndColorTexture:null,centerAndScaleTexture:null,onProgress:n};dde(s).then(t).catch(o=>{r==null||r(o),s.manager.itemError(s.url)})}}async function dde(i){i.manager.itemStart(i.url);const e=await fetch(i.url);if(e.body===null)throw"Failed to fetch file";let t=e.headers.get("Content-Length");const n=t?parseInt(t):void 0;if(n==null)throw"Failed to get content length";i.stream=e.body.getReader(),i.totalDownloadBytes=n,i.numVertices=Math.floor(i.totalDownloadBytes/i.rowLength);const r=i.gl.getContext();let s=r.getParameter(r.MAX_TEXTURE_SIZE);return i.maxVertexes=s*s,i.numVertices>i.maxVertexes&&(i.numVertices=i.maxVertexes),i.bufferTextureWidth=s,i.bufferTextureHeight=Math.floor((i.numVertices-1)/s)+1,i.centerAndScaleData=new Float32Array(i.bufferTextureWidth*i.bufferTextureHeight*4),i.covAndColorData=new Uint32Array(i.bufferTextureWidth*i.bufferTextureHeight*4),i.centerAndScaleTexture=new Sa(i.centerAndScaleData,i.bufferTextureWidth,i.bufferTextureHeight,gi,fi),i.centerAndScaleTexture.needsUpdate=!0,i.covAndColorTexture=new Sa(i.covAndColorData,i.bufferTextureWidth,i.bufferTextureHeight,Jm,Zo),i.covAndColorTexture.internalFormat="RGBA32UI",i.covAndColorTexture.needsUpdate=!0,i}async function pde(i){i.loading=!0;let e=0,t=0;const n=[];let r=0;const s=i.totalDownloadBytes!==0;for(;;)try{const{value:o,done:a}=await i.stream.read();if(a)break;if(e+=o.length,i.totalDownloadBytes!=null){const c=e/i.totalDownloadBytes*100;if(i.onProgress&&c-r>1){const u=new ProgressEvent("progress",{lengthComputable:s,loaded:e,total:i.totalDownloadBytes});i.onProgress(u),r=c}}n.push(o);const l=e-t;if(i.totalDownloadBytes!=null&&l>i.rowLength*i.chunkSize){let c=Math.floor(l/i.rowLength);const u=new Uint8Array(l);let h=0;for(const m of n)u.set(m,h),h+=m.length;if(n.length=0,l>c*i.rowLength){const m=new Uint8Array(l-c*i.rowLength);m.set(u.subarray(l-m.length,l),0),n.push(m)}const f=new Uint8Array(c*i.rowLength);f.set(u.subarray(0,f.byteLength),0);const d=y7(i,f.buffer,c);if(i.worker.postMessage({method:"push",src:i.url,length:i.numVertices*16,matrices:d.buffer},[d.buffer]),t+=c*i.rowLength,i.onProgress){const m=new ProgressEvent("progress",{lengthComputable:s,loaded:i.totalDownloadBytes,total:i.totalDownloadBytes});i.onProgress(m)}}}catch(o){console.error(o);break}if(e-t>0){let o=new Uint8Array(n.reduce((u,h)=>u+h.length,0)),a=0;for(const u of n)o.set(u,a),a+=u.length;let l=Math.floor(o.byteLength/i.rowLength);const c=y7(i,o.buffer,l);i.worker.postMessage({method:"push",src:i.url,length:l*16,matrices:c.buffer},[c.buffer])}i.loaded=!0,i.manager.itemEnd(i.url)}function mde(i,e,t,n){if(i.updateMatrixWorld(),e.gl.getCurrentViewport(t.viewport),t.material.viewport.x=t.viewport.z,t.material.viewport.y=t.viewport.w,t.material.focal=t.viewport.w/2*Math.abs(i.projectionMatrix.elements[5]),t.ready){if(n&&t.sorted)return;t.ready=!1;const r=new Float32Array([t.modelViewMatrix.elements[2],-t.modelViewMatrix.elements[6],t.modelViewMatrix.elements[10],t.modelViewMatrix.elements[14]]);e.worker.postMessage({method:"sort",src:e.url,key:t.uuid,view:r.buffer,hashed:n},[r.buffer]),n&&e.loaded&&(t.sorted=!0)}}function gde(i,e){i.loading||pde(i),e.ready=!1,e.pm=new Xe,e.vm1=new Xe,e.vm2=new Xe,e.viewport=new Rn;let t=new Uint32Array(i.bufferTextureWidth*i.bufferTextureHeight);const n=new Su(t,1,!1);n.setUsage(No);const r=e.geometry=new gx,s=new Float32Array(18),o=new mn(s,3);r.setAttribute("position",o),o.setXYZ(2,-2,2,0),o.setXYZ(1,2,2,0),o.setXYZ(0,-2,-2,0),o.setXYZ(5,-2,-2,0),o.setXYZ(4,2,2,0),o.setXYZ(3,2,-2,0),o.needsUpdate=!0,r.setAttribute("splatIndex",n),r.instanceCount=1;function a(c){if(e&&c.data.key===e.uuid){let u=new Uint32Array(c.data.indices);r.attributes.splatIndex.set(u),r.attributes.splatIndex.needsUpdate=!0,r.instanceCount=u.length,e.ready=!0}}i.worker.addEventListener("message",a);async function l(){for(;;){const c=i.gl.properties.get(i.centerAndScaleTexture),u=i.gl.properties.get(i.covAndColorTexture);if(c!=null&&c.__webglTexture&&u!=null&&u.__webglTexture&&i.loadedVertexCount>0)break;await new Promise(h=>setTimeout(h,10))}e.ready=!0}return l(),()=>i.worker.removeEventListener("message",a)}function y7(i,e,t){const n=i.gl.getContext();if(i.loadedVertexCount+t>i.maxVertexes&&(t=i.maxVertexes-i.loadedVertexCount),t<=0)throw"Failed to parse file";const r=new Uint8Array(e),s=new Float32Array(e),o=new Float32Array(t*16),a=new Uint8Array(i.covAndColorData.buffer),l=new Int16Array(i.covAndColorData.buffer);for(let c=0;c<t;c++){const u=new Xt(-(r[32*c+28+1]-128)/128,(r[32*c+28+2]-128)/128,(r[32*c+28+3]-128)/128,-(r[32*c+28+0]-128)/128);u.invert();const h=new Q(s[8*c+0],s[8*c+1],-s[8*c+2]),f=new Q(s[8*c+3+0],s[8*c+3+1],s[8*c+3+2]),d=new Xe;d.makeRotationFromQuaternion(u),d.transpose(),d.scale(f);const m=d.clone();d.transpose(),d.premultiply(m),d.setPosition(h);const y=[0,1,2,5,6,10];let g=0;for(let x=0;x<y.length;x++)Math.abs(d.elements[y[x]])>g&&(g=Math.abs(d.elements[y[x]]));let A=i.loadedVertexCount*4+c*4;i.centerAndScaleData[A+0]=h.x,i.centerAndScaleData[A+1]=-h.y,i.centerAndScaleData[A+2]=h.z,i.centerAndScaleData[A+3]=g/32767,A=i.loadedVertexCount*8+c*4*2;for(let x=0;x<y.length;x++)l[A+x]=d.elements[y[x]]*32767/g;A=i.loadedVertexCount*16+(c*4+3)*4;const E=new ut(r[32*c+24+0]/255,r[32*c+24+1]/255,r[32*c+24+2]/255);E.convertSRGBToLinear(),a[A+0]=E.r*255,a[A+1]=E.g*255,a[A+2]=E.b*255,a[A+3]=r[32*c+24+3],d.elements[15]=Math.max(f.x,f.y,f.z)*r[32*c+24+3]/255;for(let x=0;x<16;x++)o[c*16+x]=d.elements[x]}for(;t>0;){let c=0,u=0;const h=i.loadedVertexCount%i.bufferTextureWidth,f=Math.floor(i.loadedVertexCount/i.bufferTextureWidth);i.loadedVertexCount%i.bufferTextureWidth!=0?(c=Math.min(i.bufferTextureWidth,h+t)-h,u=1):Math.floor(t/i.bufferTextureWidth)>0?(c=i.bufferTextureWidth,u=Math.floor(t/i.bufferTextureWidth)):(c=t%i.bufferTextureWidth,u=1);const d=i.gl.properties.get(i.centerAndScaleTexture);n.bindTexture(n.TEXTURE_2D,d.__webglTexture),n.texSubImage2D(n.TEXTURE_2D,0,h,f,c,u,n.RGBA,n.FLOAT,i.centerAndScaleData,i.loadedVertexCount*4);const m=i.gl.properties.get(i.covAndColorTexture);n.bindTexture(n.TEXTURE_2D,m.__webglTexture),n.texSubImage2D(n.TEXTURE_2D,0,h,f,c,u,n.RGBA_INTEGER,n.UNSIGNED_INT,i.covAndColorData,i.loadedVertexCount*4),i.gl.resetState(),i.loadedVertexCount+=c*u,t-=c*u}return o}function Ade({src:i,toneMapped:e=!1,alphaTest:t=0,alphaHash:n=!1,chunkSize:r=25e3,...s}){Or({SplatMaterial:A7});const o=C.useRef(null),a=Ve(u=>u.gl),l=Ve(u=>u.camera),c=cr(fde,i,u=>{u.gl=a,u.chunkSize=r});return C.useLayoutEffect(()=>c.connect(o.current),[i]),Kt(()=>c.update(o.current,l,n)),C.createElement("mesh",ot({ref:o,frustumCulled:!1},s),C.createElement("splatMaterial",{key:`${i}/${t}/${n}${A7.key}`,transparent:!n,depthTest:!0,alphaTest:n?0:t,centerAndScaleTexture:c.centerAndScaleTexture,covAndColorTexture:c.covAndColorTexture,depthWrite:n?!0:t>0,blending:n?Kd:Aw,blendSrcAlpha:yw,alphaHash:!!n,toneMapped:e}))}function Ea(i,e,t){const n=Ve(f=>f.size),r=Ve(f=>f.viewport),s=typeof i=="number"?i:n.width*r.dpr,o=typeof e=="number"?e:n.height*r.dpr,a=(typeof i=="number"?t:i)||{},{samples:l=0,depth:c,...u}=a,h=C.useMemo(()=>{const f=new Si(s,o,{minFilter:Ln,magFilter:Ln,type:Ni,...u});return c&&(f.depthTexture=new d0(s,o,fi)),f.samples=l,f},[]);return C.useLayoutEffect(()=>{h.setSize(s,o),l&&(h.samples=l)},[l,h,s,o]),C.useEffect(()=>()=>h.dispose(),[]),h}const yde=({children:i,width:e,height:t,...n})=>{const r=Ea(e,t,n);return C.createElement(C.Fragment,null,i==null?void 0:i(r))},vde=i=>typeof i=="function",gQ=C.forwardRef(({envMap:i,resolution:e=256,frames:t=1/0,children:n,makeDefault:r,...s},o)=>{const a=Ve(({set:g})=>g),l=Ve(({camera:g})=>g),c=Ve(({size:g})=>g),u=C.useRef(null);C.useImperativeHandle(o,()=>u.current,[]);const h=C.useRef(null),f=Ea(e);C.useLayoutEffect(()=>{s.manual||u.current.updateProjectionMatrix()},[c,s]),C.useLayoutEffect(()=>{u.current.updateProjectionMatrix()}),C.useLayoutEffect(()=>{if(r){const g=l;return a(()=>({camera:u.current})),()=>a(()=>({camera:g}))}},[u,r,a]);let d=0,m=null;const y=vde(n);return Kt(g=>{y&&(t===1/0||d<t)&&(h.current.visible=!1,g.gl.setRenderTarget(f),m=g.scene.background,i&&(g.scene.background=i),g.gl.render(g.scene,u.current),g.scene.background=m,g.gl.setRenderTarget(null),h.current.visible=!0,d++)}),C.createElement(C.Fragment,null,C.createElement("orthographicCamera",ot({left:c.width/-2,right:c.width/2,top:c.height/2,bottom:c.height/-2,ref:u},s),!y&&n),C.createElement("group",{ref:h},y&&n(f.texture)))}),xde=i=>typeof i=="function",Ede=C.forwardRef(({envMap:i,resolution:e=256,frames:t=1/0,makeDefault:n,children:r,...s},o)=>{const a=Ve(({set:g})=>g),l=Ve(({camera:g})=>g),c=Ve(({size:g})=>g),u=C.useRef(null);C.useImperativeHandle(o,()=>u.current,[]);const h=C.useRef(null),f=Ea(e);C.useLayoutEffect(()=>{s.manual||(u.current.aspect=c.width/c.height)},[c,s]),C.useLayoutEffect(()=>{u.current.updateProjectionMatrix()});let d=0,m=null;const y=xde(r);return Kt(g=>{y&&(t===1/0||d<t)&&(h.current.visible=!1,g.gl.setRenderTarget(f),m=g.scene.background,i&&(g.scene.background=i),g.gl.render(g.scene,u.current),g.scene.background=m,g.gl.setRenderTarget(null),h.current.visible=!0,d++)}),C.useLayoutEffect(()=>{if(n){const g=l;return a(()=>({camera:u.current})),()=>a(()=>({camera:g}))}},[u,n,a]),C.createElement(C.Fragment,null,C.createElement("perspectiveCamera",ot({ref:u},s),!y&&r),C.createElement("group",{ref:h},y&&r(f.texture)))});function AQ({resolution:i=256,near:e=.1,far:t=1e3,envMap:n,fog:r}={}){const s=Ve(({gl:f})=>f),o=Ve(({scene:f})=>f),a=C.useMemo(()=>{const f=new wA(i);return f.texture.type=Ni,f},[i]);C.useEffect(()=>()=>{a.dispose()},[a]);const l=C.useMemo(()=>new Iw(e,t,a),[e,t,a]);let c,u;const h=C.useCallback(()=>{c=o.fog,u=o.background,o.background=n||u,o.fog=r||c,l.update(s,o),o.fog=c,o.background=u},[s,o,l]);return{fbo:a,camera:l,update:h}}function _de({children:i,frames:e=1/0,resolution:t,near:n,far:r,envMap:s,fog:o,...a}){const l=C.useRef(null),{fbo:c,camera:u,update:h}=AQ({resolution:t,near:n,far:r,envMap:s,fog:o});let f=0;return Kt(()=>{l.current&&(e===1/0||f<e)&&(l.current.visible=!1,h(),l.current.visible=!0,f++)}),C.createElement("group",a,C.createElement("primitive",{object:u}),C.createElement("group",{ref:l},i==null?void 0:i(c.texture)))}const Sde=C.forwardRef((i,e)=>{const{camera:t,onChange:n,makeDefault:r,...s}=i,o=Ve(f=>f.camera),a=Ve(f=>f.invalidate),l=Ve(f=>f.get),c=Ve(f=>f.set),u=t||o,h=C.useMemo(()=>new ice(u),[u]);return C.useEffect(()=>{const f=d=>{a(),n&&n(d)};return h==null||h.addEventListener==null||h.addEventListener("change",f),()=>h==null||h.removeEventListener==null?void 0:h.removeEventListener("change",f)},[n,h,a]),Kt(()=>h==null?void 0:h.update(),-1),C.useEffect(()=>{const f=h;return f==null||f.connect(),()=>f==null?void 0:f.dispose()},[h]),C.useEffect(()=>{if(r){const f=l().controls;return c({controls:h}),()=>c({controls:f})}},[r,h]),h?C.createElement("primitive",ot({ref:e,object:h},s)):null}),wde=C.forwardRef(({domElement:i,...e},t)=>{const{onChange:n,makeDefault:r,...s}=e,o=Ve(m=>m.invalidate),a=Ve(m=>m.camera),l=Ve(m=>m.gl),c=Ve(m=>m.events),u=Ve(m=>m.get),h=Ve(m=>m.set),f=i||c.connected||l.domElement,d=C.useMemo(()=>new gce(a),[a]);return C.useEffect(()=>(d.connect(f),()=>void d.dispose()),[f,d,o]),C.useEffect(()=>{const m=y=>{o(),n&&n(y)};return d.addEventListener==null||d.addEventListener("change",m),()=>d.removeEventListener==null?void 0:d.removeEventListener("change",m)},[n,o]),C.useEffect(()=>{if(r){const m=u().controls;return h({controls:d}),()=>h({controls:m})}},[r,d]),Kt((m,y)=>d.update(y)),C.createElement("primitive",ot({ref:t,object:d,args:[a,f]},s))}),Cde=C.forwardRef((i={enableDamping:!0},e)=>{const{domElement:t,camera:n,makeDefault:r,onChange:s,onStart:o,onEnd:a,...l}=i,c=Ve(E=>E.invalidate),u=Ve(E=>E.camera),h=Ve(E=>E.gl),f=Ve(E=>E.events),d=Ve(E=>E.set),m=Ve(E=>E.get),y=t||f.connected||h.domElement,g=n||u,A=C.useMemo(()=>new uce(g),[g]);return C.useEffect(()=>{A.connect(y);const E=x=>{c(),s&&s(x)};return A.addEventListener("change",E),o&&A.addEventListener("start",o),a&&A.addEventListener("end",a),()=>{A.dispose(),A.removeEventListener("change",E),o&&A.removeEventListener("start",o),a&&A.removeEventListener("end",a)}},[s,o,a,A,c,y]),C.useEffect(()=>{if(r){const E=m().controls;return d({controls:A}),()=>d({controls:E})}},[r,A]),Kt(()=>A.update(),-1),C.createElement("primitive",ot({ref:e,object:A,enableDamping:!0},l))}),yQ=C.forwardRef(({makeDefault:i,camera:e,regress:t,domElement:n,enableDamping:r=!0,keyEvents:s=!1,onChange:o,onStart:a,onEnd:l,...c},u)=>{const h=Ve(I=>I.invalidate),f=Ve(I=>I.camera),d=Ve(I=>I.gl),m=Ve(I=>I.events),y=Ve(I=>I.setEvents),g=Ve(I=>I.set),A=Ve(I=>I.get),E=Ve(I=>I.performance),x=e||f,w=n||m.connected||d.domElement,T=C.useMemo(()=>new mH(x),[x]);return Kt(()=>{T.enabled&&T.update()},-1),C.useEffect(()=>(s&&T.connect(s===!0?w:s),T.connect(w),()=>void T.dispose()),[s,w,t,T,h]),C.useEffect(()=>{const I=P=>{h(),t&&E.regress(),o&&o(P)},M=P=>{a&&a(P)},L=P=>{l&&l(P)};return T.addEventListener("change",I),T.addEventListener("start",M),T.addEventListener("end",L),()=>{T.removeEventListener("start",M),T.removeEventListener("end",L),T.removeEventListener("change",I)}},[o,a,l,T,h,y]),C.useEffect(()=>{if(i){const I=A().controls;return g({controls:T}),()=>g({controls:I})}},[i,T]),C.createElement("primitive",ot({ref:u,object:T,enableDamping:r},c))}),Tde=C.forwardRef(({makeDefault:i,camera:e,domElement:t,regress:n,onChange:r,onStart:s,onEnd:o,...a},l)=>{const{invalidate:c,camera:u,gl:h,events:f,set:d,get:m,performance:y,viewport:g}=Ve(),A=e||u,E=t||f.connected||h.domElement,x=C.useMemo(()=>new oce(A),[A]);return Kt(()=>{x.enabled&&x.update()},-1),C.useEffect(()=>(x.connect(E),()=>void x.dispose()),[E,n,x,c]),C.useEffect(()=>{const w=T=>{c(),n&&y.regress(),r&&r(T)};return x.addEventListener("change",w),s&&x.addEventListener("start",s),o&&x.addEventListener("end",o),()=>{s&&x.removeEventListener("start",s),o&&x.removeEventListener("end",o),x.removeEventListener("change",w)}},[r,s,o,x,c]),C.useEffect(()=>{x.handleResize()},[g]),C.useEffect(()=>{if(i){const w=m().controls;return d({controls:x}),()=>d({controls:w})}},[i,x]),C.createElement("primitive",ot({ref:l,object:x},a))}),bde=C.forwardRef(({camera:i,makeDefault:e,regress:t,domElement:n,onChange:r,onStart:s,onEnd:o,...a},l)=>{const c=Ve(x=>x.invalidate),u=Ve(x=>x.camera),h=Ve(x=>x.gl),f=Ve(x=>x.events),d=Ve(x=>x.set),m=Ve(x=>x.get),y=Ve(x=>x.performance),g=i||u,A=n||f.connected||h.domElement,E=C.useMemo(()=>new dce(g),[g]);return Kt(()=>{E.enabled&&E.update()},-1),C.useEffect(()=>(E.connect(A),()=>void E.dispose()),[A,t,E,c]),C.useEffect(()=>{const x=w=>{c(),t&&y.regress(),r&&r(w)};return E.addEventListener("change",x),s&&E.addEventListener("start",s),o&&E.addEventListener("end",o),()=>{E.removeEventListener("change",x),s&&E.removeEventListener("start",s),o&&E.removeEventListener("end",o)}},[r,s,o]),C.useEffect(()=>{if(e){const x=m().controls;return d({controls:E}),()=>d({controls:x})}},[e,E]),C.createElement("primitive",ot({ref:l,object:E},a))}),Ide=C.forwardRef(({children:i,domElement:e,onChange:t,onMouseDown:n,onMouseUp:r,onObjectChange:s,object:o,makeDefault:a,camera:l,enabled:c,axis:u,mode:h,translationSnap:f,rotationSnap:d,scaleSnap:m,space:y,size:g,showX:A,showY:E,showZ:x,...w},T)=>{const I=Ve(F=>F.controls),M=Ve(F=>F.gl),L=Ve(F=>F.events),P=Ve(F=>F.camera),R=Ve(F=>F.invalidate),U=Ve(F=>F.get),k=Ve(F=>F.set),H=l||P,G=e||L.connected||M.domElement,X=C.useMemo(()=>new Wle(H,G),[H,G]),Z=C.useRef(null);C.useLayoutEffect(()=>(o?X.attach(o instanceof _n?o:o.current):Z.current instanceof _n&&X.attach(Z.current),()=>void X.detach()),[o,i,X]),C.useEffect(()=>{if(I){const F=Y=>I.enabled=!Y.value;return X.addEventListener("dragging-changed",F),()=>X.removeEventListener("dragging-changed",F)}},[X,I]);const oe=C.useRef(),K=C.useRef(),V=C.useRef(),W=C.useRef();return C.useLayoutEffect(()=>void(oe.current=t),[t]),C.useLayoutEffect(()=>void(K.current=n),[n]),C.useLayoutEffect(()=>void(V.current=r),[r]),C.useLayoutEffect(()=>void(W.current=s),[s]),C.useEffect(()=>{const F=J=>{R(),oe.current==null||oe.current(J)},Y=J=>K.current==null?void 0:K.current(J),te=J=>V.current==null?void 0:V.current(J),q=J=>W.current==null?void 0:W.current(J);return X.addEventListener("change",F),X.addEventListener("mouseDown",Y),X.addEventListener("mouseUp",te),X.addEventListener("objectChange",q),()=>{X.removeEventListener("change",F),X.removeEventListener("mouseDown",Y),X.removeEventListener("mouseUp",te),X.removeEventListener("objectChange",q)}},[R,X]),C.useEffect(()=>{if(a){const F=U().controls;return k({controls:X}),()=>k({controls:F})}},[a,X]),C.createElement(C.Fragment,null,C.createElement("primitive",{ref:T,object:X,enabled:c,axis:u,mode:h,translationSnap:f,rotationSnap:d,scaleSnap:m,space:y,size:g,showX:A,showY:E,showZ:x}),C.createElement("group",ot({ref:Z},w),i))}),Mde=C.forwardRef(({domElement:i,selector:e,onChange:t,onLock:n,onUnlock:r,enabled:s=!0,makeDefault:o,...a},l)=>{const{camera:c,...u}=a,h=Ve(T=>T.setEvents),f=Ve(T=>T.gl),d=Ve(T=>T.camera),m=Ve(T=>T.invalidate),y=Ve(T=>T.events),g=Ve(T=>T.get),A=Ve(T=>T.set),E=c||d,x=i||y.connected||f.domElement,w=C.useMemo(()=>new ece(E),[E]);return C.useEffect(()=>{if(s){w.connect(x);const T=g().events.compute;return h({compute(I,M){const L=M.size.width/2,P=M.size.height/2;M.pointer.set(L/M.size.width*2-1,-(P/M.size.height)*2+1),M.raycaster.setFromCamera(M.pointer,M.camera)}}),()=>{w.disconnect(),h({compute:T})}}},[s,w]),C.useEffect(()=>{const T=L=>{m(),t&&t(L)};w.addEventListener("change",T),n&&w.addEventListener("lock",n),r&&w.addEventListener("unlock",r);const I=()=>w.lock(),M=e?Array.from(document.querySelectorAll(e)):[document];return M.forEach(L=>L&&L.addEventListener("click",I)),()=>{w.removeEventListener("change",T),n&&w.removeEventListener("lock",n),r&&w.removeEventListener("unlock",r),M.forEach(L=>L?L.removeEventListener("click",I):void 0)}},[t,n,r,e,w,m]),C.useEffect(()=>{if(o){const T=g().controls;return A({controls:w}),()=>A({controls:T})}},[o,w]),C.createElement("primitive",ot({ref:l,object:w},u))}),Rde=C.forwardRef(({domElement:i,makeDefault:e,...t},n)=>{const r=Ve(h=>h.camera),s=Ve(h=>h.gl),o=Ve(h=>h.events),a=Ve(h=>h.get),l=Ve(h=>h.set),c=i||o.connected||s.domElement,[u]=C.useState(()=>new Qle(r,c));return C.useEffect(()=>{if(e){const h=a().controls;return l({controls:u}),()=>l({controls:h})}},[e,u]),Kt((h,f)=>{u.update(f)},-1),u?C.createElement("primitive",ot({ref:n,object:u},t)):null});/*!
 * camera-controls
 * https://github.com/yomotsu/camera-controls
 * (c) 2017 @yomotsu
 * Released under the MIT License.
 */const Hr={LEFT:1,RIGHT:2,MIDDLE:4},nt=Object.freeze({NONE:0,ROTATE:1,TRUCK:2,SCREEN_PAN:4,OFFSET:8,DOLLY:16,ZOOM:32,TOUCH_ROTATE:64,TOUCH_TRUCK:128,TOUCH_SCREEN_PAN:256,TOUCH_OFFSET:512,TOUCH_DOLLY:1024,TOUCH_ZOOM:2048,TOUCH_DOLLY_TRUCK:4096,TOUCH_DOLLY_SCREEN_PAN:8192,TOUCH_DOLLY_OFFSET:16384,TOUCH_DOLLY_ROTATE:32768,TOUCH_ZOOM_TRUCK:65536,TOUCH_ZOOM_OFFSET:131072,TOUCH_ZOOM_SCREEN_PAN:262144,TOUCH_ZOOM_ROTATE:524288}),Qg={NONE:0,IN:1,OUT:-1};function Am(i){return i.isPerspectiveCamera}function Dd(i){return i.isOrthographicCamera}const Vg=Math.PI*2,v7=Math.PI/2,vQ=1e-5,dv=Math.PI/180;function au(i,e,t){return Math.max(e,Math.min(t,i))}function pr(i,e=vQ){return Math.abs(i)<e}function Fi(i,e,t=vQ){return pr(i-e,t)}function x7(i,e){return Math.round(i/e)*e}function pv(i){return isFinite(i)?i:i<0?-Number.MAX_VALUE:Number.MAX_VALUE}function mv(i){return Math.abs(i)<Number.MAX_VALUE?i:i*(1/0)}function VE(i,e,t,n,r=1/0,s){n=Math.max(1e-4,n);const o=2/n,a=o*s,l=1/(1+a+.48*a*a+.235*a*a*a);let c=i-e;const u=e,h=r*n;c=au(c,-h,h),e=i-c;const f=(t.value+o*c)*s;t.value=(t.value-o*f)*l;let d=e+(c+f)*l;return u-i>0==d>u&&(d=u,t.value=(d-u)/s),d}function E7(i,e,t,n,r=1/0,s,o){n=Math.max(1e-4,n);const a=2/n,l=a*s,c=1/(1+l+.48*l*l+.235*l*l*l);let u=e.x,h=e.y,f=e.z,d=i.x-u,m=i.y-h,y=i.z-f;const g=u,A=h,E=f,x=r*n,w=x*x,T=d*d+m*m+y*y;if(T>w){const X=Math.sqrt(T);d=d/X*x,m=m/X*x,y=y/X*x}u=i.x-d,h=i.y-m,f=i.z-y;const I=(t.x+a*d)*s,M=(t.y+a*m)*s,L=(t.z+a*y)*s;t.x=(t.x-a*I)*c,t.y=(t.y-a*M)*c,t.z=(t.z-a*L)*c,o.x=u+(d+I)*c,o.y=h+(m+M)*c,o.z=f+(y+L)*c;const P=g-i.x,R=A-i.y,U=E-i.z,k=o.x-g,H=o.y-A,G=o.z-E;return P*k+R*H+U*G>0&&(o.x=g,o.y=A,o.z=E,t.x=(o.x-g)/s,t.y=(o.y-A)/s,t.z=(o.z-E)/s),o}function _b(i,e){e.set(0,0),i.forEach(t=>{e.x+=t.clientX,e.y+=t.clientY}),e.x/=i.length,e.y/=i.length}function Sb(i,e){return Dd(i)?(console.warn(`${e} is not supported in OrthographicCamera`),!0):!1}class Pde{constructor(){this._listeners={}}addEventListener(e,t){const n=this._listeners;n[e]===void 0&&(n[e]=[]),n[e].indexOf(t)===-1&&n[e].push(t)}hasEventListener(e,t){const n=this._listeners;return n[e]!==void 0&&n[e].indexOf(t)!==-1}removeEventListener(e,t){const r=this._listeners[e];if(r!==void 0){const s=r.indexOf(t);s!==-1&&r.splice(s,1)}}removeAllEventListeners(e){if(!e){this._listeners={};return}Array.isArray(this._listeners[e])&&(this._listeners[e].length=0)}dispatchEvent(e){const n=this._listeners[e.type];if(n!==void 0){e.target=this;const r=n.slice(0);for(let s=0,o=r.length;s<o;s++)r[s].call(this,e)}}}var wb;const Lde="2.10.1",jE=1/8,Bde=/Mac/.test((wb=globalThis==null?void 0:globalThis.navigator)===null||wb===void 0?void 0:wb.platform);let Nn,_7,WE,Cb,za,ni,bi,jg,gv,nh,ih,ym,S7,w7,tc,Av,Wg,C7,Tb,T7,bb,Ib,KE,Mb=class g5 extends Pde{static install(e){Nn=e.THREE,_7=Object.freeze(new Nn.Vector3(0,0,0)),WE=Object.freeze(new Nn.Vector3(0,1,0)),Cb=Object.freeze(new Nn.Vector3(0,0,1)),za=new Nn.Vector2,ni=new Nn.Vector3,bi=new Nn.Vector3,jg=new Nn.Vector3,gv=new Nn.Vector3,nh=new Nn.Vector3,ih=new Nn.Vector3,ym=new Nn.Vector3,S7=new Nn.Vector3,w7=new Nn.Vector3,tc=new Nn.Spherical,Av=new Nn.Spherical,Wg=new Nn.Box3,C7=new Nn.Box3,Tb=new Nn.Sphere,T7=new Nn.Quaternion,bb=new Nn.Quaternion,Ib=new Nn.Matrix4,KE=new Nn.Raycaster}static get ACTION(){return nt}set verticalDragToForward(e){console.warn("camera-controls: `verticalDragToForward` was removed. Use `mouseButtons.left = CameraControls.ACTION.SCREEN_PAN` instead.")}constructor(e,t){super(),this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.minDistance=Number.EPSILON,this.maxDistance=1/0,this.infinityDolly=!1,this.minZoom=.01,this.maxZoom=1/0,this.smoothTime=.25,this.draggingSmoothTime=.125,this.maxSpeed=1/0,this.azimuthRotateSpeed=1,this.polarRotateSpeed=1,this.dollySpeed=1,this.dollyDragInverted=!1,this.truckSpeed=2,this.dollyToCursor=!1,this.dragToOffset=!1,this.boundaryFriction=0,this.restThreshold=.01,this.colliderMeshes=[],this.cancel=()=>{},this._enabled=!0,this._state=nt.NONE,this._viewport=null,this._changedDolly=0,this._changedZoom=0,this._hasRested=!0,this._boundaryEnclosesCamera=!1,this._needsUpdate=!0,this._updatedLastTime=!1,this._elementRect=new DOMRect,this._isDragging=!1,this._dragNeedsUpdate=!0,this._activePointers=[],this._lockedPointer=null,this._interactiveArea=new DOMRect(0,0,1,1),this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._isUserControllingOffset=!1,this._isUserControllingZoom=!1,this._lastDollyDirection=Qg.NONE,this._thetaVelocity={value:0},this._phiVelocity={value:0},this._radiusVelocity={value:0},this._targetVelocity=new Nn.Vector3,this._focalOffsetVelocity=new Nn.Vector3,this._zoomVelocity={value:0},this._truckInternal=(A,E,x,w)=>{let T,I;if(Am(this._camera)){const M=ni.copy(this._camera.position).sub(this._target),L=this._camera.getEffectiveFOV()*dv,P=M.length()*Math.tan(L*.5);T=this.truckSpeed*A*P/this._elementRect.height,I=this.truckSpeed*E*P/this._elementRect.height}else if(Dd(this._camera)){const M=this._camera;T=this.truckSpeed*A*(M.right-M.left)/M.zoom/this._elementRect.width,I=this.truckSpeed*E*(M.top-M.bottom)/M.zoom/this._elementRect.height}else return;w?(x?this.setFocalOffset(this._focalOffsetEnd.x+T,this._focalOffsetEnd.y,this._focalOffsetEnd.z,!0):this.truck(T,0,!0),this.forward(-I,!0)):x?this.setFocalOffset(this._focalOffsetEnd.x+T,this._focalOffsetEnd.y+I,this._focalOffsetEnd.z,!0):this.truck(T,I,!0)},this._rotateInternal=(A,E)=>{const x=Vg*this.azimuthRotateSpeed*A/this._elementRect.height,w=Vg*this.polarRotateSpeed*E/this._elementRect.height;this.rotate(x,w,!0)},this._dollyInternal=(A,E,x)=>{const w=Math.pow(.95,-A*this.dollySpeed),T=this._sphericalEnd.radius,I=this._sphericalEnd.radius*w,M=au(I,this.minDistance,this.maxDistance),L=M-I;this.infinityDolly&&this.dollyToCursor?this._dollyToNoClamp(I,!0):this.infinityDolly&&!this.dollyToCursor?(this.dollyInFixed(L,!0),this._dollyToNoClamp(M,!0)):this._dollyToNoClamp(M,!0),this.dollyToCursor&&(this._changedDolly+=(this.infinityDolly?I:M)-T,this._dollyControlCoord.set(E,x)),this._lastDollyDirection=Math.sign(-A)},this._zoomInternal=(A,E,x)=>{const w=Math.pow(.95,A*this.dollySpeed),T=this._zoom,I=this._zoom*w;this.zoomTo(I,!0),this.dollyToCursor&&(this._changedZoom+=I-T,this._dollyControlCoord.set(E,x))},typeof Nn>"u"&&console.error("camera-controls: `THREE` is undefined. You must first run `CameraControls.install( { THREE: THREE } )`. Check the docs for further information."),this._camera=e,this._yAxisUpSpace=new Nn.Quaternion().setFromUnitVectors(this._camera.up,WE),this._yAxisUpSpaceInverse=this._yAxisUpSpace.clone().invert(),this._state=nt.NONE,this._target=new Nn.Vector3,this._targetEnd=this._target.clone(),this._focalOffset=new Nn.Vector3,this._focalOffsetEnd=this._focalOffset.clone(),this._spherical=new Nn.Spherical().setFromVector3(ni.copy(this._camera.position).applyQuaternion(this._yAxisUpSpace)),this._sphericalEnd=this._spherical.clone(),this._lastDistance=this._spherical.radius,this._zoom=this._camera.zoom,this._zoomEnd=this._zoom,this._lastZoom=this._zoom,this._nearPlaneCorners=[new Nn.Vector3,new Nn.Vector3,new Nn.Vector3,new Nn.Vector3],this._updateNearPlaneCorners(),this._boundary=new Nn.Box3(new Nn.Vector3(-1/0,-1/0,-1/0),new Nn.Vector3(1/0,1/0,1/0)),this._cameraUp0=this._camera.up.clone(),this._target0=this._target.clone(),this._position0=this._camera.position.clone(),this._zoom0=this._zoom,this._focalOffset0=this._focalOffset.clone(),this._dollyControlCoord=new Nn.Vector2,this.mouseButtons={left:nt.ROTATE,middle:nt.DOLLY,right:nt.TRUCK,wheel:Am(this._camera)?nt.DOLLY:Dd(this._camera)?nt.ZOOM:nt.NONE},this.touches={one:nt.TOUCH_ROTATE,two:Am(this._camera)?nt.TOUCH_DOLLY_TRUCK:Dd(this._camera)?nt.TOUCH_ZOOM_TRUCK:nt.NONE,three:nt.TOUCH_TRUCK};const n=new Nn.Vector2,r=new Nn.Vector2,s=new Nn.Vector2,o=A=>{if(!this._enabled||!this._domElement)return;if(this._interactiveArea.left!==0||this._interactiveArea.top!==0||this._interactiveArea.width!==1||this._interactiveArea.height!==1){const w=this._domElement.getBoundingClientRect(),T=A.clientX/w.width,I=A.clientY/w.height;if(T<this._interactiveArea.left||T>this._interactiveArea.right||I<this._interactiveArea.top||I>this._interactiveArea.bottom)return}const E=A.pointerType!=="mouse"?null:(A.buttons&Hr.LEFT)===Hr.LEFT?Hr.LEFT:(A.buttons&Hr.MIDDLE)===Hr.MIDDLE?Hr.MIDDLE:(A.buttons&Hr.RIGHT)===Hr.RIGHT?Hr.RIGHT:null;if(E!==null){const w=this._findPointerByMouseButton(E);w&&this._disposePointer(w)}if((A.buttons&Hr.LEFT)===Hr.LEFT&&this._lockedPointer)return;const x={pointerId:A.pointerId,clientX:A.clientX,clientY:A.clientY,deltaX:0,deltaY:0,mouseButton:E};this._activePointers.push(x),this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",l),this._domElement.ownerDocument.addEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",l),this._isDragging=!0,f(A)},a=A=>{A.cancelable&&A.preventDefault();const E=A.pointerId,x=this._lockedPointer||this._findPointerById(E);if(x){if(x.clientX=A.clientX,x.clientY=A.clientY,x.deltaX=A.movementX,x.deltaY=A.movementY,this._state=0,A.pointerType==="touch")switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else(!this._isDragging&&this._lockedPointer||this._isDragging&&(A.buttons&Hr.LEFT)===Hr.LEFT)&&(this._state=this._state|this.mouseButtons.left),this._isDragging&&(A.buttons&Hr.MIDDLE)===Hr.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),this._isDragging&&(A.buttons&Hr.RIGHT)===Hr.RIGHT&&(this._state=this._state|this.mouseButtons.right);d()}},l=A=>{const E=this._findPointerById(A.pointerId);if(!(E&&E===this._lockedPointer)){if(E&&this._disposePointer(E),A.pointerType==="touch")switch(this._activePointers.length){case 0:this._state=nt.NONE;break;case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else this._state=nt.NONE;m()}};let c=-1;const u=A=>{if(!this._domElement||!this._enabled||this.mouseButtons.wheel===nt.NONE)return;if(this._interactiveArea.left!==0||this._interactiveArea.top!==0||this._interactiveArea.width!==1||this._interactiveArea.height!==1){const I=this._domElement.getBoundingClientRect(),M=A.clientX/I.width,L=A.clientY/I.height;if(M<this._interactiveArea.left||M>this._interactiveArea.right||L<this._interactiveArea.top||L>this._interactiveArea.bottom)return}if(A.preventDefault(),this.dollyToCursor||this.mouseButtons.wheel===nt.ROTATE||this.mouseButtons.wheel===nt.TRUCK){const I=performance.now();c-I<1e3&&this._getClientRect(this._elementRect),c=I}const E=Bde?-1:-3,x=A.deltaMode===1||A.ctrlKey?A.deltaY/E:A.deltaY/(E*10),w=this.dollyToCursor?(A.clientX-this._elementRect.x)/this._elementRect.width*2-1:0,T=this.dollyToCursor?(A.clientY-this._elementRect.y)/this._elementRect.height*-2+1:0;switch(this.mouseButtons.wheel){case nt.ROTATE:{this._rotateInternal(A.deltaX,A.deltaY),this._isUserControllingRotate=!0;break}case nt.TRUCK:{this._truckInternal(A.deltaX,A.deltaY,!1,!1),this._isUserControllingTruck=!0;break}case nt.SCREEN_PAN:{this._truckInternal(A.deltaX,A.deltaY,!1,!0),this._isUserControllingTruck=!0;break}case nt.OFFSET:{this._truckInternal(A.deltaX,A.deltaY,!0,!1),this._isUserControllingOffset=!0;break}case nt.DOLLY:{this._dollyInternal(-x,w,T),this._isUserControllingDolly=!0;break}case nt.ZOOM:{this._zoomInternal(-x,w,T),this._isUserControllingZoom=!0;break}}this.dispatchEvent({type:"control"})},h=A=>{if(!(!this._domElement||!this._enabled)){if(this.mouseButtons.right===g5.ACTION.NONE){const E=A instanceof PointerEvent?A.pointerId:0,x=this._findPointerById(E);x&&this._disposePointer(x),this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",l);return}A.preventDefault()}},f=A=>{if(!this._enabled)return;if(_b(this._activePointers,za),this._getClientRect(this._elementRect),n.copy(za),r.copy(za),this._activePointers.length>=2){const x=za.x-this._activePointers[1].clientX,w=za.y-this._activePointers[1].clientY,T=Math.sqrt(x*x+w*w);s.set(0,T);const I=(this._activePointers[0].clientX+this._activePointers[1].clientX)*.5,M=(this._activePointers[0].clientY+this._activePointers[1].clientY)*.5;r.set(I,M)}if(this._state=0,!A)this._lockedPointer&&(this._state=this._state|this.mouseButtons.left);else if("pointerType"in A&&A.pointerType==="touch")switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else!this._lockedPointer&&(A.buttons&Hr.LEFT)===Hr.LEFT&&(this._state=this._state|this.mouseButtons.left),(A.buttons&Hr.MIDDLE)===Hr.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),(A.buttons&Hr.RIGHT)===Hr.RIGHT&&(this._state=this._state|this.mouseButtons.right);((this._state&nt.ROTATE)===nt.ROTATE||(this._state&nt.TOUCH_ROTATE)===nt.TOUCH_ROTATE||(this._state&nt.TOUCH_DOLLY_ROTATE)===nt.TOUCH_DOLLY_ROTATE||(this._state&nt.TOUCH_ZOOM_ROTATE)===nt.TOUCH_ZOOM_ROTATE)&&(this._sphericalEnd.theta=this._spherical.theta,this._sphericalEnd.phi=this._spherical.phi,this._thetaVelocity.value=0,this._phiVelocity.value=0),((this._state&nt.TRUCK)===nt.TRUCK||(this._state&nt.SCREEN_PAN)===nt.SCREEN_PAN||(this._state&nt.TOUCH_TRUCK)===nt.TOUCH_TRUCK||(this._state&nt.TOUCH_SCREEN_PAN)===nt.TOUCH_SCREEN_PAN||(this._state&nt.TOUCH_DOLLY_TRUCK)===nt.TOUCH_DOLLY_TRUCK||(this._state&nt.TOUCH_DOLLY_SCREEN_PAN)===nt.TOUCH_DOLLY_SCREEN_PAN||(this._state&nt.TOUCH_ZOOM_TRUCK)===nt.TOUCH_ZOOM_TRUCK||(this._state&nt.TOUCH_ZOOM_SCREEN_PAN)===nt.TOUCH_DOLLY_SCREEN_PAN)&&(this._targetEnd.copy(this._target),this._targetVelocity.set(0,0,0)),((this._state&nt.DOLLY)===nt.DOLLY||(this._state&nt.TOUCH_DOLLY)===nt.TOUCH_DOLLY||(this._state&nt.TOUCH_DOLLY_TRUCK)===nt.TOUCH_DOLLY_TRUCK||(this._state&nt.TOUCH_DOLLY_SCREEN_PAN)===nt.TOUCH_DOLLY_SCREEN_PAN||(this._state&nt.TOUCH_DOLLY_OFFSET)===nt.TOUCH_DOLLY_OFFSET||(this._state&nt.TOUCH_DOLLY_ROTATE)===nt.TOUCH_DOLLY_ROTATE)&&(this._sphericalEnd.radius=this._spherical.radius,this._radiusVelocity.value=0),((this._state&nt.ZOOM)===nt.ZOOM||(this._state&nt.TOUCH_ZOOM)===nt.TOUCH_ZOOM||(this._state&nt.TOUCH_ZOOM_TRUCK)===nt.TOUCH_ZOOM_TRUCK||(this._state&nt.TOUCH_ZOOM_SCREEN_PAN)===nt.TOUCH_ZOOM_SCREEN_PAN||(this._state&nt.TOUCH_ZOOM_OFFSET)===nt.TOUCH_ZOOM_OFFSET||(this._state&nt.TOUCH_ZOOM_ROTATE)===nt.TOUCH_ZOOM_ROTATE)&&(this._zoomEnd=this._zoom,this._zoomVelocity.value=0),((this._state&nt.OFFSET)===nt.OFFSET||(this._state&nt.TOUCH_OFFSET)===nt.TOUCH_OFFSET||(this._state&nt.TOUCH_DOLLY_OFFSET)===nt.TOUCH_DOLLY_OFFSET||(this._state&nt.TOUCH_ZOOM_OFFSET)===nt.TOUCH_ZOOM_OFFSET)&&(this._focalOffsetEnd.copy(this._focalOffset),this._focalOffsetVelocity.set(0,0,0)),this.dispatchEvent({type:"controlstart"})},d=()=>{if(!this._enabled||!this._dragNeedsUpdate)return;this._dragNeedsUpdate=!1,_b(this._activePointers,za);const E=this._domElement&&this._domElement.ownerDocument.pointerLockElement===this._domElement?this._lockedPointer||this._activePointers[0]:null,x=E?-E.deltaX:r.x-za.x,w=E?-E.deltaY:r.y-za.y;if(r.copy(za),((this._state&nt.ROTATE)===nt.ROTATE||(this._state&nt.TOUCH_ROTATE)===nt.TOUCH_ROTATE||(this._state&nt.TOUCH_DOLLY_ROTATE)===nt.TOUCH_DOLLY_ROTATE||(this._state&nt.TOUCH_ZOOM_ROTATE)===nt.TOUCH_ZOOM_ROTATE)&&(this._rotateInternal(x,w),this._isUserControllingRotate=!0),(this._state&nt.DOLLY)===nt.DOLLY||(this._state&nt.ZOOM)===nt.ZOOM){const T=this.dollyToCursor?(n.x-this._elementRect.x)/this._elementRect.width*2-1:0,I=this.dollyToCursor?(n.y-this._elementRect.y)/this._elementRect.height*-2+1:0,M=this.dollyDragInverted?-1:1;(this._state&nt.DOLLY)===nt.DOLLY?(this._dollyInternal(M*w*jE,T,I),this._isUserControllingDolly=!0):(this._zoomInternal(M*w*jE,T,I),this._isUserControllingZoom=!0)}if((this._state&nt.TOUCH_DOLLY)===nt.TOUCH_DOLLY||(this._state&nt.TOUCH_ZOOM)===nt.TOUCH_ZOOM||(this._state&nt.TOUCH_DOLLY_TRUCK)===nt.TOUCH_DOLLY_TRUCK||(this._state&nt.TOUCH_ZOOM_TRUCK)===nt.TOUCH_ZOOM_TRUCK||(this._state&nt.TOUCH_DOLLY_SCREEN_PAN)===nt.TOUCH_DOLLY_SCREEN_PAN||(this._state&nt.TOUCH_ZOOM_SCREEN_PAN)===nt.TOUCH_ZOOM_SCREEN_PAN||(this._state&nt.TOUCH_DOLLY_OFFSET)===nt.TOUCH_DOLLY_OFFSET||(this._state&nt.TOUCH_ZOOM_OFFSET)===nt.TOUCH_ZOOM_OFFSET||(this._state&nt.TOUCH_DOLLY_ROTATE)===nt.TOUCH_DOLLY_ROTATE||(this._state&nt.TOUCH_ZOOM_ROTATE)===nt.TOUCH_ZOOM_ROTATE){const T=za.x-this._activePointers[1].clientX,I=za.y-this._activePointers[1].clientY,M=Math.sqrt(T*T+I*I),L=s.y-M;s.set(0,M);const P=this.dollyToCursor?(r.x-this._elementRect.x)/this._elementRect.width*2-1:0,R=this.dollyToCursor?(r.y-this._elementRect.y)/this._elementRect.height*-2+1:0;(this._state&nt.TOUCH_DOLLY)===nt.TOUCH_DOLLY||(this._state&nt.TOUCH_DOLLY_ROTATE)===nt.TOUCH_DOLLY_ROTATE||(this._state&nt.TOUCH_DOLLY_TRUCK)===nt.TOUCH_DOLLY_TRUCK||(this._state&nt.TOUCH_DOLLY_SCREEN_PAN)===nt.TOUCH_DOLLY_SCREEN_PAN||(this._state&nt.TOUCH_DOLLY_OFFSET)===nt.TOUCH_DOLLY_OFFSET?(this._dollyInternal(L*jE,P,R),this._isUserControllingDolly=!0):(this._zoomInternal(L*jE,P,R),this._isUserControllingZoom=!0)}((this._state&nt.TRUCK)===nt.TRUCK||(this._state&nt.TOUCH_TRUCK)===nt.TOUCH_TRUCK||(this._state&nt.TOUCH_DOLLY_TRUCK)===nt.TOUCH_DOLLY_TRUCK||(this._state&nt.TOUCH_ZOOM_TRUCK)===nt.TOUCH_ZOOM_TRUCK)&&(this._truckInternal(x,w,!1,!1),this._isUserControllingTruck=!0),((this._state&nt.SCREEN_PAN)===nt.SCREEN_PAN||(this._state&nt.TOUCH_SCREEN_PAN)===nt.TOUCH_SCREEN_PAN||(this._state&nt.TOUCH_DOLLY_SCREEN_PAN)===nt.TOUCH_DOLLY_SCREEN_PAN||(this._state&nt.TOUCH_ZOOM_SCREEN_PAN)===nt.TOUCH_ZOOM_SCREEN_PAN)&&(this._truckInternal(x,w,!1,!0),this._isUserControllingTruck=!0),((this._state&nt.OFFSET)===nt.OFFSET||(this._state&nt.TOUCH_OFFSET)===nt.TOUCH_OFFSET||(this._state&nt.TOUCH_DOLLY_OFFSET)===nt.TOUCH_DOLLY_OFFSET||(this._state&nt.TOUCH_ZOOM_OFFSET)===nt.TOUCH_ZOOM_OFFSET)&&(this._truckInternal(x,w,!0,!1),this._isUserControllingOffset=!0),this.dispatchEvent({type:"control"})},m=()=>{_b(this._activePointers,za),r.copy(za),this._dragNeedsUpdate=!1,(this._activePointers.length===0||this._activePointers.length===1&&this._activePointers[0]===this._lockedPointer)&&(this._isDragging=!1),this._activePointers.length===0&&this._domElement&&(this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",l),this.dispatchEvent({type:"controlend"}))};this.lockPointer=()=>{!this._enabled||!this._domElement||(this.cancel(),this._lockedPointer={pointerId:-1,clientX:0,clientY:0,deltaX:0,deltaY:0,mouseButton:null},this._activePointers.push(this._lockedPointer),this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",l),this._domElement.requestPointerLock(),this._domElement.ownerDocument.addEventListener("pointerlockchange",y),this._domElement.ownerDocument.addEventListener("pointerlockerror",g),this._domElement.ownerDocument.addEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",l),f())},this.unlockPointer=()=>{var A,E,x;this._lockedPointer!==null&&(this._disposePointer(this._lockedPointer),this._lockedPointer=null),(A=this._domElement)===null||A===void 0||A.ownerDocument.exitPointerLock(),(E=this._domElement)===null||E===void 0||E.ownerDocument.removeEventListener("pointerlockchange",y),(x=this._domElement)===null||x===void 0||x.ownerDocument.removeEventListener("pointerlockerror",g),this.cancel()};const y=()=>{this._domElement&&this._domElement.ownerDocument.pointerLockElement===this._domElement||this.unlockPointer()},g=()=>{this.unlockPointer()};this._addAllEventListeners=A=>{this._domElement=A,this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none",this._domElement.addEventListener("pointerdown",o),this._domElement.addEventListener("pointercancel",l),this._domElement.addEventListener("wheel",u,{passive:!1}),this._domElement.addEventListener("contextmenu",h)},this._removeAllEventListeners=()=>{this._domElement&&(this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect="",this._domElement.removeEventListener("pointerdown",o),this._domElement.removeEventListener("pointercancel",l),this._domElement.removeEventListener("wheel",u,{passive:!1}),this._domElement.removeEventListener("contextmenu",h),this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",l),this._domElement.ownerDocument.removeEventListener("pointerlockchange",y),this._domElement.ownerDocument.removeEventListener("pointerlockerror",g))},this.cancel=()=>{this._state!==nt.NONE&&(this._state=nt.NONE,this._activePointers.length=0,m())},t&&this.connect(t),this.update(0)}get camera(){return this._camera}set camera(e){this._camera=e,this.updateCameraUp(),this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0}get enabled(){return this._enabled}set enabled(e){this._enabled=e,this._domElement&&(e?(this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none"):(this.cancel(),this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect=""))}get active(){return!this._hasRested}get currentAction(){return this._state}get distance(){return this._spherical.radius}set distance(e){this._spherical.radius===e&&this._sphericalEnd.radius===e||(this._spherical.radius=e,this._sphericalEnd.radius=e,this._needsUpdate=!0)}get azimuthAngle(){return this._spherical.theta}set azimuthAngle(e){this._spherical.theta===e&&this._sphericalEnd.theta===e||(this._spherical.theta=e,this._sphericalEnd.theta=e,this._needsUpdate=!0)}get polarAngle(){return this._spherical.phi}set polarAngle(e){this._spherical.phi===e&&this._sphericalEnd.phi===e||(this._spherical.phi=e,this._sphericalEnd.phi=e,this._needsUpdate=!0)}get boundaryEnclosesCamera(){return this._boundaryEnclosesCamera}set boundaryEnclosesCamera(e){this._boundaryEnclosesCamera=e,this._needsUpdate=!0}set interactiveArea(e){this._interactiveArea.width=au(e.width,0,1),this._interactiveArea.height=au(e.height,0,1),this._interactiveArea.x=au(e.x,0,1-this._interactiveArea.width),this._interactiveArea.y=au(e.y,0,1-this._interactiveArea.height)}addEventListener(e,t){super.addEventListener(e,t)}removeEventListener(e,t){super.removeEventListener(e,t)}rotate(e,t,n=!1){return this.rotateTo(this._sphericalEnd.theta+e,this._sphericalEnd.phi+t,n)}rotateAzimuthTo(e,t=!1){return this.rotateTo(e,this._sphericalEnd.phi,t)}rotatePolarTo(e,t=!1){return this.rotateTo(this._sphericalEnd.theta,e,t)}rotateTo(e,t,n=!1){this._isUserControllingRotate=!1;const r=au(e,this.minAzimuthAngle,this.maxAzimuthAngle),s=au(t,this.minPolarAngle,this.maxPolarAngle);this._sphericalEnd.theta=r,this._sphericalEnd.phi=s,this._sphericalEnd.makeSafe(),this._needsUpdate=!0,n||(this._spherical.theta=this._sphericalEnd.theta,this._spherical.phi=this._sphericalEnd.phi);const o=!n||Fi(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&Fi(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold);return this._createOnRestPromise(o)}dolly(e,t=!1){return this.dollyTo(this._sphericalEnd.radius-e,t)}dollyTo(e,t=!1){return this._isUserControllingDolly=!1,this._lastDollyDirection=Qg.NONE,this._changedDolly=0,this._dollyToNoClamp(au(e,this.minDistance,this.maxDistance),t)}_dollyToNoClamp(e,t=!1){const n=this._sphericalEnd.radius;if(this.colliderMeshes.length>=1){const o=this._collisionTest(),a=Fi(o,this._spherical.radius);if(!(n>e)&&a)return Promise.resolve();this._sphericalEnd.radius=Math.min(e,o)}else this._sphericalEnd.radius=e;this._needsUpdate=!0,t||(this._spherical.radius=this._sphericalEnd.radius);const s=!t||Fi(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(s)}dollyInFixed(e,t=!1){this._targetEnd.add(this._getCameraDirection(gv).multiplyScalar(e)),t||this._target.copy(this._targetEnd);const n=!t||Fi(this._target.x,this._targetEnd.x,this.restThreshold)&&Fi(this._target.y,this._targetEnd.y,this.restThreshold)&&Fi(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(n)}zoom(e,t=!1){return this.zoomTo(this._zoomEnd+e,t)}zoomTo(e,t=!1){this._isUserControllingZoom=!1,this._zoomEnd=au(e,this.minZoom,this.maxZoom),this._needsUpdate=!0,t||(this._zoom=this._zoomEnd);const n=!t||Fi(this._zoom,this._zoomEnd,this.restThreshold);return this._changedZoom=0,this._createOnRestPromise(n)}pan(e,t,n=!1){return console.warn("`pan` has been renamed to `truck`"),this.truck(e,t,n)}truck(e,t,n=!1){this._camera.updateMatrix(),nh.setFromMatrixColumn(this._camera.matrix,0),ih.setFromMatrixColumn(this._camera.matrix,1),nh.multiplyScalar(e),ih.multiplyScalar(-t);const r=ni.copy(nh).add(ih),s=bi.copy(this._targetEnd).add(r);return this.moveTo(s.x,s.y,s.z,n)}forward(e,t=!1){ni.setFromMatrixColumn(this._camera.matrix,0),ni.crossVectors(this._camera.up,ni),ni.multiplyScalar(e);const n=bi.copy(this._targetEnd).add(ni);return this.moveTo(n.x,n.y,n.z,t)}elevate(e,t=!1){return ni.copy(this._camera.up).multiplyScalar(e),this.moveTo(this._targetEnd.x+ni.x,this._targetEnd.y+ni.y,this._targetEnd.z+ni.z,t)}moveTo(e,t,n,r=!1){this._isUserControllingTruck=!1;const s=ni.set(e,t,n).sub(this._targetEnd);this._encloseToBoundary(this._targetEnd,s,this.boundaryFriction),this._needsUpdate=!0,r||this._target.copy(this._targetEnd);const o=!r||Fi(this._target.x,this._targetEnd.x,this.restThreshold)&&Fi(this._target.y,this._targetEnd.y,this.restThreshold)&&Fi(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(o)}lookInDirectionOf(e,t,n,r=!1){const a=ni.set(e,t,n).sub(this._targetEnd).normalize().multiplyScalar(-this._sphericalEnd.radius).add(this._targetEnd);return this.setPosition(a.x,a.y,a.z,r)}fitToBox(e,t,{cover:n=!1,paddingLeft:r=0,paddingRight:s=0,paddingBottom:o=0,paddingTop:a=0}={}){const l=[],c=e.isBox3?Wg.copy(e):Wg.setFromObject(e);c.isEmpty()&&(console.warn("camera-controls: fitTo() cannot be used with an empty box. Aborting"),Promise.resolve());const u=x7(this._sphericalEnd.theta,v7),h=x7(this._sphericalEnd.phi,v7);l.push(this.rotateTo(u,h,t));const f=ni.setFromSpherical(this._sphericalEnd).normalize(),d=T7.setFromUnitVectors(f,Cb),m=Fi(Math.abs(f.y),1);m&&d.multiply(bb.setFromAxisAngle(WE,u)),d.multiply(this._yAxisUpSpaceInverse);const y=C7.makeEmpty();bi.copy(c.min).applyQuaternion(d),y.expandByPoint(bi),bi.copy(c.min).setX(c.max.x).applyQuaternion(d),y.expandByPoint(bi),bi.copy(c.min).setY(c.max.y).applyQuaternion(d),y.expandByPoint(bi),bi.copy(c.max).setZ(c.min.z).applyQuaternion(d),y.expandByPoint(bi),bi.copy(c.min).setZ(c.max.z).applyQuaternion(d),y.expandByPoint(bi),bi.copy(c.max).setY(c.min.y).applyQuaternion(d),y.expandByPoint(bi),bi.copy(c.max).setX(c.min.x).applyQuaternion(d),y.expandByPoint(bi),bi.copy(c.max).applyQuaternion(d),y.expandByPoint(bi),y.min.x-=r,y.min.y-=o,y.max.x+=s,y.max.y+=a,d.setFromUnitVectors(Cb,f),m&&d.premultiply(bb.invert()),d.premultiply(this._yAxisUpSpace);const g=y.getSize(ni),A=y.getCenter(bi).applyQuaternion(d);if(Am(this._camera)){const E=this.getDistanceToFitBox(g.x,g.y,g.z,n);l.push(this.moveTo(A.x,A.y,A.z,t)),l.push(this.dollyTo(E,t)),l.push(this.setFocalOffset(0,0,0,t))}else if(Dd(this._camera)){const E=this._camera,x=E.right-E.left,w=E.top-E.bottom,T=n?Math.max(x/g.x,w/g.y):Math.min(x/g.x,w/g.y);l.push(this.moveTo(A.x,A.y,A.z,t)),l.push(this.zoomTo(T,t)),l.push(this.setFocalOffset(0,0,0,t))}return Promise.all(l)}fitToSphere(e,t){const n=[],s="isObject3D"in e?g5.createBoundingSphere(e,Tb):Tb.copy(e);if(n.push(this.moveTo(s.center.x,s.center.y,s.center.z,t)),Am(this._camera)){const o=this.getDistanceToFitSphere(s.radius);n.push(this.dollyTo(o,t))}else if(Dd(this._camera)){const o=this._camera.right-this._camera.left,a=this._camera.top-this._camera.bottom,l=2*s.radius,c=Math.min(o/l,a/l);n.push(this.zoomTo(c,t))}return n.push(this.setFocalOffset(0,0,0,t)),Promise.all(n)}setLookAt(e,t,n,r,s,o,a=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._lastDollyDirection=Qg.NONE,this._changedDolly=0;const l=bi.set(r,s,o),c=ni.set(e,t,n);this._targetEnd.copy(l),this._sphericalEnd.setFromVector3(c.sub(l).applyQuaternion(this._yAxisUpSpace)),this.normalizeRotations(),this._needsUpdate=!0,a||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));const u=!a||Fi(this._target.x,this._targetEnd.x,this.restThreshold)&&Fi(this._target.y,this._targetEnd.y,this.restThreshold)&&Fi(this._target.z,this._targetEnd.z,this.restThreshold)&&Fi(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&Fi(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&Fi(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(u)}lerpLookAt(e,t,n,r,s,o,a,l,c,u,h,f,d,m=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._lastDollyDirection=Qg.NONE,this._changedDolly=0;const y=ni.set(r,s,o),g=bi.set(e,t,n);tc.setFromVector3(g.sub(y).applyQuaternion(this._yAxisUpSpace));const A=jg.set(u,h,f),E=bi.set(a,l,c);Av.setFromVector3(E.sub(A).applyQuaternion(this._yAxisUpSpace)),this._targetEnd.copy(y.lerp(A,d));const x=Av.theta-tc.theta,w=Av.phi-tc.phi,T=Av.radius-tc.radius;this._sphericalEnd.set(tc.radius+T*d,tc.phi+w*d,tc.theta+x*d),this.normalizeRotations(),this._needsUpdate=!0,m||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));const I=!m||Fi(this._target.x,this._targetEnd.x,this.restThreshold)&&Fi(this._target.y,this._targetEnd.y,this.restThreshold)&&Fi(this._target.z,this._targetEnd.z,this.restThreshold)&&Fi(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&Fi(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&Fi(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(I)}setPosition(e,t,n,r=!1){return this.setLookAt(e,t,n,this._targetEnd.x,this._targetEnd.y,this._targetEnd.z,r)}setTarget(e,t,n,r=!1){const s=this.getPosition(ni),o=this.setLookAt(s.x,s.y,s.z,e,t,n,r);return this._sphericalEnd.phi=au(this._sphericalEnd.phi,this.minPolarAngle,this.maxPolarAngle),o}setFocalOffset(e,t,n,r=!1){this._isUserControllingOffset=!1,this._focalOffsetEnd.set(e,t,n),this._needsUpdate=!0,r||this._focalOffset.copy(this._focalOffsetEnd);const s=!r||Fi(this._focalOffset.x,this._focalOffsetEnd.x,this.restThreshold)&&Fi(this._focalOffset.y,this._focalOffsetEnd.y,this.restThreshold)&&Fi(this._focalOffset.z,this._focalOffsetEnd.z,this.restThreshold);return this._createOnRestPromise(s)}setOrbitPoint(e,t,n){this._camera.updateMatrixWorld(),nh.setFromMatrixColumn(this._camera.matrixWorldInverse,0),ih.setFromMatrixColumn(this._camera.matrixWorldInverse,1),ym.setFromMatrixColumn(this._camera.matrixWorldInverse,2);const r=ni.set(e,t,n),s=r.distanceTo(this._camera.position),o=r.sub(this._camera.position);nh.multiplyScalar(o.x),ih.multiplyScalar(o.y),ym.multiplyScalar(o.z),ni.copy(nh).add(ih).add(ym),ni.z=ni.z+s,this.dollyTo(s,!1),this.setFocalOffset(-ni.x,ni.y,-ni.z,!1),this.moveTo(e,t,n,!1)}setBoundary(e){if(!e){this._boundary.min.set(-1/0,-1/0,-1/0),this._boundary.max.set(1/0,1/0,1/0),this._needsUpdate=!0;return}this._boundary.copy(e),this._boundary.clampPoint(this._targetEnd,this._targetEnd),this._needsUpdate=!0}setViewport(e,t,n,r){if(e===null){this._viewport=null;return}this._viewport=this._viewport||new Nn.Vector4,typeof e=="number"?this._viewport.set(e,t,n,r):this._viewport.copy(e)}getDistanceToFitBox(e,t,n,r=!1){if(Sb(this._camera,"getDistanceToFitBox"))return this._spherical.radius;const s=e/t,o=this._camera.getEffectiveFOV()*dv,a=this._camera.aspect;return((r?s>a:s<a)?t:e/a)*.5/Math.tan(o*.5)+n*.5}getDistanceToFitSphere(e){if(Sb(this._camera,"getDistanceToFitSphere"))return this._spherical.radius;const t=this._camera.getEffectiveFOV()*dv,n=Math.atan(Math.tan(t*.5)*this._camera.aspect)*2,r=1<this._camera.aspect?t:n;return e/Math.sin(r*.5)}getTarget(e,t=!0){return(e&&e.isVector3?e:new Nn.Vector3).copy(t?this._targetEnd:this._target)}getPosition(e,t=!0){return(e&&e.isVector3?e:new Nn.Vector3).setFromSpherical(t?this._sphericalEnd:this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(t?this._targetEnd:this._target)}getSpherical(e,t=!0){return(e||new Nn.Spherical).copy(t?this._sphericalEnd:this._spherical)}getFocalOffset(e,t=!0){return(e&&e.isVector3?e:new Nn.Vector3).copy(t?this._focalOffsetEnd:this._focalOffset)}normalizeRotations(){this._sphericalEnd.theta=this._sphericalEnd.theta%Vg,this._sphericalEnd.theta<0&&(this._sphericalEnd.theta+=Vg),this._spherical.theta+=Vg*Math.round((this._sphericalEnd.theta-this._spherical.theta)/Vg)}stop(){this._focalOffset.copy(this._focalOffsetEnd),this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd),this._zoom=this._zoomEnd}reset(e=!1){if(!Fi(this._camera.up.x,this._cameraUp0.x)||!Fi(this._camera.up.y,this._cameraUp0.y)||!Fi(this._camera.up.z,this._cameraUp0.z)){this._camera.up.copy(this._cameraUp0);const n=this.getPosition(ni);this.updateCameraUp(),this.setPosition(n.x,n.y,n.z)}const t=[this.setLookAt(this._position0.x,this._position0.y,this._position0.z,this._target0.x,this._target0.y,this._target0.z,e),this.setFocalOffset(this._focalOffset0.x,this._focalOffset0.y,this._focalOffset0.z,e),this.zoomTo(this._zoom0,e)];return Promise.all(t)}saveState(){this._cameraUp0.copy(this._camera.up),this.getTarget(this._target0),this.getPosition(this._position0),this._zoom0=this._zoom,this._focalOffset0.copy(this._focalOffset)}updateCameraUp(){this._yAxisUpSpace.setFromUnitVectors(this._camera.up,WE),this._yAxisUpSpaceInverse.copy(this._yAxisUpSpace).invert()}applyCameraUp(){const e=ni.subVectors(this._target,this._camera.position).normalize(),t=bi.crossVectors(e,this._camera.up);this._camera.up.crossVectors(t,e).normalize(),this._camera.updateMatrixWorld();const n=this.getPosition(ni);this.updateCameraUp(),this.setPosition(n.x,n.y,n.z)}update(e){const t=this._sphericalEnd.theta-this._spherical.theta,n=this._sphericalEnd.phi-this._spherical.phi,r=this._sphericalEnd.radius-this._spherical.radius,s=S7.subVectors(this._targetEnd,this._target),o=w7.subVectors(this._focalOffsetEnd,this._focalOffset),a=this._zoomEnd-this._zoom;if(pr(t))this._thetaVelocity.value=0,this._spherical.theta=this._sphericalEnd.theta;else{const h=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.theta=VE(this._spherical.theta,this._sphericalEnd.theta,this._thetaVelocity,h,1/0,e),this._needsUpdate=!0}if(pr(n))this._phiVelocity.value=0,this._spherical.phi=this._sphericalEnd.phi;else{const h=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.phi=VE(this._spherical.phi,this._sphericalEnd.phi,this._phiVelocity,h,1/0,e),this._needsUpdate=!0}if(pr(r))this._radiusVelocity.value=0,this._spherical.radius=this._sphericalEnd.radius;else{const h=this._isUserControllingDolly?this.draggingSmoothTime:this.smoothTime;this._spherical.radius=VE(this._spherical.radius,this._sphericalEnd.radius,this._radiusVelocity,h,this.maxSpeed,e),this._needsUpdate=!0}if(pr(s.x)&&pr(s.y)&&pr(s.z))this._targetVelocity.set(0,0,0),this._target.copy(this._targetEnd);else{const h=this._isUserControllingTruck?this.draggingSmoothTime:this.smoothTime;E7(this._target,this._targetEnd,this._targetVelocity,h,this.maxSpeed,e,this._target),this._needsUpdate=!0}if(pr(o.x)&&pr(o.y)&&pr(o.z))this._focalOffsetVelocity.set(0,0,0),this._focalOffset.copy(this._focalOffsetEnd);else{const h=this._isUserControllingOffset?this.draggingSmoothTime:this.smoothTime;E7(this._focalOffset,this._focalOffsetEnd,this._focalOffsetVelocity,h,this.maxSpeed,e,this._focalOffset),this._needsUpdate=!0}if(pr(a))this._zoomVelocity.value=0,this._zoom=this._zoomEnd;else{const h=this._isUserControllingZoom?this.draggingSmoothTime:this.smoothTime;this._zoom=VE(this._zoom,this._zoomEnd,this._zoomVelocity,h,1/0,e)}if(this.dollyToCursor){if(Am(this._camera)&&this._changedDolly!==0){const h=this._spherical.radius-this._lastDistance,f=this._camera,d=this._getCameraDirection(gv),m=ni.copy(d).cross(f.up).normalize();m.lengthSq()===0&&(m.x=1);const y=bi.crossVectors(m,d),g=this._sphericalEnd.radius*Math.tan(f.getEffectiveFOV()*dv*.5),E=(this._sphericalEnd.radius-h-this._sphericalEnd.radius)/this._sphericalEnd.radius,x=jg.copy(this._targetEnd).add(m.multiplyScalar(this._dollyControlCoord.x*g*f.aspect)).add(y.multiplyScalar(this._dollyControlCoord.y*g)),w=ni.copy(this._targetEnd).lerp(x,E),T=this._lastDollyDirection===Qg.IN&&this._spherical.radius<=this.minDistance,I=this._lastDollyDirection===Qg.OUT&&this.maxDistance<=this._spherical.radius;if(this.infinityDolly&&(T||I)){this._sphericalEnd.radius-=h,this._spherical.radius-=h;const L=bi.copy(d).multiplyScalar(-h);w.add(L)}this._boundary.clampPoint(w,w);const M=bi.subVectors(w,this._targetEnd);this._targetEnd.copy(w),this._target.add(M),this._changedDolly-=h,pr(this._changedDolly)&&(this._changedDolly=0)}else if(Dd(this._camera)&&this._changedZoom!==0){const h=this._zoom-this._lastZoom,f=this._camera,d=ni.set(this._dollyControlCoord.x,this._dollyControlCoord.y,(f.near+f.far)/(f.near-f.far)).unproject(f),m=bi.set(0,0,-1).applyQuaternion(f.quaternion),y=jg.copy(d).add(m.multiplyScalar(-d.dot(f.up))),A=-(this._zoom-h-this._zoom)/this._zoom,E=this._getCameraDirection(gv),x=this._targetEnd.dot(E),w=ni.copy(this._targetEnd).lerp(y,A),T=w.dot(E),I=E.multiplyScalar(T-x);w.sub(I),this._boundary.clampPoint(w,w);const M=bi.subVectors(w,this._targetEnd);this._targetEnd.copy(w),this._target.add(M),this._changedZoom-=h,pr(this._changedZoom)&&(this._changedZoom=0)}}this._camera.zoom!==this._zoom&&(this._camera.zoom=this._zoom,this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0),this._dragNeedsUpdate=!0;const l=this._collisionTest();this._spherical.radius=Math.min(this._spherical.radius,l),this._spherical.makeSafe(),this._camera.position.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(this._target),this._camera.lookAt(this._target),(!pr(this._focalOffset.x)||!pr(this._focalOffset.y)||!pr(this._focalOffset.z))&&(nh.setFromMatrixColumn(this._camera.matrix,0),ih.setFromMatrixColumn(this._camera.matrix,1),ym.setFromMatrixColumn(this._camera.matrix,2),nh.multiplyScalar(this._focalOffset.x),ih.multiplyScalar(-this._focalOffset.y),ym.multiplyScalar(this._focalOffset.z),ni.copy(nh).add(ih).add(ym),this._camera.position.add(ni),this._camera.updateMatrixWorld()),this._boundaryEnclosesCamera&&this._encloseToBoundary(this._camera.position.copy(this._target),ni.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse),1);const u=this._needsUpdate;return u&&!this._updatedLastTime?(this._hasRested=!1,this.dispatchEvent({type:"wake"}),this.dispatchEvent({type:"update"})):u?(this.dispatchEvent({type:"update"}),pr(t,this.restThreshold)&&pr(n,this.restThreshold)&&pr(r,this.restThreshold)&&pr(s.x,this.restThreshold)&&pr(s.y,this.restThreshold)&&pr(s.z,this.restThreshold)&&pr(o.x,this.restThreshold)&&pr(o.y,this.restThreshold)&&pr(o.z,this.restThreshold)&&pr(a,this.restThreshold)&&!this._hasRested&&(this._hasRested=!0,this.dispatchEvent({type:"rest"}))):!u&&this._updatedLastTime&&this.dispatchEvent({type:"sleep"}),this._lastDistance=this._spherical.radius,this._lastZoom=this._zoom,this._updatedLastTime=u,this._needsUpdate=!1,u}toJSON(){return JSON.stringify({enabled:this._enabled,minDistance:this.minDistance,maxDistance:pv(this.maxDistance),minZoom:this.minZoom,maxZoom:pv(this.maxZoom),minPolarAngle:this.minPolarAngle,maxPolarAngle:pv(this.maxPolarAngle),minAzimuthAngle:pv(this.minAzimuthAngle),maxAzimuthAngle:pv(this.maxAzimuthAngle),smoothTime:this.smoothTime,draggingSmoothTime:this.draggingSmoothTime,dollySpeed:this.dollySpeed,truckSpeed:this.truckSpeed,dollyToCursor:this.dollyToCursor,target:this._targetEnd.toArray(),position:ni.setFromSpherical(this._sphericalEnd).add(this._targetEnd).toArray(),zoom:this._zoomEnd,focalOffset:this._focalOffsetEnd.toArray(),target0:this._target0.toArray(),position0:this._position0.toArray(),zoom0:this._zoom0,focalOffset0:this._focalOffset0.toArray()})}fromJSON(e,t=!1){const n=JSON.parse(e);this.enabled=n.enabled,this.minDistance=n.minDistance,this.maxDistance=mv(n.maxDistance),this.minZoom=n.minZoom,this.maxZoom=mv(n.maxZoom),this.minPolarAngle=n.minPolarAngle,this.maxPolarAngle=mv(n.maxPolarAngle),this.minAzimuthAngle=mv(n.minAzimuthAngle),this.maxAzimuthAngle=mv(n.maxAzimuthAngle),this.smoothTime=n.smoothTime,this.draggingSmoothTime=n.draggingSmoothTime,this.dollySpeed=n.dollySpeed,this.truckSpeed=n.truckSpeed,this.dollyToCursor=n.dollyToCursor,this._target0.fromArray(n.target0),this._position0.fromArray(n.position0),this._zoom0=n.zoom0,this._focalOffset0.fromArray(n.focalOffset0),this.moveTo(n.target[0],n.target[1],n.target[2],t),tc.setFromVector3(ni.fromArray(n.position).sub(this._targetEnd).applyQuaternion(this._yAxisUpSpace)),this.rotateTo(tc.theta,tc.phi,t),this.dollyTo(tc.radius,t),this.zoomTo(n.zoom,t),this.setFocalOffset(n.focalOffset[0],n.focalOffset[1],n.focalOffset[2],t),this._needsUpdate=!0}connect(e){if(this._domElement){console.warn("camera-controls is already connected.");return}e.setAttribute("data-camera-controls-version",Lde),this._addAllEventListeners(e),this._getClientRect(this._elementRect)}disconnect(){this.cancel(),this._removeAllEventListeners(),this._domElement&&(this._domElement.removeAttribute("data-camera-controls-version"),this._domElement=void 0)}dispose(){this.removeAllEventListeners(),this.disconnect()}_getTargetDirection(e){return e.setFromSpherical(this._spherical).divideScalar(this._spherical.radius).applyQuaternion(this._yAxisUpSpaceInverse)}_getCameraDirection(e){return this._getTargetDirection(e).negate()}_findPointerById(e){return this._activePointers.find(t=>t.pointerId===e)}_findPointerByMouseButton(e){return this._activePointers.find(t=>t.mouseButton===e)}_disposePointer(e){this._activePointers.splice(this._activePointers.indexOf(e),1)}_encloseToBoundary(e,t,n){const r=t.lengthSq();if(r===0)return e;const s=bi.copy(t).add(e),a=this._boundary.clampPoint(s,jg).sub(s),l=a.lengthSq();if(l===0)return e.add(t);if(l===r)return e;if(n===0)return e.add(t).add(a);{const c=1+n*l/t.dot(a);return e.add(bi.copy(t).multiplyScalar(c)).add(a.multiplyScalar(1-n))}}_updateNearPlaneCorners(){if(Am(this._camera)){const e=this._camera,t=e.near,n=e.getEffectiveFOV()*dv,r=Math.tan(n*.5)*t,s=r*e.aspect;this._nearPlaneCorners[0].set(-s,-r,0),this._nearPlaneCorners[1].set(s,-r,0),this._nearPlaneCorners[2].set(s,r,0),this._nearPlaneCorners[3].set(-s,r,0)}else if(Dd(this._camera)){const e=this._camera,t=1/e.zoom,n=e.left*t,r=e.right*t,s=e.top*t,o=e.bottom*t;this._nearPlaneCorners[0].set(n,s,0),this._nearPlaneCorners[1].set(r,s,0),this._nearPlaneCorners[2].set(r,o,0),this._nearPlaneCorners[3].set(n,o,0)}}_collisionTest(){let e=1/0;if(!(this.colliderMeshes.length>=1)||Sb(this._camera,"_collisionTest"))return e;const n=this._getTargetDirection(gv);Ib.lookAt(_7,n,this._camera.up);for(let r=0;r<4;r++){const s=bi.copy(this._nearPlaneCorners[r]);s.applyMatrix4(Ib);const o=jg.addVectors(this._target,s);KE.set(o,n),KE.far=this._spherical.radius+1;const a=KE.intersectObjects(this.colliderMeshes);a.length!==0&&a[0].distance<e&&(e=a[0].distance)}return e}_getClientRect(e){if(!this._domElement)return;const t=this._domElement.getBoundingClientRect();return e.x=t.left,e.y=t.top,this._viewport?(e.x+=this._viewport.x,e.y+=t.height-this._viewport.w-this._viewport.y,e.width=this._viewport.z,e.height=this._viewport.w):(e.width=t.width,e.height=t.height),e}_createOnRestPromise(e){return e?Promise.resolve():(this._hasRested=!1,this.dispatchEvent({type:"transitionstart"}),new Promise(t=>{const n=()=>{this.removeEventListener("rest",n),t()};this.addEventListener("rest",n)}))}_addAllEventListeners(e){}_removeAllEventListeners(){}get dampingFactor(){return console.warn(".dampingFactor has been deprecated. use smoothTime (in seconds) instead."),0}set dampingFactor(e){console.warn(".dampingFactor has been deprecated. use smoothTime (in seconds) instead.")}get draggingDampingFactor(){return console.warn(".draggingDampingFactor has been deprecated. use draggingSmoothTime (in seconds) instead."),0}set draggingDampingFactor(e){console.warn(".draggingDampingFactor has been deprecated. use draggingSmoothTime (in seconds) instead.")}static createBoundingSphere(e,t=new Nn.Sphere){const n=t,r=n.center;Wg.makeEmpty(),e.traverseVisible(o=>{o.isMesh&&Wg.expandByObject(o)}),Wg.getCenter(r);let s=0;return e.traverseVisible(o=>{if(!o.isMesh)return;const a=o;if(!a.geometry)return;const l=a.geometry.clone();l.applyMatrix4(a.matrixWorld);const u=l.attributes.position;for(let h=0,f=u.count;h<f;h++)ni.fromBufferAttribute(u,h),s=Math.max(s,r.distanceToSquared(ni))}),n.radius=Math.sqrt(s),n}};const Dde=C.forwardRef((i,e)=>{C.useMemo(()=>{const T={Box3:ti,MathUtils:{clamp:un.clamp},Matrix4:Xe,Quaternion:Xt,Raycaster:y0,Sphere:Bi,Spherical:t0,Vector2:Ue,Vector3:Q,Vector4:Rn};Mb.install({THREE:T}),Or({CameraControlsImpl:Mb})},[]);const{camera:t,domElement:n,makeDefault:r,onStart:s,onEnd:o,onChange:a,regress:l,...c}=i,u=Ve(T=>T.camera),h=Ve(T=>T.gl),f=Ve(T=>T.invalidate),d=Ve(T=>T.events),m=Ve(T=>T.setEvents),y=Ve(T=>T.set),g=Ve(T=>T.get),A=Ve(T=>T.performance),E=t||u,x=n||d.connected||h.domElement,w=C.useMemo(()=>new Mb(E),[E]);return Kt((T,I)=>{w.enabled&&w.update(I)},-1),C.useEffect(()=>(w.connect(x),()=>void w.disconnect()),[x,w]),C.useEffect(()=>{const T=L=>{f(),l&&A.regress(),a&&a(L)},I=L=>{s&&s(L)},M=L=>{o&&o(L)};return w.addEventListener("update",T),w.addEventListener("controlstart",I),w.addEventListener("controlend",M),w.addEventListener("control",T),w.addEventListener("transitionstart",T),w.addEventListener("wake",T),()=>{w.removeEventListener("update",T),w.removeEventListener("controlstart",I),w.removeEventListener("controlend",M),w.removeEventListener("control",T),w.removeEventListener("transitionstart",T),w.removeEventListener("wake",T)}},[w,s,o,f,m,l,a]),C.useEffect(()=>{if(r){const T=g().controls;return y({controls:w}),()=>y({controls:T})}},[r,w]),C.createElement("primitive",ot({ref:e,object:w},c))}),kde=i=>(i==null?void 0:i.current)instanceof _n,xQ=C.createContext(null);function EQ(){const i=C.useContext(xQ);if(!i)throw new Error("useMotion hook must be used in a MotionPathControls component.");return i}function Fde({points:i=50,color:e="black"}){const{path:t}=EQ(),[n,r]=C.useState([]),s=C.useMemo(()=>new no({color:e}),[e]),o=C.useMemo(()=>new p0(.025,16,16),[]),a=C.useRef([]);return C.useEffect(()=>{t.curves!==a.current&&(r(t.getPoints(i)),a.current=t.curves)}),n.map((l,c)=>C.createElement("mesh",{key:c,material:s,geometry:o,position:[l.x,l.y,l.z]}))}const Ode=C.forwardRef(({children:i,curves:e=[],debug:t=!1,debugColor:n="black",object:r,focus:s,loop:o=!0,offset:a=void 0,smooth:l=!1,eps:c=1e-5,damping:u=.1,focusDamping:h=.1,maxSpeed:f=1/0,...d},m)=>{const{camera:y}=Ve(),g=C.useRef(null),A=C.useRef(a??0),E=C.useMemo(()=>new H6,[]),x=C.useMemo(()=>({focus:s,object:(r==null?void 0:r.current)instanceof _n?r:{current:y},path:E,current:A.current,offset:A.current,point:new Q,tangent:new Q,next:new Q}),[s,r]);C.useLayoutEffect(()=>{var T,I;E.curves=[];const M=e.length>0?e:(T=(I=g.current)==null||(I=I.__r3f)==null?void 0:I.objects)!==null&&T!==void 0?T:[];for(let L=0;L<M.length;L++)E.add(M[L]);if(l){const L=E.getPoints(typeof l=="number"?l:1),P=new Dw(L);E.curves=[P]}E.updateArcLengths()}),C.useImperativeHandle(m,()=>Object.assign(g.current,{motion:x}),[x]),C.useLayoutEffect(()=>{A.current=TE.repeat(A.current,1)},[a]);const w=C.useMemo(()=>new Q,[]);return Kt((T,I)=>{const M=x.offset;if(aA.damp(A,"current",a!==void 0?a:x.current,u,I,f,void 0,c),x.offset=o?TE.repeat(A.current,1):TE.clamp(A.current,0,1),E.getCurveLengths().length>0){E.getPointAt(x.offset,x.point),E.getTangentAt(x.offset,x.tangent).normalize(),E.getPointAt(TE.repeat(A.current-(M-x.offset),1),x.next);const L=(r==null?void 0:r.current)instanceof _n?r.current:y;L.position.copy(x.point),s&&aA.dampLookAt(L,kde(s)?s.current.getWorldPosition(w):s,h,I,f,void 0,c)}}),C.createElement("group",ot({ref:g},d),C.createElement(xQ.Provider,{value:x},i,t&&C.createElement(Fde,{color:n})))});function Nde({defaultScene:i,defaultCamera:e,renderPriority:t=1}){const{gl:n,scene:r,camera:s}=Ve();let o;return Kt(()=>{o=n.autoClear,t===1&&(n.autoClear=!0,n.render(i,e)),n.autoClear=!1,n.clearDepth(),n.render(r,s),n.autoClear=o},t),C.createElement("group",{onPointerOver:()=>null})}function _Q({children:i,renderPriority:e=1}){const{scene:t,camera:n}=Ve(),[r]=C.useState(()=>new Mu);return C.createElement(C.Fragment,null,vp(C.createElement(C.Fragment,null,i,C.createElement(Nde,{defaultScene:t,defaultCamera:n,renderPriority:e})),r,{events:{priority:e+1}}))}const SQ=C.createContext({}),m4=()=>C.useContext(SQ),Ude=2*Math.PI,Rb=new _n,b7=new Xe,[Kg,Pb]=[new Xt,new Xt],I7=new Q,M7=new Q,zde=i=>"minPolarAngle"in i,R7=i=>"getTarget"in i,Gde=({alignment:i="bottom-right",margin:e=[80,80],renderPriority:t=1,onUpdate:n,onTarget:r,children:s})=>{const o=Ve(I=>I.size),a=Ve(I=>I.camera),l=Ve(I=>I.controls),c=Ve(I=>I.invalidate),u=C.useRef(null),h=C.useRef(null),f=C.useRef(!1),d=C.useRef(0),m=C.useRef(new Q(0,0,0)),y=C.useRef(new Q(0,0,0));C.useEffect(()=>{y.current.copy(a.up),Rb.up.copy(a.up)},[a]);const g=C.useCallback(I=>{f.current=!0,(l||r)&&(m.current=(r==null?void 0:r())||(R7(l)?l.getTarget(m.current):l==null?void 0:l.target)),d.current=a.position.distanceTo(I7),Kg.copy(a.quaternion),M7.copy(I).multiplyScalar(d.current).add(I7),Rb.lookAt(M7),Pb.copy(Rb.quaternion),c()},[l,a,r,c]);Kt((I,M)=>{if(h.current&&u.current){var L;if(f.current)if(Kg.angleTo(Pb)<.01)f.current=!1,zde(l)&&a.up.copy(y.current);else{const P=M*Ude;Kg.rotateTowards(Pb,P),a.position.set(0,0,1).applyQuaternion(Kg).multiplyScalar(d.current).add(m.current),a.up.set(0,1,0).applyQuaternion(Kg).normalize(),a.quaternion.copy(Kg),R7(l)&&l.setPosition(a.position.x,a.position.y,a.position.z),n?n():l&&l.update(M),c()}b7.copy(a.matrix).invert(),(L=u.current)==null||L.quaternion.setFromRotationMatrix(b7)}});const A=C.useMemo(()=>({tweenCamera:g}),[g]),[E,x]=e,w=i.endsWith("-center")?0:i.endsWith("-left")?-o.width/2+E:o.width/2-E,T=i.startsWith("center-")?0:i.startsWith("top-")?o.height/2-x:-o.height/2+x;return C.createElement(_Q,{renderPriority:t},C.createElement(SQ.Provider,{value:A},C.createElement(gQ,{makeDefault:!0,ref:h,position:[0,0,200]}),C.createElement("group",{ref:u,position:[w,T,0]},s)))},Gv={bg:"#f0f0f0",hover:"#999",text:"black",stroke:"black"},Hde=["Right","Left","Top","Bottom","Front","Back"],wQ=i=>new Q(...i).multiplyScalar(.38),Qde=[[1,1,1],[1,1,-1],[1,-1,1],[1,-1,-1],[-1,1,1],[-1,1,-1],[-1,-1,1],[-1,-1,-1]].map(wQ),Vde=[.25,.25,.25],CQ=[[1,1,0],[1,0,1],[1,0,-1],[1,-1,0],[0,1,1],[0,1,-1],[0,-1,1],[0,-1,-1],[-1,1,0],[-1,0,1],[-1,0,-1],[-1,-1,0]].map(wQ),jde=CQ.map(i=>i.toArray().map(e=>e==0?.5:.25)),Wde=({hover:i,index:e,font:t="20px Inter var, Arial, sans-serif",faces:n=Hde,color:r=Gv.bg,hoverColor:s=Gv.hover,textColor:o=Gv.text,strokeColor:a=Gv.stroke,opacity:l=1})=>{const c=Ve(h=>h.gl),u=C.useMemo(()=>{const h=document.createElement("canvas");h.width=128,h.height=128;const f=h.getContext("2d");return f.fillStyle=r,f.fillRect(0,0,h.width,h.height),f.strokeStyle=a,f.strokeRect(0,0,h.width,h.height),f.font=t,f.textAlign="center",f.fillStyle=o,f.fillText(n[e].toUpperCase(),64,76),new k6(h)},[e,n,t,r,o,a]);return C.createElement("meshBasicMaterial",{map:u,"map-anisotropy":c.capabilities.getMaxAnisotropy()||1,attach:`material-${e}`,color:i?s:"white",transparent:!0,opacity:l})},Kde=i=>{const{tweenCamera:e}=m4(),[t,n]=C.useState(null),r=a=>{a.stopPropagation(),n(null)},s=a=>{a.stopPropagation(),e(a.face.normal)},o=a=>{a.stopPropagation(),n(Math.floor(a.faceIndex/2))};return C.createElement("mesh",{onPointerOut:r,onPointerMove:o,onClick:i.onClick||s},[...Array(6)].map((a,l)=>C.createElement(Wde,ot({key:l,index:l,hover:t===l},i))),C.createElement("boxGeometry",null))},P7=({onClick:i,dimensions:e,position:t,hoverColor:n=Gv.hover})=>{const{tweenCamera:r}=m4(),[s,o]=C.useState(!1),a=u=>{u.stopPropagation(),o(!1)},l=u=>{u.stopPropagation(),o(!0)},c=u=>{u.stopPropagation(),r(t)};return C.createElement("mesh",{scale:1.01,position:t,onPointerOver:l,onPointerOut:a,onClick:i||c},C.createElement("meshBasicMaterial",{color:s?n:"white",transparent:!0,opacity:.6,visible:s}),C.createElement("boxGeometry",{args:e}))},Yde=i=>C.createElement("group",{scale:[60,60,60]},C.createElement(Kde,i),CQ.map((e,t)=>C.createElement(P7,ot({key:t,position:e,dimensions:jde[t]},i))),Qde.map((e,t)=>C.createElement(P7,ot({key:t,position:e,dimensions:Vde},i))));function Lb({scale:i=[.8,.05,.05],color:e,rotation:t}){return C.createElement("group",{rotation:t},C.createElement("mesh",{position:[.4,0,0]},C.createElement("boxGeometry",{args:i}),C.createElement("meshBasicMaterial",{color:e,toneMapped:!1})))}function Yg({onClick:i,font:e,disabled:t,arcStyle:n,label:r,labelColor:s,axisHeadScale:o=1,...a}){const l=Ve(y=>y.gl),c=C.useMemo(()=>{const y=document.createElement("canvas");y.width=64,y.height=64;const g=y.getContext("2d");return g.beginPath(),g.arc(32,32,16,0,2*Math.PI),g.closePath(),g.fillStyle=n,g.fill(),r&&(g.font=e,g.textAlign="center",g.fillStyle=s,g.fillText(r,32,41)),new k6(y)},[n,r,s,e]),[u,h]=C.useState(!1),f=(r?1:.75)*(u?1.2:1)*o,d=y=>{y.stopPropagation(),h(!0)},m=y=>{y.stopPropagation(),h(!1)};return C.createElement("sprite",ot({scale:f,onPointerOver:t?void 0:d,onPointerOut:t?void 0:i||m},a),C.createElement("spriteMaterial",{map:c,"map-anisotropy":l.capabilities.getMaxAnisotropy()||1,alphaTest:.3,opacity:r?1:.75,toneMapped:!1}))}const $de=({hideNegativeAxes:i,hideAxisHeads:e,disabled:t,font:n="18px Inter var, Arial, sans-serif",axisColors:r=["#ff2060","#20df80","#2080ff"],axisHeadScale:s=1,axisScale:o,labels:a=["X","Y","Z"],labelColor:l="#000",onClick:c,...u})=>{const[h,f,d]=r,{tweenCamera:m}=m4(),y={font:n,disabled:t,labelColor:l,onClick:c,axisHeadScale:s,onPointerDown:t?void 0:g=>{m(g.object.position),g.stopPropagation()}};return C.createElement("group",ot({scale:40},u),C.createElement(Lb,{color:h,rotation:[0,0,0],scale:o}),C.createElement(Lb,{color:f,rotation:[0,0,Math.PI/2],scale:o}),C.createElement(Lb,{color:d,rotation:[0,-Math.PI/2,0],scale:o}),!e&&C.createElement(C.Fragment,null,C.createElement(Yg,ot({arcStyle:h,position:[1,0,0],label:a[0]},y)),C.createElement(Yg,ot({arcStyle:f,position:[0,1,0],label:a[1]},y)),C.createElement(Yg,ot({arcStyle:d,position:[0,0,1],label:a[2]},y)),!i&&C.createElement(C.Fragment,null,C.createElement(Yg,ot({arcStyle:h,position:[-1,0,0]},y)),C.createElement(Yg,ot({arcStyle:f,position:[0,-1,0]},y)),C.createElement(Yg,ot({arcStyle:d,position:[0,0,-1]},y)))))},Xde=Ec({cellSize:.5,sectionSize:1,fadeDistance:100,fadeStrength:1,fadeFrom:1,cellThickness:.5,sectionThickness:1,cellColor:new ut,sectionColor:new ut,infiniteGrid:!1,followCamera:!1,worldCamProjPosition:new Q,worldPlanePosition:new Q},`
    varying vec3 localPosition;
    varying vec4 worldPosition;

    uniform vec3 worldCamProjPosition;
    uniform vec3 worldPlanePosition;
    uniform float fadeDistance;
    uniform bool infiniteGrid;
    uniform bool followCamera;

    void main() {
      localPosition = position.xzy;
      if (infiniteGrid) localPosition *= 1.0 + fadeDistance;
      
      worldPosition = modelMatrix * vec4(localPosition, 1.0);
      if (followCamera) {
        worldPosition.xyz += (worldCamProjPosition - worldPlanePosition);
        localPosition = (inverse(modelMatrix) * worldPosition).xyz;
      }

      gl_Position = projectionMatrix * viewMatrix * worldPosition;
    }
  `,`
    varying vec3 localPosition;
    varying vec4 worldPosition;

    uniform vec3 worldCamProjPosition;
    uniform float cellSize;
    uniform float sectionSize;
    uniform vec3 cellColor;
    uniform vec3 sectionColor;
    uniform float fadeDistance;
    uniform float fadeStrength;
    uniform float fadeFrom;
    uniform float cellThickness;
    uniform float sectionThickness;

    float getGrid(float size, float thickness) {
      vec2 r = localPosition.xz / size;
      vec2 grid = abs(fract(r - 0.5) - 0.5) / fwidth(r);
      float line = min(grid.x, grid.y) + 1.0 - thickness;
      return 1.0 - min(line, 1.0);
    }

    void main() {
      float g1 = getGrid(cellSize, cellThickness);
      float g2 = getGrid(sectionSize, sectionThickness);

      vec3 from = worldCamProjPosition*vec3(fadeFrom);
      float dist = distance(from, worldPosition.xyz);
      float d = 1.0 - min(dist / fadeDistance, 1.0);
      vec3 color = mix(cellColor, sectionColor, min(1.0, sectionThickness * g2));

      gl_FragColor = vec4(color, (g1 + g2) * pow(d, fadeStrength));
      gl_FragColor.a = mix(0.75 * gl_FragColor.a, gl_FragColor.a, g2);
      if (gl_FragColor.a <= 0.0) discard;

      #include <tonemapping_fragment>
      #include <${ea>=154?"colorspace_fragment":"encodings_fragment"}>
    }
  `),qde=C.forwardRef(({args:i,cellColor:e="#000000",sectionColor:t="#2080ff",cellSize:n=.5,sectionSize:r=1,followCamera:s=!1,infiniteGrid:o=!1,fadeDistance:a=100,fadeStrength:l=1,fadeFrom:c=1,cellThickness:u=.5,sectionThickness:h=1,side:f=ys,...d},m)=>{Or({GridMaterial:Xde});const y=C.useRef(null);C.useImperativeHandle(m,()=>y.current,[]);const g=new vo,A=new Q(0,1,0),E=new Q(0,0,0);Kt(T=>{g.setFromNormalAndCoplanarPoint(A,E).applyMatrix4(y.current.matrixWorld);const I=y.current.material,M=I.uniforms.worldCamProjPosition,L=I.uniforms.worldPlanePosition;g.projectPoint(T.camera.position,M.value),L.value.set(0,0,0).applyMatrix4(y.current.matrixWorld)});const x={cellSize:n,sectionSize:r,cellColor:e,sectionColor:t,cellThickness:u,sectionThickness:h},w={fadeDistance:a,fadeStrength:l,fadeFrom:c,infiniteGrid:o,followCamera:s};return C.createElement("mesh",ot({ref:y,frustumCulled:!1},d),C.createElement("gridMaterial",ot({transparent:!0,"extensions-derivatives":!0,side:f},x,w)),C.createElement("planeGeometry",{args:i}))});function FR(i,{path:e}){const[t]=cr(Kw,[i],n=>n.setPath(e));return t}FR.preload=(i,{path:e})=>cr.preload(Kw,[i],t=>t.setPath(e));function Jde({children:i,files:e,...t}){const n=FR(e,{...t});return C.createElement(C.Fragment,null,i==null?void 0:i(n))}function g4(i){return cr(PR,i)}g4.preload=i=>cr.preload(PR,i);g4.clear=i=>cr.clear(PR,i);function Zde({path:i,...e}){const n=g4(i).children[0];return C.createElement(V2,ot({},e,{object:n}))}const TQ="https://cdn.jsdelivr.net/gh/pmndrs/drei-assets@master";function A4(i,e=`${TQ}/basis/`){const t=Ve(r=>r.gl),n=cr(BR,K1(i)?Object.values(i):i,r=>{r.detectSupport(t),r.setTranscoderPath(e)});if(C.useEffect(()=>{(Array.isArray(n)?n:[n]).forEach(t.initTexture)},[t,n]),K1(i)){const r=Object.keys(i),s={};return r.forEach(o=>Object.assign(s,{[o]:n[r.indexOf(o)]})),s}else return n}A4.preload=(i,e=`${TQ}/basis/`)=>cr.preload(BR,i,t=>{t.setTranscoderPath(e)});A4.clear=i=>cr.clear(BR,i);const epe=({children:i,input:e,basisPath:t})=>{const n=A4(e,t);return C.createElement(C.Fragment,null,i==null?void 0:i(n))},jt=Number.isFinite||function(i){return typeof i=="number"&&isFinite(i)},tpe=Number.isSafeInteger||function(i){return typeof i=="number"&&Math.abs(i)<=npe},npe=Number.MAX_SAFE_INTEGER||9007199254740991;let rn=(function(i){return i.NETWORK_ERROR="networkError",i.MEDIA_ERROR="mediaError",i.KEY_SYSTEM_ERROR="keySystemError",i.MUX_ERROR="muxError",i.OTHER_ERROR="otherError",i})({}),Ke=(function(i){return i.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",i.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",i.KEY_SYSTEM_NO_SESSION="keySystemNoSession",i.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",i.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",i.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",i.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",i.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",i.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",i.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",i.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR="keySystemDestroyMediaKeysError",i.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR="keySystemDestroyCloseSessionError",i.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR="keySystemDestroyRemoveSessionError",i.MANIFEST_LOAD_ERROR="manifestLoadError",i.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",i.MANIFEST_PARSING_ERROR="manifestParsingError",i.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",i.LEVEL_EMPTY_ERROR="levelEmptyError",i.LEVEL_LOAD_ERROR="levelLoadError",i.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",i.LEVEL_PARSING_ERROR="levelParsingError",i.LEVEL_SWITCH_ERROR="levelSwitchError",i.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",i.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",i.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",i.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",i.FRAG_LOAD_ERROR="fragLoadError",i.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",i.FRAG_DECRYPT_ERROR="fragDecryptError",i.FRAG_PARSING_ERROR="fragParsingError",i.FRAG_GAP="fragGap",i.REMUX_ALLOC_ERROR="remuxAllocError",i.KEY_LOAD_ERROR="keyLoadError",i.KEY_LOAD_TIMEOUT="keyLoadTimeOut",i.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",i.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",i.BUFFER_APPEND_ERROR="bufferAppendError",i.BUFFER_APPENDING_ERROR="bufferAppendingError",i.BUFFER_STALLED_ERROR="bufferStalledError",i.BUFFER_FULL_ERROR="bufferFullError",i.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",i.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",i.ASSET_LIST_LOAD_ERROR="assetListLoadError",i.ASSET_LIST_LOAD_TIMEOUT="assetListLoadTimeout",i.ASSET_LIST_PARSING_ERROR="assetListParsingError",i.INTERSTITIAL_ASSET_ITEM_ERROR="interstitialAssetItemError",i.INTERNAL_EXCEPTION="internalException",i.INTERNAL_ABORTED="aborted",i.ATTACH_MEDIA_ERROR="attachMediaError",i.UNKNOWN="unknown",i})({}),ae=(function(i){return i.MEDIA_ATTACHING="hlsMediaAttaching",i.MEDIA_ATTACHED="hlsMediaAttached",i.MEDIA_DETACHING="hlsMediaDetaching",i.MEDIA_DETACHED="hlsMediaDetached",i.MEDIA_ENDED="hlsMediaEnded",i.STALL_RESOLVED="hlsStallResolved",i.BUFFER_RESET="hlsBufferReset",i.BUFFER_CODECS="hlsBufferCodecs",i.BUFFER_CREATED="hlsBufferCreated",i.BUFFER_APPENDING="hlsBufferAppending",i.BUFFER_APPENDED="hlsBufferAppended",i.BUFFER_EOS="hlsBufferEos",i.BUFFERED_TO_END="hlsBufferedToEnd",i.BUFFER_FLUSHING="hlsBufferFlushing",i.BUFFER_FLUSHED="hlsBufferFlushed",i.MANIFEST_LOADING="hlsManifestLoading",i.MANIFEST_LOADED="hlsManifestLoaded",i.MANIFEST_PARSED="hlsManifestParsed",i.LEVEL_SWITCHING="hlsLevelSwitching",i.LEVEL_SWITCHED="hlsLevelSwitched",i.LEVEL_LOADING="hlsLevelLoading",i.LEVEL_LOADED="hlsLevelLoaded",i.LEVEL_UPDATED="hlsLevelUpdated",i.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",i.LEVELS_UPDATED="hlsLevelsUpdated",i.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",i.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",i.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",i.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",i.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",i.AUDIO_TRACK_UPDATED="hlsAudioTrackUpdated",i.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",i.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",i.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",i.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",i.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",i.SUBTITLE_TRACK_UPDATED="hlsSubtitleTrackUpdated",i.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",i.CUES_PARSED="hlsCuesParsed",i.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",i.INIT_PTS_FOUND="hlsInitPtsFound",i.FRAG_LOADING="hlsFragLoading",i.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",i.FRAG_LOADED="hlsFragLoaded",i.FRAG_DECRYPTED="hlsFragDecrypted",i.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",i.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",i.FRAG_PARSING_METADATA="hlsFragParsingMetadata",i.FRAG_PARSED="hlsFragParsed",i.FRAG_BUFFERED="hlsFragBuffered",i.FRAG_CHANGED="hlsFragChanged",i.FPS_DROP="hlsFpsDrop",i.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",i.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",i.ERROR="hlsError",i.DESTROYING="hlsDestroying",i.KEY_LOADING="hlsKeyLoading",i.KEY_LOADED="hlsKeyLoaded",i.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",i.BACK_BUFFER_REACHED="hlsBackBufferReached",i.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",i.ASSET_LIST_LOADING="hlsAssetListLoading",i.ASSET_LIST_LOADED="hlsAssetListLoaded",i.INTERSTITIALS_UPDATED="hlsInterstitialsUpdated",i.INTERSTITIALS_BUFFERED_TO_BOUNDARY="hlsInterstitialsBufferedToBoundary",i.INTERSTITIAL_ASSET_PLAYER_CREATED="hlsInterstitialAssetPlayerCreated",i.INTERSTITIAL_STARTED="hlsInterstitialStarted",i.INTERSTITIAL_ASSET_STARTED="hlsInterstitialAssetStarted",i.INTERSTITIAL_ASSET_ENDED="hlsInterstitialAssetEnded",i.INTERSTITIAL_ASSET_ERROR="hlsInterstitialAssetError",i.INTERSTITIAL_ENDED="hlsInterstitialEnded",i.INTERSTITIALS_PRIMARY_RESUMED="hlsInterstitialsPrimaryResumed",i.PLAYOUT_LIMIT_REACHED="hlsPlayoutLimitReached",i.EVENT_CUE_ENTER="hlsEventCueEnter",i})({});var ai={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},$t={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};class $g{constructor(e,t=0,n=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=n}sample(e,t){const n=Math.pow(this.alpha_,e);this.estimate_=t*(1-n)+n*this.estimate_,this.totalWeight_+=e}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_}}class ipe{constructor(e,t,n,r=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=n,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new $g(e),this.fast_=new $g(t),this.defaultTTFB_=r,this.ttfb_=new $g(e)}update(e,t){const{slow_:n,fast_:r,ttfb_:s}=this;n.halfLife!==e&&(this.slow_=new $g(e,n.getEstimate(),n.getTotalWeight())),r.halfLife!==t&&(this.fast_=new $g(t,r.getEstimate(),r.getTotalWeight())),s.halfLife!==e&&(this.ttfb_=new $g(e,s.getEstimate(),s.getTotalWeight()))}sample(e,t){e=Math.max(e,this.minDelayMs_);const n=8*t,r=e/1e3,s=n/r;this.fast_.sample(r,s),this.slow_.sample(r,s)}sampleTTFB(e){const t=e/1e3,n=Math.sqrt(2)*Math.exp(-Math.pow(t,2)/2);this.ttfb_.sample(n,Math.max(e,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}get defaultEstimate(){return this.defaultEstimate_}destroy(){}}function rpe(i,e,t){return(e=ope(e))in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function er(){return er=Object.assign?Object.assign.bind():function(i){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)({}).hasOwnProperty.call(t,n)&&(i[n]=t[n])}return i},er.apply(null,arguments)}function L7(i,e){var t=Object.keys(i);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(i);e&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(i,r).enumerable})),t.push.apply(t,n)}return t}function Qi(i){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?L7(Object(t),!0).forEach(function(n){rpe(i,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(t)):L7(Object(t)).forEach(function(n){Object.defineProperty(i,n,Object.getOwnPropertyDescriptor(t,n))})}return i}function spe(i,e){if(typeof i!="object"||!i)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var n=t.call(i,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}function ope(i){var e=spe(i,"string");return typeof e=="symbol"?e:e+""}class _c{constructor(e,t){this.trace=void 0,this.debug=void 0,this.log=void 0,this.warn=void 0,this.info=void 0,this.error=void 0;const n=`[${e}]:`;this.trace=kd,this.debug=t.debug.bind(null,n),this.log=t.log.bind(null,n),this.warn=t.warn.bind(null,n),this.info=t.info.bind(null,n),this.error=t.error.bind(null,n)}}const kd=function(){},ape={trace:kd,debug:kd,log:kd,warn:kd,info:kd,error:kd};function A5(){return er({},ape)}function lpe(i,e){const t=self.console[i];return t?t.bind(self.console,`${e?"["+e+"] ":""}[${i}] >`):kd}function B7(i,e,t){return e[i]?e[i].bind(e):lpe(i,t)}const y5=A5();function cpe(i,e,t){const n=A5();if(typeof console=="object"&&i===!0||typeof i=="object"){const r=["debug","log","info","warn","error"];r.forEach(s=>{n[s]=B7(s,i,t)});try{n.log(`Debug logs enabled for "${e}" in hls.js version 1.6.15`)}catch{return A5()}r.forEach(s=>{y5[s]=B7(s,i)})}else er(y5,n);return n}const Ki=y5;function Uf(i=!0){return typeof self>"u"?void 0:(i||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}function upe(i){return typeof self<"u"&&i===self.ManagedMediaSource}function bQ(i,e){const t=Object.keys(i),n=Object.keys(e),r=t.length,s=n.length;return!r||!s||r===s&&!t.some(o=>n.indexOf(o)===-1)}function Ll(i,e=!1){if(typeof TextDecoder<"u"){const c=new TextDecoder("utf-8").decode(i);if(e){const u=c.indexOf("\0");return u!==-1?c.substring(0,u):c}return c.replace(/\0/g,"")}const t=i.length;let n,r,s,o="",a=0;for(;a<t;){if(n=i[a++],n===0&&e)return o;if(n===0||n===3)continue;switch(n>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:o+=String.fromCharCode(n);break;case 12:case 13:r=i[a++],o+=String.fromCharCode((n&31)<<6|r&63);break;case 14:r=i[a++],s=i[a++],o+=String.fromCharCode((n&15)<<12|(r&63)<<6|(s&63)<<0);break}}return o}function Oo(i){let e="";for(let t=0;t<i.length;t++){let n=i[t].toString(16);n.length<2&&(n="0"+n),e+=n}return e}function IQ(i){return Uint8Array.from(i.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}function hpe(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var Bb={exports:{}},D7;function fpe(){return D7||(D7=1,(function(i,e){(function(t){var n=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,r=/^(?=([^\/?#]*))\1([^]*)$/,s=/(?:\/|^)\.(?=\/)/g,o=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,a={buildAbsoluteURL:function(l,c,u){if(u=u||{},l=l.trim(),c=c.trim(),!c){if(!u.alwaysNormalize)return l;var h=a.parseURL(l);if(!h)throw new Error("Error trying to parse base URL.");return h.path=a.normalizePath(h.path),a.buildURLFromParts(h)}var f=a.parseURL(c);if(!f)throw new Error("Error trying to parse relative URL.");if(f.scheme)return u.alwaysNormalize?(f.path=a.normalizePath(f.path),a.buildURLFromParts(f)):c;var d=a.parseURL(l);if(!d)throw new Error("Error trying to parse base URL.");if(!d.netLoc&&d.path&&d.path[0]!=="/"){var m=r.exec(d.path);d.netLoc=m[1],d.path=m[2]}d.netLoc&&!d.path&&(d.path="/");var y={scheme:d.scheme,netLoc:f.netLoc,path:null,params:f.params,query:f.query,fragment:f.fragment};if(!f.netLoc&&(y.netLoc=d.netLoc,f.path[0]!=="/"))if(!f.path)y.path=d.path,f.params||(y.params=d.params,f.query||(y.query=d.query));else{var g=d.path,A=g.substring(0,g.lastIndexOf("/")+1)+f.path;y.path=a.normalizePath(A)}return y.path===null&&(y.path=u.alwaysNormalize?a.normalizePath(f.path):f.path),a.buildURLFromParts(y)},parseURL:function(l){var c=n.exec(l);return c?{scheme:c[1]||"",netLoc:c[2]||"",path:c[3]||"",params:c[4]||"",query:c[5]||"",fragment:c[6]||""}:null},normalizePath:function(l){for(l=l.split("").reverse().join("").replace(s,"");l.length!==(l=l.replace(o,"")).length;);return l.split("").reverse().join("")},buildURLFromParts:function(l){return l.scheme+l.netLoc+l.path+l.params+l.query+l.fragment}};i.exports=a})()})(Bb)),Bb.exports}var OR=fpe();class y4{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var ar={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"};class NR{constructor(e){this._byteRange=null,this._url=null,this._stats=null,this._streams=null,this.base=void 0,this.relurl=void 0,typeof e=="string"&&(e={url:e}),this.base=e,dpe(this,"stats")}setByteRange(e,t){const n=e.split("@",2);let r;n.length===1?r=(t==null?void 0:t.byteRangeEndOffset)||0:r=parseInt(n[1]),this._byteRange=[r,parseInt(n[0])+r]}get baseurl(){return this.base.url}get byteRange(){return this._byteRange===null?[]:this._byteRange}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get elementaryStreams(){return this._streams===null&&(this._streams={[ar.AUDIO]:null,[ar.VIDEO]:null,[ar.AUDIOVIDEO]:null}),this._streams}set elementaryStreams(e){this._streams=e}get hasStats(){return this._stats!==null}get hasStreams(){return this._streams!==null}get stats(){return this._stats===null&&(this._stats=new y4),this._stats}set stats(e){this._stats=e}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=OR.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(e){this._url=e}clearElementaryStreamInfo(){const{elementaryStreams:e}=this;e[ar.AUDIO]=null,e[ar.VIDEO]=null,e[ar.AUDIOVIDEO]=null}}function As(i){return i.sn!=="initSegment"}class tS extends NR{constructor(e,t){super(t),this._decryptdata=null,this._programDateTime=null,this._ref=null,this._bitrate=void 0,this.rawProgramDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.playlistOffset=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.urlId=0,this.type=e}get byteLength(){if(this.hasStats){const e=this.stats.total;if(e)return e}if(this.byteRange.length){const e=this.byteRange[0],t=this.byteRange[1];if(jt(e)&&jt(t))return t-e}return null}get bitrate(){return this.byteLength?this.byteLength*8/this.duration:this._bitrate?this._bitrate:null}set bitrate(e){this._bitrate=e}get decryptdata(){var e;const{levelkeys:t}=this;if(!t||t.NONE)return null;if(t.identity)this._decryptdata||(this._decryptdata=t.identity.getDecryptData(this.sn));else if(!((e=this._decryptdata)!=null&&e.keyId)){const n=Object.keys(t);if(n.length===1){const r=this._decryptdata=t[n[0]]||null;r&&(this._decryptdata=r.getDecryptData(this.sn,t))}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(this.programDateTime===null)return null;const e=jt(this.duration)?this.duration:0;return this.programDateTime+e*1e3}get encrypted(){var e;if((e=this._decryptdata)!=null&&e.encrypted)return!0;if(this.levelkeys){var t;const n=Object.keys(this.levelkeys),r=n.length;if(r>1||r===1&&(t=this.levelkeys[n[0]])!=null&&t.encrypted)return!0}return!1}get programDateTime(){return this._programDateTime===null&&this.rawProgramDateTime&&(this.programDateTime=Date.parse(this.rawProgramDateTime)),this._programDateTime}set programDateTime(e){if(!jt(e)){this._programDateTime=this.rawProgramDateTime=null;return}this._programDateTime=e}get ref(){return As(this)?(this._ref||(this._ref={base:this.base,start:this.start,duration:this.duration,sn:this.sn,programDateTime:this.programDateTime}),this._ref):null}addStart(e){this.setStart(this.start+e)}setStart(e){this.start=e,this._ref&&(this._ref.start=e)}setDuration(e){this.duration=e,this._ref&&(this._ref.duration=e)}setKeyFormat(e){const t=this.levelkeys;if(t){var n;const r=t[e];r&&!((n=this._decryptdata)!=null&&n.keyId)&&(this._decryptdata=r.getDecryptData(this.sn,t))}}abortRequests(){var e,t;(e=this.loader)==null||e.abort(),(t=this.keyLoader)==null||t.abort()}setElementaryStreamInfo(e,t,n,r,s,o=!1){const{elementaryStreams:a}=this,l=a[e];if(!l){a[e]={startPTS:t,endPTS:n,startDTS:r,endDTS:s,partial:o};return}l.startPTS=Math.min(l.startPTS,t),l.endPTS=Math.max(l.endPTS,n),l.startDTS=Math.min(l.startDTS,r),l.endDTS=Math.max(l.endDTS,s)}}class MQ extends NR{constructor(e,t,n,r,s){super(n),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.duration=e.decimalFloatingPoint("DURATION"),this.gap=e.bool("GAP"),this.independent=e.bool("INDEPENDENT"),this.relurl=e.enumeratedString("URI"),this.fragment=t,this.index=r;const o=e.enumeratedString("BYTERANGE");o&&this.setByteRange(o,s),s&&(this.fragOffset=s.fragOffset+s.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:e}=this;return!!(e.audio||e.video||e.audiovideo)}}function RQ(i,e){const t=Object.getPrototypeOf(i);if(t){const n=Object.getOwnPropertyDescriptor(t,e);return n||RQ(t,e)}}function dpe(i,e){const t=RQ(i,e);t&&(t.enumerable=!0,Object.defineProperty(i,e,t))}const k7=Math.pow(2,32)-1,ppe=[].push,PQ={video:1,audio:2,id3:3,text:4};function Js(i){return String.fromCharCode.apply(null,i)}function LQ(i,e){const t=i[e]<<8|i[e+1];return t<0?65536+t:t}function Gn(i,e){const t=BQ(i,e);return t<0?4294967296+t:t}function F7(i,e){let t=Gn(i,e);return t*=Math.pow(2,32),t+=Gn(i,e+4),t}function BQ(i,e){return i[e]<<24|i[e+1]<<16|i[e+2]<<8|i[e+3]}function mpe(i){const e=i.byteLength;for(let t=0;t<e;){const n=Gn(i,t);if(n>8&&i[t+4]===109&&i[t+5]===111&&i[t+6]===111&&i[t+7]===102)return!0;t=n>1?t+n:e}return!1}function si(i,e){const t=[];if(!e.length)return t;const n=i.byteLength;for(let r=0;r<n;){const s=Gn(i,r),o=Js(i.subarray(r+4,r+8)),a=s>1?r+s:n;if(o===e[0])if(e.length===1)t.push(i.subarray(r+8,a));else{const l=si(i.subarray(r+8,a),e.slice(1));l.length&&ppe.apply(t,l)}r=a}return t}function gpe(i){const e=[],t=i[0];let n=8;const r=Gn(i,n);n+=4;let s=0,o=0;t===0?(s=Gn(i,n),o=Gn(i,n+4),n+=8):(s=F7(i,n),o=F7(i,n+8),n+=16),n+=2;let a=i.length+o;const l=LQ(i,n);n+=2;for(let c=0;c<l;c++){let u=n;const h=Gn(i,u);u+=4;const f=h&2147483647;if((h&2147483648)>>>31===1)return Ki.warn("SIDX has hierarchical references (not supported)"),null;const m=Gn(i,u);u+=4,e.push({referenceSize:f,subsegmentDuration:m,info:{duration:m/r,start:a,end:a+f-1}}),a+=f,u+=4,n=u}return{earliestPresentationTime:s,timescale:r,version:t,referencesCount:l,references:e}}function DQ(i){const e=[],t=si(i,["moov","trak"]);for(let r=0;r<t.length;r++){const s=t[r],o=si(s,["tkhd"])[0];if(o){let a=o[0];const l=Gn(o,a===0?12:20),c=si(s,["mdia","mdhd"])[0];if(c){a=c[0];const u=Gn(c,a===0?12:20),h=si(s,["mdia","hdlr"])[0];if(h){const f=Js(h.subarray(8,12)),d={soun:ar.AUDIO,vide:ar.VIDEO}[f],m=si(s,["mdia","minf","stbl","stsd"])[0],y=Ape(m);d?(e[l]={timescale:u,type:d,stsd:y},e[d]=Qi({timescale:u,id:l},y)):e[l]={timescale:u,type:f,stsd:y}}}}}return si(i,["moov","mvex","trex"]).forEach(r=>{const s=Gn(r,4),o=e[s];o&&(o.default={duration:Gn(r,12),flags:Gn(r,20)})}),e}function Ape(i){const e=i.subarray(8),t=e.subarray(86),n=Js(e.subarray(4,8));let r=n,s;const o=n==="enca"||n==="encv";if(o){const c=si(e,[n])[0].subarray(n==="enca"?28:78);si(c,["sinf"]).forEach(h=>{const f=si(h,["schm"])[0];if(f){const d=Js(f.subarray(4,8));if(d==="cbcs"||d==="cenc"){const m=si(h,["frma"])[0];m&&(r=Js(m))}}})}const a=r;switch(r){case"avc1":case"avc2":case"avc3":case"avc4":{const l=si(t,["avcC"])[0];l&&l.length>3&&(r+="."+$E(l[1])+$E(l[2])+$E(l[3]),s=YE(a==="avc1"?"dva1":"dvav",t));break}case"mp4a":{const l=si(e,[n])[0],c=si(l.subarray(28),["esds"])[0];if(c&&c.length>7){let u=4;if(c[u++]!==3)break;u=Db(c,u),u+=2;const h=c[u++];if(h&128&&(u+=2),h&64&&(u+=c[u++]),c[u++]!==4)break;u=Db(c,u);const f=c[u++];if(f===64)r+="."+$E(f);else break;if(u+=12,c[u++]!==5)break;u=Db(c,u);const d=c[u++];let m=(d&248)>>3;m===31&&(m+=1+((d&7)<<3)+((c[u]&224)>>5)),r+="."+m}break}case"hvc1":case"hev1":{const l=si(t,["hvcC"])[0];if(l&&l.length>12){const c=l[1],u=["","A","B","C"][c>>6],h=c&31,f=Gn(l,2),d=(c&32)>>5?"H":"L",m=l[12],y=l.subarray(6,12);r+="."+u+h,r+="."+ype(f).toString(16).toUpperCase(),r+="."+d+m;let g="";for(let A=y.length;A--;){const E=y[A];(E||g)&&(g="."+E.toString(16).toUpperCase()+g)}r+=g}s=YE(a=="hev1"?"dvhe":"dvh1",t);break}case"dvh1":case"dvhe":case"dvav":case"dva1":case"dav1":{r=YE(r,t)||r;break}case"vp09":{const l=si(t,["vpcC"])[0];if(l&&l.length>6){const c=l[4],u=l[5],h=l[6]>>4&15;r+="."+lh(c)+"."+lh(u)+"."+lh(h)}break}case"av01":{const l=si(t,["av1C"])[0];if(l&&l.length>2){const c=l[1]>>>5,u=l[1]&31,h=l[2]>>>7?"H":"M",f=(l[2]&64)>>6,d=(l[2]&32)>>5,m=c===2&&f?d?12:10:f?10:8,y=(l[2]&16)>>4,g=(l[2]&8)>>3,A=(l[2]&4)>>2,E=l[2]&3;r+="."+c+"."+lh(u)+h+"."+lh(m)+"."+y+"."+g+A+E+"."+lh(1)+"."+lh(1)+"."+lh(1)+"."+0,s=YE("dav1",t)}break}}return{codec:r,encrypted:o,supplemental:s}}function YE(i,e){const t=si(e,["dvvC"]),n=t.length?t[0]:si(e,["dvcC"])[0];if(n){const r=n[2]>>1&127,s=n[2]<<5&32|n[3]>>3&31;return i+"."+lh(r)+"."+lh(s)}}function ype(i){let e=0;for(let t=0;t<32;t++)e|=(i>>t&1)<<31-t;return e>>>0}function Db(i,e){const t=e+5;for(;i[e++]&128&&e<t;);return e}function $E(i){return("0"+i.toString(16).toUpperCase()).slice(-2)}function lh(i){return(i<10?"0":"")+i}function vpe(i,e){if(!i||!e)return;const t=e.keyId;t&&e.isCommonEncryption&&kQ(i,(n,r)=>{const s=n.subarray(8,24);s.some(o=>o!==0)||(Ki.log(`[eme] Patching keyId in 'enc${r?"a":"v"}>sinf>>tenc' box: ${Oo(s)} -> ${Oo(t)}`),n.set(t,8))})}function xpe(i){const e=[];return kQ(i,t=>e.push(t.subarray(8,24))),e}function kQ(i,e){si(i,["moov","trak"]).forEach(n=>{const r=si(n,["mdia","minf","stbl","stsd"])[0];if(!r)return;const s=r.subarray(8);let o=si(s,["enca"]);const a=o.length>0;a||(o=si(s,["encv"])),o.forEach(l=>{const c=a?l.subarray(28):l.subarray(78);si(c,["sinf"]).forEach(h=>{const f=FQ(h);f&&e(f,a)})})})}function FQ(i){const e=si(i,["schm"])[0];if(e){const t=Js(e.subarray(4,8));if(t==="cbcs"||t==="cenc"){const n=si(i,["schi","tenc"])[0];if(n)return n}}}function Epe(i,e,t){const n={},r=si(i,["moof","traf"]);for(let s=0;s<r.length;s++){const o=r[s],a=si(o,["tfhd"])[0],l=Gn(a,4),c=e[l];if(!c)continue;n[l]||(n[l]={start:NaN,duration:0,sampleCount:0,timescale:c.timescale,type:c.type});const u=n[l],h=si(o,["tfdt"])[0];if(h){const x=h[0];let w=Gn(h,4);x===1&&(w===k7?t.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"):(w*=k7+1,w+=Gn(h,8))),jt(w)&&(!jt(u.start)||w<u.start)&&(u.start=w)}const f=c.default,d=Gn(a,0)|(f==null?void 0:f.flags);let m=(f==null?void 0:f.duration)||0;d&8&&(d&2?m=Gn(a,12):m=Gn(a,8));const y=si(o,["trun"]);let g=u.start||0,A=0,E=m;for(let x=0;x<y.length;x++){const w=y[x],T=Gn(w,4),I=u.sampleCount;u.sampleCount+=T;const M=w[3]&1,L=w[3]&4,P=w[2]&1,R=w[2]&2,U=w[2]&4,k=w[2]&8;let H=8,G=T;for(M&&(H+=4),L&&T&&(!(w[H+1]&1)&&u.keyFrameIndex===void 0&&(u.keyFrameIndex=I),H+=4,P?(E=Gn(w,H),H+=4):E=m,R&&(H+=4),k&&(H+=4),g+=E,A+=E,G--);G--;)P?(E=Gn(w,H),H+=4):E=m,R&&(H+=4),U&&(w[H+1]&1||u.keyFrameIndex===void 0&&(u.keyFrameIndex=u.sampleCount-(G+1),u.keyFrameStart=g),H+=4),k&&(H+=4),g+=E,A+=E;!A&&m&&(A+=m*T)}u.duration+=A}if(!Object.keys(n).some(s=>n[s].duration)){let s=1/0,o=0;const a=si(i,["sidx"]);for(let l=0;l<a.length;l++){const c=gpe(a[l]);if(c!=null&&c.references){s=Math.min(s,c.earliestPresentationTime/c.timescale);const u=c.references.reduce((h,f)=>h+f.info.duration||0,0);o=Math.max(o,u+c.earliestPresentationTime/c.timescale)}}o&&jt(o)&&Object.keys(n).forEach(l=>{n[l].duration||(n[l].duration=o*n[l].timescale-n[l].start)})}return n}function _pe(i){const e={valid:null,remainder:null},t=si(i,["moof"]);if(t.length<2)return e.remainder=i,e;const n=t[t.length-1];return e.valid=i.slice(0,n.byteOffset-8),e.remainder=i.slice(n.byteOffset-8),e}function Ac(i,e){const t=new Uint8Array(i.length+e.length);return t.set(i),t.set(e,i.length),t}function O7(i,e){const t=[],n=e.samples,r=e.timescale,s=e.id;let o=!1;return si(n,["moof"]).map(l=>{const c=l.byteOffset-8;si(l,["traf"]).map(h=>{const f=si(h,["tfdt"]).map(d=>{const m=d[0];let y=Gn(d,4);return m===1&&(y*=Math.pow(2,32),y+=Gn(d,8)),y/r})[0];return f!==void 0&&(i=f),si(h,["tfhd"]).map(d=>{const m=Gn(d,4),y=Gn(d,0)&16777215,g=(y&1)!==0,A=(y&2)!==0,E=(y&8)!==0;let x=0;const w=(y&16)!==0;let T=0;const I=(y&32)!==0;let M=8;m===s&&(g&&(M+=8),A&&(M+=4),E&&(x=Gn(d,M),M+=4),w&&(T=Gn(d,M),M+=4),I&&(M+=4),e.type==="video"&&(o=v4(e.codec)),si(h,["trun"]).map(L=>{const P=L[0],R=Gn(L,0)&16777215,U=(R&1)!==0;let k=0;const H=(R&4)!==0,G=(R&256)!==0;let X=0;const Z=(R&512)!==0;let oe=0;const K=(R&1024)!==0,V=(R&2048)!==0;let W=0;const F=Gn(L,4);let Y=8;U&&(k=Gn(L,Y),Y+=4),H&&(Y+=4);let te=k+c;for(let q=0;q<F;q++){if(G?(X=Gn(L,Y),Y+=4):X=x,Z?(oe=Gn(L,Y),Y+=4):oe=T,K&&(Y+=4),V&&(P===0?W=Gn(L,Y):W=BQ(L,Y),Y+=4),e.type===ar.VIDEO){let J=0;for(;J<oe;){const re=Gn(n,te);if(te+=4,Spe(o,n[te])){const ie=n.subarray(te,te+re);UR(ie,o?2:1,i+W/r,t)}te+=re,J+=re+4}}i+=X/r}}))})})}),t}function v4(i){if(!i)return!1;const e=i.substring(0,4);return e==="hvc1"||e==="hev1"||e==="dvh1"||e==="dvhe"}function Spe(i,e){if(i){const t=e>>1&63;return t===39||t===40}else return(e&31)===6}function UR(i,e,t,n){const r=OQ(i);let s=0;s+=e;let o=0,a=0,l=0;for(;s<r.length;){o=0;do{if(s>=r.length)break;l=r[s++],o+=l}while(l===255);a=0;do{if(s>=r.length)break;l=r[s++],a+=l}while(l===255);const c=r.length-s;let u=s;if(a<c)s+=a;else if(a>c){Ki.error(`Malformed SEI payload. ${a} is too small, only ${c} bytes left to parse.`);break}if(o===4){if(r[u++]===181){const f=LQ(r,u);if(u+=2,f===49){const d=Gn(r,u);if(u+=4,d===1195456820){const m=r[u++];if(m===3){const y=r[u++],g=31&y,A=64&y,E=A?2+g*3:0,x=new Uint8Array(E);if(A){x[0]=y;for(let w=1;w<E;w++)x[w]=r[u++]}n.push({type:m,payloadType:o,pts:t,bytes:x})}}}}}else if(o===5&&a>16){const h=[];for(let m=0;m<16;m++){const y=r[u++].toString(16);h.push(y.length==1?"0"+y:y),(m===3||m===5||m===7||m===9)&&h.push("-")}const f=a-16,d=new Uint8Array(f);for(let m=0;m<f;m++)d[m]=r[u++];n.push({payloadType:o,pts:t,uuid:h.join(""),userData:Ll(d),userDataBytes:d})}}}function OQ(i){const e=i.byteLength,t=[];let n=1;for(;n<e-2;)i[n]===0&&i[n+1]===0&&i[n+2]===3?(t.push(n+2),n+=2):n++;if(t.length===0)return i;const r=e-t.length,s=new Uint8Array(r);let o=0;for(n=0;n<r;o++,n++)o===t[0]&&(o++,t.shift()),s[n]=i[o];return s}function wpe(i){const e=i[0];let t="",n="",r=0,s=0,o=0,a=0,l=0,c=0;if(e===0){for(;Js(i.subarray(c,c+1))!=="\0";)t+=Js(i.subarray(c,c+1)),c+=1;for(t+=Js(i.subarray(c,c+1)),c+=1;Js(i.subarray(c,c+1))!=="\0";)n+=Js(i.subarray(c,c+1)),c+=1;n+=Js(i.subarray(c,c+1)),c+=1,r=Gn(i,12),s=Gn(i,16),a=Gn(i,20),l=Gn(i,24),c=28}else if(e===1){c+=4,r=Gn(i,c),c+=4;const h=Gn(i,c);c+=4;const f=Gn(i,c);for(c+=4,o=2**32*h+f,tpe(o)||(o=Number.MAX_SAFE_INTEGER,Ki.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),a=Gn(i,c),c+=4,l=Gn(i,c),c+=4;Js(i.subarray(c,c+1))!=="\0";)t+=Js(i.subarray(c,c+1)),c+=1;for(t+=Js(i.subarray(c,c+1)),c+=1;Js(i.subarray(c,c+1))!=="\0";)n+=Js(i.subarray(c,c+1)),c+=1;n+=Js(i.subarray(c,c+1)),c+=1}const u=i.subarray(c,i.byteLength);return{schemeIdUri:t,value:n,timeScale:r,presentationTime:o,presentationTimeDelta:s,eventDuration:a,id:l,payload:u}}function Cpe(i,...e){const t=e.length;let n=8,r=t;for(;r--;)n+=e[r].byteLength;const s=new Uint8Array(n);for(s[0]=n>>24&255,s[1]=n>>16&255,s[2]=n>>8&255,s[3]=n&255,s.set(i,4),r=0,n=8;r<t;r++)s.set(e[r],n),n+=e[r].byteLength;return s}function Tpe(i,e,t){if(i.byteLength!==16)throw new RangeError("Invalid system id");let n,r;n=0,r=new Uint8Array;let s;n>0?(s=new Uint8Array(4),e.length>0&&new DataView(s.buffer).setUint32(0,e.length,!1)):s=new Uint8Array;const o=new Uint8Array(4);return t.byteLength>0&&new DataView(o.buffer).setUint32(0,t.byteLength,!1),Cpe([112,115,115,104],new Uint8Array([n,0,0,0]),i,s,r,o,t)}function bpe(i){const e=[];if(i instanceof ArrayBuffer){const t=i.byteLength;let n=0;for(;n+32<t;){const r=new DataView(i,n),s=Ipe(r);e.push(s),n+=s.size}}return e}function Ipe(i){const e=i.getUint32(0),t=i.byteOffset,n=i.byteLength;if(n<e)return{offset:t,size:n};if(i.getUint32(4)!==1886614376)return{offset:t,size:e};const s=i.getUint32(8)>>>24;if(s!==0&&s!==1)return{offset:t,size:e};const o=i.buffer,a=Oo(new Uint8Array(o,t+12,16));let l=null,c=null,u=0;if(s===0)u=28;else{const f=i.getUint32(28);if(!f||n<32+f*16)return{offset:t,size:e};l=[];for(let d=0;d<f;d++)l.push(new Uint8Array(o,t+32+d*16,16));u=32+f*16}if(!u)return{offset:t,size:e};const h=i.getUint32(u);return e-32<h?{offset:t,size:e}:(c=new Uint8Array(o,t+u+4,h),{version:s,systemId:a,kids:l,data:c,offset:t,size:e})}const NQ=()=>/\(Windows.+Firefox\//i.test(navigator.userAgent),uA={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,dav1:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function zR(i,e){const t=uA[e];return!!t&&!!t[i.slice(0,4)]}function j2(i,e,t=!0){return!i.split(",").some(n=>!GR(n,e,t))}function GR(i,e,t=!0){var n;const r=Uf(t);return(n=r==null?void 0:r.isTypeSupported(W2(i,e)))!=null?n:!1}function W2(i,e){return`${e}/mp4;codecs=${i}`}function N7(i){if(i){const e=i.substring(0,4);return uA.video[e]}return 2}function QS(i){const e=NQ();return i.split(",").reduce((t,n)=>{const s=e&&v4(n)?9:uA.video[n];return s?(s*2+t)/(t?3:2):(uA.audio[n]+t)/(t?2:1)},0)}const kb={};function Mpe(i,e=!0){if(kb[i])return kb[i];const t={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"],"mp4a.40.34":["mp3"]}[i];for(let r=0;r<t.length;r++){var n;if(GR(t[r],"audio",e))return kb[i]=t[r],t[r];if(t[r]==="mp3"&&(n=Uf(e))!=null&&n.isTypeSupported("audio/mpeg"))return""}return i}const Rpe=/flac|opus|mp4a\.40\.34/i;function VS(i,e=!0){return i.replace(Rpe,t=>Mpe(t.toLowerCase(),e))}function Ppe(i,e){const t=[];if(i){const n=i.split(",");for(let r=0;r<n.length;r++)zR(n[r],"video")||t.push(n[r])}return e&&t.push(e),t.join(",")}function nS(i,e){if(i&&(i.length>4||["ac-3","ec-3","alac","fLaC","Opus"].indexOf(i)!==-1)&&(U7(i,"audio")||U7(i,"video")))return i;if(e){const t=e.split(",");if(t.length>1){if(i){for(let n=t.length;n--;)if(t[n].substring(0,4)===i.substring(0,4))return t[n]}return t[0]}}return e||i}function U7(i,e){return zR(i,e)&&GR(i,e)}function Lpe(i){const e=i.split(",");for(let t=0;t<e.length;t++){const n=e[t].split(".");n.length>2&&n[0]==="avc1"&&(e[t]=`avc1.${parseInt(n[1]).toString(16)}${("000"+parseInt(n[2]).toString(16)).slice(-4)}`)}return e.join(",")}function Bpe(i){if(i.startsWith("av01.")){const e=i.split("."),t=["0","111","01","01","01","0"];for(let n=e.length;n>4&&n<10;n++)e[n]=t[n-4];return e.join(".")}return i}function z7(i){const e=Uf(i)||{isTypeSupported:()=>!1};return{mpeg:e.isTypeSupported("audio/mpeg"),mp3:e.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:e.isTypeSupported('audio/mp4; codecs="ac-3"')}}function v5(i){return i.replace(/^.+codecs=["']?([^"']+).*$/,"$1")}const Dpe={supported:!0,powerEfficient:!0,smooth:!0},kpe={supported:!1,smooth:!1,powerEfficient:!1},UQ={supported:!0,configurations:[],decodingInfoResults:[Dpe]};function zQ(i,e){return{supported:!1,configurations:e,decodingInfoResults:[kpe],error:i}}function Fpe(i,e,t,n,r,s){const o=i.videoCodec,a=i.audioCodec?i.audioGroups:null,l=s==null?void 0:s.audioCodec,c=s==null?void 0:s.channels,u=c?parseInt(c):l?1/0:2;let h=null;if(a!=null&&a.length)try{a.length===1&&a[0]?h=e.groups[a[0]].channels:h=a.reduce((f,d)=>{if(d){const m=e.groups[d];if(!m)throw new Error(`Audio track group ${d} not found`);Object.keys(m.channels).forEach(y=>{f[y]=(f[y]||0)+m.channels[y]})}return f},{2:0})}catch{return!0}return o!==void 0&&(o.split(",").some(f=>v4(f))||i.width>1920&&i.height>1088||i.height>1920&&i.width>1088||i.frameRate>Math.max(n,30)||i.videoRange!=="SDR"&&i.videoRange!==t||i.bitrate>Math.max(r,8e6))||!!h&&jt(u)&&Object.keys(h).some(f=>parseInt(f)>u)}function GQ(i,e,t,n={}){const r=i.videoCodec;if(!r&&!i.audioCodec||!t)return Promise.resolve(UQ);const s=[],o=Ope(i),a=o.length,l=Npe(i,e,a>0),c=l.length;for(let u=a||1*c||1;u--;){const h={type:"media-source"};if(a&&(h.video=o[u%a]),c){h.audio=l[u%c];const f=h.audio.bitrate;h.video&&f&&(h.video.bitrate-=f)}s.push(h)}if(r){const u=navigator.userAgent;if(r.split(",").some(h=>v4(h))&&NQ())return Promise.resolve(zQ(new Error(`Overriding Windows Firefox HEVC MediaCapabilities result based on user-agent string: (${u})`),s))}return Promise.all(s.map(u=>{const h=zpe(u);return n[h]||(n[h]=t.decodingInfo(u))})).then(u=>({supported:!u.some(h=>!h.supported),configurations:s,decodingInfoResults:u})).catch(u=>({supported:!1,configurations:s,decodingInfoResults:[],error:u}))}function Ope(i){var e;const t=(e=i.videoCodec)==null?void 0:e.split(","),n=HQ(i),r=i.width||640,s=i.height||480,o=i.frameRate||30,a=i.videoRange.toLowerCase();return t?t.map(l=>{const c={contentType:W2(Bpe(l),"video"),width:r,height:s,bitrate:n,framerate:o};return a!=="sdr"&&(c.transferFunction=a),c}):[]}function Npe(i,e,t){var n;const r=(n=i.audioCodec)==null?void 0:n.split(","),s=HQ(i);return r&&i.audioGroups?i.audioGroups.reduce((o,a)=>{var l;const c=a?(l=e.groups[a])==null?void 0:l.tracks:null;return c?c.reduce((u,h)=>{if(h.groupId===a){const f=parseFloat(h.channels||"");r.forEach(d=>{const m={contentType:W2(d,"audio"),bitrate:t?Upe(d,s):s};f&&(m.channels=""+f),u.push(m)})}return u},o):o},[]):[]}function Upe(i,e){if(e<=1)return 1;let t=128e3;return i==="ec-3"?t=768e3:i==="ac-3"&&(t=64e4),Math.min(e/2,t)}function HQ(i){return Math.ceil(Math.max(i.bitrate*.9,i.averageBitrate)/1e3)*1e3||1}function zpe(i){let e="";const{audio:t,video:n}=i;if(n){const r=v5(n.contentType);e+=`${r}_r${n.height}x${n.width}f${Math.ceil(n.framerate)}${n.transferFunction||"sd"}_${Math.ceil(n.bitrate/1e5)}`}if(t){const r=v5(t.contentType);e+=`${n?"_":""}${r}_c${t.channels}`}return e}const x5=["NONE","TYPE-0","TYPE-1",null];function Gpe(i){return x5.indexOf(i)>-1}const jS=["SDR","PQ","HLG"];function Hpe(i){return!!i&&jS.indexOf(i)>-1}var c2={No:"",Yes:"YES",v2:"v2"};function G7(i){const{canSkipUntil:e,canSkipDateRanges:t,age:n}=i,r=n<e/2;return e&&r?t?c2.v2:c2.Yes:c2.No}class E5{constructor(e,t,n){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=t,this.skip=n}addDirectives(e){const t=new self.URL(e);return this.msn!==void 0&&t.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href}}class hA{constructor(e){if(this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.supplemental=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[e.url],this._attrs=[e.attrs],this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.frameRate=e.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=e.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.codecSet=[e.videoCodec,e.audioCodec].filter(n=>!!n).map(n=>n.substring(0,4)).join(","),"supplemental"in e){var t;this.supplemental=e.supplemental;const n=(t=e.supplemental)==null?void 0:t.videoCodec;n&&n!==e.videoCodec&&(this.codecSet+=`,${n.substring(0,4)}`)}this.addGroupId("audio",e.attrs.AUDIO),this.addGroupId("text",e.attrs.SUBTITLES)}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get averageBitrate(){return this._avgBitrate||this.realBitrate||this.bitrate}get attrs(){return this._attrs[0]}get codecs(){return this.attrs.CODECS||""}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get videoRange(){return this.attrs["VIDEO-RANGE"]||"SDR"}get score(){return this.attrs.optionalFloat("SCORE",0)}get uri(){return this.url[0]||""}hasAudioGroup(e){return H7(this._audioGroups,e)}hasSubtitleGroup(e){return H7(this._subtitleGroups,e)}get audioGroups(){return this._audioGroups}get subtitleGroups(){return this._subtitleGroups}addGroupId(e,t){if(t){if(e==="audio"){let n=this._audioGroups;n||(n=this._audioGroups=[]),n.indexOf(t)===-1&&n.push(t)}else if(e==="text"){let n=this._subtitleGroups;n||(n=this._subtitleGroups=[]),n.indexOf(t)===-1&&n.push(t)}}}get urlId(){return 0}set urlId(e){}get audioGroupIds(){return this.audioGroups?[this.audioGroupId]:void 0}get textGroupIds(){return this.subtitleGroups?[this.textGroupId]:void 0}get audioGroupId(){var e;return(e=this.audioGroups)==null?void 0:e[0]}get textGroupId(){var e;return(e=this.subtitleGroups)==null?void 0:e[0]}addFallback(){}}function H7(i,e){return!e||!i?!1:i.indexOf(e)!==-1}function Qpe(){if(typeof matchMedia=="function"){const i=matchMedia("(dynamic-range: high)"),e=matchMedia("bad query");if(i.media!==e.media)return i.matches===!0}return!1}function Vpe(i,e){let t=!1,n=[];if(i&&(t=i!=="SDR",n=[i]),e){n=e.allowedVideoRanges||jS.slice(0);const r=n.join("")!=="SDR"&&!e.videoCodec;t=e.preferHDR!==void 0?e.preferHDR:r&&Qpe(),t||(n=["SDR"])}return{preferHDR:t,allowedVideoRanges:n}}const jpe=i=>{const e=new WeakSet;return(t,n)=>{if(i&&(n=i(t,n)),typeof n=="object"&&n!==null){if(e.has(n))return;e.add(n)}return n}},lr=(i,e)=>JSON.stringify(i,jpe(e));function Wpe(i,e,t,n,r){const s=Object.keys(i),o=n==null?void 0:n.channels,a=n==null?void 0:n.audioCodec,l=r==null?void 0:r.videoCodec,c=o&&parseInt(o)===2;let u=!1,h=!1,f=1/0,d=1/0,m=1/0,y=1/0,g=0,A=[];const{preferHDR:E,allowedVideoRanges:x}=Vpe(e,r);for(let L=s.length;L--;){const P=i[s[L]];u||(u=P.channels[2]>0),f=Math.min(f,P.minHeight),d=Math.min(d,P.minFramerate),m=Math.min(m,P.minBitrate),x.filter(U=>P.videoRanges[U]>0).length>0&&(h=!0)}f=jt(f)?f:0,d=jt(d)?d:0;const w=Math.max(1080,f),T=Math.max(30,d);m=jt(m)?m:t,t=Math.max(m,t),h||(e=void 0);const I=s.length>1;return{codecSet:s.reduce((L,P)=>{const R=i[P];if(P===L)return L;if(A=h?x.filter(U=>R.videoRanges[U]>0):[],I){if(R.minBitrate>t)return rh(P,`min bitrate of ${R.minBitrate} > current estimate of ${t}`),L;if(!R.hasDefaultAudio)return rh(P,"no renditions with default or auto-select sound found"),L;if(a&&P.indexOf(a.substring(0,4))%5!==0)return rh(P,`audio codec preference "${a}" not found`),L;if(o&&!c){if(!R.channels[o])return rh(P,`no renditions with ${o} channel sound found (channels options: ${Object.keys(R.channels)})`),L}else if((!a||c)&&u&&R.channels[2]===0)return rh(P,"no renditions with stereo sound found"),L;if(R.minHeight>w)return rh(P,`min resolution of ${R.minHeight} > maximum of ${w}`),L;if(R.minFramerate>T)return rh(P,`min framerate of ${R.minFramerate} > maximum of ${T}`),L;if(!A.some(U=>R.videoRanges[U]>0))return rh(P,`no variants with VIDEO-RANGE of ${lr(A)} found`),L;if(l&&P.indexOf(l.substring(0,4))%5!==0)return rh(P,`video codec preference "${l}" not found`),L;if(R.maxScore<g)return rh(P,`max score of ${R.maxScore} < selected max of ${g}`),L}return L&&(QS(P)>=QS(L)||R.fragmentError>i[L].fragmentError)?L:(y=R.minIndex,g=R.maxScore,P)},void 0),videoRanges:A,preferHDR:E,minFramerate:d,minBitrate:m,minIndex:y}}function rh(i,e){Ki.log(`[abr] start candidates with "${i}" ignored because ${e}`)}function QQ(i){return i.reduce((e,t)=>{let n=e.groups[t.groupId];n||(n=e.groups[t.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),n.tracks.push(t);const r=t.channels||"2";return n.channels[r]=(n.channels[r]||0)+1,n.hasDefault=n.hasDefault||t.default,n.hasAutoSelect=n.hasAutoSelect||t.autoselect,n.hasDefault&&(e.hasDefaultAudio=!0),n.hasAutoSelect&&(e.hasAutoSelectAudio=!0),e},{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function Kpe(i,e,t,n){return i.slice(t,n+1).reduce((r,s,o)=>{if(!s.codecSet)return r;const a=s.audioGroups;let l=r[s.codecSet];l||(r[s.codecSet]=l={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,minIndex:o,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!a,fragmentError:0}),l.minBitrate=Math.min(l.minBitrate,s.bitrate);const c=Math.min(s.height,s.width);return l.minHeight=Math.min(l.minHeight,c),l.minFramerate=Math.min(l.minFramerate,s.frameRate),l.minIndex=Math.min(l.minIndex,o),l.maxScore=Math.max(l.maxScore,s.score),l.fragmentError+=s.fragmentError,l.videoRanges[s.videoRange]=(l.videoRanges[s.videoRange]||0)+1,a&&a.forEach(u=>{if(!u)return;const h=e.groups[u];h&&(l.hasDefaultAudio=l.hasDefaultAudio||e.hasDefaultAudio?h.hasDefault:h.hasAutoSelect||!e.hasDefaultAudio&&!e.hasAutoSelectAudio,Object.keys(h.channels).forEach(f=>{l.channels[f]=(l.channels[f]||0)+h.channels[f]}))}),r},{})}function Q7(i){if(!i)return i;const{lang:e,assocLang:t,characteristics:n,channels:r,audioCodec:s}=i;return{lang:e,assocLang:t,characteristics:n,channels:r,audioCodec:s}}function Ah(i,e,t){if("attrs"in i){const n=e.indexOf(i);if(n!==-1)return n}for(let n=0;n<e.length;n++){const r=e[n];if(jm(i,r,t))return n}return-1}function jm(i,e,t){const{groupId:n,name:r,lang:s,assocLang:o,default:a}=i,l=i.forced;return(n===void 0||e.groupId===n)&&(r===void 0||e.name===r)&&(s===void 0||Ype(s,e.lang))&&(s===void 0||e.assocLang===o)&&(a===void 0||e.default===a)&&(l===void 0||e.forced===l)&&(!("characteristics"in i)||$pe(i.characteristics||"",e.characteristics))&&(t===void 0||t(i,e))}function Ype(i,e="--"){return i.length===e.length?i===e:i.startsWith(e)||e.startsWith(i)}function $pe(i,e=""){const t=i.split(","),n=e.split(",");return t.length===n.length&&!t.some(r=>n.indexOf(r)===-1)}function Cm(i,e){const{audioCodec:t,channels:n}=i;return(t===void 0||(e.audioCodec||"").substring(0,4)===t.substring(0,4))&&(n===void 0||n===(e.channels||"2"))}function Xpe(i,e,t,n,r){const s=e[n],a=e.reduce((f,d,m)=>{const y=d.uri;return(f[y]||(f[y]=[])).push(m),f},{})[s.uri];a.length>1&&(n=Math.max.apply(Math,a));const l=s.videoRange,c=s.frameRate,u=s.codecSet.substring(0,4),h=V7(e,n,f=>{if(f.videoRange!==l||f.frameRate!==c||f.codecSet.substring(0,4)!==u)return!1;const d=f.audioGroups,m=t.filter(y=>!d||d.indexOf(y.groupId)!==-1);return Ah(i,m,r)>-1});return h>-1?h:V7(e,n,f=>{const d=f.audioGroups,m=t.filter(y=>!d||d.indexOf(y.groupId)!==-1);return Ah(i,m,r)>-1})}function V7(i,e,t){for(let n=e;n>-1;n--)if(t(i[n]))return n;for(let n=e+1;n<i.length;n++)if(t(i[n]))return n;return-1}function WS(i,e){var t;return!!i&&i!==((t=e.loadLevelObj)==null?void 0:t.uri)}class VQ extends _c{constructor(e){super("abr",e.logger),this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.rebufferNotice=-1,this.supportedCache={},this.bwEstimator=void 0,this._abandonRulesCheck=t=>{var n;const{fragCurrent:r,partCurrent:s,hls:o}=this,{autoLevelEnabled:a,media:l}=o;if(!r||!l)return;const c=performance.now(),u=s?s.stats:r.stats,h=s?s.duration:r.duration,f=c-u.loading.start,d=o.minAutoLevel,m=r.level,y=this._nextAutoLevel;if(u.aborted||u.loaded&&u.loaded===u.total||m<=d){this.clearTimer(),this._nextAutoLevel=-1;return}if(!a)return;const g=y>-1&&y!==m,A=!!t||g;if(!A&&(l.paused||!l.playbackRate||!l.readyState))return;const E=o.mainForwardBufferInfo;if(!A&&E===null)return;const x=this.bwEstimator.getEstimateTTFB(),w=Math.abs(l.playbackRate);if(f<=Math.max(x,1e3*(h/(w*2))))return;const T=E?E.len/w:0,I=u.loading.first?u.loading.first-u.loading.start:-1,M=u.loaded&&I>-1,L=this.getBwEstimate(),P=o.levels,R=P[m],U=Math.max(u.loaded,Math.round(h*(r.bitrate||R.averageBitrate)/8));let k=M?f-I:f;k<1&&M&&(k=Math.min(f,u.loaded*8/L));const H=M?u.loaded*1e3/k:0,G=x/1e3,X=H?(U-u.loaded)/H:U*8/L+G;if(X<=T)return;const Z=H?H*8:L,oe=((n=(t==null?void 0:t.details)||this.hls.latestLevelDetails)==null?void 0:n.live)===!0,K=this.hls.config.abrBandWidthUpFactor;let V=Number.POSITIVE_INFINITY,W;for(W=m-1;W>d;W--){const q=P[W].maxBitrate,J=!P[W].details||oe;if(V=this.getTimeToLoadFrag(G,Z,h*q,J),V<Math.min(T,h+G))break}if(V>=X||V>h*10)return;M?this.bwEstimator.sample(f-Math.min(x,I),u.loaded):this.bwEstimator.sampleTTFB(f);const F=P[W].maxBitrate;this.getBwEstimate()*K>F&&this.resetEstimator(F);const Y=this.findBestLevel(F,d,W,0,T,1,1);Y>-1&&(W=Y),this.warn(`Fragment ${r.sn}${s?" part "+s.index:""} of level ${m} is loading too slowly;
      Fragment duration: ${r.duration.toFixed(3)}
      Time to underbuffer: ${T.toFixed(3)} s
      Estimated load time for current fragment: ${X.toFixed(3)} s
      Estimated load time for down switch fragment: ${V.toFixed(3)} s
      TTFB estimate: ${I|0} ms
      Current BW estimate: ${jt(L)?L|0:"Unknown"} bps
      New BW estimate: ${this.getBwEstimate()|0} bps
      Switching to level ${W} @ ${F|0} bps`),o.nextLoadLevel=o.nextAutoLevel=W,this.clearTimer();const te=()=>{if(this.clearTimer(),this.fragCurrent===r&&this.hls.loadLevel===W&&W>0){const q=this.getStarvationDelay();if(this.warn(`Aborting inflight request ${W>0?"and switching down":""}
      Fragment duration: ${r.duration.toFixed(3)} s
      Time to underbuffer: ${q.toFixed(3)} s`),r.abortRequests(),this.fragCurrent=this.partCurrent=null,W>d){let J=this.findBestLevel(this.hls.levels[d].bitrate,d,W,0,q,1,1);J===-1&&(J=d),this.hls.nextLoadLevel=this.hls.nextAutoLevel=J,this.resetEstimator(this.hls.levels[J].bitrate)}}};g||X>V*2?te():this.timer=self.setInterval(te,V*1e3),o.trigger(ae.FRAG_LOAD_EMERGENCY_ABORTED,{frag:r,part:s,stats:u})},this.hls=e,this.bwEstimator=this.initEstimator(),this.registerListeners()}resetEstimator(e){e&&(this.log(`setting initial bwe to ${e}`),this.hls.config.abrEwmaDefaultEstimate=e),this.firstSelection=-1,this.bwEstimator=this.initEstimator()}initEstimator(){const e=this.hls.config;return new ipe(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate)}registerListeners(){const{hls:e}=this;e.on(ae.MANIFEST_LOADING,this.onManifestLoading,this),e.on(ae.FRAG_LOADING,this.onFragLoading,this),e.on(ae.FRAG_LOADED,this.onFragLoaded,this),e.on(ae.FRAG_BUFFERED,this.onFragBuffered,this),e.on(ae.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(ae.LEVEL_LOADED,this.onLevelLoaded,this),e.on(ae.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(ae.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.on(ae.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e&&(e.off(ae.MANIFEST_LOADING,this.onManifestLoading,this),e.off(ae.FRAG_LOADING,this.onFragLoading,this),e.off(ae.FRAG_LOADED,this.onFragLoaded,this),e.off(ae.FRAG_BUFFERED,this.onFragBuffered,this),e.off(ae.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(ae.LEVEL_LOADED,this.onLevelLoaded,this),e.off(ae.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(ae.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.off(ae.ERROR,this.onError,this))}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=this.supportedCache=null,this.fragCurrent=this.partCurrent=null}onManifestLoading(e,t){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.supportedCache={},this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()}onLevelsUpdated(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null}onMaxAutoLevelUpdated(){this.firstSelection=-1,this.nextAutoLevelKey=""}onFragLoading(e,t){const n=t.frag;if(!this.ignoreFragment(n)){if(!n.bitrateTest){var r;this.fragCurrent=n,this.partCurrent=(r=t.part)!=null?r:null}this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}}onLevelSwitching(e,t){this.clearTimer()}onError(e,t){if(!t.fatal)switch(t.details){case Ke.BUFFER_ADD_CODEC_ERROR:case Ke.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case Ke.FRAG_LOAD_TIMEOUT:{const n=t.frag,{fragCurrent:r,partCurrent:s}=this;if(n&&r&&n.sn===r.sn&&n.level===r.level){const o=performance.now(),a=s?s.stats:n.stats,l=o-a.loading.start,c=a.loading.first?a.loading.first-a.loading.start:-1;if(a.loaded&&c>-1){const h=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(l-Math.min(h,c),a.loaded)}else this.bwEstimator.sampleTTFB(l)}break}}}getTimeToLoadFrag(e,t,n,r){const s=e+n/t,o=r?e+this.lastLevelLoadSec:0;return s+o}onLevelLoaded(e,t){const n=this.hls.config,{loading:r}=t.stats,s=r.end-r.first;jt(s)&&(this.lastLevelLoadSec=s/1e3),t.details.live?this.bwEstimator.update(n.abrEwmaSlowLive,n.abrEwmaFastLive):this.bwEstimator.update(n.abrEwmaSlowVoD,n.abrEwmaFastVoD),this.timer>-1&&this._abandonRulesCheck(t.levelInfo)}onFragLoaded(e,{frag:t,part:n}){const r=n?n.stats:t.stats;if(t.type===$t.MAIN&&this.bwEstimator.sampleTTFB(r.loading.first-r.loading.start),!this.ignoreFragment(t)){if(this.clearTimer(),t.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){const s=n?n.duration:t.duration,o=this.hls.levels[t.level],a=(o.loaded?o.loaded.bytes:0)+r.loaded,l=(o.loaded?o.loaded.duration:0)+s;o.loaded={bytes:a,duration:l},o.realBitrate=Math.round(8*a/l)}if(t.bitrateTest){const s={stats:r,frag:t,part:n,id:t.type};this.onFragBuffered(ae.FRAG_BUFFERED,s),t.bitrateTest=!1}else this.lastLoadedFragLevel=t.level}}onFragBuffered(e,t){const{frag:n,part:r}=t,s=r!=null&&r.stats.loaded?r.stats:n.stats;if(s.aborted||this.ignoreFragment(n))return;const o=s.parsing.end-s.loading.start-Math.min(s.loading.first-s.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(o,s.loaded),s.bwEstimate=this.getBwEstimate(),n.bitrateTest?this.bitrateTestDelay=o/1e3:this.bitrateTestDelay=0}ignoreFragment(e){return e.type!==$t.MAIN||e.sn==="initSegment"}clearTimer(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)}get firstAutoLevel(){const{maxAutoLevel:e,minAutoLevel:t}=this.hls,n=this.getBwEstimate(),r=this.hls.config.maxStarvationDelay,s=this.findBestLevel(n,t,e,0,r,1,1);if(s>-1)return s;const o=this.hls.firstLevel,a=Math.min(Math.max(o,t),e);return this.warn(`Could not find best starting auto level. Defaulting to first in playlist ${o} clamped to ${a}`),a}get forcedAutoLevel(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}get nextAutoLevel(){const e=this.forcedAutoLevel,n=this.bwEstimator.canEstimate(),r=this.lastLoadedFragLevel>-1;if(e!==-1&&(!n||!r||this.nextAutoLevelKey===this.getAutoLevelKey()))return e;const s=n&&r?this.getNextABRAutoLevel():this.firstAutoLevel;if(e!==-1){const o=this.hls.levels;if(o.length>Math.max(e,s)&&o[e].loadError<=o[s].loadError)return e}return this._nextAutoLevel=s,this.nextAutoLevelKey=this.getAutoLevelKey(),s}getAutoLevelKey(){return`${this.getBwEstimate()}_${this.getStarvationDelay().toFixed(2)}`}getNextABRAutoLevel(){const{fragCurrent:e,partCurrent:t,hls:n}=this;if(n.levels.length<=1)return n.loadLevel;const{maxAutoLevel:r,config:s,minAutoLevel:o}=n,a=t?t.duration:e?e.duration:0,l=this.getBwEstimate(),c=this.getStarvationDelay();let u=s.abrBandWidthFactor,h=s.abrBandWidthUpFactor;if(c){const g=this.findBestLevel(l,o,r,c,0,u,h);if(g>=0)return this.rebufferNotice=-1,g}let f=a?Math.min(a,s.maxStarvationDelay):s.maxStarvationDelay;if(!c){const g=this.bitrateTestDelay;g&&(f=(a?Math.min(a,s.maxLoadingDelay):s.maxLoadingDelay)-g,this.info(`bitrate test took ${Math.round(1e3*g)}ms, set first fragment max fetchDuration to ${Math.round(1e3*f)} ms`),u=h=1)}const d=this.findBestLevel(l,o,r,c,f,u,h);if(this.rebufferNotice!==d&&(this.rebufferNotice=d,this.info(`${c?"rebuffering expected":"buffer is empty"}, optimal quality level ${d}`)),d>-1)return d;const m=n.levels[o],y=n.loadLevelObj;return y&&(m==null?void 0:m.bitrate)<y.bitrate?o:n.loadLevel}getStarvationDelay(){const e=this.hls,t=e.media;if(!t)return 1/0;const n=t&&t.playbackRate!==0?Math.abs(t.playbackRate):1,r=e.mainForwardBufferInfo;return(r?r.len:0)/n}getBwEstimate(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate}findBestLevel(e,t,n,r,s,o,a){var l;const c=r+s,u=this.lastLoadedFragLevel,h=u===-1?this.hls.firstLevel:u,{fragCurrent:f,partCurrent:d}=this,{levels:m,allAudioTracks:y,loadLevel:g,config:A}=this.hls;if(m.length===1)return 0;const E=m[h],x=!!((l=this.hls.latestLevelDetails)!=null&&l.live),w=g===-1||u===-1;let T,I="SDR",M=(E==null?void 0:E.frameRate)||0;const{audioPreference:L,videoPreference:P}=A,R=this.audioTracksByGroup||(this.audioTracksByGroup=QQ(y));let U=-1;if(w){if(this.firstSelection!==-1)return this.firstSelection;const Z=this.codecTiers||(this.codecTiers=Kpe(m,R,t,n)),oe=Wpe(Z,I,e,L,P),{codecSet:K,videoRanges:V,minFramerate:W,minBitrate:F,minIndex:Y,preferHDR:te}=oe;U=Y,T=K,I=te?V[V.length-1]:V[0],M=W,e=Math.max(e,F),this.log(`picked start tier ${lr(oe)}`)}else T=E==null?void 0:E.codecSet,I=E==null?void 0:E.videoRange;const k=d?d.duration:f?f.duration:0,H=this.bwEstimator.getEstimateTTFB()/1e3,G=[];for(let Z=n;Z>=t;Z--){var X;const oe=m[Z],K=Z>h;if(!oe)continue;if(A.useMediaCapabilities&&!oe.supportedResult&&!oe.supportedPromise){const J=navigator.mediaCapabilities;typeof(J==null?void 0:J.decodingInfo)=="function"&&Fpe(oe,R,I,M,e,L)?(oe.supportedPromise=GQ(oe,R,J,this.supportedCache),oe.supportedPromise.then(re=>{if(!this.hls)return;oe.supportedResult=re;const ie=this.hls.levels,se=ie.indexOf(oe);re.error?this.warn(`MediaCapabilities decodingInfo error: "${re.error}" for level ${se} ${lr(re)}`):re.supported?re.decodingInfoResults.some(ge=>ge.smooth===!1||ge.powerEfficient===!1)&&this.log(`MediaCapabilities decodingInfo for level ${se} not smooth or powerEfficient: ${lr(re)}`):(this.warn(`Unsupported MediaCapabilities decodingInfo result for level ${se} ${lr(re)}`),se>-1&&ie.length>1&&(this.log(`Removing unsupported level ${se}`),this.hls.removeLevel(se),this.hls.loadLevel===-1&&(this.hls.nextLoadLevel=0)))}).catch(re=>{this.warn(`Error handling MediaCapabilities decodingInfo: ${re}`)})):oe.supportedResult=UQ}if((T&&oe.codecSet!==T||I&&oe.videoRange!==I||K&&M>oe.frameRate||!K&&M>0&&M<oe.frameRate||(X=oe.supportedResult)!=null&&(X=X.decodingInfoResults)!=null&&X.some(J=>J.smooth===!1))&&(!w||Z!==U)){G.push(Z);continue}const V=oe.details,W=(d?V==null?void 0:V.partTarget:V==null?void 0:V.averagetargetduration)||k;let F;K?F=a*e:F=o*e;const Y=k&&r>=k*2&&s===0?oe.averageBitrate:oe.maxBitrate,te=this.getTimeToLoadFrag(H,F,Y*W,V===void 0);if(F>=Y&&(Z===u||oe.loadError===0&&oe.fragmentError===0)&&(te<=H||!jt(te)||x&&!this.bitrateTestDelay||te<c)){const J=this.forcedAutoLevel;return Z!==g&&(J===-1||J!==g)&&(G.length&&this.trace(`Skipped level(s) ${G.join(",")} of ${n} max with CODECS and VIDEO-RANGE:"${m[G[0]].codecs}" ${m[G[0]].videoRange}; not compatible with "${T}" ${I}`),this.info(`switch candidate:${h}->${Z} adjustedbw(${Math.round(F)})-bitrate=${Math.round(F-Y)} ttfb:${H.toFixed(1)} avgDuration:${W.toFixed(1)} maxFetchDuration:${c.toFixed(1)} fetchDuration:${te.toFixed(1)} firstSelection:${w} codecSet:${oe.codecSet} videoRange:${oe.videoRange} hls.loadLevel:${g}`)),w&&(this.firstSelection=Z),Z}}return-1}set nextAutoLevel(e){const t=this.deriveNextAutoLevel(e);this._nextAutoLevel!==t&&(this.nextAutoLevelKey="",this._nextAutoLevel=t)}deriveNextAutoLevel(e){const{maxAutoLevel:t,minAutoLevel:n}=this.hls;return Math.min(Math.max(e,n),t)}}const jQ={search:function(i,e){let t=0,n=i.length-1,r=null,s=null;for(;t<=n;){r=(t+n)/2|0,s=i[r];const o=e(s);if(o>0)t=r+1;else if(o<0)n=r-1;else return s}return null}};function qpe(i,e,t){if(e===null||!Array.isArray(i)||!i.length||!jt(e))return null;const n=i[0].programDateTime;if(e<(n||0))return null;const r=i[i.length-1].endProgramDateTime;if(e>=(r||0))return null;for(let s=0;s<i.length;++s){const o=i[s];if(Zpe(e,t,o))return o}return null}function o0(i,e,t=0,n=0,r=.005){let s=null;if(i){s=e[1+i.sn-e[0].sn]||null;const a=i.endDTS-t;a>0&&a<15e-7&&(t+=15e-7),s&&i.level!==s.level&&s.end<=i.end&&(s=e[2+i.sn-e[0].sn]||null)}else t===0&&e[0].start===0&&(s=e[0]);if(s&&((!i||i.level===s.level)&&j7(t,n,s)===0||Jpe(s,i,Math.min(r,n))))return s;const o=jQ.search(e,j7.bind(null,t,n));return o&&(o!==i||!s)?o:s}function Jpe(i,e,t){if(e&&e.start===0&&e.level<i.level&&(e.endPTS||0)>0){const n=e.tagList.reduce((r,s)=>(s[0]==="INF"&&(r+=parseFloat(s[1])),r),t);return i.start<=n}return!1}function j7(i=0,e=0,t){if(t.start<=i&&t.start+t.duration>i)return 0;const n=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0));return t.start+t.duration-n<=i?1:t.start-n>i&&t.start?-1:0}function Zpe(i,e,t){const n=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0))*1e3;return(t.endProgramDateTime||0)-n>i}function WQ(i,e,t){if(i&&i.startCC<=e&&i.endCC>=e){let n=i.fragments;const{fragmentHint:r}=i;r&&(n=n.concat(r));let s;return jQ.search(n,o=>o.cc<e?1:o.cc>e?-1:(s=o,o.end<=t?1:o.start>t?-1:0)),s||null}return null}function KS(i){switch(i.details){case Ke.FRAG_LOAD_TIMEOUT:case Ke.KEY_LOAD_TIMEOUT:case Ke.LEVEL_LOAD_TIMEOUT:case Ke.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function KQ(i){return i.details.startsWith("key")}function YQ(i){return KQ(i)&&!!i.frag&&!i.frag.decryptdata}function W7(i,e){const t=KS(e);return i.default[`${t?"timeout":"error"}Retry`]}function HR(i,e){const t=i.backoff==="linear"?1:Math.pow(2,e);return Math.min(t*i.retryDelayMs,i.maxRetryDelayMs)}function K7(i){return Qi(Qi({},i),{errorRetry:null,timeoutRetry:null})}function YS(i,e,t,n){if(!i)return!1;const r=n==null?void 0:n.code,s=e<i.maxNumRetry&&(eme(r)||!!t);return i.shouldRetry?i.shouldRetry(i,e,t,n,s):s}function eme(i){return _5(i)||!!i&&(i<400||i>499)}function _5(i){return i===0&&navigator.onLine===!1}var Zs={DoNothing:0,SendEndCallback:1,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,InsertDiscontinuity:4,RetryRequest:5},Ya={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2,MoveAllAlternatesMatchingKey:4,SwitchToSDR:8};class $Q extends _c{constructor(e){super("error-controller",e.logger),this.hls=void 0,this.playlistError=0,this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(ae.ERROR,this.onError,this),e.on(ae.MANIFEST_LOADING,this.onManifestLoading,this),e.on(ae.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const e=this.hls;e&&(e.off(ae.ERROR,this.onError,this),e.off(ae.ERROR,this.onErrorOut,this),e.off(ae.MANIFEST_LOADING,this.onManifestLoading,this),e.off(ae.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null}startLoad(e){}stopLoad(){this.playlistError=0}getVariantLevelIndex(e){return(e==null?void 0:e.type)===$t.MAIN?e.level:this.getVariantIndex()}getVariantIndex(){var e;const t=this.hls,n=t.currentLevel;return(e=t.loadLevelObj)!=null&&e.details||n===-1?t.loadLevel:n}variantHasKey(e,t){if(e){var n;if((n=e.details)!=null&&n.hasKey(t))return!0;const r=e.audioGroups;if(r)return this.hls.allAudioTracks.filter(o=>r.indexOf(o.groupId)>=0).some(o=>{var a;return(a=o.details)==null?void 0:a.hasKey(t)})}return!1}onManifestLoading(){this.playlistError=0}onLevelUpdated(){this.playlistError=0}onError(e,t){var n;if(t.fatal)return;const r=this.hls,s=t.context;switch(t.details){case Ke.FRAG_LOAD_ERROR:case Ke.FRAG_LOAD_TIMEOUT:case Ke.KEY_LOAD_ERROR:case Ke.KEY_LOAD_TIMEOUT:t.errorAction=this.getFragRetryOrSwitchAction(t);return;case Ke.FRAG_PARSING_ERROR:if((n=t.frag)!=null&&n.gap){t.errorAction=Y1();return}case Ke.FRAG_GAP:case Ke.FRAG_DECRYPT_ERROR:{t.errorAction=this.getFragRetryOrSwitchAction(t),t.errorAction.action=Zs.SendAlternateToPenaltyBox;return}case Ke.LEVEL_EMPTY_ERROR:case Ke.LEVEL_PARSING_ERROR:{var o;const l=t.parent===$t.MAIN?t.level:r.loadLevel;t.details===Ke.LEVEL_EMPTY_ERROR&&((o=t.context)!=null&&(o=o.levelDetails)!=null&&o.live)?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,l):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,l))}return;case Ke.LEVEL_LOAD_ERROR:case Ke.LEVEL_LOAD_TIMEOUT:typeof(s==null?void 0:s.level)=="number"&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,s.level));return;case Ke.AUDIO_TRACK_LOAD_ERROR:case Ke.AUDIO_TRACK_LOAD_TIMEOUT:case Ke.SUBTITLE_LOAD_ERROR:case Ke.SUBTITLE_TRACK_LOAD_TIMEOUT:if(s){const l=r.loadLevelObj;if(l&&(s.type===ai.AUDIO_TRACK&&l.hasAudioGroup(s.groupId)||s.type===ai.SUBTITLE_TRACK&&l.hasSubtitleGroup(s.groupId))){t.errorAction=this.getPlaylistRetryOrSwitchAction(t,r.loadLevel),t.errorAction.action=Zs.SendAlternateToPenaltyBox,t.errorAction.flags=Ya.MoveAllAlternatesMatchingHost;return}}return;case Ke.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:t.errorAction={action:Zs.SendAlternateToPenaltyBox,flags:Ya.MoveAllAlternatesMatchingHDCP};return;case Ke.KEY_SYSTEM_SESSION_UPDATE_FAILED:case Ke.KEY_SYSTEM_STATUS_INTERNAL_ERROR:case Ke.KEY_SYSTEM_NO_SESSION:t.errorAction={action:Zs.SendAlternateToPenaltyBox,flags:Ya.MoveAllAlternatesMatchingKey};return;case Ke.BUFFER_ADD_CODEC_ERROR:case Ke.REMUX_ALLOC_ERROR:case Ke.BUFFER_APPEND_ERROR:if(!t.errorAction){var a;t.errorAction=this.getLevelSwitchAction(t,(a=t.level)!=null?a:r.loadLevel)}return;case Ke.INTERNAL_EXCEPTION:case Ke.BUFFER_APPENDING_ERROR:case Ke.BUFFER_FULL_ERROR:case Ke.LEVEL_SWITCH_ERROR:case Ke.BUFFER_STALLED_ERROR:case Ke.BUFFER_SEEK_OVER_HOLE:case Ke.BUFFER_NUDGE_ON_STALL:t.errorAction=Y1();return}t.type===rn.KEY_SYSTEM_ERROR&&(t.levelRetry=!1,t.errorAction=Y1())}getPlaylistRetryOrSwitchAction(e,t){const n=this.hls,r=W7(n.config.playlistLoadPolicy,e),s=this.playlistError++;if(YS(r,s,KS(e),e.response))return{action:Zs.RetryRequest,flags:Ya.None,retryConfig:r,retryCount:s};const a=this.getLevelSwitchAction(e,t);return r&&(a.retryConfig=r,a.retryCount=s),a}getFragRetryOrSwitchAction(e){const t=this.hls,n=this.getVariantLevelIndex(e.frag),r=t.levels[n],{fragLoadPolicy:s,keyLoadPolicy:o}=t.config,a=W7(KQ(e)?o:s,e),l=t.levels.reduce((u,h)=>u+h.fragmentError,0);if(r&&(e.details!==Ke.FRAG_GAP&&r.fragmentError++,!YQ(e)&&YS(a,l,KS(e),e.response)))return{action:Zs.RetryRequest,flags:Ya.None,retryConfig:a,retryCount:l};const c=this.getLevelSwitchAction(e,n);return a&&(c.retryConfig=a,c.retryCount=l),c}getLevelSwitchAction(e,t){const n=this.hls;t==null&&(t=n.loadLevel);const r=this.hls.levels[t];if(r){var s,o;const c=e.details;r.loadError++,c===Ke.BUFFER_APPEND_ERROR&&r.fragmentError++;let u=-1;const{levels:h,loadLevel:f,minAutoLevel:d,maxAutoLevel:m}=n;!n.autoLevelEnabled&&!n.config.preserveManualLevelOnError&&(n.loadLevel=-1);const y=(s=e.frag)==null?void 0:s.type,A=(y===$t.AUDIO&&c===Ke.FRAG_PARSING_ERROR||e.sourceBufferName==="audio"&&(c===Ke.BUFFER_ADD_CODEC_ERROR||c===Ke.BUFFER_APPEND_ERROR))&&h.some(({audioCodec:I})=>r.audioCodec!==I),x=e.sourceBufferName==="video"&&(c===Ke.BUFFER_ADD_CODEC_ERROR||c===Ke.BUFFER_APPEND_ERROR)&&h.some(({codecSet:I,audioCodec:M})=>r.codecSet!==I&&r.audioCodec===M),{type:w,groupId:T}=(o=e.context)!=null?o:{};for(let I=h.length;I--;){const M=(I+f)%h.length;if(M!==f&&M>=d&&M<=m&&h[M].loadError===0){var a,l;const L=h[M];if(c===Ke.FRAG_GAP&&y===$t.MAIN&&e.frag){const P=h[M].details;if(P){const R=o0(e.frag,P.fragments,e.frag.start);if(R!=null&&R.gap)continue}}else{if(w===ai.AUDIO_TRACK&&L.hasAudioGroup(T)||w===ai.SUBTITLE_TRACK&&L.hasSubtitleGroup(T))continue;if(y===$t.AUDIO&&(a=r.audioGroups)!=null&&a.some(P=>L.hasAudioGroup(P))||y===$t.SUBTITLE&&(l=r.subtitleGroups)!=null&&l.some(P=>L.hasSubtitleGroup(P))||A&&r.audioCodec===L.audioCodec||x&&r.codecSet===L.codecSet||!A&&r.codecSet!==L.codecSet)continue}u=M;break}}if(u>-1&&n.loadLevel!==u)return e.levelRetry=!0,this.playlistError=0,{action:Zs.SendAlternateToPenaltyBox,flags:Ya.None,nextAutoLevel:u}}return{action:Zs.SendAlternateToPenaltyBox,flags:Ya.MoveAllAlternatesMatchingHost}}onErrorOut(e,t){var n;switch((n=t.errorAction)==null?void 0:n.action){case Zs.DoNothing:break;case Zs.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(t),!t.errorAction.resolved&&t.details!==Ke.FRAG_GAP?t.fatal=!0:/MediaSource readyState: ended/.test(t.error.message)&&(this.warn(`MediaSource ended after "${t.sourceBufferName}" sourceBuffer append error. Attempting to recover from media error.`),this.hls.recoverMediaError());break;case Zs.RetryRequest:break}if(t.fatal){this.hls.stopLoad();return}}sendAlternateToPenaltyBox(e){const t=this.hls,n=e.errorAction;if(!n)return;const{flags:r}=n,s=n.nextAutoLevel;switch(r){case Ya.None:this.switchLevel(e,s);break;case Ya.MoveAllAlternatesMatchingHDCP:{const l=this.getVariantLevelIndex(e.frag),c=t.levels[l],u=c==null?void 0:c.attrs["HDCP-LEVEL"];if(n.hdcpLevel=u,u==="NONE")this.warn("HDCP policy resticted output with HDCP-LEVEL=NONE");else if(u){t.maxHdcpLevel=x5[x5.indexOf(u)-1],n.resolved=!0,this.warn(`Restricting playback to HDCP-LEVEL of "${t.maxHdcpLevel}" or lower`);break}}case Ya.MoveAllAlternatesMatchingKey:{const l=e.decryptdata;if(l){const c=this.hls.levels,u=c.length;for(let f=u;f--;)if(this.variantHasKey(c[f],l)){var o,a;this.log(`Banned key found in level ${f} (${c[f].bitrate}bps) or audio group "${(o=c[f].audioGroups)==null?void 0:o.join(",")}" (${(a=e.frag)==null?void 0:a.type} fragment) ${Oo(l.keyId||[])}`),c[f].fragmentError++,c[f].loadError++,this.log(`Removing level ${f} with key error (${e.error})`),this.hls.removeLevel(f)}const h=e.frag;if(this.hls.levels.length<u)n.resolved=!0;else if(h&&h.type!==$t.MAIN){const f=h.decryptdata;f&&!l.matches(f)&&(n.resolved=!0)}}break}}n.resolved||this.switchLevel(e,s)}switchLevel(e,t){if(t!==void 0&&e.errorAction&&(this.warn(`switching to level ${t} after ${e.details}`),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel,e.details===Ke.BUFFER_ADD_CODEC_ERROR&&e.mimeType&&e.sourceBufferName!=="audiovideo")){const n=v5(e.mimeType),r=this.hls.levels;for(let s=r.length;s--;)r[s][`${e.sourceBufferName}Codec`]===n&&(this.log(`Removing level ${s} for ${e.details} ("${n}" not supported)`),this.hls.removeLevel(s))}}}function Y1(i){const e={action:Zs.DoNothing,flags:Ya.None};return i&&(e.resolved=!0),e}var eo={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"};class tme{constructor(e){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}_registerListeners(){const{hls:e}=this;e&&(e.on(ae.MANIFEST_LOADING,this.onManifestLoading,this),e.on(ae.BUFFER_APPENDED,this.onBufferAppended,this),e.on(ae.FRAG_BUFFERED,this.onFragBuffered,this),e.on(ae.FRAG_LOADED,this.onFragLoaded,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(ae.MANIFEST_LOADING,this.onManifestLoading,this),e.off(ae.BUFFER_APPENDED,this.onBufferAppended,this),e.off(ae.FRAG_BUFFERED,this.onFragBuffered,this),e.off(ae.FRAG_LOADED,this.onFragLoaded,this))}destroy(){this._unregisterListeners(),this.hls=this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(e,t){const n=this.activePartLists[t];if(n)for(let r=n.length;r--;){const s=n[r];if(!s)break;if(s.start<=e&&e<=s.end&&s.loaded)return s}return this.getBufferedFrag(e,t)}getBufferedFrag(e,t){return this.getFragAtPos(e,t,!0)}getFragAtPos(e,t,n){const{fragments:r}=this,s=Object.keys(r);for(let o=s.length;o--;){const a=r[s[o]];if((a==null?void 0:a.body.type)===t&&(!n||a.buffered)){const l=a.body;if(l.start<=e&&e<=l.end)return l}}return null}detectEvictedFragments(e,t,n,r,s){this.timeRanges&&(this.timeRanges[e]=t);const o=(r==null?void 0:r.fragment.sn)||-1;Object.keys(this.fragments).forEach(a=>{const l=this.fragments[a];if(!l||o>=l.body.sn)return;if(!l.buffered&&(!l.loaded||s)){l.body.type===n&&this.removeFragment(l.body);return}const c=l.range[e];if(c){if(c.time.length===0){this.removeFragment(l.body);return}c.time.some(u=>{const h=!this.isTimeBuffered(u.startPTS,u.endPTS,t);return h&&this.removeFragment(l.body),h})}})}detectPartialFragments(e){const t=this.timeRanges;if(!t||e.frag.sn==="initSegment")return;const n=e.frag,r=Xg(n),s=this.fragments[r];if(!s||s.buffered&&n.gap)return;const o=!n.relurl;Object.keys(t).forEach(a=>{const l=n.elementaryStreams[a];if(!l)return;const c=t[a],u=o||l.partial===!0;s.range[a]=this.getBufferedTimes(n,e.part,u,c)}),s.loaded=null,Object.keys(s.range).length?(this.bufferedEnd(s,n),XE(s)||this.removeParts(n.sn-1,n.type)):this.removeFragment(s.body)}bufferedEnd(e,t){e.buffered=!0,(e.body.endList=t.endList||e.body.endList)&&(this.endListFragments[e.body.type]=e)}removeParts(e,t){const n=this.activePartLists[t];n&&(this.activePartLists[t]=Y7(n,r=>r.fragment.sn>=e))}fragBuffered(e,t){const n=Xg(e);let r=this.fragments[n];!r&&t&&(r=this.fragments[n]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),r&&(r.loaded=null,this.bufferedEnd(r,e))}getBufferedTimes(e,t,n,r){const s={time:[],partial:n},o=e.start,a=e.end,l=e.minEndPTS||a,c=e.maxStartPTS||o;for(let u=0;u<r.length;u++){const h=r.start(u)-this.bufferPadding,f=r.end(u)+this.bufferPadding;if(c>=h&&l<=f){s.time.push({startPTS:Math.max(o,r.start(u)),endPTS:Math.min(a,r.end(u))});break}else if(o<f&&a>h){const d=Math.max(o,r.start(u)),m=Math.min(a,r.end(u));m>d&&(s.partial=!0,s.time.push({startPTS:d,endPTS:m}))}else if(a<=h)break}return s}getPartialFragment(e){let t=null,n,r,s,o=0;const{bufferPadding:a,fragments:l}=this;return Object.keys(l).forEach(c=>{const u=l[c];u&&XE(u)&&(r=u.body.start-a,s=u.body.end+a,e>=r&&e<=s&&(n=Math.min(e-r,s-e),o<=n&&(t=u.body,o=n)))}),t}isEndListAppended(e){const t=this.endListFragments[e];return t!==void 0&&(t.buffered||XE(t))}getState(e){const t=Xg(e),n=this.fragments[t];return n?n.buffered?XE(n)?eo.PARTIAL:eo.OK:eo.APPENDING:eo.NOT_LOADED}isTimeBuffered(e,t,n){let r,s;for(let o=0;o<n.length;o++){if(r=n.start(o)-this.bufferPadding,s=n.end(o)+this.bufferPadding,e>=r&&t<=s)return!0;if(t<=r)return!1}return!1}onManifestLoading(){this.removeAllFragments()}onFragLoaded(e,t){if(t.frag.sn==="initSegment"||t.frag.bitrateTest)return;const n=t.frag,r=t.part?null:t,s=Xg(n);this.fragments[s]={body:n,appendedPTS:null,loaded:r,buffered:!1,range:Object.create(null)}}onBufferAppended(e,t){const{frag:n,part:r,timeRanges:s,type:o}=t;if(n.sn==="initSegment")return;const a=n.type;if(r){let c=this.activePartLists[a];c||(this.activePartLists[a]=c=[]),c.push(r)}this.timeRanges=s;const l=s[o];this.detectEvictedFragments(o,l,a,r)}onFragBuffered(e,t){this.detectPartialFragments(t)}hasFragment(e){const t=Xg(e);return!!this.fragments[t]}hasFragments(e){const{fragments:t}=this,n=Object.keys(t);if(!e)return n.length>0;for(let r=n.length;r--;){const s=t[n[r]];if((s==null?void 0:s.body.type)===e)return!0}return!1}hasParts(e){var t;return!!((t=this.activePartLists[e])!=null&&t.length)}removeFragmentsInRange(e,t,n,r,s){r&&!this.hasGaps||Object.keys(this.fragments).forEach(o=>{const a=this.fragments[o];if(!a)return;const l=a.body;l.type!==n||r&&!l.gap||l.start<t&&l.end>e&&(a.buffered||s)&&this.removeFragment(l)})}removeFragment(e){const t=Xg(e);e.clearElementaryStreamInfo();const n=this.activePartLists[e.type];if(n){const r=e.sn;this.activePartLists[e.type]=Y7(n,s=>s.fragment.sn!==r)}delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]}removeAllFragments(){var e;this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1;const t=(e=this.hls)==null||(e=e.latestLevelDetails)==null?void 0:e.partList;t&&t.forEach(n=>n.clearElementaryStreamInfo())}}function XE(i){var e,t,n;return i.buffered&&!!(i.body.gap||(e=i.range.video)!=null&&e.partial||(t=i.range.audio)!=null&&t.partial||(n=i.range.audiovideo)!=null&&n.partial)}function Xg(i){return`${i.type}_${i.level}_${i.sn}`}function Y7(i,e){return i.filter(t=>{const n=e(t);return n||t.clearElementaryStreamInfo(),n})}var ap={cbc:0,ctr:1};class nme{constructor(e,t,n){this.subtle=void 0,this.aesIV=void 0,this.aesMode=void 0,this.subtle=e,this.aesIV=t,this.aesMode=n}decrypt(e,t){switch(this.aesMode){case ap.cbc:return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e);case ap.ctr:return this.subtle.decrypt({name:"AES-CTR",counter:this.aesIV,length:64},t,e);default:throw new Error(`[AESCrypto] invalid aes mode ${this.aesMode}`)}}}function ime(i){const e=i.byteLength,t=e&&new DataView(i.buffer).getUint8(e-1);return t?i.slice(0,e-t):i}class rme{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(e){const t=new DataView(e),n=new Uint32Array(4);for(let r=0;r<4;r++)n[r]=t.getUint32(r*4);return n}initTable(){const e=this.sBox,t=this.invSBox,n=this.subMix,r=n[0],s=n[1],o=n[2],a=n[3],l=this.invSubMix,c=l[0],u=l[1],h=l[2],f=l[3],d=new Uint32Array(256);let m=0,y=0,g=0;for(g=0;g<256;g++)g<128?d[g]=g<<1:d[g]=g<<1^283;for(g=0;g<256;g++){let A=y^y<<1^y<<2^y<<3^y<<4;A=A>>>8^A&255^99,e[m]=A,t[A]=m;const E=d[m],x=d[E],w=d[x];let T=d[A]*257^A*16843008;r[m]=T<<24|T>>>8,s[m]=T<<16|T>>>16,o[m]=T<<8|T>>>24,a[m]=T,T=w*16843009^x*65537^E*257^m*16843008,c[A]=T<<24|T>>>8,u[A]=T<<16|T>>>16,h[A]=T<<8|T>>>24,f[A]=T,m?(m=E^d[d[d[w^E]]],y^=d[d[y]]):m=y=1}}expandKey(e){const t=this.uint8ArrayToUint32Array_(e);let n=!0,r=0;for(;r<t.length&&n;)n=t[r]===this.key[r],r++;if(n)return;this.key=t;const s=this.keySize=t.length;if(s!==4&&s!==6&&s!==8)throw new Error("Invalid aes key size="+s);const o=this.ksRows=(s+6+1)*4;let a,l;const c=this.keySchedule=new Uint32Array(o),u=this.invKeySchedule=new Uint32Array(o),h=this.sBox,f=this.rcon,d=this.invSubMix,m=d[0],y=d[1],g=d[2],A=d[3];let E,x;for(a=0;a<o;a++){if(a<s){E=c[a]=t[a];continue}x=E,a%s===0?(x=x<<8|x>>>24,x=h[x>>>24]<<24|h[x>>>16&255]<<16|h[x>>>8&255]<<8|h[x&255],x^=f[a/s|0]<<24):s>6&&a%s===4&&(x=h[x>>>24]<<24|h[x>>>16&255]<<16|h[x>>>8&255]<<8|h[x&255]),c[a]=E=(c[a-s]^x)>>>0}for(l=0;l<o;l++)a=o-l,l&3?x=c[a]:x=c[a-4],l<4||a<=4?u[l]=x:u[l]=m[h[x>>>24]]^y[h[x>>>16&255]]^g[h[x>>>8&255]]^A[h[x&255]],u[l]=u[l]>>>0}networkToHostOrderSwap(e){return e<<24|(e&65280)<<8|(e&16711680)>>8|e>>>24}decrypt(e,t,n){const r=this.keySize+6,s=this.invKeySchedule,o=this.invSBox,a=this.invSubMix,l=a[0],c=a[1],u=a[2],h=a[3],f=this.uint8ArrayToUint32Array_(n);let d=f[0],m=f[1],y=f[2],g=f[3];const A=new Int32Array(e),E=new Int32Array(A.length);let x,w,T,I,M,L,P,R,U,k,H,G,X,Z;const oe=this.networkToHostOrderSwap;for(;t<A.length;){for(U=oe(A[t]),k=oe(A[t+1]),H=oe(A[t+2]),G=oe(A[t+3]),M=U^s[0],L=G^s[1],P=H^s[2],R=k^s[3],X=4,Z=1;Z<r;Z++)x=l[M>>>24]^c[L>>16&255]^u[P>>8&255]^h[R&255]^s[X],w=l[L>>>24]^c[P>>16&255]^u[R>>8&255]^h[M&255]^s[X+1],T=l[P>>>24]^c[R>>16&255]^u[M>>8&255]^h[L&255]^s[X+2],I=l[R>>>24]^c[M>>16&255]^u[L>>8&255]^h[P&255]^s[X+3],M=x,L=w,P=T,R=I,X=X+4;x=o[M>>>24]<<24^o[L>>16&255]<<16^o[P>>8&255]<<8^o[R&255]^s[X],w=o[L>>>24]<<24^o[P>>16&255]<<16^o[R>>8&255]<<8^o[M&255]^s[X+1],T=o[P>>>24]<<24^o[R>>16&255]<<16^o[M>>8&255]<<8^o[L&255]^s[X+2],I=o[R>>>24]<<24^o[M>>16&255]<<16^o[L>>8&255]<<8^o[P&255]^s[X+3],E[t]=oe(x^d),E[t+1]=oe(I^m),E[t+2]=oe(T^y),E[t+3]=oe(w^g),d=U,m=k,y=H,g=G,t=t+4}return E.buffer}}class sme{constructor(e,t,n){this.subtle=void 0,this.key=void 0,this.aesMode=void 0,this.subtle=e,this.key=t,this.aesMode=n}expandKey(){const e=ome(this.aesMode);return this.subtle.importKey("raw",this.key,{name:e},!1,["encrypt","decrypt"])}}function ome(i){switch(i){case ap.cbc:return"AES-CBC";case ap.ctr:return"AES-CTR";default:throw new Error(`[FastAESKey] invalid aes mode ${i}`)}}const ame=16;class QR{constructor(e,{removePKCS7Padding:t=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.enableSoftwareAES=void 0,this.enableSoftwareAES=e.enableSoftwareAES,this.removePKCS7Padding=t,t)try{const n=self.crypto;n&&(this.subtle=n.subtle||n.webkitSubtle)}catch{}this.useSoftware=!this.subtle}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:e,remainderData:t}=this;if(!e||t)return this.reset(),null;const n=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?ime(n):n}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(e,t,n,r){return this.useSoftware?new Promise((s,o)=>{const a=ArrayBuffer.isView(e)?e:new Uint8Array(e);this.softwareDecrypt(a,t,n,r);const l=this.flush();l?s(l.buffer):o(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(e),t,n,r)}softwareDecrypt(e,t,n,r){const{currentIV:s,currentResult:o,remainderData:a}=this;if(r!==ap.cbc||t.byteLength!==16)return Ki.warn("SoftwareDecrypt: can only handle AES-128-CBC"),null;this.logOnce("JS AES decrypt"),a&&(e=Ac(a,e),this.remainderData=null);const l=this.getValidChunk(e);if(!l.length)return null;s&&(n=s);let c=this.softwareDecrypter;c||(c=this.softwareDecrypter=new rme),c.expandKey(t);const u=o;return this.currentResult=c.decrypt(l.buffer,0,n),this.currentIV=l.slice(-16).buffer,u||null}webCryptoDecrypt(e,t,n,r){if(this.key!==t||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(e,t,n,r));this.key=t,this.fastAesKey=new sme(this.subtle,t,r)}return this.fastAesKey.expandKey().then(s=>this.subtle?(this.logOnce("WebCrypto AES decrypt"),new nme(this.subtle,new Uint8Array(n),r).decrypt(e.buffer,s)):Promise.reject(new Error("web crypto not initialized"))).catch(s=>(Ki.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${s.name}: ${s.message}`),this.onWebCryptoError(e,t,n,r)))}onWebCryptoError(e,t,n,r){const s=this.enableSoftwareAES;if(s){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,n,r);const o=this.flush();if(o)return o.buffer}throw new Error("WebCrypto"+(s?" and softwareDecrypt":"")+": failed to decrypt data")}getValidChunk(e){let t=e;const n=e.length-e.length%ame;return n!==e.length&&(t=e.slice(0,n),this.remainderData=e.slice(n)),t}logOnce(e){this.logEnabled&&(Ki.log(`[decrypter]: ${e}`),this.logEnabled=!1)}}const $7=Math.pow(2,17);class lme{constructor(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(e,t){const n=e.url;if(!n)return Promise.reject(new Ef({type:rn.NETWORK_ERROR,details:Ke.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error(`Fragment does not have a ${n?"part list":"url"}`),networkDetails:null}));this.abort();const r=this.config,s=r.fLoader,o=r.loader;return new Promise((a,l)=>{if(this.loader&&this.loader.destroy(),e.gap)if(e.tagList.some(m=>m[0]==="GAP")){l(q7(e));return}else e.gap=!1;const c=this.loader=s?new s(r):new o(r),u=X7(e);e.loader=c;const h=K7(r.fragLoadPolicy.default),f={loadPolicy:h,timeout:h.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:e.sn==="initSegment"?1/0:$7};e.stats=c.stats;const d={onSuccess:(m,y,g,A)=>{this.resetLoader(e,c);let E=m.data;g.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(E.slice(0,16)),E=E.slice(16)),a({frag:e,part:null,payload:E,networkDetails:A})},onError:(m,y,g,A)=>{this.resetLoader(e,c),l(new Ef({type:rn.NETWORK_ERROR,details:Ke.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:Qi({url:n,data:void 0},m),error:new Error(`HTTP Error ${m.code} ${m.text}`),networkDetails:g,stats:A}))},onAbort:(m,y,g)=>{this.resetLoader(e,c),l(new Ef({type:rn.NETWORK_ERROR,details:Ke.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:g,stats:m}))},onTimeout:(m,y,g)=>{this.resetLoader(e,c),l(new Ef({type:rn.NETWORK_ERROR,details:Ke.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error(`Timeout after ${f.timeout}ms`),networkDetails:g,stats:m}))}};t&&(d.onProgress=(m,y,g,A)=>t({frag:e,part:null,payload:g,networkDetails:A})),c.load(u,f,d)})}loadPart(e,t,n){this.abort();const r=this.config,s=r.fLoader,o=r.loader;return new Promise((a,l)=>{if(this.loader&&this.loader.destroy(),e.gap||t.gap){l(q7(e,t));return}const c=this.loader=s?new s(r):new o(r),u=X7(e,t);e.loader=c;const h=K7(r.fragLoadPolicy.default),f={loadPolicy:h,timeout:h.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:$7};t.stats=c.stats,c.load(u,f,{onSuccess:(d,m,y,g)=>{this.resetLoader(e,c),this.updateStatsFromPart(e,t);const A={frag:e,part:t,payload:d.data,networkDetails:g};n(A),a(A)},onError:(d,m,y,g)=>{this.resetLoader(e,c),l(new Ef({type:rn.NETWORK_ERROR,details:Ke.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:Qi({url:u.url,data:void 0},d),error:new Error(`HTTP Error ${d.code} ${d.text}`),networkDetails:y,stats:g}))},onAbort:(d,m,y)=>{e.stats.aborted=t.stats.aborted,this.resetLoader(e,c),l(new Ef({type:rn.NETWORK_ERROR,details:Ke.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,error:new Error("Aborted"),networkDetails:y,stats:d}))},onTimeout:(d,m,y)=>{this.resetLoader(e,c),l(new Ef({type:rn.NETWORK_ERROR,details:Ke.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,error:new Error(`Timeout after ${f.timeout}ms`),networkDetails:y,stats:d}))}})})}updateStatsFromPart(e,t){const n=e.stats,r=t.stats,s=r.total;if(n.loaded+=r.loaded,s){const l=Math.round(e.duration/t.duration),c=Math.min(Math.round(n.loaded/s),l),h=(l-c)*Math.round(n.loaded/c);n.total=n.loaded+h}else n.total=Math.max(n.loaded,n.total);const o=n.loading,a=r.loading;o.start?o.first+=a.first-a.start:(o.start=a.start,o.first=a.first),o.end=a.end}resetLoader(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()}}function X7(i,e=null){const t=e||i,n={frag:i,part:e,responseType:"arraybuffer",url:t.url,headers:{},rangeStart:0,rangeEnd:0},r=t.byteRangeStartOffset,s=t.byteRangeEndOffset;if(jt(r)&&jt(s)){var o;let a=r,l=s;if(i.sn==="initSegment"&&cme((o=i.decryptdata)==null?void 0:o.method)){const c=s-r;c%16&&(l=s+(16-c%16)),r!==0&&(n.resetIV=!0,a=r-16)}n.rangeStart=a,n.rangeEnd=l}return n}function q7(i,e){const t=new Error(`GAP ${i.gap?"tag":"attribute"} found`),n={type:rn.MEDIA_ERROR,details:Ke.FRAG_GAP,fatal:!1,frag:i,error:t,networkDetails:null};return e&&(n.part=e),(e||i).stats.aborted=!0,new Ef(n)}function cme(i){return i==="AES-128"||i==="AES-256"}class Ef extends Error{constructor(e){super(e.error.message),this.data=void 0,this.data=e}}class XQ extends _c{constructor(e,t){super(e,t),this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(e){return this._tickInterval?!1:(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)}clearInterval(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1}clearNextTick(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1}tick(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}class x4{constructor(e,t,n,r=0,s=-1,o=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=qE(),this.buffering={audio:qE(),video:qE(),audiovideo:qE()},this.level=e,this.sn=t,this.id=n,this.size=r,this.part=s,this.partial=o}}function qE(){return{start:0,executeStart:0,executeEnd:0,end:0}}const J7={length:0,start:()=>0,end:()=>0};class Wn{static isBuffered(e,t){if(e){const n=Wn.getBuffered(e);for(let r=n.length;r--;)if(t>=n.start(r)&&t<=n.end(r))return!0}return!1}static bufferedRanges(e){if(e){const t=Wn.getBuffered(e);return Wn.timeRangesToArray(t)}return[]}static timeRangesToArray(e){const t=[];for(let n=0;n<e.length;n++)t.push({start:e.start(n),end:e.end(n)});return t}static bufferInfo(e,t,n){if(e){const r=Wn.bufferedRanges(e);if(r.length)return Wn.bufferedInfo(r,t,n)}return{len:0,start:t,end:t,bufferedIndex:-1}}static bufferedInfo(e,t,n){t=Math.max(0,t),e.length>1&&e.sort((u,h)=>u.start-h.start||h.end-u.end);let r=-1,s=[];if(n)for(let u=0;u<e.length;u++){t>=e[u].start&&t<=e[u].end&&(r=u);const h=s.length;if(h){const f=s[h-1].end;e[u].start-f<n?e[u].end>f&&(s[h-1].end=e[u].end):s.push(e[u])}else s.push(e[u])}else s=e;let o=0,a,l=t,c=t;for(let u=0;u<s.length;u++){const h=s[u].start,f=s[u].end;if(r===-1&&t>=h&&t<=f&&(r=u),t+n>=h&&t<f)l=h,c=f,o=c-t;else if(t+n<h){a=h;break}}return{len:o,start:l||0,end:c||0,nextStart:a,buffered:e,bufferedIndex:r}}static getBuffered(e){try{return e.buffered||J7}catch(t){return Ki.log("failed to get media.buffered",t),J7}}}const qQ=/\{\$([a-zA-Z0-9-_]+)\}/g;function Z7(i){return qQ.test(i)}function S5(i,e){if(i.variableList!==null||i.hasVariableRefs){const t=i.variableList;return e.replace(qQ,n=>{const r=n.substring(2,n.length-1),s=t==null?void 0:t[r];return s===void 0?(i.playlistParsingError||(i.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${r}"`)),n):s})}return e}function ek(i,e,t){let n=i.variableList;n||(i.variableList=n={});let r,s;if("QUERYPARAM"in e){r=e.QUERYPARAM;try{const o=new self.URL(t).searchParams;if(o.has(r))s=o.get(r);else throw new Error(`"${r}" does not match any query parameter in URI: "${t}"`)}catch(o){i.playlistParsingError||(i.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${o.message}`))}}else r=e.NAME,s=e.VALUE;r in n?i.playlistParsingError||(i.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${r}"`)):n[r]=s||""}function ume(i,e,t){const n=e.IMPORT;if(t&&n in t){let r=i.variableList;r||(i.variableList=r={}),r[n]=t[n]}else i.playlistParsingError||(i.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${n}"`))}const hme=/^(\d+)x(\d+)$/,tk=/(.+?)=(".*?"|.*?)(?:,|$)/g;class Br{constructor(e,t){typeof e=="string"&&(e=Br.parseAttrList(e,t)),er(this,e)}get clientAttrs(){return Object.keys(this).filter(e=>e.substring(0,2)==="X-")}decimalInteger(e){const t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}hexadecimalInteger(e){if(this[e]){let t=(this[e]||"0x").slice(2);t=(t.length&1?"0":"")+t;const n=new Uint8Array(t.length/2);for(let r=0;r<t.length/2;r++)n[r]=parseInt(t.slice(r*2,r*2+2),16);return n}return null}hexadecimalIntegerAsNumber(e){const t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}decimalFloatingPoint(e){return parseFloat(this[e])}optionalFloat(e,t){const n=this[e];return n?parseFloat(n):t}enumeratedString(e){return this[e]}enumeratedStringList(e,t){const n=this[e];return(n?n.split(/[ ,]+/):[]).reduce((r,s)=>(r[s.toLowerCase()]=!0,r),t)}bool(e){return this[e]==="YES"}decimalResolution(e){const t=hme.exec(this[e]);if(t!==null)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}static parseAttrList(e,t){let n;const r={};for(tk.lastIndex=0;(n=tk.exec(e))!==null;){const o=n[1].trim();let a=n[2];const l=a.indexOf('"')===0&&a.lastIndexOf('"')===a.length-1;let c=!1;if(l)a=a.slice(1,-1);else switch(o){case"IV":case"SCTE35-CMD":case"SCTE35-IN":case"SCTE35-OUT":c=!0}if(t&&(l||c))a=S5(t,a);else if(!c&&!l)switch(o){case"CLOSED-CAPTIONS":if(a==="NONE")break;case"ALLOWED-CPC":case"CLASS":case"ASSOC-LANGUAGE":case"AUDIO":case"BYTERANGE":case"CHANNELS":case"CHARACTERISTICS":case"CODECS":case"DATA-ID":case"END-DATE":case"GROUP-ID":case"ID":case"IMPORT":case"INSTREAM-ID":case"KEYFORMAT":case"KEYFORMATVERSIONS":case"LANGUAGE":case"NAME":case"PATHWAY-ID":case"QUERYPARAM":case"RECENTLY-REMOVED-DATERANGES":case"SERVER-URI":case"STABLE-RENDITION-ID":case"STABLE-VARIANT-ID":case"START-DATE":case"SUBTITLES":case"SUPPLEMENTAL-CODECS":case"URI":case"VALUE":case"VIDEO":case"X-ASSET-LIST":case"X-ASSET-URI":Ki.warn(`${e}: attribute ${o} is missing quotes`)}r[o]=a}return r}}const fme="com.apple.hls.interstitial";function dme(i){return i!=="ID"&&i!=="CLASS"&&i!=="CUE"&&i!=="START-DATE"&&i!=="DURATION"&&i!=="END-DATE"&&i!=="END-ON-NEXT"}function pme(i){return i==="SCTE35-OUT"||i==="SCTE35-IN"||i==="SCTE35-CMD"}class VR{constructor(e,t,n=0){var r;if(this.attr=void 0,this.tagAnchor=void 0,this.tagOrder=void 0,this._startDate=void 0,this._endDate=void 0,this._dateAtEnd=void 0,this._cue=void 0,this._badValueForSameId=void 0,this.tagAnchor=(t==null?void 0:t.tagAnchor)||null,this.tagOrder=(r=t==null?void 0:t.tagOrder)!=null?r:n,t){const s=t.attr;for(const o in s)if(Object.prototype.hasOwnProperty.call(e,o)&&e[o]!==s[o]){Ki.warn(`DATERANGE tag attribute: "${o}" does not match for tags with ID: "${e.ID}"`),this._badValueForSameId=o;break}e=er(new Br({}),s,e)}if(this.attr=e,t?(this._startDate=t._startDate,this._cue=t._cue,this._endDate=t._endDate,this._dateAtEnd=t._dateAtEnd):this._startDate=new Date(e["START-DATE"]),"END-DATE"in this.attr){const s=(t==null?void 0:t.endDate)||new Date(this.attr["END-DATE"]);jt(s.getTime())&&(this._endDate=s)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get cue(){const e=this._cue;return e===void 0?this._cue=this.attr.enumeratedStringList(this.attr.CUE?"CUE":"X-CUE",{pre:!1,post:!1,once:!1}):e}get startTime(){const{tagAnchor:e}=this;return e===null||e.programDateTime===null?(Ki.warn(`Expected tagAnchor Fragment with PDT set for DateRange "${this.id}": ${e}`),NaN):e.start+(this.startDate.getTime()-e.programDateTime)/1e3}get startDate(){return this._startDate}get endDate(){const e=this._endDate||this._dateAtEnd;if(e)return e;const t=this.duration;return t!==null?this._dateAtEnd=new Date(this._startDate.getTime()+t*1e3):null}get duration(){if("DURATION"in this.attr){const e=this.attr.decimalFloatingPoint("DURATION");if(jt(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isInterstitial(){return this.class===fme}get isValid(){return!!this.id&&!this._badValueForSameId&&jt(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)&&(!this.attr.CUE||!this.cue.pre&&!this.cue.post||this.cue.pre!==this.cue.post)&&(!this.isInterstitial||"X-ASSET-URI"in this.attr||"X-ASSET-LIST"in this.attr)}}const mme=10;class JQ{constructor(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.dateRangeTagCount=0,this.live=!0,this.requestScheduled=-1,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.appliedTimelineOffset=void 0,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}reloaded(e){if(!e){this.advanced=!0,this.updated=!0;return}const t=this.lastPartSn-e.lastPartSn,n=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!n||!!t||!this.live,this.advanced=this.endSN>e.endSN||t>0||t===0&&n>0,this.updated||this.advanced?this.misses=Math.floor(e.misses*.6):this.misses=e.misses+1}hasKey(e){return this.encryptedFragments.some(t=>{let n=t.decryptdata;return n||(t.setKeyFormat(e.keyFormat),n=t.decryptdata),!!n&&e.matches(n)})}get hasProgramDateTime(){return this.fragments.length?jt(this.fragments[this.fragments.length-1].programDateTime):!1}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||mme}get drift(){const e=this.driftEndTime-this.driftStartTime;return e>0?(this.driftEnd-this.driftStart)*1e3/e:1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){return this.fragments.length?this.fragments[this.fragments.length-1].end:0}get fragmentStart(){return this.fragments.length?this.fragments[0].start:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].index:-1}get maxPartIndex(){const e=this.partList;if(e){const t=this.lastPartIndex;if(t!==-1){for(let n=e.length;n--;)if(e[n].index>t)return e[n].index;return t}}return 0}get lastPartSn(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}get expired(){if(this.live&&this.age&&this.misses<3){const e=this.partEnd-this.fragmentStart;return this.age>Math.max(e,this.totalduration)+this.levelTargetDuration}return!1}}function $S(i,e){return i.length===e.length?!i.some((t,n)=>t!==e[n]):!1}function nk(i,e){return!i&&!e?!0:!i||!e?!1:$S(i,e)}function $1(i){return i==="AES-128"||i==="AES-256"||i==="AES-256-CTR"}function jR(i){switch(i){case"AES-128":case"AES-256":return ap.cbc;case"AES-256-CTR":return ap.ctr;default:throw new Error(`invalid full segment method ${i}`)}}function WR(i){return Uint8Array.from(atob(i),e=>e.charCodeAt(0))}function w5(i){return Uint8Array.from(unescape(encodeURIComponent(i)),e=>e.charCodeAt(0))}function gme(i){const e=w5(i).subarray(0,16),t=new Uint8Array(16);return t.set(e,16-e.length),t}function ZQ(i){const e=function(n,r,s){const o=n[r];n[r]=n[s],n[s]=o};e(i,0,3),e(i,1,2),e(i,4,5),e(i,6,7)}function eV(i){const e=i.split(":");let t=null;if(e[0]==="data"&&e.length===2){const n=e[1].split(";"),r=n[n.length-1].split(",");if(r.length===2){const s=r[0]==="base64",o=r[1];s?(n.splice(-1,1),t=WR(o)):t=gme(o)}}return t}const XS=typeof self<"u"?self:void 0;var Dr={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},xo={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function iS(i){switch(i){case xo.FAIRPLAY:return Dr.FAIRPLAY;case xo.PLAYREADY:return Dr.PLAYREADY;case xo.WIDEVINE:return Dr.WIDEVINE;case xo.CLEARKEY:return Dr.CLEARKEY}}function Fb(i){switch(i){case Dr.FAIRPLAY:return xo.FAIRPLAY;case Dr.PLAYREADY:return xo.PLAYREADY;case Dr.WIDEVINE:return xo.WIDEVINE;case Dr.CLEARKEY:return xo.CLEARKEY}}function Hv(i){const{drmSystems:e,widevineLicenseUrl:t}=i,n=e?[Dr.FAIRPLAY,Dr.WIDEVINE,Dr.PLAYREADY,Dr.CLEARKEY].filter(r=>!!e[r]):[];return!n[Dr.WIDEVINE]&&t&&n.push(Dr.WIDEVINE),n}const KR=(function(i){return XS!=null&&(i=XS.navigator)!=null&&i.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null})();function Ame(i,e,t,n){let r;switch(i){case Dr.FAIRPLAY:r=["cenc","sinf"];break;case Dr.WIDEVINE:case Dr.PLAYREADY:r=["cenc"];break;case Dr.CLEARKEY:r=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${i}`)}return yme(r,e,t,n)}function yme(i,e,t,n){return[{initDataTypes:i,persistentState:n.persistentState||"optional",distinctiveIdentifier:n.distinctiveIdentifier||"optional",sessionTypes:n.sessionTypes||[n.sessionType||"temporary"],audioCapabilities:e.map(s=>({contentType:`audio/mp4; codecs=${s}`,robustness:n.audioRobustness||"",encryptionScheme:n.audioEncryptionScheme||null})),videoCapabilities:t.map(s=>({contentType:`video/mp4; codecs=${s}`,robustness:n.videoRobustness||"",encryptionScheme:n.videoEncryptionScheme||null}))}]}function vme(i){var e;return!!i&&(i.sessionType==="persistent-license"||!!((e=i.sessionTypes)!=null&&e.some(t=>t==="persistent-license")))}function tV(i){const e=new Uint16Array(i.buffer,i.byteOffset,i.byteLength/2),t=String.fromCharCode.apply(null,Array.from(e)),n=t.substring(t.indexOf("<"),t.length),o=new DOMParser().parseFromString(n,"text/xml").getElementsByTagName("KID")[0];if(o){const a=o.childNodes[0]?o.childNodes[0].nodeValue:o.getAttribute("VALUE");if(a){const l=WR(a).subarray(0,16);return ZQ(l),l}}return null}let qg={};class Df{static clearKeyUriToKeyIdMap(){qg={}}static setKeyIdForUri(e,t){qg[e]=t}static addKeyIdForUri(e){const t=Object.keys(qg).length%Number.MAX_SAFE_INTEGER,n=new Uint8Array(16);return new DataView(n.buffer,12,4).setUint32(0,t),qg[e]=n,n}constructor(e,t,n,r=[1],s=null,o){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=t,this.keyFormat=n,this.keyFormatVersions=r,this.iv=s,this.encrypted=e?e!=="NONE":!1,this.isCommonEncryption=this.encrypted&&!$1(e),o!=null&&o.startsWith("0x")&&(this.keyId=new Uint8Array(IQ(o)))}matches(e){return e.uri===this.uri&&e.method===this.method&&e.encrypted===this.encrypted&&e.keyFormat===this.keyFormat&&$S(e.keyFormatVersions,this.keyFormatVersions)&&nk(e.iv,this.iv)&&nk(e.keyId,this.keyId)}isSupported(){if(this.method){if($1(this.method)||this.method==="NONE")return!0;if(this.keyFormat==="identity")return this.method==="SAMPLE-AES";switch(this.keyFormat){case xo.FAIRPLAY:case xo.WIDEVINE:case xo.PLAYREADY:case xo.CLEARKEY:return["SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1}getDecryptData(e,t){if(!this.encrypted||!this.uri)return null;if($1(this.method)){let s=this.iv;return s||(typeof e!="number"&&(Ki.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),e=0),s=Eme(e)),new Df(this.method,this.uri,"identity",this.keyFormatVersions,s)}if(this.keyId){const s=qg[this.uri];if(s&&!$S(this.keyId,s)&&Df.setKeyIdForUri(this.uri,this.keyId),this.pssh)return this}const n=eV(this.uri);if(n)switch(this.keyFormat){case xo.WIDEVINE:if(this.pssh=n,!this.keyId){const s=bpe(n.buffer);if(s.length){var r;const o=s[0];this.keyId=(r=o.kids)!=null&&r.length?o.kids[0]:null}}this.keyId||(this.keyId=ik(t));break;case xo.PLAYREADY:{const s=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=Tpe(s,null,n),this.keyId=tV(n);break}default:{let s=n.subarray(0,16);if(s.length!==16){const o=new Uint8Array(16);o.set(s,16-s.length),s=o}this.keyId=s;break}}if(!this.keyId||this.keyId.byteLength!==16){let s;s=xme(t),s||(s=ik(t),s||(s=qg[this.uri])),s&&(this.keyId=s,Df.setKeyIdForUri(this.uri,s))}return this}}function xme(i){const e=i==null?void 0:i[xo.WIDEVINE];return e?e.keyId:null}function ik(i){const e=i==null?void 0:i[xo.PLAYREADY];if(e){const t=eV(e.uri);if(t)return tV(t)}return null}function Eme(i){const e=new Uint8Array(16);for(let t=12;t<16;t++)e[t]=i>>8*(15-t)&255;return e}const rk=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,sk=/#EXT-X-MEDIA:(.*)/g,_me=/^#EXT(?:INF|-X-TARGETDURATION):/m,Ob=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#.*/.source].join("|"),"g"),Sme=new RegExp([/#EXT-X-(PROGRAM-DATE-TIME|BYTERANGE|DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class Au{static findGroup(e,t){for(let n=0;n<e.length;n++){const r=e[n];if(r.id===t)return r}}static resolve(e,t){return OR.buildAbsoluteURL(t,e,{alwaysNormalize:!0})}static isMediaPlaylist(e){return _me.test(e)}static parseMasterPlaylist(e,t){const n=Z7(e),r={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:n},s=[];if(rk.lastIndex=0,!e.startsWith("#EXTM3U"))return r.playlistParsingError=new Error("no EXTM3U delimiter"),r;let o;for(;(o=rk.exec(e))!=null;)if(o[1]){var a;const c=new Br(o[1],r),u=S5(r,o[2]),h={attrs:c,bitrate:c.decimalInteger("BANDWIDTH")||c.decimalInteger("AVERAGE-BANDWIDTH"),name:c.NAME,url:Au.resolve(u,t)},f=c.decimalResolution("RESOLUTION");f&&(h.width=f.width,h.height=f.height),lk(c.CODECS,h);const d=c["SUPPLEMENTAL-CODECS"];d&&(h.supplemental={},lk(d,h.supplemental)),(a=h.unknownCodecs)!=null&&a.length||s.push(h),r.levels.push(h)}else if(o[3]){const c=o[3],u=o[4];switch(c){case"SESSION-DATA":{const h=new Br(u,r),f=h["DATA-ID"];f&&(r.sessionData===null&&(r.sessionData={}),r.sessionData[f]=h);break}case"SESSION-KEY":{const h=ok(u,t,r);h.encrypted&&h.isSupported()?(r.sessionKeys===null&&(r.sessionKeys=[]),r.sessionKeys.push(h)):Ki.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${u}"`);break}case"DEFINE":{{const h=new Br(u,r);ek(r,h,t)}break}case"CONTENT-STEERING":{const h=new Br(u,r);r.contentSteering={uri:Au.resolve(h["SERVER-URI"],t),pathwayId:h["PATHWAY-ID"]||"."};break}case"START":{r.startTimeOffset=ak(u);break}}}const l=s.length>0&&s.length<r.levels.length;return r.levels=l?s:r.levels,r.levels.length===0&&(r.playlistParsingError=new Error("no levels found in manifest")),r}static parseMasterPlaylistMedia(e,t,n){let r;const s={},o=n.levels,a={AUDIO:o.map(c=>({id:c.attrs.AUDIO,audioCodec:c.audioCodec})),SUBTITLES:o.map(c=>({id:c.attrs.SUBTITLES,textCodec:c.textCodec})),"CLOSED-CAPTIONS":[]};let l=0;for(sk.lastIndex=0;(r=sk.exec(e))!==null;){const c=new Br(r[1],n),u=c.TYPE;if(u){const h=a[u],f=s[u]||[];s[u]=f;const d=c.LANGUAGE,m=c["ASSOC-LANGUAGE"],y=c.CHANNELS,g=c.CHARACTERISTICS,A=c["INSTREAM-ID"],E={attrs:c,bitrate:0,id:l++,groupId:c["GROUP-ID"]||"",name:c.NAME||d||"",type:u,default:c.bool("DEFAULT"),autoselect:c.bool("AUTOSELECT"),forced:c.bool("FORCED"),lang:d,url:c.URI?Au.resolve(c.URI,t):""};if(m&&(E.assocLang=m),y&&(E.channels=y),g&&(E.characteristics=g),A&&(E.instreamId=A),h!=null&&h.length){const x=Au.findGroup(h,E.groupId)||h[0];ck(E,x,"audioCodec"),ck(E,x,"textCodec")}f.push(E)}}return s}static parseLevelPlaylist(e,t,n,r,s,o){var a;const l={url:t},c=new JQ(t),u=c.fragments,h=[];let f=null,d=0,m=0,y=0,g=0,A=0,E=null,x=new tS(r,l),w,T,I,M=-1,L=!1,P=null,R;if(Ob.lastIndex=0,c.m3u8=e,c.hasVariableRefs=Z7(e),((a=Ob.exec(e))==null?void 0:a[0])!=="#EXTM3U")return c.playlistParsingError=new Error("Missing format identifier #EXTM3U"),c;for(;(w=Ob.exec(e))!==null;){L&&(L=!1,x=new tS(r,l),x.playlistOffset=y,x.setStart(y),x.sn=d,x.cc=g,A&&(x.bitrate=A),x.level=n,f&&(x.initSegment=f,f.rawProgramDateTime&&(x.rawProgramDateTime=f.rawProgramDateTime,f.rawProgramDateTime=null),P&&(x.setByteRange(P),P=null)));const G=w[1];if(G){x.duration=parseFloat(G);const X=(" "+w[2]).slice(1);x.title=X||null,x.tagList.push(X?["INF",G,X]:["INF",G])}else if(w[3]){if(jt(x.duration)){x.playlistOffset=y,x.setStart(y),I&&hk(x,I,c),x.sn=d,x.level=n,x.cc=g,u.push(x);const X=(" "+w[3]).slice(1);x.relurl=S5(c,X),C5(x,E,h),E=x,y+=x.duration,d++,m=0,L=!0}}else{if(w=w[0].match(Sme),!w){Ki.warn("No matches on slow regex match for level playlist!");continue}for(T=1;T<w.length&&w[T]===void 0;T++);const X=(" "+w[T]).slice(1),Z=(" "+w[T+1]).slice(1),oe=w[T+2]?(" "+w[T+2]).slice(1):null;switch(X){case"BYTERANGE":E?x.setByteRange(Z,E):x.setByteRange(Z);break;case"PROGRAM-DATE-TIME":x.rawProgramDateTime=Z,x.tagList.push(["PROGRAM-DATE-TIME",Z]),M===-1&&(M=u.length);break;case"PLAYLIST-TYPE":c.type&&pf(c,X,w),c.type=Z.toUpperCase();break;case"MEDIA-SEQUENCE":c.startSN!==0?pf(c,X,w):u.length>0&&fk(c,X,w),d=c.startSN=parseInt(Z);break;case"SKIP":{c.skippedSegments&&pf(c,X,w);const K=new Br(Z,c),V=K.decimalInteger("SKIPPED-SEGMENTS");if(jt(V)){c.skippedSegments+=V;for(let F=V;F--;)u.push(null);d+=V}const W=K.enumeratedString("RECENTLY-REMOVED-DATERANGES");W&&(c.recentlyRemovedDateranges=(c.recentlyRemovedDateranges||[]).concat(W.split("	")));break}case"TARGETDURATION":c.targetduration!==0&&pf(c,X,w),c.targetduration=Math.max(parseInt(Z),1);break;case"VERSION":c.version!==null&&pf(c,X,w),c.version=parseInt(Z);break;case"INDEPENDENT-SEGMENTS":break;case"ENDLIST":c.live||pf(c,X,w),c.live=!1;break;case"#":(Z||oe)&&x.tagList.push(oe?[Z,oe]:[Z]);break;case"DISCONTINUITY":g++,x.tagList.push(["DIS"]);break;case"GAP":x.gap=!0,x.tagList.push([X]);break;case"BITRATE":x.tagList.push([X,Z]),A=parseInt(Z)*1e3,jt(A)?x.bitrate=A:A=0;break;case"DATERANGE":{const K=new Br(Z,c),V=new VR(K,c.dateRanges[K.ID],c.dateRangeTagCount);c.dateRangeTagCount++,V.isValid||c.skippedSegments?c.dateRanges[V.id]=V:Ki.warn(`Ignoring invalid DATERANGE tag: "${Z}"`),x.tagList.push(["EXT-X-DATERANGE",Z]);break}case"DEFINE":{{const K=new Br(Z,c);"IMPORT"in K?ume(c,K,o):ek(c,K,t)}break}case"DISCONTINUITY-SEQUENCE":c.startCC!==0?pf(c,X,w):u.length>0&&fk(c,X,w),c.startCC=g=parseInt(Z);break;case"KEY":{const K=ok(Z,t,c);if(K.isSupported()){if(K.method==="NONE"){I=void 0;break}I||(I={});const V=I[K.keyFormat];V!=null&&V.matches(K)||(V&&(I=er({},I)),I[K.keyFormat]=K)}else Ki.warn(`[Keys] Ignoring unsupported EXT-X-KEY tag: "${Z}"`);break}case"START":c.startTimeOffset=ak(Z);break;case"MAP":{const K=new Br(Z,c);if(x.duration){const V=new tS(r,l);uk(V,K,n,I),f=V,x.initSegment=f,f.rawProgramDateTime&&!x.rawProgramDateTime&&(x.rawProgramDateTime=f.rawProgramDateTime)}else{const V=x.byteRangeEndOffset;if(V){const W=x.byteRangeStartOffset;P=`${V-W}@${W}`}else P=null;uk(x,K,n,I),f=x,L=!0}f.cc=g;break}case"SERVER-CONTROL":{R&&pf(c,X,w),R=new Br(Z),c.canBlockReload=R.bool("CAN-BLOCK-RELOAD"),c.canSkipUntil=R.optionalFloat("CAN-SKIP-UNTIL",0),c.canSkipDateRanges=c.canSkipUntil>0&&R.bool("CAN-SKIP-DATERANGES"),c.partHoldBack=R.optionalFloat("PART-HOLD-BACK",0),c.holdBack=R.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{c.partTarget&&pf(c,X,w);const K=new Br(Z);c.partTarget=K.decimalFloatingPoint("PART-TARGET");break}case"PART":{let K=c.partList;K||(K=c.partList=[]);const V=m>0?K[K.length-1]:void 0,W=m++,F=new Br(Z,c),Y=new MQ(F,x,l,W,V);K.push(Y),x.duration+=Y.duration;break}case"PRELOAD-HINT":{const K=new Br(Z,c);c.preloadHint=K;break}case"RENDITION-REPORT":{const K=new Br(Z,c);c.renditionReports=c.renditionReports||[],c.renditionReports.push(K);break}default:Ki.warn(`line parsed but not handled: ${w}`);break}}}E&&!E.relurl?(u.pop(),y-=E.duration,c.partList&&(c.fragmentHint=E)):c.partList&&(C5(x,E,h),x.cc=g,c.fragmentHint=x,I&&hk(x,I,c)),c.targetduration||(c.playlistParsingError=new Error("Missing Target Duration"));const U=u.length,k=u[0],H=u[U-1];if(y+=c.skippedSegments*c.targetduration,y>0&&U&&H){c.averagetargetduration=y/U;const G=H.sn;c.endSN=G!=="initSegment"?G:0,c.live||(H.endList=!0),M>0&&(Cme(u,M),k&&h.unshift(k))}return c.fragmentHint&&(y+=c.fragmentHint.duration),c.totalduration=y,h.length&&c.dateRangeTagCount&&k&&nV(h,c),c.endCC=g,c}}function nV(i,e){let t=i.length;if(!t)if(e.hasProgramDateTime){const a=e.fragments[e.fragments.length-1];i.push(a),t++}else return;const n=i[t-1],r=e.live?1/0:e.totalduration,s=Object.keys(e.dateRanges);for(let a=s.length;a--;){const l=e.dateRanges[s[a]],c=l.startDate.getTime();l.tagAnchor=n.ref;for(let u=t;u--;){var o;if(((o=i[u])==null?void 0:o.sn)<e.startSN)break;const h=wme(e,c,i,u,r);if(h!==-1){l.tagAnchor=e.fragments[h].ref;break}}}}function wme(i,e,t,n,r){const s=t[n];if(s){const a=s.programDateTime;if(e>=a||n===0){var o;const l=(((o=t[n+1])==null?void 0:o.start)||r)-s.start;if(e<=a+l*1e3){const c=t[n].sn-i.startSN;if(c<0)return-1;const u=i.fragments;if(u.length>t.length){const f=(t[n+1]||u[u.length-1]).sn-i.startSN;for(let d=f;d>c;d--){const m=u[d].programDateTime;if(e>=m&&e<m+u[d].duration*1e3)return d}}return c}}}return-1}function ok(i,e,t){var n,r;const s=new Br(i,t),o=(n=s.METHOD)!=null?n:"",a=s.URI,l=s.hexadecimalInteger("IV"),c=s.KEYFORMATVERSIONS,u=(r=s.KEYFORMAT)!=null?r:"identity";a&&s.IV&&!l&&Ki.error(`Invalid IV: ${s.IV}`);const h=a?Au.resolve(a,e):"",f=(c||"1").split("/").map(Number).filter(Number.isFinite);return new Df(o,h,u,f,l,s.KEYID)}function ak(i){const t=new Br(i).decimalFloatingPoint("TIME-OFFSET");return jt(t)?t:null}function lk(i,e){let t=(i||"").split(/[ ,]+/).filter(n=>n);["video","audio","text"].forEach(n=>{const r=t.filter(s=>zR(s,n));r.length&&(e[`${n}Codec`]=r.map(s=>s.split("/")[0]).join(","),t=t.filter(s=>r.indexOf(s)===-1))}),e.unknownCodecs=t}function ck(i,e,t){const n=e[t];n&&(i[t]=n)}function Cme(i,e){let t=i[e];for(let n=e;n--;){const r=i[n];if(!r)return;r.programDateTime=t.programDateTime-r.duration*1e3,t=r}}function C5(i,e,t){i.rawProgramDateTime?t.push(i):e!=null&&e.programDateTime&&(i.programDateTime=e.endProgramDateTime)}function uk(i,e,t,n){i.relurl=e.URI,e.BYTERANGE&&i.setByteRange(e.BYTERANGE),i.level=t,i.sn="initSegment",n&&(i.levelkeys=n),i.initSegment=null}function hk(i,e,t){i.levelkeys=e;const{encryptedFragments:n}=t;(!n.length||n[n.length-1].levelkeys!==e)&&Object.keys(e).some(r=>e[r].isCommonEncryption)&&n.push(i)}function pf(i,e,t){i.playlistParsingError=new Error(`#EXT-X-${e} must not appear more than once (${t[0]})`)}function fk(i,e,t){i.playlistParsingError=new Error(`#EXT-X-${e} must appear before the first Media Segment (${t[0]})`)}function Nb(i,e){const t=e.startPTS;if(jt(t)){let n=0,r;e.sn>i.sn?(n=t-i.start,r=i):(n=i.start-t,r=e),r.duration!==n&&r.setDuration(n)}else e.sn>i.sn?i.cc===e.cc&&i.minEndPTS?e.setStart(i.start+(i.minEndPTS-i.start)):e.setStart(i.start+i.duration):e.setStart(Math.max(i.start-e.duration,0))}function iV(i,e,t,n,r,s,o){n-t<=0&&(o.warn("Fragment should have a positive duration",e),n=t+e.duration,s=r+e.duration);let l=t,c=n;const u=e.startPTS,h=e.endPTS;if(jt(u)){const A=Math.abs(u-t);i&&A>i.totalduration?o.warn(`media timestamps and playlist times differ by ${A}s for level ${e.level} ${i.url}`):jt(e.deltaPTS)?e.deltaPTS=Math.max(A,e.deltaPTS):e.deltaPTS=A,l=Math.max(t,u),t=Math.min(t,u),r=e.startDTS!==void 0?Math.min(r,e.startDTS):r,c=Math.min(n,h),n=Math.max(n,h),s=e.endDTS!==void 0?Math.max(s,e.endDTS):s}const f=t-e.start;e.start!==0&&e.setStart(t),e.setDuration(n-e.start),e.startPTS=t,e.maxStartPTS=l,e.startDTS=r,e.endPTS=n,e.minEndPTS=c,e.endDTS=s;const d=e.sn;if(!i||d<i.startSN||d>i.endSN)return 0;let m;const y=d-i.startSN,g=i.fragments;for(g[y]=e,m=y;m>0;m--)Nb(g[m],g[m-1]);for(m=y;m<g.length-1;m++)Nb(g[m],g[m+1]);return i.fragmentHint&&Nb(g[g.length-1],i.fragmentHint),i.PTSKnown=i.alignedSliding=!0,f}function Tme(i,e,t){if(i===e)return;let n=null;const r=i.fragments;for(let u=r.length-1;u>=0;u--){const h=r[u].initSegment;if(h){n=h;break}}i.fragmentHint&&delete i.fragmentHint.endPTS;let s;Mme(i,e,(u,h,f,d)=>{if((!e.startCC||e.skippedSegments)&&h.cc!==u.cc){const m=u.cc-h.cc;for(let y=f;y<d.length;y++)d[y].cc+=m;e.endCC=d[d.length-1].cc}jt(u.startPTS)&&jt(u.endPTS)&&(h.setStart(h.startPTS=u.startPTS),h.startDTS=u.startDTS,h.maxStartPTS=u.maxStartPTS,h.endPTS=u.endPTS,h.endDTS=u.endDTS,h.minEndPTS=u.minEndPTS,h.setDuration(u.endPTS-u.startPTS),h.duration&&(s=h),e.PTSKnown=e.alignedSliding=!0),u.hasStreams&&(h.elementaryStreams=u.elementaryStreams),h.loader=u.loader,u.hasStats&&(h.stats=u.stats),u.initSegment&&(h.initSegment=u.initSegment,n=u.initSegment)});const o=e.fragments,a=e.fragmentHint?o.concat(e.fragmentHint):o;if(n&&a.forEach(u=>{var h;u&&(!u.initSegment||u.initSegment.relurl===((h=n)==null?void 0:h.relurl))&&(u.initSegment=n)}),e.skippedSegments){if(e.deltaUpdateFailed=o.some(u=>!u),e.deltaUpdateFailed){t.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let u=e.skippedSegments;u--;)o.shift();e.startSN=o[0].sn}else{e.canSkipDateRanges&&(e.dateRanges=bme(i.dateRanges,e,t));const u=i.fragments.filter(h=>h.rawProgramDateTime);if(i.hasProgramDateTime&&!e.hasProgramDateTime)for(let h=1;h<a.length;h++)a[h].programDateTime===null&&C5(a[h],a[h-1],u);nV(u,e)}e.endCC=o[o.length-1].cc}if(!e.startCC){var l;const u=oV(i,e.startSN-1);e.startCC=(l=u==null?void 0:u.cc)!=null?l:o[0].cc}Ime(i.partList,e.partList,(u,h)=>{h.elementaryStreams=u.elementaryStreams,h.stats=u.stats}),s?iV(e,s,s.startPTS,s.endPTS,s.startDTS,s.endDTS,t):rV(i,e),o.length&&(e.totalduration=e.edge-o[0].start),e.driftStartTime=i.driftStartTime,e.driftStart=i.driftStart;const c=e.advancedDateTime;if(e.advanced&&c){const u=e.edge;e.driftStart||(e.driftStartTime=c,e.driftStart=u),e.driftEndTime=c,e.driftEnd=u}else e.driftEndTime=i.driftEndTime,e.driftEnd=i.driftEnd,e.advancedDateTime=i.advancedDateTime;e.requestScheduled===-1&&(e.requestScheduled=i.requestScheduled)}function bme(i,e,t){const{dateRanges:n,recentlyRemovedDateranges:r}=e,s=er({},i);r&&r.forEach(l=>{delete s[l]});const a=Object.keys(s).length;return a?(Object.keys(n).forEach(l=>{const c=s[l],u=new VR(n[l].attr,c);u.isValid?(s[l]=u,c||(u.tagOrder+=a)):t.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${lr(n[l].attr)}"`)}),s):n}function Ime(i,e,t){if(i&&e){let n=0;for(let r=0,s=i.length;r<=s;r++){const o=i[r],a=e[r+n];o&&a&&o.index===a.index&&o.fragment.sn===a.fragment.sn?t(o,a):n--}}}function Mme(i,e,t){const n=e.skippedSegments,r=Math.max(i.startSN,e.startSN)-e.startSN,s=(i.fragmentHint?1:0)+(n?e.endSN:Math.min(i.endSN,e.endSN))-e.startSN,o=e.startSN-i.startSN,a=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,l=i.fragmentHint?i.fragments.concat(i.fragmentHint):i.fragments;for(let c=r;c<=s;c++){const u=l[o+c];let h=a[c];if(n&&!h&&u&&(h=e.fragments[c]=u),u&&h){t(u,h,c,a);const f=u.relurl,d=h.relurl;if(f&&Rme(f,d)){e.playlistParsingError=dk(`media sequence mismatch ${h.sn}:`,i,e,u,h);return}else if(u.cc!==h.cc){e.playlistParsingError=dk(`discontinuity sequence mismatch (${u.cc}!=${h.cc})`,i,e,u,h);return}}}}function dk(i,e,t,n,r){return new Error(`${i} ${r.url}
Playlist starting @${e.startSN}
${e.m3u8}

Playlist starting @${t.startSN}
${t.m3u8}`)}function rV(i,e,t=!0){const n=e.startSN+e.skippedSegments-i.startSN,r=i.fragments,s=n>=0;let o=0;if(s&&n<r.length)o=r[n].start;else if(s&&e.startSN===i.endSN+1)o=i.fragmentEnd;else if(s&&t)o=i.fragmentStart+n*e.levelTargetDuration;else if(!e.skippedSegments&&e.fragmentStart===0)o=i.fragmentStart;else return;T5(e,o)}function T5(i,e){if(e){const t=i.fragments;for(let n=i.skippedSegments;n<t.length;n++)t[n].addStart(e);i.fragmentHint&&i.fragmentHint.addStart(e)}}function sV(i,e=1/0){let t=1e3*i.targetduration;if(i.updated){const n=i.fragments;if(n.length&&t*4>e){const s=n[n.length-1].duration*1e3;s<t&&(t=s)}}else t/=2;return Math.round(t)}function oV(i,e,t){if(!i)return null;let n=i.fragments[e-i.startSN];return n||(n=i.fragmentHint,n&&n.sn===e)?n:e<i.startSN&&t&&t.sn===e?t:null}function pk(i,e,t){return i?aV(i.partList,e,t):null}function aV(i,e,t){if(i)for(let n=i.length;n--;){const r=i[n];if(r.index===t&&r.fragment.sn===e)return r}return null}function lV(i){i.forEach((e,t)=>{var n;(n=e.details)==null||n.fragments.forEach(r=>{r.level=t,r.initSegment&&(r.initSegment.level=t)})})}function Rme(i,e){return i!==e&&e?mk(i)!==mk(e):!1}function mk(i){return i.replace(/\?[^?]*$/,"")}function u2(i,e){for(let n=0,r=i.length;n<r;n++){var t;if(((t=i[n])==null?void 0:t.cc)===e)return i[n]}return null}function Pme(i,e){return!!(i&&e.startCC<i.endCC&&e.endCC>i.startCC)}function gk(i,e){const t=i.start+e;i.startPTS=t,i.setStart(t),i.endPTS=t+i.duration}function cV(i,e){const t=e.fragments;for(let n=0,r=t.length;n<r;n++)gk(t[n],i);e.fragmentHint&&gk(e.fragmentHint,i),e.alignedSliding=!0}function Lme(i,e){i&&(uV(e,i),e.alignedSliding||qS(e,i),!e.alignedSliding&&!e.skippedSegments&&rV(i,e,!1))}function uV(i,e){if(!Pme(e,i))return;const t=Math.min(e.endCC,i.endCC),n=u2(e.fragments,t),r=u2(i.fragments,t);if(!n||!r)return;Ki.log(`Aligning playlist at start of dicontinuity sequence ${t}`);const s=n.start-r.start;cV(s,i)}function qS(i,e){if(!i.hasProgramDateTime||!e.hasProgramDateTime)return;const t=i.fragments,n=e.fragments;if(!t.length||!n.length)return;let r,s;const o=Math.min(e.endCC,i.endCC);e.startCC<o&&i.startCC<o&&(r=u2(n,o),s=u2(t,o)),(!r||!s)&&(r=n[Math.floor(n.length/2)],s=u2(t,r.cc)||t[Math.floor(t.length/2)]);const a=r.programDateTime,l=s.programDateTime;if(!a||!l)return;const c=(l-a)/1e3-(s.start-r.start);cV(c,i)}function _a(i,e,t){Za(i,e,t),i.addEventListener(e,t)}function Za(i,e,t){i.removeEventListener(e,t)}const Bme={toString:function(i){let e="";const t=i.length;for(let n=0;n<t;n++)e+=`[${i.start(n).toFixed(3)}-${i.end(n).toFixed(3)}]`;return e}},mt={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"};class E4 extends XQ{constructor(e,t,n,r,s){super(r,e.logger),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=mt.STOPPED,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.buffering=!0,this.loadingParts=!1,this.loopSn=void 0,this.onMediaSeeking=()=>{const{config:o,fragCurrent:a,media:l,mediaBuffer:c,state:u}=this,h=l?l.currentTime:0,f=Wn.bufferInfo(c||l,h,o.maxBufferHole),d=!f.len;if(this.log(`Media seeking to ${jt(h)?h.toFixed(3):h}, state: ${u}, ${d?"out of":"in"} buffer`),this.state===mt.ENDED)this.resetLoadingState();else if(a){const m=o.maxFragLookUpTolerance,y=a.start-m,g=a.start+a.duration+m;if(d||g<f.start||y>f.end){const A=h>g;(h<y||A)&&(A&&a.loader&&(this.log(`Cancelling fragment load for seek (sn: ${a.sn})`),a.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}if(l){this.fragmentTracker.removeFragmentsInRange(h,1/0,this.playlistType,!0);const m=this.lastCurrentTime;if(h>m&&(this.lastCurrentTime=h),!this.loadingParts){const y=Math.max(f.end,h),g=this.shouldLoadParts(this.getLevelDetails(),y);g&&(this.log(`LL-Part loading ON after seeking to ${h.toFixed(2)} with buffer @${y.toFixed(2)}`),this.loadingParts=g)}}this.hls.hasEnoughToStart||(this.log(`Setting ${d?"startPosition":"nextLoadPosition"} to ${h} for seek without enough to start`),this.nextLoadPosition=h,d&&(this.startPosition=h)),d&&this.state===mt.IDLE&&this.tickImmediate()},this.onMediaEnded=()=>{this.log("setting startPosition to 0 because media ended"),this.startPosition=this.lastCurrentTime=0},this.playlistType=s,this.hls=e,this.fragmentLoader=new lme(e.config),this.keyLoader=n,this.fragmentTracker=t,this.config=e.config,this.decrypter=new QR(e.config)}registerListeners(){const{hls:e}=this;e.on(ae.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(ae.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(ae.MANIFEST_LOADING,this.onManifestLoading,this),e.on(ae.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(ae.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(ae.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(ae.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(ae.MANIFEST_LOADING,this.onManifestLoading,this),e.off(ae.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(ae.ERROR,this.onError,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(e){}stopLoad(){if(this.state===mt.STOPPED)return;this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const e=this.fragCurrent;e!=null&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=mt.STOPPED}get startPositionValue(){const{nextLoadPosition:e,startPosition:t}=this;return t===-1&&e?e:t}get bufferingEnabled(){return this.buffering}pauseBuffering(){this.buffering=!1}resumeBuffering(){this.buffering=!0}get inFlightFrag(){return{frag:this.fragCurrent,state:this.state}}_streamEnded(e,t){if(t.live||!this.media)return!1;const n=e.end||0,r=this.config.timelineOffset||0;if(n<=r)return!1;const s=e.buffered;this.config.maxBufferHole&&s&&s.length>1&&(e=Wn.bufferedInfo(s,e.start,0));const o=e.nextStart;if(o&&o>r&&o<t.edge||this.media.currentTime<e.start)return!1;const l=t.partList;if(l!=null&&l.length){const u=l[l.length-1];return Wn.isBuffered(this.media,u.start+u.duration/2)}const c=t.fragments[t.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(c)}getLevelDetails(){if(this.levels&&this.levelLastLoaded!==null)return this.levelLastLoaded.details}get timelineOffset(){const e=this.config.timelineOffset;if(e){var t;return((t=this.getLevelDetails())==null?void 0:t.appliedTimelineOffset)||e}return 0}onMediaAttached(e,t){const n=this.media=this.mediaBuffer=t.media;_a(n,"seeking",this.onMediaSeeking),_a(n,"ended",this.onMediaEnded);const r=this.config;this.levels&&r.autoStartLoad&&this.state===mt.STOPPED&&this.startLoad(r.startPosition)}onMediaDetaching(e,t){const n=!!t.transferMedia,r=this.media;if(r!==null){if(r.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),Za(r,"seeking",this.onMediaSeeking),Za(r,"ended",this.onMediaEnded),this.keyLoader&&!n&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loopSn=void 0,n){this.resetLoadingState(),this.resetTransmuxer();return}this.loadingParts=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}}onManifestLoading(){this.initPTS=[],this.levels=this.levelLastLoaded=this.fragCurrent=null,this.lastCurrentTime=this.startPosition=0,this.startFragRequested=!1}onError(e,t){}onManifestLoaded(e,t){this.startTimeOffset=t.startTimeOffset}onHandlerDestroying(){this.stopLoad(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),super.onHandlerDestroying(),this.hls=this.onMediaSeeking=this.onMediaEnded=null}onHandlerDestroyed(){this.state=mt.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(e,t,n){this.startFragRequested=!0,this._loadFragForPlayback(e,t,n)}_loadFragForPlayback(e,t,n){const r=s=>{const o=s.frag;if(this.fragContextChanged(o)){this.warn(`${o.type} sn: ${o.sn}${s.part?" part: "+s.part.index:""} of ${this.fragInfo(o,!1,s.part)}) was dropped during download.`),this.fragmentTracker.removeFragment(o);return}o.stats.chunkCount++,this._handleFragmentLoadProgress(s)};this._doFragLoad(e,t,n,r).then(s=>{if(!s)return;const o=this.state,a=s.frag;if(this.fragContextChanged(a)){(o===mt.FRAG_LOADING||!this.fragCurrent&&o===mt.PARSING)&&(this.fragmentTracker.removeFragment(a),this.state=mt.IDLE);return}"payload"in s&&(this.log(`Loaded ${a.type} sn: ${a.sn} of ${this.playlistLabel()} ${a.level}`),this.hls.trigger(ae.FRAG_LOADED,s)),this._handleFragmentLoadComplete(s)}).catch(s=>{this.state===mt.STOPPED||this.state===mt.ERROR||(this.warn(`Frag error: ${(s==null?void 0:s.message)||s}`),this.resetFragmentLoading(e))})}clearTrackerIfNeeded(e){var t;const{fragmentTracker:n}=this;if(n.getState(e)===eo.APPENDING){const s=e.type,o=this.getFwdBufferInfo(this.mediaBuffer,s),a=Math.max(e.duration,o?o.len:this.config.maxBufferLength),l=this.backtrackFragment;((l?e.sn-l.sn:0)===1||this.reduceMaxBufferLength(a,e.duration))&&n.removeFragment(e)}else((t=this.mediaBuffer)==null?void 0:t.buffered.length)===0?n.removeAllFragments():n.hasParts(e.type)&&(n.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),n.getState(e)===eo.PARTIAL&&n.removeFragment(e))}checkLiveUpdate(e){if(e.updated&&!e.live){const t=e.fragments[e.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type})}e.fragments[0]||(e.deltaUpdateFailed=!0)}waitForLive(e){const t=e.details;return(t==null?void 0:t.live)&&t.type!=="EVENT"&&(this.levelLastLoaded!==e||t.expired)}flushMainBuffer(e,t,n=null){if(!(e-t))return;const r={startOffset:e,endOffset:t,type:n};this.hls.trigger(ae.BUFFER_FLUSHING,r)}_loadInitSegment(e,t){this._doFragLoad(e,t).then(n=>{const r=n==null?void 0:n.frag;if(!r||this.fragContextChanged(r)||!this.levels)throw new Error("init load aborted");return n}).then(n=>{const{hls:r}=this,{frag:s,payload:o}=n,a=s.decryptdata;if(o&&o.byteLength>0&&a!=null&&a.key&&a.iv&&$1(a.method)){const l=self.performance.now();return this.decrypter.decrypt(new Uint8Array(o),a.key.buffer,a.iv.buffer,jR(a.method)).catch(c=>{throw r.trigger(ae.ERROR,{type:rn.MEDIA_ERROR,details:Ke.FRAG_DECRYPT_ERROR,fatal:!1,error:c,reason:c.message,frag:s}),c}).then(c=>{const u=self.performance.now();return r.trigger(ae.FRAG_DECRYPTED,{frag:s,payload:c,stats:{tstart:l,tdecrypt:u}}),n.payload=c,this.completeInitSegmentLoad(n)})}return this.completeInitSegmentLoad(n)}).catch(n=>{this.state===mt.STOPPED||this.state===mt.ERROR||(this.warn(n),this.resetFragmentLoading(e))})}completeInitSegmentLoad(e){const{levels:t}=this;if(!t)throw new Error("init load aborted, missing levels");const n=e.frag.stats;this.state!==mt.STOPPED&&(this.state=mt.IDLE),e.frag.data=new Uint8Array(e.payload),n.parsing.start=n.buffering.start=self.performance.now(),n.parsing.end=n.buffering.end=self.performance.now(),this.tick()}unhandledEncryptionError(e,t){var n,r;const s=e.tracks;if(s&&!t.encrypted&&((n=s.audio)!=null&&n.encrypted||(r=s.video)!=null&&r.encrypted)&&(!this.config.emeEnabled||!this.keyLoader.emeController)){const o=this.media,a=new Error(`Encrypted track with no key in ${this.fragInfo(t)} (media ${o?"attached mediaKeys: "+o.mediaKeys:"detached"})`);return this.warn(a.message),!o||o.mediaKeys?!1:(this.hls.trigger(ae.ERROR,{type:rn.KEY_SYSTEM_ERROR,details:Ke.KEY_SYSTEM_NO_KEYS,fatal:!1,error:a,frag:t}),this.resetTransmuxer(),!0)}return!1}fragContextChanged(e){const{fragCurrent:t}=this;return!e||!t||e.sn!==t.sn||e.level!==t.level}fragBufferedComplete(e,t){const n=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log(`Buffered ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)} > buffer:${n?Bme.toString(Wn.getBuffered(n)):"(detached)"})`),As(e)){var r;if(e.type!==$t.SUBTITLE){const o=e.elementaryStreams;if(!Object.keys(o).some(a=>!!o[a])){this.state=mt.IDLE;return}}const s=(r=this.levels)==null?void 0:r[e.level];s!=null&&s.fragmentError&&(this.log(`Resetting level fragment error count of ${s.fragmentError} on frag buffered`),s.fragmentError=0)}this.state=mt.IDLE}_handleFragmentLoadComplete(e){const{transmuxer:t}=this;if(!t)return;const{frag:n,part:r,partsLoaded:s}=e,o=!s||s.length===0||s.some(l=>!l),a=new x4(n.level,n.sn,n.stats.chunkCount+1,0,r?r.index:-1,!o);t.flush(a)}_handleFragmentLoadProgress(e){}_doFragLoad(e,t,n=null,r){var s;this.fragCurrent=e;const o=t.details;if(!this.levels||!o)throw new Error(`frag load aborted, missing level${o?"":" detail"}s`);let a=null;if(e.encrypted&&!((s=e.decryptdata)!=null&&s.key)){if(this.log(`Loading key for ${e.sn} of [${o.startSN}-${o.endSN}], ${this.playlistLabel()} ${e.level}`),this.state=mt.KEY_LOADING,this.fragCurrent=e,a=this.keyLoader.load(e).then(f=>{if(!this.fragContextChanged(f.frag))return this.hls.trigger(ae.KEY_LOADED,f),this.state===mt.KEY_LOADING&&(this.state=mt.IDLE),f}),this.hls.trigger(ae.KEY_LOADING,{frag:e}),this.fragCurrent===null)return this.log("context changed in KEY_LOADING"),Promise.resolve(null)}else e.encrypted||(a=this.keyLoader.loadClear(e,o.encryptedFragments,this.startFragRequested),a&&this.log("[eme] blocking frag load until media-keys acquired"));const l=this.fragPrevious;if(As(e)&&(!l||e.sn!==l.sn)){const f=this.shouldLoadParts(t.details,e.end);f!==this.loadingParts&&(this.log(`LL-Part loading ${f?"ON":"OFF"} loading sn ${l==null?void 0:l.sn}->${e.sn}`),this.loadingParts=f)}if(n=Math.max(e.start,n||0),this.loadingParts&&As(e)){const f=o.partList;if(f&&r){n>o.fragmentEnd&&o.fragmentHint&&(e=o.fragmentHint);const d=this.getNextPart(f,e,n);if(d>-1){const m=f[d];e=this.fragCurrent=m.fragment,this.log(`Loading ${e.type} sn: ${e.sn} part: ${m.index} (${d}/${f.length-1}) of ${this.fragInfo(e,!1,m)}) cc: ${e.cc} [${o.startSN}-${o.endSN}], target: ${parseFloat(n.toFixed(3))}`),this.nextLoadPosition=m.start+m.duration,this.state=mt.FRAG_LOADING;let y;return a?y=a.then(g=>!g||this.fragContextChanged(g.frag)?null:this.doFragPartsLoad(e,m,t,r)).catch(g=>this.handleFragLoadError(g)):y=this.doFragPartsLoad(e,m,t,r).catch(g=>this.handleFragLoadError(g)),this.hls.trigger(ae.FRAG_LOADING,{frag:e,part:m,targetBufferTime:n}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):y}else if(!e.url||this.loadedEndOfParts(f,n))return Promise.resolve(null)}}if(As(e)&&this.loadingParts){var c;this.log(`LL-Part loading OFF after next part miss @${n.toFixed(2)} Check buffer at sn: ${e.sn} loaded parts: ${(c=o.partList)==null?void 0:c.filter(f=>f.loaded).map(f=>`[${f.start}-${f.end}]`)}`),this.loadingParts=!1}else if(!e.url)return Promise.resolve(null);this.log(`Loading ${e.type} sn: ${e.sn} of ${this.fragInfo(e,!1)}) cc: ${e.cc} ${"["+o.startSN+"-"+o.endSN+"]"}, target: ${parseFloat(n.toFixed(3))}`),jt(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=mt.FRAG_LOADING;const u=this.config.progressive&&e.type!==$t.SUBTITLE;let h;return u&&a?h=a.then(f=>!f||this.fragContextChanged(f.frag)?null:this.fragmentLoader.load(e,r)).catch(f=>this.handleFragLoadError(f)):h=Promise.all([this.fragmentLoader.load(e,u?r:void 0),a]).then(([f])=>(!u&&r&&r(f),f)).catch(f=>this.handleFragLoadError(f)),this.hls.trigger(ae.FRAG_LOADING,{frag:e,targetBufferTime:n}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):h}doFragPartsLoad(e,t,n,r){return new Promise((s,o)=>{var a;const l=[],c=(a=n.details)==null?void 0:a.partList,u=h=>{this.fragmentLoader.loadPart(e,h,r).then(f=>{l[h.index]=f;const d=f.part;this.hls.trigger(ae.FRAG_LOADED,f);const m=pk(n.details,e.sn,h.index+1)||aV(c,e.sn,h.index+1);if(m)u(m);else return s({frag:e,part:d,partsLoaded:l})}).catch(o)};u(t)})}handleFragLoadError(e){if("data"in e){const t=e.data;t.frag&&t.details===Ke.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):t.frag&&t.type===rn.KEY_SYSTEM_ERROR?(t.frag.abortRequests(),this.resetStartWhenNotLoaded(),this.resetFragmentLoading(t.frag)):this.hls.trigger(ae.ERROR,t)}else this.hls.trigger(ae.ERROR,{type:rn.OTHER_ERROR,details:Ke.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null}_handleTransmuxerFlush(e){const t=this.getCurrentContext(e);if(!t||this.state!==mt.PARSING){!this.fragCurrent&&this.state!==mt.STOPPED&&this.state!==mt.ERROR&&(this.state=mt.IDLE);return}const{frag:n,part:r,level:s}=t,o=self.performance.now();n.stats.parsing.end=o,r&&(r.stats.parsing.end=o);const a=this.getLevelDetails(),c=a&&n.sn>a.endSN||this.shouldLoadParts(a,n.end);c!==this.loadingParts&&(this.log(`LL-Part loading ${c?"ON":"OFF"} after parsing segment ending @${n.end.toFixed(2)}`),this.loadingParts=c),this.updateLevelTiming(n,r,s,e.partial)}shouldLoadParts(e,t){if(this.config.lowLatencyMode){if(!e)return this.loadingParts;if(e.partList){var n;const s=e.partList[0];if(s.fragment.type===$t.SUBTITLE)return!1;const o=s.end+(((n=e.fragmentHint)==null?void 0:n.duration)||0);if(t>=o){var r;if((this.hls.hasEnoughToStart?((r=this.media)==null?void 0:r.currentTime)||this.lastCurrentTime:this.getLoadPosition())>s.start-s.fragment.duration)return!0}}}return!1}getCurrentContext(e){const{levels:t,fragCurrent:n}=this,{level:r,sn:s,part:o}=e;if(!(t!=null&&t[r]))return this.warn(`Levels object was unset while buffering fragment ${s} of ${this.playlistLabel()} ${r}. The current chunk will not be buffered.`),null;const a=t[r],l=a.details,c=o>-1?pk(l,s,o):null,u=c?c.fragment:oV(l,s,n);return u?(n&&n!==u&&(u.stats=n.stats),{frag:u,part:c,level:a}):null}bufferFragmentData(e,t,n,r,s){if(this.state!==mt.PARSING)return;const{data1:o,data2:a}=e;let l=o;if(a&&(l=Ac(o,a)),!l.length)return;const c=this.initPTS[t.cc],u=c?-c.baseTime/c.timescale:void 0,h={type:e.type,frag:t,part:n,chunkMeta:r,offset:u,parent:t.type,data:l};if(this.hls.trigger(ae.BUFFER_APPENDING,h),e.dropped&&e.independent&&!n){if(s)return;this.flushBufferGap(t)}}flushBufferGap(e){const t=this.media;if(!t)return;if(!Wn.isBuffered(t,t.currentTime)){this.flushMainBuffer(0,e.start);return}const n=t.currentTime,r=Wn.bufferInfo(t,n,0),s=e.duration,o=Math.min(this.config.maxFragLookUpTolerance*2,s*.25),a=Math.max(Math.min(e.start-o,r.end-o),n+o);e.start-a>o&&this.flushMainBuffer(a,e.start)}getFwdBufferInfo(e,t){var n;const r=this.getLoadPosition();if(!jt(r))return null;const o=this.lastCurrentTime>r||(n=this.media)!=null&&n.paused?0:this.config.maxBufferHole;return this.getFwdBufferInfoAtPos(e,r,t,o)}getFwdBufferInfoAtPos(e,t,n,r){const s=Wn.bufferInfo(e,t,r);if(s.len===0&&s.nextStart!==void 0){const o=this.fragmentTracker.getBufferedFrag(t,n);if(o&&(s.nextStart<=o.end||o.gap)){const a=Math.max(Math.min(s.nextStart,o.end)-t,r);return Wn.bufferInfo(e,t,a)}}return s}getMaxBufferLength(e){const{config:t}=this;let n;return e?n=Math.max(8*t.maxBufferSize/e,t.maxBufferLength):n=t.maxBufferLength,Math.min(n,t.maxMaxBufferLength)}reduceMaxBufferLength(e,t){const n=this.config,r=Math.max(Math.min(e-t,n.maxBufferLength),t),s=Math.max(e-t*3,n.maxMaxBufferLength/2,r);return s>=r?(n.maxMaxBufferLength=s,this.warn(`Reduce max buffer length to ${s}s`),!0):!1}getAppendedFrag(e,t=$t.MAIN){const n=this.fragmentTracker?this.fragmentTracker.getAppendedFrag(e,t):null;return n&&"fragment"in n?n.fragment:n}getNextFragment(e,t){const n=t.fragments,r=n.length;if(!r)return null;const{config:s}=this,o=n[0].start,a=s.lowLatencyMode&&!!t.partList;let l=null;if(t.live){const h=s.initialLiveManifestSize;if(r<h)return this.warn(`Not enough fragments to start playback (have: ${r}, need: ${h})`),null;if(!t.PTSKnown&&!this.startFragRequested&&this.startPosition===-1||e<o){var c;a&&!this.loadingParts&&(this.log("LL-Part loading ON for initial live fragment"),this.loadingParts=!0),l=this.getInitialLiveFragment(t);const f=this.hls.startPosition,d=this.hls.liveSyncPosition,m=l?(f!==-1&&f>=o?f:d)||l.start:e;this.log(`Setting startPosition to ${m} to match start frag at live edge. mainStart: ${f} liveSyncPosition: ${d} frag.start: ${(c=l)==null?void 0:c.start}`),this.startPosition=this.nextLoadPosition=m}}else e<=o&&(l=n[0]);if(!l){const h=this.loadingParts?t.partEnd:t.fragmentEnd;l=this.getFragmentAtPosition(e,h,t)}let u=this.filterReplacedPrimary(l,t);if(!u&&l){const h=l.sn-t.startSN;u=this.filterReplacedPrimary(n[h+1]||null,t)}return this.mapToInitFragWhenRequired(u)}isLoopLoading(e,t){const n=this.fragmentTracker.getState(e);return(n===eo.OK||n===eo.PARTIAL&&!!e.gap)&&this.nextLoadPosition>t}getNextFragmentLoopLoading(e,t,n,r,s){let o=null;if(e.gap&&(o=this.getNextFragment(this.nextLoadPosition,t),o&&!o.gap&&n.nextStart)){const a=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,n.nextStart,r,0);if(a!==null&&n.len+a.len>=s){const l=o.sn;return this.loopSn!==l&&(this.log(`buffer full after gaps in "${r}" playlist starting at sn: ${l}`),this.loopSn=l),null}}return this.loopSn=void 0,o}get primaryPrefetch(){if(Ak(this.config)){var e;if((e=this.hls.interstitialsManager)==null||(e=e.playingItem)==null?void 0:e.event)return!0}return!1}filterReplacedPrimary(e,t){if(!e)return e;if(Ak(this.config)&&e.type!==$t.SUBTITLE){const n=this.hls.interstitialsManager,r=n==null?void 0:n.bufferingItem;if(r){const o=r.event;if(o){if(o.appendInPlace||Math.abs(e.start-r.start)>1||r.start===0)return null}else if(e.end<=r.start&&(t==null?void 0:t.live)===!1||e.start>r.end&&r.nextEvent&&(r.nextEvent.appendInPlace||e.start-r.end>1))return null}const s=n==null?void 0:n.playerQueue;if(s)for(let o=s.length;o--;){const a=s[o].interstitial;if(a.appendInPlace&&e.start>=a.startTime&&e.end<=a.resumeTime)return null}}return e}mapToInitFragWhenRequired(e){return e!=null&&e.initSegment&&!e.initSegment.data&&!this.bitrateTest?e.initSegment:e}getNextPart(e,t,n){let r=-1,s=!1,o=!0;for(let a=0,l=e.length;a<l;a++){const c=e[a];if(o=o&&!c.independent,r>-1&&n<c.start)break;const u=c.loaded;u?r=-1:(s||(c.independent||o)&&c.fragment===t)&&(c.fragment!==t&&this.warn(`Need buffer at ${n} but next unloaded part starts at ${c.start}`),r=a),s=u}return r}loadedEndOfParts(e,t){let n;for(let r=e.length;r--;){if(n=e[r],!n.loaded)return!1;if(t>n.start)return!0}return!1}getInitialLiveFragment(e){const t=e.fragments,n=this.fragPrevious;let r=null;if(n){if(e.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${n.programDateTime}`),r=qpe(t,n.endProgramDateTime,this.config.maxFragLookUpTolerance)),!r){const s=n.sn+1;if(s>=e.startSN&&s<=e.endSN){const o=t[s-e.startSN];n.cc===o.cc&&(r=o,this.log(`Live playlist, switching playlist, load frag with next SN: ${r.sn}`))}r||(r=WQ(e,n.cc,n.end),r&&this.log(`Live playlist, switching playlist, load frag with same CC: ${r.sn}`))}}else{const s=this.hls.liveSyncPosition;s!==null&&(r=this.getFragmentAtPosition(s,this.bitrateTest?e.fragmentEnd:e.edge,e))}return r}getFragmentAtPosition(e,t,n){const{config:r}=this;let{fragPrevious:s}=this,{fragments:o,endSN:a}=n;const{fragmentHint:l}=n,{maxFragLookUpTolerance:c}=r,u=n.partList,h=!!(this.loadingParts&&u!=null&&u.length&&l);h&&!this.bitrateTest&&u[u.length-1].fragment.sn===l.sn&&(o=o.concat(l),a=l.sn);let f;if(e<t){var d;const y=e<this.lastCurrentTime||e>t-c||(d=this.media)!=null&&d.paused||!this.startFragRequested?0:c;f=o0(s,o,e,y)}else f=o[o.length-1];if(f){const m=f.sn-n.startSN,y=this.fragmentTracker.getState(f);if((y===eo.OK||y===eo.PARTIAL&&f.gap)&&(s=f),s&&f.sn===s.sn&&(!h||u[0].fragment.sn>f.sn||!n.live)&&f.level===s.level){const A=o[m+1];f.sn<a&&this.fragmentTracker.getState(A)!==eo.OK?f=A:f=null}}return f}alignPlaylists(e,t,n){const r=e.fragments.length;if(!r)return this.warn("No fragments in live playlist"),0;const s=e.fragmentStart,o=!t,a=e.alignedSliding&&jt(s);if(o||!a&&!s){Lme(n,e);const l=e.fragmentStart;return this.log(`Live playlist sliding: ${l.toFixed(2)} start-sn: ${t?t.startSN:"na"}->${e.startSN} fragments: ${r}`),l}return s}waitForCdnTuneIn(e){return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,e.partTarget*3)}setStartPosition(e,t){let n=this.startPosition;n<t&&(n=-1);const r=this.timelineOffset;if(n===-1){const s=this.startTimeOffset!==null,o=s?this.startTimeOffset:e.startTimeOffset;o!==null&&jt(o)?(n=t+o,o<0&&(n+=e.edge),n=Math.min(Math.max(t,n),t+e.totalduration),this.log(`Setting startPosition to ${n} for start time offset ${o} found in ${s?"multivariant":"media"} playlist`),this.startPosition=n):e.live?(n=this.hls.liveSyncPosition||t,this.log(`Setting startPosition to -1 to start at live edge ${n}`),this.startPosition=-1):(this.log("setting startPosition to 0 by default"),this.startPosition=n=0),this.lastCurrentTime=n+r}this.nextLoadPosition=n+r}getLoadPosition(){var e;const{media:t}=this;let n=0;return(e=this.hls)!=null&&e.hasEnoughToStart&&t?n=t.currentTime:this.nextLoadPosition>=0&&(n=this.nextLoadPosition),n}handleFragLoadAborted(e,t){this.transmuxer&&e.type===this.playlistType&&As(e)&&e.stats.aborted&&(this.log(`Fragment ${e.sn}${t?" part "+t.index:""} of ${this.playlistLabel()} ${e.level} was aborted`),this.resetFragmentLoading(e))}resetFragmentLoading(e){(!this.fragCurrent||!this.fragContextChanged(e)&&this.state!==mt.FRAG_LOADING_WAITING_RETRY)&&(this.state=mt.IDLE)}onFragmentOrKeyLoadError(e,t){var n;if(t.chunkMeta&&!t.frag){const A=this.getCurrentContext(t.chunkMeta);A&&(t.frag=A.frag)}const r=t.frag;if(!r||r.type!==e||!this.levels)return;if(this.fragContextChanged(r)){var s;this.warn(`Frag load error must match current frag to retry ${r.url} > ${(s=this.fragCurrent)==null?void 0:s.url}`);return}const o=t.details===Ke.FRAG_GAP;o&&this.fragmentTracker.fragBuffered(r,!0);const a=t.errorAction;if(!a){this.state=mt.ERROR;return}const{action:l,flags:c,retryCount:u=0,retryConfig:h}=a,f=!!h,d=f&&l===Zs.RetryRequest,m=f&&!a.resolved&&c===Ya.MoveAllAlternatesMatchingHost,y=(n=this.hls.latestLevelDetails)==null?void 0:n.live;if(!d&&m&&As(r)&&!r.endList&&y&&!YQ(t))this.resetFragmentErrors(e),this.treatAsGap(r),a.resolved=!0;else if((d||m)&&u<h.maxNumRetry){var g;const A=_5((g=t.response)==null?void 0:g.code),E=HR(h,u);if(this.resetStartWhenNotLoaded(),this.retryDate=self.performance.now()+E,this.state=mt.FRAG_LOADING_WAITING_RETRY,a.resolved=!0,A){this.log("Waiting for connection (offline)"),this.retryDate=1/0,t.reason="offline";return}this.warn(`Fragment ${r.sn} of ${e} ${r.level} errored with ${t.details}, retrying loading ${u+1}/${h.maxNumRetry} in ${E}ms`)}else if(h)if(this.resetFragmentErrors(e),u<h.maxNumRetry)!o&&l!==Zs.RemoveAlternatePermanently&&(a.resolved=!0);else{this.warn(`${t.details} reached or exceeded max retry (${u})`);return}else l===Zs.SendAlternateToPenaltyBox?this.state=mt.WAITING_LEVEL:this.state=mt.ERROR;this.tickImmediate()}checkRetryDate(){const e=self.performance.now(),t=this.retryDate,n=t===1/0;(!t||e>=t||n&&!_5(0))&&(n&&this.log("Connection restored (online)"),this.resetStartWhenNotLoaded(),this.state=mt.IDLE)}reduceLengthAndFlushBuffer(e){if(this.state===mt.PARSING||this.state===mt.PARSED){const t=e.frag,n=e.parent,r=this.getFwdBufferInfo(this.mediaBuffer,n),s=r&&r.len>.5;s&&this.reduceMaxBufferLength(r.len,(t==null?void 0:t.duration)||10);const o=!s;return o&&this.warn(`Buffer full error while media.currentTime (${this.getLoadPosition()}) is not buffered, flush ${n} buffer`),t&&(this.fragmentTracker.removeFragment(t),this.nextLoadPosition=t.start),this.resetLoadingState(),o}return!1}resetFragmentErrors(e){e===$t.AUDIO&&(this.fragCurrent=null),this.hls.hasEnoughToStart||(this.startFragRequested=!1),this.state!==mt.STOPPED&&(this.state=mt.IDLE)}afterBufferFlushed(e,t,n){if(!e)return;const r=Wn.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,r,n),this.state===mt.ENDED&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state!==mt.STOPPED&&(this.state=mt.IDLE)}resetStartWhenNotLoaded(){if(!this.hls.hasEnoughToStart){this.startFragRequested=!1;const e=this.levelLastLoaded,t=e?e.details:null;t!=null&&t.live?(this.log("resetting startPosition for live start"),this.startPosition=-1,this.setStartPosition(t,t.fragmentStart),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(e){this.log(`Loading context changed while buffering sn ${e.sn} of ${this.playlistLabel()} ${e.level===-1?"<removed>":e.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(),this.resetLoadingState()}removeUnbufferedFrags(e=0){this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)}updateLevelTiming(e,t,n,r){const s=n.details;if(!s){this.warn("level.details undefined");return}if(!Object.keys(e.elementaryStreams).reduce((l,c)=>{const u=e.elementaryStreams[c];if(u){const h=u.endPTS-u.startPTS;if(h<=0)return this.warn(`Could not parse fragment ${e.sn} ${c} duration reliably (${h})`),l||!1;const f=r?0:iV(s,e,u.startPTS,u.endPTS,u.startDTS,u.endDTS,this);return this.hls.trigger(ae.LEVEL_PTS_UPDATED,{details:s,level:n,drift:f,type:c,frag:e,start:u.startPTS,end:u.endPTS}),!0}return l},!1)){var a;const l=((a=this.transmuxer)==null?void 0:a.error)===null;if((n.fragmentError===0||l&&(n.fragmentError<2||e.endList))&&this.treatAsGap(e,n),l){const c=new Error(`Found no media in fragment ${e.sn} of ${this.playlistLabel()} ${e.level} resetting transmuxer to fallback to playlist timing`);if(this.warn(c.message),this.hls.trigger(ae.ERROR,{type:rn.MEDIA_ERROR,details:Ke.FRAG_PARSING_ERROR,fatal:!1,error:c,frag:e,reason:`Found no media in msn ${e.sn} of ${this.playlistLabel()} "${n.url}"`}),!this.hls)return;this.resetTransmuxer()}}this.state=mt.PARSED,this.log(`Parsed ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)})`),this.hls.trigger(ae.FRAG_PARSED,{frag:e,part:t})}playlistLabel(){return this.playlistType===$t.MAIN?"level":"track"}fragInfo(e,t=!0,n){var r,s;return`${this.playlistLabel()} ${e.level} (${n?"part":"frag"}:[${((r=t&&!n?e.startPTS:(n||e).start)!=null?r:NaN).toFixed(3)}-${((s=t&&!n?e.endPTS:(n||e).end)!=null?s:NaN).toFixed(3)}]${n&&e.type==="main"?"INDEPENDENT="+(n.independent?"YES":"NO"):""}`}treatAsGap(e,t){t&&t.fragmentError++,e.gap=!0,this.fragmentTracker.removeFragment(e),this.fragmentTracker.fragBuffered(e,!0)}resetTransmuxer(){var e;(e=this.transmuxer)==null||e.reset()}recoverWorkerError(e){e.event==="demuxerWorker"&&(this.fragmentTracker.removeAllFragments(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),this.resetStartWhenNotLoaded(),this.resetLoadingState())}set state(e){const t=this._state;t!==e&&(this._state=e,this.log(`${t}->${e}`))}get state(){return this._state}}function Ak(i){return!!i.interstitialsController&&i.enableInterstitialPlayback!==!1}class hV{constructor(){this.chunks=[],this.dataLength=0}push(e){this.chunks.push(e),this.dataLength+=e.length}flush(){const{chunks:e,dataLength:t}=this;let n;if(e.length)e.length===1?n=e[0]:n=Dme(e,t);else return new Uint8Array(0);return this.reset(),n}reset(){this.chunks.length=0,this.dataLength=0}}function Dme(i,e){const t=new Uint8Array(e);let n=0;for(let r=0;r<i.length;r++){const s=i[r];t.set(s,n),n+=s.length}return t}var Ub={exports:{}},yk;function kme(){return yk||(yk=1,(function(i){var e=Object.prototype.hasOwnProperty,t="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(t=!1));function r(l,c,u){this.fn=l,this.context=c,this.once=u||!1}function s(l,c,u,h,f){if(typeof u!="function")throw new TypeError("The listener must be a function");var d=new r(u,h||l,f),m=t?t+c:c;return l._events[m]?l._events[m].fn?l._events[m]=[l._events[m],d]:l._events[m].push(d):(l._events[m]=d,l._eventsCount++),l}function o(l,c){--l._eventsCount===0?l._events=new n:delete l._events[c]}function a(){this._events=new n,this._eventsCount=0}a.prototype.eventNames=function(){var c=[],u,h;if(this._eventsCount===0)return c;for(h in u=this._events)e.call(u,h)&&c.push(t?h.slice(1):h);return Object.getOwnPropertySymbols?c.concat(Object.getOwnPropertySymbols(u)):c},a.prototype.listeners=function(c){var u=t?t+c:c,h=this._events[u];if(!h)return[];if(h.fn)return[h.fn];for(var f=0,d=h.length,m=new Array(d);f<d;f++)m[f]=h[f].fn;return m},a.prototype.listenerCount=function(c){var u=t?t+c:c,h=this._events[u];return h?h.fn?1:h.length:0},a.prototype.emit=function(c,u,h,f,d,m){var y=t?t+c:c;if(!this._events[y])return!1;var g=this._events[y],A=arguments.length,E,x;if(g.fn){switch(g.once&&this.removeListener(c,g.fn,void 0,!0),A){case 1:return g.fn.call(g.context),!0;case 2:return g.fn.call(g.context,u),!0;case 3:return g.fn.call(g.context,u,h),!0;case 4:return g.fn.call(g.context,u,h,f),!0;case 5:return g.fn.call(g.context,u,h,f,d),!0;case 6:return g.fn.call(g.context,u,h,f,d,m),!0}for(x=1,E=new Array(A-1);x<A;x++)E[x-1]=arguments[x];g.fn.apply(g.context,E)}else{var w=g.length,T;for(x=0;x<w;x++)switch(g[x].once&&this.removeListener(c,g[x].fn,void 0,!0),A){case 1:g[x].fn.call(g[x].context);break;case 2:g[x].fn.call(g[x].context,u);break;case 3:g[x].fn.call(g[x].context,u,h);break;case 4:g[x].fn.call(g[x].context,u,h,f);break;default:if(!E)for(T=1,E=new Array(A-1);T<A;T++)E[T-1]=arguments[T];g[x].fn.apply(g[x].context,E)}}return!0},a.prototype.on=function(c,u,h){return s(this,c,u,h,!1)},a.prototype.once=function(c,u,h){return s(this,c,u,h,!0)},a.prototype.removeListener=function(c,u,h,f){var d=t?t+c:c;if(!this._events[d])return this;if(!u)return o(this,d),this;var m=this._events[d];if(m.fn)m.fn===u&&(!f||m.once)&&(!h||m.context===h)&&o(this,d);else{for(var y=0,g=[],A=m.length;y<A;y++)(m[y].fn!==u||f&&!m[y].once||h&&m[y].context!==h)&&g.push(m[y]);g.length?this._events[d]=g.length===1?g[0]:g:o(this,d)}return this},a.prototype.removeAllListeners=function(c){var u;return c?(u=t?t+c:c,this._events[u]&&o(this,u)):(this._events=new n,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=t,a.EventEmitter=a,i.exports=a})(Ub)),Ub.exports}var Fme=kme(),YR=hpe(Fme);const K2="1.6.15",fA={};function Ome(){return typeof __HLS_WORKER_BUNDLE__=="function"}function Nme(){const i=fA[K2];if(i)return i.clientCount++,i;const e=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),t=self.URL.createObjectURL(e),r={worker:new self.Worker(t),objectURL:t,clientCount:1};return fA[K2]=r,r}function Ume(i){const e=fA[i];if(e)return e.clientCount++,e;const t=new self.URL(i,self.location.href).href,r={worker:new self.Worker(t),scriptURL:t,clientCount:1};return fA[i]=r,r}function zme(i){const e=fA[i||K2];if(e&&e.clientCount--===1){const{worker:n,objectURL:r}=e;delete fA[i||K2],r&&self.URL.revokeObjectURL(r),n.terminate()}}function fV(i,e){return e+10<=i.length&&i[e]===51&&i[e+1]===68&&i[e+2]===73&&i[e+3]<255&&i[e+4]<255&&i[e+6]<128&&i[e+7]<128&&i[e+8]<128&&i[e+9]<128}function $R(i,e){return e+10<=i.length&&i[e]===73&&i[e+1]===68&&i[e+2]===51&&i[e+3]<255&&i[e+4]<255&&i[e+6]<128&&i[e+7]<128&&i[e+8]<128&&i[e+9]<128}function _4(i,e){let t=0;return t=(i[e]&127)<<21,t|=(i[e+1]&127)<<14,t|=(i[e+2]&127)<<7,t|=i[e+3]&127,t}function Y2(i,e){const t=e;let n=0;for(;$R(i,e);){n+=10;const r=_4(i,e+6);n+=r,fV(i,e+10)&&(n+=10),e+=n}if(n>0)return i.subarray(t,t+n)}function Gme(i,e,t,n){const r=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],s=e[t+2],o=s>>2&15;if(o>12){const d=new Error(`invalid ADTS sampling index:${o}`);i.emit(ae.ERROR,ae.ERROR,{type:rn.MEDIA_ERROR,details:Ke.FRAG_PARSING_ERROR,fatal:!0,error:d,reason:d.message});return}const a=(s>>6&3)+1,l=e[t+3]>>6&3|(s&1)<<2,c="mp4a.40."+a,u=r[o];let h=o;(a===5||a===29)&&(h-=3);const f=[a<<3|(h&14)>>1,(h&1)<<7|l<<3];return Ki.log(`manifest codec:${n}, parsed codec:${c}, channels:${l}, rate:${u} (ADTS object type:${a} sampling index:${o})`),{config:f,samplerate:u,channelCount:l,codec:c,parsedCodec:c,manifestCodec:n}}function dV(i,e){return i[e]===255&&(i[e+1]&246)===240}function pV(i,e){return i[e+1]&1?7:9}function XR(i,e){return(i[e+3]&3)<<11|i[e+4]<<3|(i[e+5]&224)>>>5}function Hme(i,e){return e+5<i.length}function JS(i,e){return e+1<i.length&&dV(i,e)}function Qme(i,e){return Hme(i,e)&&dV(i,e)&&XR(i,e)<=i.length-e}function Vme(i,e){if(JS(i,e)){const t=pV(i,e);if(e+t>=i.length)return!1;const n=XR(i,e);if(n<=t)return!1;const r=e+n;return r===i.length||JS(i,r)}return!1}function mV(i,e,t,n,r){if(!i.samplerate){const s=Gme(e,t,n,r);if(!s)return;er(i,s)}}function gV(i){return 1024*9e4/i}function jme(i,e){const t=pV(i,e);if(e+t<=i.length){const n=XR(i,e)-t;if(n>0)return{headerLength:t,frameLength:n}}}function AV(i,e,t,n,r){const s=gV(i.samplerate),o=n+r*s,a=jme(e,t);let l;if(a){const{frameLength:h,headerLength:f}=a,d=f+h,m=Math.max(0,t+d-e.length);m?(l=new Uint8Array(d-f),l.set(e.subarray(t+f,e.length),0)):l=e.subarray(t+f,t+d);const y={unit:l,pts:o};return m||i.samples.push(y),{sample:y,length:d,missing:m}}const c=e.length-t;return l=new Uint8Array(c),l.set(e.subarray(t,e.length),0),{sample:{unit:l,pts:o},length:c,missing:-1}}function Wme(i,e){return $R(i,e)&&_4(i,e+6)+10<=i.length-e}function Kme(i){return i instanceof ArrayBuffer?i:i.byteOffset==0&&i.byteLength==i.buffer.byteLength?i.buffer:new Uint8Array(i).buffer}function zb(i,e=0,t=1/0){return Yme(i,e,t,Uint8Array)}function Yme(i,e,t,n){const r=$me(i);let s=1;"BYTES_PER_ELEMENT"in n&&(s=n.BYTES_PER_ELEMENT);const o=Xme(i)?i.byteOffset:0,a=(o+i.byteLength)/s,l=(o+e)/s,c=Math.floor(Math.max(0,Math.min(l,a))),u=Math.floor(Math.min(c+Math.max(t,0),a));return new n(r,c,u-c)}function $me(i){return i instanceof ArrayBuffer?i:i.buffer}function Xme(i){return i&&i.buffer instanceof ArrayBuffer&&i.byteLength!==void 0&&i.byteOffset!==void 0}function qme(i){const e={key:i.type,description:"",data:"",mimeType:null,pictureType:null},t=3;if(i.size<2)return;if(i.data[0]!==t){console.log("Ignore frame with unrecognized character encoding");return}const n=i.data.subarray(1).indexOf(0);if(n===-1)return;const r=Ll(zb(i.data,1,n)),s=i.data[2+n],o=i.data.subarray(3+n).indexOf(0);if(o===-1)return;const a=Ll(zb(i.data,3+n,o));let l;return r==="-->"?l=Ll(zb(i.data,4+n+o)):l=Kme(i.data.subarray(4+n+o)),e.mimeType=r,e.pictureType=s,e.description=a,e.data=l,e}function Jme(i){if(i.size<2)return;const e=Ll(i.data,!0),t=new Uint8Array(i.data.subarray(e.length+1));return{key:i.type,info:e,data:t.buffer}}function Zme(i){if(i.size<2)return;if(i.type==="TXXX"){let t=1;const n=Ll(i.data.subarray(t),!0);t+=n.length+1;const r=Ll(i.data.subarray(t));return{key:i.type,info:n,data:r}}const e=Ll(i.data.subarray(1));return{key:i.type,info:"",data:e}}function e0e(i){if(i.type==="WXXX"){if(i.size<2)return;let t=1;const n=Ll(i.data.subarray(t),!0);t+=n.length+1;const r=Ll(i.data.subarray(t));return{key:i.type,info:n,data:r}}const e=Ll(i.data);return{key:i.type,info:"",data:e}}function t0e(i){return i.type==="PRIV"?Jme(i):i.type[0]==="W"?e0e(i):i.type==="APIC"?qme(i):Zme(i)}function n0e(i){const e=String.fromCharCode(i[0],i[1],i[2],i[3]),t=_4(i,4),n=10;return{type:e,size:t,data:i.subarray(n,n+t)}}const JE=10,i0e=10;function yV(i){let e=0;const t=[];for(;$R(i,e);){const n=_4(i,e+6);i[e+5]>>6&1&&(e+=JE),e+=JE;const r=e+n;for(;e+i0e<r;){const s=n0e(i.subarray(e)),o=t0e(s);o&&t.push(o),e+=s.size+JE}fV(i,e)&&(e+=JE)}return t}function vV(i){return i&&i.key==="PRIV"&&i.info==="com.apple.streaming.transportStreamTimestamp"}function r0e(i){if(i.data.byteLength===8){const e=new Uint8Array(i.data),t=e[3]&1;let n=(e[4]<<23)+(e[5]<<15)+(e[6]<<7)+e[7];return n/=45,t&&(n+=4772185884e-2),Math.round(n)}}function qR(i){const e=yV(i);for(let t=0;t<e.length;t++){const n=e[t];if(vV(n))return r0e(n)}}let Xa=(function(i){return i.audioId3="org.id3",i.dateRange="com.apple.quicktime.HLS",i.emsg="https://aomedia.org/emsg/ID3",i.misbklv="urn:misb:KLV:bin:1910.1",i})({});function dh(i="",e=9e4){return{type:i,id:-1,pid:-1,inputTimeScale:e,sequenceNumber:-1,samples:[],dropped:0}}class JR{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(e,t,n,r){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(e){this.initPTS=e,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(e,t){return!1}appendFrame(e,t,n){}demux(e,t){this.cachedData&&(e=Ac(this.cachedData,e),this.cachedData=null);let n=Y2(e,0),r=n?n.length:0,s;const o=this._audioTrack,a=this._id3Track,l=n?qR(n):void 0,c=e.length;for((this.basePTS===null||this.frameIndex===0&&jt(l))&&(this.basePTS=s0e(l,t,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),n&&n.length>0&&a.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:n,type:Xa.audioId3,duration:Number.POSITIVE_INFINITY});r<c;){if(this.canParse(e,r)){const u=this.appendFrame(o,e,r);u?(this.frameIndex++,this.lastPTS=u.sample.pts,r+=u.length,s=r):r=c}else Wme(e,r)?(n=Y2(e,r),a.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:n,type:Xa.audioId3,duration:Number.POSITIVE_INFINITY}),r+=n.length,s=r):r++;if(r===c&&s!==c){const u=e.slice(s);this.cachedData?this.cachedData=Ac(this.cachedData,u):this.cachedData=u}}return{audioTrack:o,videoTrack:dh(),id3Track:a,textTrack:dh()}}demuxSampleAes(e,t,n){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(e){const t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:dh(),id3Track:this._id3Track,textTrack:dh()}}destroy(){this.cachedData=null,this._audioTrack=this._id3Track=void 0}}const s0e=(i,e,t)=>{if(jt(i))return i*90;const n=t?t.baseTime*9e4/t.timescale:0;return e*9e4+n};let ZE=null;const o0e=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],a0e=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],l0e=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],c0e=[0,1,1,4];function xV(i,e,t,n,r){if(t+24>e.length)return;const s=EV(e,t);if(s&&t+s.frameLength<=e.length){const o=s.samplesPerFrame*9e4/s.sampleRate,a=n+r*o,l={unit:e.subarray(t,t+s.frameLength),pts:a,dts:a};return i.config=[],i.channelCount=s.channelCount,i.samplerate=s.sampleRate,i.samples.push(l),{sample:l,length:s.frameLength,missing:0}}}function EV(i,e){const t=i[e+1]>>3&3,n=i[e+1]>>1&3,r=i[e+2]>>4&15,s=i[e+2]>>2&3;if(t!==1&&r!==0&&r!==15&&s!==3){const o=i[e+2]>>1&1,a=i[e+3]>>6,l=t===3?3-n:n===3?3:4,c=o0e[l*14+r-1]*1e3,h=a0e[(t===3?0:t===2?1:2)*3+s],f=a===3?1:2,d=l0e[t][n],m=c0e[n],y=d*8*m,g=Math.floor(d*c/h+o)*m;if(ZE===null){const x=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);ZE=x?parseInt(x[1]):0}return!!ZE&&ZE<=87&&n===2&&c>=224e3&&a===0&&(i[e+3]=i[e+3]|128),{sampleRate:h,channelCount:f,frameLength:g,samplesPerFrame:y}}}function ZR(i,e){return i[e]===255&&(i[e+1]&224)===224&&(i[e+1]&6)!==0}function _V(i,e){return e+1<i.length&&ZR(i,e)}function u0e(i,e){return ZR(i,e)&&4<=i.length-e}function SV(i,e){if(e+1<i.length&&ZR(i,e)){const n=EV(i,e);let r=4;n!=null&&n.frameLength&&(r=n.frameLength);const s=e+r;return s===i.length||_V(i,s)}return!1}class h0e extends JR{constructor(e,t){super(),this.observer=void 0,this.config=void 0,this.observer=e,this.config=t}resetInitSegment(e,t,n,r){super.resetInitSegment(e,t,n,r),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:t,duration:r,inputTimeScale:9e4,dropped:0}}static probe(e,t){if(!e)return!1;const n=Y2(e,0);let r=(n==null?void 0:n.length)||0;if(SV(e,r))return!1;for(let s=e.length;r<s;r++)if(Vme(e,r))return t.log("ADTS sync word found !"),!0;return!1}canParse(e,t){return Qme(e,t)}appendFrame(e,t,n){mV(e,this.observer,t,n,e.manifestCodec);const r=AV(e,t,n,this.basePTS,this.frameIndex);if(r&&r.missing===0)return r}}const wV=(i,e)=>{let t=0,n=5;e+=n;const r=new Uint32Array(1),s=new Uint32Array(1),o=new Uint8Array(1);for(;n>0;){o[0]=i[e];const a=Math.min(n,8),l=8-a;s[0]=4278190080>>>24+l<<l,r[0]=(o[0]&s[0])>>l,t=t?t<<a|r[0]:r[0],e+=1,n-=a}return t};class f0e extends JR{constructor(e){super(),this.observer=void 0,this.observer=e}resetInitSegment(e,t,n,r){super.resetInitSegment(e,t,n,r),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:t,duration:r,inputTimeScale:9e4,dropped:0}}canParse(e,t){return t+64<e.length}appendFrame(e,t,n){const r=CV(e,t,n,this.basePTS,this.frameIndex);if(r!==-1)return{sample:e.samples[e.samples.length-1],length:r,missing:0}}static probe(e){if(!e)return!1;const t=Y2(e,0);if(!t)return!1;const n=t.length;return e[n]===11&&e[n+1]===119&&qR(t)!==void 0&&wV(e,n)<16}}function CV(i,e,t,n,r){if(t+8>e.length||e[t]!==11||e[t+1]!==119)return-1;const s=e[t+4]>>6;if(s>=3)return-1;const a=[48e3,44100,32e3][s],l=e[t+4]&63,u=[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][l*3+s]*2;if(t+u>e.length)return-1;const h=e[t+6]>>5;let f=0;h===2?f+=2:(h&1&&h!==1&&(f+=2),h&4&&(f+=2));const d=(e[t+6]<<8|e[t+7])>>12-f&1,y=[2,1,2,3,3,4,4,5][h]+d,g=e[t+5]>>3,A=e[t+5]&7,E=new Uint8Array([s<<6|g<<1|A>>2,(A&3)<<6|h<<3|d<<2|l>>4,l<<4&224]),x=1536/a*9e4,w=n+r*x,T=e.subarray(t,t+u);return i.config=E,i.channelCount=y,i.samplerate=a,i.samples.push({unit:T,pts:w}),u}class d0e extends JR{resetInitSegment(e,t,n,r){super.resetInitSegment(e,t,n,r),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:t,duration:r,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;const t=Y2(e,0);let n=(t==null?void 0:t.length)||0;if(t&&e[n]===11&&e[n+1]===119&&qR(t)!==void 0&&wV(e,n)<=16)return!1;for(let r=e.length;n<r;n++)if(SV(e,n))return Ki.log("MPEG Audio sync word found !"),!0;return!1}canParse(e,t){return u0e(e,t)}appendFrame(e,t,n){if(this.basePTS!==null)return xV(e,t,n,this.basePTS,this.frameIndex)}}const p0e=/\/emsg[-/]ID3/i;class m0e{constructor(e,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}resetTimeStamp(){}resetInitSegment(e,t,n,r){const s=this.videoTrack=dh("video",1),o=this.audioTrack=dh("audio",1),a=this.txtTrack=dh("text",1);if(this.id3Track=dh("id3",1),this.timeOffset=0,!(e!=null&&e.byteLength))return;const l=DQ(e);if(l.video){const{id:c,timescale:u,codec:h,supplemental:f}=l.video;s.id=c,s.timescale=a.timescale=u,s.codec=h,s.supplemental=f}if(l.audio){const{id:c,timescale:u,codec:h}=l.audio;o.id=c,o.timescale=u,o.codec=h}a.id=PQ.text,s.sampleDuration=0,s.duration=o.duration=r}resetContiguity(){this.remainderData=null}static probe(e){return mpe(e)}demux(e,t){this.timeOffset=t;let n=e;const r=this.videoTrack,s=this.txtTrack;if(this.config.progressive){this.remainderData&&(n=Ac(this.remainderData,e));const a=_pe(n);this.remainderData=a.remainder,r.samples=a.valid||new Uint8Array}else r.samples=n;const o=this.extractID3Track(r,t);return s.samples=O7(t,r),{videoTrack:r,audioTrack:this.audioTrack,id3Track:o,textTrack:this.txtTrack}}flush(){const e=this.timeOffset,t=this.videoTrack,n=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;const r=this.extractID3Track(t,this.timeOffset);return n.samples=O7(e,t),{videoTrack:t,audioTrack:dh(),id3Track:r,textTrack:dh()}}extractID3Track(e,t){const n=this.id3Track;if(e.samples.length){const r=si(e.samples,["emsg"]);r&&r.forEach(s=>{const o=wpe(s);if(p0e.test(o.schemeIdUri)){const a=vk(o,t);let l=o.eventDuration===4294967295?Number.POSITIVE_INFINITY:o.eventDuration/o.timeScale;l<=.001&&(l=Number.POSITIVE_INFINITY);const c=o.payload;n.samples.push({data:c,len:c.byteLength,dts:a,pts:a,type:Xa.emsg,duration:l})}else if(this.config.enableEmsgKLVMetadata&&o.schemeIdUri.startsWith("urn:misb:KLV:bin:1910.1")){const a=vk(o,t);n.samples.push({data:o.payload,len:o.payload.byteLength,dts:a,pts:a,type:Xa.misbklv,duration:Number.POSITIVE_INFINITY})}})}return n}demuxSampleAes(e,t,n){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){this.config=null,this.remainderData=null,this.videoTrack=this.audioTrack=this.id3Track=this.txtTrack=void 0}}function vk(i,e){return jt(i.presentationTime)?i.presentationTime/i.timeScale:e+i.presentationTimeDelta/i.timeScale}class g0e{constructor(e,t,n){this.keyData=void 0,this.decrypter=void 0,this.keyData=n,this.decrypter=new QR(t,{removePKCS7Padding:!1})}decryptBuffer(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer,ap.cbc)}decryptAacSample(e,t,n){const r=e[t].unit;if(r.length<=16)return;const s=r.subarray(16,r.length-r.length%16),o=s.buffer.slice(s.byteOffset,s.byteOffset+s.length);this.decryptBuffer(o).then(a=>{const l=new Uint8Array(a);r.set(l,16),this.decrypter.isSync()||this.decryptAacSamples(e,t+1,n)}).catch(n)}decryptAacSamples(e,t,n){for(;;t++){if(t>=e.length){n();return}if(!(e[t].unit.length<32)&&(this.decryptAacSample(e,t,n),!this.decrypter.isSync()))return}}getAvcEncryptedData(e){const t=Math.floor((e.length-48)/160)*16+16,n=new Int8Array(t);let r=0;for(let s=32;s<e.length-16;s+=160,r+=16)n.set(e.subarray(s,s+16),r);return n}getAvcDecryptedUnit(e,t){const n=new Uint8Array(t);let r=0;for(let s=32;s<e.length-16;s+=160,r+=16)e.set(n.subarray(r,r+16),s);return e}decryptAvcSample(e,t,n,r,s){const o=OQ(s.data),a=this.getAvcEncryptedData(o);this.decryptBuffer(a.buffer).then(l=>{s.data=this.getAvcDecryptedUnit(o,l),this.decrypter.isSync()||this.decryptAvcSamples(e,t,n+1,r)}).catch(r)}decryptAvcSamples(e,t,n,r){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,n=0){if(t>=e.length){r();return}const s=e[t].units;for(;!(n>=s.length);n++){const o=s[n];if(!(o.data.length<=48||o.type!==1&&o.type!==5)&&(this.decryptAvcSample(e,t,n,r,o),!this.decrypter.isSync()))return}}}}class TV{constructor(){this.VideoSample=null}createVideoSample(e,t,n){return{key:e,frame:!1,pts:t,dts:n,units:[],length:0}}getLastNalUnit(e){var t;let n=this.VideoSample,r;if((!n||n.units.length===0)&&(n=e[e.length-1]),(t=n)!=null&&t.units){const s=n.units;r=s[s.length-1]}return r}pushAccessUnit(e,t){if(e.units.length&&e.frame){if(e.pts===void 0){const n=t.samples,r=n.length;if(r){const s=n[r-1];e.pts=s.pts,e.dts=s.dts}else{t.dropped++;return}}t.samples.push(e)}}parseNALu(e,t,n){const r=t.byteLength;let s=e.naluState||0;const o=s,a=[];let l=0,c,u,h,f=-1,d=0;for(s===-1&&(f=0,d=this.getNALuType(t,0),s=0,l=1);l<r;){if(c=t[l++],!s){s=c?0:1;continue}if(s===1){s=c?0:2;continue}if(!c)s=3;else if(c===1){if(u=l-s-1,f>=0){const m={data:t.subarray(f,u),type:d};a.push(m)}else{const m=this.getLastNalUnit(e.samples);m&&(o&&l<=4-o&&m.state&&(m.data=m.data.subarray(0,m.data.byteLength-o)),u>0&&(m.data=Ac(m.data,t.subarray(0,u)),m.state=0))}l<r?(h=this.getNALuType(t,l),f=l,d=h,s=0):s=-1}else s=0}if(f>=0&&s>=0){const m={data:t.subarray(f,r),type:d,state:s};a.push(m)}if(a.length===0){const m=this.getLastNalUnit(e.samples);m&&(m.data=Ac(m.data,t))}return e.naluState=s,a}}class h2{constructor(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const e=this.data,t=this.bytesAvailable,n=e.byteLength-t,r=new Uint8Array(4),s=Math.min(4,t);if(s===0)throw new Error("no bytes available");r.set(e.subarray(n,n+s)),this.word=new DataView(r.buffer).getUint32(0),this.bitsAvailable=s*8,this.bytesAvailable-=s}skipBits(e){let t;e=Math.min(e,this.bytesAvailable*8+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,t=e>>3,e-=t<<3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}readBits(e){let t=Math.min(this.bitsAvailable,e);const n=this.word>>>32-t;if(e>32&&Ki.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else if(this.bytesAvailable>0)this.loadWord();else throw new Error("no bits available");return t=e-t,t>0&&this.bitsAvailable?n<<t|this.readBits(t):n}skipLZ(){let e;for(e=0;e<this.bitsAvailable;++e)if((this.word&2147483648>>>e)!==0)return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const e=this.skipLZ();return this.readBits(e+1)-1}readEG(){const e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}readBoolean(){return this.readBits(1)===1}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}}class A0e extends TV{parsePES(e,t,n,r){const s=this.parseNALu(e,n.data,r);let o=this.VideoSample,a,l=!1;n.data=null,o&&s.length&&!e.audFound&&(this.pushAccessUnit(o,e),o=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts)),s.forEach(c=>{var u,h;switch(c.type){case 1:{let y=!1;a=!0;const g=c.data;if(l&&g.length>4){const A=this.readSliceType(g);(A===2||A===4||A===7||A===9)&&(y=!0)}if(y){var f;(f=o)!=null&&f.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null)}o||(o=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),o.frame=!0,o.key=y;break}case 5:a=!0,(u=o)!=null&&u.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null),o||(o=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),o.key=!0,o.frame=!0;break;case 6:{a=!0,UR(c.data,1,n.pts,t.samples);break}case 7:{var d,m;a=!0,l=!0;const y=c.data,g=this.readSPS(y);if(!e.sps||e.width!==g.width||e.height!==g.height||((d=e.pixelRatio)==null?void 0:d[0])!==g.pixelRatio[0]||((m=e.pixelRatio)==null?void 0:m[1])!==g.pixelRatio[1]){e.width=g.width,e.height=g.height,e.pixelRatio=g.pixelRatio,e.sps=[y];const A=y.subarray(1,4);let E="avc1.";for(let x=0;x<3;x++){let w=A[x].toString(16);w.length<2&&(w="0"+w),E+=w}e.codec=E}break}case 8:a=!0,e.pps=[c.data];break;case 9:a=!0,e.audFound=!0,(h=o)!=null&&h.frame&&(this.pushAccessUnit(o,e),o=null),o||(o=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts));break;case 12:a=!0;break;default:a=!1;break}o&&a&&o.units.push(c)}),r&&o&&(this.pushAccessUnit(o,e),this.VideoSample=null)}getNALuType(e,t){return e[t]&31}readSliceType(e){const t=new h2(e);return t.readUByte(),t.readUEG(),t.readUEG()}skipScalingList(e,t){let n=8,r=8,s;for(let o=0;o<e;o++)r!==0&&(s=t.readEG(),r=(n+s+256)%256),n=r===0?n:r}readSPS(e){const t=new h2(e);let n=0,r=0,s=0,o=0,a,l,c;const u=t.readUByte.bind(t),h=t.readBits.bind(t),f=t.readUEG.bind(t),d=t.readBoolean.bind(t),m=t.skipBits.bind(t),y=t.skipEG.bind(t),g=t.skipUEG.bind(t),A=this.skipScalingList.bind(this);u();const E=u();if(h(5),m(3),u(),g(),E===100||E===110||E===122||E===244||E===44||E===83||E===86||E===118||E===128){const L=f();if(L===3&&m(1),g(),g(),m(1),d())for(l=L!==3?8:12,c=0;c<l;c++)d()&&(c<6?A(16,t):A(64,t))}g();const x=f();if(x===0)f();else if(x===1)for(m(1),y(),y(),a=f(),c=0;c<a;c++)y();g(),m(1);const w=f(),T=f(),I=h(1);I===0&&m(1),m(1),d()&&(n=f(),r=f(),s=f(),o=f());let M=[1,1];if(d()&&d())switch(u()){case 1:M=[1,1];break;case 2:M=[12,11];break;case 3:M=[10,11];break;case 4:M=[16,11];break;case 5:M=[40,33];break;case 6:M=[24,11];break;case 7:M=[20,11];break;case 8:M=[32,11];break;case 9:M=[80,33];break;case 10:M=[18,11];break;case 11:M=[15,11];break;case 12:M=[64,33];break;case 13:M=[160,99];break;case 14:M=[4,3];break;case 15:M=[3,2];break;case 16:M=[2,1];break;case 255:{M=[u()<<8|u(),u()<<8|u()];break}}return{width:Math.ceil((w+1)*16-n*2-r*2),height:(2-I)*(T+1)*16-(I?2:4)*(s+o),pixelRatio:M}}}class y0e extends TV{constructor(...e){super(...e),this.initVPS=null}parsePES(e,t,n,r){const s=this.parseNALu(e,n.data,r);let o=this.VideoSample,a,l=!1;n.data=null,o&&s.length&&!e.audFound&&(this.pushAccessUnit(o,e),o=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts)),s.forEach(c=>{var u,h;switch(c.type){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:o||(o=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts)),o.frame=!0,a=!0;break;case 16:case 17:case 18:case 21:if(a=!0,l){var f;(f=o)!=null&&f.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null)}o||(o=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),o.key=!0,o.frame=!0;break;case 19:case 20:a=!0,(u=o)!=null&&u.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null),o||(o=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),o.key=!0,o.frame=!0;break;case 39:a=!0,UR(c.data,2,n.pts,t.samples);break;case 32:a=!0,e.vps||(typeof e.params!="object"&&(e.params={}),e.params=er(e.params,this.readVPS(c.data)),this.initVPS=c.data),e.vps=[c.data];break;case 33:if(a=!0,l=!0,e.vps!==void 0&&e.vps[0]!==this.initVPS&&e.sps!==void 0&&!this.matchSPS(e.sps[0],c.data)&&(this.initVPS=e.vps[0],e.sps=e.pps=void 0),!e.sps){const d=this.readSPS(c.data);e.width=d.width,e.height=d.height,e.pixelRatio=d.pixelRatio,e.codec=d.codecString,e.sps=[],typeof e.params!="object"&&(e.params={});for(const m in d.params)e.params[m]=d.params[m]}this.pushParameterSet(e.sps,c.data,e.vps),o||(o=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),o.key=!0;break;case 34:if(a=!0,typeof e.params=="object"){if(!e.pps){e.pps=[];const d=this.readPPS(c.data);for(const m in d)e.params[m]=d[m]}this.pushParameterSet(e.pps,c.data,e.vps)}break;case 35:a=!0,e.audFound=!0,(h=o)!=null&&h.frame&&(this.pushAccessUnit(o,e),o=null),o||(o=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts));break;default:a=!1;break}o&&a&&o.units.push(c)}),r&&o&&(this.pushAccessUnit(o,e),this.VideoSample=null)}pushParameterSet(e,t,n){(n&&n[0]===this.initVPS||!n&&!e.length)&&e.push(t)}getNALuType(e,t){return(e[t]&126)>>>1}ebsp2rbsp(e){const t=new Uint8Array(e.byteLength);let n=0;for(let r=0;r<e.byteLength;r++)r>=2&&e[r]===3&&e[r-1]===0&&e[r-2]===0||(t[n]=e[r],n++);return new Uint8Array(t.buffer,0,n)}pushAccessUnit(e,t){super.pushAccessUnit(e,t),this.initVPS&&(this.initVPS=null)}readVPS(e){const t=new h2(e);t.readUByte(),t.readUByte(),t.readBits(4),t.skipBits(2),t.readBits(6);const n=t.readBits(3),r=t.readBoolean();return{numTemporalLayers:n+1,temporalIdNested:r}}readSPS(e){const t=new h2(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.readBits(4);const n=t.readBits(3);t.readBoolean();const r=t.readBits(2),s=t.readBoolean(),o=t.readBits(5),a=t.readUByte(),l=t.readUByte(),c=t.readUByte(),u=t.readUByte(),h=t.readUByte(),f=t.readUByte(),d=t.readUByte(),m=t.readUByte(),y=t.readUByte(),g=t.readUByte(),A=t.readUByte(),E=[],x=[];for(let Ae=0;Ae<n;Ae++)E.push(t.readBoolean()),x.push(t.readBoolean());if(n>0)for(let Ae=n;Ae<8;Ae++)t.readBits(2);for(let Ae=0;Ae<n;Ae++)E[Ae]&&(t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte()),x[Ae]&&t.readUByte();t.readUEG();const w=t.readUEG();w==3&&t.skipBits(1);const T=t.readUEG(),I=t.readUEG(),M=t.readBoolean();let L=0,P=0,R=0,U=0;M&&(L+=t.readUEG(),P+=t.readUEG(),R+=t.readUEG(),U+=t.readUEG());const k=t.readUEG(),H=t.readUEG(),G=t.readUEG(),X=t.readBoolean();for(let Ae=X?0:n;Ae<=n;Ae++)t.skipUEG(),t.skipUEG(),t.skipUEG();if(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.readBoolean()&&t.readBoolean())for(let ke=0;ke<4;ke++)for(let be=0;be<(ke===3?2:6);be++)if(!t.readBoolean())t.readUEG();else{const j=Math.min(64,1<<4+(ke<<1));ke>1&&t.readEG();for(let de=0;de<j;de++)t.readEG()}t.readBoolean(),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.skipUEG(),t.skipUEG(),t.readBoolean());const K=t.readUEG();let V=0;for(let Ae=0;Ae<K;Ae++){let ke=!1;if(Ae!==0&&(ke=t.readBoolean()),ke){Ae===K&&t.readUEG(),t.readBoolean(),t.readUEG();let be=0;for(let ne=0;ne<=V;ne++){const j=t.readBoolean();let de=!1;j||(de=t.readBoolean()),(j||de)&&be++}V=be}else{const be=t.readUEG(),ne=t.readUEG();V=be+ne;for(let j=0;j<be;j++)t.readUEG(),t.readBoolean();for(let j=0;j<ne;j++)t.readUEG(),t.readBoolean()}}if(t.readBoolean()){const Ae=t.readUEG();for(let ke=0;ke<Ae;ke++){for(let be=0;be<G+4;be++)t.readBits(1);t.readBits(1)}}let F=0,Y=1,te=1,q=!0,J=1,re=0;t.readBoolean(),t.readBoolean();let ie=!1;if(t.readBoolean()){if(t.readBoolean()){const Re=t.readUByte(),Le=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],Fe=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];Re>0&&Re<16?(Y=Le[Re-1],te=Fe[Re-1]):Re===255&&(Y=t.readBits(16),te=t.readBits(16))}if(t.readBoolean()&&t.readBoolean(),t.readBoolean()&&(t.readBits(3),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.readUByte(),t.readUByte())),t.readBoolean()&&(t.readUEG(),t.readUEG()),t.readBoolean(),t.readBoolean(),t.readBoolean(),ie=t.readBoolean(),ie&&(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG()),t.readBoolean()&&(J=t.readBits(32),re=t.readBits(32),t.readBoolean()&&t.readUEG(),t.readBoolean())){const Fe=t.readBoolean(),He=t.readBoolean();let it=!1;(Fe||He)&&(it=t.readBoolean(),it&&(t.readUByte(),t.readBits(5),t.readBoolean(),t.readBits(5)),t.readBits(4),t.readBits(4),it&&t.readBits(4),t.readBits(5),t.readBits(5),t.readBits(5));for(let Ye=0;Ye<=n;Ye++){q=t.readBoolean();const ct=q||t.readBoolean();let pt=!1;ct?t.readEG():pt=t.readBoolean();const je=pt?1:t.readUEG()+1;if(Fe)for(let Mt=0;Mt<je;Mt++)t.readUEG(),t.readUEG(),it&&(t.readUEG(),t.readUEG()),t.skipBits(1);if(He)for(let Mt=0;Mt<je;Mt++)t.readUEG(),t.readUEG(),it&&(t.readUEG(),t.readUEG()),t.skipBits(1)}}t.readBoolean()&&(t.readBoolean(),t.readBoolean(),t.readBoolean(),F=t.readUEG())}let ge=T,xe=I;if(M){let Ae=1,ke=1;w===1?Ae=ke=2:w==2&&(Ae=2),ge=T-Ae*P-Ae*L,xe=I-ke*U-ke*R}const pe=r?["A","B","C"][r]:"",ue=a<<24|l<<16|c<<8|u;let Me=0;for(let Ae=0;Ae<32;Ae++)Me=(Me|(ue>>Ae&1)<<31-Ae)>>>0;let Se=Me.toString(16);return o===1&&Se==="2"&&(Se="6"),{codecString:`hvc1.${pe}${o}.${Se}.${s?"H":"L"}${A}.B0`,params:{general_tier_flag:s,general_profile_idc:o,general_profile_space:r,general_profile_compatibility_flags:[a,l,c,u],general_constraint_indicator_flags:[h,f,d,m,y,g],general_level_idc:A,bit_depth:k+8,bit_depth_luma_minus8:k,bit_depth_chroma_minus8:H,min_spatial_segmentation_idc:F,chroma_format_idc:w,frame_rate:{fixed:q,fps:re/J}},width:ge,height:xe,pixelRatio:[Y,te]}}readPPS(e){const t=new h2(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.skipUEG(),t.skipUEG(),t.skipBits(2),t.skipBits(3),t.skipBits(2),t.skipUEG(),t.skipUEG(),t.skipEG(),t.skipBits(2),t.readBoolean()&&t.skipUEG(),t.skipEG(),t.skipEG(),t.skipBits(4);const r=t.readBoolean(),s=t.readBoolean();let o=1;return s&&r?o=0:s?o=3:r&&(o=2),{parallelismType:o}}matchSPS(e,t){return String.fromCharCode.apply(null,e).substr(3)===String.fromCharCode.apply(null,t).substr(3)}}const Ao=188;class Fd{constructor(e,t,n,r){this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=e,this.config=t,this.typeSupported=n,this.logger=r,this.videoParser=null}static probe(e,t){const n=Fd.syncOffset(e);return n>0&&t.warn(`MPEG2-TS detected but first sync word found @ offset ${n}`),n!==-1}static syncOffset(e){const t=e.length;let n=Math.min(Ao*5,t-Ao)+1,r=0;for(;r<n;){let s=!1,o=-1,a=0;for(let l=r;l<t;l+=Ao)if(e[l]===71&&(t-l===Ao||e[l+Ao]===71)){if(a++,o===-1&&(o=l,o!==0&&(n=Math.min(o+Ao*99,e.length-Ao)+1)),s||(s=b5(e,l)===0),s&&a>1&&(o===0&&a>2||l+Ao>n))return o}else{if(a)return-1;break}r++}return-1}static createTrack(e,t){return{container:e==="video"||e==="audio"?"video/mp2t":void 0,type:e,id:PQ[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:e==="audio"?t:void 0}}resetInitSegment(e,t,n,r){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=Fd.createTrack("video"),this._videoTrack.duration=r,this._audioTrack=Fd.createTrack("audio",r),this._id3Track=Fd.createTrack("id3"),this._txtTrack=Fd.createTrack("text"),this._audioTrack.segmentCodec="aac",this.videoParser=null,this.aacOverFlow=null,this.remainderData=null,this.audioCodec=t,this.videoCodec=n}resetTimeStamp(){}resetContiguity(){const{_audioTrack:e,_videoTrack:t,_id3Track:n}=this;e&&(e.pesData=null),t&&(t.pesData=null),n&&(n.pesData=null),this.aacOverFlow=null,this.remainderData=null}demux(e,t,n=!1,r=!1){n||(this.sampleAes=null);let s;const o=this._videoTrack,a=this._audioTrack,l=this._id3Track,c=this._txtTrack;let u=o.pid,h=o.pesData,f=a.pid,d=l.pid,m=a.pesData,y=l.pesData,g=null,A=this.pmtParsed,E=this._pmtId,x=e.length;if(this.remainderData&&(e=Ac(this.remainderData,e),x=e.length,this.remainderData=null),x<Ao&&!r)return this.remainderData=e,{audioTrack:a,videoTrack:o,id3Track:l,textTrack:c};const w=Math.max(0,Fd.syncOffset(e));x-=(x-w)%Ao,x<e.byteLength&&!r&&(this.remainderData=new Uint8Array(e.buffer,x,e.buffer.byteLength-x));let T=0;for(let M=w;M<x;M+=Ao)if(e[M]===71){const L=!!(e[M+1]&64),P=b5(e,M),R=(e[M+3]&48)>>4;let U;if(R>1){if(U=M+5+e[M+4],U===M+Ao)continue}else U=M+4;switch(P){case u:L&&(h&&(s=Jg(h,this.logger))&&(this.readyVideoParser(o.segmentCodec),this.videoParser!==null&&this.videoParser.parsePES(o,c,s,!1)),h={data:[],size:0}),h&&(h.data.push(e.subarray(U,M+Ao)),h.size+=M+Ao-U);break;case f:if(L){if(m&&(s=Jg(m,this.logger)))switch(a.segmentCodec){case"aac":this.parseAACPES(a,s);break;case"mp3":this.parseMPEGPES(a,s);break;case"ac3":this.parseAC3PES(a,s);break}m={data:[],size:0}}m&&(m.data.push(e.subarray(U,M+Ao)),m.size+=M+Ao-U);break;case d:L&&(y&&(s=Jg(y,this.logger))&&this.parseID3PES(l,s),y={data:[],size:0}),y&&(y.data.push(e.subarray(U,M+Ao)),y.size+=M+Ao-U);break;case 0:L&&(U+=e[U]+1),E=this._pmtId=v0e(e,U);break;case E:{L&&(U+=e[U]+1);const k=x0e(e,U,this.typeSupported,n,this.observer,this.logger);u=k.videoPid,u>0&&(o.pid=u,o.segmentCodec=k.segmentVideoCodec),f=k.audioPid,f>0&&(a.pid=f,a.segmentCodec=k.segmentAudioCodec),d=k.id3Pid,d>0&&(l.pid=d),g!==null&&!A&&(this.logger.warn(`MPEG-TS PMT found at ${M} after unknown PID '${g}'. Backtracking to sync byte @${w} to parse all TS packets.`),g=null,M=w-188),A=this.pmtParsed=!0;break}case 17:case 8191:break;default:g=P;break}}else T++;T>0&&I5(this.observer,new Error(`Found ${T} TS packet/s that do not start with 0x47`),void 0,this.logger),o.pesData=h,a.pesData=m,l.pesData=y;const I={audioTrack:a,videoTrack:o,id3Track:l,textTrack:c};return r&&this.extractRemainingSamples(I),I}flush(){const{remainderData:e}=this;this.remainderData=null;let t;return e?t=this.demux(e,-1,!1,!0):t={videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(t),this.sampleAes?this.decrypt(t,this.sampleAes):t}extractRemainingSamples(e){const{audioTrack:t,videoTrack:n,id3Track:r,textTrack:s}=e,o=n.pesData,a=t.pesData,l=r.pesData;let c;if(o&&(c=Jg(o,this.logger))?(this.readyVideoParser(n.segmentCodec),this.videoParser!==null&&(this.videoParser.parsePES(n,s,c,!0),n.pesData=null)):n.pesData=o,a&&(c=Jg(a,this.logger))){switch(t.segmentCodec){case"aac":this.parseAACPES(t,c);break;case"mp3":this.parseMPEGPES(t,c);break;case"ac3":this.parseAC3PES(t,c);break}t.pesData=null}else a!=null&&a.size&&this.logger.log("last AAC PES packet truncated,might overlap between fragments"),t.pesData=a;l&&(c=Jg(l,this.logger))?(this.parseID3PES(r,c),r.pesData=null):r.pesData=l}demuxSampleAes(e,t,n){const r=this.demux(e,n,!0,!this.config.progressive),s=this.sampleAes=new g0e(this.observer,this.config,t);return this.decrypt(r,s)}readyVideoParser(e){this.videoParser===null&&(e==="avc"?this.videoParser=new A0e:e==="hevc"&&(this.videoParser=new y0e))}decrypt(e,t){return new Promise(n=>{const{audioTrack:r,videoTrack:s}=e;r.samples&&r.segmentCodec==="aac"?t.decryptAacSamples(r.samples,0,()=>{s.samples?t.decryptAvcSamples(s.samples,0,0,()=>{n(e)}):n(e)}):s.samples&&t.decryptAvcSamples(s.samples,0,0,()=>{n(e)})})}destroy(){this.observer&&this.observer.removeAllListeners(),this.config=this.logger=this.observer=null,this.aacOverFlow=this.videoParser=this.remainderData=this.sampleAes=null,this._videoTrack=this._audioTrack=this._id3Track=this._txtTrack=void 0}parseAACPES(e,t){let n=0;const r=this.aacOverFlow;let s=t.data;if(r){this.aacOverFlow=null;const h=r.missing,f=r.sample.unit.byteLength;if(h===-1)s=Ac(r.sample.unit,s);else{const d=f-h;r.sample.unit.set(s.subarray(0,h),d),e.samples.push(r.sample),n=r.missing}}let o,a;for(o=n,a=s.length;o<a-1&&!JS(s,o);o++);if(o!==n){let h;const f=o<a-1;if(f?h=`AAC PES did not start with ADTS header,offset:${o}`:h="No ADTS header found in AAC PES",I5(this.observer,new Error(h),f,this.logger),!f)return}mV(e,this.observer,s,o,this.audioCodec);let l;if(t.pts!==void 0)l=t.pts;else if(r){const h=gV(e.samplerate);l=r.sample.pts+h}else{this.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}let c=0,u;for(;o<a;)if(u=AV(e,s,o,l,c),o+=u.length,u.missing){this.aacOverFlow=u;break}else for(c++;o<a-1&&!JS(s,o);o++);}parseMPEGPES(e,t){const n=t.data,r=n.length;let s=0,o=0;const a=t.pts;if(a===void 0){this.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;o<r;)if(_V(n,o)){const l=xV(e,n,o,a,s);if(l)o+=l.length,s++;else break}else o++}parseAC3PES(e,t){{const n=t.data,r=t.pts;if(r===void 0){this.logger.warn("[tsdemuxer]: AC3 PES unknown PTS");return}const s=n.length;let o=0,a=0,l;for(;a<s&&(l=CV(e,n,a,r,o++))>0;)a+=l}}parseID3PES(e,t){if(t.pts===void 0){this.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}const n=er({},t,{type:this._videoTrack?Xa.emsg:Xa.audioId3,duration:Number.POSITIVE_INFINITY});e.samples.push(n)}}function b5(i,e){return((i[e+1]&31)<<8)+i[e+2]}function v0e(i,e){return(i[e+10]&31)<<8|i[e+11]}function x0e(i,e,t,n,r,s){const o={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},a=(i[e+1]&15)<<8|i[e+2],l=e+3+a-4,c=(i[e+10]&15)<<8|i[e+11];for(e+=12+c;e<l;){const u=b5(i,e),h=(i[e+3]&15)<<8|i[e+4];switch(i[e]){case 207:if(!n){Gb("ADTS AAC",s);break}case 15:o.audioPid===-1&&(o.audioPid=u);break;case 21:o.id3Pid===-1&&(o.id3Pid=u);break;case 219:if(!n){Gb("H.264",s);break}case 27:o.videoPid===-1&&(o.videoPid=u);break;case 3:case 4:!t.mpeg&&!t.mp3?s.log("MPEG audio found, not supported in this browser"):o.audioPid===-1&&(o.audioPid=u,o.segmentAudioCodec="mp3");break;case 193:if(!n){Gb("AC-3",s);break}case 129:t.ac3?o.audioPid===-1&&(o.audioPid=u,o.segmentAudioCodec="ac3"):s.log("AC-3 audio found, not supported in this browser");break;case 6:if(o.audioPid===-1&&h>0){let f=e+5,d=h;for(;d>2;){switch(i[f]){case 106:t.ac3!==!0?s.log("AC-3 audio found, not supported in this browser for now"):(o.audioPid=u,o.segmentAudioCodec="ac3");break}const y=i[f+1]+2;f+=y,d-=y}}break;case 194:case 135:return I5(r,new Error("Unsupported EC-3 in M2TS found"),void 0,s),o;case 36:o.videoPid===-1&&(o.videoPid=u,o.segmentVideoCodec="hevc",s.log("HEVC in M2TS found"));break}e+=h+5}return o}function I5(i,e,t,n){n.warn(`parsing error: ${e.message}`),i.emit(ae.ERROR,ae.ERROR,{type:rn.MEDIA_ERROR,details:Ke.FRAG_PARSING_ERROR,fatal:!1,levelRetry:t,error:e,reason:e.message})}function Gb(i,e){e.log(`${i} with AES-128-CBC encryption found in unencrypted stream`)}function Jg(i,e){let t=0,n,r,s,o,a;const l=i.data;if(!i||i.size===0)return null;for(;l[0].length<19&&l.length>1;)l[0]=Ac(l[0],l[1]),l.splice(1,1);if(n=l[0],(n[0]<<16)+(n[1]<<8)+n[2]===1){if(r=(n[4]<<8)+n[5],r&&r>i.size-6)return null;const u=n[7];u&192&&(o=(n[9]&14)*536870912+(n[10]&255)*4194304+(n[11]&254)*16384+(n[12]&255)*128+(n[13]&254)/2,u&64?(a=(n[14]&14)*536870912+(n[15]&255)*4194304+(n[16]&254)*16384+(n[17]&255)*128+(n[18]&254)/2,o-a>60*9e4&&(e.warn(`${Math.round((o-a)/9e4)}s delta between PTS and DTS, align them`),o=a)):a=o),s=n[8];let h=s+9;if(i.size<=h)return null;i.size-=h;const f=new Uint8Array(i.size);for(let d=0,m=l.length;d<m;d++){n=l[d];let y=n.byteLength;if(h)if(h>y){h-=y;continue}else n=n.subarray(h),y-=h,h=0;f.set(n,t),t+=y}return r&&(r-=s+3),{data:f,pts:o,dts:a,len:r}}return null}class E0e{static getSilentFrame(e,t){switch(e){case"mp4a.40.2":if(t===1)return new Uint8Array([0,200,0,128,35,128]);if(t===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(t===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(t===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(t===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(t===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(t===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}}}const Rd=Math.pow(2,32)-1;class We{static init(){We.types={avc1:[],avcC:[],hvc1:[],hvcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};let e;for(e in We.types)We.types.hasOwnProperty(e)&&(We.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);const t=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),n=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);We.HDLR_TYPES={video:t,audio:n};const r=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),s=new Uint8Array([0,0,0,0,0,0,0,0]);We.STTS=We.STSC=We.STCO=s,We.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),We.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),We.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),We.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const o=new Uint8Array([105,115,111,109]),a=new Uint8Array([97,118,99,49]),l=new Uint8Array([0,0,0,1]);We.FTYP=We.box(We.types.ftyp,o,l,o,a),We.DINF=We.box(We.types.dinf,We.box(We.types.dref,r))}static box(e,...t){let n=8,r=t.length;const s=r;for(;r--;)n+=t[r].byteLength;const o=new Uint8Array(n);for(o[0]=n>>24&255,o[1]=n>>16&255,o[2]=n>>8&255,o[3]=n&255,o.set(e,4),r=0,n=8;r<s;r++)o.set(t[r],n),n+=t[r].byteLength;return o}static hdlr(e){return We.box(We.types.hdlr,We.HDLR_TYPES[e])}static mdat(e){return We.box(We.types.mdat,e)}static mdhd(e,t){t*=e;const n=Math.floor(t/(Rd+1)),r=Math.floor(t%(Rd+1));return We.box(We.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,n>>24,n>>16&255,n>>8&255,n&255,r>>24,r>>16&255,r>>8&255,r&255,85,196,0,0]))}static mdia(e){return We.box(We.types.mdia,We.mdhd(e.timescale||0,e.duration||0),We.hdlr(e.type),We.minf(e))}static mfhd(e){return We.box(We.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,e&255]))}static minf(e){return e.type==="audio"?We.box(We.types.minf,We.box(We.types.smhd,We.SMHD),We.DINF,We.stbl(e)):We.box(We.types.minf,We.box(We.types.vmhd,We.VMHD),We.DINF,We.stbl(e))}static moof(e,t,n){return We.box(We.types.moof,We.mfhd(e),We.traf(n,t))}static moov(e){let t=e.length;const n=[];for(;t--;)n[t]=We.trak(e[t]);return We.box.apply(null,[We.types.moov,We.mvhd(e[0].timescale||0,e[0].duration||0)].concat(n).concat(We.mvex(e)))}static mvex(e){let t=e.length;const n=[];for(;t--;)n[t]=We.trex(e[t]);return We.box.apply(null,[We.types.mvex,...n])}static mvhd(e,t){t*=e;const n=Math.floor(t/(Rd+1)),r=Math.floor(t%(Rd+1)),s=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,n>>24,n>>16&255,n>>8&255,n&255,r>>24,r>>16&255,r>>8&255,r&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return We.box(We.types.mvhd,s)}static sdtp(e){const t=e.samples||[],n=new Uint8Array(4+t.length);let r,s;for(r=0;r<t.length;r++)s=t[r].flags,n[r+4]=s.dependsOn<<4|s.isDependedOn<<2|s.hasRedundancy;return We.box(We.types.sdtp,n)}static stbl(e){return We.box(We.types.stbl,We.stsd(e),We.box(We.types.stts,We.STTS),We.box(We.types.stsc,We.STSC),We.box(We.types.stsz,We.STSZ),We.box(We.types.stco,We.STCO))}static avc1(e){let t=[],n=[],r,s,o;for(r=0;r<e.sps.length;r++)s=e.sps[r],o=s.byteLength,t.push(o>>>8&255),t.push(o&255),t=t.concat(Array.prototype.slice.call(s));for(r=0;r<e.pps.length;r++)s=e.pps[r],o=s.byteLength,n.push(o>>>8&255),n.push(o&255),n=n.concat(Array.prototype.slice.call(s));const a=We.box(We.types.avcC,new Uint8Array([1,t[3],t[4],t[5],255,224|e.sps.length].concat(t).concat([e.pps.length]).concat(n))),l=e.width,c=e.height,u=e.pixelRatio[0],h=e.pixelRatio[1];return We.box(We.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,l>>8&255,l&255,c>>8&255,c&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),a,We.box(We.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),We.box(We.types.pasp,new Uint8Array([u>>24,u>>16&255,u>>8&255,u&255,h>>24,h>>16&255,h>>8&255,h&255])))}static esds(e){const t=e.config;return new Uint8Array([0,0,0,0,3,25,0,1,0,4,17,64,21,0,0,0,0,0,0,0,0,0,0,0,5,2,...t,6,1,2])}static audioStsd(e){const t=e.samplerate||0;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount||0,0,16,0,0,0,0,t>>8&255,t&255,0,0])}static mp4a(e){return We.box(We.types.mp4a,We.audioStsd(e),We.box(We.types.esds,We.esds(e)))}static mp3(e){return We.box(We.types[".mp3"],We.audioStsd(e))}static ac3(e){return We.box(We.types["ac-3"],We.audioStsd(e),We.box(We.types.dac3,e.config))}static stsd(e){const{segmentCodec:t}=e;if(e.type==="audio"){if(t==="aac")return We.box(We.types.stsd,We.STSD,We.mp4a(e));if(t==="ac3"&&e.config)return We.box(We.types.stsd,We.STSD,We.ac3(e));if(t==="mp3"&&e.codec==="mp3")return We.box(We.types.stsd,We.STSD,We.mp3(e))}else if(e.pps&&e.sps){if(t==="avc")return We.box(We.types.stsd,We.STSD,We.avc1(e));if(t==="hevc"&&e.vps)return We.box(We.types.stsd,We.STSD,We.hvc1(e))}else throw new Error("video track missing pps or sps");throw new Error(`unsupported ${e.type} segment codec (${t}/${e.codec})`)}static tkhd(e){const t=e.id,n=(e.duration||0)*(e.timescale||0),r=e.width||0,s=e.height||0,o=Math.floor(n/(Rd+1)),a=Math.floor(n%(Rd+1));return We.box(We.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,t&255,0,0,0,0,o>>24,o>>16&255,o>>8&255,o&255,a>>24,a>>16&255,a>>8&255,a&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,r>>8&255,r&255,0,0,s>>8&255,s&255,0,0]))}static traf(e,t){const n=We.sdtp(e),r=e.id,s=Math.floor(t/(Rd+1)),o=Math.floor(t%(Rd+1));return We.box(We.types.traf,We.box(We.types.tfhd,new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,r&255])),We.box(We.types.tfdt,new Uint8Array([1,0,0,0,s>>24,s>>16&255,s>>8&255,s&255,o>>24,o>>16&255,o>>8&255,o&255])),We.trun(e,n.length+16+20+8+16+8+8),n)}static trak(e){return e.duration=e.duration||4294967295,We.box(We.types.trak,We.tkhd(e),We.mdia(e))}static trex(e){const t=e.id;return We.box(We.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(e,t){const n=e.samples||[],r=n.length,s=12+16*r,o=new Uint8Array(s);let a,l,c,u,h,f;for(t+=8+s,o.set([e.type==="video"?1:0,0,15,1,r>>>24&255,r>>>16&255,r>>>8&255,r&255,t>>>24&255,t>>>16&255,t>>>8&255,t&255],0),a=0;a<r;a++)l=n[a],c=l.duration,u=l.size,h=l.flags,f=l.cts,o.set([c>>>24&255,c>>>16&255,c>>>8&255,c&255,u>>>24&255,u>>>16&255,u>>>8&255,u&255,h.isLeading<<2|h.dependsOn,h.isDependedOn<<6|h.hasRedundancy<<4|h.paddingValue<<1|h.isNonSync,h.degradPrio&61440,h.degradPrio&15,f>>>24&255,f>>>16&255,f>>>8&255,f&255],12+16*a);return We.box(We.types.trun,o)}static initSegment(e){We.types||We.init();const t=We.moov(e);return Ac(We.FTYP,t)}static hvc1(e){const t=e.params,n=[e.vps,e.sps,e.pps],r=4,s=new Uint8Array([1,t.general_profile_space<<6|(t.general_tier_flag?32:0)|t.general_profile_idc,t.general_profile_compatibility_flags[0],t.general_profile_compatibility_flags[1],t.general_profile_compatibility_flags[2],t.general_profile_compatibility_flags[3],t.general_constraint_indicator_flags[0],t.general_constraint_indicator_flags[1],t.general_constraint_indicator_flags[2],t.general_constraint_indicator_flags[3],t.general_constraint_indicator_flags[4],t.general_constraint_indicator_flags[5],t.general_level_idc,240|t.min_spatial_segmentation_idc>>8,255&t.min_spatial_segmentation_idc,252|t.parallelismType,252|t.chroma_format_idc,248|t.bit_depth_luma_minus8,248|t.bit_depth_chroma_minus8,0,parseInt(t.frame_rate.fps),r-1|t.temporal_id_nested<<2|t.num_temporal_layers<<3|(t.frame_rate.fixed?64:0),n.length]);let o=s.length;for(let m=0;m<n.length;m+=1){o+=3;for(let y=0;y<n[m].length;y+=1)o+=2+n[m][y].length}const a=new Uint8Array(o);a.set(s,0),o=s.length;const l=n.length-1;for(let m=0;m<n.length;m+=1){a.set(new Uint8Array([32+m|(m===l?128:0),0,n[m].length]),o),o+=3;for(let y=0;y<n[m].length;y+=1)a.set(new Uint8Array([n[m][y].length>>8,n[m][y].length&255]),o),o+=2,a.set(n[m][y],o),o+=n[m][y].length}const c=We.box(We.types.hvcC,a),u=e.width,h=e.height,f=e.pixelRatio[0],d=e.pixelRatio[1];return We.box(We.types.hvc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,u>>8&255,u&255,h>>8&255,h&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),c,We.box(We.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),We.box(We.types.pasp,new Uint8Array([f>>24,f>>16&255,f>>8&255,f&255,d>>24,d>>16&255,d>>8&255,d&255])))}}We.types=void 0;We.HDLR_TYPES=void 0;We.STTS=void 0;We.STSC=void 0;We.STCO=void 0;We.STSZ=void 0;We.VMHD=void 0;We.SMHD=void 0;We.STSD=void 0;We.FTYP=void 0;We.DINF=void 0;const bV=9e4;function e8(i,e,t=1,n=!1){const r=i*e*t;return n?Math.round(r):r}function _0e(i,e,t=1,n=!1){return e8(i,e,1/t,n)}function yv(i,e=!1){return e8(i,1e3,1/bV,e)}function S0e(i,e=1){return e8(i,bV,1/e)}function xk(i){const{baseTime:e,timescale:t,trackId:n}=i;return`${e/t} (${e}/${t}) trackId: ${n}`}const w0e=10*1e3,C0e=1024,T0e=1152,b0e=1536;let Zg=null,Hb=null;function Ek(i,e,t,n){return{duration:e,size:t,cts:n,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:i?2:1,isNonSync:i?0:1}}}class rS extends _c{constructor(e,t,n,r){if(super("mp4-remuxer",r),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextVideoTs=null,this.nextAudioTs=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=e,this.config=t,this.typeSupported=n,this.ISGenerated=!1,Zg===null){const o=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Zg=o?parseInt(o[1]):0}if(Hb===null){const s=navigator.userAgent.match(/Safari\/(\d+)/i);Hb=s?parseInt(s[1]):0}}destroy(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null}resetTimeStamp(e){const t=this._initPTS;(!t||!e||e.trackId!==t.trackId||e.baseTime!==t.baseTime||e.timescale!==t.timescale)&&this.log(`Reset initPTS: ${t&&xk(t)} > ${e&&xk(e)}`),this._initPTS=this._initDTS=e}resetNextTimestamp(){this.log("reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){this.log("ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0}getVideoStartPts(e){let t=!1;const n=e[0].pts,r=e.reduce((s,o)=>{let a=o.pts,l=a-s;return l<-4294967296&&(t=!0,a=Cl(a,n),l=a-s),l>0?s:a},n);return t&&this.debug("PTS rollover detected"),r}remux(e,t,n,r,s,o,a,l){let c,u,h,f,d,m,y=s,g=s;const A=e.pid>-1,E=t.pid>-1,x=t.samples.length,w=e.samples.length>0,T=a&&x>0||x>1;if((!A||w)&&(!E||T)||this.ISGenerated||a){if(this.ISGenerated){var M,L,P,R;const G=this.videoTrackConfig;(G&&(t.width!==G.width||t.height!==G.height||((M=t.pixelRatio)==null?void 0:M[0])!==((L=G.pixelRatio)==null?void 0:L[0])||((P=t.pixelRatio)==null?void 0:P[1])!==((R=G.pixelRatio)==null?void 0:R[1]))||!G&&T||this.nextAudioTs===null&&w)&&this.resetInitSegment()}this.ISGenerated||(h=this.generateIS(e,t,s,o));const U=this.isVideoContiguous;let k=-1,H;if(T&&(k=I0e(t.samples),!U&&this.config.forceKeyFrameOnDiscontinuity))if(m=!0,k>0){this.warn(`Dropped ${k} out of ${x} video samples due to a missing keyframe`);const G=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(k),t.dropped+=k,g+=(t.samples[0].pts-G)/t.inputTimeScale,H=g}else k===-1&&(this.warn(`No keyframe found out of ${x} video samples`),m=!1);if(this.ISGenerated){if(w&&T){const G=this.getVideoStartPts(t.samples),Z=(Cl(e.samples[0].pts,G)-G)/t.inputTimeScale;y+=Math.max(0,Z),g+=Math.max(0,-Z)}if(w){if(e.samplerate||(this.warn("regenerate InitSegment as audio detected"),h=this.generateIS(e,t,s,o)),u=this.remuxAudio(e,y,this.isAudioContiguous,o,E||T||l===$t.AUDIO?g:void 0),T){const G=u?u.endPTS-u.startPTS:0;t.inputTimeScale||(this.warn("regenerate InitSegment as video detected"),h=this.generateIS(e,t,s,o)),c=this.remuxVideo(t,g,U,G)}}else T&&(c=this.remuxVideo(t,g,U,0));c&&(c.firstKeyFrame=k,c.independent=k!==-1,c.firstKeyFramePTS=H)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(n.samples.length&&(d=IV(n,s,this._initPTS,this._initDTS)),r.samples.length&&(f=MV(r,s,this._initPTS))),{audio:u,video:c,initSegment:h,independent:m,text:f,id3:d}}computeInitPts(e,t,n,r){const s=Math.round(n*t);let o=Cl(e,s);if(o<s+t)for(this.log(`Adjusting PTS for rollover in timeline near ${(s-o)/t} ${r}`);o<s+t;)o+=8589934592;return o-s}generateIS(e,t,n,r){const s=e.samples,o=t.samples,a=this.typeSupported,l={},c=this._initPTS;let u=!c||r,h="audio/mp4",f,d,m,y=-1;if(u&&(f=d=1/0),e.config&&s.length){switch(e.timescale=e.samplerate,e.segmentCodec){case"mp3":a.mpeg?(h="audio/mpeg",e.codec=""):a.mp3&&(e.codec="mp3");break;case"ac3":e.codec="ac-3";break}l.audio={id:"audio",container:h,codec:e.codec,initSegment:e.segmentCodec==="mp3"&&a.mpeg?new Uint8Array(0):We.initSegment([e]),metadata:{channelCount:e.channelCount}},u&&(y=e.id,m=e.inputTimeScale,!c||m!==c.timescale?f=d=this.computeInitPts(s[0].pts,m,n,"audio"):u=!1)}if(t.sps&&t.pps&&o.length){if(t.timescale=t.inputTimeScale,l.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:We.initSegment([t]),metadata:{width:t.width,height:t.height}},u)if(y=t.id,m=t.inputTimeScale,!c||m!==c.timescale){const g=this.getVideoStartPts(o),A=Cl(o[0].dts,g),E=this.computeInitPts(A,m,n,"video"),x=this.computeInitPts(g,m,n,"video");d=Math.min(d,E),f=Math.min(f,x)}else u=!1;this.videoTrackConfig={width:t.width,height:t.height,pixelRatio:t.pixelRatio}}if(Object.keys(l).length)return this.ISGenerated=!0,u?(c&&this.warn(`Timestamps at playlist time: ${r?"":"~"}${n} ${f/m} != initPTS: ${c.baseTime/c.timescale} (${c.baseTime}/${c.timescale}) trackId: ${c.trackId}`),this.log(`Found initPTS at playlist time: ${n} offset: ${f/m} (${f}/${m}) trackId: ${y}`),this._initPTS={baseTime:f,timescale:m,trackId:y},this._initDTS={baseTime:d,timescale:m,trackId:y}):f=m=void 0,{tracks:l,initPTS:f,timescale:m,trackId:y}}remuxVideo(e,t,n,r){const s=e.inputTimeScale,o=e.samples,a=[],l=o.length,c=this._initPTS,u=c.baseTime*s/c.timescale;let h=this.nextVideoTs,f=8,d=this.videoSampleDuration,m,y,g=Number.POSITIVE_INFINITY,A=Number.NEGATIVE_INFINITY,E=!1;if(!n||h===null){const F=u+t*s,Y=o[0].pts-Cl(o[0].dts,o[0].pts);Zg&&h!==null&&Math.abs(F-Y-(h+u))<15e3?n=!0:h=F-Y-u}const x=h+u;for(let F=0;F<l;F++){const Y=o[F];Y.pts=Cl(Y.pts,x),Y.dts=Cl(Y.dts,x),Y.dts<o[F>0?F-1:F].dts&&(E=!0)}E&&o.sort(function(F,Y){const te=F.dts-Y.dts,q=F.pts-Y.pts;return te||q}),m=o[0].dts,y=o[o.length-1].dts;const w=y-m,T=w?Math.round(w/(l-1)):d||e.inputTimeScale/30;if(n){const F=m-x,Y=F>T,te=F<-1;if((Y||te)&&(Y?this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${yv(F,!0)} ms (${F}dts) hole between fragments detected at ${t.toFixed(3)}`):this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${yv(-F,!0)} ms (${F}dts) overlapping between fragments detected at ${t.toFixed(3)}`),!te||x>=o[0].pts||Zg)){m=x;const q=o[0].pts-F;if(Y)o[0].dts=m,o[0].pts=q;else{let J=!0;for(let re=0;re<o.length&&!(o[re].dts>q&&J);re++){const ie=o[re].pts;if(o[re].dts-=F,o[re].pts-=F,re<o.length-1){const se=o[re+1].pts,ge=o[re].pts,xe=se<=ge,pe=se<=ie;J=xe==pe}}}this.log(`Video: Initial PTS/DTS adjusted: ${yv(q,!0)}/${yv(m,!0)}, delta: ${yv(F,!0)} ms`)}}m=Math.max(0,m);let I=0,M=0,L=m;for(let F=0;F<l;F++){const Y=o[F],te=Y.units,q=te.length;let J=0;for(let re=0;re<q;re++)J+=te[re].data.length;M+=J,I+=q,Y.length=J,Y.dts<L?(Y.dts=L,L+=T/4|0||1):L=Y.dts,g=Math.min(Y.pts,g),A=Math.max(Y.pts,A)}y=o[l-1].dts;const P=M+4*I+8;let R;try{R=new Uint8Array(P)}catch(F){this.observer.emit(ae.ERROR,ae.ERROR,{type:rn.MUX_ERROR,details:Ke.REMUX_ALLOC_ERROR,fatal:!1,error:F,bytes:P,reason:`fail allocating video mdat ${P}`});return}const U=new DataView(R.buffer);U.setUint32(0,P),R.set(We.types.mdat,4);let k=!1,H=Number.POSITIVE_INFINITY,G=Number.POSITIVE_INFINITY,X=Number.NEGATIVE_INFINITY,Z=Number.NEGATIVE_INFINITY;for(let F=0;F<l;F++){const Y=o[F],te=Y.units;let q=0;for(let ie=0,se=te.length;ie<se;ie++){const ge=te[ie],xe=ge.data,pe=ge.data.byteLength;U.setUint32(f,pe),f+=4,R.set(xe,f),f+=pe,q+=4+pe}let J;if(F<l-1)d=o[F+1].dts-Y.dts,J=o[F+1].pts-Y.pts;else{const ie=this.config,se=F>0?Y.dts-o[F-1].dts:T;if(J=F>0?Y.pts-o[F-1].pts:T,ie.stretchShortVideoTrack&&this.nextAudioTs!==null){const ge=Math.floor(ie.maxBufferHole*s),xe=(r?g+r*s:this.nextAudioTs+u)-Y.pts;xe>ge?(d=xe-se,d<0?d=se:k=!0,this.log(`It is approximately ${xe/90} ms to the next segment; using duration ${d/90} ms for the last video frame.`)):d=se}else d=se}const re=Math.round(Y.pts-Y.dts);H=Math.min(H,d),X=Math.max(X,d),G=Math.min(G,J),Z=Math.max(Z,J),a.push(Ek(Y.key,d,q,re))}if(a.length){if(Zg){if(Zg<70){const F=a[0].flags;F.dependsOn=2,F.isNonSync=0}}else if(Hb&&Z-G<X-H&&T/X<.025&&a[0].cts===0){this.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let F=m;for(let Y=0,te=a.length;Y<te;Y++){const q=F+a[Y].duration,J=F+a[Y].cts;if(Y<te-1){const re=q+a[Y+1].cts;a[Y].duration=re-J}else a[Y].duration=Y?a[Y-1].duration:T;a[Y].cts=0,F=q}}}d=k||!d?T:d;const oe=y+d;this.nextVideoTs=h=oe-u,this.videoSampleDuration=d,this.isVideoContiguous=!0;const W={data1:We.moof(e.sequenceNumber++,m,er(e,{samples:a})),data2:R,startPTS:(g-u)/s,endPTS:(A+d-u)/s,startDTS:(m-u)/s,endDTS:h/s,type:"video",hasAudio:!1,hasVideo:!0,nb:a.length,dropped:e.dropped};return e.samples=[],e.dropped=0,W}getSamplesPerFrame(e){switch(e.segmentCodec){case"mp3":return T0e;case"ac3":return b0e;default:return C0e}}remuxAudio(e,t,n,r,s){const o=e.inputTimeScale,a=e.samplerate?e.samplerate:o,l=o/a,c=this.getSamplesPerFrame(e),u=c*l,h=this._initPTS,f=e.segmentCodec==="mp3"&&this.typeSupported.mpeg,d=[],m=s!==void 0;let y=e.samples,g=f?0:8,A=this.nextAudioTs||-1;const E=h.baseTime*o/h.timescale,x=E+t*o;if(this.isAudioContiguous=n=n||y.length&&A>0&&(r&&Math.abs(x-(A+E))<9e3||Math.abs(Cl(y[0].pts,x)-(A+E))<20*u),y.forEach(function(Z){Z.pts=Cl(Z.pts,x)}),!n||A<0){const Z=y.length;if(y=y.filter(oe=>oe.pts>=0),Z!==y.length&&this.warn(`Removed ${y.length-Z} of ${Z} samples (initPTS ${E} / ${o})`),!y.length)return;s===0?A=0:r&&!m?A=Math.max(0,x-E):A=y[0].pts-E}if(e.segmentCodec==="aac"){const Z=this.config.maxAudioFramesDrift;for(let oe=0,K=A+E;oe<y.length;oe++){const V=y[oe],W=V.pts,F=W-K,Y=Math.abs(1e3*F/o);if(F<=-Z*u&&m)oe===0&&(this.warn(`Audio frame @ ${(W/o).toFixed(3)}s overlaps marker by ${Math.round(1e3*F/o)} ms.`),this.nextAudioTs=A=W-E,K=W);else if(F>=Z*u&&Y<w0e&&m){let te=Math.round(F/u);for(K=W-te*u;K<0&&te&&u;)te--,K+=u;oe===0&&(this.nextAudioTs=A=K-E),this.warn(`Injecting ${te} audio frames @ ${((K-E)/o).toFixed(3)}s due to ${Math.round(1e3*F/o)} ms gap.`);for(let q=0;q<te;q++){let J=E0e.getSilentFrame(e.parsedCodec||e.manifestCodec||e.codec,e.channelCount);J||(this.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),J=V.unit.subarray()),y.splice(oe,0,{unit:J,pts:K}),K+=u,oe++}}V.pts=K,K+=u}}let w=null,T=null,I,M=0,L=y.length;for(;L--;)M+=y[L].unit.byteLength;for(let Z=0,oe=y.length;Z<oe;Z++){const K=y[Z],V=K.unit;let W=K.pts;if(T!==null){const Y=d[Z-1];Y.duration=Math.round((W-T)/l)}else if(n&&e.segmentCodec==="aac"&&(W=A+E),w=W,M>0){M+=g;try{I=new Uint8Array(M)}catch(Y){this.observer.emit(ae.ERROR,ae.ERROR,{type:rn.MUX_ERROR,details:Ke.REMUX_ALLOC_ERROR,fatal:!1,error:Y,bytes:M,reason:`fail allocating audio mdat ${M}`});return}f||(new DataView(I.buffer).setUint32(0,M),I.set(We.types.mdat,4))}else return;I.set(V,g);const F=V.byteLength;g+=F,d.push(Ek(!0,c,F,0)),T=W}const P=d.length;if(!P)return;const R=d[d.length-1];A=T-E,this.nextAudioTs=A+l*R.duration;const U=f?new Uint8Array(0):We.moof(e.sequenceNumber++,w/l,er({},e,{samples:d}));e.samples=[];const k=(w-E)/o,H=this.nextAudioTs/o,X={data1:U,data2:I,startPTS:k,endPTS:H,startDTS:k,endDTS:H,type:"audio",hasAudio:!0,hasVideo:!1,nb:P};return this.isAudioContiguous=!0,X}}function Cl(i,e){let t;if(e===null)return i;for(e<i?t=-8589934592:t=8589934592;Math.abs(i-e)>4294967296;)i+=t;return i}function I0e(i){for(let e=0;e<i.length;e++)if(i[e].key)return e;return-1}function IV(i,e,t,n){const r=i.samples.length;if(!r)return;const s=i.inputTimeScale;for(let a=0;a<r;a++){const l=i.samples[a];l.pts=Cl(l.pts-t.baseTime*s/t.timescale,e*s)/s,l.dts=Cl(l.dts-n.baseTime*s/n.timescale,e*s)/s}const o=i.samples;return i.samples=[],{samples:o}}function MV(i,e,t){const n=i.samples.length;if(!n)return;const r=i.inputTimeScale;for(let o=0;o<n;o++){const a=i.samples[o];a.pts=Cl(a.pts-t.baseTime*r/t.timescale,e*r)/r}i.samples.sort((o,a)=>o.pts-a.pts);const s=i.samples;return i.samples=[],{samples:s}}class M0e extends _c{constructor(e,t,n,r){super("passthrough-remuxer",r),this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null,this.isVideoContiguous=!1}destroy(){}resetTimeStamp(e){this.lastEndTime=null;const t=this.initPTS;t&&e&&t.baseTime===e.baseTime&&t.timescale===e.timescale||(this.initPTS=e)}resetNextTimestamp(){this.isVideoContiguous=!1,this.lastEndTime=null}resetInitSegment(e,t,n,r){this.audioCodec=t,this.videoCodec=n,this.generateInitSegment(e,r),this.emitInitSegment=!0}generateInitSegment(e,t){let{audioCodec:n,videoCodec:r}=this;if(!(e!=null&&e.byteLength)){this.initTracks=void 0,this.initData=void 0;return}const{audio:s,video:o}=this.initData=DQ(e);if(t)vpe(e,t);else{const l=s||o;l!=null&&l.encrypted&&this.warn(`Init segment with encrypted track with has no key ("${l.codec}")!`)}s&&(n=_k(s,ar.AUDIO,this)),o&&(r=_k(o,ar.VIDEO,this));const a={};s&&o?a.audiovideo={container:"video/mp4",codec:n+","+r,supplemental:o.supplemental,encrypted:o.encrypted,initSegment:e,id:"main"}:s?a.audio={container:"audio/mp4",codec:n,encrypted:s.encrypted,initSegment:e,id:"audio"}:o?a.video={container:"video/mp4",codec:r,supplemental:o.supplemental,encrypted:o.encrypted,initSegment:e,id:"main"}:this.warn("initSegment does not contain moov or trak boxes."),this.initTracks=a}remux(e,t,n,r,s,o){var a,l;let{initPTS:c,lastEndTime:u}=this;const h={audio:void 0,video:void 0,text:r,id3:n,initSegment:void 0};jt(u)||(u=this.lastEndTime=s||0);const f=t.samples;if(!f.length)return h;const d={initPTS:void 0,timescale:void 0,trackId:void 0};let m=this.initData;if((a=m)!=null&&a.length||(this.generateInitSegment(f),m=this.initData),!((l=m)!=null&&l.length))return this.warn("Failed to generate initSegment."),h;this.emitInitSegment&&(d.tracks=this.initTracks,this.emitInitSegment=!1);const y=Epe(f,m,this),g=m.audio?y[m.audio.id]:null,A=m.video?y[m.video.id]:null,E=e_(A,1/0),x=e_(g,1/0),w=e_(A,0,!0),T=e_(g,0,!0);let I=s,M=0;const L=g&&(!A||!c&&x<E||c&&c.trackId===m.audio.id),P=L?g:A;if(P){const K=P.timescale,V=P.start-s*K,W=L?m.audio.id:m.video.id;I=P.start/K,M=L?T-x:w-E,(o||!c)&&(R0e(c,I,s,M)||K!==c.timescale)&&(c&&this.warn(`Timestamps at playlist time: ${o?"":"~"}${s} ${V/K} != initPTS: ${c.baseTime/c.timescale} (${c.baseTime}/${c.timescale}) trackId: ${c.trackId}`),this.log(`Found initPTS at playlist time: ${s} offset: ${I-s} (${V}/${K}) trackId: ${W}`),c=null,d.initPTS=V,d.timescale=K,d.trackId=W)}else this.warn(`No audio or video samples found for initPTS at playlist time: ${s}`);c?(d.initPTS=c.baseTime,d.timescale=c.timescale,d.trackId=c.trackId):((!d.timescale||d.trackId===void 0||d.initPTS===void 0)&&(this.warn("Could not set initPTS"),d.initPTS=I,d.timescale=1,d.trackId=-1),this.initPTS=c={baseTime:d.initPTS,timescale:d.timescale,trackId:d.trackId});const R=I-c.baseTime/c.timescale,U=R+M;M>0?this.lastEndTime=U:(this.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const k=!!m.audio,H=!!m.video;let G="";k&&(G+="audio"),H&&(G+="video");const X=(m.audio?m.audio.encrypted:!1)||(m.video?m.video.encrypted:!1),Z={data1:f,startPTS:R,startDTS:R,endPTS:U,endDTS:U,type:G,hasAudio:k,hasVideo:H,nb:1,dropped:0,encrypted:X};h.audio=k&&!H?Z:void 0,h.video=H?Z:void 0;const oe=A==null?void 0:A.sampleCount;if(oe){const K=A.keyFrameIndex,V=K!==-1;Z.nb=oe,Z.dropped=K===0||this.isVideoContiguous?0:V?K:oe,Z.independent=V,Z.firstKeyFrame=K,V&&A.keyFrameStart&&(Z.firstKeyFramePTS=(A.keyFrameStart-c.baseTime)/c.timescale),this.isVideoContiguous||(h.independent=V),this.isVideoContiguous||(this.isVideoContiguous=V),Z.dropped&&this.warn(`fmp4 does not start with IDR: firstIDR ${K}/${oe} dropped: ${Z.dropped} start: ${Z.firstKeyFramePTS||"NA"}`)}return h.initSegment=d,h.id3=IV(n,s,c,c),r.samples.length&&(h.text=MV(r,s,c)),h}}function e_(i,e,t=!1){return(i==null?void 0:i.start)!==void 0?(i.start+(t?i.duration:0))/i.timescale:e}function R0e(i,e,t,n){if(i===null)return!0;const r=Math.max(n,1),s=e-i.baseTime/i.timescale;return Math.abs(s-t)>r}function _k(i,e,t){const n=i.codec;return n&&n.length>4?n:e===ar.AUDIO?n==="ec-3"||n==="ac-3"||n==="alac"?n:n==="fLaC"||n==="Opus"?VS(n,!1):(t.warn(`Unhandled audio codec "${n}" in mp4 MAP`),n||"mp4a"):(t.warn(`Unhandled video codec "${n}" in mp4 MAP`),n||"avc1")}let _f;try{_f=self.performance.now.bind(self.performance)}catch{_f=Date.now}const sS=[{demux:m0e,remux:M0e},{demux:Fd,remux:rS},{demux:h0e,remux:rS},{demux:d0e,remux:rS}];sS.splice(2,0,{demux:f0e,remux:rS});class Sk{constructor(e,t,n,r,s,o){this.asyncResult=!1,this.logger=void 0,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=t,this.config=n,this.id=s,this.logger=o}configure(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()}push(e,t,n,r){const s=n.transmuxing;s.executeStart=_f();let o=new Uint8Array(e);const{currentTransmuxState:a,transmuxConfig:l}=this;r&&(this.currentTransmuxState=r);const{contiguous:c,discontinuity:u,trackSwitch:h,accurateTimeOffset:f,timeOffset:d,initSegmentChange:m}=r||a,{audioCodec:y,videoCodec:g,defaultInitPts:A,duration:E,initSegmentData:x}=l,w=P0e(o,t);if(w&&$1(w.method)){const L=this.getDecrypter(),P=jR(w.method);if(L.isSync()){let R=L.softwareDecrypt(o,w.key.buffer,w.iv.buffer,P);if(n.part>-1){const k=L.flush();R=k&&k.buffer}if(!R)return s.executeEnd=_f(),Qb(n);o=new Uint8Array(R)}else return this.asyncResult=!0,this.decryptionPromise=L.webCryptoDecrypt(o,w.key.buffer,w.iv.buffer,P).then(R=>{const U=this.push(R,null,n);return this.decryptionPromise=null,U}),this.decryptionPromise}const T=this.needsProbing(u,h);if(T){const L=this.configureTransmuxer(o);if(L)return this.logger.warn(`[transmuxer] ${L.message}`),this.observer.emit(ae.ERROR,ae.ERROR,{type:rn.MEDIA_ERROR,details:Ke.FRAG_PARSING_ERROR,fatal:!1,error:L,reason:L.message}),s.executeEnd=_f(),Qb(n)}(u||h||m||T)&&this.resetInitSegment(x,y,g,E,t),(u||m||T)&&this.resetInitialTimestamp(A),c||this.resetContiguity();const I=this.transmux(o,w,d,f,n);this.asyncResult=$2(I);const M=this.currentTransmuxState;return M.contiguous=!0,M.discontinuity=!1,M.trackSwitch=!1,s.executeEnd=_f(),I}flush(e){const t=e.transmuxing;t.executeStart=_f();const{decrypter:n,currentTransmuxState:r,decryptionPromise:s}=this;if(s)return this.asyncResult=!0,s.then(()=>this.flush(e));const o=[],{timeOffset:a}=r;if(n){const h=n.flush();h&&o.push(this.push(h.buffer,null,e))}const{demuxer:l,remuxer:c}=this;if(!l||!c){t.executeEnd=_f();const h=[Qb(e)];return this.asyncResult?Promise.resolve(h):h}const u=l.flush(a);return $2(u)?(this.asyncResult=!0,u.then(h=>(this.flushRemux(o,h,e),o))):(this.flushRemux(o,u,e),this.asyncResult?Promise.resolve(o):o)}flushRemux(e,t,n){const{audioTrack:r,videoTrack:s,id3Track:o,textTrack:a}=t,{accurateTimeOffset:l,timeOffset:c}=this.currentTransmuxState;this.logger.log(`[transmuxer.ts]: Flushed ${this.id} sn: ${n.sn}${n.part>-1?" part: "+n.part:""} of ${this.id===$t.MAIN?"level":"track"} ${n.level}`);const u=this.remuxer.remux(r,s,o,a,c,l,!0,this.id);e.push({remuxResult:u,chunkMeta:n}),n.transmuxing.executeEnd=_f()}resetInitialTimestamp(e){const{demuxer:t,remuxer:n}=this;!t||!n||(t.resetTimeStamp(e),n.resetTimeStamp(e))}resetContiguity(){const{demuxer:e,remuxer:t}=this;!e||!t||(e.resetContiguity(),t.resetNextTimestamp())}resetInitSegment(e,t,n,r,s){const{demuxer:o,remuxer:a}=this;!o||!a||(o.resetInitSegment(e,t,n,r),a.resetInitSegment(e,t,n,s))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(e,t,n,r,s){let o;return t&&t.method==="SAMPLE-AES"?o=this.transmuxSampleAes(e,t,n,r,s):o=this.transmuxUnencrypted(e,n,r,s),o}transmuxUnencrypted(e,t,n,r){const{audioTrack:s,videoTrack:o,id3Track:a,textTrack:l}=this.demuxer.demux(e,t,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(s,o,a,l,t,n,!1,this.id),chunkMeta:r}}transmuxSampleAes(e,t,n,r,s){return this.demuxer.demuxSampleAes(e,t,n).then(o=>({remuxResult:this.remuxer.remux(o.audioTrack,o.videoTrack,o.id3Track,o.textTrack,n,r,!1,this.id),chunkMeta:s}))}configureTransmuxer(e){const{config:t,observer:n,typeSupported:r}=this;let s;for(let h=0,f=sS.length;h<f;h++){var o;if((o=sS[h].demux)!=null&&o.probe(e,this.logger)){s=sS[h];break}}if(!s)return new Error("Failed to find demuxer by probing fragment data");const a=this.demuxer,l=this.remuxer,c=s.remux,u=s.demux;(!l||!(l instanceof c))&&(this.remuxer=new c(n,t,r,this.logger)),(!a||!(a instanceof u))&&(this.demuxer=new u(n,t,r,this.logger),this.probe=u.probe)}needsProbing(e,t){return!this.demuxer||!this.remuxer||e||t}getDecrypter(){let e=this.decrypter;return e||(e=this.decrypter=new QR(this.config)),e}}function P0e(i,e){let t=null;return i.byteLength>0&&(e==null?void 0:e.key)!=null&&e.iv!==null&&e.method!=null&&(t=e),t}const Qb=i=>({remuxResult:{},chunkMeta:i});function $2(i){return"then"in i&&i.then instanceof Function}class L0e{constructor(e,t,n,r,s){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=t,this.initSegmentData=n,this.duration=r,this.defaultInitPts=s||null}}class B0e{constructor(e,t,n,r,s,o){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=t,this.accurateTimeOffset=n,this.trackSwitch=r,this.timeOffset=s,this.initSegmentChange=o}}let wk=0;class RV{constructor(e,t,n,r){this.error=null,this.hls=void 0,this.id=void 0,this.instanceNo=wk++,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.onWorkerMessage=l=>{const c=l.data,u=this.hls;if(!(!u||!(c!=null&&c.event)||c.instanceNo!==this.instanceNo))switch(c.event){case"init":{var h;const f=(h=this.workerContext)==null?void 0:h.objectURL;f&&self.URL.revokeObjectURL(f);break}case"transmuxComplete":{this.handleTransmuxComplete(c.data);break}case"flush":{this.onFlush(c.data);break}case"workerLog":{u.logger[c.data.logType]&&u.logger[c.data.logType](c.data.message);break}default:{c.data=c.data||{},c.data.frag=this.frag,c.data.part=this.part,c.data.id=this.id,u.trigger(c.event,c.data);break}}},this.onWorkerError=l=>{if(!this.hls)return;const c=new Error(`${l.message}  (${l.filename}:${l.lineno})`);this.hls.config.enableWorker=!1,this.hls.logger.warn(`Error in "${this.id}" Web Worker, fallback to inline`),this.hls.trigger(ae.ERROR,{type:rn.OTHER_ERROR,details:Ke.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:c})};const s=e.config;this.hls=e,this.id=t,this.useWorker=!!s.enableWorker,this.onTransmuxComplete=n,this.onFlush=r;const o=(l,c)=>{c=c||{},c.frag=this.frag||void 0,l===ae.ERROR&&(c=c,c.parent=this.id,c.part=this.part,this.error=c.error),this.hls.trigger(l,c)};this.observer=new YR,this.observer.on(ae.FRAG_DECRYPTED,o),this.observer.on(ae.ERROR,o);const a=z7(s.preferManagedMediaSource);if(this.useWorker&&typeof Worker<"u"){const l=this.hls.logger;if(s.workerPath||Ome()){try{s.workerPath?(l.log(`loading Web Worker ${s.workerPath} for "${t}"`),this.workerContext=Ume(s.workerPath)):(l.log(`injecting Web Worker for "${t}"`),this.workerContext=Nme());const{worker:u}=this.workerContext;u.addEventListener("message",this.onWorkerMessage),u.addEventListener("error",this.onWorkerError),u.postMessage({instanceNo:this.instanceNo,cmd:"init",typeSupported:a,id:t,config:lr(s)})}catch(u){l.warn(`Error setting up "${t}" Web Worker, fallback to inline`,u),this.terminateWorker(),this.error=null,this.transmuxer=new Sk(this.observer,a,s,"",t,e.logger)}return}}this.transmuxer=new Sk(this.observer,a,s,"",t,e.logger)}reset(){if(this.frag=null,this.part=null,this.workerContext){const e=this.instanceNo;this.instanceNo=wk++;const t=this.hls.config,n=z7(t.preferManagedMediaSource);this.workerContext.worker.postMessage({instanceNo:this.instanceNo,cmd:"reset",resetNo:e,typeSupported:n,id:this.id,config:lr(t)})}}terminateWorker(){if(this.workerContext){const{worker:e}=this.workerContext;this.workerContext=null,e.removeEventListener("message",this.onWorkerMessage),e.removeEventListener("error",this.onWorkerError),zme(this.hls.config.workerPath)}}destroy(){if(this.workerContext)this.terminateWorker(),this.onWorkerMessage=this.onWorkerError=null;else{const t=this.transmuxer;t&&(t.destroy(),this.transmuxer=null)}const e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.part=null,this.observer=null,this.hls=null}push(e,t,n,r,s,o,a,l,c,u){var h,f;c.transmuxing.start=self.performance.now();const{instanceNo:d,transmuxer:m}=this,y=o?o.start:s.start,g=s.decryptdata,A=this.frag,E=!(A&&s.cc===A.cc),x=!(A&&c.level===A.level),w=A?c.sn-A.sn:-1,T=this.part?c.part-this.part.index:-1,I=w===0&&c.id>1&&c.id===(A==null?void 0:A.stats.chunkCount),M=!x&&(w===1||w===0&&(T===1||I&&T<=0)),L=self.performance.now();(x||w||s.stats.parsing.start===0)&&(s.stats.parsing.start=L),o&&(T||!M)&&(o.stats.parsing.start=L);const P=!(A&&((h=s.initSegment)==null?void 0:h.url)===((f=A.initSegment)==null?void 0:f.url)),R=new B0e(E,M,l,x,y,P);if(!M||E||P){this.hls.logger.log(`[transmuxer-interface]: Starting new transmux session for ${s.type} sn: ${c.sn}${c.part>-1?" part: "+c.part:""} ${this.id===$t.MAIN?"level":"track"}: ${c.level} id: ${c.id}
        discontinuity: ${E}
        trackSwitch: ${x}
        contiguous: ${M}
        accurateTimeOffset: ${l}
        timeOffset: ${y}
        initSegmentChange: ${P}`);const U=new L0e(n,r,t,a,u);this.configureTransmuxer(U)}if(this.frag=s,this.part=o,this.workerContext)this.workerContext.worker.postMessage({instanceNo:d,cmd:"demux",data:e,decryptdata:g,chunkMeta:c,state:R},e instanceof ArrayBuffer?[e]:[]);else if(m){const U=m.push(e,g,c,R);$2(U)?U.then(k=>{this.handleTransmuxComplete(k)}).catch(k=>{this.transmuxerError(k,c,"transmuxer-interface push error")}):this.handleTransmuxComplete(U)}}flush(e){e.transmuxing.start=self.performance.now();const{instanceNo:t,transmuxer:n}=this;if(this.workerContext)this.workerContext.worker.postMessage({instanceNo:t,cmd:"flush",chunkMeta:e});else if(n){const r=n.flush(e);$2(r)?r.then(s=>{this.handleFlushResult(s,e)}).catch(s=>{this.transmuxerError(s,e,"transmuxer-interface flush error")}):this.handleFlushResult(r,e)}}transmuxerError(e,t,n){this.hls&&(this.error=e,this.hls.trigger(ae.ERROR,{type:rn.MEDIA_ERROR,details:Ke.FRAG_PARSING_ERROR,chunkMeta:t,frag:this.frag||void 0,part:this.part||void 0,fatal:!1,error:e,err:e,reason:n}))}handleFlushResult(e,t){e.forEach(n=>{this.handleTransmuxComplete(n)}),this.onFlush(t)}configureTransmuxer(e){const{instanceNo:t,transmuxer:n}=this;this.workerContext?this.workerContext.worker.postMessage({instanceNo:t,cmd:"configure",config:e}):n&&n.configure(e)}handleTransmuxComplete(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)}}const Ck=100;class PV extends E4{constructor(e,t,n){super(e,t,n,"audio-stream-controller",$t.AUDIO),this.mainAnchor=null,this.mainFragLoading=null,this.audioOnly=!1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.flushing=!1,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.resetItem()}resetItem(){this.mainDetails=this.mainAnchor=this.mainFragLoading=this.bufferedTrack=this.switchingTrack=this.waitingData=this.cachedTrackLoadedData=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(ae.LEVEL_LOADED,this.onLevelLoaded,this),e.on(ae.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(ae.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(ae.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(ae.BUFFER_RESET,this.onBufferReset,this),e.on(ae.BUFFER_CREATED,this.onBufferCreated,this),e.on(ae.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(ae.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(ae.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(ae.FRAG_LOADING,this.onFragLoading,this),e.on(ae.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){const{hls:e}=this;e&&(super.unregisterListeners(),e.off(ae.LEVEL_LOADED,this.onLevelLoaded,this),e.off(ae.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(ae.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(ae.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(ae.BUFFER_RESET,this.onBufferReset,this),e.off(ae.BUFFER_CREATED,this.onBufferCreated,this),e.off(ae.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(ae.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(ae.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(ae.FRAG_LOADING,this.onFragLoading,this),e.off(ae.FRAG_BUFFERED,this.onFragBuffered,this))}onInitPtsFound(e,{frag:t,id:n,initPTS:r,timescale:s,trackId:o}){if(n===$t.MAIN){const a=t.cc,l=this.fragCurrent;if(this.initPTS[a]={baseTime:r,timescale:s,trackId:o},this.log(`InitPTS for cc: ${a} found from main: ${r/s} (${r}/${s}) trackId: ${o}`),this.mainAnchor=t,this.state===mt.WAITING_INIT_PTS){const c=this.waitingData;(!c&&!this.loadingParts||c&&c.frag.cc!==a)&&this.syncWithAnchor(t,c==null?void 0:c.frag)}else!this.hls.hasEnoughToStart&&l&&l.cc!==a?(l.abortRequests(),this.syncWithAnchor(t,l)):this.state===mt.IDLE&&this.tick()}}getLoadPosition(){return!this.startFragRequested&&this.nextLoadPosition>=0?this.nextLoadPosition:super.getLoadPosition()}syncWithAnchor(e,t){var n;const r=((n=this.mainFragLoading)==null?void 0:n.frag)||null;if(t&&(r==null?void 0:r.cc)===t.cc)return;const s=(r||e).cc,o=this.getLevelDetails(),a=this.getLoadPosition(),l=WQ(o,s,a);l&&(this.log(`Syncing with main frag at ${l.start} cc ${l.cc}`),this.startFragRequested=!1,this.nextLoadPosition=l.start,this.resetLoadingState(),this.state===mt.IDLE&&this.doTickIdle())}startLoad(e,t){if(!this.levels){this.startPosition=e,this.state=mt.STOPPED;return}const n=this.lastCurrentTime;this.stopLoad(),this.setInterval(Ck),n>0&&e===-1?(this.log(`Override startPosition with lastCurrentTime @${n.toFixed(3)}`),e=n,this.state=mt.IDLE):this.state=mt.WAITING_TRACK,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}doTick(){switch(this.state){case mt.IDLE:this.doTickIdle();break;case mt.WAITING_TRACK:{const{levels:e,trackId:t}=this,n=e==null?void 0:e[t],r=n==null?void 0:n.details;if(r&&!this.waitForLive(n)){if(this.waitForCdnTuneIn(r))break;this.state=mt.WAITING_INIT_PTS}break}case mt.FRAG_LOADING_WAITING_RETRY:{this.checkRetryDate();break}case mt.WAITING_INIT_PTS:{const e=this.waitingData;if(e){const{frag:t,part:n,cache:r,complete:s}=e,o=this.mainAnchor;if(this.initPTS[t.cc]!==void 0){this.waitingData=null,this.state=mt.FRAG_LOADING;const a=r.flush().buffer,l={frag:t,part:n,payload:a,networkDetails:null};this._handleFragmentLoadProgress(l),s&&super._handleFragmentLoadComplete(l)}else o&&o.cc!==e.frag.cc&&this.syncWithAnchor(o,e.frag)}else this.state=mt.IDLE}}this.onTickEnd()}resetLoadingState(){const e=this.waitingData;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingData=null),super.resetLoadingState()}onTickEnd(){const{media:e}=this;e!=null&&e.readyState&&(this.lastCurrentTime=e.currentTime)}doTickIdle(){var e;const{hls:t,levels:n,media:r,trackId:s}=this,o=t.config;if(!this.buffering||!r&&!this.primaryPrefetch&&(this.startFragRequested||!o.startFragPrefetch)||!(n!=null&&n[s]))return;const a=n[s],l=a.details;if(!l||this.waitForLive(a)||this.waitForCdnTuneIn(l)){this.state=mt.WAITING_TRACK,this.startFragRequested=!1;return}const c=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&c&&(this.bufferFlushed=!1,this.afterBufferFlushed(c,ar.AUDIO,$t.AUDIO));const u=this.getFwdBufferInfo(c,$t.AUDIO);if(u===null)return;if(!this.switchingTrack&&this._streamEnded(u,l)){t.trigger(ae.BUFFER_EOS,{type:"audio"}),this.state=mt.ENDED;return}const h=u.len,f=t.maxBufferLength,d=l.fragments,m=d[0].start,y=this.getLoadPosition(),g=this.flushing?y:u.end;if(this.switchingTrack&&r){const x=y;l.PTSKnown&&x<m&&(u.end>m||u.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),r.currentTime=m+.05)}if(h>=f&&!this.switchingTrack&&g<d[d.length-1].start)return;let A=this.getNextFragment(g,l);if(A&&this.isLoopLoading(A,g)&&(A=this.getNextFragmentLoopLoading(A,l,u,$t.MAIN,f)),!A){this.bufferFlushed=!0;return}let E=((e=this.mainFragLoading)==null?void 0:e.frag)||null;if(!this.audioOnly&&this.startFragRequested&&E&&As(A)&&!A.endList&&(!l.live||!this.loadingParts&&g<this.hls.liveSyncPosition)&&(this.fragmentTracker.getState(E)===eo.OK&&(this.mainFragLoading=E=null),E&&As(E))){if(A.start>E.end){const w=this.fragmentTracker.getFragAtPos(g,$t.MAIN);w&&w.end>E.end&&(E=w,this.mainFragLoading={frag:w,targetBufferTime:null})}if(A.start>E.end)return}this.loadFragment(A,a,g)}onMediaDetaching(e,t){this.bufferFlushed=this.flushing=!1,super.onMediaDetaching(e,t)}onAudioTracksUpdated(e,{audioTracks:t}){this.resetTransmuxer(),this.levels=t.map(n=>new hA(n))}onAudioTrackSwitching(e,t){const n=!!t.url;this.trackId=t.id;const{fragCurrent:r}=this;r&&(r.abortRequests(),this.removeUnbufferedFrags(r.start)),this.resetLoadingState(),n?(this.switchingTrack=t,this.flushAudioIfNeeded(t),this.state!==mt.STOPPED&&(this.setInterval(Ck),this.state=mt.IDLE,this.tick())):(this.resetTransmuxer(),this.switchingTrack=null,this.bufferedTrack=t,this.clearInterval())}onManifestLoading(){super.onManifestLoading(),this.bufferFlushed=this.flushing=this.audioOnly=!1,this.resetItem(),this.trackId=-1}onLevelLoaded(e,t){this.mainDetails=t.details;const n=this.cachedTrackLoadedData;n&&(this.cachedTrackLoadedData=null,this.onAudioTrackLoaded(ae.AUDIO_TRACK_LOADED,n))}onAudioTrackLoaded(e,t){var n;const{levels:r}=this,{details:s,id:o,groupId:a,track:l}=t;if(!r){this.warn(`Audio tracks reset while loading track ${o} "${l.name}" of "${a}"`);return}const c=this.mainDetails;if(!c||s.endCC>c.endCC||c.expired){this.cachedTrackLoadedData=t,this.state!==mt.STOPPED&&(this.state=mt.WAITING_TRACK);return}this.cachedTrackLoadedData=null,this.log(`Audio track ${o} "${l.name}" of "${a}" loaded [${s.startSN},${s.endSN}]${s.lastPartSn?`[part-${s.lastPartSn}-${s.lastPartIndex}]`:""},duration:${s.totalduration}`);const u=r[o];let h=0;if(s.live||(n=u.details)!=null&&n.live){if(this.checkLiveUpdate(s),s.deltaUpdateFailed)return;if(u.details){var f;h=this.alignPlaylists(s,u.details,(f=this.levelLastLoaded)==null?void 0:f.details)}s.alignedSliding||(uV(s,c),s.alignedSliding||qS(s,c),h=s.fragmentStart)}u.details=s,this.levelLastLoaded=u,this.startFragRequested||this.setStartPosition(c,h),this.hls.trigger(ae.AUDIO_TRACK_UPDATED,{details:s,id:o,groupId:t.groupId}),this.state===mt.WAITING_TRACK&&!this.waitForCdnTuneIn(s)&&(this.state=mt.IDLE),this.tick()}_handleFragmentLoadProgress(e){var t;const n=e.frag,{part:r,payload:s}=e,{config:o,trackId:a,levels:l}=this;if(!l){this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${n.sn} of level ${n.level} will not be buffered`);return}const c=l[a];if(!c){this.warn("Audio track is undefined on fragment load progress");return}const u=c.details;if(!u){this.warn("Audio track details undefined on fragment load progress"),this.removeUnbufferedFrags(n.start);return}const h=o.defaultAudioCodec||c.audioCodec||"mp4a.40.2";let f=this.transmuxer;f||(f=this.transmuxer=new RV(this.hls,$t.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const d=this.initPTS[n.cc],m=(t=n.initSegment)==null?void 0:t.data;if(d!==void 0){const g=r?r.index:-1,A=g!==-1,E=new x4(n.level,n.sn,n.stats.chunkCount,s.byteLength,g,A);f.push(s,m,h,"",n,r,u.totalduration,!1,E,d)}else{this.log(`Unknown video PTS for cc ${n.cc}, waiting for video PTS before demuxing audio frag ${n.sn} of [${u.startSN} ,${u.endSN}],track ${a}`);const{cache:y}=this.waitingData=this.waitingData||{frag:n,part:r,cache:new hV,complete:!1};y.push(new Uint8Array(s)),this.state!==mt.STOPPED&&(this.state=mt.WAITING_INIT_PTS)}}_handleFragmentLoadComplete(e){if(this.waitingData){this.waitingData.complete=!0;return}super._handleFragmentLoadComplete(e)}onBufferReset(){this.mediaBuffer=null}onBufferCreated(e,t){this.bufferFlushed=this.flushing=!1;const n=t.tracks.audio;n&&(this.mediaBuffer=n.buffer||null)}onFragLoading(e,t){!this.audioOnly&&t.frag.type===$t.MAIN&&As(t.frag)&&(this.mainFragLoading=t,this.state===mt.IDLE&&this.tick())}onFragBuffered(e,t){const{frag:n,part:r}=t;if(n.type!==$t.AUDIO){!this.audioOnly&&n.type===$t.MAIN&&!n.elementaryStreams.video&&!n.elementaryStreams.audiovideo&&(this.audioOnly=!0,this.mainFragLoading=null);return}if(this.fragContextChanged(n)){this.warn(`Fragment ${n.sn}${r?" p: "+r.index:""} of level ${n.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);return}if(As(n)){this.fragPrevious=n;const s=this.switchingTrack;s&&(this.bufferedTrack=s,this.switchingTrack=null,this.hls.trigger(ae.AUDIO_TRACK_SWITCHED,Qi({},s)))}this.fragBufferedComplete(n,r),this.media&&this.tick()}onError(e,t){var n;if(t.fatal){this.state=mt.ERROR;return}switch(t.details){case Ke.FRAG_GAP:case Ke.FRAG_PARSING_ERROR:case Ke.FRAG_DECRYPT_ERROR:case Ke.FRAG_LOAD_ERROR:case Ke.FRAG_LOAD_TIMEOUT:case Ke.KEY_LOAD_ERROR:case Ke.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError($t.AUDIO,t);break;case Ke.AUDIO_TRACK_LOAD_ERROR:case Ke.AUDIO_TRACK_LOAD_TIMEOUT:case Ke.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===mt.WAITING_TRACK&&((n=t.context)==null?void 0:n.type)===ai.AUDIO_TRACK&&(this.state=mt.IDLE);break;case Ke.BUFFER_ADD_CODEC_ERROR:case Ke.BUFFER_APPEND_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)||this.resetLoadingState();break;case Ke.BUFFER_FULL_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case Ke.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onBufferFlushing(e,{type:t}){t!==ar.VIDEO&&(this.flushing=!0)}onBufferFlushed(e,{type:t}){if(t!==ar.VIDEO){this.flushing=!1,this.bufferFlushed=!0,this.state===mt.ENDED&&(this.state=mt.IDLE);const n=this.mediaBuffer||this.media;n&&(this.afterBufferFlushed(n,t,$t.AUDIO),this.tick())}}_handleTransmuxComplete(e){var t;const n="audio",{hls:r}=this,{remuxResult:s,chunkMeta:o}=e,a=this.getCurrentContext(o);if(!a){this.resetWhenMissingContext(o);return}const{frag:l,part:c,level:u}=a,{details:h}=u,{audio:f,text:d,id3:m,initSegment:y}=s;if(this.fragContextChanged(l)||!h){this.fragmentTracker.removeFragment(l);return}if(this.state=mt.PARSING,this.switchingTrack&&f&&this.completeAudioSwitch(this.switchingTrack),y!=null&&y.tracks){const g=l.initSegment||l;if(this.unhandledEncryptionError(y,l))return;this._bufferInitSegment(u,y.tracks,g,o),r.trigger(ae.FRAG_PARSING_INIT_SEGMENT,{frag:g,id:n,tracks:y.tracks})}if(f){const{startPTS:g,endPTS:A,startDTS:E,endDTS:x}=f;c&&(c.elementaryStreams[ar.AUDIO]={startPTS:g,endPTS:A,startDTS:E,endDTS:x}),l.setElementaryStreamInfo(ar.AUDIO,g,A,E,x),this.bufferFragmentData(f,l,c,o)}if(m!=null&&(t=m.samples)!=null&&t.length){const g=er({id:n,frag:l,details:h},m);r.trigger(ae.FRAG_PARSING_METADATA,g)}if(d){const g=er({id:n,frag:l,details:h},d);r.trigger(ae.FRAG_PARSING_USERDATA,g)}}_bufferInitSegment(e,t,n,r){if(this.state!==mt.PARSING||(t.video&&delete t.video,t.audiovideo&&delete t.audiovideo,!t.audio))return;const s=t.audio;s.id=$t.AUDIO;const o=e.audioCodec;this.log(`Init audio buffer, container:${s.container}, codecs[level/parsed]=[${o}/${s.codec}]`),o&&o.split(",").length===1&&(s.levelCodec=o),this.hls.trigger(ae.BUFFER_CODECS,t);const a=s.initSegment;if(a!=null&&a.byteLength){const l={type:"audio",frag:n,part:null,chunkMeta:r,parent:n.type,data:a};this.hls.trigger(ae.BUFFER_APPENDING,l)}this.tickImmediate()}loadFragment(e,t,n){const r=this.fragmentTracker.getState(e);if(this.switchingTrack||r===eo.NOT_LOADED||r===eo.PARTIAL){var s;if(!As(e))this._loadInitSegment(e,t);else if((s=t.details)!=null&&s.live&&!this.initPTS[e.cc]){this.log(`Waiting for video PTS in continuity counter ${e.cc} of live stream before loading audio fragment ${e.sn} of level ${this.trackId}`),this.state=mt.WAITING_INIT_PTS;const o=this.mainDetails;o&&o.fragmentStart!==t.details.fragmentStart&&qS(t.details,o)}else super.loadFragment(e,t,n)}else this.clearTrackerIfNeeded(e)}flushAudioIfNeeded(e){if(this.media&&this.bufferedTrack){const{name:t,lang:n,assocLang:r,characteristics:s,audioCodec:o,channels:a}=this.bufferedTrack;jm({name:t,lang:n,assocLang:r,characteristics:s,audioCodec:o,channels:a},e,Cm)||(WS(e.url,this.hls)?(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null):this.bufferedTrack=e)}}completeAudioSwitch(e){const{hls:t}=this;this.flushAudioIfNeeded(e),this.bufferedTrack=e,this.switchingTrack=null,t.trigger(ae.AUDIO_TRACK_SWITCHED,Qi({},e))}}class S4 extends _c{constructor(e,t){super(t,e.logger),this.hls=void 0,this.canLoad=!1,this.timer=-1,this.hls=e}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){this.timer!==-1&&(self.clearTimeout(this.timer),this.timer=-1)}startLoad(){this.canLoad=!0,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(e,t,n){const r=t==null?void 0:t.renditionReports;if(r){let s=-1;for(let o=0;o<r.length;o++){const a=r[o];let l;try{l=new self.URL(a.URI,t.url).href}catch(c){this.warn(`Could not construct new URL for Rendition Report: ${c}`),l=a.URI||""}if(l===e){s=o;break}else l===e.substring(0,l.length)&&(s=o)}if(s!==-1){const o=r[s],a=parseInt(o["LAST-MSN"])||t.lastPartSn;let l=parseInt(o["LAST-PART"])||t.lastPartIndex;if(this.hls.config.lowLatencyMode){const u=Math.min(t.age-t.partTarget,t.targetduration);l>=0&&u>t.partTarget&&(l+=1)}const c=n&&G7(n);return new E5(a,l>=0?l:void 0,c)}}}loadPlaylist(e){this.clearTimer()}loadingPlaylist(e,t){this.clearTimer()}shouldLoadPlaylist(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)}getUrlWithDirectives(e,t){if(t)try{return t.addDirectives(e)}catch(n){this.warn(`Could not construct new URL with HLS Delivery Directives: ${n}`)}return e}playlistLoaded(e,t,n){const{details:r,stats:s}=t,o=self.performance.now(),a=s.loading.first?Math.max(0,o-s.loading.first):0;r.advancedDateTime=Date.now()-a;const l=this.hls.config.timelineOffset;if(l!==r.appliedTimelineOffset){const u=Math.max(l||0,0);r.appliedTimelineOffset=u,r.fragments.forEach(h=>{h.setStart(h.playlistOffset+u)})}if(r.live||n!=null&&n.live){const u="levelInfo"in t?t.levelInfo:t.track;if(r.reloaded(n),n&&r.fragments.length>0){Tme(n,r,this);const E=r.playlistParsingError;if(E){this.warn(E);const x=this.hls;if(!x.config.ignorePlaylistParsingErrors){var c;const{networkDetails:w}=t;x.trigger(ae.ERROR,{type:rn.NETWORK_ERROR,details:Ke.LEVEL_PARSING_ERROR,fatal:!1,url:r.url,error:E,reason:E.message,level:t.level||void 0,parent:(c=r.fragments[0])==null?void 0:c.type,networkDetails:w,stats:s});return}r.playlistParsingError=null}}r.requestScheduled===-1&&(r.requestScheduled=s.loading.start);const h=this.hls.mainForwardBufferInfo,f=h?h.end-h.len:0,d=(r.edge-f)*1e3,m=sV(r,d);if(r.requestScheduled+m<o?r.requestScheduled=o:r.requestScheduled+=m,this.log(`live playlist ${e} ${r.advanced?"REFRESHED "+r.lastPartSn+"-"+r.lastPartIndex:r.updated?"UPDATED":"MISSED"}`),!this.canLoad||!r.live)return;let y,g,A;if(r.canBlockReload&&r.endSN&&r.advanced){const E=this.hls.config.lowLatencyMode,x=r.lastPartSn,w=r.endSN,T=r.lastPartIndex,I=T!==-1,M=x===w;I?M?(g=w+1,A=E?0:T):(g=x,A=E?T+1:r.maxPartIndex):g=w+1;const L=r.age,P=L+r.ageHeader;let R=Math.min(P-r.partTarget,r.targetduration*1.5);if(R>0){if(P>r.targetduration*3)this.log(`Playlist last advanced ${L.toFixed(2)}s ago. Omitting segment and part directives.`),g=void 0,A=void 0;else if(n!=null&&n.tuneInGoal&&P-r.partTarget>n.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${n.tuneInGoal} to: ${R} with playlist age: ${r.age}`),R=0;else{const U=Math.floor(R/r.targetduration);if(g+=U,A!==void 0){const k=Math.round(R%r.targetduration/r.partTarget);A+=k}this.log(`CDN Tune-in age: ${r.ageHeader}s last advanced ${L.toFixed(2)}s goal: ${R} skip sn ${U} to part ${A}`)}r.tuneInGoal=R}if(y=this.getDeliveryDirectives(r,t.deliveryDirectives,g,A),E||!M){r.requestScheduled=o,this.loadingPlaylist(u,y);return}}else(r.canBlockReload||r.canSkipUntil)&&(y=this.getDeliveryDirectives(r,t.deliveryDirectives,g,A));y&&g!==void 0&&r.canBlockReload&&(r.requestScheduled=s.loading.first+Math.max(m-a*2,m/2)),this.scheduleLoading(u,y,r)}else this.clearTimer()}scheduleLoading(e,t,n){const r=n||e.details;if(!r){this.loadingPlaylist(e,t);return}const s=self.performance.now(),o=r.requestScheduled;if(s>=o){this.loadingPlaylist(e,t);return}const a=o-s;this.log(`reload live playlist ${e.name||e.bitrate+"bps"} in ${Math.round(a)} ms`),this.clearTimer(),this.timer=self.setTimeout(()=>this.loadingPlaylist(e,t),a)}getDeliveryDirectives(e,t,n,r){let s=G7(e);return t!=null&&t.skip&&e.deltaUpdateFailed&&(n=t.msn,r=t.part,s=c2.No),new E5(n,r,s)}checkRetry(e){const t=e.details,n=KS(e),r=e.errorAction,{action:s,retryCount:o=0,retryConfig:a}=r||{},l=!!r&&!!a&&(s===Zs.RetryRequest||!r.resolved&&s===Zs.SendAlternateToPenaltyBox);if(l){var c;if(o>=a.maxNumRetry)return!1;if(n&&(c=e.context)!=null&&c.deliveryDirectives)this.warn(`Retrying playlist loading ${o+1}/${a.maxNumRetry} after "${t}" without delivery-directives`),this.loadPlaylist();else{const u=HR(a,o);this.clearTimer(),this.timer=self.setTimeout(()=>this.loadPlaylist(),u),this.warn(`Retrying playlist loading ${o+1}/${a.maxNumRetry} after "${t}" in ${u}ms`)}e.levelRetry=!0,r.resolved=!0}return l}}function LV(i,e){if(i.length!==e.length)return!1;for(let t=0;t<i.length;t++)if(!X2(i[t].attrs,e[t].attrs))return!1;return!0}function X2(i,e,t){const n=i["STABLE-RENDITION-ID"];return n&&!t?n===e["STABLE-RENDITION-ID"]:!(t||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some(r=>i[r]!==e[r])}function M5(i,e){return e.label.toLowerCase()===i.name.toLowerCase()&&(!e.language||e.language.toLowerCase()===(i.lang||"").toLowerCase())}class BV extends S4{constructor(e){super(e,"audio-track-controller"),this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:e}=this;e.on(ae.MANIFEST_LOADING,this.onManifestLoading,this),e.on(ae.MANIFEST_PARSED,this.onManifestParsed,this),e.on(ae.LEVEL_LOADING,this.onLevelLoading,this),e.on(ae.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(ae.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(ae.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(ae.MANIFEST_LOADING,this.onManifestLoading,this),e.off(ae.MANIFEST_PARSED,this.onManifestParsed,this),e.off(ae.LEVEL_LOADING,this.onLevelLoading,this),e.off(ae.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(ae.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(ae.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.audioTracks||[]}onAudioTrackLoaded(e,t){const{id:n,groupId:r,details:s}=t,o=this.tracksInGroup[n];if(!o||o.groupId!==r){this.warn(`Audio track with id:${n} and group:${r} not found in active group ${o==null?void 0:o.groupId}`);return}const a=o.details;o.details=t.details,this.log(`Audio track ${n} "${o.name}" lang:${o.lang} group:${r} loaded [${s.startSN}-${s.endSN}]`),n===this.trackId&&this.playlistLoaded(n,t,a)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const n=t.audioGroups||null,r=this.groupIds;let s=this.currentTrack;if(!n||(r==null?void 0:r.length)!==(n==null?void 0:n.length)||n!=null&&n.some(a=>(r==null?void 0:r.indexOf(a))===-1)){this.groupIds=n,this.trackId=-1,this.currentTrack=null;const a=this.tracks.filter(f=>!n||n.indexOf(f.groupId)!==-1);if(a.length)this.selectDefaultTrack&&!a.some(f=>f.default)&&(this.selectDefaultTrack=!1),a.forEach((f,d)=>{f.id=d});else if(!s&&!this.tracksInGroup.length)return;this.tracksInGroup=a;const l=this.hls.config.audioPreference;if(!s&&l){const f=Ah(l,a,Cm);if(f>-1)s=a[f];else{const d=Ah(l,this.tracks);s=this.tracks[d]}}let c=this.findTrackId(s);c===-1&&s&&(c=this.findTrackId(null));const u={audioTracks:a};this.log(`Updating audio tracks, ${a.length} track(s) found in group(s): ${n==null?void 0:n.join(",")}`),this.hls.trigger(ae.AUDIO_TRACKS_UPDATED,u);const h=this.trackId;if(c!==-1&&h===-1)this.setAudioTrack(c);else if(a.length&&h===-1){var o;const f=new Error(`No audio track selected for current audio group-ID(s): ${(o=this.groupIds)==null?void 0:o.join(",")} track count: ${a.length}`);this.warn(f.message),this.hls.trigger(ae.ERROR,{type:rn.MEDIA_ERROR,details:Ke.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:f})}}}onError(e,t){t.fatal||!t.context||t.context.type===ai.AUDIO_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allAudioTracks(){return this.tracks}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}setAudioOption(e){const t=this.hls;if(t.config.audioPreference=e,e){const n=this.allAudioTracks;if(this.selectDefaultTrack=!1,n.length){const r=this.currentTrack;if(r&&jm(e,r,Cm))return r;const s=Ah(e,this.tracksInGroup,Cm);if(s>-1){const o=this.tracksInGroup[s];return this.setAudioTrack(s),o}else if(r){let o=t.loadLevel;o===-1&&(o=t.firstAutoLevel);const a=Xpe(e,t.levels,n,o,Cm);if(a===-1)return null;t.nextLoadLevel=a}if(e.channels||e.audioCodec){const o=Ah(e,n);if(o>-1)return n[o]}}}return null}setAudioTrack(e){const t=this.tracksInGroup;if(e<0||e>=t.length){this.warn(`Invalid audio track id: ${e}`);return}this.selectDefaultTrack=!1;const n=this.currentTrack,r=t[e],s=r.details&&!r.details.live;if(e===this.trackId&&r===n&&s||(this.log(`Switching to audio-track ${e} "${r.name}" lang:${r.lang} group:${r.groupId} channels:${r.channels}`),this.trackId=e,this.currentTrack=r,this.hls.trigger(ae.AUDIO_TRACK_SWITCHING,Qi({},r)),s))return;const o=this.switchParams(r.url,n==null?void 0:n.details,r.details);this.loadPlaylist(o)}findTrackId(e){const t=this.tracksInGroup;for(let n=0;n<t.length;n++){const r=t[n];if(!(this.selectDefaultTrack&&!r.default)&&(!e||jm(e,r,Cm)))return n}if(e){const{name:n,lang:r,assocLang:s,characteristics:o,audioCodec:a,channels:l}=e;for(let c=0;c<t.length;c++){const u=t[c];if(jm({name:n,lang:r,assocLang:s,characteristics:o,audioCodec:a,channels:l},u,Cm))return c}for(let c=0;c<t.length;c++){const u=t[c];if(X2(e.attrs,u.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return c}for(let c=0;c<t.length;c++){const u=t[c];if(X2(e.attrs,u.attrs,["LANGUAGE"]))return c}}return-1}loadPlaylist(e){super.loadPlaylist();const t=this.currentTrack;this.shouldLoadPlaylist(t)&&WS(t.url,this.hls)&&this.scheduleLoading(t,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const n=e.id,r=e.groupId,s=this.getUrlWithDirectives(e.url,t),o=e.details,a=o==null?void 0:o.age;this.log(`Loading audio-track ${n} "${e.name}" lang:${e.lang} group:${r}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${a&&o.live?" age "+a.toFixed(1)+(o.type&&" "+o.type||""):""} ${s}`),this.hls.trigger(ae.AUDIO_TRACK_LOADING,{url:s,id:n,groupId:r,deliveryDirectives:t||null,track:e})}}class D0e{constructor(e){this.tracks=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.tracks=e}destroy(){this.tracks=this.queues=null}append(e,t,n){if(this.queues===null||this.tracks===null)return;const r=this.queues[t];r.push(e),r.length===1&&!n&&this.executeNext(t)}appendBlocker(e){return new Promise(t=>{const n={label:"async-blocker",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.append(n,e)})}prependBlocker(e){return new Promise(t=>{if(this.queues){const n={label:"async-blocker-prepend",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.queues[e].unshift(n)}})}removeBlockers(){this.queues!==null&&[this.queues.video,this.queues.audio,this.queues.audiovideo].forEach(e=>{var t;const n=(t=e[0])==null?void 0:t.label;(n==="async-blocker"||n==="async-blocker-prepend")&&(e[0].execute(),e.splice(0,1))})}unblockAudio(e){if(this.queues===null)return;this.queues.audio[0]===e&&this.shiftAndExecuteNext("audio")}executeNext(e){if(this.queues===null||this.tracks===null)return;const t=this.queues[e];if(t.length){const r=t[0];try{r.execute()}catch(s){var n;if(r.onError(s),this.queues===null||this.tracks===null)return;const o=(n=this.tracks[e])==null?void 0:n.buffer;o!=null&&o.updating||this.shiftAndExecuteNext(e)}}}shiftAndExecuteNext(e){this.queues!==null&&(this.queues[e].shift(),this.executeNext(e))}current(e){var t;return((t=this.queues)==null?void 0:t[e][0])||null}toString(){const{queues:e,tracks:t}=this;return e===null||t===null?"<destroyed>":`
${this.list("video")}
${this.list("audio")}
${this.list("audiovideo")}}`}list(e){var t,n;return(t=this.queues)!=null&&t[e]||(n=this.tracks)!=null&&n[e]?`${e}: (${this.listSbInfo(e)}) ${this.listOps(e)}`:""}listSbInfo(e){var t;const n=(t=this.tracks)==null?void 0:t[e],r=n==null?void 0:n.buffer;return r?`SourceBuffer${r.updating?" updating":""}${n.ended?" ended":""}${n.ending?" ending":""}`:"none"}listOps(e){var t;return((t=this.queues)==null?void 0:t[e].map(n=>n.label).join(", "))||""}}const Tk=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/,DV="HlsJsTrackRemovedError";class k0e extends Error{constructor(e){super(e),this.name=DV}}class kV extends _c{constructor(e,t){super("buffer-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.details=null,this._objectUrl=null,this.operationQueue=null,this.bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.blockedAudioAppend=null,this.lastVideoAppendEnd=0,this.appendSource=void 0,this.transferData=void 0,this.overrides=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.sourceBuffers=[[null,null],[null,null]],this._onEndStreaming=n=>{var r;this.hls&&((r=this.mediaSource)==null?void 0:r.readyState)==="open"&&this.hls.pauseBuffering()},this._onStartStreaming=n=>{this.hls&&this.hls.resumeBuffering()},this._onMediaSourceOpen=n=>{const{media:r,mediaSource:s}=this;n&&this.log("Media source opened"),!(!r||!s)&&(s.removeEventListener("sourceopen",this._onMediaSourceOpen),r.removeEventListener("emptied",this._onMediaEmptied),this.updateDuration(),this.hls.trigger(ae.MEDIA_ATTACHED,{media:r,mediaSource:s}),this.mediaSource!==null&&this.checkPendingTracks())},this._onMediaSourceClose=()=>{this.log("Media source closed")},this._onMediaSourceEnded=()=>{this.log("Media source ended")},this._onMediaEmptied=()=>{const{mediaSrc:n,_objectUrl:r}=this;n!==r&&this.error(`Media element src was set while attaching MediaSource (${r} > ${n})`)},this.hls=e,this.fragmentTracker=t,this.appendSource=upe(Uf(e.config.preferManagedMediaSource)),this.initTracks(),this.registerListeners()}hasSourceTypes(){return Object.keys(this.tracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.transferData=this.overrides=void 0,this.operationQueue&&(this.operationQueue.destroy(),this.operationQueue=null),this.hls=this.fragmentTracker=null,this._onMediaSourceOpen=this._onMediaSourceClose=null,this._onMediaSourceEnded=null,this._onStartStreaming=this._onEndStreaming=null}registerListeners(){const{hls:e}=this;e.on(ae.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(ae.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(ae.MANIFEST_LOADING,this.onManifestLoading,this),e.on(ae.MANIFEST_PARSED,this.onManifestParsed,this),e.on(ae.BUFFER_RESET,this.onBufferReset,this),e.on(ae.BUFFER_APPENDING,this.onBufferAppending,this),e.on(ae.BUFFER_CODECS,this.onBufferCodecs,this),e.on(ae.BUFFER_EOS,this.onBufferEos,this),e.on(ae.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(ae.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(ae.FRAG_PARSED,this.onFragParsed,this),e.on(ae.FRAG_CHANGED,this.onFragChanged,this),e.on(ae.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(ae.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(ae.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(ae.MANIFEST_LOADING,this.onManifestLoading,this),e.off(ae.MANIFEST_PARSED,this.onManifestParsed,this),e.off(ae.BUFFER_RESET,this.onBufferReset,this),e.off(ae.BUFFER_APPENDING,this.onBufferAppending,this),e.off(ae.BUFFER_CODECS,this.onBufferCodecs,this),e.off(ae.BUFFER_EOS,this.onBufferEos,this),e.off(ae.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(ae.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(ae.FRAG_PARSED,this.onFragParsed,this),e.off(ae.FRAG_CHANGED,this.onFragChanged,this),e.off(ae.ERROR,this.onError,this)}transferMedia(){const{media:e,mediaSource:t}=this;if(!e)return null;const n={};if(this.operationQueue){const s=this.isUpdating();s||this.operationQueue.removeBlockers();const o=this.isQueued();(s||o)&&this.warn(`Transfering MediaSource with${o?" operations in queue":""}${s?" updating SourceBuffer(s)":""} ${this.operationQueue}`),this.operationQueue.destroy()}const r=this.transferData;return!this.sourceBufferCount&&r&&r.mediaSource===t?er(n,r.tracks):this.sourceBuffers.forEach(s=>{const[o]=s;o&&(n[o]=er({},this.tracks[o]),this.removeBuffer(o)),s[0]=s[1]=null}),{media:e,mediaSource:t,tracks:n}}initTracks(){const e={};this.sourceBuffers=[[null,null],[null,null]],this.tracks=e,this.resetQueue(),this.resetAppendErrors(),this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.lastVideoAppendEnd=0}onManifestLoading(){this.bufferCodecEventsTotal=0,this.details=null}onManifestParsed(e,t){var n;let r=2;(t.audio&&!t.video||!t.altAudio)&&(r=1),this.bufferCodecEventsTotal=r,this.log(`${r} bufferCodec event(s) expected.`),(n=this.transferData)!=null&&n.mediaSource&&this.sourceBufferCount&&r&&this.bufferCreated()}onMediaAttaching(e,t){const n=this.media=t.media;this.transferData=this.overrides=void 0;const r=Uf(this.appendSource);if(r){const s=!!t.mediaSource;(s||t.overrides)&&(this.transferData=t,this.overrides=t.overrides);const o=this.mediaSource=t.mediaSource||new r;if(this.assignMediaSource(o),s)this._objectUrl=n.src,this.attachTransferred();else{const a=this._objectUrl=self.URL.createObjectURL(o);if(this.appendSource)try{n.removeAttribute("src");const l=self.ManagedMediaSource;n.disableRemotePlayback=n.disableRemotePlayback||l&&o instanceof l,bk(n),F0e(n,a),n.load()}catch{n.src=a}else n.src=a}n.addEventListener("emptied",this._onMediaEmptied)}}assignMediaSource(e){var t,n;this.log(`${((t=this.transferData)==null?void 0:t.mediaSource)===e?"transferred":"created"} media source: ${(n=e.constructor)==null?void 0:n.name}`),e.addEventListener("sourceopen",this._onMediaSourceOpen),e.addEventListener("sourceended",this._onMediaSourceEnded),e.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(e.addEventListener("startstreaming",this._onStartStreaming),e.addEventListener("endstreaming",this._onEndStreaming))}attachTransferred(){const e=this.media,t=this.transferData;if(!t||!e)return;const n=this.tracks,r=t.tracks,s=r?Object.keys(r):null,o=s?s.length:0,a=()=>{Promise.resolve().then(()=>{this.media&&this.mediaSourceOpenOrEnded&&this._onMediaSourceOpen()})};if(r&&s&&o){if(!this.tracksReady){this.hls.config.startFragPrefetch=!0,this.log("attachTransferred: waiting for SourceBuffer track info");return}if(this.log(`attachTransferred: (bufferCodecEventsTotal ${this.bufferCodecEventsTotal})
required tracks: ${lr(n,(l,c)=>l==="initSegment"?void 0:c)};
transfer tracks: ${lr(r,(l,c)=>l==="initSegment"?void 0:c)}}`),!bQ(r,n)){t.mediaSource=null,t.tracks=void 0;const l=e.currentTime,c=this.details,u=Math.max(l,(c==null?void 0:c.fragments[0].start)||0);if(u-l>1){this.log(`attachTransferred: waiting for playback to reach new tracks start time ${l} -> ${u}`);return}this.warn(`attachTransferred: resetting MediaSource for incompatible tracks ("${Object.keys(r)}"->"${Object.keys(n)}") start time: ${u} currentTime: ${l}`),this.onMediaDetaching(ae.MEDIA_DETACHING,{}),this.onMediaAttaching(ae.MEDIA_ATTACHING,t),e.currentTime=u;return}this.transferData=void 0,s.forEach(l=>{const c=l,u=r[c];if(u){const h=u.buffer;if(h){const f=this.fragmentTracker,d=u.id;if(f.hasFragments(d)||f.hasParts(d)){const g=Wn.getBuffered(h);f.detectEvictedFragments(c,g,d,null,!0)}const m=Vb(c),y=[c,h];this.sourceBuffers[m]=y,h.updating&&this.operationQueue&&this.operationQueue.prependBlocker(c),this.trackSourceBuffer(c,u)}}}),a(),this.bufferCreated()}else this.log("attachTransferred: MediaSource w/o SourceBuffers"),a()}get mediaSourceOpenOrEnded(){var e;const t=(e=this.mediaSource)==null?void 0:e.readyState;return t==="open"||t==="ended"}onMediaDetaching(e,t){const n=!!t.transferMedia;this.transferData=this.overrides=void 0;const{media:r,mediaSource:s,_objectUrl:o}=this;if(s){if(this.log(`media source ${n?"transferring":"detaching"}`),n)this.sourceBuffers.forEach(([a])=>{a&&this.removeBuffer(a)}),this.resetQueue();else{if(this.mediaSourceOpenOrEnded){const a=s.readyState==="open";try{const l=s.sourceBuffers;for(let c=l.length;c--;)a&&l[c].abort(),s.removeSourceBuffer(l[c]);a&&s.endOfStream()}catch(l){this.warn(`onMediaDetaching: ${l.message} while calling endOfStream`)}}this.sourceBufferCount&&this.onBufferReset()}s.removeEventListener("sourceopen",this._onMediaSourceOpen),s.removeEventListener("sourceended",this._onMediaSourceEnded),s.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(s.removeEventListener("startstreaming",this._onStartStreaming),s.removeEventListener("endstreaming",this._onEndStreaming)),this.mediaSource=null,this._objectUrl=null}r&&(r.removeEventListener("emptied",this._onMediaEmptied),n||(o&&self.URL.revokeObjectURL(o),this.mediaSrc===o?(r.removeAttribute("src"),this.appendSource&&bk(r),r.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.media=null),this.hls.trigger(ae.MEDIA_DETACHED,t)}onBufferReset(){this.sourceBuffers.forEach(([e])=>{e&&this.resetBuffer(e)}),this.initTracks()}resetBuffer(e){var t;const n=(t=this.tracks[e])==null?void 0:t.buffer;if(this.removeBuffer(e),n)try{var r;(r=this.mediaSource)!=null&&r.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(n)}catch(s){this.warn(`onBufferReset ${e}`,s)}delete this.tracks[e]}removeBuffer(e){this.removeBufferListeners(e),this.sourceBuffers[Vb(e)]=[null,null];const t=this.tracks[e];t&&(t.buffer=void 0)}resetQueue(){this.operationQueue&&this.operationQueue.destroy(),this.operationQueue=new D0e(this.tracks)}onBufferCodecs(e,t){var n;const r=this.tracks,s=Object.keys(t);this.log(`BUFFER_CODECS: "${s}" (current SB count ${this.sourceBufferCount})`);const o="audiovideo"in t&&(r.audio||r.video)||r.audiovideo&&("audio"in t||"video"in t),a=!o&&this.sourceBufferCount&&this.media&&s.some(l=>!r[l]);if(o||a){this.warn(`Unsupported transition between "${Object.keys(r)}" and "${s}" SourceBuffers`);return}s.forEach(l=>{var c,u;const h=t[l],{id:f,codec:d,levelCodec:m,container:y,metadata:g,supplemental:A}=h;let E=r[l];const x=(c=this.transferData)==null||(c=c.tracks)==null?void 0:c[l],w=x!=null&&x.buffer?x:E,T=(w==null?void 0:w.pendingCodec)||(w==null?void 0:w.codec),I=w==null?void 0:w.levelCodec;E||(E=r[l]={buffer:void 0,listeners:[],codec:d,supplemental:A,container:y,levelCodec:m,metadata:g,id:f});const M=nS(T,I),L=M==null?void 0:M.replace(Tk,"$1");let P=nS(d,m);const R=(u=P)==null?void 0:u.replace(Tk,"$1");P&&M&&L!==R&&(l.slice(0,5)==="audio"&&(P=VS(P,this.appendSource)),this.log(`switching codec ${T} to ${P}`),P!==(E.pendingCodec||E.codec)&&(E.pendingCodec=P),E.container=y,this.appendChangeType(l,y,P))}),(this.tracksReady||this.sourceBufferCount)&&(t.tracks=this.sourceBufferTracks),!this.sourceBufferCount&&(this.bufferCodecEventsTotal>1&&!this.tracks.video&&!t.video&&((n=t.audio)==null?void 0:n.id)==="main"&&(this.log("Main audio-only"),this.bufferCodecEventsTotal=1),this.mediaSourceOpenOrEnded&&this.checkPendingTracks())}get sourceBufferTracks(){return Object.keys(this.tracks).reduce((e,t)=>{const n=this.tracks[t];return e[t]={id:n.id,container:n.container,codec:n.codec,levelCodec:n.levelCodec},e},{})}appendChangeType(e,t,n){const r=`${t};codecs=${n}`,s={label:`change-type=${r}`,execute:()=>{const o=this.tracks[e];if(o){const a=o.buffer;a!=null&&a.changeType&&(this.log(`changing ${e} sourceBuffer type to ${r}`),a.changeType(r),o.codec=n,o.container=t)}this.shiftAndExecuteNext(e)},onStart:()=>{},onComplete:()=>{},onError:o=>{this.warn(`Failed to change ${e} SourceBuffer type`,o)}};this.append(s,e,this.isPending(this.tracks[e]))}blockAudio(e){var t;const n=e.start,r=n+e.duration*.05;if(((t=this.fragmentTracker.getAppendedFrag(n,$t.MAIN))==null?void 0:t.gap)===!0)return;const o={label:"block-audio",execute:()=>{var a;const l=this.tracks.video;(this.lastVideoAppendEnd>r||l!=null&&l.buffer&&Wn.isBuffered(l.buffer,r)||((a=this.fragmentTracker.getAppendedFrag(r,$t.MAIN))==null?void 0:a.gap)===!0)&&(this.blockedAudioAppend=null,this.shiftAndExecuteNext("audio"))},onStart:()=>{},onComplete:()=>{},onError:a=>{this.warn("Error executing block-audio operation",a)}};this.blockedAudioAppend={op:o,frag:e},this.append(o,"audio",!0)}unblockAudio(){const{blockedAudioAppend:e,operationQueue:t}=this;e&&t&&(this.blockedAudioAppend=null,t.unblockAudio(e.op))}onBufferAppending(e,t){const{tracks:n}=this,{data:r,type:s,parent:o,frag:a,part:l,chunkMeta:c,offset:u}=t,h=c.buffering[s],{sn:f,cc:d}=a,m=self.performance.now();h.start=m;const y=a.stats.buffering,g=l?l.stats.buffering:null;y.start===0&&(y.start=m),g&&g.start===0&&(g.start=m);const A=n.audio;let E=!1;s==="audio"&&(A==null?void 0:A.container)==="audio/mpeg"&&(E=!this.lastMpegAudioChunk||c.id===1||this.lastMpegAudioChunk.sn!==c.sn,this.lastMpegAudioChunk=c);const x=n.video,w=x==null?void 0:x.buffer;if(w&&f!=="initSegment"){const M=l||a,L=this.blockedAudioAppend;if(s==="audio"&&o!=="main"&&!this.blockedAudioAppend&&!(x.ending||x.ended)){const R=M.start+M.duration*.05,U=w.buffered,k=this.currentOp("video");!U.length&&!k?this.blockAudio(M):!k&&!Wn.isBuffered(w,R)&&this.lastVideoAppendEnd<R&&this.blockAudio(M)}else if(s==="video"){const P=M.end;if(L){const R=L.frag.start;(P>R||P<this.lastVideoAppendEnd||Wn.isBuffered(w,R))&&this.unblockAudio()}this.lastVideoAppendEnd=P}}const T=(l||a).start,I={label:`append-${s}`,execute:()=>{var M;h.executeStart=self.performance.now();const L=(M=this.tracks[s])==null?void 0:M.buffer;L&&(E?this.updateTimestampOffset(L,T,.1,s,f,d):u!==void 0&&jt(u)&&this.updateTimestampOffset(L,u,1e-6,s,f,d)),this.appendExecutor(r,s)},onStart:()=>{},onComplete:()=>{const M=self.performance.now();h.executeEnd=h.end=M,y.first===0&&(y.first=M),g&&g.first===0&&(g.first=M);const L={};this.sourceBuffers.forEach(([P,R])=>{P&&(L[P]=Wn.getBuffered(R))}),this.appendErrors[s]=0,s==="audio"||s==="video"?this.appendErrors.audiovideo=0:(this.appendErrors.audio=0,this.appendErrors.video=0),this.hls.trigger(ae.BUFFER_APPENDED,{type:s,frag:a,part:l,chunkMeta:c,parent:a.type,timeRanges:L})},onError:M=>{var L;const P={type:rn.MEDIA_ERROR,parent:a.type,details:Ke.BUFFER_APPEND_ERROR,sourceBufferName:s,frag:a,part:l,chunkMeta:c,error:M,err:M,fatal:!1},R=(L=this.media)==null?void 0:L.error;if(M.code===DOMException.QUOTA_EXCEEDED_ERR||M.name=="QuotaExceededError"||"quota"in M)P.details=Ke.BUFFER_FULL_ERROR;else if(M.code===DOMException.INVALID_STATE_ERR&&this.mediaSourceOpenOrEnded&&!R)P.errorAction=Y1(!0);else if(M.name===DV&&this.sourceBufferCount===0)P.errorAction=Y1(!0);else{const U=++this.appendErrors[s];this.warn(`Failed ${U}/${this.hls.config.appendErrorMaxRetry} times to append segment in "${s}" sourceBuffer (${R||"no media error"})`),(U>=this.hls.config.appendErrorMaxRetry||R)&&(P.fatal=!0)}this.hls.trigger(ae.ERROR,P)}};this.log(`queuing "${s}" append sn: ${f}${l?" p: "+l.index:""} of ${a.type===$t.MAIN?"level":"track"} ${a.level} cc: ${d}`),this.append(I,s,this.isPending(this.tracks[s]))}getFlushOp(e,t,n){return this.log(`queuing "${e}" remove ${t}-${n}`),{label:"remove",execute:()=>{this.removeExecutor(e,t,n)},onStart:()=>{},onComplete:()=>{this.hls.trigger(ae.BUFFER_FLUSHED,{type:e})},onError:r=>{this.warn(`Failed to remove ${t}-${n} from "${e}" SourceBuffer`,r)}}}onBufferFlushing(e,t){const{type:n,startOffset:r,endOffset:s}=t;n?this.append(this.getFlushOp(n,r,s),n):this.sourceBuffers.forEach(([o])=>{o&&this.append(this.getFlushOp(o,r,s),o)})}onFragParsed(e,t){const{frag:n,part:r}=t,s=[],o=r?r.elementaryStreams:n.elementaryStreams;o[ar.AUDIOVIDEO]?s.push("audiovideo"):(o[ar.AUDIO]&&s.push("audio"),o[ar.VIDEO]&&s.push("video"));const a=()=>{const l=self.performance.now();n.stats.buffering.end=l,r&&(r.stats.buffering.end=l);const c=r?r.stats:n.stats;this.hls.trigger(ae.FRAG_BUFFERED,{frag:n,part:r,stats:c,id:n.type})};s.length===0&&this.warn(`Fragments must have at least one ElementaryStreamType set. type: ${n.type} level: ${n.level} sn: ${n.sn}`),this.blockBuffers(a,s).catch(l=>{this.warn(`Fragment buffered callback ${l}`),this.stepOperationQueue(this.sourceBufferTypes)})}onFragChanged(e,t){this.trimBuffers()}get bufferedToEnd(){return this.sourceBufferCount>0&&!this.sourceBuffers.some(([e])=>{if(e){const t=this.tracks[e];if(t)return!t.ended||t.ending}return!1})}onBufferEos(e,t){var n;this.sourceBuffers.forEach(([o])=>{if(o){const a=this.tracks[o];(!t.type||t.type===o)&&(a.ending=!0,a.ended||(a.ended=!0,this.log(`${o} buffer reached EOS`)))}});const r=((n=this.overrides)==null?void 0:n.endOfStream)!==!1;this.sourceBufferCount>0&&!this.sourceBuffers.some(([o])=>{var a;return o&&!((a=this.tracks[o])!=null&&a.ended)})?r?(this.log("Queueing EOS"),this.blockUntilOpen(()=>{this.tracksEnded();const{mediaSource:o}=this;if(!o||o.readyState!=="open"){o&&this.log(`Could not call mediaSource.endOfStream(). mediaSource.readyState: ${o.readyState}`);return}this.log("Calling mediaSource.endOfStream()"),o.endOfStream(),this.hls.trigger(ae.BUFFERED_TO_END,void 0)})):(this.tracksEnded(),this.hls.trigger(ae.BUFFERED_TO_END,void 0)):t.type==="video"&&this.unblockAudio()}tracksEnded(){this.sourceBuffers.forEach(([e])=>{if(e!==null){const t=this.tracks[e];t&&(t.ending=!1)}})}onLevelUpdated(e,{details:t}){t.fragments.length&&(this.details=t,this.updateDuration())}updateDuration(){this.blockUntilOpen(()=>{const e=this.getDurationAndRange();e&&this.updateMediaSource(e)})}onError(e,t){if(t.details===Ke.BUFFER_APPEND_ERROR&&t.frag){var n;const r=(n=t.errorAction)==null?void 0:n.nextAutoLevel;jt(r)&&r!==t.frag.level&&this.resetAppendErrors()}}resetAppendErrors(){this.appendErrors={audio:0,video:0,audiovideo:0}}trimBuffers(){const{hls:e,details:t,media:n}=this;if(!n||t===null||!this.sourceBufferCount)return;const r=e.config,s=n.currentTime,o=t.levelTargetDuration,a=t.live&&r.liveBackBufferLength!==null?r.liveBackBufferLength:r.backBufferLength;if(jt(a)&&a>=0){const c=Math.max(a,o),u=Math.floor(s/o)*o-c;this.flushBackBuffer(s,o,u)}const l=r.frontBufferFlushThreshold;if(jt(l)&&l>0){const c=Math.max(r.maxBufferLength,l),u=Math.max(c,o),h=Math.floor(s/o)*o+u;this.flushFrontBuffer(s,o,h)}}flushBackBuffer(e,t,n){this.sourceBuffers.forEach(([r,s])=>{if(s){const a=Wn.getBuffered(s);if(a.length>0&&n>a.start(0)){var o;this.hls.trigger(ae.BACK_BUFFER_REACHED,{bufferEnd:n});const l=this.tracks[r];if((o=this.details)!=null&&o.live)this.hls.trigger(ae.LIVE_BACK_BUFFER_REACHED,{bufferEnd:n});else if(l!=null&&l.ended){this.log(`Cannot flush ${r} back buffer while SourceBuffer is in ended state`);return}this.hls.trigger(ae.BUFFER_FLUSHING,{startOffset:0,endOffset:n,type:r})}}})}flushFrontBuffer(e,t,n){this.sourceBuffers.forEach(([r,s])=>{if(s){const o=Wn.getBuffered(s),a=o.length;if(a<2)return;const l=o.start(a-1),c=o.end(a-1);if(n>l||e>=l&&e<=c)return;this.hls.trigger(ae.BUFFER_FLUSHING,{startOffset:l,endOffset:1/0,type:r})}})}getDurationAndRange(){var e;const{details:t,mediaSource:n}=this;if(!t||!this.media||(n==null?void 0:n.readyState)!=="open")return null;const r=t.edge;if(t.live&&this.hls.config.liveDurationInfinity){if(t.fragments.length&&n.setLiveSeekableRange){const c=Math.max(0,t.fragmentStart),u=Math.max(c,r);return{duration:1/0,start:c,end:u}}return{duration:1/0}}const s=(e=this.overrides)==null?void 0:e.duration;if(s)return jt(s)?{duration:s}:null;const o=this.media.duration,a=jt(n.duration)?n.duration:0;return r>a&&r>o||!jt(o)?{duration:r}:null}updateMediaSource({duration:e,start:t,end:n}){const r=this.mediaSource;!this.media||!r||r.readyState!=="open"||(r.duration!==e&&(jt(e)&&this.log(`Updating MediaSource duration to ${e.toFixed(3)}`),r.duration=e),t!==void 0&&n!==void 0&&(this.log(`MediaSource duration is set to ${r.duration}. Setting seekable range to ${t}-${n}.`),r.setLiveSeekableRange(t,n)))}get tracksReady(){const e=this.pendingTrackCount;return e>0&&(e>=this.bufferCodecEventsTotal||this.isPending(this.tracks.audiovideo))}checkPendingTracks(){const{bufferCodecEventsTotal:e,pendingTrackCount:t,tracks:n}=this;if(this.log(`checkPendingTracks (pending: ${t} codec events expected: ${e}) ${lr(n)}`),this.tracksReady){var r;const s=(r=this.transferData)==null?void 0:r.tracks;s&&Object.keys(s).length?this.attachTransferred():this.createSourceBuffers()}}bufferCreated(){if(this.sourceBufferCount){const e={};this.sourceBuffers.forEach(([t,n])=>{if(t){const r=this.tracks[t];e[t]={buffer:n,container:r.container,codec:r.codec,supplemental:r.supplemental,levelCodec:r.levelCodec,id:r.id,metadata:r.metadata}}}),this.hls.trigger(ae.BUFFER_CREATED,{tracks:e}),this.log(`SourceBuffers created. Running queue: ${this.operationQueue}`),this.sourceBuffers.forEach(([t])=>{this.executeNext(t)})}else{const e=new Error("could not create source buffer for media codec(s)");this.hls.trigger(ae.ERROR,{type:rn.MEDIA_ERROR,details:Ke.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:e,reason:e.message})}}createSourceBuffers(){const{tracks:e,sourceBuffers:t,mediaSource:n}=this;if(!n)throw new Error("createSourceBuffers called when mediaSource was null");for(const s in e){const o=s,a=e[o];if(this.isPending(a)){const l=this.getTrackCodec(a,o),c=`${a.container};codecs=${l}`;a.codec=l,this.log(`creating sourceBuffer(${c})${this.currentOp(o)?" Queued":""} ${lr(a)}`);try{const u=n.addSourceBuffer(c),h=Vb(o),f=[o,u];t[h]=f,a.buffer=u}catch(u){var r;this.error(`error while trying to add sourceBuffer: ${u.message}`),this.shiftAndExecuteNext(o),(r=this.operationQueue)==null||r.removeBlockers(),delete this.tracks[o],this.hls.trigger(ae.ERROR,{type:rn.MEDIA_ERROR,details:Ke.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:u,sourceBufferName:o,mimeType:c,parent:a.id});return}this.trackSourceBuffer(o,a)}}this.bufferCreated()}getTrackCodec(e,t){const n=e.supplemental;let r=e.codec;n&&(t==="video"||t==="audiovideo")&&j2(n,"video")&&(r=Ppe(r,n));const s=nS(r,e.levelCodec);return s?t.slice(0,5)==="audio"?VS(s,this.appendSource):s:""}trackSourceBuffer(e,t){const n=t.buffer;if(!n)return;const r=this.getTrackCodec(t,e);this.tracks[e]={buffer:n,codec:r,container:t.container,levelCodec:t.levelCodec,supplemental:t.supplemental,metadata:t.metadata,id:t.id,listeners:[]},this.removeBufferListeners(e),this.addBufferListener(e,"updatestart",this.onSBUpdateStart),this.addBufferListener(e,"updateend",this.onSBUpdateEnd),this.addBufferListener(e,"error",this.onSBUpdateError),this.appendSource&&this.addBufferListener(e,"bufferedchange",(s,o)=>{const a=o.removedRanges;a!=null&&a.length&&this.hls.trigger(ae.BUFFER_FLUSHED,{type:s})})}get mediaSrc(){var e,t;const n=((e=this.media)==null||(t=e.querySelector)==null?void 0:t.call(e,"source"))||this.media;return n==null?void 0:n.src}onSBUpdateStart(e){const t=this.currentOp(e);t&&t.onStart()}onSBUpdateEnd(e){var t;if(((t=this.mediaSource)==null?void 0:t.readyState)==="closed"){this.resetBuffer(e);return}const n=this.currentOp(e);n&&(n.onComplete(),this.shiftAndExecuteNext(e))}onSBUpdateError(e,t){var n;const r=new Error(`${e} SourceBuffer error. MediaSource readyState: ${(n=this.mediaSource)==null?void 0:n.readyState}`);this.error(`${r}`,t),this.hls.trigger(ae.ERROR,{type:rn.MEDIA_ERROR,details:Ke.BUFFER_APPENDING_ERROR,sourceBufferName:e,error:r,fatal:!1});const s=this.currentOp(e);s&&s.onError(r)}updateTimestampOffset(e,t,n,r,s,o){const a=t-e.timestampOffset;Math.abs(a)>=n&&(this.log(`Updating ${r} SourceBuffer timestampOffset to ${t} (sn: ${s} cc: ${o})`),e.timestampOffset=t)}removeExecutor(e,t,n){const{media:r,mediaSource:s}=this,o=this.tracks[e],a=o==null?void 0:o.buffer;if(!r||!s||!a){this.warn(`Attempting to remove from the ${e} SourceBuffer, but it does not exist`),this.shiftAndExecuteNext(e);return}const l=jt(r.duration)?r.duration:1/0,c=jt(s.duration)?s.duration:1/0,u=Math.max(0,t),h=Math.min(n,l,c);h>u&&(!o.ending||o.ended)?(o.ended=!1,this.log(`Removing [${u},${h}] from the ${e} SourceBuffer`),a.remove(u,h)):this.shiftAndExecuteNext(e)}appendExecutor(e,t){const n=this.tracks[t],r=n==null?void 0:n.buffer;if(!r)throw new k0e(`Attempting to append to the ${t} SourceBuffer, but it does not exist`);n.ending=!1,n.ended=!1,r.appendBuffer(e)}blockUntilOpen(e){if(this.isUpdating()||this.isQueued())this.blockBuffers(e).catch(t=>{this.warn(`SourceBuffer blocked callback ${t}`),this.stepOperationQueue(this.sourceBufferTypes)});else try{e()}catch(t){this.warn(`Callback run without blocking ${this.operationQueue} ${t}`)}}isUpdating(){return this.sourceBuffers.some(([e,t])=>e&&t.updating)}isQueued(){return this.sourceBuffers.some(([e])=>e&&!!this.currentOp(e))}isPending(e){return!!e&&!e.buffer}blockBuffers(e,t=this.sourceBufferTypes){if(!t.length)return this.log("Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(e);const{operationQueue:n}=this,r=t.map(o=>this.appendBlocker(o));return t.length>1&&!!this.blockedAudioAppend&&this.unblockAudio(),Promise.all(r).then(o=>{n===this.operationQueue&&(e(),this.stepOperationQueue(this.sourceBufferTypes))})}stepOperationQueue(e){e.forEach(t=>{var n;const r=(n=this.tracks[t])==null?void 0:n.buffer;!r||r.updating||this.shiftAndExecuteNext(t)})}append(e,t,n){this.operationQueue&&this.operationQueue.append(e,t,n)}appendBlocker(e){if(this.operationQueue)return this.operationQueue.appendBlocker(e)}currentOp(e){return this.operationQueue?this.operationQueue.current(e):null}executeNext(e){e&&this.operationQueue&&this.operationQueue.executeNext(e)}shiftAndExecuteNext(e){this.operationQueue&&this.operationQueue.shiftAndExecuteNext(e)}get pendingTrackCount(){return Object.keys(this.tracks).reduce((e,t)=>e+(this.isPending(this.tracks[t])?1:0),0)}get sourceBufferCount(){return this.sourceBuffers.reduce((e,[t])=>e+(t?1:0),0)}get sourceBufferTypes(){return this.sourceBuffers.map(([e])=>e).filter(e=>!!e)}addBufferListener(e,t,n){const r=this.tracks[e];if(!r)return;const s=r.buffer;if(!s)return;const o=n.bind(this,e);r.listeners.push({event:t,listener:o}),s.addEventListener(t,o)}removeBufferListeners(e){const t=this.tracks[e];if(!t)return;const n=t.buffer;n&&(t.listeners.forEach(r=>{n.removeEventListener(r.event,r.listener)}),t.listeners.length=0)}}function bk(i){const e=i.querySelectorAll("source");[].slice.call(e).forEach(t=>{i.removeChild(t)})}function F0e(i,e){const t=self.document.createElement("source");t.type="video/mp4",t.src=e,i.appendChild(t)}function Vb(i){return i==="audio"?1:0}class w4{constructor(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(e){this.streamController=e}destroy(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:e}=this;e.on(ae.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(ae.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(ae.MANIFEST_PARSED,this.onManifestParsed,this),e.on(ae.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(ae.BUFFER_CODECS,this.onBufferCodecs,this),e.on(ae.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:e}=this;e.off(ae.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(ae.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(ae.MANIFEST_PARSED,this.onManifestParsed,this),e.off(ae.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(ae.BUFFER_CODECS,this.onBufferCodecs,this),e.off(ae.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(e,t){const n=this.hls.levels[t.droppedLevel];this.isLevelAllowed(n)&&this.restrictedLevels.push({bitrate:n.bitrate,height:n.height,width:n.width})}onMediaAttaching(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()}onManifestParsed(e,t){const n=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,n.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onLevelsUpdated(e,t){this.timer&&jt(this.autoLevelCapping)&&this.detectPlayerSize()}onBufferCodecs(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onMediaDetaching(){this.stopCapping(),this.media=null}detectPlayerSize(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0){this.clientRect=null;return}const e=this.hls.levels;if(e.length){const t=this.hls,n=this.getMaxLevel(e.length-1);n!==this.autoLevelCapping&&t.logger.log(`Setting autoLevelCapping to ${n}: ${e[n].height}p@${e[n].bitrate} for media ${this.mediaWidth}x${this.mediaHeight}`),t.autoLevelCapping=n,t.autoLevelEnabled&&t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}getMaxLevel(e){const t=this.hls.levels;if(!t.length)return-1;const n=t.filter((r,s)=>this.isLevelAllowed(r)&&s<=e);return this.clientRect=null,w4.getMaxLevelByMediaSize(n,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const e=this.media,t={width:0,height:0};if(e){const n=e.getBoundingClientRect();t.width=n.width,t.height=n.height,!t.width&&!t.height&&(t.width=n.right-n.left||e.width||0,t.height=n.bottom-n.top||e.height||0)}return this.clientRect=t,t}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch{}return Math.min(e,this.hls.config.maxDevicePixelRatio)}isLevelAllowed(e){return!this.restrictedLevels.some(n=>e.bitrate===n.bitrate&&e.width===n.width&&e.height===n.height)}static getMaxLevelByMediaSize(e,t,n){if(!(e!=null&&e.length))return-1;const r=(a,l)=>l?a.width!==l.width||a.height!==l.height:!0;let s=e.length-1;const o=Math.max(t,n);for(let a=0;a<e.length;a+=1){const l=e[a];if((l.width>=o||l.height>=o)&&r(l,e[a+1])){s=a;break}}return s}}const O0e={MANIFEST:"m",AUDIO:"a",VIDEO:"v",MUXED:"av",INIT:"i",CAPTION:"c",TIMED_TEXT:"tt",KEY:"k",OTHER:"o"},Ga=O0e,N0e={HLS:"h"},U0e=N0e;class Eh{constructor(e,t){Array.isArray(e)&&(e=e.map(n=>n instanceof Eh?n:new Eh(n))),this.value=e,this.params=t}}const z0e="Dict";function G0e(i){return Array.isArray(i)?JSON.stringify(i):i instanceof Map?"Map{}":i instanceof Set?"Set{}":typeof i=="object"?JSON.stringify(i):String(i)}function H0e(i,e,t,n){return new Error(`failed to ${i} "${G0e(e)}" as ${t}`,{cause:n})}function _h(i,e,t){return H0e("serialize",i,e,t)}class FV{constructor(e){this.description=e}}const Ik="Bare Item",Q0e="Boolean";function V0e(i){if(typeof i!="boolean")throw _h(i,Q0e);return i?"?1":"?0"}function j0e(i){return btoa(String.fromCharCode(...i))}const W0e="Byte Sequence";function K0e(i){if(ArrayBuffer.isView(i)===!1)throw _h(i,W0e);return`:${j0e(i)}:`}const Y0e="Integer";function $0e(i){return i<-999999999999999||999999999999999<i}function OV(i){if($0e(i))throw _h(i,Y0e);return i.toString()}function X0e(i){return`@${OV(i.getTime()/1e3)}`}function NV(i,e){if(i<0)return-NV(-i,e);const t=Math.pow(10,e);if(Math.abs(i*t%1-.5)<Number.EPSILON){const r=Math.floor(i*t);return(r%2===0?r:r+1)/t}else return Math.round(i*t)/t}const q0e="Decimal";function J0e(i){const e=NV(i,3);if(Math.floor(Math.abs(e)).toString().length>12)throw _h(i,q0e);const t=e.toString();return t.includes(".")?t:`${t}.0`}const Z0e="String",ege=/[\x00-\x1f\x7f]+/;function tge(i){if(ege.test(i))throw _h(i,Z0e);return`"${i.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`}function nge(i){return i.description||i.toString().slice(7,-1)}const ige="Token";function Mk(i){const e=nge(i);if(/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(e)===!1)throw _h(e,ige);return e}function R5(i){switch(typeof i){case"number":if(!jt(i))throw _h(i,Ik);return Number.isInteger(i)?OV(i):J0e(i);case"string":return tge(i);case"symbol":return Mk(i);case"boolean":return V0e(i);case"object":if(i instanceof Date)return X0e(i);if(i instanceof Uint8Array)return K0e(i);if(i instanceof FV)return Mk(i);default:throw _h(i,Ik)}}const rge="Key";function P5(i){if(/^[a-z*][a-z0-9\-_.*]*$/.test(i)===!1)throw _h(i,rge);return i}function t8(i){return i==null?"":Object.entries(i).map(([e,t])=>t===!0?`;${P5(e)}`:`;${P5(e)}=${R5(t)}`).join("")}function UV(i){return i instanceof Eh?`${R5(i.value)}${t8(i.params)}`:R5(i)}function sge(i){return`(${i.value.map(UV).join(" ")})${t8(i.params)}`}function oge(i,e={whitespace:!0}){if(typeof i!="object"||i==null)throw _h(i,z0e);const t=i instanceof Map?i.entries():Object.entries(i),n=e!=null&&e.whitespace?" ":"";return Array.from(t).map(([r,s])=>{s instanceof Eh||(s=new Eh(s));let o=P5(r);return s.value===!0?o+=t8(s.params):(o+="=",Array.isArray(s.value)?o+=sge(s):o+=UV(s)),o}).join(`,${n}`)}function zV(i,e){return oge(i,e)}const sh="CMCD-Object",ts="CMCD-Request",vm="CMCD-Session",Pd="CMCD-Status",age={br:sh,ab:sh,d:sh,ot:sh,tb:sh,tpb:sh,lb:sh,tab:sh,lab:sh,url:sh,pb:ts,bl:ts,tbl:ts,dl:ts,ltc:ts,mtp:ts,nor:ts,nrr:ts,rc:ts,sn:ts,sta:ts,su:ts,ttfb:ts,ttfbb:ts,ttlb:ts,cmsdd:ts,cmsds:ts,smrt:ts,df:ts,cs:ts,ts,cid:vm,pr:vm,sf:vm,sid:vm,st:vm,v:vm,msd:vm,bs:Pd,bsd:Pd,cdn:Pd,rtp:Pd,bg:Pd,pt:Pd,ec:Pd,e:Pd},lge={REQUEST:ts};function cge(i){return Object.keys(i).reduce((e,t)=>{var n;return(n=i[t])===null||n===void 0||n.forEach(r=>e[r]=t),e},{})}function uge(i,e){const t={};if(!i)return t;const n=Object.keys(i),r=e?cge(e):{};return n.reduce((s,o)=>{var a;const l=age[o]||r[o]||lge.REQUEST,c=(a=s[l])!==null&&a!==void 0?a:s[l]={};return c[o]=i[o],s},t)}function hge(i){return["ot","sf","st","e","sta"].includes(i)}function fge(i){return typeof i=="number"?jt(i):i!=null&&i!==""&&i!==!1}const GV="event";function dge(i,e){const t=new URL(i),n=new URL(e);if(t.origin!==n.origin)return i;const r=t.pathname.split("/").slice(1),s=n.pathname.split("/").slice(1,-1);for(;r[0]===s[0];)r.shift(),s.shift();for(;s.length;)s.shift(),r.unshift("..");return r.join("/")+t.search+t.hash}const oS=i=>Math.round(i),L5=(i,e)=>Array.isArray(i)?i.map(t=>L5(t,e)):i instanceof Eh&&typeof i.value=="string"?new Eh(L5(i.value,e),i.params):(e.baseUrl&&(i=dge(i,e.baseUrl)),e.version===1?encodeURIComponent(i):i),t_=i=>oS(i/100)*100,pge=(i,e)=>{let t=i;return e.version>=2&&(i instanceof Eh&&typeof i.value=="string"?t=new Eh([i]):typeof i=="string"&&(t=[i])),L5(t,e)},mge={br:oS,d:oS,bl:t_,dl:t_,mtp:t_,nor:pge,rtp:t_,tb:oS},HV="request",QV="response",n8=["ab","bg","bl","br","bs","bsd","cdn","cid","cs","df","ec","lab","lb","ltc","msd","mtp","pb","pr","pt","sf","sid","sn","st","sta","tab","tb","tbl","tpb","ts","v"],gge=["e"],Age=/^[a-zA-Z0-9-.]+-[a-zA-Z0-9-.]+$/;function C4(i){return Age.test(i)}function yge(i){return n8.includes(i)||gge.includes(i)||C4(i)}const VV=["d","dl","nor","ot","rtp","su"];function vge(i){return n8.includes(i)||VV.includes(i)||C4(i)}const xge=["cmsdd","cmsds","rc","smrt","ttfb","ttfbb","ttlb","url"];function Ege(i){return n8.includes(i)||VV.includes(i)||xge.includes(i)||C4(i)}const _ge=["bl","br","bs","cid","d","dl","mtp","nor","nrr","ot","pr","rtp","sf","sid","st","su","tb","v"];function Sge(i){return _ge.includes(i)||C4(i)}const wge={[QV]:Ege,[GV]:yge,[HV]:vge};function jV(i,e={}){const t={};if(i==null||typeof i!="object")return t;const n=e.version||i.v||1,r=e.reportingMode||HV,s=n===1?Sge:wge[r];let o=Object.keys(i).filter(s);const a=e.filter;typeof a=="function"&&(o=o.filter(a));const l=r===QV||r===GV;l&&!o.includes("ts")&&o.push("ts"),n>1&&!o.includes("v")&&o.push("v");const c=er({},mge,e.formatters),u={version:n,reportingMode:r,baseUrl:e.baseUrl};return o.sort().forEach(h=>{let f=i[h];const d=c[h];if(typeof d=="function"&&(f=d(f,u)),h==="v"){if(n===1)return;f=n}h=="pr"&&f===1||(l&&h==="ts"&&!jt(f)&&(f=Date.now()),fge(f)&&(hge(h)&&typeof f=="string"&&(f=new FV(f)),t[h]=f))}),t}function Cge(i,e={}){const t={};if(!i)return t;const n=jV(i,e),r=uge(n,e==null?void 0:e.customHeaderMap);return Object.entries(r).reduce((s,[o,a])=>{const l=zV(a,{whitespace:!1});return l&&(s[o]=l),s},t)}function Tge(i,e,t){return er(i,Cge(e,t))}const bge="CMCD";function Ige(i,e={}){return i?zV(jV(i,e),{whitespace:!1}):""}function Mge(i,e={}){if(!i)return"";const t=Ige(i,e);return encodeURIComponent(t)}function Rge(i,e={}){if(!i)return"";const t=Mge(i,e);return`${bge}=${t}`}const Rk=/CMCD=[^&#]+/;function Pge(i,e,t){const n=Rge(e,t);if(!n)return i;if(Rk.test(i))return i.replace(Rk,n);const r=i.includes("?")?"&":"?";return`${i}${r}${n}`}class WV{constructor(e){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=r=>{try{this.apply(r,{ot:Ga.MANIFEST,su:!this.initialized})}catch(s){this.hls.logger.warn("Could not generate manifest CMCD data.",s)}},this.applyFragmentData=r=>{try{const{frag:s,part:o}=r,a=this.hls.levels[s.level],l=this.getObjectType(s),c={d:(o||s).duration*1e3,ot:l};(l===Ga.VIDEO||l===Ga.AUDIO||l==Ga.MUXED)&&(c.br=a.bitrate/1e3,c.tb=this.getTopBandwidth(l)/1e3,c.bl=this.getBufferLength(l));const u=o?this.getNextPart(o):this.getNextFrag(s);u!=null&&u.url&&u.url!==s.url&&(c.nor=u.url),this.apply(r,c)}catch(s){this.hls.logger.warn("Could not generate segment CMCD data.",s)}},this.hls=e;const t=this.config=e.config,{cmcd:n}=t;n!=null&&(t.pLoader=this.createPlaylistLoader(),t.fLoader=this.createFragmentLoader(),this.sid=n.sessionId||e.sessionId,this.cid=n.contentId,this.useHeaders=n.useHeaders===!0,this.includeKeys=n.includeKeys,this.registerListeners())}registerListeners(){const e=this.hls;e.on(ae.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(ae.MEDIA_DETACHED,this.onMediaDetached,this),e.on(ae.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const e=this.hls;e.off(ae.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(ae.MEDIA_DETACHED,this.onMediaDetached,this),e.off(ae.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=this.media=null}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(e,t){var n,r;this.audioBuffer=(n=t.tracks.audio)==null?void 0:n.buffer,this.videoBuffer=(r=t.tracks.video)==null?void 0:r.buffer}createData(){var e;return{v:1,sf:U0e.HLS,sid:this.sid,cid:this.cid,pr:(e=this.media)==null?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(e,t={}){er(t,this.createData());const n=t.ot===Ga.INIT||t.ot===Ga.VIDEO||t.ot===Ga.MUXED;this.starved&&n&&(t.bs=!0,t.su=!0,this.starved=!1),t.su==null&&(t.su=this.buffering);const{includeKeys:r}=this;r&&(t=Object.keys(t).reduce((o,a)=>(r.includes(a)&&(o[a]=t[a]),o),{}));const s={baseUrl:e.url};this.useHeaders?(e.headers||(e.headers={}),Tge(e.headers,t,s)):e.url=Pge(e.url,t,s)}getNextFrag(e){var t;const n=(t=this.hls.levels[e.level])==null?void 0:t.details;if(n){const r=e.sn-n.startSN;return n.fragments[r+1]}}getNextPart(e){var t;const{index:n,fragment:r}=e,s=(t=this.hls.levels[r.level])==null||(t=t.details)==null?void 0:t.partList;if(s){const{sn:o}=r;for(let a=s.length-1;a>=0;a--){const l=s[a];if(l.index===n&&l.fragment.sn===o)return s[a+1]}}}getObjectType(e){const{type:t}=e;if(t==="subtitle")return Ga.TIMED_TEXT;if(e.sn==="initSegment")return Ga.INIT;if(t==="audio")return Ga.AUDIO;if(t==="main")return this.hls.audioTracks.length?Ga.VIDEO:Ga.MUXED}getTopBandwidth(e){let t=0,n;const r=this.hls;if(e===Ga.AUDIO)n=r.audioTracks;else{const s=r.maxAutoLevel,o=s>-1?s+1:r.levels.length;n=r.levels.slice(0,o)}return n.forEach(s=>{s.bitrate>t&&(t=s.bitrate)}),t>0?t:NaN}getBufferLength(e){const t=this.media,n=e===Ga.AUDIO?this.audioBuffer:this.videoBuffer;return!n||!t?NaN:Wn.bufferInfo(n,t.currentTime,this.config.maxBufferHole).len*1e3}createPlaylistLoader(){const{pLoader:e}=this.config,t=this.applyPlaylistData,n=e||this.config.loader;return class{constructor(s){this.loader=void 0,this.loader=new n(s)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(s,o,a){t(s),this.loader.load(s,o,a)}}}createFragmentLoader(){const{fLoader:e}=this.config,t=this.applyFragmentData,n=e||this.config.loader;return class{constructor(s){this.loader=void 0,this.loader=new n(s)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(s,o,a){t(s),this.loader.load(s,o,a)}}}}const Lge=3e5;class KV extends _c{constructor(e){super("content-steering",e.logger),this.hls=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this._pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(ae.MANIFEST_LOADING,this.onManifestLoading,this),e.on(ae.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(ae.MANIFEST_PARSED,this.onManifestParsed,this),e.on(ae.ERROR,this.onError,this)}unregisterListeners(){const e=this.hls;e&&(e.off(ae.MANIFEST_LOADING,this.onManifestLoading,this),e.off(ae.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(ae.MANIFEST_PARSED,this.onManifestParsed,this),e.off(ae.ERROR,this.onError,this))}pathways(){return(this.levels||[]).reduce((e,t)=>(e.indexOf(t.pathwayId)===-1&&e.push(t.pathwayId),e),[])}get pathwayPriority(){return this._pathwayPriority}set pathwayPriority(e){this.updatePathwayPriority(e)}startLoad(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){const e=this.timeToLoad*1e3-(performance.now()-this.updated);if(e>0){this.scheduleRefresh(this.uri,e);return}}this.loadSteeringManifest(this.uri)}}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()}clearTimeout(){this.reloadTimer!==-1&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(e){const t=this.levels;t&&(this.levels=t.filter(n=>n!==e))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(e,t){const{contentSteering:n}=t;n!==null&&(this.pathwayId=n.pathwayId,this.uri=n.uri,this.started&&this.startLoad())}onManifestParsed(e,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks}onError(e,t){const{errorAction:n}=t;if((n==null?void 0:n.action)===Zs.SendAlternateToPenaltyBox&&n.flags===Ya.MoveAllAlternatesMatchingHost){const r=this.levels;let s=this._pathwayPriority,o=this.pathwayId;if(t.context){const{groupId:a,pathwayId:l,type:c}=t.context;a&&r?o=this.getPathwayForGroupId(a,c,o):l&&(o=l)}o in this.penalizedPathways||(this.penalizedPathways[o]=performance.now()),!s&&r&&(s=this.pathways()),s&&s.length>1&&(this.updatePathwayPriority(s),n.resolved=this.pathwayId!==o),t.details===Ke.BUFFER_APPEND_ERROR&&!t.fatal?n.resolved=!0:n.resolved||this.warn(`Could not resolve ${t.details} ("${t.error.message}") with content-steering for Pathway: ${o} levels: ${r&&r.length} priorities: ${lr(s)} penalized: ${lr(this.penalizedPathways)}`)}}filterParsedLevels(e){this.levels=e;let t=this.getLevelsForPathway(this.pathwayId);if(t.length===0){const n=e[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${n}"`),t=this.getLevelsForPathway(n),this.pathwayId=n}return t.length!==e.length&&this.log(`Found ${t.length}/${e.length} levels in Pathway "${this.pathwayId}"`),t}getLevelsForPathway(e){return this.levels===null?[]:this.levels.filter(t=>e===t.pathwayId)}updatePathwayPriority(e){this._pathwayPriority=e;let t;const n=this.penalizedPathways,r=performance.now();Object.keys(n).forEach(s=>{r-n[s]>Lge&&delete n[s]});for(let s=0;s<e.length;s++){const o=e[s];if(o in n)continue;if(o===this.pathwayId)return;const a=this.hls.nextLoadLevel,l=this.hls.levels[a];if(t=this.getLevelsForPathway(o),t.length>0){this.log(`Setting Pathway to "${o}"`),this.pathwayId=o,lV(t),this.hls.trigger(ae.LEVELS_UPDATED,{levels:t});const c=this.hls.levels[a];l&&c&&this.levels&&(c.attrs["STABLE-VARIANT-ID"]!==l.attrs["STABLE-VARIANT-ID"]&&c.bitrate!==l.bitrate&&this.log(`Unstable Pathways change from bitrate ${l.bitrate} to ${c.bitrate}`),this.hls.nextLoadLevel=a);break}}}getPathwayForGroupId(e,t,n){const r=this.getLevelsForPathway(n).concat(this.levels||[]);for(let s=0;s<r.length;s++)if(t===ai.AUDIO_TRACK&&r[s].hasAudioGroup(e)||t===ai.SUBTITLE_TRACK&&r[s].hasSubtitleGroup(e))return r[s].pathwayId;return n}clonePathways(e){const t=this.levels;if(!t)return;const n={},r={};e.forEach(s=>{const{ID:o,"BASE-ID":a,"URI-REPLACEMENT":l}=s;if(t.some(u=>u.pathwayId===o))return;const c=this.getLevelsForPathway(a).map(u=>{const h=new Br(u.attrs);h["PATHWAY-ID"]=o;const f=h.AUDIO&&`${h.AUDIO}_clone_${o}`,d=h.SUBTITLES&&`${h.SUBTITLES}_clone_${o}`;f&&(n[h.AUDIO]=f,h.AUDIO=f),d&&(r[h.SUBTITLES]=d,h.SUBTITLES=d);const m=YV(u.uri,h["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",l),y=new hA({attrs:h,audioCodec:u.audioCodec,bitrate:u.bitrate,height:u.height,name:u.name,url:m,videoCodec:u.videoCodec,width:u.width});if(u.audioGroups)for(let g=1;g<u.audioGroups.length;g++)y.addGroupId("audio",`${u.audioGroups[g]}_clone_${o}`);if(u.subtitleGroups)for(let g=1;g<u.subtitleGroups.length;g++)y.addGroupId("text",`${u.subtitleGroups[g]}_clone_${o}`);return y});t.push(...c),Pk(this.audioTracks,n,l,o),Pk(this.subtitleTracks,r,l,o)})}loadSteeringManifest(e){const t=this.hls.config,n=t.loader;this.loader&&this.loader.destroy(),this.loader=new n(t);let r;try{r=new self.URL(e)}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest URI: ${e}`);return}if(r.protocol!=="data:"){const u=(this.hls.bandwidthEstimate||t.abrEwmaDefaultEstimate)|0;r.searchParams.set("_HLS_pathway",this.pathwayId),r.searchParams.set("_HLS_throughput",""+u)}const s={responseType:"json",url:r.href},o=t.steeringManifestLoadPolicy.default,a=o.errorRetry||o.timeoutRetry||{},l={loadPolicy:o,timeout:o.maxLoadTimeMs,maxRetry:a.maxNumRetry||0,retryDelay:a.retryDelayMs||0,maxRetryDelay:a.maxRetryDelayMs||0},c={onSuccess:(u,h,f,d)=>{this.log(`Loaded steering manifest: "${r}"`);const m=u.data;if((m==null?void 0:m.VERSION)!==1){this.log(`Steering VERSION ${m.VERSION} not supported!`);return}this.updated=performance.now(),this.timeToLoad=m.TTL;const{"RELOAD-URI":y,"PATHWAY-CLONES":g,"PATHWAY-PRIORITY":A}=m;if(y)try{this.uri=new self.URL(y,r).href}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest RELOAD-URI: ${y}`);return}this.scheduleRefresh(this.uri||f.url),g&&this.clonePathways(g);const E={steeringManifest:m,url:r.toString()};this.hls.trigger(ae.STEERING_MANIFEST_LOADED,E),A&&this.updatePathwayPriority(A)},onError:(u,h,f,d)=>{if(this.log(`Error loading steering manifest: ${u.code} ${u.text} (${h.url})`),this.stopLoad(),u.code===410){this.enabled=!1,this.log(`Steering manifest ${h.url} no longer available`);return}let m=this.timeToLoad*1e3;if(u.code===429){const y=this.loader;if(typeof(y==null?void 0:y.getResponseHeader)=="function"){const g=y.getResponseHeader("Retry-After");g&&(m=parseFloat(g)*1e3)}this.log(`Steering manifest ${h.url} rate limited`);return}this.scheduleRefresh(this.uri||h.url,m)},onTimeout:(u,h,f)=>{this.log(`Timeout loading steering manifest (${h.url})`),this.scheduleRefresh(this.uri||h.url)}};this.log(`Requesting steering manifest: ${r}`),this.loader.load(s,l,c)}scheduleRefresh(e,t=this.timeToLoad*1e3){this.clearTimeout(),this.reloadTimer=self.setTimeout(()=>{var n;const r=(n=this.hls)==null?void 0:n.media;if(r&&!r.ended){this.loadSteeringManifest(e);return}this.scheduleRefresh(e,this.timeToLoad*1e3)},t)}}function Pk(i,e,t,n){i&&Object.keys(e).forEach(r=>{const s=i.filter(o=>o.groupId===r).map(o=>{const a=er({},o);return a.details=void 0,a.attrs=new Br(a.attrs),a.url=a.attrs.URI=YV(o.url,o.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",t),a.groupId=a.attrs["GROUP-ID"]=e[r],a.attrs["PATHWAY-ID"]=n,a});i.push(...s)})}function YV(i,e,t,n){const{HOST:r,PARAMS:s,[t]:o}=n;let a;e&&(a=o==null?void 0:o[e],a&&(i=a));const l=new self.URL(i);return r&&!a&&(l.host=r),s&&Object.keys(s).sort().forEach(c=>{c&&l.searchParams.set(c,s[c])}),l.href}class Wm extends _c{constructor(e){super("eme",e.logger),this.hls=void 0,this.config=void 0,this.media=null,this.mediaResolved=void 0,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.mediaKeys=null,this.setMediaKeysQueue=Wm.CDMCleanupPromise?[Wm.CDMCleanupPromise]:[],this.bannedKeyIds={},this.onMediaEncrypted=t=>{const{initDataType:n,initData:r}=t,s=`"${t.type}" event: init data type: "${n}"`;if(this.debug(s),r!==null){if(!this.keyFormatPromise){let o=Object.keys(this.keySystemAccessPromises);o.length||(o=Hv(this.config));const a=o.map(Fb).filter(l=>!!l);this.keyFormatPromise=this.getKeyFormatPromise(a)}this.keyFormatPromise.then(o=>{const a=iS(o);if(n!=="sinf"||a!==Dr.FAIRPLAY){this.log(`Ignoring "${t.type}" event with init data type: "${n}" for selected key-system ${a}`);return}let l;try{const d=Js(new Uint8Array(r)),m=WR(JSON.parse(d).sinf),y=FQ(m);if(!y)throw new Error("'schm' box missing or not cbcs/cenc with schi > tenc");l=new Uint8Array(y.subarray(8,24))}catch(d){this.warn(`${s} Failed to parse sinf: ${d}`);return}const c=Oo(l),{keyIdToKeySessionPromise:u,mediaKeySessions:h}=this;let f=u[c];for(let d=0;d<h.length;d++){const m=h[d],y=m.decryptdata;if(!y.keyId)continue;const g=Oo(y.keyId);if($S(l,y.keyId)||y.uri.replace(/-/g,"").indexOf(c)!==-1){if(f=u[g],!f)continue;if(y.pssh)break;delete u[g],y.pssh=new Uint8Array(r),y.keyId=l,f=u[c]=f.then(()=>this.generateRequestWithPreferredKeySession(m,n,r,"encrypted-event-key-match")),f.catch(A=>this.handleError(A));break}}f||this.handleError(new Error(`Key ID ${c} not encountered in playlist. Key-system sessions ${h.length}.`))}).catch(o=>this.handleError(o))}},this.onWaitingForKey=t=>{this.log(`"${t.type}" event`)},this.hls=e,this.config=e.config,this.registerListeners()}destroy(){this.onDestroying(),this.onMediaDetached();const e=this.config;e.requestMediaKeySystemAccessFunc=null,e.licenseXhrSetup=e.licenseResponseCallback=void 0,e.drmSystems=e.drmSystemOptions={},this.hls=this.config=this.keyIdToKeySessionPromise=null,this.onMediaEncrypted=this.onWaitingForKey=null}registerListeners(){this.hls.on(ae.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(ae.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(ae.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(ae.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.on(ae.DESTROYING,this.onDestroying,this)}unregisterListeners(){this.hls.off(ae.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(ae.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(ae.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(ae.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.off(ae.DESTROYING,this.onDestroying,this)}getLicenseServerUrl(e){const{drmSystems:t,widevineLicenseUrl:n}=this.config,r=t==null?void 0:t[e];if(r)return r.licenseUrl;if(e===Dr.WIDEVINE&&n)return n}getLicenseServerUrlOrThrow(e){const t=this.getLicenseServerUrl(e);if(t===void 0)throw new Error(`no license server URL configured for key-system "${e}"`);return t}getServerCertificateUrl(e){const{drmSystems:t}=this.config,n=t==null?void 0:t[e];if(n)return n.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${e}"]`)}attemptKeySystemAccess(e){const t=this.hls.levels,n=(o,a,l)=>!!o&&l.indexOf(o)===a,r=t.map(o=>o.audioCodec).filter(n),s=t.map(o=>o.videoCodec).filter(n);return r.length+s.length===0&&s.push("avc1.42e01e"),new Promise((o,a)=>{const l=c=>{const u=c.shift();this.getMediaKeysPromise(u,r,s).then(h=>o({keySystem:u,mediaKeys:h})).catch(h=>{c.length?l(c):h instanceof El?a(h):a(new El({type:rn.KEY_SYSTEM_ERROR,details:Ke.KEY_SYSTEM_NO_ACCESS,error:h,fatal:!0},h.message))})};l(e)})}requestMediaKeySystemAccess(e,t){const{requestMediaKeySystemAccessFunc:n}=this.config;if(typeof n!="function"){let r=`Configured requestMediaKeySystemAccess is not a function ${n}`;return KR===null&&self.location.protocol==="http:"&&(r=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(r))}return n(e,t)}getMediaKeysPromise(e,t,n){var r;const s=Ame(e,t,n,this.config.drmSystemOptions||{});let o=this.keySystemAccessPromises[e],a=(r=o)==null?void 0:r.keySystemAccess;if(!a){this.log(`Requesting encrypted media "${e}" key-system access with config: ${lr(s)}`),a=this.requestMediaKeySystemAccess(e,s);const l=o=this.keySystemAccessPromises[e]={keySystemAccess:a};return a.catch(c=>{this.log(`Failed to obtain access to key-system "${e}": ${c}`)}),a.then(c=>{this.log(`Access for key-system "${c.keySystem}" obtained`);const u=this.fetchServerCertificate(e);this.log(`Create media-keys for "${e}"`);const h=l.mediaKeys=c.createMediaKeys().then(f=>(this.log(`Media-keys created for "${e}"`),l.hasMediaKeys=!0,u.then(d=>d?this.setMediaKeysServerCertificate(f,e,d):f)));return h.catch(f=>{this.error(`Failed to create media-keys for "${e}"}: ${f}`)}),h})}return a.then(()=>o.mediaKeys)}createMediaKeySessionContext({decryptdata:e,keySystem:t,mediaKeys:n}){this.log(`Creating key-system session "${t}" keyId: ${Oo(e.keyId||[])} keyUri: ${e.uri}`);const r=n.createSession(),s={decryptdata:e,keySystem:t,mediaKeys:n,mediaKeysSession:r,keyStatus:"status-pending"};return this.mediaKeySessions.push(s),s}renewKeySession(e){const t=e.decryptdata;if(t.pssh){const n=this.createMediaKeySessionContext(e),r=n_(t),s="cenc";this.keyIdToKeySessionPromise[r]=this.generateRequestWithPreferredKeySession(n,s,t.pssh.buffer,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)}updateKeySession(e,t){const n=e.mediaKeysSession;return this.log(`Updating key-session "${n.sessionId}" for keyId ${Oo(e.decryptdata.keyId||[])}
      } (data length: ${t.byteLength})`),n.update(t)}getSelectedKeySystemFormats(){return Object.keys(this.keySystemAccessPromises).map(e=>({keySystem:e,hasMediaKeys:this.keySystemAccessPromises[e].hasMediaKeys})).filter(({hasMediaKeys:e})=>!!e).map(({keySystem:e})=>Fb(e)).filter(e=>!!e)}getKeySystemAccess(e){return this.getKeySystemSelectionPromise(e).then(({keySystem:t,mediaKeys:n})=>this.attemptSetMediaKeys(t,n))}selectKeySystem(e){return new Promise((t,n)=>{this.getKeySystemSelectionPromise(e).then(({keySystem:r})=>{const s=Fb(r);s?t(s):n(new Error(`Unable to find format for key-system "${r}"`))}).catch(n)})}selectKeySystemFormat(e){const t=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${e.sn} ${e.type}: ${e.level}) key formats ${t.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(t)),this.keyFormatPromise}getKeyFormatPromise(e){const t=Hv(this.config),n=e.map(iS).filter(r=>!!r&&t.indexOf(r)!==-1);return this.selectKeySystem(n)}getKeyStatus(e){const{mediaKeySessions:t}=this;for(let n=0;n<t.length;n++){const r=Bge(e,t[n]);if(r)return r}}loadKey(e){const t=e.keyInfo.decryptdata,n=n_(t),r=this.bannedKeyIds[n];if(r||this.getKeyStatus(t)==="internal-error"){const a=Lk(r||"internal-error",t);return this.handleError(a,e.frag),Promise.reject(a)}const s=`(keyId: ${n} format: "${t.keyFormat}" method: ${t.method} uri: ${t.uri})`;this.log(`Starting session for key ${s}`);const o=this.keyIdToKeySessionPromise[n];if(!o){const a=this.getKeySystemForKeyPromise(t).then(({keySystem:l,mediaKeys:c})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${e.frag.sn} ${e.frag.type}: ${e.frag.level} using key ${s}`),this.attemptSetMediaKeys(l,c).then(()=>(this.throwIfDestroyed(),this.createMediaKeySessionContext({keySystem:l,mediaKeys:c,decryptdata:t}))))).then(l=>{const c="cenc",u=t.pssh?t.pssh.buffer:null;return this.generateRequestWithPreferredKeySession(l,c,u,"playlist-key")});return a.catch(l=>this.handleError(l,e.frag)),this.keyIdToKeySessionPromise[n]=a,a}return o.catch(a=>{if(a instanceof El){const l=Qi({},a.data);this.getKeyStatus(t)==="internal-error"&&(l.decryptdata=t);const c=new El(l,a.message);this.handleError(c,e.frag)}}),o}throwIfDestroyed(e="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(e,t){if(this.hls)if(e instanceof El){t&&(e.data.frag=t);const n=e.data.decryptdata;this.error(`${e.message}${n?` (${Oo(n.keyId||[])})`:""}`),this.hls.trigger(ae.ERROR,e.data)}else this.error(e.message),this.hls.trigger(ae.ERROR,{type:rn.KEY_SYSTEM_ERROR,details:Ke.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0})}getKeySystemForKeyPromise(e){const t=n_(e),n=this.keyIdToKeySessionPromise[t];if(!n){const r=iS(e.keyFormat),s=r?[r]:Hv(this.config);return this.attemptKeySystemAccess(s)}return n}getKeySystemSelectionPromise(e){if(e.length||(e=Hv(this.config)),e.length===0)throw new El({type:rn.KEY_SYSTEM_ERROR,details:Ke.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${lr({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(e)}attemptSetMediaKeys(e,t){if(this.mediaResolved=void 0,this.mediaKeys===t)return Promise.resolve();const n=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${e}"`);const r=Promise.all(n).then(()=>this.media?this.media.setMediaKeys(t):new Promise((s,o)=>{this.mediaResolved=()=>{if(this.mediaResolved=void 0,!this.media)return o(new Error("Attempted to set mediaKeys without media element attached"));this.mediaKeys=t,this.media.setMediaKeys(t).then(s).catch(o)}}));return this.mediaKeys=t,this.setMediaKeysQueue.push(r),r.then(()=>{this.log(`Media-keys set for "${e}"`),n.push(r),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(s=>n.indexOf(s)===-1)})}generateRequestWithPreferredKeySession(e,t,n,r){var s;const o=(s=this.config.drmSystems)==null||(s=s[e.keySystem])==null?void 0:s.generateRequest;if(o)try{const m=o.call(this.hls,t,n,e);if(!m)throw new Error("Invalid response from configured generateRequest filter");t=m.initDataType,n=m.initData?m.initData:null,e.decryptdata.pssh=n?new Uint8Array(n):null}catch(m){if(this.warn(m.message),this.hls&&this.hls.config.debug)throw m}if(n===null)return this.log(`Skipping key-session request for "${r}" (no initData)`),Promise.resolve(e);const a=n_(e.decryptdata),l=e.decryptdata.uri;this.log(`Generating key-session request for "${r}" keyId: ${a} URI: ${l} (init data type: ${t} length: ${n.byteLength})`);const c=new YR,u=e._onmessage=m=>{const y=e.mediaKeysSession;if(!y){c.emit("error",new Error("invalid state"));return}const{messageType:g,message:A}=m;this.log(`"${g}" message event for session "${y.sessionId}" message size: ${A.byteLength}`),g==="license-request"||g==="license-renewal"?this.renewLicense(e,A).catch(E=>{c.eventNames().length?c.emit("error",E):this.handleError(E)}):g==="license-release"?e.keySystem===Dr.FAIRPLAY&&this.updateKeySession(e,w5("acknowledged")).then(()=>this.removeSession(e)).catch(E=>this.handleError(E)):this.warn(`unhandled media key message type "${g}"`)},h=(m,y)=>{y.keyStatus=m;let g;m.startsWith("usable")?c.emit("resolved"):m==="internal-error"||m==="output-restricted"||m==="output-downscaled"?g=Lk(m,y.decryptdata):m==="expired"?g=new Error(`key expired (keyId: ${a})`):m==="released"?g=new Error("key released"):m==="status-pending"||this.warn(`unhandled key status change "${m}" (keyId: ${a})`),g&&(c.eventNames().length?c.emit("error",g):this.handleError(g))},f=e._onkeystatuseschange=m=>{if(!e.mediaKeysSession){c.emit("error",new Error("invalid state"));return}const g=this.getKeyStatuses(e);if(!Object.keys(g).some(w=>g[w]!=="status-pending"))return;if(g[a]==="expired"){this.log(`Expired key ${lr(g)} in key-session "${e.mediaKeysSession.sessionId}"`),this.renewKeySession(e);return}let E=g[a];if(E)h(E,e);else{var x;e.keyStatusTimeouts||(e.keyStatusTimeouts={}),(x=e.keyStatusTimeouts)[a]||(x[a]=self.setTimeout(()=>{if(!e.mediaKeysSession||!this.mediaKeys)return;const T=this.getKeyStatus(e.decryptdata);if(T&&T!=="status-pending")return this.log(`No status for keyId ${a} in key-session "${e.mediaKeysSession.sessionId}". Using session key-status ${T} from other session.`),h(T,e);this.log(`key status for ${a} in key-session "${e.mediaKeysSession.sessionId}" timed out after 1000ms`),E="internal-error",h(E,e)},1e3)),this.log(`No status for keyId ${a} (${lr(g)}).`)}};_a(e.mediaKeysSession,"message",u),_a(e.mediaKeysSession,"keystatuseschange",f);const d=new Promise((m,y)=>{c.on("error",y),c.on("resolved",m)});return e.mediaKeysSession.generateRequest(t,n).then(()=>{this.log(`Request generated for key-session "${e.mediaKeysSession.sessionId}" keyId: ${a} URI: ${l}`)}).catch(m=>{throw new El({type:rn.KEY_SYSTEM_ERROR,details:Ke.KEY_SYSTEM_NO_SESSION,error:m,decryptdata:e.decryptdata,fatal:!1},`Error generating key-session request: ${m}`)}).then(()=>d).catch(m=>(c.removeAllListeners(),this.removeSession(e).then(()=>{throw m}))).then(()=>(c.removeAllListeners(),e))}getKeyStatuses(e){const t={};return e.mediaKeysSession.keyStatuses.forEach((n,r)=>{if(typeof r=="string"&&typeof n=="object"){const a=r;r=n,n=a}const s="buffer"in r?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):new Uint8Array(r);if(e.keySystem===Dr.PLAYREADY&&s.length===16){const a=Oo(s);t[a]=n,ZQ(s)}const o=Oo(s);n==="internal-error"&&(this.bannedKeyIds[o]=n),this.log(`key status change "${n}" for keyStatuses keyId: ${o} key-session "${e.mediaKeysSession.sessionId}"`),t[o]=n}),t}fetchServerCertificate(e){const t=this.config,n=t.loader,r=new n(t),s=this.getServerCertificateUrl(e);return s?(this.log(`Fetching server certificate for "${e}"`),new Promise((o,a)=>{const l={responseType:"arraybuffer",url:s},c=t.certLoadPolicy.default,u={loadPolicy:c,timeout:c.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},h={onSuccess:(f,d,m,y)=>{o(f.data)},onError:(f,d,m,y)=>{a(new El({type:rn.KEY_SYSTEM_ERROR,details:Ke.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:m,response:Qi({url:l.url,data:void 0},f)},`"${e}" certificate request failed (${s}). Status: ${f.code} (${f.text})`))},onTimeout:(f,d,m)=>{a(new El({type:rn.KEY_SYSTEM_ERROR,details:Ke.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:m,response:{url:l.url,data:void 0}},`"${e}" certificate request timed out (${s})`))},onAbort:(f,d,m)=>{a(new Error("aborted"))}};r.load(l,u,h)})):Promise.resolve()}setMediaKeysServerCertificate(e,t,n){return new Promise((r,s)=>{e.setServerCertificate(n).then(o=>{this.log(`setServerCertificate ${o?"success":"not supported by CDM"} (${n.byteLength}) on "${t}"`),r(e)}).catch(o=>{s(new El({type:rn.KEY_SYSTEM_ERROR,details:Ke.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:o,fatal:!0},o.message))})})}renewLicense(e,t){return this.requestLicense(e,new Uint8Array(t)).then(n=>this.updateKeySession(e,new Uint8Array(n)).catch(r=>{throw new El({type:rn.KEY_SYSTEM_ERROR,details:Ke.KEY_SYSTEM_SESSION_UPDATE_FAILED,decryptdata:e.decryptdata,error:r,fatal:!1},r.message)}))}unpackPlayReadyKeyMessage(e,t){const n=String.fromCharCode.apply(null,new Uint16Array(t.buffer));if(!n.includes("PlayReadyKeyMessage"))return e.setRequestHeader("Content-Type","text/xml; charset=utf-8"),t;const r=new DOMParser().parseFromString(n,"application/xml"),s=r.querySelectorAll("HttpHeader");if(s.length>0){let u;for(let h=0,f=s.length;h<f;h++){var o,a;u=s[h];const d=(o=u.querySelector("name"))==null?void 0:o.textContent,m=(a=u.querySelector("value"))==null?void 0:a.textContent;d&&m&&e.setRequestHeader(d,m)}}const l=r.querySelector("Challenge"),c=l==null?void 0:l.textContent;if(!c)throw new Error("Cannot find <Challenge> in key message");return w5(atob(c))}setupLicenseXHR(e,t,n,r){const s=this.config.licenseXhrSetup;return s?Promise.resolve().then(()=>{if(!n.decryptdata)throw new Error("Key removed");return s.call(this.hls,e,t,n,r)}).catch(o=>{if(!n.decryptdata)throw o;return e.open("POST",t,!0),s.call(this.hls,e,t,n,r)}).then(o=>(e.readyState||e.open("POST",t,!0),{xhr:e,licenseChallenge:o||r})):(e.open("POST",t,!0),Promise.resolve({xhr:e,licenseChallenge:r}))}requestLicense(e,t){const n=this.config.keyLoadPolicy.default;return new Promise((r,s)=>{const o=this.getLicenseServerUrlOrThrow(e.keySystem);this.log(`Sending license request to URL: ${o}`);const a=new XMLHttpRequest;a.responseType="arraybuffer",a.onreadystatechange=()=>{if(!this.hls||!e.mediaKeysSession)return s(new Error("invalid state"));if(a.readyState===4)if(a.status===200){this._requestLicenseFailureCount=0;let l=a.response;this.log(`License received ${l instanceof ArrayBuffer?l.byteLength:l}`);const c=this.config.licenseResponseCallback;if(c)try{l=c.call(this.hls,a,o,e)}catch(u){this.error(u)}r(l)}else{const l=n.errorRetry,c=l?l.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>c||a.status>=400&&a.status<500)s(new El({type:rn.KEY_SYSTEM_ERROR,details:Ke.KEY_SYSTEM_LICENSE_REQUEST_FAILED,decryptdata:e.decryptdata,fatal:!0,networkDetails:a,response:{url:o,data:void 0,code:a.status,text:a.statusText}},`License Request XHR failed (${o}). Status: ${a.status} (${a.statusText})`));else{const u=c-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${u} attempts left`),this.requestLicense(e,t).then(r,s)}}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=a,this.setupLicenseXHR(a,o,e,t).then(({xhr:l,licenseChallenge:c})=>{e.keySystem==Dr.PLAYREADY&&(c=this.unpackPlayReadyKeyMessage(l,c)),l.send(c)}).catch(s)})}onDestroying(){this.unregisterListeners(),this._clear()}onMediaAttached(e,t){if(!this.config.emeEnabled)return;const n=t.media;this.media=n,_a(n,"encrypted",this.onMediaEncrypted),_a(n,"waitingforkey",this.onWaitingForKey);const r=this.mediaResolved;r?r():this.mediaKeys=n.mediaKeys}onMediaDetached(){const e=this.media;e&&(Za(e,"encrypted",this.onMediaEncrypted),Za(e,"waitingforkey",this.onWaitingForKey),this.media=null,this.mediaKeys=null)}_clear(){var e;this._requestLicenseFailureCount=0,this.keyIdToKeySessionPromise={},this.bannedKeyIds={};const t=this.mediaResolved;if(t&&t(),!this.mediaKeys&&!this.mediaKeySessions.length)return;const n=this.media,r=this.mediaKeySessions.slice();this.mediaKeySessions=[],this.mediaKeys=null,Df.clearKeyUriToKeyIdMap();const s=r.length;Wm.CDMCleanupPromise=Promise.all(r.map(o=>this.removeSession(o)).concat((n==null||(e=n.setMediaKeys(null))==null?void 0:e.catch(o=>{this.log(`Could not clear media keys: ${o}`),this.hls&&this.hls.trigger(ae.ERROR,{type:rn.OTHER_ERROR,details:Ke.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR,fatal:!1,error:new Error(`Could not clear media keys: ${o}`)})}))||Promise.resolve())).catch(o=>{this.log(`Could not close sessions and clear media keys: ${o}`),this.hls&&this.hls.trigger(ae.ERROR,{type:rn.OTHER_ERROR,details:Ke.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close sessions and clear media keys: ${o}`)})}).then(()=>{s&&this.log("finished closing key sessions and clearing media keys")})}onManifestLoading(){this._clear()}onManifestLoaded(e,{sessionKeys:t}){if(!(!t||!this.config.emeEnabled)&&!this.keyFormatPromise){const n=t.reduce((r,s)=>(r.indexOf(s.keyFormat)===-1&&r.push(s.keyFormat),r),[]);this.log(`Selecting key-system from session-keys ${n.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(n)}}removeSession(e){const{mediaKeysSession:t,licenseXhr:n,decryptdata:r}=e;if(t){this.log(`Remove licenses and keys and close session "${t.sessionId}" keyId: ${Oo((r==null?void 0:r.keyId)||[])}`),e._onmessage&&(t.removeEventListener("message",e._onmessage),e._onmessage=void 0),e._onkeystatuseschange&&(t.removeEventListener("keystatuseschange",e._onkeystatuseschange),e._onkeystatuseschange=void 0),n&&n.readyState!==XMLHttpRequest.DONE&&n.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;const s=this.mediaKeySessions.indexOf(e);s>-1&&this.mediaKeySessions.splice(s,1);const{keyStatusTimeouts:o}=e;o&&Object.keys(o).forEach(c=>self.clearTimeout(o[c]));const{drmSystemOptions:a}=this.config;return(vme(a)?new Promise((c,u)=>{self.setTimeout(()=>u(new Error("MediaKeySession.remove() timeout")),8e3),t.remove().then(c).catch(u)}):Promise.resolve()).catch(c=>{this.log(`Could not remove session: ${c}`),this.hls&&this.hls.trigger(ae.ERROR,{type:rn.OTHER_ERROR,details:Ke.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR,fatal:!1,error:new Error(`Could not remove session: ${c}`)})}).then(()=>t.close()).catch(c=>{this.log(`Could not close session: ${c}`),this.hls&&this.hls.trigger(ae.ERROR,{type:rn.OTHER_ERROR,details:Ke.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close session: ${c}`)})})}return Promise.resolve()}}Wm.CDMCleanupPromise=void 0;function n_(i){if(!i)throw new Error("Could not read keyId of undefined decryptdata");if(i.keyId===null)throw new Error("keyId is null");return Oo(i.keyId)}function Bge(i,e){if(i.keyId&&e.mediaKeysSession.keyStatuses.has(i.keyId))return e.mediaKeysSession.keyStatuses.get(i.keyId);if(i.matches(e.decryptdata))return e.keyStatus}class El extends Error{constructor(e,t){super(t),this.data=void 0,e.error||(e.error=new Error(t)),this.data=e,e.err=e.error}}function Lk(i,e){const t=i==="output-restricted",n=t?Ke.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:Ke.KEY_SYSTEM_STATUS_INTERNAL_ERROR;return new El({type:rn.KEY_SYSTEM_ERROR,details:n,fatal:!1,decryptdata:e},t?"HDCP level output restricted":`key status changed to "${i}"`)}class $V{constructor(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}setStreamController(e){this.streamController=e}registerListeners(){this.hls.on(ae.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.on(ae.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListeners(){this.hls.off(ae.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.off(ae.MEDIA_DETACHING,this.onMediaDetaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(e,t){const n=this.hls.config;if(n.capLevelOnFPSDrop){const r=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=r,r&&typeof r.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),n.fpsDroppedMonitoringPeriod)}}onMediaDetaching(){this.media=null}checkFPS(e,t,n){const r=performance.now();if(t){if(this.lastTime){const s=r-this.lastTime,o=n-this.lastDroppedFrames,a=t-this.lastDecodedFrames,l=1e3*o/s,c=this.hls;if(c.trigger(ae.FPS_DROP,{currentDropped:o,currentDecoded:a,totalDroppedFrames:n}),l>0&&o>c.config.fpsDroppedMonitoringThreshold*a){let u=c.currentLevel;c.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+u),u>0&&(c.autoLevelCapping===-1||c.autoLevelCapping>=u)&&(u=u-1,c.trigger(ae.FPS_DROP_LEVEL_CAPPING,{level:u,droppedLevel:c.currentLevel}),c.autoLevelCapping=u,this.streamController.nextLevelSwitch())}}this.lastTime=r,this.lastDroppedFrames=n,this.lastDecodedFrames=t}}checkFPSInterval(){const e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){const t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}}function XV(i,e){let t;try{t=new Event("addtrack")}catch{t=document.createEvent("Event"),t.initEvent("addtrack",!1,!1)}t.track=i,e.dispatchEvent(t)}function qV(i,e){const t=i.mode;if(t==="disabled"&&(i.mode="hidden"),i.cues&&!i.cues.getCueById(e.id))try{if(i.addCue(e),!i.cues.getCueById(e.id))throw new Error(`addCue is failed for: ${e}`)}catch(n){Ki.debug(`[texttrack-utils]: ${n}`);try{const r=new self.TextTrackCue(e.startTime,e.endTime,e.text);r.id=e.id,i.addCue(r)}catch(r){Ki.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${r}`)}}t==="disabled"&&(i.mode=t)}function F1(i,e){const t=i.mode;if(t==="disabled"&&(i.mode="hidden"),i.cues)for(let n=i.cues.length;n--;)e&&i.cues[n].removeEventListener("enter",e),i.removeCue(i.cues[n]);t==="disabled"&&(i.mode=t)}function B5(i,e,t,n){const r=i.mode;if(r==="disabled"&&(i.mode="hidden"),i.cues&&i.cues.length>0){const s=kge(i.cues,e,t);for(let o=0;o<s.length;o++)(!n||n(s[o]))&&i.removeCue(s[o])}r==="disabled"&&(i.mode=r)}function Dge(i,e){if(e<=i[0].startTime)return 0;const t=i.length-1;if(e>i[t].endTime)return-1;let n=0,r=t,s;for(;n<=r;)if(s=Math.floor((r+n)/2),e<i[s].startTime)r=s-1;else if(e>i[s].startTime&&n<t)n=s+1;else return s;return i[n].startTime-e<e-i[r].startTime?n:r}function kge(i,e,t){const n=[],r=Dge(i,e);if(r>-1)for(let s=r,o=i.length;s<o;s++){const a=i[s];if(a.startTime>=e&&a.endTime<=t)n.push(a);else if(a.startTime>t)return n}return n}function aS(i){const e=[];for(let t=0;t<i.length;t++){const n=i[t];(n.kind==="subtitles"||n.kind==="captions")&&n.label&&e.push(i[t])}return e}class JV extends S4{constructor(e){super(e,"subtitle-track-controller"),this.media=null,this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.onTextTracksChanged=()=>{if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let t=null;const n=aS(this.media.textTracks);for(let s=0;s<n.length;s++)if(n[s].mode==="hidden")t=n[s];else if(n[s].mode==="showing"){t=n[s];break}const r=this.findTrackForTextTrack(t);this.subtitleTrack!==r&&this.setSubtitleTrack(r)},this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes()}registerListeners(){const{hls:e}=this;e.on(ae.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(ae.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(ae.MANIFEST_LOADING,this.onManifestLoading,this),e.on(ae.MANIFEST_PARSED,this.onManifestParsed,this),e.on(ae.LEVEL_LOADING,this.onLevelLoading,this),e.on(ae.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(ae.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(ae.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(ae.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(ae.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(ae.MANIFEST_LOADING,this.onManifestLoading,this),e.off(ae.MANIFEST_PARSED,this.onManifestParsed,this),e.off(ae.LEVEL_LOADING,this.onLevelLoading,this),e.off(ae.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(ae.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(ae.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,e)}onMediaDetaching(e,t){const n=this.media;if(!n)return;const r=!!t.transferMedia;if(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||n.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),this.subtitleTrack=-1,this.media=null,r)return;aS(n.textTracks).forEach(o=>{F1(o)})}onManifestLoading(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.subtitleTracks}onSubtitleTrackLoaded(e,t){const{id:n,groupId:r,details:s}=t,o=this.tracksInGroup[n];if(!o||o.groupId!==r){this.warn(`Subtitle track with id:${n} and group:${r} not found in active group ${o==null?void 0:o.groupId}`);return}const a=o.details;o.details=t.details,this.log(`Subtitle track ${n} "${o.name}" lang:${o.lang} group:${r} loaded [${s.startSN}-${s.endSN}]`),n===this.trackId&&this.playlistLoaded(n,t,a)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const n=t.subtitleGroups||null,r=this.groupIds;let s=this.currentTrack;if(!n||(r==null?void 0:r.length)!==(n==null?void 0:n.length)||n!=null&&n.some(o=>(r==null?void 0:r.indexOf(o))===-1)){this.groupIds=n,this.trackId=-1,this.currentTrack=null;const o=this.tracks.filter(u=>!n||n.indexOf(u.groupId)!==-1);if(o.length)this.selectDefaultTrack&&!o.some(u=>u.default)&&(this.selectDefaultTrack=!1),o.forEach((u,h)=>{u.id=h});else if(!s&&!this.tracksInGroup.length)return;this.tracksInGroup=o;const a=this.hls.config.subtitlePreference;if(!s&&a){this.selectDefaultTrack=!1;const u=Ah(a,o);if(u>-1)s=o[u];else{const h=Ah(a,this.tracks);s=this.tracks[h]}}let l=this.findTrackId(s);l===-1&&s&&(l=this.findTrackId(null));const c={subtitleTracks:o};this.log(`Updating subtitle tracks, ${o.length} track(s) found in "${n==null?void 0:n.join(",")}" group-id`),this.hls.trigger(ae.SUBTITLE_TRACKS_UPDATED,c),l!==-1&&this.trackId===-1&&this.setSubtitleTrack(l)}}findTrackId(e){const t=this.tracksInGroup,n=this.selectDefaultTrack;for(let r=0;r<t.length;r++){const s=t[r];if(!(n&&!s.default||!n&&!e)&&(!e||jm(s,e)))return r}if(e){for(let r=0;r<t.length;r++){const s=t[r];if(X2(e.attrs,s.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return r}for(let r=0;r<t.length;r++){const s=t[r];if(X2(e.attrs,s.attrs,["LANGUAGE"]))return r}}return-1}findTrackForTextTrack(e){if(e){const t=this.tracksInGroup;for(let n=0;n<t.length;n++){const r=t[n];if(M5(r,e))return n}}return-1}onError(e,t){t.fatal||!t.context||t.context.type===ai.SUBTITLE_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allSubtitleTracks(){return this.tracks}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(e){this.selectDefaultTrack=!1,this.setSubtitleTrack(e)}setSubtitleOption(e){if(this.hls.config.subtitlePreference=e,e){if(e.id===-1)return this.setSubtitleTrack(-1),null;const t=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,t.length){const n=this.currentTrack;if(n&&jm(e,n))return n;const r=Ah(e,this.tracksInGroup);if(r>-1){const s=this.tracksInGroup[r];return this.setSubtitleTrack(r),s}else{if(n)return null;{const s=Ah(e,t);if(s>-1)return t[s]}}}}return null}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentTrack)&&this.scheduleLoading(this.currentTrack,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const n=e.id,r=e.groupId,s=this.getUrlWithDirectives(e.url,t),o=e.details,a=o==null?void 0:o.age;this.log(`Loading subtitle ${n} "${e.name}" lang:${e.lang} group:${r}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${a&&o.live?" age "+a.toFixed(1)+(o.type&&" "+o.type||""):""} ${s}`),this.hls.trigger(ae.SUBTITLE_TRACK_LOADING,{url:s,id:n,groupId:r,deliveryDirectives:t||null,track:e})}toggleTrackModes(){const{media:e}=this;if(!e)return;const t=aS(e.textTracks),n=this.currentTrack;let r;if(n&&(r=t.filter(s=>M5(n,s))[0],r||this.warn(`Unable to find subtitle TextTrack with name "${n.name}" and language "${n.lang}"`)),[].slice.call(t).forEach(s=>{s.mode!=="disabled"&&s!==r&&(s.mode="disabled")}),r){const s=this.subtitleDisplay?"showing":"hidden";r.mode!==s&&(r.mode=s)}}setSubtitleTrack(e){const t=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=e;return}if(e<-1||e>=t.length||!jt(e)){this.warn(`Invalid subtitle track id: ${e}`);return}this.selectDefaultTrack=!1;const n=this.currentTrack,r=t[e]||null;if(this.trackId=e,this.currentTrack=r,this.toggleTrackModes(),!r){this.hls.trigger(ae.SUBTITLE_TRACK_SWITCH,{id:e});return}const s=!!r.details&&!r.details.live;if(e===this.trackId&&r===n&&s)return;this.log(`Switching to subtitle-track ${e}`+(r?` "${r.name}" lang:${r.lang} group:${r.groupId}`:""));const{id:o,groupId:a="",name:l,type:c,url:u}=r;this.hls.trigger(ae.SUBTITLE_TRACK_SWITCH,{id:o,groupId:a,name:l,type:c,url:u});const h=this.switchParams(r.url,n==null?void 0:n.details,r.details);this.loadPlaylist(h)}}function Fge(){try{return crypto.randomUUID()}catch{try{const e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)}catch{let t=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,r=>{const s=(t+Math.random()*16)%16|0;return t=Math.floor(t/16),(r=="x"?s:s&3|8).toString(16)})}}}function f2(i){let e=5381,t=i.length;for(;t;)e=e*33^i.charCodeAt(--t);return(e>>>0).toString()}const X1=.025;let ZS=(function(i){return i[i.Point=0]="Point",i[i.Range=1]="Range",i})({});function Oge(i,e,t){return`${i.identifier}-${t+1}-${f2(e)}`}class Nge{constructor(e,t){this.base=void 0,this._duration=null,this._timelineStart=null,this.appendInPlaceDisabled=void 0,this.appendInPlaceStarted=void 0,this.dateRange=void 0,this.hasPlayed=!1,this.cumulativeDuration=0,this.resumeOffset=NaN,this.playoutLimit=NaN,this.restrictions={skip:!1,jump:!1},this.snapOptions={out:!1,in:!1},this.assetList=[],this.assetListLoader=void 0,this.assetListResponse=null,this.resumeAnchor=void 0,this.error=void 0,this.resetOnResume=void 0,this.base=t,this.dateRange=e,this.setDateRange(e)}setDateRange(e){this.dateRange=e,this.resumeOffset=e.attr.optionalFloat("X-RESUME-OFFSET",this.resumeOffset),this.playoutLimit=e.attr.optionalFloat("X-PLAYOUT-LIMIT",this.playoutLimit),this.restrictions=e.attr.enumeratedStringList("X-RESTRICT",this.restrictions),this.snapOptions=e.attr.enumeratedStringList("X-SNAP",this.snapOptions)}reset(){var e;this.appendInPlaceStarted=!1,(e=this.assetListLoader)==null||e.destroy(),this.assetListLoader=void 0,this.supplementsPrimary||(this.assetListResponse=null,this.assetList=[],this._duration=null)}isAssetPastPlayoutLimit(e){var t;if(e>0&&e>=this.assetList.length)return!0;const n=this.playoutLimit;return e<=0||isNaN(n)?!1:n===0?!0:(((t=this.assetList[e])==null?void 0:t.startOffset)||0)>n}findAssetIndex(e){return this.assetList.indexOf(e)}get identifier(){return this.dateRange.id}get startDate(){return this.dateRange.startDate}get startTime(){const e=this.dateRange.startTime;if(this.snapOptions.out){const t=this.dateRange.tagAnchor;if(t)return jb(e,t)}return e}get startOffset(){return this.cue.pre?0:this.startTime}get startIsAligned(){if(this.startTime===0||this.snapOptions.out)return!0;const e=this.dateRange.tagAnchor;if(e){const t=this.dateRange.startTime,n=jb(t,e);return t-n<.1}return!1}get resumptionOffset(){const e=this.resumeOffset,t=jt(e)?e:this.duration;return this.cumulativeDuration+t}get resumeTime(){const e=this.startOffset+this.resumptionOffset;if(this.snapOptions.in){const t=this.resumeAnchor;if(t)return jb(e,t)}return e}get appendInPlace(){return this.appendInPlaceStarted?!0:this.appendInPlaceDisabled?!1:!!(!this.cue.once&&!this.cue.pre&&this.startIsAligned&&(isNaN(this.playoutLimit)&&isNaN(this.resumeOffset)||this.resumeOffset&&this.duration&&Math.abs(this.resumeOffset-this.duration)<X1))}set appendInPlace(e){if(this.appendInPlaceStarted){this.resetOnResume=!e;return}this.appendInPlaceDisabled=!e}get timelineStart(){return this._timelineStart!==null?this._timelineStart:this.startTime}set timelineStart(e){this._timelineStart=e}get duration(){const e=this.playoutLimit;let t;return this._duration!==null?t=this._duration:this.dateRange.duration?t=this.dateRange.duration:t=this.dateRange.plannedDuration||0,!isNaN(e)&&e<t&&(t=e),t}set duration(e){this._duration=e}get cue(){return this.dateRange.cue}get timelineOccupancy(){return this.dateRange.attr["X-TIMELINE-OCCUPIES"]==="RANGE"?ZS.Range:ZS.Point}get supplementsPrimary(){return this.dateRange.attr["X-TIMELINE-STYLE"]==="PRIMARY"}get contentMayVary(){return this.dateRange.attr["X-CONTENT-MAY-VARY"]!=="NO"}get assetUrl(){return this.dateRange.attr["X-ASSET-URI"]}get assetListUrl(){return this.dateRange.attr["X-ASSET-LIST"]}get baseUrl(){return this.base.url}get assetListLoaded(){return this.assetList.length>0||this.assetListResponse!==null}toString(){return Uge(this)}}function jb(i,e){return i-e.start<e.duration/2&&!(Math.abs(i-(e.start+e.duration))<X1)?e.start:e.start+e.duration}function ZV(i,e,t){const n=new self.URL(i,t);return n.protocol!=="data:"&&n.searchParams.set("_HLS_primary_id",e),n}function Wb(i,e){for(;(t=i.assetList[++e])!=null&&t.error;)var t;return e}function Uge(i){return`["${i.identifier}" ${i.cue.pre?"<pre>":i.cue.post?"<post>":""}${i.timelineStart.toFixed(2)}-${i.resumeTime.toFixed(2)}]`}function b1(i){const e=i.timelineStart,t=i.duration||0;return`["${i.identifier}" ${e.toFixed(2)}-${(e+t).toFixed(2)}]`}class zge{constructor(e,t,n,r){this.hls=void 0,this.interstitial=void 0,this.assetItem=void 0,this.tracks=null,this.hasDetails=!1,this.mediaAttached=null,this._currentTime=void 0,this._bufferedEosTime=void 0,this.checkPlayout=()=>{this.reachedPlayout(this.currentTime)&&this.hls&&this.hls.trigger(ae.PLAYOUT_LIMIT_REACHED,{})};const s=this.hls=new e(t);this.interstitial=n,this.assetItem=r;const o=()=>{this.hasDetails=!0};s.once(ae.LEVEL_LOADED,o),s.once(ae.AUDIO_TRACK_LOADED,o),s.once(ae.SUBTITLE_TRACK_LOADED,o),s.on(ae.MEDIA_ATTACHING,(a,{media:l})=>{this.removeMediaListeners(),this.mediaAttached=l,this.interstitial.playoutLimit&&(l.addEventListener("timeupdate",this.checkPlayout),this.appendInPlace&&s.on(ae.BUFFER_APPENDED,()=>{const u=this.bufferedEnd;this.reachedPlayout(u)&&(this._bufferedEosTime=u,s.trigger(ae.BUFFERED_TO_END,void 0))}))})}get appendInPlace(){return this.interstitial.appendInPlace}loadSource(){const e=this.hls;if(e)if(e.url)e.levels.length&&!e.started&&e.startLoad(-1,!0);else{let t=this.assetItem.uri;try{t=ZV(t,e.config.primarySessionId||"").href}catch{}e.loadSource(t)}}bufferedInPlaceToEnd(e){var t;if(!this.appendInPlace)return!1;if((t=this.hls)!=null&&t.bufferedToEnd)return!0;if(!e)return!1;const n=Math.min(this._bufferedEosTime||1/0,this.duration),r=this.timelineOffset,s=Wn.bufferInfo(e,r,0);return this.getAssetTime(s.end)>=n-.02}reachedPlayout(e){const n=this.interstitial.playoutLimit;return this.startOffset+e>=n}get destroyed(){var e;return!((e=this.hls)!=null&&e.userConfig)}get assetId(){return this.assetItem.identifier}get interstitialId(){return this.assetItem.parentIdentifier}get media(){var e;return((e=this.hls)==null?void 0:e.media)||null}get bufferedEnd(){const e=this.media||this.mediaAttached;if(!e)return this._bufferedEosTime?this._bufferedEosTime:this.currentTime;const t=Wn.bufferInfo(e,e.currentTime,.001);return this.getAssetTime(t.end)}get currentTime(){const e=this.media||this.mediaAttached;return e?this.getAssetTime(e.currentTime):this._currentTime||0}get duration(){const e=this.assetItem.duration;if(!e)return 0;const t=this.interstitial.playoutLimit;if(t){const n=t-this.startOffset;if(n>0&&n<e)return n}return e}get remaining(){const e=this.duration;return e?Math.max(0,e-this.currentTime):0}get startOffset(){return this.assetItem.startOffset}get timelineOffset(){var e;return((e=this.hls)==null?void 0:e.config.timelineOffset)||0}set timelineOffset(e){const t=this.timelineOffset;if(e!==t){const n=e-t;if(Math.abs(n)>1/9e4&&this.hls){if(this.hasDetails)throw new Error("Cannot set timelineOffset after playlists are loaded");this.hls.config.timelineOffset=e}}}getAssetTime(e){const t=this.timelineOffset,n=this.duration;return Math.min(Math.max(0,e-t),n)}removeMediaListeners(){const e=this.mediaAttached;e&&(this._currentTime=e.currentTime,this.bufferSnapShot(),e.removeEventListener("timeupdate",this.checkPlayout))}bufferSnapShot(){if(this.mediaAttached){var e;(e=this.hls)!=null&&e.bufferedToEnd&&(this._bufferedEosTime=this.bufferedEnd)}}destroy(){this.removeMediaListeners(),this.hls&&this.hls.destroy(),this.hls=null,this.tracks=this.mediaAttached=this.checkPlayout=null}attachMedia(e){var t;this.loadSource(),(t=this.hls)==null||t.attachMedia(e)}detachMedia(){var e;this.removeMediaListeners(),this.mediaAttached=null,(e=this.hls)==null||e.detachMedia()}resumeBuffering(){var e;(e=this.hls)==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.hls)==null||e.pauseBuffering()}transferMedia(){var e;return this.bufferSnapShot(),((e=this.hls)==null?void 0:e.transferMedia())||null}resetDetails(){const e=this.hls;if(e&&this.hasDetails){e.stopLoad();const t=n=>delete n.details;e.levels.forEach(t),e.allAudioTracks.forEach(t),e.allSubtitleTracks.forEach(t),this.hasDetails=!1}}on(e,t,n){var r;(r=this.hls)==null||r.on(e,t)}once(e,t,n){var r;(r=this.hls)==null||r.once(e,t)}off(e,t,n){var r;(r=this.hls)==null||r.off(e,t)}toString(){var e;return`HlsAssetPlayer: ${b1(this.assetItem)} ${(e=this.hls)==null?void 0:e.sessionId} ${this.appendInPlace?"append-in-place":""}`}}const Bk=.033;class Gge extends _c{constructor(e,t){super("interstitials-sched",t),this.onScheduleUpdate=void 0,this.eventMap={},this.events=null,this.items=null,this.durations={primary:0,playout:0,integrated:0},this.onScheduleUpdate=e}destroy(){this.reset(),this.onScheduleUpdate=null}reset(){this.eventMap={},this.setDurations(0,0,0),this.events&&this.events.forEach(e=>e.reset()),this.events=this.items=null}resetErrorsInRange(e,t){return this.events?this.events.reduce((n,r)=>e<=r.startOffset&&t>r.startOffset?(delete r.error,n+1):n,0):0}get duration(){const e=this.items;return e?e[e.length-1].end:0}get length(){return this.items?this.items.length:0}getEvent(e){return e&&this.eventMap[e]||null}hasEvent(e){return e in this.eventMap}findItemIndex(e,t){if(e.event)return this.findEventIndex(e.event.identifier);let n=-1;e.nextEvent?n=this.findEventIndex(e.nextEvent.identifier)-1:e.previousEvent&&(n=this.findEventIndex(e.previousEvent.identifier)+1);const r=this.items;if(r)for(r[n]||(t===void 0&&(t=e.start),n=this.findItemIndexAtTime(t));n>=0&&(s=r[n])!=null&&s.event;){var s;n--}return n}findItemIndexAtTime(e,t){const n=this.items;if(n)for(let r=0;r<n.length;r++){let s=n[r];if(t&&t!=="primary"&&(s=s[t]),e===s.start||e>s.start&&e<s.end)return r}return-1}findJumpRestrictedIndex(e,t){const n=this.items;if(n)for(let r=e;r<=t&&n[r];r++){const s=n[r].event;if(s!=null&&s.restrictions.jump&&!s.appendInPlace)return r}return-1}findEventIndex(e){const t=this.items;if(t)for(let r=t.length;r--;){var n;if(((n=t[r].event)==null?void 0:n.identifier)===e)return r}return-1}findAssetIndex(e,t){const n=e.assetList,r=n.length;if(r>1)for(let s=0;s<r;s++){const o=n[s];if(!o.error){const a=o.timelineStart;if(t===a||t>a&&(t<a+(o.duration||0)||s===r-1))return s}}return 0}get assetIdAtEnd(){var e;const t=(e=this.items)==null||(e=e[this.length-1])==null?void 0:e.event;if(t){const n=t.assetList,r=n[n.length-1];if(r)return r.identifier}return null}parseInterstitialDateRanges(e,t){const n=e.main.details,{dateRanges:r}=n,s=this.events,o=this.parseDateRanges(r,{url:n.url},t),a=Object.keys(r),l=s?s.filter(c=>!a.includes(c.identifier)):[];o.length&&o.sort((c,u)=>{const h=c.cue.pre,f=c.cue.post,d=u.cue.pre,m=u.cue.post;if(h&&!d)return-1;if(d&&!h||f&&!m)return 1;if(m&&!f)return-1;if(!h&&!d&&!f&&!m){const y=c.startTime,g=u.startTime;if(y!==g)return y-g}return c.dateRange.tagOrder-u.dateRange.tagOrder}),this.events=o,l.forEach(c=>{this.removeEvent(c)}),this.updateSchedule(e,l)}updateSchedule(e,t=[],n=!1){const r=this.events||[];if(r.length||t.length||this.length<2){const s=this.items,o=this.parseSchedule(r,e);(n||t.length||(s==null?void 0:s.length)!==o.length||o.some((l,c)=>Math.abs(l.playout.start-s[c].playout.start)>.005||Math.abs(l.playout.end-s[c].playout.end)>.005))&&(this.items=o,this.onScheduleUpdate(t,s))}}parseDateRanges(e,t,n){const r=[],s=Object.keys(e);for(let o=0;o<s.length;o++){const a=s[o],l=e[a];if(l.isInterstitial){let c=this.eventMap[a];c?c.setDateRange(l):(c=new Nge(l,t),this.eventMap[a]=c,n===!1&&(c.appendInPlace=n)),r.push(c)}}return r}parseSchedule(e,t){const n=[],r=t.main.details,s=r.live?1/0:r.edge;let o=0;if(e=e.filter(l=>!l.error&&!(l.cue.once&&l.hasPlayed)),e.length){this.resolveOffsets(e,t);let l=0,c=0;if(e.forEach((u,h)=>{const f=u.cue.pre,d=u.cue.post,m=e[h-1]||null,y=u.appendInPlace,g=d?s:u.startOffset,A=u.duration,E=u.timelineOccupancy===ZS.Range?A:0,x=u.resumptionOffset,w=(m==null?void 0:m.startTime)===g,T=g+u.cumulativeDuration;let I=y?T+A:g+x;if(f||!d&&g<=0){const L=c;c+=E,u.timelineStart=T;const P=o;o+=A,n.push({event:u,start:T,end:I,playout:{start:P,end:o},integrated:{start:L,end:c}})}else if(g<=s){if(!w){const R=g-l;if(R>Bk){const U=l,k=c;c+=R;const H=o;o+=R;const G={previousEvent:e[h-1]||null,nextEvent:u,start:U,end:U+R,playout:{start:H,end:o},integrated:{start:k,end:c}};n.push(G)}else R>0&&m&&(m.cumulativeDuration+=R,n[n.length-1].end=g)}d&&(I=T),u.timelineStart=T;const L=c;c+=E;const P=o;o+=A,n.push({event:u,start:T,end:I,playout:{start:P,end:o},integrated:{start:L,end:c}})}else return;const M=u.resumeTime;d||M>s?l=s:l=M}),l<s){var a;const u=l,h=c,f=s-l;c+=f;const d=o;o+=f,n.push({previousEvent:((a=n[n.length-1])==null?void 0:a.event)||null,nextEvent:null,start:l,end:u+f,playout:{start:d,end:o},integrated:{start:h,end:c}})}this.setDurations(s,o,c)}else n.push({previousEvent:null,nextEvent:null,start:0,end:s,playout:{start:0,end:s},integrated:{start:0,end:s}}),this.setDurations(s,s,s);return n}setDurations(e,t,n){this.durations={primary:e,playout:t,integrated:n}}resolveOffsets(e,t){const n=t.main.details,r=n.live?1/0:n.edge;let s=0,o=-1;e.forEach((a,l)=>{const c=a.cue.pre,u=a.cue.post,h=c?0:u?r:a.startTime;this.updateAssetDurations(a),o===h?a.cumulativeDuration=s:(s=0,o=h),!u&&a.snapOptions.in&&(a.resumeAnchor=o0(null,n.fragments,a.startOffset+a.resumptionOffset,0,0)||void 0),a.appendInPlace&&!a.appendInPlaceStarted&&(this.primaryCanResumeInPlaceAt(a,t)||(a.appendInPlace=!1)),!a.appendInPlace&&l+1<e.length&&e[l+1].startTime-e[l].resumeTime<Bk&&(e[l+1].appendInPlace=!1,e[l+1].appendInPlace&&this.warn(`Could not change append strategy for abutting event ${a}`));const d=jt(a.resumeOffset)?a.resumeOffset:a.duration;s+=d})}primaryCanResumeInPlaceAt(e,t){const n=e.resumeTime,r=e.startTime+e.resumptionOffset;return Math.abs(n-r)>X1?(this.log(`"${e.identifier}" resumption ${n} not aligned with estimated timeline end ${r}`),!1):!Object.keys(t).some(o=>{const a=t[o].details,l=a.edge;if(n>=l)return this.log(`"${e.identifier}" resumption ${n} past ${o} playlist end ${l}`),!1;const c=o0(null,a.fragments,n);if(!c)return this.log(`"${e.identifier}" resumption ${n} does not align with any fragments in ${o} playlist (${a.fragStart}-${a.fragmentEnd})`),!0;const u=o==="audio"?.175:0;return Math.abs(c.start-n)<X1+u||Math.abs(c.end-n)<X1+u?!1:(this.log(`"${e.identifier}" resumption ${n} not aligned with ${o} fragment bounds (${c.start}-${c.end} sn: ${c.sn} cc: ${c.cc})`),!0)})}updateAssetDurations(e){if(!e.assetListLoaded)return;const t=e.timelineStart;let n=0,r=!1,s=!1;for(let o=0;o<e.assetList.length;o++){const a=e.assetList[o],l=t+n;a.startOffset=n,a.timelineStart=l,r||(r=a.duration===null),s||(s=!!a.error);const c=a.error?0:a.duration||0;n+=c}r&&!s?e.duration=Math.max(n,e.duration):e.duration=n}removeEvent(e){e.reset(),delete this.eventMap[e.identifier]}}function ou(i){return`[${i.event?'"'+i.event.identifier+'"':"primary"}: ${i.start.toFixed(2)}-${i.end.toFixed(2)}]`}class Hge{constructor(e){this.hls=void 0,this.hls=e}destroy(){this.hls=null}loadAssetList(e,t){const n=e.assetListUrl;let r;try{r=ZV(n,this.hls.sessionId,e.baseUrl)}catch(f){const d=this.assignAssetListError(e,Ke.ASSET_LIST_LOAD_ERROR,f,n);this.hls.trigger(ae.ERROR,d);return}t&&r.protocol!=="data:"&&r.searchParams.set("_HLS_start_offset",""+t);const s=this.hls.config,o=s.loader,a=new o(s),l={responseType:"json",url:r.href},c=s.interstitialAssetListLoadPolicy.default,u={loadPolicy:c,timeout:c.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},h={onSuccess:(f,d,m,y)=>{const g=f.data,A=g==null?void 0:g.ASSETS;if(!Array.isArray(A)){const E=this.assignAssetListError(e,Ke.ASSET_LIST_PARSING_ERROR,new Error("Invalid interstitial asset list"),m.url,d,y);this.hls.trigger(ae.ERROR,E);return}e.assetListResponse=g,this.hls.trigger(ae.ASSET_LIST_LOADED,{event:e,assetListResponse:g,networkDetails:y})},onError:(f,d,m,y)=>{const g=this.assignAssetListError(e,Ke.ASSET_LIST_LOAD_ERROR,new Error(`Error loading X-ASSET-LIST: HTTP status ${f.code} ${f.text} (${d.url})`),d.url,y,m);this.hls.trigger(ae.ERROR,g)},onTimeout:(f,d,m)=>{const y=this.assignAssetListError(e,Ke.ASSET_LIST_LOAD_TIMEOUT,new Error(`Timeout loading X-ASSET-LIST (${d.url})`),d.url,f,m);this.hls.trigger(ae.ERROR,y)}};return a.load(l,u,h),this.hls.trigger(ae.ASSET_LIST_LOADING,{event:e}),a}assignAssetListError(e,t,n,r,s,o){return e.error=n,{type:rn.NETWORK_ERROR,details:t,fatal:!1,interstitial:e,url:r,error:n,networkDetails:o,stats:s}}}function Dk(i){var e;i==null||(e=i.play())==null||e.catch(()=>{})}function i_(i,e){return`[${i}] Advancing timeline position to ${e}`}class Qge extends _c{constructor(e,t){super("interstitials",e.logger),this.HlsPlayerClass=void 0,this.hls=void 0,this.assetListLoader=void 0,this.mediaSelection=null,this.altSelection=null,this.media=null,this.detachedData=null,this.requiredTracks=null,this.manager=null,this.playerQueue=[],this.bufferedPos=-1,this.timelinePos=-1,this.schedule=void 0,this.playingItem=null,this.bufferingItem=null,this.waitingItem=null,this.endedItem=null,this.playingAsset=null,this.endedAsset=null,this.bufferingAsset=null,this.shouldPlay=!1,this.onPlay=()=>{this.shouldPlay=!0},this.onPause=()=>{this.shouldPlay=!1},this.onSeeking=()=>{const n=this.currentTime;if(n===void 0||this.playbackDisabled||!this.schedule)return;const r=n-this.timelinePos;if(Math.abs(r)<1/7056e5)return;const o=r<=-.01;this.timelinePos=n,this.bufferedPos=n;const a=this.playingItem;if(!a){this.checkBuffer();return}if(o&&this.schedule.resetErrorsInRange(n,n-r)&&this.updateSchedule(!0),this.checkBuffer(),o&&n<a.start||n>=a.end){var l;const d=this.findItemIndex(a);let m=this.schedule.findItemIndexAtTime(n);if(m===-1&&(m=d+(o?-1:1),this.log(`seeked ${o?"back ":""}to position not covered by schedule ${n} (resolving from ${d} to ${m})`)),!this.isInterstitial(a)&&(l=this.media)!=null&&l.paused&&(this.shouldPlay=!1),!o&&m>d){const y=this.schedule.findJumpRestrictedIndex(d+1,m);if(y>d){this.setSchedulePosition(y);return}}this.setSchedulePosition(m);return}const c=this.playingAsset;if(!c){if(this.playingLastItem&&this.isInterstitial(a)){const d=a.event.assetList[0];d&&(this.endedItem=this.playingItem,this.playingItem=null,this.setScheduleToAssetAtTime(n,d))}return}const u=c.timelineStart,h=c.duration||0;if(o&&n<u||n>=u+h){var f;(f=a.event)!=null&&f.appendInPlace&&(this.clearAssetPlayers(a.event,a),this.flushFrontBuffer(n)),this.setScheduleToAssetAtTime(n,c)}},this.onTimeupdate=()=>{const n=this.currentTime;if(n===void 0||this.playbackDisabled)return;if(n>this.timelinePos)this.timelinePos=n,n>this.bufferedPos&&this.checkBuffer();else return;const r=this.playingItem;if(!r||this.playingLastItem)return;if(n>=r.end){this.timelinePos=r.end;const a=this.findItemIndex(r);this.setSchedulePosition(a+1)}const s=this.playingAsset;if(!s)return;const o=s.timelineStart+(s.duration||0);n>=o&&this.setScheduleToAssetAtTime(n,s)},this.onScheduleUpdate=(n,r)=>{const s=this.schedule;if(!s)return;const o=this.playingItem,a=s.events||[],l=s.items||[],c=s.durations,u=n.map(y=>y.identifier),h=!!(a.length||u.length);(h||r)&&this.log(`INTERSTITIALS_UPDATED (${a.length}): ${a}
Schedule: ${l.map(y=>ou(y))} pos: ${this.timelinePos}`),u.length&&this.log(`Removed events ${u}`);let f=null,d=null;o&&(f=this.updateItem(o,this.timelinePos),this.itemsMatch(o,f)?this.playingItem=f:this.waitingItem=this.endedItem=null),this.waitingItem=this.updateItem(this.waitingItem),this.endedItem=this.updateItem(this.endedItem);const m=this.bufferingItem;if(m&&(d=this.updateItem(m,this.bufferedPos),this.itemsMatch(m,d)?this.bufferingItem=d:m.event&&(this.bufferingItem=this.playingItem,this.clearInterstitial(m.event,null))),n.forEach(y=>{y.assetList.forEach(g=>{this.clearAssetPlayer(g.identifier,null)})}),this.playerQueue.forEach(y=>{if(y.interstitial.appendInPlace){const g=y.assetItem.timelineStart,A=y.timelineOffset-g;if(A)try{y.timelineOffset=g}catch(E){Math.abs(A)>X1&&this.warn(`${E} ("${y.assetId}" ${y.timelineOffset}->${g})`)}}}),h||r){if(this.hls.trigger(ae.INTERSTITIALS_UPDATED,{events:a.slice(0),schedule:l.slice(0),durations:c,removedIds:u}),this.isInterstitial(o)&&u.includes(o.event.identifier)){this.warn(`Interstitial "${o.event.identifier}" removed while playing`),this.primaryFallback(o.event);return}o&&this.trimInPlace(f,o),m&&d!==f&&this.trimInPlace(d,m),this.checkBuffer()}},this.hls=e,this.HlsPlayerClass=t,this.assetListLoader=new Hge(e),this.schedule=new Gge(this.onScheduleUpdate,e.logger),this.registerListeners()}registerListeners(){const e=this.hls;e&&(e.on(ae.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(ae.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(ae.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(ae.MANIFEST_LOADING,this.onManifestLoading,this),e.on(ae.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(ae.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(ae.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.on(ae.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(ae.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.on(ae.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.on(ae.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.on(ae.BUFFER_APPENDED,this.onBufferAppended,this),e.on(ae.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(ae.BUFFERED_TO_END,this.onBufferedToEnd,this),e.on(ae.MEDIA_ENDED,this.onMediaEnded,this),e.on(ae.ERROR,this.onError,this),e.on(ae.DESTROYING,this.onDestroying,this))}unregisterListeners(){const e=this.hls;e&&(e.off(ae.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(ae.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(ae.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(ae.MANIFEST_LOADING,this.onManifestLoading,this),e.off(ae.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(ae.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(ae.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.off(ae.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(ae.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.off(ae.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.off(ae.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.off(ae.BUFFER_CODECS,this.onBufferCodecs,this),e.off(ae.BUFFER_APPENDED,this.onBufferAppended,this),e.off(ae.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(ae.BUFFERED_TO_END,this.onBufferedToEnd,this),e.off(ae.MEDIA_ENDED,this.onMediaEnded,this),e.off(ae.ERROR,this.onError,this),e.off(ae.DESTROYING,this.onDestroying,this))}startLoad(){this.resumeBuffering()}stopLoad(){this.pauseBuffering()}resumeBuffering(){var e;(e=this.getBufferingPlayer())==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.getBufferingPlayer())==null||e.pauseBuffering()}destroy(){this.unregisterListeners(),this.stopLoad(),this.assetListLoader&&this.assetListLoader.destroy(),this.emptyPlayerQueue(),this.clearScheduleState(),this.schedule&&this.schedule.destroy(),this.media=this.detachedData=this.mediaSelection=this.requiredTracks=this.altSelection=this.schedule=this.manager=null,this.hls=this.HlsPlayerClass=this.log=null,this.assetListLoader=null,this.onPlay=this.onPause=this.onSeeking=this.onTimeupdate=null,this.onScheduleUpdate=null}onDestroying(){const e=this.primaryMedia||this.media;e&&this.removeMediaListeners(e)}removeMediaListeners(e){Za(e,"play",this.onPlay),Za(e,"pause",this.onPause),Za(e,"seeking",this.onSeeking),Za(e,"timeupdate",this.onTimeupdate)}onMediaAttaching(e,t){const n=this.media=t.media;_a(n,"seeking",this.onSeeking),_a(n,"timeupdate",this.onTimeupdate),_a(n,"play",this.onPlay),_a(n,"pause",this.onPause)}onMediaAttached(e,t){const n=this.effectivePlayingItem,r=this.detachedData;if(this.detachedData=null,n===null)this.checkStart();else if(!r){this.clearScheduleState();const s=this.findItemIndex(n);this.setSchedulePosition(s)}}clearScheduleState(){this.log("clear schedule state"),this.playingItem=this.bufferingItem=this.waitingItem=this.endedItem=this.playingAsset=this.endedAsset=this.bufferingAsset=null}onMediaDetaching(e,t){const n=!!t.transferMedia,r=this.media;if(this.media=null,!n&&(r&&this.removeMediaListeners(r),this.detachedData)){const s=this.getBufferingPlayer();s&&(this.log(`Removing schedule state for detachedData and ${s}`),this.playingAsset=this.endedAsset=this.bufferingAsset=this.bufferingItem=this.waitingItem=this.detachedData=null,s.detachMedia()),this.shouldPlay=!1}}get interstitialsManager(){if(!this.hls)return null;if(this.manager)return this.manager;const e=this,t=()=>e.bufferingItem||e.waitingItem,n=h=>h&&e.getAssetPlayer(h.identifier),r=(h,f,d,m,y)=>{if(h){let g=h[f].start;const A=h.event;if(A){if(f==="playout"||A.timelineOccupancy!==ZS.Point){const E=n(d);(E==null?void 0:E.interstitial)===A&&(g+=E.assetItem.startOffset+E[y])}}else{const E=m==="bufferedPos"?o():e[m];g+=E-h.start}return g}return 0},s=(h,f)=>{var d;if(h!==0&&f!=="primary"&&(d=e.schedule)!=null&&d.length){var m;const y=e.schedule.findItemIndexAtTime(h),g=(m=e.schedule.items)==null?void 0:m[y];if(g){const A=g[f].start-g.start;return h+A}}return h},o=()=>{const h=e.bufferedPos;return h===Number.MAX_VALUE?a("primary"):Math.max(h,0)},a=h=>{var f,d;return(f=e.primaryDetails)!=null&&f.live?e.primaryDetails.edge:((d=e.schedule)==null?void 0:d.durations[h])||0},l=(h,f)=>{var d,m;const y=e.effectivePlayingItem;if(y!=null&&(d=y.event)!=null&&d.restrictions.skip||!e.schedule)return;e.log(`seek to ${h} "${f}"`);const g=e.effectivePlayingItem,A=e.schedule.findItemIndexAtTime(h,f),E=(m=e.schedule.items)==null?void 0:m[A],x=e.getBufferingPlayer(),w=x==null?void 0:x.interstitial,T=w==null?void 0:w.appendInPlace,I=g&&e.itemsMatch(g,E);if(g&&(T||I)){const M=n(e.playingAsset),L=(M==null?void 0:M.media)||e.primaryMedia;if(L){const P=f==="primary"?L.currentTime:r(g,f,e.playingAsset,"timelinePos","currentTime"),R=h-P,U=(T?P:L.currentTime)+R;if(U>=0&&(!M||T||U<=M.duration)){L.currentTime=U;return}}}if(E){let M=h;if(f!=="primary"){const P=E[f].start,R=h-P;M=E.start+R}const L=!e.isInterstitial(E);if((!e.isInterstitial(g)||g.event.appendInPlace)&&(L||E.event.appendInPlace)){const P=e.media||(T?x==null?void 0:x.media:null);P&&(P.currentTime=M)}else if(g){const P=e.findItemIndex(g);if(A>P){const U=e.schedule.findJumpRestrictedIndex(P+1,A);if(U>P){e.setSchedulePosition(U);return}}let R=0;if(L)e.timelinePos=M,e.checkBuffer();else{const U=E.event.assetList,k=h-(E[f]||E).start;for(let H=U.length;H--;){const G=U[H];if(G.duration&&k>=G.startOffset&&k<G.startOffset+G.duration){R=H;break}}}e.setSchedulePosition(A,R)}}},c=()=>{const h=e.effectivePlayingItem;if(e.isInterstitial(h))return h;const f=t();return e.isInterstitial(f)?f:null},u={get bufferedEnd(){const h=t(),f=e.bufferingItem;if(f&&f===h){var d;return r(f,"playout",e.bufferingAsset,"bufferedPos","bufferedEnd")-f.playout.start||((d=e.bufferingAsset)==null?void 0:d.startOffset)||0}return 0},get currentTime(){const h=c(),f=e.effectivePlayingItem;return f&&f===h?r(f,"playout",e.effectivePlayingAsset,"timelinePos","currentTime")-f.playout.start:0},set currentTime(h){const f=c(),d=e.effectivePlayingItem;d&&d===f&&l(h+d.playout.start,"playout")},get duration(){const h=c();return h?h.playout.end-h.playout.start:0},get assetPlayers(){var h;const f=(h=c())==null?void 0:h.event.assetList;return f?f.map(d=>e.getAssetPlayer(d.identifier)):[]},get playingIndex(){var h;const f=(h=c())==null?void 0:h.event;return f&&e.effectivePlayingAsset?f.findAssetIndex(e.effectivePlayingAsset):-1},get scheduleItem(){return c()}};return this.manager={get events(){var h;return((h=e.schedule)==null||(h=h.events)==null?void 0:h.slice(0))||[]},get schedule(){var h;return((h=e.schedule)==null||(h=h.items)==null?void 0:h.slice(0))||[]},get interstitialPlayer(){return c()?u:null},get playerQueue(){return e.playerQueue.slice(0)},get bufferingAsset(){return e.bufferingAsset},get bufferingItem(){return t()},get bufferingIndex(){const h=t();return e.findItemIndex(h)},get playingAsset(){return e.effectivePlayingAsset},get playingItem(){return e.effectivePlayingItem},get playingIndex(){const h=e.effectivePlayingItem;return e.findItemIndex(h)},primary:{get bufferedEnd(){return o()},get currentTime(){const h=e.timelinePos;return h>0?h:0},set currentTime(h){l(h,"primary")},get duration(){return a("primary")},get seekableStart(){var h;return((h=e.primaryDetails)==null?void 0:h.fragmentStart)||0}},integrated:{get bufferedEnd(){return r(t(),"integrated",e.bufferingAsset,"bufferedPos","bufferedEnd")},get currentTime(){return r(e.effectivePlayingItem,"integrated",e.effectivePlayingAsset,"timelinePos","currentTime")},set currentTime(h){l(h,"integrated")},get duration(){return a("integrated")},get seekableStart(){var h;return s(((h=e.primaryDetails)==null?void 0:h.fragmentStart)||0,"integrated")}},skip:()=>{const h=e.effectivePlayingItem,f=h==null?void 0:h.event;if(f&&!f.restrictions.skip){const d=e.findItemIndex(h);if(f.appendInPlace){const m=h.playout.start+h.event.duration;l(m+.001,"playout")}else e.advanceAfterAssetEnded(f,d,1/0)}}}}get effectivePlayingItem(){return this.waitingItem||this.playingItem||this.endedItem}get effectivePlayingAsset(){return this.playingAsset||this.endedAsset}get playingLastItem(){var e;const t=this.playingItem,n=(e=this.schedule)==null?void 0:e.items;return!this.playbackStarted||!t||!n?!1:this.findItemIndex(t)===n.length-1}get playbackStarted(){return this.effectivePlayingItem!==null}get currentTime(){var e,t;if(this.mediaSelection===null)return;const n=this.waitingItem||this.playingItem;if(this.isInterstitial(n)&&!n.event.appendInPlace)return;let r=this.media;!r&&(e=this.bufferingItem)!=null&&(e=e.event)!=null&&e.appendInPlace&&(r=this.primaryMedia);const s=(t=r)==null?void 0:t.currentTime;if(!(s===void 0||!jt(s)))return s}get primaryMedia(){var e;return this.media||((e=this.detachedData)==null?void 0:e.media)||null}isInterstitial(e){return!!(e!=null&&e.event)}retreiveMediaSource(e,t){const n=this.getAssetPlayer(e);n&&this.transferMediaFromPlayer(n,t)}transferMediaFromPlayer(e,t){const n=e.interstitial.appendInPlace,r=e.media;if(n&&r===this.primaryMedia){if(this.bufferingAsset=null,(!t||this.isInterstitial(t)&&!t.event.appendInPlace)&&t&&r){this.detachedData={media:r};return}const s=e.transferMedia();this.log(`transfer MediaSource from ${e} ${lr(s)}`),this.detachedData=s}else t&&r&&(this.shouldPlay||(this.shouldPlay=!r.paused))}transferMediaTo(e,t){var n,r;if(e.media===t)return;let s=null;const o=this.hls,a=e!==o,l=a&&e.interstitial.appendInPlace,c=(n=this.detachedData)==null?void 0:n.mediaSource;let u;if(o.media)l&&(s=o.transferMedia(),this.detachedData=s),u="Primary";else if(c){const m=this.getBufferingPlayer();m?(s=m.transferMedia(),u=`${m}`):u="detached MediaSource"}else u="detached media";if(!s){if(c)s=this.detachedData,this.log(`using detachedData: MediaSource ${lr(s)}`);else if(!this.detachedData||o.media===t){const m=this.playerQueue;m.length>1&&m.forEach(y=>{if(a&&y.interstitial.appendInPlace!==l){const g=y.interstitial;this.clearInterstitial(y.interstitial,null),g.appendInPlace=!1,g.appendInPlace&&this.warn(`Could not change append strategy for queued assets ${g}`)}}),this.hls.detachMedia(),this.detachedData={media:t}}}const h=s&&"mediaSource"in s&&((r=s.mediaSource)==null?void 0:r.readyState)!=="closed",f=h&&s?s:t;this.log(`${h?"transfering MediaSource":"attaching media"} to ${a?e:"Primary"} from ${u} (media.currentTime: ${t.currentTime})`);const d=this.schedule;if(f===s&&d){const m=a&&e.assetId===d.assetIdAtEnd;f.overrides={duration:d.duration,endOfStream:!a||m,cueRemoval:!a}}e.attachMedia(f)}onInterstitialCueEnter(){this.onTimeupdate()}checkStart(){const e=this.schedule,t=e==null?void 0:e.events;if(!t||this.playbackDisabled||!this.media)return;this.bufferedPos===-1&&(this.bufferedPos=0);const n=this.timelinePos,r=this.effectivePlayingItem;if(n===-1){const s=this.hls.startPosition;if(this.log(i_("checkStart",s)),this.timelinePos=s,t.length&&t[0].cue.pre){const o=e.findEventIndex(t[0].identifier);this.setSchedulePosition(o)}else if(s>=0||!this.primaryLive){const o=this.timelinePos=s>0?s:0,a=e.findItemIndexAtTime(o);this.setSchedulePosition(a)}}else if(r&&!this.playingItem){const s=e.findItemIndex(r);this.setSchedulePosition(s)}}advanceAssetBuffering(e,t){const n=e.event,r=n.findAssetIndex(t),s=Wb(n,r);if(!n.isAssetPastPlayoutLimit(s))this.bufferedToEvent(e,s);else if(this.schedule){var o;const a=(o=this.schedule.items)==null?void 0:o[this.findItemIndex(e)+1];a&&this.bufferedToItem(a)}}advanceAfterAssetEnded(e,t,n){const r=Wb(e,n);if(e.isAssetPastPlayoutLimit(r)){if(this.schedule){const s=this.schedule.items;if(s){const o=t+1,a=s.length;if(o>=a){this.setSchedulePosition(-1);return}const l=e.resumeTime;this.timelinePos<l&&(this.log(i_("advanceAfterAssetEnded",l)),this.timelinePos=l,e.appendInPlace&&this.advanceInPlace(l),this.checkBuffer(this.bufferedPos<l)),this.setSchedulePosition(o)}}}else{if(e.appendInPlace){const s=e.assetList[r];s&&this.advanceInPlace(s.timelineStart)}this.setSchedulePosition(t,r)}}setScheduleToAssetAtTime(e,t){const n=this.schedule;if(!n)return;const r=t.parentIdentifier,s=n.getEvent(r);if(s){const o=n.findEventIndex(r),a=n.findAssetIndex(s,e);this.advanceAfterAssetEnded(s,o,a-1)}}setSchedulePosition(e,t){var n;const r=(n=this.schedule)==null?void 0:n.items;if(!r||this.playbackDisabled)return;const s=e>=0?r[e]:null;this.log(`setSchedulePosition ${e}, ${t} (${s&&ou(s)}) pos: ${this.timelinePos}`);const o=this.waitingItem||this.playingItem,a=this.playingLastItem;if(this.isInterstitial(o)){const u=o.event,h=this.playingAsset,f=h==null?void 0:h.identifier,d=f?this.getAssetPlayer(f):null;if(d&&f&&(!this.eventItemsMatch(o,s)||t!==void 0&&f!==u.assetList[t].identifier)){var l;const m=u.findAssetIndex(h);if(this.log(`INTERSTITIAL_ASSET_ENDED ${m+1}/${u.assetList.length} ${b1(h)}`),this.endedAsset=h,this.playingAsset=null,this.hls.trigger(ae.INTERSTITIAL_ASSET_ENDED,{asset:h,assetListIndex:m,event:u,schedule:r.slice(0),scheduleIndex:e,player:d}),o!==this.playingItem){this.itemsMatch(o,this.playingItem)&&!this.playingAsset&&this.advanceAfterAssetEnded(u,this.findItemIndex(this.playingItem),m);return}this.retreiveMediaSource(f,s),d.media&&!((l=this.detachedData)!=null&&l.mediaSource)&&d.detachMedia()}if(!this.eventItemsMatch(o,s)&&(this.endedItem=o,this.playingItem=null,this.log(`INTERSTITIAL_ENDED ${u} ${ou(o)}`),u.hasPlayed=!0,this.hls.trigger(ae.INTERSTITIAL_ENDED,{event:u,schedule:r.slice(0),scheduleIndex:e}),u.cue.once)){var c;this.updateSchedule();const m=(c=this.schedule)==null?void 0:c.items;if(s&&m){const y=this.findItemIndex(s);this.advanceSchedule(y,m,t,o,a)}return}}this.advanceSchedule(e,r,t,o,a)}advanceSchedule(e,t,n,r,s){const o=this.schedule;if(!o)return;const a=t[e]||null,l=this.primaryMedia,c=this.playerQueue;if(c.length&&c.forEach(u=>{const h=u.interstitial,f=o.findEventIndex(h.identifier);(f<e||f>e+1)&&this.clearInterstitial(h,a)}),this.isInterstitial(a)){this.timelinePos=Math.min(Math.max(this.timelinePos,a.start),a.end);const u=a.event;if(n===void 0){n=o.findAssetIndex(u,this.timelinePos);const m=Wb(u,n-1);if(u.isAssetPastPlayoutLimit(m)||u.appendInPlace&&this.timelinePos===a.end){this.advanceAfterAssetEnded(u,e,n);return}n=m}const h=this.waitingItem;this.assetsBuffered(a,l)||this.setBufferingItem(a);let f=this.preloadAssets(u,n);if(this.eventItemsMatch(a,h||r)||(this.waitingItem=a,this.log(`INTERSTITIAL_STARTED ${ou(a)} ${u.appendInPlace?"append in place":""}`),this.hls.trigger(ae.INTERSTITIAL_STARTED,{event:u,schedule:t.slice(0),scheduleIndex:e})),!u.assetListLoaded){this.log(`Waiting for ASSET-LIST to complete loading ${u}`);return}if(u.assetListLoader&&(u.assetListLoader.destroy(),u.assetListLoader=void 0),!l){this.log(`Waiting for attachMedia to start Interstitial ${u}`);return}this.waitingItem=this.endedItem=null,this.playingItem=a;const d=u.assetList[n];if(!d){this.advanceAfterAssetEnded(u,e,n||0);return}if(f||(f=this.getAssetPlayer(d.identifier)),f===null||f.destroyed){const m=u.assetList.length;this.warn(`asset ${n+1}/${m} player destroyed ${u}`),f=this.createAssetPlayer(u,d,n),f.loadSource()}if(!this.eventItemsMatch(a,this.bufferingItem)&&u.appendInPlace&&this.isAssetBuffered(d))return;this.startAssetPlayer(f,n,t,e,l),this.shouldPlay&&Dk(f.media)}else a?(this.resumePrimary(a,e,r),this.shouldPlay&&Dk(this.hls.media)):s&&this.isInterstitial(r)&&(this.endedItem=null,this.playingItem=r,r.event.appendInPlace||this.attachPrimary(o.durations.primary,null))}get playbackDisabled(){return this.hls.config.enableInterstitialPlayback===!1}get primaryDetails(){var e;return(e=this.mediaSelection)==null?void 0:e.main.details}get primaryLive(){var e;return!!((e=this.primaryDetails)!=null&&e.live)}resumePrimary(e,t,n){var r,s;if(this.playingItem=e,this.playingAsset=this.endedAsset=null,this.waitingItem=this.endedItem=null,this.bufferedToItem(e),this.log(`resuming ${ou(e)}`),!((r=this.detachedData)!=null&&r.mediaSource)){let a=this.timelinePos;(a<e.start||a>=e.end)&&(a=this.getPrimaryResumption(e,t),this.log(i_("resumePrimary",a)),this.timelinePos=a),this.attachPrimary(a,e)}if(!n)return;const o=(s=this.schedule)==null?void 0:s.items;o&&(this.log(`INTERSTITIALS_PRIMARY_RESUMED ${ou(e)}`),this.hls.trigger(ae.INTERSTITIALS_PRIMARY_RESUMED,{schedule:o.slice(0),scheduleIndex:t}),this.checkBuffer())}getPrimaryResumption(e,t){const n=e.start;if(this.primaryLive){const r=this.primaryDetails;if(t===0)return this.hls.startPosition;if(r&&(n<r.fragmentStart||n>r.edge))return this.hls.liveSyncPosition||-1}return n}isAssetBuffered(e){const t=this.getAssetPlayer(e.identifier);return t!=null&&t.hls?t.hls.bufferedToEnd:Wn.bufferInfo(this.primaryMedia,this.timelinePos,0).end+1>=e.timelineStart+(e.duration||0)}attachPrimary(e,t,n){t?this.setBufferingItem(t):this.bufferingItem=this.playingItem,this.bufferingAsset=null;const r=this.primaryMedia;if(!r)return;const s=this.hls;s.media?this.checkBuffer():(this.transferMediaTo(s,r),n&&this.startLoadingPrimaryAt(e,n)),n||(this.log(i_("attachPrimary",e)),this.timelinePos=e,this.startLoadingPrimaryAt(e,n))}startLoadingPrimaryAt(e,t){var n;const r=this.hls;!r.loadingEnabled||!r.media||Math.abs((((n=r.mainForwardBufferInfo)==null?void 0:n.start)||r.media.currentTime)-e)>.5?r.startLoad(e,t):r.bufferingEnabled||r.resumeBuffering()}onManifestLoading(){var e;this.stopLoad(),(e=this.schedule)==null||e.reset(),this.emptyPlayerQueue(),this.clearScheduleState(),this.shouldPlay=!1,this.bufferedPos=this.timelinePos=-1,this.mediaSelection=this.altSelection=this.manager=this.requiredTracks=null,this.hls.off(ae.BUFFER_CODECS,this.onBufferCodecs,this),this.hls.on(ae.BUFFER_CODECS,this.onBufferCodecs,this)}onLevelUpdated(e,t){if(t.level===-1||!this.schedule)return;const n=this.hls.levels[t.level];if(!n.details)return;const r=Qi(Qi({},this.mediaSelection||this.altSelection),{},{main:n});this.mediaSelection=r,this.schedule.parseInterstitialDateRanges(r,this.hls.config.interstitialAppendInPlace),!this.effectivePlayingItem&&this.schedule.items&&this.checkStart()}onAudioTrackUpdated(e,t){const n=this.hls.audioTracks[t.id],r=this.mediaSelection;if(!r){this.altSelection=Qi(Qi({},this.altSelection),{},{audio:n});return}const s=Qi(Qi({},r),{},{audio:n});this.mediaSelection=s}onSubtitleTrackUpdated(e,t){const n=this.hls.subtitleTracks[t.id],r=this.mediaSelection;if(!r){this.altSelection=Qi(Qi({},this.altSelection),{},{subtitles:n});return}const s=Qi(Qi({},r),{},{subtitles:n});this.mediaSelection=s}onAudioTrackSwitching(e,t){const n=Q7(t);this.playerQueue.forEach(({hls:r})=>r&&(r.setAudioOption(t)||r.setAudioOption(n)))}onSubtitleTrackSwitch(e,t){const n=Q7(t);this.playerQueue.forEach(({hls:r})=>r&&(r.setSubtitleOption(t)||t.id!==-1&&r.setSubtitleOption(n)))}onBufferCodecs(e,t){const n=t.tracks;n&&(this.requiredTracks=n)}onBufferAppended(e,t){this.checkBuffer()}onBufferFlushed(e,t){const n=this.playingItem;if(n&&!this.itemsMatch(n,this.bufferingItem)&&!this.isInterstitial(n)){const r=this.timelinePos;this.bufferedPos=r,this.checkBuffer()}}onBufferedToEnd(e){if(!this.schedule)return;const t=this.schedule.events;if(this.bufferedPos<Number.MAX_VALUE&&t){for(let r=0;r<t.length;r++){const s=t[r];if(s.cue.post){var n;const o=this.schedule.findEventIndex(s.identifier),a=(n=this.schedule.items)==null?void 0:n[o];this.isInterstitial(a)&&this.eventItemsMatch(a,this.bufferingItem)&&this.bufferedToItem(a,0);break}}this.bufferedPos=Number.MAX_VALUE}}onMediaEnded(e){const t=this.playingItem;if(!this.playingLastItem&&t){const n=this.findItemIndex(t);this.setSchedulePosition(n+1)}else this.shouldPlay=!1}updateItem(e,t){var n;const r=(n=this.schedule)==null?void 0:n.items;if(e&&r){const s=this.findItemIndex(e,t);return r[s]||null}return null}trimInPlace(e,t){if(this.isInterstitial(e)&&e.event.appendInPlace&&t.end-e.end>.25){e.event.assetList.forEach((s,o)=>{e.event.isAssetPastPlayoutLimit(o)&&this.clearAssetPlayer(s.identifier,null)});const n=e.end+.25,r=Wn.bufferInfo(this.primaryMedia,n,0);(r.end>n||(r.nextStart||0)>n)&&(this.log(`trim buffered interstitial ${ou(e)} (was ${ou(t)})`),this.attachPrimary(n,null,!0),this.flushFrontBuffer(n))}}itemsMatch(e,t){return!!t&&(e===t||e.event&&t.event&&this.eventItemsMatch(e,t)||!e.event&&!t.event&&this.findItemIndex(e)===this.findItemIndex(t))}eventItemsMatch(e,t){var n;return!!t&&(e===t||e.event.identifier===((n=t.event)==null?void 0:n.identifier))}findItemIndex(e,t){return e&&this.schedule?this.schedule.findItemIndex(e,t):-1}updateSchedule(e=!1){var t;const n=this.mediaSelection;n&&((t=this.schedule)==null||t.updateSchedule(n,[],e))}checkBuffer(e){var t;const n=(t=this.schedule)==null?void 0:t.items;if(!n)return;const r=Wn.bufferInfo(this.primaryMedia,this.timelinePos,0);e&&(this.bufferedPos=this.timelinePos),e||(e=r.len<1),this.updateBufferedPos(r.end,n,e)}updateBufferedPos(e,t,n){const r=this.schedule,s=this.bufferingItem;if(this.bufferedPos>e||!r)return;if(t.length===1&&this.itemsMatch(t[0],s)){this.bufferedPos=e;return}const o=this.playingItem,a=this.findItemIndex(o);let l=r.findItemIndexAtTime(e);if(this.bufferedPos<e){var c;const u=this.findItemIndex(s),h=Math.min(u+1,t.length-1),f=t[h];if((l===-1&&s&&e>=s.end||(c=f.event)!=null&&c.appendInPlace&&e+.01>=f.start)&&(l=h),this.isInterstitial(s)){const d=s.event;if(h-a>1&&d.appendInPlace===!1||d.assetList.length===0&&d.assetListLoader)return}if(this.bufferedPos=e,l>u&&l>a)this.bufferedToItem(f);else{const d=this.primaryDetails;this.primaryLive&&d&&e>d.edge-d.targetduration&&f.start<d.edge+this.hls.config.interstitialLiveLookAhead&&this.isInterstitial(f)&&this.preloadAssets(f.event,0)}}else n&&o&&!this.itemsMatch(o,s)&&(l===a?this.bufferedToItem(o):l===a+1&&this.bufferedToItem(t[l]))}assetsBuffered(e,t){return e.event.assetList.length===0?!1:!e.event.assetList.some(r=>{const s=this.getAssetPlayer(r.identifier);return!(s!=null&&s.bufferedInPlaceToEnd(t))})}setBufferingItem(e){const t=this.bufferingItem,n=this.schedule;if(!this.itemsMatch(e,t)&&n){const{items:r,events:s}=n;if(!r||!s)return t;const o=this.isInterstitial(e),a=this.getBufferingPlayer();this.bufferingItem=e,this.bufferedPos=Math.max(e.start,Math.min(e.end,this.timelinePos));const l=a?a.remaining:t?t.end-this.timelinePos:0;if(this.log(`INTERSTITIALS_BUFFERED_TO_BOUNDARY ${ou(e)}`+(t?` (${l.toFixed(2)} remaining)`:"")),!this.playbackDisabled)if(o){const c=n.findAssetIndex(e.event,this.bufferedPos);e.event.assetList.forEach((u,h)=>{const f=this.getAssetPlayer(u.identifier);f&&(h===c&&f.loadSource(),f.resumeBuffering())})}else this.hls.resumeBuffering(),this.playerQueue.forEach(c=>c.pauseBuffering());this.hls.trigger(ae.INTERSTITIALS_BUFFERED_TO_BOUNDARY,{events:s.slice(0),schedule:r.slice(0),bufferingIndex:this.findItemIndex(e),playingIndex:this.findItemIndex(this.playingItem)})}else this.bufferingItem!==e&&(this.bufferingItem=e);return t}bufferedToItem(e,t=0){const n=this.setBufferingItem(e);if(!this.playbackDisabled){if(this.isInterstitial(e))this.bufferedToEvent(e,t);else if(n!==null){this.bufferingAsset=null;const r=this.detachedData;r?r.mediaSource?this.attachPrimary(e.start,e,!0):this.preloadPrimary(e):this.preloadPrimary(e)}}}preloadPrimary(e){const t=this.findItemIndex(e),n=this.getPrimaryResumption(e,t);this.startLoadingPrimaryAt(n)}bufferedToEvent(e,t){const n=e.event,r=n.assetList.length===0&&!n.assetListLoader,s=n.cue.once;if(r||!s){const o=this.preloadAssets(n,t);if(o!=null&&o.interstitial.appendInPlace){const a=this.primaryMedia;a&&this.bufferAssetPlayer(o,a)}}}preloadAssets(e,t){const n=e.assetUrl,r=e.assetList.length,s=r===0&&!e.assetListLoader,o=e.cue.once;if(s){const l=e.timelineStart;if(e.appendInPlace){var a;const f=this.playingItem;!this.isInterstitial(f)&&(f==null||(a=f.nextEvent)==null?void 0:a.identifier)===e.identifier&&this.flushFrontBuffer(l+.25)}let c,u=0;if(!this.playingItem&&this.primaryLive&&(u=this.hls.startPosition,u===-1&&(u=this.hls.liveSyncPosition||0)),u&&!(e.cue.pre||e.cue.post)){const f=u-l;f>0&&(c=Math.round(f*1e3)/1e3)}if(this.log(`Load interstitial asset ${t+1}/${n?1:r} ${e}${c?` live-start: ${u} start-offset: ${c}`:""}`),n)return this.createAsset(e,0,0,l,e.duration,n);const h=this.assetListLoader.loadAssetList(e,c);h&&(e.assetListLoader=h)}else if(!o&&r){for(let c=t;c<r;c++){const u=e.assetList[c],h=this.getAssetPlayerQueueIndex(u.identifier);(h===-1||this.playerQueue[h].destroyed)&&!u.error&&this.createAssetPlayer(e,u,c)}const l=e.assetList[t];if(l){const c=this.getAssetPlayer(l.identifier);return c&&c.loadSource(),c}}return null}flushFrontBuffer(e){const t=this.requiredTracks;if(!t)return;this.log(`Removing front buffer starting at ${e}`),Object.keys(t).forEach(r=>{this.hls.trigger(ae.BUFFER_FLUSHING,{startOffset:e,endOffset:1/0,type:r})})}getAssetPlayerQueueIndex(e){const t=this.playerQueue;for(let n=0;n<t.length;n++)if(e===t[n].assetId)return n;return-1}getAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);return this.playerQueue[t]||null}getBufferingPlayer(){const{playerQueue:e,primaryMedia:t}=this;if(t){for(let n=0;n<e.length;n++)if(e[n].media===t)return e[n]}return null}createAsset(e,t,n,r,s,o){const a={parentIdentifier:e.identifier,identifier:Oge(e,o,t),duration:s,startOffset:n,timelineStart:r,uri:o};return this.createAssetPlayer(e,a,t)}createAssetPlayer(e,t,n){const r=this.hls,s=r.userConfig;let o=s.videoPreference;const a=r.loadLevelObj||r.levels[r.currentLevel];(o||a)&&(o=er({},o),a.videoCodec&&(o.videoCodec=a.videoCodec),a.videoRange&&(o.allowedVideoRanges=[a.videoRange]));const l=r.audioTracks[r.audioTrack],c=r.subtitleTracks[r.subtitleTrack];let u=0;if(this.primaryLive||e.appendInPlace){const w=this.timelinePos-t.timelineStart;if(w>1){const T=t.duration;T&&w<T&&(u=w)}}const h=t.identifier,f=Qi(Qi({},s),{},{maxMaxBufferLength:Math.min(180,r.config.maxMaxBufferLength),autoStartLoad:!0,startFragPrefetch:!0,primarySessionId:r.sessionId,assetPlayerId:h,abrEwmaDefaultEstimate:r.bandwidthEstimate,interstitialsController:void 0,startPosition:u,liveDurationInfinity:!1,testBandwidth:!1,videoPreference:o,audioPreference:l||s.audioPreference,subtitlePreference:c||s.subtitlePreference});e.appendInPlace&&(e.appendInPlaceStarted=!0,t.timelineStart&&(f.timelineOffset=t.timelineStart));const d=f.cmcd;d!=null&&d.sessionId&&d.contentId&&(f.cmcd=er({},d,{contentId:f2(t.uri)})),this.getAssetPlayer(h)&&this.warn(`Duplicate date range identifier ${e} and asset ${h}`);const m=new zge(this.HlsPlayerClass,f,e,t);this.playerQueue.push(m),e.assetList[n]=t;let y=!0;const g=w=>{if(w.live){var T;const L=new Error(`Interstitials MUST be VOD assets ${e}`),P={fatal:!0,type:rn.OTHER_ERROR,details:Ke.INTERSTITIAL_ASSET_ITEM_ERROR,error:L},R=((T=this.schedule)==null?void 0:T.findEventIndex(e.identifier))||-1;this.handleAssetItemError(P,e,R,n,L.message);return}const I=w.edge-w.fragmentStart,M=t.duration;(y||M===null||I>M)&&(y=!1,this.log(`Interstitial asset "${h}" duration change ${M} > ${I}`),t.duration=I,this.updateSchedule())};m.on(ae.LEVEL_UPDATED,(w,{details:T})=>g(T)),m.on(ae.LEVEL_PTS_UPDATED,(w,{details:T})=>g(T)),m.on(ae.EVENT_CUE_ENTER,()=>this.onInterstitialCueEnter());const A=(w,T)=>{const I=this.getAssetPlayer(h);if(I&&T.tracks){I.off(ae.BUFFER_CODECS,A),I.tracks=T.tracks;const M=this.primaryMedia;this.bufferingAsset===I.assetItem&&M&&!I.media&&this.bufferAssetPlayer(I,M)}};m.on(ae.BUFFER_CODECS,A);const E=()=>{var w;const T=this.getAssetPlayer(h);if(this.log(`buffered to end of asset ${T}`),!T||!this.schedule)return;const I=this.schedule.findEventIndex(e.identifier),M=(w=this.schedule.items)==null?void 0:w[I];this.isInterstitial(M)&&this.advanceAssetBuffering(M,t)};m.on(ae.BUFFERED_TO_END,E);const x=w=>()=>{if(!this.getAssetPlayer(h)||!this.schedule)return;this.shouldPlay=!0;const I=this.schedule.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,I,w)};return m.once(ae.MEDIA_ENDED,x(n)),m.once(ae.PLAYOUT_LIMIT_REACHED,x(1/0)),m.on(ae.ERROR,(w,T)=>{if(!this.schedule)return;const I=this.getAssetPlayer(h);if(T.details===Ke.BUFFER_STALLED_ERROR){if(I!=null&&I.appendInPlace){this.handleInPlaceStall(e);return}this.onTimeupdate(),this.checkBuffer(!0);return}this.handleAssetItemError(T,e,this.schedule.findEventIndex(e.identifier),n,`Asset player error ${T.error} ${e}`)}),m.on(ae.DESTROYING,()=>{if(!this.getAssetPlayer(h)||!this.schedule)return;const T=new Error(`Asset player destroyed unexpectedly ${h}`),I={fatal:!0,type:rn.OTHER_ERROR,details:Ke.INTERSTITIAL_ASSET_ITEM_ERROR,error:T};this.handleAssetItemError(I,e,this.schedule.findEventIndex(e.identifier),n,T.message)}),this.log(`INTERSTITIAL_ASSET_PLAYER_CREATED ${b1(t)}`),this.hls.trigger(ae.INTERSTITIAL_ASSET_PLAYER_CREATED,{asset:t,assetListIndex:n,event:e,player:m}),m}clearInterstitial(e,t){this.clearAssetPlayers(e,t),e.reset()}clearAssetPlayers(e,t){e.assetList.forEach(n=>{this.clearAssetPlayer(n.identifier,t)})}resetAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);if(t!==-1){this.log(`reset asset player "${e}" after error`);const n=this.playerQueue[t];this.transferMediaFromPlayer(n,null),n.resetDetails()}}clearAssetPlayer(e,t){const n=this.getAssetPlayerQueueIndex(e);if(n!==-1){const r=this.playerQueue[n];this.log(`clear ${r} toSegment: ${t&&ou(t)}`),this.transferMediaFromPlayer(r,t),this.playerQueue.splice(n,1),r.destroy()}}emptyPlayerQueue(){let e;for(;e=this.playerQueue.pop();)e.destroy();this.playerQueue=[]}startAssetPlayer(e,t,n,r,s){const{interstitial:o,assetItem:a,assetId:l}=e,c=o.assetList.length,u=this.playingAsset;this.endedAsset=null,this.playingAsset=a,(!u||u.identifier!==l)&&(u&&(this.clearAssetPlayer(u.identifier,n[r]),delete u.error),this.log(`INTERSTITIAL_ASSET_STARTED ${t+1}/${c} ${b1(a)}`),this.hls.trigger(ae.INTERSTITIAL_ASSET_STARTED,{asset:a,assetListIndex:t,event:o,schedule:n.slice(0),scheduleIndex:r,player:e})),this.bufferAssetPlayer(e,s)}bufferAssetPlayer(e,t){var n,r;if(!this.schedule)return;const{interstitial:s,assetItem:o}=e,a=this.schedule.findEventIndex(s.identifier),l=(n=this.schedule.items)==null?void 0:n[a];if(!l)return;e.loadSource(),this.setBufferingItem(l),this.bufferingAsset=o;const c=this.getBufferingPlayer();if(c===e)return;const u=s.appendInPlace;if(u&&(c==null?void 0:c.interstitial.appendInPlace)===!1)return;const h=(c==null?void 0:c.tracks)||((r=this.detachedData)==null?void 0:r.tracks)||this.requiredTracks;if(u&&o!==this.playingAsset){if(!e.tracks){this.log(`Waiting for track info before buffering ${e}`);return}if(h&&!bQ(h,e.tracks)){const f=new Error(`Asset ${b1(o)} SourceBuffer tracks ('${Object.keys(e.tracks)}') are not compatible with primary content tracks ('${Object.keys(h)}')`),d={fatal:!0,type:rn.OTHER_ERROR,details:Ke.INTERSTITIAL_ASSET_ITEM_ERROR,error:f},m=s.findAssetIndex(o);this.handleAssetItemError(d,s,a,m,f.message);return}}this.transferMediaTo(e,t)}handleInPlaceStall(e){const t=this.schedule,n=this.primaryMedia;if(!t||!n)return;const r=n.currentTime,s=t.findAssetIndex(e,r),o=e.assetList[s];if(o){const a=this.getAssetPlayer(o.identifier);if(a){const l=a.currentTime||r-o.timelineStart,c=a.duration-l;if(this.warn(`Stalled at ${l} of ${l+c} in ${a} ${e} (media.currentTime: ${r})`),l&&(c/n.playbackRate<.5||a.bufferedInPlaceToEnd(n))&&a.hls){const u=t.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,u,s)}}}}advanceInPlace(e){const t=this.primaryMedia;t&&t.currentTime<e&&(t.currentTime=e)}handleAssetItemError(e,t,n,r,s){if(e.details===Ke.BUFFER_STALLED_ERROR)return;const o=t.assetList[r]||null;if(this.warn(`INTERSTITIAL_ASSET_ERROR ${o&&b1(o)} ${e.error}`),!this.schedule)return;const a=(o==null?void 0:o.identifier)||"",l=this.getAssetPlayerQueueIndex(a),c=this.playerQueue[l]||null,u=this.schedule.items,h=er({},e,{fatal:!1,errorAction:Y1(!0),asset:o,assetListIndex:r,event:t,schedule:u,scheduleIndex:n,player:c});if(this.hls.trigger(ae.INTERSTITIAL_ASSET_ERROR,h),!e.fatal)return;const f=this.playingAsset,d=this.bufferingAsset,m=new Error(s);if(o&&(this.clearAssetPlayer(a,null),o.error=m),!t.assetList.some(y=>!y.error))t.error=m;else for(let y=r;y<t.assetList.length;y++)this.resetAssetPlayer(t.assetList[y].identifier);this.updateSchedule(!0),t.error?this.primaryFallback(t):f&&f.identifier===a?this.advanceAfterAssetEnded(t,n,r):d&&d.identifier===a&&this.isInterstitial(this.bufferingItem)&&this.advanceAssetBuffering(this.bufferingItem,d)}primaryFallback(e){const t=e.timelineStart,n=this.effectivePlayingItem;let r=this.timelinePos;if(n){this.log(`Fallback to primary from event "${e.identifier}" start: ${t} pos: ${r} playing: ${ou(n)} error: ${e.error}`),r===-1&&(r=this.hls.startPosition);const o=this.updateItem(n,r);this.itemsMatch(n,o)&&this.clearInterstitial(e,null),e.appendInPlace&&(this.attachPrimary(t,null),this.flushFrontBuffer(t))}else if(r===-1){this.checkStart();return}if(!this.schedule)return;const s=this.schedule.findItemIndexAtTime(r);this.setSchedulePosition(s)}onAssetListLoaded(e,t){var n,r;const s=t.event,o=s.identifier,a=t.assetListResponse.ASSETS;if(!((n=this.schedule)!=null&&n.hasEvent(o)))return;const l=s.timelineStart,c=s.duration;let u=0;a.forEach((y,g)=>{const A=parseFloat(y.DURATION);this.createAsset(s,g,u,l+u,A,y.URI),u+=A}),s.duration=u,this.log(`Loaded asset-list with duration: ${u} (was: ${c}) ${s}`);const h=this.waitingItem,f=(h==null?void 0:h.event.identifier)===o;this.updateSchedule();const d=(r=this.bufferingItem)==null?void 0:r.event;if(f){var m;const y=this.schedule.findEventIndex(o),g=(m=this.schedule.items)==null?void 0:m[y];if(g){if(!this.playingItem&&this.timelinePos>g.end&&this.schedule.findItemIndexAtTime(this.timelinePos)!==y){s.error=new Error(`Interstitial ${a.length?"no longer within playback range":"asset-list is empty"} ${this.timelinePos} ${s}`),this.log(s.error.message),this.updateSchedule(!0),this.primaryFallback(s);return}this.setBufferingItem(g)}this.setSchedulePosition(y)}else if((d==null?void 0:d.identifier)===o){const y=s.assetList[0];if(y){const g=this.getAssetPlayer(y.identifier);if(d.appendInPlace){const A=this.primaryMedia;g&&A&&this.bufferAssetPlayer(g,A)}else g&&g.loadSource()}}}onError(e,t){if(this.schedule)switch(t.details){case Ke.ASSET_LIST_PARSING_ERROR:case Ke.ASSET_LIST_LOAD_ERROR:case Ke.ASSET_LIST_LOAD_TIMEOUT:{const n=t.interstitial;n&&(this.updateSchedule(!0),this.primaryFallback(n));break}case Ke.BUFFER_STALLED_ERROR:{const n=this.endedItem||this.waitingItem||this.playingItem;if(this.isInterstitial(n)&&n.event.appendInPlace){this.handleInPlaceStall(n.event);return}this.log(`Primary player stall @${this.timelinePos} bufferedPos: ${this.bufferedPos}`),this.onTimeupdate(),this.checkBuffer(!0);break}}}}const kk=500;class ej extends E4{constructor(e,t,n){super(e,t,n,"subtitle-stream-controller",$t.SUBTITLE),this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(ae.LEVEL_LOADED,this.onLevelLoaded,this),e.on(ae.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(ae.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(ae.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(ae.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(ae.BUFFER_FLUSHING,this.onBufferFlushing,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(ae.LEVEL_LOADED,this.onLevelLoaded,this),e.off(ae.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(ae.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(ae.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(ae.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(ae.BUFFER_FLUSHING,this.onBufferFlushing,this)}startLoad(e,t){this.stopLoad(),this.state=mt.IDLE,this.setInterval(kk),this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}onManifestLoading(){super.onManifestLoading(),this.mainDetails=null}onMediaDetaching(e,t){this.tracksBuffered=[],super.onMediaDetaching(e,t)}onLevelLoaded(e,t){this.mainDetails=t.details}onSubtitleFragProcessed(e,t){const{frag:n,success:r}=t;if(this.fragContextChanged(n)||(As(n)&&(this.fragPrevious=n),this.state=mt.IDLE),!r)return;const s=this.tracksBuffered[this.currentTrackId];if(!s)return;let o;const a=n.start;for(let c=0;c<s.length;c++)if(a>=s[c].start&&a<=s[c].end){o=s[c];break}const l=n.start+n.duration;o?o.end=l:(o={start:a,end:l},s.push(o)),this.fragmentTracker.fragBuffered(n),this.fragBufferedComplete(n,null),this.media&&this.tick()}onBufferFlushing(e,t){const{startOffset:n,endOffset:r}=t;if(n===0&&r!==Number.POSITIVE_INFINITY){const s=r-1;if(s<=0)return;t.endOffsetSubtitles=Math.max(0,s),this.tracksBuffered.forEach(o=>{for(let a=0;a<o.length;){if(o[a].end<=s){o.shift();continue}else if(o[a].start<s)o[a].start=s;else break;a++}}),this.fragmentTracker.removeFragmentsInRange(n,s,$t.SUBTITLE)}}onError(e,t){const n=t.frag;(n==null?void 0:n.type)===$t.SUBTITLE&&(t.details===Ke.FRAG_GAP&&this.fragmentTracker.fragBuffered(n,!0),this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==mt.STOPPED&&(this.state=mt.IDLE))}onSubtitleTracksUpdated(e,{subtitleTracks:t}){if(this.levels&&LV(this.levels,t)){this.levels=t.map(n=>new hA(n));return}this.tracksBuffered=[],this.levels=t.map(n=>{const r=new hA(n);return this.tracksBuffered[r.id]=[],r}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,$t.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null}onSubtitleTrackSwitch(e,t){var n;if(this.currentTrackId=t.id,!((n=this.levels)!=null&&n.length)||this.currentTrackId===-1){this.clearInterval();return}const r=this.levels[this.currentTrackId];r!=null&&r.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,r&&this.state!==mt.STOPPED&&this.setInterval(kk)}onSubtitleTrackLoaded(e,t){var n;const{currentTrackId:r,levels:s}=this,{details:o,id:a}=t;if(!s){this.warn(`Subtitle tracks were reset while loading level ${a}`);return}const l=s[a];if(a>=s.length||!l)return;this.log(`Subtitle track ${a} loaded [${o.startSN},${o.endSN}]${o.lastPartSn?`[part-${o.lastPartSn}-${o.lastPartIndex}]`:""},duration:${o.totalduration}`),this.mediaBuffer=this.mediaBufferTimeRanges;let c=0;if(o.live||(n=l.details)!=null&&n.live){if(o.deltaUpdateFailed)return;const h=this.mainDetails;if(!h){this.startFragRequested=!1;return}const f=h.fragments[0];if(!l.details)o.hasProgramDateTime&&h.hasProgramDateTime?(qS(o,h),c=o.fragmentStart):f&&(c=f.start,T5(o,c));else{var u;c=this.alignPlaylists(o,l.details,(u=this.levelLastLoaded)==null?void 0:u.details),c===0&&f&&(c=f.start,T5(o,c))}h&&!this.startFragRequested&&this.setStartPosition(h,c)}l.details=o,this.levelLastLoaded=l,a===r&&(this.hls.trigger(ae.SUBTITLE_TRACK_UPDATED,{details:o,id:a,groupId:t.groupId}),this.tick(),o.live&&!this.fragCurrent&&this.media&&this.state===mt.IDLE&&(o0(null,o.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),l.details=void 0)))}_handleFragmentLoadComplete(e){const{frag:t,payload:n}=e,r=t.decryptdata,s=this.hls;if(!this.fragContextChanged(t)&&n&&n.byteLength>0&&r!=null&&r.key&&r.iv&&$1(r.method)){const o=performance.now();this.decrypter.decrypt(new Uint8Array(n),r.key.buffer,r.iv.buffer,jR(r.method)).catch(a=>{throw s.trigger(ae.ERROR,{type:rn.MEDIA_ERROR,details:Ke.FRAG_DECRYPT_ERROR,fatal:!1,error:a,reason:a.message,frag:t}),a}).then(a=>{const l=performance.now();s.trigger(ae.FRAG_DECRYPTED,{frag:t,payload:a,stats:{tstart:o,tdecrypt:l}})}).catch(a=>{this.warn(`${a.name}: ${a.message}`),this.state=mt.IDLE})}}doTick(){if(!this.media){this.state=mt.IDLE;return}if(this.state===mt.IDLE){const{currentTrackId:e,levels:t}=this,n=t==null?void 0:t[e];if(!n||!t.length||!n.details||this.waitForLive(n))return;const{config:r}=this,s=this.getLoadPosition(),o=Wn.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],s,r.maxBufferHole),{end:a,len:l}=o,c=n.details,u=this.hls.maxBufferLength+c.levelTargetDuration;if(l>u)return;const h=c.fragments,f=h.length,d=c.edge;let m=null;const y=this.fragPrevious;if(a<d){const E=r.maxFragLookUpTolerance,x=a>d-E?0:E;m=o0(y,h,Math.max(h[0].start,a),x),!m&&y&&y.start<h[0].start&&(m=h[0])}else m=h[f-1];if(m=this.filterReplacedPrimary(m,n.details),!m)return;const g=m.sn-c.startSN,A=h[g-1];if(A&&A.cc===m.cc&&this.fragmentTracker.getState(A)===eo.NOT_LOADED&&(m=A),this.fragmentTracker.getState(m)===eo.NOT_LOADED){const E=this.mapToInitFragWhenRequired(m);E&&this.loadFragment(E,n,a)}}}loadFragment(e,t,n){As(e)?super.loadFragment(e,t,n):this._loadInitSegment(e,t)}get mediaBufferTimeRanges(){return new Vge(this.tracksBuffered[this.currentTrackId]||[])}}class Vge{constructor(e){this.buffered=void 0;const t=(n,r,s)=>{if(r=r>>>0,r>s-1)throw new DOMException(`Failed to execute '${n}' on 'TimeRanges': The index provided (${r}) is greater than the maximum bound (${s})`);return e[r][n]};this.buffered={get length(){return e.length},end(n){return t("end",n,e.length)},start(n){return t("start",n,e.length)}}}}const jge={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},tj=i=>String.fromCharCode(jge[i]||i),hu=15,mf=100,Wge={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},Kge={17:2,18:4,21:6,22:8,23:10,19:13,20:15},Yge={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},$ge={25:2,26:4,29:6,30:8,31:10,27:13,28:15},Xge=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class qge{constructor(){this.time=null,this.verboseLevel=0}log(e,t){if(this.verboseLevel>=e){const n=typeof t=="function"?t():t;Ki.log(`${this.time} [${e}] ${n}`)}}}const xm=function(e){const t=[];for(let n=0;n<e.length;n++)t.push(e[n].toString(16));return t};class nj{constructor(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(e){const t=["foreground","underline","italics","background","flash"];for(let n=0;n<t.length;n++){const r=t[n];e.hasOwnProperty(r)&&(this[r]=e[r])}}isDefault(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash}equals(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}copy(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class Jge{constructor(){this.uchar=" ",this.penState=new nj}reset(){this.uchar=" ",this.penState.reset()}setChar(e,t){this.uchar=e,this.penState.copy(t)}setPenState(e){this.penState.copy(e)}equals(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}copy(e){this.uchar=e.uchar,this.penState.copy(e.penState)}isEmpty(){return this.uchar===" "&&this.penState.isDefault()}}class Zge{constructor(e){this.chars=[],this.pos=0,this.currPenState=new nj,this.cueStartTime=null,this.logger=void 0;for(let t=0;t<mf;t++)this.chars.push(new Jge);this.logger=e}equals(e){for(let t=0;t<mf;t++)if(!this.chars[t].equals(e.chars[t]))return!1;return!0}copy(e){for(let t=0;t<mf;t++)this.chars[t].copy(e.chars[t])}isEmpty(){let e=!0;for(let t=0;t<mf;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}setCursor(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>mf&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=mf)}moveCursor(e){const t=this.pos+e;if(e>1)for(let n=this.pos+1;n<t+1;n++)this.chars[n].setPenState(this.currPenState);this.setCursor(t)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(e){e>=144&&this.backSpace();const t=tj(e);if(this.pos>=mf){this.logger.log(0,()=>"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1)}clearFromPos(e){let t;for(t=e;t<mf;t++)this.chars[t].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const e=[];let t=!0;for(let n=0;n<mf;n++){const r=this.chars[n].uchar;r!==" "&&(t=!1),e.push(r)}return t?"":e.join("")}setPenStyles(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)}}class Kb{constructor(e){this.rows=[],this.currRow=hu-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(let t=0;t<hu;t++)this.rows.push(new Zge(e));this.logger=e}reset(){for(let e=0;e<hu;e++)this.rows[e].clear();this.currRow=hu-1}equals(e){let t=!0;for(let n=0;n<hu;n++)if(!this.rows[n].equals(e.rows[n])){t=!1;break}return t}copy(e){for(let t=0;t<hu;t++)this.rows[t].copy(e.rows[t])}isEmpty(){let e=!0;for(let t=0;t<hu;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(e){this.rows[this.currRow].insertChar(e)}setPen(e){this.rows[this.currRow].setPenStyles(e)}moveCursor(e){this.rows[this.currRow].moveCursor(e)}setCursor(e){this.logger.log(2,"setCursor: "+e),this.rows[this.currRow].setCursor(e)}setPAC(e){this.logger.log(2,()=>"pacData = "+lr(e));let t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(let a=0;a<hu;a++)this.rows[a].clear();const s=this.currRow+1-this.nrRollUpRows,o=this.lastOutputScreen;if(o){const a=o.rows[s].cueStartTime,l=this.logger.time;if(a!==null&&l!==null&&a<l)for(let c=0;c<this.nrRollUpRows;c++)this.rows[t-this.nrRollUpRows+c+1].copy(o.rows[s+c])}}this.currRow=t;const n=this.rows[this.currRow];if(e.indent!==null){const s=e.indent,o=Math.max(s-1,0);n.setCursor(e.indent),e.color=n.chars[o].penState.foreground}const r={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(r)}setBkgData(e){this.logger.log(2,()=>"bkgData = "+lr(e)),this.backSpace(),this.setPen(e),this.insertChar(32)}setRollUpRows(e){this.nrRollUpRows=e}rollUp(){if(this.nrRollUpRows===null){this.logger.log(3,"roll_up but nrRollUpRows not set yet");return}this.logger.log(1,()=>this.getDisplayText());const e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(2,"Rolling up")}getDisplayText(e){e=e||!1;const t=[];let n="",r=-1;for(let s=0;s<hu;s++){const o=this.rows[s].getTextString();o&&(r=s+1,e?t.push("Row "+r+": '"+o+"'"):t.push(o.trim()))}return t.length>0&&(e?n="["+t.join(" | ")+"]":n=t.join(`
`)),n}getTextAndFormat(){return this.rows}}class Fk{constructor(e,t,n){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new Kb(n),this.nonDisplayedMemory=new Kb(n),this.lastOutputScreen=new Kb(n),this.currRollUpRow=this.displayedMemory.rows[hu-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=n}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[hu-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(e){this.outputFilter=e}setPAC(e){this.writeScreen.setPAC(e)}setBkgData(e){this.writeScreen.setBkgData(e)}setMode(e){e!==this.mode&&(this.mode=e,this.logger.log(2,()=>"MODE="+e),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}insertChars(e){for(let n=0;n<e.length;n++)this.writeScreen.insertChar(e[n]);const t=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>t+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){const e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}ccMIDROW(e){const t={flash:!1};if(t.underline=e%2===1,t.italics=e>=46,t.italics)t.foreground="white";else{const n=Math.floor(e/2)-16,r=["white","green","blue","cyan","red","yellow","magenta"];t.foreground=r[n]}this.logger.log(2,"MIDROW: "+lr(t)),this.writeScreen.setPen(t)}outputDataUpdate(e=!1){const t=this.logger.time;t!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=t:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t),this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}}class Ok{constructor(e,t,n){this.channels=void 0,this.currentChannel=0,this.cmdHistory=t1e(),this.logger=void 0;const r=this.logger=new qge;this.channels=[null,new Fk(e,t,r),new Fk(e+1,n,r)]}getHandler(e){return this.channels[e].getHandler()}setHandler(e,t){this.channels[e].setHandler(t)}addData(e,t){this.logger.time=e;for(let n=0;n<t.length;n+=2){const r=t[n]&127,s=t[n+1]&127;let o=!1,a=null;if(r===0&&s===0)continue;this.logger.log(3,()=>"["+xm([t[n],t[n+1]])+"] -> ("+xm([r,s])+")");const l=this.cmdHistory;if(r>=16&&r<=31){if(e1e(r,s,l)){r_(null,null,l),this.logger.log(3,()=>"Repeated command ("+xm([r,s])+") is dropped");continue}r_(r,s,this.cmdHistory),o=this.parseCmd(r,s),o||(o=this.parseMidrow(r,s)),o||(o=this.parsePAC(r,s)),o||(o=this.parseBackgroundAttributes(r,s))}else r_(null,null,l);if(!o&&(a=this.parseChars(r,s),a)){const u=this.currentChannel;u&&u>0?this.channels[u].insertChars(a):this.logger.log(2,"No channel found yet. TEXT-MODE?")}!o&&!a&&this.logger.log(2,()=>"Couldn't parse cleaned data "+xm([r,s])+" orig: "+xm([t[n],t[n+1]]))}}parseCmd(e,t){const n=(e===20||e===28||e===21||e===29)&&t>=32&&t<=47,r=(e===23||e===31)&&t>=33&&t<=35;if(!(n||r))return!1;const s=e===20||e===21||e===23?1:2,o=this.channels[s];return e===20||e===21||e===28||e===29?t===32?o.ccRCL():t===33?o.ccBS():t===34?o.ccAOF():t===35?o.ccAON():t===36?o.ccDER():t===37?o.ccRU(2):t===38?o.ccRU(3):t===39?o.ccRU(4):t===40?o.ccFON():t===41?o.ccRDC():t===42?o.ccTR():t===43?o.ccRTD():t===44?o.ccEDM():t===45?o.ccCR():t===46?o.ccENM():t===47&&o.ccEOC():o.ccTO(t-32),this.currentChannel=s,!0}parseMidrow(e,t){let n=0;if((e===17||e===25)&&t>=32&&t<=47){if(e===17?n=1:n=2,n!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const r=this.channels[n];return r?(r.ccMIDROW(t),this.logger.log(3,()=>"MIDROW ("+xm([e,t])+")"),!0):!1}return!1}parsePAC(e,t){let n;const r=(e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127,s=(e===16||e===24)&&t>=64&&t<=95;if(!(r||s))return!1;const o=e<=23?1:2;t>=64&&t<=95?n=o===1?Wge[e]:Yge[e]:n=o===1?Kge[e]:$ge[e];const a=this.channels[o];return a?(a.setPAC(this.interpretPAC(n,t)),this.currentChannel=o,!0):!1}interpretPAC(e,t){let n;const r={color:null,italics:!1,indent:null,underline:!1,row:e};return t>95?n=t-96:n=t-64,r.underline=(n&1)===1,n<=13?r.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(n/2)]:n<=15?(r.italics=!0,r.color="white"):r.indent=Math.floor((n-16)/2)*4,r}parseChars(e,t){let n,r=null,s=null;if(e>=25?(n=2,s=e-8):(n=1,s=e),s>=17&&s<=19){let o;s===17?o=t+80:s===18?o=t+112:o=t+144,this.logger.log(2,()=>"Special char '"+tj(o)+"' in channel "+n),r=[o]}else e>=32&&e<=127&&(r=t===0?[e]:[e,t]);return r&&this.logger.log(3,()=>"Char codes =  "+xm(r).join(",")),r}parseBackgroundAttributes(e,t){const n=(e===16||e===24)&&t>=32&&t<=47,r=(e===23||e===31)&&t>=45&&t<=47;if(!(n||r))return!1;let s;const o={};e===16||e===24?(s=Math.floor((t-32)/2),o.background=Xge[s],t%2===1&&(o.background=o.background+"_semi")):t===45?o.background="transparent":(o.foreground="black",t===47&&(o.underline=!0));const a=e<=23?1:2;return this.channels[a].setBkgData(o),!0}reset(){for(let e=0;e<Object.keys(this.channels).length;e++){const t=this.channels[e];t&&t.reset()}r_(null,null,this.cmdHistory)}cueSplitAtTime(e){for(let t=0;t<this.channels.length;t++){const n=this.channels[t];n&&n.cueSplitAtTime(e)}}}function r_(i,e,t){t.a=i,t.b=e}function e1e(i,e,t){return t.a===i&&t.b===e}function t1e(){return{a:null,b:null}}var i8=(function(){if(XS!=null&&XS.VTTCue)return self.VTTCue;const i=["","lr","rl"],e=["start","middle","end","left","right"];function t(a,l){if(typeof l!="string"||!Array.isArray(a))return!1;const c=l.toLowerCase();return~a.indexOf(c)?c:!1}function n(a){return t(i,a)}function r(a){return t(e,a)}function s(a,...l){let c=1;for(;c<arguments.length;c++){const u=arguments[c];for(const h in u)a[h]=u[h]}return a}function o(a,l,c){const u=this,h={enumerable:!0};u.hasBeenReset=!1;let f="",d=!1,m=a,y=l,g=c,A=null,E="",x=!0,w="auto",T="start",I=50,M="middle",L=50,P="middle";Object.defineProperty(u,"id",s({},h,{get:function(){return f},set:function(R){f=""+R}})),Object.defineProperty(u,"pauseOnExit",s({},h,{get:function(){return d},set:function(R){d=!!R}})),Object.defineProperty(u,"startTime",s({},h,{get:function(){return m},set:function(R){if(typeof R!="number")throw new TypeError("Start time must be set to a number.");m=R,this.hasBeenReset=!0}})),Object.defineProperty(u,"endTime",s({},h,{get:function(){return y},set:function(R){if(typeof R!="number")throw new TypeError("End time must be set to a number.");y=R,this.hasBeenReset=!0}})),Object.defineProperty(u,"text",s({},h,{get:function(){return g},set:function(R){g=""+R,this.hasBeenReset=!0}})),Object.defineProperty(u,"region",s({},h,{get:function(){return A},set:function(R){A=R,this.hasBeenReset=!0}})),Object.defineProperty(u,"vertical",s({},h,{get:function(){return E},set:function(R){const U=n(R);if(U===!1)throw new SyntaxError("An invalid or illegal string was specified.");E=U,this.hasBeenReset=!0}})),Object.defineProperty(u,"snapToLines",s({},h,{get:function(){return x},set:function(R){x=!!R,this.hasBeenReset=!0}})),Object.defineProperty(u,"line",s({},h,{get:function(){return w},set:function(R){if(typeof R!="number"&&R!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");w=R,this.hasBeenReset=!0}})),Object.defineProperty(u,"lineAlign",s({},h,{get:function(){return T},set:function(R){const U=r(R);if(!U)throw new SyntaxError("An invalid or illegal string was specified.");T=U,this.hasBeenReset=!0}})),Object.defineProperty(u,"position",s({},h,{get:function(){return I},set:function(R){if(R<0||R>100)throw new Error("Position must be between 0 and 100.");I=R,this.hasBeenReset=!0}})),Object.defineProperty(u,"positionAlign",s({},h,{get:function(){return M},set:function(R){const U=r(R);if(!U)throw new SyntaxError("An invalid or illegal string was specified.");M=U,this.hasBeenReset=!0}})),Object.defineProperty(u,"size",s({},h,{get:function(){return L},set:function(R){if(R<0||R>100)throw new Error("Size must be between 0 and 100.");L=R,this.hasBeenReset=!0}})),Object.defineProperty(u,"align",s({},h,{get:function(){return P},set:function(R){const U=r(R);if(!U)throw new SyntaxError("An invalid or illegal string was specified.");P=U,this.hasBeenReset=!0}})),u.displayState=void 0}return o.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},o})();class n1e{decode(e,t){if(!e)return"";if(typeof e!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}function ij(i){function e(n,r,s,o){return(n|0)*3600+(r|0)*60+(s|0)+parseFloat(o||0)}const t=i.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return t?parseFloat(t[2])>59?e(t[2],t[3],0,t[4]):e(t[1],t[2],t[3],t[4]):null}class i1e{constructor(){this.values=Object.create(null)}set(e,t){!this.get(e)&&t!==""&&(this.values[e]=t)}get(e,t,n){return n?this.has(e)?this.values[e]:t[n]:this.has(e)?this.values[e]:t}has(e){return e in this.values}alt(e,t,n){for(let r=0;r<n.length;++r)if(t===n[r]){this.set(e,t);break}}integer(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))}percent(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){const n=parseFloat(t);if(n>=0&&n<=100)return this.set(e,n),!0}return!1}}function rj(i,e,t,n){const r=n?i.split(n):[i];for(const s in r){if(typeof r[s]!="string")continue;const o=r[s].split(t);if(o.length!==2)continue;const a=o[0],l=o[1];e(a,l)}}const D5=new i8(0,0,""),s_=D5.align==="middle"?"middle":"center";function r1e(i,e,t){const n=i;function r(){const a=ij(i);if(a===null)throw new Error("Malformed timestamp: "+n);return i=i.replace(/^[^\sa-zA-Z-]+/,""),a}function s(a,l){const c=new i1e;rj(a,function(f,d){let m;switch(f){case"region":for(let y=t.length-1;y>=0;y--)if(t[y].id===d){c.set(f,t[y].region);break}break;case"vertical":c.alt(f,d,["rl","lr"]);break;case"line":m=d.split(","),c.integer(f,m[0]),c.percent(f,m[0])&&c.set("snapToLines",!1),c.alt(f,m[0],["auto"]),m.length===2&&c.alt("lineAlign",m[1],["start",s_,"end"]);break;case"position":m=d.split(","),c.percent(f,m[0]),m.length===2&&c.alt("positionAlign",m[1],["start",s_,"end","line-left","line-right","auto"]);break;case"size":c.percent(f,d);break;case"align":c.alt(f,d,["start",s_,"end","left","right"]);break}},/:/,/\s/),l.region=c.get("region",null),l.vertical=c.get("vertical","");let u=c.get("line","auto");u==="auto"&&D5.line===-1&&(u=-1),l.line=u,l.lineAlign=c.get("lineAlign","start"),l.snapToLines=c.get("snapToLines",!0),l.size=c.get("size",100),l.align=c.get("align",s_);let h=c.get("position","auto");h==="auto"&&D5.position===50&&(h=l.align==="start"||l.align==="left"?0:l.align==="end"||l.align==="right"?100:50),l.position=h}function o(){i=i.replace(/^\s+/,"")}if(o(),e.startTime=r(),o(),i.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+n);i=i.slice(3),o(),e.endTime=r(),o(),s(i,e)}function sj(i){return i.replace(/<br(?: \/)?>/gi,`
`)}class s1e{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new n1e,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(e){const t=this;e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));function n(){let s=t.buffer,o=0;for(s=sj(s);o<s.length&&s[o]!=="\r"&&s[o]!==`
`;)++o;const a=s.slice(0,o);return s[o]==="\r"&&++o,s[o]===`
`&&++o,t.buffer=s.slice(o),a}function r(s){rj(s,function(o,a){},/:/)}try{let s="";if(t.state==="INITIAL"){if(!/\r\n|\n/.test(t.buffer))return this;s=n();const a=s.match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(!(a!=null&&a[0]))throw new Error("Malformed WebVTT signature.");t.state="HEADER"}let o=!1;for(;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(o?o=!1:s=n(),t.state){case"HEADER":/:/.test(s)?r(s):s||(t.state="ID");continue;case"NOTE":s||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(s)){t.state="NOTE";break}if(!s)continue;if(t.cue=new i8(0,0,""),t.state="CUE",s.indexOf("-->")===-1){t.cue.id=s;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{r1e(s,t.cue,t.regionList)}catch{t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":{const a=s.indexOf("-->")!==-1;if(!s||a&&(o=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(t.cue===null)continue;t.cue.text&&(t.cue.text+=`
`),t.cue.text+=s}continue;case"BADCUE":s||(t.state="ID")}}}catch{t.state==="CUETEXT"&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state=t.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this}flush(){const e=this;try{if((e.cue||e.state==="HEADER")&&(e.buffer+=`

`,e.parse()),e.state==="INITIAL"||e.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(t){e.onparsingerror&&e.onparsingerror(t)}return e.onflush&&e.onflush(),this}}const o1e=/\r\n|\n\r|\n|\r/g,Yb=function(e,t,n=0){return e.slice(n,n+t.length)===t},a1e=function(e){let t=parseInt(e.slice(-3));const n=parseInt(e.slice(-6,-4)),r=parseInt(e.slice(-9,-7)),s=e.length>9?parseInt(e.substring(0,e.indexOf(":"))):0;if(!jt(t)||!jt(n)||!jt(r)||!jt(s))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${e}`);return t+=1e3*n,t+=60*1e3*r,t+=3600*1e3*s,t};function r8(i,e,t){return f2(i.toString())+f2(e.toString())+f2(t)}const l1e=function(e,t,n){let r=e[t],s=e[r.prevCC];if(!s||!s.new&&r.new){e.ccOffset=e.presentationOffset=r.start,r.new=!1;return}for(;(o=s)!=null&&o.new;){var o;e.ccOffset+=r.start-s.start,r.new=!1,r=s,s=e[r.prevCC]}e.presentationOffset=n};function c1e(i,e,t,n,r,s,o){const a=new s1e,l=Ll(new Uint8Array(i)).trim().replace(o1e,`
`).split(`
`),c=[],u=e?S0e(e.baseTime,e.timescale):0;let h="00:00.000",f=0,d=0,m,y=!0;a.oncue=function(g){const A=t[n];let E=t.ccOffset;const x=(f-u)/9e4;if(A!=null&&A.new&&(d!==void 0?E=t.ccOffset=A.start:l1e(t,n,x)),x){if(!e){m=new Error("Missing initPTS for VTT MPEGTS");return}E=x-t.presentationOffset}const w=g.endTime-g.startTime,T=Cl((g.startTime+E-d)*9e4,r*9e4)/9e4;g.startTime=Math.max(T,0),g.endTime=Math.max(T+w,0);const I=g.text.trim();g.text=decodeURIComponent(encodeURIComponent(I)),g.id||(g.id=r8(g.startTime,g.endTime,I)),g.endTime>0&&c.push(g)},a.onparsingerror=function(g){m=g},a.onflush=function(){if(m){o(m);return}s(c)},l.forEach(g=>{if(y)if(Yb(g,"X-TIMESTAMP-MAP=")){y=!1,g.slice(16).split(",").forEach(A=>{Yb(A,"LOCAL:")?h=A.slice(6):Yb(A,"MPEGTS:")&&(f=parseInt(A.slice(7)))});try{d=a1e(h)/1e3}catch(A){m=A}return}else g===""&&(y=!1);a.parse(g+`
`)}),a.flush()}const $b="stpp.ttml.im1t",oj=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,aj=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,u1e={left:"start",center:"center",right:"end",start:"start",end:"end"};function Nk(i,e,t,n){const r=si(new Uint8Array(i),["mdat"]);if(r.length===0){n(new Error("Could not parse IMSC1 mdat"));return}const s=r.map(a=>Ll(a)),o=_0e(e.baseTime,1,e.timescale);try{s.forEach(a=>t(h1e(a,o)))}catch(a){n(a)}}function h1e(i,e){const r=new DOMParser().parseFromString(i,"text/xml").getElementsByTagName("tt")[0];if(!r)throw new Error("Invalid ttml");const s={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},o=Object.keys(s).reduce((h,f)=>(h[f]=r.getAttribute(`ttp:${f}`)||s[f],h),{}),a=r.getAttribute("xml:space")!=="preserve",l=Uk(Xb(r,"styling","style")),c=Uk(Xb(r,"layout","region")),u=Xb(r,"body","[begin]");return[].map.call(u,h=>{const f=lj(h,a);if(!f||!h.hasAttribute("begin"))return null;const d=Jb(h.getAttribute("begin"),o),m=Jb(h.getAttribute("dur"),o);let y=Jb(h.getAttribute("end"),o);if(d===null)throw zk(h);if(y===null){if(m===null)throw zk(h);y=d+m}const g=new i8(d-e,y-e,f);g.id=r8(g.startTime,g.endTime,g.text);const A=c[h.getAttribute("region")],E=l[h.getAttribute("style")],x=f1e(A,E,l),{textAlign:w}=x;if(w){const T=u1e[w];T&&(g.lineAlign=T),g.align=w}return er(g,x),g}).filter(h=>h!==null)}function Xb(i,e,t){const n=i.getElementsByTagName(e)[0];return n?[].slice.call(n.querySelectorAll(t)):[]}function Uk(i){return i.reduce((e,t)=>{const n=t.getAttribute("xml:id");return n&&(e[n]=t),e},{})}function lj(i,e){return[].slice.call(i.childNodes).reduce((t,n,r)=>{var s;return n.nodeName==="br"&&r?t+`
`:(s=n.childNodes)!=null&&s.length?lj(n,e):e?t+n.textContent.trim().replace(/\s+/g," "):t+n.textContent},"")}function f1e(i,e,t){const n="http://www.w3.org/ns/ttml#styling";let r=null;const s=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],o=i!=null&&i.hasAttribute("style")?i.getAttribute("style"):null;return o&&t.hasOwnProperty(o)&&(r=t[o]),s.reduce((a,l)=>{const c=qb(e,n,l)||qb(i,n,l)||qb(r,n,l);return c&&(a[l]=c),a},{})}function qb(i,e,t){return i&&i.hasAttributeNS(e,t)?i.getAttributeNS(e,t):null}function zk(i){return new Error(`Could not parse ttml timestamp ${i}`)}function Jb(i,e){if(!i)return null;let t=ij(i);return t===null&&(oj.test(i)?t=d1e(i,e):aj.test(i)&&(t=p1e(i,e))),t}function d1e(i,e){const t=oj.exec(i),n=(t[4]|0)+(t[5]|0)/e.subFrameRate;return(t[1]|0)*3600+(t[2]|0)*60+(t[3]|0)+n/e.frameRate}function p1e(i,e){const t=aj.exec(i),n=Number(t[1]);switch(t[2]){case"h":return n*3600;case"m":return n*60;case"ms":return n*1e3;case"f":return n/e.frameRate;case"t":return n/e.tickRate}return n}class o_{constructor(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}dispatchCue(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(e,t,n){(this.startTime===null||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=n,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}class cj{constructor(e){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=Hk(),this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},e.on(ae.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(ae.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(ae.MANIFEST_LOADING,this.onManifestLoading,this),e.on(ae.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(ae.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(ae.FRAG_LOADING,this.onFragLoading,this),e.on(ae.FRAG_LOADED,this.onFragLoaded,this),e.on(ae.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(ae.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(ae.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(ae.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(ae.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:e}=this;e.off(ae.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(ae.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(ae.MANIFEST_LOADING,this.onManifestLoading,this),e.off(ae.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(ae.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(ae.FRAG_LOADING,this.onFragLoading,this),e.off(ae.FRAG_LOADED,this.onFragLoaded,this),e.off(ae.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(ae.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(ae.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(ae.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(ae.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.media=null,this.cea608Parser1=this.cea608Parser2=void 0}initCea608Parsers(){const e=new o_(this,"textTrack1"),t=new o_(this,"textTrack2"),n=new o_(this,"textTrack3"),r=new o_(this,"textTrack4");this.cea608Parser1=new Ok(1,e,t),this.cea608Parser2=new Ok(3,n,r)}addCues(e,t,n,r,s){let o=!1;for(let a=s.length;a--;){const l=s[a],c=m1e(l[0],l[1],t,n);if(c>=0&&(l[0]=Math.min(l[0],t),l[1]=Math.max(l[1],n),o=!0,c/(n-t)>.5))return}if(o||s.push([t,n]),this.config.renderTextTracksNatively){const a=this.captionsTracks[e];this.Cues.newCue(a,t,n,r)}else{const a=this.Cues.newCue(null,t,n,r);this.hls.trigger(ae.CUES_PARSED,{type:"captions",cues:a,track:e})}}onInitPtsFound(e,{frag:t,id:n,initPTS:r,timescale:s,trackId:o}){const{unparsedVttFrags:a}=this;n===$t.MAIN&&(this.initPTS[t.cc]={baseTime:r,timescale:s,trackId:o}),a.length&&(this.unparsedVttFrags=[],a.forEach(l=>{this.initPTS[l.frag.cc]?this.onFragLoaded(ae.FRAG_LOADED,l):this.hls.trigger(ae.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:l.frag,error:new Error("Subtitle discontinuity domain does not match main")})}))}getExistingTrack(e,t){const{media:n}=this;if(n)for(let r=0;r<n.textTracks.length;r++){const s=n.textTracks[r];if(Gk(s,{name:e,lang:t,characteristics:"transcribes-spoken-dialog,describes-music-and-sound"}))return s}return null}createCaptionsTrack(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)}createNativeTrack(e){if(this.captionsTracks[e])return;const{captionsProperties:t,captionsTracks:n,media:r}=this,{label:s,languageCode:o}=t[e],a=this.getExistingTrack(s,o);if(a)n[e]=a,F1(n[e]),XV(n[e],r);else{const l=this.createTextTrack("captions",s,o);l&&(l[e]=!0,n[e]=l)}}createNonNativeTrack(e){if(this.nonNativeCaptionsTracks[e])return;const t=this.captionsProperties[e];if(!t)return;const n=t.label,r={_id:e,label:n,kind:"captions",default:t.media?!!t.media.default:!1,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=r,this.hls.trigger(ae.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[r]})}createTextTrack(e,t,n){const r=this.media;if(r)return r.addTextTrack(e,t,n)}onMediaAttaching(e,t){this.media=t.media,t.mediaSource||this._cleanTracks()}onMediaDetaching(e,t){const n=!!t.transferMedia;if(this.media=null,n)return;const{captionsTracks:r}=this;Object.keys(r).forEach(s=>{F1(r[s]),delete r[s]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=Hk(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:e}=this;if(!e)return;const t=e.textTracks;if(t)for(let n=0;n<t.length;n++)F1(t[n])}onSubtitleTracksUpdated(e,t){const n=t.subtitleTracks||[],r=n.some(s=>s.textCodec===$b);if(this.config.enableWebVTT||r&&this.config.enableIMSC1){if(LV(this.tracks,n)){this.tracks=n;return}if(this.textTracks=[],this.tracks=n,this.config.renderTextTracksNatively){const o=this.media,a=o?aS(o.textTracks):null;if(this.tracks.forEach((l,c)=>{let u;if(a){let h=null;for(let f=0;f<a.length;f++)if(a[f]&&Gk(a[f],l)){h=a[f],a[f]=null;break}h&&(u=h)}if(u)F1(u);else{const h=uj(l);u=this.createTextTrack(h,l.name,l.lang),u&&(u.mode="disabled")}u&&this.textTracks.push(u)}),a!=null&&a.length){const l=a.filter(c=>c!==null).map(c=>c.label);l.length&&this.hls.logger.warn(`Media element contains unused subtitle tracks: ${l.join(", ")}. Replace media element for each source to clear TextTracks and captions menu.`)}}else if(this.tracks.length){const o=this.tracks.map(a=>({label:a.name,kind:a.type.toLowerCase(),default:a.default,subtitleTrack:a}));this.hls.trigger(ae.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:o})}}}onManifestLoaded(e,t){this.config.enableCEA708Captions&&t.captions&&t.captions.forEach(n=>{const r=/(?:CC|SERVICE)([1-4])/.exec(n.instreamId);if(!r)return;const s=`textTrack${r[1]}`,o=this.captionsProperties[s];o&&(o.label=n.name,n.lang&&(o.languageCode=n.lang),o.media=n)})}closedCaptionsForLevel(e){const t=this.hls.levels[e.level];return t==null?void 0:t.attrs["CLOSED-CAPTIONS"]}onFragLoading(e,t){if(this.enabled&&t.frag.type===$t.MAIN){var n,r;const{cea608Parser1:s,cea608Parser2:o,lastSn:a}=this,{cc:l,sn:c}=t.frag,u=(n=(r=t.part)==null?void 0:r.index)!=null?n:-1;s&&o&&(c!==a+1||c===a&&u!==this.lastPartIndex+1||l!==this.lastCc)&&(s.reset(),o.reset()),this.lastCc=l,this.lastSn=c,this.lastPartIndex=u}}onFragLoaded(e,t){const{frag:n,payload:r}=t;if(n.type===$t.SUBTITLE)if(r.byteLength){const s=n.decryptdata,o="stats"in t;if(s==null||!s.encrypted||o){const a=this.tracks[n.level],l=this.vttCCs;l[n.cc]||(l[n.cc]={start:n.start,prevCC:this.prevCC,new:!0},this.prevCC=n.cc),a&&a.textCodec===$b?this._parseIMSC1(n,r):this._parseVTTs(t)}}else this.hls.trigger(ae.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:n,error:new Error("Empty subtitle payload")})}_parseIMSC1(e,t){const n=this.hls;Nk(t,this.initPTS[e.cc],r=>{this._appendCues(r,e.level),n.trigger(ae.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},r=>{n.logger.log(`Failed to parse IMSC1: ${r}`),n.trigger(ae.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:r})})}_parseVTTs(e){var t;const{frag:n,payload:r}=e,{initPTS:s,unparsedVttFrags:o}=this,a=s.length-1;if(!s[n.cc]&&a===-1){o.push(e);return}const l=this.hls,c=(t=n.initSegment)!=null&&t.data?Ac(n.initSegment.data,new Uint8Array(r)).buffer:r;c1e(c,this.initPTS[n.cc],this.vttCCs,n.cc,n.start,u=>{this._appendCues(u,n.level),l.trigger(ae.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:n})},u=>{const h=u.message==="Missing initPTS for VTT MPEGTS";h?o.push(e):this._fallbackToIMSC1(n,r),l.logger.log(`Failed to parse VTT cue: ${u}`),!(h&&a>n.cc)&&l.trigger(ae.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:n,error:u})})}_fallbackToIMSC1(e,t){const n=this.tracks[e.level];n.textCodec||Nk(t,this.initPTS[e.cc],()=>{n.textCodec=$b,this._parseIMSC1(e,t)},()=>{n.textCodec="wvtt"})}_appendCues(e,t){const n=this.hls;if(this.config.renderTextTracksNatively){const r=this.textTracks[t];if(!r||r.mode==="disabled")return;e.forEach(s=>qV(r,s))}else{const r=this.tracks[t];if(!r)return;const s=r.default?"default":"subtitles"+t;n.trigger(ae.CUES_PARSED,{type:"subtitles",cues:e,track:s})}}onFragDecrypted(e,t){const{frag:n}=t;n.type===$t.SUBTITLE&&this.onFragLoaded(ae.FRAG_LOADED,t)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(e,t){if(!this.enabled||!this.config.enableCEA708Captions)return;const{frag:n,samples:r}=t;if(!(n.type===$t.MAIN&&this.closedCaptionsForLevel(n)==="NONE"))for(let s=0;s<r.length;s++){const o=r[s].bytes;if(o){this.cea608Parser1||this.initCea608Parsers();const a=this.extractCea608Data(o);this.cea608Parser1.addData(r[s].pts,a[0]),this.cea608Parser2.addData(r[s].pts,a[1])}}}onBufferFlushing(e,{startOffset:t,endOffset:n,endOffsetSubtitles:r,type:s}){const{media:o}=this;if(!(!o||o.currentTime<n)){if(!s||s==="video"){const{captionsTracks:a}=this;Object.keys(a).forEach(l=>B5(a[l],t,n))}if(this.config.renderTextTracksNatively&&t===0&&r!==void 0){const{textTracks:a}=this;Object.keys(a).forEach(l=>B5(a[l],t,r))}}}extractCea608Data(e){const t=[[],[]],n=e[0]&31;let r=2;for(let s=0;s<n;s++){const o=e[r++],a=127&e[r++],l=127&e[r++];if(a===0&&l===0)continue;if((4&o)!==0){const u=3&o;(u===0||u===1)&&(t[u].push(a),t[u].push(l))}}return t}}function uj(i){return i.characteristics&&/transcribes-spoken-dialog/gi.test(i.characteristics)&&/describes-music-and-sound/gi.test(i.characteristics)?"captions":"subtitles"}function Gk(i,e){return!!i&&i.kind===uj(e)&&M5(e,i)}function m1e(i,e,t,n){return Math.min(e,n)-Math.max(i,t)}function Hk(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}const g1e=/\s/,hj={newCue(i,e,t,n){const r=[];let s,o,a,l,c;const u=self.VTTCue||self.TextTrackCue;for(let f=0;f<n.rows.length;f++)if(s=n.rows[f],a=!0,l=0,c="",!s.isEmpty()){var h;for(let y=0;y<s.chars.length;y++)g1e.test(s.chars[y].uchar)&&a?l++:(c+=s.chars[y].uchar,a=!1);s.cueStartTime=e,e===t&&(t+=1e-4),l>=16?l--:l++;const d=sj(c.trim()),m=r8(e,t,d);i!=null&&(h=i.cues)!=null&&h.getCueById(m)||(o=new u(e,t,d),o.id=m,o.line=f+1,o.align="left",o.position=10+Math.min(80,Math.floor(l*8/32)*10),r.push(o))}return i&&r.length&&(r.sort((f,d)=>f.line==="auto"||d.line==="auto"?0:f.line>8&&d.line>8?d.line-f.line:f.line-d.line),r.forEach(f=>qV(i,f))),r}};function fj(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}const A1e=/(\d+)-(\d+)\/(\d+)/;class k5{constructor(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||E1e,this.controller=new self.AbortController,this.stats=new y4}destroy(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null}abortInternal(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(e,t,n){const r=this.stats;if(r.loading.start)throw new Error("Loader can only be used once.");r.loading.start=self.performance.now();const s=y1e(e,this.controller.signal),o=e.responseType==="arraybuffer",a=o?"byteLength":"length",{maxTimeToFirstByteMs:l,maxLoadTimeMs:c}=t.loadPolicy;this.context=e,this.config=t,this.callbacks=n,this.request=this.fetchSetup(e,s),self.clearTimeout(this.requestTimeout),t.timeout=l&&jt(l)?l:c,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(r,e,this.response))},t.timeout),($2(this.request)?this.request.then(self.fetch):self.fetch(this.request)).then(h=>{var f;this.response=this.loader=h;const d=Math.max(self.performance.now(),r.loading.start);if(self.clearTimeout(this.requestTimeout),t.timeout=c,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(r,e,this.response))},c-(d-r.loading.start)),!h.ok){const{status:y,statusText:g}=h;throw new _1e(g||"fetch, bad network response",y,h)}r.loading.first=d,r.total=x1e(h.headers)||r.total;const m=(f=this.callbacks)==null?void 0:f.onProgress;return m&&jt(t.highWaterMark)?this.loadProgressively(h,r,e,t.highWaterMark,m):o?h.arrayBuffer():e.responseType==="json"?h.json():h.text()}).then(h=>{var f,d;const m=this.response;if(!m)throw new Error("loader destroyed");self.clearTimeout(this.requestTimeout),r.loading.end=Math.max(self.performance.now(),r.loading.first);const y=h[a];y&&(r.loaded=r.total=y);const g={url:m.url,data:h,code:m.status},A=(f=this.callbacks)==null?void 0:f.onProgress;A&&!jt(t.highWaterMark)&&A(r,e,h,m),(d=this.callbacks)==null||d.onSuccess(g,r,e,m)}).catch(h=>{var f;if(self.clearTimeout(this.requestTimeout),r.aborted)return;const d=h&&h.code||0,m=h?h.message:null;(f=this.callbacks)==null||f.onError({code:d,text:m},e,h?h.details:null,r)})}getCacheAge(){let e=null;if(this.response){const t=this.response.headers.get("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.response?this.response.headers.get(e):null}loadProgressively(e,t,n,r=0,s){const o=new hV,a=e.body.getReader(),l=()=>a.read().then(c=>{if(c.done)return o.dataLength&&s(t,n,o.flush().buffer,e),Promise.resolve(new ArrayBuffer(0));const u=c.value,h=u.length;return t.loaded+=h,h<r||o.dataLength?(o.push(u),o.dataLength>=r&&s(t,n,o.flush().buffer,e)):s(t,n,u.buffer,e),l()}).catch(()=>Promise.reject());return l()}}function y1e(i,e){const t={method:"GET",mode:"cors",credentials:"same-origin",signal:e,headers:new self.Headers(er({},i.headers))};return i.rangeEnd&&t.headers.set("Range","bytes="+i.rangeStart+"-"+String(i.rangeEnd-1)),t}function v1e(i){const e=A1e.exec(i);if(e)return parseInt(e[2])-parseInt(e[1])+1}function x1e(i){const e=i.get("Content-Range");if(e){const n=v1e(e);if(jt(n))return n}const t=i.get("Content-Length");if(t)return parseInt(t)}function E1e(i,e){return new self.Request(i.url,e)}class _1e extends Error{constructor(e,t,n){super(e),this.code=void 0,this.details=void 0,this.code=t,this.details=n}}const S1e=/^age:\s*[\d.]+\s*$/im;class s8{constructor(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new y4,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null}abortInternal(){const e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,e.readyState!==4&&(this.stats.aborted=!0,e.abort()))}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(e,t,n){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=n,this.loadInternal()}loadInternal(){const{config:e,context:t}=this;if(!e||!t)return;const n=this.loader=new self.XMLHttpRequest,r=this.stats;r.loading.first=0,r.loaded=0,r.aborted=!1;const s=this.xhrSetup;s?Promise.resolve().then(()=>{if(!(this.loader!==n||this.stats.aborted))return s(n,t.url)}).catch(o=>{if(!(this.loader!==n||this.stats.aborted))return n.open("GET",t.url,!0),s(n,t.url)}).then(()=>{this.loader!==n||this.stats.aborted||this.openAndSendXhr(n,t,e)}).catch(o=>{var a;(a=this.callbacks)==null||a.onError({code:n.status,text:o.message},t,n,r)}):this.openAndSendXhr(n,t,e)}openAndSendXhr(e,t,n){e.readyState||e.open("GET",t.url,!0);const r=t.headers,{maxTimeToFirstByteMs:s,maxLoadTimeMs:o}=n.loadPolicy;if(r)for(const a in r)e.setRequestHeader(a,r[a]);t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,self.clearTimeout(this.requestTimeout),n.timeout=s&&jt(s)?s:o,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),n.timeout),e.send()}readystatechange(){const{context:e,loader:t,stats:n}=this;if(!e||!t)return;const r=t.readyState,s=this.config;if(!n.aborted&&r>=2&&(n.loading.first===0&&(n.loading.first=Math.max(self.performance.now(),n.loading.start),s.timeout!==s.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),s.timeout=s.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),s.loadPolicy.maxLoadTimeMs-(n.loading.first-n.loading.start)))),r===4)){self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;const c=t.status,u=t.responseType==="text"?t.responseText:null;if(c>=200&&c<300){const m=u??t.response;if(m!=null){var o,a;n.loading.end=Math.max(self.performance.now(),n.loading.first);const y=t.responseType==="arraybuffer"?m.byteLength:m.length;n.loaded=n.total=y,n.bwEstimate=n.total*8e3/(n.loading.end-n.loading.first);const g=(o=this.callbacks)==null?void 0:o.onProgress;g&&g(n,e,m,t);const A={url:t.responseURL,data:m,code:c};(a=this.callbacks)==null||a.onSuccess(A,n,e,t);return}}const h=s.loadPolicy.errorRetry,f=n.retry,d={url:e.url,data:void 0,code:c};if(YS(h,f,!1,d))this.retry(h);else{var l;Ki.error(`${c} while loading ${e.url}`),(l=this.callbacks)==null||l.onError({code:c,text:t.statusText},e,t,n)}}}loadtimeout(){if(!this.config)return;const e=this.config.loadPolicy.timeoutRetry,t=this.stats.retry;if(YS(e,t,!0))this.retry(e);else{var n;Ki.warn(`timeout while loading ${(n=this.context)==null?void 0:n.url}`);const r=this.callbacks;r&&(this.abortInternal(),r.onTimeout(this.stats,this.context,this.loader))}}retry(e){const{context:t,stats:n}=this;this.retryDelay=HR(e,n.retry),n.retry++,Ki.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${t==null?void 0:t.url}, retrying ${n.retry}/${e.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(e){const t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)}getCacheAge(){let e=null;if(this.loader&&S1e.test(this.loader.getAllResponseHeaders())){const t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.loader&&new RegExp(`^${e}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null}}const w1e={maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null},C1e=Qi(Qi({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,maxDevicePixelRatio:Number.POSITIVE_INFINITY,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,startOnSegmentBoundary:!1,maxBufferSize:60*1e3*1e3,maxFragLookUpTolerance:.25,maxBufferHole:.1,detectStallWithCurrentTimeMs:1250,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,nudgeOnVideoHole:!0,liveSyncMode:"edge",liveSyncDurationCount:3,liveSyncOnStallIncrease:1,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,ignorePlaylistParsingErrors:!1,loader:s8,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:VQ,bufferController:kV,capLevelController:w4,errorController:$Q,fpsController:$V,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:KR,requireKeySystemAccessOnStart:!1,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableEmsgKLVMetadata:!1,enableID3MetadataCues:!0,enableInterstitialPlayback:!0,interstitialAppendInPlace:!0,interstitialLiveLookAhead:10,useMediaCapabilities:!0,preserveManualLevelOnError:!1,certLoadPolicy:{default:w1e},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},interstitialAssetListLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:3e4,timeoutRetry:{maxNumRetry:0,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:0,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},T1e()),{},{subtitleStreamController:ej,subtitleTrackController:JV,timelineController:cj,audioStreamController:PV,audioTrackController:BV,emeController:Wm,cmcdController:WV,contentSteeringController:KV,interstitialsController:Qge});function T1e(){return{cueHandler:hj,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function b1e(i,e,t){if((e.liveSyncDurationCount||e.liveMaxLatencyDurationCount)&&(e.liveSyncDuration||e.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(e.liveMaxLatencyDurationCount!==void 0&&(e.liveSyncDurationCount===void 0||e.liveMaxLatencyDurationCount<=e.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(e.liveMaxLatencyDuration!==void 0&&(e.liveSyncDuration===void 0||e.liveMaxLatencyDuration<=e.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const n=F5(i),r=["manifest","level","frag"],s=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return r.forEach(o=>{const a=`${o==="level"?"playlist":o}LoadPolicy`,l=e[a]===void 0,c=[];s.forEach(u=>{const h=`${o}Loading${u}`,f=e[h];if(f!==void 0&&l){c.push(h);const d=n[a].default;switch(e[a]={default:d},u){case"TimeOut":d.maxLoadTimeMs=f,d.maxTimeToFirstByteMs=f;break;case"MaxRetry":d.errorRetry.maxNumRetry=f,d.timeoutRetry.maxNumRetry=f;break;case"RetryDelay":d.errorRetry.retryDelayMs=f,d.timeoutRetry.retryDelayMs=f;break;case"MaxRetryTimeout":d.errorRetry.maxRetryDelayMs=f,d.timeoutRetry.maxRetryDelayMs=f;break}}}),c.length&&t.warn(`hls.js config: "${c.join('", "')}" setting(s) are deprecated, use "${a}": ${lr(e[a])}`)}),Qi(Qi({},n),e)}function F5(i){return i&&typeof i=="object"?Array.isArray(i)?i.map(F5):Object.keys(i).reduce((e,t)=>(e[t]=F5(i[t]),e),{}):i}function I1e(i,e){const t=i.loader;t!==k5&&t!==s8?(e.log("[config]: Custom loader detected, cannot enable progressive streaming"),i.progressive=!1):fj()&&(i.loader=k5,i.progressive=!0,i.enableSoftwareAES=!0,e.log("[config]: Progressive streaming enabled, using FetchLoader"))}const lS=2,M1e=.1,R1e=.05,P1e=100;class L1e extends XQ{constructor(e,t){super("gap-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.media=null,this.mediaSource=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.buffered={},this.lastCurrentTime=0,this.ended=0,this.waiting=0,this.onMediaPlaying=()=>{this.ended=0,this.waiting=0},this.onMediaWaiting=()=>{var n;(n=this.media)!=null&&n.seeking||(this.waiting=self.performance.now(),this.tick())},this.onMediaEnded=()=>{if(this.hls){var n;this.ended=((n=this.media)==null?void 0:n.currentTime)||1,this.hls.trigger(ae.MEDIA_ENDED,{stalled:!1})}},this.hls=e,this.fragmentTracker=t,this.registerListeners()}registerListeners(){const{hls:e}=this;e&&(e.on(ae.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(ae.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(ae.BUFFER_APPENDED,this.onBufferAppended,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(ae.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(ae.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(ae.BUFFER_APPENDED,this.onBufferAppended,this))}destroy(){super.destroy(),this.unregisterListeners(),this.media=this.hls=this.fragmentTracker=null,this.mediaSource=void 0}onMediaAttached(e,t){this.setInterval(P1e),this.mediaSource=t.mediaSource;const n=this.media=t.media;_a(n,"playing",this.onMediaPlaying),_a(n,"waiting",this.onMediaWaiting),_a(n,"ended",this.onMediaEnded)}onMediaDetaching(e,t){this.clearInterval();const{media:n}=this;n&&(Za(n,"playing",this.onMediaPlaying),Za(n,"waiting",this.onMediaWaiting),Za(n,"ended",this.onMediaEnded),this.media=null),this.mediaSource=void 0}onBufferAppended(e,t){this.buffered=t.timeRanges}get hasBuffered(){return Object.keys(this.buffered).length>0}tick(){var e;if(!((e=this.media)!=null&&e.readyState)||!this.hasBuffered)return;const t=this.media.currentTime;this.poll(t,this.lastCurrentTime),this.lastCurrentTime=t}poll(e,t){var n,r;const s=(n=this.hls)==null?void 0:n.config;if(!s)return;const o=this.media;if(!o)return;const{seeking:a}=o,l=this.seeking&&!a,c=!this.seeking&&a,u=o.paused&&!a||o.ended||o.playbackRate===0;if(this.seeking=a,e!==t){t&&(this.ended=0),this.moved=!0,a||(this.nudgeRetry=0,s.nudgeOnVideoHole&&!u&&e>t&&this.nudgeOnVideoHole(e,t)),this.waiting===0&&this.stallResolved(e);return}if(c||l){l&&this.stallResolved(e);return}if(u){this.nudgeRetry=0,this.stallResolved(e),!this.ended&&o.ended&&this.hls&&(this.ended=e||1,this.hls.trigger(ae.MEDIA_ENDED,{stalled:!1}));return}if(!Wn.getBuffered(o).length){this.nudgeRetry=0;return}const h=Wn.bufferInfo(o,e,0),f=h.nextStart||0,d=this.fragmentTracker;if(a&&d&&this.hls){const I=Qk(this.hls.inFlightFragments,e),M=h.len>lS,L=!f||I||f-e>lS&&!d.getPartialFragment(e);if(M||L)return;this.moved=!1}const m=(r=this.hls)==null?void 0:r.latestLevelDetails;if(!this.moved&&this.stalled!==null&&d){if(!(h.len>0)&&!f)return;const M=Math.max(f,h.start||0)-e,P=!!(m!=null&&m.live)?m.targetduration*2:lS,R=a_(e,d);if(M>0&&(M<=P||R)){o.paused||this._trySkipBufferHole(R);return}}const y=s.detectStallWithCurrentTimeMs,g=self.performance.now(),A=this.waiting;let E=this.stalled;if(E===null)if(A>0&&g-A<y)E=this.stalled=A;else{this.stalled=g;return}const x=g-E;if(!a&&(x>=y||A)&&this.hls){var w;if(((w=this.mediaSource)==null?void 0:w.readyState)==="ended"&&!(m!=null&&m.live)&&Math.abs(e-((m==null?void 0:m.edge)||0))<1){if(this.ended)return;this.ended=e||1,this.hls.trigger(ae.MEDIA_ENDED,{stalled:!0});return}if(this._reportStall(h),!this.media||!this.hls)return}const T=Wn.bufferInfo(o,e,s.maxBufferHole);this._tryFixBufferStall(T,x,e)}stallResolved(e){const t=this.stalled;if(t&&this.hls&&(this.stalled=null,this.stallReported)){const n=self.performance.now()-t;this.log(`playback not stuck anymore @${e}, after ${Math.round(n)}ms`),this.stallReported=!1,this.waiting=0,this.hls.trigger(ae.STALL_RESOLVED,{})}}nudgeOnVideoHole(e,t){var n;const r=this.buffered.video;if(this.hls&&this.media&&this.fragmentTracker&&(n=this.buffered.audio)!=null&&n.length&&r&&r.length>1&&e>r.end(0)){const s=Wn.bufferedInfo(Wn.timeRangesToArray(this.buffered.audio),e,0);if(s.len>1&&t>=s.start){const o=Wn.timeRangesToArray(r),a=Wn.bufferedInfo(o,t,0).bufferedIndex;if(a>-1&&a<o.length-1){const l=Wn.bufferedInfo(o,e,0).bufferedIndex,c=o[a].end,u=o[a+1].start;if((l===-1||l>a)&&u-c<1&&e-c<2){const h=new Error(`nudging playhead to flush pipeline after video hole. currentTime: ${e} hole: ${c} -> ${u} buffered index: ${l}`);this.warn(h.message),this.media.currentTime+=1e-6;let f=a_(e,this.fragmentTracker);f&&"fragment"in f?f=f.fragment:f||(f=void 0);const d=Wn.bufferInfo(this.media,e,0);this.hls.trigger(ae.ERROR,{type:rn.MEDIA_ERROR,details:Ke.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:h,reason:h.message,frag:f,buffer:d.len,bufferInfo:d})}}}}}_tryFixBufferStall(e,t,n){var r,s;const{fragmentTracker:o,media:a}=this,l=(r=this.hls)==null?void 0:r.config;if(!a||!o||!l)return;const c=(s=this.hls)==null?void 0:s.latestLevelDetails,u=a_(n,o);if((u||c!=null&&c.live&&n<c.fragmentStart)&&(this._trySkipBufferHole(u)||!this.media))return;const h=e.buffered,f=this.adjacentTraversal(e,n);(h&&h.length>1&&e.len>l.maxBufferHole||e.nextStart&&(e.nextStart-n<l.maxBufferHole||f))&&(t>l.highBufferWatchdogPeriod*1e3||this.waiting)&&(this.warn("Trying to nudge playhead over buffer-hole"),this._tryNudgeBuffer(e))}adjacentTraversal(e,t){const n=this.fragmentTracker,r=e.nextStart;if(n&&r){const s=n.getFragAtPos(t,$t.MAIN),o=n.getFragAtPos(r,$t.MAIN);if(s&&o)return o.sn-s.sn<2}return!1}_reportStall(e){const{hls:t,media:n,stallReported:r,stalled:s}=this;if(!r&&s!==null&&n&&t){this.stallReported=!0;const o=new Error(`Playback stalling at @${n.currentTime} due to low buffer (${lr(e)})`);this.warn(o.message),t.trigger(ae.ERROR,{type:rn.MEDIA_ERROR,details:Ke.BUFFER_STALLED_ERROR,fatal:!1,error:o,buffer:e.len,bufferInfo:e,stalled:{start:s}})}}_trySkipBufferHole(e){var t;const{fragmentTracker:n,media:r}=this,s=(t=this.hls)==null?void 0:t.config;if(!r||!n||!s)return 0;const o=r.currentTime,a=Wn.bufferInfo(r,o,0),l=o<a.start?a.start:a.nextStart;if(l&&this.hls){const u=a.len<=s.maxBufferHole,h=a.len>0&&a.len<1&&r.readyState<3,f=l-o;if(f>0&&(u||h)){if(f>s.maxBufferHole){let m=!1;if(o===0){const y=n.getAppendedFrag(0,$t.MAIN);y&&l<y.end&&(m=!0)}if(!m&&e){var c;if(!((c=this.hls.loadLevelObj)!=null&&c.details)||Qk(this.hls.inFlightFragments,l))return 0;let g=!1,A=e.end;for(;A<l;){const E=a_(A,n);if(E)A+=E.duration;else{g=!0;break}}if(g)return 0}}const d=Math.max(l+R1e,o+M1e);if(this.warn(`skipping hole, adjusting currentTime from ${o} to ${d}`),this.moved=!0,r.currentTime=d,!(e!=null&&e.gap)){const m=new Error(`fragment loaded with buffer holes, seeking from ${o} to ${d}`),y={type:rn.MEDIA_ERROR,details:Ke.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:m,reason:m.message,buffer:a.len,bufferInfo:a};e&&("fragment"in e?y.part=e:y.frag=e),this.hls.trigger(ae.ERROR,y)}return d}}return 0}_tryNudgeBuffer(e){const{hls:t,media:n,nudgeRetry:r}=this,s=t==null?void 0:t.config;if(!n||!s)return 0;const o=n.currentTime;if(this.nudgeRetry++,r<s.nudgeMaxRetry){const a=o+(r+1)*s.nudgeOffset,l=new Error(`Nudging 'currentTime' from ${o} to ${a}`);this.warn(l.message),n.currentTime=a,t.trigger(ae.ERROR,{type:rn.MEDIA_ERROR,details:Ke.BUFFER_NUDGE_ON_STALL,error:l,fatal:!1,buffer:e.len,bufferInfo:e})}else{const a=new Error(`Playhead still not moving while enough data buffered @${o} after ${s.nudgeMaxRetry} nudges`);this.error(a.message),t.trigger(ae.ERROR,{type:rn.MEDIA_ERROR,details:Ke.BUFFER_STALLED_ERROR,error:a,fatal:!0,buffer:e.len,bufferInfo:e})}}}function Qk(i,e){const t=Vk(i.main);if(t&&t.start<=e)return t;const n=Vk(i.audio);return n&&n.start<=e?n:null}function Vk(i){if(!i)return null;switch(i.state){case mt.IDLE:case mt.STOPPED:case mt.ENDED:case mt.ERROR:return null}return i.frag}function a_(i,e){return e.getAppendedFrag(i,$t.MAIN)||e.getPartialFragment(i)}const B1e=.25;function O5(){if(!(typeof self>"u"))return self.VTTCue||self.TextTrackCue}function Zb(i,e,t,n,r){let s=new i(e,t,"");try{s.value=n,r&&(s.type=r)}catch{s=new i(e,t,lr(r?Qi({type:r},n):n))}return s}const l_=(()=>{const i=O5();try{i&&new i(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();class D1e{constructor(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.removeCues=!0,this.assetCue=void 0,this.onEventCueEnter=()=>{this.hls&&this.hls.trigger(ae.EVENT_CUE_ENTER,{})},this.hls=e,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=this.onEventCueEnter=null}_registerListeners(){const{hls:e}=this;e&&(e.on(ae.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(ae.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(ae.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(ae.MANIFEST_LOADING,this.onManifestLoading,this),e.on(ae.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(ae.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(ae.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(ae.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(ae.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(ae.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(ae.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(ae.MANIFEST_LOADING,this.onManifestLoading,this),e.off(ae.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(ae.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(ae.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(ae.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}onMediaAttaching(e,t){var n;this.media=t.media,((n=t.overrides)==null?void 0:n.cueRemoval)===!1&&(this.removeCues=!1)}onMediaAttached(){var e;const t=(e=this.hls)==null?void 0:e.latestLevelDetails;t&&this.updateDateRangeCues(t)}onMediaDetaching(e,t){this.media=null,!t.transferMedia&&(this.id3Track&&(this.removeCues&&F1(this.id3Track,this.onEventCueEnter),this.id3Track=null),this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(e){const t=this.getID3Track(e.textTracks);return t.mode="hidden",t}getID3Track(e){if(this.media){for(let t=0;t<e.length;t++){const n=e[t];if(n.kind==="metadata"&&n.label==="id3")return XV(n,this.media),n}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(e,t){if(!this.media||!this.hls)return;const{enableEmsgMetadataCues:n,enableID3MetadataCues:r}=this.hls.config;if(!n&&!r)return;const{samples:s}=t;this.id3Track||(this.id3Track=this.createTrack(this.media));const o=O5();if(o)for(let a=0;a<s.length;a++){const l=s[a].type;if(l===Xa.emsg&&!n||!r)continue;const c=yV(s[a].data),u=s[a].pts;let h=u+s[a].duration;h>l_&&(h=l_),h-u<=0&&(h=u+B1e);for(let d=0;d<c.length;d++){const m=c[d];if(!vV(m)){this.updateId3CueEnds(u,l);const y=Zb(o,u,h,m,l);y&&this.id3Track.addCue(y)}}}}updateId3CueEnds(e,t){var n;const r=(n=this.id3Track)==null?void 0:n.cues;if(r)for(let s=r.length;s--;){const o=r[s];o.type===t&&o.startTime<e&&o.endTime===l_&&(o.endTime=e)}}onBufferFlushing(e,{startOffset:t,endOffset:n,type:r}){const{id3Track:s,hls:o}=this;if(!o)return;const{config:{enableEmsgMetadataCues:a,enableID3MetadataCues:l}}=o;if(s&&(a||l)){let c;r==="audio"?c=u=>u.type===Xa.audioId3&&l:r==="video"?c=u=>u.type===Xa.emsg&&a:c=u=>u.type===Xa.audioId3&&l||u.type===Xa.emsg&&a,B5(s,t,n,c)}}onLevelUpdated(e,{details:t}){this.updateDateRangeCues(t,!0)}onLevelPtsUpdated(e,t){Math.abs(t.drift)>.01&&this.updateDateRangeCues(t.details)}updateDateRangeCues(e,t){if(!this.hls||!this.media)return;const{assetPlayerId:n,timelineOffset:r,enableDateRangeMetadataCues:s,interstitialsController:o}=this.hls.config;if(!s)return;const a=O5();if(n&&r&&!o){const{fragmentStart:y,fragmentEnd:g}=e;let A=this.assetCue;A?(A.startTime=y,A.endTime=g):a&&(A=this.assetCue=Zb(a,y,g,{assetPlayerId:this.hls.config.assetPlayerId},"hlsjs.interstitial.asset"),A&&(A.id=n,this.id3Track||(this.id3Track=this.createTrack(this.media)),this.id3Track.addCue(A),A.addEventListener("enter",this.onEventCueEnter)))}if(!e.hasProgramDateTime)return;const{id3Track:l}=this,{dateRanges:c}=e,u=Object.keys(c);let h=this.dateRangeCuesAppended;if(l&&t){var f;if((f=l.cues)!=null&&f.length){const y=Object.keys(h).filter(g=>!u.includes(g));for(let g=y.length;g--;){var d;const A=y[g],E=(d=h[A])==null?void 0:d.cues;delete h[A],E&&Object.keys(E).forEach(x=>{const w=E[x];if(w){w.removeEventListener("enter",this.onEventCueEnter);try{l.removeCue(w)}catch{}}})}}else h=this.dateRangeCuesAppended={}}const m=e.fragments[e.fragments.length-1];if(!(u.length===0||!jt(m==null?void 0:m.programDateTime))){this.id3Track||(this.id3Track=this.createTrack(this.media));for(let y=0;y<u.length;y++){const g=u[y],A=c[g],E=A.startTime,x=h[g],w=(x==null?void 0:x.cues)||{};let T=(x==null?void 0:x.durationKnown)||!1,I=l_;const{duration:M,endDate:L}=A;if(L&&M!==null)I=E+M,T=!0;else if(A.endOnNext&&!T){const R=u.reduce((U,k)=>{if(k!==A.id){const H=c[k];if(H.class===A.class&&H.startDate>A.startDate&&(!U||A.startDate<U.startDate))return H}return U},null);R&&(I=R.startTime,T=!0)}const P=Object.keys(A.attr);for(let R=0;R<P.length;R++){const U=P[R];if(!dme(U))continue;const k=w[U];if(k)T&&!(x!=null&&x.durationKnown)?k.endTime=I:Math.abs(k.startTime-E)>.01&&(k.startTime=E,k.endTime=I);else if(a){let H=A.attr[U];pme(U)&&(H=IQ(H));const X=Zb(a,E,I,{key:U,data:H},Xa.dateRange);X&&(X.id=g,this.id3Track.addCue(X),w[U]=X,o&&(U==="X-ASSET-LIST"||U==="X-ASSET-URL")&&X.addEventListener("enter",this.onEventCueEnter))}}h[g]={cues:w,dateRange:A,durationKnown:T}}}}}class k1e{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.currentTime=0,this.stallCount=0,this._latency=null,this._targetLatencyUpdated=!1,this.onTimeupdate=()=>{const{media:t}=this,n=this.levelDetails;if(!t||!n)return;this.currentTime=t.currentTime;const r=this.computeLatency();if(r===null)return;this._latency=r;const{lowLatencyMode:s,maxLiveSyncPlaybackRate:o}=this.config;if(!s||o===1||!n.live)return;const a=this.targetLatency;if(a===null)return;const l=r-a,c=Math.min(this.maxLatency,a+n.targetduration);if(l<c&&l>.05&&this.forwardBufferLength>1){const h=Math.min(2,Math.max(1,o)),f=Math.round(2/(1+Math.exp(-.75*l-this.edgeStalled))*20)/20,d=Math.min(h,Math.max(1,f));this.changeMediaPlaybackRate(t,d)}else t.playbackRate!==1&&t.playbackRate!==0&&this.changeMediaPlaybackRate(t,1)},this.hls=e,this.config=e.config,this.registerListeners()}get levelDetails(){var e;return((e=this.hls)==null?void 0:e.latestLevelDetails)||null}get latency(){return this._latency||0}get maxLatency(){const{config:e}=this;if(e.liveMaxLatencyDuration!==void 0)return e.liveMaxLatencyDuration;const t=this.levelDetails;return t?e.liveMaxLatencyDurationCount*t.targetduration:0}get targetLatency(){const e=this.levelDetails;if(e===null||this.hls===null)return null;const{holdBack:t,partHoldBack:n,targetduration:r}=e,{liveSyncDuration:s,liveSyncDurationCount:o,lowLatencyMode:a}=this.config,l=this.hls.userConfig;let c=a&&n||t;(this._targetLatencyUpdated||l.liveSyncDuration||l.liveSyncDurationCount||c===0)&&(c=s!==void 0?s:o*r);const u=r;return c+Math.min(this.stallCount*this.config.liveSyncOnStallIncrease,u)}set targetLatency(e){this.stallCount=0,this.config.liveSyncDuration=e,this._targetLatencyUpdated=!0}get liveSyncPosition(){const e=this.estimateLiveEdge(),t=this.targetLatency;if(e===null||t===null)return null;const n=this.levelDetails;if(n===null)return null;const r=n.edge,s=e-t-this.edgeStalled,o=r-n.totalduration,a=r-(this.config.lowLatencyMode&&n.partTarget||n.targetduration);return Math.min(Math.max(o,s),a)}get drift(){const e=this.levelDetails;return e===null?1:e.drift}get edgeStalled(){const e=this.levelDetails;if(e===null)return 0;const t=(this.config.lowLatencyMode&&e.partTarget||e.targetduration)*3;return Math.max(e.age-t,0)}get forwardBufferLength(){const{media:e}=this,t=this.levelDetails;if(!e||!t)return 0;const n=e.buffered.length;return(n?e.buffered.end(n-1):t.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.hls=null}registerListeners(){const{hls:e}=this;e&&(e.on(ae.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(ae.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(ae.MANIFEST_LOADING,this.onManifestLoading,this),e.on(ae.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(ae.ERROR,this.onError,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(ae.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(ae.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(ae.MANIFEST_LOADING,this.onManifestLoading,this),e.off(ae.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(ae.ERROR,this.onError,this))}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.onTimeupdate)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.onTimeupdate),this.media=null)}onManifestLoading(){this._latency=null,this.stallCount=0}onLevelUpdated(e,{details:t}){t.advanced&&this.onTimeupdate(),!t.live&&this.media&&this.media.removeEventListener("timeupdate",this.onTimeupdate)}onError(e,t){var n;t.details===Ke.BUFFER_STALLED_ERROR&&(this.stallCount++,this.hls&&(n=this.levelDetails)!=null&&n.live&&this.hls.logger.warn("[latency-controller]: Stall detected, adjusting target latency"))}changeMediaPlaybackRate(e,t){var n,r;e.playbackRate!==t&&((n=this.hls)==null||n.logger.debug(`[latency-controller]: latency=${this.latency.toFixed(3)}, targetLatency=${(r=this.targetLatency)==null?void 0:r.toFixed(3)}, forwardBufferLength=${this.forwardBufferLength.toFixed(3)}: adjusting playback rate from ${e.playbackRate} to ${t}`),e.playbackRate=t)}estimateLiveEdge(){const e=this.levelDetails;return e===null?null:e.edge+e.age}computeLatency(){const e=this.estimateLiveEdge();return e===null?null:e-this.currentTime}}class F1e extends S4{constructor(e,t){super(e,"level-controller"),this._levels=[],this._firstLevel=-1,this._maxAutoLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=t,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(ae.MANIFEST_LOADING,this.onManifestLoading,this),e.on(ae.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(ae.LEVEL_LOADED,this.onLevelLoaded,this),e.on(ae.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(ae.FRAG_BUFFERED,this.onFragBuffered,this),e.on(ae.ERROR,this.onError,this)}_unregisterListeners(){const{hls:e}=this;e.off(ae.MANIFEST_LOADING,this.onManifestLoading,this),e.off(ae.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(ae.LEVEL_LOADED,this.onLevelLoaded,this),e.off(ae.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(ae.FRAG_BUFFERED,this.onFragBuffered,this),e.off(ae.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}stopLoad(){this._levels.forEach(t=>{t.loadError=0,t.fragmentError=0}),super.stopLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1}onManifestLoading(e,t){this.resetLevels()}onManifestLoaded(e,t){const n=this.hls.config.preferManagedMediaSource,r=[],s={},o={};let a=!1,l=!1,c=!1;t.levels.forEach(u=>{const h=u.attrs;let{audioCodec:f,videoCodec:d}=u;f&&(u.audioCodec=f=VS(f,n)||void 0),d&&(d=u.videoCodec=Lpe(d));const{width:m,height:y,unknownCodecs:g}=u,A=(g==null?void 0:g.length)||0;if(a||(a=!!(m&&y)),l||(l=!!d),c||(c=!!f),A||f&&!this.isAudioSupported(f)||d&&!this.isVideoSupported(d)){this.log(`Some or all CODECS not supported "${h.CODECS}"`);return}const{CODECS:E,"FRAME-RATE":x,"HDCP-LEVEL":w,"PATHWAY-ID":T,RESOLUTION:I,"VIDEO-RANGE":M}=h,P=`${`${T||"."}-`}${u.bitrate}-${I}-${x}-${E}-${M}-${w}`;if(s[P])if(s[P].uri!==u.url&&!u.attrs["PATHWAY-ID"]){const R=o[P]+=1;u.attrs["PATHWAY-ID"]=new Array(R+1).join(".");const U=this.createLevel(u);s[P]=U,r.push(U)}else s[P].addGroupId("audio",h.AUDIO),s[P].addGroupId("text",h.SUBTITLES);else{const R=this.createLevel(u);s[P]=R,o[P]=1,r.push(R)}}),this.filterAndSortMediaOptions(r,t,a,l,c)}createLevel(e){const t=new hA(e),n=e.supplemental;if(n!=null&&n.videoCodec&&!this.isVideoSupported(n.videoCodec)){const r=new Error(`SUPPLEMENTAL-CODECS not supported "${n.videoCodec}"`);this.log(r.message),t.supportedResult=zQ(r,[])}return t}isAudioSupported(e){return j2(e,"audio",this.hls.config.preferManagedMediaSource)}isVideoSupported(e){return j2(e,"video",this.hls.config.preferManagedMediaSource)}filterAndSortMediaOptions(e,t,n,r,s){var o;let a=[],l=[],c=e;const u=((o=t.stats)==null?void 0:o.parsing)||{};if((n||r)&&s&&(c=c.filter(({videoCodec:E,videoRange:x,width:w,height:T})=>(!!E||!!(w&&T))&&Hpe(x))),c.length===0){Promise.resolve().then(()=>{if(this.hls){let E="no level with compatible codecs found in manifest",x=E;t.levels.length&&(x=`one or more CODECS in variant not supported: ${lr(t.levels.map(T=>T.attrs.CODECS).filter((T,I,M)=>M.indexOf(T)===I))}`,this.warn(x),E+=` (${x})`);const w=new Error(E);this.hls.trigger(ae.ERROR,{type:rn.MEDIA_ERROR,details:Ke.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,error:w,reason:x})}}),u.end=performance.now();return}t.audioTracks&&(a=t.audioTracks.filter(E=>!E.audioCodec||this.isAudioSupported(E.audioCodec)),jk(a)),t.subtitles&&(l=t.subtitles,jk(l));const h=c.slice(0);c.sort((E,x)=>{if(E.attrs["HDCP-LEVEL"]!==x.attrs["HDCP-LEVEL"])return(E.attrs["HDCP-LEVEL"]||"")>(x.attrs["HDCP-LEVEL"]||"")?1:-1;if(n&&E.height!==x.height)return E.height-x.height;if(E.frameRate!==x.frameRate)return E.frameRate-x.frameRate;if(E.videoRange!==x.videoRange)return jS.indexOf(E.videoRange)-jS.indexOf(x.videoRange);if(E.videoCodec!==x.videoCodec){const w=N7(E.videoCodec),T=N7(x.videoCodec);if(w!==T)return T-w}if(E.uri===x.uri&&E.codecSet!==x.codecSet){const w=QS(E.codecSet),T=QS(x.codecSet);if(w!==T)return T-w}return E.averageBitrate!==x.averageBitrate?E.averageBitrate-x.averageBitrate:0});let f=h[0];if(this.steering&&(c=this.steering.filterParsedLevels(c),c.length!==h.length)){for(let E=0;E<h.length;E++)if(h[E].pathwayId===c[0].pathwayId){f=h[E];break}}this._levels=c;for(let E=0;E<c.length;E++)if(c[E]===f){var d;this._firstLevel=E;const x=f.bitrate,w=this.hls.bandwidthEstimate;if(this.log(`manifest loaded, ${c.length} level(s) found, first bitrate: ${x}`),((d=this.hls.userConfig)==null?void 0:d.abrEwmaDefaultEstimate)===void 0){const T=Math.min(x,this.hls.config.abrEwmaDefaultEstimateMax);T>w&&w===this.hls.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=T)}break}const m=s&&!r,y=this.hls.config,g=!!(y.audioStreamController&&y.audioTrackController),A={levels:c,audioTracks:a,subtitleTracks:l,sessionData:t.sessionData,sessionKeys:t.sessionKeys,firstLevel:this._firstLevel,stats:t.stats,audio:s,video:r,altAudio:g&&!m&&a.some(E=>!!E.url)};u.end=performance.now(),this.hls.trigger(ae.MANIFEST_PARSED,A)}get levels(){return this._levels.length===0?null:this._levels}get loadLevelObj(){return this.currentLevel}get level(){return this.currentLevelIndex}set level(e){const t=this._levels;if(t.length===0)return;if(e<0||e>=t.length){const u=new Error("invalid level idx"),h=e<0;if(this.hls.trigger(ae.ERROR,{type:rn.OTHER_ERROR,details:Ke.LEVEL_SWITCH_ERROR,level:e,fatal:h,error:u,reason:u.message}),h)return;e=Math.min(e,t.length-1)}const n=this.currentLevelIndex,r=this.currentLevel,s=r?r.attrs["PATHWAY-ID"]:void 0,o=t[e],a=o.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=o,n===e&&r&&s===a)return;this.log(`Switching to level ${e} (${o.height?o.height+"p ":""}${o.videoRange?o.videoRange+" ":""}${o.codecSet?o.codecSet+" ":""}@${o.bitrate})${a?" with Pathway "+a:""} from level ${n}${s?" with Pathway "+s:""}`);const l={level:e,attrs:o.attrs,details:o.details,bitrate:o.bitrate,averageBitrate:o.averageBitrate,maxBitrate:o.maxBitrate,realBitrate:o.realBitrate,width:o.width,height:o.height,codecSet:o.codecSet,audioCodec:o.audioCodec,videoCodec:o.videoCodec,audioGroups:o.audioGroups,subtitleGroups:o.subtitleGroups,loaded:o.loaded,loadError:o.loadError,fragmentError:o.fragmentError,name:o.name,id:o.id,uri:o.uri,url:o.url,urlId:0,audioGroupIds:o.audioGroupIds,textGroupIds:o.textGroupIds};this.hls.trigger(ae.LEVEL_SWITCHING,l);const c=o.details;if(!c||c.live){const u=this.switchParams(o.uri,r==null?void 0:r.details,c);this.loadPlaylist(u)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(e){this.manualLevelIndex=e,this._startLevel===void 0&&(this._startLevel=e),e!==-1&&(this.level=e)}get firstLevel(){return this._firstLevel}set firstLevel(e){this._firstLevel=e}get startLevel(){if(this._startLevel===void 0){const e=this.hls.config.startLevel;return e!==void 0?e:this.hls.firstAutoLevel}return this._startLevel}set startLevel(e){this._startLevel=e}get pathways(){return this.steering?this.steering.pathways():[]}get pathwayPriority(){return this.steering?this.steering.pathwayPriority:null}set pathwayPriority(e){if(this.steering){const t=this.steering.pathways(),n=e.filter(r=>t.indexOf(r)!==-1);if(e.length<1){this.warn(`pathwayPriority ${e} should contain at least one pathway from list: ${t}`);return}this.steering.pathwayPriority=n}}onError(e,t){t.fatal||!t.context||t.context.type===ai.LEVEL&&t.context.level===this.level&&this.checkRetry(t)}onFragBuffered(e,{frag:t}){if(t!==void 0&&t.type===$t.MAIN){const n=t.elementaryStreams;if(!Object.keys(n).some(s=>!!n[s]))return;const r=this._levels[t.level];r!=null&&r.loadError&&(this.log(`Resetting level error count of ${r.loadError} on frag buffered`),r.loadError=0)}}onLevelLoaded(e,t){var n;const{level:r,details:s}=t,o=t.levelInfo;if(!o){var a;this.warn(`Invalid level index ${r}`),(a=t.deliveryDirectives)!=null&&a.skip&&(s.deltaUpdateFailed=!0);return}if(o===this.currentLevel||t.withoutMultiVariant){o.fragmentError===0&&(o.loadError=0);let l=o.details;l===t.details&&l.advanced&&(l=void 0),this.playlistLoaded(r,t,l)}else(n=t.deliveryDirectives)!=null&&n.skip&&(s.deltaUpdateFailed=!0)}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentLevel)&&this.scheduleLoading(this.currentLevel,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const n=this.getUrlWithDirectives(e.uri,t),r=this.currentLevelIndex,s=e.attrs["PATHWAY-ID"],o=e.details,a=o==null?void 0:o.age;this.log(`Loading level index ${r}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${s?" Pathway "+s:""}${a&&o.live?" age "+a.toFixed(1)+(o.type&&" "+o.type||""):""} ${n}`),this.hls.trigger(ae.LEVEL_LOADING,{url:n,level:r,levelInfo:e,pathwayId:e.attrs["PATHWAY-ID"],id:0,deliveryDirectives:t||null})}get nextLoadLevel(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(e){this.level=e,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=e)}removeLevel(e){var t;if(this._levels.length===1)return;const n=this._levels.filter((s,o)=>o!==e?!0:(this.steering&&this.steering.removeLevel(s),s===this.currentLevel&&(this.currentLevel=null,this.currentLevelIndex=-1,s.details&&s.details.fragments.forEach(a=>a.level=-1)),!1));lV(n),this._levels=n,this.currentLevelIndex>-1&&(t=this.currentLevel)!=null&&t.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.manualLevelIndex>-1&&(this.manualLevelIndex=this.currentLevelIndex);const r=n.length-1;this._firstLevel=Math.min(this._firstLevel,r),this._startLevel&&(this._startLevel=Math.min(this._startLevel,r)),this.hls.trigger(ae.LEVELS_UPDATED,{levels:n})}onLevelsUpdated(e,{levels:t}){this._levels=t}checkMaxAutoUpdated(){const{autoLevelCapping:e,maxAutoLevel:t,maxHdcpLevel:n}=this.hls;this._maxAutoLevel!==t&&(this._maxAutoLevel=t,this.hls.trigger(ae.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:e,levels:this.levels,maxAutoLevel:t,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:n}))}}function jk(i){const e={};i.forEach(t=>{const n=t.groupId||"";t.id=e[n]=e[n]||0,e[n]++})}function dj(){return self.SourceBuffer||self.WebKitSourceBuffer}function o8(){if(!Uf())return!1;const e=dj();return!e||e.prototype&&typeof e.prototype.appendBuffer=="function"&&typeof e.prototype.remove=="function"}function pj(){if(!o8())return!1;const i=Uf();return typeof(i==null?void 0:i.isTypeSupported)=="function"&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some(e=>i.isTypeSupported(W2(e,"video")))||["mp4a.40.2","fLaC"].some(e=>i.isTypeSupported(W2(e,"audio"))))}function O1e(){var i;const e=dj();return typeof(e==null||(i=e.prototype)==null?void 0:i.changeType)=="function"}const N1e=100;class U1e extends E4{constructor(e,t,n){super(e,t,n,"stream-controller",$t.MAIN),this.audioCodecSwap=!1,this.level=-1,this._forceStartLoad=!1,this._hasEnoughToStart=!1,this.altAudio=0,this.audioOnly=!1,this.fragPlaying=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this.onMediaPlaying=()=>{this.tick()},this.onMediaSeeked=()=>{const r=this.media,s=r?r.currentTime:null;if(s===null||!jt(s)||(this.log(`Media seeked to ${s.toFixed(3)}`),!this.getBufferedFrag(s)))return;const o=this.getFwdBufferInfoAtPos(r,s,$t.MAIN,0);if(o===null||o.len===0){this.warn(`Main forward buffer length at ${s} on "seeked" event ${o?o.len:"empty"})`);return}this.tick()},this.registerListeners()}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(ae.MANIFEST_PARSED,this.onManifestParsed,this),e.on(ae.LEVEL_LOADING,this.onLevelLoading,this),e.on(ae.LEVEL_LOADED,this.onLevelLoaded,this),e.on(ae.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(ae.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(ae.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(ae.BUFFER_CREATED,this.onBufferCreated,this),e.on(ae.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(ae.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(ae.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(ae.MANIFEST_PARSED,this.onManifestParsed,this),e.off(ae.LEVEL_LOADED,this.onLevelLoaded,this),e.off(ae.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(ae.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(ae.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(ae.BUFFER_CREATED,this.onBufferCreated,this),e.off(ae.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(ae.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(ae.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this.onMediaPlaying=this.onMediaSeeked=null,this.unregisterListeners(),super.onHandlerDestroying()}startLoad(e,t){if(this.levels){const{lastCurrentTime:n,hls:r}=this;if(this.stopLoad(),this.setInterval(N1e),this.level=-1,!this.startFragRequested){let s=r.startLevel;s===-1&&(r.config.testBandwidth&&this.levels.length>1?(s=0,this.bitrateTest=!0):s=r.firstAutoLevel),r.nextLoadLevel=s,this.level=r.loadLevel,this._hasEnoughToStart=!!t}n>0&&e===-1&&!t&&(this.log(`Override startPosition with lastCurrentTime @${n.toFixed(3)}`),e=n),this.state=mt.IDLE,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}else this._forceStartLoad=!0,this.state=mt.STOPPED}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case mt.WAITING_LEVEL:{const{levels:e,level:t}=this,n=e==null?void 0:e[t],r=n==null?void 0:n.details;if(r&&(!r.live||this.levelLastLoaded===n&&!this.waitForLive(n))){if(this.waitForCdnTuneIn(r))break;this.state=mt.IDLE;break}else if(this.hls.nextLoadLevel!==this.level){this.state=mt.IDLE;break}break}case mt.FRAG_LOADING_WAITING_RETRY:this.checkRetryDate();break}this.state===mt.IDLE&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){var e;super.onTickEnd(),(e=this.media)!=null&&e.readyState&&this.media.seeking===!1&&(this.lastCurrentTime=this.media.currentTime),this.checkFragmentChanged()}doTickIdle(){const{hls:e,levelLastLoaded:t,levels:n,media:r}=this;if(t===null||!r&&!this.primaryPrefetch&&(this.startFragRequested||!e.config.startFragPrefetch)||this.altAudio&&this.audioOnly)return;const s=this.buffering?e.nextLoadLevel:e.loadLevel;if(!(n!=null&&n[s]))return;const o=n[s],a=this.getMainFwdBufferInfo();if(a===null)return;const l=this.getLevelDetails();if(l&&this._streamEnded(a,l)){const y={};this.altAudio===2&&(y.type="video"),this.hls.trigger(ae.BUFFER_EOS,y),this.state=mt.ENDED;return}if(!this.buffering)return;e.loadLevel!==s&&e.manualLevel===-1&&this.log(`Adapting to level ${s} from level ${this.level}`),this.level=e.nextLoadLevel=s;const c=o.details;if(!c||this.state===mt.WAITING_LEVEL||this.waitForLive(o)){this.level=s,this.state=mt.WAITING_LEVEL,this.startFragRequested=!1;return}const u=a.len,h=this.getMaxBufferLength(o.maxBitrate);if(u>=h)return;this.backtrackFragment&&this.backtrackFragment.start>a.end&&(this.backtrackFragment=null);const f=this.backtrackFragment?this.backtrackFragment.start:a.end;let d=this.getNextFragment(f,c);if(this.couldBacktrack&&!this.fragPrevious&&d&&As(d)&&this.fragmentTracker.getState(d)!==eo.OK){var m;const g=((m=this.backtrackFragment)!=null?m:d).sn-c.startSN,A=c.fragments[g-1];A&&d.cc===A.cc&&(d=A,this.fragmentTracker.removeFragment(A))}else this.backtrackFragment&&a.len&&(this.backtrackFragment=null);if(d&&this.isLoopLoading(d,f)){if(!d.gap){const g=this.audioOnly&&!this.altAudio?ar.AUDIO:ar.VIDEO,A=(g===ar.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;A&&this.afterBufferFlushed(A,g,$t.MAIN)}d=this.getNextFragmentLoopLoading(d,c,a,$t.MAIN,h)}d&&(d.initSegment&&!d.initSegment.data&&!this.bitrateTest&&(d=d.initSegment),this.loadFragment(d,o,f))}loadFragment(e,t,n){const r=this.fragmentTracker.getState(e);r===eo.NOT_LOADED||r===eo.PARTIAL?As(e)?this.bitrateTest?(this.log(`Fragment ${e.sn} of level ${e.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(e,t)):super.loadFragment(e,t,n):this._loadInitSegment(e,t):this.clearTrackerIfNeeded(e)}getBufferedFrag(e){return this.fragmentTracker.getBufferedFrag(e,$t.MAIN)}followingBufferedFrag(e){return e?this.getBufferedFrag(e.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:e,media:t}=this;if(t!=null&&t.readyState){let n;const r=this.getAppendedFrag(t.currentTime);r&&r.start>1&&this.flushMainBuffer(0,r.start-1);const s=this.getLevelDetails();if(s!=null&&s.live){const a=this.getMainFwdBufferInfo();if(!a||a.len<s.targetduration*2)return}if(!t.paused&&e){const a=this.hls.nextLoadLevel,l=e[a],c=this.fragLastKbps;c&&this.fragCurrent?n=this.fragCurrent.duration*l.maxBitrate/(1e3*c)+1:n=0}else n=0;const o=this.getBufferedFrag(t.currentTime+n);if(o){const a=this.followingBufferedFrag(o);if(a){this.abortCurrentFrag();const l=a.maxStartPTS?a.maxStartPTS:a.start,c=a.duration,u=Math.max(o.end,l+Math.min(Math.max(c-this.config.maxFragLookUpTolerance,c*(this.couldBacktrack?.5:.125)),c*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(u,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case mt.KEY_LOADING:case mt.FRAG_LOADING:case mt.FRAG_LOADING_WAITING_RETRY:case mt.PARSING:case mt.PARSED:this.state=mt.IDLE;break}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(e,t){super.flushMainBuffer(e,t,this.altAudio===2?"video":null)}onMediaAttached(e,t){super.onMediaAttached(e,t);const n=t.media;_a(n,"playing",this.onMediaPlaying),_a(n,"seeked",this.onMediaSeeked)}onMediaDetaching(e,t){const{media:n}=this;n&&(Za(n,"playing",this.onMediaPlaying),Za(n,"seeked",this.onMediaSeeked)),this.videoBuffer=null,this.fragPlaying=null,super.onMediaDetaching(e,t),!t.transferMedia&&(this._hasEnoughToStart=!1)}onManifestLoading(){super.onManifestLoading(),this.log("Trigger BUFFER_RESET"),this.hls.trigger(ae.BUFFER_RESET,void 0),this.couldBacktrack=!1,this.fragLastKbps=0,this.fragPlaying=this.backtrackFragment=null,this.altAudio=0,this.audioOnly=!1}onManifestParsed(e,t){let n=!1,r=!1;for(let s=0;s<t.levels.length;s++){const o=t.levels[s].audioCodec;o&&(n=n||o.indexOf("mp4a.40.2")!==-1,r=r||o.indexOf("mp4a.40.5")!==-1)}this.audioCodecSwitch=n&&r&&!O1e(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1}onLevelLoading(e,t){const{levels:n}=this;if(!n||this.state!==mt.IDLE)return;const r=t.levelInfo;(!r.details||r.details.live&&(this.levelLastLoaded!==r||r.details.expired)||this.waitForCdnTuneIn(r.details))&&(this.state=mt.WAITING_LEVEL)}onLevelLoaded(e,t){var n;const{levels:r,startFragRequested:s}=this,o=t.level,a=t.details,l=a.totalduration;if(!r){this.warn(`Levels were reset while loading level ${o}`);return}this.log(`Level ${o} loaded [${a.startSN},${a.endSN}]${a.lastPartSn?`[part-${a.lastPartSn}-${a.lastPartIndex}]`:""}, cc [${a.startCC}, ${a.endCC}] duration:${l}`);const c=t.levelInfo,u=this.fragCurrent;u&&(this.state===mt.FRAG_LOADING||this.state===mt.FRAG_LOADING_WAITING_RETRY)&&u.level!==t.level&&u.loader&&this.abortCurrentFrag();let h=0;if(a.live||(n=c.details)!=null&&n.live){var f;if(this.checkLiveUpdate(a),a.deltaUpdateFailed)return;h=this.alignPlaylists(a,c.details,(f=this.levelLastLoaded)==null?void 0:f.details)}if(c.details=a,this.levelLastLoaded=c,s||this.setStartPosition(a,h),this.hls.trigger(ae.LEVEL_UPDATED,{details:a,level:o}),this.state===mt.WAITING_LEVEL){if(this.waitForCdnTuneIn(a))return;this.state=mt.IDLE}s&&a.live&&this.synchronizeToLiveEdge(a),this.tick()}synchronizeToLiveEdge(e){const{config:t,media:n}=this;if(!n)return;const r=this.hls.liveSyncPosition,s=this.getLoadPosition(),o=e.fragmentStart,a=e.edge,l=s>=o-t.maxFragLookUpTolerance&&s<=a;if(r!==null&&n.duration>r&&(s<r||!l)){const u=t.liveMaxLatencyDuration!==void 0?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;if((!l&&n.readyState<4||s<a-u)&&(this._hasEnoughToStart||(this.nextLoadPosition=r),n.readyState))if(this.warn(`Playback: ${s.toFixed(3)} is located too far from the end of live sliding playlist: ${a}, reset currentTime to : ${r.toFixed(3)}`),this.config.liveSyncMode==="buffered"){var c;const h=Wn.bufferInfo(n,r,0);if(!((c=h.buffered)!=null&&c.length)){n.currentTime=r;return}if(h.start<=s){n.currentTime=r;return}const{nextStart:d}=Wn.bufferedInfo(h.buffered,s,0);d&&(n.currentTime=d)}else n.currentTime=r}}_handleFragmentLoadProgress(e){var t;const n=e.frag,{part:r,payload:s}=e,{levels:o}=this;if(!o){this.warn(`Levels were reset while fragment load was in progress. Fragment ${n.sn} of level ${n.level} will not be buffered`);return}const a=o[n.level];if(!a){this.warn(`Level ${n.level} not found on progress`);return}const l=a.details;if(!l){this.warn(`Dropping fragment ${n.sn} of level ${n.level} after level details were reset`),this.fragmentTracker.removeFragment(n);return}const c=a.videoCodec,u=l.PTSKnown||!l.live,h=(t=n.initSegment)==null?void 0:t.data,f=this._getAudioCodec(a),d=this.transmuxer=this.transmuxer||new RV(this.hls,$t.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),m=r?r.index:-1,y=m!==-1,g=new x4(n.level,n.sn,n.stats.chunkCount,s.byteLength,m,y),A=this.initPTS[n.cc];d.push(s,h,f,c,n,r,l.totalduration,u,g,A)}onAudioTrackSwitching(e,t){const n=this.hls,r=this.altAudio!==0;if(WS(t.url,n))this.altAudio=1;else{if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const o=this.fragCurrent;o&&(this.log("Switching to main audio track, cancel main fragment load"),o.abortRequests(),this.fragmentTracker.removeFragment(o)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();if(r){this.altAudio=0,this.fragmentTracker.removeAllFragments(),n.once(ae.BUFFER_FLUSHED,()=>{this.hls&&this.hls.trigger(ae.AUDIO_TRACK_SWITCHED,t)}),n.trigger(ae.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null});return}n.trigger(ae.AUDIO_TRACK_SWITCHED,t)}}onAudioTrackSwitched(e,t){const n=WS(t.url,this.hls);if(n){const r=this.videoBuffer;r&&this.mediaBuffer!==r&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=r)}this.altAudio=n?2:0,this.tick()}onBufferCreated(e,t){const n=t.tracks;let r,s,o=!1;for(const a in n){const l=n[a];if(l.id==="main"){if(s=a,r=l,a==="video"){const c=n[a];c&&(this.videoBuffer=c.buffer)}}else o=!0}o&&r?(this.log(`Alternate track found, use ${s}.buffered to schedule main fragment loading`),this.mediaBuffer=r.buffer):this.mediaBuffer=this.media}onFragBuffered(e,t){const{frag:n,part:r}=t,s=n.type===$t.MAIN;if(s){if(this.fragContextChanged(n)){this.warn(`Fragment ${n.sn}${r?" p: "+r.index:""} of level ${n.level} finished buffering, but was aborted. state: ${this.state}`),this.state===mt.PARSED&&(this.state=mt.IDLE);return}const a=r?r.stats:n.stats;this.fragLastKbps=Math.round(8*a.total/(a.buffering.end-a.loading.first)),As(n)&&(this.fragPrevious=n),this.fragBufferedComplete(n,r)}const o=this.media;o&&(!this._hasEnoughToStart&&Wn.getBuffered(o).length&&(this._hasEnoughToStart=!0,this.seekToStartPos()),s&&this.tick())}get hasEnoughToStart(){return this._hasEnoughToStart}onError(e,t){var n;if(t.fatal){this.state=mt.ERROR;return}switch(t.details){case Ke.FRAG_GAP:case Ke.FRAG_PARSING_ERROR:case Ke.FRAG_DECRYPT_ERROR:case Ke.FRAG_LOAD_ERROR:case Ke.FRAG_LOAD_TIMEOUT:case Ke.KEY_LOAD_ERROR:case Ke.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError($t.MAIN,t);break;case Ke.LEVEL_LOAD_ERROR:case Ke.LEVEL_LOAD_TIMEOUT:case Ke.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===mt.WAITING_LEVEL&&((n=t.context)==null?void 0:n.type)===ai.LEVEL&&(this.state=mt.IDLE);break;case Ke.BUFFER_ADD_CODEC_ERROR:case Ke.BUFFER_APPEND_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&this.resetLoadingState();break;case Ke.BUFFER_FULL_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&(!this.config.interstitialsController&&this.config.assetPlayerId?this._hasEnoughToStart=!0:this.flushMainBuffer(0,Number.POSITIVE_INFINITY));break;case Ke.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onFragLoadEmergencyAborted(){this.state=mt.IDLE,this._hasEnoughToStart||(this.startFragRequested=!1,this.nextLoadPosition=this.lastCurrentTime),this.tickImmediate()}onBufferFlushed(e,{type:t}){if(t!==ar.AUDIO||!this.altAudio){const n=(t===ar.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;n&&(this.afterBufferFlushed(n,t,$t.MAIN),this.tick())}}onLevelsUpdated(e,t){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level,this.level===-1&&this.resetWhenMissingContext(this.fragCurrent)),this.levels=t.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:e}=this;if(!e)return;const t=e.currentTime;let n=this.startPosition;if(n>=0&&t<n){if(e.seeking){this.log(`could not seek to ${n}, already seeking at ${t}`);return}const r=this.timelineOffset;r&&n&&(n+=r);const s=this.getLevelDetails(),o=Wn.getBuffered(e),a=o.length?o.start(0):0,l=a-n,c=Math.max(this.config.maxBufferHole,this.config.maxFragLookUpTolerance);(this.config.startOnSegmentBoundary||l>0&&(l<c||this.loadingParts&&l<2*((s==null?void 0:s.partTarget)||0)))&&(this.log(`adjusting start position by ${l} to match buffer start`),n+=l,this.startPosition=n),t<n&&(this.log(`seek to target start position ${n} from current time ${t} buffer start ${a}`),e.currentTime=n)}}_getAudioCodec(e){let t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t.indexOf("mp4a.40.5")!==-1?t="mp4a.40.2":t="mp4a.40.5"),t}_loadBitrateTestFrag(e,t){e.bitrateTest=!0,this._doFragLoad(e,t).then(n=>{const{hls:r}=this,s=n==null?void 0:n.frag;if(!s||this.fragContextChanged(s))return;t.fragmentError=0,this.state=mt.IDLE,this.startFragRequested=!1,this.bitrateTest=!1;const o=s.stats;o.parsing.start=o.parsing.end=o.buffering.start=o.buffering.end=self.performance.now(),r.trigger(ae.FRAG_LOADED,n),s.bitrateTest=!1}).catch(n=>{this.state===mt.STOPPED||this.state===mt.ERROR||(this.warn(n),this.resetFragmentLoading(e))})}_handleTransmuxComplete(e){const t=this.playlistType,{hls:n}=this,{remuxResult:r,chunkMeta:s}=e,o=this.getCurrentContext(s);if(!o){this.resetWhenMissingContext(s);return}const{frag:a,part:l,level:c}=o,{video:u,text:h,id3:f,initSegment:d}=r,{details:m}=c,y=this.altAudio?void 0:r.audio;if(this.fragContextChanged(a)){this.fragmentTracker.removeFragment(a);return}if(this.state=mt.PARSING,d){const g=d.tracks;if(g){const w=a.initSegment||a;if(this.unhandledEncryptionError(d,a))return;this._bufferInitSegment(c,g,w,s),n.trigger(ae.FRAG_PARSING_INIT_SEGMENT,{frag:w,id:t,tracks:g})}const A=d.initPTS,E=d.timescale,x=this.initPTS[a.cc];if(jt(A)&&(!x||x.baseTime!==A||x.timescale!==E)){const w=d.trackId;this.initPTS[a.cc]={baseTime:A,timescale:E,trackId:w},n.trigger(ae.INIT_PTS_FOUND,{frag:a,id:t,initPTS:A,timescale:E,trackId:w})}}if(u&&m){y&&u.type==="audiovideo"&&this.logMuxedErr(a);const g=m.fragments[a.sn-1-m.startSN],A=a.sn===m.startSN,E=!g||a.cc>g.cc;if(r.independent!==!1){const{startPTS:x,endPTS:w,startDTS:T,endDTS:I}=u;if(l)l.elementaryStreams[u.type]={startPTS:x,endPTS:w,startDTS:T,endDTS:I};else if(u.firstKeyFrame&&u.independent&&s.id===1&&!E&&(this.couldBacktrack=!0),u.dropped&&u.independent){const M=this.getMainFwdBufferInfo(),L=(M?M.end:this.getLoadPosition())+this.config.maxBufferHole,P=u.firstKeyFramePTS?u.firstKeyFramePTS:x;if(!A&&L<P-this.config.maxBufferHole&&!E){this.backtrack(a);return}else E&&(a.gap=!0);a.setElementaryStreamInfo(u.type,a.start,w,a.start,I,!0)}else A&&x-(m.appliedTimelineOffset||0)>lS&&(a.gap=!0);a.setElementaryStreamInfo(u.type,x,w,T,I),this.backtrackFragment&&(this.backtrackFragment=a),this.bufferFragmentData(u,a,l,s,A||E)}else if(A||E)a.gap=!0;else{this.backtrack(a);return}}if(y){const{startPTS:g,endPTS:A,startDTS:E,endDTS:x}=y;l&&(l.elementaryStreams[ar.AUDIO]={startPTS:g,endPTS:A,startDTS:E,endDTS:x}),a.setElementaryStreamInfo(ar.AUDIO,g,A,E,x),this.bufferFragmentData(y,a,l,s)}if(m&&f!=null&&f.samples.length){const g={id:t,frag:a,details:m,samples:f.samples};n.trigger(ae.FRAG_PARSING_METADATA,g)}if(m&&h){const g={id:t,frag:a,details:m,samples:h.samples};n.trigger(ae.FRAG_PARSING_USERDATA,g)}}logMuxedErr(e){this.warn(`${As(e)?"Media":"Init"} segment with muxed audiovideo where only video expected: ${e.url}`)}_bufferInitSegment(e,t,n,r){if(this.state!==mt.PARSING)return;this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&(delete t.audio,t.audiovideo&&this.logMuxedErr(n));const{audio:s,video:o,audiovideo:a}=t;if(s){const c=e.audioCodec;let u=nS(s.codec,c);u==="mp4a"&&(u="mp4a.40.5");const h=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){u&&(u.indexOf("mp4a.40.5")!==-1?u="mp4a.40.2":u="mp4a.40.5");const f=s.metadata;f&&"channelCount"in f&&(f.channelCount||1)!==1&&h.indexOf("firefox")===-1&&(u="mp4a.40.5")}u&&u.indexOf("mp4a.40.5")!==-1&&h.indexOf("android")!==-1&&s.container!=="audio/mpeg"&&(u="mp4a.40.2",this.log(`Android: force audio codec to ${u}`)),c&&c!==u&&this.log(`Swapping manifest audio codec "${c}" for "${u}"`),s.levelCodec=u,s.id=$t.MAIN,this.log(`Init audio buffer, container:${s.container}, codecs[selected/level/parsed]=[${u||""}/${c||""}/${s.codec}]`),delete t.audiovideo}if(o){o.levelCodec=e.videoCodec,o.id=$t.MAIN;const c=o.codec;if((c==null?void 0:c.length)===4)switch(c){case"hvc1":case"hev1":o.codec="hvc1.1.6.L120.90";break;case"av01":o.codec="av01.0.04M.08";break;case"avc1":o.codec="avc1.42e01e";break}this.log(`Init video buffer, container:${o.container}, codecs[level/parsed]=[${e.videoCodec||""}/${c}]${o.codec!==c?" parsed-corrected="+o.codec:""}${o.supplemental?" supplemental="+o.supplemental:""}`),delete t.audiovideo}a&&(this.log(`Init audiovideo buffer, container:${a.container}, codecs[level/parsed]=[${e.codecs}/${a.codec}]`),delete t.video,delete t.audio);const l=Object.keys(t);if(l.length){if(this.hls.trigger(ae.BUFFER_CODECS,t),!this.hls)return;l.forEach(c=>{const h=t[c].initSegment;h!=null&&h.byteLength&&this.hls.trigger(ae.BUFFER_APPENDING,{type:c,data:h,frag:n,part:null,chunkMeta:r,parent:n.type})})}this.tickImmediate()}getMainFwdBufferInfo(){const e=this.mediaBuffer&&this.altAudio===2?this.mediaBuffer:this.media;return this.getFwdBufferInfo(e,$t.MAIN)}get maxBufferLength(){const{levels:e,level:t}=this,n=e==null?void 0:e[t];return n?this.getMaxBufferLength(n.maxBitrate):this.config.maxBufferLength}backtrack(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=mt.IDLE}checkFragmentChanged(){const e=this.media;let t=null;if(e&&e.readyState>1&&e.seeking===!1){const n=e.currentTime;if(Wn.isBuffered(e,n)?t=this.getAppendedFrag(n):Wn.isBuffered(e,n+.1)&&(t=this.getAppendedFrag(n+.1)),t){this.backtrackFragment=null;const r=this.fragPlaying,s=t.level;(!r||t.sn!==r.sn||r.level!==s)&&(this.fragPlaying=t,this.hls.trigger(ae.FRAG_CHANGED,{frag:t}),(!r||r.level!==s)&&this.hls.trigger(ae.LEVEL_SWITCHED,{level:s}))}}}get nextLevel(){const e=this.nextBufferedFrag;return e?e.level:-1}get currentFrag(){var e;if(this.fragPlaying)return this.fragPlaying;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;return jt(t)?this.getAppendedFrag(t):null}get currentProgramDateTime(){var e;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;if(jt(t)){const n=this.getLevelDetails(),r=this.currentFrag||(n?o0(null,n.fragments,t):null);if(r){const s=r.programDateTime;if(s!==null){const o=s+(t-r.start)*1e3;return new Date(o)}}}return null}get currentLevel(){const e=this.currentFrag;return e?e.level:-1}get nextBufferedFrag(){const e=this.currentFrag;return e?this.followingBufferedFrag(e):null}get forceStartLoad(){return this._forceStartLoad}}class z1e extends _c{constructor(e,t){super("key-loader",t),this.config=void 0,this.keyIdToKeyInfo={},this.emeController=null,this.config=e}abort(e){for(const n in this.keyIdToKeyInfo){const r=this.keyIdToKeyInfo[n].loader;if(r){var t;if(e&&e!==((t=r.context)==null?void 0:t.frag.type))return;r.abort()}}}detach(){for(const e in this.keyIdToKeyInfo){const t=this.keyIdToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyIdToKeyInfo[e]}}destroy(){this.detach();for(const e in this.keyIdToKeyInfo){const t=this.keyIdToKeyInfo[e].loader;t&&t.destroy()}this.keyIdToKeyInfo={}}createKeyLoadError(e,t=Ke.KEY_LOAD_ERROR,n,r,s){return new Ef({type:rn.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:s,error:n,networkDetails:r})}loadClear(e,t,n){if(this.emeController&&this.config.emeEnabled&&!this.emeController.getSelectedKeySystemFormats().length){if(t.length)for(let r=0,s=t.length;r<s;r++){const o=t[r];if(e.cc<=o.cc&&(!As(e)||!As(o)||e.sn<o.sn)||!n&&r==s-1)return this.emeController.selectKeySystemFormat(o).then(a=>{if(!this.emeController)return;o.setKeyFormat(a);const l=iS(a);if(l)return this.emeController.getKeySystemAccess([l])})}if(this.config.requireKeySystemAccessOnStart){const r=Hv(this.config);if(r.length)return this.emeController.getKeySystemAccess(r)}}return null}load(e){return!e.decryptdata&&e.encrypted&&this.emeController&&this.config.emeEnabled?this.emeController.selectKeySystemFormat(e).then(t=>this.loadInternal(e,t)):this.loadInternal(e)}loadInternal(e,t){var n,r;t&&e.setKeyFormat(t);const s=e.decryptdata;if(!s){const c=new Error(t?`Expected frag.decryptdata to be defined after setting format ${t}`:`Missing decryption data on fragment in onKeyLoading (emeEnabled with controller: ${this.emeController&&this.config.emeEnabled})`);return Promise.reject(this.createKeyLoadError(e,Ke.KEY_LOAD_ERROR,c))}const o=s.uri;if(!o)return Promise.reject(this.createKeyLoadError(e,Ke.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${o}"`)));const a=eI(s);let l=this.keyIdToKeyInfo[a];if((n=l)!=null&&n.decryptdata.key)return s.key=l.decryptdata.key,Promise.resolve({frag:e,keyInfo:l});if(this.emeController&&(r=l)!=null&&r.keyLoadPromise)switch(this.emeController.getKeyStatus(l.decryptdata)){case"usable":case"usable-in-future":return l.keyLoadPromise.then(u=>{const{keyInfo:h}=u;return s.key=h.decryptdata.key,{frag:e,keyInfo:h}})}switch(this.log(`${this.keyIdToKeyInfo[a]?"Rel":"L"}oading${s.keyId?" keyId: "+Oo(s.keyId):""} URI: ${s.uri} from ${e.type} ${e.level}`),l=this.keyIdToKeyInfo[a]={decryptdata:s,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},s.method){case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return s.keyFormat==="identity"?this.loadKeyHTTP(l,e):this.loadKeyEME(l,e);case"AES-128":case"AES-256":case"AES-256-CTR":return this.loadKeyHTTP(l,e);default:return Promise.reject(this.createKeyLoadError(e,Ke.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${s.method}"`)))}}loadKeyEME(e,t){const n={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){var r;if(!e.decryptdata.keyId&&(r=t.initSegment)!=null&&r.data){const o=xpe(t.initSegment.data);if(o.length){let a=o[0];a.some(l=>l!==0)?(this.log(`Using keyId found in init segment ${Oo(a)}`),Df.setKeyIdForUri(e.decryptdata.uri,a)):(a=Df.addKeyIdForUri(e.decryptdata.uri),this.log(`Generating keyId to patch media ${Oo(a)}`)),e.decryptdata.keyId=a}}if(!e.decryptdata.keyId&&!As(t))return Promise.resolve(n);const s=this.emeController.loadKey(n);return(e.keyLoadPromise=s.then(o=>(e.mediaKeySessionContext=o,n))).catch(o=>{throw e.keyLoadPromise=null,"data"in o&&(o.data.frag=t),o})}return Promise.resolve(n)}loadKeyHTTP(e,t){const n=this.config,r=n.loader,s=new r(n);return t.keyLoader=e.loader=s,e.keyLoadPromise=new Promise((o,a)=>{const l={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},c=n.keyLoadPolicy.default,u={loadPolicy:c,timeout:c.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},h={onSuccess:(f,d,m,y)=>{const{frag:g,keyInfo:A}=m,E=eI(A.decryptdata);if(!g.decryptdata||A!==this.keyIdToKeyInfo[E])return a(this.createKeyLoadError(g,Ke.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),y));A.decryptdata.key=g.decryptdata.key=new Uint8Array(f.data),g.keyLoader=null,A.loader=null,o({frag:g,keyInfo:A})},onError:(f,d,m,y)=>{this.resetLoader(d),a(this.createKeyLoadError(t,Ke.KEY_LOAD_ERROR,new Error(`HTTP Error ${f.code} loading key ${f.text}`),m,Qi({url:l.url,data:void 0},f)))},onTimeout:(f,d,m)=>{this.resetLoader(d),a(this.createKeyLoadError(t,Ke.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),m))},onAbort:(f,d,m)=>{this.resetLoader(d),a(this.createKeyLoadError(t,Ke.INTERNAL_ABORTED,new Error("key loading aborted"),m))}};s.load(l,u,h)})}resetLoader(e){const{frag:t,keyInfo:n,url:r}=e,s=n.loader;t.keyLoader===s&&(t.keyLoader=null,n.loader=null);const o=eI(n.decryptdata)||r;delete this.keyIdToKeyInfo[o],s&&s.destroy()}}function eI(i){if(i.keyFormat!==xo.FAIRPLAY){const e=i.keyId;if(e)return Oo(e)}return i.uri}function Wk(i){const{type:e}=i;switch(e){case ai.AUDIO_TRACK:return $t.AUDIO;case ai.SUBTITLE_TRACK:return $t.SUBTITLE;default:return $t.MAIN}}function tI(i,e){let t=i.url;return(t===void 0||t.indexOf("data:")===0)&&(t=e.url),t}class G1e{constructor(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.onManifestLoaded=this.checkAutostartLoad,this.hls=e,this.registerListeners()}startLoad(e){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:e}=this;e.on(ae.MANIFEST_LOADING,this.onManifestLoading,this),e.on(ae.LEVEL_LOADING,this.onLevelLoading,this),e.on(ae.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(ae.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.on(ae.LEVELS_UPDATED,this.onLevelsUpdated,this)}unregisterListeners(){const{hls:e}=this;e.off(ae.MANIFEST_LOADING,this.onManifestLoading,this),e.off(ae.LEVEL_LOADING,this.onLevelLoading,this),e.off(ae.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(ae.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.off(ae.LEVELS_UPDATED,this.onLevelsUpdated,this)}createInternalLoader(e){const t=this.hls.config,n=t.pLoader,r=t.loader,s=n||r,o=new s(t);return this.loaders[e.type]=o,o}getInternalLoader(e){return this.loaders[e.type]}resetInternalLoader(e){this.loaders[e]&&delete this.loaders[e]}destroyInternalLoaders(){for(const e in this.loaders){const t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(e,t){const{url:n}=t;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:ai.MANIFEST,url:n,deliveryDirectives:null,levelOrTrack:null})}onLevelLoading(e,t){const{id:n,level:r,pathwayId:s,url:o,deliveryDirectives:a,levelInfo:l}=t;this.load({id:n,level:r,pathwayId:s,responseType:"text",type:ai.LEVEL,url:o,deliveryDirectives:a,levelOrTrack:l})}onAudioTrackLoading(e,t){const{id:n,groupId:r,url:s,deliveryDirectives:o,track:a}=t;this.load({id:n,groupId:r,level:null,responseType:"text",type:ai.AUDIO_TRACK,url:s,deliveryDirectives:o,levelOrTrack:a})}onSubtitleTrackLoading(e,t){const{id:n,groupId:r,url:s,deliveryDirectives:o,track:a}=t;this.load({id:n,groupId:r,level:null,responseType:"text",type:ai.SUBTITLE_TRACK,url:s,deliveryDirectives:o,levelOrTrack:a})}onLevelsUpdated(e,t){const n=this.loaders[ai.LEVEL];if(n){const r=n.context;r&&!t.levels.some(s=>s===r.levelOrTrack)&&(n.abort(),delete this.loaders[ai.LEVEL])}}load(e){var t;const n=this.hls.config;let r=this.getInternalLoader(e);if(r){const c=this.hls.logger,u=r.context;if(u&&u.levelOrTrack===e.levelOrTrack&&(u.url===e.url||u.deliveryDirectives&&!e.deliveryDirectives)){u.url===e.url?c.log(`[playlist-loader]: ignore ${e.url} ongoing request`):c.log(`[playlist-loader]: ignore ${e.url} in favor of ${u.url}`);return}c.log(`[playlist-loader]: aborting previous loader for type: ${e.type}`),r.abort()}let s;if(e.type===ai.MANIFEST?s=n.manifestLoadPolicy.default:s=er({},n.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),r=this.createInternalLoader(e),jt((t=e.deliveryDirectives)==null?void 0:t.part)){let c;if(e.type===ai.LEVEL&&e.level!==null?c=this.hls.levels[e.level].details:e.type===ai.AUDIO_TRACK&&e.id!==null?c=this.hls.audioTracks[e.id].details:e.type===ai.SUBTITLE_TRACK&&e.id!==null&&(c=this.hls.subtitleTracks[e.id].details),c){const u=c.partTarget,h=c.targetduration;if(u&&h){const f=Math.max(u*3,h*.8)*1e3;s=er({},s,{maxTimeToFirstByteMs:Math.min(f,s.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(f,s.maxTimeToFirstByteMs)})}}}const o=s.errorRetry||s.timeoutRetry||{},a={loadPolicy:s,timeout:s.maxLoadTimeMs,maxRetry:o.maxNumRetry||0,retryDelay:o.retryDelayMs||0,maxRetryDelay:o.maxRetryDelayMs||0},l={onSuccess:(c,u,h,f)=>{const d=this.getInternalLoader(h);this.resetInternalLoader(h.type);const m=c.data;u.parsing.start=performance.now(),Au.isMediaPlaylist(m)||h.type!==ai.MANIFEST?this.handleTrackOrLevelPlaylist(c,u,h,f||null,d):this.handleMasterPlaylist(c,u,h,f)},onError:(c,u,h,f)=>{this.handleNetworkError(u,h,!1,c,f)},onTimeout:(c,u,h)=>{this.handleNetworkError(u,h,!0,void 0,c)}};r.load(e,a,l)}checkAutostartLoad(){if(!this.hls)return;const{config:{autoStartLoad:e,startPosition:t},forceStartLoad:n}=this.hls;(e||n)&&(this.hls.logger.log(`${e?"auto":"force"} startLoad with configured startPosition ${t}`),this.hls.startLoad(t))}handleMasterPlaylist(e,t,n,r){const s=this.hls,o=e.data,a=tI(e,n),l=Au.parseMasterPlaylist(o,a);if(l.playlistParsingError){t.parsing.end=performance.now(),this.handleManifestParsingError(e,n,l.playlistParsingError,r,t);return}const{contentSteering:c,levels:u,sessionData:h,sessionKeys:f,startTimeOffset:d,variableList:m}=l;this.variableList=m,u.forEach(E=>{const{unknownCodecs:x}=E;if(x){const{preferManagedMediaSource:w}=this.hls.config;let{audioCodec:T,videoCodec:I}=E;for(let M=x.length;M--;){const L=x[M];j2(L,"audio",w)?(E.audioCodec=T=T?`${T},${L}`:L,uA.audio[T.substring(0,4)]=2,x.splice(M,1)):j2(L,"video",w)&&(E.videoCodec=I=I?`${I},${L}`:L,uA.video[I.substring(0,4)]=2,x.splice(M,1))}}});const{AUDIO:y=[],SUBTITLES:g,"CLOSED-CAPTIONS":A}=Au.parseMasterPlaylistMedia(o,a,l);y.length&&!y.some(x=>!x.url)&&u[0].audioCodec&&!u[0].attrs.AUDIO&&(this.hls.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),y.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new Br({}),bitrate:0,url:""})),s.trigger(ae.MANIFEST_LOADED,{levels:u,audioTracks:y,subtitles:g,captions:A,contentSteering:c,url:a,stats:t,networkDetails:r,sessionData:h,sessionKeys:f,startTimeOffset:d,variableList:m})}handleTrackOrLevelPlaylist(e,t,n,r,s){const o=this.hls,{id:a,level:l,type:c}=n,u=tI(e,n),h=jt(l)?l:jt(a)?a:0,f=Wk(n),d=Au.parseLevelPlaylist(e.data,u,h,f,0,this.variableList);if(c===ai.MANIFEST){const m={attrs:new Br({}),bitrate:0,details:d,name:"",url:u};d.requestScheduled=t.loading.start+sV(d,0),o.trigger(ae.MANIFEST_LOADED,{levels:[m],audioTracks:[],url:u,stats:t,networkDetails:r,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),n.levelDetails=d,this.handlePlaylistLoaded(d,e,t,n,r,s)}handleManifestParsingError(e,t,n,r,s){this.hls.trigger(ae.ERROR,{type:rn.NETWORK_ERROR,details:Ke.MANIFEST_PARSING_ERROR,fatal:t.type===ai.MANIFEST,url:e.url,err:n,error:n,reason:n.message,response:e,context:t,networkDetails:r,stats:s})}handleNetworkError(e,t,n=!1,r,s){let o=`A network ${n?"timeout":"error"+(r?" (status "+r.code+")":"")} occurred while loading ${e.type}`;e.type===ai.LEVEL?o+=`: ${e.level} id: ${e.id}`:(e.type===ai.AUDIO_TRACK||e.type===ai.SUBTITLE_TRACK)&&(o+=` id: ${e.id} group-id: "${e.groupId}"`);const a=new Error(o);this.hls.logger.warn(`[playlist-loader]: ${o}`);let l=Ke.UNKNOWN,c=!1;const u=this.getInternalLoader(e);switch(e.type){case ai.MANIFEST:l=n?Ke.MANIFEST_LOAD_TIMEOUT:Ke.MANIFEST_LOAD_ERROR,c=!0;break;case ai.LEVEL:l=n?Ke.LEVEL_LOAD_TIMEOUT:Ke.LEVEL_LOAD_ERROR,c=!1;break;case ai.AUDIO_TRACK:l=n?Ke.AUDIO_TRACK_LOAD_TIMEOUT:Ke.AUDIO_TRACK_LOAD_ERROR,c=!1;break;case ai.SUBTITLE_TRACK:l=n?Ke.SUBTITLE_TRACK_LOAD_TIMEOUT:Ke.SUBTITLE_LOAD_ERROR,c=!1;break}u&&this.resetInternalLoader(e.type);const h={type:rn.NETWORK_ERROR,details:l,fatal:c,url:e.url,loader:u,context:e,error:a,networkDetails:t,stats:s};if(r){const f=(t==null?void 0:t.url)||e.url;h.response=Qi({url:f,data:void 0},r)}this.hls.trigger(ae.ERROR,h)}handlePlaylistLoaded(e,t,n,r,s,o){const a=this.hls,{type:l,level:c,levelOrTrack:u,id:h,groupId:f,deliveryDirectives:d}=r,m=tI(t,r),y=Wk(r);let g=typeof r.level=="number"&&y===$t.MAIN?c:void 0;const A=e.playlistParsingError;if(A){if(this.hls.logger.warn(`${A} ${e.url}`),!a.config.ignorePlaylistParsingErrors){a.trigger(ae.ERROR,{type:rn.NETWORK_ERROR,details:Ke.LEVEL_PARSING_ERROR,fatal:!1,url:m,error:A,reason:A.message,response:t,context:r,level:g,parent:y,networkDetails:s,stats:n});return}e.playlistParsingError=null}if(!e.fragments.length){const E=e.playlistParsingError=new Error("No Segments found in Playlist");a.trigger(ae.ERROR,{type:rn.NETWORK_ERROR,details:Ke.LEVEL_EMPTY_ERROR,fatal:!1,url:m,error:E,reason:E.message,response:t,context:r,level:g,parent:y,networkDetails:s,stats:n});return}switch(e.live&&o&&(o.getCacheAge&&(e.ageHeader=o.getCacheAge()||0),(!o.getCacheAge||isNaN(e.ageHeader))&&(e.ageHeader=0)),l){case ai.MANIFEST:case ai.LEVEL:if(g){if(!u)g=0;else if(u!==a.levels[g]){const E=a.levels.indexOf(u);E>-1&&(g=E)}}a.trigger(ae.LEVEL_LOADED,{details:e,levelInfo:u||a.levels[0],level:g||0,id:h||0,stats:n,networkDetails:s,deliveryDirectives:d,withoutMultiVariant:l===ai.MANIFEST});break;case ai.AUDIO_TRACK:a.trigger(ae.AUDIO_TRACK_LOADED,{details:e,track:u,id:h||0,groupId:f||"",stats:n,networkDetails:s,deliveryDirectives:d});break;case ai.SUBTITLE_TRACK:a.trigger(ae.SUBTITLE_TRACK_LOADED,{details:e,track:u,id:h||0,groupId:f||"",stats:n,networkDetails:s,deliveryDirectives:d});break}}}class bf{static get version(){return K2}static isMSESupported(){return o8()}static isSupported(){return pj()}static getMediaSource(){return Uf()}static get Events(){return ae}static get MetadataSchema(){return Xa}static get ErrorTypes(){return rn}static get ErrorDetails(){return Ke}static get DefaultConfig(){return bf.defaultConfig?bf.defaultConfig:C1e}static set DefaultConfig(e){bf.defaultConfig=e}constructor(e={}){this.config=void 0,this.userConfig=void 0,this.logger=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new YR,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioStreamController=void 0,this.subtititleStreamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.interstitialsController=void 0,this.gapController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this._url=null,this._sessionId=void 0,this.triggeringException=void 0,this.started=!1;const t=this.logger=cpe(e.debug||!1,"Hls instance",e.assetPlayerId),n=this.config=b1e(bf.DefaultConfig,e,t);this.userConfig=e,n.progressive&&I1e(n,t);const{abrController:r,bufferController:s,capLevelController:o,errorController:a,fpsController:l}=n,c=new a(this),u=this.abrController=new r(this),h=new tme(this),f=n.interstitialsController,d=f?this.interstitialsController=new f(this,bf):null,m=this.bufferController=new s(this,h),y=this.capLevelController=new o(this),g=new l(this),A=new G1e(this),E=n.contentSteeringController,x=E?new E(this):null,w=this.levelController=new F1e(this,x),T=new D1e(this),I=new z1e(this.config,this.logger),M=this.streamController=new U1e(this,h,I),L=this.gapController=new L1e(this,h);y.setStreamController(M),g.setStreamController(M);const P=[A,w,M];d&&P.splice(1,0,d),x&&P.splice(1,0,x),this.networkControllers=P;const R=[u,m,L,y,g,T,h];this.audioTrackController=this.createController(n.audioTrackController,P);const U=n.audioStreamController;U&&P.push(this.audioStreamController=new U(this,h,I)),this.subtitleTrackController=this.createController(n.subtitleTrackController,P);const k=n.subtitleStreamController;k&&P.push(this.subtititleStreamController=new k(this,h,I)),this.createController(n.timelineController,R),I.emeController=this.emeController=this.createController(n.emeController,R),this.cmcdController=this.createController(n.cmcdController,R),this.latencyController=this.createController(k1e,R),this.coreComponents=R,P.push(c);const H=c.onErrorOut;typeof H=="function"&&this.on(ae.ERROR,H,c),this.on(ae.MANIFEST_LOADED,A.onManifestLoaded,A)}createController(e,t){if(e){const n=new e(this);return t&&t.push(n),n}return null}on(e,t,n=this){this._emitter.on(e,t,n)}once(e,t,n=this){this._emitter.once(e,t,n)}removeAllListeners(e){this._emitter.removeAllListeners(e)}off(e,t,n=this,r){this._emitter.off(e,t,n,r)}listeners(e){return this._emitter.listeners(e)}emit(e,t,n){return this._emitter.emit(e,t,n)}trigger(e,t){if(this.config.debug)return this.emit(e,e,t);try{return this.emit(e,e,t)}catch(n){if(this.logger.error("An internal error happened while handling event "+e+'. Error message: "'+n.message+'". Here is a stacktrace:',n),!this.triggeringException){this.triggeringException=!0;const r=e===ae.ERROR;this.trigger(ae.ERROR,{type:rn.OTHER_ERROR,details:Ke.INTERNAL_EXCEPTION,fatal:r,event:e,error:n}),this.triggeringException=!1}}return!1}listenerCount(e){return this._emitter.listenerCount(e)}destroy(){this.logger.log("destroy"),this.trigger(ae.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this._url=null,this.networkControllers.forEach(t=>t.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(t=>t.destroy()),this.coreComponents.length=0;const e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null}attachMedia(e){if(!e||"media"in e&&!e.media){const s=new Error(`attachMedia failed: invalid argument (${e})`);this.trigger(ae.ERROR,{type:rn.OTHER_ERROR,details:Ke.ATTACH_MEDIA_ERROR,fatal:!0,error:s});return}this.logger.log("attachMedia"),this._media&&(this.logger.warn("media must be detached before attaching"),this.detachMedia());const t="media"in e,n=t?e.media:e,r=t?e:{media:n};this._media=n,this.trigger(ae.MEDIA_ATTACHING,r)}detachMedia(){this.logger.log("detachMedia"),this.trigger(ae.MEDIA_DETACHING,{}),this._media=null}transferMedia(){this._media=null;const e=this.bufferController.transferMedia();return this.trigger(ae.MEDIA_DETACHING,{transferMedia:e}),e}loadSource(e){this.stopLoad();const t=this.media,n=this._url,r=this._url=OR.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.logger.log(`loadSource:${r}`),t&&n&&(n!==r||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(t)),this.trigger(ae.MANIFEST_LOADING,{url:e})}get url(){return this._url}get hasEnoughToStart(){return this.streamController.hasEnoughToStart}get startPosition(){return this.streamController.startPositionValue}startLoad(e=-1,t){this.logger.log(`startLoad(${e+(t?", <skip seek to start>":"")})`),this.started=!0,this.resumeBuffering();for(let n=0;n<this.networkControllers.length&&(this.networkControllers[n].startLoad(e,t),!(!this.started||!this.networkControllers));n++);}stopLoad(){this.logger.log("stopLoad"),this.started=!1;for(let e=0;e<this.networkControllers.length&&(this.networkControllers[e].stopLoad(),!(this.started||!this.networkControllers));e++);}get loadingEnabled(){return this.started}get bufferingEnabled(){return this.streamController.bufferingEnabled}resumeBuffering(){this.bufferingEnabled||(this.logger.log("resume buffering"),this.networkControllers.forEach(e=>{e.resumeBuffering&&e.resumeBuffering()}))}pauseBuffering(){this.bufferingEnabled&&(this.logger.log("pause buffering"),this.networkControllers.forEach(e=>{e.pauseBuffering&&e.pauseBuffering()}))}get inFlightFragments(){const e={[$t.MAIN]:this.streamController.inFlightFrag};return this.audioStreamController&&(e[$t.AUDIO]=this.audioStreamController.inFlightFrag),this.subtititleStreamController&&(e[$t.SUBTITLE]=this.subtititleStreamController.inFlightFrag),e}swapAudioCodec(){this.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){this.logger.log("recoverMediaError");const e=this._media,t=e==null?void 0:e.currentTime;this.detachMedia(),e&&(this.attachMedia(e),t&&this.startLoad(t))}removeLevel(e){this.levelController.removeLevel(e)}get sessionId(){let e=this._sessionId;return e||(e=this._sessionId=Fge()),e}get levels(){const e=this.levelController.levels;return e||[]}get latestLevelDetails(){return this.streamController.getLevelDetails()||null}get loadLevelObj(){return this.levelController.loadLevelObj}get currentLevel(){return this.streamController.currentLevel}set currentLevel(e){this.logger.log(`set currentLevel:${e}`),this.levelController.manualLevel=e,this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(e){this.logger.log(`set nextLevel:${e}`),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(e){this.logger.log(`set loadLevel:${e}`),this.levelController.manualLevel=e}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(e){this.levelController.nextLoadLevel=e}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(e){this.logger.log(`set firstLevel:${e}`),this.levelController.firstLevel=e}get startLevel(){const e=this.levelController.startLevel;return e===-1&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:e}set startLevel(e){this.logger.log(`set startLevel:${e}`),e!==-1&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(e){const t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimate():NaN}set bandwidthEstimate(e){this.abrController.resetEstimator(e)}get abrEwmaDefaultEstimate(){const{bwEstimator:e}=this.abrController;return e?e.defaultEstimate:NaN}get ttfbEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimateTTFB():NaN}set autoLevelCapping(e){this._autoLevelCapping!==e&&(this.logger.log(`set autoLevelCapping:${e}`),this._autoLevelCapping=e,this.levelController.checkMaxAutoUpdated())}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(e){Gpe(e)&&this._maxHdcpLevel!==e&&(this._maxHdcpLevel=e,this.levelController.checkMaxAutoUpdated())}get autoLevelEnabled(){return this.levelController.manualLevel===-1}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:e,config:{minAutoBitrate:t}}=this;if(!e)return 0;const n=e.length;for(let r=0;r<n;r++)if(e[r].maxBitrate>=t)return r;return 0}get maxAutoLevel(){const{levels:e,autoLevelCapping:t,maxHdcpLevel:n}=this;let r;if(t===-1&&e!=null&&e.length?r=e.length-1:r=t,n)for(let s=r;s--;){const o=e[s].attrs["HDCP-LEVEL"];if(o&&o<=n)return s}return r}get firstAutoLevel(){return this.abrController.firstAutoLevel}get nextAutoLevel(){return this.abrController.nextAutoLevel}set nextAutoLevel(e){this.abrController.nextAutoLevel=e}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}get maxBufferLength(){return this.streamController.maxBufferLength}setAudioOption(e){var t;return((t=this.audioTrackController)==null?void 0:t.setAudioOption(e))||null}setSubtitleOption(e){var t;return((t=this.subtitleTrackController)==null?void 0:t.setSubtitleOption(e))||null}get allAudioTracks(){const e=this.audioTrackController;return e?e.allAudioTracks:[]}get audioTracks(){const e=this.audioTrackController;return e?e.audioTracks:[]}get audioTrack(){const e=this.audioTrackController;return e?e.audioTrack:-1}set audioTrack(e){const t=this.audioTrackController;t&&(t.audioTrack=e)}get allSubtitleTracks(){const e=this.subtitleTrackController;return e?e.allSubtitleTracks:[]}get subtitleTracks(){const e=this.subtitleTrackController;return e?e.subtitleTracks:[]}get subtitleTrack(){const e=this.subtitleTrackController;return e?e.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(e){const t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}get subtitleDisplay(){const e=this.subtitleTrackController;return e?e.subtitleDisplay:!1}set subtitleDisplay(e){const t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(e){this.config.lowLatencyMode=e}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}set targetLatency(e){this.latencyController.targetLatency=e}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}get pathways(){return this.levelController.pathways}get pathwayPriority(){return this.levelController.pathwayPriority}set pathwayPriority(e){this.levelController.pathwayPriority=e}get bufferedToEnd(){var e;return!!((e=this.bufferController)!=null&&e.bufferedToEnd)}get interstitialsManager(){var e;return((e=this.interstitialsController)==null?void 0:e.interstitialsManager)||null}getMediaDecodingInfo(e,t=this.allAudioTracks){const n=QQ(t);return GQ(e,n,navigator.mediaCapabilities)}}bf.defaultConfig=void 0;const H1e=Object.freeze(Object.defineProperty({__proto__:null,AbrController:VQ,AttrList:Br,AudioStreamController:PV,AudioTrackController:BV,BasePlaylistController:S4,BaseSegment:NR,BaseStreamController:E4,BufferController:kV,CMCDController:WV,CapLevelController:w4,ChunkMetadata:x4,ContentSteeringController:KV,Cues:hj,DateRange:VR,EMEController:Wm,ErrorActionFlags:Ya,ErrorController:$Q,ErrorDetails:Ke,ErrorTypes:rn,Events:ae,FPSController:$V,FetchLoader:k5,Fragment:tS,Hls:bf,HlsSkip:c2,HlsUrlParameters:E5,KeySystemFormats:xo,KeySystems:Dr,Level:hA,LevelDetails:JQ,LevelKey:Df,LoadStats:y4,M3U8Parser:Au,MetadataSchema:Xa,NetworkErrorAction:Zs,Part:MQ,PlaylistLevelType:$t,SubtitleStreamController:ej,SubtitleTrackController:JV,TimelineController:cj,XhrLoader:s8,default:bf,fetchSupported:fj,getMediaSource:Uf,isMSESupported:o8,isSupported:pj,requestMediaKeySystemAccess:KR},Symbol.toStringTag,{value:"Module"})),Q1e=((i,e)=>typeof window<"u"&&typeof((i=window.document)==null?void 0:i.createElement)=="function"&&typeof((e=window.navigator)==null?void 0:e.userAgent)=="string")();let nI=null;async function V1e(...i){var e;(e=nI)!==null&&e!==void 0||(nI=await U1(()=>Promise.resolve().then(()=>H1e),void 0,import.meta.url));const t=nI.default;return t.isSupported()?new t(...i):null}function mj(i,{unsuspend:e="loadedmetadata",start:t=!0,hls:n={},crossOrigin:r="anonymous",muted:s=!0,loop:o=!0,playsInline:a=!0,onVideoFrame:l,...c}={}){const u=Ve(m=>m.gl),h=C.useRef(null),f=Th(()=>new Promise(async m=>{let y,g;typeof i=="string"?y=i:g=i;const A=Object.assign(document.createElement("video"),{src:y,srcObject:g,crossOrigin:r,loop:o,muted:s,playsInline:a,...c});if(y&&Q1e&&y.endsWith(".m3u8")){const x=h.current=await V1e(n);x&&(x.on(ae.MEDIA_ATTACHED,()=>void x.loadSource(y)),x.attachMedia(A))}const E=new iz(A);"colorSpace"in E?E.colorSpace=u.outputColorSpace:E.encoding=u.outputEncoding,A.addEventListener(e,()=>m(E))}),[i]),d=f.source.data;return j1e(d,l),C.useEffect(()=>(t&&f.image.play(),()=>{h.current&&(h.current.destroy(),h.current=null)}),[f,t]),f}const T4=C.forwardRef(({children:i,src:e,...t},n)=>{const r=mj(e,t);return C.useEffect(()=>()=>void r.dispose(),[r]),C.useImperativeHandle(n,()=>r,[r]),C.createElement(C.Fragment,null,i==null?void 0:i(r))}),j1e=(i,e)=>{C.useEffect(()=>{if(!e||!i.requestVideoFrameCallback)return;let t;const n=(...r)=>{e(...r),t=i.requestVideoFrameCallback(n)};return i.requestVideoFrameCallback(n),()=>i.cancelVideoFrameCallback(t)},[i,e])},d2=(i,e)=>{if(Array.isArray(i))return i[0];{const t=e??Object.keys(i)[0];return i[t][0]}},gj=i=>{for(let e=3;e<i.length;e+=4)if(i[e]!==0)return!1;return!0};function b4(i,e,t,n,r,s){const o=C.useRef(Ve(k=>k.viewport)),a=C.useRef(null),l=C.useRef(0),c=.1,u=C.useRef(i),h=C.useRef(e),f=C.useRef(t),[d,m]=C.useState(null),[y,g]=C.useState(new vi),A=C.useMemo(()=>new xh,[]),[E,x]=C.useState(null),w=C.useCallback((k,H,G)=>{const X=H*(o.current.aspect>k/H?o.current.width/k:o.current.height/H),oe=k*(o.current.aspect>k/H?o.current.width/k:o.current.height/H)*G,K=X*G,V=1;let W=Math.min(V,oe),F=Math.min(V,K);return oe>V&&(W=V,F=K/oe*V),new Q(W,F,1)},[]),T=C.useCallback((k,H)=>{if(k.image){const G=document.createElement("canvas"),X=G.getContext("2d",s);if(!X)throw new Error("Failed to get 2d context");G.width=k.image.width,G.height=k.image.height,X.drawImage(k.image,0,0);const Z=k.image.width,oe=k.image.height,K=Math.round(Math.sqrt(H*(Z/oe))),V=Math.round(H/K),W=Z/K,F=oe/V,Y=[];for(let te=0;te<V;te++)for(let q=0;q<K;q++){if(te*K+q>=H){Y.push({row:te,col:q});continue}const re=X.getImageData(q*W,te*F,W,F).data;gj(re)&&Y.push({row:te,col:q})}return{rows:V,columns:K,frameWidth:W,frameHeight:F,emptyFrames:Y}}else return{rows:0,columns:0,frameWidth:0,frameHeight:0,emptyFrames:[]}},[s]),I=C.useCallback(k=>{const H=G=>{let X=null;for(const oe of G){const{w:K,h:V}=oe.frame,W=K*V;(!X||W>X.area)&&(X={w:K,h:V,area:W})}return G.map(oe=>{const{w:K,h:V}=oe.frame,W=K*V,F=X?W===X.area?1:Math.sqrt(W/X.area):1;return{...oe,scaleRatio:F}})};if(Array.isArray(k))return H(k);{const G={};for(const X in k)G[X]=H(k[X]);return G}},[]),M=C.useCallback(()=>{const k={},H=a.current,G=f.current;if(H)if(G&&Array.isArray(H.frames)){for(let X=0;X<G.length;X++){k[G[X]]=[];for(const Z of H.frames){const oe=Z.frame,K=Z.sourceSize.w,V=Z.sourceSize.h;typeof Z.filename=="string"&&Z.filename.toLowerCase().indexOf(G[X].toLowerCase())!==-1&&k[G[X]].push({...Z,frame:oe,sourceSize:{w:K,h:V}})}}for(const X in k){const Z=I(k[X]);Array.isArray(Z)&&(k[X]=Z)}return k}else if(G&&typeof H.frames=="object"){for(let X=0;X<G.length;X++){k[G[X]]=[];for(const Z in H.frames){const oe=H.frames[Z],K=oe.frame,V=oe.sourceSize.w,W=oe.sourceSize.h;typeof Z=="string"&&Z.toLowerCase().indexOf(G[X].toLowerCase())!==-1&&k[G[X]].push({...oe,frame:K,sourceSize:{w:V,h:W}})}}for(const X in k){const Z=I(k[X]);Array.isArray(Z)&&(k[X]=Z)}return k}else{let X=[];return H!=null&&H.frames&&(Array.isArray(H.frames)?X=H.frames.map(Z=>({...Z,x:Z.frame.x,y:Z.frame.y,w:Z.frame.w,h:Z.frame.h})):X=Object.values(H.frames).flat().map(Z=>({...Z,x:Z.frame.x,y:Z.frame.y,w:Z.frame.w,h:Z.frame.h}))),I(X)}return[]},[I,a]),L=C.useCallback((k,H)=>{let G=new Q(1,1,1);if(k===null){if(H&&n){const X=H.image.width,Z=H.image.height;l.current=n;const{rows:oe,columns:K,frameWidth:V,frameHeight:W,emptyFrames:F}=T(H,n),Y={frames:[],meta:{version:"1.0",size:{w:X,h:Z},rows:oe,columns:K,frameWidth:V,frameHeight:W,scale:"1"}};for(let te=0;te<oe;te++)for(let q=0;q<K;q++)(F??[]).some(re=>re.row===te&&re.col===q)||Array.isArray(Y.frames)&&Y.frames.push({frame:{x:q*V,y:te*W,w:V,h:W},scaleRatio:1,rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:V,h:W},sourceSize:{w:V,h:W}});G=w(V,W,c),a.current=Y}a.current&&a.current.frames&&(a.current.frames=I(a.current.frames))}else if(H){a.current=k,a.current.frames=M(),l.current=Array.isArray(k.frames)?k.frames.length:Object.keys(k.frames).length;const{w:X,h:Z}=d2(k.frames).sourceSize;G=w(X,Z,c)}m(a.current),"encoding"in H?H.encoding=3001:"colorSpace"in H&&(H.colorSpace=gs),g(H),x({spriteTexture:H,spriteData:a.current,aspect:G})},[T,n,M,w,I]),P=C.useCallback((k,H,G)=>{const X=fetch(k).then(oe=>oe.json()),Z=new Promise(oe=>{A.load(H,oe)});Promise.all([X,Z]).then(oe=>{G(oe[0],oe[1])})},[A]),R=C.useCallback(k=>{if(!k&&!u.current)throw new Error("Either textureUrl or input must be provided");const H=k??u.current;if(!H)throw new Error("A valid texture URL must be provided");A.load(H,G=>L(null,G))},[A,L]),U=C.useCallback((k,H)=>{H&&k?P(H,k,L):R(k)},[P,R,L]);return C.useLayoutEffect(()=>{h.current&&u.current?P(h.current,u.current,L):u.current&&R();const k=u.current;return()=>{k&&cr.clear(xh,k)}},[P,R,L]),C.useLayoutEffect(()=>{r==null||r(y,d??null)},[y,d,r]),{spriteObj:E,loadJsonAndTexture:U}}b4.preload=i=>cr.preload(xh,i);b4.clear=i=>cr.clear(xh,i);function a8(i,e,...t){const n=C.useRef(),r=Ve(s=>s.scene);return C.useLayoutEffect(()=>{let s;if(i&&i!=null&&i.current&&e&&(n.current=s=new e(i.current,...t)),s)return s.traverse(o=>o.raycast=()=>null),r.add(s),()=>{n.current=void 0,r.remove(s),s.dispose==null||s.dispose()}},[r,e,i,...t]),Kt(()=>{var s;return void((s=n.current)==null||s.update==null?void 0:s.update())}),n}const W1e=({type:i,args:e=[]})=>{const t=C.useRef(null),n=C.useRef(null);return C.useLayoutEffect(()=>{n.current=t.current.parent}),a8(n,i,...e),C.createElement("object3D",{ref:t})};var cS={exports:{}},K1e=cS.exports,Kk;function Y1e(){return Kk||(Kk=1,(function(i,e){(function(t,n){i.exports=n()})(K1e,function(){var t=function(){function n(d){return o.appendChild(d.dom),d}function r(d){for(var m=0;m<o.children.length;m++)o.children[m].style.display=m===d?"block":"none";s=d}var s=0,o=document.createElement("div");o.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",o.addEventListener("click",function(d){d.preventDefault(),r(++s%o.children.length)},!1);var a=(performance||Date).now(),l=a,c=0,u=n(new t.Panel("FPS","#0ff","#002")),h=n(new t.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var f=n(new t.Panel("MB","#f08","#201"));return r(0),{REVISION:16,dom:o,addPanel:n,showPanel:r,begin:function(){a=(performance||Date).now()},end:function(){c++;var d=(performance||Date).now();if(h.update(d-a,200),d>l+1e3&&(u.update(1e3*c/(d-l),100),l=d,c=0,f)){var m=performance.memory;f.update(m.usedJSHeapSize/1048576,m.jsHeapSizeLimit/1048576)}return d},update:function(){a=this.end()},domElement:o,setMode:r}};return t.Panel=function(n,r,s){var o=1/0,a=0,l=Math.round,c=l(window.devicePixelRatio||1),u=80*c,h=48*c,f=3*c,d=2*c,m=3*c,y=15*c,g=74*c,A=30*c,E=document.createElement("canvas");E.width=u,E.height=h,E.style.cssText="width:80px;height:48px";var x=E.getContext("2d");return x.font="bold "+9*c+"px Helvetica,Arial,sans-serif",x.textBaseline="top",x.fillStyle=s,x.fillRect(0,0,u,h),x.fillStyle=r,x.fillText(n,f,d),x.fillRect(m,y,g,A),x.fillStyle=s,x.globalAlpha=.9,x.fillRect(m,y,g,A),{dom:E,update:function(w,T){o=Math.min(o,w),a=Math.max(a,w),x.fillStyle=s,x.globalAlpha=1,x.fillRect(0,0,u,y),x.fillStyle=r,x.fillText(l(w)+" "+n+" ("+l(o)+"-"+l(a)+")",f,d),x.drawImage(E,m+c,y,g-c,A,m,y,g-c,A),x.fillRect(m+g-c,y,c,A),x.fillStyle=s,x.globalAlpha=.9,x.fillRect(m+g-c,y,c,l((1-w/T)*A))}}},t})})(cS)),cS.exports}var $1e=Y1e();const X1e=EA($1e);function q1e(i,e=[],t){const[n,r]=C.useState();return C.useLayoutEffect(()=>{const s=i();return r(s),()=>void 0},e),n}function J1e({showPanel:i=0,className:e,parent:t}){const n=q1e(()=>new X1e,[]);return C.useEffect(()=>{if(n){const r=t&&t.current||document.body;n.showPanel(i),r==null||r.appendChild(n.dom);const s=(e??"").split(" ").filter(l=>l);s.length&&n.dom.classList.add(...s);const o=Jw(()=>n.begin()),a=Zw(()=>n.end());return()=>{s.length&&n.dom.classList.remove(...s),r==null||r.removeChild(n.dom),o(),a()}}},[t,n,e,i]),null}class Z1e{constructor(e,t,n){this.name=e,this.fg=t,this.bg=n,this.gradient=null,this.PR=Math.round(window.devicePixelRatio||1),this.WIDTH=90*this.PR,this.HEIGHT=48*this.PR,this.TEXT_X=3*this.PR,this.TEXT_Y=2*this.PR,this.GRAPH_X=3*this.PR,this.GRAPH_Y=15*this.PR,this.GRAPH_WIDTH=84*this.PR,this.GRAPH_HEIGHT=30*this.PR,this.canvas=document.createElement("canvas"),this.canvas.width=this.WIDTH,this.canvas.height=this.HEIGHT,this.canvas.style.width="90px",this.canvas.style.height="48px",this.canvas.style.position="absolute",this.canvas.style.cssText="width:90px;height:48px",this.context=this.canvas.getContext("2d"),this.initializeCanvas()}createGradient(){if(!this.context)throw new Error("No context");const e=this.context.createLinearGradient(0,this.GRAPH_Y,0,this.GRAPH_Y+this.GRAPH_HEIGHT);let t;const n=this.fg;switch(this.fg.toLowerCase()){case"#0ff":t="#006666";break;case"#0f0":t="#006600";break;case"#ff0":t="#666600";break;case"#e1e1e1":t="#666666";break;default:t=this.bg;break}return e.addColorStop(0,t),e.addColorStop(1,n),e}initializeCanvas(){this.context&&(this.context.font="bold "+9*this.PR+"px Helvetica,Arial,sans-serif",this.context.textBaseline="top",this.gradient=this.createGradient(),this.context.fillStyle=this.bg,this.context.fillRect(0,0,this.WIDTH,this.HEIGHT),this.context.fillStyle=this.fg,this.context.fillText(this.name,this.TEXT_X,this.TEXT_Y),this.context.fillStyle=this.fg,this.context.fillRect(this.GRAPH_X,this.GRAPH_Y,this.GRAPH_WIDTH,this.GRAPH_HEIGHT),this.context.fillStyle=this.bg,this.context.globalAlpha=.9,this.context.fillRect(this.GRAPH_X,this.GRAPH_Y,this.GRAPH_WIDTH,this.GRAPH_HEIGHT))}update(e,t,n,r,s=0){if(!this.context||!this.gradient)return;const o=Math.min(1/0,e),a=Math.max(n,e);r=Math.max(r,t),this.context.globalAlpha=1,this.context.fillStyle=this.bg,this.context.fillRect(0,0,this.WIDTH,this.GRAPH_Y),this.context.fillStyle=this.fg,this.context.fillText(`${e.toFixed(s)} ${this.name} (${o.toFixed(s)}-${parseFloat(a.toFixed(s))})`,this.TEXT_X,this.TEXT_Y),this.context.drawImage(this.canvas,this.GRAPH_X+this.PR,this.GRAPH_Y,this.GRAPH_WIDTH-this.PR,this.GRAPH_HEIGHT,this.GRAPH_X,this.GRAPH_Y,this.GRAPH_WIDTH-this.PR,this.GRAPH_HEIGHT);const l=this.GRAPH_HEIGHT-(1-t/r)*this.GRAPH_HEIGHT;l>0&&(this.context.globalAlpha=1,this.context.fillStyle=this.gradient,this.context.fillRect(this.GRAPH_X+this.GRAPH_WIDTH-this.PR,this.GRAPH_Y+this.GRAPH_HEIGHT-l,this.PR,l))}}const Aj=class I1{constructor({trackGPU:e=!1,logsPerSecond:t=30,samplesLog:n=60,samplesGraph:r=10,precision:s=2,minimal:o=!1,horizontal:a=!0,mode:l=0}={}){this.gl=null,this.ext=null,this.activeQuery=null,this.gpuQueries=[],this.threeRendererPatched=!1,this.frames=0,this.renderCount=0,this.isRunningCPUProfiling=!1,this.totalCpuDuration=0,this.totalGpuDuration=0,this.totalGpuDurationCompute=0,this.totalFps=0,this.gpuPanel=null,this.gpuPanelCompute=null,this.averageFps={logs:[],graph:[]},this.averageCpu={logs:[],graph:[]},this.averageGpu={logs:[],graph:[]},this.averageGpuCompute={logs:[],graph:[]},this.handleClick=c=>{c.preventDefault(),this.showPanel(++this.mode%this.dom.children.length)},this.handleResize=()=>{this.resizePanel(this.fpsPanel,0),this.resizePanel(this.msPanel,1),this.gpuPanel&&this.resizePanel(this.gpuPanel,2),this.gpuPanelCompute&&this.resizePanel(this.gpuPanelCompute,3)},this.mode=l,this.horizontal=a,this.minimal=o,this.trackGPU=e,this.samplesLog=n,this.samplesGraph=r,this.precision=s,this.logsPerSecond=t,this.dom=document.createElement("div"),this.initializeDOM(),this.beginTime=performance.now(),this.prevTime=this.beginTime,this.prevCpuTime=this.beginTime,this.fpsPanel=this.addPanel(new I1.Panel("FPS","#0ff","#002"),0),this.msPanel=this.addPanel(new I1.Panel("CPU","#0f0","#020"),1),this.setupEventListeners()}initializeDOM(){this.dom.style.cssText=`
      position: fixed;
      top: 0;
      left: 0;
      opacity: 0.9;
      z-index: 10000;
      ${this.minimal?"cursor: pointer;":""}
    `}setupEventListeners(){this.minimal?(this.dom.addEventListener("click",this.handleClick),this.showPanel(this.mode)):window.addEventListener("resize",this.handleResize)}async init(e){if(!e){console.error('Stats: The "canvas" parameter is undefined.');return}this.handleThreeRenderer(e)||await this.handleWebGPURenderer(e)||this.initializeWebGL(e)}handleThreeRenderer(e){return e.isWebGLRenderer&&!this.threeRendererPatched?(this.patchThreeRenderer(e),this.gl=e.getContext(),this.trackGPU&&this.initializeGPUTracking(),!0):!1}async handleWebGPURenderer(e){return e.isWebGPURenderer?(this.trackGPU&&(e.backend.trackTimestamp=!0,await e.hasFeatureAsync("timestamp-query")&&this.initializeWebGPUPanels()),this.info=e.info,!0):!1}initializeWebGPUPanels(){this.gpuPanel=this.addPanel(new I1.Panel("GPU","#ff0","#220"),2),this.gpuPanelCompute=this.addPanel(new I1.Panel("CPT","#e1e1e1","#212121"),3)}initializeWebGL(e){if(e instanceof WebGL2RenderingContext)this.gl=e;else if(e instanceof HTMLCanvasElement||e instanceof OffscreenCanvas){if(this.gl=e.getContext("webgl2"),!this.gl)return console.error("Stats: Unable to obtain WebGL2 context."),!1}else return console.error("Stats: Invalid input type. Expected WebGL2RenderingContext, HTMLCanvasElement, or OffscreenCanvas."),!1;return!0}initializeGPUTracking(){this.gl&&(this.ext=this.gl.getExtension("EXT_disjoint_timer_query_webgl2"),this.ext&&(this.gpuPanel=this.addPanel(new I1.Panel("GPU","#ff0","#220"),2)))}begin(){this.isRunningCPUProfiling||this.beginProfiling("cpu-started"),!(!this.gl||!this.ext)&&(this.activeQuery&&this.gl.endQuery(this.ext.TIME_ELAPSED_EXT),this.activeQuery=this.gl.createQuery(),this.activeQuery&&this.gl.beginQuery(this.ext.TIME_ELAPSED_EXT,this.activeQuery))}end(){this.renderCount++,this.gl&&this.ext&&this.activeQuery&&(this.gl.endQuery(this.ext.TIME_ELAPSED_EXT),this.gpuQueries.push({query:this.activeQuery}),this.activeQuery=null)}update(){this.info?this.processWebGPUTimestamps():this.processGpuQueries(),this.endProfiling("cpu-started","cpu-finished","cpu-duration"),this.updateAverages(),this.resetCounters()}processWebGPUTimestamps(){this.totalGpuDuration=this.info.render.timestamp,this.totalGpuDurationCompute=this.info.compute.timestamp,this.addToAverage(this.totalGpuDurationCompute,this.averageGpuCompute)}updateAverages(){this.addToAverage(this.totalCpuDuration,this.averageCpu),this.addToAverage(this.totalGpuDuration,this.averageGpu)}resetCounters(){this.renderCount=0,this.totalCpuDuration===0&&this.beginProfiling("cpu-started"),this.totalCpuDuration=0,this.totalFps=0,this.beginTime=this.endInternal()}resizePanel(e,t){e.canvas.style.position="absolute",this.minimal?e.canvas.style.display="none":(e.canvas.style.display="block",this.horizontal?(e.canvas.style.top="0px",e.canvas.style.left=t*e.WIDTH/e.PR+"px"):(e.canvas.style.left="0px",e.canvas.style.top=t*e.HEIGHT/e.PR+"px"))}addPanel(e,t){return e.canvas&&(this.dom.appendChild(e.canvas),this.resizePanel(e,t)),e}showPanel(e){for(let t=0;t<this.dom.children.length;t++){const n=this.dom.children[t];n.style.display=t===e?"block":"none"}this.mode=e}processGpuQueries(){!this.gl||!this.ext||(this.totalGpuDuration=0,this.gpuQueries.forEach((e,t)=>{if(this.gl){const n=this.gl.getQueryParameter(e.query,this.gl.QUERY_RESULT_AVAILABLE),r=this.gl.getParameter(this.ext.GPU_DISJOINT_EXT);if(n&&!r){const o=this.gl.getQueryParameter(e.query,this.gl.QUERY_RESULT)*1e-6;this.totalGpuDuration+=o,this.gl.deleteQuery(e.query),this.gpuQueries.splice(t,1)}}}))}endInternal(){this.frames++;const e=(performance||Date).now(),t=e-this.prevTime;if(e>=this.prevCpuTime+1e3/this.logsPerSecond){const n=Math.round(this.frames*1e3/t);this.addToAverage(n,this.averageFps),this.updatePanel(this.fpsPanel,this.averageFps,0),this.updatePanel(this.msPanel,this.averageCpu,this.precision),this.updatePanel(this.gpuPanel,this.averageGpu,this.precision),this.gpuPanelCompute&&this.updatePanel(this.gpuPanelCompute,this.averageGpuCompute),this.frames=0,this.prevCpuTime=e,this.prevTime=e}return e}addToAverage(e,t){t.logs.push(e),t.logs.length>this.samplesLog&&t.logs.shift(),t.graph.push(e),t.graph.length>this.samplesGraph&&t.graph.shift()}beginProfiling(e){window.performance&&(window.performance.mark(e),this.isRunningCPUProfiling=!0)}endProfiling(e,t,n){if(window.performance&&t&&this.isRunningCPUProfiling){window.performance.mark(t);const r=performance.measure(n,e,t);this.totalCpuDuration+=r.duration,this.isRunningCPUProfiling=!1}}updatePanel(e,t,n=2){if(t.logs.length>0){let r=0,s=.01;for(let l=0;l<t.logs.length;l++)r+=t.logs[l],t.logs[l]>s&&(s=t.logs[l]);let o=0,a=.01;for(let l=0;l<t.graph.length;l++)o+=t.graph[l],t.graph[l]>a&&(a=t.graph[l]);e&&e.update(r/Math.min(t.logs.length,this.samplesLog),o/Math.min(t.graph.length,this.samplesGraph),s,a,n)}}get domElement(){return this.dom}patchThreeRenderer(e){const t=e.render,n=this;e.render=function(r,s){n.begin(),t.call(this,r,s),n.end()},this.threeRendererPatched=!0}};Aj.Panel=Z1e;let eAe=Aj;const tAe=C.forwardRef(function({className:e,parent:t,id:n,clearStatsGlStyle:r,...s},o){const a=Ve(c=>c.gl),l=C.useMemo(()=>{const c=new eAe({...s});return c.init(a),c},[a]);return C.useImperativeHandle(o,()=>l.domElement,[l]),C.useEffect(()=>{if(l){const c=t&&t.current||document.body;c==null||c.appendChild(l.domElement),l.domElement.querySelectorAll("canvas").forEach(f=>{f.style.removeProperty("position")}),n&&(l.domElement.id=n),r&&l.domElement.removeAttribute("style"),l.domElement.removeAttribute("style");const u=(e??"").split(" ").filter(f=>f);u.length&&l.domElement.classList.add(...u);const h=Zw(()=>l.update());return()=>{u.length&&l.domElement.classList.remove(...u),c==null||c.removeChild(l.domElement),h()}}},[t,l,e,n,r]),null});function nAe({size:i=256,frames:e=1/0}={}){const t=Ve(u=>u.viewport.dpr),{width:n,height:r}=Ve(u=>u.size),s=i||n*t,o=i||r*t,a=C.useMemo(()=>{const u=new d0(s,o);return u.format=vu,u.type=pp,{depthTexture:u}},[s,o]);let l=0;const c=Ea(s,o,a);return Kt(u=>{(e===1/0||l<e)&&(u.gl.setRenderTarget(c),u.gl.render(u.scene,u.camera),u.gl.setRenderTarget(null),l++)}),c.depthTexture}function iAe(i,e,t=1){const n=Ve(o=>o.viewport),r=e*(n.aspect>i/e?n.width/i:n.height/e);return[i*(n.aspect>i/e?n.width/i:n.height/e)*t,r*t,1]}function rAe(i,e){const t=Ve(r=>r.pointer),[n]=C.useState(()=>{const r=new y0;return e&&Os(r,e,{}),function(s,o){r.setFromCamera(t,i instanceof h0?i:i.current);const a=this.constructor.prototype.raycast.bind(this);a&&a(r,o)}});return n}function iI(i,e,t,n){return new(t||(t=Promise))((function(r,s){function o(c){try{l(n.next(c))}catch(u){s(u)}}function a(c){try{l(n.throw(c))}catch(u){s(u)}}function l(c){var u;c.done?r(c.value):(u=c.value,u instanceof t?u:new t((function(h){h(u)}))).then(o,a)}l((n=n.apply(i,[])).next())}))}const sAe=["geforce 320m","geforce 8600","geforce 8600m gt","geforce 8800 gs","geforce 8800 gt","geforce 9400","geforce 9400m g","geforce 9400m","geforce 9600m gt","geforce 9600m","geforce fx go5200","geforce gt 120","geforce gt 130","geforce gt 330m","geforce gtx 285","google swiftshader","intel g41","intel g45","intel gma 4500mhd","intel gma x3100","intel hd 3000","intel q45","legacy","mali-2","mali-3","mali-4","quadro fx 1500","quadro fx 4","quadro fx 5","radeon hd 2400","radeon hd 2600","radeon hd 4670","radeon hd 4850","radeon hd 4870","radeon hd 5670","radeon hd 5750","radeon hd 6290","radeon hd 6300","radeon hd 6310","radeon hd 6320","radeon hd 6490m","radeon hd 6630m","radeon hd 6750m","radeon hd 6770m","radeon hd 6970m","sgx 543","sgx543"];function Yk(i){return i=i.toLowerCase().replace(/.*angle ?\((.+)\)(?: on vulkan [0-9.]+)?$/i,"$1").replace(/\s(\d{1,2}gb|direct3d.+$)|\(r\)| \([^)]+\)$/g,"").replace(/(?:vulkan|opengl) \d+\.\d+(?:\.\d+)?(?: \((.*)\))?/,"$1")}const yj=typeof window>"u",ch=(()=>{if(yj)return;const{userAgent:i,platform:e,maxTouchPoints:t}=window.navigator,n=/(iphone|ipod|ipad)/i.test(i),r=e==="iPad"||e==="MacIntel"&&t>0&&!window.MSStream;return{isIpad:r,isMobile:/android/i.test(i)||n||r,isSafari12:/Version\/12.+Safari/.test(i),isFirefox:/Firefox/.test(i)}})();function oAe(i,e,t){if(!t)return[e];const n=(function(c){const u=`
    precision highp float;
    attribute vec3 aPosition;
    varying float vvv;
    void main() {
      vvv = 0.31622776601683794;
      gl_Position = vec4(aPosition, 1.0);
    }
  `,h=`
    precision highp float;
    varying float vvv;
    void main() {
      vec4 enc = vec4(1.0, 255.0, 65025.0, 16581375.0) * vvv;
      enc = fract(enc);
      enc -= enc.yzww * vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0, 0.0);
      gl_FragColor = enc;
    }
  `,f=c.createShader(35633),d=c.createShader(35632),m=c.createProgram();if(!(d&&f&&m))return;c.shaderSource(f,u),c.shaderSource(d,h),c.compileShader(f),c.compileShader(d),c.attachShader(m,f),c.attachShader(m,d),c.linkProgram(m),c.detachShader(m,f),c.detachShader(m,d),c.deleteShader(f),c.deleteShader(d),c.useProgram(m);const y=c.createBuffer();c.bindBuffer(34962,y),c.bufferData(34962,new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),35044);const g=c.getAttribLocation(m,"aPosition");c.vertexAttribPointer(g,3,5126,!1,0,0),c.enableVertexAttribArray(g),c.clearColor(1,1,1,1),c.clear(16384),c.viewport(0,0,1,1),c.drawArrays(4,0,3);const A=new Uint8Array(4);return c.readPixels(0,0,1,1,6408,5121,A),c.deleteProgram(m),c.deleteBuffer(y),A.join("")})(i),r="801621810",s="8016218135",o="80162181161",a=ch!=null&&ch.isIpad?[["a7",o,12],["a8",s,15],["a8x",s,15],["a9",s,15],["a9x",s,15],["a10",s,15],["a10x",s,15],["a12",r,15],["a12x",r,15],["a12z",r,15],["a14",r,15],["a15",r,15],["m1",r,15],["m2",r,15]]:[["a7",o,12],["a8",s,12],["a9",s,15],["a10",s,15],["a11",r,15],["a12",r,15],["a13",r,15],["a14",r,15],["a15",r,15],["a16",r,15],["a17",r,15]];let l;return n==="80162181255"?l=a.filter((([,,c])=>c>=14)):(l=a.filter((([,c])=>c===n)),l.length||(l=a)),l.map((([c])=>`apple ${c} gpu`))}let $k=class extends Error{constructor(e){super(e),Object.setPrototypeOf(this,new.target.prototype)}};const rI=[],Xk=[];function aAe(i,e){if(i===e)return 0;const t=i;i.length>e.length&&(i=e,e=t);let n=i.length,r=e.length;for(;n>0&&i.charCodeAt(~-n)===e.charCodeAt(~-r);)n--,r--;let s,o=0;for(;o<n&&i.charCodeAt(o)===e.charCodeAt(o);)o++;if(n-=o,r-=o,n===0)return r;let a,l,c=0,u=0,h=0;for(;u<n;)Xk[u]=i.charCodeAt(o+u),rI[u]=++u;for(;h<r;)for(s=e.charCodeAt(o+h),a=h++,c=h,u=0;u<n;u++)l=s===Xk[u]?a:a+1,a=rI[u],c=rI[u]=a>c?l>c?c+1:l:l>a?a+1:l;return c}function lAe(i){return i!=null}const cAe=({mobileTiers:i=[0,15,30,60],desktopTiers:e=[0,15,30,60],override:t={},glContext:n,failIfMajorPerformanceCaveat:r=!1,benchmarksURL:s="https://unpkg.com/detect-gpu@5.0.70/dist/benchmarks"}={})=>iI(void 0,void 0,void 0,(function*(){const o={};if(yj)return{tier:0,type:"SSR"};const{isIpad:a=!!(ch!=null&&ch.isIpad),isMobile:l=!!(ch!=null&&ch.isMobile),screenSize:c=window.screen,loadBenchmarks:u=(T=>iI(void 0,void 0,void 0,(function*(){const I=yield fetch(`${s}/${T}`).then((M=>M.json()));if(parseInt(I.shift().split(".")[0],10)<4)throw new $k("Detect GPU benchmark data is out of date. Please update to version 4x");return I})))}=t;let{renderer:h}=t;const f=(T,I,M,L,P)=>({device:P,fps:L,gpu:M,isMobile:l,tier:T,type:I});let d,m="";if(h)h=Yk(h),d=[h];else{const T=n||(function(M,L=!1){const P={alpha:!1,antialias:!1,depth:!1,failIfMajorPerformanceCaveat:L,powerPreference:"high-performance",stencil:!1};M&&delete P.powerPreference;const R=window.document.createElement("canvas"),U=R.getContext("webgl",P)||R.getContext("experimental-webgl",P);return U??void 0})(ch==null?void 0:ch.isSafari12,r);if(!T)return f(0,"WEBGL_UNSUPPORTED");const I=ch!=null&&ch.isFirefox?null:T.getExtension("WEBGL_debug_renderer_info");if(h=I?T.getParameter(I.UNMASKED_RENDERER_WEBGL):T.getParameter(T.RENDERER),!h)return f(1,"FALLBACK");m=h,h=Yk(h),d=(function(M,L,P){return L==="apple gpu"?oAe(M,L,P):[L]})(T,h,l)}const y=(yield Promise.all(d.map((function(T){var I;return iI(this,void 0,void 0,(function*(){const M=(te=>{const q=l?["adreno","apple","mali-t","mali","nvidia","powervr","samsung"]:["intel","apple","amd","radeon","nvidia","geforce","adreno"];for(const J of q)if(te.includes(J))return J})(T);if(!M)return;const L=`${l?"m":"d"}-${M}${a?"-ipad":""}.json`,P=o[L]=(I=o[L])!==null&&I!==void 0?I:u(L);let R;try{R=yield P}catch(te){if(te instanceof $k)throw te;return}const U=(function(te){var q;const J=(te=te.replace(/\([^)]+\)/,"")).match(/\d+/)||te.match(/(\W|^)([A-Za-z]{1,3})(\W|$)/g);return(q=J==null?void 0:J.join("").replace(/\W|amd/g,""))!==null&&q!==void 0?q:""})(T);let k=R.filter((([,te])=>te===U));k.length||(k=R.filter((([te])=>te.includes(T))));const H=k.length;if(H===0)return;const G=T.split(/[.,()\[\]/\s]/g).sort().filter(((te,q,J)=>q===0||te!==J[q-1])).join(" ");let X,[Z,,,,oe]=H>1?k.map((te=>[te,aAe(G,te[2])])).sort((([,te],[,q])=>te-q))[0][0]:k[0],K=Number.MAX_VALUE;const{devicePixelRatio:V}=window,W=c.width*V*c.height*V;for(const te of oe){const[q,J]=te,re=q*J,ie=Math.abs(W-re);ie<K&&(K=ie,X=te)}if(!X)return;const[,,F,Y]=X;return[K,F,Z,Y]}))})))).filter(lAe).sort((([T=Number.MAX_VALUE,I],[M=Number.MAX_VALUE,L])=>T===M?I-L:T-M));if(!y.length){const T=sAe.find((I=>h.includes(I)));return T?f(0,"BLOCKLISTED",T):f(1,"FALLBACK",`${h} (${m})`)}const[,g,A,E]=y[0];if(g===-1)return f(0,"BLOCKLISTED",A,g,E);const x=l?i:e;let w=0;for(let T=0;T<x.length;T++)g>=x[T]&&(w=T);return f(w,"BENCHMARK",A,g,E)})),vj=i=>Th(()=>cAe(i),["useDetectGPU"]);function uAe({children:i,...e}){const t=vj(e);return C.createElement(C.Fragment,null,i==null?void 0:i(t))}const xj=0,hAe=1,I4=2,qk=2,sI=1.25,Jk=1,Jd=32,M4=65535,fAe=Math.pow(2,-24),oI=Symbol("SKIP_GENERATION");function Ej(i){return i.index?i.index.count:i.attributes.position.count}function LA(i){return Ej(i)/3}function _j(i,e=ArrayBuffer){return i>65535?new Uint32Array(new e(4*i)):new Uint16Array(new e(2*i))}function dAe(i,e){if(!i.index){const t=i.attributes.position.count,n=e.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer,r=_j(t,n);i.setIndex(new mn(r,1));for(let s=0;s<t;s++)r[s]=s}}function Sj(i,e){const t=LA(i),n=e||i.drawRange,r=n.start/3,s=(n.start+n.count)/3,o=Math.max(0,r),a=Math.min(t,s)-o;return[{offset:Math.floor(o),count:Math.floor(a)}]}function wj(i,e){if(!i.groups||!i.groups.length)return Sj(i,e);const t=[],n=new Set,r=e||i.drawRange,s=r.start/3,o=(r.start+r.count)/3;for(const l of i.groups){const c=l.start/3,u=(l.start+l.count)/3;n.add(Math.max(s,c)),n.add(Math.min(o,u))}const a=Array.from(n.values()).sort((l,c)=>l-c);for(let l=0;l<a.length-1;l++){const c=a[l],u=a[l+1];t.push({offset:Math.floor(c),count:Math.floor(u-c)})}return t}function pAe(i,e){const t=LA(i),n=wj(i,e).sort((o,a)=>o.offset-a.offset),r=n[n.length-1];r.count=Math.min(t-r.offset,r.count);let s=0;return n.forEach(({count:o})=>s+=o),t!==s}function aI(i,e,t,n,r){let s=1/0,o=1/0,a=1/0,l=-1/0,c=-1/0,u=-1/0,h=1/0,f=1/0,d=1/0,m=-1/0,y=-1/0,g=-1/0;for(let A=e*6,E=(e+t)*6;A<E;A+=6){const x=i[A+0],w=i[A+1],T=x-w,I=x+w;T<s&&(s=T),I>l&&(l=I),x<h&&(h=x),x>m&&(m=x);const M=i[A+2],L=i[A+3],P=M-L,R=M+L;P<o&&(o=P),R>c&&(c=R),M<f&&(f=M),M>y&&(y=M);const U=i[A+4],k=i[A+5],H=U-k,G=U+k;H<a&&(a=H),G>u&&(u=G),U<d&&(d=U),U>g&&(g=U)}n[0]=s,n[1]=o,n[2]=a,n[3]=l,n[4]=c,n[5]=u,r[0]=h,r[1]=f,r[2]=d,r[3]=m,r[4]=y,r[5]=g}function mAe(i,e=null,t=null,n=null){const r=i.attributes.position,s=i.index?i.index.array:null,o=LA(i),a=r.normalized;let l;e===null?(l=new Float32Array(o*6*4),t=0,n=o):(l=e,t=t||0,n=n||o);const c=r.array,u=r.offset||0;let h=3;r.isInterleavedBufferAttribute&&(h=r.data.stride);const f=["getX","getY","getZ"];for(let d=t;d<t+n;d++){const m=d*3,y=d*6;let g=m+0,A=m+1,E=m+2;s&&(g=s[g],A=s[A],E=s[E]),a||(g=g*h+u,A=A*h+u,E=E*h+u);for(let x=0;x<3;x++){let w,T,I;a?(w=r[f[x]](g),T=r[f[x]](A),I=r[f[x]](E)):(w=c[g+x],T=c[A+x],I=c[E+x]);let M=w;T<M&&(M=T),I<M&&(M=I);let L=w;T>L&&(L=T),I>L&&(L=I);const P=(L-M)/2,R=x*2;l[y+R+0]=M+P,l[y+R+1]=P+(Math.abs(M)+P)*fAe}}return l}function ns(i,e,t){return t.min.x=e[i],t.min.y=e[i+1],t.min.z=e[i+2],t.max.x=e[i+3],t.max.y=e[i+4],t.max.z=e[i+5],t}function Zk(i){let e=-1,t=-1/0;for(let n=0;n<3;n++){const r=i[n+3]-i[n];r>t&&(t=r,e=n)}return e}function eF(i,e){e.set(i)}function tF(i,e,t){let n,r;for(let s=0;s<3;s++){const o=s+3;n=i[s],r=e[s],t[s]=n<r?n:r,n=i[o],r=e[o],t[o]=n>r?n:r}}function c_(i,e,t){for(let n=0;n<3;n++){const r=e[i+2*n],s=e[i+2*n+1],o=r-s,a=r+s;o<t[n]&&(t[n]=o),a>t[n+3]&&(t[n+3]=a)}}function vv(i){const e=i[3]-i[0],t=i[4]-i[1],n=i[5]-i[2];return 2*(e*t+t*n+n*e)}const Af=32,gAe=(i,e)=>i.candidate-e.candidate,Ld=new Array(Af).fill().map(()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0})),u_=new Float32Array(6);function AAe(i,e,t,n,r,s){let o=-1,a=0;if(s===xj)o=Zk(e),o!==-1&&(a=(e[o]+e[o+3])/2);else if(s===hAe)o=Zk(i),o!==-1&&(a=yAe(t,n,r,o));else if(s===I4){const l=vv(i);let c=sI*r;const u=n*6,h=(n+r)*6;for(let f=0;f<3;f++){const d=e[f],g=(e[f+3]-d)/Af;if(r<Af/4){const A=[...Ld];A.length=r;let E=0;for(let w=u;w<h;w+=6,E++){const T=A[E];T.candidate=t[w+2*f],T.count=0;const{bounds:I,leftCacheBounds:M,rightCacheBounds:L}=T;for(let P=0;P<3;P++)L[P]=1/0,L[P+3]=-1/0,M[P]=1/0,M[P+3]=-1/0,I[P]=1/0,I[P+3]=-1/0;c_(w,t,I)}A.sort(gAe);let x=r;for(let w=0;w<x;w++){const T=A[w];for(;w+1<x&&A[w+1].candidate===T.candidate;)A.splice(w+1,1),x--}for(let w=u;w<h;w+=6){const T=t[w+2*f];for(let I=0;I<x;I++){const M=A[I];T>=M.candidate?c_(w,t,M.rightCacheBounds):(c_(w,t,M.leftCacheBounds),M.count++)}}for(let w=0;w<x;w++){const T=A[w],I=T.count,M=r-T.count,L=T.leftCacheBounds,P=T.rightCacheBounds;let R=0;I!==0&&(R=vv(L)/l);let U=0;M!==0&&(U=vv(P)/l);const k=Jk+sI*(R*I+U*M);k<c&&(o=f,c=k,a=T.candidate)}}else{for(let x=0;x<Af;x++){const w=Ld[x];w.count=0,w.candidate=d+g+x*g;const T=w.bounds;for(let I=0;I<3;I++)T[I]=1/0,T[I+3]=-1/0}for(let x=u;x<h;x+=6){let I=~~((t[x+2*f]-d)/g);I>=Af&&(I=Af-1);const M=Ld[I];M.count++,c_(x,t,M.bounds)}const A=Ld[Af-1];eF(A.bounds,A.rightCacheBounds);for(let x=Af-2;x>=0;x--){const w=Ld[x],T=Ld[x+1];tF(w.bounds,T.rightCacheBounds,w.rightCacheBounds)}let E=0;for(let x=0;x<Af-1;x++){const w=Ld[x],T=w.count,I=w.bounds,L=Ld[x+1].rightCacheBounds;T!==0&&(E===0?eF(I,u_):tF(I,u_,u_)),E+=T;let P=0,R=0;E!==0&&(P=vv(u_)/l);const U=r-E;U!==0&&(R=vv(L)/l);const k=Jk+sI*(P*E+R*U);k<c&&(o=f,c=k,a=w.candidate)}}}}else console.warn(`MeshBVH: Invalid build strategy value ${s} used.`);return{axis:o,pos:a}}function yAe(i,e,t,n){let r=0;for(let s=e,o=e+t;s<o;s++)r+=i[s*6+n*2];return r/t}class lI{constructor(){this.boundingData=new Float32Array(6)}}function vAe(i,e,t,n,r,s){let o=n,a=n+r-1;const l=s.pos,c=s.axis*2;for(;;){for(;o<=a&&t[o*6+c]<l;)o++;for(;o<=a&&t[a*6+c]>=l;)a--;if(o<a){for(let u=0;u<3;u++){let h=e[o*3+u];e[o*3+u]=e[a*3+u],e[a*3+u]=h}for(let u=0;u<6;u++){let h=t[o*6+u];t[o*6+u]=t[a*6+u],t[a*6+u]=h}o++,a--}else return o}}function xAe(i,e,t,n,r,s){let o=n,a=n+r-1;const l=s.pos,c=s.axis*2;for(;;){for(;o<=a&&t[o*6+c]<l;)o++;for(;o<=a&&t[a*6+c]>=l;)a--;if(o<a){let u=i[o];i[o]=i[a],i[a]=u;for(let h=0;h<6;h++){let f=t[o*6+h];t[o*6+h]=t[a*6+h],t[a*6+h]=f}o++,a--}else return o}}function va(i,e){return e[i+15]===65535}function el(i,e){return e[i+6]}function Il(i,e){return e[i+14]}function dc(i){return i+8}function Ml(i,e){return e[i+6]}function l8(i,e){return e[i+7]}let Cj,Qv,uS,Tj;const EAe=Math.pow(2,32);function N5(i){return"count"in i?1:1+N5(i.left)+N5(i.right)}function _Ae(i,e,t){return Cj=new Float32Array(t),Qv=new Uint32Array(t),uS=new Uint16Array(t),Tj=new Uint8Array(t),U5(i,e)}function U5(i,e){const t=i/4,n=i/2,r="count"in e,s=e.boundingData;for(let o=0;o<6;o++)Cj[t+o]=s[o];if(r)if(e.buffer){const o=e.buffer;Tj.set(new Uint8Array(o),i);for(let a=i,l=i+o.byteLength;a<l;a+=Jd){const c=a/2;va(c,uS)||(Qv[a/4+6]+=t)}return i+o.byteLength}else{const o=e.offset,a=e.count;return Qv[t+6]=o,uS[n+14]=a,uS[n+15]=M4,i+Jd}else{const o=e.left,a=e.right,l=e.splitAxis;let c;if(c=U5(i+Jd,o),c/4>EAe)throw new Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return Qv[t+6]=c/4,c=U5(c,a),Qv[t+7]=l,c}}function SAe(i,e){const t=(i.index?i.index.count:i.attributes.position.count)/3,n=t>2**16,r=n?4:2,s=e?new SharedArrayBuffer(t*r):new ArrayBuffer(t*r),o=n?new Uint32Array(s):new Uint16Array(s);for(let a=0,l=o.length;a<l;a++)o[a]=a;return o}function wAe(i,e,t,n,r){const{maxDepth:s,verbose:o,maxLeafTris:a,strategy:l,onProgress:c,indirect:u}=r,h=i._indirectBuffer,f=i.geometry,d=f.index?f.index.array:null,m=u?xAe:vAe,y=LA(f),g=new Float32Array(6);let A=!1;const E=new lI;return aI(e,t,n,E.boundingData,g),w(E,t,n,g),E;function x(T){c&&c(T/y)}function w(T,I,M,L=null,P=0){if(!A&&P>=s&&(A=!0,o&&(console.warn(`MeshBVH: Max depth of ${s} reached when generating BVH. Consider increasing maxDepth.`),console.warn(f))),M<=a||P>=s)return x(I+M),T.offset=I,T.count=M,T;const R=AAe(T.boundingData,L,e,I,M,l);if(R.axis===-1)return x(I+M),T.offset=I,T.count=M,T;const U=m(h,d,e,I,M,R);if(U===I||U===I+M)x(I+M),T.offset=I,T.count=M;else{T.splitAxis=R.axis;const k=new lI,H=I,G=U-I;T.left=k,aI(e,H,G,k.boundingData,g),w(k,H,G,g,P+1);const X=new lI,Z=U,oe=M-G;T.right=X,aI(e,Z,oe,X.boundingData,g),w(X,Z,oe,g,P+1)}return T}}function CAe(i,e){const t=i.geometry;e.indirect&&(i._indirectBuffer=SAe(t,e.useSharedArrayBuffer),pAe(t,e.range)&&!e.verbose&&console.warn('MeshBVH: Provided geometry contains groups or a range that do not fully span the vertex contents while using the "indirect" option. BVH may incorrectly report intersections on unrendered portions of the geometry.')),i._indirectBuffer||dAe(t,e);const n=e.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer,r=mAe(t),s=e.indirect?Sj(t,e.range):wj(t,e.range);i._roots=s.map(o=>{const a=wAe(i,r,o.offset,o.count,e),l=N5(a),c=new n(Jd*l);return _Ae(0,a,c),c})}class zf{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(e,t){let n=1/0,r=-1/0;for(let s=0,o=e.length;s<o;s++){const l=e[s][t];n=l<n?l:n,r=l>r?l:r}this.min=n,this.max=r}setFromPoints(e,t){let n=1/0,r=-1/0;for(let s=0,o=t.length;s<o;s++){const a=t[s],l=e.dot(a);n=l<n?l:n,r=l>r?l:r}this.min=n,this.max=r}isSeparated(e){return this.min>e.max||e.min>this.max}}zf.prototype.setFromBox=(function(){const i=new Q;return function(t,n){const r=n.min,s=n.max;let o=1/0,a=-1/0;for(let l=0;l<=1;l++)for(let c=0;c<=1;c++)for(let u=0;u<=1;u++){i.x=r.x*l+s.x*(1-l),i.y=r.y*c+s.y*(1-c),i.z=r.z*u+s.z*(1-u);const h=t.dot(i);o=Math.min(h,o),a=Math.max(h,a)}this.min=o,this.max=a}})();const TAe=(function(){const i=new Q,e=new Q,t=new Q;return function(r,s,o){const a=r.start,l=i,c=s.start,u=e;t.subVectors(a,c),i.subVectors(r.end,r.start),e.subVectors(s.end,s.start);const h=t.dot(u),f=u.dot(l),d=u.dot(u),m=t.dot(l),g=l.dot(l)*d-f*f;let A,E;g!==0?A=(h*f-m*d)/g:A=0,E=(h+A*f)/d,o.x=A,o.y=E}})(),c8=(function(){const i=new Ue,e=new Q,t=new Q;return function(r,s,o,a){TAe(r,s,i);let l=i.x,c=i.y;if(l>=0&&l<=1&&c>=0&&c<=1){r.at(l,o),s.at(c,a);return}else if(l>=0&&l<=1){c<0?s.at(0,a):s.at(1,a),r.closestPointToPoint(a,!0,o);return}else if(c>=0&&c<=1){l<0?r.at(0,o):r.at(1,o),s.closestPointToPoint(o,!0,a);return}else{let u;l<0?u=r.start:u=r.end;let h;c<0?h=s.start:h=s.end;const f=e,d=t;if(r.closestPointToPoint(h,!0,e),s.closestPointToPoint(u,!0,t),f.distanceToSquared(h)<=d.distanceToSquared(u)){o.copy(f),a.copy(h);return}else{o.copy(u),a.copy(d);return}}}})(),bAe=(function(){const i=new Q,e=new Q,t=new vo,n=new Eu;return function(s,o){const{radius:a,center:l}=s,{a:c,b:u,c:h}=o;if(n.start=c,n.end=u,n.closestPointToPoint(l,!0,i).distanceTo(l)<=a||(n.start=c,n.end=h,n.closestPointToPoint(l,!0,i).distanceTo(l)<=a)||(n.start=u,n.end=h,n.closestPointToPoint(l,!0,i).distanceTo(l)<=a))return!0;const y=o.getPlane(t);if(Math.abs(y.distanceToPoint(l))<=a){const A=y.projectPoint(l,e);if(o.containsPoint(A))return!0}return!1}})(),IAe=1e-15;function cI(i){return Math.abs(i)<IAe}class Tu extends ks{constructor(...e){super(...e),this.isExtendedTriangle=!0,this.satAxes=new Array(4).fill().map(()=>new Q),this.satBounds=new Array(4).fill().map(()=>new zf),this.points=[this.a,this.b,this.c],this.sphere=new Bi,this.plane=new vo,this.needsUpdate=!0}intersectsSphere(e){return bAe(e,this)}update(){const e=this.a,t=this.b,n=this.c,r=this.points,s=this.satAxes,o=this.satBounds,a=s[0],l=o[0];this.getNormal(a),l.setFromPoints(a,r);const c=s[1],u=o[1];c.subVectors(e,t),u.setFromPoints(c,r);const h=s[2],f=o[2];h.subVectors(t,n),f.setFromPoints(h,r);const d=s[3],m=o[3];d.subVectors(n,e),m.setFromPoints(d,r),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(a,e),this.needsUpdate=!1}}Tu.prototype.closestPointToSegment=(function(){const i=new Q,e=new Q,t=new Eu;return function(r,s=null,o=null){const{start:a,end:l}=r,c=this.points;let u,h=1/0;for(let f=0;f<3;f++){const d=(f+1)%3;t.start.copy(c[f]),t.end.copy(c[d]),c8(t,r,i,e),u=i.distanceToSquared(e),u<h&&(h=u,s&&s.copy(i),o&&o.copy(e))}return this.closestPointToPoint(a,i),u=a.distanceToSquared(i),u<h&&(h=u,s&&s.copy(i),o&&o.copy(a)),this.closestPointToPoint(l,i),u=l.distanceToSquared(i),u<h&&(h=u,s&&s.copy(i),o&&o.copy(l)),Math.sqrt(h)}})();Tu.prototype.intersectsTriangle=(function(){const i=new Tu,e=new Array(3),t=new Array(3),n=new zf,r=new zf,s=new Q,o=new Q,a=new Q,l=new Q,c=new Q,u=new Eu,h=new Eu,f=new Eu,d=new Q;function m(y,g,A){const E=y.points;let x=0,w=-1;for(let T=0;T<3;T++){const{start:I,end:M}=u;I.copy(E[T]),M.copy(E[(T+1)%3]),u.delta(o);const L=cI(g.distanceToPoint(I));if(cI(g.normal.dot(o))&&L){A.copy(u),x=2;break}const P=g.intersectLine(u,d);if(!P&&L&&d.copy(I),(P||L)&&!cI(d.distanceTo(M))){if(x<=1)(x===1?A.start:A.end).copy(d),L&&(w=x);else if(x>=2){(w===1?A.start:A.end).copy(d),x=2;break}if(x++,x===2&&w===-1)break}}return x}return function(g,A=null,E=!1){this.needsUpdate&&this.update(),g.isExtendedTriangle?g.needsUpdate&&g.update():(i.copy(g),i.update(),g=i);const x=this.plane,w=g.plane;if(Math.abs(x.normal.dot(w.normal))>1-1e-10){const T=this.satBounds,I=this.satAxes;t[0]=g.a,t[1]=g.b,t[2]=g.c;for(let P=0;P<4;P++){const R=T[P],U=I[P];if(n.setFromPoints(U,t),R.isSeparated(n))return!1}const M=g.satBounds,L=g.satAxes;e[0]=this.a,e[1]=this.b,e[2]=this.c;for(let P=0;P<4;P++){const R=M[P],U=L[P];if(n.setFromPoints(U,e),R.isSeparated(n))return!1}for(let P=0;P<4;P++){const R=I[P];for(let U=0;U<4;U++){const k=L[U];if(s.crossVectors(R,k),n.setFromPoints(s,e),r.setFromPoints(s,t),n.isSeparated(r))return!1}}return A&&(E||console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),A.start.set(0,0,0),A.end.set(0,0,0)),!0}else{const T=m(this,w,h);if(T===1&&g.containsPoint(h.end))return A&&(A.start.copy(h.end),A.end.copy(h.end)),!0;if(T!==2)return!1;const I=m(g,x,f);if(I===1&&this.containsPoint(f.end))return A&&(A.start.copy(f.end),A.end.copy(f.end)),!0;if(I!==2)return!1;if(h.delta(a),f.delta(l),a.dot(l)<0){let H=f.start;f.start=f.end,f.end=H}const M=h.start.dot(a),L=h.end.dot(a),P=f.start.dot(a),R=f.end.dot(a),U=L<P,k=M<R;return M!==R&&P!==L&&U===k?!1:(A&&(c.subVectors(h.start,f.start),c.dot(a)>0?A.start.copy(h.start):A.start.copy(f.start),c.subVectors(h.end,f.end),c.dot(a)<0?A.end.copy(h.end):A.end.copy(f.end)),!0)}}})();Tu.prototype.distanceToPoint=(function(){const i=new Q;return function(t){return this.closestPointToPoint(t,i),t.distanceTo(i)}})();Tu.prototype.distanceToTriangle=(function(){const i=new Q,e=new Q,t=["a","b","c"],n=new Eu,r=new Eu;return function(o,a=null,l=null){const c=a||l?n:null;if(this.intersectsTriangle(o,c))return(a||l)&&(a&&c.getCenter(a),l&&c.getCenter(l)),0;let u=1/0;for(let h=0;h<3;h++){let f;const d=t[h],m=o[d];this.closestPointToPoint(m,i),f=m.distanceToSquared(i),f<u&&(u=f,a&&a.copy(i),l&&l.copy(m));const y=this[d];o.closestPointToPoint(y,i),f=y.distanceToSquared(i),f<u&&(u=f,a&&a.copy(y),l&&l.copy(i))}for(let h=0;h<3;h++){const f=t[h],d=t[(h+1)%3];n.set(this[f],this[d]);for(let m=0;m<3;m++){const y=t[m],g=t[(m+1)%3];r.set(o[y],o[g]),c8(n,r,i,e);const A=i.distanceToSquared(e);A<u&&(u=A,a&&a.copy(i),l&&l.copy(e))}}return Math.sqrt(u)}})();class Ta{constructor(e,t,n){this.isOrientedBox=!0,this.min=new Q,this.max=new Q,this.matrix=new Xe,this.invMatrix=new Xe,this.points=new Array(8).fill().map(()=>new Q),this.satAxes=new Array(3).fill().map(()=>new Q),this.satBounds=new Array(3).fill().map(()=>new zf),this.alignedSatBounds=new Array(3).fill().map(()=>new zf),this.needsUpdate=!1,e&&this.min.copy(e),t&&this.max.copy(t),n&&this.matrix.copy(n)}set(e,t,n){this.min.copy(e),this.max.copy(t),this.matrix.copy(n),this.needsUpdate=!0}copy(e){this.min.copy(e.min),this.max.copy(e.max),this.matrix.copy(e.matrix),this.needsUpdate=!0}}Ta.prototype.update=(function(){return function(){const e=this.matrix,t=this.min,n=this.max,r=this.points;for(let c=0;c<=1;c++)for(let u=0;u<=1;u++)for(let h=0;h<=1;h++){const f=1*c|2*u|4*h,d=r[f];d.x=c?n.x:t.x,d.y=u?n.y:t.y,d.z=h?n.z:t.z,d.applyMatrix4(e)}const s=this.satBounds,o=this.satAxes,a=r[0];for(let c=0;c<3;c++){const u=o[c],h=s[c],f=1<<c,d=r[f];u.subVectors(a,d),h.setFromPoints(u,r)}const l=this.alignedSatBounds;l[0].setFromPointsField(r,"x"),l[1].setFromPointsField(r,"y"),l[2].setFromPointsField(r,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1}})();Ta.prototype.intersectsBox=(function(){const i=new zf;return function(t){this.needsUpdate&&this.update();const n=t.min,r=t.max,s=this.satBounds,o=this.satAxes,a=this.alignedSatBounds;if(i.min=n.x,i.max=r.x,a[0].isSeparated(i)||(i.min=n.y,i.max=r.y,a[1].isSeparated(i))||(i.min=n.z,i.max=r.z,a[2].isSeparated(i)))return!1;for(let l=0;l<3;l++){const c=o[l],u=s[l];if(i.setFromBox(c,t),u.isSeparated(i))return!1}return!0}})();Ta.prototype.intersectsTriangle=(function(){const i=new Tu,e=new Array(3),t=new zf,n=new zf,r=new Q;return function(o){this.needsUpdate&&this.update(),o.isExtendedTriangle?o.needsUpdate&&o.update():(i.copy(o),i.update(),o=i);const a=this.satBounds,l=this.satAxes;e[0]=o.a,e[1]=o.b,e[2]=o.c;for(let f=0;f<3;f++){const d=a[f],m=l[f];if(t.setFromPoints(m,e),d.isSeparated(t))return!1}const c=o.satBounds,u=o.satAxes,h=this.points;for(let f=0;f<3;f++){const d=c[f],m=u[f];if(t.setFromPoints(m,h),d.isSeparated(t))return!1}for(let f=0;f<3;f++){const d=l[f];for(let m=0;m<4;m++){const y=u[m];if(r.crossVectors(d,y),t.setFromPoints(r,e),n.setFromPoints(r,h),t.isSeparated(n))return!1}}return!0}})();Ta.prototype.closestPointToPoint=(function(){return function(e,t){return this.needsUpdate&&this.update(),t.copy(e).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),t}})();Ta.prototype.distanceToPoint=(function(){const i=new Q;return function(t){return this.closestPointToPoint(t,i),t.distanceTo(i)}})();Ta.prototype.distanceToBox=(function(){const i=["x","y","z"],e=new Array(12).fill().map(()=>new Eu),t=new Array(12).fill().map(()=>new Eu),n=new Q,r=new Q;return function(o,a=0,l=null,c=null){if(this.needsUpdate&&this.update(),this.intersectsBox(o))return(l||c)&&(o.getCenter(r),this.closestPointToPoint(r,n),o.closestPointToPoint(n,r),l&&l.copy(n),c&&c.copy(r)),0;const u=a*a,h=o.min,f=o.max,d=this.points;let m=1/0;for(let g=0;g<8;g++){const A=d[g];r.copy(A).clamp(h,f);const E=A.distanceToSquared(r);if(E<m&&(m=E,l&&l.copy(A),c&&c.copy(r),E<u))return Math.sqrt(E)}let y=0;for(let g=0;g<3;g++)for(let A=0;A<=1;A++)for(let E=0;E<=1;E++){const x=(g+1)%3,w=(g+2)%3,T=A<<x|E<<w,I=1<<g|A<<x|E<<w,M=d[T],L=d[I];e[y].set(M,L);const R=i[g],U=i[x],k=i[w],H=t[y],G=H.start,X=H.end;G[R]=h[R],G[U]=A?h[U]:f[U],G[k]=E?h[k]:f[U],X[R]=f[R],X[U]=A?h[U]:f[U],X[k]=E?h[k]:f[U],y++}for(let g=0;g<=1;g++)for(let A=0;A<=1;A++)for(let E=0;E<=1;E++){r.x=g?f.x:h.x,r.y=A?f.y:h.y,r.z=E?f.z:h.z,this.closestPointToPoint(r,n);const x=r.distanceToSquared(n);if(x<m&&(m=x,l&&l.copy(n),c&&c.copy(r),x<u))return Math.sqrt(x)}for(let g=0;g<12;g++){const A=e[g];for(let E=0;E<12;E++){const x=t[E];c8(A,x,n,r);const w=n.distanceToSquared(r);if(w<m&&(m=w,l&&l.copy(n),c&&c.copy(r),w<u))return Math.sqrt(w)}}return Math.sqrt(m)}})();class u8{constructor(e){this._getNewPrimitive=e,this._primitives=[]}getPrimitive(){const e=this._primitives;return e.length===0?this._getNewPrimitive():e.pop()}releasePrimitive(e){this._primitives.push(e)}}class MAe extends u8{constructor(){super(()=>new Tu)}}const pc=new MAe;class RAe{constructor(){this.float32Array=null,this.uint16Array=null,this.uint32Array=null;const e=[];let t=null;this.setBuffer=n=>{t&&e.push(t),t=n,this.float32Array=new Float32Array(n),this.uint16Array=new Uint16Array(n),this.uint32Array=new Uint32Array(n)},this.clearBuffer=()=>{t=null,this.float32Array=null,this.uint16Array=null,this.uint32Array=null,e.length!==0&&this.setBuffer(e.pop())}}}const br=new RAe;let Wd,O1;const e1=[],h_=new u8(()=>new ti);function PAe(i,e,t,n,r,s){Wd=h_.getPrimitive(),O1=h_.getPrimitive(),e1.push(Wd,O1),br.setBuffer(i._roots[e]);const o=z5(0,i.geometry,t,n,r,s);br.clearBuffer(),h_.releasePrimitive(Wd),h_.releasePrimitive(O1),e1.pop(),e1.pop();const a=e1.length;return a>0&&(O1=e1[a-1],Wd=e1[a-2]),o}function z5(i,e,t,n,r=null,s=0,o=0){const{float32Array:a,uint16Array:l,uint32Array:c}=br;let u=i*2;if(va(u,l)){const f=el(i,c),d=Il(u,l);return ns(i,a,Wd),n(f,d,!1,o,s+i,Wd)}else{let R=function(k){const{uint16Array:H,uint32Array:G}=br;let X=k*2;for(;!va(X,H);)k=dc(k),X=k*2;return el(k,G)},U=function(k){const{uint16Array:H,uint32Array:G}=br;let X=k*2;for(;!va(X,H);)k=Ml(k,G),X=k*2;return el(k,G)+Il(X,H)};const f=dc(i),d=Ml(i,c);let m=f,y=d,g,A,E,x;if(r&&(E=Wd,x=O1,ns(m,a,E),ns(y,a,x),g=r(E),A=r(x),A<g)){m=d,y=f;const k=g;g=A,A=k,E=x}E||(E=Wd,ns(m,a,E));const w=va(m*2,l),T=t(E,w,g,o+1,s+m);let I;if(T===qk){const k=R(m),G=U(m)-k;I=n(k,G,!0,o+1,s+m,E)}else I=T&&z5(m,e,t,n,r,s,o+1);if(I)return!0;x=O1,ns(y,a,x);const M=va(y*2,l),L=t(x,M,A,o+1,s+y);let P;if(L===qk){const k=R(y),G=U(y)-k;P=n(k,G,!0,o+1,s+y,x)}else P=L&&z5(y,e,t,n,r,s,o+1);return!!P}}const xv=new Q,uI=new Q;function LAe(i,e,t={},n=0,r=1/0){const s=n*n,o=r*r;let a=1/0,l=null;if(i.shapecast({boundsTraverseOrder:u=>(xv.copy(e).clamp(u.min,u.max),xv.distanceToSquared(e)),intersectsBounds:(u,h,f)=>f<a&&f<o,intersectsTriangle:(u,h)=>{u.closestPointToPoint(e,xv);const f=e.distanceToSquared(xv);return f<a&&(uI.copy(xv),a=f,l=h),f<s}}),a===1/0)return null;const c=Math.sqrt(a);return t.point?t.point.copy(uI):t.point=uI.clone(),t.distance=c,t.faceIndex=l,t}const t1=new Q,n1=new Q,i1=new Q,f_=new Ue,d_=new Ue,p_=new Ue,nF=new Q,iF=new Q,rF=new Q,m_=new Q;function BAe(i,e,t,n,r,s,o,a){let l;if(s===ys?l=i.intersectTriangle(n,t,e,!0,r):l=i.intersectTriangle(e,t,n,s!==Li,r),l===null)return null;const c=i.origin.distanceTo(r);return c<o||c>a?null:{distance:c,point:r.clone()}}function DAe(i,e,t,n,r,s,o,a,l,c,u){t1.fromBufferAttribute(e,s),n1.fromBufferAttribute(e,o),i1.fromBufferAttribute(e,a);const h=BAe(i,t1,n1,i1,m_,l,c,u);if(h){n&&(f_.fromBufferAttribute(n,s),d_.fromBufferAttribute(n,o),p_.fromBufferAttribute(n,a),h.uv=ks.getInterpolation(m_,t1,n1,i1,f_,d_,p_,new Ue)),r&&(f_.fromBufferAttribute(r,s),d_.fromBufferAttribute(r,o),p_.fromBufferAttribute(r,a),h.uv1=ks.getInterpolation(m_,t1,n1,i1,f_,d_,p_,new Ue)),t&&(nF.fromBufferAttribute(t,s),iF.fromBufferAttribute(t,o),rF.fromBufferAttribute(t,a),h.normal=ks.getInterpolation(m_,t1,n1,i1,nF,iF,rF,new Q),h.normal.dot(i.direction)>0&&h.normal.multiplyScalar(-1));const f={a:s,b:o,c:a,normal:new Q,materialIndex:0};ks.getNormal(t1,n1,i1,f.normal),h.face=f,h.faceIndex=s}return h}function R4(i,e,t,n,r,s,o){const a=n*3;let l=a+0,c=a+1,u=a+2;const h=i.index;i.index&&(l=h.getX(l),c=h.getX(c),u=h.getX(u));const{position:f,normal:d,uv:m,uv1:y}=i.attributes,g=DAe(t,f,d,m,y,l,c,u,e,s,o);return g?(g.faceIndex=n,r&&r.push(g),g):null}function Ns(i,e,t,n){const r=i.a,s=i.b,o=i.c;let a=e,l=e+1,c=e+2;t&&(a=t.getX(a),l=t.getX(l),c=t.getX(c)),r.x=n.getX(a),r.y=n.getY(a),r.z=n.getZ(a),s.x=n.getX(l),s.y=n.getY(l),s.z=n.getZ(l),o.x=n.getX(c),o.y=n.getY(c),o.z=n.getZ(c)}function kAe(i,e,t,n,r,s,o,a){const{geometry:l,_indirectBuffer:c}=i;for(let u=n,h=n+r;u<h;u++)R4(l,e,t,u,s,o,a)}function FAe(i,e,t,n,r,s,o){const{geometry:a,_indirectBuffer:l}=i;let c=1/0,u=null;for(let h=n,f=n+r;h<f;h++){let d;d=R4(a,e,t,h,null,s,o),d&&d.distance<c&&(u=d,c=d.distance)}return u}function OAe(i,e,t,n,r,s,o){const{geometry:a}=t,{index:l}=a,c=a.attributes.position;for(let u=i,h=e+i;u<h;u++){let f;if(f=u,Ns(o,f*3,l,c),o.needsUpdate=!0,n(o,f,r,s))return!0}return!1}function NAe(i,e=null){e&&Array.isArray(e)&&(e=new Set(e));const t=i.geometry,n=t.index?t.index.array:null,r=t.attributes.position;let s,o,a,l,c=0;const u=i._roots;for(let f=0,d=u.length;f<d;f++)s=u[f],o=new Uint32Array(s),a=new Uint16Array(s),l=new Float32Array(s),h(0,c),c+=s.byteLength;function h(f,d,m=!1){const y=f*2;if(a[y+15]===M4){const A=o[f+6],E=a[y+14];let x=1/0,w=1/0,T=1/0,I=-1/0,M=-1/0,L=-1/0;for(let P=3*A,R=3*(A+E);P<R;P++){let U=n[P];const k=r.getX(U),H=r.getY(U),G=r.getZ(U);k<x&&(x=k),k>I&&(I=k),H<w&&(w=H),H>M&&(M=H),G<T&&(T=G),G>L&&(L=G)}return l[f+0]!==x||l[f+1]!==w||l[f+2]!==T||l[f+3]!==I||l[f+4]!==M||l[f+5]!==L?(l[f+0]=x,l[f+1]=w,l[f+2]=T,l[f+3]=I,l[f+4]=M,l[f+5]=L,!0):!1}else{const A=f+8,E=o[f+6],x=A+d,w=E+d;let T=m,I=!1,M=!1;e?T||(I=e.has(x),M=e.has(w),T=!I&&!M):(I=!0,M=!0);const L=T||I,P=T||M;let R=!1;L&&(R=h(A,d,T));let U=!1;P&&(U=h(E,d,T));const k=R||U;if(k)for(let H=0;H<3;H++){const G=A+H,X=E+H,Z=l[G],oe=l[G+3],K=l[X],V=l[X+3];l[f+H]=Z<K?Z:K,l[f+H+3]=oe>V?oe:V}return k}}}function lp(i,e,t,n,r){let s,o,a,l,c,u;const h=1/t.direction.x,f=1/t.direction.y,d=1/t.direction.z,m=t.origin.x,y=t.origin.y,g=t.origin.z;let A=e[i],E=e[i+3],x=e[i+1],w=e[i+3+1],T=e[i+2],I=e[i+3+2];return h>=0?(s=(A-m)*h,o=(E-m)*h):(s=(E-m)*h,o=(A-m)*h),f>=0?(a=(x-y)*f,l=(w-y)*f):(a=(w-y)*f,l=(x-y)*f),s>l||a>o||((a>s||isNaN(s))&&(s=a),(l<o||isNaN(o))&&(o=l),d>=0?(c=(T-g)*d,u=(I-g)*d):(c=(I-g)*d,u=(T-g)*d),s>u||c>o)?!1:((c>s||s!==s)&&(s=c),(u<o||o!==o)&&(o=u),s<=r&&o>=n)}function UAe(i,e,t,n,r,s,o,a){const{geometry:l,_indirectBuffer:c}=i;for(let u=n,h=n+r;u<h;u++){let f=c?c[u]:u;R4(l,e,t,f,s,o,a)}}function zAe(i,e,t,n,r,s,o){const{geometry:a,_indirectBuffer:l}=i;let c=1/0,u=null;for(let h=n,f=n+r;h<f;h++){let d;d=R4(a,e,t,l?l[h]:h,null,s,o),d&&d.distance<c&&(u=d,c=d.distance)}return u}function GAe(i,e,t,n,r,s,o){const{geometry:a}=t,{index:l}=a,c=a.attributes.position;for(let u=i,h=e+i;u<h;u++){let f;if(f=t.resolveTriangleIndex(u),Ns(o,f*3,l,c),o.needsUpdate=!0,n(o,f,r,s))return!0}return!1}function HAe(i,e,t,n,r,s,o){br.setBuffer(i._roots[e]),G5(0,i,t,n,r,s,o),br.clearBuffer()}function G5(i,e,t,n,r,s,o){const{float32Array:a,uint16Array:l,uint32Array:c}=br,u=i*2;if(va(u,l)){const f=el(i,c),d=Il(u,l);kAe(e,t,n,f,d,r,s,o)}else{const f=dc(i);lp(f,a,n,s,o)&&G5(f,e,t,n,r,s,o);const d=Ml(i,c);lp(d,a,n,s,o)&&G5(d,e,t,n,r,s,o)}}const QAe=["x","y","z"];function VAe(i,e,t,n,r,s){br.setBuffer(i._roots[e]);const o=H5(0,i,t,n,r,s);return br.clearBuffer(),o}function H5(i,e,t,n,r,s){const{float32Array:o,uint16Array:a,uint32Array:l}=br;let c=i*2;if(va(c,a)){const h=el(i,l),f=Il(c,a);return FAe(e,t,n,h,f,r,s)}else{const h=l8(i,l),f=QAe[h],m=n.direction[f]>=0;let y,g;m?(y=dc(i),g=Ml(i,l)):(y=Ml(i,l),g=dc(i));const E=lp(y,o,n,r,s)?H5(y,e,t,n,r,s):null;if(E){const T=E.point[f];if(m?T<=o[g+h]:T>=o[g+h+3])return E}const w=lp(g,o,n,r,s)?H5(g,e,t,n,r,s):null;return E&&w?E.distance<=w.distance?E:w:E||w||null}}const g_=new ti,r1=new Tu,s1=new Tu,Ev=new Xe,sF=new Ta,A_=new Ta;function jAe(i,e,t,n){br.setBuffer(i._roots[e]);const r=Q5(0,i,t,n);return br.clearBuffer(),r}function Q5(i,e,t,n,r=null){const{float32Array:s,uint16Array:o,uint32Array:a}=br;let l=i*2;if(r===null&&(t.boundingBox||t.computeBoundingBox(),sF.set(t.boundingBox.min,t.boundingBox.max,n),r=sF),va(l,o)){const u=e.geometry,h=u.index,f=u.attributes.position,d=t.index,m=t.attributes.position,y=el(i,a),g=Il(l,o);if(Ev.copy(n).invert(),t.boundsTree)return ns(i,s,A_),A_.matrix.copy(Ev),A_.needsUpdate=!0,t.boundsTree.shapecast({intersectsBounds:E=>A_.intersectsBox(E),intersectsTriangle:E=>{E.a.applyMatrix4(n),E.b.applyMatrix4(n),E.c.applyMatrix4(n),E.needsUpdate=!0;for(let x=y*3,w=(g+y)*3;x<w;x+=3)if(Ns(s1,x,h,f),s1.needsUpdate=!0,E.intersectsTriangle(s1))return!0;return!1}});for(let A=y*3,E=(g+y)*3;A<E;A+=3){Ns(r1,A,h,f),r1.a.applyMatrix4(Ev),r1.b.applyMatrix4(Ev),r1.c.applyMatrix4(Ev),r1.needsUpdate=!0;for(let x=0,w=d.count;x<w;x+=3)if(Ns(s1,x,d,m),s1.needsUpdate=!0,r1.intersectsTriangle(s1))return!0}}else{const u=i+8,h=a[i+6];return ns(u,s,g_),!!(r.intersectsBox(g_)&&Q5(u,e,t,n,r)||(ns(h,s,g_),r.intersectsBox(g_)&&Q5(h,e,t,n,r)))}}const y_=new Xe,hI=new Ta,_v=new Ta,WAe=new Q,KAe=new Q,YAe=new Q,$Ae=new Q;function XAe(i,e,t,n={},r={},s=0,o=1/0){e.boundingBox||e.computeBoundingBox(),hI.set(e.boundingBox.min,e.boundingBox.max,t),hI.needsUpdate=!0;const a=i.geometry,l=a.attributes.position,c=a.index,u=e.attributes.position,h=e.index,f=pc.getPrimitive(),d=pc.getPrimitive();let m=WAe,y=KAe,g=null,A=null;r&&(g=YAe,A=$Ae);let E=1/0,x=null,w=null;return y_.copy(t).invert(),_v.matrix.copy(y_),i.shapecast({boundsTraverseOrder:T=>hI.distanceToBox(T),intersectsBounds:(T,I,M)=>M<E&&M<o?(I&&(_v.min.copy(T.min),_v.max.copy(T.max),_v.needsUpdate=!0),!0):!1,intersectsRange:(T,I)=>{if(e.boundsTree)return e.boundsTree.shapecast({boundsTraverseOrder:L=>_v.distanceToBox(L),intersectsBounds:(L,P,R)=>R<E&&R<o,intersectsRange:(L,P)=>{for(let R=L,U=L+P;R<U;R++){Ns(d,3*R,h,u),d.a.applyMatrix4(t),d.b.applyMatrix4(t),d.c.applyMatrix4(t),d.needsUpdate=!0;for(let k=T,H=T+I;k<H;k++){Ns(f,3*k,c,l),f.needsUpdate=!0;const G=f.distanceToTriangle(d,m,g);if(G<E&&(y.copy(m),A&&A.copy(g),E=G,x=k,w=R),G<s)return!0}}}});{const M=LA(e);for(let L=0,P=M;L<P;L++){Ns(d,3*L,h,u),d.a.applyMatrix4(t),d.b.applyMatrix4(t),d.c.applyMatrix4(t),d.needsUpdate=!0;for(let R=T,U=T+I;R<U;R++){Ns(f,3*R,c,l),f.needsUpdate=!0;const k=f.distanceToTriangle(d,m,g);if(k<E&&(y.copy(m),A&&A.copy(g),E=k,x=R,w=L),k<s)return!0}}}}}),pc.releasePrimitive(f),pc.releasePrimitive(d),E===1/0?null:(n.point?n.point.copy(y):n.point=y.clone(),n.distance=E,n.faceIndex=x,r&&(r.point?r.point.copy(A):r.point=A.clone(),r.point.applyMatrix4(y_),y.applyMatrix4(y_),r.distance=y.sub(r.point).length(),r.faceIndex=w),n)}function qAe(i,e=null){e&&Array.isArray(e)&&(e=new Set(e));const t=i.geometry,n=t.index?t.index.array:null,r=t.attributes.position;let s,o,a,l,c=0;const u=i._roots;for(let f=0,d=u.length;f<d;f++)s=u[f],o=new Uint32Array(s),a=new Uint16Array(s),l=new Float32Array(s),h(0,c),c+=s.byteLength;function h(f,d,m=!1){const y=f*2;if(a[y+15]===M4){const A=o[f+6],E=a[y+14];let x=1/0,w=1/0,T=1/0,I=-1/0,M=-1/0,L=-1/0;for(let P=A,R=A+E;P<R;P++){const U=3*i.resolveTriangleIndex(P);for(let k=0;k<3;k++){let H=U+k;H=n?n[H]:H;const G=r.getX(H),X=r.getY(H),Z=r.getZ(H);G<x&&(x=G),G>I&&(I=G),X<w&&(w=X),X>M&&(M=X),Z<T&&(T=Z),Z>L&&(L=Z)}}return l[f+0]!==x||l[f+1]!==w||l[f+2]!==T||l[f+3]!==I||l[f+4]!==M||l[f+5]!==L?(l[f+0]=x,l[f+1]=w,l[f+2]=T,l[f+3]=I,l[f+4]=M,l[f+5]=L,!0):!1}else{const A=f+8,E=o[f+6],x=A+d,w=E+d;let T=m,I=!1,M=!1;e?T||(I=e.has(x),M=e.has(w),T=!I&&!M):(I=!0,M=!0);const L=T||I,P=T||M;let R=!1;L&&(R=h(A,d,T));let U=!1;P&&(U=h(E,d,T));const k=R||U;if(k)for(let H=0;H<3;H++){const G=A+H,X=E+H,Z=l[G],oe=l[G+3],K=l[X],V=l[X+3];l[f+H]=Z<K?Z:K,l[f+H+3]=oe>V?oe:V}return k}}}function JAe(i,e,t,n,r,s,o){br.setBuffer(i._roots[e]),V5(0,i,t,n,r,s,o),br.clearBuffer()}function V5(i,e,t,n,r,s,o){const{float32Array:a,uint16Array:l,uint32Array:c}=br,u=i*2;if(va(u,l)){const f=el(i,c),d=Il(u,l);UAe(e,t,n,f,d,r,s,o)}else{const f=dc(i);lp(f,a,n,s,o)&&V5(f,e,t,n,r,s,o);const d=Ml(i,c);lp(d,a,n,s,o)&&V5(d,e,t,n,r,s,o)}}const ZAe=["x","y","z"];function eye(i,e,t,n,r,s){br.setBuffer(i._roots[e]);const o=j5(0,i,t,n,r,s);return br.clearBuffer(),o}function j5(i,e,t,n,r,s){const{float32Array:o,uint16Array:a,uint32Array:l}=br;let c=i*2;if(va(c,a)){const h=el(i,l),f=Il(c,a);return zAe(e,t,n,h,f,r,s)}else{const h=l8(i,l),f=ZAe[h],m=n.direction[f]>=0;let y,g;m?(y=dc(i),g=Ml(i,l)):(y=Ml(i,l),g=dc(i));const E=lp(y,o,n,r,s)?j5(y,e,t,n,r,s):null;if(E){const T=E.point[f];if(m?T<=o[g+h]:T>=o[g+h+3])return E}const w=lp(g,o,n,r,s)?j5(g,e,t,n,r,s):null;return E&&w?E.distance<=w.distance?E:w:E||w||null}}const v_=new ti,o1=new Tu,a1=new Tu,Sv=new Xe,oF=new Ta,x_=new Ta;function tye(i,e,t,n){br.setBuffer(i._roots[e]);const r=W5(0,i,t,n);return br.clearBuffer(),r}function W5(i,e,t,n,r=null){const{float32Array:s,uint16Array:o,uint32Array:a}=br;let l=i*2;if(r===null&&(t.boundingBox||t.computeBoundingBox(),oF.set(t.boundingBox.min,t.boundingBox.max,n),r=oF),va(l,o)){const u=e.geometry,h=u.index,f=u.attributes.position,d=t.index,m=t.attributes.position,y=el(i,a),g=Il(l,o);if(Sv.copy(n).invert(),t.boundsTree)return ns(i,s,x_),x_.matrix.copy(Sv),x_.needsUpdate=!0,t.boundsTree.shapecast({intersectsBounds:E=>x_.intersectsBox(E),intersectsTriangle:E=>{E.a.applyMatrix4(n),E.b.applyMatrix4(n),E.c.applyMatrix4(n),E.needsUpdate=!0;for(let x=y,w=g+y;x<w;x++)if(Ns(a1,3*e.resolveTriangleIndex(x),h,f),a1.needsUpdate=!0,E.intersectsTriangle(a1))return!0;return!1}});for(let A=y,E=g+y;A<E;A++){const x=e.resolveTriangleIndex(A);Ns(o1,3*x,h,f),o1.a.applyMatrix4(Sv),o1.b.applyMatrix4(Sv),o1.c.applyMatrix4(Sv),o1.needsUpdate=!0;for(let w=0,T=d.count;w<T;w+=3)if(Ns(a1,w,d,m),a1.needsUpdate=!0,o1.intersectsTriangle(a1))return!0}}else{const u=i+8,h=a[i+6];return ns(u,s,v_),!!(r.intersectsBox(v_)&&W5(u,e,t,n,r)||(ns(h,s,v_),r.intersectsBox(v_)&&W5(h,e,t,n,r)))}}const E_=new Xe,fI=new Ta,wv=new Ta,nye=new Q,iye=new Q,rye=new Q,sye=new Q;function oye(i,e,t,n={},r={},s=0,o=1/0){e.boundingBox||e.computeBoundingBox(),fI.set(e.boundingBox.min,e.boundingBox.max,t),fI.needsUpdate=!0;const a=i.geometry,l=a.attributes.position,c=a.index,u=e.attributes.position,h=e.index,f=pc.getPrimitive(),d=pc.getPrimitive();let m=nye,y=iye,g=null,A=null;r&&(g=rye,A=sye);let E=1/0,x=null,w=null;return E_.copy(t).invert(),wv.matrix.copy(E_),i.shapecast({boundsTraverseOrder:T=>fI.distanceToBox(T),intersectsBounds:(T,I,M)=>M<E&&M<o?(I&&(wv.min.copy(T.min),wv.max.copy(T.max),wv.needsUpdate=!0),!0):!1,intersectsRange:(T,I)=>{if(e.boundsTree){const M=e.boundsTree;return M.shapecast({boundsTraverseOrder:L=>wv.distanceToBox(L),intersectsBounds:(L,P,R)=>R<E&&R<o,intersectsRange:(L,P)=>{for(let R=L,U=L+P;R<U;R++){const k=M.resolveTriangleIndex(R);Ns(d,3*k,h,u),d.a.applyMatrix4(t),d.b.applyMatrix4(t),d.c.applyMatrix4(t),d.needsUpdate=!0;for(let H=T,G=T+I;H<G;H++){const X=i.resolveTriangleIndex(H);Ns(f,3*X,c,l),f.needsUpdate=!0;const Z=f.distanceToTriangle(d,m,g);if(Z<E&&(y.copy(m),A&&A.copy(g),E=Z,x=H,w=R),Z<s)return!0}}}})}else{const M=LA(e);for(let L=0,P=M;L<P;L++){Ns(d,3*L,h,u),d.a.applyMatrix4(t),d.b.applyMatrix4(t),d.c.applyMatrix4(t),d.needsUpdate=!0;for(let R=T,U=T+I;R<U;R++){const k=i.resolveTriangleIndex(R);Ns(f,3*k,c,l),f.needsUpdate=!0;const H=f.distanceToTriangle(d,m,g);if(H<E&&(y.copy(m),A&&A.copy(g),E=H,x=R,w=L),H<s)return!0}}}}}),pc.releasePrimitive(f),pc.releasePrimitive(d),E===1/0?null:(n.point?n.point.copy(y):n.point=y.clone(),n.distance=E,n.faceIndex=x,r&&(r.point?r.point.copy(A):r.point=A.clone(),r.point.applyMatrix4(E_),y.applyMatrix4(E_),r.distance=y.sub(r.point).length(),r.faceIndex=w),n)}function aye(){return typeof SharedArrayBuffer<"u"}const p2=new br.constructor,ew=new br.constructor,Od=new u8(()=>new ti),l1=new ti,c1=new ti,dI=new ti,pI=new ti;let mI=!1;function lye(i,e,t,n){if(mI)throw new Error("MeshBVH: Recursive calls to bvhcast not supported.");mI=!0;const r=i._roots,s=e._roots;let o,a=0,l=0;const c=new Xe().copy(t).invert();for(let u=0,h=r.length;u<h;u++){p2.setBuffer(r[u]),l=0;const f=Od.getPrimitive();ns(0,p2.float32Array,f),f.applyMatrix4(c);for(let d=0,m=s.length;d<m&&(ew.setBuffer(s[d]),o=lu(0,0,t,c,n,a,l,0,0,f),ew.clearBuffer(),l+=s[d].length,!o);d++);if(Od.releasePrimitive(f),p2.clearBuffer(),a+=r[u].length,o)break}return mI=!1,o}function lu(i,e,t,n,r,s=0,o=0,a=0,l=0,c=null,u=!1){let h,f;u?(h=ew,f=p2):(h=p2,f=ew);const d=h.float32Array,m=h.uint32Array,y=h.uint16Array,g=f.float32Array,A=f.uint32Array,E=f.uint16Array,x=i*2,w=e*2,T=va(x,y),I=va(w,E);let M=!1;if(I&&T)u?M=r(el(e,A),Il(e*2,E),el(i,m),Il(i*2,y),l,o+e,a,s+i):M=r(el(i,m),Il(i*2,y),el(e,A),Il(e*2,E),a,s+i,l,o+e);else if(I){const L=Od.getPrimitive();ns(e,g,L),L.applyMatrix4(t);const P=dc(i),R=Ml(i,m);ns(P,d,l1),ns(R,d,c1);const U=L.intersectsBox(l1),k=L.intersectsBox(c1);M=U&&lu(e,P,n,t,r,o,s,l,a+1,L,!u)||k&&lu(e,R,n,t,r,o,s,l,a+1,L,!u),Od.releasePrimitive(L)}else{const L=dc(e),P=Ml(e,A);ns(L,g,dI),ns(P,g,pI);const R=c.intersectsBox(dI),U=c.intersectsBox(pI);if(R&&U)M=lu(i,L,t,n,r,s,o,a,l+1,c,u)||lu(i,P,t,n,r,s,o,a,l+1,c,u);else if(R)if(T)M=lu(i,L,t,n,r,s,o,a,l+1,c,u);else{const k=Od.getPrimitive();k.copy(dI).applyMatrix4(t);const H=dc(i),G=Ml(i,m);ns(H,d,l1),ns(G,d,c1);const X=k.intersectsBox(l1),Z=k.intersectsBox(c1);M=X&&lu(L,H,n,t,r,o,s,l,a+1,k,!u)||Z&&lu(L,G,n,t,r,o,s,l,a+1,k,!u),Od.releasePrimitive(k)}else if(U)if(T)M=lu(i,P,t,n,r,s,o,a,l+1,c,u);else{const k=Od.getPrimitive();k.copy(pI).applyMatrix4(t);const H=dc(i),G=Ml(i,m);ns(H,d,l1),ns(G,d,c1);const X=k.intersectsBox(l1),Z=k.intersectsBox(c1);M=X&&lu(P,H,n,t,r,o,s,l,a+1,k,!u)||Z&&lu(P,G,n,t,r,o,s,l,a+1,k,!u),Od.releasePrimitive(k)}}return M}const __=new Ta,aF=new ti,cye={strategy:xj,maxDepth:40,maxLeafTris:10,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,indirect:!1,verbose:!0,range:null};class P4{static serialize(e,t={}){t={cloneBuffers:!0,...t};const n=e.geometry,r=e._roots,s=e._indirectBuffer,o=n.getIndex();let a;return t.cloneBuffers?a={roots:r.map(l=>l.slice()),index:o?o.array.slice():null,indirectBuffer:s?s.slice():null}:a={roots:r,index:o?o.array:null,indirectBuffer:s},a}static deserialize(e,t,n={}){n={setIndex:!0,indirect:!!e.indirectBuffer,...n};const{index:r,roots:s,indirectBuffer:o}=e,a=new P4(t,{...n,[oI]:!0});if(a._roots=s,a._indirectBuffer=o||null,n.setIndex){const l=t.getIndex();if(l===null){const c=new mn(e.index,1,!1);t.setIndex(c)}else l.array!==r&&(l.array.set(r),l.needsUpdate=!0)}return a}get indirect(){return!!this._indirectBuffer}constructor(e,t={}){if(e.isBufferGeometry){if(e.index&&e.index.isInterleavedBufferAttribute)throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.")}else throw new Error("MeshBVH: Only BufferGeometries are supported.");if(t=Object.assign({...cye,[oI]:!1},t),t.useSharedArrayBuffer&&!aye())throw new Error("MeshBVH: SharedArrayBuffer is not available.");this.geometry=e,this._roots=null,this._indirectBuffer=null,t[oI]||(CAe(this,t),!e.boundingBox&&t.setBoundingBox&&(e.boundingBox=this.getBoundingBox(new ti))),this.resolveTriangleIndex=t.indirect?n=>this._indirectBuffer[n]:n=>n}refit(e=null){return(this.indirect?qAe:NAe)(this,e)}traverse(e,t=0){const n=this._roots[t],r=new Uint32Array(n),s=new Uint16Array(n);o(0);function o(a,l=0){const c=a*2,u=s[c+15]===M4;if(u){const h=r[a+6],f=s[c+14];e(l,u,new Float32Array(n,a*4,6),h,f)}else{const h=a+Jd/4,f=r[a+6],d=r[a+7];e(l,u,new Float32Array(n,a*4,6),d)||(o(h,l+1),o(f,l+1))}}}raycast(e,t=tl,n=0,r=1/0){const s=this._roots,o=this.geometry,a=[],l=t.isMaterial,c=Array.isArray(t),u=o.groups,h=l?t.side:t,f=this.indirect?JAe:HAe;for(let d=0,m=s.length;d<m;d++){const y=c?t[u[d].materialIndex].side:h,g=a.length;if(f(this,d,y,e,a,n,r),c){const A=u[d].materialIndex;for(let E=g,x=a.length;E<x;E++)a[E].face.materialIndex=A}}return a}raycastFirst(e,t=tl,n=0,r=1/0){const s=this._roots,o=this.geometry,a=t.isMaterial,l=Array.isArray(t);let c=null;const u=o.groups,h=a?t.side:t,f=this.indirect?eye:VAe;for(let d=0,m=s.length;d<m;d++){const y=l?t[u[d].materialIndex].side:h,g=f(this,d,y,e,n,r);g!=null&&(c==null||g.distance<c.distance)&&(c=g,l&&(g.face.materialIndex=u[d].materialIndex))}return c}intersectsGeometry(e,t){let n=!1;const r=this._roots,s=this.indirect?tye:jAe;for(let o=0,a=r.length;o<a&&(n=s(this,o,e,t),!n);o++);return n}shapecast(e){const t=pc.getPrimitive(),n=this.indirect?GAe:OAe;let{boundsTraverseOrder:r,intersectsBounds:s,intersectsRange:o,intersectsTriangle:a}=e;if(o&&a){const h=o;o=(f,d,m,y,g)=>h(f,d,m,y,g)?!0:n(f,d,this,a,m,y,t)}else o||(a?o=(h,f,d,m)=>n(h,f,this,a,d,m,t):o=(h,f,d)=>d);let l=!1,c=0;const u=this._roots;for(let h=0,f=u.length;h<f;h++){const d=u[h];if(l=PAe(this,h,s,o,r,c),l)break;c+=d.byteLength}return pc.releasePrimitive(t),l}bvhcast(e,t,n){let{intersectsRanges:r,intersectsTriangles:s}=n;const o=pc.getPrimitive(),a=this.geometry.index,l=this.geometry.attributes.position,c=this.indirect?m=>{const y=this.resolveTriangleIndex(m);Ns(o,y*3,a,l)}:m=>{Ns(o,m*3,a,l)},u=pc.getPrimitive(),h=e.geometry.index,f=e.geometry.attributes.position,d=e.indirect?m=>{const y=e.resolveTriangleIndex(m);Ns(u,y*3,h,f)}:m=>{Ns(u,m*3,h,f)};if(s){const m=(y,g,A,E,x,w,T,I)=>{for(let M=A,L=A+E;M<L;M++){d(M),u.a.applyMatrix4(t),u.b.applyMatrix4(t),u.c.applyMatrix4(t),u.needsUpdate=!0;for(let P=y,R=y+g;P<R;P++)if(c(P),o.needsUpdate=!0,s(o,u,P,M,x,w,T,I))return!0}return!1};if(r){const y=r;r=function(g,A,E,x,w,T,I,M){return y(g,A,E,x,w,T,I,M)?!0:m(g,A,E,x,w,T,I,M)}}else r=m}return lye(this,e,t,r)}intersectsBox(e,t){return __.set(e.min,e.max,t),__.needsUpdate=!0,this.shapecast({intersectsBounds:n=>__.intersectsBox(n),intersectsTriangle:n=>__.intersectsTriangle(n)})}intersectsSphere(e){return this.shapecast({intersectsBounds:t=>e.intersectsBox(t),intersectsTriangle:t=>t.intersectsSphere(e)})}closestPointToGeometry(e,t,n={},r={},s=0,o=1/0){return(this.indirect?oye:XAe)(this,e,t,n,r,s,o)}closestPointToPoint(e,t={},n=0,r=1/0){return LAe(this,e,t,n,r)}getBoundingBox(e){return e.makeEmpty(),this._roots.forEach(n=>{ns(0,new Float32Array(n),aF),e.union(aF)}),e}}function lF(i,e,t){return i===null?null:(i.point.applyMatrix4(e.matrixWorld),i.distance=i.point.distanceTo(t.ray.origin),i.object=e,i)}const cF=L6||null,S_=new vc,uF=new Q,hF=new Xe,uye=It.prototype.raycast,hye=cF!==null?cF.prototype.raycast:null,fF=new Q,Do=new It,w_=[];function bj(i,e){this.isBatchedMesh?fye.call(this,i,e):dye.call(this,i,e)}function fye(i,e){if(this.boundsTrees){const t=this.boundsTrees,n=this._drawInfo,r=this._drawRanges,s=this.matrixWorld;Do.material=this.material,Do.geometry=this.geometry;const o=Do.geometry.boundsTree,a=Do.geometry.drawRange;Do.geometry.boundingSphere===null&&(Do.geometry.boundingSphere=new Bi);for(let l=0,c=n.length;l<c;l++){if(!this.getVisibleAt(l))continue;const u=n[l].geometryIndex;if(Do.geometry.boundsTree=t[u],this.getMatrixAt(l,Do.matrixWorld).premultiply(s),!Do.geometry.boundsTree){this.getBoundingBoxAt(u,Do.geometry.boundingBox),this.getBoundingSphereAt(u,Do.geometry.boundingSphere);const h=r[u];Do.geometry.setDrawRange(h.start,h.count)}Do.raycast(i,w_);for(let h=0,f=w_.length;h<f;h++){const d=w_[h];d.object=this,d.batchId=l,e.push(d)}w_.length=0}Do.geometry.boundsTree=o,Do.geometry.drawRange=a,Do.material=null,Do.geometry=null}else hye.call(this,i,e)}function dye(i,e){if(this.geometry.boundsTree){if(this.material===void 0)return;hF.copy(this.matrixWorld).invert(),S_.copy(i.ray).applyMatrix4(hF),fF.setFromMatrixScale(this.matrixWorld),uF.copy(S_.direction).multiply(fF);const t=uF.length(),n=i.near/t,r=i.far/t,s=this.geometry.boundsTree;if(i.firstHitOnly===!0){const o=lF(s.raycastFirst(S_,this.material,n,r),this,i);o&&e.push(o)}else{const o=s.raycast(S_,this.material,n,r);for(let a=0,l=o.length;a<l;a++){const c=lF(o[a],this,i);c&&e.push(c)}}}else uye.call(this,i,e)}function Ij(i={}){return this.boundsTree=new P4(this,i),this.boundsTree}function Mj(){this.boundsTree=null}function pye(i){switch(i){case 1:return"R";case 2:return"RG";case 3:return"RGBA";case 4:return"RGBA"}throw new Error}function mye(i){switch(i){case 1:return hc;case 2:return Gd;case 3:return gi;case 4:return gi}}function dF(i){switch(i){case 1:return Ew;case 2:return rx;case 3:return Jm;case 4:return Jm}}class Rj extends Sa{constructor(){super(),this.minFilter=zn,this.magFilter=zn,this.generateMipmaps=!1,this.overrideItemSize=null,this._forcedType=null}updateFrom(e){const t=this.overrideItemSize,n=e.itemSize,r=e.count;if(t!==null){if(n*r%t!==0)throw new Error("VertexAttributeTexture: overrideItemSize must divide evenly into buffer length.");e.itemSize=t,e.count=r*n/t}const s=e.itemSize,o=e.count,a=e.normalized,l=e.array.constructor,c=l.BYTES_PER_ELEMENT;let u=this._forcedType,h=s;if(u===null)switch(l){case Float32Array:u=fi;break;case Uint8Array:case Uint16Array:case Uint32Array:u=Zo;break;case Int8Array:case Int16Array:case Int32Array:u=Um;break}let f,d,m,y,g=pye(s);switch(u){case fi:m=1,d=mye(s),a&&c===1?(y=l,g+="8",l===Uint8Array?f=Zi:(f=w2,g+="_SNORM")):(y=Float32Array,g+="32F",f=fi);break;case Um:g+=c*8+"I",m=a?Math.pow(2,l.BYTES_PER_ELEMENT*8-1):1,d=dF(s),c===1?(y=Int8Array,f=w2):c===2?(y=Int16Array,f=xw):(y=Int32Array,f=Um);break;case Zo:g+=c*8+"UI",m=a?Math.pow(2,l.BYTES_PER_ELEMENT*8-1):1,d=dF(s),c===1?(y=Uint8Array,f=Zi):c===2?(y=Uint16Array,f=pp):(y=Uint32Array,f=Zo);break}h===3&&(d===gi||d===Jm)&&(h=4);const A=Math.ceil(Math.sqrt(o))||1,E=h*A*A,x=new y(E),w=e.normalized;e.normalized=!1;for(let T=0;T<o;T++){const I=h*T;x[I]=e.getX(T)/m,s>=2&&(x[I+1]=e.getY(T)/m),s>=3&&(x[I+2]=e.getZ(T)/m,h===4&&(x[I+3]=1)),s>=4&&(x[I+3]=e.getW(T)/m)}e.normalized=w,this.internalFormat=g,this.format=d,this.type=f,this.image.width=A,this.image.height=A,this.image.data=x,this.needsUpdate=!0,this.dispose(),e.itemSize=n,e.count=r}}class gye extends Rj{constructor(){super(),this._forcedType=Zo}}class Aye extends Rj{constructor(){super(),this._forcedType=fi}}class Pj{constructor(){this.index=new gye,this.position=new Aye,this.bvhBounds=new Sa,this.bvhContents=new Sa,this._cachedIndexAttr=null,this.index.overrideItemSize=3}updateFrom(e){const{geometry:t}=e;if(vye(e,this.bvhBounds,this.bvhContents),this.position.updateFrom(t.attributes.position),e.indirect){const n=e._indirectBuffer;if(this._cachedIndexAttr===null||this._cachedIndexAttr.count!==n.length)if(t.index)this._cachedIndexAttr=t.index.clone();else{const r=_j(Ej(t));this._cachedIndexAttr=new mn(r,1,!1)}yye(t,n,this._cachedIndexAttr),this.index.updateFrom(this._cachedIndexAttr)}else this.index.updateFrom(t.index)}dispose(){const{index:e,position:t,bvhBounds:n,bvhContents:r}=this;e&&e.dispose(),t&&t.dispose(),n&&n.dispose(),r&&r.dispose()}}function yye(i,e,t){const n=t.array,r=i.index?i.index.array:null;for(let s=0,o=e.length;s<o;s++){const a=3*s,l=3*e[s];for(let c=0;c<3;c++)n[a+c]=r?r[l+c]:l+c}}function vye(i,e,t){const n=i._roots;if(n.length!==1)throw new Error("MeshBVHUniformStruct: Multi-root BVHs not supported.");const r=n[0],s=new Uint16Array(r),o=new Uint32Array(r),a=new Float32Array(r),l=r.byteLength/Jd,c=2*Math.ceil(Math.sqrt(l/2)),u=new Float32Array(4*c*c),h=Math.ceil(Math.sqrt(l)),f=new Uint32Array(2*h*h);for(let d=0;d<l;d++){const m=d*Jd/4,y=m*2,g=m;for(let A=0;A<3;A++)u[8*d+0+A]=a[g+0+A],u[8*d+4+A]=a[g+3+A];if(va(y,s)){const A=Il(y,s),E=el(m,o),x=4294901760|A;f[d*2+0]=x,f[d*2+1]=E}else{const A=4*Ml(m,o)/Jd,E=l8(m,o);f[d*2+0]=E,f[d*2+1]=A}}e.image.data=u,e.image.width=c,e.image.height=c,e.format=gi,e.type=fi,e.internalFormat="RGBA32F",e.minFilter=zn,e.magFilter=zn,e.generateMipmaps=!1,e.needsUpdate=!0,e.dispose(),t.image.data=f,t.image.width=h,t.image.height=h,t.format=rx,t.type=Zo,t.internalFormat="RG32UI",t.minFilter=zn,t.magFilter=zn,t.generateMipmaps=!1,t.needsUpdate=!0,t.dispose()}const xye=`

// A stack of uint32 indices can can store the indices for
// a perfectly balanced tree with a depth up to 31. Lower stack
// depth gets higher performance.
//
// However not all trees are balanced. Best value to set this to
// is the trees max depth.
#ifndef BVH_STACK_DEPTH
#define BVH_STACK_DEPTH 60
#endif

#ifndef INFINITY
#define INFINITY 1e20
#endif

// Utilities
uvec4 uTexelFetch1D( usampler2D tex, uint index ) {

	uint width = uint( textureSize( tex, 0 ).x );
	uvec2 uv;
	uv.x = index % width;
	uv.y = index / width;

	return texelFetch( tex, ivec2( uv ), 0 );

}

ivec4 iTexelFetch1D( isampler2D tex, uint index ) {

	uint width = uint( textureSize( tex, 0 ).x );
	uvec2 uv;
	uv.x = index % width;
	uv.y = index / width;

	return texelFetch( tex, ivec2( uv ), 0 );

}

vec4 texelFetch1D( sampler2D tex, uint index ) {

	uint width = uint( textureSize( tex, 0 ).x );
	uvec2 uv;
	uv.x = index % width;
	uv.y = index / width;

	return texelFetch( tex, ivec2( uv ), 0 );

}

vec4 textureSampleBarycoord( sampler2D tex, vec3 barycoord, uvec3 faceIndices ) {

	return
		barycoord.x * texelFetch1D( tex, faceIndices.x ) +
		barycoord.y * texelFetch1D( tex, faceIndices.y ) +
		barycoord.z * texelFetch1D( tex, faceIndices.z );

}

void ndcToCameraRay(
	vec2 coord, mat4 cameraWorld, mat4 invProjectionMatrix,
	out vec3 rayOrigin, out vec3 rayDirection
) {

	// get camera look direction and near plane for camera clipping
	vec4 lookDirection = cameraWorld * vec4( 0.0, 0.0, - 1.0, 0.0 );
	vec4 nearVector = invProjectionMatrix * vec4( 0.0, 0.0, - 1.0, 1.0 );
	float near = abs( nearVector.z / nearVector.w );

	// get the camera direction and position from camera matrices
	vec4 origin = cameraWorld * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec4 direction = invProjectionMatrix * vec4( coord, 0.5, 1.0 );
	direction /= direction.w;
	direction = cameraWorld * direction - origin;

	// slide the origin along the ray until it sits at the near clip plane position
	origin.xyz += direction.xyz * near / dot( direction, lookDirection );

	rayOrigin = origin.xyz;
	rayDirection = direction.xyz;

}
`,Eye=`

#ifndef TRI_INTERSECT_EPSILON
#define TRI_INTERSECT_EPSILON 1e-5
#endif

// Raycasting
bool intersectsBounds( vec3 rayOrigin, vec3 rayDirection, vec3 boundsMin, vec3 boundsMax, out float dist ) {

	// https://www.reddit.com/r/opengl/comments/8ntzz5/fast_glsl_ray_box_intersection/
	// https://tavianator.com/2011/ray_box.html
	vec3 invDir = 1.0 / rayDirection;

	// find intersection distances for each plane
	vec3 tMinPlane = invDir * ( boundsMin - rayOrigin );
	vec3 tMaxPlane = invDir * ( boundsMax - rayOrigin );

	// get the min and max distances from each intersection
	vec3 tMinHit = min( tMaxPlane, tMinPlane );
	vec3 tMaxHit = max( tMaxPlane, tMinPlane );

	// get the furthest hit distance
	vec2 t = max( tMinHit.xx, tMinHit.yz );
	float t0 = max( t.x, t.y );

	// get the minimum hit distance
	t = min( tMaxHit.xx, tMaxHit.yz );
	float t1 = min( t.x, t.y );

	// set distance to 0.0 if the ray starts inside the box
	dist = max( t0, 0.0 );

	return t1 >= dist;

}

bool intersectsTriangle(
	vec3 rayOrigin, vec3 rayDirection, vec3 a, vec3 b, vec3 c,
	out vec3 barycoord, out vec3 norm, out float dist, out float side
) {

	// https://stackoverflow.com/questions/42740765/intersection-between-line-and-triangle-in-3d
	vec3 edge1 = b - a;
	vec3 edge2 = c - a;
	norm = cross( edge1, edge2 );

	float det = - dot( rayDirection, norm );
	float invdet = 1.0 / det;

	vec3 AO = rayOrigin - a;
	vec3 DAO = cross( AO, rayDirection );

	vec4 uvt;
	uvt.x = dot( edge2, DAO ) * invdet;
	uvt.y = - dot( edge1, DAO ) * invdet;
	uvt.z = dot( AO, norm ) * invdet;
	uvt.w = 1.0 - uvt.x - uvt.y;

	// set the hit information
	barycoord = uvt.wxy; // arranged in A, B, C order
	dist = uvt.z;
	side = sign( det );
	norm = side * normalize( norm );

	// add an epsilon to avoid misses between triangles
	uvt += vec4( TRI_INTERSECT_EPSILON );

	return all( greaterThanEqual( uvt, vec4( 0.0 ) ) );

}

bool intersectTriangles(
	// geometry info and triangle range
	sampler2D positionAttr, usampler2D indexAttr, uint offset, uint count,

	// ray
	vec3 rayOrigin, vec3 rayDirection,

	// outputs
	inout float minDistance, inout uvec4 faceIndices, inout vec3 faceNormal, inout vec3 barycoord,
	inout float side, inout float dist
) {

	bool found = false;
	vec3 localBarycoord, localNormal;
	float localDist, localSide;
	for ( uint i = offset, l = offset + count; i < l; i ++ ) {

		uvec3 indices = uTexelFetch1D( indexAttr, i ).xyz;
		vec3 a = texelFetch1D( positionAttr, indices.x ).rgb;
		vec3 b = texelFetch1D( positionAttr, indices.y ).rgb;
		vec3 c = texelFetch1D( positionAttr, indices.z ).rgb;

		if (
			intersectsTriangle( rayOrigin, rayDirection, a, b, c, localBarycoord, localNormal, localDist, localSide )
			&& localDist < minDistance
		) {

			found = true;
			minDistance = localDist;

			faceIndices = uvec4( indices.xyz, i );
			faceNormal = localNormal;

			side = localSide;
			barycoord = localBarycoord;
			dist = localDist;

		}

	}

	return found;

}

bool intersectsBVHNodeBounds( vec3 rayOrigin, vec3 rayDirection, sampler2D bvhBounds, uint currNodeIndex, out float dist ) {

	uint cni2 = currNodeIndex * 2u;
	vec3 boundsMin = texelFetch1D( bvhBounds, cni2 ).xyz;
	vec3 boundsMax = texelFetch1D( bvhBounds, cni2 + 1u ).xyz;
	return intersectsBounds( rayOrigin, rayDirection, boundsMin, boundsMax, dist );

}

// use a macro to hide the fact that we need to expand the struct into separate fields
#define	bvhIntersectFirstHit(		bvh,		rayOrigin, rayDirection, faceIndices, faceNormal, barycoord, side, dist	)	_bvhIntersectFirstHit(		bvh.position, bvh.index, bvh.bvhBounds, bvh.bvhContents,		rayOrigin, rayDirection, faceIndices, faceNormal, barycoord, side, dist	)

bool _bvhIntersectFirstHit(
	// bvh info
	sampler2D bvh_position, usampler2D bvh_index, sampler2D bvh_bvhBounds, usampler2D bvh_bvhContents,

	// ray
	vec3 rayOrigin, vec3 rayDirection,

	// output variables split into separate variables due to output precision
	inout uvec4 faceIndices, inout vec3 faceNormal, inout vec3 barycoord,
	inout float side, inout float dist
) {

	// stack needs to be twice as long as the deepest tree we expect because
	// we push both the left and right child onto the stack every traversal
	int ptr = 0;
	uint stack[ BVH_STACK_DEPTH ];
	stack[ 0 ] = 0u;

	float triangleDistance = INFINITY;
	bool found = false;
	while ( ptr > - 1 && ptr < BVH_STACK_DEPTH ) {

		uint currNodeIndex = stack[ ptr ];
		ptr --;

		// check if we intersect the current bounds
		float boundsHitDistance;
		if (
			! intersectsBVHNodeBounds( rayOrigin, rayDirection, bvh_bvhBounds, currNodeIndex, boundsHitDistance )
			|| boundsHitDistance > triangleDistance
		) {

			continue;

		}

		uvec2 boundsInfo = uTexelFetch1D( bvh_bvhContents, currNodeIndex ).xy;
		bool isLeaf = bool( boundsInfo.x & 0xffff0000u );

		if ( isLeaf ) {

			uint count = boundsInfo.x & 0x0000ffffu;
			uint offset = boundsInfo.y;

			found = intersectTriangles(
				bvh_position, bvh_index, offset, count,
				rayOrigin, rayDirection, triangleDistance,
				faceIndices, faceNormal, barycoord, side, dist
			) || found;

		} else {

			uint leftIndex = currNodeIndex + 1u;
			uint splitAxis = boundsInfo.x & 0x0000ffffu;
			uint rightIndex = boundsInfo.y;

			bool leftToRight = rayDirection[ splitAxis ] >= 0.0;
			uint c1 = leftToRight ? leftIndex : rightIndex;
			uint c2 = leftToRight ? rightIndex : leftIndex;

			// set c2 in the stack so we traverse it later. We need to keep track of a pointer in
			// the stack while we traverse. The second pointer added is the one that will be
			// traversed first
			ptr ++;
			stack[ ptr ] = c2;

			ptr ++;
			stack[ ptr ] = c1;

		}

	}

	return found;

}
`,_ye=`
struct BVH {

	usampler2D index;
	sampler2D position;

	sampler2D bvhBounds;
	usampler2D bvhContents;

};
`,Sye=_ye,wye=`
	${xye}
	${Eye}
`,pF=i=>i.isMesh;function Cye(i,e){e={strategy:I4,verbose:!1,setBoundingBox:!0,maxDepth:40,maxLeafTris:10,indirect:!1,...e},C.useEffect(()=>{if(i.current){i.current.raycast=bj;const t=i.current.geometry;return t.computeBoundsTree=Ij,t.disposeBoundsTree=Mj,t.computeBoundsTree(e),()=>{t.boundsTree&&t.disposeBoundsTree()}}},[i,JSON.stringify(e)])}const Tye=C.forwardRef(({enabled:i=!0,firstHitOnly:e=!1,children:t,strategy:n=I4,verbose:r=!1,setBoundingBox:s=!0,maxDepth:o=40,maxLeafTris:a=10,indirect:l=!1,...c},u)=>{const h=C.useRef(null),f=Ve(d=>d.raycaster);return C.useImperativeHandle(u,()=>h.current,[]),C.useEffect(()=>{if(i){const d={strategy:n,verbose:r,setBoundingBox:s,maxDepth:o,maxLeafTris:a,indirect:l},m=h.current;return f.firstHitOnly=e,m.traverse(y=>{pF(y)&&!y.geometry.boundsTree&&y.raycast===It.prototype.raycast&&(y.raycast=bj,y.geometry.computeBoundsTree=Ij,y.geometry.disposeBoundsTree=Mj,y.geometry.computeBoundsTree(d))}),()=>{delete f.firstHitOnly,m.traverse(y=>{pF(y)&&y.geometry.boundsTree&&(y.geometry.disposeBoundsTree(),y.raycast=It.prototype.raycast)})}}},[]),C.createElement("group",ot({ref:h},c),t)});function bye(...i){const e=C.useRef([]);return e.current=i.map(t=>C.useContext(t)),C.useMemo(()=>({children:t})=>i.reduceRight((n,r,s)=>C.createElement(r.Provider,{value:e.current[s],children:n}),t),[])}function Iye(i,e){const t=C.useRef(),[n]=C.useState(()=>e?e instanceof _n?{current:e}:e:t),[r]=C.useState(()=>new tR(void 0));C.useLayoutEffect(()=>{e&&(n.current=e instanceof _n?e:e.current),r._root=n.current});const s=C.useRef({}),o=C.useMemo(()=>{const a={};return i.forEach(l=>Object.defineProperty(a,l.name,{enumerable:!0,get(){if(n.current)return s.current[l.name]||(s.current[l.name]=r.clipAction(l,n.current))},configurable:!0})),{ref:n,clips:i,actions:a,names:i.map(l=>l.name),mixer:r}},[i]);return Kt((a,l)=>r.update(l)),C.useEffect(()=>{const a=n.current;return()=>{s.current={},r.stopAllAction(),Object.values(o.actions).forEach(l=>{a&&r.uncacheAction(l,a)})}},[i]),o}function Lj(i){const e=C.useRef(null),t=C.useRef(!1),n=C.useRef(!1),r=C.useRef(i);return C.useLayoutEffect(()=>void(r.current=i),[i]),C.useEffect(()=>{const s=e.current;if(s){const o=Jw(()=>(t.current=!1,!0)),a=s.onBeforeRender;s.onBeforeRender=()=>t.current=!0;const l=Zw(()=>(t.current!==n.current&&(r.current==null||r.current(n.current=t.current)),!0));return()=>{s.onBeforeRender=a,o(),l()}}},[]),e}const Mye=`
#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )
  vec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );
  #ifdef BOX_PROJECTED_ENV_MAP
    vWorldPosition = worldPosition.xyz;
  #endif
#endif
`,Rye=`
#ifdef BOX_PROJECTED_ENV_MAP
  uniform vec3 envMapSize;
  uniform vec3 envMapPosition;
  varying vec3 vWorldPosition;
    
  vec3 parallaxCorrectNormal( vec3 v, vec3 cubeSize, vec3 cubePos ) {
    vec3 nDir = normalize( v );
    vec3 rbmax = ( .5 * cubeSize + cubePos - vWorldPosition ) / nDir;
    vec3 rbmin = ( -.5 * cubeSize + cubePos - vWorldPosition ) / nDir;
    vec3 rbminmax;
    rbminmax.x = ( nDir.x > 0. ) ? rbmax.x : rbmin.x;
    rbminmax.y = ( nDir.y > 0. ) ? rbmax.y : rbmin.y;
    rbminmax.z = ( nDir.z > 0. ) ? rbmax.z : rbmin.z;
    float correction = min( min( rbminmax.x, rbminmax.y ), rbminmax.z );
    vec3 boxIntersection = vWorldPosition + nDir * correction;    
    return boxIntersection - cubePos;
  }
#endif
`,Pye=`
#ifdef BOX_PROJECTED_ENV_MAP
  worldNormal = parallaxCorrectNormal( worldNormal, envMapSize, envMapPosition );
#endif
`,Lye=`
#ifdef BOX_PROJECTED_ENV_MAP
  reflectVec = parallaxCorrectNormal( reflectVec, envMapSize, envMapPosition );
#endif
`;function Bye(i,e,t){i.defines.BOX_PROJECTED_ENV_MAP=!0,i.uniforms.envMapPosition={value:e},i.uniforms.envMapSize={value:t},i.vertexShader=`
  varying vec3 vWorldPosition;
  ${i.vertexShader.replace("#include <worldpos_vertex>",Mye)}`,i.fragmentShader=`
    ${Rye}
    ${i.fragmentShader.replace("#include <envmap_physical_pars_fragment>",Un.envmap_physical_pars_fragment).replace("vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );",`vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
         ${Pye}
         `).replace("reflectVec = inverseTransformDirection( reflectVec, viewMatrix );",`reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
         ${Lye}
        `)}`}function Dye(i=new Q,e=new Q){const[t]=C.useState(()=>({position:new Q,size:new Q}));Os(t,{position:i,size:e});const n=C.useRef(null),r=C.useMemo(()=>({ref:n,onBeforeCompile:s=>Bye(s,t.position,t.size),customProgramCacheKey:()=>JSON.stringify(t.position.toArray())+JSON.stringify(t.size.toArray())}),[...t.position.toArray(),...t.size.toArray()]);return C.useLayoutEffect(()=>void(n.current.needsUpdate=!0),[t]),r}const mF=new ti,C_=new Q,kye=({anchor:i,...e})=>{const t=C.useRef(null),n=C.useRef(null);return C.useEffect(()=>{var r;(r=t.current)!=null&&(r=r.parent)!=null&&r.parent&&(n.current=t.current.parent,t.current.parent.parent.add(t.current))},[]),Kt(()=>{n.current&&(mF.setFromObject(n.current),mF.getSize(C_),t.current.position.set(n.current.position.x+C_.x*(Array.isArray(i)?i[0]:i.x)/2,n.current.position.y+C_.y*(Array.isArray(i)?i[1]:i.y)/2,n.current.position.z+C_.z*(Array.isArray(i)?i[2]:i.z)/2))}),C.createElement("group",ot({ref:t},e))};function Fye(i,e,t=.9){return e*t+i*(1-t)}const Oye=i=>Math.sqrt(1-Math.pow(i-1,2));class Nye{constructor({size:e=256,maxAge:t=750,radius:n=.3,intensity:r=.2,interpolate:s=0,smoothing:o=0,minForce:a=.3,blend:l="screen",ease:c=Oye}={}){this.size=e,this.maxAge=t,this.radius=n,this.intensity=r,this.ease=c,this.interpolate=s,this.smoothing=o,this.minForce=a,this.blend=l,this.trail=[],this.force=0,this.initTexture()}initTexture(){this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=this.size;const e=this.canvas.getContext("2d");if(e===null)throw new Error("2D not available");this.ctx=e,this.ctx.fillStyle="black",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.texture=new vi(this.canvas),this.canvas.id="touchTexture",this.canvas.style.width=this.canvas.style.height=`${this.canvas.width}px`}update(e){this.clear(),this.trail.forEach((t,n)=>{t.age+=e*1e3,t.age>this.maxAge&&this.trail.splice(n,1)}),this.trail.length||(this.force=0),this.trail.forEach(t=>{this.drawTouch(t)}),this.texture.needsUpdate=!0}clear(){this.ctx.globalCompositeOperation="source-over",this.ctx.fillStyle="black",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height)}addTouch(e){const t=this.trail[this.trail.length-1];if(t){const n=t.x-e.x,r=t.y-e.y,s=n*n+r*r,o=Math.max(this.minForce,Math.min(s*1e4,1));if(this.force=Fye(o,this.force,this.smoothing),this.interpolate){const a=Math.ceil(s/Math.pow(this.radius*.5/this.interpolate,2));if(a>1)for(let l=1;l<a;l++)this.trail.push({x:t.x-n/a*l,y:t.y-r/a*l,age:0,force:o})}}this.trail.push({x:e.x,y:e.y,age:0,force:this.force})}drawTouch(e){const t={x:e.x*this.size,y:(1-e.y)*this.size};let n=1;e.age<this.maxAge*.3?n=this.ease(e.age/(this.maxAge*.3)):n=this.ease(1-(e.age-this.maxAge*.3)/(this.maxAge*.7)),n*=e.force,this.ctx.globalCompositeOperation=this.blend;const r=this.size*this.radius*n,s=this.ctx.createRadialGradient(t.x,t.y,Math.max(0,r*.25),t.x,t.y,Math.max(0,r));s.addColorStop(0,`rgba(255, 255, 255, ${this.intensity})`),s.addColorStop(1,"rgba(0, 0, 0, 0.0)"),this.ctx.beginPath(),this.ctx.fillStyle=s,this.ctx.arc(t.x,t.y,Math.max(0,r),0,Math.PI*2),this.ctx.fill()}}function Bj(i={}){const{size:e,maxAge:t,radius:n,intensity:r,interpolate:s,smoothing:o,minForce:a,blend:l,ease:c}=i,u=C.useMemo(()=>new Nye(i),[e,t,n,r,s,o,a,l,c]);Kt((f,d)=>void u.update(d));const h=C.useCallback(f=>u.addTouch(f.uv),[u]);return[u.texture,h]}const Uye=({children:i,...e})=>{const t=Bj(e);return C.createElement(C.Fragment,null,i==null?void 0:i(t))},h8=C.forwardRef(function({children:e,disable:t,disableX:n,disableY:r,disableZ:s,left:o,right:a,top:l,bottom:c,front:u,back:h,onCentered:f,precise:d=!0,cacheKey:m=0,...y},g){const A=C.useRef(null),E=C.useRef(null),x=C.useRef(null);return C.useLayoutEffect(()=>{E.current.matrixWorld.identity();const w=new ti().setFromObject(x.current,d),T=new Q,I=new Bi,M=w.max.x-w.min.x,L=w.max.y-w.min.y,P=w.max.z-w.min.z;w.getCenter(T),w.getBoundingSphere(I);const R=l?L/2:c?-L/2:0,U=o?-M/2:a?M/2:0,k=u?P/2:h?-P/2:0;E.current.position.set(t||n?0:-T.x+U,t||r?0:-T.y+R,t||s?0:-T.z+k),typeof f<"u"&&f({parent:A.current.parent,container:A.current,width:M,height:L,depth:P,boundingBox:w,boundingSphere:I,center:T,verticalAlignment:R,horizontalAlignment:U,depthAlignment:k})},[m,f,l,o,u,t,n,r,s,d,a,c,h]),C.useImperativeHandle(g,()=>A.current,[]),C.createElement("group",ot({ref:A},y),C.createElement("group",{ref:E},C.createElement("group",{ref:x},e)))}),zye=C.forwardRef(({font:i,color:e="#cbcbcb",bevelSize:t=.04,debug:n=!1,children:r,...s},o)=>{const[a,l]=C.useState(0),c=C.useCallback((f=1)=>l(a+f),[a]),u=C.useCallback((f=1)=>l(a-f),[a]),h=C.useMemo(()=>({incr:c,decr:u}),[c,u]);return C.useImperativeHandle(o,()=>h,[h]),C.createElement("group",s,C.createElement(C.Suspense,{fallback:null},C.createElement(h8,{top:!0,cacheKey:JSON.stringify({counter:a,font:i})},C.createElement(lQ,{bevelEnabled:!0,bevelSize:t,font:i},n?C.createElement("meshNormalMaterial",{wireframe:!0}):C.createElement("meshStandardMaterial",{color:e}),a))),r)});var gI={exports:{}},AI,gF;function Gye(){if(gF)return AI;gF=1;var i="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return AI=i,AI}var yI,AF;function Hye(){if(AF)return yI;AF=1;var i=Gye();function e(){}function t(){}return t.resetWarningCache=e,yI=function(){function n(o,a,l,c,u,h){if(h!==i){var f=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw f.name="Invariant Violation",f}}n.isRequired=n;function r(){return n}var s={array:n,bigint:n,bool:n,func:n,number:n,object:n,string:n,symbol:n,any:n,arrayOf:r,element:n,elementType:n,instanceOf:r,node:n,objectOf:r,oneOf:r,oneOfType:r,shape:r,exact:r,checkPropTypes:t,resetWarningCache:e};return s.PropTypes=s,s},yI}var yF;function Qye(){return yF||(yF=1,gI.exports=Hye()()),gI.exports}var Vye=Qye();const Cv=EA(Vye);function Dj(i){return kj(i.children,i.components)}Dj.propTypes={children:Cv.func.isRequired,components:Cv.arrayOf(Cv.oneOfType([Cv.element,Cv.func])).isRequired};function kj(i,e,t){if(t=t||[],!e[0])return i(t);function n(r){return kj(i,e.slice(1),t.concat([r]))}return typeof e[0]=="function"?e[0]({results:t,render:n}):C.cloneElement(e[0],{children:n})}const m2=(i,e)=>{"updateRanges"in i?i.updateRanges[0]=e:i.updateRange=e},jye=3e3,Wye=3001;function Kye(i){return typeof i=="function"}const vF=new Xe,xF=new Xe,T_=[],Tv=new It;class Fj extends xa{constructor(){super(),this.color=new ut("white"),this.instance={current:void 0},this.instanceKey={current:void 0}}get geometry(){var e;return(e=this.instance.current)==null?void 0:e.geometry}raycast(e,t){const n=this.instance.current;if(!n||!n.geometry||!n.material)return;Tv.geometry=n.geometry;const r=n.matrixWorld,s=n.userData.instances.indexOf(this.instanceKey);if(!(s===-1||s>n.count)){n.getMatrixAt(s,vF),xF.multiplyMatrices(r,vF),Tv.matrixWorld=xF,n.material instanceof Us?Tv.material.side=n.material.side:Tv.material.side=n.material[0].side,Tv.raycast(e,T_);for(let o=0,a=T_.length;o<a;o++){const l=T_[o];l.instanceId=s,l.object=this,t.push(l)}T_.length=0}}}const Oj=C.createContext(null),EF=new Xe,_F=new Xe,Yye=new Xe,SF=new Q,wF=new Xt,CF=new Q,$ye=i=>i.isInstancedBufferAttribute,L4=C.forwardRef(({context:i,children:e,...t},n)=>{C.useMemo(()=>Or({PositionMesh:Fj}),[]);const r=C.useRef();C.useImperativeHandle(n,()=>r.current,[]);const{subscribe:s,getParent:o}=C.useContext(i||Oj);return C.useLayoutEffect(()=>s(r),[]),C.createElement("positionMesh",ot({instance:o(),instanceKey:r,ref:r},t),e)}),B4=C.forwardRef(({context:i,children:e,range:t,limit:n=1e3,frames:r=1/0,...s},o)=>{const[{localContext:a,instance:l}]=C.useState(()=>{const E=C.createContext(null);return{localContext:E,instance:C.forwardRef((x,w)=>C.createElement(L4,ot({context:E},x,{ref:w})))}}),c=C.useRef(null);C.useImperativeHandle(o,()=>c.current,[]);const[u,h]=C.useState([]),[[f,d]]=C.useState(()=>{const E=new Float32Array(n*16);for(let x=0;x<n;x++)Yye.identity().toArray(E,x*16);return[E,new Float32Array([...new Array(n*3)].map(()=>1))]});C.useEffect(()=>{c.current.instanceMatrix.needsUpdate=!0});let m=0,y=0;const g=C.useRef([]);C.useLayoutEffect(()=>{g.current=Object.entries(c.current.geometry.attributes).filter(([E,x])=>$ye(x))}),Kt(()=>{if(r===1/0||m<r){c.current.updateMatrix(),c.current.updateMatrixWorld(),EF.copy(c.current.matrixWorld).invert(),y=Math.min(n,t!==void 0?t:n,u.length),c.current.count=y,m2(c.current.instanceMatrix,{offset:0,count:y*16}),m2(c.current.instanceColor,{offset:0,count:y*3});for(let E=0;E<u.length;E++){const x=u[E].current;x.matrixWorld.decompose(SF,wF,CF),_F.compose(SF,wF,CF).premultiply(EF),_F.toArray(f,E*16),c.current.instanceMatrix.needsUpdate=!0,x.color.toArray(d,E*3),c.current.instanceColor.needsUpdate=!0}m++}});const A=C.useMemo(()=>({getParent:()=>c,subscribe:E=>(h(x=>[...x,E]),()=>h(x=>x.filter(w=>w.current!==E.current)))}),[]);return C.createElement("instancedMesh",ot({userData:{instances:u,limit:n,frames:r},matrixAutoUpdate:!1,ref:c,args:[null,null,0],raycast:()=>null},s),C.createElement("instancedBufferAttribute",{attach:"instanceMatrix",count:f.length/16,array:f,itemSize:16,usage:No}),C.createElement("instancedBufferAttribute",{attach:"instanceColor",count:d.length/3,array:d,itemSize:3,usage:No}),Kye(e)?C.createElement(a.Provider,{value:A},e(l)):i?C.createElement(i.Provider,{value:A},e):C.createElement(Oj.Provider,{value:A},e))}),Xye=C.forwardRef(function({meshes:e,children:t,...n},r){const s=Array.isArray(e);if(!s)for(const o of Object.keys(e))e[o].isMesh||delete e[o];return C.createElement("group",{ref:r},C.createElement(Dj,{components:(s?e:Object.values(e)).map(({geometry:o,material:a})=>C.createElement(B4,ot({key:o.uuid,geometry:o,material:a},n)))},o=>s?t(...o):t(Object.keys(e).filter(a=>e[a].isMesh).reduce((a,l,c)=>({...a,[l]:o[c]}),{}))))});function qye(){const i=C.createContext(null);return[C.forwardRef((e,t)=>C.createElement(B4,ot({ref:t,context:i},e))),C.forwardRef((e,t)=>C.createElement(L4,ot({ref:t,context:i},e)))]}const Jye=C.forwardRef(({name:i,defaultValue:e,normalized:t,usage:n=No},r)=>{const s=C.useRef(null);C.useImperativeHandle(r,()=>s.current,[]),C.useLayoutEffect(()=>{const a=s.current.__r3f.parent;a.geometry.attributes[i]=s.current;const l=Array.isArray(e)?e:[e],c=Array.from({length:a.userData.limit},()=>l).flat();return s.current.array=new Float32Array(c),s.current.itemSize=l.length,s.current.count=c.length/s.current.itemSize,()=>{delete a.geometry.attributes[i]}},[i]);let o=0;return Kt(()=>{const a=s.current.__r3f.parent;if(a.userData.frames===1/0||o<a.userData.frames){for(let l=0;l<a.userData.instances.length;l++){const u=a.userData.instances[l].current[i];u!==void 0&&(s.current.set(Array.isArray(u)?u:typeof u.toArray=="function"?u.toArray():[u],l*s.current.itemSize),s.current.needsUpdate=!0)}o++}}),C.createElement("instancedBufferAttribute",{ref:s,usage:n,normalized:t})}),Nj=C.createContext(null);function Zye(){return C.useContext(Nj)}function eve(i){return i!==null&&"meta"in i&&"frames"in i}const TF=new Fs(1,1),tve=C.forwardRef(({startFrame:i=0,endFrame:e,fps:t=30,frameName:n="",textureDataURL:r,textureImageURL:s,loop:o=!1,numberOfFrames:a=1,autoPlay:l=!0,animationNames:c,onStart:u,onEnd:h,onLoopEnd:f,onFrame:d,play:m,pause:y=!1,flipX:g=!1,alphaTest:A=0,children:E,asSprite:x=!1,offset:w,playBackwards:T=!1,resetOnEnd:I=!1,maxItems:M=1,instanceItems:L=[[0,0,0]],spriteDataset:P,canvasRenderingContext2DSettings:R,roundFramePosition:U=!1,meshProps:k={},...H},G)=>{const X=C.useRef(new xa),Z=C.useRef(null),oe=C.useRef(null),K=C.useRef(null),V=C.useRef(window.performance.now()),W=C.useRef(i),F=C.useRef(n),Y=t>0?1e3/t:0,[te,q]=C.useState(new vi),J=C.useRef(0),[re,ie]=C.useState(new Q(1,1,1)),se=g?-1:1,ge=C.useRef(y),xe=C.useRef(w),pe=C.useRef(!1),{spriteObj:ue,loadJsonAndTexture:Me}=b4(null,null,c,a,void 0,R),Se=C.useRef(n),ve=C.useCallback((Re,Le)=>{if(Le===null)a&&(J.current=a,T&&(W.current=a-1),Z.current=Le);else{var Fe,He;Z.current=Le,Z.current&&Array.isArray(Z.current.frames)?J.current=Z.current.frames.length:Z.current&&typeof Z.current=="object"&&Se.current?J.current=Z.current.frames[Se.current].length:J.current=0,T&&(W.current=J.current-1);const{w:it,h:Ye}=d2((Fe=(He=Z.current)==null?void 0:He.frames)!==null&&Fe!==void 0?Fe:[],Se.current).sourceSize,ct=be(it,Ye);ie(ct),oe.current&&(oe.current.map=Re)}q(Re)},[a,T]),Ae=C.useCallback(()=>{if(!Z.current)return;const{meta:{size:Re},frames:Le}=Z.current,{w:Fe,h:He}=Array.isArray(Le)?Le[0].sourceSize:n?Le[n]?Le[n][0].sourceSize:{w:0,h:0}:{w:0,h:0};oe.current&&oe.current.map&&(oe.current.map.wrapS=oe.current.map.wrapT=_o,oe.current.map.center.set(0,0),oe.current.map.repeat.set(1*se/(Re.w/Fe),1/(Re.h/He)));const Ye=1/((Re.h-1)/He);oe.current&&oe.current.map&&(oe.current.map.offset.x=0,oe.current.map.offset.y=1-Ye),u&&u({currentFrameName:n??"",currentFrame:W.current})},[se,n,u]),ke=C.useMemo(()=>({current:xe.current,offset:xe.current,imageUrl:s,hasEnded:!1,ref:G}),[s,G]);C.useImperativeHandle(G,()=>X.current,[]),C.useLayoutEffect(()=>{xe.current=w},[w]);const be=(Re,Le)=>{var Fe;const He=new Q,it=Le/Re;return He.set(1,it,1),(Fe=K.current)==null||Fe.scale.copy(He),He};C.useEffect(()=>{if(P){var Re;ve(P==null||(Re=P.spriteTexture)==null?void 0:Re.clone(),P.spriteData)}else s&&r&&Me(s,r)},[Me,P,r,s,ve]),C.useEffect(()=>{if(ue){var Re;ve(ue==null||(Re=ue.spriteTexture)==null?void 0:Re.clone(),ue==null?void 0:ue.spriteData)}},[ue,ve]),C.useEffect(()=>{if(ke.hasEnded=!1,Z.current&&T===!0){var Re;W.current=((Re=Z.current.frames.length)!==null&&Re!==void 0?Re:0)-1}else W.current=0},[T,ke]),C.useLayoutEffect(()=>{Ae()},[te,g,Ae]),C.useEffect(()=>{l&&(ge.current=!1)},[l]),C.useLayoutEffect(()=>{if(F.current!==n&&n&&(W.current=0,F.current=n,ke.hasEnded=!1,Y<=0&&(W.current=e||i||0),Z.current)){const{w:Re,h:Le}=d2(Z.current.frames,n).sourceSize,Fe=be(Re,Le);ie(Fe)}},[n,Y,ke,e,i]);const ne=()=>{if(!eve(Z.current))return;const{meta:{size:Re},frames:Le}=Z.current,{w:Fe,h:He}=d2(Le,n).sourceSize,it=Array.isArray(Le)?Le:n?Le[n]:[],Ye=e||it.length-1;var ct=w===void 0?ke.current:w;if(Y<=0){W.current=e||i||0,j(Fe,He,Re,it);return}const pt=window.performance.now(),je=pt-V.current;if(!(je<=Y)){var Mt=T?W.current<0:W.current>Ye,Ft=T?W.current===Ye:W.current===0,St=T?W.current<0:W.current>=Ye;if(Mt){if(W.current=o?i??0:0,T&&(W.current=Ye),o?f==null||f({currentFrameName:n??"",currentFrame:W.current}):(h==null||h({currentFrameName:n??"",currentFrame:W.current}),ke.hasEnded=!I,I&&(ge.current=!0)),!o)return}else Ft&&(u==null||u({currentFrameName:n??"",currentFrame:W.current}));ct!==void 0&&St?pe.current===!1&&(h==null||h({currentFrameName:n??"",currentFrame:W.current}),pe.current=!0):pe.current=!1,!(je<=Y)&&(V.current=pt-je%Y,j(Fe,He,Re,it))}},j=(Re,Le,Fe,He)=>{var it=w===void 0?ke.current:w;const Ye=W.current;let ct=0,pt=0;be(Re,Le);const je=U?Math.round((Fe.w-1)/Re):(Fe.w-1)/Re,Mt=U?Math.round((Fe.h-1)/Le):(Fe.h-1)/Le;if(!He[Ye])return;const{frame:{x:Ft,y:St},sourceSize:{w:gt,h:ft}}=He[Ye],Ce=1/je,qe=1/Mt;if(oe.current&&oe.current.map&&(ct=se>0?Ce*(Ft/gt):Ce*(Ft/gt)-oe.current.map.repeat.x,pt=Math.abs(1-qe)-qe*(St/ft),oe.current.map.offset.x=ct,oe.current.map.offset.y=pt),it!=null){let At=Math.floor(it*He.length);At=Math.max(0,Math.min(At,He.length-1)),isNaN(At)&&(At=0),W.current=At}else T?W.current-=1:W.current+=1};Kt((Re,Le)=>{var Fe,He;!((Fe=Z.current)!=null&&Fe.frames)||!((He=oe.current)!=null&&He.map)||ge.current||!ke.hasEnded&&(l||m)&&(ne(),d==null||d({currentFrameName:F.current,currentFrame:W.current}))});function de(Re=new Q(1,1,1),Le=1){if(typeof Le=="number")return Re.multiplyScalar(Le);if(Array.isArray(Le))return Re.multiply(new Q(...Le));if(Le instanceof Q)return Re.multiply(Le)}return C.createElement("group",ot({},H,{ref:X,scale:de(re,H.scale)}),C.createElement(Nj.Provider,{value:ke},x&&C.createElement(KH,null,C.createElement("mesh",ot({ref:K,scale:1,geometry:TF},k),C.createElement("meshBasicMaterial",{premultipliedAlpha:!1,toneMapped:!1,side:Li,ref:oe,map:te,transparent:!0,alphaTest:A??0}))),!x&&C.createElement(B4,ot({geometry:TF,limit:M??1},k),C.createElement("meshBasicMaterial",{premultipliedAlpha:!1,toneMapped:!1,side:Li,ref:oe,map:te,transparent:!0,alphaTest:A??0}),(L??[0]).map((Re,Le)=>C.createElement(L4,ot({key:Le,ref:(L==null?void 0:L.length)===1?K:null,position:Re,scale:1},k)))),E))}),nve=C.forwardRef(({children:i,curve:e},t)=>{const[n]=C.useState(()=>new Mu),[r,s]=C.useState(),o=C.useRef(null);return C.useLayoutEffect(()=>{o.current=new cle(n.children[0]),s(o.current.object3D)},[i]),C.useEffect(()=>{var a;e&&((a=o.current)==null||a.updateCurve(0,e))},[e]),C.useImperativeHandle(t,()=>o.current),C.createElement(C.Fragment,null,vp(i,n),r&&C.createElement("primitive",{object:r}))});var ive=`#define GLSLIFY 1
vec3 mod289(vec3 x){return x-floor(x*(1.0/289.0))*289.0;}vec4 mod289(vec4 x){return x-floor(x*(1.0/289.0))*289.0;}vec4 permute(vec4 x){return mod289(((x*34.0)+1.0)*x);}vec4 taylorInvSqrt(vec4 r){return 1.79284291400159-0.85373472095314*r;}float snoise(vec3 v){const vec2 C=vec2(1.0/6.0,1.0/3.0);const vec4 D=vec4(0.0,0.5,1.0,2.0);vec3 i=floor(v+dot(v,C.yyy));vec3 x0=v-i+dot(i,C.xxx);vec3 g=step(x0.yzx,x0.xyz);vec3 l=1.0-g;vec3 i1=min(g.xyz,l.zxy);vec3 i2=max(g.xyz,l.zxy);vec3 x1=x0-i1+C.xxx;vec3 x2=x0-i2+C.yyy;vec3 x3=x0-D.yyy;i=mod289(i);vec4 p=permute(permute(permute(i.z+vec4(0.0,i1.z,i2.z,1.0))+i.y+vec4(0.0,i1.y,i2.y,1.0))+i.x+vec4(0.0,i1.x,i2.x,1.0));float n_=0.142857142857;vec3 ns=n_*D.wyz-D.xzx;vec4 j=p-49.0*floor(p*ns.z*ns.z);vec4 x_=floor(j*ns.z);vec4 y_=floor(j-7.0*x_);vec4 x=x_*ns.x+ns.yyyy;vec4 y=y_*ns.x+ns.yyyy;vec4 h=1.0-abs(x)-abs(y);vec4 b0=vec4(x.xy,y.xy);vec4 b1=vec4(x.zw,y.zw);vec4 s0=floor(b0)*2.0+1.0;vec4 s1=floor(b1)*2.0+1.0;vec4 sh=-step(h,vec4(0.0));vec4 a0=b0.xzyw+s0.xzyw*sh.xxyy;vec4 a1=b1.xzyw+s1.xzyw*sh.zzww;vec3 p0=vec3(a0.xy,h.x);vec3 p1=vec3(a0.zw,h.y);vec3 p2=vec3(a1.xy,h.z);vec3 p3=vec3(a1.zw,h.w);vec4 norm=taylorInvSqrt(vec4(dot(p0,p0),dot(p1,p1),dot(p2,p2),dot(p3,p3)));p0*=norm.x;p1*=norm.y;p2*=norm.z;p3*=norm.w;vec4 m=max(0.6-vec4(dot(x0,x0),dot(x1,x1),dot(x2,x2),dot(x3,x3)),0.0);m=m*m;return 42.0*dot(m*m,vec4(dot(p0,x0),dot(p1,x1),dot(p2,x2),dot(p3,x3)));}`;class rve extends nl{constructor(e={}){super(e),this.setValues(e),this._time={value:0},this._distort={value:.4},this._radius={value:1}}onBeforeCompile(e){e.uniforms.time=this._time,e.uniforms.radius=this._radius,e.uniforms.distort=this._distort,e.vertexShader=`
      uniform float time;
      uniform float radius;
      uniform float distort;
      ${ive}
      ${e.vertexShader}
    `,e.vertexShader=e.vertexShader.replace("#include <begin_vertex>",`
        float updateTime = time / 50.0;
        float noise = snoise(vec3(position / 2.0 + updateTime * 5.0));
        vec3 transformed = vec3(position * (noise * pow(distort, 2.0) + radius));
        `)}get time(){return this._time.value}set time(e){this._time.value=e}get distort(){return this._distort.value}set distort(e){this._distort.value=e}get radius(){return this._radius.value}set radius(e){this._radius.value=e}}const sve=C.forwardRef(({speed:i=1,...e},t)=>{const[n]=C.useState(()=>new rve);return Kt(r=>n&&(n.time=r.clock.elapsedTime*i)),C.createElement("primitive",ot({object:n,ref:t,attach:"material"},e))});class ove extends m0{constructor(e={}){super(e),this.setValues(e),this._time={value:0},this._factor={value:1}}onBeforeCompile(e){e.uniforms.time=this._time,e.uniforms.factor=this._factor,e.vertexShader=`
      uniform float time;
      uniform float factor;
      ${e.vertexShader}
    `,e.vertexShader=e.vertexShader.replace("#include <begin_vertex>",`float theta = sin( time + position.y ) / 2.0 * factor;
        float c = cos( theta );
        float s = sin( theta );
        mat3 m = mat3( c, 0, s, 0, 1, 0, -s, 0, c );
        vec3 transformed = vec3( position ) * m;
        vNormal = vNormal * m;`)}get time(){return this._time.value}set time(e){this._time.value=e}get factor(){return this._factor.value}set factor(e){this._factor.value=e}}const ave=C.forwardRef(({speed:i=1,...e},t)=>{const[n]=C.useState(()=>new ove);return Kt(r=>n&&(n.time=r.clock.elapsedTime*i)),C.createElement("primitive",ot({object:n,ref:t,attach:"material"},e))});class lve extends Mi{constructor(e=new Ue){super({uniforms:{inputBuffer:new Xo(null),depthBuffer:new Xo(null),resolution:new Xo(new Ue),texelSize:new Xo(new Ue),halfTexelSize:new Xo(new Ue),kernel:new Xo(0),scale:new Xo(1),cameraNear:new Xo(0),cameraFar:new Xo(1),minDepthThreshold:new Xo(0),maxDepthThreshold:new Xo(1),depthScale:new Xo(0),depthToBlurRatioBias:new Xo(.25)},fragmentShader:`#include <common>
        #include <dithering_pars_fragment>      
        uniform sampler2D inputBuffer;
        uniform sampler2D depthBuffer;
        uniform float cameraNear;
        uniform float cameraFar;
        uniform float minDepthThreshold;
        uniform float maxDepthThreshold;
        uniform float depthScale;
        uniform float depthToBlurRatioBias;
        varying vec2 vUv;
        varying vec2 vUv0;
        varying vec2 vUv1;
        varying vec2 vUv2;
        varying vec2 vUv3;

        void main() {
          float depthFactor = 0.0;
          
          #ifdef USE_DEPTH
            vec4 depth = texture2D(depthBuffer, vUv);
            depthFactor = smoothstep(minDepthThreshold, maxDepthThreshold, 1.0-(depth.r * depth.a));
            depthFactor *= depthScale;
            depthFactor = max(0.0, min(1.0, depthFactor + 0.25));
          #endif
          
          vec4 sum = texture2D(inputBuffer, mix(vUv0, vUv, depthFactor));
          sum += texture2D(inputBuffer, mix(vUv1, vUv, depthFactor));
          sum += texture2D(inputBuffer, mix(vUv2, vUv, depthFactor));
          sum += texture2D(inputBuffer, mix(vUv3, vUv, depthFactor));
          gl_FragColor = sum * 0.25 ;

          #include <dithering_fragment>
          #include <tonemapping_fragment>
          #include <${ea>=154?"colorspace_fragment":"encodings_fragment"}>
        }`,vertexShader:`uniform vec2 texelSize;
        uniform vec2 halfTexelSize;
        uniform float kernel;
        uniform float scale;
        varying vec2 vUv;
        varying vec2 vUv0;
        varying vec2 vUv1;
        varying vec2 vUv2;
        varying vec2 vUv3;

        void main() {
          vec2 uv = position.xy * 0.5 + 0.5;
          vUv = uv;

          vec2 dUv = (texelSize * vec2(kernel) + halfTexelSize) * scale;
          vUv0 = vec2(uv.x - dUv.x, uv.y + dUv.y);
          vUv1 = vec2(uv.x + dUv.x, uv.y + dUv.y);
          vUv2 = vec2(uv.x + dUv.x, uv.y - dUv.y);
          vUv3 = vec2(uv.x - dUv.x, uv.y - dUv.y);

          gl_Position = vec4(position.xy, 1.0, 1.0);
        }`,blending:gc,depthWrite:!1,depthTest:!1}),this.toneMapped=!1,this.setTexelSize(e.x,e.y),this.kernel=new Float32Array([0,1,2,2,3])}setTexelSize(e,t){this.uniforms.texelSize.value.set(e,t),this.uniforms.halfTexelSize.value.set(e,t).multiplyScalar(.5)}setResolution(e){this.uniforms.resolution.value.copy(e)}}class Uj{constructor({gl:e,resolution:t,width:n=500,height:r=500,minDepthThreshold:s=0,maxDepthThreshold:o=1,depthScale:a=0,depthToBlurRatioBias:l=.25}){this.renderToScreen=!1,this.renderTargetA=new Si(t,t,{minFilter:Ln,magFilter:Ln,stencilBuffer:!1,depthBuffer:!1,type:Ni}),this.renderTargetB=this.renderTargetA.clone(),this.convolutionMaterial=new lve,this.convolutionMaterial.setTexelSize(1/n,1/r),this.convolutionMaterial.setResolution(new Ue(n,r)),this.scene=new Mu,this.camera=new h0,this.convolutionMaterial.uniforms.minDepthThreshold.value=s,this.convolutionMaterial.uniforms.maxDepthThreshold.value=o,this.convolutionMaterial.uniforms.depthScale.value=a,this.convolutionMaterial.uniforms.depthToBlurRatioBias.value=l,this.convolutionMaterial.defines.USE_DEPTH=a>0;const c=new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),u=new Float32Array([0,0,2,0,0,2]),h=new fn;h.setAttribute("position",new mn(c,3)),h.setAttribute("uv",new mn(u,2)),this.screen=new It(h,this.convolutionMaterial),this.screen.frustumCulled=!1,this.scene.add(this.screen)}render(e,t,n){const r=this.scene,s=this.camera,o=this.renderTargetA,a=this.renderTargetB;let l=this.convolutionMaterial,c=l.uniforms;c.depthBuffer.value=t.depthTexture;const u=l.kernel;let h=t,f,d,m;for(d=0,m=u.length-1;d<m;++d)f=(d&1)===0?o:a,c.kernel.value=u[d],c.inputBuffer.value=h.texture,e.setRenderTarget(f),e.render(r,s),h=f;c.kernel.value=u[d],c.inputBuffer.value=h.texture,e.setRenderTarget(this.renderToScreen?null:n),e.render(r,s)}}let zj=class extends m0{constructor(e={}){super(e),this._tDepth={value:null},this._distortionMap={value:null},this._tDiffuse={value:null},this._tDiffuseBlur={value:null},this._textureMatrix={value:null},this._hasBlur={value:!1},this._mirror={value:0},this._mixBlur={value:0},this._blurStrength={value:.5},this._minDepthThreshold={value:.9},this._maxDepthThreshold={value:1},this._depthScale={value:0},this._depthToBlurRatioBias={value:.25},this._distortion={value:1},this._mixContrast={value:1},this.setValues(e)}onBeforeCompile(e){var t;(t=e.defines)!=null&&t.USE_UV||(e.defines.USE_UV=""),e.uniforms.hasBlur=this._hasBlur,e.uniforms.tDiffuse=this._tDiffuse,e.uniforms.tDepth=this._tDepth,e.uniforms.distortionMap=this._distortionMap,e.uniforms.tDiffuseBlur=this._tDiffuseBlur,e.uniforms.textureMatrix=this._textureMatrix,e.uniforms.mirror=this._mirror,e.uniforms.mixBlur=this._mixBlur,e.uniforms.mixStrength=this._blurStrength,e.uniforms.minDepthThreshold=this._minDepthThreshold,e.uniforms.maxDepthThreshold=this._maxDepthThreshold,e.uniforms.depthScale=this._depthScale,e.uniforms.depthToBlurRatioBias=this._depthToBlurRatioBias,e.uniforms.distortion=this._distortion,e.uniforms.mixContrast=this._mixContrast,e.vertexShader=`
        uniform mat4 textureMatrix;
        varying vec4 my_vUv;
      ${e.vertexShader}`,e.vertexShader=e.vertexShader.replace("#include <project_vertex>",`#include <project_vertex>
        my_vUv = textureMatrix * vec4( position, 1.0 );
        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );`),e.fragmentShader=`
        uniform sampler2D tDiffuse;
        uniform sampler2D tDiffuseBlur;
        uniform sampler2D tDepth;
        uniform sampler2D distortionMap;
        uniform float distortion;
        uniform float cameraNear;
			  uniform float cameraFar;
        uniform bool hasBlur;
        uniform float mixBlur;
        uniform float mirror;
        uniform float mixStrength;
        uniform float minDepthThreshold;
        uniform float maxDepthThreshold;
        uniform float mixContrast;
        uniform float depthScale;
        uniform float depthToBlurRatioBias;
        varying vec4 my_vUv;
        ${e.fragmentShader}`,e.fragmentShader=e.fragmentShader.replace("#include <emissivemap_fragment>",`#include <emissivemap_fragment>

      float distortionFactor = 0.0;
      #ifdef USE_DISTORTION
        distortionFactor = texture2D(distortionMap, vUv).r * distortion;
      #endif

      vec4 new_vUv = my_vUv;
      new_vUv.x += distortionFactor;
      new_vUv.y += distortionFactor;

      vec4 base = texture2DProj(tDiffuse, new_vUv);
      vec4 blur = texture2DProj(tDiffuseBlur, new_vUv);

      vec4 merge = base;

      #ifdef USE_NORMALMAP
        vec2 normal_uv = vec2(0.0);
        vec4 normalColor = texture2D(normalMap, vUv * normalScale);
        vec3 my_normal = normalize( vec3( normalColor.r * 2.0 - 1.0, normalColor.b,  normalColor.g * 2.0 - 1.0 ) );
        vec3 coord = new_vUv.xyz / new_vUv.w;
        normal_uv = coord.xy + coord.z * my_normal.xz * 0.05;
        vec4 base_normal = texture2D(tDiffuse, normal_uv);
        vec4 blur_normal = texture2D(tDiffuseBlur, normal_uv);
        merge = base_normal;
        blur = blur_normal;
      #endif

      float depthFactor = 0.0001;
      float blurFactor = 0.0;

      #ifdef USE_DEPTH
        vec4 depth = texture2DProj(tDepth, new_vUv);
        depthFactor = smoothstep(minDepthThreshold, maxDepthThreshold, 1.0-(depth.r * depth.a));
        depthFactor *= depthScale;
        depthFactor = max(0.0001, min(1.0, depthFactor));

        #ifdef USE_BLUR
          blur = blur * min(1.0, depthFactor + depthToBlurRatioBias);
          merge = merge * min(1.0, depthFactor + 0.5);
        #else
          merge = merge * depthFactor;
        #endif

      #endif

      float reflectorRoughnessFactor = roughness;
      #ifdef USE_ROUGHNESSMAP
        vec4 reflectorTexelRoughness = texture2D( roughnessMap, vUv );
        reflectorRoughnessFactor *= reflectorTexelRoughness.g;
      #endif

      #ifdef USE_BLUR
        blurFactor = min(1.0, mixBlur * reflectorRoughnessFactor);
        merge = mix(merge, blur, blurFactor);
      #endif

      vec4 newMerge = vec4(0.0, 0.0, 0.0, 1.0);
      newMerge.r = (merge.r - 0.5) * mixContrast + 0.5;
      newMerge.g = (merge.g - 0.5) * mixContrast + 0.5;
      newMerge.b = (merge.b - 0.5) * mixContrast + 0.5;

      diffuseColor.rgb = diffuseColor.rgb * ((1.0 - min(1.0, mirror)) + newMerge.rgb * mixStrength);
      `)}get tDiffuse(){return this._tDiffuse.value}set tDiffuse(e){this._tDiffuse.value=e}get tDepth(){return this._tDepth.value}set tDepth(e){this._tDepth.value=e}get distortionMap(){return this._distortionMap.value}set distortionMap(e){this._distortionMap.value=e}get tDiffuseBlur(){return this._tDiffuseBlur.value}set tDiffuseBlur(e){this._tDiffuseBlur.value=e}get textureMatrix(){return this._textureMatrix.value}set textureMatrix(e){this._textureMatrix.value=e}get hasBlur(){return this._hasBlur.value}set hasBlur(e){this._hasBlur.value=e}get mirror(){return this._mirror.value}set mirror(e){this._mirror.value=e}get mixBlur(){return this._mixBlur.value}set mixBlur(e){this._mixBlur.value=e}get mixStrength(){return this._blurStrength.value}set mixStrength(e){this._blurStrength.value=e}get minDepthThreshold(){return this._minDepthThreshold.value}set minDepthThreshold(e){this._minDepthThreshold.value=e}get maxDepthThreshold(){return this._maxDepthThreshold.value}set maxDepthThreshold(e){this._maxDepthThreshold.value=e}get depthScale(){return this._depthScale.value}set depthScale(e){this._depthScale.value=e}get depthToBlurRatioBias(){return this._depthToBlurRatioBias.value}set depthToBlurRatioBias(e){this._depthToBlurRatioBias.value=e}get distortion(){return this._distortion.value}set distortion(e){this._distortion.value=e}get mixContrast(){return this._mixContrast.value}set mixContrast(e){this._mixContrast.value=e}};const cve=C.forwardRef(({mixBlur:i=0,mixStrength:e=1,resolution:t=256,blur:n=[0,0],minDepthThreshold:r=.9,maxDepthThreshold:s=1,depthScale:o=0,depthToBlurRatioBias:a=.25,mirror:l=0,distortion:c=1,mixContrast:u=1,distortionMap:h,reflectorOffset:f=0,...d},m)=>{Or({MeshReflectorMaterialImpl:zj});const y=Ve(({gl:F})=>F),g=Ve(({camera:F})=>F),A=Ve(({scene:F})=>F);n=Array.isArray(n)?n:[n,n];const E=n[0]+n[1]>0,x=C.useRef(null);C.useImperativeHandle(m,()=>x.current,[]);const[w]=C.useState(()=>new vo),[T]=C.useState(()=>new Q),[I]=C.useState(()=>new Q),[M]=C.useState(()=>new Q),[L]=C.useState(()=>new Xe),[P]=C.useState(()=>new Q(0,0,-1)),[R]=C.useState(()=>new Rn),[U]=C.useState(()=>new Q),[k]=C.useState(()=>new Q),[H]=C.useState(()=>new Rn),[G]=C.useState(()=>new Xe),[X]=C.useState(()=>new jn),Z=C.useCallback(()=>{var F;const Y=x.current.parent||((F=x.current)==null?void 0:F.__r3f.parent);if(!Y||(I.setFromMatrixPosition(Y.matrixWorld),M.setFromMatrixPosition(g.matrixWorld),L.extractRotation(Y.matrixWorld),T.set(0,0,1),T.applyMatrix4(L),I.addScaledVector(T,f),U.subVectors(I,M),U.dot(T)>0))return;U.reflect(T).negate(),U.add(I),L.extractRotation(g.matrixWorld),P.set(0,0,-1),P.applyMatrix4(L),P.add(M),k.subVectors(I,P),k.reflect(T).negate(),k.add(I),X.position.copy(U),X.up.set(0,1,0),X.up.applyMatrix4(L),X.up.reflect(T),X.lookAt(k),X.far=g.far,X.updateMatrixWorld(),X.projectionMatrix.copy(g.projectionMatrix),G.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),G.multiply(X.projectionMatrix),G.multiply(X.matrixWorldInverse),G.multiply(Y.matrixWorld),w.setFromNormalAndCoplanarPoint(T,I),w.applyMatrix4(X.matrixWorldInverse),R.set(w.normal.x,w.normal.y,w.normal.z,w.constant);const te=X.projectionMatrix;H.x=(Math.sign(R.x)+te.elements[8])/te.elements[0],H.y=(Math.sign(R.y)+te.elements[9])/te.elements[5],H.z=-1,H.w=(1+te.elements[10])/te.elements[14],R.multiplyScalar(2/R.dot(H)),te.elements[2]=R.x,te.elements[6]=R.y,te.elements[10]=R.z+1,te.elements[14]=R.w},[g,f]),[oe,K,V,W]=C.useMemo(()=>{const F={minFilter:Ln,magFilter:Ln,type:Ni},Y=new Si(t,t,F);Y.depthBuffer=!0,Y.depthTexture=new d0(t,t),Y.depthTexture.format=vu,Y.depthTexture.type=pp;const te=new Si(t,t,F),q=new Uj({gl:y,resolution:t,width:n[0],height:n[1],minDepthThreshold:r,maxDepthThreshold:s,depthScale:o,depthToBlurRatioBias:a}),J={mirror:l,textureMatrix:G,mixBlur:i,tDiffuse:Y.texture,tDepth:Y.depthTexture,tDiffuseBlur:te.texture,hasBlur:E,mixStrength:e,minDepthThreshold:r,maxDepthThreshold:s,depthScale:o,depthToBlurRatioBias:a,distortion:c,distortionMap:h,mixContrast:u,"defines-USE_BLUR":E?"":void 0,"defines-USE_DEPTH":o>0?"":void 0,"defines-USE_DISTORTION":h?"":void 0};return[Y,te,q,J]},[y,n,G,t,l,E,i,e,r,s,o,a,c,h,u]);return Kt(()=>{var F;const Y=x.current.parent||((F=x.current)==null?void 0:F.__r3f.parent);if(!Y)return;Y.visible=!1;const te=y.xr.enabled,q=y.shadowMap.autoUpdate;Z(),y.xr.enabled=!1,y.shadowMap.autoUpdate=!1,y.setRenderTarget(oe),y.state.buffers.depth.setMask(!0),y.autoClear||y.clear(),y.render(A,X),E&&V.render(y,oe,K),y.xr.enabled=te,y.shadowMap.autoUpdate=q,Y.visible=!0,y.setRenderTarget(null)}),C.createElement("meshReflectorMaterialImpl",ot({attach:"material",key:"key"+W["defines-USE_BLUR"]+W["defines-USE_DEPTH"]+W["defines-USE_DISTORTION"],ref:x},W,d))}),uve=Ec({envMap:null,bounces:3,ior:2.4,correctMips:!0,aberrationStrength:.01,fresnel:0,bvh:new Pj,color:new ut("white"),opacity:1,resolution:new Ue,viewMatrixInverse:new Xe,projectionMatrixInverse:new Xe},`
  uniform mat4 viewMatrixInverse;

  varying vec3 vWorldPosition;
  varying vec3 vNormal;
  varying mat4 vModelMatrixInverse;

  #include <color_pars_vertex>

  void main() {
    #include <color_vertex>

    vec4 transformedNormal = vec4(normal, 0.0);
    vec4 transformedPosition = vec4(position, 1.0);
    #ifdef USE_INSTANCING
      transformedNormal = instanceMatrix * transformedNormal;
      transformedPosition = instanceMatrix * transformedPosition;
    #endif

    #ifdef USE_INSTANCING
      vModelMatrixInverse = inverse(modelMatrix * instanceMatrix);
    #else
      vModelMatrixInverse = inverse(modelMatrix);
    #endif

    vWorldPosition = (modelMatrix * transformedPosition).xyz;
    vNormal = normalize((viewMatrixInverse * vec4(normalMatrix * transformedNormal.xyz, 0.0)).xyz);
    gl_Position = projectionMatrix * viewMatrix * modelMatrix * transformedPosition;
  }`,`
  #define ENVMAP_TYPE_CUBE_UV
  precision highp isampler2D;
  precision highp usampler2D;
  varying vec3 vWorldPosition;
  varying vec3 vNormal;
  varying mat4 vModelMatrixInverse;

  #include <color_pars_fragment>

  #ifdef ENVMAP_TYPE_CUBEM
    uniform samplerCube envMap;
  #else
    uniform sampler2D envMap;
  #endif

  uniform float bounces;
  ${Sye}
  ${wye}
  uniform BVH bvh;
  uniform float ior;
  uniform bool correctMips;
  uniform vec2 resolution;
  uniform float fresnel;
  uniform mat4 modelMatrix;
  uniform mat4 projectionMatrixInverse;
  uniform mat4 viewMatrixInverse;
  uniform float aberrationStrength;
  uniform vec3 color;
  uniform float opacity;

  float fresnelFunc(vec3 viewDirection, vec3 worldNormal) {
    return pow( 1.0 + dot( viewDirection, worldNormal), 10.0 );
  }

  vec3 totalInternalReflection(vec3 ro, vec3 rd, vec3 normal, float ior, mat4 modelMatrixInverse) {
    vec3 rayOrigin = ro;
    vec3 rayDirection = rd;
    rayDirection = refract(rayDirection, normal, 1.0 / ior);
    rayOrigin = vWorldPosition + rayDirection * 0.001;
    rayOrigin = (modelMatrixInverse * vec4(rayOrigin, 1.0)).xyz;
    rayDirection = normalize((modelMatrixInverse * vec4(rayDirection, 0.0)).xyz);
    for(float i = 0.0; i < bounces; i++) {
      uvec4 faceIndices = uvec4( 0u );
      vec3 faceNormal = vec3( 0.0, 0.0, 1.0 );
      vec3 barycoord = vec3( 0.0 );
      float side = 1.0;
      float dist = 0.0;
      bvhIntersectFirstHit( bvh, rayOrigin, rayDirection, faceIndices, faceNormal, barycoord, side, dist );
      vec3 hitPos = rayOrigin + rayDirection * max(dist - 0.001, 0.0);
      vec3 tempDir = refract(rayDirection, faceNormal, ior);
      if (length(tempDir) != 0.0) {
        rayDirection = tempDir;
        break;
      }
      rayDirection = reflect(rayDirection, faceNormal);
      rayOrigin = hitPos + rayDirection * 0.01;
    }
    rayDirection = normalize((modelMatrix * vec4(rayDirection, 0.0)).xyz);
    return rayDirection;
  }

  #include <common>
  #include <cube_uv_reflection_fragment>

  #ifdef ENVMAP_TYPE_CUBEM
    vec4 textureGradient(samplerCube envMap, vec3 rayDirection, vec3 directionCamPerfect) {
      return textureGrad(envMap, rayDirection, dFdx(correctMips ? directionCamPerfect: rayDirection), dFdy(correctMips ? directionCamPerfect: rayDirection));
    }
  #else
    vec4 textureGradient(sampler2D envMap, vec3 rayDirection, vec3 directionCamPerfect) {
      vec2 uvv = equirectUv( rayDirection );
      vec2 smoothUv = equirectUv( directionCamPerfect );
      return textureGrad(envMap, uvv, dFdx(correctMips ? smoothUv : uvv), dFdy(correctMips ? smoothUv : uvv));
    }
  #endif

  void main() {
    vec2 uv = gl_FragCoord.xy / resolution;
    vec3 directionCamPerfect = (projectionMatrixInverse * vec4(uv * 2.0 - 1.0, 0.0, 1.0)).xyz;
    directionCamPerfect = (viewMatrixInverse * vec4(directionCamPerfect, 0.0)).xyz;
    directionCamPerfect = normalize(directionCamPerfect);
    vec3 normal = vNormal;
    vec3 rayOrigin = cameraPosition;
    vec3 rayDirection = normalize(vWorldPosition - cameraPosition);

    vec4 diffuseColor = vec4(color, opacity);
    #include <color_fragment>

    #ifdef CHROMATIC_ABERRATIONS
      vec3 rayDirectionG = totalInternalReflection(rayOrigin, rayDirection, normal, max(ior, 1.0), vModelMatrixInverse);
      #ifdef FAST_CHROMA
        vec3 rayDirectionR = normalize(rayDirectionG + 1.0 * vec3(aberrationStrength / 2.0));
        vec3 rayDirectionB = normalize(rayDirectionG - 1.0 * vec3(aberrationStrength / 2.0));
      #else
        vec3 rayDirectionR = totalInternalReflection(rayOrigin, rayDirection, normal, max(ior * (1.0 - aberrationStrength), 1.0), vModelMatrixInverse);
        vec3 rayDirectionB = totalInternalReflection(rayOrigin, rayDirection, normal, max(ior * (1.0 + aberrationStrength), 1.0), vModelMatrixInverse);
      #endif
      float finalColorR = textureGradient(envMap, rayDirectionR, directionCamPerfect).r;
      float finalColorG = textureGradient(envMap, rayDirectionG, directionCamPerfect).g;
      float finalColorB = textureGradient(envMap, rayDirectionB, directionCamPerfect).b;
      diffuseColor.rgb *= vec3(finalColorR, finalColorG, finalColorB);
    #else
      rayDirection = totalInternalReflection(rayOrigin, rayDirection, normal, max(ior, 1.0), vModelMatrixInverse);
      diffuseColor.rgb *= textureGradient(envMap, rayDirection, directionCamPerfect).rgb;
    #endif

    vec3 viewDirection = normalize(vWorldPosition - cameraPosition);
    float nFresnel = fresnelFunc(viewDirection, normal) * fresnel;
    gl_FragColor = vec4(mix(diffuseColor.rgb, vec3(1.0), nFresnel), diffuseColor.a);

    #include <tonemapping_fragment>
    #include <${ea>=154?"colorspace_fragment":"encodings_fragment"}>
  }`),hve=i=>i&&i.isCubeTexture;function fve({aberrationStrength:i=0,fastChroma:e=!0,envMap:t,...n}){Or({MeshRefractionMaterial:uve});const r=C.useRef(),{size:s}=Ve(),o=C.useMemo(()=>{var a,l;const c={},u=hve(t),f=((a=u?(l=t.image[0])==null?void 0:l.width:t.image.width)!==null&&a!==void 0?a:1024)/4,d=Math.floor(Math.log2(f)),m=Math.pow(2,d),y=3*Math.max(m,112),g=4*m;return u&&(c.ENVMAP_TYPE_CUBEM=""),c.CUBEUV_TEXEL_WIDTH=`${1/y}`,c.CUBEUV_TEXEL_HEIGHT=`${1/g}`,c.CUBEUV_MAX_MIP=`${d}.0`,i>0&&(c.CHROMATIC_ABERRATIONS=""),e&&(c.FAST_CHROMA=""),c},[i,e]);return C.useLayoutEffect(()=>{var a;const l=(a=r.current)==null||(a=a.__r3f)==null||(a=a.parent)==null?void 0:a.geometry;l&&(r.current.bvh=new Pj,r.current.bvh.updateFrom(new P4(l.clone().toNonIndexed(),{strategy:I4})))},[]),Kt(({camera:a})=>{r.current.viewMatrixInverse=a.matrixWorld,r.current.projectionMatrixInverse=a.projectionMatrixInverse}),C.createElement("meshRefractionMaterial",ot({key:JSON.stringify(o),defines:o,ref:r,resolution:[s.width,s.height],aberrationStrength:i,envMap:t},n))}const f8=Ec({},"void main() { }","void main() { gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0); discard;  }");class dve extends nl{constructor(e=6,t=!1){super(),this.uniforms={chromaticAberration:{value:.05},transmission:{value:0},_transmission:{value:1},transmissionMap:{value:null},roughness:{value:0},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:1/0},attenuationColor:{value:new ut("white")},anisotropicBlur:{value:.1},time:{value:0},distortion:{value:0},distortionScale:{value:.5},temporalDistortion:{value:0},buffer:{value:null}},this.onBeforeCompile=n=>{n.uniforms={...n.uniforms,...this.uniforms},this.anisotropy>0&&(n.defines.USE_ANISOTROPY=""),t?n.defines.USE_SAMPLER="":n.defines.USE_TRANSMISSION="",n.fragmentShader=`
      uniform float chromaticAberration;         
      uniform float anisotropicBlur;      
      uniform float time;
      uniform float distortion;
      uniform float distortionScale;
      uniform float temporalDistortion;
      uniform sampler2D buffer;

      vec3 random3(vec3 c) {
        float j = 4096.0*sin(dot(c,vec3(17.0, 59.4, 15.0)));
        vec3 r;
        r.z = fract(512.0*j);
        j *= .125;
        r.x = fract(512.0*j);
        j *= .125;
        r.y = fract(512.0*j);
        return r-0.5;
      }

      uint hash( uint x ) {
        x += ( x << 10u );
        x ^= ( x >>  6u );
        x += ( x <<  3u );
        x ^= ( x >> 11u );
        x += ( x << 15u );
        return x;
      }

      // Compound versions of the hashing algorithm I whipped together.
      uint hash( uvec2 v ) { return hash( v.x ^ hash(v.y)                         ); }
      uint hash( uvec3 v ) { return hash( v.x ^ hash(v.y) ^ hash(v.z)             ); }
      uint hash( uvec4 v ) { return hash( v.x ^ hash(v.y) ^ hash(v.z) ^ hash(v.w) ); }

      // Construct a float with half-open range [0:1] using low 23 bits.
      // All zeroes yields 0.0, all ones yields the next smallest representable value below 1.0.
      float floatConstruct( uint m ) {
        const uint ieeeMantissa = 0x007FFFFFu; // binary32 mantissa bitmask
        const uint ieeeOne      = 0x3F800000u; // 1.0 in IEEE binary32
        m &= ieeeMantissa;                     // Keep only mantissa bits (fractional part)
        m |= ieeeOne;                          // Add fractional part to 1.0
        float  f = uintBitsToFloat( m );       // Range [1:2]
        return f - 1.0;                        // Range [0:1]
      }

      // Pseudo-random value in half-open range [0:1].
      float randomBase( float x ) { return floatConstruct(hash(floatBitsToUint(x))); }
      float randomBase( vec2  v ) { return floatConstruct(hash(floatBitsToUint(v))); }
      float randomBase( vec3  v ) { return floatConstruct(hash(floatBitsToUint(v))); }
      float randomBase( vec4  v ) { return floatConstruct(hash(floatBitsToUint(v))); }
      float rand(float seed) {
        float result = randomBase(vec3(gl_FragCoord.xy, seed));
        return result;
      }

      const float F3 =  0.3333333;
      const float G3 =  0.1666667;

      float snoise(vec3 p) {
        vec3 s = floor(p + dot(p, vec3(F3)));
        vec3 x = p - s + dot(s, vec3(G3));
        vec3 e = step(vec3(0.0), x - x.yzx);
        vec3 i1 = e*(1.0 - e.zxy);
        vec3 i2 = 1.0 - e.zxy*(1.0 - e);
        vec3 x1 = x - i1 + G3;
        vec3 x2 = x - i2 + 2.0*G3;
        vec3 x3 = x - 1.0 + 3.0*G3;
        vec4 w, d;
        w.x = dot(x, x);
        w.y = dot(x1, x1);
        w.z = dot(x2, x2);
        w.w = dot(x3, x3);
        w = max(0.6 - w, 0.0);
        d.x = dot(random3(s), x);
        d.y = dot(random3(s + i1), x1);
        d.z = dot(random3(s + i2), x2);
        d.w = dot(random3(s + 1.0), x3);
        w *= w;
        w *= w;
        d *= w;
        return dot(d, vec4(52.0));
      }

      float snoiseFractal(vec3 m) {
        return 0.5333333* snoise(m)
              +0.2666667* snoise(2.0*m)
              +0.1333333* snoise(4.0*m)
              +0.0666667* snoise(8.0*m);
      }
`+n.fragmentShader,n.fragmentShader=n.fragmentShader.replace("#include <transmission_pars_fragment>",`
        #ifdef USE_TRANSMISSION
          // Transmission code is based on glTF-Sampler-Viewer
          // https://github.com/KhronosGroup/glTF-Sample-Viewer
          uniform float _transmission;
          uniform float thickness;
          uniform float attenuationDistance;
          uniform vec3 attenuationColor;
          #ifdef USE_TRANSMISSIONMAP
            uniform sampler2D transmissionMap;
          #endif
          #ifdef USE_THICKNESSMAP
            uniform sampler2D thicknessMap;
          #endif
          uniform vec2 transmissionSamplerSize;
          uniform sampler2D transmissionSamplerMap;
          uniform mat4 modelMatrix;
          uniform mat4 projectionMatrix;
          varying vec3 vWorldPosition;
          vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
            // Direction of refracted light.
            vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
            // Compute rotation-independant scaling of the model matrix.
            vec3 modelScale;
            modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
            modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
            modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
            // The thickness is specified in local space.
            return normalize( refractionVector ) * thickness * modelScale;
          }
          float applyIorToRoughness( const in float roughness, const in float ior ) {
            // Scale roughness with IOR so that an IOR of 1.0 results in no microfacet refraction and
            // an IOR of 1.5 results in the default amount of microfacet refraction.
            return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
          }
          vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
            float framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );            
            #ifdef USE_SAMPLER
              #ifdef texture2DLodEXT
                return texture2DLodEXT(transmissionSamplerMap, fragCoord.xy, framebufferLod);
              #else
                return texture2D(transmissionSamplerMap, fragCoord.xy, framebufferLod);
              #endif
            #else
              return texture2D(buffer, fragCoord.xy);
            #endif
          }
          vec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
            if ( isinf( attenuationDistance ) ) {
              // Attenuation distance is +∞, i.e. the transmitted color is not attenuated at all.
              return radiance;
            } else {
              // Compute light attenuation using Beer's law.
              vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
              vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance ); // Beer's law
              return transmittance * radiance;
            }
          }
          vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
            const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
            const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,
            const in vec3 attenuationColor, const in float attenuationDistance ) {
            vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
            vec3 refractedRayExit = position + transmissionRay;
            // Project refracted vector on the framebuffer, while mapping to normalized device coordinates.
            vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
            vec2 refractionCoords = ndcPos.xy / ndcPos.w;
            refractionCoords += 1.0;
            refractionCoords /= 2.0;
            // Sample framebuffer to get pixel the refracted ray hits.
            vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
            vec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );
            // Get the specular component.
            vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
            return vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );
          }
        #endif
`),n.fragmentShader=n.fragmentShader.replace("#include <transmission_fragment>",`  
        // Improve the refraction to use the world pos
        material.transmission = _transmission;
        material.transmissionAlpha = 1.0;
        material.thickness = thickness;
        material.attenuationDistance = attenuationDistance;
        material.attenuationColor = attenuationColor;
        #ifdef USE_TRANSMISSIONMAP
          material.transmission *= texture2D( transmissionMap, vUv ).r;
        #endif
        #ifdef USE_THICKNESSMAP
          material.thickness *= texture2D( thicknessMap, vUv ).g;
        #endif
        
        vec3 pos = vWorldPosition;
        float runningSeed = 0.0;
        vec3 v = normalize( cameraPosition - pos );
        vec3 n = inverseTransformDirection( normal, viewMatrix );
        vec3 transmission = vec3(0.0);
        float transmissionR, transmissionB, transmissionG;
        float randomCoords = rand(runningSeed++);
        float thickness_smear = thickness * max(pow(roughnessFactor, 0.33), anisotropicBlur);
        vec3 distortionNormal = vec3(0.0);
        vec3 temporalOffset = vec3(time, -time, -time) * temporalDistortion;
        if (distortion > 0.0) {
          distortionNormal = distortion * vec3(snoiseFractal(vec3((pos * distortionScale + temporalOffset))), snoiseFractal(vec3(pos.zxy * distortionScale - temporalOffset)), snoiseFractal(vec3(pos.yxz * distortionScale + temporalOffset)));
        }
        for (float i = 0.0; i < ${e}.0; i ++) {
          vec3 sampleNorm = normalize(n + roughnessFactor * roughnessFactor * 2.0 * normalize(vec3(rand(runningSeed++) - 0.5, rand(runningSeed++) - 0.5, rand(runningSeed++) - 0.5)) * pow(rand(runningSeed++), 0.33) + distortionNormal);
          transmissionR = getIBLVolumeRefraction(
            sampleNorm, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
            pos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness  + thickness_smear * (i + randomCoords) / float(${e}),
            material.attenuationColor, material.attenuationDistance
          ).r;
          transmissionG = getIBLVolumeRefraction(
            sampleNorm, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
            pos, modelMatrix, viewMatrix, projectionMatrix, material.ior  * (1.0 + chromaticAberration * (i + randomCoords) / float(${e})) , material.thickness + thickness_smear * (i + randomCoords) / float(${e}),
            material.attenuationColor, material.attenuationDistance
          ).g;
          transmissionB = getIBLVolumeRefraction(
            sampleNorm, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
            pos, modelMatrix, viewMatrix, projectionMatrix, material.ior * (1.0 + 2.0 * chromaticAberration * (i + randomCoords) / float(${e})), material.thickness + thickness_smear * (i + randomCoords) / float(${e}),
            material.attenuationColor, material.attenuationDistance
          ).b;
          transmission.r += transmissionR;
          transmission.g += transmissionG;
          transmission.b += transmissionB;
        }
        transmission /= ${e}.0;
        totalDiffuse = mix( totalDiffuse, transmission.rgb, material.transmission );
`)},Object.keys(this.uniforms).forEach(n=>Object.defineProperty(this,n,{get:()=>this.uniforms[n].value,set:r=>this.uniforms[n].value=r}))}}const pve=C.forwardRef(({buffer:i,transmissionSampler:e=!1,backside:t=!1,side:n=tl,transmission:r=1,thickness:s=0,backsideThickness:o=0,backsideEnvMapIntensity:a=1,samples:l=10,resolution:c,backsideResolution:u,background:h,anisotropy:f,anisotropicBlur:d,...m},y)=>{Or({MeshTransmissionMaterial:dve});const g=C.useRef(null),[A]=C.useState(()=>new f8),E=Ea(u||c),x=Ea(c);let w,T,I,M;return Kt(L=>{g.current.time=L.clock.elapsedTime,g.current.buffer===x.texture&&!e&&(M=g.current.__r3f.parent,M&&(I=L.gl.toneMapping,w=L.scene.background,T=g.current.envMapIntensity,L.gl.toneMapping=yu,h&&(L.scene.background=h),M.material=A,t&&(L.gl.setRenderTarget(E),L.gl.render(L.scene,L.camera),M.material=g.current,M.material.buffer=E.texture,M.material.thickness=o,M.material.side=ys,M.material.envMapIntensity=a),L.gl.setRenderTarget(x),L.gl.render(L.scene,L.camera),M.material=g.current,M.material.thickness=s,M.material.side=n,M.material.buffer=x.texture,M.material.envMapIntensity=T,L.scene.background=w,L.gl.setRenderTarget(null),L.gl.toneMapping=I))}),C.useImperativeHandle(y,()=>g.current,[]),C.createElement("meshTransmissionMaterial",ot({args:[l,e],ref:g},m,{buffer:i||x.texture,_transmission:r,anisotropicBlur:d??f,transmission:e?r:0,thickness:s,side:n}))}),mve=C.forwardRef((i,e)=>(Or({DiscardMaterialImpl:f8}),C.createElement("discardMaterialImpl",ot({ref:e},i))));function gve(i){const e=C.useRef(null);return C.useLayoutEffect(()=>{var t;const n=(t=e.current)==null?void 0:t.parent,r=n==null?void 0:n.geometry;if(r){const s=n.material;n.material=e.current.__r3f.objects;const o=[...r.groups];return r.clearGroups(),n.material.forEach((a,l)=>{l<n.material.length-1&&(a.depthWrite=!1),r.addGroup(0,1/0,l)}),()=>{n.material=s,r.groups=o}}}),C.createElement("group",ot({ref:e},i))}const vI=ea>=154?"opaque_fragment":"output_fragment";class Gj extends hx{constructor(e){super(e),this.onBeforeCompile=(t,n)=>{const{isWebGL2:r}=n.capabilities;t.fragmentShader=t.fragmentShader.replace(`#include <${vI}>`,`
        ${r?`#include <${vI}>`:`#extension GL_OES_standard_derivatives : enable
#include <${vI}>`}
      vec2 cxy = 2.0 * gl_PointCoord - 1.0;
      float r = dot(cxy, cxy);
      float delta = fwidth(r);     
      float mask = 1.0 - smoothstep(1.0 - delta, 1.0 + delta, r);
      gl_FragColor = vec4(gl_FragColor.rgb, mask * gl_FragColor.a );
      #include <tonemapping_fragment>
      #include <${ea>=154?"colorspace_fragment":"encodings_fragment"}>
      `)}}}const Ave=C.forwardRef((i,e)=>{const[t]=C.useState(()=>new Gj(null));return C.createElement("primitive",ot({},i,{object:t,ref:e,attach:"material"}))}),yve=({focus:i=0,size:e=25,samples:t=10}={})=>`
#define PENUMBRA_FILTER_SIZE float(${e})
#define RGB_NOISE_FUNCTION(uv) (randRGB(uv))
vec3 randRGB(vec2 uv) {
  return vec3(
    fract(sin(dot(uv, vec2(12.75613, 38.12123))) * 13234.76575),
    fract(sin(dot(uv, vec2(19.45531, 58.46547))) * 43678.23431),
    fract(sin(dot(uv, vec2(23.67817, 78.23121))) * 93567.23423)
  );
}

vec3 lowPassRandRGB(vec2 uv) {
  // 3x3 convolution (average)
  // can be implemented as separable with an extra buffer for a total of 6 samples instead of 9
  vec3 result = vec3(0);
  result += RGB_NOISE_FUNCTION(uv + vec2(-1.0, -1.0));
  result += RGB_NOISE_FUNCTION(uv + vec2(-1.0,  0.0));
  result += RGB_NOISE_FUNCTION(uv + vec2(-1.0, +1.0));
  result += RGB_NOISE_FUNCTION(uv + vec2( 0.0, -1.0));
  result += RGB_NOISE_FUNCTION(uv + vec2( 0.0,  0.0));
  result += RGB_NOISE_FUNCTION(uv + vec2( 0.0, +1.0));
  result += RGB_NOISE_FUNCTION(uv + vec2(+1.0, -1.0));
  result += RGB_NOISE_FUNCTION(uv + vec2(+1.0,  0.0));
  result += RGB_NOISE_FUNCTION(uv + vec2(+1.0, +1.0));
  result *= 0.111111111; // 1.0 / 9.0
  return result;
}
vec3 highPassRandRGB(vec2 uv) {
  // by subtracting the low-pass signal from the original signal, we're being left with the high-pass signal
  // hp(x) = x - lp(x)
  return RGB_NOISE_FUNCTION(uv) - lowPassRandRGB(uv) + 0.5;
}


vec2 vogelDiskSample(int sampleIndex, int sampleCount, float angle) {
  const float goldenAngle = 2.399963f; // radians
  float r = sqrt(float(sampleIndex) + 0.5f) / sqrt(float(sampleCount));
  float theta = float(sampleIndex) * goldenAngle + angle;
  float sine = sin(theta);
  float cosine = cos(theta);
  return vec2(cosine, sine) * r;
}
float penumbraSize( const in float zReceiver, const in float zBlocker ) { // Parallel plane estimation
  return (zReceiver - zBlocker) / zBlocker;
}
float findBlocker(sampler2D shadowMap, vec2 uv, float compare, float angle) {
  float texelSize = 1.0 / float(textureSize(shadowMap, 0).x);
  float blockerDepthSum = float(${i});
  float blockers = 0.0;

  int j = 0;
  vec2 offset = vec2(0.);
  float depth = 0.;

  #pragma unroll_loop_start
  for(int i = 0; i < ${t}; i ++) {
    offset = (vogelDiskSample(j, ${t}, angle) * texelSize) * 2.0 * PENUMBRA_FILTER_SIZE;
    depth = unpackRGBAToDepth( texture2D( shadowMap, uv + offset));
    if (depth < compare) {
      blockerDepthSum += depth;
      blockers++;
    }
    j++;
  }
  #pragma unroll_loop_end

  if (blockers > 0.0) {
    return blockerDepthSum / blockers;
  }
  return -1.0;
}

        
float vogelFilter(sampler2D shadowMap, vec2 uv, float zReceiver, float filterRadius, float angle) {
  float texelSize = 1.0 / float(textureSize(shadowMap, 0).x);
  float shadow = 0.0f;
  int j = 0;
  vec2 vogelSample = vec2(0.0);
  vec2 offset = vec2(0.0);
  #pragma unroll_loop_start
  for (int i = 0; i < ${t}; i++) {
    vogelSample = vogelDiskSample(j, ${t}, angle) * texelSize;
    offset = vogelSample * (1.0 + filterRadius * float(${e}));
    shadow += step( zReceiver, unpackRGBAToDepth( texture2D( shadowMap, uv + offset ) ) );
    j++;
  }
  #pragma unroll_loop_end
  return shadow * 1.0 / ${t}.0;
}

float PCSS (sampler2D shadowMap, vec4 coords) {
  vec2 uv = coords.xy;
  float zReceiver = coords.z; // Assumed to be eye-space z in this code
  float angle = highPassRandRGB(gl_FragCoord.xy).r * PI2;
  float avgBlockerDepth = findBlocker(shadowMap, uv, zReceiver, angle);
  if (avgBlockerDepth == -1.0) {
    return 1.0;
  }
  float penumbraRatio = penumbraSize(zReceiver, avgBlockerDepth);
  return vogelFilter(shadowMap, uv, zReceiver, 1.25 * penumbraRatio, angle);
}`;function bF(i,e,t){e.traverse(n=>{n.material&&(i.properties.remove(n.material),n.material.dispose==null||n.material.dispose())}),i.info.programs.length=0,i.compile(e,t)}function vve({focus:i=0,samples:e=10,size:t=25}){const n=Ve(o=>o.gl),r=Ve(o=>o.scene),s=Ve(o=>o.camera);return C.useEffect(()=>{const o=Un.shadowmap_pars_fragment;return Un.shadowmap_pars_fragment=Un.shadowmap_pars_fragment.replace("#ifdef USE_SHADOWMAP",`#ifdef USE_SHADOWMAP
`+yve({size:t,samples:e,focus:i})).replace("#if defined( SHADOWMAP_TYPE_PCF )",`
return PCSS(shadowMap, shadowCoord);
#if defined( SHADOWMAP_TYPE_PCF )`),bF(n,r,s),()=>{Un.shadowmap_pars_fragment=o,bF(n,r,s)}},[i,t,e]),null}function ao(i,e){const t=i+"Geometry";return C.forwardRef(({args:n,children:r,...s},o)=>{const a=C.useRef(null);return C.useImperativeHandle(o,()=>a.current),C.useLayoutEffect(()=>void(e==null?void 0:e(a.current))),C.createElement("mesh",ot({ref:a},s),C.createElement(t,{attach:"geometry",args:n}),r)})}const xve=ao("box"),Eve=ao("circle"),_ve=ao("cone"),Sve=ao("cylinder"),wve=ao("sphere"),Cve=ao("plane"),Tve=ao("tube"),bve=ao("torus"),Ive=ao("torusKnot"),Mve=ao("tetrahedron"),Rve=ao("ring"),Pve=ao("polyhedron"),Lve=ao("icosahedron"),Bve=ao("octahedron"),Dve=ao("dodecahedron"),kve=ao("extrude"),Fve=ao("lathe"),Ove=ao("capsule"),Nve=ao("shape",({geometry:i})=>{const e=i.attributes.position,t=new ti().setFromBufferAttribute(e),n=new Q;t.getSize(n);const r=[];let s=0,o=0,a=0,l=0;for(let c=0;c<e.count;c++)s=e.getX(c),o=e.getY(c),a=(s-t.min.x)/n.x,l=(o-t.min.y)/n.y,r.push(a,l);i.setAttribute("uv",new Gt(r,2))}),ah=1e-5;function Uve(i,e,t){const n=new Pf,r=t-ah;return n.absarc(ah,ah,ah,-Math.PI/2,-Math.PI,!0),n.absarc(ah,e-r*2,ah,Math.PI,Math.PI/2,!0),n.absarc(i-r*2,e-r*2,ah,Math.PI/2,0,!0),n.absarc(i-r*2,ah,ah,0,-Math.PI/2,!0),n}const zve=C.forwardRef(function({args:[e=1,t=1,n=1]=[],radius:r=.05,steps:s=1,smoothness:o=4,bevelSegments:a=4,creaseAngle:l=.4,children:c,...u},h){const f=C.useMemo(()=>Uve(e,t,r),[e,t,r]),d=C.useMemo(()=>({depth:n-r*2,bevelEnabled:!0,bevelSegments:a*2,steps:s,bevelSize:r-ah,bevelThickness:r,curveSegments:o}),[n,r,o]),m=C.useRef(null);return C.useLayoutEffect(()=>{m.current&&(m.current.center(),sH(m.current,l))},[f,d]),C.createElement("mesh",ot({ref:h},u),C.createElement("extrudeGeometry",{ref:m,args:[f,d]}),c)});function Gve(){const i=new fn,e=new Float32Array([-1,-1,3,-1,-1,3]);return i.boundingSphere=new Bi,i.boundingSphere.set(new Q,1/0),i.setAttribute("position",new mn(e,2)),i}const Hve=C.forwardRef(function({children:e,...t},n){const r=C.useMemo(Gve,[]);return C.createElement("mesh",ot({ref:n,geometry:r,frustumCulled:!1},t),e)}),Qve=C.forwardRef(({children:i,width:e,height:t,depth:n,box3:r,precise:s=!0,...o},a)=>{const l=C.useRef(null),c=C.useRef(null),u=C.useRef(null);return C.useLayoutEffect(()=>{c.current.matrixWorld.identity();let h=r||new ti().setFromObject(u.current,s);const f=h.max.x-h.min.x,d=h.max.y-h.min.y,m=h.max.z-h.min.z;let y=Math.max(f,d,m);e&&(y=f),t&&(y=d),n&&(y=m),c.current.scale.setScalar(1/y)},[e,t,n,r,s]),C.useImperativeHandle(a,()=>l.current,[]),C.createElement("group",ot({ref:l},o),C.createElement("group",{ref:c},C.createElement("group",{ref:u},i)))});var nc=(function(i){return i[i.NONE=0]="NONE",i[i.START=1]="START",i[i.ACTIVE=2]="ACTIVE",i})(nc||{});const u1=i=>i&&i.isOrthographicCamera,Vve=i=>i&&i.isBox3,jve=i=>1-Math.exp(-5*i)+.007*i,Hj=C.createContext(null);function Qj({children:i,maxDuration:e=1,margin:t=1.2,observe:n,fit:r,clip:s,interpolateFunc:o=jve,onFit:a}){const l=C.useRef(null),{camera:c,size:u,invalidate:h}=Ve(),f=Ve(T=>T.controls),d=C.useRef(a);d.current=a;const m=C.useRef({camPos:new Q,camRot:new Xt,camZoom:1}),y=C.useRef({camPos:void 0,camRot:void 0,camZoom:void 0,camUp:void 0,target:void 0}),g=C.useRef(nc.NONE),A=C.useRef(0),[E]=C.useState(()=>new ti),x=C.useMemo(()=>{function T(){const I=E.getSize(new Q),M=E.getCenter(new Q),L=Math.max(I.x,I.y,I.z),P=u1(c)?L*4:L/(2*Math.atan(Math.PI*c.fov/360)),R=u1(c)?L*4:P/c.aspect,U=t*Math.max(P,R);return{box:E,size:I,center:M,distance:U}}return{getSize:T,refresh(I){if(Vve(I))E.copy(I);else{const M=I||l.current;if(!M)return this;M.updateWorldMatrix(!0,!0),E.setFromObject(M)}if(E.isEmpty()){const M=c.position.length()||10;E.setFromCenterAndSize(new Q,new Q(M,M,M))}return m.current.camPos.copy(c.position),m.current.camRot.copy(c.quaternion),u1(c)&&(m.current.camZoom=c.zoom),y.current.camPos=void 0,y.current.camRot=void 0,y.current.camZoom=void 0,y.current.camUp=void 0,y.current.target=void 0,this},reset(){const{center:I,distance:M}=T(),L=c.position.clone().sub(I).normalize();y.current.camPos=I.clone().addScaledVector(L,M),y.current.target=I.clone();const P=new Xe().lookAt(y.current.camPos,y.current.target,c.up);return y.current.camRot=new Xt().setFromRotationMatrix(P),g.current=nc.START,A.current=0,this},moveTo(I){return y.current.camPos=Array.isArray(I)?new Q(...I):I.clone(),g.current=nc.START,A.current=0,this},lookAt({target:I,up:M}){y.current.target=Array.isArray(I)?new Q(...I):I.clone(),M?y.current.camUp=Array.isArray(M)?new Q(...M):M.clone():y.current.camUp=c.up.clone();const L=new Xe().lookAt(y.current.camPos||c.position,y.current.target,y.current.camUp);return y.current.camRot=new Xt().setFromRotationMatrix(L),g.current=nc.START,A.current=0,this},to({position:I,target:M}){return this.moveTo(I).lookAt({target:M})},fit(){if(!u1(c))return this.reset();let I=0,M=0;const L=[new Q(E.min.x,E.min.y,E.min.z),new Q(E.min.x,E.max.y,E.min.z),new Q(E.min.x,E.min.y,E.max.z),new Q(E.min.x,E.max.y,E.max.z),new Q(E.max.x,E.max.y,E.max.z),new Q(E.max.x,E.max.y,E.min.z),new Q(E.max.x,E.min.y,E.max.z),new Q(E.max.x,E.min.y,E.min.z)],P=y.current.camPos||c.position,R=y.current.target||(f==null?void 0:f.target),U=y.current.camUp||c.up,k=R?new Xe().lookAt(P,R,U).setPosition(P).invert():c.matrixWorldInverse;for(const X of L)X.applyMatrix4(k),I=Math.max(I,Math.abs(X.y)),M=Math.max(M,Math.abs(X.x));I*=2,M*=2;const H=(c.top-c.bottom)/I,G=(c.right-c.left)/M;return y.current.camZoom=Math.min(H,G)/t,g.current=nc.START,A.current=0,d.current&&d.current(this.getSize()),this},clip(){const{distance:I}=T();return c.near=I/100,c.far=I*100,c.updateProjectionMatrix(),f&&(f.maxDistance=I*10,f.update()),h(),this}}},[E,c,f,t,h]);C.useLayoutEffect(()=>{if(f){const T=()=>{if(f&&y.current.target&&g.current!==nc.NONE){const I=new Q().setFromMatrixColumn(c.matrix,2),M=m.current.camPos.distanceTo(f.target),L=(y.current.camPos||m.current.camPos).distanceTo(y.current.target),P=(1-A.current)*M+A.current*L;f.target.copy(c.position).addScaledVector(I,-P),f.update()}g.current=nc.NONE};return f.addEventListener("start",T),()=>f.removeEventListener("start",T)}},[f]);const w=C.useRef(0);return C.useLayoutEffect(()=>{(n||w.current++===0)&&(x.refresh(),r&&x.reset().fit(),s&&x.clip())},[u,s,r,n,c,f]),Kt((T,I)=>{if(g.current===nc.START)g.current=nc.ACTIVE,h();else if(g.current===nc.ACTIVE){if(A.current+=I/e,A.current>=1)y.current.camPos&&c.position.copy(y.current.camPos),y.current.camRot&&c.quaternion.copy(y.current.camRot),y.current.camUp&&c.up.copy(y.current.camUp),y.current.camZoom&&u1(c)&&(c.zoom=y.current.camZoom),c.updateMatrixWorld(),c.updateProjectionMatrix(),f&&y.current.target&&(f.target.copy(y.current.target),f.update()),g.current=nc.NONE;else{const M=o(A.current);y.current.camPos&&c.position.lerpVectors(m.current.camPos,y.current.camPos,M),y.current.camRot&&c.quaternion.slerpQuaternions(m.current.camRot,y.current.camRot,M),y.current.camUp&&c.up.set(0,1,0).applyQuaternion(c.quaternion),y.current.camZoom&&u1(c)&&(c.zoom=(1-M)*m.current.camZoom+M*y.current.camZoom),c.updateMatrixWorld(),c.updateProjectionMatrix()}h()}}),C.createElement("group",{ref:l},C.createElement(Hj.Provider,{value:x},i))}function Vj(){return C.useContext(Hj)}const Wve=C.forwardRef(({intensity:i=1,decay:e,decayRate:t=.65,maxYaw:n=.1,maxPitch:r=.1,maxRoll:s=.1,yawFrequency:o=.1,pitchFrequency:a=.1,rollFrequency:l=.1},c)=>{const u=Ve(E=>E.camera),h=Ve(E=>E.controls),f=C.useRef(i),d=C.useRef(u.rotation.clone()),[m]=C.useState(()=>new YT),[y]=C.useState(()=>new YT),[g]=C.useState(()=>new YT),A=()=>{(f.current<0||f.current>1)&&(f.current=f.current<0?0:1)};return C.useImperativeHandle(c,()=>({getIntensity:()=>f.current,setIntensity:E=>{f.current=E,A()}}),[]),C.useEffect(()=>{if(h){const E=()=>void(d.current=u.rotation.clone());return h.addEventListener("change",E),E(),()=>void h.removeEventListener("change",E)}},[u,h]),Kt((E,x)=>{const w=Math.pow(f.current,2),T=n*w*m.noise(E.clock.elapsedTime*o,1),I=r*w*y.noise(E.clock.elapsedTime*a,1),M=s*w*g.noise(E.clock.elapsedTime*l,1);u.rotation.set(d.current.x+I,d.current.y+T,d.current.z+M),e&&f.current>0&&(f.current-=t*x,A())}),null}),Kve=C.forwardRef(({children:i,enabled:e=!0,speed:t=1,rotationIntensity:n=1,floatIntensity:r=1,floatingRange:s=[-.1,.1],autoInvalidate:o=!1,...a},l)=>{const c=C.useRef(null);C.useImperativeHandle(l,()=>c.current,[]);const u=C.useRef(Math.random()*1e4);return Kt(h=>{var f,d;if(!e||t===0)return;o&&h.invalidate();const m=u.current+h.clock.elapsedTime;c.current.rotation.x=Math.cos(m/4*t)/8*n,c.current.rotation.y=Math.sin(m/4*t)/8*n,c.current.rotation.z=Math.sin(m/4*t)/20*n;let y=Math.sin(m/4*t)/10;y=un.mapLinear(y,-.1,.1,(f=s==null?void 0:s[0])!==null&&f!==void 0?f:-.1,(d=s==null?void 0:s[1])!==null&&d!==void 0?d:.1),c.current.position.y=y*r,c.current.updateMatrix()}),C.createElement("group",a,C.createElement("group",{ref:c,matrixAutoUpdate:!1},i))}),jj=(i,e,t)=>{let n;switch(i){case Zi:n=new Uint8ClampedArray(e*t*4);break;case Ni:n=new Uint16Array(e*t*4);break;case Zo:n=new Uint32Array(e*t*4);break;case w2:n=new Int8Array(e*t*4);break;case xw:n=new Int16Array(e*t*4);break;case Um:n=new Int32Array(e*t*4);break;case fi:n=new Float32Array(e*t*4);break;default:throw new Error("Unsupported data type")}return n};let b_;const Yve=(i,e,t,n)=>{if(b_!==void 0)return b_;const r=new Si(1,1,n);e.setRenderTarget(r);const s=new It(new Fs,new no({color:16777215}));e.render(s,t),e.setRenderTarget(null);const o=jj(i,r.width,r.height);return e.readRenderTargetPixels(r,0,0,r.width,r.height,o),r.dispose(),s.geometry.dispose(),s.material.dispose(),b_=o[0]!==0,b_};class d8{constructor(e){Zr(this,"_renderer");Zr(this,"_rendererIsDisposable",!1);Zr(this,"_material");Zr(this,"_scene");Zr(this,"_camera");Zr(this,"_quad");Zr(this,"_renderTarget");Zr(this,"_width");Zr(this,"_height");Zr(this,"_type");Zr(this,"_colorSpace");Zr(this,"_supportsReadPixels",!0);Zr(this,"render",()=>{this._renderer.setRenderTarget(this._renderTarget);try{this._renderer.render(this._scene,this._camera)}catch(e){throw this._renderer.setRenderTarget(null),e}this._renderer.setRenderTarget(null)});var n,r,s,o,a,l,c,u,h,f,d,m,y,g,A,E;this._width=e.width,this._height=e.height,this._type=e.type,this._colorSpace=e.colorSpace;const t={format:gi,depthBuffer:!1,stencilBuffer:!1,type:this._type,colorSpace:this._colorSpace,anisotropy:((n=e.renderTargetOptions)==null?void 0:n.anisotropy)!==void 0?(r=e.renderTargetOptions)==null?void 0:r.anisotropy:1,generateMipmaps:((s=e.renderTargetOptions)==null?void 0:s.generateMipmaps)!==void 0?(o=e.renderTargetOptions)==null?void 0:o.generateMipmaps:!1,magFilter:((a=e.renderTargetOptions)==null?void 0:a.magFilter)!==void 0?(l=e.renderTargetOptions)==null?void 0:l.magFilter:Ln,minFilter:((c=e.renderTargetOptions)==null?void 0:c.minFilter)!==void 0?(u=e.renderTargetOptions)==null?void 0:u.minFilter:Ln,samples:((h=e.renderTargetOptions)==null?void 0:h.samples)!==void 0?(f=e.renderTargetOptions)==null?void 0:f.samples:void 0,wrapS:((d=e.renderTargetOptions)==null?void 0:d.wrapS)!==void 0?(m=e.renderTargetOptions)==null?void 0:m.wrapS:Wi,wrapT:((y=e.renderTargetOptions)==null?void 0:y.wrapT)!==void 0?(g=e.renderTargetOptions)==null?void 0:g.wrapT:Wi};if(this._material=e.material,e.renderer?this._renderer=e.renderer:(this._renderer=d8.instantiateRenderer(),this._rendererIsDisposable=!0),this._scene=new Mu,this._camera=new qi,this._camera.position.set(0,0,10),this._camera.left=-.5,this._camera.right=.5,this._camera.top=.5,this._camera.bottom=-.5,this._camera.updateProjectionMatrix(),!Yve(this._type,this._renderer,this._camera,t)){let x;switch(this._type){case Ni:x=this._renderer.extensions.has("EXT_color_buffer_float")?fi:void 0;break}x!==void 0?(console.warn(`This browser does not support reading pixels from ${this._type} RenderTargets, switching to ${fi}`),this._type=x):(this._supportsReadPixels=!1,console.warn("This browser dos not support toArray or toDataTexture, calls to those methods will result in an error thrown"))}this._quad=new It(new Fs,this._material),this._quad.geometry.computeBoundingBox(),this._scene.add(this._quad),this._renderTarget=new Si(this.width,this.height,t),this._renderTarget.texture.mapping=((A=e.renderTargetOptions)==null?void 0:A.mapping)!==void 0?(E=e.renderTargetOptions)==null?void 0:E.mapping:np}static instantiateRenderer(){const e=new Pw;return e.setSize(128,128),e}toArray(){if(!this._supportsReadPixels)throw new Error("Can't read pixels in this browser");const e=jj(this._type,this._width,this._height);return this._renderer.readRenderTargetPixels(this._renderTarget,0,0,this._width,this._height,e),e}toDataTexture(e){const t=new Sa(this.toArray(),this.width,this.height,gi,this._type,(e==null?void 0:e.mapping)||np,(e==null?void 0:e.wrapS)||Wi,(e==null?void 0:e.wrapT)||Wi,(e==null?void 0:e.magFilter)||Ln,(e==null?void 0:e.minFilter)||Ln,(e==null?void 0:e.anisotropy)||1,Dl);return t.generateMipmaps=(e==null?void 0:e.generateMipmaps)!==void 0?e==null?void 0:e.generateMipmaps:!1,t}disposeOnDemandRenderer(){this._renderer.setRenderTarget(null),this._rendererIsDisposable&&(this._renderer.dispose(),this._renderer.forceContextLoss())}dispose(e){this.disposeOnDemandRenderer(),e&&this.renderTarget.dispose(),this.material instanceof Mi&&Object.values(this.material.uniforms).forEach(t=>{t.value instanceof vi&&t.value.dispose()}),Object.values(this.material).forEach(t=>{t instanceof vi&&t.dispose()}),this.material.dispose(),this._quad.geometry.dispose()}get width(){return this._width}set width(e){this._width=e,this._renderTarget.setSize(this._width,this._height)}get height(){return this._height}set height(e){this._height=e,this._renderTarget.setSize(this._width,this._height)}get renderer(){return this._renderer}get renderTarget(){return this._renderTarget}set renderTarget(e){this._renderTarget=e,this._width=e.width,this._height=e.height}get material(){return this._material}get type(){return this._type}get colorSpace(){return this._colorSpace}}class Wj extends Error{}class Kj extends Error{}const bv=(i,e,t)=>{const n=new RegExp(`${e}="([^"]*)"`,"i").exec(i);if(n)return n[1];const r=new RegExp(`<${e}[^>]*>([\\s\\S]*?)</${e}>`,"i").exec(i);if(r){const s=r[1].match(/<rdf:li>([^<]*)<\/rdf:li>/g);return s&&s.length===3?s.map(o=>o.replace(/<\/?rdf:li>/g,"")):r[1].trim()}if(t!==void 0)return t;throw new Error(`Can't find ${e} in gainmap metadata`)},$ve=i=>{let e;typeof TextDecoder<"u"?e=new TextDecoder().decode(i):e=i.toString();let t=e.indexOf("<x:xmpmeta");for(;t!==-1;){const n=e.indexOf("x:xmpmeta>",t),r=e.slice(t,n+10);try{const s=bv(r,"hdrgm:GainMapMin","0"),o=bv(r,"hdrgm:GainMapMax"),a=bv(r,"hdrgm:Gamma","1"),l=bv(r,"hdrgm:OffsetSDR","0.015625"),c=bv(r,"hdrgm:OffsetHDR","0.015625"),u=/hdrgm:HDRCapacityMin="([^"]*)"/.exec(r),h=u?u[1]:"0",f=/hdrgm:HDRCapacityMax="([^"]*)"/.exec(r);if(!f)throw new Error("Incomplete gainmap metadata");const d=f[1];return{gainMapMin:Array.isArray(s)?s.map(m=>parseFloat(m)):[parseFloat(s),parseFloat(s),parseFloat(s)],gainMapMax:Array.isArray(o)?o.map(m=>parseFloat(m)):[parseFloat(o),parseFloat(o),parseFloat(o)],gamma:Array.isArray(a)?a.map(m=>parseFloat(m)):[parseFloat(a),parseFloat(a),parseFloat(a)],offsetSdr:Array.isArray(l)?l.map(m=>parseFloat(m)):[parseFloat(l),parseFloat(l),parseFloat(l)],offsetHdr:Array.isArray(c)?c.map(m=>parseFloat(m)):[parseFloat(c),parseFloat(c),parseFloat(c)],hdrCapacityMin:parseFloat(h),hdrCapacityMax:parseFloat(d)}}catch{}t=e.indexOf("<x:xmpmeta",n)}};class Xve{constructor(e){Zr(this,"options");this.options={debug:e&&e.debug!==void 0?e.debug:!1,extractFII:e&&e.extractFII!==void 0?e.extractFII:!0,extractNonFII:e&&e.extractNonFII!==void 0?e.extractNonFII:!0}}extract(e){return new Promise((t,n)=>{const r=this.options.debug,s=new DataView(e.buffer);if(s.getUint16(0)!==65496){n(new Error("Not a valid jpeg"));return}const o=s.byteLength;let a=2,l=0,c;for(;a<o;){if(++l>250){n(new Error(`Found no marker after ${l} loops 😵`));return}if(s.getUint8(a)!==255){n(new Error(`Not a valid marker at offset 0x${a.toString(16)}, found: 0x${s.getUint8(a).toString(16)}`));return}if(c=s.getUint8(a+1),r&&console.log(`Marker: ${c.toString(16)}`),c===226){r&&console.log("Found APP2 marker (0xffe2)");const u=a+4;if(s.getUint32(u)===1297106432){const h=u+4;let f;if(s.getUint16(h)===18761)f=!1;else if(s.getUint16(h)===19789)f=!0;else{n(new Error("No valid endianness marker found in TIFF header"));return}if(s.getUint16(h+2,!f)!==42){n(new Error("Not valid TIFF data! (no 0x002A marker)"));return}const d=s.getUint32(h+4,!f);if(d<8){n(new Error("Not valid TIFF data! (First offset less than 8)"));return}const m=h+d,y=s.getUint16(m,!f),g=m+2;let A=0;for(let T=g;T<g+12*y;T+=12)s.getUint16(T,!f)===45057&&(A=s.getUint32(T+8,!f));const x=m+2+y*12+4,w=[];for(let T=x;T<x+A*16;T+=16){const I={MPType:s.getUint32(T,!f),size:s.getUint32(T+4,!f),dataOffset:s.getUint32(T+8,!f),dependantImages:s.getUint32(T+12,!f),start:-1,end:-1,isFII:!1};I.dataOffset?(I.start=h+I.dataOffset,I.isFII=!1):(I.start=0,I.isFII=!0),I.end=I.start+I.size,w.push(I)}if(this.options.extractNonFII&&w.length){const T=new Blob([s]),I=[];for(const M of w){if(M.isFII&&!this.options.extractFII)continue;const L=T.slice(M.start,M.end+1,"image/jpeg");I.push(L)}t(I)}}}a+=2+s.getUint16(a+2)}})}}const qve=async i=>{const e=$ve(i);if(!e)throw new Kj("Gain map XMP metadata not found");const n=await new Xve({extractFII:!0,extractNonFII:!0}).extract(i);if(n.length!==2)throw new Wj("Gain map recovery image not found");return{sdr:new Uint8Array(await n[0].arrayBuffer()),gainMap:new Uint8Array(await n[1].arrayBuffer()),metadata:e}},IF=i=>new Promise((e,t)=>{const n=document.createElement("img");n.onload=()=>{e(n)},n.onerror=r=>{t(r)},n.src=URL.createObjectURL(i)});class Jve extends os{constructor(t,n){super(n);Zr(this,"_renderer");Zr(this,"_renderTargetOptions");Zr(this,"_internalLoadingManager");Zr(this,"_config");this._config=t,t.renderer&&(this._renderer=t.renderer),this._internalLoadingManager=new Ww}setRenderer(t){return this._renderer=t,this}setRenderTargetOptions(t){return this._renderTargetOptions=t,this}prepareQuadRenderer(){this._renderer||console.warn("WARNING: A Renderer was not passed to this Loader constructor or in setRenderer, the result of this Loader will need to be converted to a Data Texture with toDataTexture() before you can use it in your renderer.");const t=this._config.createMaterial({gainMapMax:[1,1,1],gainMapMin:[0,0,0],gamma:[1,1,1],offsetHdr:[1,1,1],offsetSdr:[1,1,1],hdrCapacityMax:1,hdrCapacityMin:0,maxDisplayBoost:1,gainMap:new vi,sdr:new vi});return this._config.createQuadRenderer({width:16,height:16,type:Ni,colorSpace:Dl,material:t,renderer:this._renderer,renderTargetOptions:this._renderTargetOptions})}async processImages(t,n,r){const s=n?new Blob([n],{type:"image/jpeg"}):void 0,o=new Blob([t],{type:"image/jpeg"});let a,l,c=!1;if(typeof createImageBitmap>"u"){const u=await Promise.all([s?IF(s):Promise.resolve(void 0),IF(o)]);l=u[0],a=u[1],c=r==="flipY"}else{const u=await Promise.all([s?createImageBitmap(s,{imageOrientation:r||"flipY"}):Promise.resolve(void 0),createImageBitmap(o,{imageOrientation:r||"flipY"})]);l=u[0],a=u[1]}return{sdrImage:a,gainMapImage:l,needsFlip:c}}createTextures(t,n,r){const s=new vi(n||new ImageData(2,2),np,Wi,Wi,Ln,lM,gi,Zi,1,Dl);s.flipY=r,s.needsUpdate=!0;const o=new vi(t,np,Wi,Wi,Ln,lM,gi,Zi,1,gs);return o.flipY=r,o.needsUpdate=!0,{gainMap:s,sdr:o}}updateQuadRenderer(t,n,r,s,o){t.width=n.width,t.height=n.height,t.material.gainMap=r,t.material.sdr=s,t.material.gainMapMin=o.gainMapMin,t.material.gainMapMax=o.gainMapMax,t.material.offsetHdr=o.offsetHdr,t.material.offsetSdr=o.offsetSdr,t.material.gamma=o.gamma,t.material.hdrCapacityMin=o.hdrCapacityMin,t.material.hdrCapacityMax=o.hdrCapacityMax,t.material.maxDisplayBoost=Math.pow(2,o.hdrCapacityMax),t.material.needsUpdate=!0}}const Zve=`
varying vec2 vUv;

void main() {
  vUv = uv;
  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
}
`,e2e=`
// min half float value
#define HALF_FLOAT_MIN vec3( -65504, -65504, -65504 )
// max half float value
#define HALF_FLOAT_MAX vec3( 65504, 65504, 65504 )

uniform sampler2D sdr;
uniform sampler2D gainMap;
uniform vec3 gamma;
uniform vec3 offsetHdr;
uniform vec3 offsetSdr;
uniform vec3 gainMapMin;
uniform vec3 gainMapMax;
uniform float weightFactor;

varying vec2 vUv;

void main() {
  vec3 rgb = texture2D( sdr, vUv ).rgb;
  vec3 recovery = texture2D( gainMap, vUv ).rgb;
  vec3 logRecovery = pow( recovery, gamma );
  vec3 logBoost = gainMapMin * ( 1.0 - logRecovery ) + gainMapMax * logRecovery;
  vec3 hdrColor = (rgb + offsetSdr) * exp2( logBoost * weightFactor ) - offsetHdr;
  vec3 clampedHdrColor = max( HALF_FLOAT_MIN, min( HALF_FLOAT_MAX, hdrColor ));
  gl_FragColor = vec4( clampedHdrColor , 1.0 );
}
`;class t2e extends Mi{constructor({gamma:t,offsetHdr:n,offsetSdr:r,gainMapMin:s,gainMapMax:o,maxDisplayBoost:a,hdrCapacityMin:l,hdrCapacityMax:c,sdr:u,gainMap:h}){super({name:"GainMapDecoderMaterial",vertexShader:Zve,fragmentShader:e2e,uniforms:{sdr:{value:u},gainMap:{value:h},gamma:{value:new Q(1/t[0],1/t[1],1/t[2])},offsetHdr:{value:new Q().fromArray(n)},offsetSdr:{value:new Q().fromArray(r)},gainMapMin:{value:new Q().fromArray(s)},gainMapMax:{value:new Q().fromArray(o)},weightFactor:{value:(Math.log2(a)-l)/(c-l)}},blending:gc,depthTest:!1,depthWrite:!1});Zr(this,"_maxDisplayBoost");Zr(this,"_hdrCapacityMin");Zr(this,"_hdrCapacityMax");this._maxDisplayBoost=a,this._hdrCapacityMin=l,this._hdrCapacityMax=c,this.needsUpdate=!0,this.uniformsNeedUpdate=!0}get sdr(){return this.uniforms.sdr.value}set sdr(t){this.uniforms.sdr.value=t}get gainMap(){return this.uniforms.gainMap.value}set gainMap(t){this.uniforms.gainMap.value=t}get offsetHdr(){return this.uniforms.offsetHdr.value.toArray()}set offsetHdr(t){this.uniforms.offsetHdr.value.fromArray(t)}get offsetSdr(){return this.uniforms.offsetSdr.value.toArray()}set offsetSdr(t){this.uniforms.offsetSdr.value.fromArray(t)}get gainMapMin(){return this.uniforms.gainMapMin.value.toArray()}set gainMapMin(t){this.uniforms.gainMapMin.value.fromArray(t)}get gainMapMax(){return this.uniforms.gainMapMax.value.toArray()}set gainMapMax(t){this.uniforms.gainMapMax.value.fromArray(t)}get gamma(){const t=this.uniforms.gamma.value;return[1/t.x,1/t.y,1/t.z]}set gamma(t){const n=this.uniforms.gamma.value;n.x=1/t[0],n.y=1/t[1],n.z=1/t[2]}get hdrCapacityMin(){return this._hdrCapacityMin}set hdrCapacityMin(t){this._hdrCapacityMin=t,this.calculateWeight()}get hdrCapacityMax(){return this._hdrCapacityMax}set hdrCapacityMax(t){this._hdrCapacityMax=t,this.calculateWeight()}get maxDisplayBoost(){return this._maxDisplayBoost}set maxDisplayBoost(t){this._maxDisplayBoost=Math.max(1,Math.min(65504,t)),this.calculateWeight()}calculateWeight(){const t=(Math.log2(this._maxDisplayBoost)-this._hdrCapacityMin)/(this._hdrCapacityMax-this._hdrCapacityMin);this.uniforms.weightFactor.value=Math.max(0,Math.min(1,t))}}class Yj extends Jve{constructor(e,t){super({renderer:e,createMaterial:n=>new t2e(n),createQuadRenderer:n=>new d8(n)},t)}async render(e,t,n,r){const{sdrImage:s,gainMapImage:o,needsFlip:a}=await this.processImages(n,r,"flipY"),{gainMap:l,sdr:c}=this.createTextures(s,o,a);this.updateQuadRenderer(e,s,l,c,t),e.render()}}class n2e extends Yj{load([e,t,n],r,s,o){const a=this.prepareQuadRenderer();let l,c,u;const h=async()=>{if(l&&c&&u){try{await this.render(a,u,l,c)}catch(P){this.manager.itemError(e),this.manager.itemError(t),this.manager.itemError(n),typeof o=="function"&&o(P),a.disposeOnDemandRenderer();return}typeof r=="function"&&r(a),this.manager.itemEnd(e),this.manager.itemEnd(t),this.manager.itemEnd(n),a.disposeOnDemandRenderer()}};let f=!0,d=0,m=0,y=!0,g=0,A=0,E=!0,x=0,w=0;const T=()=>{if(typeof s=="function"){const P=d+g+x,R=m+A+w,U=f&&y&&E;s(new ProgressEvent("progress",{lengthComputable:U,loaded:R,total:P}))}};this.manager.itemStart(e),this.manager.itemStart(t),this.manager.itemStart(n);const I=new Yr(this._internalLoadingManager);I.setResponseType("arraybuffer"),I.setRequestHeader(this.requestHeader),I.setPath(this.path),I.setWithCredentials(this.withCredentials),I.load(e,async P=>{if(typeof P=="string")throw new Error("Invalid sdr buffer");l=P,await h()},P=>{f=P.lengthComputable,m=P.loaded,d=P.total,T()},P=>{this.manager.itemError(e),typeof o=="function"&&o(P)});const M=new Yr(this._internalLoadingManager);M.setResponseType("arraybuffer"),M.setRequestHeader(this.requestHeader),M.setPath(this.path),M.setWithCredentials(this.withCredentials),M.load(t,async P=>{if(typeof P=="string")throw new Error("Invalid gainmap buffer");c=P,await h()},P=>{y=P.lengthComputable,A=P.loaded,g=P.total,T()},P=>{this.manager.itemError(t),typeof o=="function"&&o(P)});const L=new Yr(this._internalLoadingManager);return L.setRequestHeader(this.requestHeader),L.setPath(this.path),L.setWithCredentials(this.withCredentials),L.load(n,async P=>{if(typeof P!="string")throw new Error("Invalid metadata string");u=JSON.parse(P),await h()},P=>{E=P.lengthComputable,w=P.loaded,x=P.total,T()},P=>{this.manager.itemError(n),typeof o=="function"&&o(P)}),a}}class i2e extends Yj{load(e,t,n,r){const s=this.prepareQuadRenderer(),o=new Yr(this._internalLoadingManager);return o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setPath(this.path),o.setWithCredentials(this.withCredentials),this.manager.itemStart(e),o.load(e,async a=>{if(typeof a=="string")throw new Error("Invalid buffer, received [string], was expecting [ArrayBuffer]");const l=new Uint8Array(a);let c,u,h;try{const f=await qve(l);c=f.sdr,u=f.gainMap,h=f.metadata}catch(f){if(f instanceof Kj||f instanceof Wj)console.warn(`Failure to reconstruct an HDR image from ${e}: Gain map metadata not found in the file, HDRJPGLoader will render the SDR jpeg`),h={gainMapMin:[0,0,0],gainMapMax:[1,1,1],gamma:[1,1,1],hdrCapacityMin:0,hdrCapacityMax:1,offsetHdr:[0,0,0],offsetSdr:[0,0,0]},c=l;else throw f}try{await this.render(s,h,c.buffer,u==null?void 0:u.buffer)}catch(f){this.manager.itemError(e),typeof r=="function"&&r(f),s.disposeOnDemandRenderer();return}typeof t=="function"&&t(s),this.manager.itemEnd(e),s.disposeOnDemandRenderer()},n,a=>{this.manager.itemError(e),typeof r=="function"&&r(a)}),s}}const q2={apartment:"lebombo_1k.hdr",city:"potsdamer_platz_1k.hdr",dawn:"kiara_1_dawn_1k.hdr",forest:"forest_slope_1k.hdr",lobby:"st_fagans_interior_1k.hdr",night:"dikhololo_night_1k.hdr",park:"rooitou_park_1k.hdr",studio:"studio_small_03_1k.hdr",sunset:"venice_sunset_1k.hdr",warehouse:"empty_warehouse_01_1k.hdr"},$j="https://raw.githack.com/pmndrs/drei-assets/456060a26bbeb8fdf79326f224b6d99b8bcce736/hdri/",q1=i=>Array.isArray(i),p8=["/px.png","/nx.png","/py.png","/ny.png","/pz.png","/nz.png"];function bx({files:i=p8,path:e="",preset:t=void 0,encoding:n=void 0,extensions:r}={}){let s=null,o=!1;t&&(m8(t),i=q2[t],e=$j),o=q1(i);const{extension:a,isCubemap:l}=g8(i);if(s=A8(a),!s)throw new Error("useEnvironment: Unrecognized file extension: "+i);const c=Ve(d=>d.gl);C.useLayoutEffect(()=>{if(a!=="webp"&&a!=="jpg"&&a!=="jpeg")return;function d(){cr.clear(s,o?[i]:i)}c.domElement.addEventListener("webglcontextlost",d,{once:!0})},[i,c.domElement]);const u=cr(s,o?[i]:i,d=>{(a==="webp"||a==="jpg"||a==="jpeg")&&d.setRenderer(c),d.setPath==null||d.setPath(e),r&&r(d)});let h=o?u[0]:u;if(a==="jpg"||a==="jpeg"||a==="webp"){var f;h=(f=h.renderTarget)==null?void 0:f.texture}return h.mapping=l?_u:Xm,"colorSpace"in h?h.colorSpace=n??l?"srgb":"srgb-linear":h.encoding=n??l?Wye:jye,h}const r2e={files:p8,path:"",preset:void 0,extensions:void 0};bx.preload=i=>{const e={...r2e,...i};let{files:t,path:n=""}=e;const{preset:r,extensions:s}=e;r&&(m8(r),t=q2[r],n=$j);const{extension:o}=g8(t);if(o==="webp"||o==="jpg"||o==="jpeg")throw new Error("useEnvironment: Preloading gainmaps is not supported");const a=A8(o);if(!a)throw new Error("useEnvironment: Unrecognized file extension: "+t);cr.preload(a,q1(t)?[t]:t,l=>{l.setPath==null||l.setPath(n),s&&s(l)})};const s2e={files:p8,preset:void 0};bx.clear=i=>{const e={...s2e,...i};let{files:t}=e;const{preset:n}=e;n&&(m8(n),t=q2[n]);const{extension:r}=g8(t),s=A8(r);if(!s)throw new Error("useEnvironment: Unrecognized file extension: "+t);cr.clear(s,q1(t)?[t]:t)};function m8(i){if(!(i in q2))throw new Error("Preset must be one of: "+Object.keys(q2).join(", "))}function g8(i){var e;const t=q1(i)&&i.length===6,n=q1(i)&&i.length===3&&i.some(o=>o.endsWith("json")),r=q1(i)?i[0]:i;return{extension:t?"cube":n?"webp":r.startsWith("data:application/exr")?"exr":r.startsWith("data:application/hdr")?"hdr":r.startsWith("data:image/jpeg")?"jpg":(e=r.split(".").pop())==null||(e=e.split("?"))==null||(e=e.shift())==null?void 0:e.toLowerCase(),isCubemap:t,isGainmap:n}}function A8(i){return i==="cube"?Kw:i==="hdr"?hhe:i==="exr"?fhe:i==="jpg"||i==="jpeg"?i2e:i==="webp"?n2e:null}const o2e=i=>i.current&&i.current.isScene,a2e=i=>o2e(i)?i.current:i;function y8(i,e,t,n,r={}){var s,o,a,l;r={backgroundBlurriness:0,backgroundIntensity:1,backgroundRotation:[0,0,0],environmentIntensity:1,environmentRotation:[0,0,0],...r};const c=a2e(e||t),u=c.background,h=c.environment,f={backgroundBlurriness:c.backgroundBlurriness,backgroundIntensity:c.backgroundIntensity,backgroundRotation:(s=(o=c.backgroundRotation)==null||o.clone==null?void 0:o.clone())!==null&&s!==void 0?s:[0,0,0],environmentIntensity:c.environmentIntensity,environmentRotation:(a=(l=c.environmentRotation)==null||l.clone==null?void 0:l.clone())!==null&&a!==void 0?a:[0,0,0]};return i!=="only"&&(c.environment=n),i&&(c.background=n),Os(c,r),()=>{i!=="only"&&(c.environment=h),i&&(c.background=u),Os(c,f)}}function D4({scene:i,background:e=!1,map:t,...n}){const r=Ve(s=>s.scene);return C.useLayoutEffect(()=>{if(t)return y8(e,i,r,t,n)}),null}function v8({background:i=!1,scene:e,blur:t,backgroundBlurriness:n,backgroundIntensity:r,backgroundRotation:s,environmentIntensity:o,environmentRotation:a,...l}){const c=bx(l),u=Ve(h=>h.scene);return C.useLayoutEffect(()=>y8(i,e,u,c,{backgroundBlurriness:t??n,backgroundIntensity:r,backgroundRotation:s,environmentIntensity:o,environmentRotation:a})),C.useEffect(()=>()=>{c.dispose()},[c]),null}function Xj({children:i,near:e=.1,far:t=1e3,resolution:n=256,frames:r=1,map:s,background:o=!1,blur:a,backgroundBlurriness:l,backgroundIntensity:c,backgroundRotation:u,environmentIntensity:h,environmentRotation:f,scene:d,files:m,path:y,preset:g=void 0,extensions:A}){const E=Ve(L=>L.gl),x=Ve(L=>L.scene),w=C.useRef(null),[T]=C.useState(()=>new Mu),I=C.useMemo(()=>{const L=new wA(n);return L.texture.type=Ni,L},[n]);C.useEffect(()=>()=>{I.dispose()},[I]),C.useLayoutEffect(()=>{if(r===1){const L=E.autoClear;E.autoClear=!0,w.current.update(E,T),E.autoClear=L}return y8(o,d,x,I.texture,{backgroundBlurriness:a??l,backgroundIntensity:c,backgroundRotation:u,environmentIntensity:h,environmentRotation:f})},[i,T,I.texture,d,x,o,r,E]);let M=1;return Kt(()=>{if(r===1/0||M<r){const L=E.autoClear;E.autoClear=!0,w.current.update(E,T),E.autoClear=L,M++}}),C.createElement(C.Fragment,null,vp(C.createElement(C.Fragment,null,i,C.createElement("cubeCamera",{ref:w,args:[e,t,I]}),m||g?C.createElement(v8,{background:!0,files:m,preset:g,path:y,extensions:A}):s?C.createElement(D4,{background:!0,map:s,extensions:A}):null),T))}function l2e(i){var e,t,n,r;const s=bx(i),o=i.map||s;C.useMemo(()=>Or({GroundProjectedEnvImpl:Lle}),[]),C.useEffect(()=>()=>{s.dispose()},[s]);const a=C.useMemo(()=>[o],[o]),l=(e=i.ground)==null?void 0:e.height,c=(t=i.ground)==null?void 0:t.radius,u=(n=(r=i.ground)==null?void 0:r.scale)!==null&&n!==void 0?n:1e3;return C.createElement(C.Fragment,null,C.createElement(D4,ot({},i,{map:o})),C.createElement("groundProjectedEnvImpl",{args:a,scale:u,height:l,radius:c}))}function qj(i){return i.ground?C.createElement(l2e,i):i.map?C.createElement(D4,i):i.children?C.createElement(Xj,i):C.createElement(v8,i)}const Jj=C.forwardRef(({scale:i=10,frames:e=1/0,opacity:t=1,width:n=1,height:r=1,blur:s=1,near:o=0,far:a=10,resolution:l=512,smooth:c=!0,color:u="#000000",depthWrite:h=!1,renderOrder:f,...d},m)=>{const y=C.useRef(null),g=Ve(G=>G.scene),A=Ve(G=>G.gl),E=C.useRef(null);n=n*(Array.isArray(i)?i[0]:i||1),r=r*(Array.isArray(i)?i[1]:i||1);const[x,w,T,I,M,L,P]=C.useMemo(()=>{const G=new Si(l,l),X=new Si(l,l);X.texture.generateMipmaps=G.texture.generateMipmaps=!1;const Z=new Fs(n,r).rotateX(Math.PI/2),oe=new It(Z),K=new ax;K.depthTest=K.depthWrite=!1,K.onBeforeCompile=F=>{F.uniforms={...F.uniforms,ucolor:{value:new ut(u)}},F.fragmentShader=F.fragmentShader.replace("void main() {",`uniform vec3 ucolor;
           void main() {
          `),F.fragmentShader=F.fragmentShader.replace("vec4( vec3( 1.0 - fragCoordZ ), opacity );","vec4( ucolor * fragCoordZ * 2.0, ( 1.0 - fragCoordZ ) * 1.0 );")};const V=new Mi(pue),W=new Mi(mue);return W.depthTest=V.depthTest=!1,[G,Z,K,oe,V,W,X]},[l,n,r,i,u]),R=G=>{I.visible=!0,I.material=M,M.uniforms.tDiffuse.value=x.texture,M.uniforms.h.value=G*1/256,A.setRenderTarget(P),A.render(I,E.current),I.material=L,L.uniforms.tDiffuse.value=P.texture,L.uniforms.v.value=G*1/256,A.setRenderTarget(x),A.render(I,E.current),I.visible=!1};let U=0,k,H;return Kt(()=>{E.current&&(e===1/0||U<e)&&(U++,k=g.background,H=g.overrideMaterial,y.current.visible=!1,g.background=null,g.overrideMaterial=T,A.setRenderTarget(x),A.render(g,E.current),R(s),c&&R(s*.4),A.setRenderTarget(null),y.current.visible=!0,g.overrideMaterial=H,g.background=k)}),C.useImperativeHandle(m,()=>y.current,[]),C.createElement("group",ot({"rotation-x":Math.PI/2},d,{ref:y}),C.createElement("mesh",{renderOrder:f,geometry:w,scale:[1,-1,1],rotation:[-Math.PI/2,0,0]},C.createElement("meshBasicMaterial",{transparent:!0,map:x.texture,opacity:t,depthWrite:h})),C.createElement("orthographicCamera",{ref:E,args:[-n/2,n/2,r/2,-r/2,o,a]}))});function c2e(i){return i.isLight}function u2e(i){return!!i.geometry}const x8=C.createContext(null),h2e=Ec({color:new ut,blend:2,alphaTest:.75,opacity:0,map:null},`varying vec2 vUv;
   void main() {
     gl_Position = projectionMatrix * viewMatrix * modelMatrix * vec4(position, 1.);
     vUv = uv;
   }`,`varying vec2 vUv;
   uniform sampler2D map;
   uniform vec3 color;
   uniform float opacity;
   uniform float alphaTest;
   uniform float blend;
   void main() {
     vec4 sampledDiffuseColor = texture2D(map, vUv);
     gl_FragColor = vec4(color * sampledDiffuseColor.r * blend, max(0.0, (1.0 - (sampledDiffuseColor.r + sampledDiffuseColor.g + sampledDiffuseColor.b) / alphaTest)) * opacity);
     #include <tonemapping_fragment>
     #include <${ea>=154?"colorspace_fragment":"encodings_fragment"}>
   }`),Zj=C.forwardRef(({children:i,temporal:e,frames:t=40,limit:n=1/0,blend:r=20,scale:s=10,opacity:o=1,alphaTest:a=.75,color:l="black",colorBlend:c=2,resolution:u=1024,toneMapped:h=!0,...f},d)=>{Or({SoftShadowMaterial:h2e});const m=Ve(I=>I.gl),y=Ve(I=>I.scene),g=Ve(I=>I.camera),A=Ve(I=>I.invalidate),E=C.useRef(null),x=C.useRef(null),[w]=C.useState(()=>new f2e(m,y,u));C.useLayoutEffect(()=>{w.configure(E.current)},[]);const T=C.useMemo(()=>({lights:new Map,temporal:!!e,frames:Math.max(2,t),blend:Math.max(2,t===1/0?r:t),count:0,getMesh:()=>E.current,reset:()=>{w.clear();const I=E.current.material;I.opacity=0,I.alphaTest=0,T.count=0},update:(I=1)=>{const M=E.current.material;T.temporal?(M.opacity=Math.min(o,M.opacity+o/T.blend),M.alphaTest=Math.min(a,M.alphaTest+a/T.blend)):(M.opacity=o,M.alphaTest=a),x.current.visible=!0,w.prepare();for(let L=0;L<I;L++)T.lights.forEach(P=>P.update()),w.update(g,T.blend);x.current.visible=!1,w.finish()}}),[w,g,y,e,t,r,o,a]);return C.useLayoutEffect(()=>{T.reset(),!T.temporal&&T.frames!==1/0&&T.update(T.blend)}),C.useImperativeHandle(d,()=>T,[T]),Kt(()=>{(T.temporal||T.frames===1/0)&&T.count<T.frames&&T.count<n&&(A(),T.update(),T.count++)}),C.createElement("group",f,C.createElement("group",{traverse:()=>null,ref:x},C.createElement(x8.Provider,{value:T},i)),C.createElement("mesh",{receiveShadow:!0,ref:E,scale:s,rotation:[-Math.PI/2,0,0]},C.createElement("planeGeometry",null),C.createElement("softShadowMaterial",{transparent:!0,depthWrite:!1,toneMapped:h,color:l,blend:c,map:w.progressiveLightMap2.texture})))}),eW=C.forwardRef(({castShadow:i=!0,bias:e=.001,mapSize:t=512,size:n=5,near:r=.5,far:s=500,frames:o=1,position:a=[0,0,0],radius:l=1,amount:c=8,intensity:u=ea>=155?Math.PI:1,ambient:h=.5,...f},d)=>{const m=C.useRef(null),y=new Q(...a).length(),g=C.useContext(x8),A=C.useCallback(()=>{let x;if(m.current)for(let w=0;w<m.current.children.length;w++)if(x=m.current.children[w],Math.random()>h)x.position.set(a[0]+un.randFloatSpread(l),a[1]+un.randFloatSpread(l),a[2]+un.randFloatSpread(l));else{let T=Math.acos(2*Math.random()-1)-Math.PI/2,I=2*Math.PI*Math.random();x.position.set(Math.cos(T)*Math.cos(I)*y,Math.abs(Math.cos(T)*Math.sin(I)*y),Math.sin(T)*y)}},[l,h,y,...a]),E=C.useMemo(()=>({update:A}),[A]);return C.useImperativeHandle(d,()=>E,[E]),C.useLayoutEffect(()=>{var x;const w=m.current;return g&&((x=g.lights)==null||x.set(w.uuid,E)),()=>{var T;return void(g==null||(T=g.lights)==null?void 0:T.delete(w.uuid))}},[g,E]),C.createElement("group",ot({ref:m},f),Array.from({length:c},(x,w)=>C.createElement("directionalLight",{key:w,castShadow:i,"shadow-bias":e,"shadow-mapSize":[t,t],intensity:u/c},C.createElement("orthographicCamera",{attach:"shadow-camera",args:[-n,n,n,-n,r,s]}))))});class f2e{constructor(e,t,n=1024){this.renderer=e,this.res=n,this.scene=t,this.buffer1Active=!1,this.lights=[],this.meshes=[],this.object=null,this.clearColor=new ut,this.clearAlpha=0;const r={type:Ni,magFilter:zn,minFilter:zn};this.progressiveLightMap1=new Si(this.res,this.res,r),this.progressiveLightMap2=new Si(this.res,this.res,r),this.discardMat=new f8,this.targetMat=new mx({fog:!1}),this.previousShadowMap={value:this.progressiveLightMap1.texture},this.averagingWindow={value:100},this.targetMat.onBeforeCompile=s=>{s.vertexShader=`varying vec2 vUv;
`+s.vertexShader.slice(0,-1)+"vUv = uv; gl_Position = vec4((uv - 0.5) * 2.0, 1.0, 1.0); }";const o=s.fragmentShader.indexOf("void main() {");s.fragmentShader=`varying vec2 vUv;
`+s.fragmentShader.slice(0,o)+`uniform sampler2D previousShadowMap;
	uniform float averagingWindow;
`+s.fragmentShader.slice(o-1,-1)+`
vec3 texelOld = texture2D(previousShadowMap, vUv).rgb;
        gl_FragColor.rgb = mix(texelOld, gl_FragColor.rgb, 1.0/ averagingWindow);
      }`,s.uniforms.previousShadowMap=this.previousShadowMap,s.uniforms.averagingWindow=this.averagingWindow}}clear(){this.renderer.getClearColor(this.clearColor),this.clearAlpha=this.renderer.getClearAlpha(),this.renderer.setClearColor("black",1),this.renderer.setRenderTarget(this.progressiveLightMap1),this.renderer.clear(),this.renderer.setRenderTarget(this.progressiveLightMap2),this.renderer.clear(),this.renderer.setRenderTarget(null),this.renderer.setClearColor(this.clearColor,this.clearAlpha),this.lights=[],this.meshes=[],this.scene.traverse(e=>{u2e(e)?this.meshes.push({object:e,material:e.material}):c2e(e)&&this.lights.push({object:e,intensity:e.intensity})})}prepare(){this.lights.forEach(e=>e.object.intensity=0),this.meshes.forEach(e=>e.object.material=this.discardMat)}finish(){this.lights.forEach(e=>e.object.intensity=e.intensity),this.meshes.forEach(e=>e.object.material=e.material)}configure(e){this.object=e}update(e,t=100){if(!this.object)return;this.averagingWindow.value=t,this.object.material=this.targetMat;const n=this.buffer1Active?this.progressiveLightMap1:this.progressiveLightMap2,r=this.buffer1Active?this.progressiveLightMap2:this.progressiveLightMap1,s=this.scene.background;this.scene.background=null,this.renderer.setRenderTarget(n),this.previousShadowMap.value=r.texture,this.buffer1Active=!this.buffer1Active,this.renderer.render(this.scene,e),this.renderer.setRenderTarget(null),this.scene.background=s}}const d2e={rembrandt:{main:[1,2,1],fill:[-2,-.5,-2]},portrait:{main:[-1,2,.5],fill:[-1,.5,-1.5]},upfront:{main:[0,2,1],fill:[-1,.5,-1.5]},soft:{main:[-2,4,4],fill:[-1,.5,-1.5]}};function p2e({radius:i,adjustCamera:e}){const t=Vj();return C.useEffect(()=>{e&&t.refresh().clip().fit()},[i,e]),null}function m2e({children:i,center:e,adjustCamera:t=!0,intensity:n=.5,shadows:r="contact",environment:s="city",preset:o="rembrandt",...a}){var l,c,u,h,f,d,m,y;const g=typeof o=="string"?d2e[o]:o,[{radius:A,height:E},x]=C.useState({radius:0,width:0,height:0,depth:0}),w=(l=r==null?void 0:r.bias)!==null&&l!==void 0?l:-1e-4,T=(c=r==null?void 0:r.normalBias)!==null&&c!==void 0?c:0,I=(u=r==null?void 0:r.size)!==null&&u!==void 0?u:1024,M=(h=r==null?void 0:r.offset)!==null&&h!==void 0?h:0,L=r==="contact"||(r==null?void 0:r.type)==="contact",P=r==="accumulative"||(r==null?void 0:r.type)==="accumulative",R={...typeof r=="object"?r:{}},U=s?typeof s=="string"?{preset:s}:s:null,k=C.useCallback(H=>{const{width:G,height:X,depth:Z,boundingSphere:oe}=H;x({radius:oe.radius,width:G,height:X,depth:Z}),e!=null&&e.onCentered&&e.onCentered(H)},[]);return C.createElement(C.Fragment,null,C.createElement("ambientLight",{intensity:n/3}),C.createElement("spotLight",{penumbra:1,position:[g.main[0]*A,g.main[1]*A,g.main[2]*A],intensity:n*2,castShadow:!!r,"shadow-bias":w,"shadow-normalBias":T,"shadow-mapSize":I}),C.createElement("pointLight",{position:[g.fill[0]*A,g.fill[1]*A,g.fill[2]*A],intensity:n}),C.createElement(Qj,ot({fit:!!t,clip:!!t,margin:Number(t),observe:!0},a),C.createElement(p2e,{radius:A,adjustCamera:t}),C.createElement(h8,ot({},e,{position:[0,M/2,0],onCentered:k}),i)),C.createElement("group",{position:[0,-E/2-M/2,0]},L&&C.createElement(Jj,ot({scale:A*4,far:A,blur:2},R)),P&&C.createElement(Zj,ot({temporal:!0,frames:100,alphaTest:.9,toneMapped:!0,scale:A*4},R),C.createElement(eW,{amount:(f=R.amount)!==null&&f!==void 0?f:8,radius:(d=R.radius)!==null&&d!==void 0?d:A,ambient:(m=R.ambient)!==null&&m!==void 0?m:.5,intensity:(y=R.intensity)!==null&&y!==void 0?y:1,position:[g.main[0]*A,g.main[1]*A,g.main[2]*A],size:A*4,bias:-w,mapSize:I}))),s&&C.createElement(qj,U))}const g2e=i=>i===0?0:Math.pow(2,10*i-10);function A2e({children:i,floor:e=.25,segments:t=20,receiveShadow:n,...r}){const s=C.useRef(null);return C.useLayoutEffect(()=>{let o=0;const a=t/t/2,l=s.current.attributes.position;for(let c=0;c<t+1;c++)for(let u=0;u<t+1;u++)l.setXYZ(o++,c/t-a+(c===0?-e:0),u/t-a,g2e(c/t));l.needsUpdate=!0,s.current.computeVertexNormals()},[t,e]),C.createElement("group",r,C.createElement("mesh",{receiveShadow:n,rotation:[-Math.PI/2,0,Math.PI/2]},C.createElement("planeGeometry",{ref:s,args:[1,1,t,t]}),i))}const y2e=C.forwardRef(({fog:i=!1,renderOrder:e,depthWrite:t=!1,colorStop:n=0,color:r="black",opacity:s=.5,...o},a)=>{const l=C.useMemo(()=>{const c=document.createElement("canvas");c.width=128,c.height=128;const u=c.getContext("2d"),h=u.createRadialGradient(c.width/2,c.height/2,0,c.width/2,c.height/2,c.width/2);return h.addColorStop(n,new ut(r).getStyle()),h.addColorStop(1,"rgba(0,0,0,0)"),u.fillStyle=h,u.fillRect(0,0,c.width,c.height),c},[r,n]);return C.createElement("mesh",ot({renderOrder:e,ref:a,"rotation-x":-Math.PI/2},o),C.createElement("planeGeometry",null),C.createElement("meshBasicMaterial",{transparent:!0,opacity:s,fog:i,depthWrite:t,side:Li},C.createElement("canvasTexture",{attach:"map",args:[l]})))});function MF(i=tl){const e={value:new Xe};return Object.assign(new j6({side:i}),{viewMatrix:e,onBeforeCompile:t=>{t.uniforms.viewMatrix=e,t.fragmentShader=`vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
           return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
         }
`+t.fragmentShader.replace("#include <normal_fragment_maps>",`#include <normal_fragment_maps>
           normal = inverseTransformDirection( normal, viewMatrix );
`)}})}const v2e=Ec({causticsTexture:null,causticsTextureB:null,color:new ut,lightProjMatrix:new Xe,lightViewMatrix:new Xe},`varying vec3 vWorldPosition;
   void main() {
     gl_Position = projectionMatrix * viewMatrix * modelMatrix * vec4(position, 1.);
     vec4 worldPosition = modelMatrix * vec4(position, 1.);
     vWorldPosition = worldPosition.xyz;
   }`,`varying vec3 vWorldPosition;
  uniform vec3 color;
  uniform sampler2D causticsTexture;
  uniform sampler2D causticsTextureB;
  uniform mat4 lightProjMatrix;
  uniform mat4 lightViewMatrix;
   void main() {
    // Apply caustics
    vec4 lightSpacePos = lightProjMatrix * lightViewMatrix * vec4(vWorldPosition, 1.0);
    lightSpacePos.xyz /= lightSpacePos.w;
    lightSpacePos.xyz = lightSpacePos.xyz * 0.5 + 0.5;
    vec3 front = texture2D(causticsTexture, lightSpacePos.xy).rgb;
    vec3 back = texture2D(causticsTextureB, lightSpacePos.xy).rgb;
    gl_FragColor = vec4((front + back) * color, 1.0);
    #include <tonemapping_fragment>
    #include <${ea>=154?"colorspace_fragment":"encodings_fragment"}>
   }`),x2e=Ec({cameraMatrixWorld:new Xe,cameraProjectionMatrixInv:new Xe,normalTexture:null,depthTexture:null,lightDir:new Q(0,1,0),lightPlaneNormal:new Q(0,1,0),lightPlaneConstant:0,near:.1,far:100,modelMatrix:new Xe,worldRadius:1/40,ior:1.1,bounces:0,resolution:1024,size:10,intensity:.5},`
  varying vec2 vUv;
  void main() {
      vUv = uv;
      gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
  }`,`
  uniform mat4 cameraMatrixWorld;
  uniform mat4 cameraProjectionMatrixInv;
  uniform vec3 lightDir;
  uniform vec3 lightPlaneNormal;
  uniform float lightPlaneConstant;
  uniform float near;
  uniform float far;
  uniform float time;
  uniform float worldRadius;
  uniform float resolution;
  uniform float size;
  uniform float intensity;
  uniform float ior;
  precision highp isampler2D;
  precision highp usampler2D;
  uniform sampler2D normalTexture;
  uniform sampler2D depthTexture;
  uniform float bounces;
  varying vec2 vUv;
  vec3 WorldPosFromDepth(float depth, vec2 coord) {
    float z = depth * 2.0 - 1.0;
    vec4 clipSpacePosition = vec4(coord * 2.0 - 1.0, z, 1.0);
    vec4 viewSpacePosition = cameraProjectionMatrixInv * clipSpacePosition;
    // Perspective division
    viewSpacePosition /= viewSpacePosition.w;
    vec4 worldSpacePosition = cameraMatrixWorld * viewSpacePosition;
    return worldSpacePosition.xyz;
  }
  float sdPlane( vec3 p, vec3 n, float h ) {
    // n must be normalized
    return dot(p,n) + h;
  }
  float planeIntersect( vec3 ro, vec3 rd, vec4 p ) {
    return -(dot(ro,p.xyz)+p.w)/dot(rd,p.xyz);
  }
  vec3 totalInternalReflection(vec3 ro, vec3 rd, vec3 pos, vec3 normal, float ior, out vec3 rayOrigin, out vec3 rayDirection) {
    rayOrigin = ro;
    rayDirection = rd;
    rayDirection = refract(rayDirection, normal, 1.0 / ior);
    rayOrigin = pos + rayDirection * 0.1;
    return rayDirection;
  }
  void main() {
    // Each sample consists of random offset in the x and y direction
    float caustic = 0.0;
    float causticTexelSize = (1.0 / resolution) * size * 2.0;
    float texelsNeeded = worldRadius / causticTexelSize;
    float sampleRadius = texelsNeeded / resolution;
    float sum = 0.0;
    if (texture2D(depthTexture, vUv).x == 1.0) {
      gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);
      return;
    }
    vec2 offset1 = vec2(-0.5, -0.5);//vec2(rand() - 0.5, rand() - 0.5);
    vec2 offset2 = vec2(-0.5, 0.5);//vec2(rand() - 0.5, rand() - 0.5);
    vec2 offset3 = vec2(0.5, 0.5);//vec2(rand() - 0.5, rand() - 0.5);
    vec2 offset4 = vec2(0.5, -0.5);//vec2(rand() - 0.5, rand() - 0.5);
    vec2 uv1 = vUv + offset1 * sampleRadius;
    vec2 uv2 = vUv + offset2 * sampleRadius;
    vec2 uv3 = vUv + offset3 * sampleRadius;
    vec2 uv4 = vUv + offset4 * sampleRadius;
    vec3 normal1 = texture2D(normalTexture, uv1, -10.0).rgb * 2.0 - 1.0;
    vec3 normal2 = texture2D(normalTexture, uv2, -10.0).rgb * 2.0 - 1.0;
    vec3 normal3 = texture2D(normalTexture, uv3, -10.0).rgb * 2.0 - 1.0;
    vec3 normal4 = texture2D(normalTexture, uv4, -10.0).rgb * 2.0 - 1.0;
    float depth1 = texture2D(depthTexture, uv1, -10.0).x;
    float depth2 = texture2D(depthTexture, uv2, -10.0).x;
    float depth3 = texture2D(depthTexture, uv3, -10.0).x;
    float depth4 = texture2D(depthTexture, uv4, -10.0).x;
    // Sanity check the depths
    if (depth1 == 1.0 || depth2 == 1.0 || depth3 == 1.0 || depth4 == 1.0) {
      gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);
      return;
    }
    vec3 pos1 = WorldPosFromDepth(depth1, uv1);
    vec3 pos2 = WorldPosFromDepth(depth2, uv2);
    vec3 pos3 = WorldPosFromDepth(depth3, uv3);
    vec3 pos4 = WorldPosFromDepth(depth4, uv4);
    vec3 originPos1 = WorldPosFromDepth(0.0, uv1);
    vec3 originPos2 = WorldPosFromDepth(0.0, uv2);
    vec3 originPos3 = WorldPosFromDepth(0.0, uv3);
    vec3 originPos4 = WorldPosFromDepth(0.0, uv4);
    vec3 endPos1, endPos2, endPos3, endPos4;
    vec3 endDir1, endDir2, endDir3, endDir4;
    totalInternalReflection(originPos1, lightDir, pos1, normal1, ior, endPos1, endDir1);
    totalInternalReflection(originPos2, lightDir, pos2, normal2, ior, endPos2, endDir2);
    totalInternalReflection(originPos3, lightDir, pos3, normal3, ior, endPos3, endDir3);
    totalInternalReflection(originPos4, lightDir, pos4, normal4, ior, endPos4, endDir4);
    float lightPosArea = length(cross(originPos2 - originPos1, originPos3 - originPos1)) + length(cross(originPos3 - originPos1, originPos4 - originPos1));
    float t1 = planeIntersect(endPos1, endDir1, vec4(lightPlaneNormal, lightPlaneConstant));
    float t2 = planeIntersect(endPos2, endDir2, vec4(lightPlaneNormal, lightPlaneConstant));
    float t3 = planeIntersect(endPos3, endDir3, vec4(lightPlaneNormal, lightPlaneConstant));
    float t4 = planeIntersect(endPos4, endDir4, vec4(lightPlaneNormal, lightPlaneConstant));
    vec3 finalPos1 = endPos1 + endDir1 * t1;
    vec3 finalPos2 = endPos2 + endDir2 * t2;
    vec3 finalPos3 = endPos3 + endDir3 * t3;
    vec3 finalPos4 = endPos4 + endDir4 * t4;
    float finalArea = length(cross(finalPos2 - finalPos1, finalPos3 - finalPos1)) + length(cross(finalPos3 - finalPos1, finalPos4 - finalPos1));
    caustic += intensity * (lightPosArea / finalArea);
    // Calculate the area of the triangle in light spaces
    gl_FragColor = vec4(vec3(max(caustic, 0.0)), 1.0);
  }`),RF={depth:!0,minFilter:Ln,magFilter:Ln,type:Zi},PF={minFilter:Bl,magFilter:Ln,type:fi,generateMipmaps:!0},E2e=C.forwardRef(({debug:i,children:e,frames:t=1,ior:n=1.1,color:r="white",causticsOnly:s=!1,backside:o=!1,backsideIOR:a=1.1,worldRadius:l=.3125,intensity:c=.05,resolution:u=2024,lightSource:h=[5,5,5],...f},d)=>{Or({CausticsProjectionMaterial:v2e});const m=C.useRef(null),y=C.useRef(null),g=C.useRef(null),A=C.useRef(null),E=Ve(re=>re.gl),x=a8(i&&y,Dz),w=Ea(u,u,RF),T=Ea(u,u,RF),I=Ea(u,u,PF),M=Ea(u,u,PF),[L]=C.useState(()=>MF()),[P]=C.useState(()=>MF(ys)),[R]=C.useState(()=>new x2e),[U]=C.useState(()=>new Tf(R));C.useLayoutEffect(()=>{m.current.updateWorldMatrix(!1,!0)});let k=0;const H=new Q,G=new f0,X=new Xe,Z=new vo,oe=new Q,K=new Q,V=new ti,W=new Q,F=[],Y=[],te=[],q=[],J=new Q;for(let re=0;re<8;re++)F.push(new Q),Y.push(new Q),te.push(new Q),q.push(new Q);return Kt(()=>{if(t===1/0||k++<t){var re,ie;Array.isArray(h)?oe.fromArray(h).normalize():oe.copy(m.current.worldToLocal(h.current.getWorldPosition(H)).normalize()),K.copy(oe).multiplyScalar(-1),(re=g.current.parent)==null||re.matrixWorld.identity(),V.setFromObject(g.current,!0),F[0].set(V.min.x,V.min.y,V.min.z),F[1].set(V.min.x,V.min.y,V.max.z),F[2].set(V.min.x,V.max.y,V.min.z),F[3].set(V.min.x,V.max.y,V.max.z),F[4].set(V.max.x,V.min.y,V.min.z),F[5].set(V.max.x,V.min.y,V.max.z),F[6].set(V.max.x,V.max.y,V.min.z),F[7].set(V.max.x,V.max.y,V.max.z);for(let ne=0;ne<8;ne++)Y[ne].copy(F[ne]);V.getCenter(W),F.map(ne=>ne.sub(W));const se=Z.set(K,0);F.map((ne,j)=>se.projectPoint(ne,te[j]));const ge=te.reduce((ne,j)=>ne.add(j),H.set(0,0,0)).divideScalar(te.length),xe=te.map(ne=>ne.distanceTo(ge)).reduce((ne,j)=>Math.max(ne,j)),pe=F.map(ne=>ne.dot(oe)).reduce((ne,j)=>Math.max(ne,j));y.current.position.copy(J.copy(oe).multiplyScalar(pe).add(W)),y.current.lookAt(g.current.localToWorld(W));const ue=X.lookAt(y.current.position,W,H.set(0,1,0));y.current.left=-xe,y.current.right=xe,y.current.top=xe,y.current.bottom=-xe;const Me=H.set(0,xe,0).applyMatrix4(ue),Se=(y.current.position.y+Me.y)/oe.y;y.current.near=.1,y.current.far=Se,y.current.updateProjectionMatrix(),y.current.updateMatrixWorld();const ve=Y.map((ne,j)=>ne.add(q[j].copy(oe).multiplyScalar(-ne.y/oe.y))),Ae=ve.reduce((ne,j)=>ne.add(j),H.set(0,0,0)).divideScalar(ve.length),ke=2*ve.map(ne=>Math.hypot(ne.x-Ae.x,ne.z-Ae.z)).reduce((ne,j)=>Math.max(ne,j));A.current.scale.setScalar(ke),A.current.position.copy(Ae),i&&((ie=x.current)==null||ie.update()),P.viewMatrix.value=L.viewMatrix.value=y.current.matrixWorldInverse;const be=G.setFromProjectionMatrix(X.multiplyMatrices(y.current.projectionMatrix,y.current.matrixWorldInverse)).planes[4];R.cameraMatrixWorld=y.current.matrixWorld,R.cameraProjectionMatrixInv=y.current.projectionMatrixInverse,R.lightDir=K,R.lightPlaneNormal=be.normal,R.lightPlaneConstant=be.constant,R.near=y.current.near,R.far=y.current.far,R.resolution=u,R.size=xe,R.intensity=c,R.worldRadius=l,g.current.visible=!0,E.setRenderTarget(w),E.clear(),g.current.overrideMaterial=L,E.render(g.current,y.current),E.setRenderTarget(T),E.clear(),o&&(g.current.overrideMaterial=P,E.render(g.current,y.current)),g.current.overrideMaterial=null,R.ior=n,A.current.material.lightProjMatrix=y.current.projectionMatrix,A.current.material.lightViewMatrix=y.current.matrixWorldInverse,R.normalTexture=w.texture,R.depthTexture=w.depthTexture,E.setRenderTarget(I),E.clear(),U.render(E),R.ior=a,R.normalTexture=T.texture,R.depthTexture=T.depthTexture,E.setRenderTarget(M),E.clear(),o&&U.render(E),E.setRenderTarget(null),s&&(g.current.visible=!1)}}),C.useImperativeHandle(d,()=>m.current,[]),C.createElement("group",ot({ref:m},f),C.createElement("scene",{ref:g},C.createElement("orthographicCamera",{ref:y,up:[0,1,0]}),e),C.createElement("mesh",{renderOrder:2,ref:A,"rotation-x":-Math.PI/2},C.createElement("planeGeometry",null),C.createElement("causticsProjectionMaterial",{transparent:!0,color:r,causticsTexture:I.texture,causticsTextureB:M.texture,blending:Aw,blendSrc:yw,blendDst:x2,depthWrite:!1}),i&&C.createElement(uQ,null,C.createElement("lineBasicMaterial",{color:"#ffff00",toneMapped:!1}))))}),_2e=C.forwardRef(({mixBlur:i=0,mixStrength:e=.5,resolution:t=256,blur:n=[0,0],args:r=[1,1],minDepthThreshold:s=.9,maxDepthThreshold:o=1,depthScale:a=0,depthToBlurRatioBias:l=.25,mirror:c=0,children:u,debug:h=0,distortion:f=1,mixContrast:d=1,distortionMap:m,...y},g)=>{Or({MeshReflectorMaterial:zj}),C.useEffect(()=>{console.warn("Reflector has been deprecated and will be removed next major. Replace it with <MeshReflectorMaterial />!")},[]);const A=Ve(({gl:te})=>te),E=Ve(({camera:te})=>te),x=Ve(({scene:te})=>te);n=Array.isArray(n)?n:[n,n];const w=n[0]+n[1]>0,T=C.useRef(null);C.useImperativeHandle(g,()=>T.current,[]);const[I]=C.useState(()=>new vo),[M]=C.useState(()=>new Q),[L]=C.useState(()=>new Q),[P]=C.useState(()=>new Q),[R]=C.useState(()=>new Xe),[U]=C.useState(()=>new Q(0,0,-1)),[k]=C.useState(()=>new Rn),[H]=C.useState(()=>new Q),[G]=C.useState(()=>new Q),[X]=C.useState(()=>new Rn),[Z]=C.useState(()=>new Xe),[oe]=C.useState(()=>new jn),K=C.useCallback(()=>{if(L.setFromMatrixPosition(T.current.matrixWorld),P.setFromMatrixPosition(E.matrixWorld),R.extractRotation(T.current.matrixWorld),M.set(0,0,1),M.applyMatrix4(R),H.subVectors(L,P),H.dot(M)>0)return;H.reflect(M).negate(),H.add(L),R.extractRotation(E.matrixWorld),U.set(0,0,-1),U.applyMatrix4(R),U.add(P),G.subVectors(L,U),G.reflect(M).negate(),G.add(L),oe.position.copy(H),oe.up.set(0,1,0),oe.up.applyMatrix4(R),oe.up.reflect(M),oe.lookAt(G),oe.far=E.far,oe.updateMatrixWorld(),oe.projectionMatrix.copy(E.projectionMatrix),Z.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),Z.multiply(oe.projectionMatrix),Z.multiply(oe.matrixWorldInverse),Z.multiply(T.current.matrixWorld),I.setFromNormalAndCoplanarPoint(M,L),I.applyMatrix4(oe.matrixWorldInverse),k.set(I.normal.x,I.normal.y,I.normal.z,I.constant);const te=oe.projectionMatrix;X.x=(Math.sign(k.x)+te.elements[8])/te.elements[0],X.y=(Math.sign(k.y)+te.elements[9])/te.elements[5],X.z=-1,X.w=(1+te.elements[10])/te.elements[14],k.multiplyScalar(2/k.dot(X)),te.elements[2]=k.x,te.elements[6]=k.y,te.elements[10]=k.z+1,te.elements[14]=k.w},[]),[V,W,F,Y]=C.useMemo(()=>{const te={type:Ni,minFilter:Ln,magFilter:Ln},q=new Si(t,t,te);q.depthBuffer=!0,q.depthTexture=new d0(t,t),q.depthTexture.format=vu,q.depthTexture.type=pp;const J=new Si(t,t,te),re=new Uj({gl:A,resolution:t,width:n[0],height:n[1],minDepthThreshold:s,maxDepthThreshold:o,depthScale:a,depthToBlurRatioBias:l}),ie={mirror:c,textureMatrix:Z,mixBlur:i,tDiffuse:q.texture,tDepth:q.depthTexture,tDiffuseBlur:J.texture,hasBlur:w,mixStrength:e,minDepthThreshold:s,maxDepthThreshold:o,depthScale:a,depthToBlurRatioBias:l,transparent:!0,debug:h,distortion:f,distortionMap:m,mixContrast:d,"defines-USE_BLUR":w?"":void 0,"defines-USE_DEPTH":a>0?"":void 0,"defines-USE_DISTORTION":m?"":void 0};return[q,J,re,ie]},[A,n,Z,t,c,w,i,e,s,o,a,l,h,f,m,d]);return Kt(()=>{if(!(T!=null&&T.current))return;T.current.visible=!1;const te=A.xr.enabled,q=A.shadowMap.autoUpdate;K(),A.xr.enabled=!1,A.shadowMap.autoUpdate=!1,A.setRenderTarget(V),A.state.buffers.depth.setMask(!0),A.autoClear||A.clear(),A.render(x,oe),w&&F.render(A,V,W),A.xr.enabled=te,A.shadowMap.autoUpdate=q,T.current.visible=!0,A.setRenderTarget(null)}),C.createElement("mesh",ot({ref:T},y),C.createElement("planeGeometry",{args:r}),u?u("meshReflectorMaterial",Y):C.createElement("meshReflectorMaterial",Y))});class S2e extends Mi{constructor(){super({uniforms:{depth:{value:null},opacity:{value:1},attenuation:{value:2.5},anglePower:{value:12},spotPosition:{value:new Q(0,0,0)},lightColor:{value:new ut("white")},cameraNear:{value:0},cameraFar:{value:1},resolution:{value:new Ue(0,0)}},transparent:!0,depthWrite:!1,vertexShader:`
        varying vec3 vNormal;
        varying float vViewZ;
        varying float vIntensity;
        uniform vec3 spotPosition;
        uniform float attenuation;

        #include <common>
        #include <logdepthbuf_pars_vertex>

        void main() {
          // compute intensity
          vNormal = normalize(normalMatrix * normal);
          vec4 worldPosition = modelMatrix * vec4(position, 1);
          vec4 viewPosition = viewMatrix * worldPosition;
          vViewZ = viewPosition.z;

          vIntensity = 1.0 - saturate(distance(worldPosition.xyz, spotPosition) / attenuation);

          gl_Position = projectionMatrix * viewPosition;

          #include <logdepthbuf_vertex>
        }
      `,fragmentShader:`
        varying vec3 vNormal;
        varying float vViewZ;
        varying float vIntensity;

        uniform vec3 lightColor;
        uniform float anglePower;
        uniform sampler2D depth;
        uniform vec2 resolution;
        uniform float cameraNear;
        uniform float cameraFar;
        uniform float opacity;

        #include <packing>
        #include <logdepthbuf_pars_fragment>

        float readDepth(sampler2D depthSampler, vec2 uv) {
          float fragCoordZ = texture(depthSampler, uv).r;

          // https://github.com/mrdoob/three.js/issues/23072
          #ifdef USE_LOGDEPTHBUF
            float viewZ = 1.0 - exp2(fragCoordZ * log(cameraFar + 1.0) / log(2.0));
          #else
            float viewZ = perspectiveDepthToViewZ(fragCoordZ, cameraNear, cameraFar);
          #endif

          return viewZ;
        }

        void main() {
          #include <logdepthbuf_fragment>

          vec3 normal = vec3(vNormal.x, vNormal.y, abs(vNormal.z));
          float angleIntensity = pow(dot(normal, vec3(0, 0, 1)), anglePower);
          float intensity = vIntensity * angleIntensity;

          // fades when z is close to sampled depth, meaning the cone is intersecting existing geometry
          bool isSoft = resolution[0] > 0.0 && resolution[1] > 0.0;
          if (isSoft) {
            vec2 uv = gl_FragCoord.xy / resolution;
            intensity *= smoothstep(0.0, 1.0, vViewZ - readDepth(depth, uv));
          }

          gl_FragColor = vec4(lightColor, intensity * opacity);

          #include <tonemapping_fragment>
          #include <${ea>=154?"colorspace_fragment":"encodings_fragment"}>
        }
      `})}}var w2e=`#define GLSLIFY 1
varying vec2 vUv;uniform sampler2D uShadowMap;uniform float uTime;void main(){vec3 color=texture2D(uShadowMap,vUv).xyz;gl_FragColor=vec4(color,1.);}`;const C2e=i=>i==null?void 0:i.isSpotLight;function T2e({opacity:i=1,radiusTop:e,radiusBottom:t,depthBuffer:n,color:r="white",distance:s=5,angle:o=.15,attenuation:a=5,anglePower:l=5}){const c=C.useRef(null),u=Ve(g=>g.size),h=Ve(g=>g.camera),f=Ve(g=>g.viewport.dpr),[d]=C.useState(()=>new S2e),[m]=C.useState(()=>new Q);e=e===void 0?.1:e,t=t===void 0?o*7:t,Kt(()=>{d.uniforms.spotPosition.value.copy(c.current.getWorldPosition(m)),c.current.lookAt(c.current.parent.target.getWorldPosition(m))});const y=C.useMemo(()=>{const g=new yo(e,t,s,128,64,!0);return g.applyMatrix4(new Xe().makeTranslation(0,-s/2,0)),g.applyMatrix4(new Xe().makeRotationX(-Math.PI/2)),g},[s,e,t]);return C.createElement(C.Fragment,null,C.createElement("mesh",{ref:c,geometry:y,raycast:()=>null},C.createElement("primitive",{object:d,attach:"material","uniforms-opacity-value":i,"uniforms-lightColor-value":r,"uniforms-attenuation-value":a,"uniforms-anglePower-value":l,"uniforms-depth-value":n,"uniforms-cameraNear-value":h.near,"uniforms-cameraFar-value":h.far,"uniforms-resolution-value":n?[u.width*f,u.height*f]:[0,0]})))}function tW(i,e,t,n,r){const[[s,o]]=C.useState(()=>[new Q,new Q]);C.useLayoutEffect(()=>{if(C2e(i.current))i.current.shadow.mapSize.set(t,n),i.current.shadow.needsUpdate=!0;else throw new Error("SpotlightShadow must be a child of a SpotLight")},[i,t,n]),Kt(()=>{if(!i.current)return;const a=i.current.position,l=i.current.target.position;o.copy(l).sub(a);var c=o.length();o.normalize().multiplyScalar(c*r),s.copy(a).add(o),e.current.position.copy(s),e.current.lookAt(i.current.target.position)})}function b2e({distance:i=.4,alphaTest:e=.5,map:t,shader:n=w2e,width:r=512,height:s=512,scale:o=1,children:a,...l}){const c=C.useRef(null),u=l.spotlightRef,h=l.debug;tW(u,c,r,s,i);const f=C.useMemo(()=>new Si(r,s,{format:gi,stencilBuffer:!1}),[r,s]),d=C.useRef({uShadowMap:{value:t},uTime:{value:0}});C.useEffect(()=>void(d.current.uShadowMap.value=t),[t]);const m=C.useMemo(()=>new Tf(new Mi({uniforms:d.current,vertexShader:`
          varying vec2 vUv;

          void main() {
            vUv = uv;
            gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
          }
          `,fragmentShader:n})),[n]);return C.useEffect(()=>()=>{m.material.dispose(),m.dispose()},[m]),C.useEffect(()=>()=>f.dispose(),[f]),Kt(({gl:y},g)=>{d.current.uTime.value+=g,y.setRenderTarget(f),m.render(y),y.setRenderTarget(null)}),C.createElement(C.Fragment,null,C.createElement("mesh",{ref:c,scale:o,castShadow:!0},C.createElement("planeGeometry",null),C.createElement("meshBasicMaterial",{transparent:!0,side:Li,alphaTest:e,alphaMap:f.texture,"alphaMap-wrapS":_o,"alphaMap-wrapT":_o,opacity:h?1:0},a)))}function I2e({distance:i=.4,alphaTest:e=.5,map:t,width:n=512,height:r=512,scale:s,children:o,...a}){const l=C.useRef(null),c=a.spotlightRef,u=a.debug;return tW(c,l,n,r,i),C.createElement(C.Fragment,null,C.createElement("mesh",{ref:l,scale:s,castShadow:!0},C.createElement("planeGeometry",null),C.createElement("meshBasicMaterial",{transparent:!0,side:Li,alphaTest:e,alphaMap:t,"alphaMap-wrapS":_o,"alphaMap-wrapT":_o,opacity:u?1:0},o)))}function M2e(i){return i.shader?C.createElement(b2e,i):C.createElement(I2e,i)}const R2e=C.forwardRef(({opacity:i=1,radiusTop:e,radiusBottom:t,depthBuffer:n,color:r="white",distance:s=5,angle:o=.15,attenuation:a=5,anglePower:l=5,volumetric:c=!0,debug:u=!1,children:h,...f},d)=>{const m=C.useRef(null);return C.useImperativeHandle(d,()=>m.current,[]),C.createElement("group",null,u&&m.current&&C.createElement("spotLightHelper",{args:[m.current]}),C.createElement("spotLight",ot({ref:m,angle:o,color:r,distance:s,castShadow:!0},f),c&&C.createElement(T2e,{debug:u,opacity:i,radiusTop:e,radiusBottom:t,depthBuffer:n,color:r,distance:s,angle:o,attenuation:a,anglePower:l})),h&&C.cloneElement(h,{spotlightRef:m,debug:u}))}),P2e=C.forwardRef(({light:i,args:e,map:t,toneMapped:n=!1,color:r="white",form:s="rect",intensity:o=1,scale:a=1,target:l=[0,0,0],children:c,...u},h)=>{const f=C.useRef(null);return C.useImperativeHandle(h,()=>f.current,[]),C.useLayoutEffect(()=>{!c&&!u.material&&(Os(f.current.material,{color:r}),f.current.material.color.multiplyScalar(o))},[r,o,c,u.material]),C.useLayoutEffect(()=>{u.rotation||f.current.quaternion.identity(),l&&!u.rotation&&(typeof l=="boolean"?f.current.lookAt(0,0,0):f.current.lookAt(Array.isArray(l)?new Q(...l):l))},[l,u.rotation]),a=Array.isArray(a)&&a.length===2?[a[0],a[1],1]:a,C.createElement("mesh",ot({ref:f,scale:a},u),s==="circle"?C.createElement("ringGeometry",{args:e||[0,.5,64]}):s==="ring"?C.createElement("ringGeometry",{args:e||[.25,.5,64]}):s==="rect"||s==="plane"?C.createElement("planeGeometry",{args:e||[1,1]}):s==="box"?C.createElement("boxGeometry",{args:e||[1,1,1]}):C.createElement(s,{args:e}),c||C.createElement("meshBasicMaterial",{toneMapped:n,map:t,side:Li}),i&&C.createElement("pointLight",ot({castShadow:!0},i)))});function nW(i,e,t=new Q){const n=Math.PI*(i-.5),r=2*Math.PI*(e-.5);return t.x=Math.cos(r),t.y=Math.sin(n),t.z=Math.sin(r),t}const L2e=C.forwardRef(({inclination:i=.6,azimuth:e=.1,distance:t=1e3,mieCoefficient:n=.005,mieDirectionalG:r=.8,rayleigh:s=.5,turbidity:o=10,sunPosition:a=nW(i,e),...l},c)=>{const u=C.useMemo(()=>new Q().setScalar(t),[t]),[h]=C.useState(()=>new Rle);return C.createElement("primitive",ot({object:h,ref:c,"material-uniforms-mieCoefficient-value":n,"material-uniforms-mieDirectionalG-value":r,"material-uniforms-rayleigh-value":s,"material-uniforms-sunPosition-value":a,"material-uniforms-turbidity-value":o,scale:u},l))});class B2e extends Mi{constructor(){super({uniforms:{time:{value:0},fade:{value:1}},vertexShader:`
      uniform float time;
      attribute float size;
      varying vec3 vColor;
      void main() {
        vColor = color;
        vec4 mvPosition = modelViewMatrix * vec4(position, 0.5);
        gl_PointSize = size * (30.0 / -mvPosition.z) * (3.0 + sin(time + 100.0));
        gl_Position = projectionMatrix * mvPosition;
      }`,fragmentShader:`
      uniform sampler2D pointTexture;
      uniform float fade;
      varying vec3 vColor;
      void main() {
        float opacity = 1.0;
        if (fade == 1.0) {
          float d = distance(gl_PointCoord, vec2(0.5, 0.5));
          opacity = 1.0 / (1.0 + exp(16.0 * (d - 0.25)));
        }
        gl_FragColor = vec4(vColor, opacity);

        #include <tonemapping_fragment>
	      #include <${ea>=154?"colorspace_fragment":"encodings_fragment"}>
      }`})}}const D2e=i=>new Q().setFromSpherical(new t0(i,Math.acos(1-Math.random()*2),Math.random()*2*Math.PI)),k2e=C.forwardRef(({radius:i=100,depth:e=50,count:t=5e3,saturation:n=0,factor:r=4,fade:s=!1,speed:o=1},a)=>{const l=C.useRef(),[c,u,h]=C.useMemo(()=>{const d=[],m=[],y=Array.from({length:t},()=>(.5+.5*Math.random())*r),g=new ut;let A=i+e;const E=e/t;for(let x=0;x<t;x++)A-=E*Math.random(),d.push(...D2e(A).toArray()),g.setHSL(x/t,n,.9),m.push(g.r,g.g,g.b);return[new Float32Array(d),new Float32Array(m),new Float32Array(y)]},[t,e,r,i,n]);Kt(d=>l.current&&(l.current.uniforms.time.value=d.clock.elapsedTime*o));const[f]=C.useState(()=>new B2e);return C.createElement("points",{ref:a},C.createElement("bufferGeometry",null,C.createElement("bufferAttribute",{attach:"attributes-position",args:[c,3]}),C.createElement("bufferAttribute",{attach:"attributes-color",args:[u,3]}),C.createElement("bufferAttribute",{attach:"attributes-size",args:[h,1]})),C.createElement("primitive",{ref:l,object:f,attach:"material",blending:xS,"uniforms-fade-value":s,depthWrite:!1,transparent:!0,vertexColors:!0}))}),F2e="https://rawcdn.githack.com/pmndrs/drei-assets/9225a9f1fbd449d9411125c2f419b843d0308c9f/cloud.png",LF=new Xe,I_=new Q,M_=new Xt,BF=new Q,DF=new Xt,Iv=new Q,E8=C.createContext(null),iW=C.forwardRef(({children:i,material:e=mx,texture:t=F2e,range:n,limit:r=200,frustumCulled:s,...o},a)=>{var l,c;const u=C.useMemo(()=>class extends e{constructor(){super();const L=parseInt(dp.replace(/\D+/g,""))>=154?"opaque_fragment":"output_fragment";this.onBeforeCompile=P=>{P.vertexShader=`attribute float cloudOpacity;
               varying float vOpacity;
              `+P.vertexShader.replace("#include <fog_vertex>",`#include <fog_vertex>
                 vOpacity = cloudOpacity;
                `),P.fragmentShader=`varying float vOpacity;
              `+P.fragmentShader.replace(`#include <${L}>`,`#include <${L}>
                 gl_FragColor = vec4(outgoingLight, diffuseColor.a * vOpacity);
                `)}}},[e]);Or({CloudMaterial:u});const h=C.useRef(null),f=C.useRef([]),d=C.useMemo(()=>new Float32Array(Array.from({length:r},()=>1)),[r]),m=C.useMemo(()=>new Float32Array(Array.from({length:r},()=>[1,1,1]).flat()),[r]),y=xp(t);let g=0,A=0,E;const x=new Xt,w=new Q(0,0,1),T=new Q;Kt((L,P)=>{for(g=L.clock.elapsedTime,LF.copy(h.current.matrixWorld).invert(),L.camera.matrixWorld.decompose(BF,DF,Iv),A=0;A<f.current.length;A++)E=f.current[A],E.ref.current.matrixWorld.decompose(I_,M_,Iv),I_.add(T.copy(E.position).applyQuaternion(M_).multiply(Iv)),M_.copy(DF).multiply(x.setFromAxisAngle(w,E.rotation+=P*E.rotationFactor)),Iv.multiplyScalar(E.volume+(1+Math.sin(g*E.density*E.speed))/2*E.growth),E.matrix.compose(I_,M_,Iv).premultiply(LF),E.dist=I_.distanceTo(BF);for(f.current.sort((R,U)=>U.dist-R.dist),A=0;A<f.current.length;A++)E=f.current[A],d[A]=E.opacity*(E.dist<E.fade-1?E.dist/E.fade:1),h.current.setMatrixAt(A,E.matrix),h.current.setColorAt(A,E.color);h.current.geometry.attributes.cloudOpacity.needsUpdate=!0,h.current.instanceMatrix.needsUpdate=!0,h.current.instanceColor&&(h.current.instanceColor.needsUpdate=!0)}),C.useLayoutEffect(()=>{const L=Math.min(r,n!==void 0?n:r,f.current.length);h.current.count=L,m2(h.current.instanceMatrix,{offset:0,count:L*16}),h.current.instanceColor&&m2(h.current.instanceColor,{offset:0,count:L*3}),m2(h.current.geometry.attributes.cloudOpacity,{offset:0,count:L})});let I=[(l=y.image.width)!==null&&l!==void 0?l:1,(c=y.image.height)!==null&&c!==void 0?c:1];const M=Math.max(I[0],I[1]);return I=[I[0]/M,I[1]/M],C.createElement("group",ot({ref:a},o),C.createElement(E8.Provider,{value:f},i,C.createElement("instancedMesh",{matrixAutoUpdate:!1,ref:h,args:[null,null,r],frustumCulled:s},C.createElement("instancedBufferAttribute",{usage:No,attach:"instanceColor",args:[m,3]}),C.createElement("planeGeometry",{args:[...I]},C.createElement("instancedBufferAttribute",{usage:No,attach:"attributes-cloudOpacity",args:[d,1]})),C.createElement("cloudMaterial",{key:e.name,map:y,transparent:!0,depthWrite:!1}))))}),K5=C.forwardRef(({opacity:i=1,speed:e=0,bounds:t=[5,1,1],segments:n=20,color:r="#ffffff",fade:s=10,volume:o=6,smallestVolume:a=.25,distribute:l=null,growth:c=4,concentrate:u="inside",seed:h=Math.random(),...f},d)=>{function m(){const x=Math.sin(h++)*1e4;return x-Math.floor(x)}const y=C.useContext(E8),g=C.useRef(null),A=C.useId(),E=C.useMemo(()=>[...new Array(n)].map((x,w)=>({segments:n,bounds:new Q(1,1,1),position:new Q,uuid:A,index:w,ref:g,dist:0,matrix:new Xe,color:new ut,rotation:w*(Math.PI/n)})),[n,A]);return C.useLayoutEffect(()=>{E.forEach((x,w)=>{Os(x,{volume:o,color:r,speed:e,growth:c,opacity:i,fade:s,bounds:t,density:Math.max(.5,m()),rotationFactor:Math.max(.2,.5*m())*e});const T=l==null?void 0:l(x,w);if(T||n>1){var I;x.position.copy(x.bounds).multiply((I=T==null?void 0:T.point)!==null&&I!==void 0?I:{x:m()*2-1,y:m()*2-1,z:m()*2-1})}const M=Math.abs(x.position.x),L=Math.abs(x.position.y),P=Math.abs(x.position.z),R=Math.max(M,L,P);x.length=1,M===R&&(x.length-=M/x.bounds.x),L===R&&(x.length-=L/x.bounds.y),P===R&&(x.length-=P/x.bounds.z),x.volume=((T==null?void 0:T.volume)!==void 0?T.volume:Math.max(Math.max(0,a),u==="random"?m():u==="inside"?x.length:1-x.length))*o})},[u,t,s,r,i,c,o,h,n,e]),C.useLayoutEffect(()=>{const x=E;return y.current=[...y.current,...x],()=>{y.current=y.current.filter(w=>w.uuid!==A)}},[E]),C.useImperativeHandle(d,()=>g.current,[]),C.createElement("group",ot({ref:g},f))}),O2e=C.forwardRef((i,e)=>C.useContext(E8)?C.createElement(K5,ot({ref:e},i)):C.createElement(iW,null,C.createElement(K5,ot({ref:e},i))));class N2e extends Mi{constructor(){super({uniforms:{time:{value:0},pixelRatio:{value:1}},vertexShader:`
        uniform float pixelRatio;
        uniform float time;
        attribute float size;  
        attribute float speed;  
        attribute float opacity;
        attribute vec3 noise;
        attribute vec3 color;
        varying vec3 vColor;
        varying float vOpacity;

        void main() {
          vec4 modelPosition = modelMatrix * vec4(position, 1.0);
          modelPosition.y += sin(time * speed + modelPosition.x * noise.x * 100.0) * 0.2;
          modelPosition.z += cos(time * speed + modelPosition.x * noise.y * 100.0) * 0.2;
          modelPosition.x += cos(time * speed + modelPosition.x * noise.z * 100.0) * 0.2;
          vec4 viewPosition = viewMatrix * modelPosition;
          vec4 projectionPostion = projectionMatrix * viewPosition;
          gl_Position = projectionPostion;
          gl_PointSize = size * 25. * pixelRatio;
          gl_PointSize *= (1.0 / - viewPosition.z);
          vColor = color;
          vOpacity = opacity;
        }
      `,fragmentShader:`
        varying vec3 vColor;
        varying float vOpacity;
        void main() {
          float distanceToCenter = distance(gl_PointCoord, vec2(0.5));
          float strength = 0.05 / distanceToCenter - 0.1;
          gl_FragColor = vec4(vColor, strength * vOpacity);
          #include <tonemapping_fragment>
          #include <${ea>=154?"colorspace_fragment":"encodings_fragment"}>
        }
      `})}get time(){return this.uniforms.time.value}set time(e){this.uniforms.time.value=e}get pixelRatio(){return this.uniforms.pixelRatio.value}set pixelRatio(e){this.uniforms.pixelRatio.value=e}}const rW=i=>i&&i.constructor===Float32Array,U2e=i=>[i.r,i.g,i.b],sW=i=>i instanceof Ue||i instanceof Q||i instanceof Rn,oW=i=>Array.isArray(i)?i:sW(i)?i.toArray():[i,i,i];function Mv(i,e,t){return C.useMemo(()=>{if(e!==void 0){if(rW(e))return e;if(e instanceof ut){const n=Array.from({length:i*3},()=>U2e(e)).flat();return Float32Array.from(n)}else if(sW(e)||Array.isArray(e)){const n=Array.from({length:i*3},()=>oW(e)).flat();return Float32Array.from(n)}return Float32Array.from({length:i},()=>e)}return Float32Array.from({length:i},t)},[e])}const z2e=C.forwardRef(({noise:i=1,count:e=100,speed:t=1,opacity:n=1,scale:r=1,size:s,color:o,children:a,...l},c)=>{C.useMemo(()=>Or({SparklesImplMaterial:N2e}),[]);const u=C.useRef(null),h=Ve(x=>x.viewport.dpr),f=oW(r),d=C.useMemo(()=>Float32Array.from(Array.from({length:e},()=>f.map(un.randFloatSpread)).flat()),[e,...f]),m=Mv(e,s,Math.random),y=Mv(e,n),g=Mv(e,t),A=Mv(e*3,i),E=Mv(o===void 0?e*3:e,rW(o)?o:new ut(o),()=>1);return Kt(x=>{u.current&&u.current.material&&(u.current.material.time=x.clock.elapsedTime)}),C.useImperativeHandle(c,()=>u.current,[]),C.createElement("points",ot({key:`particle-${e}-${JSON.stringify(r)}`},l,{ref:u}),C.createElement("bufferGeometry",null,C.createElement("bufferAttribute",{attach:"attributes-position",args:[d,3]}),C.createElement("bufferAttribute",{attach:"attributes-size",args:[m,1]}),C.createElement("bufferAttribute",{attach:"attributes-opacity",args:[y,1]}),C.createElement("bufferAttribute",{attach:"attributes-speed",args:[g,1]}),C.createElement("bufferAttribute",{attach:"attributes-color",args:[E,3]}),C.createElement("bufferAttribute",{attach:"attributes-noise",args:[A,3]})),a||C.createElement("sparklesImplMaterial",{transparent:!0,pixelRatio:h,depthWrite:!1}))});function G2e(i){switch(i){case 64:return"-64px";case 128:return"-128px";case 256:return"-256px";case 512:return"-512px";default:return""}}const H2e="https://cdn.jsdelivr.net/gh/pmndrs/drei-assets@master/matcaps.json",Q2e="https://rawcdn.githack.com/emmelleppi/matcaps/9b36ccaaf0a24881a39062d05566c9e92be4aa0d";function aW(i=0,e=1024,t){const n=Th(()=>fetch(H2e).then(u=>u.json()),["matcapList"]),r=n[0],s=C.useMemo(()=>Object.keys(n).length,[]),a=`${C.useMemo(()=>typeof i=="string"?i:typeof i=="number"?n[i]:null,[i])||r}${G2e(e)}.png`,l=`${Q2e}/${e}/${a}`;return[xp(l,t),l,s]}const V2e=({children:i,id:e,format:t,onLoad:n})=>{const r=aW(e,t,n);return C.createElement(C.Fragment,null,i==null?void 0:i(r))},j2e="https://rawcdn.githack.com/pmndrs/drei-assets/7a3104997e1576f83472829815b00880d88b32fb",W2e="https://cdn.jsdelivr.net/gh/pmndrs/drei-assets@master/normals/normals.json";function lW(i=0,e={},t){const{repeat:n=[1,1],anisotropy:r=1,offset:s=[0,0]}=e,o=Th(()=>fetch(W2e).then(f=>f.json()),["normalsList"]),a=C.useMemo(()=>Object.keys(o).length,[]),l=o[0],c=o[i]||l,u=`${j2e}/normals/${c}`,h=xp(u,t);return C.useLayoutEffect(()=>{h&&(h.wrapS=h.wrapT=_o,h.repeat=new Ue(n[0],n[1]),h.offset=new Ue(s[0],s[1]),h.anisotropy=r)},[h,r,n,s]),[h,u,a]}const K2e=({children:i,id:e,onLoad:t,...n})=>{const r=lW(e,n,t);return C.createElement(C.Fragment,null,i==null?void 0:i(r))},Zd={uniforms:{strokeOpacity:1,fillOpacity:.25,fillMix:0,thickness:.05,colorBackfaces:!1,dashInvert:!0,dash:!1,dashRepeats:4,dashLength:.5,squeeze:!1,squeezeMin:.2,squeezeMax:1,stroke:new ut("#ff0000"),backfaceStroke:new ut("#0000ff"),fill:new ut("#00ff00")},vertex:`
	  attribute vec3 barycentric;
	
		varying vec3 v_edges_Barycentric;
		varying vec3 v_edges_Position;

		void initWireframe() {
			v_edges_Barycentric = barycentric;
			v_edges_Position = position.xyz;
		}
	  `,fragment:`
		#ifndef PI
	  	#define PI 3.1415926535897932384626433832795
		#endif
  
	  varying vec3 v_edges_Barycentric;
	  varying vec3 v_edges_Position;
  
	  uniform float strokeOpacity;
	  uniform float fillOpacity;
	  uniform float fillMix;
	  uniform float thickness;
	  uniform bool colorBackfaces;
  
	  // Dash
	  uniform bool dashInvert;
	  uniform bool dash;
	  uniform bool dashOnly;
	  uniform float dashRepeats;
	  uniform float dashLength;
  
	  // Squeeze
	  uniform bool squeeze;
	  uniform float squeezeMin;
	  uniform float squeezeMax;
  
	  // Colors
	  uniform vec3 stroke;
	  uniform vec3 backfaceStroke;
	  uniform vec3 fill;
  
	  // This is like
	  float wireframe_aastep(float threshold, float dist) {
		  float afwidth = fwidth(dist) * 0.5;
		  return smoothstep(threshold - afwidth, threshold + afwidth, dist);
	  }
  
	  float wireframe_map(float value, float min1, float max1, float min2, float max2) {
		  return min2 + (value - min1) * (max2 - min2) / (max1 - min1);
	  }
  
	  float getWireframe() {
			vec3 barycentric = v_edges_Barycentric;
		
			// Distance from center of each triangle to its edges.
			float d = min(min(barycentric.x, barycentric.y), barycentric.z);

			// for dashed rendering, we can use this to get the 0 .. 1 value of the line length
			float positionAlong = max(barycentric.x, barycentric.y);
			if (barycentric.y < barycentric.x && barycentric.y < barycentric.z) {
				positionAlong = 1.0 - positionAlong;
			}

			// the thickness of the stroke
			float computedThickness = wireframe_map(thickness, 0.0, 1.0, 0.0, 0.34);

			// if we want to shrink the thickness toward the center of the line segment
			if (squeeze) {
				computedThickness *= mix(squeezeMin, squeezeMax, (1.0 - sin(positionAlong * PI)));
			}

			// Create dash pattern
			if (dash) {
				// here we offset the stroke position depending on whether it
				// should overlap or not
				float offset = 1.0 / dashRepeats * dashLength / 2.0;
				if (!dashInvert) {
					offset += 1.0 / dashRepeats / 2.0;
				}

				// if we should animate the dash or not
				// if (dashAnimate) {
				// 	offset += time * 0.22;
				// }

				// create the repeating dash pattern
				float pattern = fract((positionAlong + offset) * dashRepeats);
				computedThickness *= 1.0 - wireframe_aastep(dashLength, pattern);
			}

			// compute the anti-aliased stroke edge  
			float edge = 1.0 - wireframe_aastep(computedThickness, d);

			return edge;
	  }
	  `},Y2e=Ec(Zd.uniforms,Zd.vertex+`
  	void main() {
		initWireframe();
		gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
	}
  `,Zd.fragment+`
  void main () {
		// Compute color

		float edge = getWireframe();
		vec4 colorStroke = vec4(stroke, edge);

		#ifdef FLIP_SIDED
			colorStroke.rgb = backfaceStroke;
		#endif
    
		vec4 colorFill = vec4(fill, fillOpacity);
		vec4 outColor = mix(colorFill, colorStroke, edge * strokeOpacity);

		gl_FragColor = outColor;
	}
  `);function $2e(i,e){i.onBeforeCompile=t=>{t.uniforms={...t.uniforms,...e},t.vertexShader=t.vertexShader.replace("void main() {",`
		  ${Zd.vertex}
		  void main() {
			initWireframe();
		`),t.fragmentShader=t.fragmentShader.replace("void main() {",`
		  ${Zd.fragment}
		  void main() {
		`),t.fragmentShader=t.fragmentShader.replace("#include <color_fragment>",`
		  #include <color_fragment>
			  float edge = getWireframe();
		  vec4 colorStroke = vec4(stroke, edge);
		  #ifdef FLIP_SIDED
			colorStroke.rgb = backfaceStroke;
		  #endif
		  vec4 colorFill = vec4(mix(diffuseColor.rgb, fill, fillMix), mix(diffuseColor.a, fillOpacity, fillMix));
		  vec4 outColor = mix(colorFill, colorStroke, edge * strokeOpacity);

		  diffuseColor.rgb = outColor.rgb;
		  diffuseColor.a *= outColor.a;
		`)},i.side=Li,i.transparent=!0}function X2e(i,e){C.useEffect(()=>{var t;return void(i.fillOpacity.value=(t=e.fillOpacity)!==null&&t!==void 0?t:i.fillOpacity.value)},[e.fillOpacity]),C.useEffect(()=>{var t;return void(i.fillMix.value=(t=e.fillMix)!==null&&t!==void 0?t:i.fillMix.value)},[e.fillMix]),C.useEffect(()=>{var t;return void(i.strokeOpacity.value=(t=e.strokeOpacity)!==null&&t!==void 0?t:i.strokeOpacity.value)},[e.strokeOpacity]),C.useEffect(()=>{var t;return void(i.thickness.value=(t=e.thickness)!==null&&t!==void 0?t:i.thickness.value)},[e.thickness]),C.useEffect(()=>void(i.colorBackfaces.value=!!e.colorBackfaces),[e.colorBackfaces]),C.useEffect(()=>void(i.dash.value=!!e.dash),[e.dash]),C.useEffect(()=>void(i.dashInvert.value=!!e.dashInvert),[e.dashInvert]),C.useEffect(()=>{var t;return void(i.dashRepeats.value=(t=e.dashRepeats)!==null&&t!==void 0?t:i.dashRepeats.value)},[e.dashRepeats]),C.useEffect(()=>{var t;return void(i.dashLength.value=(t=e.dashLength)!==null&&t!==void 0?t:i.dashLength.value)},[e.dashLength]),C.useEffect(()=>void(i.squeeze.value=!!e.squeeze),[e.squeeze]),C.useEffect(()=>{var t;return void(i.squeezeMin.value=(t=e.squeezeMin)!==null&&t!==void 0?t:i.squeezeMin.value)},[e.squeezeMin]),C.useEffect(()=>{var t;return void(i.squeezeMax.value=(t=e.squeezeMax)!==null&&t!==void 0?t:i.squeezeMax.value)},[e.squeezeMax]),C.useEffect(()=>void(i.stroke.value=e.stroke?new ut(e.stroke):i.stroke.value),[e.stroke]),C.useEffect(()=>void(i.fill.value=e.fill?new ut(e.fill):i.fill.value),[e.fill]),C.useEffect(()=>void(i.backfaceStroke.value=e.backfaceStroke?new ut(e.backfaceStroke):i.backfaceStroke.value),[e.backfaceStroke])}function q2e(i){return!!(i!=null&&i.geometry)}function J2e(i){return!!(i!=null&&i.isBufferGeometry)}function Z2e(i){return!!(i!=null&&i.current)}function kF(i){return(i==null?void 0:i.current)!==void 0}function FF(i){return i.type==="WireframeGeometry"}function exe(){const i={};for(const e in Zd.uniforms)i[e]={value:Zd.uniforms[e]};return i}function txe(i,e){const n=i.getAttribute("position").count,r=[];for(let s=0;s<n;s++){const o=s%2===0,a=e?1:0;o?r.push(0,0,1,0,1,0,1,0,a):r.push(0,1,0,0,0,1,1,0,a)}return new mn(Float32Array.from(r),3)}function cW(i){const e=Z2e(i)?i.current:i;if(J2e(e))return e;{if(FF(e))throw new Error("Wireframe: WireframeGeometry is not supported.");const t=e.parent;if(q2e(t)){if(FF(t.geometry))throw new Error("Wireframe: WireframeGeometry is not supported.");return t.geometry}}}function uW(i,e){if(i.index){console.warn("Wireframe: Requires non-indexed geometry, converting to non-indexed geometry.");const n=i.toNonIndexed();i.copy(n),i.setIndex(null)}const t=txe(i,e);i.setAttribute("barycentric",t)}function nxe({geometry:i,simplify:e=!1,...t}){Or({MeshWireframeMaterial:Y2e});const[n,r]=C.useState(null);C.useLayoutEffect(()=>{const o=cW(i);if(!o)throw new Error("Wireframe: geometry prop must be a BufferGeometry or a ref to a BufferGeometry.");uW(o,e),kF(i)&&r(o)},[e,i]);const s=kF(i)?n:i;return C.createElement(C.Fragment,null,s&&C.createElement("mesh",{geometry:s},C.createElement("meshWireframeMaterial",ot({attach:"material",transparent:!0,side:Li,polygonOffset:!0,polygonOffsetFactor:-4},t,{extensions:{derivatives:!0,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1}}))))}function ixe({simplify:i=!1,...e}){const t=C.useRef(null),n=C.useMemo(()=>exe(),[Zd.uniforms]);return X2e(n,e),C.useLayoutEffect(()=>{const r=cW(t);if(!r)throw new Error("Wireframe: Must be a child of a Mesh, Line or Points object or specify a geometry prop.");const s=r.clone();return uW(r,i),()=>{r.copy(s),s.dispose()}},[i]),C.useLayoutEffect(()=>{const r=t.current.parent,s=r.material.clone();return $2e(r.material,n),()=>{r.material.dispose(),r.material=s}},[]),C.createElement("object3D",{ref:t})}function rxe({geometry:i,...e}){return i?C.createElement(nxe,ot({geometry:i},e)):C.createElement(ixe,e)}function sxe({opacity:i,alphaMap:e}){const t=C.useRef(null),n=C.useRef(null),r=C.useRef({value:1}),s=C.useRef({value:null}),o=C.useRef({value:!1});return C.useLayoutEffect(()=>{t.current.onBeforeCompile=n.current.onBeforeCompile=a=>{const l=a.fragmentShader.indexOf("void main");let c="",u,h=l;for(;u!==`
`&&h<l+100;)u=a.fragmentShader.charAt(h),c+=u,h++;c=c.trim(),a.vertexShader=a.vertexShader.replace("void main() {",`
        varying vec2 custom_vUv;

        void main() {
          custom_vUv = uv;
          
        `),a.fragmentShader=a.fragmentShader.replace(c,`
          uniform float uShadowOpacity;
          uniform sampler2D uAlphaMap;
          uniform bool uHasAlphaMap;

          varying vec2 custom_vUv;
  
          float bayerDither2x2( vec2 v ) {
            return mod( 3.0 * v.y + 2.0 * v.x, 4.0 );
          }
    
          float bayerDither4x4( vec2 v ) {
            vec2 P1 = mod( v, 2.0 );
            vec2 P2 = mod( floor( 0.5  * v ), 2.0 );
            return 4.0 * bayerDither2x2( P1 ) + bayerDither2x2( P2 );
          }
  
          void main() {
            float alpha = 
              uHasAlphaMap ? 
                uShadowOpacity * texture2D(uAlphaMap, custom_vUv).x
              : uShadowOpacity;

            if( ( bayerDither4x4( floor( mod( gl_FragCoord.xy, 4.0 ) ) ) ) / 16.0 >= alpha ) discard;
            
          `),a.uniforms.uShadowOpacity=r.current,a.uniforms.uAlphaMap=s.current,a.uniforms.uHasAlphaMap=o.current}},[]),Kt(()=>{var a;const l=(a=t.current.__r3f)==null?void 0:a.parent;if(l){const c=l.material;c&&(r.current.value=i??c.opacity,e===!1?(s.current.value=null,o.current.value=!1):(s.current.value=e||c.alphaMap,o.current.value=!!s.current.value))}}),C.createElement(C.Fragment,null,C.createElement("meshDepthMaterial",{ref:t,attach:"customDepthMaterial",depthPacking:ww}),C.createElement("meshDistanceMaterial",{ref:n,attach:"customDistanceMaterial"}))}const OF=new Xe,xI=new vc,NF=new Bi,oxe=new Q;class hW extends xa{constructor(){super(),this.size=0,this.color=new ut("white"),this.instance={current:void 0},this.instanceKey={current:void 0}}get geometry(){var e;return(e=this.instance.current)==null?void 0:e.geometry}raycast(e,t){var n,r;const s=this.instance.current;if(!s||!s.geometry)return;const o=s.userData.instances.indexOf(this.instanceKey);if(o===-1||o>s.geometry.drawRange.count)return;const a=(n=(r=e.params.Points)==null?void 0:r.threshold)!==null&&n!==void 0?n:1;if(NF.set(this.getWorldPosition(oxe),a),e.ray.intersectsSphere(NF)===!1)return;OF.copy(s.matrixWorld).invert(),xI.copy(e.ray).applyMatrix4(OF);const l=a/((this.scale.x+this.scale.y+this.scale.z)/3),c=l*l,u=xI.distanceSqToPoint(this.position);if(u<c){const h=new Q;xI.closestPointToPoint(this.position,h),h.applyMatrix4(this.matrixWorld);const f=e.ray.origin.distanceTo(h);if(f<e.near||f>e.far)return;t.push({distance:f,distanceToRay:Math.sqrt(u),point:h,index:o,face:null,object:this})}}}let Em,Rv;const fW=C.createContext(null),UF=new Xe,zF=new Q,axe=C.forwardRef(({children:i,range:e,limit:t=1e3,...n},r)=>{const s=C.useRef(null);C.useImperativeHandle(r,()=>s.current,[]);const[o,a]=C.useState([]),[[l,c,u]]=C.useState(()=>[new Float32Array(t*3),Float32Array.from({length:t*3},()=>1),Float32Array.from({length:t},()=>1)]);C.useEffect(()=>{s.current.geometry.attributes.position.needsUpdate=!0}),Kt(()=>{for(s.current.updateMatrix(),s.current.updateMatrixWorld(),UF.copy(s.current.matrixWorld).invert(),s.current.geometry.drawRange.count=Math.min(t,e!==void 0?e:t,o.length),Em=0;Em<o.length;Em++)Rv=o[Em].current,Rv.getWorldPosition(zF).applyMatrix4(UF),zF.toArray(l,Em*3),s.current.geometry.attributes.position.needsUpdate=!0,Rv.matrixWorldNeedsUpdate=!0,Rv.color.toArray(c,Em*3),s.current.geometry.attributes.color.needsUpdate=!0,u.set([Rv.size],Em),s.current.geometry.attributes.size.needsUpdate=!0});const h=C.useMemo(()=>({getParent:()=>s,subscribe:f=>(a(d=>[...d,f]),()=>a(d=>d.filter(m=>m.current!==f.current)))}),[]);return C.createElement("points",ot({userData:{instances:o},matrixAutoUpdate:!1,ref:s,raycast:()=>null},n),C.createElement("bufferGeometry",null,C.createElement("bufferAttribute",{attach:"attributes-position",count:l.length/3,array:l,itemSize:3,usage:No}),C.createElement("bufferAttribute",{attach:"attributes-color",count:c.length/3,array:c,itemSize:3,usage:No}),C.createElement("bufferAttribute",{attach:"attributes-size",count:u.length,array:u,itemSize:1,usage:No})),C.createElement(fW.Provider,{value:h},i))}),lxe=C.forwardRef(({children:i,...e},t)=>{C.useMemo(()=>Or({PositionPoint:hW}),[]);const n=C.useRef(null);C.useImperativeHandle(t,()=>n.current,[]);const{subscribe:r,getParent:s}=C.useContext(fW);return C.useLayoutEffect(()=>r(n),[]),C.createElement("positionPoint",ot({instance:s(),instanceKey:n,ref:n},e),i)}),dW=C.forwardRef(({children:i,positions:e,colors:t,sizes:n,stride:r=3,...s},o)=>{const a=C.useRef(null);return C.useImperativeHandle(o,()=>a.current,[]),Kt(()=>{const l=a.current.geometry.attributes;l.position.needsUpdate=!0,t&&(l.color.needsUpdate=!0),n&&(l.size.needsUpdate=!0)}),C.createElement("points",ot({ref:a},s),C.createElement("bufferGeometry",null,C.createElement("bufferAttribute",{attach:"attributes-position",count:e.length/r,array:e,itemSize:r,usage:No}),t&&C.createElement("bufferAttribute",{attach:"attributes-color",count:t.length/r,array:t,itemSize:3,usage:No}),n&&C.createElement("bufferAttribute",{attach:"attributes-size",count:n.length/r,array:n,itemSize:1,usage:No})),i)}),cxe=C.forwardRef((i,e)=>i.positions instanceof Float32Array?C.createElement(dW,ot({},i,{ref:e})):C.createElement(axe,ot({},i,{ref:e}))),pW=C.createContext(null),uxe=C.forwardRef((i,e)=>{C.useMemo(()=>Or({SegmentObject:mW}),[]);const{limit:t=1e3,lineWidth:n=1,children:r,...s}=i,[o,a]=C.useState([]),[l]=C.useState(()=>new jH),[c]=C.useState(()=>new h4),[u]=C.useState(()=>new u4),[h]=C.useState(()=>new Ue(512,512)),[f]=C.useState(()=>Array(t*6).fill(0)),[d]=C.useState(()=>Array(t*6).fill(0)),m=C.useMemo(()=>({subscribe:y=>(a(g=>[...g,y]),()=>a(g=>g.filter(A=>A.current!==y.current)))}),[]);return Kt(()=>{for(let g=0;g<t;g++){var y;const A=(y=o[g])==null?void 0:y.current;A&&(f[g*6+0]=A.start.x,f[g*6+1]=A.start.y,f[g*6+2]=A.start.z,f[g*6+3]=A.end.x,f[g*6+4]=A.end.y,f[g*6+5]=A.end.z,d[g*6+0]=A.color.r,d[g*6+1]=A.color.g,d[g*6+2]=A.color.b,d[g*6+3]=A.color.r,d[g*6+4]=A.color.g,d[g*6+5]=A.color.b)}u.setColors(d),u.setPositions(f),l.computeLineDistances()}),C.createElement("primitive",{object:l,ref:e},C.createElement("primitive",{object:u,attach:"geometry"}),C.createElement("primitive",ot({object:c,attach:"material",vertexColors:!0,resolution:h,linewidth:n},s)),C.createElement(pW.Provider,{value:m},r))});class mW{constructor(){this.color=new ut("white"),this.start=new Q(0,0,0),this.end=new Q(0,0,0)}}const GF=i=>i instanceof Q?i:new Q(...typeof i=="number"?[i,i,i]:i),hxe=C.forwardRef(({color:i,start:e,end:t},n)=>{const r=C.useContext(pW);if(!r)throw"Segment must used inside Segments component.";const s=C.useRef(null);return C.useImperativeHandle(n,()=>s.current,[]),C.useLayoutEffect(()=>r.subscribe(s),[]),C.createElement("segmentObject",{ref:s,color:i,start:GF(e),end:GF(t)})}),fxe=C.forwardRef(({children:i,hysteresis:e=0,distances:t,...n},r)=>{const s=C.useRef(null);return C.useImperativeHandle(r,()=>s.current,[]),C.useLayoutEffect(()=>{const{current:o}=s;o.levels.length=0,o.children.forEach((a,l)=>o.levels.push({object:a,hysteresis:e,distance:t[l]}))}),Kt(o=>{var a;return(a=s.current)==null?void 0:a.update(o.camera)}),C.createElement("lOD",ot({ref:s},n),i)});function dxe({all:i,scene:e,camera:t}){const n=Ve(({gl:o})=>o),r=Ve(({camera:o})=>o),s=Ve(({scene:o})=>o);return C.useLayoutEffect(()=>{const o=[];i&&(e||s).traverse(c=>{c.visible===!1&&(o.push(c),c.visible=!0)}),n.compile(e||s,t||r);const a=new wA(128);new Iw(.01,1e5,a).update(n,e||s),a.dispose(),o.forEach(c=>c.visible=!1)},[]),null}function pxe(){const i=Ve(e=>e.gl);return C.useEffect(()=>(i.shadowMap.autoUpdate=!1,i.shadowMap.needsUpdate=!0,()=>{i.shadowMap.autoUpdate=i.shadowMap.needsUpdate=!0}),[i.shadowMap]),null}const HF=new Xe,QF=new vc,EI=new Bi,_I=new Q;function mxe(i,e){const t=this.geometry,n=this.material,r=this.matrixWorld;n!==void 0&&(t.boundingSphere===null&&t.computeBoundingSphere(),EI.copy(t.boundingSphere),EI.applyMatrix4(r),i.ray.intersectsSphere(EI)!==!1&&(HF.copy(r).invert(),QF.copy(i.ray).applyMatrix4(HF),!(t.boundingBox!==null&&QF.intersectBox(t.boundingBox,_I)===null)&&e.push({distance:_I.distanceTo(i.ray.origin),point:_I.clone(),object:this})))}function gxe({pixelated:i}){const e=Ve(o=>o.gl),t=Ve(o=>o.internal.active),n=Ve(o=>o.performance.current),r=Ve(o=>o.viewport.initialDpr),s=Ve(o=>o.setDpr);return C.useEffect(()=>{const o=e.domElement;return()=>{t&&s(r),i&&o&&(o.style.imageRendering="auto")}},[]),C.useEffect(()=>{s(n*r),i&&e.domElement&&(e.domElement.style.imageRendering=n===1?"auto":"pixelated")},[n]),null}function Axe(){const i=Ve(n=>n.get),e=Ve(n=>n.setEvents),t=Ve(n=>n.performance.current);return C.useEffect(()=>{const n=i().events.enabled;return()=>e({enabled:n})},[]),C.useEffect(()=>e({enabled:t===1}),[t]),null}const gW=C.createContext(null);function yxe({iterations:i=10,ms:e=250,threshold:t=.75,step:n=.1,factor:r=.5,flipflops:s=1/0,bounds:o=f=>f>100?[60,100]:[40,60],onIncline:a,onDecline:l,onChange:c,onFallback:u,children:h}){const f=Math.pow(10,0),[d,m]=C.useState(()=>({fps:0,index:0,factor:r,flipped:0,refreshrate:0,fallback:!1,frames:[],averages:[],subscriptions:new Map,subscribe:g=>{const A=Symbol();return d.subscriptions.set(A,g.current),()=>void d.subscriptions.delete(A)}}));let y=0;return Kt(()=>{const{frames:g,averages:A}=d;if(!d.fallback&&A.length<i){g.push(performance.now());const E=g[g.length-1]-g[0];if(E>=e){if(d.fps=Math.round(g.length/E*1e3*f)/f,d.refreshrate=Math.max(d.refreshrate,d.fps),A[d.index++%i]=d.fps,A.length===i){const[x,w]=o(d.refreshrate),T=A.filter(M=>M>=w),I=A.filter(M=>M<x);T.length>i*t&&(d.factor=Math.min(1,d.factor+n),d.flipped++,a&&a(d),d.subscriptions.forEach(M=>M.onIncline&&M.onIncline(d))),I.length>i*t&&(d.factor=Math.max(0,d.factor-n),d.flipped++,l&&l(d),d.subscriptions.forEach(M=>M.onDecline&&M.onDecline(d))),y!==d.factor&&(y=d.factor,c&&c(d),d.subscriptions.forEach(M=>M.onChange&&M.onChange(d))),d.flipped>s&&!d.fallback&&(d.fallback=!0,u&&u(d),d.subscriptions.forEach(M=>M.onFallback&&M.onFallback(d))),d.averages=[]}d.frames=[]}}}),C.createElement(gW.Provider,{value:d},h)}function vxe({onIncline:i,onDecline:e,onChange:t,onFallback:n}){const r=C.useContext(gW),s=C.useRef({onIncline:i,onDecline:e,onChange:t,onFallback:n});C.useLayoutEffect(()=>{s.current.onIncline=i,s.current.onDecline=e,s.current.onChange=t,s.current.onFallback=n},[i,e,t,n]),C.useLayoutEffect(()=>r.subscribe(s),[r])}const AW=C.forwardRef(({children:i,compute:e,width:t,height:n,samples:r=8,renderPriority:s=0,eventPriority:o=0,frames:a=1/0,stencilBuffer:l=!1,depthBuffer:c=!0,generateMipmaps:u=!1,...h},f)=>{const{size:d,viewport:m}=Ve(),y=Ea((t||d.width)*m.dpr,(n||d.height)*m.dpr,{samples:r,stencilBuffer:l,depthBuffer:c,generateMipmaps:u}),[g]=C.useState(()=>new Mu),A=C.useCallback((E,x,w)=>{var T,I;let M=(T=y.texture)==null?void 0:T.__r3f.parent;for(;M&&!(M instanceof _n);)M=M.__r3f.parent;if(!M)return!1;w.raycaster.camera||w.events.compute(E,w,(I=w.previousRoot)==null?void 0:I.getState());const[L]=w.raycaster.intersectObject(M);if(!L)return!1;const P=L.uv;if(!P)return!1;x.raycaster.setFromCamera(x.pointer.set(P.x*2-1,P.y*2-1),x.camera)},[]);return C.useImperativeHandle(f,()=>y.texture,[y]),C.createElement(C.Fragment,null,vp(C.createElement(xxe,{renderPriority:s,frames:a,fbo:y},i,C.createElement("group",{onPointerOver:()=>null})),g,{events:{compute:e||A,priority:o}}),C.createElement("primitive",ot({object:y.texture},h)))});function xxe({frames:i,renderPriority:e,children:t,fbo:n}){let r=0,s,o,a,l;return Kt(c=>{(i===1/0||r<i)&&(s=c.gl.autoClear,o=c.gl.xr.enabled,a=c.gl.getRenderTarget(),l=c.gl.xr.isPresenting,c.gl.autoClear=!0,c.gl.xr.enabled=!1,c.gl.xr.isPresenting=!1,c.gl.setRenderTarget(n),c.gl.render(c.scene,c.camera),c.gl.setRenderTarget(a),c.gl.autoClear=s,c.gl.xr.enabled=o,c.gl.xr.isPresenting=l,r++)},e),C.createElement(C.Fragment,null,t)}const yW=C.forwardRef(({children:i,compute:e,renderPriority:t=-1,eventPriority:n=0,frames:r=1/0,stencilBuffer:s=!1,depthBuffer:o=!0,generateMipmaps:a=!1,resolution:l=896,near:c=.1,far:u=1e3,flip:h=!1,position:f,rotation:d,scale:m,quaternion:y,matrix:g,matrixAutoUpdate:A,...E},x)=>{const{size:w,viewport:T}=Ve(),I=C.useRef(null),M=C.useMemo(()=>{const P=new wA(Math.max((l||w.width)*T.dpr,(l||w.height)*T.dpr),{stencilBuffer:s,depthBuffer:o,generateMipmaps:a});return P.texture.isRenderTargetTexture=!h,P.texture.flipY=!0,P.texture.type=Ni,P},[l,h]);C.useEffect(()=>()=>M.dispose(),[M]);const[L]=C.useState(()=>new Mu);return C.useImperativeHandle(x,()=>({scene:L,fbo:M,camera:I.current}),[M]),C.createElement(C.Fragment,null,vp(C.createElement(Exe,{renderPriority:t,frames:r,camera:I},i,C.createElement("group",{onPointerOver:()=>null})),L,{events:{compute:e,priority:n}}),C.createElement("primitive",ot({object:M.texture},E)),C.createElement("cubeCamera",{ref:I,args:[c,u,M],position:f,rotation:d,scale:m,quaternion:y,matrix:g,matrixAutoUpdate:A}))});function Exe({frames:i,renderPriority:e,children:t,camera:n}){let r=0;return Kt(s=>{(i===1/0||r<i)&&(n.current.update(s.gl,s.scene),r++)},e),C.createElement(C.Fragment,null,t)}const _xe=C.forwardRef(({id:i=1,colorWrite:e=!1,depthWrite:t=!1,...n},r)=>{const s=C.useRef(null),o=C.useMemo(()=>({colorWrite:e,depthWrite:t,stencilWrite:!0,stencilRef:i,stencilFunc:IS,stencilFail:W_,stencilZFail:W_,stencilZPass:W_}),[i,e,t]);return C.useLayoutEffect(()=>{Object.assign(s.current.material,o)}),C.useImperativeHandle(r,()=>s.current,[]),C.createElement("mesh",ot({ref:s,renderOrder:-i},n))});function Sxe(i,e=!1){return{stencilWrite:!0,stencilRef:i,stencilFunc:e?LU:PU,stencilFail:hh,stencilZFail:hh,stencilZPass:hh}}function wxe({renderPriority:i=1,zoom:e=0,segments:t=64,children:n,resolution:r=896,...s}){const o=C.useRef(null),a=C.useRef(null),{width:l,height:c}=Ve(g=>g.size),[u]=C.useState(()=>new qi);C.useLayoutEffect(()=>{u.position.set(0,0,100),u.zoom=100,u.left=l/-2,u.right=l/2,u.top=c/2,u.bottom=c/-2,u.updateProjectionMatrix()},[l,c]);const h=Math.sqrt(l*l+c*c)/100*(.5+e/2),f=new Q,d=new Bi(new Q,h),m=new Tn,y=C.useCallback((g,A,E)=>{if(A.pointer.set(g.offsetX/A.size.width*2-1,-(g.offsetY/A.size.height)*2+1),A.raycaster.setFromCamera(A.pointer,u),A.raycaster.ray.intersectSphere(d,f))f.normalize();else return;m.getNormalMatrix(a.current.camera.matrixWorld),a.current.camera.getWorldPosition(A.raycaster.ray.origin),A.raycaster.ray.direction.set(0,0,1).reflect(f),A.raycaster.ray.direction.x*=-1,A.raycaster.ray.direction.applyNormalMatrix(m).multiplyScalar(-1)},[]);return Kt(g=>{i&&g.gl.render(o.current,u)},i),C.createElement(C.Fragment,null,C.createElement("mesh",ot({ref:o},s,{scale:h}),C.createElement("sphereGeometry",{args:[1,t,t]}),C.createElement("meshBasicMaterial",null,C.createElement(yW,{compute:y,attach:"envMap",flip:!0,resolution:r,ref:a},n,C.createElement(Cxe,{api:a})))))}function Cxe({api:i}){const e=new Q,t=new Xt,n=new Q,r=new Eo(0,Math.PI,0);return Kt(s=>{s.camera.matrixWorld.decompose(e,t,n),i.current.camera.position.copy(e),i.current.camera.quaternion.setFromEuler(r).premultiply(t)}),null}const Txe=Ec({blur:0,map:null,sdf:null,blend:0,size:0,resolution:new Ue},`varying vec2 vUv;
   void main() {
     gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
     vUv = uv;
   }`,`uniform sampler2D sdf;
   uniform sampler2D map;
   uniform float blur;
   uniform float size;
   uniform float time;
   uniform vec2 resolution;
   varying vec2 vUv;
   #include <packing>
   void main() {
     vec2 uv = gl_FragCoord.xy / resolution.xy;
     vec4 t = texture2D(map, uv);
     float k = blur;
     float d = texture2D(sdf, vUv).r/size;
     float alpha = 1.0 - smoothstep(0.0, 1.0, clamp(d/k + 1.0, 0.0, 1.0));
     gl_FragColor = vec4(t.rgb, blur == 0.0 ? t.a : t.a * alpha);
     #include <tonemapping_fragment>
     #include <${ea>=154?"colorspace_fragment":"encodings_fragment"}>
   }`),bxe=C.forwardRef(({children:i,events:e=void 0,blur:t=0,eventPriority:n=0,renderPriority:r=0,worldUnits:s=!1,resolution:o=512,...a},l)=>{Or({PortalMaterialImpl:Txe});const c=C.useRef(null),{scene:u,gl:h,size:f,viewport:d,setEvents:m}=Ve(),y=Ea(o,o),[g,A]=C.useState(0);Kt(()=>{const I=c.current.blend>0?Math.max(1,r):0;g!==I&&A(I)}),C.useEffect(()=>{e!==void 0&&m({enabled:!e})},[e]);const[E,x]=C.useState(!0),w=Lj(x);C.useLayoutEffect(()=>{var I;w.current=(I=c.current)==null?void 0:I.__r3f.parent},[]),C.useLayoutEffect(()=>{if(w.current&&t&&c.current.sdf===null){const I=new It(w.current.geometry,new no),M=new ti().setFromBufferAttribute(I.geometry.attributes.position),L=new qi(M.min.x*(1+2/o),M.max.x*(1+2/o),M.max.y*(1+2/o),M.min.y*(1+2/o),.1,1e3);L.position.set(0,0,1),L.lookAt(0,0,0),h.setRenderTarget(y),h.render(I,L);const R=Mxe(o,o,h)(y.texture),U=new Float32Array(o*o);h.readRenderTargetPixels(R,0,0,o,o,U);let k=1/0;for(let H=0;H<U.length;H++)U[H]<k&&(k=U[H]);k=-k,c.current.size=k,c.current.sdf=R.texture,h.setRenderTarget(null)}},[o,t]),C.useImperativeHandle(l,()=>c.current);const T=C.useCallback((I,M,L)=>{var P;if(!w.current)return!1;if(M.pointer.set(I.offsetX/M.size.width*2-1,-(I.offsetY/M.size.height)*2+1),M.raycaster.setFromCamera(M.pointer,M.camera),((P=c.current)==null?void 0:P.blend)===0){const[R]=M.raycaster.intersectObject(w.current);if(!R)return M.raycaster.camera=void 0,!1}},[]);return C.createElement("portalMaterialImpl",ot({ref:c,blur:t,blend:0,resolution:[f.width*d.dpr,f.height*d.dpr],attach:"material"},a),C.createElement(AW,{attach:"map",frames:E?1/0:0,eventPriority:n,renderPriority:r,compute:T},i,C.createElement(Ixe,{events:e,rootScene:u,priority:g,material:c,worldUnits:s})))});function Ixe({events:i=void 0,rootScene:e,material:t,priority:n,worldUnits:r}){const s=Ve(h=>h.scene),o=Ve(h=>h.setEvents),a=Ea(),l=Ea();C.useLayoutEffect(()=>{s.matrixAutoUpdate=!1},[]),C.useEffect(()=>{i!==void 0&&o({enabled:i})},[i]);const[c,u]=C.useMemo(()=>{const h={value:0};return[new Tf(new Mi({uniforms:{a:{value:a.texture},b:{value:l.texture},blend:h},vertexShader:`
          varying vec2 vUv;
          void main() {
            vUv = uv;
            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
          }`,fragmentShader:`
          uniform sampler2D a;
          uniform sampler2D b;
          uniform float blend;
          varying vec2 vUv;
          #include <packing>
          void main() {
            vec4 ta = texture2D(a, vUv);
            vec4 tb = texture2D(b, vUv);
            gl_FragColor = mix(tb, ta, blend);
            #include <tonemapping_fragment>
            #include <${ea>=154?"colorspace_fragment":"encodings_fragment"}>
          }`})),h]},[]);return Kt(h=>{var f;let d=t==null||(f=t.current)==null?void 0:f.__r3f.parent;if(d){if(r)s.matrixWorld.identity();else{var m;n&&((m=t.current)==null?void 0:m.blend)===1&&d.updateWorldMatrix(!0,!1),s.matrixWorld.copy(d.matrixWorld)}if(n){var y,g,A;((y=t.current)==null?void 0:y.blend)>0&&((g=t.current)==null?void 0:g.blend)<1?(u.value=t.current.blend,h.gl.setRenderTarget(a),h.gl.render(s,h.camera),h.gl.setRenderTarget(l),h.gl.render(e,h.camera),h.gl.setRenderTarget(null),c.render(h.gl)):((A=t.current)==null?void 0:A.blend)===1&&h.gl.render(s,h.camera)}}},n),C.createElement(C.Fragment,null)}const Mxe=(i,e,t)=>{let n=new Si(i,e,{minFilter:Bl,magFilter:Ln,type:fi,format:hc,generateMipmaps:!0}),r=new Si(i,e,{minFilter:zn,magFilter:zn}),s=new Si(i,e,{minFilter:zn,magFilter:zn}),o=new Si(i,e,{minFilter:zn,magFilter:zn}),a=new Si(i,e,{minFilter:zn,magFilter:zn}),l=new Si(i,e,{minFilter:zn,magFilter:zn,type:fi,format:hc}),c=new Si(i,e,{minFilter:zn,magFilter:zn,type:fi,format:hc});const u=new Tf(new Mi({uniforms:{tex:{value:null}},vertexShader:`
        varying vec2 vUv;
        void main() {
          vUv = uv;
          gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        }`,fragmentShader:`
        uniform sampler2D tex;
        varying vec2 vUv;
        #include <packing>
        void main() {
          gl_FragColor = pack2HalfToRGBA(vUv * (round(texture2D(tex, vUv).x)));
        }`})),h=new Tf(new Mi({uniforms:{tex:{value:null}},vertexShader:`
        varying vec2 vUv;
        void main() {
          vUv = uv;
          gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        }`,fragmentShader:`
        uniform sampler2D tex;
        varying vec2 vUv;
        #include <packing>
        void main() {
          gl_FragColor = pack2HalfToRGBA(vUv * (1.0 - round(texture2D(tex, vUv).x)));
        }`})),f=new Tf(new Mi({uniforms:{tex:{value:null},offset:{value:0},level:{value:0},maxSteps:{value:0}},vertexShader:`
        varying vec2 vUv;
        void main() {
          vUv = uv;
          gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        }`,fragmentShader:`
        varying vec2 vUv;
        uniform sampler2D tex;
        uniform float offset;
        uniform float level;
        uniform float maxSteps;
        #include <packing>
        void main() {
          float closestDist = 9999999.9;
          vec2 closestPos = vec2(0.0);
          for (float x = -1.0; x <= 1.0; x += 1.0) {
            for (float y = -1.0; y <= 1.0; y += 1.0) {
              vec2 voffset = vUv;
              voffset += vec2(x, y) * vec2(${1/i}, ${1/e}) * offset;
              vec2 pos = unpackRGBATo2Half(texture2D(tex, voffset));
              float dist = distance(pos.xy, vUv);
              if(pos.x != 0.0 && pos.y != 0.0 && dist < closestDist) {
                closestDist = dist;
                closestPos = pos;
              }
            }
          }
          gl_FragColor = pack2HalfToRGBA(closestPos);
        }`})),d=new Tf(new Mi({uniforms:{tex:{value:null},size:{value:new Ue(i,e)}},vertexShader:`
        varying vec2 vUv;
        void main() {
          vUv = uv;
          gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        }`,fragmentShader:`
        varying vec2 vUv;
        uniform sampler2D tex;
        uniform vec2 size;
        #include <packing>
        void main() {
          gl_FragColor = vec4(distance(size * unpackRGBATo2Half(texture2D(tex, vUv)), size * vUv), 0.0, 0.0, 0.0);
        }`})),m=new Tf(new Mi({uniforms:{inside:{value:c.texture},outside:{value:l.texture},tex:{value:null}},vertexShader:`
        varying vec2 vUv;
        void main() {
          vUv = uv;
          gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        }`,fragmentShader:`
        varying vec2 vUv;
        uniform sampler2D inside;
        uniform sampler2D outside;
        uniform sampler2D tex;
        #include <packing>
        void main() {
          float i = texture2D(inside, vUv).x;
          float o =texture2D(outside, vUv).x;
          if (texture2D(tex, vUv).x == 0.0) {
            gl_FragColor = vec4(o, 0.0, 0.0, 0.0);
          } else {
            gl_FragColor = vec4(-i, 0.0, 0.0, 0.0);
          }
        }`}));return y=>{let g=n;y.minFilter=zn,y.magFilter=zn,u.material.uniforms.tex.value=y,t.setRenderTarget(r),u.render(t);const A=Math.ceil(Math.log(Math.max(i,e))/Math.log(2));let E=r,x=null;for(let w=0;w<A;w++){const T=Math.pow(2,A-w-1);x=E===r?o:r,f.material.uniforms.level.value=w,f.material.uniforms.maxSteps.value=A,f.material.uniforms.offset.value=T,f.material.uniforms.tex.value=E.texture,t.setRenderTarget(x),f.render(t),E=x}t.setRenderTarget(l),d.material.uniforms.tex.value=x.texture,d.render(t),h.material.uniforms.tex.value=y,t.setRenderTarget(s),h.render(t),E=s;for(let w=0;w<A;w++){const T=Math.pow(2,A-w-1);x=E===s?a:s,f.material.uniforms.level.value=w,f.material.uniforms.maxSteps.value=A,f.material.uniforms.offset.value=T,f.material.uniforms.tex.value=E.texture,t.setRenderTarget(x),f.render(t),E=x}return t.setRenderTarget(c),d.material.uniforms.tex.value=x.texture,d.render(t),t.setRenderTarget(g),m.material.uniforms.tex.value=y,m.render(t),t.setRenderTarget(null),g}},Rxe={},VF=i=>{let e;const t=new Set,n=(u,h)=>{const f=typeof u=="function"?u(e):u;if(!Object.is(f,e)){const d=e;e=h??(typeof f!="object"||f===null)?f:Object.assign({},e,f),t.forEach(m=>m(e,d))}},r=()=>e,l={setState:n,getState:r,getInitialState:()=>c,subscribe:u=>(t.add(u),()=>t.delete(u)),destroy:()=>{(Rxe?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),t.clear()}},c=e=i(n,r,l);return l},Pxe=i=>i?VF(i):VF;var SI={exports:{}},wI={},CI={exports:{}},TI={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var jF;function Lxe(){if(jF)return TI;jF=1;var i=_A();function e(h,f){return h===f&&(h!==0||1/h===1/f)||h!==h&&f!==f}var t=typeof Object.is=="function"?Object.is:e,n=i.useState,r=i.useEffect,s=i.useLayoutEffect,o=i.useDebugValue;function a(h,f){var d=f(),m=n({inst:{value:d,getSnapshot:f}}),y=m[0].inst,g=m[1];return s(function(){y.value=d,y.getSnapshot=f,l(y)&&g({inst:y})},[h,d,f]),r(function(){return l(y)&&g({inst:y}),h(function(){l(y)&&g({inst:y})})},[h]),o(d),d}function l(h){var f=h.getSnapshot;h=h.value;try{var d=f();return!t(h,d)}catch{return!0}}function c(h,f){return f()}var u=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?c:a;return TI.useSyncExternalStore=i.useSyncExternalStore!==void 0?i.useSyncExternalStore:u,TI}var WF;function Bxe(){return WF||(WF=1,CI.exports=Lxe()),CI.exports}/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var KF;function Dxe(){if(KF)return wI;KF=1;var i=_A(),e=Bxe();function t(c,u){return c===u&&(c!==0||1/c===1/u)||c!==c&&u!==u}var n=typeof Object.is=="function"?Object.is:t,r=e.useSyncExternalStore,s=i.useRef,o=i.useEffect,a=i.useMemo,l=i.useDebugValue;return wI.useSyncExternalStoreWithSelector=function(c,u,h,f,d){var m=s(null);if(m.current===null){var y={hasValue:!1,value:null};m.current=y}else y=m.current;m=a(function(){function A(I){if(!E){if(E=!0,x=I,I=f(I),d!==void 0&&y.hasValue){var M=y.value;if(d(M,I))return w=M}return w=I}if(M=w,n(x,I))return M;var L=f(I);return d!==void 0&&d(M,L)?(x=I,M):(x=I,w=L)}var E=!1,x,w,T=h===void 0?null:h;return[function(){return A(u())},T===null?void 0:function(){return A(T())}]},[u,h,f,d]);var g=r(c,m[0],m[1]);return o(function(){y.hasValue=!0,y.value=g},[g]),l(g),g},wI}var YF;function kxe(){return YF||(YF=1,SI.exports=Dxe()),SI.exports}var Fxe=kxe();const Oxe=EA(Fxe),vW={},{useDebugValue:Nxe}=bl,{useSyncExternalStoreWithSelector:Uxe}=Oxe;let $F=!1;const zxe=i=>i;function Gxe(i,e=zxe,t){(vW?"production":void 0)!=="production"&&t&&!$F&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),$F=!0);const n=Uxe(i.subscribe,i.getState,i.getServerState||i.getInitialState,e,t);return Nxe(n),n}const XF=i=>{(vW?"production":void 0)!=="production"&&typeof i!="function"&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const e=typeof i=="function"?Pxe(i):i,t=(n,r)=>Gxe(e,n,r);return Object.assign(t,e),t},Hxe=i=>i?XF(i):XF;var qF,JF;const ZF=typeof window<"u"&&((qF=window.document)!=null&&qF.createElement||((JF=window.navigator)==null?void 0:JF.product)==="ReactNative")?bl.useLayoutEffect:bl.useEffect;function Qxe(){const i=Hxe(e=>({current:new Array,version:0,set:e}));return{In:({children:e})=>{const t=i(r=>r.set),n=i(r=>r.version);return ZF(()=>{t(r=>({version:r.version+1}))},[]),ZF(()=>(t(({current:r})=>({current:[...r,e]})),()=>t(({current:r})=>({current:r.filter(s=>s!==e)}))),[e,n]),null},Out:()=>{const e=i(t=>t.current);return bl.createElement(bl.Fragment,null,e)}}}const Vxe=i=>i&&i.isOrthographicCamera,eO=new ut,xW=Qxe();function EW(i){return"top"in i}function bI(i,e){const{right:t,top:n,left:r,bottom:s,width:o,height:a}=e,l=e.bottom<0||n>i.height||t<0||e.left>i.width;if(EW(i)){const h=i.top+i.height-s,f=r-i.left;return{position:{width:o,height:a,left:f,top:n,bottom:h,right:t},isOffscreen:l}}const c=i.height-s;return{position:{width:o,height:a,top:n,left:r,bottom:c,right:t},isOffscreen:l}}function II(i,{left:e,bottom:t,width:n,height:r}){let s;const o=n/r;return Vxe(i.camera)?i.camera.manual?i.camera.updateProjectionMatrix():(i.camera.left!==n/-2||i.camera.right!==n/2||i.camera.top!==r/2||i.camera.bottom!==r/-2)&&(Object.assign(i.camera,{left:n/-2,right:n/2,top:r/2,bottom:r/-2}),i.camera.updateProjectionMatrix()):i.camera.aspect!==o&&(i.camera.aspect=o,i.camera.updateProjectionMatrix()),s=i.gl.autoClear,i.gl.autoClear=!1,i.gl.setViewport(e,t,n,r),i.gl.setScissor(e,t,n,r),i.gl.setScissorTest(!0),s}function MI(i,e){i.gl.setScissorTest(!1),i.gl.autoClear=e}function tO(i){i.gl.getClearColor(eO),i.gl.setClearColor(eO,i.gl.getClearAlpha()),i.gl.clear(!0,!0)}function jxe({visible:i=!0,canvasSize:e,scene:t,index:n,children:r,frames:s,rect:o,track:a}){const l=Ve(),[c,u]=C.useState(!1);let h=0;return Kt(f=>{if(s===1/0||h<=s){var d;a&&(o.current=(d=a.current)==null?void 0:d.getBoundingClientRect()),h++}if(o.current){const{position:m,isOffscreen:y}=bI(e,o.current);if(c!==y&&u(y),i&&!c&&o.current){const g=II(f,m);f.gl.render(r?f.scene:t,f.camera),MI(f,g)}}},n),C.useLayoutEffect(()=>{const f=o.current;if(f&&(!i||!c)){const{position:d}=bI(e,f),m=II(l,d);tO(l),MI(l,m)}},[i,c]),C.useEffect(()=>{if(!a)return;const f=o.current,d=l.get().events.connected;return l.setEvents({connected:a.current}),()=>{if(f){const{position:m}=bI(e,f),y=II(l,m);tO(l),MI(l,y)}l.setEvents({connected:d})}},[a]),C.useEffect(()=>{EW(e)||console.warn(`Detected @react-three/fiber canvas size does not include position information. <View /> may not work as expected. Upgrade to @react-three/fiber ^8.1.0 for support.
 See https://github.com/pmndrs/drei/issues/944`)},[]),C.createElement(C.Fragment,null,r,C.createElement("group",{onPointerOver:()=>null}))}const _W=C.forwardRef(({track:i,visible:e=!0,index:t=1,id:n,style:r,className:s,frames:o=1/0,children:a,...l},c)=>{var u,h,f,d;const m=C.useRef(null),{size:y,scene:g}=Ve(),[A]=C.useState(()=>new Mu),[E,x]=C.useReducer(()=>!0,!1),w=C.useCallback((T,I)=>{if(m.current&&i&&i.current&&T.target===i.current){const{width:M,height:L,left:P,top:R}=m.current,U=T.clientX-P,k=T.clientY-R;I.pointer.set(U/M*2-1,-(k/L)*2+1),I.raycaster.setFromCamera(I.pointer,I.camera)}},[m,i]);return C.useEffect(()=>{var T;i&&(m.current=(T=i.current)==null?void 0:T.getBoundingClientRect()),x()},[i]),C.createElement("group",ot({ref:c},l),E&&vp(C.createElement(jxe,{visible:e,canvasSize:y,frames:o,scene:g,track:i,rect:m,index:t},a),A,{events:{compute:w,priority:t},size:{width:(u=m.current)==null?void 0:u.width,height:(h=m.current)==null?void 0:h.height,top:(f=m.current)==null?void 0:f.top,left:(d=m.current)==null?void 0:d.left}}))}),Wxe=C.forwardRef(({as:i="div",id:e,visible:t,className:n,style:r,index:s=1,track:o,frames:a=1/0,children:l,...c},u)=>{const h=C.useId(),f=C.useRef(null);return C.useImperativeHandle(u,()=>f.current),C.createElement(C.Fragment,null,C.createElement(i,ot({ref:f,id:e,className:n,style:r},c)),C.createElement(xW.In,null,C.createElement(_W,{visible:t,key:h,track:f,frames:a,index:s},l)))}),Kxe=(()=>{const i=C.forwardRef((e,t)=>C.useContext(n0)?C.createElement(_W,ot({ref:t},e)):C.createElement(Wxe,ot({ref:t},e)));return i.Port=()=>C.createElement(xW.Out,null),i})(),Ix=C.createContext(null),R_=new Q,nO=new Q,Yxe=(i,e,t,n)=>{const r=e.dot(e),s=e.dot(i)-e.dot(t),o=e.dot(n);return o===0?-s/r:(R_.copy(n).multiplyScalar(r/o).sub(e),nO.copy(n).multiplyScalar(s/o).add(t).sub(i),-R_.dot(nO)/R_.dot(R_))},$xe=new Q(0,1,0),iO=new Xe,RI=({direction:i,axis:e})=>{const{translation:t,translationLimits:n,annotations:r,annotationsClass:s,depthTest:o,scale:a,lineWidth:l,fixed:c,axisColors:u,hoveredColor:h,opacity:f,onDragStart:d,onDrag:m,onDragEnd:y,userData:g}=C.useContext(Ix),A=Ve(oe=>oe.controls),E=C.useRef(null),x=C.useRef(null),w=C.useRef(null),T=C.useRef(0),[I,M]=C.useState(!1),L=C.useCallback(oe=>{r&&(E.current.innerText=`${t.current[e].toFixed(2)}`,E.current.style.display="block"),oe.stopPropagation();const K=new Xe().extractRotation(x.current.matrixWorld),V=oe.point.clone(),W=new Q().setFromMatrixPosition(x.current.matrixWorld),F=i.clone().applyMatrix4(K).normalize();w.current={clickPoint:V,dir:F},T.current=t.current[e],d({component:"Arrow",axis:e,origin:W,directions:[F]}),A&&(A.enabled=!1),oe.target.setPointerCapture(oe.pointerId)},[r,i,A,d,t,e]),P=C.useCallback(oe=>{if(oe.stopPropagation(),I||M(!0),w.current){const{clickPoint:K,dir:V}=w.current,[W,F]=(n==null?void 0:n[e])||[void 0,void 0];let Y=Yxe(K,V,oe.ray.origin,oe.ray.direction);W!==void 0&&(Y=Math.max(Y,W-T.current)),F!==void 0&&(Y=Math.min(Y,F-T.current)),t.current[e]=T.current+Y,r&&(E.current.innerText=`${t.current[e].toFixed(2)}`),iO.makeTranslation(V.x*Y,V.y*Y,V.z*Y),m(iO)}},[r,m,I,t,n,e]),R=C.useCallback(oe=>{r&&(E.current.style.display="none"),oe.stopPropagation(),w.current=null,y(),A&&(A.enabled=!0),oe.target.releasePointerCapture(oe.pointerId)},[r,A,y]),U=C.useCallback(oe=>{oe.stopPropagation(),M(!1)},[]),{cylinderLength:k,coneWidth:H,coneLength:G,matrixL:X}=C.useMemo(()=>{const oe=c?l/a*1.6:a/20,K=c?.2:a/5,V=c?1-K:a-K,W=new Xt().setFromUnitVectors($xe,i.clone().normalize()),F=new Xe().makeRotationFromQuaternion(W);return{cylinderLength:V,coneWidth:oe,coneLength:K,matrixL:F}},[i,a,l,c]),Z=I?h:u[e];return C.createElement("group",{ref:x},C.createElement("group",{matrix:X,matrixAutoUpdate:!1,onPointerDown:L,onPointerMove:P,onPointerUp:R,onPointerOut:U},r&&C.createElement(MA,{position:[0,-G,0]},C.createElement("div",{style:{display:"none",background:"#151520",color:"white",padding:"6px 8px",borderRadius:7,whiteSpace:"nowrap"},className:s,ref:E})),C.createElement("mesh",{visible:!1,position:[0,(k+G)/2,0],userData:g},C.createElement("cylinderGeometry",{args:[H*1.4,H*1.4,k+G,8,1]})),C.createElement(Cu,{transparent:!0,raycast:()=>null,depthTest:o,points:[0,0,0,0,k,0],lineWidth:l,side:Li,color:Z,opacity:f,polygonOffset:!0,renderOrder:1,polygonOffsetFactor:-10,fog:!1}),C.createElement("mesh",{raycast:()=>null,position:[0,k+G/2,0],renderOrder:500},C.createElement("coneGeometry",{args:[H,G,24,1]}),C.createElement("meshBasicMaterial",{transparent:!0,depthTest:o,color:Z,opacity:f,polygonOffset:!0,polygonOffsetFactor:-10,fog:!1}))))},PI=new Q,LI=new Q,BI=i=>i*180/Math.PI,Xxe=i=>i*Math.PI/180,qxe=(i,e,t,n,r)=>{PI.copy(i).sub(t),LI.copy(e).sub(t);const s=n.dot(n),o=r.dot(r),a=PI.dot(n)/s,l=PI.dot(r)/o,c=LI.dot(n)/s,u=LI.dot(r)/o,h=Math.atan2(l,a);return Math.atan2(u,c)-h},Jxe=(i,e)=>{let t=Math.floor(i/e);return t=t<0?t+1:t,i-t*e},rO=i=>{let e=Jxe(i,2*Math.PI);return Math.abs(e)<1e-6?0:(e<0&&(e+=2*Math.PI),e)},P_=new Xe,sO=new Q,L_=new vc,DI=new Q,kI=({dir1:i,dir2:e,axis:t})=>{const{rotationLimits:n,annotations:r,annotationsClass:s,depthTest:o,scale:a,lineWidth:l,fixed:c,axisColors:u,hoveredColor:h,opacity:f,onDragStart:d,onDrag:m,onDragEnd:y,userData:g}=C.useContext(Ix),A=Ve(Z=>Z.controls),E=C.useRef(null),x=C.useRef(null),w=C.useRef(0),T=C.useRef(0),I=C.useRef(null),[M,L]=C.useState(!1),P=C.useCallback(Z=>{r&&(E.current.innerText=`${BI(T.current).toFixed(0)}º`,E.current.style.display="block"),Z.stopPropagation();const oe=Z.point.clone(),K=new Q().setFromMatrixPosition(x.current.matrixWorld),V=new Q().setFromMatrixColumn(x.current.matrixWorld,0).normalize(),W=new Q().setFromMatrixColumn(x.current.matrixWorld,1).normalize(),F=new Q().setFromMatrixColumn(x.current.matrixWorld,2).normalize(),Y=new vo().setFromNormalAndCoplanarPoint(F,K);I.current={clickPoint:oe,origin:K,e1:V,e2:W,normal:F,plane:Y},d({component:"Rotator",axis:t,origin:K,directions:[V,W,F]}),A&&(A.enabled=!1),Z.target.setPointerCapture(Z.pointerId)},[r,A,d,t]),R=C.useCallback(Z=>{if(Z.stopPropagation(),M||L(!0),I.current){const{clickPoint:oe,origin:K,e1:V,e2:W,normal:F,plane:Y}=I.current,[te,q]=(n==null?void 0:n[t])||[void 0,void 0];L_.copy(Z.ray),L_.intersectPlane(Y,DI),L_.direction.negate(),L_.intersectPlane(Y,DI);let J=qxe(oe,DI,K,V,W),re=BI(J);Z.shiftKey&&(re=Math.round(re/10)*10,J=Xxe(re)),te!==void 0&&q!==void 0&&q-te<2*Math.PI?(J=rO(J),J=J>Math.PI?J-2*Math.PI:J,J=un.clamp(J,te-w.current,q-w.current),T.current=w.current+J):(T.current=rO(w.current+J),T.current=T.current>Math.PI?T.current-2*Math.PI:T.current),r&&(re=BI(T.current),E.current.innerText=`${re.toFixed(0)}º`),P_.makeRotationAxis(F,J),sO.copy(K).applyMatrix4(P_).sub(K).negate(),P_.setPosition(sO),m(P_)}},[r,m,M,n,t]),U=C.useCallback(Z=>{r&&(E.current.style.display="none"),Z.stopPropagation(),w.current=T.current,I.current=null,y(),A&&(A.enabled=!0),Z.target.releasePointerCapture(Z.pointerId)},[r,A,y]),k=C.useCallback(Z=>{Z.stopPropagation(),L(!1)},[]),H=C.useMemo(()=>{const Z=i.clone().normalize(),oe=e.clone().normalize();return new Xe().makeBasis(Z,oe,Z.clone().cross(oe))},[i,e]),G=c?.65:a*.65,X=C.useMemo(()=>{const oe=[];for(let K=0;K<=32;K++){const V=K*(Math.PI/2)/32;oe.push(new Q(Math.cos(V)*G,Math.sin(V)*G,0))}return oe},[G]);return C.createElement("group",{ref:x,onPointerDown:P,onPointerMove:R,onPointerUp:U,onPointerOut:k,matrix:H,matrixAutoUpdate:!1},r&&C.createElement(MA,{position:[G,G,0]},C.createElement("div",{style:{display:"none",background:"#151520",color:"white",padding:"6px 8px",borderRadius:7,whiteSpace:"nowrap"},className:s,ref:E})),C.createElement(Cu,{points:X,lineWidth:l*4,visible:!1,userData:g}),C.createElement(Cu,{transparent:!0,raycast:()=>null,depthTest:o,points:X,lineWidth:l,side:Li,color:M?h:u[t],opacity:f,polygonOffset:!0,polygonOffsetFactor:-10,fog:!1}))},Zxe=(i,e,t)=>{const n=Math.abs(i.x)>=Math.abs(i.y)&&Math.abs(i.x)>=Math.abs(i.z)?0:Math.abs(i.y)>=Math.abs(i.x)&&Math.abs(i.y)>=Math.abs(i.z)?1:2,r=[0,1,2].sort((m,y)=>Math.abs(e.getComponent(y))-Math.abs(e.getComponent(m))),s=n===r[0]?r[1]:r[0],o=i.getComponent(n),a=i.getComponent(s),l=e.getComponent(n),c=e.getComponent(s),u=t.getComponent(n),f=(t.getComponent(s)-u*(a/o))/(c-l*(a/o));return[(u-f*l)/o,f]},B_=new vc,D_=new Q,oO=new Xe,FI=({dir1:i,dir2:e,axis:t})=>{const{translation:n,translationLimits:r,annotations:s,annotationsClass:o,depthTest:a,scale:l,lineWidth:c,fixed:u,axisColors:h,hoveredColor:f,opacity:d,onDragStart:m,onDrag:y,onDragEnd:g,userData:A}=C.useContext(Ix),E=Ve(V=>V.controls),x=C.useRef(null),w=C.useRef(null),T=C.useRef(null),I=C.useRef(0),M=C.useRef(0),[L,P]=C.useState(!1),R=C.useCallback(V=>{s&&(x.current.innerText=`${n.current[(t+1)%3].toFixed(2)}, ${n.current[(t+2)%3].toFixed(2)}`,x.current.style.display="block"),V.stopPropagation();const W=V.point.clone(),F=new Q().setFromMatrixPosition(w.current.matrixWorld),Y=new Q().setFromMatrixColumn(w.current.matrixWorld,0).normalize(),te=new Q().setFromMatrixColumn(w.current.matrixWorld,1).normalize(),q=new Q().setFromMatrixColumn(w.current.matrixWorld,2).normalize(),J=new vo().setFromNormalAndCoplanarPoint(q,F);T.current={clickPoint:W,e1:Y,e2:te,plane:J},I.current=n.current[(t+1)%3],M.current=n.current[(t+2)%3],m({component:"Slider",axis:t,origin:F,directions:[Y,te,q]}),E&&(E.enabled=!1),V.target.setPointerCapture(V.pointerId)},[s,E,m,t]),U=C.useCallback(V=>{if(V.stopPropagation(),L||P(!0),T.current){const{clickPoint:W,e1:F,e2:Y,plane:te}=T.current,[q,J]=(r==null?void 0:r[(t+1)%3])||[void 0,void 0],[re,ie]=(r==null?void 0:r[(t+2)%3])||[void 0,void 0];B_.copy(V.ray),B_.intersectPlane(te,D_),B_.direction.negate(),B_.intersectPlane(te,D_),D_.sub(W);let[se,ge]=Zxe(F,Y,D_);q!==void 0&&(se=Math.max(se,q-I.current)),J!==void 0&&(se=Math.min(se,J-I.current)),re!==void 0&&(ge=Math.max(ge,re-M.current)),ie!==void 0&&(ge=Math.min(ge,ie-M.current)),n.current[(t+1)%3]=I.current+se,n.current[(t+2)%3]=M.current+ge,s&&(x.current.innerText=`${n.current[(t+1)%3].toFixed(2)}, ${n.current[(t+2)%3].toFixed(2)}`),oO.makeTranslation(se*F.x+ge*Y.x,se*F.y+ge*Y.y,se*F.z+ge*Y.z),y(oO)}},[s,y,L,n,r,t]),k=C.useCallback(V=>{s&&(x.current.style.display="none"),V.stopPropagation(),T.current=null,g(),E&&(E.enabled=!0),V.target.releasePointerCapture(V.pointerId)},[s,E,g]),H=C.useCallback(V=>{V.stopPropagation(),P(!1)},[]),G=C.useMemo(()=>{const V=i.clone().normalize(),W=e.clone().normalize();return new Xe().makeBasis(V,W,V.clone().cross(W))},[i,e]),X=u?1/7:l/7,Z=u?.225:l*.225,oe=L?f:h[t],K=C.useMemo(()=>[new Q(0,0,0),new Q(0,Z,0),new Q(Z,Z,0),new Q(Z,0,0),new Q(0,0,0)],[Z]);return C.createElement("group",{ref:w,matrix:G,matrixAutoUpdate:!1},s&&C.createElement(MA,{position:[0,0,0]},C.createElement("div",{style:{display:"none",background:"#151520",color:"white",padding:"6px 8px",borderRadius:7,whiteSpace:"nowrap"},className:o,ref:x})),C.createElement("group",{position:[X*1.7,X*1.7,0]},C.createElement("mesh",{visible:!0,onPointerDown:R,onPointerMove:U,onPointerUp:k,onPointerOut:H,scale:Z,userData:A},C.createElement("planeGeometry",null),C.createElement("meshBasicMaterial",{transparent:!0,depthTest:a,color:oe,polygonOffset:!0,polygonOffsetFactor:-10,side:Li,fog:!1})),C.createElement(Cu,{position:[-Z/2,-Z/2,0],transparent:!0,depthTest:a,points:K,lineWidth:c,color:oe,opacity:d,polygonOffset:!0,polygonOffsetFactor:-10,userData:A,fog:!1})))},Vv=new Q,aO=new Q,e3e=(i,e,t,n)=>{const r=e.dot(e),s=e.dot(i)-e.dot(t),o=e.dot(n);return o===0?-s/r:(Vv.copy(n).multiplyScalar(r/o).sub(e),aO.copy(n).multiplyScalar(s/o).add(t).sub(i),-Vv.dot(aO)/Vv.dot(Vv))},t3e=new Q(0,1,0),Pv=new Q,lO=new Xe,OI=({direction:i,axis:e})=>{const{scaleLimits:t,annotations:n,annotationsClass:r,depthTest:s,scale:o,lineWidth:a,fixed:l,axisColors:c,hoveredColor:u,opacity:h,onDragStart:f,onDrag:d,onDragEnd:m,userData:y}=C.useContext(Ix),g=Ve(K=>K.size),A=Ve(K=>K.controls),E=C.useRef(null),x=C.useRef(null),w=C.useRef(null),T=C.useRef(1),I=C.useRef(1),M=C.useRef(null),[L,P]=C.useState(!1),R=l?1.2:1.2*o,U=C.useCallback(K=>{n&&(E.current.innerText=`${I.current.toFixed(2)}`,E.current.style.display="block"),K.stopPropagation();const V=new Xe().extractRotation(x.current.matrixWorld),W=K.point.clone(),F=new Q().setFromMatrixPosition(x.current.matrixWorld),Y=i.clone().applyMatrix4(V).normalize(),te=x.current.matrixWorld.clone(),q=te.clone().invert(),J=l?1/f4(x.current.getWorldPosition(Vv),o,K.camera,g):1;M.current={clickPoint:W,dir:Y,mPLG:te,mPLGInv:q,offsetMultiplier:J},f({component:"Sphere",axis:e,origin:F,directions:[Y]}),A&&(A.enabled=!1),K.target.setPointerCapture(K.pointerId)},[n,A,i,f,e,l,o,g]),k=C.useCallback(K=>{if(K.stopPropagation(),L||P(!0),M.current){const{clickPoint:V,dir:W,mPLG:F,mPLGInv:Y,offsetMultiplier:te}=M.current,[q,J]=(t==null?void 0:t[e])||[1e-5,void 0],ie=e3e(V,W,K.ray.origin,K.ray.direction)*te,se=l?ie:ie/o;let ge=Math.pow(2,se*.2);K.shiftKey&&(ge=Math.round(ge*10)/10),ge=Math.max(ge,q/T.current),J!==void 0&&(ge=Math.min(ge,J/T.current)),I.current=T.current*ge,w.current.position.set(0,R+ie,0),n&&(E.current.innerText=`${I.current.toFixed(2)}`),Pv.set(1,1,1),Pv.setComponent(e,ge),lO.makeScale(Pv.x,Pv.y,Pv.z).premultiply(F).multiply(Y),d(lO)}},[n,R,d,L,t,e]),H=C.useCallback(K=>{n&&(E.current.style.display="none"),K.stopPropagation(),T.current=I.current,M.current=null,w.current.position.set(0,R,0),m(),A&&(A.enabled=!0),K.target.releasePointerCapture(K.pointerId)},[n,A,m,R]),G=C.useCallback(K=>{K.stopPropagation(),P(!1)},[]),{radius:X,matrixL:Z}=C.useMemo(()=>{const K=l?a/o*1.8:o/22.5,V=new Xt().setFromUnitVectors(t3e,i.clone().normalize()),W=new Xe().makeRotationFromQuaternion(V);return{radius:K,matrixL:W}},[i,o,a,l]),oe=L?u:c[e];return C.createElement("group",{ref:x},C.createElement("group",{matrix:Z,matrixAutoUpdate:!1,onPointerDown:U,onPointerMove:k,onPointerUp:H,onPointerOut:G},n&&C.createElement(MA,{position:[0,R/2,0]},C.createElement("div",{style:{display:"none",background:"#151520",color:"white",padding:"6px 8px",borderRadius:7,whiteSpace:"nowrap"},className:r,ref:E})),C.createElement("mesh",{ref:w,position:[0,R,0],renderOrder:500,userData:y},C.createElement("sphereGeometry",{args:[X,12,12]}),C.createElement("meshBasicMaterial",{transparent:!0,depthTest:s,color:oe,opacity:h,polygonOffset:!0,polygonOffsetFactor:-10}))))},cO=new Xe,uO=new Xe,hO=new Xe,k_=new Xe,NI=new Xe,h1=new Xe,fO=new Xe,dO=new Xe,pO=new Xe,f1=new ti,UI=new ti,mO=new Q,gO=new Q,AO=new Q,yO=new Q,Lv=new Q,d1=new Q(1,0,0),p1=new Q(0,1,0),m1=new Q(0,0,1),n3e=C.forwardRef(({enabled:i=!0,matrix:e,onDragStart:t,onDrag:n,onDragEnd:r,autoTransform:s=!0,anchor:o,disableAxes:a=!1,disableSliders:l=!1,disableRotations:c=!1,disableScaling:u=!1,activeAxes:h=[!0,!0,!0],offset:f=[0,0,0],rotation:d=[0,0,0],scale:m=1,lineWidth:y=4,fixed:g=!1,translationLimits:A,rotationLimits:E,scaleLimits:x,depthTest:w=!0,axisColors:T=["#ff2060","#20df80","#2080ff"],hoveredColor:I="#ffff40",annotations:M=!1,annotationsClass:L,opacity:P=1,visible:R=!0,userData:U,children:k,...H},G)=>{const X=Ve(J=>J.invalidate),Z=C.useRef(null),oe=C.useRef(null),K=C.useRef(null),V=C.useRef(null),W=C.useRef([0,0,0]),F=C.useRef(new Q(1,1,1)),Y=C.useRef(new Q(1,1,1));C.useLayoutEffect(()=>{o&&(V.current.updateWorldMatrix(!0,!0),k_.copy(V.current.matrixWorld).invert(),f1.makeEmpty(),V.current.traverse(J=>{J.geometry&&(J.geometry.boundingBox||J.geometry.computeBoundingBox(),h1.copy(J.matrixWorld).premultiply(k_),UI.copy(J.geometry.boundingBox),UI.applyMatrix4(h1),f1.union(UI))}),mO.copy(f1.max).add(f1.min).multiplyScalar(.5),gO.copy(f1.max).sub(f1.min).multiplyScalar(.5),AO.copy(gO).multiply(new Q(...o)).add(mO),yO.set(...f).add(AO),K.current.position.copy(yO),X())});const te=C.useMemo(()=>({onDragStart:J=>{cO.copy(oe.current.matrix),uO.copy(oe.current.matrixWorld),t&&t(J),X()},onDrag:J=>{hO.copy(Z.current.matrixWorld),k_.copy(hO).invert(),NI.copy(uO).premultiply(J),h1.copy(NI).premultiply(k_),fO.copy(cO).invert(),dO.copy(h1).multiply(fO),s&&oe.current.matrix.copy(h1),n&&n(h1,dO,NI,J),X()},onDragEnd:()=>{r&&r(),X()},translation:W,translationLimits:A,rotationLimits:E,axisColors:T,hoveredColor:I,opacity:P,scale:m,lineWidth:y,fixed:g,depthTest:w,userData:U,annotations:M,annotationsClass:L}),[t,n,r,W,A,E,x,w,m,y,g,...T,I,P,U,s,M,L]),q=new Q;return Kt(J=>{if(g){const re=f4(K.current.getWorldPosition(q),m,J.camera,J.size);F.current.setScalar(re)}e&&e instanceof Xe&&(oe.current.matrix=e),oe.current.updateWorldMatrix(!0,!0),pO.makeRotationFromEuler(K.current.rotation).setPosition(K.current.position).premultiply(oe.current.matrixWorld),Y.current.setFromMatrixScale(pO),Lv.copy(F.current).divide(Y.current),(Math.abs(K.current.scale.x-Lv.x)>1e-4||Math.abs(K.current.scale.y-Lv.y)>1e-4||Math.abs(K.current.scale.z-Lv.z)>1e-4)&&(K.current.scale.copy(Lv),J.invalidate())}),C.useImperativeHandle(G,()=>oe.current,[]),C.createElement(Ix.Provider,{value:te},C.createElement("group",{ref:Z},C.createElement("group",ot({ref:oe,matrix:e,matrixAutoUpdate:!1},H),C.createElement("group",{visible:R,ref:K,position:f,rotation:d},i&&C.createElement(C.Fragment,null,!a&&h[0]&&C.createElement(RI,{axis:0,direction:d1}),!a&&h[1]&&C.createElement(RI,{axis:1,direction:p1}),!a&&h[2]&&C.createElement(RI,{axis:2,direction:m1}),!l&&h[0]&&h[1]&&C.createElement(FI,{axis:2,dir1:d1,dir2:p1}),!l&&h[0]&&h[2]&&C.createElement(FI,{axis:1,dir1:m1,dir2:d1}),!l&&h[2]&&h[1]&&C.createElement(FI,{axis:0,dir1:p1,dir2:m1}),!c&&h[0]&&h[1]&&C.createElement(kI,{axis:2,dir1:d1,dir2:p1}),!c&&h[0]&&h[2]&&C.createElement(kI,{axis:1,dir1:m1,dir2:d1}),!c&&h[2]&&h[1]&&C.createElement(kI,{axis:0,dir1:p1,dir2:m1}),!u&&h[0]&&C.createElement(OI,{axis:0,direction:d1}),!u&&h[1]&&C.createElement(OI,{axis:1,direction:p1}),!u&&h[2]&&C.createElement(OI,{axis:2,direction:m1}))),C.createElement("group",{ref:V},k))))}),i3e=C.forwardRef(({options:i={video:!0},...e},t)=>{const n=Th(()=>navigator.mediaDevices.getDisplayMedia(i),[]);return C.useEffect(()=>()=>{n==null||n.getTracks().forEach(r=>r.stop()),Ax([])},[n]),C.createElement(T4,ot({ref:t},e,{src:n}))}),SW=C.forwardRef(({constraints:i={audio:!1,video:{facingMode:"user"}},...e},t)=>{const n=Th(()=>navigator.mediaDevices.getUserMedia(i),[]);return C.useEffect(()=>()=>{n==null||n.getTracks().forEach(r=>r.stop()),Ax([])},[n]),C.createElement(T4,ot({ref:t},e,{src:n}))}),r3e=new Q(0,0,-1),s3e=(function(){const i=new Q,e=new Q,t=new Q,n=new Q,r=new Q;return function(s,o,a,l){return i.copy(s),e.copy(o),t.copy(a),n.copy(e).sub(i),r.copy(t).sub(i),l.crossVectors(r,n).normalize()}})();function o3e(i,e){return i.clone().add(e).multiplyScalar(.5)}const wW=C.forwardRef(({points:i=hS.SAMPLE_FACELANDMARKER_RESULT.faceLandmarks[0],face:e,facialTransformationMatrix:t,faceBlendshapes:n,offset:r,offsetScalar:s=80,width:o,height:a,depth:l=1,verticalTri:c=[159,386,152],origin:u,eyes:h=!0,eyesAsOrigin:f=!1,debug:d=!1,children:m,...y},g)=>{var A;e&&(i=e.keypoints,console.warn("Facemesh `face` prop is deprecated: use `points` instead"));const E=C.useRef(null),x=C.useRef(null),w=C.useRef(null),T=C.useRef(null),I=C.useRef(null),M=C.useRef(null),L=C.useRef(null),[P]=C.useState(()=>new Q),[R]=C.useState(()=>new _n),[U]=C.useState(()=>new Xt),[k]=C.useState(()=>new Q),{invalidate:H}=Ve();C.useEffect(()=>{var V;(V=I.current)==null||V.geometry.setIndex(hS.TRIANGULATION)},[]);const[G]=C.useState(()=>new Q);C.useEffect(()=>{var V,W;const F=(V=I.current)==null?void 0:V.geometry;if(!F)return;if(F.setFromPoints(i),F.setDrawRange(0,hS.TRIANGULATION.length),t)if(R.matrix.fromArray(t.data),R.matrix.decompose(R.position,R.quaternion,R.scale),R.rotation.y*=-1,R.rotation.z*=-1,U.setFromEuler(R.rotation),r){var Y;R.position.y*=-1,R.position.z*=-1,(Y=E.current)==null||Y.position.copy(R.position.divideScalar(s))}else{var te;(te=E.current)==null||te.position.set(0,0,0)}else s3e(i[c[0]],i[c[1]],i[c[2]],P),U.setFromUnitVectors(r3e,P);const q=U.clone().invert();if(F.computeBoundingBox(),d&&H(),F.center(),F.applyQuaternion(q),(W=T.current)==null||W.setRotationFromQuaternion(U),h){if(!n)console.warn("Facemesh `eyes` option only works if `faceBlendshapes` is provided: skipping.");else if(M.current&&L.current&&w.current)if(f){const J=M.current._computeSphere(F),re=L.current._computeSphere(F);u=o3e(J.center,re.center).negate(),M.current._update(F,n,J),L.current._update(F,n,re)}else M.current._update(F,n),L.current._update(F,n)}if(w.current){if(u!==void 0)if(typeof u=="number"){const J=F.getAttribute("position");k.set(-J.getX(u),-J.getY(u),-J.getZ(u))}else u.isVector3&&k.copy(u);else k.setScalar(0);w.current.position.copy(k)}if(x.current){let J=1;(o||a||l)&&(F.boundingBox.getSize(G),o&&(J=o/G.x),a&&(J=a/G.y),l&&(J=l/G.z)),x.current.scale.setScalar(J!==1?J:1)}F.computeVertexNormals(),F.attributes.position.needsUpdate=!0},[i,t,n,R,r,s,o,a,l,c,u,h,d,H,P,U,G,k]);const X=C.useMemo(()=>({outerRef:T,meshRef:I,eyeRightRef:M,eyeLeftRef:L}),[]);C.useImperativeHandle(g,()=>X,[X]);const[Z]=C.useState(()=>new Q),oe=(A=I.current)==null?void 0:A.geometry.boundingBox,K=(oe==null?void 0:oe.getSize(Z).z)||1;return C.createElement("group",y,C.createElement("group",{ref:E},C.createElement("group",{ref:T},C.createElement("group",{ref:x},d?C.createElement(C.Fragment,null,C.createElement("axesHelper",{args:[K]}),C.createElement(Cu,{points:[[0,0,0],[0,0,-K]],color:65535})):null,C.createElement("group",{ref:w},h&&n&&C.createElement("group",{name:"eyes"},C.createElement(Y5,{side:"left",ref:M,debug:d}),C.createElement(Y5,{side:"right",ref:L,debug:d})),C.createElement("mesh",{ref:I,name:"face"},m,d?C.createElement(C.Fragment,null,oe&&C.createElement("box3Helper",{args:[oe]})):null))))))}),M1={contourLandmarks:{right:[33,133,159,145,153],left:[263,362,386,374,380]},blendshapes:{right:[14,16,18,12],left:[13,15,17,11]},color:{right:"red",left:"#00ff00"},fov:{horizontal:100,vertical:90}},Y5=C.forwardRef(({side:i,debug:e=!0},t)=>{const n=C.useRef(null),r=C.useRef(null),[s]=C.useState(()=>new Bi),o=C.useCallback(h=>{const f=h.getAttribute("position"),m=M1.contourLandmarks[i].map(y=>new Q(f.getX(y),f.getY(y),f.getZ(y)));return s.center.set(0,0,0),m.forEach(y=>s.center.add(y)),s.center.divideScalar(m.length),s.radius=m[0].sub(m[1]).length()/2,s},[s,i]),[a]=C.useState(()=>new Eo),l=C.useCallback((h,f,d)=>{if(n.current){var m;(m=d)!==null&&m!==void 0||(d=o(h)),n.current.position.copy(d.center),n.current.scale.setScalar(d.radius)}if(f&&r.current){const y=M1.blendshapes[i],g=f.categories[y[0]].score,A=f.categories[y[1]].score,E=f.categories[y[2]].score,x=f.categories[y[3]].score,w=M1.fov.horizontal*un.DEG2RAD,T=M1.fov.vertical*un.DEG2RAD,I=w*.5*(x-E),M=T*.5*(g-A)*(i==="left"?1:-1);a.set(I,M,0),r.current.setRotationFromEuler(a)}},[o,i,a]),c=C.useMemo(()=>({eyeMeshRef:n,irisDirRef:r,_computeSphere:o,_update:l}),[o,l]);C.useImperativeHandle(t,()=>c,[c]);const u=M1.color[i];return C.createElement("group",null,C.createElement("group",{ref:n},e&&C.createElement("axesHelper",null),C.createElement("group",{ref:r},C.createElement(C.Fragment,null,e&&C.createElement(Cu,{points:[[0,0,0],[0,0,-2]],lineWidth:1,color:u})))))}),hS={TRIANGULATION:[127,34,139,11,0,37,232,231,120,72,37,39,128,121,47,232,121,128,104,69,67,175,171,148,157,154,155,118,50,101,73,39,40,9,151,108,48,115,131,194,204,211,74,40,185,80,42,183,40,92,186,230,229,118,202,212,214,83,18,17,76,61,146,160,29,30,56,157,173,106,204,194,135,214,192,203,165,98,21,71,68,51,45,4,144,24,23,77,146,91,205,50,187,201,200,18,91,106,182,90,91,181,85,84,17,206,203,36,148,171,140,92,40,39,193,189,244,159,158,28,247,246,161,236,3,196,54,68,104,193,168,8,117,228,31,189,193,55,98,97,99,126,47,100,166,79,218,155,154,26,209,49,131,135,136,150,47,126,217,223,52,53,45,51,134,211,170,140,67,69,108,43,106,91,230,119,120,226,130,247,63,53,52,238,20,242,46,70,156,78,62,96,46,53,63,143,34,227,173,155,133,123,117,111,44,125,19,236,134,51,216,206,205,154,153,22,39,37,167,200,201,208,36,142,100,57,212,202,20,60,99,28,158,157,35,226,113,160,159,27,204,202,210,113,225,46,43,202,204,62,76,77,137,123,116,41,38,72,203,129,142,64,98,240,49,102,64,41,73,74,212,216,207,42,74,184,169,170,211,170,149,176,105,66,69,122,6,168,123,147,187,96,77,90,65,55,107,89,90,180,101,100,120,63,105,104,93,137,227,15,86,85,129,102,49,14,87,86,55,8,9,100,47,121,145,23,22,88,89,179,6,122,196,88,95,96,138,172,136,215,58,172,115,48,219,42,80,81,195,3,51,43,146,61,171,175,199,81,82,38,53,46,225,144,163,110,246,33,7,52,65,66,229,228,117,34,127,234,107,108,69,109,108,151,48,64,235,62,78,191,129,209,126,111,35,143,163,161,246,117,123,50,222,65,52,19,125,141,221,55,65,3,195,197,25,7,33,220,237,44,70,71,139,122,193,245,247,130,33,71,21,162,153,158,159,170,169,150,188,174,196,216,186,92,144,160,161,2,97,167,141,125,241,164,167,37,72,38,12,145,159,160,38,82,13,63,68,71,226,35,111,158,153,154,101,50,205,206,92,165,209,198,217,165,167,97,220,115,218,133,112,243,239,238,241,214,135,169,190,173,133,171,208,32,125,44,237,86,87,178,85,86,179,84,85,180,83,84,181,201,83,182,137,93,132,76,62,183,61,76,184,57,61,185,212,57,186,214,207,187,34,143,156,79,239,237,123,137,177,44,1,4,201,194,32,64,102,129,213,215,138,59,166,219,242,99,97,2,94,141,75,59,235,24,110,228,25,130,226,23,24,229,22,23,230,26,22,231,112,26,232,189,190,243,221,56,190,28,56,221,27,28,222,29,27,223,30,29,224,247,30,225,238,79,20,166,59,75,60,75,240,147,177,215,20,79,166,187,147,213,112,233,244,233,128,245,128,114,188,114,217,174,131,115,220,217,198,236,198,131,134,177,132,58,143,35,124,110,163,7,228,110,25,356,389,368,11,302,267,452,350,349,302,303,269,357,343,277,452,453,357,333,332,297,175,152,377,384,398,382,347,348,330,303,304,270,9,336,337,278,279,360,418,262,431,304,408,409,310,415,407,270,409,410,450,348,347,422,430,434,313,314,17,306,307,375,387,388,260,286,414,398,335,406,418,364,367,416,423,358,327,251,284,298,281,5,4,373,374,253,307,320,321,425,427,411,421,313,18,321,405,406,320,404,405,315,16,17,426,425,266,377,400,369,322,391,269,417,465,464,386,257,258,466,260,388,456,399,419,284,332,333,417,285,8,346,340,261,413,441,285,327,460,328,355,371,329,392,439,438,382,341,256,429,420,360,364,394,379,277,343,437,443,444,283,275,440,363,431,262,369,297,338,337,273,375,321,450,451,349,446,342,467,293,334,282,458,461,462,276,353,383,308,324,325,276,300,293,372,345,447,382,398,362,352,345,340,274,1,19,456,248,281,436,427,425,381,256,252,269,391,393,200,199,428,266,330,329,287,273,422,250,462,328,258,286,384,265,353,342,387,259,257,424,431,430,342,353,276,273,335,424,292,325,307,366,447,345,271,303,302,423,266,371,294,455,460,279,278,294,271,272,304,432,434,427,272,407,408,394,430,431,395,369,400,334,333,299,351,417,168,352,280,411,325,319,320,295,296,336,319,403,404,330,348,349,293,298,333,323,454,447,15,16,315,358,429,279,14,15,316,285,336,9,329,349,350,374,380,252,318,402,403,6,197,419,318,319,325,367,364,365,435,367,397,344,438,439,272,271,311,195,5,281,273,287,291,396,428,199,311,271,268,283,444,445,373,254,339,263,466,249,282,334,296,449,347,346,264,447,454,336,296,299,338,10,151,278,439,455,292,407,415,358,371,355,340,345,372,390,249,466,346,347,280,442,443,282,19,94,370,441,442,295,248,419,197,263,255,359,440,275,274,300,383,368,351,412,465,263,467,466,301,368,389,380,374,386,395,378,379,412,351,419,436,426,322,373,390,388,2,164,393,370,462,461,164,0,267,302,11,12,374,373,387,268,12,13,293,300,301,446,261,340,385,384,381,330,266,425,426,423,391,429,355,437,391,327,326,440,457,438,341,382,362,459,457,461,434,430,394,414,463,362,396,369,262,354,461,457,316,403,402,315,404,403,314,405,404,313,406,405,421,418,406,366,401,361,306,408,407,291,409,408,287,410,409,432,436,410,434,416,411,264,368,383,309,438,457,352,376,401,274,275,4,421,428,262,294,327,358,433,416,367,289,455,439,462,370,326,2,326,370,305,460,455,254,449,448,255,261,446,253,450,449,252,451,450,256,452,451,341,453,452,413,464,463,441,413,414,258,442,441,257,443,442,259,444,443,260,445,444,467,342,445,459,458,250,289,392,290,290,328,460,376,433,435,250,290,392,411,416,433,341,463,464,453,464,465,357,465,412,343,412,399,360,363,440,437,399,456,420,456,363,401,435,288,372,383,353,339,255,249,448,261,255,133,243,190,133,155,112,33,246,247,33,130,25,398,384,286,362,398,414,362,463,341,263,359,467,263,249,255,466,467,260,75,60,166,238,239,79,162,127,139,72,11,37,121,232,120,73,72,39,114,128,47,233,232,128,103,104,67,152,175,148,173,157,155,119,118,101,74,73,40,107,9,108,49,48,131,32,194,211,184,74,185,191,80,183,185,40,186,119,230,118,210,202,214,84,83,17,77,76,146,161,160,30,190,56,173,182,106,194,138,135,192,129,203,98,54,21,68,5,51,4,145,144,23,90,77,91,207,205,187,83,201,18,181,91,182,180,90,181,16,85,17,205,206,36,176,148,140,165,92,39,245,193,244,27,159,28,30,247,161,174,236,196,103,54,104,55,193,8,111,117,31,221,189,55,240,98,99,142,126,100,219,166,218,112,155,26,198,209,131,169,135,150,114,47,217,224,223,53,220,45,134,32,211,140,109,67,108,146,43,91,231,230,120,113,226,247,105,63,52,241,238,242,124,46,156,95,78,96,70,46,63,116,143,227,116,123,111,1,44,19,3,236,51,207,216,205,26,154,22,165,39,167,199,200,208,101,36,100,43,57,202,242,20,99,56,28,157,124,35,113,29,160,27,211,204,210,124,113,46,106,43,204,96,62,77,227,137,116,73,41,72,36,203,142,235,64,240,48,49,64,42,41,74,214,212,207,183,42,184,210,169,211,140,170,176,104,105,69,193,122,168,50,123,187,89,96,90,66,65,107,179,89,180,119,101,120,68,63,104,234,93,227,16,15,85,209,129,49,15,14,86,107,55,9,120,100,121,153,145,22,178,88,179,197,6,196,89,88,96,135,138,136,138,215,172,218,115,219,41,42,81,5,195,51,57,43,61,208,171,199,41,81,38,224,53,225,24,144,110,105,52,66,118,229,117,227,34,234,66,107,69,10,109,151,219,48,235,183,62,191,142,129,126,116,111,143,7,163,246,118,117,50,223,222,52,94,19,141,222,221,65,196,3,197,45,220,44,156,70,139,188,122,245,139,71,162,145,153,159,149,170,150,122,188,196,206,216,92,163,144,161,164,2,167,242,141,241,0,164,37,11,72,12,144,145,160,12,38,13,70,63,71,31,226,111,157,158,154,36,101,205,203,206,165,126,209,217,98,165,97,237,220,218,237,239,241,210,214,169,140,171,32,241,125,237,179,86,178,180,85,179,181,84,180,182,83,181,194,201,182,177,137,132,184,76,183,185,61,184,186,57,185,216,212,186,192,214,187,139,34,156,218,79,237,147,123,177,45,44,4,208,201,32,98,64,129,192,213,138,235,59,219,141,242,97,97,2,141,240,75,235,229,24,228,31,25,226,230,23,229,231,22,230,232,26,231,233,112,232,244,189,243,189,221,190,222,28,221,223,27,222,224,29,223,225,30,224,113,247,225,99,60,240,213,147,215,60,20,166,192,187,213,243,112,244,244,233,245,245,128,188,188,114,174,134,131,220,174,217,236,236,198,134,215,177,58,156,143,124,25,110,7,31,228,25,264,356,368,0,11,267,451,452,349,267,302,269,350,357,277,350,452,357,299,333,297,396,175,377,381,384,382,280,347,330,269,303,270,151,9,337,344,278,360,424,418,431,270,304,409,272,310,407,322,270,410,449,450,347,432,422,434,18,313,17,291,306,375,259,387,260,424,335,418,434,364,416,391,423,327,301,251,298,275,281,4,254,373,253,375,307,321,280,425,411,200,421,18,335,321,406,321,320,405,314,315,17,423,426,266,396,377,369,270,322,269,413,417,464,385,386,258,248,456,419,298,284,333,168,417,8,448,346,261,417,413,285,326,327,328,277,355,329,309,392,438,381,382,256,279,429,360,365,364,379,355,277,437,282,443,283,281,275,363,395,431,369,299,297,337,335,273,321,348,450,349,359,446,467,283,293,282,250,458,462,300,276,383,292,308,325,283,276,293,264,372,447,346,352,340,354,274,19,363,456,281,426,436,425,380,381,252,267,269,393,421,200,428,371,266,329,432,287,422,290,250,328,385,258,384,446,265,342,386,387,257,422,424,430,445,342,276,422,273,424,306,292,307,352,366,345,268,271,302,358,423,371,327,294,460,331,279,294,303,271,304,436,432,427,304,272,408,395,394,431,378,395,400,296,334,299,6,351,168,376,352,411,307,325,320,285,295,336,320,319,404,329,330,349,334,293,333,366,323,447,316,15,315,331,358,279,317,14,316,8,285,9,277,329,350,253,374,252,319,318,403,351,6,419,324,318,325,397,367,365,288,435,397,278,344,439,310,272,311,248,195,281,375,273,291,175,396,199,312,311,268,276,283,445,390,373,339,295,282,296,448,449,346,356,264,454,337,336,299,337,338,151,294,278,455,308,292,415,429,358,355,265,340,372,388,390,466,352,346,280,295,442,282,354,19,370,285,441,295,195,248,197,457,440,274,301,300,368,417,351,465,251,301,389,385,380,386,394,395,379,399,412,419,410,436,322,387,373,388,326,2,393,354,370,461,393,164,267,268,302,12,386,374,387,312,268,13,298,293,301,265,446,340,380,385,381,280,330,425,322,426,391,420,429,437,393,391,326,344,440,438,458,459,461,364,434,394,428,396,262,274,354,457,317,316,402,316,315,403,315,314,404,314,313,405,313,421,406,323,366,361,292,306,407,306,291,408,291,287,409,287,432,410,427,434,411,372,264,383,459,309,457,366,352,401,1,274,4,418,421,262,331,294,358,435,433,367,392,289,439,328,462,326,94,2,370,289,305,455,339,254,448,359,255,446,254,253,449,253,252,450,252,256,451,256,341,452,414,413,463,286,441,414,286,258,441,258,257,442,257,259,443,259,260,444,260,467,445,309,459,250,305,289,290,305,290,460,401,376,435,309,250,392,376,411,433,453,341,464,357,453,465,343,357,412,437,343,399,344,360,440,420,437,456,360,420,363,361,401,288,265,372,353,390,339,249,339,448,255],SAMPLE_FACE:{keypoints:[{x:356.2804412841797,y:295.1960563659668,z:-23.786449432373047,name:"lips"},{x:354.8859405517578,y:264.69520568847656,z:-36.718435287475586},{x:355.2180862426758,y:275.3360366821289,z:-21.183712482452393},{x:347.349853515625,y:242.4400234222412,z:-25.093655586242676},{x:354.40135955810547,y:256.67933464050293,z:-38.23572635650635},{x:353.7689971923828,y:247.54886627197266,z:-34.5475435256958},{x:352.1288299560547,y:227.34312057495117,z:-13.095386028289795},{x:303.5013198852539,y:234.67002868652344,z:12.500141859054565,name:"rightEye"},{x:351.09378814697266,y:211.87547206878662,z:-6.413471698760986},{x:350.7115936279297,y:202.1251630783081,z:-6.413471698760986},{x:348.33667755126953,y:168.7741756439209,z:6.483500003814697,name:"faceOval"},{x:356.4806365966797,y:299.2995357513428,z:-23.144519329071045},{x:356.5511703491211,y:302.66146659851074,z:-21.020312309265137},{x:356.6239547729492,y:304.1536331176758,z:-18.137459754943848,name:"lips"},{x:356.5807342529297,y:305.1840591430664,z:-18.767719268798828,name:"lips"},{x:356.8241500854492,y:308.25711250305176,z:-20.16829490661621},{x:357.113037109375,y:312.26277351379395,z:-22.10575819015503},{x:357.34962463378906,y:317.1123218536377,z:-21.837315559387207,name:"lips"},{x:357.6658630371094,y:325.51036834716797,z:-16.27002477645874},{x:355.0201416015625,y:269.36279296875,z:-33.73054027557373},{x:348.5237503051758,y:270.33411026000977,z:-24.93025302886963},{x:279.97331619262695,y:213.24176788330078,z:47.759642601013184,name:"faceOval"},{x:322.66529083251953,y:238.5027265548706,z:5.535193085670471},{x:316.0983657836914,y:239.94489669799805,z:5.777376294136047},{x:309.9431610107422,y:240.24518966674805,z:7.510589361190796},{x:301.31994247436523,y:237.86138534545898,z:13.118728399276733},{x:328.14266204833984,y:235.80496788024902,z:6.646900177001953},{x:313.7326431274414,y:222.11161136627197,z:3.9887237548828125},{x:320.45196533203125,y:221.87729358673096,z:4.601476192474365},{x:307.35679626464844,y:223.63793849945068,z:5.932023525238037},{x:303.0031204223633,y:226.3743782043457,z:8.479321002960205},{x:296.80023193359375,y:242.94299125671387,z:15.931552648544312},{x:332.2352981567383,y:340.77341079711914,z:-10.165848731994629},{x:301.38587951660156,y:233.46447944641113,z:14.764405488967896,name:"rightEye"},{x:279.0147018432617,y:244.37155723571777,z:45.77549457550049},{x:289.60548400878906,y:239.1807460784912,z:23.191204071044922},{x:320.32257080078125,y:267.1292781829834,z:-4.954537749290466},{x:347.64583587646484,y:294.4955062866211,z:-23.062820434570312,name:"lips"},{x:349.28138732910156,y:303.1095886230469,z:-20.238323211669922},{x:338.9453125,y:298.19186210632324,z:-19.456336498260498,name:"lips"},{x:333.36788177490234,y:302.6706790924072,z:-14.776077270507812,name:"lips"},{x:342.89188385009766,y:304.3561363220215,z:-17.752301692962646},{x:337.7375030517578,y:306.0098361968994,z:-13.410515785217285},{x:325.6159210205078,y:316.22995376586914,z:-6.681914925575256},{x:349.0104675292969,y:264.9818515777588,z:-36.274919509887695},{x:347.7138900756836,y:257.5664806365967,z:-37.67549514770508},{x:291.79357528686523,y:218.88171672821045,z:11.578094959259033,name:"rightEyebrow"},{x:332.2689437866211,y:247.56946563720703,z:-3.3730539679527283},{x:332.0074462890625,y:267.1201229095459,z:-19.969879388809204},{x:331.27952575683594,y:263.6967658996582,z:-17.47218608856201},{x:301.04373931884766,y:269.56552505493164,z:3.61815482378006},{x:347.4863815307617,y:249.0706443786621,z:-32.633421421051025},{x:307.26118087768555,y:208.2646894454956,z:1.1591226607561111,name:"rightEyebrow"},{x:297.91919708251953,y:212.22604751586914,z:5.914516448974609,name:"rightEyebrow"},{x:285.1651382446289,y:197.98450469970703,z:36.391637325286865,name:"faceOval"},{x:337.04097747802734,y:211.25229835510254,z:-4.548954665660858},{x:326.5912628173828,y:223.16698551177979,z:6.670243740081787},{x:320.05664825439453,y:309.5834255218506,z:-4.055835008621216},{x:289.6866226196289,y:314.617395401001,z:53.875489234924316,name:"faceOval"},{x:337.4256896972656,y:270.8755302429199,z:-17.67060160636902},{x:343.69922637939453,y:273.0000400543213,z:-18.756048679351807},{x:327.4242401123047,y:309.22399520874023,z:-4.703601002693176,name:"lips"},{x:330.37220001220703,y:308.3323001861572,z:-6.442649960517883},{x:293.87027740478516,y:207.7961826324463,z:9.821539521217346,name:"rightEyebrow"},{x:332.11437225341797,y:271.22812271118164,z:-16.64351224899292},{x:320.1197814941406,y:207.40366458892822,z:-2.48164564371109,name:"rightEyebrow"},{x:318.59575271606445,y:201.07443809509277,z:-3.110446035861969,name:"rightEyebrow"},{x:310.72303771972656,y:175.75075149536133,z:13.328815698623657,name:"faceOval"},{x:289.67578887939453,y:202.29835510253906,z:21.370456218719482},{x:315.30879974365234,y:187.35260009765625,z:5.0304025411605835},{x:287.8936767578125,y:216.54793739318848,z:17.81065821647644,name:"rightEyebrow"},{x:283.9391899108887,y:215.01142501831055,z:32.04984903335571},{x:348.35330963134766,y:299.4155788421631,z:-22.47924566268921},{x:341.1790466308594,y:301.8221855163574,z:-18.977805376052856},{x:335.69713592529297,y:304.4266891479492,z:-14.682706594467163},{x:339.4615173339844,y:272.3654365539551,z:-16.38674020767212},{x:328.99600982666016,y:308.86685371398926,z:-5.616893768310547},{x:332.00313568115234,y:309.1875743865967,z:-10.335084199905396},{x:331.0068130493164,y:307.9274368286133,z:-6.681914925575256,name:"lips"},{x:341.13792419433594,y:266.4876937866211,z:-26.56425952911377},{x:339.02950286865234,y:305.6663703918457,z:-12.33674168586731,name:"lips"},{x:344.22935485839844,y:304.9452781677246,z:-15.161235332489014,name:"lips"},{x:350.1844024658203,y:304.374303817749,z:-17.5305438041687,name:"lips"},{x:348.52630615234375,y:325.9562301635742,z:-16.164982318878174},{x:348.6581802368164,y:317.1624183654785,z:-21.510512828826904,name:"lips"},{x:348.9766311645508,y:312.1923065185547,z:-21.708929538726807},{x:349.2427444458008,y:308.0660820007324,z:-19.643079042434692},{x:349.67491149902344,y:305.42747497558594,z:-18.16080331802368,name:"lips"},{x:337.95589447021484,y:306.6535949707031,z:-12.803598642349243,name:"lips"},{x:337.06878662109375,y:307.63169288635254,z:-14.274203777313232},{x:335.77449798583984,y:309.8449516296387,z:-15.698124170303345},{x:334.6099090576172,y:312.7997016906738,z:-14.764405488967896,name:"lips"},{x:327.2330856323242,y:293.80866050720215,z:-11.864047050476074},{x:280.97679138183594,y:279.79928970336914,z:68.90834331512451,name:"faceOval"},{x:355.13843536376953,y:271.7875671386719,z:-25.350427627563477},{x:334.7235870361328,y:307.4656391143799,z:-9.302158951759338,name:"lips"},{x:333.5293960571289,y:307.89782524108887,z:-10.200862884521484},{x:346.29688262939453,y:276.4256286621094,z:-19.748122692108154},{x:335.16246795654297,y:276.22097969055176,z:-12.313398122787476},{x:345.09132385253906,y:274.7082996368408,z:-19.304605722427368},{x:325.4267883300781,y:252.95130729675293,z:-1.6661019623279572},{x:315.347843170166,y:259.05200958251953,z:-.25604281574487686},{x:330.44933319091797,y:267.7570152282715,z:-14.017432928085327},{x:294.96768951416016,y:185.26001930236816,z:23.903164863586426,name:"faceOval"},{x:299.63531494140625,y:192.7913761138916,z:12.640198469161987},{x:304.5452117919922,y:202.4142837524414,z:3.244667649269104,name:"rightEyebrow"},{x:331.6915512084961,y:320.0467872619629,z:-10.632705688476562},{x:334.5911407470703,y:201.27566814422607,z:-6.133356094360352,name:"rightEyebrow"},{x:331.4815902709961,y:185.44180870056152,z:.6627205014228821},{x:328.05816650390625,y:170.8385467529297,z:7.358860373497009,name:"faceOval"},{x:304.49764251708984,y:239.76297855377197,z:10.387605428695679},{x:290.6382179260254,y:248.85257720947266,z:19.03616428375244},{x:331.5682601928711,y:233.20727348327637,z:7.837390303611755},{x:295.5115509033203,y:228.9834451675415,z:14.41426157951355},{x:336.94332122802734,y:241.8259334564209,z:-5.27842104434967},{x:336.2792205810547,y:262.7049922943115,z:-26.12074375152588},{x:284.4102478027344,y:255.3262710571289,z:25.467140674591064},{x:295.1420593261719,y:253.02655220031738,z:12.430112361907959},{x:303.5196113586426,y:254.20703887939453,z:6.139191389083862},{x:315.73450088500977,y:251.64799690246582,z:3.3788898587226868},{x:324.69661712646484,y:247.56494522094727,z:2.3328344523906708},{x:331.57970428466797,y:243.02241325378418,z:1.1423448473215103},{x:345.6210708618164,y:229.9976634979248,z:-10.825285911560059},{x:286.26644134521484,y:270.37991523742676,z:21.708929538726807},{x:290.2525520324707,y:228.4921360015869,z:17.71728754043579},{x:351.65367126464844,y:269.3400764465332,z:-33.450424671173096},{x:333.1378936767578,y:253.88388633728027,z:-7.230473756790161},{x:277.8318977355957,y:246.95331573486328,z:68.20805549621582,name:"faceOval"},{x:336.6680908203125,y:238.10003757476807,z:.7688578963279724},{x:329.95800018310547,y:269.18323516845703,z:-7.207130789756775},{x:299.17491912841797,y:234.13324356079102,z:15.95489501953125},{x:335.61729431152344,y:258.71752738952637,z:-23.016133308410645},{x:284.1079330444336,y:297.0343494415283,z:63.25934886932373,name:"faceOval"},{x:331.44542694091797,y:230.6892442703247,z:9.92658257484436,name:"rightEye"},{x:341.41536712646484,y:253.01264762878418,z:-29.038610458374023},{x:303.5472869873047,y:327.5896739959717,z:16.725212335586548},{x:304.7756576538086,y:337.4389457702637,z:27.38126277923584,name:"faceOval"},{x:280.80501556396484,y:275.32050132751465,z:45.0752067565918},{x:295.43582916259766,y:318.4501647949219,z:26.2608003616333},{x:281.4303207397461,y:228.7355661392212,z:40.94350814819336},{x:331.2549591064453,y:349.4216537475586,z:-7.376367449760437},{x:352.4247741699219,y:271.7330074310303,z:-24.953596591949463},{x:327.5672912597656,y:260.41900634765625,z:-5.456410646438599},{x:284.5432472229004,y:241.7647933959961,z:29.668869972229004},{x:310,y:235.66174507141113,z:8.502663969993591,name:"rightEye"},{x:315.7071113586426,y:235.7572603225708,z:6.938687562942505,name:"rightEye"},{x:330.41088104248047,y:311.04143142700195,z:-9.325502514839172,name:"lips"},{x:288.5377502441406,y:285.31983375549316,z:21.837315559387207},{x:344.55039978027344,y:359.4300842285156,z:-6.705257892608643,name:"faceOval"},{x:323.41880798339844,y:351.67362213134766,z:7.802375555038452,name:"faceOval"},{x:314.64088439941406,y:346.11894607543945,z:16.36339783668518,name:"faceOval"},{x:349.4945526123047,y:184.8434829711914,z:-.21847527474164963},{x:359.24694061279297,y:359.8348903656006,z:-8.403456211090088,name:"faceOval"},{x:321.26182556152344,y:234.64492321014404,z:6.90950870513916,name:"rightEye"},{x:326.318359375,y:232.90250301361084,z:8.029969334602356,name:"rightEye"},{x:329.6211624145508,y:231.6195774078369,z:9.722331762313843,name:"rightEye"},{x:285.9398078918457,y:228.2351303100586,z:24.650139808654785},{x:325.79288482666016,y:227.88007736206055,z:7.469738721847534,name:"rightEye"},{x:320.1699447631836,y:227.5934886932373,z:6.168370842933655,name:"rightEye"},{x:314.85408782958984,y:227.85282611846924,z:6.2675780057907104,name:"rightEye"},{x:309.3084907531738,y:229.1516876220703,z:7.7031683921813965,name:"rightEye"},{x:305.5621337890625,y:230.92366218566895,z:9.722331762313843,name:"rightEye"},{x:277.8681945800781,y:228.5354232788086,z:59.71122741699219,name:"faceOval"},{x:306.1444664001465,y:235.1954698562622,z:10.603528022766113,name:"rightEye"},{x:355.4478454589844,y:281.96210861206055,z:-20.565123558044434},{x:333.02661895751953,y:288.0105400085449,z:-14.72939133644104},{x:337.15728759765625,y:269.2059516906738,z:-19.8414945602417},{x:345.9898376464844,y:283.5453128814697,z:-20.4834246635437},{x:351.48963928222656,y:219.98916149139404,z:-7.0378947257995605},{x:312.39574432373047,y:336.50628089904785,z:8.671900033950806},{x:321.32152557373047,y:343.1755256652832,z:.9067271649837494},{x:343.78379821777344,y:353.2975959777832,z:-14.355905055999756},{x:296.8791389465332,y:327.91497230529785,z:41.01353645324707,name:"faceOval"},{x:329.6939468383789,y:229.27897453308105,z:8.934508562088013,name:"rightEye"},{x:341.6905212402344,y:241.4073657989502,z:-14.589333534240723},{x:359.03079986572266,y:353.48859786987305,z:-15.803166627883911},{x:333.1861877441406,y:356.43213272094727,z:-1.0234417766332626,name:"faceOval"},{x:283.97483825683594,y:291.4318656921387,z:41.94725513458252},{x:343.33770751953125,y:305.830135345459,z:-15.756480693817139,name:"lips"},{x:342.40283966064453,y:307.7453899383545,z:-17.4021577835083},{x:341.53621673583984,y:311.0595703125,z:-19.047834873199463},{x:340.9107208251953,y:315.4837703704834,z:-18.5576331615448,name:"lips"},{x:339.1478729248047,y:323.42233657836914,z:-14.367576837539673},{x:333.3201599121094,y:307.4406337738037,z:-9.617288708686829},{x:331.2411117553711,y:306.9811820983887,z:-9.669809937477112},{x:329.23255920410156,y:306.0508346557617,z:-9.582273960113525,name:"lips"},{x:322.4586486816406,y:301.33323669433594,z:-7.720675468444824},{x:297.1712112426758,y:286.9552803039551,z:8.240055441856384},{x:341.3060760498047,y:235.4432201385498,z:-7.504753470420837},{x:336.9318389892578,y:224.3451976776123,z:5.829898118972778},{x:332.65323638916016,y:226.70403957366943,z:8.105834126472473},{x:334.67357635498047,y:306.4397621154785,z:-8.981193900108337,name:"lips"},{x:297.4601936340332,y:306.29210472106934,z:15.476365089416504},{x:342.9119110107422,y:222.37077713012695,z:-2.754466235637665},{x:335.4629898071289,y:332.20250129699707,z:-11.823196411132812},{x:353.2412338256836,y:240.56339263916016,z:-27.147831916809082},{x:346.3080596923828,y:236.41446590423584,z:-18.452589511871338},{x:352.6475143432617,y:234.1420555114746,z:-19.748122692108154},{x:337.3209762573242,y:253.39937210083008,z:-16.024924516677856},{x:358.6122131347656,y:344.90861892700195,z:-18.592647314071655},{x:358.1117248535156,y:334.64990615844727,z:-17.49552845954895},{x:346.4450454711914,y:335.0321102142334,z:-16.32838249206543},{x:319.17640686035156,y:320.2833938598633,z:-3.276764452457428},{x:325.2540588378906,y:276.2369728088379,z:-6.460157036781311},{x:326.7214584350586,y:327.3939514160156,z:-7.417217493057251},{x:310.7190132141113,y:277.2265148162842,z:-3.5452082753181458},{x:319.78355407714844,y:284.8238182067871,z:-6.4543211460113525},{x:305.773983001709,y:290.83580017089844,z:.06907138042151928},{x:344.4001770019531,y:344.85408782958984,z:-16.946970224380493},{x:333.1879425048828,y:258.74256134033203,z:-11.90489649772644},{x:313.80598068237305,y:327.08919525146484,z:2.2277912497520447},{x:322.9637908935547,y:334.6819496154785,z:-3.3643004298210144},{x:313.4055519104004,y:311.2166690826416,z:-1.1175429821014404},{x:291.0865783691406,y:298.2831001281738,z:22.467575073242188},{x:305.6580924987793,y:313.3707904815674,z:5.561453700065613},{x:288.23760986328125,y:305.9941864013672,z:36.765122413635254},{x:315.10692596435547,y:296.26991271972656,z:-4.604393839836121},{x:337.50518798828125,y:247.5944423675537,z:-10.597691535949707},{x:338.8450622558594,y:265.47778129577637,z:-27.778091430664062},{x:334.25254821777344,y:269.0671920776367,z:-20.938611030578613},{x:341.64512634277344,y:259.6387195587158,z:-32.189905643463135},{x:331.44081115722656,y:219.0976095199585,z:4.207563698291779},{x:320.56339263916016,y:216.49658203125,z:2.930997312068939},{x:311.21912002563477,y:216.57853603363037,z:2.9674705862998962},{x:303.46256256103516,y:218.54614734649658,z:5.357203483581543},{x:297.99999237060547,y:222.505202293396,z:9.325502514839172},{x:294.93839263916016,y:236.39654159545898,z:18.534289598464966},{x:278.87489318847656,y:259.7095584869385,z:45.68212032318115},{x:300.3782653808594,y:245.38593292236328,z:12.278382778167725},{x:307.06348419189453,y:246.36857986450195,z:8.164191246032715},{x:315.5229187011719,y:245.3949737548828,z:5.503097176551819},{x:323.71395111083984,y:242.75178909301758,z:4.6335723996162415},{x:330.2785873413086,y:239.34658527374268,z:4.937030673027039},{x:334.6982192993164,y:236.0460376739502,z:4.823233783245087},{x:279.3412208557129,y:263.5196113586426,z:70.91583728790283,name:"faceOval"},{x:334.65972900390625,y:271.6648578643799,z:-17.775644063949585},{x:342.05677032470703,y:246.99846267700195,z:-20.84523916244507},{x:344.0357971191406,y:264.5701503753662,z:-32.936880588531494},{x:348.25531005859375,y:268.6645030975342,z:-30.695960521697998},{x:344.12227630615234,y:266.34212493896484,z:-29.808926582336426},{x:337.12318420410156,y:274.2556858062744,z:-15.768152475357056},{x:349.49047088623047,y:269.071683883667,z:-32.51670837402344},{x:350.1683044433594,y:271.4691352844238,z:-24.93025302886963},{x:333.9634704589844,y:230.56639194488525,z:8.89949381351471},{x:338.2147979736328,y:231.4807891845703,z:4.6715047955513},{x:340.4712677001953,y:231.74463272094727,z:-.34996166825294495},{x:303.28975677490234,y:232.24980354309082,z:11.916568279266357,name:"rightEye"},{x:299.4649124145508,y:229.53842639923096,z:12.325069904327393},{x:359.09618377685547,y:241.77349090576172,z:-24.650139808654785},{x:399.46216583251953,y:229.89503860473633,z:15.919880867004395,name:"leftEye"},{x:361.38919830322266,y:269.6129894256592,z:-24.510080814361572},{x:416.9973373413086,y:206.0895538330078,z:53.26857566833496,name:"faceOval"},{x:381.32179260253906,y:235.5476474761963,z:7.6214683055877686},{x:387.8068542480469,y:236.25958442687988,z:8.345099091529846},{x:393.95751953125,y:235.8660364151001,z:10.475142002105713},{x:401.84600830078125,y:232.77019500732422,z:16.760226488113403},{x:375.70568084716797,y:233.48456382751465,z:8.234220147132874},{x:388.17752838134766,y:218.94717693328857,z:6.810300946235657},{x:381.64928436279297,y:219.2656660079956,z:6.711093783378601},{x:394.4760513305664,y:219.66821193695068,z:9.173773527145386},{x:398.8843536376953,y:221.8837022781372,z:12.03328251838684},{x:406.5454864501953,y:237.12156772613525,z:19.7131085395813},{x:383.87447357177734,y:337.6932907104492,z:-8.631049990653992},{x:401.2682342529297,y:228.5916566848755,z:18.359217643737793,name:"leftEye"},{x:422.0449447631836,y:236.73934936523438,z:51.16771221160889},{x:412.69153594970703,y:232.80198097229004,z:27.52131938934326},{x:387.3497772216797,y:263.298397064209,z:-2.8609684109687805},{x:364.5124053955078,y:293.39221000671387,z:-22.397546768188477,name:"lips"},{x:363.62987518310547,y:302.1291446685791,z:-19.643079042434692},{x:373.2334518432617,y:295.8647060394287,z:-18.125789165496826,name:"lips"},{x:378.83365631103516,y:299.5177745819092,z:-13.153743743896484,name:"lips"},{x:369.91477966308594,y:302.5704002380371,z:-16.65518283843994},{x:374.9167251586914,y:303.5416603088379,z:-11.963253021240234},{x:387.58888244628906,y:312.2716999053955,z:-4.680258631706238},{x:360.6635284423828,y:264.31986808776855,z:-35.94811677932739},{x:361.04564666748047,y:256.8225860595703,z:-37.278664112091064},{x:408.3855438232422,y:213.52088928222656,z:15.756480693817139,name:"leftEyebrow"},{x:373.2946014404297,y:245.38101196289062,z:-1.9316278398036957},{x:376.83860778808594,y:264.3721103668213,z:-18.510947227478027},{x:376.9546127319336,y:261.0010528564453,z:-15.989909172058105},{x:406.1498260498047,y:263.5030174255371,z:7.072908878326416},{x:360.07205963134766,y:248.3631706237793,z:-32.16656446456909},{x:393.11119079589844,y:205.10473251342773,z:3.7786373496055603,name:"leftEyebrow"},{x:402.12791442871094,y:207.89000988006592,z:9.383859634399414,name:"leftEyebrow"},{x:410.8693313598633,y:191.6182279586792,z:41.27030849456787,name:"faceOval"},{x:364.9509811401367,y:210.40483474731445,z:-3.758212625980377},{x:375.94444274902344,y:221.1331844329834,z:8.368442058563232},{x:392.1904754638672,y:305.0360298156738,z:-1.752179116010666},{x:419.50225830078125,y:307.25592613220215,z:58.96425247192383,name:"faceOval"},{x:372.0027160644531,y:268.7212657928467,z:-16.631840467453003},{x:366.1614227294922,y:271.6237449645996,z:-18.219159841537476},{x:385.00938415527344,y:305.3863334655762,z:-2.567722797393799},{x:381.99771881103516,y:304.9723720550537,z:-4.575215280056},{x:405.078125,y:203.21216583251953,z:13.713973760604858,name:"leftEyebrow"},{x:377.13207244873047,y:268.4710121154785,z:-15.266278982162476},{x:380.9713363647461,y:205.36980628967285,z:-.7250899076461792,name:"leftEyebrow"},{x:381.7788314819336,y:198.9268398284912,z:-1.184653863310814,name:"leftEyebrow"},{x:385.5204772949219,y:172.1484375,z:16.04826807975769,name:"faceOval"},{x:407.94189453125,y:196.76236152648926,z:25.723915100097656},{x:383.03890228271484,y:184.5157527923584,z:7.393874526023865},{x:411.61781311035156,y:210.79241752624512,z:22.315845489501953,name:"leftEyebrow"},{x:414.30870056152344,y:208.4643030166626,z:37.021894454956055},{x:364.28722381591797,y:298.35777282714844,z:-21.86065673828125},{x:371.3682556152344,y:299.78848457336426,z:-17.834001779556274},{x:376.88201904296875,y:301.6696071624756,z:-13.153743743896484},{x:370.2193832397461,y:270.49095153808594,z:-15.569736957550049},{x:383.5081100463867,y:305.2726364135742,z:-3.673594295978546},{x:380.73760986328125,y:305.96869468688965,z:-8.660228252410889},{x:381.2334442138672,y:304.63574409484863,z:-4.820316135883331,name:"lips"},{x:368.1698989868164,y:264.8884963989258,z:-25.653886795043945},{x:373.5087203979492,y:303.4233856201172,z:-10.95950722694397,name:"lips"},{x:368.4544372558594,y:303.29601287841797,z:-14.169161319732666,name:"lips"},{x:362.76554107666016,y:303.5735607147217,z:-16.911956071853638,name:"lips"},{x:366.60980224609375,y:324.8870658874512,z:-15.616422891616821},{x:365.7067108154297,y:315.95678329467773,z:-20.903596878051758,name:"lips"},{x:365.0083923339844,y:311.2232208251953,z:-21.066999435424805},{x:364.1508102416992,y:307.0583438873291,z:-18.907777070999146},{x:363.37512969970703,y:304.5721435546875,z:-17.42550015449524,name:"lips"},{x:374.580078125,y:304.3059539794922,z:-11.40302300453186,name:"lips"},{x:375.55362701416016,y:305.0998020172119,z:-12.861957550048828},{x:377.2437286376953,y:307.1674346923828,z:-14.215847253799438},{x:378.68587493896484,y:309.9015712738037,z:-13.223772048950195,name:"lips"},{x:383.8992691040039,y:290.29629707336426,z:-9.97326910495758},{x:423.3871841430664,y:271.91688537597656,z:74.37058925628662,name:"faceOval"},{x:377.68043518066406,y:304.62209701538086,z:-7.603961229324341,name:"lips"},{x:379.00428771972656,y:304.9314594268799,z:-8.57852816581726},{x:364.00279998779297,y:275.2813911437988,z:-19.25792098045349},{x:374.68231201171875,y:273.82555961608887,z:-11.28047227859497},{x:365.0354766845703,y:273.4548568725586,z:-18.791062831878662},{x:380.61901092529297,y:249.8848056793213,z:.15501167625188828},{x:391.14158630371094,y:254.7934627532959,z:2.0906515419483185},{x:378.1761169433594,y:264.9612236022949,z:-12.605184316635132},{x:400.9540557861328,y:179.99592304229736,z:27.82477855682373,name:"faceOval"},{x:398.0038833618164,y:188.50656509399414,z:16.094952821731567},{x:394.8717498779297,y:199.0359592437744,z:6.226727366447449,name:"leftEyebrow"},{x:382.10926055908203,y:316.83926582336426,z:-8.946179747581482},{x:366.51588439941406,y:200.32583713531494,z:-5.24632453918457,name:"leftEyebrow"},{x:367.4893569946289,y:183.87210845947266,z:1.9039081037044525},{x:368.6243438720703,y:168.8127565383911,z:8.736093044281006,name:"faceOval"},{x:398.96175384521484,y:234.9675178527832,z:13.713973760604858},{x:412.9645538330078,y:242.23042488098145,z:23.272905349731445},{x:372.05257415771484,y:231.41919136047363,z:9.226294755935669},{x:406.0722351074219,y:223.58965873718262,z:18.370890617370605},{x:368.27442169189453,y:240.2039337158203,z:-4.166713654994965},{x:372.3575210571289,y:260.66442489624023,z:-24.976940155029297},{x:419.2244338989258,y:247.9079246520996,z:30.299127101898193},{x:409.43885803222656,y:246.60913467407227,z:16.398411989212036},{x:401.69139862060547,y:248.76328468322754,z:9.395531415939331},{x:389.7608184814453,y:247.56915092468262,z:5.841569304466248},{x:380.5461883544922,y:244.55984115600586,z:4.263003468513489},{x:373.25817108154297,y:240.80214500427246,z:2.5356262922286987},{x:358.77086639404297,y:229.35615062713623,z:-10.387605428695679},{x:419.5793914794922,y:262.8478717803955,z:26.5175724029541},{x:410.8808898925781,y:222.51372814178467,z:22.199130058288574},{x:358.45714569091797,y:268.91467094421387,z:-33.17030906677246},{x:373.4129333496094,y:251.6385841369629,z:-5.771540403366089},{x:422.5408172607422,y:239.23919677734375,z:74.04378890991211,name:"faceOval"},{x:367.8171920776367,y:236.58040523529053,z:1.820748895406723},{x:378.51959228515625,y:266.2532329559326,z:-5.74819803237915},{x:403.3472442626953,y:229.05112266540527,z:19.689764976501465},{x:372.34840393066406,y:256.6451168060303,z:-21.872329711914062},{x:422.54566192626953,y:289.1587829589844,z:68.67491245269775,name:"faceOval"},{x:371.9297409057617,y:228.90116214752197,z:11.432201862335205,name:"leftEye"},{x:366.21360778808594,y:251.6158962249756,z:-28.19826364517212},{x:409.1571807861328,y:321.3156223297119,z:20.2266526222229},{x:408.52943420410156,y:331.44238471984863,z:31.09278917312622,name:"faceOval"},{x:424.2788314819336,y:267.1992301940918,z:50.467424392700195},{x:415.60352325439453,y:311.6528606414795,z:30.579242706298828},{x:418.12793731689453,y:221.59927368164062,z:46.26569747924805},{x:385.68286895751953,y:346.0184955596924,z:-5.70151150226593},{x:357.82936096191406,y:271.3758373260498,z:-24.836881160736084},{x:379.588623046875,y:257.5071716308594,z:-3.755294680595398},{x:417.4592590332031,y:234.71948146820068,z:34.5475435256958},{x:393.4684371948242,y:231.58967971801758,z:11.408859491348267,name:"leftEye"},{x:387.8864288330078,y:232.14245796203613,z:9.51808214187622,name:"leftEye"},{x:382.4981689453125,y:307.5654888153076,z:-7.522260546684265,name:"lips"},{x:419.00169372558594,y:277.8332805633545,z:26.424202919006348},{x:373.62953186035156,y:357.6375102996826,z:-5.75986921787262,name:"faceOval"},{x:392.8708267211914,y:347.72446632385254,z:10.154176950454712,name:"faceOval"},{x:400.3953552246094,y:341.0005187988281,z:19.39797878265381,name:"faceOval"},{x:382.25440979003906,y:231.66935920715332,z:8.998700976371765,name:"leftEye"},{x:377.14550018310547,y:230.4228687286377,z:9.804032444953918,name:"leftEye"},{x:373.8358688354492,y:229.64950561523438,z:11.292144060134888,name:"leftEye"},{x:414.5794677734375,y:221.67891025543213,z:29.412097930908203},{x:377.00672149658203,y:225.66201210021973,z:9.360517263412476,name:"leftEye"},{x:382.29530334472656,y:224.8431158065796,z:8.32175612449646,name:"leftEye"},{x:387.5133514404297,y:224.49507236480713,z:8.917000889778137,name:"leftEye"},{x:393.15906524658203,y:225.24795055389404,z:10.737749338150024,name:"leftEye"},{x:397.05554962158203,y:226.55359268188477,z:13.002015352249146,name:"leftEye"},{x:420.5299377441406,y:221.014666557312,z:65.40690422058105,name:"faceOval"},{x:397.06920623779297,y:230.6661558151245,z:13.807345628738403,name:"leftEye"},{x:377.94647216796875,y:285.1647090911865,z:-13.305472135543823},{x:372.1118927001953,y:267.1267318725586,z:-18.83774757385254},{x:364.9968719482422,y:282.24411964416504,z:-19.818150997161865},{x:401.973876953125,y:331.20131492614746,z:11.566424369812012},{x:394.3083190917969,y:338.86693954467773,z:3.142542541027069},{x:373.9820861816406,y:351.4504623413086,z:-13.50388765335083},{x:414.3888854980469,y:321.24735832214355,z:45.51872253417969,name:"faceOval"},{x:373.44234466552734,y:227.33163356781006,z:10.626870393753052,name:"leftEye"},{x:364.0731430053711,y:240.31539916992188,z:-13.807345628738403},{x:384.2658233642578,y:353.3793067932129,z:.7385850697755814,name:"faceOval"},{x:423.20526123046875,y:283.5176181793213,z:47.152724266052246},{x:369.42798614501953,y:304.0898895263672,z:-14.647691249847412,name:"lips"},{x:370.63812255859375,y:305.90051651000977,z:-16.211668252944946},{x:371.91192626953125,y:309.0167713165283,z:-17.84567356109619},{x:373.0583953857422,y:313.3545398712158,z:-17.378815412521362,name:"lips"},{x:375.39905548095703,y:321.09289169311523,z:-13.118728399276733},{x:379.2567825317383,y:304.3582534790039,z:-7.924926280975342},{x:381.18797302246094,y:303.7031364440918,z:-7.843226194381714},{x:383.0918502807617,y:302.4884605407715,z:-7.6506465673446655,name:"lips"},{x:389.09461975097656,y:297.1475315093994,z:-5.5497825145721436},{x:411.6408920288086,y:280.24898529052734,z:12.02161192893982},{x:363.3110809326172,y:234.27620887756348,z:-6.775286793708801},{x:366.0474395751953,y:223.29872131347656,z:6.827808618545532},{x:370.34427642822266,y:225.1457118988037,z:9.558931589126587},{x:377.5371551513672,y:303.60079765319824,z:-7.358860373497009,name:"lips"},{x:412.9557800292969,y:299.53579902648926,z:19.39797878265381},{x:360.0810241699219,y:221.72012329101562,z:-2.153385728597641},{x:379.82784271240234,y:329.47723388671875,z:-10.48097848892212},{x:359.08477783203125,y:235.7911491394043,z:-18.079102039337158},{x:369.6688461303711,y:251.5407943725586,z:-14.962821006774902},{x:369.5555114746094,y:333.5307312011719,z:-15.67478060722351},{x:394.0193176269531,y:315.6973171234131,z:-.9920747578144073},{x:383.78997802734375,y:272.7268695831299,z:-4.689012169837952},{x:387.67765045166016,y:323.6722755432129,z:-5.640236139297485},{x:397.8769302368164,y:272.1331214904785,z:-.9395531564950943},{x:389.87476348876953,y:280.5630111694336,z:-4.29218202829361},{x:403.83888244628906,y:285.1167869567871,z:3.0229100584983826},{x:372.5467300415039,y:343.1070327758789,z:-16.153310537338257},{x:374.1112518310547,y:256.3721466064453,z:-10.574349164962769},{x:399.73785400390625,y:321.77515983581543,z:4.849494695663452},{x:392.03365325927734,y:330.56447982788086,z:-1.3407598435878754},{x:398.59134674072266,y:305.93902587890625,z:1.517290621995926},{x:417.95997619628906,y:290.9716987609863,z:26.89105987548828},{x:406.04541778564453,y:307.35154151916504,z:8.666064143180847},{x:420.75328826904297,y:298.40752601623535,z:41.78385257720947},{x:395.4522705078125,y:291.4153575897217,z:-2.1752697229385376},{x:368.6452102661133,y:245.8882999420166,z:-9.453888535499573},{x:370.34900665283203,y:263.56690406799316,z:-26.75100326538086},{x:374.98477935791016,y:266.6126346588135,z:-19.77146625518799},{x:366.99840545654297,y:258.12140464782715,z:-31.372904777526855},{x:371.00616455078125,y:217.63479709625244,z:5.60522198677063},{x:381.30577087402344,y:214.14087295532227,z:4.983716309070587},{x:390.1496124267578,y:213.38221549987793,z:5.593550801277161},{x:397.7696990966797,y:214.3659782409668,z:8.57852816581726},{x:403.1652069091797,y:217.65509605407715,z:13.013685941696167},{x:407.3551940917969,y:230.72525024414062,z:22.444231510162354},{x:424.0876770019531,y:251.7839241027832,z:51.16771221160889},{x:403.50196838378906,y:239.88757610321045,z:15.803166627883911},{x:397.31719970703125,y:241.49806022644043,z:11.233787536621094},{x:388.99425506591797,y:241.4366912841797,z:7.948269248008728},{x:380.7804489135742,y:239.78078842163086,z:6.600214838981628},{x:374.01336669921875,y:237.11946487426758,z:6.349278092384338},{x:369.39125061035156,y:234.35351371765137,z:5.987462401390076},{x:422.9730987548828,y:255.76455116271973,z:76.61150932312012,name:"faceOval"},{x:374.73915100097656,y:269.24214363098145,z:-16.608498096466064},{x:364.61681365966797,y:245.71088790893555,z:-20.02823829650879},{x:365.3834533691406,y:263.34174156188965,z:-32.32996463775635},{x:361.58252716064453,y:267.8273677825928,z:-30.345816612243652},{x:365.37208557128906,y:265.0249671936035,z:-29.178667068481445},{x:372.72605895996094,y:272.05135345458984,z:-14.834434986114502},{x:360.48614501953125,y:268.34827423095703,z:-32.189905643463135},{x:359.9516296386719,y:270.8049201965332,z:-24.650139808654785},{x:369.5049285888672,y:229.01945114135742,z:10.107489824295044},{x:365.5447769165039,y:230.24096488952637,z:5.593550801277161},{x:363.50669860839844,y:230.6208372116089,z:.43622106313705444},{x:399.3529510498047,y:227.65677452087402,z:15.35965085029602,name:"leftEye"},{x:402.5693130493164,y:224.60190296173096,z:15.931552648544312}],box:{xMin:277.8318977355957,yMin:168.7741756439209,xMax:424.2788314819336,yMax:359.8348903656006,width:146.4469337463379,height:191.0607147216797}},SAMPLE_FACELANDMARKER_RESULT:{faceLandmarks:[[{x:.5760777592658997,y:.8639070391654968,z:-.030997956171631813},{x:.572094738483429,y:.7886289358139038,z:-.07189624011516571},{x:.5723551511764526,y:.8075382709503174,z:-.03578168898820877},{x:.5548420548439026,y:.7188365459442139,z:-.057787876576185226},{x:.5706077814102173,y:.7674974799156189,z:-.07740399986505508},{x:.5681378245353699,y:.7387768030166626,z:-.07356284558773041},{x:.5621535181999207,y:.6681165099143982,z:-.04189874976873398},{x:.46613582968711853,y:.6679812073707581,z:.011289681307971478},{x:.5579932928085327,y:.6174106597900391,z:-.03502821549773216},{x:.5563451647758484,y:.5905600190162659,z:-.03928658738732338},{x:.5487832427024841,y:.4900572597980499,z:-.029898937791585922},{x:.5765544176101685,y:.8692144751548767,z:-.02831427752971649},{x:.5771114230155945,y:.873644232749939,z:-.02345779910683632},{x:.5771905779838562,y:.877016007900238,z:-.016658689826726913},{x:.5778058767318726,y:.8770116567611694,z:-.014505492523312569},{x:.5783766508102417,y:.8835000991821289,z:-.015996402129530907},{x:.5792440176010132,y:.8913810849189758,z:-.01924579218029976},{x:.5796768069267273,y:.8996334671974182,z:-.018261712044477463},{x:.5817288160324097,y:.9255813956260681,z:-.007126849144697189},{x:.5726592540740967,y:.7992473244667053,z:-.0643521398305893},{x:.5579419136047363,y:.7996989488601685,z:-.04566684365272522},{x:.4216199815273285,y:.5958762764930725,z:.06776496022939682},{x:.5052269697189331,y:.6796539425849915,z:-.0010737782577052712},{x:.49243026971817017,y:.6838865876197815,z:-.0005227324436418712},{x:.4796970784664154,y:.6856290102005005,z:.002684245817363262},{x:.4618356227874756,y:.6764569878578186,z:.013439622707664967},{x:.5160380601882935,y:.6737282276153564,z:-17607348127057776e-21},{x:.48070961236953735,y:.6255870461463928,z:-.008339674212038517},{x:.49719780683517456,y:.6256808042526245,z:-.008027955889701843},{x:.46674346923828125,y:.6317623853683472,z:-.004460199736058712},{x:.4582492709159851,y:.641118049621582,z:.0011905613355338573},{x:.45408669114112854,y:.6911458969116211,z:.020514748990535736},{x:.535312294960022,y:.9619986414909363,z:.012499462813138962},{x:.4608460068702698,y:.6628725528717041,z:.01517564244568348},{x:.4206731915473938,y:.6828458309173584,z:.07848648726940155},{x:.4390624463558197,y:.6796106696128845,z:.03283142298460007},{x:.5029968619346619,y:.7701570391654968,z:-.009734481573104858},{x:.5595027208328247,y:.8607323169708252,z:-.030043255537748337},{x:.5621269941329956,y:.8738374710083008,z:-.021709579974412918},{x:.5451499819755554,y:.865527331829071,z:-.022014077752828598},{x:.5351184010505676,y:.8705098032951355,z:-.011602800339460373},{x:.5495014190673828,y:.8744956254959106,z:-.016490943729877472},{x:.5395170450210571,y:.8759440779685974,z:-.007333362940698862},{x:.5183624029159546,y:.8959754705429077,z:.010520773939788342},{x:.5604349374771118,y:.7895449995994568,z:-.07082037627696991},{x:.557381272315979,y:.7687489986419678,z:-.07590588927268982},{x:.4432901442050934,y:.6308897733688354,z:.0027153254486620426},{x:.5258325338363647,y:.7151225805282593,z:-.014676518738269806},{x:.5271827578544617,y:.7833116054534912,z:-.037643320858478546},{x:.5257382988929749,y:.7717816233634949,z:-.03401920944452286},{x:.46516409516334534,y:.7705106735229492,z:.0065747760236263275},{x:.5558893084526062,y:.7420997619628906,z:-.0694495290517807},{x:.4720408320426941,y:.6066038608551025,z:-.021204356104135513},{x:.45432573556900024,y:.6158540844917297,z:-.011054684408009052},{x:.4305151402950287,y:.5608053803443909,z:.0396830290555954},{x:.5310865640640259,y:.6157484650611877,z:-.03081176057457924},{x:.5114666223526001,y:.6329749226570129,z:-.00335998204536736},{x:.506435751914978,y:.8786543607711792,z:.012980876490473747},{x:.4480472207069397,y:.8640613555908203,z:.12569651007652283},{x:.5372058153152466,y:.7942581176757812,z:-.03168361634016037},{x:.5488379597663879,y:.8001630306243896,z:-.03280917927622795},{x:.5213388204574585,y:.8794381618499756,z:.011892606504261494},{x:.5242055654525757,y:.8789222240447998,z:.008370225317776203},{x:.4477175176143646,y:.6039950251579285,z:-.0050799972377717495},{x:.526964008808136,y:.7916748523712158,z:-.02968614175915718},{x:.4971255660057068,y:.6050706505775452,z:-.028175678104162216},{x:.4938119053840637,y:.5882453918457031,z:-.03210941329598427},{x:.4757143557071686,y:.5094879865646362,z:-.01300730835646391},{x:.43947282433509827,y:.5816648006439209,z:.01415177434682846},{x:.485664039850235,y:.5477864146232605,z:-.023685332387685776},{x:.43635931611061096,y:.6226438283920288,z:.013606148771941662},{x:.42910251021385193,y:.6102726459503174,z:.03926564007997513},{x:.5605402588844299,y:.8680099248886108,z:-.027318159118294716},{x:.5474816560745239,y:.8702861070632935,z:-.019686367362737656},{x:.5373021364212036,y:.8728838562965393,z:-.010484928265213966},{x:.540735125541687,y:.7979167103767395,z:-.029073253273963928},{x:.5228585004806519,y:.87913578748703,z:.009915109723806381},{x:.530497670173645,y:.8815253973007202,z:.0020524784922599792},{x:.5259912610054016,y:.8790552616119385,z:.007895970717072487},{x:.5433906316757202,y:.7882310748100281,z:-.05121905356645584},{x:.541388213634491,y:.8777219653129578,z:-.00466804439201951},{x:.5515822172164917,y:.8767023086547852,z:-.010475946590304375},{x:.5637003779411316,y:.877059817314148,z:-.015273625031113625},{x:.5640299320220947,y:.9263423085212708,z:-.00658724969252944},{x:.5642300248146057,y:.8993074893951416,z:-.017653480172157288},{x:.5637336373329163,y:.8910360932350159,z:-.01852807030081749},{x:.5637134313583374,y:.8837276697158813,z:-.01482592523097992},{x:.564205527305603,y:.8768964409828186,z:-.01331155002117157},{x:.5419867634773254,y:.8778373599052429,z:-.0037720394320786},{x:.5404468774795532,y:.880696177482605,z:-.005610354244709015},{x:.5392338633537292,y:.8845721483230591,z:-.007352025713771582},{x:.538469672203064,y:.8891173601150513,z:-.005154991988092661},{x:.5189250111579895,y:.8452741503715515,z:-.009755070321261883},{x:.4258975088596344,y:.7662280797958374,z:.1387351155281067},{x:.5725725293159485,y:.8041572570800781,z:-.04583907872438431},{x:.5342061519622803,y:.8785833120346069,z:.002659974154084921},{x:.5324031114578247,y:.8804071545600891,z:.0017832003068178892},{x:.5538818836212158,y:.8078407645225525,z:-.03254539892077446},{x:.5325431823730469,y:.8026832938194275,z:-.019140373915433884},{x:.5514076948165894,y:.8043903112411499,z:-.03313535451889038},{x:.5131856203079224,y:.7284771800041199,z:-.009399853646755219},{x:.49331504106521606,y:.7443980574607849,z:-.005225230939686298},{x:.5239617824554443,y:.7807451486587524,z:-.025881027802824974},{x:.4473606050014496,y:.5315827131271362,z:.011164786294102669},{x:.45718759298324585,y:.5604941248893738,z:-.005943301599472761},{x:.4670005738735199,y:.5909327268600464,z:-.019681761041283607},{x:.5311570167541504,y:.9076261520385742,z:.00389476353302598},{x:.5249923467636108,y:.5893563628196716,z:-.037981919944286346},{x:.5166932344436646,y:.5429551005363464,z:-.03319704160094261},{x:.5085030198097229,y:.49676206707954407,z:-.02691275253891945},{x:.4687720239162445,y:.6834565997123718,z:.008113506250083447},{x:.4426414966583252,y:.7069531679153442,z:.028577271848917007},{x:.5230373740196228,y:.6675713658332825,z:.001773772411979735},{x:.4481240212917328,y:.6527872085571289,z:.012414850294589996},{x:.5339856743812561,y:.7012367844581604,z:-.020220188423991203},{x:.5347223281860352,y:.7761190533638,z:-.05141595005989075},{x:.4315067231655121,y:.7211957573890686,z:.04381405934691429},{x:.45203351974487305,y:.7206180095672607,z:.017288070172071457},{x:.46892452239990234,y:.7265436053276062,z:.005602988880127668},{x:.49314674735069275,y:.7202282547950745,z:-.0006408205372281373},{x:.5104925632476807,y:.7091827392578125,z:-.00362918758764863},{x:.5232142210006714,y:.698553740978241,z:-.00787867046892643},{x:.5497883558273315,y:.6743605136871338,z:-.036349106580019},{x:.43658503890037537,y:.7627100348472595,z:.042555369436740875},{x:.4397648870944977,y:.6528646349906921,z:.017956094816327095},{x:.5653332471847534,y:.7992802858352661,z:-.06365057826042175},{x:.5285563468933105,y:.736810564994812,z:-.018836988136172295},{x:.4180678725242615,y:.6792560815811157,z:.12284679710865021},{x:.5328429937362671,y:.6865872144699097,z:-.010484723374247551},{x:.5230283141136169,y:.7809416055679321,z:-.011922398582100868},{x:.4551771283149719,y:.6650775074958801,z:.01774493046104908},{x:.5337203741073608,y:.7618928551673889,z:-.04697106033563614},{x:.43463975191116333,y:.8133478164672852,z:.1354849934577942},{x:.5225707292556763,y:.6605283617973328,z:.004980515688657761},{x:.5441933870315552,y:.7497199773788452,z:-.06091512367129326},{x:.4774007797241211,y:.9159183502197266,z:.059622734785079956},{x:.48068761825561523,y:.9364941716194153,z:.08404944837093353},{x:.4268292486667633,y:.7657528519630432,z:.09051097184419632},{x:.46051913499832153,y:.8880485892295837,z:.0738474428653717},{x:.4243420660495758,y:.6434382200241089,z:.06230505183339119},{x:.5342157483100891,y:.9835634231567383,z:.021662971004843712},{x:.5668109655380249,y:.8042187094688416,z:-.044937074184417725},{x:.5176341533660889,y:.7530587315559387,z:-.012967454269528389},{x:.430206298828125,y:.6835605502128601,z:.04612284153699875},{x:.4794231951236725,y:.6732114553451538,z:.003970044665038586},{x:.49073347449302673,y:.6722435355186462,z:.0008692514384165406},{x:.5294116139411926,y:.884677529335022,z:.004413890186697245},{x:.4430122375488281,y:.80235356092453,z:.04987282305955887},{x:.5603825449943542,y:1.0092442035675049,z:.026417359709739685},{x:.5186598300933838,y:.9828659892082214,z:.0513598807156086},{x:.5010536909103394,y:.9640932679176331,z:.06591596454381943},{x:.5524769425392151,y:.539441704750061,z:-.035816047340631485},{x:.5879997611045837,y:1.0091472864151,z:.02285068854689598},{x:.5016193985939026,y:.6684437990188599,z:.00028415941051207483},{x:.511952817440033,y:.6642197370529175,z:.0021144719794392586},{x:.5194343328475952,y:.6623469591140747,z:.004674181342124939},{x:.4321230351924896,y:.6496355533599854,z:.03124697133898735},{x:.508686363697052,y:.6479565501213074,z:-.00044765998609364033},{x:.4963986277580261,y:.6431032419204712,z:-.0032507688738405704},{x:.4845542013645172,y:.6430778503417969,z:-.002903624437749386},{x:.4733612537384033,y:.647506833076477,z:.00023347247042693198},{x:.4668654501438141,y:.653346598148346,z:.004762572236359119},{x:.41815051436424255,y:.633708119392395,z:.09809435904026031},{x:.47159942984580994,y:.6711485385894775,z:.007849935442209244},{x:.5734396576881409,y:.8256140351295471,z:-.03155219927430153},{x:.5306524038314819,y:.8337990641593933,z:-.018351426348090172},{x:.5371729135513306,y:.7910830974578857,z:-.037286680191755295},{x:.5549534559249878,y:.8275275826454163,z:-.030664825811982155},{x:.5597432255744934,y:.6418541669845581,z:-.03318847343325615},{x:.4958484172821045,y:.9429569244384766,z:.048340678215026855},{x:.5140507817268372,y:.9634028077125549,z:.03589847311377525},{x:.5587693452835083,y:.9951097369194031,z:.00908728688955307},{x:.46411189436912537,y:.9051855206489563,z:.10601935535669327},{x:.5181609392166138,y:.6554316878318787,z:.002546071307733655},{x:.5436590909957886,y:.7085841298103333,z:-.03844436630606651},{x:.5872187614440918,y:.9960382580757141,z:.0063423276878893375},{x:.5379653573036194,y:.9989125728607178,z:.03636329993605614},{x:.4350326955318451,y:.8088565468788147,z:.09147704392671585},{x:.5523084998130798,y:.8773422837257385,z:-.009068487212061882},{x:.5510149598121643,y:.8816931843757629,z:-.011043853126466274},{x:.5503793954849243,y:.88776695728302,z:-.01348799467086792},{x:.5501549243927002,y:.8954370617866516,z:-.012142189778387547},{x:.546072781085968,y:.9192524552345276,z:-.003157563041895628},{x:.5314661860466003,y:.8771666884422302,z:.0005075141089037061},{x:.5293324589729309,y:.8762547969818115,z:.00039177737198770046},{x:.5275698900222778,y:.8750609755516052,z:47732755774632096e-21},{x:.5104271173477173,y:.8607332110404968,z:.0012934643309563398},{x:.45938700437545776,y:.8134918212890625,z:.023569690063595772},{x:.5418947339057922,y:.6864100694656372,z:-.027333909645676613},{x:.531914234161377,y:.6456130743026733,z:-.005434140563011169},{x:.523697018623352,y:.647885262966156,z:-.0002466466394253075},{x:.5338191390037537,y:.8783687353134155,z:.002268768846988678},{x:.46226605772972107,y:.8610277771949768,z:.04718952998518944},{x:.5434442758560181,y:.6456181406974792,z:-.02327350154519081},{x:.5399754643440247,y:.940219521522522,z:.005075343884527683},{x:.5661457777023315,y:.71457839012146,z:-.06242101639509201},{x:.5523148775100708,y:.6974870562553406,z:-.04863070324063301},{x:.5639959573745728,y:.6923378109931946,z:-.05180761218070984},{x:.5367592573165894,y:.7423217296600342,z:-.03623027727007866},{x:.5853689908981323,y:.9752064943313599,z:-.002361974213272333},{x:.5835235118865967,y:.9493685960769653,z:-.003941743168979883},{x:.5615018606185913,y:.949194610118866,z:-.0015953965485095978},{x:.5068561434745789,y:.9048219323158264,z:.01862684078514576},{x:.5134067535400391,y:.7971825003623962,z:-.008485661819577217},{x:.5223897099494934,y:.925589919090271,z:.01249657291918993},{x:.48500555753707886,y:.7959478497505188,z:-.0032065745908766985},{x:.5037734508514404,y:.8184596300125122,z:-.004932103678584099},{x:.4766361117362976,y:.828806459903717,z:.01027688942849636},{x:.5589827299118042,y:.974656343460083,z:.0009666886180639267},{x:.5294582843780518,y:.7541216611862183,z:-.025603046640753746},{x:.4973002076148987,y:.9208990931510925,z:.031931452453136444},{x:.5163551568984985,y:.9432790875434875,z:.024321340024471283},{x:.49399662017822266,y:.8814862370491028,z:.018687399104237556},{x:.44948166608810425,y:.836137592792511,z:.05702034756541252},{x:.47898444533348083,y:.8836610913276672,z:.03150695189833641},{x:.4454479217529297,y:.8499438166618347,z:.08868525922298431},{x:.49572959542274475,y:.8452823758125305,z:.0036111653316766024},{x:.5362502336502075,y:.7222585678100586,z:-.027912352234125137},{x:.5393770337104797,y:.7850722074508667,z:-.05415399745106697},{x:.531399667263031,y:.7898418307304382,z:-.03883346915245056},{x:.5451627373695374,y:.7717036604881287,z:-.06480253487825394},{x:.5206395983695984,y:.6287745833396912,z:-.010521138086915016},{x:.4974782466888428,y:.6191938519477844,z:-.014098240062594414},{x:.4774145185947418,y:.6193130612373352,z:-.013643337413668633},{x:.4616098403930664,y:.6259890198707581,z:-.008448202162981033},{x:.4516478478908539,y:.6368461847305298,z:9050309745362028e-20},{x:.4485096037387848,y:.6719120740890503,z:.022984720766544342},{x:.42177659273147583,y:.7240667343139648,z:.08511673659086227},{x:.4616215229034424,y:.6988231539726257,z:.014238474890589714},{x:.4755798876285553,y:.7034608721733093,z:.00625590980052948},{x:.4924992024898529,y:.7005885243415833,z:.0009391739731654525},{x:.5082254409790039,y:.693384051322937,z:-.0009464038303121924},{x:.5203112959861755,y:.6849707961082458,z:-.0022114769089967012},{x:.52867591381073,y:.6779075860977173,z:-.002962538506835699},{x:.4213953912258148,y:.7219811677932739,z:.1350894570350647},{x:.5320829749107361,y:.794858992099762,z:-.03181503340601921},{x:.5452795028686523,y:.7286570072174072,z:-.04771539941430092},{x:.5496407747268677,y:.7866933345794678,z:-.06452003121376038},{x:.557040274143219,y:.7962084412574768,z:-.05837344378232956},{x:.549176812171936,y:.7895247936248779,z:-.057761140167713165},{x:.5362890362739563,y:.8005836606025696,z:-.026903774589300156},{x:.560200035572052,y:.7983731031417847,z:-.06172555685043335},{x:.5616944432258606,y:.8022753596305847,z:-.045200999826192856},{x:.5273328423500061,y:.6611284017562866,z:.0029021520167589188},{x:.534850537776947,y:.6660012006759644,z:-.005215510260313749},{x:.5394860506057739,y:.6701375246047974,z:-.014931917190551758},{x:.4634307324886322,y:.658291757106781,z:.009295716881752014},{x:.4538393020629883,y:.6519932150840759,z:.00930330716073513},{x:.5776031613349915,y:.7159298658370972,z:-.057365912944078445},{x:.6504855155944824,y:.6461779475212097,z:.014184834435582161},{x:.5860154032707214,y:.7962266206741333,z:-.04522843658924103},{x:.6842049360275269,y:.5631637573242188,z:.07207967340946198},{x:.6152560710906982,y:.6674962639808655,z:.0007529259892180562},{x:.6280948519706726,y:.6684326529502869,z:.0016892586136236787},{x:.6408625245094299,y:.6663892269134521,z:.005331226624548435},{x:.6557814478874207,y:.6534678936004639,z:.01646413467824459},{x:.6035663485527039,y:.6639701724052429,z:.0013799630105495453},{x:.6329053044319153,y:.608010470867157,z:-.006195899099111557},{x:.6167260408401489,y:.6117533445358276,z:-.006319951266050339},{x:.6471013426780701,y:.6112449765205383,z:-.0017843559617176652},{x:.6560901999473572,y:.6185776591300964,z:.004047257360070944},{x:.6666946411132812,y:.6651176810264587,z:.023647578433156013},{x:.6311345100402832,y:.9495396018028259,z:.014004078693687916},{x:.6544655561447144,y:.6397901773452759,z:.01809609681367874},{x:.6965808868408203,y:.6482675075531006,z:.08304904401302338},{x:.679817259311676,y:.650188148021698,z:.03632688894867897},{x:.6336516737937927,y:.7541458010673523,z:-.007742783520370722},{x:.5921701192855835,y:.8567668199539185,z:-.029399123042821884},{x:.591663658618927,y:.870215654373169,z:-.02103729173541069},{x:.6068367958068848,y:.8584195375442505,z:-.020668085664510727},{x:.6176617741584778,y:.860965371131897,z:-.009790095500648022},{x:.6040634512901306,y:.8686612844467163,z:-.015289564616978168},{x:.6143736839294434,y:.8671170473098755,z:-.005712216719985008},{x:.6373105049133301,y:.8815656900405884,z:.012672550976276398},{x:.5832505822181702,y:.7866312861442566,z:-.07051534950733185},{x:.5836675763130188,y:.7658692598342896,z:-.07566110789775848},{x:.6709531545639038,y:.604898989200592,z:.005951565690338612},{x:.6029891967773438,y:.705652117729187,z:-.013388276100158691},{x:.6131622195243835,y:.7728396058082581,z:-.036248479038476944},{x:.6123163104057312,y:.7612020373344421,z:-.03264721855521202},{x:.6696187853813171,y:.744706928730011,z:.009673702530562878},{x:.5803102254867554,y:.7385968565940857,z:-.0689152330160141},{x:.6404349207878113,y:.5877999663352966,z:-.01929756999015808},{x:.6588467955589294,y:.5929454565048218,z:-.008487257175147533},{x:.6720337867736816,y:.530631422996521,z:.043437421321868896},{x:.584305465221405,y:.6099005341529846,z:-.030301367864012718},{x:.6034283638000488,y:.6217452883720398,z:-.001970183802768588},{x:.6460927724838257,y:.8608663082122803,z:.015541625209152699},{x:.6957815289497375,y:.8326103091239929,z:.13015234470367432},{x:.6043362617492676,y:.7861682772636414,z:-.030476901680231094},{x:.594293475151062,y:.7942103147506714,z:-.032218821346759796},{x:.6324057579040527,y:.8665139675140381,z:.014255806803703308},{x:.6296147704124451,y:.8667733669281006,z:.010388285852968693},{x:.663644552230835,y:.5798642635345459,z:-.0022301070857793093},{x:.6140630841255188,y:.7809288501739502,z:-.02835679054260254},{x:.615908145904541,y:.5921698212623596,z:-.026804860681295395},{x:.617181122303009,y:.5748661756515503,z:-.03060605563223362},{x:.6222207546234131,y:.49137672781944275,z:-.011151673272252083},{x:.6669357419013977,y:.5541607141494751,z:.017466170713305473},{x:.6182981729507446,y:.5320425629615784,z:-.021793590858578682},{x:.6760554313659668,y:.595052182674408,z:.017115700989961624},{x:.6801463961601257,y:.5800720453262329,z:.043127160519361496},{x:.5922210812568665,y:.8644017577171326,z:-.02662893570959568},{x:.6054555177688599,y:.8637874722480774,z:-.018363753333687782},{x:.6161889433860779,y:.8641164898872375,z:-.008808949030935764},{x:.6017249822616577,y:.7901403307914734,z:-.028126630932092667},{x:.631446123123169,y:.8664817810058594,z:.012112865224480629},{x:.6249198913574219,y:.8716511130332947,z:.003882825840264559},{x:.6281915903091431,y:.867301881313324,z:.009891441091895103},{x:.5986843109130859,y:.7813931703567505,z:-.050227612257003784},{x:.6126407384872437,y:.869275689125061,z:-.0031255714129656553},{x:.6027271151542664,y:.8711842894554138,z:-.009324162267148495},{x:.59088134765625,y:.8742044568061829,z:-.014608660712838173},{x:.5984604358673096,y:.9216185212135315,z:-.005981989670544863},{x:.5950398445129395,y:.8964707255363464,z:-.01703473925590515},{x:.5941568613052368,y:.8882410526275635,z:-.017784785479307175},{x:.5928806662559509,y:.8803883194923401,z:-.014153128489851952},{x:.5909661054611206,y:.8748103976249695,z:-.012609979137778282},{x:.6128016710281372,y:.8702545762062073,z:-.0022550546564161777},{x:.6150846481323242,y:.8726804256439209,z:-.00414019962772727},{x:.6173093914985657,y:.8770190477371216,z:-.005970994010567665},{x:.619335412979126,y:.8814800977706909,z:-.0036864024586975574},{x:.6292637586593628,y:.8314558267593384,z:-.007714875973761082},{x:.702275276184082,y:.7320667505264282,z:.1433621346950531},{x:.6204835176467896,y:.8689177632331848,z:.0044869170524179935},{x:.6223508715629578,y:.8704851269721985,z:.00352082890458405},{x:.590448260307312,y:.8029727935791016,z:-.03200828656554222},{x:.6097423434257507,y:.7933741211891174,z:-.018042555078864098},{x:.59229576587677,y:.7993767261505127,z:-.032564569264650345},{x:.6171364188194275,y:.7153720259666443,z:-.007672437466681004},{x:.6389747858047485,y:.726390540599823,z:-.002999067772179842},{x:.6151940226554871,y:.769412100315094,z:-.024427521973848343},{x:.6526776552200317,y:.505868136882782,z:.01412637997418642},{x:.6475822329521179,y:.5375454425811768,z:-.0033899128902703524},{x:.6433356404304504,y:.5714520215988159,z:-.017428796738386154},{x:.626949667930603,y:.8962116837501526,z:.005602736957371235},{x:.5868416428565979,y:.5829002261161804,z:-.03727729618549347},{x:.5877229571342468,y:.5345035791397095,z:-.032396964728832245},{x:.5887066125869751,y:.48655083775520325,z:-.025856535881757736},{x:.6507197618484497,y:.6612282991409302,z:.011114613153040409},{x:.6803066730499268,y:.677992045879364,z:.032125361263751984},{x:.5963194370269775,y:.6598632335662842,z:.002976928371936083},{x:.667536199092865,y:.6274255514144897,z:.015618261881172657},{x:.5930740833282471,y:.6940041780471802,z:-.019217798486351967},{x:.6053346395492554,y:.7676517963409424,z:-.050308309495449066},{x:.6934473514556885,y:.6884298920631409,z:.04794462397694588},{x:.6738007664680481,y:.6934011578559875,z:.020697161555290222},{x:.6588084697723389,y:.7033141851425171,z:.008462334051728249},{x:.6346072554588318,y:.7029502391815186,z:.001542167621664703},{x:.6157816648483276,y:.6966525912284851,z:-.002009218093007803},{x:.6015574336051941,y:.688928484916687,z:-.006588225718587637},{x:.5746836066246033,y:.6711069345474243,z:-.03597589209675789},{x:.6947521567344666,y:.7309479117393494,z:.046707939356565475},{x:.6759101152420044,y:.6249120831489563,z:.021654341369867325},{x:.5794773101806641,y:.7971615195274353,z:-.06339326500892639},{x:.6041849851608276,y:.727514922618866,z:-.017512541264295578},{x:.6968844532966614,y:.6440950036048889,z:.12727996706962585},{x:.5910853147506714,y:.679325520992279,z:-.009497715160250664},{x:.6157375574111938,y:.7695677280426025,z:-.010624290443956852},{x:.6606494784355164,y:.6410489678382874,z:.0208158977329731},{x:.6040687561035156,y:.7531470656394958,z:-.045887019485235214},{x:.7012156248092651,y:.780247151851654,z:.14028730988502502},{x:.595149576663971,y:.6527782678604126,z:.006308757700026035},{x:.5925500392913818,y:.7436665892601013,z:-.060151755809783936},{x:.6780198812484741,y:.8905693888664246,z:.0626060739159584},{x:.676746666431427,y:.9113880395889282,z:.08726003766059875},{x:.7030686140060425,y:.7312687635421753,z:.09529774636030197},{x:.688987135887146,y:.8588417172431946,z:.07752864807844162},{x:.6883691549301147,y:.6109960675239563,z:.06669612973928452},{x:.6358906030654907,y:.9702065587043762,z:.023120900616049767},{x:.5781539678573608,y:.8023634552955627,z:-.044763918966054916},{x:.6170316934585571,y:.7408350706100464,z:-.011375460773706436},{x:.688542366027832,y:.6516284346580505,z:.050206027925014496},{x:.6385149359703064,y:.6540714502334595,z:.006462941411882639},{x:.6279382109642029,y:.6563615798950195,z:.003062846139073372},{x:.6268895268440247,y:.8736732006072998,z:.00627936702221632},{x:.6944946050643921,y:.7709181308746338,z:.053824134171009064},{x:.614617109298706,y:1.0022112131118774,z:.02719894051551819},{x:.6493719220161438,y:.9665167927742004,z:.053563784807920456},{x:.6624587178230286,y:.943530797958374,z:.068605437874794},{x:.6162528991699219,y:.6558693051338196,z:.002187855076044798},{x:.6058168411254883,y:.654328465461731,z:.0036193584091961384},{x:.5987918972969055,y:.6536934971809387,z:.006134530063718557},{x:.6831037402153015,y:.6195642948150635,z:.03511790186166763},{x:.6062582731246948,y:.6356398463249207,z:.001280312892049551},{x:.6174948811531067,y:.62776118516922,z:-.0013642468256875873},{x:.6297246217727661,y:.6253792643547058,z:-.0007034156005829573},{x:.6407091617584229,y:.627578616142273,z:.0028144705574959517},{x:.6479622721672058,y:.6322650909423828,z:.00750273372977972},{x:.6915091276168823,y:.5990704298019409,z:.10270945727825165},{x:.6457163095474243,y:.6504453420639038,z:.010696077719330788},{x:.6164222955703735,y:.8231936097145081,z:-.016772059723734856},{x:.6042401194572449,y:.7830976843833923,z:-.03630910441279411},{x:.5922216773033142,y:.8228387236595154,z:-.029992375522851944},{x:.6646111011505127,y:.92097008228302,z:.050967294722795486},{x:.651232898235321,y:.9460107088088989,z:.038000158965587616},{x:.6140977144241333,y:.9882472157478333,z:.009882091544568539},{x:.6870781183242798,y:.8768675327301025,z:.10980932414531708},{x:.5986856818199158,y:.6456438899040222,z:.003999010659754276},{x:.585981547832489,y:.7034481763839722,z:-.0377722829580307},{x:.6342031359672546,y:.9867448806762695,z:.03786521404981613},{x:.7013950943946838,y:.776049017906189,z:.09598205983638763},{x:.6030206680297852,y:.8719133138656616,z:-.007931148633360863},{x:.6050592064857483,y:.8767156004905701,z:-.009791925549507141},{x:.6073468923568726,y:.8831382393836975,z:-.012361008673906326},{x:.6087977290153503,y:.890143632888794,z:-.01098148338496685},{x:.6147705316543579,y:.9110084772109985,z:-.0018823575228452682},{x:.622577965259552,y:.8670604825019836,z:.002609190298244357},{x:.6241236329078674,y:.8651344180107117,z:.0025534380692988634},{x:.6257084608078003,y:.8638408184051514,z:.0023300074972212315},{x:.639931321144104,y:.8449671268463135,z:.0038123116828501225},{x:.6810906529426575,y:.7856625318527222,z:.02717764675617218},{x:.583532452583313,y:.6811994910240173,z:-.026588857173919678},{x:.5855660438537598,y:.6393819451332092,z:-.004512844607234001},{x:.5932201743125916,y:.6398029327392578,z:.0008020466193556786},{x:.6200879812240601,y:.8683351874351501,z:.00417016725987196},{x:.6842559576034546,y:.8330534100532532,z:.050836317241191864},{x:.5754412412643433,y:.6418221592903137,z:-.022838059812784195},{x:.6232790350914001,y:.9295297265052795,z:.006339520215988159},{x:.5764067769050598,y:.694546639919281,z:-.04825803264975548},{x:.59778892993927,y:.7343927621841431,z:-.035004377365112305},{x:.6042810678482056,y:.9441440105438232,z:-.0010970570147037506},{x:.6496372222900391,y:.8869078159332275,z:.021036235615611076},{x:.6274012327194214,y:.7830310463905334,z:-.006658440921455622},{x:.637792706489563,y:.9104999899864197,z:.014290250837802887},{x:.6549934148788452,y:.7748609185218811,z:-.0006672973395325243},{x:.6404005289077759,y:.801220715045929,z:-.0026642554439604282},{x:.6671456694602966,y:.8045546412467957,z:.013180811889469624},{x:.6107483506202698,y:.9680658578872681,z:.001778992242179811},{x:.6060343980789185,y:.744587242603302,z:-.024382334202528},{x:.6602751612663269,y:.8998945355415344,z:.0344940721988678},{x:.6463775038719177,y:.9262562394142151,z:.02617623284459114},{x:.6579852104187012,y:.8602304458618164,z:.021586716175079346},{x:.6926165223121643,y:.8053340315818787,z:.061075080186128616},{x:.6724731922149658,y:.8594399690628052,z:.03457934781908989},{x:.6975721716880798,y:.8183245062828064,z:.09300774335861206},{x:.6512877941131592,y:.8258221745491028,z:.006324059329926968},{x:.594887375831604,y:.7148372530937195,z:-.026898479089140892},{x:.6017440557479858,y:.7773507833480835,z:-.05312420800328255},{x:.6096571683883667,y:.7806998491287231,z:-.037646256387233734},{x:.5952993035316467,y:.7654367685317993,z:-.06398405134677887},{x:.5950021147727966,y:.6201304793357849,z:-.009297547861933708},{x:.6165438890457153,y:.6052900552749634,z:-.012455573305487633},{x:.6362661719322205,y:.6015968918800354,z:-.011649220250546932},{x:.6522727608680725,y:.6046400666236877,z:-.005903332494199276},{x:.6625409722328186,y:.6128141283988953,z:.0030042496509850025},{x:.6688099503517151,y:.6457712054252625,z:.026322703808546066},{x:.7013440728187561,y:.6893666386604309,z:.08984331786632538},{x:.6608623266220093,y:.6749406456947327,z:.0172116681933403},{x:.6482325196266174,y:.6823726296424866,z:.008881398476660252},{x:.6313265562057495,y:.6842025518417358,z:.0031308617908507586},{x:.6147016286849976,y:.6809731721878052,z:.0007630771724507213},{x:.6018834114074707,y:.6755372285842896,z:-.0008834321051836014},{x:.5925027132034302,y:.670681357383728,z:-.001968748401850462},{x:.700127363204956,y:.6871103644371033,z:.13980500400066376},{x:.6095665693283081,y:.7853189706802368,z:-.03074747882783413},{x:.5880423784255981,y:.7229287028312683,z:-.04691500961780548},{x:.5930182337760925,y:.7811514139175415,z:-.06398335844278336},{x:.5867722034454346,y:.7922660112380981,z:-.05794971063733101},{x:.5933279991149902,y:.7842848896980286,z:-.05714067071676254},{x:.6063535809516907,y:.7920218706130981,z:-.02590685710310936},{x:.5839452743530273,y:.794978141784668,z:-.0615212507545948},{x:.5828126072883606,y:.8000800013542175,z:-.0449722595512867},{x:.5909603834152222,y:.6541213393211365,z:.003991890233010054},{x:.5852181911468506,y:.6602938771247864,z:-.004428438376635313},{x:.5825737714767456,y:.6651063561439514,z:-.014345290139317513},{x:.6517343521118164,y:.6362385153770447,z:.012151890434324741},{x:.6615052819252014,y:.6281577944755554,z:.0123682152479887},{x:.4856873154640198,y:.6568945646286011,z:.000720038078725338},{x:.49988406896591187,y:.6547410488128662,z:.0006949726957827806},{x:.48438939452171326,y:.6392973065376282,z:.000705525919329375},{x:.47143134474754333,y:.6589511632919312,z:.0006980331381782889},{x:.48704618215560913,y:.6752797961235046,z:.0006921177846379578},{x:.6243702173233032,y:.640461802482605,z:-6592126737814397e-20},{x:.6390967965126038,y:.6385173797607422,z:-.00016105435497593135},{x:.6230536699295044,y:.6224825382232666,z:-.00016136496560648084},{x:.6095397472381592,y:.641917884349823,z:-.0001803556369850412},{x:.6250996589660645,y:.6586247682571411,z:-.0001785515050869435}]],faceBlendshapes:[{categories:[{index:0,score:5187174338061595e-21,categoryName:"_neutral",displayName:""},{index:1,score:.24521504342556,categoryName:"browDownLeft",displayName:""},{index:2,score:.1987743377685547,categoryName:"browDownRight",displayName:""},{index:3,score:.013400448486208916,categoryName:"browInnerUp",displayName:""},{index:4,score:.012361560948193073,categoryName:"browOuterUpLeft",displayName:""},{index:5,score:.019305096939206123,categoryName:"browOuterUpRight",displayName:""},{index:6,score:28426356948330067e-21,categoryName:"cheekPuff",displayName:""},{index:7,score:34500112633395474e-23,categoryName:"cheekSquintLeft",displayName:""},{index:8,score:483789051486383e-21,categoryName:"cheekSquintRight",displayName:""},{index:9,score:.07650448381900787,categoryName:"eyeBlinkLeft",displayName:""},{index:10,score:.05070012807846069,categoryName:"eyeBlinkRight",displayName:""},{index:11,score:.13978900015354156,categoryName:"eyeLookDownLeft",displayName:""},{index:12,score:.14198613166809082,categoryName:"eyeLookDownRight",displayName:""},{index:13,score:.2177766114473343,categoryName:"eyeLookInLeft",displayName:""},{index:14,score:.014739357866346836,categoryName:"eyeLookInRight",displayName:""},{index:15,score:.02361512929201126,categoryName:"eyeLookOutLeft",displayName:""},{index:16,score:.19679604470729828,categoryName:"eyeLookOutRight",displayName:""},{index:17,score:.04874616861343384,categoryName:"eyeLookUpLeft",displayName:""},{index:18,score:.049392376095056534,categoryName:"eyeLookUpRight",displayName:""},{index:19,score:.34944331645965576,categoryName:"eyeSquintLeft",displayName:""},{index:20,score:.2939716875553131,categoryName:"eyeSquintRight",displayName:""},{index:21,score:.005955042317509651,categoryName:"eyeWideLeft",displayName:""},{index:22,score:.006776117719709873,categoryName:"eyeWideRight",displayName:""},{index:23,score:16942436559475027e-21,categoryName:"jawForward",displayName:""},{index:24,score:.0045165494084358215,categoryName:"jawLeft",displayName:""},{index:25,score:.07803940027952194,categoryName:"jawOpen",displayName:""},{index:26,score:2090057751047425e-20,categoryName:"jawRight",displayName:""},{index:27,score:.06032035872340202,categoryName:"mouthClose",displayName:""},{index:28,score:.00228882092051208,categoryName:"mouthDimpleLeft",displayName:""},{index:29,score:.00781762320548296,categoryName:"mouthDimpleRight",displayName:""},{index:30,score:.0017093931091949344,categoryName:"mouthFrownLeft",displayName:""},{index:31,score:.0019319106359034777,categoryName:"mouthFrownRight",displayName:""},{index:32,score:8485237776767462e-20,categoryName:"mouthFunnel",displayName:""},{index:33,score:.0009051355300471187,categoryName:"mouthLeft",displayName:""},{index:34,score:.0003630454302765429,categoryName:"mouthLowerDownLeft",displayName:""},{index:35,score:.00017601238505449146,categoryName:"mouthLowerDownRight",displayName:""},{index:36,score:.12865161895751953,categoryName:"mouthPressLeft",displayName:""},{index:37,score:.20137207210063934,categoryName:"mouthPressRight",displayName:""},{index:38,score:.0022203284315764904,categoryName:"mouthPucker",displayName:""},{index:39,score:.0009096377179957926,categoryName:"mouthRight",displayName:""},{index:40,score:.34189721941947937,categoryName:"mouthRollLower",displayName:""},{index:41,score:.11409689486026764,categoryName:"mouthRollUpper",displayName:""},{index:42,score:.17172536253929138,categoryName:"mouthShrugLower",displayName:""},{index:43,score:.004038424696773291,categoryName:"mouthShrugUpper",displayName:""},{index:44,score:.00023205230536404997,categoryName:"mouthSmileLeft",displayName:""},{index:45,score:.00019313619122840464,categoryName:"mouthSmileRight",displayName:""},{index:46,score:.0018571305554360151,categoryName:"mouthStretchLeft",displayName:""},{index:47,score:.0023813238367438316,categoryName:"mouthStretchRight",displayName:""},{index:48,score:24323100660694763e-21,categoryName:"mouthUpperUpLeft",displayName:""},{index:49,score:3161552012898028e-20,categoryName:"mouthUpperUpRight",displayName:""},{index:50,score:108198406678639e-21,categoryName:"noseSneerLeft",displayName:""},{index:51,score:12652527630052646e-22,categoryName:"noseSneerRight",displayName:""}],headIndex:-1,headName:""}],facialTransformationMatrixes:[{rows:4,columns:4,data:[.9947517514228821,.10230544209480286,.0013679931871592999,0,-.10230997204780579,.9947447776794434,.003816320328041911,0,-.000970348424743861,-.0039362297393381596,.9999914169311523,0,2.8888821601867676,-7.808934211730957,-30.52109146118164,1]}]}},CW=C.createContext({}),$5={basePath:"https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@0.10.17/wasm",options:{baseOptions:{modelAssetPath:"https://storage.googleapis.com/mediapipe-models/face_landmarker/face_landmarker/float16/1/face_landmarker.task",delegate:"GPU"},runningMode:"VIDEO",outputFaceBlendshapes:!0,outputFacialTransformationMatrixes:!0}},a3e=C.forwardRef(({basePath:i=$5.basePath,options:e=$5.options,children:t},n)=>{const r=JSON.stringify(e),s=Th(async()=>{const{FilesetResolver:o,FaceLandmarker:a}=await U1(async()=>{const{FilesetResolver:c,FaceLandmarker:u}=await Promise.resolve().then(()=>a_e);return{FilesetResolver:c,FaceLandmarker:u}},void 0,import.meta.url),l=await o.forVisionTasks(i);return a.createFromOptions(l,e)},[i,r]);return C.useEffect(()=>()=>{s==null||s.close(),Ax([i,r])},[s,i,r]),C.useImperativeHandle(n,()=>s,[s]),C.createElement(CW.Provider,{value:s},t)});function TW(){return C.useContext(CW)}function vO(i,e){return i.clone().add(e).multiplyScalar(.5)}function g1(i,e,t){const n=i.localToWorld(e);return t.worldToLocal(n)}const bW=C.createContext({}),l3e=C.forwardRef(({camera:i,videoTexture:e={start:!0},manualDetect:t=!1,faceLandmarkerResult:n,manualUpdate:r=!1,makeDefault:s,smoothTime:o=.25,offset:a=!0,offsetScalar:l=80,eyes:c=!1,eyesAsOrigin:u=!0,depth:h=.15,debug:f=!1,facemesh:d},m)=>{var y,g;const A=Ve(re=>re.scene),E=Ve(re=>re.camera),x=Ve(re=>re.set),w=Ve(re=>re.get),T=i||E,I=C.useRef(null),[M]=C.useState(()=>new _n),[L]=C.useState(()=>new Q),[P]=C.useState(()=>new Q),[R]=C.useState(()=>new Q),[U]=C.useState(()=>new Q),k=C.useCallback(()=>{M.parent=T.parent;const re=I.current;if(re){const{outerRef:ie,eyeRightRef:se,eyeLeftRef:ge}=re;if(se.current&&ge.current){const{irisDirRef:xe}=se.current,{irisDirRef:pe}=ge.current;xe.current&&pe.current&&ie.current&&(L.copy(g1(xe.current,new Q(0,0,0),ie.current)),P.copy(g1(pe.current,new Q(0,0,0),ie.current)),M.position.copy(g1(ie.current,vO(L,P),T.parent||A)),R.copy(g1(xe.current,new Q(0,0,1),ie.current)),U.copy(g1(pe.current,new Q(0,0,1),ie.current)),M.lookAt(ie.current.localToWorld(vO(R,U))))}else ie.current&&(M.position.copy(g1(ie.current,new Q(0,0,0),T.parent||A)),M.lookAt(ie.current.localToWorld(new Q(0,0,1))))}return M},[T,P,U,L,R,A,M]),[H]=C.useState(()=>new _n),G=C.useCallback(function(re,ie){if(T){var se;(se=ie)!==null&&se!==void 0||(ie=k()),o>0?(aA.damp3(H.position,ie.position,o,re,void 0,void 0,1e-9),aA.dampE(H.rotation,ie.rotation,o,re,void 0,void 0,1e-9)):(H.position.copy(ie.position),H.rotation.copy(ie.rotation)),T.position.copy(H.position),T.rotation.copy(H.rotation)}},[T,k,o,H.position,H.rotation]);Kt((re,ie)=>{r||G(ie)});const X=C.useRef(null),[Z,oe]=C.useState(),K=TW(),V=C.useCallback((re,ie)=>{const se=X.current;if(!se)return;const ge=se.source.data,xe=K==null?void 0:K.detectForVideo(ge,re);oe(xe)},[K]),W=C.useMemo(()=>Object.assign(Object.create(Ch.prototype),{computeTarget:k,update:G,facemeshApiRef:I}),[k,G]);C.useImperativeHandle(m,()=>W,[W]),C.useEffect(()=>{if(s){const re=w().controls;return x({controls:W}),()=>x({controls:re})}},[s,W,w,x]);const F=n??Z,Y=F==null?void 0:F.faceLandmarks[0],te=F==null||(y=F.facialTransformationMatrixes)==null?void 0:y[0],q=F==null||(g=F.faceBlendshapes)==null?void 0:g[0],J={onVideoFrame:V,...e};return C.createElement(bW.Provider,{value:W},!t&&C.createElement(C.Suspense,{fallback:null},"src"in J?C.createElement(T4,ot({ref:X},J)):C.createElement(SW,ot({ref:X},J))),C.createElement(wW,ot({ref:I,children:C.createElement("meshNormalMaterial",{side:Li})},d,{points:Y,depth:h,facialTransformationMatrix:te,faceBlendshapes:q,eyes:c,eyesAsOrigin:u,offset:a,offsetScalar:l,debug:f,"rotation-z":Math.PI,visible:f})))}),c3e=()=>C.useContext(bW),u3e=Object.freeze(Object.defineProperty({__proto__:null,AccumulativeShadows:Zj,AdaptiveDpr:gxe,AdaptiveEvents:Axe,ArcballControls:bde,AsciiRenderer:ude,BBAnchor:kye,Backdrop:A2e,BakeShadows:pxe,Billboard:KH,Bounds:Qj,Box:xve,Bvh:Tye,CameraControls:Dde,CameraShake:Wve,Capsule:Ove,CatmullRomLine:Bhe,Caustics:E2e,Center:h8,Circle:Eve,Clone:V2,Cloud:O2e,CloudInstance:K5,Clouds:iW,ComputedAttribute:tde,Cone:_ve,ContactShadows:Jj,CubeCamera:_de,CubeTexture:Jde,CubicBezierLine:Lhe,CurveModifier:nve,CycleRaycast:gre,Cylinder:Sve,Decal:ade,Detailed:fxe,DetectGPU:uAe,DeviceOrientationControls:Sde,Dodecahedron:Dve,DragControls:Fse,Edges:uQ,Effects:kfe,Environment:qj,EnvironmentCube:v8,EnvironmentMap:D4,EnvironmentPortal:Xj,Example:zye,Extrude:kve,FaceControls:l3e,FaceLandmarker:a3e,FaceLandmarkerDefaults:$5,Facemesh:wW,FacemeshDatas:hS,FacemeshEye:Y5,FacemeshEyeDefaults:M1,Fbo:yde,Fbx:Zde,FirstPersonControls:Rde,Fisheye:wxe,Float:Kve,FlyControls:wde,GizmoHelper:Gde,GizmoViewcube:Yde,GizmoViewport:$de,Gltf:cde,GradientTexture:Ffe,GradientType:m5,Grid:qde,Helper:W1e,Html:MA,Hud:_Q,Icosahedron:Lve,Image:Gfe,Instance:L4,InstancedAttribute:Jye,Instances:B4,IsObject:K1,KeyboardControls:tle,Ktx2:epe,Lathe:Fve,Lightformer:P2e,Line:Cu,Loader:Sre,MapControls:Cde,MarchingCube:rde,MarchingCubes:ide,MarchingPlane:sde,Mask:_xe,MatcapTexture:V2e,Merged:Xye,MeshDiscardMaterial:mve,MeshDistortMaterial:sve,MeshPortalMaterial:bxe,MeshReflectorMaterial:cve,MeshRefractionMaterial:fve,MeshTransmissionMaterial:pve,MeshWobbleMaterial:ave,MotionPathControls:Ode,MultiMaterial:gve,NormalTexture:K2e,Octahedron:Bve,OrbitControls:yQ,OrthographicCamera:gQ,Outlines:Hfe,PerformanceMonitor:yxe,PerspectiveCamera:Ede,PivotControls:n3e,Plane:Cve,Point:lxe,PointMaterial:Ave,PointMaterialImpl:Gj,PointerLockControls:Mde,Points:cxe,PointsBuffer:dW,Polyhedron:Pve,PositionMesh:Fj,PositionPoint:hW,PositionalAudio:Dhe,Preload:dxe,PresentationControls:Jae,Progress:Ere,QuadraticBezierLine:Phe,RandomizedLight:eW,Reflector:_2e,RenderCubeTexture:yW,RenderTexture:AW,Resize:Qve,Ring:Rve,RoundedBox:zve,Sampler:ede,ScreenQuad:Hve,ScreenSizer:Mhe,ScreenSpace:_he,ScreenVideoTexture:i3e,Scroll:Ooe,ScrollControls:Doe,Segment:hxe,SegmentObject:mW,Segments:uxe,Select:xhe,Shadow:y2e,ShadowAlpha:sxe,Shape:Nve,Sky:L2e,SoftShadows:vve,Sparkles:z2e,Sphere:wve,Splat:Ade,SpotLight:R2e,SpotLightShadow:M2e,SpriteAnimator:tve,Stage:m2e,Stars:k2e,Stats:J1e,StatsGl:tAe,Svg:lde,Tetrahedron:Mve,Text:oQ,Text3D:lQ,Texture:Ofe,Torus:bve,TorusKnot:Ive,TrackballControls:Tde,Trail:Zfe,TrailTexture:Uye,TransformControls:Ide,Tube:Tve,VideoTexture:T4,View:Kxe,WebcamVideoTexture:SW,Wireframe:rxe,accumulativeContext:x8,calcPosFromAngles:nW,calculateScaleFactor:f4,checkIfFrameIsEmpty:gj,createInstances:qye,getFirstFrame:d2,isWebGL2Available:Dfe,meshBounds:mxe,shaderMaterial:Ec,useAnimations:Iye,useAspect:iAe,useBVH:Cye,useBounds:Vj,useBoxProjectedEnv:Dye,useCamera:rAe,useContextBridge:bye,useCubeCamera:AQ,useCubeTexture:FR,useCursor:Are,useDepthBuffer:nAe,useDetectGPU:vj,useEnvironment:bx,useFBO:Ea,useFBX:g4,useFaceControls:c3e,useFaceLandmarker:TW,useFont:p4,useGLTF:Tx,useGizmoContext:m4,useHelper:a8,useIntersect:Lj,useKTX2:A4,useKeyboardControls:nle,useMask:Sxe,useMatcapTexture:aW,useMotion:EQ,useNormalTexture:lW,usePerformanceMonitor:vxe,useProgress:uR,useScroll:dR,useSelect:Ehe,useSpriteAnimator:Zye,useSpriteLoader:b4,useSurfaceSampler:dQ,useTexture:xp,useTrail:fQ,useTrailTexture:Bj,useVideoTexture:mj},Symbol.toStringTag,{value:"Module"}));function xO(i){return NN[i]||UN}function h3e(i,e,t){const n={linear:[[t,0,0],[-t,0,0]],"trigonal-planar":[[t,0,0],[-t*.5,t*.866,0],[-t*.5,-t*.866,0]],bent:[[t*.9,t*.44,0],[-t*.9,t*.44,0]],tetrahedral:[[0,t,0],[t*.943,-t*.333,0],[-t*.471,-t*.333,t*.816],[-t*.471,-t*.333,-t*.816]],"trigonal-pyramidal":[[t*.943,-t*.333,0],[-t*.471,-t*.333,t*.816],[-t*.471,-t*.333,-t*.816]],"trigonal-bipyramidal":[[0,t,0],[0,-t,0],[t,0,0],[-t*.5,0,t*.866],[-t*.5,0,-t*.866]],"see-saw":[[0,t,0],[0,-t,0],[t,0,0],[-t,0,0]],"t-shaped":[[0,t,0],[0,-t,0],[t,0,0]],"square-planar":[[t,0,0],[-t,0,0],[0,0,t],[0,0,-t]],"square-pyramidal":[[0,t,0],[t*.707,-t*.3,t*.707],[t*.707,-t*.3,-t*.707],[-t*.707,-t*.3,t*.707],[-t*.707,-t*.3,-t*.707]],octahedral:[[0,t,0],[0,-t,0],[t,0,0],[-t,0,0],[0,0,t],[0,0,-t]]};if(i&&n[i])return n[i].slice(0,e);const r=[];for(let s=0;s<e;s++){const o=Math.acos(1-2*(s+.5)/e),a=Math.PI*(1+Math.sqrt(5))*s;r.push([t*Math.sin(o)*Math.cos(a),t*Math.cos(o),t*Math.sin(o)*Math.sin(a)])}return r}function f3e(i,e,t){const n=new Map;if(i.length===0)return n;const r=new Map;for(const u of e)r.set(u.from,(r.get(u.from)||0)+1),r.set(u.to,(r.get(u.to)||0)+1);let s=i[0],o=0;for(const u of i){const h=r.get(u.id)||0;h>o&&(o=h,s=u)}n.set(s.id,[0,0,0]);const a=[];for(const u of e)u.from===s.id?a.push(u.to):u.to===s.id&&a.push(u.from);const l=1.5,c=h3e(t,a.length,l);a.forEach((u,h)=>{h<c.length&&n.set(u,c[h])});for(const u of i)if(!n.has(u.id)){let h=[0,0,0];for(const d of e){const m=d.from===u.id?d.to:d.to===u.id?d.from:null;if(m&&n.has(m)){h=n.get(m);break}}const f=l*.8;n.set(u.id,[h[0]+f,h[1]+f*.5,h[2]])}return n}function d3e({atom:i,position:e,radius:t,color:n,showLabel:r=!1,interactive:s=!1,onClick:o}){const a=C.useRef(null),l=C.useCallback(h=>{h.stopPropagation(),o==null||o()},[o]),c=C.useCallback(()=>{s&&a.current&&(document.body.style.cursor="pointer")},[s]),u=C.useCallback(()=>{s&&(document.body.style.cursor="default")},[s]);return N.jsxs("group",{position:e,children:[N.jsxs("mesh",{ref:a,onClick:s?l:void 0,onPointerOver:c,onPointerOut:u,children:[N.jsx("sphereGeometry",{args:[t,32,32]}),N.jsx("meshStandardMaterial",{color:n,roughness:.4,metalness:.1})]}),r&&N.jsx(oQ,{position:[0,t+.2,0],fontSize:.3,color:"#ffffff",anchorX:"center",anchorY:"middle",outlineWidth:.02,outlineColor:"#000000",children:i.symbol})]})}function p3e({start:i,end:e,radius:t,color:n}){const r=[(i[0]+e[0])/2,(i[1]+e[1])/2,(i[2]+e[2])/2],s=new Q(e[0]-i[0],e[1]-i[1],e[2]-i[2]),o=s.length(),a=new Xt;return a.setFromUnitVectors(new Q(0,1,0),s.normalize()),N.jsxs("mesh",{position:r,quaternion:a,children:[N.jsx("cylinderGeometry",{args:[t,t,o,16]}),N.jsx("meshStandardMaterial",{color:n,roughness:.5,metalness:.2})]})}function m3e({molecule:i,style:e="ball-stick",showLabels:t=!1,onAtomClick:n}){const r=C.useMemo(()=>f3e(i.atoms,i.bonds,i.geometry),[i.atoms,i.bonds,i.geometry]),s=C.useCallback(o=>{const a=xO(o);return e==="space-fill"?a.radius*.8:a.radius*.35},[e]);return N.jsxs(N.Fragment,{children:[N.jsx("ambientLight",{intensity:.5}),N.jsx("directionalLight",{position:[5,5,5],intensity:1}),N.jsx("directionalLight",{position:[-5,-5,-5],intensity:.3}),i.atoms.map(o=>{const a=r.get(o.id)||[0,0,0],l=xO(o.symbol),c=s(o.symbol);return N.jsx(d3e,{atom:o,position:a,radius:c,color:l.color,showLabel:t,interactive:!!n,onClick:()=>n==null?void 0:n(o.id,o)},o.id)}),e==="ball-stick"&&i.bonds.map((o,a)=>{const l=r.get(o.from)||[0,0,0],c=r.get(o.to)||[0,0,0];return N.jsx(p3e,{start:l,end:c,radius:.08,color:"#374151"},`bond-${a}`)})]})}function g3e({text:i="Loading 3D viewer..."}){return N.jsx(MA,{center:!0,children:N.jsx("div",{className:"text-gray-500 text-sm",children:i})})}function EO({molecule:i,style:e="ball-stick",showLabels:t=!1,autoRotate:n=!1,autoRotateSpeed:r=2,cameraPreset:s="default",onAtomClick:o,width:a="100%",height:l=300,backgroundColor:c="transparent",className:u="",loadingFallback:h}){const f=C.useMemo(()=>{switch(s){case"top":return[0,5,0];case"front":return[0,0,5];case"side":return[5,0,0];case"default":default:return[3,2,3]}},[s]);return N.jsx("div",{className:`molecule-viewer-3d ${u}`,style:{width:typeof a=="number"?`${a}px`:a,height:typeof l=="number"?`${l}px`:l,backgroundColor:c},children:N.jsxs(oG,{camera:{position:f,fov:50},style:{background:c},children:[N.jsx(C.Suspense,{fallback:h||N.jsx(g3e,{}),children:N.jsx(m3e,{molecule:i,style:e,showLabels:t,onAtomClick:o})}),N.jsx(yQ,{autoRotate:n,autoRotateSpeed:r,enablePan:!0,enableZoom:!0,enableRotate:!0})]})})}const A3e=Object.freeze(Object.defineProperty({__proto__:null,MoleculeViewer3D:EO,default:EO},Symbol.toStringTag,{value:"Module"})),Bv={is:"Íslenska",en:"English",pl:"Polski"},F_={is:"🇮🇸",en:"🇬🇧",pl:"🇵🇱"};function y3e({language:i,onLanguageChange:e,availableLanguages:t=["is","en","pl"],variant:n="dropdown",className:r="",showLabels:s=!0}){return n==="dropdown"?N.jsxs("div",{className:`flex items-center gap-2 ${r}`,children:[s&&N.jsx("span",{className:"text-sm text-gray-600",children:F_[i]}),N.jsx("select",{value:i,onChange:o=>e(o.target.value),className:"text-sm border border-gray-300 rounded-lg px-3 py-1.5 bg-white hover:border-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent cursor-pointer","aria-label":"Select language",children:t.map(o=>N.jsxs("option",{value:o,children:[F_[o]," ",Bv[o]]},o))})]}):n==="buttons"?N.jsx("div",{className:`flex items-center gap-1 ${r}`,role:"group","aria-label":"Language selection",children:t.map(o=>N.jsxs("button",{onClick:()=>e(o),className:`px-3 py-1.5 text-sm rounded-lg transition-colors ${i===o?"bg-blue-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,"aria-pressed":i===o,"aria-label":Bv[o],children:[F_[o]," ",s&&Bv[o]]},o))}):N.jsx("div",{className:`flex items-center gap-0.5 ${r}`,role:"group","aria-label":"Language selection",children:t.map(o=>N.jsx("button",{onClick:()=>e(o),className:`p-1.5 text-lg rounded transition-all ${i===o?"bg-blue-100 scale-110":"hover:bg-gray-100 opacity-60 hover:opacity-100"}`,"aria-pressed":i===o,"aria-label":Bv[o],title:Bv[o],children:F_[o]},o))})}const IW={linear:"linear",bent:"bent","bent-2":"bent","bent-4":"bent","trigonal-planar":"trigonal-planar","trigonal-pyramidal":"trigonal-pyramidal",tetrahedral:"tetrahedral",seesaw:"see-saw","see-saw":"see-saw","t-shaped":"t-shaped","trigonal-bipyramidal":"trigonal-bipyramidal","square-planar":"square-planar","square-pyramidal":"square-pyramidal",octahedral:"octahedral"};function MW(i){var o;const t=i.replace(/₀/g,"0").replace(/₁/g,"1").replace(/₂/g,"2").replace(/₃/g,"3").replace(/₄/g,"4").replace(/₅/g,"5").replace(/₆/g,"6").replace(/₇/g,"7").replace(/₈/g,"8").replace(/₉/g,"9").match(/([A-Z][a-z]?)(\d*)/g)||[],n=[];for(const a of t){const l=a.match(/([A-Z][a-z]?)(\d*)/);if(l){const c=l[1],u=l[2]?parseInt(l[2]):1;c&&n.push({symbol:c,count:u})}}const r=((o=n[0])==null?void 0:o.symbol)||"C",s=n.slice(1);return{central:r,surrounding:s}}function _O(i,e="single"){const t=[],n=[],r=MW(i.formula),s=i.centralAtom||r.central,o=`${s.toLowerCase()}-central`;t.push({id:o,symbol:s,lonePairs:i.lonePairs});let a=0;for(const c of r.surrounding)for(let u=0;u<c.count;u++){const h=`${c.symbol.toLowerCase()}-${a}`;t.push({id:h,symbol:c.symbol,lonePairs:0}),n.push({from:o,to:h,type:e}),a++}const l=IW[i.correctGeometryId];return{id:i.formula.toLowerCase().replace(/[₀₁₂₃₄₅₆₇₈₉]/g,""),formula:i.formula,name:i.name,atoms:t,bonds:n,geometry:l,isPolar:i.isPolar}}function zI(i){const e=MW(i.example),t=e.central,n=e.surrounding,r=[],s=[],o=`${t.toLowerCase()}-central`;r.push({id:o,symbol:t,lonePairs:i.lonePairs});let a=0;for(const c of n)for(let u=0;u<c.count;u++){const h=`${c.symbol.toLowerCase()}-${a}`;r.push({id:h,symbol:c.symbol,lonePairs:0}),s.push({from:o,to:h,type:"single"}),a++}const l=IW[i.id];return{id:i.example.toLowerCase().replace(/[₀₁₂₃₄₅₆₇₈₉]/g,""),formula:i.example,name:i.exampleName,atoms:r,bonds:s,geometry:l}}function RW(i){const e=[...i];for(let t=e.length-1;t>0;t--){const n=Math.floor(Math.random()*(t+1));[e[t],e[n]]=[e[n],e[t]]}return e}const GI={linear:{geometry:"linear",geometryName:"Línuleg",idealAngle:180,actualAngle:180,lonePairs:0,bondingPairs:2,example:"CO₂",explanation:"Tvö rafeinasvið staðsetjast beint á móti hvoru öðru."},"trigonal-planar":{geometry:"trigonal-planar",geometryName:"Þríhyrnd slétt",idealAngle:120,actualAngle:120,lonePairs:0,bondingPairs:3,example:"BF₃",explanation:"Þrjú rafeinasvið dreifast jafnt í sléttu, 120° sundur."},"bent-2":{geometry:"bent-2",geometryName:"Beygð (1 lp)",idealAngle:120,actualAngle:117,lonePairs:1,bondingPairs:2,example:"SO₂",explanation:"Einstætt par þrýstir bindandi pörum saman."},tetrahedral:{geometry:"tetrahedral",geometryName:"Fjórflötungur",idealAngle:109.5,actualAngle:109.5,lonePairs:0,bondingPairs:4,example:"CH₄",explanation:"Fjögur rafeinasvið í fullkominni þrívíðri röðun."},"trigonal-pyramidal":{geometry:"trigonal-pyramidal",geometryName:"Þríhyrnd pýramída",idealAngle:109.5,actualAngle:107,lonePairs:1,bondingPairs:3,example:"NH₃",explanation:"Einstætt par minnkar hornið úr 109.5° í ~107°."},"bent-4":{geometry:"bent-4",geometryName:"Beygð (2 lp)",idealAngle:109.5,actualAngle:104.5,lonePairs:2,bondingPairs:2,example:"H₂O",explanation:"Tvö einstæð pör þrýsta horninu niður í 104.5°."},"trigonal-bipyramidal":{geometry:"trigonal-bipyramidal",geometryName:"Þríhyrnd tvípýramída",idealAngle:90,actualAngle:90,lonePairs:0,bondingPairs:5,example:"PCl₅",explanation:"Ás-horn 90°, miðsléttuhhorn 120°."},octahedral:{geometry:"octahedral",geometryName:"Áttflötungur",idealAngle:90,actualAngle:90,lonePairs:0,bondingPairs:6,example:"SF₆",explanation:"Öll horn 90° í samhverfu formi."}};function v3e({geometryId:i,showComparison:e=!0,compact:t=!1}){const[n,r]=C.useState(i||"tetrahedral"),s=GI[n],o=s.idealAngle-s.actualAngle,a=t?160:220,l=a/2,c=a/2+20,u=t?50:70,h=(A,E)=>{const x=-A/2,w=A/2,T=x*Math.PI/180-Math.PI/2,I=w*Math.PI/180-Math.PI/2,M=l+E*Math.cos(T),L=c+E*Math.sin(T),P=l+E*Math.cos(I),R=c+E*Math.sin(I),U=A>180?1:0;return`M ${l} ${c} L ${M} ${L} A ${E} ${E} 0 ${U} 1 ${P} ${R} Z`},f=(A,E)=>{const x=A/2,w=(-x-90)*Math.PI/180,T=(x-90)*Math.PI/180;return{left:{x:l+E*Math.cos(w),y:c+E*Math.sin(w)},right:{x:l+E*Math.cos(T),y:c+E*Math.sin(T)}}},d=t?55:75,m=f(s.idealAngle,d),y=f(s.actualAngle,d),g=C.useMemo(()=>({"Úr fjórflötungi (109.5°)":["tetrahedral","trigonal-pyramidal","bent-4"],"Úr þríhyrnd sléttri (120°)":["trigonal-planar","bent-2"]}),[]);return t?N.jsx("div",{className:"bg-slate-800 rounded-lg p-3",children:N.jsxs("div",{className:"flex items-center gap-3",children:[N.jsxs("svg",{width:a,height:a,className:"flex-shrink-0",children:[N.jsx("path",{d:h(s.actualAngle,u*.6),fill:"rgba(45, 212, 191, 0.3)",stroke:"#2dd4bf",strokeWidth:"2"}),N.jsx("line",{x1:l,y1:c,x2:y.left.x,y2:y.left.y,stroke:"#60a5fa",strokeWidth:"4",strokeLinecap:"round"}),N.jsx("line",{x1:l,y1:c,x2:y.right.x,y2:y.right.y,stroke:"#60a5fa",strokeWidth:"4",strokeLinecap:"round"}),N.jsx("circle",{cx:l,cy:c,r:"10",fill:"#f472b6"}),N.jsx("circle",{cx:y.left.x,cy:y.left.y,r:"8",fill:"#60a5fa"}),N.jsx("circle",{cx:y.right.x,cy:y.right.y,r:"8",fill:"#60a5fa"}),N.jsxs("text",{x:l,y:c-u*.3,textAnchor:"middle",fill:"#2dd4bf",fontSize:"14",fontWeight:"bold",children:[s.actualAngle,"°"]})]}),N.jsxs("div",{children:[N.jsx("div",{className:"font-bold text-white",children:s.geometryName}),N.jsx("div",{className:"text-sm text-gray-400",children:s.example}),s.lonePairs>0&&N.jsxs("div",{className:"text-xs text-yellow-400 mt-1",children:[s.lonePairs," einstæð pör → -",o,"°"]})]})]})}):N.jsxs("div",{className:"bg-gradient-to-br from-slate-800 to-slate-900 rounded-xl p-5 shadow-lg",children:[N.jsxs("h3",{className:"text-white font-bold text-sm mb-4 flex items-center gap-2",children:[N.jsx("span",{className:"text-lg",children:"📐"}),"Tengjahornamælir (Bond Angle Tool)"]}),N.jsx("div",{className:"flex flex-wrap gap-2 mb-4",children:Object.entries(GI).map(([A,E])=>N.jsx("button",{onClick:()=>r(A),className:`px-3 py-1.5 rounded-lg text-xs font-medium transition-colors ${n===A?"bg-teal-500 text-white":"bg-slate-700 text-gray-300 hover:bg-slate-600"}`,children:E.example},A))}),N.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[N.jsx("div",{className:"flex-1 flex justify-center",children:N.jsxs("svg",{width:a,height:a,children:[N.jsx("circle",{cx:l,cy:c,r:u,fill:"none",stroke:"#374151",strokeWidth:"1",strokeDasharray:"4,4",opacity:"0.5"}),e&&s.idealAngle!==s.actualAngle&&N.jsx("path",{d:h(s.idealAngle,u*.5),fill:"rgba(156, 163, 175, 0.2)",stroke:"#9ca3af",strokeWidth:"1",strokeDasharray:"4,2"}),N.jsx("path",{d:h(s.actualAngle,u*.7),fill:"rgba(45, 212, 191, 0.3)",stroke:"#2dd4bf",strokeWidth:"2"}),[0,30,60,90,120,150,180].map(A=>{const E=(A-90)*Math.PI/180,x=u-5,w=u+5;return N.jsxs("g",{children:[N.jsx("line",{x1:l+x*Math.cos(E),y1:c+x*Math.sin(E),x2:l+w*Math.cos(E),y2:c+w*Math.sin(E),stroke:"#4b5563",strokeWidth:"1"}),A%60===0&&N.jsxs("text",{x:l+(u+15)*Math.cos(E),y:c+(u+15)*Math.sin(E)+4,textAnchor:"middle",fill:"#6b7280",fontSize:"10",children:[A,"°"]})]},A)}),e&&s.idealAngle!==s.actualAngle&&N.jsxs(N.Fragment,{children:[N.jsx("line",{x1:l,y1:c,x2:m.left.x,y2:m.left.y,stroke:"#9ca3af",strokeWidth:"2",strokeDasharray:"4,4",opacity:"0.5"}),N.jsx("line",{x1:l,y1:c,x2:m.right.x,y2:m.right.y,stroke:"#9ca3af",strokeWidth:"2",strokeDasharray:"4,4",opacity:"0.5"})]}),N.jsx("line",{x1:l,y1:c,x2:y.left.x,y2:y.left.y,stroke:"#60a5fa",strokeWidth:"5",strokeLinecap:"round"}),N.jsx("line",{x1:l,y1:c,x2:y.right.x,y2:y.right.y,stroke:"#60a5fa",strokeWidth:"5",strokeLinecap:"round"}),N.jsx("circle",{cx:l,cy:c,r:"14",fill:"#f472b6",stroke:"#fff",strokeWidth:"2"}),N.jsx("circle",{cx:y.left.x,cy:y.left.y,r:"10",fill:"#60a5fa",stroke:"#fff",strokeWidth:"2"}),N.jsx("circle",{cx:y.right.x,cy:y.right.y,r:"10",fill:"#60a5fa",stroke:"#fff",strokeWidth:"2"}),s.lonePairs>0&&N.jsx("g",{children:Array.from({length:Math.min(s.lonePairs,2)}).map((A,E)=>{const x=90+(E===0?-25:25),w=x*Math.PI/180,T=35;return N.jsx("g",{children:N.jsx("ellipse",{cx:l+T*Math.cos(w),cy:c-T*Math.sin(w),rx:"8",ry:"12",fill:"rgba(250, 204, 21, 0.5)",stroke:"#facc15",strokeWidth:"2",transform:`rotate(${90-x}, ${l+T*Math.cos(w)}, ${c-T*Math.sin(w)})`})},E)})}),N.jsxs("text",{x:l,y:c-u*.4,textAnchor:"middle",fill:"#2dd4bf",fontSize:"18",fontWeight:"bold",children:[s.actualAngle,"°"]}),e&&o>0&&N.jsxs("text",{x:l,y:c-u*.4-20,textAnchor:"middle",fill:"#9ca3af",fontSize:"12",children:["(kjörhorn: ",s.idealAngle,"°)"]})]})}),N.jsxs("div",{className:"flex-1 space-y-3",children:[N.jsxs("div",{className:"bg-slate-700/50 rounded-lg p-3",children:[N.jsx("div",{className:"text-xs text-gray-400 mb-1",children:"Lögun"}),N.jsx("div",{className:"font-bold text-white text-lg",children:s.geometryName}),N.jsx("div",{className:"text-sm text-teal-400",children:s.example})]}),N.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[N.jsxs("div",{className:"bg-slate-700/50 rounded-lg p-3 text-center",children:[N.jsx("div",{className:"text-xs text-gray-400",children:"Bindandi pör"}),N.jsx("div",{className:"text-xl font-bold text-blue-400",children:s.bondingPairs})]}),N.jsxs("div",{className:"bg-slate-700/50 rounded-lg p-3 text-center",children:[N.jsx("div",{className:"text-xs text-gray-400",children:"Einstæð pör"}),N.jsx("div",{className:"text-xl font-bold text-yellow-400",children:s.lonePairs})]})]}),N.jsxs("div",{className:"bg-slate-700/50 rounded-lg p-3",children:[N.jsx("div",{className:"text-xs text-gray-400 mb-2",children:"Horngreining"}),N.jsxs("div",{className:"space-y-1 text-sm",children:[N.jsxs("div",{className:"flex justify-between",children:[N.jsx("span",{className:"text-gray-400",children:"Kjörhorn:"}),N.jsxs("span",{className:"text-gray-300",children:[s.idealAngle,"°"]})]}),o>0&&N.jsxs("div",{className:"flex justify-between",children:[N.jsx("span",{className:"text-yellow-400",children:"Áhrif einstæðra para:"}),N.jsxs("span",{className:"text-yellow-300",children:["-",o,"°"]})]}),N.jsxs("div",{className:"flex justify-between border-t border-slate-600 pt-1 mt-1",children:[N.jsx("span",{className:"text-teal-400 font-bold",children:"Raunhorn:"}),N.jsxs("span",{className:"text-teal-300 font-bold",children:[s.actualAngle,"°"]})]})]})]}),N.jsxs("div",{className:"bg-yellow-500/10 border border-yellow-500/30 rounded-lg p-3",children:[N.jsx("div",{className:"text-xs text-yellow-400 font-semibold mb-1",children:"💡 Útskýring"}),N.jsx("div",{className:"text-sm text-yellow-200",children:s.explanation})]})]})]}),e&&N.jsxs("div",{className:"mt-4 pt-4 border-t border-slate-700",children:[N.jsx("div",{className:"text-xs text-gray-400 mb-3",children:"Samanburður: Áhrif einstæðra para"}),N.jsx("div",{className:"space-y-3",children:Object.entries(g).map(([A,E])=>N.jsxs("div",{children:[N.jsx("div",{className:"text-xs text-gray-500 mb-1",children:A}),N.jsx("div",{className:"flex gap-2 flex-wrap",children:E.map(x=>{const w=GI[x],T=w.idealAngle-w.actualAngle;return N.jsxs("button",{onClick:()=>r(x),className:`flex items-center gap-2 px-3 py-2 rounded-lg text-xs transition-colors ${n===x?"bg-teal-500/30 border border-teal-500":"bg-slate-700/50 hover:bg-slate-600/50"}`,children:[N.jsx("span",{className:"text-white font-medium",children:w.example}),N.jsxs("span",{className:"text-teal-400",children:[w.actualAngle,"°"]}),T>0&&N.jsxs("span",{className:"text-yellow-400 text-xs",children:["(",w.lonePairs," lp)"]})]},x)})})]},A))})]}),N.jsxs("div",{className:"mt-4 flex flex-wrap gap-4 text-xs",children:[N.jsxs("div",{className:"flex items-center gap-1",children:[N.jsx("div",{className:"w-4 h-1 bg-blue-400 rounded"}),N.jsx("span",{className:"text-gray-400",children:"Efnatengi"})]}),N.jsxs("div",{className:"flex items-center gap-1",children:[N.jsx("div",{className:"w-4 h-4 rounded-full bg-yellow-400/50 border border-yellow-400"}),N.jsx("span",{className:"text-gray-400",children:"Einstætt par"})]}),N.jsxs("div",{className:"flex items-center gap-1",children:[N.jsx("div",{className:"w-4 h-4 rounded-sm bg-teal-400/30 border border-teal-400"}),N.jsx("span",{className:"text-gray-400",children:"Tengihorn"})]})]})]})}const x3e={geometry:"Rafeindaröðun (electron geometry) vs sameindaröðun (molecular geometry) - einstæð pör sjást ekki í sameindaröðun."},E3e=["VSEPR kenningin","Rafeinasvið","Sameindaröðun","Tengjahorn"],SO=[{id:"linear",name:"Línuleg",nameEn:"Linear",electronDomains:2,bondingPairs:2,lonePairs:0,electronGeometry:"Línuleg",molecularGeometry:"Línuleg",bondAngle:"180°",example:"CO₂",exampleName:"Koltvísýringur",description:"Tvö rafeinasvið staðsetjast á sitthvora hlið miðatómsins.",visual:"○—●—○"},{id:"trigonal-planar",name:"Þríhyrnd slétt",nameEn:"Trigonal Planar",electronDomains:3,bondingPairs:3,lonePairs:0,electronGeometry:"Þríhyrnd slétt",molecularGeometry:"Þríhyrnd slétt",bondAngle:"120°",example:"BF₃",exampleName:"Bórþríflúoríð",description:"Þrjú rafeinasvið dreifist jafnt í sléttu þríhyrningsformi.",visual:`○╲
  ●
○╱ ╲○`},{id:"bent-2",name:"Beygð (2 bp)",nameEn:"Bent",electronDomains:3,bondingPairs:2,lonePairs:1,electronGeometry:"Þríhyrnd slétt",molecularGeometry:"Beygð",bondAngle:"<120°",example:"SO₂",exampleName:"Brennisteinstvísýringur",description:"Einstætt par ýtir bindandi pörum saman — lægra horn.",visual:`○╲  ::
  ●
○╱`},{id:"tetrahedral",name:"Fjórflötungur",nameEn:"Tetrahedral",electronDomains:4,bondingPairs:4,lonePairs:0,electronGeometry:"Fjórflötungur",molecularGeometry:"Fjórflötungur",bondAngle:"109.5°",example:"CH₄",exampleName:"Metan",description:"Fjögur rafeinasvið í þrívíð fjórflötungsröðun.",visual:`    ○
    |
○—●—○
    |
    ○`},{id:"trigonal-pyramidal",name:"Þríhyrnd pýramída",nameEn:"Trigonal Pyramidal",electronDomains:4,bondingPairs:3,lonePairs:1,electronGeometry:"Fjórflötungur",molecularGeometry:"Þríhyrnd pýramída",bondAngle:"107°",example:"NH₃",exampleName:"Ammóníak",description:"Einstætt par ofan á þremur bindandi — pýramídalögun.",visual:`    ::
    |
○—●—○
    |
    ○`},{id:"bent-4",name:"Beygð (2 lp)",nameEn:"Bent",electronDomains:4,bondingPairs:2,lonePairs:2,electronGeometry:"Fjórflötungur",molecularGeometry:"Beygð",bondAngle:"104.5°",example:"H₂O",exampleName:"Vatn",description:"Tvö einstæð pör þrýsta bindandi pörum saman.",visual:`  ::  ::
    \\ /
○—●—○`},{id:"trigonal-bipyramidal",name:"Þríhyrnd tvípýramída",nameEn:"Trigonal Bipyramidal",electronDomains:5,bondingPairs:5,lonePairs:0,electronGeometry:"Þríhyrnd tvípýramída",molecularGeometry:"Þríhyrnd tvípýramída",bondAngle:"90° og 120°",example:"PCl₅",exampleName:"Fosfórpentaklóríð",description:"Fimm rafeinasvið — þrjú í miðsléttunni (120°), tvö lóðrétt (90°).",visual:`    ○
    |
○-●-○
   /|\\
  ○ ○`},{id:"octahedral",name:"Áttflötungur",nameEn:"Octahedral",electronDomains:6,bondingPairs:6,lonePairs:0,electronGeometry:"Áttflötungur",molecularGeometry:"Áttflötungur",bondAngle:"90°",example:"SF₆",exampleName:"Brennisteinshexaflúoríð",description:"Sex rafeinasvið í samhverfri áttflötungsröðun.",visual:`    ○
    |
○-●-○
   /|
  ○ ○
    |
    ○`}],A1=[{id:1,type:"identify",question:"Hvaða lögun hefur CO₂ (koltvísýringur)?",geometryId:"linear",options:[{id:"a",text:"Línuleg (Linear)",correct:!0,explanation:"CO₂ hefur 2 rafeinasvið sem staðsetjast 180° í sundur."},{id:"b",text:"Beygð (Bent)",correct:!1,explanation:"Beygð lögun krefst einstæðra para á miðatómi."},{id:"c",text:"Þríhyrnd slétt",correct:!1,explanation:"Þríhyrnd slétt hefur 3 rafeinasvið, ekki 2."},{id:"d",text:"Fjórflötungur",correct:!1,explanation:"Fjórflötungur hefur 4 rafeinasvið."}],hints:{topic:"Þetta snýst um VSEPR lögun miðað við fjölda rafeinasviða.",strategy:"Teldu rafeinasvið á miðatóminu (C). Tvöföldar tengingar telja sem eitt svið.",method:"CO₂ hefur tvöföld tenging við hvort súrefnisatóm = 2 rafeinasvið.",solution:"2 rafeinasvið staðsetjast 180° í sundur = línuleg lögun."}},{id:2,type:"electron_domains",question:"Hversu mörg rafeinasvið (electron domains) hefur vatn (H₂O)?",geometryId:"bent-4",options:[{id:"a",text:"2 rafeinasvið",correct:!1,explanation:"Þú telur aðeins bindandi pörin."},{id:"b",text:"3 rafeinasvið",correct:!1,explanation:"Þú vantar eitt einstætt par."},{id:"c",text:"4 rafeinasvið",correct:!0,explanation:"Rétt! 2 bindandi pör + 2 einstæð pör = 4 rafeinasvið."},{id:"d",text:"6 rafeinasvið",correct:!1,explanation:"Það eru aðeins 4 rafeinapör í ystu skel súrefnis."}],hints:{topic:"Mundu að telja bæði bindandi og einstæð pör.",strategy:"Rafeinasvið = bindandi pör + einstæð pör á miðatóminu.",method:"Súrefni hefur 6 gildisrafeindir. 2 fara í O-H tengingar, 4 mynda 2 einstæð pör.",solution:"2 bindandi pör + 2 einstæð pör = 4 rafeinasvið."}},{id:3,type:"molecular_vs_electron",question:"NH₃ (ammóníak) hefur fjórflötungs RAFEINALÖGUN en hvaða SAMEINDARLÖGUN?",geometryId:"trigonal-pyramidal",options:[{id:"a",text:"Fjórflötungur",correct:!1,explanation:"Sameindarlögun tekur ekki tillit til einstæðu paranna."},{id:"b",text:"Þríhyrnd pýramída",correct:!0,explanation:"Rétt! Einstætt par á toppnum er ekki sýnilegt í sameindarlögun."},{id:"c",text:"Þríhyrnd slétt",correct:!1,explanation:"Þríhyrnd slétt er 2D, NH₃ er 3D pýramída."},{id:"d",text:"Línuleg",correct:!1,explanation:"Línuleg hefur aðeins 2 rafeinasvið."}],hints:{topic:"Munurinn á rafeinalögun og sameindarlögun.",strategy:"Sameindarlögun lýsir aðeins stöðu atóma, ekki einstæðra para.",method:"NH₃: 4 rafeinasvið (3 bp + 1 lp). Sameindarlögun sýnir aðeins 3 bindandi pörin.",solution:"Þríhyrnd pýramída - 3 H atóm í botninum, N á toppnum, einstætt par ósýnilegt."}},{id:4,type:"angle",question:"Hvert er tengihorn í fjórflötungssameindum (eins og CH₄)?",geometryId:"tetrahedral",options:[{id:"a",text:"90°",correct:!1,explanation:"90° er fyrir áttflötung (octahedral)."},{id:"b",text:"109.5°",correct:!0,explanation:"Rétt! Þetta er hornið sem hámarkar fjarlægð milli 4 rafeinasviða."},{id:"c",text:"120°",correct:!1,explanation:"120° er fyrir þríhyrnd slétta lögun."},{id:"d",text:"180°",correct:!1,explanation:"180° er fyrir línulega lögun."}],hints:{topic:"Tengihorn ákvarðast af fjölda rafeinasviða.",strategy:"Hornið hámarkar fjarlægð milli rafeinasviða í þrívíðri röðun.",method:"4 rafeinasvið í þrívídd = fjórflötungur. Hornið er milli 90° og 120°.",solution:"109.5° - þetta er nákvæmt fjórflötungshorn."}},{id:5,type:"lone_pair_effect",question:"Af hverju er tengihorn í H₂O (104.5°) minna en í CH₄ (109.5°)?",options:[{id:"a",text:"Súrefni er minna atóm",correct:!1,explanation:"Stærð atóms hefur lítil áhrif á hornið."},{id:"b",text:"Einstæð pör hrinda meira en bindandi pör",correct:!0,explanation:"Rétt! Einstæð pör taka meira pláss og ýta bindandi pörum saman."},{id:"c",text:"Vatn er fljótandi",correct:!1,explanation:"Eðlisástand hefur ekki áhrif á lögun."},{id:"d",text:"Vetni er léttara en kolefni",correct:!1,explanation:"Massinn hefur ekki áhrif á tengihorn."}],hints:{topic:"Áhrif einstæðra para á tengihorn.",strategy:'Hugsaðu um það sem „tekur meira pláss" í kringum miðatómið.',method:"Einstæð pör eru nær kjarna og dreifa sér meira en bindandi pör.",solution:"Einstæð pör hrinda meira og ýta bindandi pörum saman = minna horn."}},{id:6,type:"identify",question:"Hvaða lögun hefur BF₃ (bórþríflúoríð)?",geometryId:"trigonal-planar",options:[{id:"a",text:"Þríhyrnd pýramída",correct:!1,explanation:"Pýramída hefur einstætt par á miðatóminu."},{id:"b",text:"Þríhyrnd slétt",correct:!0,explanation:"Rétt! 3 bindandi pör, engin einstæð pör — slétt 120° lögun."},{id:"c",text:"Beygð",correct:!1,explanation:"Beygð lögun hefur einstæð pör."},{id:"d",text:"Fjórflötungur",correct:!1,explanation:"Fjórflötungur hefur 4 rafeinasvið, ekki 3."}],hints:{topic:"VSEPR lögun með 3 rafeinasvið.",strategy:"Athugaðu hvort miðatómið hefur einstæð pör.",method:"Bór hefur aðeins 3 gildisrafeindir og myndar ekki einstæð pör.",solution:"3 bindandi pör, 0 einstæð = þríhyrnd slétt lögun (120°)."}},{id:7,type:"molecular_vs_electron",question:"SF₆ hefur 6 rafeinasvið. Hvað heitir þessi lögun?",geometryId:"octahedral",options:[{id:"a",text:"Sexflötungur",correct:!1,explanation:"Sexflötungur er ekki algengur í VSEPR."},{id:"b",text:"Áttflötungur (Octahedral)",correct:!0,explanation:"Rétt! 6 rafeinasvið í 90° sundur — áttflötungur."},{id:"c",text:"Þríhyrnd tvípýramída",correct:!1,explanation:"Þríhyrnd tvípýramída hefur 5 rafeinasvið."},{id:"d",text:"Kúla",correct:!1,explanation:"Kúla er ekki VSEPR lögun."}],hints:{topic:"VSEPR lögun með 6 rafeinasvið.",strategy:"Nafnið kemur frá fjölda flata á fasta efninu sem lýsir þessari röðun.",method:"6 rafeinasvið í samhverfri röðun, öll 90° frá hvoru öðru.",solution:"Áttflötungur (octahedral) - fasti efnið hefur 8 fleti."}},{id:8,type:"electron_domains",question:"PCl₅ hefur 5 rafeinasvið. Hvað heitir þessi rafeinalögun?",geometryId:"trigonal-bipyramidal",options:[{id:"a",text:"Fimmflötungur",correct:!1,explanation:"Þetta er ekki staðlað VSEPR nafn."},{id:"b",text:"Áttflötungur",correct:!1,explanation:"Áttflötungur hefur 6 rafeinasvið."},{id:"c",text:"Þríhyrnd tvípýramída",correct:!0,explanation:"Rétt! 3 á miðsléttu (120°) + 2 lóðrétt (90°)."},{id:"d",text:"Fjórflötungur",correct:!1,explanation:"Fjórflötungur hefur 4 rafeinasvið."}],hints:{topic:"VSEPR lögun með 5 rafeinasvið.",strategy:"Hugsaðu um tvær mismunandi stöður - miðslétta og ás.",method:"3 stöður á miðsléttu (120°) + 2 stöður lóðrétt á ásnum (90°).",solution:"Þríhyrnd tvípýramída - trigonal bipyramidal."}}];function _3e({onComplete:i,onBack:e,onCorrectAnswer:t,onIncorrectAnswer:n}){const[r,s]=C.useState("explore"),[o,a]=C.useState(null),[l,c]=C.useState("2d"),[u,h]=C.useState(0),[f,d]=C.useState(null),[m,y]=C.useState(!1),[g,A]=C.useState(!1),[E,x]=C.useState(1),[w,T]=C.useState(0),[I,M]=C.useState(!1),[L,P]=C.useState(0),[R,U]=C.useState(0),k=A1[u],H=A1.length*15,G=C.useMemo(()=>RW(k.options).map((V,W)=>({...V,id:String.fromCharCode(97+W)})),[u,k.options]),X=15,Z=()=>{const K=G.find(W=>W.id===f),V=(K==null?void 0:K.correct)??!1;if(M(V),V){t==null||t();const W=Math.round(X*E);P(F=>F+W)}else n==null||n();y(!0)},oe=()=>{w>0&&U(K=>K+w),u<A1.length-1?(h(K=>K+1),d(null),y(!1),A(!1),x(1),T(0),M(!1)):i(L,H,R+w)};return r==="explore"?N.jsx("div",{className:"min-h-screen bg-gradient-to-br from-teal-50 to-cyan-100 p-4 md:p-8",children:N.jsxs("div",{className:"max-w-5xl mx-auto",children:[N.jsxs("div",{className:"flex items-center justify-between mb-6",children:[N.jsxs("button",{onClick:e,className:"text-gray-600 hover:text-gray-800 flex items-center gap-2",children:[N.jsx("span",{children:"←"})," Til baka"]}),N.jsx("div",{className:"text-sm text-gray-600",children:"Stig 1: Könnun"})]}),N.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl p-6 md:p-8 mb-6",children:[N.jsx("h2",{className:"text-2xl font-bold text-teal-800 mb-4",children:"Kannaðu mismunandi sameindarlögun"}),N.jsx("p",{className:"text-gray-600 mb-6",children:"Smelltu á lögun til að sjá dæmi og útskýringu. Þegar þú ert tilbúinn, haltu áfram í spurningar."}),N.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-8",children:SO.map(K=>N.jsxs("button",{onClick:()=>a(K),className:`p-4 rounded-xl border-2 transition-all text-center ${(o==null?void 0:o.id)===K.id?"border-teal-500 bg-teal-50 shadow-lg":"border-gray-200 hover:border-teal-300 hover:bg-teal-50/50"}`,children:[N.jsx("div",{className:"text-lg font-bold text-gray-800",children:K.name}),N.jsx("div",{className:"text-xs text-gray-500",children:K.nameEn}),N.jsx("div",{className:"text-sm text-teal-600 mt-1",children:K.example})]},K.id))}),o&&N.jsxs("div",{className:"bg-teal-50 rounded-xl p-6 animate-slide-in",children:[N.jsxs("div",{className:"flex flex-col md:flex-row gap-6",children:[N.jsxs("div",{className:"flex-1",children:[N.jsxs("div",{className:"flex justify-center gap-2 mb-3",children:[N.jsx("button",{onClick:()=>c("2d"),className:`px-4 py-1.5 rounded-lg text-sm font-medium transition-colors ${l==="2d"?"bg-teal-600 text-white":"bg-gray-200 text-gray-600 hover:bg-gray-300"}`,children:"2D"}),N.jsx("button",{onClick:()=>c("3d"),className:`px-4 py-1.5 rounded-lg text-sm font-medium transition-colors ${l==="3d"?"bg-teal-600 text-white":"bg-gray-200 text-gray-600 hover:bg-gray-300"}`,children:"3D"})]}),N.jsx("div",{className:"bg-gray-900 rounded-xl p-6 flex items-center justify-center min-h-48",children:N.jsxs("div",{className:"text-center w-full",children:[l==="2d"?N.jsx(tM,{molecule:zI({id:o.id,example:o.example,exampleName:o.exampleName,bondingPairs:o.bondingPairs,lonePairs:o.lonePairs}),mode:"vsepr",size:"lg",animation:"scale-in",showLonePairs:!0,ariaLabel:`${o.name} lögun: ${o.example}`}):N.jsx(HN,{molecule:zI({id:o.id,example:o.example,exampleName:o.exampleName,bondingPairs:o.bondingPairs,lonePairs:o.lonePairs}),style:"ball-stick",showLabels:!0,autoRotate:!0,autoRotateSpeed:1.5,height:200,backgroundColor:"transparent"}),N.jsx("div",{className:"text-2xl font-bold text-teal-400 mt-4",children:o.example}),N.jsx("div",{className:"text-gray-400",children:o.exampleName}),l==="3d"&&N.jsx("div",{className:"text-xs text-gray-500 mt-2",children:"Dragðu til að snúa, skrollaðu til að stækka"})]})})]}),N.jsxs("div",{className:"flex-1 space-y-4",children:[N.jsx("h3",{className:"text-xl font-bold text-teal-800",children:o.name}),N.jsx("p",{className:"text-gray-700",children:o.description}),N.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[N.jsxs("div",{className:"bg-white p-3 rounded-lg",children:[N.jsx("div",{className:"text-gray-500",children:"Rafeinasvið"}),N.jsx("div",{className:"font-bold text-gray-800",children:o.electronDomains})]}),N.jsxs("div",{className:"bg-white p-3 rounded-lg",children:[N.jsx("div",{className:"text-gray-500",children:"Bindandi pör"}),N.jsx("div",{className:"font-bold text-blue-600",children:o.bondingPairs})]}),N.jsxs("div",{className:"bg-white p-3 rounded-lg",children:[N.jsx("div",{className:"text-gray-500",children:"Einstæð pör"}),N.jsx("div",{className:"font-bold text-yellow-600",children:o.lonePairs})]}),N.jsxs("div",{className:"bg-white p-3 rounded-lg",children:[N.jsx("div",{className:"text-gray-500",children:"Tengihorn"}),N.jsx("div",{className:"font-bold text-teal-600",children:o.bondAngle})]})]}),N.jsxs("div",{className:"bg-white p-3 rounded-lg",children:[N.jsx("div",{className:"text-gray-500 text-sm",children:"Rafeinalögun"}),N.jsx("div",{className:"font-bold text-purple-600",children:o.electronGeometry})]}),N.jsxs("div",{className:"bg-white p-3 rounded-lg",children:[N.jsx("div",{className:"text-gray-500 text-sm",children:"Sameindarlögun"}),N.jsx("div",{className:"font-bold text-teal-600",children:o.molecularGeometry})]})]})]}),N.jsx("div",{className:"mt-6",children:N.jsx(v3e,{geometryId:o.id,showComparison:!1})})]})]}),N.jsx("button",{onClick:()=>s("quiz"),className:"w-full bg-teal-500 hover:bg-teal-600 text-white font-bold py-4 px-6 rounded-xl transition-colors",children:"Hefja spurningar →"})]})}):N.jsx("div",{className:"min-h-screen bg-gradient-to-br from-teal-50 to-cyan-100 p-4 md:p-8",children:N.jsxs("div",{className:"max-w-3xl mx-auto",children:[N.jsxs("div",{className:"flex items-center justify-between mb-6",children:[N.jsxs("button",{onClick:()=>s("explore"),className:"text-gray-600 hover:text-gray-800 flex items-center gap-2",children:[N.jsx("span",{children:"←"})," Til baka"]}),N.jsxs("div",{className:"text-right",children:[N.jsxs("div",{className:"text-sm text-gray-600",children:["Spurning ",u+1," af ",A1.length]}),N.jsxs("div",{className:"text-lg font-bold text-teal-600",children:[L," stig"]})]})]}),N.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 mb-6",children:N.jsx("div",{className:"bg-teal-500 h-2 rounded-full transition-all duration-300",style:{width:`${(u+1)/A1.length*100}%`}})}),N.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl p-6 md:p-8",children:[N.jsx("p",{className:"text-gray-700 text-lg mb-6",children:k.question}),k.geometryId&&(()=>{const K=SO.find(V=>V.id===k.geometryId);return K?N.jsxs("div",{className:"bg-slate-900 p-4 rounded-xl mb-6 flex flex-col items-center",children:[N.jsx(tM,{molecule:zI({id:K.id,example:K.example,exampleName:K.exampleName,bondingPairs:K.bondingPairs,lonePairs:K.lonePairs}),mode:"vsepr",size:"md",animation:"fade-in",showLonePairs:!0,ariaLabel:`${K.name} lögun`}),N.jsx("div",{className:"text-slate-300 text-sm mt-2 font-medium",children:K.example})]}):null})(),N.jsx("div",{className:"space-y-3 mb-6",children:G.map(K=>N.jsxs("button",{onClick:()=>!m&&d(K.id),disabled:m,className:`w-full p-4 rounded-xl border-2 text-left transition-all ${m?K.correct?"border-green-500 bg-green-50":f===K.id?"border-red-500 bg-red-50":"border-gray-200 bg-gray-50 opacity-50":f===K.id?"border-teal-500 bg-teal-50 ring-2 ring-teal-200":"border-gray-300 hover:border-teal-400 hover:bg-teal-50"}`,children:[N.jsxs("div",{className:"flex items-start gap-3",children:[N.jsxs("span",{className:"font-bold text-gray-500 uppercase",children:[K.id,"."]}),N.jsx("span",{className:"flex-1",children:K.text})]}),m&&f===K.id&&N.jsx("div",{className:`mt-2 text-sm ${K.correct?"text-green-700":"text-red-700"}`,children:K.explanation})]},K.id))}),!m&&!g&&N.jsx("button",{onClick:()=>{A(!0),U(K=>K+1)},className:"text-teal-600 hover:text-teal-800 text-sm underline mb-4",children:"Syna visbendingu (-7 stig)"}),g&&!m&&N.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 p-4 rounded-xl mb-4",children:[N.jsx("span",{className:"font-bold text-yellow-800",children:"Vísbending: "}),N.jsx("span",{className:"text-yellow-900",children:k.hints.topic})]}),!m&&N.jsx("button",{onClick:Z,disabled:!f,className:"w-full bg-teal-500 hover:bg-teal-600 disabled:bg-gray-300 text-white font-bold py-4 px-6 rounded-xl transition-colors",children:"Athuga svar"}),m&&(()=>{const K=G.find(V=>V.correct);return N.jsxs(N.Fragment,{children:[N.jsx("div",{className:"mb-4",children:N.jsx(V$,{feedback:{isCorrect:I,explanation:I?`Rétt! ${(K==null?void 0:K.explanation)||""}`:`${(K==null?void 0:K.explanation)||""}`,misconception:I?void 0:x3e.geometry,relatedConcepts:E3e,nextSteps:I?"Frábært! Þú skilur VSEPR vel. Haltu áfram.":"Mundu: Teldu rafeinasvið fyrst, síðan athugaðu einstæð pör."},config:{showExplanation:!0,showMisconceptions:!I,showRelatedConcepts:!0,showNextSteps:!0}})}),N.jsx("button",{onClick:oe,className:"w-full bg-teal-500 hover:bg-teal-600 text-white font-bold py-4 px-6 rounded-xl transition-colors",children:u<A1.length-1?"Næsta spurning":"Ljúka stigi 1"})]})})()]})]})})}const S3e=[{id:"linear",name:"Línuleg",bondAngle:"180°"},{id:"bent",name:"Beygð",bondAngle:"<120° eða <109.5°"},{id:"trigonal-planar",name:"Þríhyrnd slétt",bondAngle:"120°"},{id:"trigonal-pyramidal",name:"Þríhyrnd pýramída",bondAngle:"107°"},{id:"tetrahedral",name:"Fjórflötungur",bondAngle:"109.5°"},{id:"seesaw",name:"Sjáldruslögun",bondAngle:"90° og 120°"},{id:"t-shaped",name:"T-lögun",bondAngle:"90°"},{id:"trigonal-bipyramidal",name:"Þríhyrnd tvípýramída",bondAngle:"90° og 120°"},{id:"square-planar",name:"Ferningsslétt",bondAngle:"90°"},{id:"octahedral",name:"Áttflötungur",bondAngle:"90°"}],y1=[{id:1,formula:"H₂O",name:"Vatn",lewisStructure:`  ::  ::
   \\ /
H — O — H`,centralAtom:"O",bondingPairs:2,lonePairs:2,electronDomains:4,electronGeometry:"Fjórflötungur",molecularGeometry:"Beygð",correctGeometryId:"bent",bondAngle:"104.5°",isPolar:!0,explanation:"Súrefni hefur 6 gildisrafeindir. 2 fara í tengsl við H, 4 mynda 2 einstæð pör. 4 rafeinasvið = fjórflötungs rafeinalögun, en 2 einstæð pör gera sameindarlögunina beygða."},{id:2,formula:"NH₃",name:"Ammóníak",lewisStructure:`    ::
    |
H — N — H
    |
    H`,centralAtom:"N",bondingPairs:3,lonePairs:1,electronDomains:4,electronGeometry:"Fjórflötungur",molecularGeometry:"Þríhyrnd pýramída",correctGeometryId:"trigonal-pyramidal",bondAngle:"107°",isPolar:!0,explanation:"Nitur hefur 5 gildisrafeindir. 3 fara í tengsl við H, 2 mynda einstætt par. 4 rafeinasvið gefa fjórflötungs rafeinalögun, en 1 einstætt par gerir sameindarlögunina þríhyrnda pýramídu."},{id:3,formula:"CH₄",name:"Metan",lewisStructure:`    H
    |
H — C — H
    |
    H`,centralAtom:"C",bondingPairs:4,lonePairs:0,electronDomains:4,electronGeometry:"Fjórflötungur",molecularGeometry:"Fjórflötungur",correctGeometryId:"tetrahedral",bondAngle:"109.5°",isPolar:!1,explanation:"Kolefni hefur 4 gildisrafeindir sem allar fara í tengsl við H. 4 rafeinasvið, engin einstæð pör — fullkomin fjórflötungs lögun."},{id:4,formula:"CO₂",name:"Koltvísýringur",lewisStructure:"O = C = O",centralAtom:"C",bondingPairs:2,lonePairs:0,electronDomains:2,electronGeometry:"Línuleg",molecularGeometry:"Línuleg",correctGeometryId:"linear",bondAngle:"180°",isPolar:!1,explanation:"Tvöfaldar tengingar telja sem eitt rafeinasvið hvor. 2 rafeinasvið = línuleg lögun með 180° horn."},{id:5,formula:"BF₃",name:"Bórþríflúoríð",lewisStructure:`    F
    |
 F — B — F`,centralAtom:"B",bondingPairs:3,lonePairs:0,electronDomains:3,electronGeometry:"Þríhyrnd slétt",molecularGeometry:"Þríhyrnd slétt",correctGeometryId:"trigonal-planar",bondAngle:"120°",isPolar:!1,explanation:"Bór hefur aðeins 3 gildisrafeindir og myndar 3 tengsl án einstæðra para. 3 rafeinasvið = þríhyrnd slétt lögun."},{id:6,formula:"PCl₅",name:"Fosfórpentaklóríð",lewisStructure:`    Cl
    |
Cl-P-Cl
   /|\\
 Cl Cl`,centralAtom:"P",bondingPairs:5,lonePairs:0,electronDomains:5,electronGeometry:"Þríhyrnd tvípýramída",molecularGeometry:"Þríhyrnd tvípýramída",correctGeometryId:"trigonal-bipyramidal",bondAngle:"90° og 120°",isPolar:!1,explanation:"Fosfór getur rúmað 5 tengsl vegna d-skelja. 5 rafeinasvið = þríhyrnd tvípýramída með 3 á miðsléttunni (120°) og 2 á ásnum (90°)."},{id:7,formula:"SF₄",name:"Brennisteinstetraflúoríð",lewisStructure:`  :: F
   \\|
F-S-F
   /
  F`,centralAtom:"S",bondingPairs:4,lonePairs:1,electronDomains:5,electronGeometry:"Þríhyrnd tvípýramída",molecularGeometry:"Sjáldruslögun",correctGeometryId:"seesaw",bondAngle:"90° og 120°",isPolar:!0,explanation:"Brennisteinn hefur 6 gildisrafeindir. 4 í tengsl, 2 mynda einstætt par. 5 rafeinasvið = þríhyrnd tvípýramída en einstæða parið veldur sjáldruslögun."},{id:8,formula:"SF₆",name:"Brennisteinshexaflúoríð",lewisStructure:`    F
    |
F-S-F
   /|\\
 F F F`,centralAtom:"S",bondingPairs:6,lonePairs:0,electronDomains:6,electronGeometry:"Áttflötungur",molecularGeometry:"Áttflötungur",correctGeometryId:"octahedral",bondAngle:"90°",isPolar:!1,explanation:"Brennisteinn getur rúmað 6 tengsl vegna d-skelja. 6 rafeinasvið í samhverfri áttflötungsröðun með öll horn 90°."},{id:9,formula:"XeF₄",name:"Xenontetraflúoríð",lewisStructure:`::  F  ::
    |   
F - Xe - F
    |   
    F`,centralAtom:"Xe",bondingPairs:4,lonePairs:2,electronDomains:6,electronGeometry:"Áttflötungur",molecularGeometry:"Ferningsslétt",correctGeometryId:"square-planar",bondAngle:"90°",isPolar:!1,explanation:"Xenon hefur 8 gildisrafeindir. 4 í tengsl, 4 mynda 2 einstæð pör. 6 rafeinasvið = áttflötungs rafeinalögun, en 2 einstæð pör (í andstæðum stöðum) gefa ferningssléttu lögun."},{id:10,formula:"ClF₃",name:"Klórþríflúoríð",lewisStructure:`    F
    |
::Cl::
   / \\
  F   F`,centralAtom:"Cl",bondingPairs:3,lonePairs:2,electronDomains:5,electronGeometry:"Þríhyrnd tvípýramída",molecularGeometry:"T-lögun",correctGeometryId:"t-shaped",bondAngle:"90°",isPolar:!0,explanation:"Klór hefur 7 gildisrafeindir. 3 í tengsl, 4 mynda 2 einstæð pör. 5 rafeinasvið = þríhyrnd tvípýramída en 2 einstæð pör á miðsléttunni gefa T-lögun."}],_m=[{id:"count",label:"Telja rafeinasvið"},{id:"geometry",label:"Velja lögun"},{id:"angle",label:"Tengihorn"},{id:"explanation",label:"Útskýra"}];function w3e({onComplete:i,onBack:e,onCorrectAnswer:t,onIncorrectAnswer:n}){const[r,s]=C.useState(0),[o,a]=C.useState(0),[l,c]=C.useState(0),[u,h]=C.useState(!1),[f,d]=C.useState(0),[m,y]=C.useState("2d"),[g,A]=C.useState(""),[E,x]=C.useState(""),[w,T]=C.useState(null),[I,M]=C.useState(""),[L,P]=C.useState(""),[R,U]=C.useState(null),k=y1[r],H=_m[o],G=y1.length*_m.length*10,X=C.useMemo(()=>RW(S3e),[r]),Z=()=>{let W=!1;if(H.id==="count")W=parseInt(g)===k.bondingPairs&&parseInt(E)===k.lonePairs;else if(H.id==="geometry")W=w===k.correctGeometryId;else if(H.id==="angle"){const F=I.replace(/\s/g,"").toLowerCase(),Y=k.bondAngle.replace(/\s/g,"").toLowerCase();W=F===Y||F.includes(Y.replace("°",""))||k.correctGeometryId==="bent"&&(F.includes("104")||F.includes("105"))}else H.id==="explanation"&&(W=L.length>20);U(W?"correct":"incorrect"),W?(t==null||t(),c(u?F=>F+5:F=>F+10)):n==null||n()},oe=()=>{o<_m.length-1?(a(W=>W+1),U(null),h(!1)):r<y1.length-1?(s(W=>W+1),K()):i(l,G,f)},K=()=>{a(0),A(""),x(""),T(null),M(""),P(""),U(null),h(!1)},V=()=>H.id==="count"?`${k.centralAtom} hefur ${k.bondingPairs+k.lonePairs*2} gildisrafeindir. Hversu margar fara í tengsl?`:H.id==="geometry"?`${k.electronDomains} rafeinasvið með ${k.lonePairs} einstæð pör gefur þessa lögun.`:H.id==="angle"?`Þessi lögun hefur venjulega horn nálægt ${k.bondAngle}.`:"Útskýrðu af hverju þessi lögun myndast út frá fjölda rafeinasviða.";return N.jsx("div",{className:"min-h-screen bg-gradient-to-br from-teal-50 to-cyan-100 p-4 md:p-8",children:N.jsxs("div",{className:"max-w-4xl mx-auto",children:[N.jsxs("div",{className:"flex items-center justify-between mb-6",children:[N.jsxs("button",{onClick:e,className:"text-gray-600 hover:text-gray-800 flex items-center gap-2",children:[N.jsx("span",{children:"←"})," Til baka"]}),N.jsxs("div",{className:"text-right",children:[N.jsxs("div",{className:"text-sm text-gray-600",children:["Sameind ",r+1," af ",y1.length]}),N.jsxs("div",{className:"text-lg font-bold text-teal-600",children:[l," stig"]})]})]}),N.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 mb-6",children:N.jsx("div",{className:"bg-teal-500 h-2 rounded-full transition-all duration-300",style:{width:`${(r*_m.length+o+1)/(y1.length*_m.length)*100}%`}})}),N.jsx("div",{className:"flex gap-2 mb-6",children:_m.map((W,F)=>N.jsx("div",{className:`flex-1 text-center py-2 rounded-lg text-sm font-medium ${F===o?"bg-teal-500 text-white":F<o?"bg-green-100 text-green-700":"bg-gray-100 text-gray-500"}`,children:W.label},W.id))}),N.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl p-6 md:p-8",children:[N.jsxs("div",{className:"flex flex-col md:flex-row gap-6 mb-8",children:[N.jsxs("div",{className:"flex-1",children:[N.jsxs("div",{className:"flex justify-center gap-2 mb-3",children:[N.jsx("button",{onClick:()=>y("2d"),className:`px-4 py-1.5 rounded-lg text-sm font-medium transition-colors ${m==="2d"?"bg-teal-600 text-white":"bg-gray-200 text-gray-600 hover:bg-gray-300"}`,children:"2D"}),N.jsx("button",{onClick:()=>y("3d"),className:`px-4 py-1.5 rounded-lg text-sm font-medium transition-colors ${m==="3d"?"bg-teal-600 text-white":"bg-gray-200 text-gray-600 hover:bg-gray-300"}`,children:"3D"})]}),N.jsx("div",{className:"bg-gray-900 rounded-xl p-6",children:N.jsxs("div",{className:"text-center",children:[N.jsx("div",{className:"text-3xl font-bold text-white mb-2",children:k.formula}),N.jsx("div",{className:"text-gray-400 mb-4",children:k.name}),N.jsx("div",{className:"flex justify-center py-4",children:m==="2d"?N.jsx(tM,{molecule:_O({formula:k.formula,name:k.name,centralAtom:k.centralAtom,bondingPairs:k.bondingPairs,lonePairs:k.lonePairs,electronDomains:k.electronDomains,correctGeometryId:k.correctGeometryId,isPolar:k.isPolar}),mode:"vsepr",size:"lg",animation:"scale-in",showLonePairs:!0,ariaLabel:`${k.name} VSEPR lögun`}):N.jsx(HN,{molecule:_O({formula:k.formula,name:k.name,centralAtom:k.centralAtom,bondingPairs:k.bondingPairs,lonePairs:k.lonePairs,electronDomains:k.electronDomains,correctGeometryId:k.correctGeometryId,isPolar:k.isPolar}),style:"ball-stick",showLabels:!0,autoRotate:!0,autoRotateSpeed:1.5,height:200,width:"100%",backgroundColor:"transparent"})}),m==="3d"&&N.jsx("div",{className:"text-xs text-gray-500 mt-2",children:"Dragðu til að snúa, skrollaðu til að stækka"})]})})]}),N.jsxs("div",{className:"flex-1 bg-gray-50 rounded-xl p-6",children:[N.jsxs("h3",{className:"font-bold text-gray-700 mb-4",children:["Miðatóm: ",k.centralAtom]}),H.id==="count"&&N.jsxs("div",{className:"space-y-4",children:[N.jsx("p",{className:"text-gray-600",children:"Teldu rafeinasvið í kringum miðatómið:"}),N.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[N.jsxs("div",{children:[N.jsx("label",{className:"block text-sm font-medium text-gray-600 mb-1",children:"Bindandi pör"}),N.jsx("input",{type:"number",value:g,onChange:W=>A(W.target.value),disabled:R!==null,className:"w-full p-3 border-2 border-gray-300 rounded-xl text-center text-xl",min:"0",max:"6"})]}),N.jsxs("div",{children:[N.jsx("label",{className:"block text-sm font-medium text-gray-600 mb-1",children:"Einstæð pör"}),N.jsx("input",{type:"number",value:E,onChange:W=>x(W.target.value),disabled:R!==null,className:"w-full p-3 border-2 border-gray-300 rounded-xl text-center text-xl",min:"0",max:"3"})]})]}),R==="correct"&&N.jsxs("div",{className:"bg-teal-50 p-3 rounded-lg",children:[N.jsx("span",{className:"font-bold text-teal-700",children:"Samtals rafeinasvið: "}),N.jsx("span",{className:"text-teal-600",children:k.electronDomains})]})]}),H.id==="geometry"&&N.jsxs("div",{className:"space-y-4",children:[N.jsxs("p",{className:"text-gray-600",children:["Með ",k.bondingPairs," bindandi pör og ",k.lonePairs," einstæð pör, hvaða ",N.jsx("strong",{children:"sameindarlögun"})," hefur þessi sameind?"]}),N.jsx("div",{className:"grid grid-cols-2 gap-2",children:X.map(W=>N.jsxs("button",{onClick:()=>!R&&T(W.id),disabled:R!==null,className:`p-3 rounded-xl border-2 text-left transition-all ${R?W.id===k.correctGeometryId?"border-green-500 bg-green-50":w===W.id?"border-red-500 bg-red-50":"border-gray-200 opacity-50":w===W.id?"border-teal-500 bg-teal-50":"border-gray-200 hover:border-teal-300"}`,children:[N.jsx("div",{className:"font-bold text-sm",children:W.name}),N.jsx("div",{className:"text-xs text-gray-500",children:W.bondAngle})]},W.id))})]}),H.id==="angle"&&N.jsxs("div",{className:"space-y-4",children:[N.jsxs("p",{className:"text-gray-600",children:["Hvert er (eru) tengihornið/-in í ",k.formula,"?"]}),N.jsx("input",{type:"text",value:I,onChange:W=>M(W.target.value),disabled:R!==null,placeholder:"t.d. 109.5° eða 90° og 120°",className:"w-full p-3 border-2 border-gray-300 rounded-xl"}),R==="correct"&&N.jsxs("div",{className:"bg-green-50 p-3 rounded-lg text-green-700",children:["Rétt! Tengihornið er ",k.bondAngle]}),R==="incorrect"&&N.jsxs("div",{className:"bg-red-50 p-3 rounded-lg text-red-700",children:["Rétt svar: ",k.bondAngle]}),R!==null&&N.jsxs("div",{className:"bg-indigo-50 p-4 rounded-xl border border-indigo-200",children:[N.jsxs("div",{className:"font-bold text-indigo-800 mb-3 flex items-center gap-2",children:[N.jsx("span",{className:"text-lg",children:"📐"})," Tengihorn í ",k.molecularGeometry]}),N.jsx("div",{className:"flex items-center justify-center py-4",children:N.jsxs("svg",{width:"180",height:"120",viewBox:"0 0 180 120",className:"drop-shadow",children:[N.jsx("circle",{cx:"90",cy:"80",r:"18",fill:"#0d9488",stroke:"#134e4a",strokeWidth:"2"}),N.jsx("text",{x:"90",y:"85",textAnchor:"middle",fill:"white",fontWeight:"bold",fontSize:"14",children:k.centralAtom}),k.correctGeometryId==="linear"&&N.jsxs(N.Fragment,{children:[N.jsx("line",{x1:"20",y1:"80",x2:"72",y2:"80",stroke:"#374151",strokeWidth:"3"}),N.jsx("line",{x1:"108",y1:"80",x2:"160",y2:"80",stroke:"#374151",strokeWidth:"3"}),N.jsx("path",{d:"M 60 80 A 30 30 0 0 1 120 80",fill:"none",stroke:"#8b5cf6",strokeWidth:"2",strokeDasharray:"4 2"}),N.jsx("text",{x:"90",y:"60",textAnchor:"middle",fill:"#8b5cf6",fontWeight:"bold",fontSize:"12",children:"180°"})]}),k.correctGeometryId==="trigonal-planar"&&N.jsxs(N.Fragment,{children:[N.jsx("line",{x1:"90",y1:"62",x2:"90",y2:"20",stroke:"#374151",strokeWidth:"3"}),N.jsx("line",{x1:"72",y1:"80",x2:"30",y2:"100",stroke:"#374151",strokeWidth:"3"}),N.jsx("line",{x1:"108",y1:"80",x2:"150",y2:"100",stroke:"#374151",strokeWidth:"3"}),N.jsx("path",{d:"M 70 35 A 25 25 0 0 1 110 35",fill:"none",stroke:"#8b5cf6",strokeWidth:"2",strokeDasharray:"4 2"}),N.jsx("text",{x:"90",y:"50",textAnchor:"middle",fill:"#8b5cf6",fontWeight:"bold",fontSize:"11",children:"120°"})]}),(k.correctGeometryId==="tetrahedral"||k.correctGeometryId==="trigonal-pyramidal"||k.correctGeometryId==="bent")&&N.jsxs(N.Fragment,{children:[N.jsx("line",{x1:"72",y1:"80",x2:"30",y2:"55",stroke:"#374151",strokeWidth:"3"}),N.jsx("line",{x1:"108",y1:"80",x2:"150",y2:"55",stroke:"#374151",strokeWidth:"3"}),k.bondingPairs>=3&&N.jsx("line",{x1:"90",y1:"62",x2:"90",y2:"20",stroke:"#374151",strokeWidth:"3"}),k.bondingPairs>=4&&N.jsx("line",{x1:"90",y1:"98",x2:"90",y2:"115",stroke:"#374151",strokeWidth:"3"}),N.jsx("path",{d:"M 50 55 A 35 35 0 0 1 130 55",fill:"none",stroke:"#8b5cf6",strokeWidth:"2",strokeDasharray:"4 2"}),N.jsx("text",{x:"90",y:"45",textAnchor:"middle",fill:"#8b5cf6",fontWeight:"bold",fontSize:"11",children:k.bondAngle})]}),(k.correctGeometryId==="octahedral"||k.correctGeometryId==="square-planar")&&N.jsxs(N.Fragment,{children:[N.jsx("line",{x1:"90",y1:"62",x2:"90",y2:"20",stroke:"#374151",strokeWidth:"3"}),N.jsx("line",{x1:"72",y1:"80",x2:"30",y2:"80",stroke:"#374151",strokeWidth:"3"}),N.jsx("line",{x1:"108",y1:"80",x2:"150",y2:"80",stroke:"#374151",strokeWidth:"3"}),N.jsx("line",{x1:"90",y1:"98",x2:"90",y2:"115",stroke:"#374151",strokeWidth:"3"}),N.jsx("path",{d:"M 90 50 A 30 30 0 0 1 120 80",fill:"none",stroke:"#8b5cf6",strokeWidth:"2",strokeDasharray:"4 2"}),N.jsx("text",{x:"115",y:"60",textAnchor:"middle",fill:"#8b5cf6",fontWeight:"bold",fontSize:"11",children:"90°"})]}),(k.correctGeometryId==="trigonal-bipyramidal"||k.correctGeometryId==="seesaw"||k.correctGeometryId==="t-shaped")&&N.jsxs(N.Fragment,{children:[N.jsx("line",{x1:"90",y1:"62",x2:"90",y2:"15",stroke:"#374151",strokeWidth:"3"}),N.jsx("line",{x1:"90",y1:"98",x2:"90",y2:"115",stroke:"#374151",strokeWidth:"3"}),N.jsx("line",{x1:"72",y1:"80",x2:"30",y2:"80",stroke:"#374151",strokeWidth:"3"}),N.jsx("line",{x1:"108",y1:"80",x2:"150",y2:"80",stroke:"#374151",strokeWidth:"3"}),N.jsx("path",{d:"M 90 45 A 35 35 0 0 1 125 80",fill:"none",stroke:"#8b5cf6",strokeWidth:"2",strokeDasharray:"4 2"}),N.jsx("text",{x:"130",y:"55",textAnchor:"start",fill:"#8b5cf6",fontWeight:"bold",fontSize:"10",children:"90°"}),N.jsx("text",{x:"50",y:"95",textAnchor:"middle",fill:"#f59e0b",fontWeight:"bold",fontSize:"10",children:"120°"})]})]})}),N.jsx("div",{className:"text-xs text-indigo-600 text-center",children:k.lonePairs>0&&N.jsx("span",{children:"⚠️ Einstæð pör (ekki sýnd) minnka hornið frá fullkominni röðun"})})]})]}),H.id==="explanation"&&N.jsxs("div",{className:"space-y-4",children:[N.jsxs("p",{className:"text-gray-600",children:["Útskýrðu af hverju ",k.formula," hefur ",k.molecularGeometry.toLowerCase()," lögun:"]}),N.jsx("textarea",{value:L,onChange:W=>P(W.target.value),disabled:R!==null,placeholder:"Skrifaðu útskýringu...",rows:4,className:"w-full p-3 border-2 border-gray-300 rounded-xl resize-none"}),R!==null&&N.jsxs("div",{className:"bg-teal-50 p-4 rounded-lg",children:[N.jsx("div",{className:"font-bold text-teal-800 mb-2",children:"Dæmi um útskýringu:"}),N.jsx("p",{className:"text-teal-700 text-sm",children:k.explanation})]})]})]})]}),!R&&!u&&N.jsx("button",{onClick:()=>{h(!0),d(W=>W+1)},className:"text-teal-600 hover:text-teal-800 text-sm underline mb-4",children:"Syna visbendingu (-5 stig)"}),u&&!R&&N.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 p-4 rounded-xl mb-4",children:[N.jsx("span",{className:"font-bold text-yellow-800",children:"Vísbending: "}),N.jsx("span",{className:"text-yellow-900",children:V()})]}),R&&N.jsx("div",{className:`p-4 rounded-xl mb-4 ${R==="correct"?"bg-green-50 border border-green-200":"bg-red-50 border border-red-200"}`,children:N.jsx("div",{className:`font-bold ${R==="correct"?"text-green-700":"text-red-700"}`,children:R==="correct"?"Rétt!":"Rangt — Sjáðu rétt svar hér að ofan"})}),R?N.jsx("button",{onClick:oe,className:"w-full bg-teal-500 hover:bg-teal-600 text-white font-bold py-4 px-6 rounded-xl transition-colors",children:o<_m.length-1?"Næsta skref":r<y1.length-1?"Næsta sameind":"Ljúka stigi 2"}):N.jsx("button",{onClick:Z,disabled:H.id==="count"&&(!g||!E)||H.id==="geometry"&&!w||H.id==="angle"&&!I||H.id==="explanation"&&L.length<10,className:"w-full bg-teal-500 hover:bg-teal-600 disabled:bg-gray-300 text-white font-bold py-4 px-6 rounded-xl transition-colors",children:"Athuga svar"})]}),N.jsxs("div",{className:"mt-6 bg-white rounded-xl p-4 shadow",children:[N.jsx("h3",{className:"font-bold text-gray-700 mb-3",children:"Lögunartafla"}),N.jsx("div",{className:"overflow-x-auto",children:N.jsxs("table",{className:"w-full text-sm",children:[N.jsx("thead",{children:N.jsxs("tr",{className:"bg-gray-50",children:[N.jsx("th",{className:"p-2 text-left",children:"Rafeinasvið"}),N.jsx("th",{className:"p-2 text-left",children:"BP"}),N.jsx("th",{className:"p-2 text-left",children:"LP"}),N.jsx("th",{className:"p-2 text-left",children:"Lögun"}),N.jsx("th",{className:"p-2 text-left",children:"Horn"})]})}),N.jsxs("tbody",{children:[N.jsxs("tr",{className:"border-t",children:[N.jsx("td",{className:"p-2",children:"2"}),N.jsx("td",{children:"2"}),N.jsx("td",{children:"0"}),N.jsx("td",{children:"Línuleg"}),N.jsx("td",{children:"180°"})]}),N.jsxs("tr",{className:"border-t",children:[N.jsx("td",{className:"p-2",children:"3"}),N.jsx("td",{children:"3"}),N.jsx("td",{children:"0"}),N.jsx("td",{children:"Þríhyrnd slétt"}),N.jsx("td",{children:"120°"})]}),N.jsxs("tr",{className:"border-t",children:[N.jsx("td",{className:"p-2",children:"3"}),N.jsx("td",{children:"2"}),N.jsx("td",{children:"1"}),N.jsx("td",{children:"Beygð"}),N.jsx("td",{children:"<120°"})]}),N.jsxs("tr",{className:"border-t",children:[N.jsx("td",{className:"p-2",children:"4"}),N.jsx("td",{children:"4"}),N.jsx("td",{children:"0"}),N.jsx("td",{children:"Fjórflötungur"}),N.jsx("td",{children:"109.5°"})]}),N.jsxs("tr",{className:"border-t",children:[N.jsx("td",{className:"p-2",children:"4"}),N.jsx("td",{children:"3"}),N.jsx("td",{children:"1"}),N.jsx("td",{children:"Þríhyrnd pýramída"}),N.jsx("td",{children:"107°"})]}),N.jsxs("tr",{className:"border-t",children:[N.jsx("td",{className:"p-2",children:"4"}),N.jsx("td",{children:"2"}),N.jsx("td",{children:"2"}),N.jsx("td",{children:"Beygð"}),N.jsx("td",{children:"104.5°"})]}),N.jsxs("tr",{className:"border-t bg-purple-50",children:[N.jsx("td",{className:"p-2",children:"5"}),N.jsx("td",{children:"5"}),N.jsx("td",{children:"0"}),N.jsx("td",{children:"Þríhyrnd tvípýramída"}),N.jsx("td",{children:"90°, 120°"})]}),N.jsxs("tr",{className:"border-t bg-purple-50",children:[N.jsx("td",{className:"p-2",children:"5"}),N.jsx("td",{children:"4"}),N.jsx("td",{children:"1"}),N.jsx("td",{children:"Sjáldruslögun"}),N.jsx("td",{children:"~90°, ~120°"})]}),N.jsxs("tr",{className:"border-t bg-purple-50",children:[N.jsx("td",{className:"p-2",children:"5"}),N.jsx("td",{children:"3"}),N.jsx("td",{children:"2"}),N.jsx("td",{children:"T-lögun"}),N.jsx("td",{children:"90°"})]}),N.jsxs("tr",{className:"border-t bg-indigo-50",children:[N.jsx("td",{className:"p-2",children:"6"}),N.jsx("td",{children:"6"}),N.jsx("td",{children:"0"}),N.jsx("td",{children:"Áttflötungur"}),N.jsx("td",{children:"90°"})]}),N.jsxs("tr",{className:"border-t bg-indigo-50",children:[N.jsx("td",{className:"p-2",children:"6"}),N.jsx("td",{children:"4"}),N.jsx("td",{children:"2"}),N.jsx("td",{children:"Ferningsslétt"}),N.jsx("td",{children:"90°"})]})]})]})})]})]})})}const v1=[{id:1,type:"hybridization",formula:"CH₄",name:"Metan",question:"Hvaða blendni (hybridization) hefur kolefnið í CH₄?",options:[{id:"a",text:"sp",correct:!1,explanation:"sp blendni gefur línulega lögun (2 svið)."},{id:"b",text:"sp²",correct:!1,explanation:"sp² blendni gefur þríhyrnda sléttu (3 svið)."},{id:"c",text:"sp³",correct:!0,explanation:"Rétt! 4 rafeinasvið = sp³ blendni = fjórflötungur."},{id:"d",text:"sp³d",correct:!1,explanation:"sp³d krefst 5 rafeinasviða."}],hint:"Fjöldi rafeinasviða ákvarðar blendnina: 2=sp, 3=sp², 4=sp³...",conceptExplanation:"Blendni lýsir hvernig atómbreytir (orbitals) blandast saman. Fjöldi blandaðra breyti = fjöldi rafeinasviða."},{id:2,type:"hybridization",formula:"CO₂",name:"Koltvísýringur",question:"Hvaða blendni hefur kolefnið í CO₂?",options:[{id:"a",text:"sp",correct:!0,explanation:"Rétt! 2 rafeinasvið (2 tvöfald tengingar) = sp blendni = línuleg."},{id:"b",text:"sp²",correct:!1,explanation:"sp² gefur þríhyrnd sléttu lögun."},{id:"c",text:"sp³",correct:!1,explanation:"sp³ gefur fjórflötung."},{id:"d",text:"Engin blendni",correct:!1,explanation:"Kolefni notar alltaf blendni í efnatengsli."}],hint:"Tvöfald tenging telst sem EITT rafeinasvið.",conceptExplanation:"Í CO₂ hefur kolefni 2 tvöfalt tengingar við súrefni. Hver tvöfald tenging telur sem eitt rafeinasvið, svo C hefur 2 rafeinasvið og sp blendni."},{id:3,type:"hybridization",formula:"NH₃",name:"Ammóníak",question:"Hvaða blendni hefur nitrið í NH₃?",options:[{id:"a",text:"sp",correct:!1,explanation:"sp hefur aðeins 2 rafeinasvið."},{id:"b",text:"sp²",correct:!1,explanation:"sp² hefur 3 rafeinasvið."},{id:"c",text:"sp³",correct:!0,explanation:"Rétt! 3 tengsl + 1 einstætt par = 4 rafeinasvið = sp³."},{id:"d",text:"sp³d",correct:!1,explanation:"sp³d krefst 5 rafeinasviða."}],hint:"Mundu að telja EINSTÆÐ PÖR sem rafeinasvið líka!",conceptExplanation:"NH₃ hefur 3 N-H tengsl og 1 einstætt par á nitri = 4 rafeinasvið = sp³ blendni. Þó sameindarlögunin sé þríhyrnd pýramída er blendnin enn sp³."},{id:4,type:"hybridization",formula:"SF₆",name:"Brennisteinshexaflúoríð",question:"Hvaða blendni hefur brennisteinið í SF₆?",options:[{id:"a",text:"sp³",correct:!1,explanation:"sp³ hefur aðeins 4 rafeinasvið."},{id:"b",text:"sp³d",correct:!1,explanation:"sp³d hefur 5 rafeinasvið."},{id:"c",text:"sp³d²",correct:!0,explanation:"Rétt! 6 tengsl = 6 rafeinasvið = sp³d² blendni = áttflötungur."},{id:"d",text:"d²sp³",correct:!1,explanation:"Þetta er sama og sp³d², en sp³d² er algengari ritháttður."}],hint:"S hefur 6 F tengingar = 6 rafeinasvið. Þetta krefst d-breytu.",conceptExplanation:"Fyrir 5+ rafeinasvið þarf að nota d-breytir (orbitals). 5 svið = sp³d, 6 svið = sp³d². Þetta er mögulegt fyrir frumefni í 3. röð og neðar."},{id:5,type:"polarity",formula:"H₂O",name:"Vatn",question:"Er vatn (H₂O) skautuð eða óskautuð sameind?",options:[{id:"a",text:"Skautuð",correct:!0,explanation:"Rétt! Beygð lögun gerir að verkum að tvískautsvægin jafnast ekki út."},{id:"b",text:"Óskautuð",correct:!1,explanation:"Vatn er skautað vegna beygðu lögunarinnar."},{id:"c",text:"Fer eftir hitastigi",correct:!1,explanation:"Skautun ákvarðast af efnafræðilegri byggingu, ekki hitastigi."},{id:"d",text:"Fer eftir jónstyrk",correct:!1,explanation:"Jónstyrkur hefur ekki áhrif á sameindarskautun."}],hint:"Hugsaðu um lögunina — ef O-H tvískautsvægin benda í mismunandi áttir, hvað gerist?",conceptExplanation:"Í H₂O eru tvö skautuð O-H tengisl sem benda í mismunandi áttir (104.5° horn). Tvískautsvægin jafnast ekki út → skautuð sameind."},{id:6,type:"polarity",formula:"CO₂",name:"Koltvísýringur",question:"Er CO₂ skautuð eða óskautuð sameind?",options:[{id:"a",text:"Skautuð",correct:!1,explanation:"Þó C=O tengslin séu skautuð, þá er sameindin ekki skautuð."},{id:"b",text:"Óskautuð",correct:!0,explanation:"Rétt! Línuleg lögun (180°) — tvískautsvægin jafnast út."},{id:"c",text:"Lítillega skautuð",correct:!1,explanation:"Skautun er annaðhvort til staðar eða ekki í þessari samhengi."},{id:"d",text:"Fer eftir þrýstingi",correct:!1,explanation:"Þrýstingur hefur ekki áhrif á sameindarskautun."}],hint:"Línuleg lögun — C=O tvískautsvægin vísa í gagnstæðar áttir.",conceptExplanation:"Hvert C=O tengi er skautað (O er rafneikvæðara). En í línulegri lögun (180°) vísa tvískautsvægin í GAGNSTÆÐAR áttir og hætta við hvort annað → nettó tvískautsvægi = 0."},{id:7,type:"polarity",formula:"BF₃",name:"Bórþríflúoríð",question:"Er BF₃ skautuð eða óskautuð sameind?",options:[{id:"a",text:"Skautuð vegna F atóma",correct:!1,explanation:"Þó B-F tengslin séu skautuð, er sameindin samhverf."},{id:"b",text:"Óskautuð vegna samhverfu",correct:!0,explanation:"Rétt! Þríhyrnd slétt lögun er samhverf — tvískautsvægin jafnast út."},{id:"c",text:"Skautuð vegna bórs",correct:!1,explanation:"Bór er ekki mjög rafneikvætt miðað við flúor."},{id:"d",text:"Misjafnlega skautuð",correct:!1,explanation:"Sameind er annaðhvort skautuð eða ekki."}],hint:"Þríhyrnd slétt lögun (120°) — þrjú eins tengisl.",conceptExplanation:"BF₃ er þríhyrnd slétt (120° milli allra tengja). Þrjú jafn skautuð B-F tengisl draga í þrjár jafnar áttir → kraftarnir jafnast út → óskautuð sameind."},{id:8,type:"polarity",formula:"CHCl₃",name:"Klóróform",question:"Er CHCl₃ (klóróform) skautuð eða óskautuð sameind?",options:[{id:"a",text:"Óskautuð vegna fjórflötungs",correct:!1,explanation:"Fjórflötungur er samhverfur, en CHCl₃ hefur mismunandi atóm."},{id:"b",text:"Skautuð vegna ósamhverfu",correct:!0,explanation:"Rétt! C-H og C-Cl hafa mismunandi skautun — ósamhverft dreifing."},{id:"c",text:"Aðeins H er skautað",correct:!1,explanation:"Bæði C-H og C-Cl tengisl eru skautuð."},{id:"d",text:"Fer eftir leysi",correct:!1,explanation:"Skautun ákvarðast af byggingu sameindarinnar."}],hint:"Berðu saman CH₄ (óskautuð) við CHCl₃ — hvað er breytt?",conceptExplanation:"Í CH₄ eru öll 4 tengslin eins → samhverf → óskautuð. Í CHCl₃ eru 1 H og 3 Cl — ósamhverf → skautuð. C-Cl tengsl draga miklu meira en C-H."},{id:9,type:"multi_center",formula:"C₂H₄",name:"Eten (etýlen)",lewisStructure:"H₂C = CH₂",question:"Hvaða blendni hafa BÆÐI kolefnin í C₂H₄ (eten)?",options:[{id:"a",text:"sp",correct:!1,explanation:"sp gefur línulega lögun, en C₂H₄ er slétt."},{id:"b",text:"sp²",correct:!0,explanation:"Rétt! Hvert C hefur 3 rafeinasvið (2 C-H + 1 C=C) = sp² blendni."},{id:"c",text:"sp³",correct:!1,explanation:"sp³ krefst 4 rafeinasviða, en hvert C hefur aðeins 3."},{id:"d",text:"Mismunandi blendni",correct:!1,explanation:"Bæði kolefnin eru í nákvæmlega sömu stöðu."}],hint:"Tvöfald C=C tenging telur sem EITT rafeinasvið. Teldu svið í kringum hvort C.",conceptExplanation:"Í C₂H₄ hefur hvert C: 2 tengsl við H + 1 tengsl við hitt C (tvöfalt tengi). = 3 rafeinasvið = sp² blendni. Öll atóm liggja í einni slétti."},{id:10,type:"multi_center",formula:"C₂H₂",name:"Etín (asetýlen)",lewisStructure:"H-C≡C-H",question:"Hvaða blendni hafa kolefnin í C₂H₂ (etín)?",options:[{id:"a",text:"sp",correct:!0,explanation:"Rétt! Hvert C hefur 2 rafeinasvið (1 C-H + 1 C≡C) = sp blendni = línuleg."},{id:"b",text:"sp²",correct:!1,explanation:"sp² krefst 3 rafeinasviða."},{id:"c",text:"sp³",correct:!1,explanation:"sp³ krefst 4 rafeinasviða."},{id:"d",text:"Engin blendni",correct:!1,explanation:"Kolefni notar alltaf blendni í sameindum."}],hint:"Þreföld tenging telur einnig sem EITT rafeinasvið.",conceptExplanation:"Í C₂H₂ er þreföld tenging milli kolefnanna. Hvert C hefur aðeins 2 rafeinasvið (C-H + C≡C) = sp blendni. Sameindin er línuleg (180°)."},{id:11,type:"dipole",formula:"CCl₄",name:"Kolefnistetraklóríð",question:"CCl₄ hefur fjögur C-Cl tengisl sem eru öll skautuð. Af hverju er CCl₄ þá ÓSKAUTUÐ sameind?",options:[{id:"a",text:"C-Cl tengisl eru í raun óskautuð",correct:!1,explanation:"C-Cl tengisl ERU skautuð (Cl er rafneikvæðara)."},{id:"b",text:"Fjórflötungslögun er samhverf — tvískautsvægi jafnast út",correct:!0,explanation:"Rétt! Fjögur jafn skautuð tengisl í fjórflötungi draga í jafnar áttir → nettó tvískautsvægi = 0."},{id:"c",text:"Klór er ekki nægilega rafneikvætt",correct:!1,explanation:"Klór er mjög rafneikvætt."},{id:"d",text:"Kolefni er óleiðandi",correct:!1,explanation:"Leiðni hefur ekkert með skautun að gera."}],hint:"Hugsaðu um fjórflötunginn — ef þú dregur í allar 4 áttir jafnt...",conceptExplanation:"Þetta er klassískt dæmi um SAMHVERFU. Þó hvert C-Cl tengi sé skautað, þá eru þau SAMHVERF dreifð í rúminu (fjórflötungur). Kraftarnir jafnast út → enginn nettó tvískautsvægi."},{id:12,type:"dipole",formula:"NF₃ vs. NH₃",name:"Samanburður",question:"Bæði NF₃ og NH₃ hafa þríhyrnda pýramídalögun. Hvor er MEIRA skautuð?",options:[{id:"a",text:"NF₃ er meira skautuð vegna F",correct:!1,explanation:"F er rafneikvæðara, en það er ekki allt..."},{id:"b",text:"NH₃ er meira skautuð",correct:!0,explanation:"Rétt! Í NH₃ benda einstæða parið og N-H tvískautsvægin í SÖMU átt. Í NF₃ benda þau í GAGNSTÆÐAR áttir."},{id:"c",text:"Þær eru jafn skatuaðar",correct:!1,explanation:"Stefna tvískautsvægis skiptir máli."},{id:"d",text:"Hvorug er skautuð",correct:!1,explanation:"Báðar eru skatuaðar, en misjafnlega."}],hint:"Hugsaðu um einstæða parið á N — hvert bendir það? Og hvert benda tengslin?",conceptExplanation:"Í NH₃: N-H tengisl benda FRÁ N (H er δ+) og einstæða parið bendir einnig upp → allir kraftar benda í SÖMU ÁTTINA → stórt tvískautsvægi. Í NF₃: N-F tengisl benda MÓTI N (F er δ-) en einstæða parið bendir í GAGNSTÆÐA ÁTT → kraftar hætta við → minna tvískautsvægi."}];function C3e({onComplete:i,onBack:e,onCorrectAnswer:t,onIncorrectAnswer:n}){const[r,s]=C.useState(0),[o,a]=C.useState(null),[l,c]=C.useState(!1),[u,h]=C.useState(!1),[f,d]=C.useState(!1),[m,y]=C.useState(!1),[g,A]=C.useState(0),[E,x]=C.useState(0),w=v1[r],T=v1.length*12,I=()=>{const R=w.options.find(k=>k.id===o),U=(R==null?void 0:R.correct)??!1;y(U),U?(t==null||t(),A(u?k=>k+6:k=>k+12)):n==null||n(),c(!0)},M=()=>{r<v1.length-1?(s(R=>R+1),a(null),c(!1),h(!1),d(!1),y(!1)):i(g,T,E)},L=R=>{switch(R){case"hybridization":return"Blendni";case"polarity":return"Skautun";case"multi_center":return"Mörg miðatóm";case"dipole":return"Tvískautsvægi";default:return R}},P=R=>{switch(R){case"hybridization":return"bg-purple-100 text-purple-800";case"polarity":return"bg-blue-100 text-blue-800";case"multi_center":return"bg-green-100 text-green-800";case"dipole":return"bg-orange-100 text-orange-800";default:return"bg-gray-100 text-gray-800"}};return N.jsx("div",{className:"min-h-screen bg-gradient-to-br from-teal-50 to-cyan-100 p-4 md:p-8",children:N.jsxs("div",{className:"max-w-3xl mx-auto",children:[N.jsxs("div",{className:"flex items-center justify-between mb-6",children:[N.jsxs("button",{onClick:e,className:"text-gray-600 hover:text-gray-800 flex items-center gap-2",children:[N.jsx("span",{children:"←"})," Til baka"]}),N.jsxs("div",{className:"text-right",children:[N.jsxs("div",{className:"text-sm text-gray-600",children:["Spurning ",r+1," af ",v1.length]}),N.jsxs("div",{className:"text-lg font-bold text-teal-600",children:[g," stig"]})]})]}),N.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 mb-6",children:N.jsx("div",{className:"bg-teal-500 h-2 rounded-full transition-all duration-300",style:{width:`${(r+1)/v1.length*100}%`}})}),N.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl p-6 md:p-8",children:[N.jsx("div",{className:"mb-4",children:N.jsx("span",{className:`inline-block px-3 py-1 rounded-full text-sm font-medium ${P(w.type)}`,children:L(w.type)})}),N.jsxs("div",{className:"bg-gray-900 rounded-xl p-4 mb-6 text-center",children:[N.jsx("div",{className:"text-3xl font-bold text-white",children:w.formula}),N.jsx("div",{className:"text-gray-400",children:w.name}),w.lewisStructure&&N.jsx("div",{className:"font-mono text-teal-400 mt-2 whitespace-pre",children:w.lewisStructure})]}),N.jsx("p",{className:"text-gray-700 text-lg mb-6",children:w.question}),N.jsx("div",{className:"space-y-3 mb-6",children:w.options.map(R=>N.jsxs("button",{onClick:()=>!l&&a(R.id),disabled:l,className:`w-full p-4 rounded-xl border-2 text-left transition-all ${l?R.correct?"border-green-500 bg-green-50":o===R.id?"border-red-500 bg-red-50":"border-gray-200 bg-gray-50 opacity-50":o===R.id?"border-teal-500 bg-teal-50 ring-2 ring-teal-200":"border-gray-300 hover:border-teal-400 hover:bg-teal-50"}`,children:[N.jsxs("div",{className:"flex items-start gap-3",children:[N.jsxs("span",{className:"font-bold text-gray-500 uppercase",children:[R.id,"."]}),N.jsx("span",{className:"flex-1",children:R.text})]}),l&&o===R.id&&N.jsx("div",{className:`mt-2 text-sm ${R.correct?"text-green-700":"text-red-700"}`,children:R.explanation})]},R.id))}),!l&&!u&&N.jsx("button",{onClick:()=>{h(!0),x(R=>R+1)},className:"text-teal-600 hover:text-teal-800 text-sm underline mb-4",children:"Syna visbendingu (-6 stig)"}),u&&!l&&N.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 p-4 rounded-xl mb-4",children:[N.jsx("span",{className:"font-bold text-yellow-800",children:"Vísbending: "}),N.jsx("span",{className:"text-yellow-900",children:w.hint})]}),!l&&N.jsx("button",{onClick:I,disabled:!o,className:"w-full bg-teal-500 hover:bg-teal-600 disabled:bg-gray-300 text-white font-bold py-4 px-6 rounded-xl transition-colors",children:"Athuga svar"}),l&&N.jsxs(N.Fragment,{children:[N.jsx("div",{className:`p-4 rounded-xl mb-4 ${m?"bg-green-50 border border-green-200":"bg-red-50 border border-red-200"}`,children:N.jsx("div",{className:`font-bold text-lg ${m?"text-green-700":"text-red-700"}`,children:m?"Rétt!":"Rangt"})}),N.jsx("button",{onClick:()=>d(!f),className:"w-full text-left p-4 bg-purple-50 rounded-xl mb-4 hover:bg-purple-100 transition-colors",children:N.jsxs("div",{className:"flex items-center justify-between",children:[N.jsx("span",{className:"font-bold text-purple-800",children:"💡 Skoða hugtakaútskýringu"}),N.jsx("span",{className:"text-purple-600",children:f?"▲":"▼"})]})}),f&&N.jsx("div",{className:"bg-purple-50 p-4 rounded-xl mb-4 border border-purple-200",children:N.jsx("p",{className:"text-purple-900 text-sm",children:w.conceptExplanation})}),N.jsx("button",{onClick:M,className:"w-full bg-teal-500 hover:bg-teal-600 text-white font-bold py-4 px-6 rounded-xl transition-colors",children:r<v1.length-1?"Næsta spurning":"Ljúka stigi 3"})]})]}),N.jsxs("div",{className:"mt-6 grid md:grid-cols-2 gap-4",children:[N.jsxs("div",{className:"bg-white rounded-xl p-4 shadow",children:[N.jsx("h3",{className:"font-bold text-gray-700 mb-3",children:"🧬 Blendnitafla"}),N.jsxs("table",{className:"w-full text-sm",children:[N.jsx("thead",{children:N.jsxs("tr",{className:"bg-gray-50",children:[N.jsx("th",{className:"p-2 text-left",children:"Svið"}),N.jsx("th",{className:"p-2 text-left",children:"Blendni"}),N.jsx("th",{className:"p-2 text-left",children:"Lögun"})]})}),N.jsxs("tbody",{children:[N.jsxs("tr",{className:"border-t",children:[N.jsx("td",{className:"p-2",children:"2"}),N.jsx("td",{className:"hybridization-sp",children:"sp"}),N.jsx("td",{children:"Línuleg"})]}),N.jsxs("tr",{className:"border-t",children:[N.jsx("td",{className:"p-2",children:"3"}),N.jsx("td",{className:"hybridization-sp2",children:"sp²"}),N.jsx("td",{children:"Þríhyrnd"})]}),N.jsxs("tr",{className:"border-t",children:[N.jsx("td",{className:"p-2",children:"4"}),N.jsx("td",{className:"hybridization-sp3",children:"sp³"}),N.jsx("td",{children:"Fjórflötungur"})]}),N.jsxs("tr",{className:"border-t",children:[N.jsx("td",{className:"p-2",children:"5"}),N.jsx("td",{className:"hybridization-sp3d",children:"sp³d"}),N.jsx("td",{children:"Tvípýramída"})]}),N.jsxs("tr",{className:"border-t",children:[N.jsx("td",{className:"p-2",children:"6"}),N.jsx("td",{className:"hybridization-sp3d2",children:"sp³d²"}),N.jsx("td",{children:"Áttflötungur"})]})]})]})]}),N.jsxs("div",{className:"bg-white rounded-xl p-4 shadow",children:[N.jsx("h3",{className:"font-bold text-gray-700 mb-3",children:"⚡ Skautun"}),N.jsxs("div",{className:"space-y-2 text-sm",children:[N.jsxs("div",{className:"bg-green-50 p-2 rounded",children:[N.jsx("strong",{children:"Óskautuð:"})," Samhverf lögun → tvískautsvægi jafnast út"]}),N.jsxs("div",{className:"bg-blue-50 p-2 rounded",children:[N.jsx("strong",{children:"Skautuð:"})," Ósamhverf → nettó tvískautsvægi ≠ 0"]}),N.jsxs("div",{className:"text-gray-600 mt-2",children:[N.jsx("strong",{children:"Dæmi:"}),N.jsx("br",{}),"CO₂ (línuleg) → óskautuð",N.jsx("br",{}),"H₂O (beygð) → skautuð",N.jsx("br",{}),"CCl₄ (fjórflötungur) → óskautuð",N.jsx("br",{}),"CHCl₃ (fjórflötungur) → skautuð"]})]})]})]})]})})}function T3e({gameId:i,onAchievementUnlocked:e}){const[t,n]=C.useState(b3),[r,s]=C.useState([]);C.useEffect(()=>{const y=new Date().toISOString().split("T")[0];if(!t.daysPlayed.includes(y)){const g={...t,daysPlayed:[...t.daysPlayed,y]};n(g),y6(g);const A=iL(g,{type:"game_start"});A.length>0&&(s(E=>[...E,...A]),A.forEach(E=>e==null?void 0:e(E)))}},[]);const o=C.useCallback(y=>{const g=b3(),A=iL(g,y);A.length>0&&(s(E=>[...E,...A]),A.forEach(E=>e==null?void 0:e(E))),n(b3())},[e]),a=C.useCallback(y=>{o({type:"answer_correct",gameId:i,firstAttempt:y==null?void 0:y.firstAttempt})},[i,o]),l=C.useCallback(()=>{o({type:"answer_incorrect",gameId:i})},[i,o]),c=C.useCallback((y,g,A,E)=>{o({type:"level_complete",gameId:i,level:y,score:g,maxScore:A,timeTaken:E==null?void 0:E.timeTaken,hintsUsed:(E==null?void 0:E.hintsUsed)??0})},[i,o]),u=C.useCallback(()=>{o({type:"game_complete",gameId:i})},[i,o]),h=C.useCallback(y=>{s(g=>g.filter(A=>A.achievement.id!==y))},[]),f=C.useCallback(()=>{s([])},[]),d=C.useCallback(y=>ON(t,y),[t]),m=C.useCallback(()=>{f$(),n(b3()),s([])},[]);return{achievements:t,allAchievements:nx,unlockedAchievements:u$(t),lockedAchievements:h$(t),currentStreak:t.currentStreak,bestStreak:t.bestStreak,totalPoints:t.totalPoints,unlockedPercentage:c$(t),notifications:r,trackCorrectAnswer:a,trackIncorrectAnswer:l,trackLevelComplete:c,trackGameComplete:u,dismissNotification:h,clearNotifications:f,getProgress:d,resetAll:m}}const wO="kvenno-language",b3e="is",CO={is:{common:{start:"Byrja",continue:"Halda áfram",next:"Næsta",previous:"Fyrri",submit:"Staðfesta",cancel:"Hætta við",close:"Loka",reset:"Endurstilla",save:"Vista",back:"Til baka",hint:"Vísbending",skip:"Sleppa",retry:"Reyna aftur",correct:"Rétt!",incorrect:"Rangt",excellent:"Frábært!",good:"Gott!",tryAgain:"Reyndu aftur",level:"Stig",score:"Stig",time:"Tími",locked:"Læst",completed:"Lokið"},language:{select:"Tungumál",is:"Íslenska",en:"English",pl:"Polski"},levels:{level1:{name:"Stig 1",description:"Byrjendur"},level2:{name:"Stig 2",description:"Millistig"},level3:{name:"Stig 3",description:"Framhaldsstig"}},feedback:{success:"Vel gert!",error:"Villa kom upp",warning:"Athugaðu betur",progressSaved:"Framvinda vistuð",levelCompleted:"Þú hefur lokið þessu stigi!",gameCompleted:"Til hamingju! Þú hefur lokið leiknum!"},ui:{resetProgress:"Endurstilla framvindu",resetConfirm:"Ertu viss um að þú viljir endurstilla framvinduna?",learningPath:"Námsferillinn",achievements:"Árangur",settings:"Stillingar"}},en:{common:{start:"Start",continue:"Continue",next:"Next",previous:"Previous",submit:"Submit",cancel:"Cancel",close:"Close",reset:"Reset",save:"Save",back:"Back",hint:"Hint",skip:"Skip",retry:"Retry",correct:"Correct!",incorrect:"Incorrect",excellent:"Excellent!",good:"Good!",tryAgain:"Try again",level:"Level",score:"Score",time:"Time",locked:"Locked",completed:"Completed"},language:{select:"Language",is:"Íslenska",en:"English",pl:"Polski"},levels:{level1:{name:"Level 1",description:"Beginner"},level2:{name:"Level 2",description:"Intermediate"},level3:{name:"Level 3",description:"Advanced"}},feedback:{success:"Well done!",error:"An error occurred",warning:"Please review",progressSaved:"Progress saved",levelCompleted:"You have completed this level!",gameCompleted:"Congratulations! You have completed the game!"},ui:{resetProgress:"Reset Progress",resetConfirm:"Are you sure you want to reset all progress?",learningPath:"Learning Path",achievements:"Achievements",settings:"Settings"}},pl:{common:{start:"Rozpocznij",continue:"Kontynuuj",next:"Następny",previous:"Poprzedni",submit:"Zatwierdź",cancel:"Anuluj",close:"Zamknij",reset:"Resetuj",save:"Zapisz",back:"Wstecz",hint:"Wskazówka",skip:"Pomiń",retry:"Spróbuj ponownie",correct:"Prawidłowo!",incorrect:"Nieprawidłowo",excellent:"Doskonale!",good:"Dobrze!",tryAgain:"Spróbuj ponownie",level:"Poziom",score:"Wynik",time:"Czas",locked:"Zablokowany",completed:"Ukończony"},language:{select:"Język",is:"Íslenska",en:"English",pl:"Polski"},levels:{level1:{name:"Poziom 1",description:"Początkujący"},level2:{name:"Poziom 2",description:"Średniozaawansowany"},level3:{name:"Poziom 3",description:"Zaawansowany"}},feedback:{success:"Dobrze wykonane!",error:"Wystąpił błąd",warning:"Proszę przejrzeć",progressSaved:"Postęp zapisany",levelCompleted:"Ukończyłeś ten poziom!",gameCompleted:"Gratulacje! Ukończyłeś grę!"},ui:{resetProgress:"Resetuj postęp",resetConfirm:"Czy na pewno chcesz zresetować cały postęp?",learningPath:"Ścieżka nauki",achievements:"Osiągnięcia",settings:"Ustawienia"}}};function X5(i,e){const t={...i};for(const n of Object.keys(e))typeof e[n]=="object"&&e[n]!==null&&typeof i[n]=="object"&&i[n]!==null?t[n]=X5(i[n],e[n]):t[n]=e[n];return t}function TO(i,e){const t=e.split(".");let n=i;for(const r of t)if(n&&typeof n=="object"&&r in n)n=n[r];else return;return typeof n=="string"?n:void 0}function I3e(i={}){const{gameTranslations:e}=i,[t,n]=C.useState(()=>{try{const a=localStorage.getItem(wO);if(a&&["is","en","pl"].includes(a))return a}catch{}return b3e}),r=C.useMemo(()=>{const a=CO[t];if(!e)return a;const l=e[t]||e.is;return X5(a,l)},[t,e]),s=C.useCallback(a=>{n(a);try{localStorage.setItem(wO,a)}catch{}},[]);return{t:C.useCallback((a,l)=>{const c=TO(r,a);if(c!==void 0)return c;if(t!=="is"&&e){const u=X5(CO.is,e.is),h=TO(u,a);if(h!==void 0)return h}return l||a},[r,t,e]),language:t,setLanguage:s,availableLanguages:["is","en","pl"]}}const M3e={is:{game:{title:"VSEPR Rúmfræði",subtitle:"Kvennaskólinn - Efnafræði 2. ár",description:"Lærðu um lögun sameinda og VSEPR kenninguna"},intro:{title:"Hvað er VSEPR?",description:"VSEPR (Valence Shell Electron Pair Repulsion) útskýrir hvernig rafeindasvæði í kringum miðatóm fælast frá hvor öðru og mynda mismunandi lögun sameinda."},levels:{level1:{name:"Stig 1: Grunnlögun",description:"Lærðu undirstöðulögunina",details:"Kynntu þér línulega, hornrétta, þríhliða og fjórhliða lögun."},level2:{name:"Stig 2: Stakeindir",description:"Stakeindir breyta lögun",details:"Sjáðu hvernig stakeindarapör hafa áhrif á sameindalögun.",locked:"Ljúktu stigi 1 fyrst"},level3:{name:"Stig 3: Bindishorn",description:"Spáðu bindishornum",details:"Reiknaðu og spáðu bindishornum milli atóma.",locked:"Ljúktu stigi 2 fyrst"}},geometry:{linear:"Línuleg",bentShape:"Hornrétt",trigonalPlanar:"Þríhliða slétt",trigonalPyramidal:"Þríhliða pýramída",tetrahedral:"Fjórhliða",trigonalBipyramidal:"Þríhliða tvípýramída",octahedral:"Áttflötungur",seesawShape:"Vippu",tShape:"T-lögun",squarePlanar:"Ferningur slétt",squarePyramidal:"Fernings pýramída"},bondAngles:{title:"Bindishorn",degrees:"gráður"},progress:{title:"Framvinda",levelsCompleted:"Stig lokið",totalScore:"Heildar stig",gamesPlayed:"Leikir spilaðir",reset:"Endurstilla"}},en:{game:{title:"VSEPR Geometry",subtitle:"Kvennaskólinn - Chemistry Year 2",description:"Learn about molecular shapes and VSEPR theory"},intro:{title:"What is VSEPR?",description:"VSEPR (Valence Shell Electron Pair Repulsion) explains how electron regions around a central atom repel each other and form different molecular shapes."},levels:{level1:{name:"Level 1: Basic Shapes",description:"Learn the fundamental shapes",details:"Get familiar with linear, bent, trigonal and tetrahedral shapes."},level2:{name:"Level 2: Lone Pairs",description:"Lone pairs change shapes",details:"See how lone pairs affect molecular geometry.",locked:"Complete level 1 first"},level3:{name:"Level 3: Bond Angles",description:"Predict bond angles",details:"Calculate and predict bond angles between atoms.",locked:"Complete level 2 first"}},geometry:{linear:"Linear",bentShape:"Bent",trigonalPlanar:"Trigonal planar",trigonalPyramidal:"Trigonal pyramidal",tetrahedral:"Tetrahedral",trigonalBipyramidal:"Trigonal bipyramidal",octahedral:"Octahedral",seesawShape:"Seesaw",tShape:"T-shaped",squarePlanar:"Square planar",squarePyramidal:"Square pyramidal"},bondAngles:{title:"Bond Angles",degrees:"degrees"},progress:{title:"Progress",levelsCompleted:"Levels completed",totalScore:"Total score",gamesPlayed:"Games played",reset:"Reset"}},pl:{game:{title:"Geometria VSEPR",subtitle:"Kvennaskólinn - Chemia rok 2",description:"Poznaj ksztalty czastek i teorie VSEPR"},intro:{title:"Czym jest VSEPR?",description:"VSEPR (Valence Shell Electron Pair Repulsion) wyjasnia jak obszary elektronowe wokol atomu centralnego odpychaja sie nawzajem i tworza rozne ksztalty czastek."},levels:{level1:{name:"Poziom 1: Podstawowe ksztalty",description:"Poznaj podstawowe ksztalty",details:"Zapoznaj sie z ksztaltem liniowym, katowym, trojkatnym i tetraedrycznym."},level2:{name:"Poziom 2: Wolne pary",description:"Wolne pary zmieniaja ksztalt",details:"Zobacz jak wolne pary wplywaja na geometrie czasteczki.",locked:"Najpierw ukoncz poziom 1"},level3:{name:"Poziom 3: Katy wiazania",description:"Przewiduj katy wiazania",details:"Obliczaj i przewiduj katy wiazania miedzy atomami.",locked:"Najpierw ukoncz poziom 2"}},geometry:{linear:"Liniowy",bentShape:"Katowy",trigonalPlanar:"Trojkatny plaski",trigonalPyramidal:"Trojkatny piramidalny",tetrahedral:"Tetraedryczny",trigonalBipyramidal:"Trojkatny dwupiramidalny",octahedral:"Oktaedryczny",seesawShape:"Hustawka",tShape:"Ksztalt T",squarePlanar:"Kwadratowy plaski",squarePyramidal:"Kwadratowy piramidalny"},bondAngles:{title:"Katy wiazania",degrees:"stopni"},progress:{title:"Postep",levelsCompleted:"Ukonczone poziomy",totalScore:"Calkowity wynik",gamesPlayed:"Rozegrane gry",reset:"Resetuj"}}},PW="vsepr-geometry-progress";function R3e(){const i=localStorage.getItem(PW);if(i)try{return JSON.parse(i)}catch{return q5()}return q5()}function q5(){return{level1Completed:!1,level1Score:0,level2Completed:!1,level2Score:0,level3Completed:!1,level3Score:0,totalGamesPlayed:0}}function bO(i){localStorage.setItem(PW,JSON.stringify(i))}function P3e(){const[i,e]=C.useState("menu"),{language:t,setLanguage:n}=I3e({gameTranslations:M3e}),[r,s]=C.useState(R3e),[o,a]=C.useState(!1),{achievements:l,allAchievements:c,notifications:u,trackCorrectAnswer:h,trackIncorrectAnswer:f,trackLevelComplete:d,trackGameComplete:m,dismissNotification:y,resetAll:g}=T3e({gameId:"vsepr-geometry"});C.useEffect(()=>{bO(r)},[r]);const A=(M,L,P)=>{s(R=>({...R,level1Completed:!0,level1Score:Math.max(R.level1Score,M),totalGamesPlayed:R.totalGamesPlayed+1})),d(1,M,L,{hintsUsed:P}),e("menu")},E=(M,L,P)=>{s(R=>({...R,level2Completed:!0,level2Score:Math.max(R.level2Score,M),totalGamesPlayed:R.totalGamesPlayed+1})),d(2,M,L,{hintsUsed:P}),e("menu")},x=(M,L,P)=>{s(R=>({...R,level3Completed:!0,level3Score:Math.max(R.level3Score,M),totalGamesPlayed:R.totalGamesPlayed+1})),d(3,M,L,{hintsUsed:P}),m(),e("complete")},w=()=>{const M=q5();s(M),bO(M)};if(i==="level1")return N.jsxs(N.Fragment,{children:[N.jsx(_3e,{onComplete:A,onBack:()=>e("menu"),onCorrectAnswer:()=>h(),onIncorrectAnswer:()=>f()}),N.jsx(T3,{notifications:u,onDismiss:y})]});if(i==="level2")return N.jsxs(N.Fragment,{children:[N.jsx(w3e,{onComplete:E,onBack:()=>e("menu"),onCorrectAnswer:()=>h(),onIncorrectAnswer:()=>f()}),N.jsx(T3,{notifications:u,onDismiss:y})]});if(i==="level3")return N.jsxs(N.Fragment,{children:[N.jsx(C3e,{onComplete:x,onBack:()=>e("menu"),onCorrectAnswer:()=>h(),onIncorrectAnswer:()=>f()}),N.jsx(T3,{notifications:u,onDismiss:y})]});if(i==="complete"){const M=r.level1Score+r.level2Score+r.level3Score;return N.jsx("div",{className:"min-h-screen bg-gradient-to-br from-teal-50 to-cyan-100 p-4 md:p-8",children:N.jsxs("div",{className:"max-w-2xl mx-auto bg-white rounded-2xl shadow-2xl p-6 md:p-8",children:[N.jsx("h1",{className:"text-3xl md:text-4xl font-bold text-center mb-6 text-teal-600",children:"Til hamingju!"}),N.jsxs("div",{className:"text-center mb-8",children:[N.jsx("div",{className:"text-6xl mb-4",children:"🏆"}),N.jsx("div",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Þú hefur lokið öllum stigum!"})]}),N.jsxs("div",{className:"space-y-4 mb-8",children:[N.jsxs("div",{className:"bg-blue-50 p-4 rounded-xl flex justify-between items-center",children:[N.jsxs("div",{children:[N.jsx("div",{className:"font-bold text-blue-800",children:"Stig 1: VSEPR Kenning"}),N.jsx("div",{className:"text-sm text-blue-600",children:"Lögun og rafeinasvið"})]}),N.jsx("div",{className:"text-2xl font-bold text-blue-600",children:r.level1Score})]}),N.jsxs("div",{className:"bg-green-50 p-4 rounded-xl flex justify-between items-center",children:[N.jsxs("div",{children:[N.jsx("div",{className:"font-bold text-green-800",children:"Stig 2: Spá fyrir um lögun"}),N.jsx("div",{className:"text-sm text-green-600",children:"Frá Lewis til rúmfræði"})]}),N.jsx("div",{className:"text-2xl font-bold text-green-600",children:r.level2Score})]}),N.jsxs("div",{className:"bg-purple-50 p-4 rounded-xl flex justify-between items-center",children:[N.jsxs("div",{children:[N.jsx("div",{className:"font-bold text-purple-800",children:"Stig 3: Blendni og skautun"}),N.jsx("div",{className:"text-sm text-purple-600",children:"Flókin sameindir"})]}),N.jsx("div",{className:"text-2xl font-bold text-purple-600",children:r.level3Score})]}),N.jsxs("div",{className:"bg-teal-100 p-4 rounded-xl flex justify-between items-center border-2 border-teal-400",children:[N.jsx("div",{className:"font-bold text-teal-800 text-lg",children:"Heildarstig"}),N.jsx("div",{className:"text-3xl font-bold text-teal-600",children:M})]})]}),N.jsxs("div",{className:"bg-teal-50 p-6 rounded-xl mb-6",children:[N.jsx("h2",{className:"font-bold text-teal-800 mb-3",children:"Hvað lærðir þú?"}),N.jsxs("ul",{className:"space-y-2 text-teal-900 text-sm",children:[N.jsxs("li",{children:["✓ ",N.jsx("strong",{children:"VSEPR:"})," Rafeindasvið hrinda hvert öðru frá — ákvarðar lögun"]}),N.jsxs("li",{children:["✓ ",N.jsx("strong",{children:"Rafeinasvið:"})," Bindandi pör + einstæð pör = rafeinasvið"]}),N.jsxs("li",{children:["✓ ",N.jsx("strong",{children:"Sameindarlögun:"}),' Einstæð pör „fela sig" en hafa áhrif á horn']}),N.jsxs("li",{children:["✓ ",N.jsx("strong",{children:"Blendni:"})," sp (línuleg), sp² (þríhyrnd), sp³ (fjórflötungur)..."]}),N.jsxs("li",{children:["✓ ",N.jsx("strong",{children:"Skautun:"})," Ósamhverf lögun = sameind skautuð"]})]})]}),N.jsx("button",{onClick:()=>e("menu"),className:"w-full bg-teal-500 hover:bg-teal-600 text-white font-bold py-4 px-6 rounded-xl transition-colors",children:"Til baka í valmynd"})]})})}const T=r.level1Score+r.level2Score+r.level3Score,I=[r.level1Completed,r.level2Completed,r.level3Completed].filter(Boolean).length;return N.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-teal-50 to-cyan-100 p-4 md:p-8",children:[N.jsxs("div",{className:"max-w-3xl mx-auto bg-white rounded-2xl shadow-2xl p-6 md:p-8",children:[N.jsxs("div",{className:"flex justify-between items-start mb-4",children:[N.jsx("div",{className:"flex-1"}),N.jsx("h1",{className:"text-3xl md:text-4xl font-bold text-center text-teal-600 flex-1",children:"VSEPR Rumfraedi"}),N.jsxs("div",{className:"flex-1 flex justify-end items-center gap-2",children:[N.jsx(y3e,{language:t,onLanguageChange:n,variant:"compact"}),N.jsx(p$,{achievements:l,onClick:()=>a(!0)})]})]}),N.jsx("p",{className:"text-center text-gray-600 mb-8",children:"Laerdu ad spa fyrir um logun sameinda"}),N.jsxs("div",{className:"bg-teal-50 p-6 rounded-xl mb-8",children:[N.jsx("h2",{className:"font-bold text-teal-800 mb-3",children:"Hvað er VSEPR?"}),N.jsxs("p",{className:"text-teal-900 text-sm mb-4",children:[N.jsx("strong",{children:"VSEPR"})," (Valence Shell Electron Pair Repulsion) segir að rafeindasvið í ystu skel miðatóms ",N.jsx("em",{children:"hrindi hvert öðru frá"})," og staðsetji sig eins langt í sundur og hægt er. Þetta ákvarðar lögun sameindarinnar."]}),N.jsx("div",{className:"bg-white p-3 rounded-lg border border-teal-200",children:N.jsx("p",{className:"text-sm text-teal-800 font-mono text-center",children:"Rafeinasvið = Bindandi pör + Einstæð pör"})})]}),N.jsxs("div",{className:"space-y-4",children:[N.jsx("button",{onClick:()=>e("level1"),className:"w-full p-6 rounded-xl border-4 border-blue-400 bg-blue-50 hover:bg-blue-100 transition-all text-left",children:N.jsxs("div",{className:"flex items-center gap-4",children:[N.jsx("div",{className:"text-4xl",children:"🔮"}),N.jsxs("div",{className:"flex-1",children:[N.jsxs("div",{className:"flex items-center gap-2",children:[N.jsx("span",{className:"text-xl font-bold text-blue-800",children:"Stig 1: VSEPR Kenning"}),r.level1Completed&&N.jsxs("span",{className:"bg-green-500 text-white text-xs px-2 py-1 rounded-full",children:["✓ ",r.level1Score," stig"]})]}),N.jsx("div",{className:"text-sm text-blue-600 mt-1",children:"Kynntu þér mismunandi sameindarlögun"}),N.jsx("div",{className:"text-xs text-gray-600 mt-2",children:"Sjáðu hvernig rafeinasvið hrinda hvert öðru og mynda mismunandi rúmfræði."})]})]})}),N.jsx("button",{onClick:()=>r.level1Completed&&e("level2"),className:`w-full p-6 rounded-xl border-4 transition-all text-left ${r.level1Completed?"border-green-400 bg-green-50 hover:bg-green-100 cursor-pointer":"border-gray-200 bg-gray-50 opacity-60 cursor-not-allowed"}`,children:N.jsxs("div",{className:"flex items-center gap-4",children:[N.jsx("div",{className:"text-4xl",children:"🧩"}),N.jsxs("div",{className:"flex-1",children:[N.jsxs("div",{className:"flex items-center gap-2",children:[N.jsx("span",{className:`text-xl font-bold ${r.level1Completed?"text-green-800":"text-gray-600"}`,children:"Stig 2: Spá fyrir um lögun"}),r.level2Completed&&N.jsxs("span",{className:"bg-green-500 text-white text-xs px-2 py-1 rounded-full",children:["✓ ",r.level2Score," stig"]}),!r.level1Completed&&N.jsx("span",{className:"text-xs text-gray-500",children:"(Ljúktu stigi 1 fyrst)"})]}),N.jsx("div",{className:`text-sm mt-1 ${r.level1Completed?"text-green-600":"text-gray-500"}`,children:"Ákvarðaðu lögun út frá Lewis-formúlu"}),N.jsx("div",{className:"text-xs text-gray-600 mt-2",children:"Teldu rafeinasvið og spáðu fyrir um sameindarlögun og tengihorn."})]})]})}),N.jsx("button",{onClick:()=>r.level2Completed&&e("level3"),className:`w-full p-6 rounded-xl border-4 transition-all text-left ${r.level2Completed?"border-purple-400 bg-purple-50 hover:bg-purple-100 cursor-pointer":"border-gray-200 bg-gray-50 opacity-60 cursor-not-allowed"}`,children:N.jsxs("div",{className:"flex items-center gap-4",children:[N.jsx("div",{className:"text-4xl",children:"⚗️"}),N.jsxs("div",{className:"flex-1",children:[N.jsxs("div",{className:"flex items-center gap-2",children:[N.jsx("span",{className:`text-xl font-bold ${r.level2Completed?"text-purple-800":"text-gray-600"}`,children:"Stig 3: Blendni og skautun"}),r.level3Completed&&N.jsxs("span",{className:"bg-green-500 text-white text-xs px-2 py-1 rounded-full",children:["✓ ",r.level3Score," stig"]}),!r.level2Completed&&N.jsx("span",{className:"text-xs text-gray-500",children:"(Ljúktu stigi 2 fyrst)"})]}),N.jsx("div",{className:`text-sm mt-1 ${r.level2Completed?"text-purple-600":"text-gray-500"}`,children:"Ákvarðaðu blendni og hvort sameind sé skautuð"}),N.jsx("div",{className:"text-xs text-gray-600 mt-2",children:"Flóknari sameindir með mörgum miðatómum og tvískautsvægi."})]})]})})]}),r.totalGamesPlayed>0&&N.jsxs("div",{className:"mt-8 bg-gray-50 p-4 rounded-xl",children:[N.jsxs("div",{className:"flex justify-between items-center mb-3",children:[N.jsx("h3",{className:"font-semibold text-gray-700",children:"Framvinda"}),N.jsx("button",{onClick:w,className:"text-sm text-gray-500 hover:text-red-500 transition-colors",children:"Endurstilla"})]}),N.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center",children:[N.jsxs("div",{className:"bg-teal-50 rounded-lg p-3",children:[N.jsxs("div",{className:"text-2xl font-bold text-teal-600",children:[I,"/3"]}),N.jsx("div",{className:"text-xs text-gray-600",children:"Stig lokið"})]}),N.jsxs("div",{className:"bg-green-50 rounded-lg p-3",children:[N.jsx("div",{className:"text-2xl font-bold text-green-600",children:T}),N.jsx("div",{className:"text-xs text-gray-600",children:"Heildar stig"})]}),N.jsxs("div",{className:"bg-blue-50 rounded-lg p-3",children:[N.jsx("div",{className:"text-2xl font-bold text-blue-600",children:r.totalGamesPlayed}),N.jsx("div",{className:"text-xs text-gray-600",children:"Leikir spilaðir"})]})]})]}),N.jsxs("div",{className:"mt-6 bg-gray-50 p-4 rounded-xl",children:[N.jsx("h3",{className:"font-semibold text-gray-700 mb-3",children:"📐 Algengar sameindarlögun"}),N.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2 text-sm",children:[N.jsxs("div",{className:"bg-white p-2 rounded border text-center",children:[N.jsx("div",{className:"text-lg mb-1",children:"—"}),N.jsx("div",{className:"font-bold text-gray-800",children:"Línuleg"}),N.jsx("div",{className:"text-xs text-gray-500",children:"180°"})]}),N.jsxs("div",{className:"bg-white p-2 rounded border text-center",children:[N.jsx("div",{className:"text-lg mb-1",children:"△"}),N.jsx("div",{className:"font-bold text-gray-800",children:"Þríhyrnd"}),N.jsx("div",{className:"text-xs text-gray-500",children:"120°"})]}),N.jsxs("div",{className:"bg-white p-2 rounded border text-center",children:[N.jsx("div",{className:"text-lg mb-1",children:"◇"}),N.jsx("div",{className:"font-bold text-gray-800",children:"Fjórflötungur"}),N.jsx("div",{className:"text-xs text-gray-500",children:"109.5°"})]}),N.jsxs("div",{className:"bg-white p-2 rounded border text-center",children:[N.jsx("div",{className:"text-lg mb-1",children:"∠"}),N.jsx("div",{className:"font-bold text-gray-800",children:"Beygð"}),N.jsx("div",{className:"text-xs text-gray-500",children:"<109.5°"})]})]})]}),N.jsx("div",{className:"mt-6 text-center text-xs text-gray-500",children:"Kafli 9 — Chemistry: The Central Science (Brown et al.)"})]}),o&&N.jsx(d$,{achievements:l,allAchievements:c,onClose:()=>a(!1),onReset:g}),N.jsx(T3,{notifications:u,onDismiss:y})]})}s$.createRoot(document.getElementById("root")).render(N.jsx(bl.StrictMode,{children:N.jsx(P3e,{})}));var a0=typeof self<"u"?self:{};function tw(i,e){e:{for(var t=["CLOSURE_FLAGS"],n=a0,r=0;r<t.length;r++)if((n=n[t[r]])==null){t=null;break e}t=n}return(i=t&&t[i])!=null?i:e}function Sm(){throw Error("Invalid UTF8")}function IO(i,e){return e=String.fromCharCode.apply(null,e),i==null?e:i+e}let O_,HI;const L3e=typeof TextDecoder<"u";let B3e;const D3e=typeof TextEncoder<"u";function LW(i){if(D3e)i=(B3e||(B3e=new TextEncoder)).encode(i);else{let t=0;const n=new Uint8Array(3*i.length);for(let r=0;r<i.length;r++){var e=i.charCodeAt(r);if(e<128)n[t++]=e;else{if(e<2048)n[t++]=e>>6|192;else{if(e>=55296&&e<=57343){if(e<=56319&&r<i.length){const s=i.charCodeAt(++r);if(s>=56320&&s<=57343){e=1024*(e-55296)+s-56320+65536,n[t++]=e>>18|240,n[t++]=e>>12&63|128,n[t++]=e>>6&63|128,n[t++]=63&e|128;continue}r--}e=65533}n[t++]=e>>12|224,n[t++]=e>>6&63|128}n[t++]=63&e|128}}i=t===n.length?n:n.subarray(0,t)}return i}var J2,BW=tw(610401301,!1),k3e=tw(653718497,tw(1,!0)),DW=tw(660014094,!1);const MO=a0.navigator;function J5(i){return!!BW&&!!J2&&J2.brands.some((({brand:e})=>e&&e.indexOf(i)!=-1))}function lc(i){var e;return(e=a0.navigator)&&(e=e.userAgent)||(e=""),e.indexOf(i)!=-1}function Ud(){return!!BW&&!!J2&&J2.brands.length>0}function QI(){return Ud()?J5("Chromium"):(lc("Chrome")||lc("CriOS"))&&!(!Ud()&&lc("Edge"))||lc("Silk")}function _8(i){return _8[" "](i),i}J2=MO&&MO.userAgentData||null,_8[" "]=function(){};var F3e=!Ud()&&(lc("Trident")||lc("MSIE"));!lc("Android")||QI(),QI(),lc("Safari")&&(QI()||!Ud()&&lc("Coast")||!Ud()&&lc("Opera")||!Ud()&&lc("Edge")||(Ud()?J5("Microsoft Edge"):lc("Edg/"))||Ud()&&J5("Opera"));var kW={},jv=null;function O3e(i){var e=i.length,t=3*e/4;t%3?t=Math.floor(t):"=.".indexOf(i[e-1])!=-1&&(t="=.".indexOf(i[e-2])!=-1?t-2:t-1);var n=new Uint8Array(t),r=0;return(function(s,o){function a(d){for(;l<s.length;){var m=s.charAt(l++),y=jv[m];if(y!=null)return y;if(!/^[\s\xa0]*$/.test(m))throw Error("Unknown base64 encoding at char: "+m)}return d}FW();for(var l=0;;){var c=a(-1),u=a(0),h=a(64),f=a(64);if(f===64&&c===-1)break;o(c<<2|u>>4),h!=64&&(o(u<<4&240|h>>2),f!=64&&o(h<<6&192|f))}})(i,(function(s){n[r++]=s})),r!==t?n.subarray(0,r):n}function FW(){if(!jv){jv={};for(var i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".split(""),e=["+/=","+/","-_=","-_.","-_"],t=0;t<5;t++){var n=i.concat(e[t].split(""));kW[t]=n;for(var r=0;r<n.length;r++){var s=n[r];jv[s]===void 0&&(jv[s]=r)}}}}var OW=typeof Uint8Array<"u",NW=!F3e&&typeof btoa=="function";function RO(i){if(!NW){var e;e===void 0&&(e=0),FW(),e=kW[e];var t=Array(Math.floor(i.length/3)),n=e[64]||"";let l=0,c=0;for(;l<i.length-2;l+=3){var r=i[l],s=i[l+1],o=i[l+2],a=e[r>>2];r=e[(3&r)<<4|s>>4],s=e[(15&s)<<2|o>>6],o=e[63&o],t[c++]=a+r+s+o}switch(a=0,o=n,i.length-l){case 2:o=e[(15&(a=i[l+1]))<<2]||n;case 1:i=i[l],t[c]=e[i>>2]+e[(3&i)<<4|a>>4]+o+n}return t.join("")}for(e="",t=0,n=i.length-10240;t<n;)e+=String.fromCharCode.apply(null,i.subarray(t,t+=10240));return e+=String.fromCharCode.apply(null,t?i.subarray(t):i),btoa(e)}const PO=/[-_.]/g,N3e={"-":"+",_:"/",".":"="};function U3e(i){return N3e[i]||""}function UW(i){if(!NW)return O3e(i);PO.test(i)&&(i=i.replace(PO,U3e)),i=atob(i);const e=new Uint8Array(i.length);for(let t=0;t<i.length;t++)e[t]=i.charCodeAt(t);return e}function Mx(i){return OW&&i!=null&&i instanceof Uint8Array}var dA={};let z3e;function zW(i){if(i!==dA)throw Error("illegal external caller")}function l0(){return z3e||(z3e=new kf(null,dA))}function S8(i){zW(dA);var e=i.ba;return(e=e==null||Mx(e)?e:typeof e=="string"?UW(e):null)==null?e:i.ba=e}var kf=class{constructor(i,e){if(zW(e),this.ba=i,i!=null&&i.length===0)throw Error("ByteString should be constructed with non-empty values")}ua(){return new Uint8Array(S8(this)||0)}};function GW(i,e){i.__closure__error__context__984382||(i.__closure__error__context__984382={}),i.__closure__error__context__984382.severity=e}let G3e;function c0(){const i=Error();GW(i,"incident"),(function(e){a0.setTimeout((()=>{throw e}),0)})(i)}function Z5(i){return GW(i=Error(i),"warning"),i}function w8(){return typeof BigInt=="function"}function kl(i){return Array.prototype.slice.call(i)}var BA=typeof Symbol=="function"&&typeof Symbol()=="symbol";function k4(i){return typeof Symbol=="function"&&typeof Symbol()=="symbol"?Symbol():i}var Rx=k4(),LO=k4("0di"),VI=k4("2ex"),Dv=k4("1oa"),F4=BA?(i,e)=>{i[Rx]|=e}:(i,e)=>{i.G!==void 0?i.G|=e:Object.defineProperties(i,{G:{value:e,configurable:!0,writable:!0,enumerable:!1}})},nw=BA?(i,e)=>{i[Rx]&=~e}:(i,e)=>{i.G!==void 0&&(i.G&=~e)},xs=BA?i=>0|i[Rx]:i=>0|i.G,Ui=BA?i=>i[Rx]:i=>i.G,Wr=BA?(i,e)=>{i[Rx]=e}:(i,e)=>{i.G!==void 0?i.G=e:Object.defineProperties(i,{G:{value:e,configurable:!0,writable:!0,enumerable:!1}})};function DA(i){return F4(i,34),i}function H3e(i,e){Wr(e,-14591&(0|i))}function e6(i,e){Wr(e,-14557&(34|i))}var C8,Px={},HW={};function BO(i){return!(!i||typeof i!="object"||i.La!==HW)}function O4(i){return i!==null&&typeof i=="object"&&!Array.isArray(i)&&i.constructor===Object}function T8(i,e,t){if(i!=null){if(typeof i=="string")i=i?new kf(i,dA):l0();else if(i.constructor!==kf)if(Mx(i))i=i.length?new kf(t?i:new Uint8Array(i),dA):l0();else{if(!e)throw Error();i=void 0}}return i}function iw(i){return!(!Array.isArray(i)||i.length)&&!!(1&xs(i))}const DO=[];function Hf(i){if(2&i)throw Error()}Wr(DO,55),C8=Object.freeze(DO);class rw{constructor(e,t,n){this.l=0,this.g=e,this.h=t,this.m=n}next(){if(this.l<this.g.length){const e=this.g[this.l++];return{done:!1,value:this.h?this.h.call(this.m,e):e}}return{done:!0,value:void 0}}[Symbol.iterator](){return new rw(this.g,this.h,this.m)}}let ep;function QW(i,e){(e=ep?e[ep]:void 0)&&(i[ep]=kl(e))}var Q3e=Object.freeze({}),V3e=Object.freeze({});function N4(i){return i.Sa=!0,i}var j3e=N4((i=>typeof i=="number")),kO=N4((i=>typeof i=="string")),W3e=N4((i=>typeof i=="boolean")),U4=typeof a0.BigInt=="function"&&typeof a0.BigInt(0)=="bigint",t6=N4((i=>U4?i>=Y3e&&i<=X3e:i[0]==="-"?FO(i,K3e):FO(i,$3e)));const K3e=Number.MIN_SAFE_INTEGER.toString(),Y3e=U4?BigInt(Number.MIN_SAFE_INTEGER):void 0,$3e=Number.MAX_SAFE_INTEGER.toString(),X3e=U4?BigInt(Number.MAX_SAFE_INTEGER):void 0;function FO(i,e){if(i.length>e.length)return!1;if(i.length<e.length||i===e)return!0;for(let t=0;t<i.length;t++){const n=i[t],r=e[t];if(n>r)return!1;if(n<r)return!0}}const q3e=typeof Uint8Array.prototype.slice=="function";let VW,or=0,is=0;function OO(i){const e=i>>>0;or=e,is=(i-e)/4294967296>>>0}function pA(i){if(i<0){OO(-i);const[e,t]=R8(or,is);or=e>>>0,is=t>>>0}else OO(i)}function b8(i){const e=VW||(VW=new DataView(new ArrayBuffer(8)));e.setFloat32(0,+i,!0),is=0,or=e.getUint32(0,!0)}function I8(i,e){return 4294967296*e+(i>>>0)}function M8(i,e){const t=2147483648&e;return t&&(e=~e>>>0,(i=1+~i>>>0)==0&&(e=e+1>>>0)),i=I8(i,e),t?-i:i}function sw(i,e){if(i>>>=0,(e>>>=0)<=2097151)var t=""+(4294967296*e+i);else w8()?t=""+(BigInt(e)<<BigInt(32)|BigInt(i)):(i=(16777215&i)+6777216*(t=16777215&(i>>>24|e<<8))+6710656*(e=e>>16&65535),t+=8147497*e,e*=2,i>=1e7&&(t+=i/1e7>>>0,i%=1e7),t>=1e7&&(e+=t/1e7>>>0,t%=1e7),t=e+NO(t)+NO(i));return t}function NO(i){return i=String(i),"0000000".slice(i.length)+i}function z4(i){if(i.length<16)pA(Number(i));else if(w8())i=BigInt(i),or=Number(i&BigInt(4294967295))>>>0,is=Number(i>>BigInt(32)&BigInt(4294967295));else{const e=+(i[0]==="-");is=or=0;const t=i.length;for(let n=e,r=(t-e)%6+e;r<=t;n=r,r+=6){const s=Number(i.slice(n,r));is*=1e6,or=1e6*or+s,or>=4294967296&&(is+=Math.trunc(or/4294967296),is>>>=0,or>>>=0)}if(e){const[n,r]=R8(or,is);or=n,is=r}}}function R8(i,e){return e=~e,i?i=1+~i:e+=1,[i,e]}function Ep(i){return i==null||typeof i=="number"?i:i==="NaN"||i==="Infinity"||i==="-Infinity"?Number(i):void 0}function jW(i){return i==null||typeof i=="boolean"?i:typeof i=="number"?!!i:void 0}const J3e=/^-?([1-9][0-9]*|0)(\.[0-9]+)?$/;function G4(i){const e=typeof i;switch(e){case"bigint":return!0;case"number":return Number.isFinite(i)}return e==="string"&&J3e.test(i)}function kA(i){if(i==null)return i;if(typeof i=="string"){if(!i)return;i=+i}return typeof i=="number"&&Number.isFinite(i)?0|i:void 0}function Z3e(i){if(i==null)return i;if(typeof i=="string"){if(!i)return;i=+i}return typeof i=="number"&&Number.isFinite(i)?i>>>0:void 0}function UO(i){return i[0]!=="-"&&(i.length<20||i.length===20&&Number(i.substring(0,6))<184467)}function P8(i){return i=Math.trunc(i),Number.isSafeInteger(i)||(pA(i),i=M8(or,is)),i}function L8(i){var e=Math.trunc(Number(i));if(Number.isSafeInteger(e))return String(e);if((e=i.indexOf("."))!==-1&&(i=i.substring(0,e)),!(i[0]==="-"?i.length<20||i.length===20&&Number(i.substring(0,7))>-922337:i.length<19||i.length===19&&Number(i.substring(0,6))<922337))if(z4(i),i=or,2147483648&(e=is))if(w8())i=""+(BigInt(0|e)<<BigInt(32)|BigInt(i>>>0));else{const[t,n]=R8(i,e);i="-"+sw(t,n)}else i=sw(i,e);return i}function ow(i){return i==null?i:typeof i=="bigint"?(t6(i)?i=Number(i):(i=BigInt.asIntN(64,i),i=t6(i)?Number(i):String(i)),i):G4(i)?typeof i=="number"?P8(i):L8(i):void 0}function eEe(i){if(i==null)return i;var e=typeof i;if(e==="bigint")return String(BigInt.asUintN(64,i));if(G4(i)){if(e==="string")return e=Math.trunc(Number(i)),Number.isSafeInteger(e)&&e>=0?i=String(e):((e=i.indexOf("."))!==-1&&(i=i.substring(0,e)),UO(i)||(z4(i),i=sw(or,is))),i;if(e==="number")return(i=Math.trunc(i))>=0&&Number.isSafeInteger(i)?i:(function(t){if(t<0){pA(t);const n=sw(or,is);return t=Number(n),Number.isSafeInteger(t)?t:n}return UO(String(t))?t:(pA(t),I8(or,is))})(i)}}function WW(i){if(typeof i!="string")throw Error();return i}function FA(i){if(i!=null&&typeof i!="string")throw Error();return i}function tp(i){return i==null||typeof i=="string"?i:void 0}function B8(i,e,t,n){if(i!=null&&typeof i=="object"&&i.Y===Px)return i;if(!Array.isArray(i))return t?2&n?(i=e[LO])?e=i:(DA((i=new e).u),e=e[LO]=i):e=new e:e=void 0,e;let r=t=xs(i);return r===0&&(r|=32&n),r|=2&n,r!==t&&Wr(i,r),new e(i)}function tEe(i,e,t){if(e)e:{if(!G4(e=i))throw Z5("int64");switch(typeof e){case"string":e=L8(e);break e;case"bigint":if(i=e=BigInt.asIntN(64,e),kO(i)){if(!/^\s*(?:-?[1-9]\d*|0)?\s*$/.test(i))throw Error(String(i))}else if(j3e(i)&&!Number.isSafeInteger(i))throw Error(String(i));e=U4?BigInt(e):W3e(e)?e?"1":"0":kO(e)?e.trim()||"0":String(e);break e;default:e=P8(e)}}else e=ow(i);return typeof(t=(i=e)==null?t?0:void 0:i)=="string"&&(e=+t,Number.isSafeInteger(e))?e:t}function KW(i){if(kv===void 0&&(kv=typeof Proxy=="function"?$W(Proxy):null),!kv||!YW())return i;let e=Jo==null?void 0:Jo.get(i);return e||(Math.random()>.01?i:((function(t){if(jI===void 0){const n=new kv([],{});jI=Array.prototype.concat.call([],n).length===1}jI&&typeof Symbol=="function"&&Symbol.isConcatSpreadable&&(t[Symbol.isConcatSpreadable]=!0)})(i),e=new kv(i,{set:(t,n,r)=>(c0(),t[n]=r,!0)}),(function(t,n){(Jo||(Jo=new Km)).set(t,n),(fS||(fS=new Km)).set(n,t)})(i,e),e))}let Jo,fS,kv,Km,jI,Rl,aw,nEe,iEe;function YW(){return Km===void 0&&(Km=typeof WeakMap=="function"?$W(WeakMap):null),Km}function $W(i){try{return i.toString().indexOf("[native code]")!==-1?i:null}catch{return null}}function D8(i,e,t){var o;if(k3e&&YW()){if((o=Rl==null?void 0:Rl.get(e))!=null&&o.get(i)){if(t)return}else if(Math.random()>.01)return;var n=i.length;t={length:n};for(var r=0;r<Math.min(n,10);r++){if(n<=10)var s=r;else{s=n/10;const a=Math.floor(r*s);s=a+Math.floor(Math.random()*(Math.floor((r+1)*s)-a))}t[s]=i[s]}XW(i,t)?((r=(n=Rl||(Rl=new Km)).get(e))||(r=new Km,n.set(e,r)),r.set(i,t)):(c0(),Z2(i,e))}}function lw(i,e){var n;const t=(n=Rl==null?void 0:Rl.get(e))==null?void 0:n.get(i);t&&!XW(i,t)&&(c0(),Z2(i,e))}function XW(i,e){if(i.length!==e.length)return!1;for(const r in e){var t,n=Number(r);if((t=Number.isInteger(n))&&(t=i[n],n=e[n],t=!(Number.isNaN(t)?Number.isNaN(n):t===n)),t)return!1}return!0}function H4(i){if(i&&(Rl!=null&&Rl.has(i))){var e=i.u;if(e)for(let t=0;t<e.length;t++){const n=e[t];if(t===e.length-1&&O4(n))for(const r in n){const s=n[r];Array.isArray(s)&&lw(s,i)}else Array.isArray(n)&&lw(n,i)}}}function Z2(i,e){var t;(t=Rl==null?void 0:Rl.get(e))==null||t.delete(i)}function Ym(i,e){return i=qW(i,e[0],e[1]),F4(i,16384),i}function qW(i,e,t){if(i==null&&(i=aw),aw=void 0,i==null){var n=96;t?(i=[t],n|=512):i=[],e&&(n=-33521665&n|(1023&e)<<15)}else{if(!Array.isArray(i))throw Error("narr");if(2048&(n=xs(i)))throw Error("farr");if(64&n)return i;if(n|=64,t&&(n|=512,t!==i[0]))throw Error("mid");e:{const r=(t=i).length;if(r){const s=r-1;if(O4(t[s])){if((e=s-(+!!(512&(n|=256))-1))>=1024)throw Error("pvtlmt");n=-33521665&n|(1023&e)<<15;break e}}if(e){if((e=Math.max(e,r-(+!!(512&n)-1)))>1024)throw Error("spvt");n=-33521665&n|(1023&e)<<15}}}return Wr(i,n),i}const rEe={};let sEe=(function(){try{return _8(new class extends Map{constructor(){super()}}),!1}catch{return!0}})();class WI{constructor(){this.g=new Map}get(e){return this.g.get(e)}set(e,t){return this.g.set(e,t),this.size=this.g.size,this}delete(e){return e=this.g.delete(e),this.size=this.g.size,e}clear(){this.g.clear(),this.size=this.g.size}has(e){return this.g.has(e)}entries(){return this.g.entries()}keys(){return this.g.keys()}values(){return this.g.values()}forEach(e,t){return this.g.forEach(e,t)}[Symbol.iterator](){return this.entries()}}const oEe=sEe?(Object.setPrototypeOf(WI.prototype,Map.prototype),Object.defineProperties(WI.prototype,{size:{value:0,configurable:!0,enumerable:!0,writable:!0}}),WI):class extends Map{constructor(){super()}};function zO(i){return i}function KI(i){if(2&i.M)throw Error("Cannot mutate an immutable Map")}var yc=class extends oEe{constructor(i,e,t=zO,n=zO){super();let r=xs(i);r|=64,Wr(i,r),this.M=r,this.U=e,this.T=t,this.aa=this.U?aEe:n;for(let s=0;s<i.length;s++){const o=i[s],a=t(o[0],!1,!0);let l=o[1];e?l===void 0&&(l=null):l=n(o[1],!1,!0,void 0,void 0,r),super.set(a,l)}}pa(i=GO){if(this.size!==0)return this.Z(i)}Z(i=GO){const e=[],t=super.entries();for(var n;!(n=t.next()).done;)(n=n.value)[0]=i(n[0]),n[1]=i(n[1]),e.push(n);return e}clear(){KI(this),super.clear()}delete(i){return KI(this),super.delete(this.T(i,!0,!1))}entries(){var i=this.oa();return new rw(i,lEe,this)}keys(){return this.Ka()}values(){var i=this.oa();return new rw(i,yc.prototype.get,this)}forEach(i,e){super.forEach(((t,n)=>{i.call(e,this.get(n),n,this)}))}set(i,e){return KI(this),(i=this.T(i,!0,!1))==null?this:e==null?(super.delete(i),this):super.set(i,this.aa(e,!0,!0,this.U,!1,this.M))}Qa(i){const e=this.T(i[0],!1,!0);i=i[1],i=this.U?i===void 0?null:i:this.aa(i,!1,!0,void 0,!1,this.M),super.set(e,i)}has(i){return super.has(this.T(i,!1,!1))}get(i){i=this.T(i,!1,!1);const e=super.get(i);if(e!==void 0){var t=this.U;return t?((t=this.aa(e,!1,!0,t,this.va,this.M))!==e&&super.set(i,t),t):e}}oa(){return Array.from(super.keys())}Ka(){return super.keys()}[Symbol.iterator](){return this.entries()}};function aEe(i,e,t,n,r,s){return i=B8(i,n,t,s),r&&(i=V4(i)),i}function GO(i){return i}function lEe(i){return[i,this.get(i)]}let cEe;function HO(){return cEe||(cEe=new yc(DA([]),void 0,void 0,void 0,rEe))}function k8(i,e,t,n,r){if(i!=null){if(Array.isArray(i))i=iw(i)?void 0:r&&2&xs(i)?i:Q4(i,e,t,n!==void 0,r);else if(O4(i)){const s={};for(let o in i)s[o]=k8(i[o],e,t,n,r);i=s}else i=e(i,n);return i}}function Q4(i,e,t,n,r){const s=n||t?xs(i):0;n=n?!!(32&s):void 0;const o=kl(i);for(let a=0;a<o.length;a++)o[a]=k8(o[a],e,t,n,r);return t&&(QW(o,i),t(s,o)),o}function uEe(i){return k8(i,F8,void 0,void 0,!1)}function F8(i){return i.Y===Px?i.toJSON():i instanceof yc?i.pa(uEe):(function(e){switch(typeof e){case"number":return isFinite(e)?e:String(e);case"bigint":return t6(e)?Number(e):String(e);case"boolean":return e?1:0;case"object":if(e)if(Array.isArray(e)){if(iw(e))return}else{if(Mx(e))return RO(e);if(e instanceof kf){const t=e.ba;return t==null?"":typeof t=="string"?t:e.ba=RO(t)}if(e instanceof yc)return e.pa()}}return e})(i)}function n6(i,e,t=e6){if(i!=null){if(OW&&i instanceof Uint8Array)return e?i:new Uint8Array(i);if(Array.isArray(i)){var n=xs(i);return 2&n?i:(e&&(e=n===0||!!(32&n)&&!(64&n||!(16&n))),e?(Wr(i,-12293&(34|n)),i):Q4(i,n6,4&n?e6:t,!0,!0))}return i.Y===Px?(t=i.u,i=2&(n=Ui(t))?i:O8(i,t,n,!0)):i instanceof yc&&!(2&i.M)&&(t=DA(i.Z(n6)),i=new yc(t,i.U,i.T,i.aa)),i}}function O8(i,e,t,n){return H4(i),i=i.constructor,aw=e=JW(e,t,n),e=new i(e),aw=void 0,e}function JW(i,e,t){const n=t||2&e?e6:H3e,r=!!(32&e);return i=(function(s,o,a){const l=kl(s);var c=l.length;const u=256&o?l[c-1]:void 0;for(c+=u?-1:0,o=512&o?1:0;o<c;o++)l[o]=a(l[o]);if(u){o=l[o]={};for(const h in u)o[h]=a(u[h])}return QW(l,s),l})(i,e,(s=>n6(s,r,n))),F4(i,32|(t?2:0)),i}function V4(i){const e=i.u,t=Ui(e);return 2&t?O8(i,e,t,!1):i}function ZW(i,e,t,n){return!(4&e)||t!=null}function cp(i,e){return bh(i=i.u,Ui(i),e)}function QO(i,e,t,n){if(!((e=n+(+!!(512&e)-1))<0||e>=i.length||e>=t))return i[e]}function bh(i,e,t,n){if(t===-1)return null;const r=e>>15&1023||536870912;if(!(t>=r)){var s=i.length;return n&&256&e&&(n=i[s-1][t])!=null?(QO(i,e,r,t)&&VI!=null&&((e=(i=G3e??(G3e={}))[VI]||0)>=4||(i[VI]=e+1,c0())),n):QO(i,e,r,t)}return 256&e?i[i.length-1][t]:void 0}function Ar(i,e,t){const n=i.u;let r=Ui(n);return Hf(r),kr(n,r,e,t),i}function kr(i,e,t,n){const r=e>>15&1023||536870912;if(t>=r){let s,o=e;if(256&e)s=i[i.length-1];else{if(n==null)return o;s=i[r+(+!!(512&e)-1)]={},o|=256}return s[t]=n,t<r&&(i[t+(+!!(512&e)-1)]=void 0),o!==e&&Wr(i,o),o}return i[t+(+!!(512&e)-1)]=n,256&e&&t in(i=i[i.length-1])&&delete i[t],e}function OA(i,e,t,n,r){var s=2&e;r=bh(i,e,t,r),Array.isArray(r)||(r=C8);const o=!(2&n);n=!(1&n);const a=!!(32&e);let l=xs(r);return l!==0||!a||s||o?1&l||(l|=1,Wr(r,l)):(l|=33,Wr(r,l)),s?(i=!1,2&l||(DA(r),i=!!(4&l)),(n||i)&&Object.freeze(r)):(s=!!(2&l)||!!(2048&l),n&&s?(r=kl(r),s=1,a&&!o&&(s|=32),Wr(r,s),kr(i,e,t,r)):o&&32&l&&!s&&nw(r,32)),r}function dS(i,e){i=i.u;let t=Ui(i);const n=bh(i,t,e),r=Ep(n);return r!=null&&r!==n&&kr(i,t,e,r),r}function eK(i){i=i.u;let e=Ui(i);const t=bh(i,e,1),n=T8(t,!0,!!(34&e));return n!=null&&n!==t&&kr(i,e,1,n),n}function Om(){return Q3e===void 0?2:5}function Nm(i,e,t,n,r,s){const o=i.u;let a=Ui(o);n=2&a?1:n,s=!!s,r=tK(o,a,e,r);var l=xs(r),c=r;if(lw(c,i),n!==2&&n!==1||Z2(c,i),ZW(i,l,void 0)){4&l&&(r=kl(r),l=u0(l,a),a=kr(o,a,e,r));let h=c=0;for(;c<r.length;c++){const f=t(r[c]);f!=null&&(r[h++]=f)}h<c&&(r.length=h),l=-4097&(20|(l=nK(l,a))),Wr(r,l&=-8193),2&l&&Object.freeze(r)}let u;return n===1||n===4&&32&l?If(l)||(i=l,(l|=2)!==i&&Wr(r,l),Object.freeze(r)):(t=n===5&&(!!(32&l)||If(l)||!!(Jo!=null&&Jo.get(r))),(n===2||t)&&If(l)&&(r=kl(r),l=mA(l=u0(l,a),a,s),Wr(r,l),a=kr(o,a,e,r)),If(l)||(e=l,(l=mA(l,a,s))!==e&&Wr(r,l)),t?(u=KW(r),D8(r,i,!0)):n!==2||s||(Jo==null||Jo.delete(r))),u||r}function tK(i,e,t,n){return i=bh(i,e,t,n),Array.isArray(i)?i:C8}function nK(i,e){return i===0&&(i=u0(i,e)),1|i}function If(i){return!!(2&i)&&!!(4&i)||!!(2048&i)}function iK(i){i=kl(i);for(let e=0;e<i.length;e++){const t=i[e]=kl(i[e]);Array.isArray(t[1])&&(t[1]=DA(t[1]))}return i}function i6(i,e,t,n){i=i.u;let r=Ui(i);Hf(r),kr(i,r,e,(n==="0"?Number(t)===0:t===n)?void 0:t)}function YI(i,e){var t=OK;return U8(N8(i=i.u),i,Ui(i),t)===e?e:-1}function N8(i){if(BA)return i[Dv]??(i[Dv]=new Map);if(Dv in i)return i[Dv];const e=new Map;return Object.defineProperty(i,Dv,{value:e}),e}function rK(i,e,t,n){const r=N8(i),s=U8(r,i,e,t);return s!==n&&(s&&(e=kr(i,e,s)),r.set(t,n)),e}function U8(i,e,t,n){let r=i.get(n);if(r!=null)return r;r=0;for(let s=0;s<n.length;s++){const o=n[s];bh(e,t,o)!=null&&(r!==0&&(t=kr(e,t,r)),r=o)}return i.set(n,r),r}function z8(i,e,t,n){let r,s=Ui(i);if((n=bh(i,s,t,n))!=null&&n.Y===Px)return(e=V4(n))!==n&&kr(i,s,t,e),e.u;if(Array.isArray(n)){const o=xs(n);r=2&o?JW(n,o,!1):n,r=Ym(r,e)}else r=Ym(void 0,e);return r!==n&&kr(i,s,t,r),r}function sK(i,e,t,n){i=i.u;let r=Ui(i);return(e=B8(n=bh(i,r,t,n),e,!1,r))!==n&&e!=null&&kr(i,r,t,e),e}function wi(i,e,t,n=!1){if((e=sK(i,e,t,n))==null)return e;if(i=i.u,!(2&(n=Ui(i)))){const r=V4(e);r!==e&&kr(i,n,t,e=r)}return e}function oK(i,e,t,n,r,s,o){const a=i.u;var l=!!(2&e);r=l?1:r,s=!!s,o&&(o=!l),l=tK(a,e,n);var c=xs(l),u=l;if(lw(u,i),r!==2&&r!==1||Z2(u,i),!(u=!!(4&c))){var h=l,f=e;const m=!!(2&(c=nK(c,e)));m&&(f|=2);let y=!m,g=!0,A=0,E=0;for(;A<h.length;A++){const x=B8(h[A],t,!1,f);if(x instanceof t){if(!m){const w=!!(2&xs(x.u));y&&(y=!w),g&&(g=w)}h[E++]=x}}E<A&&(h.length=E),c|=4,c=g?16|c:-17&c,Wr(h,c=y?8|c:-9&c),m&&Object.freeze(h)}if(o&&!(8&c||!l.length&&(r===1||r===4&&32&c))){for(If(c)?(l=kl(l),c=u0(c,e),e=kr(a,e,n,l)):Z2(l,i),t=l,o=c,h=0;h<t.length;h++)(c=t[h])!==(f=V4(c))&&(t[h]=f);o|=8,o=t.length?-17&o:16|o,Wr(t,o),c=o}let d;return r===1||r===4&&32&c?If(c)||(i=c,(c|=!l.length||16&c&&(!u||32&c)?2:2048)!==i&&Wr(l,c),Object.freeze(l)):(u=r===5&&(!!(32&c)||If(c)||!!(Jo!=null&&Jo.get(l))),(r===2||u)&&If(c)&&(l=kl(l),c=mA(c=u0(c,e),e,s),Wr(l,c),e=kr(a,e,n,l)),If(c)||(n=c,(c=mA(c,e,s))!==n&&Wr(l,c)),u?(d=KW(l),D8(l,i,!0)):r!==2||s||(Jo==null||Jo.delete(l))),d||l}function Gf(i,e,t){const n=Ui(i.u);return oK(i,n,e,t,Om(),!1,!(2&n))}function Cn(i,e,t,n){return n==null&&(n=void 0),Ar(i,t,n)}function g2(i,e,t,n){n==null&&(n=void 0);e:{i=i.u;let r=Ui(i);if(Hf(r),n==null){const s=N8(i);if(U8(s,i,r,t)!==e)break e;s.set(t,0)}else r=rK(i,r,t,e);kr(i,r,e,n)}}function u0(i,e){return-2049&(i=32|(2&e?2|i:-3&i))}function mA(i,e,t){return 32&e&&t||(i&=-33),i}function cw(i,e,t,n){const r=Ui(i.u);Hf(r),i=oK(i,r,t,e,2,!0),t=n??new t,i.push(t),2&xs(t.u)?nw(i,8):nw(i,16)}function bu(i,e){return i??e}function mc(i,e){return kA(cp(i,e))}function ms(i,e){return bu(dS(i,e),0)}function Sh(i,e){return bu(tp(cp(i,e)),"")}function ex(i,e,t){if(t!=null&&typeof t!="boolean")throw i=typeof t,Error(`Expected boolean but got ${i!="object"?i:t?Array.isArray(t)?"array":i:"null"}: ${t}`);Ar(i,e,t)}function wh(i,e,t){if(t!=null){if(typeof t!="number"||!Number.isFinite(t))throw Z5("int32");t|=0}Ar(i,e,t)}function hn(i,e,t){if(t!=null&&typeof t!="number")throw Error(`Value of float/double field must be a number, found ${typeof t}: ${t}`);Ar(i,e,t)}function uw(i,e,t){{const a=i.u;let l=Ui(a);if(Hf(l),t==null)kr(a,l,e);else{t=(fS==null?void 0:fS.get(t))||t;var n,r=xs(t),s=r,o=!!(2&r)||Object.isFrozen(t);if((n=!o)&&(n=V3e===void 0||!1),ZW(i,r)){r=21,o&&(t=kl(t),s=0,r=mA(r=u0(r,l),l,!0));for(let c=0;c<t.length;c++)t[c]=WW(t[c])}n?(t=kl(t),s=0,r=mA(r=u0(r,l),l,!0)):o||D8(t,i),r!==s&&Wr(t,r),kr(a,l,e,t)}}}function j4(i,e,t){Hf(Ui(i.u)),Nm(i,e,tp,2,void 0,!0).push(WW(t))}function aK(i,e){return Error(`Invalid wire type: ${i} (at position ${e})`)}function G8(){return Error("Failed to read varint, encoding is invalid.")}function lK(i,e){return Error(`Tried to read past the end of the data ${e} > ${i}`)}function H8(i){if(typeof i=="string")return{buffer:UW(i),O:!1};if(Array.isArray(i))return{buffer:new Uint8Array(i),O:!1};if(i.constructor===Uint8Array)return{buffer:i,O:!1};if(i.constructor===ArrayBuffer)return{buffer:new Uint8Array(i),O:!1};if(i.constructor===kf)return{buffer:S8(i)||new Uint8Array(0),O:!0};if(i instanceof Uint8Array)return{buffer:new Uint8Array(i.buffer,i.byteOffset,i.byteLength),O:!1};throw Error("Type not convertible to a Uint8Array, expected a Uint8Array, an ArrayBuffer, a base64 encoded string, a ByteString or an Array of numbers")}function Q8(i,e){let t,n=0,r=0,s=0;const o=i.h;let a=i.g;do t=o[a++],n|=(127&t)<<s,s+=7;while(s<32&&128&t);for(s>32&&(r|=(127&t)>>4),s=3;s<32&&128&t;s+=7)t=o[a++],r|=(127&t)<<s;if($m(i,a),t<128)return e(n>>>0,r>>>0);throw G8()}function V8(i){let e=0,t=i.g;const n=t+10,r=i.h;for(;t<n;){const s=r[t++];if(e|=s,(128&s)==0)return $m(i,t),!!(127&e)}throw G8()}function up(i){const e=i.h;let t=i.g,n=e[t++],r=127&n;if(128&n&&(n=e[t++],r|=(127&n)<<7,128&n&&(n=e[t++],r|=(127&n)<<14,128&n&&(n=e[t++],r|=(127&n)<<21,128&n&&(n=e[t++],r|=n<<28,128&n&&128&e[t++]&&128&e[t++]&&128&e[t++]&&128&e[t++]&&128&e[t++])))))throw G8();return $m(i,t),r}function hp(i){return up(i)>>>0}function r6(i){var e=i.h;const t=i.g,n=e[t],r=e[t+1],s=e[t+2];return e=e[t+3],$m(i,i.g+4),(n<<0|r<<8|s<<16|e<<24)>>>0}function s6(i){var e=r6(i);i=2*(e>>31)+1;const t=e>>>23&255;return e&=8388607,t==255?e?NaN:i*(1/0):t==0?1401298464324817e-60*i*e:i*Math.pow(2,t-150)*(e+8388608)}function hEe(i){return up(i)}function $I(i,e,{ea:t=!1}={}){i.ea=t,e&&(e=H8(e),i.h=e.buffer,i.m=e.O,i.j=0,i.l=i.h.length,i.g=i.j)}function $m(i,e){if(i.g=e,e>i.l)throw lK(i.l,e)}function cK(i,e){if(e<0)throw Error(`Tried to read a negative byte length: ${e}`);const t=i.g,n=t+e;if(n>i.l)throw lK(e,i.l-t);return i.g=n,t}function uK(i,e){if(e==0)return l0();var t=cK(i,e);return i.ea&&i.m?t=i.h.subarray(t,t+e):(i=i.h,t=t===(e=t+e)?new Uint8Array(0):q3e?i.slice(t,e):new Uint8Array(i.subarray(t,e))),t.length==0?l0():new kf(t,dA)}yc.prototype.toJSON=void 0,yc.prototype.La=HW;var VO=[];function hK(i){var e=i.g;if(e.g==e.l)return!1;i.l=i.g.g;var t=hp(i.g);if(e=t>>>3,!((t&=7)>=0&&t<=5))throw aK(t,i.l);if(e<1)throw Error(`Invalid field number: ${e} (at position ${i.l})`);return i.m=e,i.h=t,!0}function pS(i){switch(i.h){case 0:i.h!=0?pS(i):V8(i.g);break;case 1:$m(i=i.g,i.g+8);break;case 2:if(i.h!=2)pS(i);else{var e=hp(i.g);$m(i=i.g,i.g+e)}break;case 5:$m(i=i.g,i.g+4);break;case 3:for(e=i.m;;){if(!hK(i))throw Error("Unmatched start-group tag: stream EOF");if(i.h==4){if(i.m!=e)throw Error("Unmatched end-group tag");break}pS(i)}break;default:throw aK(i.h,i.l)}}function Lx(i,e,t){const n=i.g.l,r=hp(i.g),s=i.g.g+r;let o=s-n;if(o<=0&&(i.g.l=s,t(e,i,void 0,void 0,void 0),o=s-i.g.g),o)throw Error(`Message parsing ended unexpectedly. Expected to read ${r} bytes, instead read ${r-o} bytes, either the data ended unexpectedly or the message misreported its own length`);return i.g.g=s,i.g.l=n,e}function j8(i){var e=hp(i.g),t=cK(i=i.g,e);if(i=i.h,L3e){var n,r=i;(n=HI)||(n=HI=new TextDecoder("utf-8",{fatal:!0})),e=t+e,r=t===0&&e===r.length?r:r.subarray(t,e);try{var s=n.decode(r)}catch(a){if(O_===void 0){try{n.decode(new Uint8Array([128]))}catch{}try{n.decode(new Uint8Array([97])),O_=!0}catch{O_=!1}}throw!O_&&(HI=void 0),a}}else{e=(s=t)+e,t=[];let a,l=null;for(;s<e;){var o=i[s++];o<128?t.push(o):o<224?s>=e?Sm():(a=i[s++],o<194||(192&a)!=128?(s--,Sm()):t.push((31&o)<<6|63&a)):o<240?s>=e-1?Sm():(a=i[s++],(192&a)!=128||o===224&&a<160||o===237&&a>=160||(192&(n=i[s++]))!=128?(s--,Sm()):t.push((15&o)<<12|(63&a)<<6|63&n)):o<=244?s>=e-2?Sm():(a=i[s++],(192&a)!=128||a-144+(o<<28)>>30!=0||(192&(n=i[s++]))!=128||(192&(r=i[s++]))!=128?(s--,Sm()):(o=(7&o)<<18|(63&a)<<12|(63&n)<<6|63&r,o-=65536,t.push(55296+(o>>10&1023),56320+(1023&o)))):Sm(),t.length>=8192&&(l=IO(l,t),t.length=0)}s=IO(l,t)}return s}function fK(i){const e=hp(i.g);return uK(i.g,e)}function W4(i,e,t){var n=hp(i.g);for(n=i.g.g+n;i.g.g<n;)t.push(e(i.g))}var N_=[];let hw;function Lu(i,e,t){e.g?e.m(i,e.g,e.h,t,!0):e.m(i,e.h,t,!0)}var an=class{constructor(i,e){this.u=qW(i,e)}toJSON(){return dK(this)}l(){var i=JEe;return i.g?i.l(this,i.g,i.h,!0):i.l(this,i.h,i.defaultValue,!0)}clone(){const i=this.u;return O8(this,i,Ui(i),!1)}O(){return!!(2&xs(this.u))}};function dK(i){H4(i),i=hw?i.u:Q4(i.u,F8,void 0,void 0,!1);{var e=!hw;let c=i.length;if(c){var t=i[c-1],n=O4(t);n?c--:t=void 0;var r=i;if(n){e:{var s,o=t,a=!1;if(o)for(let u in o)isNaN(+u)?(s??(s={}))[u]=o[u]:(n=o[u],Array.isArray(n)&&(iw(n)||BO(n)&&n.size===0)&&(n=null),n==null&&(a=!0),n!=null&&((s??(s={}))[u]=n));if(a||(s=o),s)for(let u in s){a=s;break e}a=null}o=a==null?t!=null:a!==t}for(;c>0&&((s=r[c-1])==null||iw(s)||BO(s)&&s.size===0);c--)var l=!0;(r!==i||o||l)&&(e?(l||o||a)&&(r.length=c):r=Array.prototype.slice.call(r,0,c),a&&r.push(a)),l=r}else l=i}return l}function jO(i){return i?/^\d+$/.test(i)?(z4(i),new o6(or,is)):null:fEe||(fEe=new o6(0,0))}an.prototype.Y=Px,an.prototype.toString=function(){try{return hw=!0,dK(this).toString()}finally{hw=!1}};var o6=class{constructor(i,e){this.h=i>>>0,this.g=e>>>0}};let fEe;function WO(i){return i?/^-?\d+$/.test(i)?(z4(i),new a6(or,is)):null:dEe||(dEe=new a6(0,0))}var a6=class{constructor(i,e){this.h=i>>>0,this.g=e>>>0}};let dEe;function J1(i,e,t){for(;t>0||e>127;)i.g.push(127&e|128),e=(e>>>7|t<<25)>>>0,t>>>=7;i.g.push(e)}function Bx(i,e){for(;e>127;)i.g.push(127&e|128),e>>>=7;i.g.push(e)}function K4(i,e){if(e>=0)Bx(i,e);else{for(let t=0;t<9;t++)i.g.push(127&e|128),e>>=7;i.g.push(1)}}function tx(i,e){i.g.push(e>>>0&255),i.g.push(e>>>8&255),i.g.push(e>>>16&255),i.g.push(e>>>24&255)}function gA(i,e){e.length!==0&&(i.l.push(e),i.h+=e.length)}function Sc(i,e,t){Bx(i.g,8*e+t)}function W8(i,e){return Sc(i,e,2),e=i.g.end(),gA(i,e),e.push(i.h),e}function K8(i,e){var t=e.pop();for(t=i.h+i.g.length()-t;t>127;)e.push(127&t|128),t>>>=7,i.h++;e.push(t),i.h++}function Y4(i,e,t){Sc(i,e,2),Bx(i.g,t.length),gA(i,i.g.end()),gA(i,t)}function l6(i,e,t,n){t!=null&&(e=W8(i,e),n(t,i),K8(i,e))}class NA{constructor(e,t,n){this.g=e,this.h=t,this.qa=n}}function pK(i){return Array.isArray(i)?i[0]instanceof NA?i:[SEe,i]:[i,void 0]}function UA(i,e){if(Array.isArray(e)){var t=xs(e);if(4&t)return e;for(var n=0,r=0;n<e.length;n++){const s=i(e[n]);s!=null&&(e[r++]=s)}return r<n&&(e.length=r),Wr(e,-12289&(5|t)),2&t&&Object.freeze(e),e}}const KO=Symbol();function Y8(i){let e=i[KO];if(!e){const t=$8(i),n=t.h;e=n?(r,s)=>n(r,s,t):(r,s)=>{var c;for(;hK(s)&&s.h!=4;){var o=s.m;let u=t[o];const h=!u;let f=!1;if(!u){var a=t.X;if(a){var l=a[o];l&&(f=(c=a.P)==null?void 0:c[o],(!DW||f)&&(a=pEe(l))&&(u=t[o]=a))}}u&&u(s,r,o)||(o=(a=s).l,pS(a),a.ja?a=void 0:(l=a.g.g-o,a.g.g=o,a=uK(a.g,l)),o=r,a&&(ep||(ep=Symbol()),(l=o[ep])?l.push(a):o[ep]=[a])),h&&u&&!f&&c6++<5&&c0()}},i[KO]=e}return e}function pEe(i){const e=(i=pK(i))[0].g;if(i=i[1]){const t=Y8(i),n=$8(i).g;return(r,s,o)=>e(r,s,o,n,t)}return e}function mEe(i,e,t){i[e]=t}function mK(i,e,t,n){var r=mEe;e.g=(function(h){switch(typeof h){case"boolean":return nEe||(nEe=[0,void 0,!0]);case"number":return h>0?void 0:h===0?iEe||(iEe=[0,void 0]):[-h,void 0];case"string":return[0,h];case"object":return h}})(i[0]);let s=0;var o=i[++s];o&&o.constructor===Object&&(e.X=o,typeof(o=i[++s])=="function"&&(e.h=o,e.l=i[++s],o=i[++s]));const a={};for(;Array.isArray(o)&&typeof o[0]=="number"&&o[0]>0;){for(var l=0;l<o.length;l++)a[o[l]]=o;o=i[++s]}for(l=1;o!==void 0;){let h;typeof o=="number"&&(l+=o,o=i[++s]);var c=void 0;if(o instanceof NA?h=o:(h=wEe,s--),h.qa){o=i[++s],c=i;var u=s;typeof o=="function"&&(o=o(),c[u]=o),c=o}for(u=l+1,typeof(o=i[++s])=="number"&&o<0&&(u-=o,o=i[++s]);l<u;l++){const f=a[l];r(e,l,c?n(h,c,f):t(h,f))}}return e}const YO=Symbol();function gK(i){let e=i[YO];if(!e){const t=$4(i);e=(n,r)=>AK(n,r,t),i[YO]=e}return e}const $O=Symbol();function gEe(i){return i.h}function AEe(i,e){let t,n;const r=i.h;return(s,o,a)=>r(s,o,a,n||(n=$4(e).g),t||(t=gK(e)))}function $4(i){let e=i[$O];return e||(e=mK(i,i[$O]={},gEe,AEe))}const XO=Symbol();function yEe(i,e){const t=i.g;return e?(n,r,s)=>t(n,r,s,e):t}function vEe(i,e,t){const n=i.g;let r,s;return(o,a,l)=>n(o,a,l,s||(s=$8(e).g),r||(r=Y8(e)),t)}function $8(i){let e=i[XO];return e||(e=mK(i,i[XO]={},yEe,vEe))}function qO(i,e){var s;var t=i[e];if(t)return t;if(t=i.X){var n=t[e];if(n){var r=(n=pK(n))[0].h;if(n=n[1],t=(s=t.P)==null?void 0:s[e],!DW||t){if(n){const o=gK(n),a=$4(n).g;t=(t=i.l)?t(a,o):(l,c,u)=>r(l,c,u,a,o)}else t=r;return i[e]=t}}}}function AK(i,e,t){var l,c,u;for(var n=Ui(i),r=+!!(512&n)-1,s=i.length,o=512&n?1:0,a=s+(256&n?-1:0);o<a;o++){const h=i[o];if(h==null)continue;const f=o-r,d=qO(t,f);if(!d)continue;const m=t.X;m!=null&&m[f]&&!((l=m==null?void 0:m.P)!=null&&l[f])&&c6++<5&&c0(),d(e,h,f)}if(256&n){n=i[s-1];for(let h in n)r=+h,!Number.isNaN(r)&&(s=n[h])!=null&&(a=qO(t,r))&&((c=o=t.X)!=null&&c[r]&&!((u=o==null?void 0:o.P)!=null&&u[r])&&c6++<5&&c0(),a(e,s,r))}if(i=ep?i[ep]:void 0)for(gA(e,e.g.end()),t=0;t<i.length;t++)gA(e,S8(i[t])||new Uint8Array(0))}function il(i,e){return new NA(i,e,!1)}function zA(i,e){return new NA(i,e,!1)}function X4(i,e){return new NA(i,e,!0)}function rl(i,e,t){kr(i,Ui(i),e,t)}var xEe=X4((function(i,e,t,n,r){return i.h===2&&(i=Lx(i,Ym([void 0,void 0],n),r),Hf(n=Ui(e)),(r=bh(e,n,t))instanceof yc?(2&r.M)!=0?((r=r.Z()).push(i),kr(e,n,t,r)):r.Qa(i):Array.isArray(r)?(2&xs(r)&&kr(e,n,t,r=iK(r)),r.push(i)):kr(e,n,t,[i]),!0)}),(function(i,e,t,n,r){if(e instanceof yc)e.forEach(((s,o)=>{l6(i,t,Ym([o,s],n),r)}));else if(Array.isArray(e))for(let s=0;s<e.length;s++){const o=e[s];Array.isArray(o)&&l6(i,t,Ym(o,n),r)}}));let c6=0;function yK(i,e,t){if(e=(function(n){if(n==null)return n;const r=typeof n;if(r==="bigint")return String(BigInt.asIntN(64,n));if(G4(n)){if(r==="string")return L8(n);if(r==="number")return P8(n)}})(e),e!=null&&(typeof e=="string"&&WO(e),e!=null))switch(Sc(i,t,0),typeof e){case"number":i=i.g,pA(e),J1(i,or,is);break;case"bigint":t=BigInt.asUintN(64,e),t=new a6(Number(t&BigInt(4294967295)),Number(t>>BigInt(32))),J1(i.g,t.h,t.g);break;default:t=WO(e),J1(i.g,t.h,t.g)}}function vK(i,e,t){(e=kA(e))!=null&&e!=null&&(Sc(i,t,0),K4(i.g,e))}function xK(i,e,t){(e=jW(e))!=null&&(Sc(i,t,0),i.g.g.push(e?1:0))}function EK(i,e,t){(e=tp(e))!=null&&Y4(i,t,LW(e))}function q4(i,e,t,n,r){e instanceof an?(H4(e),e=e.u):e=Array.isArray(e)?Ym(e,n):void 0,l6(i,t,e,r)}function _K(i,e,t){(e=e==null||typeof e=="string"||Mx(e)||e instanceof kf?e:void 0)!=null&&Y4(i,t,H8(e).buffer)}function SK(i,e,t){return(i.h===5||i.h===2)&&(e=OA(e,Ui(e),t,2,!1),i.h==2?W4(i,s6,e):e.push(s6(i.g)),!0)}var Ds,wf=il((function(i,e,t){if(i.h!==1)return!1;var n=i.g;i=r6(n);const r=r6(n);n=2*(r>>31)+1;const s=r>>>20&2047;return i=4294967296*(1048575&r)+i,rl(e,t,s==2047?i?NaN:n*(1/0):s==0?5e-324*n*i:n*Math.pow(2,s-1075)*(i+4503599627370496)),!0}),(function(i,e,t){(e=Ep(e))!=null&&(Sc(i,t,1),i=i.g,(t=VW||(VW=new DataView(new ArrayBuffer(8)))).setFloat64(0,+e,!0),or=t.getUint32(0,!0),is=t.getUint32(4,!0),tx(i,or),tx(i,is))})),ro=il((function(i,e,t){return i.h===5&&(rl(e,t,s6(i.g)),!0)}),(function(i,e,t){(e=Ep(e))!=null&&(Sc(i,t,5),i=i.g,b8(e),tx(i,or))})),EEe=zA(SK,(function(i,e,t){if((e=UA(Ep,e))!=null)for(let o=0;o<e.length;o++){var n=i,r=t,s=e[o];s!=null&&(Sc(n,r,5),n=n.g,b8(s),tx(n,or))}})),X8=zA(SK,(function(i,e,t){if((e=UA(Ep,e))!=null&&e.length){Sc(i,t,2),Bx(i.g,4*e.length);for(let n=0;n<e.length;n++)t=i.g,b8(e[n]),tx(t,or)}})),fp=il((function(i,e,t){return i.h===0&&(rl(e,t,Q8(i.g,M8)),!0)}),yK),XI=il((function(i,e,t){return i.h===0&&(rl(e,t,(i=Q8(i.g,M8))===0?void 0:i),!0)}),yK),_Ee=il((function(i,e,t){return i.h===0&&(rl(e,t,Q8(i.g,I8)),!0)}),(function(i,e,t){if((e=eEe(e))!=null&&(typeof e=="string"&&jO(e),e!=null))switch(Sc(i,t,0),typeof e){case"number":i=i.g,pA(e),J1(i,or,is);break;case"bigint":t=BigInt.asUintN(64,e),t=new o6(Number(t&BigInt(4294967295)),Number(t>>BigInt(32))),J1(i.g,t.h,t.g);break;default:t=jO(e),J1(i.g,t.h,t.g)}})),ss=il((function(i,e,t){return i.h===0&&(rl(e,t,up(i.g)),!0)}),vK),J4=zA((function(i,e,t){return(i.h===0||i.h===2)&&(e=OA(e,Ui(e),t,2,!1),i.h==2?W4(i,up,e):e.push(up(i.g)),!0)}),(function(i,e,t){if((e=UA(kA,e))!=null&&e.length){t=W8(i,t);for(let n=0;n<e.length;n++)K4(i.g,e[n]);K8(i,t)}})),N1=il((function(i,e,t){return i.h===0&&(rl(e,t,(i=up(i.g))===0?void 0:i),!0)}),vK),Vr=il((function(i,e,t){return i.h===0&&(rl(e,t,V8(i.g)),!0)}),xK),A2=il((function(i,e,t){return i.h===0&&(rl(e,t,(i=V8(i.g))===!1?void 0:i),!0)}),xK),qo=zA((function(i,e,t){if(i.h!==2)return!1;i=j8(i);const n=Ui(e);return Hf(n),OA(e,n,t,2).push(i),!0}),(function(i,e,t){if((e=UA(tp,e))!=null)for(let o=0;o<e.length;o++){var n=i,r=t,s=e[o];s!=null&&Y4(n,r,LW(s))}})),zd=il((function(i,e,t){return i.h===2&&(rl(e,t,(i=j8(i))===""?void 0:i),!0)}),EK),ji=il((function(i,e,t){return i.h===2&&(rl(e,t,j8(i)),!0)}),EK),SEe=X4((function(i,e,t,n,r){return i.h===2&&(Lx(i,z8(e,n,t,!0),r),!0)}),q4),wEe=X4((function(i,e,t,n,r){return i.h===2&&(Lx(i,z8(e,n,t),r),!0)}),q4);Ds=new NA((function(i,e,t,n,r){if(i.h!==2)return!1;n=Ym(void 0,n);let s=Ui(e);Hf(s);let o=OA(e,s,t,3);return s=Ui(e),4&xs(o)&&(o=kl(o),Wr(o,-2079&(1|xs(o))),kr(e,s,t,o)),o.push(n),Lx(i,n,r),!0}),(function(i,e,t,n,r){if(Array.isArray(e))for(let s=0;s<e.length;s++)q4(i,e[s],t,n,r)}),!0);var Ji=X4((function(i,e,t,n,r,s){return i.h===2&&(rK(e,Ui(e),s,t),Lx(i,e=z8(e,n,t),r),!0)}),q4),wK=il((function(i,e,t){return i.h===2&&(rl(e,t,fK(i)),!0)}),_K),CEe=zA((function(i,e,t){return(i.h===0||i.h===2)&&(e=OA(e,Ui(e),t,2,!1),i.h==2?W4(i,hp,e):e.push(hp(i.g)),!0)}),(function(i,e,t){if((e=UA(Z3e,e))!=null)for(let o=0;o<e.length;o++){var n=i,r=t,s=e[o];s!=null&&(Sc(n,r,0),Bx(n.g,s))}})),Iu=il((function(i,e,t){return i.h===0&&(rl(e,t,up(i.g)),!0)}),(function(i,e,t){(e=kA(e))!=null&&(e=parseInt(e,10),Sc(i,t,0),K4(i.g,e))}));class TEe{constructor(e,t){this.h=e,this.g=t,this.l=wi,this.m=Cn,this.defaultValue=void 0}}function Bu(i,e){return new TEe(i,e)}function _p(i,e){return(t,n)=>{if(N_.length){const s=N_.pop();s.o(n),$I(s.g,t,n),t=s}else t=new class{constructor(s,o){if(VO.length){const a=VO.pop();$I(a,s,o),s=a}else s=new class{constructor(a,l){this.h=null,this.m=!1,this.g=this.l=this.j=0,$I(this,a,l)}clear(){this.h=null,this.m=!1,this.g=this.l=this.j=0,this.ea=!1}}(s,o);this.g=s,this.l=this.g.g,this.h=this.m=-1,this.o(o)}o({ja:s=!1}={}){this.ja=s}}(t,n);try{const s=new i,o=s.u;Y8(e)(o,t);var r=s}finally{t.g.clear(),t.m=-1,t.h=-1,N_.length<100&&N_.push(t)}return r}}function Z4(i){return function(){H4(this);const e=new class{constructor(){this.l=[],this.h=0,this.g=new class{constructor(){this.g=[]}length(){return this.g.length}end(){const o=this.g;return this.g=[],o}}}};AK(this.u,e,$4(i)),gA(e,e.g.end());const t=new Uint8Array(e.h),n=e.l,r=n.length;let s=0;for(let o=0;o<r;o++){const a=n[o];t.set(a,s),s+=a.length}return e.l=[t],t}}var JO=class extends an{constructor(i){super(i)}},ZO=[0,zd,il((function(i,e,t){return i.h===2&&(rl(e,t,(i=fK(i))===l0()?void 0:i),!0)}),(function(i,e,t){if(e!=null){if(e instanceof an){const n=e.Ta;return void(n&&(e=n(e),e!=null&&Y4(i,t,H8(e).buffer)))}if(Array.isArray(e))return}_K(i,e,t)}))],CK=[0,ss,Iu,Vr,-1,J4,Iu,-1],bEe=class extends an{constructor(){super()}},TK=[0,Vr,ji,Vr,Iu,-1,zA((function(i,e,t){return(i.h===0||i.h===2)&&(e=OA(e,Ui(e),t,2,!1),i.h==2?W4(i,hEe,e):e.push(up(i.g)),!0)}),(function(i,e,t){if((e=UA(kA,e))!=null&&e.length){t=W8(i,t);for(let n=0;n<e.length;n++)K4(i.g,e[n]);K8(i,t)}})),ji,-1,[0,Vr,-1],Iu,Vr,-1],bK=[0,ji,-2],eN=class extends an{constructor(){super()}},IK=[0],MK=[0,ss,Vr,1,Vr,-3],IEe=[0,ji,Vr,-1,ss,[0,[1,2,3,4,5,6,7],Ji,IK,Ji,TK,Ji,bK,Ji,MK,Ji,CK,Ji,[0,ji,-2],Ji,[0,ji,Iu]],[0,ji],Vr,[0,[1,3],[2,4],Ji,[0,J4],-1,Ji,[0,qo],-1,Ds,[0,ji,-1]],ji],Fl=class extends an{constructor(i){super(i,2)}},Ir={},to=Ir.P={};Ir[336783863]=IEe,to[336783863]=1;var tN=[0,XI,-1,A2,-3,XI,J4,zd,N1,XI,-1,A2,N1,A2,-2,zd];function Ol(i,e){i6(i,2,FA(e),"")}function yr(i,e){j4(i,3,e)}function mi(i,e){j4(i,4,e)}var wa=class extends an{constructor(i){super(i,500)}o(i){return Cn(this,0,7,i)}},y2=[-1,{P:{}}],nN=[0,ji,1,y2],iN=[0,ji,qo,y2];function Nl(i,e){cw(i,1,wa,e)}function Mr(i,e){j4(i,10,e)}function Ii(i,e){j4(i,15,e)}var sl=class extends an{constructor(i){super(i,500)}o(i){return Cn(this,0,1001,i)}},RK=[-500,Ds,[-500,zd,-1,qo,-3,[-2,Ir,Vr],Ds,ZO,N1,-1,nN,iN,Ds,[0,zd,A2],zd,tN,N1,qo,987,qo],4,Ds,[-500,ji,-1,[-1,{P:{}}],998,ji],Ds,[-500,ji,qo,-1,[-2,{P:{}},Vr],997,qo,-1],N1,Ds,[-500,ji,qo,y2,998,qo],qo,N1,nN,iN,Ds,[0,zd,-1,y2],qo,-2,tN,zd,-1,A2,979,y2,Ds,ZO];sl.prototype.g=Z4(RK);var MEe=_p(sl,RK),REe=class extends an{constructor(i){super(i)}},PK=class extends an{constructor(i){super(i)}g(){return Gf(this,REe,1)}},LK=[0,Ds,[0,ss,ro,ji,-1]],eC=_p(PK,LK),PEe=class extends an{constructor(i){super(i)}},LEe=class extends an{constructor(i){super(i)}},qI=class extends an{constructor(i){super(i)}h(){return wi(this,PEe,2)}g(){return Gf(this,LEe,5)}},BK=_p(class extends an{constructor(i){super(i)}},[0,qo,J4,X8,[0,Iu,[0,ss,-3],[0,ro,-3],[0,ss,-1,[0,Ds,[0,ss,-2]]],Ds,[0,ro,-1,ji,ro]],ji,-1,fp,Ds,[0,ss,ro],qo,fp]),DK=class extends an{constructor(i){super(i)}},Z1=_p(class extends an{constructor(i){super(i)}},[0,Ds,[0,ro,-4]]),kK=class extends an{constructor(i){super(i)}},Dx=_p(class extends an{constructor(i){super(i)}},[0,Ds,[0,ro,-4]]),BEe=class extends an{constructor(i){super(i)}},DEe=[0,ss,-1,X8,Iu],FK=class extends an{constructor(){super()}};FK.prototype.g=Z4([0,ro,-4,fp]);var kEe=class extends an{constructor(i){super(i)}},FEe=_p(class extends an{constructor(i){super(i)}},[0,Ds,[0,1,ss,ji,LK],fp]),rN=class extends an{constructor(i){super(i)}},OEe=class extends an{constructor(i){super(i)}ra(){const i=eK(this);return i??l0()}},NEe=class extends an{constructor(i){super(i)}},OK=[1,2],UEe=_p(class extends an{constructor(i){super(i)}},[0,Ds,[0,OK,Ji,[0,X8],Ji,[0,wK],ss,ji],fp]),q8=class extends an{constructor(i){super(i)}},NK=[0,ji,ss,ro,qo,-1],sN=class extends an{constructor(i){super(i)}},zEe=[0,Vr,-1],oN=class extends an{constructor(i){super(i)}},mS=[1,2,3,4,5],fw=class extends an{constructor(i){super(i)}g(){return eK(this)!=null}h(){return tp(cp(this,2))!=null}},Fr=class extends an{constructor(i){super(i)}g(){return jW(cp(this,2))??!1}},UK=[0,wK,ji,[0,ss,fp,-1],[0,_Ee,fp]],Es=[0,UK,Vr,[0,mS,Ji,MK,Ji,TK,Ji,CK,Ji,IK,Ji,bK],Iu],tC=class extends an{constructor(i){super(i)}},J8=[0,Es,ro,-1,ss],GEe=Bu(502141897,tC);Ir[502141897]=J8,to[502141897]=1;var zK=[0,UK];Ir[512499200]=zK;var GK=[0,zK];Ir[515723506]=GK;var HEe=_p(class extends an{constructor(i){super(i)}},[0,[0,Iu,-1,EEe,CEe],DEe]),HK=[0,Es];Ir[508981768]=HK;var QK=class extends an{constructor(i){super(i)}},VK=class extends an{constructor(i){super(i)}},Z8=[0,Es,ro,HK,Vr],jK=[0,Es,J8,Z8,ro,GK];Ir[508968149]=Z8;var QEe=Bu(508968150,VK);Ir[508968150]=jK,to[508968150]=1,to[508968149]=1;var WK=class extends an{constructor(i){super(i)}},VEe=Bu(513916220,WK);Ir[513916220]=[0,Es,jK,ss],to[513916220]=1;var x1=class extends an{constructor(i){super(i)}h(){return wi(this,q8,2)}g(){Ar(this,2)}},KK=[0,Es,NK];Ir[478825465]=KK,to[478825465]=1;var YK=[0,Es];Ir[478825422]=YK;var jEe=class extends an{constructor(i){super(i)}},$K=class extends an{constructor(i){super(i)}},eP=class extends an{constructor(i){super(i)}},tP=class extends an{constructor(i){super(i)}},XK=class extends an{constructor(i){super(i)}},qK=[0,Es,YK,KK,-1],JK=[0,Es,ro,ss],nP=[0,Es,ro],ZK=[0,Es,JK,nP,ro],WEe=[0,Es,ZK,qK];Ir[463370452]=qK,Ir[464864288]=JK,Ir[474472470]=nP;var KEe=Bu(462713202,tP);Ir[462713202]=ZK;var YEe=Bu(479097054,XK);Ir[479097054]=WEe,to[479097054]=1,to[463370452]=1,to[464864288]=1,to[462713202]=1,to[474472470]=1;var $Ee=class extends an{constructor(i){super(i)}},eY=class extends an{constructor(i){super(i)}},tY=class extends an{constructor(i){super(i)}},nY=class extends an{constructor(){super()}},u6=[0,Es,ro,-1,ss],h6=[0,Es,ro,Vr];nY.prototype.g=Z4([0,Es,nP,[0,Es],J8,Z8,u6,h6]),Ir[514774813]=u6,Ir[518928384]=h6;var iY=class extends an{constructor(i){super(i)}},XEe=Bu(456383383,iY);Ir[456383383]=[0,Es,NK],to[456383383]=1;var rY=class extends an{constructor(i){super(i)}},qEe=Bu(476348187,rY);Ir[476348187]=[0,Es,zEe],to[476348187]=1;var sY=class extends an{constructor(i){super(i)}},aN=class extends an{constructor(i){super(i)}},oY=[0,Iu,-1],JEe=Bu(458105876,class extends an{constructor(i){super(i)}g(){var i=this.u;const e=Ui(i),t=2&e;return i=(function(n,r,s){var o=aN;const a=2&r;let l=!1;if(s==null){if(a)return HO();s=[]}else if(s.constructor===yc){if((2&s.M)==0||a)return s;s=s.Z()}else Array.isArray(s)?l=!!(2&xs(s)):s=[];if(a){if(!s.length)return HO();l||(l=!0,DA(s))}else l&&(l=!1,s=iK(s));return l||(64&xs(s)?nw(s,32):32&r&&F4(s,32)),kr(n,r,2,o=new yc(s,o,tEe,void 0)),o})(i,e,bh(i,e,2)),!t&&aN&&(i.va=!0),i}});Ir[458105876]=[0,oY,xEe,[!0,fp,[0,ji,-1,qo]]],to[458105876]=1;var iP=class extends an{constructor(i){super(i)}},aY=Bu(458105758,iP);Ir[458105758]=[0,Es,ji,oY],to[458105758]=1;var lY=class extends an{constructor(i){super(i)}},ZEe=Bu(443442058,lY);Ir[443442058]=[0,Es,ji,ss,ro,qo,-1],to[443442058]=1,to[514774813]=1;var cY=class extends an{constructor(i){super(i)}},e_e=Bu(516587230,cY);function f6(i,e){return e=e?e.clone():new q8,i.displayNamesLocale!==void 0?Ar(e,1,FA(i.displayNamesLocale)):i.displayNamesLocale===void 0&&Ar(e,1),i.maxResults!==void 0?wh(e,2,i.maxResults):"maxResults"in i&&Ar(e,2),i.scoreThreshold!==void 0?hn(e,3,i.scoreThreshold):"scoreThreshold"in i&&Ar(e,3),i.categoryAllowlist!==void 0?uw(e,4,i.categoryAllowlist):"categoryAllowlist"in i&&Ar(e,4),i.categoryDenylist!==void 0?uw(e,5,i.categoryDenylist):"categoryDenylist"in i&&Ar(e,5),e}function rP(i,e=-1,t=""){return{categories:i.map((n=>({index:bu(mc(n,1),0)??-1,score:ms(n,2)??0,categoryName:Sh(n,3)??"",displayName:Sh(n,4)??""}))),headIndex:e,headName:t}}function uY(i){var o,a;var e=Nm(i,3,Ep,Om()),t=Nm(i,2,kA,Om()),n=Nm(i,1,tp,Om()),r=Nm(i,9,tp,Om());const s={categories:[],keypoints:[]};for(let l=0;l<e.length;l++)s.categories.push({score:e[l],index:t[l]??-1,categoryName:n[l]??"",displayName:r[l]??""});if((e=(o=wi(i,qI,4))==null?void 0:o.h())&&(s.boundingBox={originX:mc(e,1)??0,originY:mc(e,2)??0,width:mc(e,3)??0,height:mc(e,4)??0,angle:0}),(a=wi(i,qI,4))==null?void 0:a.g().length)for(const l of wi(i,qI,4).g())s.keypoints.push({x:dS(l,1)??0,y:dS(l,2)??0,score:dS(l,4)??0,label:tp(cp(l,3))??""});return s}function nC(i){const e=[];for(const t of Gf(i,kK,1))e.push({x:ms(t,1)??0,y:ms(t,2)??0,z:ms(t,3)??0,visibility:ms(t,4)??0});return e}function v2(i){const e=[];for(const t of Gf(i,DK,1))e.push({x:ms(t,1)??0,y:ms(t,2)??0,z:ms(t,3)??0,visibility:ms(t,4)??0});return e}function lN(i){return Array.from(i,(e=>e>127?e-256:e))}function cN(i,e){if(i.length!==e.length)throw Error(`Cannot compute cosine similarity between embeddings of different sizes (${i.length} vs. ${e.length}).`);let t=0,n=0,r=0;for(let s=0;s<i.length;s++)t+=i[s]*e[s],n+=i[s]*i[s],r+=e[s]*e[s];if(n<=0||r<=0)throw Error("Cannot compute cosine similarity on embedding with 0 norm.");return t/Math.sqrt(n*r)}let U_;Ir[516587230]=[0,Es,u6,h6,ro],to[516587230]=1,to[518928384]=1;const t_e=new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11]);async function hY(){if(U_===void 0)try{await WebAssembly.instantiate(t_e),U_=!0}catch{U_=!1}return U_}async function Fv(i,e=""){const t=await hY()?"wasm_internal":"wasm_nosimd_internal";return{wasmLoaderPath:`${e}/${i}_${t}.js`,wasmBinaryPath:`${e}/${i}_${t}.wasm`}}var Tm=class{};function fY(){var i=navigator;return typeof OffscreenCanvas<"u"&&(!(function(e=navigator){return(e=e.userAgent).includes("Safari")&&!e.includes("Chrome")})(i)||!!((i=i.userAgent.match(/Version\/([\d]+).*Safari/))&&i.length>=1&&Number(i[1])>=17))}async function uN(i){if(typeof importScripts!="function"){const e=document.createElement("script");return e.src=i.toString(),e.crossOrigin="anonymous",new Promise(((t,n)=>{e.addEventListener("load",(()=>{t()}),!1),e.addEventListener("error",(r=>{n(r)}),!1),document.body.appendChild(e)}))}importScripts(i.toString())}function dY(i){return i.videoWidth!==void 0?[i.videoWidth,i.videoHeight]:i.naturalWidth!==void 0?[i.naturalWidth,i.naturalHeight]:i.displayWidth!==void 0?[i.displayWidth,i.displayHeight]:[i.width,i.height]}function gn(i,e,t){i.m||console.error("No wasm multistream support detected: ensure dependency inclusion of :gl_graph_runner_internal_multi_input target"),t(e=i.i.stringToNewUTF8(e)),i.i._free(e)}function hN(i,e,t){if(!i.i.canvas)throw Error("No OpenGL canvas configured.");if(t?i.i._bindTextureToStream(t):i.i._bindTextureToCanvas(),!(t=i.i.canvas.getContext("webgl2")||i.i.canvas.getContext("webgl")))throw Error("Failed to obtain WebGL context from the provided canvas. `getContext()` should only be invoked with `webgl` or `webgl2`.");i.i.gpuOriginForWebTexturesIsBottomLeft&&t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!0),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e),i.i.gpuOriginForWebTexturesIsBottomLeft&&t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!1);const[n,r]=dY(e);return!i.l||n===i.i.canvas.width&&r===i.i.canvas.height||(i.i.canvas.width=n,i.i.canvas.height=r),[n,r]}function fN(i,e,t){i.m||console.error("No wasm multistream support detected: ensure dependency inclusion of :gl_graph_runner_internal_multi_input target");const n=new Uint32Array(e.length);for(let r=0;r<e.length;r++)n[r]=i.i.stringToNewUTF8(e[r]);e=i.i._malloc(4*n.length),i.i.HEAPU32.set(n,e>>2),t(e);for(const r of n)i.i._free(r);i.i._free(e)}function oh(i,e,t){i.i.simpleListeners=i.i.simpleListeners||{},i.i.simpleListeners[e]=t}function Bd(i,e,t){let n=[];i.i.simpleListeners=i.i.simpleListeners||{},i.i.simpleListeners[e]=(r,s,o)=>{s?(t(n,o),n=[]):n.push(r)}}Tm.forVisionTasks=function(i){return Fv("vision",i)},Tm.forTextTasks=function(i){return Fv("text",i)},Tm.forGenAiExperimentalTasks=function(i){return Fv("genai_experimental",i)},Tm.forGenAiTasks=function(i){return Fv("genai",i)},Tm.forAudioTasks=function(i){return Fv("audio",i)},Tm.isSimdSupported=function(){return hY()};async function n_e(i,e,t,n){return i=await(async(r,s,o,a,l)=>{if(s&&await uN(s),!self.ModuleFactory||o&&(await uN(o),!self.ModuleFactory))throw Error("ModuleFactory not set.");return self.Module&&l&&((s=self.Module).locateFile=l.locateFile,l.mainScriptUrlOrBlob&&(s.mainScriptUrlOrBlob=l.mainScriptUrlOrBlob)),l=await self.ModuleFactory(self.Module||l),self.ModuleFactory=self.Module=void 0,new r(l,a)})(i,t.wasmLoaderPath,t.assetLoaderPath,e,{locateFile:r=>r.endsWith(".wasm")?t.wasmBinaryPath.toString():t.assetBinaryPath&&r.endsWith(".data")?t.assetBinaryPath.toString():r}),await i.o(n),i}function JI(i,e){const t=wi(i.baseOptions,fw,1)||new fw;typeof e=="string"?(Ar(t,2,FA(e)),Ar(t,1)):e instanceof Uint8Array&&(Ar(t,1,T8(e,!1,!1)),Ar(t,2)),Cn(i.baseOptions,0,1,t)}function dN(i){try{const e=i.H.length;if(e===1)throw Error(i.H[0].message);if(e>1)throw Error("Encountered multiple errors: "+i.H.map((t=>t.message)).join(", "))}finally{i.H=[]}}function en(i,e){i.B=Math.max(i.B,e)}function iC(i,e){i.A=new wa,Ol(i.A,"PassThroughCalculator"),yr(i.A,"free_memory"),mi(i.A,"free_memory_unused_out"),Mr(e,"free_memory"),Nl(e,i.A)}function AA(i,e){yr(i.A,e),mi(i.A,e+"_unused_out")}function rC(i){i.g.addBoolToStream(!0,"free_memory",i.B)}var gS=class{constructor(i){this.g=i,this.H=[],this.B=0,this.g.setAutoRenderToScreen(!1)}l(i,e=!0){var t,n,r,s,o,a;if(e){const l=i.baseOptions||{};if((t=i.baseOptions)!=null&&t.modelAssetBuffer&&((n=i.baseOptions)!=null&&n.modelAssetPath))throw Error("Cannot set both baseOptions.modelAssetPath and baseOptions.modelAssetBuffer");if(!((r=wi(this.baseOptions,fw,1))!=null&&r.g()||(s=wi(this.baseOptions,fw,1))!=null&&s.h()||(o=i.baseOptions)!=null&&o.modelAssetBuffer||(a=i.baseOptions)!=null&&a.modelAssetPath))throw Error("Either baseOptions.modelAssetPath or baseOptions.modelAssetBuffer must be set");if((function(c,u){let h=wi(c.baseOptions,oN,3);if(!h){var f=h=new oN,d=new eN;g2(f,4,mS,d)}"delegate"in u&&(u.delegate==="GPU"?(u=h,f=new bEe,g2(u,2,mS,f)):(u=h,f=new eN,g2(u,4,mS,f))),Cn(c.baseOptions,0,3,h)})(this,l),l.modelAssetPath)return fetch(l.modelAssetPath.toString()).then((c=>{if(c.ok)return c.arrayBuffer();throw Error(`Failed to fetch model: ${l.modelAssetPath} (${c.status})`)})).then((c=>{try{this.g.i.FS_unlink("/model.dat")}catch{}this.g.i.FS_createDataFile("/","model.dat",new Uint8Array(c),!0,!1,!1),JI(this,"/model.dat"),this.m(),this.J()}));if(l.modelAssetBuffer instanceof Uint8Array)JI(this,l.modelAssetBuffer);else if(l.modelAssetBuffer)return(async function(c){const u=[];for(var h=0;;){const{done:f,value:d}=await c.read();if(f)break;u.push(d),h+=d.length}if(u.length===0)return new Uint8Array(0);if(u.length===1)return u[0];c=new Uint8Array(h),h=0;for(const f of u)c.set(f,h),h+=f.length;return c})(l.modelAssetBuffer).then((c=>{JI(this,c),this.m(),this.J()}))}return this.m(),this.J(),Promise.resolve()}J(){}ga(){let i;if(this.g.ga((e=>{i=MEe(e)})),!i)throw Error("Failed to retrieve CalculatorGraphConfig");return i}setGraph(i,e){this.g.attachErrorListener(((t,n)=>{this.H.push(Error(n))})),this.g.Oa(),this.g.setGraph(i,e),this.A=void 0,dN(this)}finishProcessing(){this.g.finishProcessing(),dN(this)}close(){this.A=void 0,this.g.closeGraph()}};function Ff(i,e){if(!i)throw Error(`Unable to obtain required WebGL resource: ${e}`);return i}gS.prototype.close=gS.prototype.close,(function(i,e){i=i.split(".");var t,n=a0;for((i[0]in n)||n.execScript===void 0||n.execScript("var "+i[0]);i.length&&(t=i.shift());)i.length||e===void 0?n=n[t]&&n[t]!==Object.prototype[t]?n[t]:n[t]={}:n[t]=e})("TaskRunner",gS);class i_e{constructor(e,t,n,r){this.g=e,this.h=t,this.m=n,this.l=r}bind(){this.g.bindVertexArray(this.h)}close(){this.g.deleteVertexArray(this.h),this.g.deleteBuffer(this.m),this.g.deleteBuffer(this.l)}}function pN(i,e,t){const n=i.g;if(t=Ff(n.createShader(t),"Failed to create WebGL shader"),n.shaderSource(t,e),n.compileShader(t),!n.getShaderParameter(t,n.COMPILE_STATUS))throw Error(`Could not compile WebGL shader: ${n.getShaderInfoLog(t)}`);return n.attachShader(i.h,t),t}function mN(i,e){const t=i.g,n=Ff(t.createVertexArray(),"Failed to create vertex array");t.bindVertexArray(n);const r=Ff(t.createBuffer(),"Failed to create buffer");t.bindBuffer(t.ARRAY_BUFFER,r),t.enableVertexAttribArray(i.R),t.vertexAttribPointer(i.R,2,t.FLOAT,!1,0,0),t.bufferData(t.ARRAY_BUFFER,new Float32Array([-1,-1,-1,1,1,1,1,-1]),t.STATIC_DRAW);const s=Ff(t.createBuffer(),"Failed to create buffer");return t.bindBuffer(t.ARRAY_BUFFER,s),t.enableVertexAttribArray(i.J),t.vertexAttribPointer(i.J,2,t.FLOAT,!1,0,0),t.bufferData(t.ARRAY_BUFFER,new Float32Array(e?[0,1,0,0,1,0,1,1]:[0,0,0,1,1,1,1,0]),t.STATIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,null),t.bindVertexArray(null),new i_e(t,n,r,s)}function sP(i,e){if(i.g){if(e!==i.g)throw Error("Cannot change GL context once initialized")}else i.g=e}function oP(i,e,t,n){return sP(i,e),i.h||(i.m(),i.C()),t?(i.s||(i.s=mN(i,!0)),t=i.s):(i.v||(i.v=mN(i,!1)),t=i.v),e.useProgram(i.h),t.bind(),i.l(),i=n(),t.g.bindVertexArray(null),i}function sC(i,e,t){return sP(i,e),i=Ff(e.createTexture(),"Failed to create texture"),e.bindTexture(e.TEXTURE_2D,i),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,t??e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,t??e.LINEAR),e.bindTexture(e.TEXTURE_2D,null),i}function oC(i,e,t){sP(i,e),i.A||(i.A=Ff(e.createFramebuffer(),"Failed to create framebuffe.")),e.bindFramebuffer(e.FRAMEBUFFER,i.A),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0)}function aP(i){var e;(e=i.g)==null||e.bindFramebuffer(i.g.FRAMEBUFFER,null)}var lP=class{H(){return`
  precision mediump float;
  varying vec2 vTex;
  uniform sampler2D inputTexture;
  void main() {
    gl_FragColor = texture2D(inputTexture, vTex);
  }
 `}m(){const i=this.g;if(this.h=Ff(i.createProgram(),"Failed to create WebGL program"),this.da=pN(this,`
  attribute vec2 aVertex;
  attribute vec2 aTex;
  varying vec2 vTex;
  void main(void) {
    gl_Position = vec4(aVertex, 0.0, 1.0);
    vTex = aTex;
  }`,i.VERTEX_SHADER),this.ca=pN(this,this.H(),i.FRAGMENT_SHADER),i.linkProgram(this.h),!i.getProgramParameter(this.h,i.LINK_STATUS))throw Error(`Error during program linking: ${i.getProgramInfoLog(this.h)}`);this.R=i.getAttribLocation(this.h,"aVertex"),this.J=i.getAttribLocation(this.h,"aTex")}C(){}l(){}close(){if(this.h){const i=this.g;i.deleteProgram(this.h),i.deleteShader(this.da),i.deleteShader(this.ca)}this.A&&this.g.deleteFramebuffer(this.A),this.v&&this.v.close(),this.s&&this.s.close()}};function Mf(i,e){switch(e){case 0:return i.g.find((t=>t instanceof Uint8Array));case 1:return i.g.find((t=>t instanceof Float32Array));case 2:return i.g.find((t=>typeof WebGLTexture<"u"&&t instanceof WebGLTexture));default:throw Error(`Type is not supported: ${e}`)}}function d6(i){var e=Mf(i,1);if(!e){if(e=Mf(i,0))e=new Float32Array(e).map((n=>n/255));else{e=new Float32Array(i.width*i.height);const n=yA(i);var t=cP(i);if(oC(t,n,pY(i)),"iPad Simulator;iPhone Simulator;iPod Simulator;iPad;iPhone;iPod".split(";").includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in self.document){t=new Float32Array(i.width*i.height*4),n.readPixels(0,0,i.width,i.height,n.RGBA,n.FLOAT,t);for(let r=0,s=0;r<e.length;++r,s+=4)e[r]=t[s]}else n.readPixels(0,0,i.width,i.height,n.RED,n.FLOAT,e)}i.g.push(e)}return e}function pY(i){let e=Mf(i,2);if(!e){const t=yA(i);e=gY(i);const n=d6(i),r=mY(i);t.texImage2D(t.TEXTURE_2D,0,r,i.width,i.height,0,t.RED,t.FLOAT,n),p6(i)}return e}function yA(i){if(!i.canvas)throw Error("Conversion to different image formats require that a canvas is passed when initializing the image.");return i.h||(i.h=Ff(i.canvas.getContext("webgl2"),"You cannot use a canvas that is already bound to a different type of rendering context.")),i.h}function mY(i){if(i=yA(i),!z_)if(i.getExtension("EXT_color_buffer_float")&&i.getExtension("OES_texture_float_linear")&&i.getExtension("EXT_float_blend"))z_=i.R32F;else{if(!i.getExtension("EXT_color_buffer_half_float"))throw Error("GPU does not fully support 4-channel float32 or float16 formats");z_=i.R16F}return z_}function cP(i){return i.l||(i.l=new lP),i.l}function gY(i){const e=yA(i);e.viewport(0,0,i.width,i.height),e.activeTexture(e.TEXTURE0);let t=Mf(i,2);return t||(t=sC(cP(i),e,i.m?e.LINEAR:e.NEAREST),i.g.push(t),i.j=!0),e.bindTexture(e.TEXTURE_2D,t),t}function p6(i){i.h.bindTexture(i.h.TEXTURE_2D,null)}var z_,Xs=class{constructor(i,e,t,n,r,s,o){this.g=i,this.m=e,this.j=t,this.canvas=n,this.l=r,this.width=s,this.height=o,this.j&&--gN===0&&console.error("You seem to be creating MPMask instances without invoking .close(). This leaks resources.")}Ja(){return!!Mf(this,0)}ma(){return!!Mf(this,1)}S(){return!!Mf(this,2)}la(){return(e=Mf(i=this,0))||(e=d6(i),e=new Uint8Array(e.map((t=>255*t))),i.g.push(e)),e;var i,e}ka(){return d6(this)}N(){return pY(this)}clone(){const i=[];for(const e of this.g){let t;if(e instanceof Uint8Array)t=new Uint8Array(e);else if(e instanceof Float32Array)t=new Float32Array(e);else{if(!(e instanceof WebGLTexture))throw Error(`Type is not supported: ${e}`);{const n=yA(this),r=cP(this);n.activeTexture(n.TEXTURE1),t=sC(r,n,this.m?n.LINEAR:n.NEAREST),n.bindTexture(n.TEXTURE_2D,t);const s=mY(this);n.texImage2D(n.TEXTURE_2D,0,s,this.width,this.height,0,n.RED,n.FLOAT,null),n.bindTexture(n.TEXTURE_2D,null),oC(r,n,t),oP(r,n,!1,(()=>{gY(this),n.clearColor(0,0,0,0),n.clear(n.COLOR_BUFFER_BIT),n.drawArrays(n.TRIANGLE_FAN,0,4),p6(this)})),aP(r),p6(this)}}i.push(t)}return new Xs(i,this.m,this.S(),this.canvas,this.l,this.width,this.height)}close(){this.j&&yA(this).deleteTexture(Mf(this,2)),gN=-1}};Xs.prototype.close=Xs.prototype.close,Xs.prototype.clone=Xs.prototype.clone,Xs.prototype.getAsWebGLTexture=Xs.prototype.N,Xs.prototype.getAsFloat32Array=Xs.prototype.ka,Xs.prototype.getAsUint8Array=Xs.prototype.la,Xs.prototype.hasWebGLTexture=Xs.prototype.S,Xs.prototype.hasFloat32Array=Xs.prototype.ma,Xs.prototype.hasUint8Array=Xs.prototype.Ja;var gN=250;function ph(i,e){switch(e){case 0:return i.g.find((t=>t instanceof ImageData));case 1:return i.g.find((t=>typeof ImageBitmap<"u"&&t instanceof ImageBitmap));case 2:return i.g.find((t=>typeof WebGLTexture<"u"&&t instanceof WebGLTexture));default:throw Error(`Type is not supported: ${e}`)}}function AY(i){var e=ph(i,0);if(!e){e=vA(i);const t=aC(i),n=new Uint8Array(i.width*i.height*4);oC(t,e,AS(i)),e.readPixels(0,0,i.width,i.height,e.RGBA,e.UNSIGNED_BYTE,n),aP(t),e=new ImageData(new Uint8ClampedArray(n.buffer),i.width,i.height),i.g.push(e)}return e}function AS(i){let e=ph(i,2);if(!e){const t=vA(i);e=yS(i);const n=ph(i,1)||AY(i);t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,n),Wv(i)}return e}function vA(i){if(!i.canvas)throw Error("Conversion to different image formats require that a canvas is passed when iniitializing the image.");return i.h||(i.h=Ff(i.canvas.getContext("webgl2"),"You cannot use a canvas that is already bound to a different type of rendering context.")),i.h}function aC(i){return i.l||(i.l=new lP),i.l}function yS(i){const e=vA(i);e.viewport(0,0,i.width,i.height),e.activeTexture(e.TEXTURE0);let t=ph(i,2);return t||(t=sC(aC(i),e),i.g.push(t),i.m=!0),e.bindTexture(e.TEXTURE_2D,t),t}function Wv(i){i.h.bindTexture(i.h.TEXTURE_2D,null)}function AN(i){const e=vA(i);return oP(aC(i),e,!0,(()=>(function(t,n){const r=t.canvas;if(r.width===t.width&&r.height===t.height)return n();const s=r.width,o=r.height;return r.width=t.width,r.height=t.height,t=n(),r.width=s,r.height=o,t})(i,(()=>{if(e.bindFramebuffer(e.FRAMEBUFFER,null),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT),e.drawArrays(e.TRIANGLE_FAN,0,4),!(i.canvas instanceof OffscreenCanvas))throw Error("Conversion to ImageBitmap requires that the MediaPipe Tasks is initialized with an OffscreenCanvas");return i.canvas.transferToImageBitmap()}))))}var qs=class{constructor(i,e,t,n,r,s,o){this.g=i,this.j=e,this.m=t,this.canvas=n,this.l=r,this.width=s,this.height=o,(this.j||this.m)&&--yN===0&&console.error("You seem to be creating MPImage instances without invoking .close(). This leaks resources.")}Ia(){return!!ph(this,0)}na(){return!!ph(this,1)}S(){return!!ph(this,2)}Ga(){return AY(this)}Fa(){var i=ph(this,1);return i||(AS(this),yS(this),i=AN(this),Wv(this),this.g.push(i),this.j=!0),i}N(){return AS(this)}clone(){const i=[];for(const e of this.g){let t;if(e instanceof ImageData)t=new ImageData(e.data,this.width,this.height);else if(e instanceof WebGLTexture){const n=vA(this),r=aC(this);n.activeTexture(n.TEXTURE1),t=sC(r,n),n.bindTexture(n.TEXTURE_2D,t),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,this.width,this.height,0,n.RGBA,n.UNSIGNED_BYTE,null),n.bindTexture(n.TEXTURE_2D,null),oC(r,n,t),oP(r,n,!1,(()=>{yS(this),n.clearColor(0,0,0,0),n.clear(n.COLOR_BUFFER_BIT),n.drawArrays(n.TRIANGLE_FAN,0,4),Wv(this)})),aP(r),Wv(this)}else{if(!(e instanceof ImageBitmap))throw Error(`Type is not supported: ${e}`);AS(this),yS(this),t=AN(this),Wv(this)}i.push(t)}return new qs(i,this.na(),this.S(),this.canvas,this.l,this.width,this.height)}close(){this.j&&ph(this,1).close(),this.m&&vA(this).deleteTexture(ph(this,2)),yN=-1}};qs.prototype.close=qs.prototype.close,qs.prototype.clone=qs.prototype.clone,qs.prototype.getAsWebGLTexture=qs.prototype.N,qs.prototype.getAsImageBitmap=qs.prototype.Fa,qs.prototype.getAsImageData=qs.prototype.Ga,qs.prototype.hasWebGLTexture=qs.prototype.S,qs.prototype.hasImageBitmap=qs.prototype.na,qs.prototype.hasImageData=qs.prototype.Ia;var yN=250;function Du(...i){return i.map((([e,t])=>({start:e,end:t})))}const r_e=(function(i){return class extends i{Oa(){this.i._registerModelResourcesGraphService()}}})((vN=class{constructor(i,e){this.l=!0,this.i=i,this.g=null,this.h=0,this.m=typeof this.i._addIntToInputStream=="function",e!==void 0?this.i.canvas=e:fY()?this.i.canvas=new OffscreenCanvas(1,1):(console.warn("OffscreenCanvas not supported and GraphRunner constructor glCanvas parameter is undefined. Creating backup canvas."),this.i.canvas=document.createElement("canvas"))}async initializeGraph(i){const e=await(await fetch(i)).arrayBuffer();i=!(i.endsWith(".pbtxt")||i.endsWith(".textproto")),this.setGraph(new Uint8Array(e),i)}setGraphFromString(i){this.setGraph(new TextEncoder().encode(i),!1)}setGraph(i,e){const t=i.length,n=this.i._malloc(t);this.i.HEAPU8.set(i,n),e?this.i._changeBinaryGraph(t,n):this.i._changeTextGraph(t,n),this.i._free(n)}configureAudio(i,e,t,n,r){this.i._configureAudio||console.warn('Attempting to use configureAudio without support for input audio. Is build dep ":gl_graph_runner_audio" missing?'),gn(this,n||"input_audio",(s=>{gn(this,r=r||"audio_header",(o=>{this.i._configureAudio(s,o,i,e,t)}))}))}setAutoResizeCanvas(i){this.l=i}setAutoRenderToScreen(i){this.i._setAutoRenderToScreen(i)}setGpuBufferVerticalFlip(i){this.i.gpuOriginForWebTexturesIsBottomLeft=i}ga(i){oh(this,"__graph_config__",(e=>{i(e)})),gn(this,"__graph_config__",(e=>{this.i._getGraphConfig(e,void 0)})),delete this.i.simpleListeners.__graph_config__}attachErrorListener(i){this.i.errorListener=i}attachEmptyPacketListener(i,e){this.i.emptyPacketListeners=this.i.emptyPacketListeners||{},this.i.emptyPacketListeners[i]=e}addAudioToStream(i,e,t){this.addAudioToStreamWithShape(i,0,0,e,t)}addAudioToStreamWithShape(i,e,t,n,r){const s=4*i.length;this.h!==s&&(this.g&&this.i._free(this.g),this.g=this.i._malloc(s),this.h=s),this.i.HEAPF32.set(i,this.g/4),gn(this,n,(o=>{this.i._addAudioToInputStream(this.g,e,t,o,r)}))}addGpuBufferToStream(i,e,t){gn(this,e,(n=>{const[r,s]=hN(this,i,n);this.i._addBoundTextureToStream(n,r,s,t)}))}addBoolToStream(i,e,t){gn(this,e,(n=>{this.i._addBoolToInputStream(i,n,t)}))}addDoubleToStream(i,e,t){gn(this,e,(n=>{this.i._addDoubleToInputStream(i,n,t)}))}addFloatToStream(i,e,t){gn(this,e,(n=>{this.i._addFloatToInputStream(i,n,t)}))}addIntToStream(i,e,t){gn(this,e,(n=>{this.i._addIntToInputStream(i,n,t)}))}addUintToStream(i,e,t){gn(this,e,(n=>{this.i._addUintToInputStream(i,n,t)}))}addStringToStream(i,e,t){gn(this,e,(n=>{gn(this,i,(r=>{this.i._addStringToInputStream(r,n,t)}))}))}addStringRecordToStream(i,e,t){gn(this,e,(n=>{fN(this,Object.keys(i),(r=>{fN(this,Object.values(i),(s=>{this.i._addFlatHashMapToInputStream(r,s,Object.keys(i).length,n,t)}))}))}))}addProtoToStream(i,e,t,n){gn(this,t,(r=>{gn(this,e,(s=>{const o=this.i._malloc(i.length);this.i.HEAPU8.set(i,o),this.i._addProtoToInputStream(o,i.length,s,r,n),this.i._free(o)}))}))}addEmptyPacketToStream(i,e){gn(this,i,(t=>{this.i._addEmptyPacketToInputStream(t,e)}))}addBoolVectorToStream(i,e,t){gn(this,e,(n=>{const r=this.i._allocateBoolVector(i.length);if(!r)throw Error("Unable to allocate new bool vector on heap.");for(const s of i)this.i._addBoolVectorEntry(r,s);this.i._addBoolVectorToInputStream(r,n,t)}))}addDoubleVectorToStream(i,e,t){gn(this,e,(n=>{const r=this.i._allocateDoubleVector(i.length);if(!r)throw Error("Unable to allocate new double vector on heap.");for(const s of i)this.i._addDoubleVectorEntry(r,s);this.i._addDoubleVectorToInputStream(r,n,t)}))}addFloatVectorToStream(i,e,t){gn(this,e,(n=>{const r=this.i._allocateFloatVector(i.length);if(!r)throw Error("Unable to allocate new float vector on heap.");for(const s of i)this.i._addFloatVectorEntry(r,s);this.i._addFloatVectorToInputStream(r,n,t)}))}addIntVectorToStream(i,e,t){gn(this,e,(n=>{const r=this.i._allocateIntVector(i.length);if(!r)throw Error("Unable to allocate new int vector on heap.");for(const s of i)this.i._addIntVectorEntry(r,s);this.i._addIntVectorToInputStream(r,n,t)}))}addUintVectorToStream(i,e,t){gn(this,e,(n=>{const r=this.i._allocateUintVector(i.length);if(!r)throw Error("Unable to allocate new unsigned int vector on heap.");for(const s of i)this.i._addUintVectorEntry(r,s);this.i._addUintVectorToInputStream(r,n,t)}))}addStringVectorToStream(i,e,t){gn(this,e,(n=>{const r=this.i._allocateStringVector(i.length);if(!r)throw Error("Unable to allocate new string vector on heap.");for(const s of i)gn(this,s,(o=>{this.i._addStringVectorEntry(r,o)}));this.i._addStringVectorToInputStream(r,n,t)}))}addBoolToInputSidePacket(i,e){gn(this,e,(t=>{this.i._addBoolToInputSidePacket(i,t)}))}addDoubleToInputSidePacket(i,e){gn(this,e,(t=>{this.i._addDoubleToInputSidePacket(i,t)}))}addFloatToInputSidePacket(i,e){gn(this,e,(t=>{this.i._addFloatToInputSidePacket(i,t)}))}addIntToInputSidePacket(i,e){gn(this,e,(t=>{this.i._addIntToInputSidePacket(i,t)}))}addUintToInputSidePacket(i,e){gn(this,e,(t=>{this.i._addUintToInputSidePacket(i,t)}))}addStringToInputSidePacket(i,e){gn(this,e,(t=>{gn(this,i,(n=>{this.i._addStringToInputSidePacket(n,t)}))}))}addProtoToInputSidePacket(i,e,t){gn(this,t,(n=>{gn(this,e,(r=>{const s=this.i._malloc(i.length);this.i.HEAPU8.set(i,s),this.i._addProtoToInputSidePacket(s,i.length,r,n),this.i._free(s)}))}))}addBoolVectorToInputSidePacket(i,e){gn(this,e,(t=>{const n=this.i._allocateBoolVector(i.length);if(!n)throw Error("Unable to allocate new bool vector on heap.");for(const r of i)this.i._addBoolVectorEntry(n,r);this.i._addBoolVectorToInputSidePacket(n,t)}))}addDoubleVectorToInputSidePacket(i,e){gn(this,e,(t=>{const n=this.i._allocateDoubleVector(i.length);if(!n)throw Error("Unable to allocate new double vector on heap.");for(const r of i)this.i._addDoubleVectorEntry(n,r);this.i._addDoubleVectorToInputSidePacket(n,t)}))}addFloatVectorToInputSidePacket(i,e){gn(this,e,(t=>{const n=this.i._allocateFloatVector(i.length);if(!n)throw Error("Unable to allocate new float vector on heap.");for(const r of i)this.i._addFloatVectorEntry(n,r);this.i._addFloatVectorToInputSidePacket(n,t)}))}addIntVectorToInputSidePacket(i,e){gn(this,e,(t=>{const n=this.i._allocateIntVector(i.length);if(!n)throw Error("Unable to allocate new int vector on heap.");for(const r of i)this.i._addIntVectorEntry(n,r);this.i._addIntVectorToInputSidePacket(n,t)}))}addUintVectorToInputSidePacket(i,e){gn(this,e,(t=>{const n=this.i._allocateUintVector(i.length);if(!n)throw Error("Unable to allocate new unsigned int vector on heap.");for(const r of i)this.i._addUintVectorEntry(n,r);this.i._addUintVectorToInputSidePacket(n,t)}))}addStringVectorToInputSidePacket(i,e){gn(this,e,(t=>{const n=this.i._allocateStringVector(i.length);if(!n)throw Error("Unable to allocate new string vector on heap.");for(const r of i)gn(this,r,(s=>{this.i._addStringVectorEntry(n,s)}));this.i._addStringVectorToInputSidePacket(n,t)}))}attachBoolListener(i,e){oh(this,i,e),gn(this,i,(t=>{this.i._attachBoolListener(t)}))}attachBoolVectorListener(i,e){Bd(this,i,e),gn(this,i,(t=>{this.i._attachBoolVectorListener(t)}))}attachIntListener(i,e){oh(this,i,e),gn(this,i,(t=>{this.i._attachIntListener(t)}))}attachIntVectorListener(i,e){Bd(this,i,e),gn(this,i,(t=>{this.i._attachIntVectorListener(t)}))}attachUintListener(i,e){oh(this,i,e),gn(this,i,(t=>{this.i._attachUintListener(t)}))}attachUintVectorListener(i,e){Bd(this,i,e),gn(this,i,(t=>{this.i._attachUintVectorListener(t)}))}attachDoubleListener(i,e){oh(this,i,e),gn(this,i,(t=>{this.i._attachDoubleListener(t)}))}attachDoubleVectorListener(i,e){Bd(this,i,e),gn(this,i,(t=>{this.i._attachDoubleVectorListener(t)}))}attachFloatListener(i,e){oh(this,i,e),gn(this,i,(t=>{this.i._attachFloatListener(t)}))}attachFloatVectorListener(i,e){Bd(this,i,e),gn(this,i,(t=>{this.i._attachFloatVectorListener(t)}))}attachStringListener(i,e){oh(this,i,e),gn(this,i,(t=>{this.i._attachStringListener(t)}))}attachStringVectorListener(i,e){Bd(this,i,e),gn(this,i,(t=>{this.i._attachStringVectorListener(t)}))}attachProtoListener(i,e,t){oh(this,i,e),gn(this,i,(n=>{this.i._attachProtoListener(n,t||!1)}))}attachProtoVectorListener(i,e,t){Bd(this,i,e),gn(this,i,(n=>{this.i._attachProtoVectorListener(n,t||!1)}))}attachAudioListener(i,e,t){this.i._attachAudioListener||console.warn('Attempting to use attachAudioListener without support for output audio. Is build dep ":gl_graph_runner_audio_out" missing?'),oh(this,i,((n,r)=>{n=new Float32Array(n.buffer,n.byteOffset,n.length/4),e(n,r)})),gn(this,i,(n=>{this.i._attachAudioListener(n,t||!1)}))}finishProcessing(){this.i._waitUntilIdle()}closeGraph(){this.i._closeGraph(),this.i.simpleListeners=void 0,this.i.emptyPacketListeners=void 0}},class extends vN{get ia(){return this.i}ta(i,e,t){gn(this,e,(n=>{const[r,s]=hN(this,i,n);this.ia._addBoundTextureAsImageToStream(n,r,s,t)}))}W(i,e){oh(this,i,e),gn(this,i,(t=>{this.ia._attachImageListener(t)}))}fa(i,e){Bd(this,i,e),gn(this,i,(t=>{this.ia._attachImageVectorListener(t)}))}}));var vN,wc=class extends r_e{};async function di(i,e,t){return(async function(n,r,s,o){return n_e(n,r,s,o)})(i,t.canvas??(fY()?void 0:document.createElement("canvas")),e,t)}function yY(i,e,t,n){if(i.V){const s=new FK;if(t!=null&&t.regionOfInterest){if(!i.sa)throw Error("This task doesn't support region-of-interest.");var r=t.regionOfInterest;if(r.left>=r.right||r.top>=r.bottom)throw Error("Expected RectF with left < right and top < bottom.");if(r.left<0||r.top<0||r.right>1||r.bottom>1)throw Error("Expected RectF values to be in [0,1].");hn(s,1,(r.left+r.right)/2),hn(s,2,(r.top+r.bottom)/2),hn(s,4,r.right-r.left),hn(s,3,r.bottom-r.top)}else hn(s,1,.5),hn(s,2,.5),hn(s,4,1),hn(s,3,1);if(t!=null&&t.rotationDegrees){if((t==null?void 0:t.rotationDegrees)%90!=0)throw Error("Expected rotation to be a multiple of 90°.");if(hn(s,5,-Math.PI*t.rotationDegrees/180),(t==null?void 0:t.rotationDegrees)%180!=0){const[o,a]=dY(e);t=ms(s,3)*a/o,r=ms(s,4)*o/a,hn(s,4,t),hn(s,3,r)}}i.g.addProtoToStream(s.g(),"mediapipe.NormalizedRect",i.V,n)}i.g.ta(e,i.da,n??performance.now()),i.finishProcessing()}function Cc(i,e,t){var n;if((n=i.baseOptions)!=null&&n.g())throw Error("Task is not initialized with image mode. 'runningMode' must be set to 'IMAGE'.");yY(i,e,t,i.B+1)}function Ih(i,e,t,n){var r;if(!((r=i.baseOptions)!=null&&r.g()))throw Error("Task is not initialized with video mode. 'runningMode' must be set to 'VIDEO'.");yY(i,e,t,n)}function xA(i,e,t,n){var r=e.data;const s=e.width,o=s*(e=e.height);if((r instanceof Uint8Array||r instanceof Float32Array)&&r.length!==o)throw Error("Unsupported channel count: "+r.length/o);return i=new Xs([r],t,!1,i.g.i.canvas,i.R,s,e),n?i.clone():i}var Ca=class extends gS{constructor(i,e,t,n){super(i),this.g=i,this.da=e,this.V=t,this.sa=n,this.R=new lP}l(i,e=!0){if("runningMode"in i&&ex(this.baseOptions,2,!!i.runningMode&&i.runningMode!=="IMAGE"),i.canvas!==void 0&&this.g.i.canvas!==i.canvas)throw Error("You must create a new task to reset the canvas.");return super.l(i,e)}close(){this.R.close(),super.close()}};Ca.prototype.close=Ca.prototype.close;var _l=class extends Ca{constructor(i,e){super(new wc(i,e),"image_in","norm_rect_in",!1),this.j={detections:[]},Cn(i=this.h=new tC,0,1,e=new Fr),hn(this.h,2,.5),hn(this.h,3,.3)}get baseOptions(){return wi(this.h,Fr,1)}set baseOptions(i){Cn(this.h,0,1,i)}o(i){return"minDetectionConfidence"in i&&hn(this.h,2,i.minDetectionConfidence??.5),"minSuppressionThreshold"in i&&hn(this.h,3,i.minSuppressionThreshold??.3),this.l(i)}D(i,e){return this.j={detections:[]},Cc(this,i,e),this.j}F(i,e,t){return this.j={detections:[]},Ih(this,i,t,e),this.j}m(){var i=new sl;Mr(i,"image_in"),Mr(i,"norm_rect_in"),Ii(i,"detections");const e=new Fl;Lu(e,GEe,this.h);const t=new wa;Ol(t,"mediapipe.tasks.vision.face_detector.FaceDetectorGraph"),yr(t,"IMAGE:image_in"),yr(t,"NORM_RECT:norm_rect_in"),mi(t,"DETECTIONS:detections"),t.o(e),Nl(i,t),this.g.attachProtoVectorListener("detections",((n,r)=>{for(const s of n)n=BK(s),this.j.detections.push(uY(n));en(this,r)})),this.g.attachEmptyPacketListener("detections",(n=>{en(this,n)})),i=i.g(),this.setGraph(new Uint8Array(i),!0)}};_l.prototype.detectForVideo=_l.prototype.F,_l.prototype.detect=_l.prototype.D,_l.prototype.setOptions=_l.prototype.o,_l.createFromModelPath=async function(i,e){return di(_l,i,{baseOptions:{modelAssetPath:e}})},_l.createFromModelBuffer=function(i,e){return di(_l,i,{baseOptions:{modelAssetBuffer:e}})},_l.createFromOptions=function(i,e){return di(_l,i,e)};var uP=Du([61,146],[146,91],[91,181],[181,84],[84,17],[17,314],[314,405],[405,321],[321,375],[375,291],[61,185],[185,40],[40,39],[39,37],[37,0],[0,267],[267,269],[269,270],[270,409],[409,291],[78,95],[95,88],[88,178],[178,87],[87,14],[14,317],[317,402],[402,318],[318,324],[324,308],[78,191],[191,80],[80,81],[81,82],[82,13],[13,312],[312,311],[311,310],[310,415],[415,308]),hP=Du([263,249],[249,390],[390,373],[373,374],[374,380],[380,381],[381,382],[382,362],[263,466],[466,388],[388,387],[387,386],[386,385],[385,384],[384,398],[398,362]),fP=Du([276,283],[283,282],[282,295],[295,285],[300,293],[293,334],[334,296],[296,336]),vY=Du([474,475],[475,476],[476,477],[477,474]),dP=Du([33,7],[7,163],[163,144],[144,145],[145,153],[153,154],[154,155],[155,133],[33,246],[246,161],[161,160],[160,159],[159,158],[158,157],[157,173],[173,133]),pP=Du([46,53],[53,52],[52,65],[65,55],[70,63],[63,105],[105,66],[66,107]),xY=Du([469,470],[470,471],[471,472],[472,469]),mP=Du([10,338],[338,297],[297,332],[332,284],[284,251],[251,389],[389,356],[356,454],[454,323],[323,361],[361,288],[288,397],[397,365],[365,379],[379,378],[378,400],[400,377],[377,152],[152,148],[148,176],[176,149],[149,150],[150,136],[136,172],[172,58],[58,132],[132,93],[93,234],[234,127],[127,162],[162,21],[21,54],[54,103],[103,67],[67,109],[109,10]),EY=[...uP,...hP,...fP,...dP,...pP,...mP],_Y=Du([127,34],[34,139],[139,127],[11,0],[0,37],[37,11],[232,231],[231,120],[120,232],[72,37],[37,39],[39,72],[128,121],[121,47],[47,128],[232,121],[121,128],[128,232],[104,69],[69,67],[67,104],[175,171],[171,148],[148,175],[118,50],[50,101],[101,118],[73,39],[39,40],[40,73],[9,151],[151,108],[108,9],[48,115],[115,131],[131,48],[194,204],[204,211],[211,194],[74,40],[40,185],[185,74],[80,42],[42,183],[183,80],[40,92],[92,186],[186,40],[230,229],[229,118],[118,230],[202,212],[212,214],[214,202],[83,18],[18,17],[17,83],[76,61],[61,146],[146,76],[160,29],[29,30],[30,160],[56,157],[157,173],[173,56],[106,204],[204,194],[194,106],[135,214],[214,192],[192,135],[203,165],[165,98],[98,203],[21,71],[71,68],[68,21],[51,45],[45,4],[4,51],[144,24],[24,23],[23,144],[77,146],[146,91],[91,77],[205,50],[50,187],[187,205],[201,200],[200,18],[18,201],[91,106],[106,182],[182,91],[90,91],[91,181],[181,90],[85,84],[84,17],[17,85],[206,203],[203,36],[36,206],[148,171],[171,140],[140,148],[92,40],[40,39],[39,92],[193,189],[189,244],[244,193],[159,158],[158,28],[28,159],[247,246],[246,161],[161,247],[236,3],[3,196],[196,236],[54,68],[68,104],[104,54],[193,168],[168,8],[8,193],[117,228],[228,31],[31,117],[189,193],[193,55],[55,189],[98,97],[97,99],[99,98],[126,47],[47,100],[100,126],[166,79],[79,218],[218,166],[155,154],[154,26],[26,155],[209,49],[49,131],[131,209],[135,136],[136,150],[150,135],[47,126],[126,217],[217,47],[223,52],[52,53],[53,223],[45,51],[51,134],[134,45],[211,170],[170,140],[140,211],[67,69],[69,108],[108,67],[43,106],[106,91],[91,43],[230,119],[119,120],[120,230],[226,130],[130,247],[247,226],[63,53],[53,52],[52,63],[238,20],[20,242],[242,238],[46,70],[70,156],[156,46],[78,62],[62,96],[96,78],[46,53],[53,63],[63,46],[143,34],[34,227],[227,143],[123,117],[117,111],[111,123],[44,125],[125,19],[19,44],[236,134],[134,51],[51,236],[216,206],[206,205],[205,216],[154,153],[153,22],[22,154],[39,37],[37,167],[167,39],[200,201],[201,208],[208,200],[36,142],[142,100],[100,36],[57,212],[212,202],[202,57],[20,60],[60,99],[99,20],[28,158],[158,157],[157,28],[35,226],[226,113],[113,35],[160,159],[159,27],[27,160],[204,202],[202,210],[210,204],[113,225],[225,46],[46,113],[43,202],[202,204],[204,43],[62,76],[76,77],[77,62],[137,123],[123,116],[116,137],[41,38],[38,72],[72,41],[203,129],[129,142],[142,203],[64,98],[98,240],[240,64],[49,102],[102,64],[64,49],[41,73],[73,74],[74,41],[212,216],[216,207],[207,212],[42,74],[74,184],[184,42],[169,170],[170,211],[211,169],[170,149],[149,176],[176,170],[105,66],[66,69],[69,105],[122,6],[6,168],[168,122],[123,147],[147,187],[187,123],[96,77],[77,90],[90,96],[65,55],[55,107],[107,65],[89,90],[90,180],[180,89],[101,100],[100,120],[120,101],[63,105],[105,104],[104,63],[93,137],[137,227],[227,93],[15,86],[86,85],[85,15],[129,102],[102,49],[49,129],[14,87],[87,86],[86,14],[55,8],[8,9],[9,55],[100,47],[47,121],[121,100],[145,23],[23,22],[22,145],[88,89],[89,179],[179,88],[6,122],[122,196],[196,6],[88,95],[95,96],[96,88],[138,172],[172,136],[136,138],[215,58],[58,172],[172,215],[115,48],[48,219],[219,115],[42,80],[80,81],[81,42],[195,3],[3,51],[51,195],[43,146],[146,61],[61,43],[171,175],[175,199],[199,171],[81,82],[82,38],[38,81],[53,46],[46,225],[225,53],[144,163],[163,110],[110,144],[52,65],[65,66],[66,52],[229,228],[228,117],[117,229],[34,127],[127,234],[234,34],[107,108],[108,69],[69,107],[109,108],[108,151],[151,109],[48,64],[64,235],[235,48],[62,78],[78,191],[191,62],[129,209],[209,126],[126,129],[111,35],[35,143],[143,111],[117,123],[123,50],[50,117],[222,65],[65,52],[52,222],[19,125],[125,141],[141,19],[221,55],[55,65],[65,221],[3,195],[195,197],[197,3],[25,7],[7,33],[33,25],[220,237],[237,44],[44,220],[70,71],[71,139],[139,70],[122,193],[193,245],[245,122],[247,130],[130,33],[33,247],[71,21],[21,162],[162,71],[170,169],[169,150],[150,170],[188,174],[174,196],[196,188],[216,186],[186,92],[92,216],[2,97],[97,167],[167,2],[141,125],[125,241],[241,141],[164,167],[167,37],[37,164],[72,38],[38,12],[12,72],[38,82],[82,13],[13,38],[63,68],[68,71],[71,63],[226,35],[35,111],[111,226],[101,50],[50,205],[205,101],[206,92],[92,165],[165,206],[209,198],[198,217],[217,209],[165,167],[167,97],[97,165],[220,115],[115,218],[218,220],[133,112],[112,243],[243,133],[239,238],[238,241],[241,239],[214,135],[135,169],[169,214],[190,173],[173,133],[133,190],[171,208],[208,32],[32,171],[125,44],[44,237],[237,125],[86,87],[87,178],[178,86],[85,86],[86,179],[179,85],[84,85],[85,180],[180,84],[83,84],[84,181],[181,83],[201,83],[83,182],[182,201],[137,93],[93,132],[132,137],[76,62],[62,183],[183,76],[61,76],[76,184],[184,61],[57,61],[61,185],[185,57],[212,57],[57,186],[186,212],[214,207],[207,187],[187,214],[34,143],[143,156],[156,34],[79,239],[239,237],[237,79],[123,137],[137,177],[177,123],[44,1],[1,4],[4,44],[201,194],[194,32],[32,201],[64,102],[102,129],[129,64],[213,215],[215,138],[138,213],[59,166],[166,219],[219,59],[242,99],[99,97],[97,242],[2,94],[94,141],[141,2],[75,59],[59,235],[235,75],[24,110],[110,228],[228,24],[25,130],[130,226],[226,25],[23,24],[24,229],[229,23],[22,23],[23,230],[230,22],[26,22],[22,231],[231,26],[112,26],[26,232],[232,112],[189,190],[190,243],[243,189],[221,56],[56,190],[190,221],[28,56],[56,221],[221,28],[27,28],[28,222],[222,27],[29,27],[27,223],[223,29],[30,29],[29,224],[224,30],[247,30],[30,225],[225,247],[238,79],[79,20],[20,238],[166,59],[59,75],[75,166],[60,75],[75,240],[240,60],[147,177],[177,215],[215,147],[20,79],[79,166],[166,20],[187,147],[147,213],[213,187],[112,233],[233,244],[244,112],[233,128],[128,245],[245,233],[128,114],[114,188],[188,128],[114,217],[217,174],[174,114],[131,115],[115,220],[220,131],[217,198],[198,236],[236,217],[198,131],[131,134],[134,198],[177,132],[132,58],[58,177],[143,35],[35,124],[124,143],[110,163],[163,7],[7,110],[228,110],[110,25],[25,228],[356,389],[389,368],[368,356],[11,302],[302,267],[267,11],[452,350],[350,349],[349,452],[302,303],[303,269],[269,302],[357,343],[343,277],[277,357],[452,453],[453,357],[357,452],[333,332],[332,297],[297,333],[175,152],[152,377],[377,175],[347,348],[348,330],[330,347],[303,304],[304,270],[270,303],[9,336],[336,337],[337,9],[278,279],[279,360],[360,278],[418,262],[262,431],[431,418],[304,408],[408,409],[409,304],[310,415],[415,407],[407,310],[270,409],[409,410],[410,270],[450,348],[348,347],[347,450],[422,430],[430,434],[434,422],[313,314],[314,17],[17,313],[306,307],[307,375],[375,306],[387,388],[388,260],[260,387],[286,414],[414,398],[398,286],[335,406],[406,418],[418,335],[364,367],[367,416],[416,364],[423,358],[358,327],[327,423],[251,284],[284,298],[298,251],[281,5],[5,4],[4,281],[373,374],[374,253],[253,373],[307,320],[320,321],[321,307],[425,427],[427,411],[411,425],[421,313],[313,18],[18,421],[321,405],[405,406],[406,321],[320,404],[404,405],[405,320],[315,16],[16,17],[17,315],[426,425],[425,266],[266,426],[377,400],[400,369],[369,377],[322,391],[391,269],[269,322],[417,465],[465,464],[464,417],[386,257],[257,258],[258,386],[466,260],[260,388],[388,466],[456,399],[399,419],[419,456],[284,332],[332,333],[333,284],[417,285],[285,8],[8,417],[346,340],[340,261],[261,346],[413,441],[441,285],[285,413],[327,460],[460,328],[328,327],[355,371],[371,329],[329,355],[392,439],[439,438],[438,392],[382,341],[341,256],[256,382],[429,420],[420,360],[360,429],[364,394],[394,379],[379,364],[277,343],[343,437],[437,277],[443,444],[444,283],[283,443],[275,440],[440,363],[363,275],[431,262],[262,369],[369,431],[297,338],[338,337],[337,297],[273,375],[375,321],[321,273],[450,451],[451,349],[349,450],[446,342],[342,467],[467,446],[293,334],[334,282],[282,293],[458,461],[461,462],[462,458],[276,353],[353,383],[383,276],[308,324],[324,325],[325,308],[276,300],[300,293],[293,276],[372,345],[345,447],[447,372],[352,345],[345,340],[340,352],[274,1],[1,19],[19,274],[456,248],[248,281],[281,456],[436,427],[427,425],[425,436],[381,256],[256,252],[252,381],[269,391],[391,393],[393,269],[200,199],[199,428],[428,200],[266,330],[330,329],[329,266],[287,273],[273,422],[422,287],[250,462],[462,328],[328,250],[258,286],[286,384],[384,258],[265,353],[353,342],[342,265],[387,259],[259,257],[257,387],[424,431],[431,430],[430,424],[342,353],[353,276],[276,342],[273,335],[335,424],[424,273],[292,325],[325,307],[307,292],[366,447],[447,345],[345,366],[271,303],[303,302],[302,271],[423,266],[266,371],[371,423],[294,455],[455,460],[460,294],[279,278],[278,294],[294,279],[271,272],[272,304],[304,271],[432,434],[434,427],[427,432],[272,407],[407,408],[408,272],[394,430],[430,431],[431,394],[395,369],[369,400],[400,395],[334,333],[333,299],[299,334],[351,417],[417,168],[168,351],[352,280],[280,411],[411,352],[325,319],[319,320],[320,325],[295,296],[296,336],[336,295],[319,403],[403,404],[404,319],[330,348],[348,349],[349,330],[293,298],[298,333],[333,293],[323,454],[454,447],[447,323],[15,16],[16,315],[315,15],[358,429],[429,279],[279,358],[14,15],[15,316],[316,14],[285,336],[336,9],[9,285],[329,349],[349,350],[350,329],[374,380],[380,252],[252,374],[318,402],[402,403],[403,318],[6,197],[197,419],[419,6],[318,319],[319,325],[325,318],[367,364],[364,365],[365,367],[435,367],[367,397],[397,435],[344,438],[438,439],[439,344],[272,271],[271,311],[311,272],[195,5],[5,281],[281,195],[273,287],[287,291],[291,273],[396,428],[428,199],[199,396],[311,271],[271,268],[268,311],[283,444],[444,445],[445,283],[373,254],[254,339],[339,373],[282,334],[334,296],[296,282],[449,347],[347,346],[346,449],[264,447],[447,454],[454,264],[336,296],[296,299],[299,336],[338,10],[10,151],[151,338],[278,439],[439,455],[455,278],[292,407],[407,415],[415,292],[358,371],[371,355],[355,358],[340,345],[345,372],[372,340],[346,347],[347,280],[280,346],[442,443],[443,282],[282,442],[19,94],[94,370],[370,19],[441,442],[442,295],[295,441],[248,419],[419,197],[197,248],[263,255],[255,359],[359,263],[440,275],[275,274],[274,440],[300,383],[383,368],[368,300],[351,412],[412,465],[465,351],[263,467],[467,466],[466,263],[301,368],[368,389],[389,301],[395,378],[378,379],[379,395],[412,351],[351,419],[419,412],[436,426],[426,322],[322,436],[2,164],[164,393],[393,2],[370,462],[462,461],[461,370],[164,0],[0,267],[267,164],[302,11],[11,12],[12,302],[268,12],[12,13],[13,268],[293,300],[300,301],[301,293],[446,261],[261,340],[340,446],[330,266],[266,425],[425,330],[426,423],[423,391],[391,426],[429,355],[355,437],[437,429],[391,327],[327,326],[326,391],[440,457],[457,438],[438,440],[341,382],[382,362],[362,341],[459,457],[457,461],[461,459],[434,430],[430,394],[394,434],[414,463],[463,362],[362,414],[396,369],[369,262],[262,396],[354,461],[461,457],[457,354],[316,403],[403,402],[402,316],[315,404],[404,403],[403,315],[314,405],[405,404],[404,314],[313,406],[406,405],[405,313],[421,418],[418,406],[406,421],[366,401],[401,361],[361,366],[306,408],[408,407],[407,306],[291,409],[409,408],[408,291],[287,410],[410,409],[409,287],[432,436],[436,410],[410,432],[434,416],[416,411],[411,434],[264,368],[368,383],[383,264],[309,438],[438,457],[457,309],[352,376],[376,401],[401,352],[274,275],[275,4],[4,274],[421,428],[428,262],[262,421],[294,327],[327,358],[358,294],[433,416],[416,367],[367,433],[289,455],[455,439],[439,289],[462,370],[370,326],[326,462],[2,326],[326,370],[370,2],[305,460],[460,455],[455,305],[254,449],[449,448],[448,254],[255,261],[261,446],[446,255],[253,450],[450,449],[449,253],[252,451],[451,450],[450,252],[256,452],[452,451],[451,256],[341,453],[453,452],[452,341],[413,464],[464,463],[463,413],[441,413],[413,414],[414,441],[258,442],[442,441],[441,258],[257,443],[443,442],[442,257],[259,444],[444,443],[443,259],[260,445],[445,444],[444,260],[467,342],[342,445],[445,467],[459,458],[458,250],[250,459],[289,392],[392,290],[290,289],[290,328],[328,460],[460,290],[376,433],[433,435],[435,376],[250,290],[290,392],[392,250],[411,416],[416,433],[433,411],[341,463],[463,464],[464,341],[453,464],[464,465],[465,453],[357,465],[465,412],[412,357],[343,412],[412,399],[399,343],[360,363],[363,440],[440,360],[437,399],[399,456],[456,437],[420,456],[456,363],[363,420],[401,435],[435,288],[288,401],[372,383],[383,353],[353,372],[339,255],[255,249],[249,339],[448,261],[261,255],[255,448],[133,243],[243,190],[190,133],[133,155],[155,112],[112,133],[33,246],[246,247],[247,33],[33,130],[130,25],[25,33],[398,384],[384,286],[286,398],[362,398],[398,414],[414,362],[362,463],[463,341],[341,362],[263,359],[359,467],[467,263],[263,249],[249,255],[255,263],[466,467],[467,260],[260,466],[75,60],[60,166],[166,75],[238,239],[239,79],[79,238],[162,127],[127,139],[139,162],[72,11],[11,37],[37,72],[121,232],[232,120],[120,121],[73,72],[72,39],[39,73],[114,128],[128,47],[47,114],[233,232],[232,128],[128,233],[103,104],[104,67],[67,103],[152,175],[175,148],[148,152],[119,118],[118,101],[101,119],[74,73],[73,40],[40,74],[107,9],[9,108],[108,107],[49,48],[48,131],[131,49],[32,194],[194,211],[211,32],[184,74],[74,185],[185,184],[191,80],[80,183],[183,191],[185,40],[40,186],[186,185],[119,230],[230,118],[118,119],[210,202],[202,214],[214,210],[84,83],[83,17],[17,84],[77,76],[76,146],[146,77],[161,160],[160,30],[30,161],[190,56],[56,173],[173,190],[182,106],[106,194],[194,182],[138,135],[135,192],[192,138],[129,203],[203,98],[98,129],[54,21],[21,68],[68,54],[5,51],[51,4],[4,5],[145,144],[144,23],[23,145],[90,77],[77,91],[91,90],[207,205],[205,187],[187,207],[83,201],[201,18],[18,83],[181,91],[91,182],[182,181],[180,90],[90,181],[181,180],[16,85],[85,17],[17,16],[205,206],[206,36],[36,205],[176,148],[148,140],[140,176],[165,92],[92,39],[39,165],[245,193],[193,244],[244,245],[27,159],[159,28],[28,27],[30,247],[247,161],[161,30],[174,236],[236,196],[196,174],[103,54],[54,104],[104,103],[55,193],[193,8],[8,55],[111,117],[117,31],[31,111],[221,189],[189,55],[55,221],[240,98],[98,99],[99,240],[142,126],[126,100],[100,142],[219,166],[166,218],[218,219],[112,155],[155,26],[26,112],[198,209],[209,131],[131,198],[169,135],[135,150],[150,169],[114,47],[47,217],[217,114],[224,223],[223,53],[53,224],[220,45],[45,134],[134,220],[32,211],[211,140],[140,32],[109,67],[67,108],[108,109],[146,43],[43,91],[91,146],[231,230],[230,120],[120,231],[113,226],[226,247],[247,113],[105,63],[63,52],[52,105],[241,238],[238,242],[242,241],[124,46],[46,156],[156,124],[95,78],[78,96],[96,95],[70,46],[46,63],[63,70],[116,143],[143,227],[227,116],[116,123],[123,111],[111,116],[1,44],[44,19],[19,1],[3,236],[236,51],[51,3],[207,216],[216,205],[205,207],[26,154],[154,22],[22,26],[165,39],[39,167],[167,165],[199,200],[200,208],[208,199],[101,36],[36,100],[100,101],[43,57],[57,202],[202,43],[242,20],[20,99],[99,242],[56,28],[28,157],[157,56],[124,35],[35,113],[113,124],[29,160],[160,27],[27,29],[211,204],[204,210],[210,211],[124,113],[113,46],[46,124],[106,43],[43,204],[204,106],[96,62],[62,77],[77,96],[227,137],[137,116],[116,227],[73,41],[41,72],[72,73],[36,203],[203,142],[142,36],[235,64],[64,240],[240,235],[48,49],[49,64],[64,48],[42,41],[41,74],[74,42],[214,212],[212,207],[207,214],[183,42],[42,184],[184,183],[210,169],[169,211],[211,210],[140,170],[170,176],[176,140],[104,105],[105,69],[69,104],[193,122],[122,168],[168,193],[50,123],[123,187],[187,50],[89,96],[96,90],[90,89],[66,65],[65,107],[107,66],[179,89],[89,180],[180,179],[119,101],[101,120],[120,119],[68,63],[63,104],[104,68],[234,93],[93,227],[227,234],[16,15],[15,85],[85,16],[209,129],[129,49],[49,209],[15,14],[14,86],[86,15],[107,55],[55,9],[9,107],[120,100],[100,121],[121,120],[153,145],[145,22],[22,153],[178,88],[88,179],[179,178],[197,6],[6,196],[196,197],[89,88],[88,96],[96,89],[135,138],[138,136],[136,135],[138,215],[215,172],[172,138],[218,115],[115,219],[219,218],[41,42],[42,81],[81,41],[5,195],[195,51],[51,5],[57,43],[43,61],[61,57],[208,171],[171,199],[199,208],[41,81],[81,38],[38,41],[224,53],[53,225],[225,224],[24,144],[144,110],[110,24],[105,52],[52,66],[66,105],[118,229],[229,117],[117,118],[227,34],[34,234],[234,227],[66,107],[107,69],[69,66],[10,109],[109,151],[151,10],[219,48],[48,235],[235,219],[183,62],[62,191],[191,183],[142,129],[129,126],[126,142],[116,111],[111,143],[143,116],[118,117],[117,50],[50,118],[223,222],[222,52],[52,223],[94,19],[19,141],[141,94],[222,221],[221,65],[65,222],[196,3],[3,197],[197,196],[45,220],[220,44],[44,45],[156,70],[70,139],[139,156],[188,122],[122,245],[245,188],[139,71],[71,162],[162,139],[149,170],[170,150],[150,149],[122,188],[188,196],[196,122],[206,216],[216,92],[92,206],[164,2],[2,167],[167,164],[242,141],[141,241],[241,242],[0,164],[164,37],[37,0],[11,72],[72,12],[12,11],[12,38],[38,13],[13,12],[70,63],[63,71],[71,70],[31,226],[226,111],[111,31],[36,101],[101,205],[205,36],[203,206],[206,165],[165,203],[126,209],[209,217],[217,126],[98,165],[165,97],[97,98],[237,220],[220,218],[218,237],[237,239],[239,241],[241,237],[210,214],[214,169],[169,210],[140,171],[171,32],[32,140],[241,125],[125,237],[237,241],[179,86],[86,178],[178,179],[180,85],[85,179],[179,180],[181,84],[84,180],[180,181],[182,83],[83,181],[181,182],[194,201],[201,182],[182,194],[177,137],[137,132],[132,177],[184,76],[76,183],[183,184],[185,61],[61,184],[184,185],[186,57],[57,185],[185,186],[216,212],[212,186],[186,216],[192,214],[214,187],[187,192],[139,34],[34,156],[156,139],[218,79],[79,237],[237,218],[147,123],[123,177],[177,147],[45,44],[44,4],[4,45],[208,201],[201,32],[32,208],[98,64],[64,129],[129,98],[192,213],[213,138],[138,192],[235,59],[59,219],[219,235],[141,242],[242,97],[97,141],[97,2],[2,141],[141,97],[240,75],[75,235],[235,240],[229,24],[24,228],[228,229],[31,25],[25,226],[226,31],[230,23],[23,229],[229,230],[231,22],[22,230],[230,231],[232,26],[26,231],[231,232],[233,112],[112,232],[232,233],[244,189],[189,243],[243,244],[189,221],[221,190],[190,189],[222,28],[28,221],[221,222],[223,27],[27,222],[222,223],[224,29],[29,223],[223,224],[225,30],[30,224],[224,225],[113,247],[247,225],[225,113],[99,60],[60,240],[240,99],[213,147],[147,215],[215,213],[60,20],[20,166],[166,60],[192,187],[187,213],[213,192],[243,112],[112,244],[244,243],[244,233],[233,245],[245,244],[245,128],[128,188],[188,245],[188,114],[114,174],[174,188],[134,131],[131,220],[220,134],[174,217],[217,236],[236,174],[236,198],[198,134],[134,236],[215,177],[177,58],[58,215],[156,143],[143,124],[124,156],[25,110],[110,7],[7,25],[31,228],[228,25],[25,31],[264,356],[356,368],[368,264],[0,11],[11,267],[267,0],[451,452],[452,349],[349,451],[267,302],[302,269],[269,267],[350,357],[357,277],[277,350],[350,452],[452,357],[357,350],[299,333],[333,297],[297,299],[396,175],[175,377],[377,396],[280,347],[347,330],[330,280],[269,303],[303,270],[270,269],[151,9],[9,337],[337,151],[344,278],[278,360],[360,344],[424,418],[418,431],[431,424],[270,304],[304,409],[409,270],[272,310],[310,407],[407,272],[322,270],[270,410],[410,322],[449,450],[450,347],[347,449],[432,422],[422,434],[434,432],[18,313],[313,17],[17,18],[291,306],[306,375],[375,291],[259,387],[387,260],[260,259],[424,335],[335,418],[418,424],[434,364],[364,416],[416,434],[391,423],[423,327],[327,391],[301,251],[251,298],[298,301],[275,281],[281,4],[4,275],[254,373],[373,253],[253,254],[375,307],[307,321],[321,375],[280,425],[425,411],[411,280],[200,421],[421,18],[18,200],[335,321],[321,406],[406,335],[321,320],[320,405],[405,321],[314,315],[315,17],[17,314],[423,426],[426,266],[266,423],[396,377],[377,369],[369,396],[270,322],[322,269],[269,270],[413,417],[417,464],[464,413],[385,386],[386,258],[258,385],[248,456],[456,419],[419,248],[298,284],[284,333],[333,298],[168,417],[417,8],[8,168],[448,346],[346,261],[261,448],[417,413],[413,285],[285,417],[326,327],[327,328],[328,326],[277,355],[355,329],[329,277],[309,392],[392,438],[438,309],[381,382],[382,256],[256,381],[279,429],[429,360],[360,279],[365,364],[364,379],[379,365],[355,277],[277,437],[437,355],[282,443],[443,283],[283,282],[281,275],[275,363],[363,281],[395,431],[431,369],[369,395],[299,297],[297,337],[337,299],[335,273],[273,321],[321,335],[348,450],[450,349],[349,348],[359,446],[446,467],[467,359],[283,293],[293,282],[282,283],[250,458],[458,462],[462,250],[300,276],[276,383],[383,300],[292,308],[308,325],[325,292],[283,276],[276,293],[293,283],[264,372],[372,447],[447,264],[346,352],[352,340],[340,346],[354,274],[274,19],[19,354],[363,456],[456,281],[281,363],[426,436],[436,425],[425,426],[380,381],[381,252],[252,380],[267,269],[269,393],[393,267],[421,200],[200,428],[428,421],[371,266],[266,329],[329,371],[432,287],[287,422],[422,432],[290,250],[250,328],[328,290],[385,258],[258,384],[384,385],[446,265],[265,342],[342,446],[386,387],[387,257],[257,386],[422,424],[424,430],[430,422],[445,342],[342,276],[276,445],[422,273],[273,424],[424,422],[306,292],[292,307],[307,306],[352,366],[366,345],[345,352],[268,271],[271,302],[302,268],[358,423],[423,371],[371,358],[327,294],[294,460],[460,327],[331,279],[279,294],[294,331],[303,271],[271,304],[304,303],[436,432],[432,427],[427,436],[304,272],[272,408],[408,304],[395,394],[394,431],[431,395],[378,395],[395,400],[400,378],[296,334],[334,299],[299,296],[6,351],[351,168],[168,6],[376,352],[352,411],[411,376],[307,325],[325,320],[320,307],[285,295],[295,336],[336,285],[320,319],[319,404],[404,320],[329,330],[330,349],[349,329],[334,293],[293,333],[333,334],[366,323],[323,447],[447,366],[316,15],[15,315],[315,316],[331,358],[358,279],[279,331],[317,14],[14,316],[316,317],[8,285],[285,9],[9,8],[277,329],[329,350],[350,277],[253,374],[374,252],[252,253],[319,318],[318,403],[403,319],[351,6],[6,419],[419,351],[324,318],[318,325],[325,324],[397,367],[367,365],[365,397],[288,435],[435,397],[397,288],[278,344],[344,439],[439,278],[310,272],[272,311],[311,310],[248,195],[195,281],[281,248],[375,273],[273,291],[291,375],[175,396],[396,199],[199,175],[312,311],[311,268],[268,312],[276,283],[283,445],[445,276],[390,373],[373,339],[339,390],[295,282],[282,296],[296,295],[448,449],[449,346],[346,448],[356,264],[264,454],[454,356],[337,336],[336,299],[299,337],[337,338],[338,151],[151,337],[294,278],[278,455],[455,294],[308,292],[292,415],[415,308],[429,358],[358,355],[355,429],[265,340],[340,372],[372,265],[352,346],[346,280],[280,352],[295,442],[442,282],[282,295],[354,19],[19,370],[370,354],[285,441],[441,295],[295,285],[195,248],[248,197],[197,195],[457,440],[440,274],[274,457],[301,300],[300,368],[368,301],[417,351],[351,465],[465,417],[251,301],[301,389],[389,251],[394,395],[395,379],[379,394],[399,412],[412,419],[419,399],[410,436],[436,322],[322,410],[326,2],[2,393],[393,326],[354,370],[370,461],[461,354],[393,164],[164,267],[267,393],[268,302],[302,12],[12,268],[312,268],[268,13],[13,312],[298,293],[293,301],[301,298],[265,446],[446,340],[340,265],[280,330],[330,425],[425,280],[322,426],[426,391],[391,322],[420,429],[429,437],[437,420],[393,391],[391,326],[326,393],[344,440],[440,438],[438,344],[458,459],[459,461],[461,458],[364,434],[434,394],[394,364],[428,396],[396,262],[262,428],[274,354],[354,457],[457,274],[317,316],[316,402],[402,317],[316,315],[315,403],[403,316],[315,314],[314,404],[404,315],[314,313],[313,405],[405,314],[313,421],[421,406],[406,313],[323,366],[366,361],[361,323],[292,306],[306,407],[407,292],[306,291],[291,408],[408,306],[291,287],[287,409],[409,291],[287,432],[432,410],[410,287],[427,434],[434,411],[411,427],[372,264],[264,383],[383,372],[459,309],[309,457],[457,459],[366,352],[352,401],[401,366],[1,274],[274,4],[4,1],[418,421],[421,262],[262,418],[331,294],[294,358],[358,331],[435,433],[433,367],[367,435],[392,289],[289,439],[439,392],[328,462],[462,326],[326,328],[94,2],[2,370],[370,94],[289,305],[305,455],[455,289],[339,254],[254,448],[448,339],[359,255],[255,446],[446,359],[254,253],[253,449],[449,254],[253,252],[252,450],[450,253],[252,256],[256,451],[451,252],[256,341],[341,452],[452,256],[414,413],[413,463],[463,414],[286,441],[441,414],[414,286],[286,258],[258,441],[441,286],[258,257],[257,442],[442,258],[257,259],[259,443],[443,257],[259,260],[260,444],[444,259],[260,467],[467,445],[445,260],[309,459],[459,250],[250,309],[305,289],[289,290],[290,305],[305,290],[290,460],[460,305],[401,376],[376,435],[435,401],[309,250],[250,392],[392,309],[376,411],[411,433],[433,376],[453,341],[341,464],[464,453],[357,453],[453,465],[465,357],[343,357],[357,412],[412,343],[437,343],[343,399],[399,437],[344,360],[360,440],[440,344],[420,437],[437,456],[456,420],[360,420],[420,363],[363,360],[361,401],[401,288],[288,361],[265,372],[372,353],[353,265],[390,339],[339,249],[249,390],[339,448],[448,255],[255,339]);function xN(i){i.j={faceLandmarks:[],faceBlendshapes:[],facialTransformationMatrixes:[]}}var Qr=class extends Ca{constructor(i,e){super(new wc(i,e),"image_in","norm_rect",!1),this.j={faceLandmarks:[],faceBlendshapes:[],facialTransformationMatrixes:[]},this.outputFacialTransformationMatrixes=this.outputFaceBlendshapes=!1,Cn(i=this.h=new VK,0,1,e=new Fr),this.v=new QK,Cn(this.h,0,3,this.v),this.s=new tC,Cn(this.h,0,2,this.s),wh(this.s,4,1),hn(this.s,2,.5),hn(this.v,2,.5),hn(this.h,4,.5)}get baseOptions(){return wi(this.h,Fr,1)}set baseOptions(i){Cn(this.h,0,1,i)}o(i){return"numFaces"in i&&wh(this.s,4,i.numFaces??1),"minFaceDetectionConfidence"in i&&hn(this.s,2,i.minFaceDetectionConfidence??.5),"minTrackingConfidence"in i&&hn(this.h,4,i.minTrackingConfidence??.5),"minFacePresenceConfidence"in i&&hn(this.v,2,i.minFacePresenceConfidence??.5),"outputFaceBlendshapes"in i&&(this.outputFaceBlendshapes=!!i.outputFaceBlendshapes),"outputFacialTransformationMatrixes"in i&&(this.outputFacialTransformationMatrixes=!!i.outputFacialTransformationMatrixes),this.l(i)}D(i,e){return xN(this),Cc(this,i,e),this.j}F(i,e,t){return xN(this),Ih(this,i,t,e),this.j}m(){var i=new sl;Mr(i,"image_in"),Mr(i,"norm_rect"),Ii(i,"face_landmarks");const e=new Fl;Lu(e,QEe,this.h);const t=new wa;Ol(t,"mediapipe.tasks.vision.face_landmarker.FaceLandmarkerGraph"),yr(t,"IMAGE:image_in"),yr(t,"NORM_RECT:norm_rect"),mi(t,"NORM_LANDMARKS:face_landmarks"),t.o(e),Nl(i,t),this.g.attachProtoVectorListener("face_landmarks",((n,r)=>{for(const s of n)n=Dx(s),this.j.faceLandmarks.push(nC(n));en(this,r)})),this.g.attachEmptyPacketListener("face_landmarks",(n=>{en(this,n)})),this.outputFaceBlendshapes&&(Ii(i,"blendshapes"),mi(t,"BLENDSHAPES:blendshapes"),this.g.attachProtoVectorListener("blendshapes",((n,r)=>{if(this.outputFaceBlendshapes)for(const s of n)n=eC(s),this.j.faceBlendshapes.push(rP(n.g()??[]));en(this,r)})),this.g.attachEmptyPacketListener("blendshapes",(n=>{en(this,n)}))),this.outputFacialTransformationMatrixes&&(Ii(i,"face_geometry"),mi(t,"FACE_GEOMETRY:face_geometry"),this.g.attachProtoVectorListener("face_geometry",((n,r)=>{if(this.outputFacialTransformationMatrixes)for(const s of n)(n=wi(HEe(s),BEe,2))&&this.j.facialTransformationMatrixes.push({rows:bu(mc(n,1),0)??0,columns:bu(mc(n,2),0)??0,data:Nm(n,3,Ep,Om()).slice()??[]});en(this,r)})),this.g.attachEmptyPacketListener("face_geometry",(n=>{en(this,n)}))),i=i.g(),this.setGraph(new Uint8Array(i),!0)}};Qr.prototype.detectForVideo=Qr.prototype.F,Qr.prototype.detect=Qr.prototype.D,Qr.prototype.setOptions=Qr.prototype.o,Qr.createFromModelPath=function(i,e){return di(Qr,i,{baseOptions:{modelAssetPath:e}})},Qr.createFromModelBuffer=function(i,e){return di(Qr,i,{baseOptions:{modelAssetBuffer:e}})},Qr.createFromOptions=function(i,e){return di(Qr,i,e)},Qr.FACE_LANDMARKS_LIPS=uP,Qr.FACE_LANDMARKS_LEFT_EYE=hP,Qr.FACE_LANDMARKS_LEFT_EYEBROW=fP,Qr.FACE_LANDMARKS_LEFT_IRIS=vY,Qr.FACE_LANDMARKS_RIGHT_EYE=dP,Qr.FACE_LANDMARKS_RIGHT_EYEBROW=pP,Qr.FACE_LANDMARKS_RIGHT_IRIS=xY,Qr.FACE_LANDMARKS_FACE_OVAL=mP,Qr.FACE_LANDMARKS_CONTOURS=EY,Qr.FACE_LANDMARKS_TESSELATION=_Y;var cu=class extends Ca{constructor(i,e){super(new wc(i,e),"image_in","norm_rect",!0),Cn(i=this.j=new WK,0,1,e=new Fr)}get baseOptions(){return wi(this.j,Fr,1)}set baseOptions(i){Cn(this.j,0,1,i)}o(i){return super.l(i)}Ra(i,e,t){const n=typeof e!="function"?e:{};if(this.h=typeof e=="function"?e:t,Cc(this,i,n??{}),!this.h)return this.s}m(){var i=new sl;Mr(i,"image_in"),Mr(i,"norm_rect"),Ii(i,"stylized_image");const e=new Fl;Lu(e,VEe,this.j);const t=new wa;Ol(t,"mediapipe.tasks.vision.face_stylizer.FaceStylizerGraph"),yr(t,"IMAGE:image_in"),yr(t,"NORM_RECT:norm_rect"),mi(t,"STYLIZED_IMAGE:stylized_image"),t.o(e),Nl(i,t),this.g.W("stylized_image",((n,r)=>{var s=!this.h,o=n.data,a=n.width;const l=a*(n=n.height);if(o instanceof Uint8Array)if(o.length===3*l){const c=new Uint8ClampedArray(4*l);for(let u=0;u<l;++u)c[4*u]=o[3*u],c[4*u+1]=o[3*u+1],c[4*u+2]=o[3*u+2],c[4*u+3]=255;o=new ImageData(c,a,n)}else{if(o.length!==4*l)throw Error("Unsupported channel count: "+o.length/l);o=new ImageData(new Uint8ClampedArray(o.buffer,o.byteOffset,o.length),a,n)}else if(!(o instanceof WebGLTexture))throw Error(`Unsupported format: ${o.constructor.name}`);a=new qs([o],!1,!1,this.g.i.canvas,this.R,a,n),this.s=s=s?a.clone():a,this.h&&this.h(s),en(this,r)})),this.g.attachEmptyPacketListener("stylized_image",(n=>{this.s=null,this.h&&this.h(null),en(this,n)})),i=i.g(),this.setGraph(new Uint8Array(i),!0)}};cu.prototype.stylize=cu.prototype.Ra,cu.prototype.setOptions=cu.prototype.o,cu.createFromModelPath=function(i,e){return di(cu,i,{baseOptions:{modelAssetPath:e}})},cu.createFromModelBuffer=function(i,e){return di(cu,i,{baseOptions:{modelAssetBuffer:e}})},cu.createFromOptions=function(i,e){return di(cu,i,e)};var gP=Du([0,1],[1,2],[2,3],[3,4],[0,5],[5,6],[6,7],[7,8],[5,9],[9,10],[10,11],[11,12],[9,13],[13,14],[14,15],[15,16],[13,17],[0,17],[17,18],[18,19],[19,20]);function EN(i){i.gestures=[],i.landmarks=[],i.worldLandmarks=[],i.handedness=[]}function _N(i){return i.gestures.length===0?{gestures:[],landmarks:[],worldLandmarks:[],handedness:[],handednesses:[]}:{gestures:i.gestures,landmarks:i.landmarks,worldLandmarks:i.worldLandmarks,handedness:i.handedness,handednesses:i.handedness}}function SN(i,e=!0){const t=[];for(const r of i){var n=eC(r);i=[];for(const s of n.g())n=e&&mc(s,1)!=null?bu(mc(s,1),0):-1,i.push({score:ms(s,2)??0,index:n,categoryName:Sh(s,3)??"",displayName:Sh(s,4)??""});t.push(i)}return t}var Qa=class extends Ca{constructor(i,e){super(new wc(i,e),"image_in","norm_rect",!1),this.gestures=[],this.landmarks=[],this.worldLandmarks=[],this.handedness=[],Cn(i=this.j=new XK,0,1,e=new Fr),this.s=new tP,Cn(this.j,0,2,this.s),this.C=new eP,Cn(this.s,0,3,this.C),this.v=new $K,Cn(this.s,0,2,this.v),this.h=new jEe,Cn(this.j,0,3,this.h),hn(this.v,2,.5),hn(this.s,4,.5),hn(this.C,2,.5)}get baseOptions(){return wi(this.j,Fr,1)}set baseOptions(i){Cn(this.j,0,1,i)}o(i){var r,s,o,a;if(wh(this.v,3,i.numHands??1),"minHandDetectionConfidence"in i&&hn(this.v,2,i.minHandDetectionConfidence??.5),"minTrackingConfidence"in i&&hn(this.s,4,i.minTrackingConfidence??.5),"minHandPresenceConfidence"in i&&hn(this.C,2,i.minHandPresenceConfidence??.5),i.cannedGesturesClassifierOptions){var e=new x1,t=e,n=f6(i.cannedGesturesClassifierOptions,(r=wi(this.h,x1,3))==null?void 0:r.h());Cn(t,0,2,n),Cn(this.h,0,3,e)}else i.cannedGesturesClassifierOptions===void 0&&((s=wi(this.h,x1,3))==null||s.g());return i.customGesturesClassifierOptions?(Cn(t=e=new x1,0,2,n=f6(i.customGesturesClassifierOptions,(o=wi(this.h,x1,4))==null?void 0:o.h())),Cn(this.h,0,4,e)):i.customGesturesClassifierOptions===void 0&&((a=wi(this.h,x1,4))==null||a.g()),this.l(i)}Ma(i,e){return EN(this),Cc(this,i,e),_N(this)}Na(i,e,t){return EN(this),Ih(this,i,t,e),_N(this)}m(){var i=new sl;Mr(i,"image_in"),Mr(i,"norm_rect"),Ii(i,"hand_gestures"),Ii(i,"hand_landmarks"),Ii(i,"world_hand_landmarks"),Ii(i,"handedness");const e=new Fl;Lu(e,YEe,this.j);const t=new wa;Ol(t,"mediapipe.tasks.vision.gesture_recognizer.GestureRecognizerGraph"),yr(t,"IMAGE:image_in"),yr(t,"NORM_RECT:norm_rect"),mi(t,"HAND_GESTURES:hand_gestures"),mi(t,"LANDMARKS:hand_landmarks"),mi(t,"WORLD_LANDMARKS:world_hand_landmarks"),mi(t,"HANDEDNESS:handedness"),t.o(e),Nl(i,t),this.g.attachProtoVectorListener("hand_landmarks",((n,r)=>{for(const s of n){n=Dx(s);const o=[];for(const a of Gf(n,kK,1))o.push({x:ms(a,1)??0,y:ms(a,2)??0,z:ms(a,3)??0,visibility:ms(a,4)??0});this.landmarks.push(o)}en(this,r)})),this.g.attachEmptyPacketListener("hand_landmarks",(n=>{en(this,n)})),this.g.attachProtoVectorListener("world_hand_landmarks",((n,r)=>{for(const s of n){n=Z1(s);const o=[];for(const a of Gf(n,DK,1))o.push({x:ms(a,1)??0,y:ms(a,2)??0,z:ms(a,3)??0,visibility:ms(a,4)??0});this.worldLandmarks.push(o)}en(this,r)})),this.g.attachEmptyPacketListener("world_hand_landmarks",(n=>{en(this,n)})),this.g.attachProtoVectorListener("hand_gestures",((n,r)=>{this.gestures.push(...SN(n,!1)),en(this,r)})),this.g.attachEmptyPacketListener("hand_gestures",(n=>{en(this,n)})),this.g.attachProtoVectorListener("handedness",((n,r)=>{this.handedness.push(...SN(n)),en(this,r)})),this.g.attachEmptyPacketListener("handedness",(n=>{en(this,n)})),i=i.g(),this.setGraph(new Uint8Array(i),!0)}};function wN(i){return{landmarks:i.landmarks,worldLandmarks:i.worldLandmarks,handednesses:i.handedness,handedness:i.handedness}}Qa.prototype.recognizeForVideo=Qa.prototype.Na,Qa.prototype.recognize=Qa.prototype.Ma,Qa.prototype.setOptions=Qa.prototype.o,Qa.createFromModelPath=function(i,e){return di(Qa,i,{baseOptions:{modelAssetPath:e}})},Qa.createFromModelBuffer=function(i,e){return di(Qa,i,{baseOptions:{modelAssetBuffer:e}})},Qa.createFromOptions=function(i,e){return di(Qa,i,e)},Qa.HAND_CONNECTIONS=gP;var Va=class extends Ca{constructor(i,e){super(new wc(i,e),"image_in","norm_rect",!1),this.landmarks=[],this.worldLandmarks=[],this.handedness=[],Cn(i=this.h=new tP,0,1,e=new Fr),this.s=new eP,Cn(this.h,0,3,this.s),this.j=new $K,Cn(this.h,0,2,this.j),wh(this.j,3,1),hn(this.j,2,.5),hn(this.s,2,.5),hn(this.h,4,.5)}get baseOptions(){return wi(this.h,Fr,1)}set baseOptions(i){Cn(this.h,0,1,i)}o(i){return"numHands"in i&&wh(this.j,3,i.numHands??1),"minHandDetectionConfidence"in i&&hn(this.j,2,i.minHandDetectionConfidence??.5),"minTrackingConfidence"in i&&hn(this.h,4,i.minTrackingConfidence??.5),"minHandPresenceConfidence"in i&&hn(this.s,2,i.minHandPresenceConfidence??.5),this.l(i)}D(i,e){return this.landmarks=[],this.worldLandmarks=[],this.handedness=[],Cc(this,i,e),wN(this)}F(i,e,t){return this.landmarks=[],this.worldLandmarks=[],this.handedness=[],Ih(this,i,t,e),wN(this)}m(){var i=new sl;Mr(i,"image_in"),Mr(i,"norm_rect"),Ii(i,"hand_landmarks"),Ii(i,"world_hand_landmarks"),Ii(i,"handedness");const e=new Fl;Lu(e,KEe,this.h);const t=new wa;Ol(t,"mediapipe.tasks.vision.hand_landmarker.HandLandmarkerGraph"),yr(t,"IMAGE:image_in"),yr(t,"NORM_RECT:norm_rect"),mi(t,"LANDMARKS:hand_landmarks"),mi(t,"WORLD_LANDMARKS:world_hand_landmarks"),mi(t,"HANDEDNESS:handedness"),t.o(e),Nl(i,t),this.g.attachProtoVectorListener("hand_landmarks",((n,r)=>{for(const s of n)n=Dx(s),this.landmarks.push(nC(n));en(this,r)})),this.g.attachEmptyPacketListener("hand_landmarks",(n=>{en(this,n)})),this.g.attachProtoVectorListener("world_hand_landmarks",((n,r)=>{for(const s of n)n=Z1(s),this.worldLandmarks.push(v2(n));en(this,r)})),this.g.attachEmptyPacketListener("world_hand_landmarks",(n=>{en(this,n)})),this.g.attachProtoVectorListener("handedness",((n,r)=>{var s=this.handedness,o=s.push;const a=[];for(const l of n){n=eC(l);const c=[];for(const u of n.g())c.push({score:ms(u,2)??0,index:bu(mc(u,1),0)??-1,categoryName:Sh(u,3)??"",displayName:Sh(u,4)??""});a.push(c)}o.call(s,...a),en(this,r)})),this.g.attachEmptyPacketListener("handedness",(n=>{en(this,n)})),i=i.g(),this.setGraph(new Uint8Array(i),!0)}};Va.prototype.detectForVideo=Va.prototype.F,Va.prototype.detect=Va.prototype.D,Va.prototype.setOptions=Va.prototype.o,Va.createFromModelPath=function(i,e){return di(Va,i,{baseOptions:{modelAssetPath:e}})},Va.createFromModelBuffer=function(i,e){return di(Va,i,{baseOptions:{modelAssetBuffer:e}})},Va.createFromOptions=function(i,e){return di(Va,i,e)},Va.HAND_CONNECTIONS=gP;var SY=Du([0,1],[1,2],[2,3],[3,7],[0,4],[4,5],[5,6],[6,8],[9,10],[11,12],[11,13],[13,15],[15,17],[15,19],[15,21],[17,19],[12,14],[14,16],[16,18],[16,20],[16,22],[18,20],[11,23],[12,24],[23,24],[23,25],[24,26],[25,27],[26,28],[27,29],[28,30],[29,31],[30,32],[27,31],[28,32]);function CN(i){i.h={faceLandmarks:[],faceBlendshapes:[],poseLandmarks:[],poseWorldLandmarks:[],poseSegmentationMasks:[],leftHandLandmarks:[],leftHandWorldLandmarks:[],rightHandLandmarks:[],rightHandWorldLandmarks:[]}}function TN(i){try{if(!i.C)return i.h;i.C(i.h)}finally{rC(i)}}function G_(i,e){i=Dx(i),e.push(nC(i))}var wr=class extends Ca{constructor(i,e){super(new wc(i,e),"input_frames_image",null,!1),this.h={faceLandmarks:[],faceBlendshapes:[],poseLandmarks:[],poseWorldLandmarks:[],poseSegmentationMasks:[],leftHandLandmarks:[],leftHandWorldLandmarks:[],rightHandLandmarks:[],rightHandWorldLandmarks:[]},this.outputPoseSegmentationMasks=this.outputFaceBlendshapes=!1,Cn(i=this.j=new nY,0,1,e=new Fr),this.K=new eP,Cn(this.j,0,2,this.K),this.ca=new $Ee,Cn(this.j,0,3,this.ca),this.s=new tC,Cn(this.j,0,4,this.s),this.I=new QK,Cn(this.j,0,5,this.I),this.v=new eY,Cn(this.j,0,6,this.v),this.L=new tY,Cn(this.j,0,7,this.L),hn(this.s,2,.5),hn(this.s,3,.3),hn(this.I,2,.5),hn(this.v,2,.5),hn(this.v,3,.3),hn(this.L,2,.5),hn(this.K,2,.5)}get baseOptions(){return wi(this.j,Fr,1)}set baseOptions(i){Cn(this.j,0,1,i)}o(i){return"minFaceDetectionConfidence"in i&&hn(this.s,2,i.minFaceDetectionConfidence??.5),"minFaceSuppressionThreshold"in i&&hn(this.s,3,i.minFaceSuppressionThreshold??.3),"minFacePresenceConfidence"in i&&hn(this.I,2,i.minFacePresenceConfidence??.5),"outputFaceBlendshapes"in i&&(this.outputFaceBlendshapes=!!i.outputFaceBlendshapes),"minPoseDetectionConfidence"in i&&hn(this.v,2,i.minPoseDetectionConfidence??.5),"minPoseSuppressionThreshold"in i&&hn(this.v,3,i.minPoseSuppressionThreshold??.3),"minPosePresenceConfidence"in i&&hn(this.L,2,i.minPosePresenceConfidence??.5),"outputPoseSegmentationMasks"in i&&(this.outputPoseSegmentationMasks=!!i.outputPoseSegmentationMasks),"minHandLandmarksConfidence"in i&&hn(this.K,2,i.minHandLandmarksConfidence??.5),this.l(i)}D(i,e,t){const n=typeof e!="function"?e:{};return this.C=typeof e=="function"?e:t,CN(this),Cc(this,i,n),TN(this)}F(i,e,t,n){const r=typeof t!="function"?t:{};return this.C=typeof t=="function"?t:n,CN(this),Ih(this,i,r,e),TN(this)}m(){var i=new sl;Mr(i,"input_frames_image"),Ii(i,"pose_landmarks"),Ii(i,"pose_world_landmarks"),Ii(i,"face_landmarks"),Ii(i,"left_hand_landmarks"),Ii(i,"left_hand_world_landmarks"),Ii(i,"right_hand_landmarks"),Ii(i,"right_hand_world_landmarks");const e=new Fl,t=new JO;i6(t,1,FA("type.googleapis.com/mediapipe.tasks.vision.holistic_landmarker.proto.HolisticLandmarkerGraphOptions"),""),(function(r,s){if(s!=null)if(Array.isArray(s))Ar(r,2,Q4(s,F8,void 0,void 0,!1));else{if(!(typeof s=="string"||s instanceof kf||Mx(s)))throw Error("invalid value in Any.value field: "+s+" expected a ByteString, a base64 encoded string, a Uint8Array or a jspb array");i6(r,2,T8(s,!1,!1),l0())}})(t,this.j.g());const n=new wa;Ol(n,"mediapipe.tasks.vision.holistic_landmarker.HolisticLandmarkerGraph"),cw(n,8,JO,t),yr(n,"IMAGE:input_frames_image"),mi(n,"POSE_LANDMARKS:pose_landmarks"),mi(n,"POSE_WORLD_LANDMARKS:pose_world_landmarks"),mi(n,"FACE_LANDMARKS:face_landmarks"),mi(n,"LEFT_HAND_LANDMARKS:left_hand_landmarks"),mi(n,"LEFT_HAND_WORLD_LANDMARKS:left_hand_world_landmarks"),mi(n,"RIGHT_HAND_LANDMARKS:right_hand_landmarks"),mi(n,"RIGHT_HAND_WORLD_LANDMARKS:right_hand_world_landmarks"),n.o(e),Nl(i,n),iC(this,i),this.g.attachProtoListener("pose_landmarks",((r,s)=>{G_(r,this.h.poseLandmarks),en(this,s)})),this.g.attachEmptyPacketListener("pose_landmarks",(r=>{en(this,r)})),this.g.attachProtoListener("pose_world_landmarks",((r,s)=>{var o=this.h.poseWorldLandmarks;r=Z1(r),o.push(v2(r)),en(this,s)})),this.g.attachEmptyPacketListener("pose_world_landmarks",(r=>{en(this,r)})),this.outputPoseSegmentationMasks&&(mi(n,"POSE_SEGMENTATION_MASK:pose_segmentation_mask"),AA(this,"pose_segmentation_mask"),this.g.W("pose_segmentation_mask",((r,s)=>{this.h.poseSegmentationMasks=[xA(this,r,!0,!this.C)],en(this,s)})),this.g.attachEmptyPacketListener("pose_segmentation_mask",(r=>{this.h.poseSegmentationMasks=[],en(this,r)}))),this.g.attachProtoListener("face_landmarks",((r,s)=>{G_(r,this.h.faceLandmarks),en(this,s)})),this.g.attachEmptyPacketListener("face_landmarks",(r=>{en(this,r)})),this.outputFaceBlendshapes&&(Ii(i,"extra_blendshapes"),mi(n,"FACE_BLENDSHAPES:extra_blendshapes"),this.g.attachProtoListener("extra_blendshapes",((r,s)=>{var o=this.h.faceBlendshapes;this.outputFaceBlendshapes&&(r=eC(r),o.push(rP(r.g()??[]))),en(this,s)})),this.g.attachEmptyPacketListener("extra_blendshapes",(r=>{en(this,r)}))),this.g.attachProtoListener("left_hand_landmarks",((r,s)=>{G_(r,this.h.leftHandLandmarks),en(this,s)})),this.g.attachEmptyPacketListener("left_hand_landmarks",(r=>{en(this,r)})),this.g.attachProtoListener("left_hand_world_landmarks",((r,s)=>{var o=this.h.leftHandWorldLandmarks;r=Z1(r),o.push(v2(r)),en(this,s)})),this.g.attachEmptyPacketListener("left_hand_world_landmarks",(r=>{en(this,r)})),this.g.attachProtoListener("right_hand_landmarks",((r,s)=>{G_(r,this.h.rightHandLandmarks),en(this,s)})),this.g.attachEmptyPacketListener("right_hand_landmarks",(r=>{en(this,r)})),this.g.attachProtoListener("right_hand_world_landmarks",((r,s)=>{var o=this.h.rightHandWorldLandmarks;r=Z1(r),o.push(v2(r)),en(this,s)})),this.g.attachEmptyPacketListener("right_hand_world_landmarks",(r=>{en(this,r)})),i=i.g(),this.setGraph(new Uint8Array(i),!0)}};wr.prototype.detectForVideo=wr.prototype.F,wr.prototype.detect=wr.prototype.D,wr.prototype.setOptions=wr.prototype.o,wr.createFromModelPath=function(i,e){return di(wr,i,{baseOptions:{modelAssetPath:e}})},wr.createFromModelBuffer=function(i,e){return di(wr,i,{baseOptions:{modelAssetBuffer:e}})},wr.createFromOptions=function(i,e){return di(wr,i,e)},wr.HAND_CONNECTIONS=gP,wr.POSE_CONNECTIONS=SY,wr.FACE_LANDMARKS_LIPS=uP,wr.FACE_LANDMARKS_LEFT_EYE=hP,wr.FACE_LANDMARKS_LEFT_EYEBROW=fP,wr.FACE_LANDMARKS_LEFT_IRIS=vY,wr.FACE_LANDMARKS_RIGHT_EYE=dP,wr.FACE_LANDMARKS_RIGHT_EYEBROW=pP,wr.FACE_LANDMARKS_RIGHT_IRIS=xY,wr.FACE_LANDMARKS_FACE_OVAL=mP,wr.FACE_LANDMARKS_CONTOURS=EY,wr.FACE_LANDMARKS_TESSELATION=_Y;var Sl=class extends Ca{constructor(i,e){super(new wc(i,e),"input_image","norm_rect",!0),this.j={classifications:[]},Cn(i=this.h=new iY,0,1,e=new Fr)}get baseOptions(){return wi(this.h,Fr,1)}set baseOptions(i){Cn(this.h,0,1,i)}o(i){return Cn(this.h,0,2,f6(i,wi(this.h,q8,2))),this.l(i)}wa(i,e){return this.j={classifications:[]},Cc(this,i,e),this.j}xa(i,e,t){return this.j={classifications:[]},Ih(this,i,t,e),this.j}m(){var i=new sl;Mr(i,"input_image"),Mr(i,"norm_rect"),Ii(i,"classifications");const e=new Fl;Lu(e,XEe,this.h);const t=new wa;Ol(t,"mediapipe.tasks.vision.image_classifier.ImageClassifierGraph"),yr(t,"IMAGE:input_image"),yr(t,"NORM_RECT:norm_rect"),mi(t,"CLASSIFICATIONS:classifications"),t.o(e),Nl(i,t),this.g.attachProtoListener("classifications",((n,r)=>{this.j=(function(s){const o={classifications:Gf(s,kEe,1).map((a=>{var l;return rP(((l=wi(a,PK,4))==null?void 0:l.g())??[],bu(mc(a,2),0),Sh(a,3))}))};return ow(cp(s,2))!=null&&(o.timestampMs=bu(ow(cp(s,2)),0)),o})(FEe(n)),en(this,r)})),this.g.attachEmptyPacketListener("classifications",(n=>{en(this,n)})),i=i.g(),this.setGraph(new Uint8Array(i),!0)}};Sl.prototype.classifyForVideo=Sl.prototype.xa,Sl.prototype.classify=Sl.prototype.wa,Sl.prototype.setOptions=Sl.prototype.o,Sl.createFromModelPath=function(i,e){return di(Sl,i,{baseOptions:{modelAssetPath:e}})},Sl.createFromModelBuffer=function(i,e){return di(Sl,i,{baseOptions:{modelAssetBuffer:e}})},Sl.createFromOptions=function(i,e){return di(Sl,i,e)};var ja=class extends Ca{constructor(i,e){super(new wc(i,e),"image_in","norm_rect",!0),this.h=new rY,this.embeddings={embeddings:[]},Cn(i=this.h,0,1,e=new Fr)}get baseOptions(){return wi(this.h,Fr,1)}set baseOptions(i){Cn(this.h,0,1,i)}o(i){var e=this.h,t=wi(this.h,sN,2);return t=t?t.clone():new sN,i.l2Normalize!==void 0?ex(t,1,i.l2Normalize):"l2Normalize"in i&&Ar(t,1),i.quantize!==void 0?ex(t,2,i.quantize):"quantize"in i&&Ar(t,2),Cn(e,0,2,t),this.l(i)}Da(i,e){return Cc(this,i,e),this.embeddings}Ea(i,e,t){return Ih(this,i,t,e),this.embeddings}m(){var i=new sl;Mr(i,"image_in"),Mr(i,"norm_rect"),Ii(i,"embeddings_out");const e=new Fl;Lu(e,qEe,this.h);const t=new wa;Ol(t,"mediapipe.tasks.vision.image_embedder.ImageEmbedderGraph"),yr(t,"IMAGE:image_in"),yr(t,"NORM_RECT:norm_rect"),mi(t,"EMBEDDINGS:embeddings_out"),t.o(e),Nl(i,t),this.g.attachProtoListener("embeddings_out",((n,r)=>{n=UEe(n),this.embeddings=(function(s){return{embeddings:Gf(s,NEe,1).map((o=>{var l,c;const a={headIndex:bu(mc(o,3),0)??-1,headName:Sh(o,4)??""};if(sK(o,rN,YI(o,1))!==void 0)o=Nm(o=wi(o,rN,YI(o,1)),1,Ep,Om()),a.floatEmbedding=o.slice();else{const u=new Uint8Array(0);a.quantizedEmbedding=((c=(l=wi(o,OEe,YI(o,2)))==null?void 0:l.ra())==null?void 0:c.ua())??u}return a})),timestampMs:bu(ow(cp(s,2)),0)}})(n),en(this,r)})),this.g.attachEmptyPacketListener("embeddings_out",(n=>{en(this,n)})),i=i.g(),this.setGraph(new Uint8Array(i),!0)}};ja.cosineSimilarity=function(i,e){if(i.floatEmbedding&&e.floatEmbedding)i=cN(i.floatEmbedding,e.floatEmbedding);else{if(!i.quantizedEmbedding||!e.quantizedEmbedding)throw Error("Cannot compute cosine similarity between quantized and float embeddings.");i=cN(lN(i.quantizedEmbedding),lN(e.quantizedEmbedding))}return i},ja.prototype.embedForVideo=ja.prototype.Ea,ja.prototype.embed=ja.prototype.Da,ja.prototype.setOptions=ja.prototype.o,ja.createFromModelPath=function(i,e){return di(ja,i,{baseOptions:{modelAssetPath:e}})},ja.createFromModelBuffer=function(i,e){return di(ja,i,{baseOptions:{modelAssetBuffer:e}})},ja.createFromOptions=function(i,e){return di(ja,i,e)};var dw=class{constructor(i,e,t){this.confidenceMasks=i,this.categoryMask=e,this.qualityScores=t}close(){var i,e;(i=this.confidenceMasks)==null||i.forEach((t=>{t.close()})),(e=this.categoryMask)==null||e.close()}};function bN(i){i.categoryMask=void 0,i.confidenceMasks=void 0,i.qualityScores=void 0}function IN(i){try{const e=new dw(i.confidenceMasks,i.categoryMask,i.qualityScores);if(!i.j)return e;i.j(e)}finally{rC(i)}}dw.prototype.close=dw.prototype.close;var ga=class extends Ca{constructor(i,e){super(new wc(i,e),"image_in","norm_rect",!1),this.s=[],this.outputCategoryMask=!1,this.outputConfidenceMasks=!0,this.h=new iP,this.v=new sY,Cn(this.h,0,3,this.v),Cn(i=this.h,0,1,e=new Fr)}get baseOptions(){return wi(this.h,Fr,1)}set baseOptions(i){Cn(this.h,0,1,i)}o(i){return i.displayNamesLocale!==void 0?Ar(this.h,2,FA(i.displayNamesLocale)):"displayNamesLocale"in i&&Ar(this.h,2),"outputCategoryMask"in i&&(this.outputCategoryMask=i.outputCategoryMask??!1),"outputConfidenceMasks"in i&&(this.outputConfidenceMasks=i.outputConfidenceMasks??!0),super.l(i)}J(){(function(i){var t,n;const e=Gf(i.ga(),wa,1).filter((r=>Sh(r,1).includes("mediapipe.tasks.TensorsToSegmentationCalculator")));if(i.s=[],e.length>1)throw Error("The graph has more than one mediapipe.tasks.TensorsToSegmentationCalculator.");e.length===1&&(((n=(t=wi(e[0],Fl,7))==null?void 0:t.l())==null?void 0:n.g())??new Map).forEach(((r,s)=>{i.s[Number(s)]=Sh(r,1)}))})(this)}ha(i,e,t){const n=typeof e!="function"?e:{};return this.j=typeof e=="function"?e:t,bN(this),Cc(this,i,n),IN(this)}Pa(i,e,t,n){const r=typeof t!="function"?t:{};return this.j=typeof t=="function"?t:n,bN(this),Ih(this,i,r,e),IN(this)}Ha(){return this.s}m(){var i=new sl;Mr(i,"image_in"),Mr(i,"norm_rect");const e=new Fl;Lu(e,aY,this.h);const t=new wa;Ol(t,"mediapipe.tasks.vision.image_segmenter.ImageSegmenterGraph"),yr(t,"IMAGE:image_in"),yr(t,"NORM_RECT:norm_rect"),t.o(e),Nl(i,t),iC(this,i),this.outputConfidenceMasks&&(Ii(i,"confidence_masks"),mi(t,"CONFIDENCE_MASKS:confidence_masks"),AA(this,"confidence_masks"),this.g.fa("confidence_masks",((n,r)=>{this.confidenceMasks=n.map((s=>xA(this,s,!0,!this.j))),en(this,r)})),this.g.attachEmptyPacketListener("confidence_masks",(n=>{this.confidenceMasks=[],en(this,n)}))),this.outputCategoryMask&&(Ii(i,"category_mask"),mi(t,"CATEGORY_MASK:category_mask"),AA(this,"category_mask"),this.g.W("category_mask",((n,r)=>{this.categoryMask=xA(this,n,!1,!this.j),en(this,r)})),this.g.attachEmptyPacketListener("category_mask",(n=>{this.categoryMask=void 0,en(this,n)}))),Ii(i,"quality_scores"),mi(t,"QUALITY_SCORES:quality_scores"),this.g.attachFloatVectorListener("quality_scores",((n,r)=>{this.qualityScores=n,en(this,r)})),this.g.attachEmptyPacketListener("quality_scores",(n=>{this.categoryMask=void 0,en(this,n)})),i=i.g(),this.setGraph(new Uint8Array(i),!0)}};ga.prototype.getLabels=ga.prototype.Ha,ga.prototype.segmentForVideo=ga.prototype.Pa,ga.prototype.segment=ga.prototype.ha,ga.prototype.setOptions=ga.prototype.o,ga.createFromModelPath=function(i,e){return di(ga,i,{baseOptions:{modelAssetPath:e}})},ga.createFromModelBuffer=function(i,e){return di(ga,i,{baseOptions:{modelAssetBuffer:e}})},ga.createFromOptions=function(i,e){return di(ga,i,e)};var pw=class{constructor(i,e,t){this.confidenceMasks=i,this.categoryMask=e,this.qualityScores=t}close(){var i,e;(i=this.confidenceMasks)==null||i.forEach((t=>{t.close()})),(e=this.categoryMask)==null||e.close()}};pw.prototype.close=pw.prototype.close;var s_e=class extends an{constructor(i){super(i)}},E1=[0,ss,-2],mw=[0,wf,-3,Vr,wf,-1],MN=[0,mw],RN=[0,mw,ss,-1],ZI=class extends an{constructor(i){super(i)}},PN=[0,wf,-1,Vr],o_e=class extends an{constructor(){super()}},LN=class extends an{constructor(i){super(i)}},m6=[1,2,3,4,5,6,7,8,9,10,14,15],wY=class extends an{constructor(){super()}};wY.prototype.g=Z4([0,Ds,[0,m6,Ji,mw,Ji,[0,mw,E1],Ji,MN,Ji,[0,MN,E1],Ji,PN,Ji,[0,wf,-3,Vr,Iu],Ji,[0,wf,-3,Vr],Ji,[0,ji,wf,-2,Vr,ss,Vr,-1,2,wf,E1],Ji,RN,Ji,[0,RN,E1],wf,E1,ji,Ji,[0,wf,-3,Vr,E1,-1],Ji,[0,Ds,PN]],ji,[0,ji,ss,-1,Vr]]);var uu=class extends Ca{constructor(i,e){super(new wc(i,e),"image_in","norm_rect_in",!1),this.outputCategoryMask=!1,this.outputConfidenceMasks=!0,this.h=new iP,this.s=new sY,Cn(this.h,0,3,this.s),Cn(i=this.h,0,1,e=new Fr)}get baseOptions(){return wi(this.h,Fr,1)}set baseOptions(i){Cn(this.h,0,1,i)}o(i){return"outputCategoryMask"in i&&(this.outputCategoryMask=i.outputCategoryMask??!1),"outputConfidenceMasks"in i&&(this.outputConfidenceMasks=i.outputConfidenceMasks??!0),super.l(i)}ha(i,e,t,n){const r=typeof t!="function"?t:{};this.j=typeof t=="function"?t:n,this.qualityScores=this.categoryMask=this.confidenceMasks=void 0,t=this.B+1,n=new wY;const s=new LN;var o=new s_e;if(wh(o,1,255),Cn(s,0,12,o),e.keypoint&&e.scribble)throw Error("Cannot provide both keypoint and scribble.");if(e.keypoint){var a=new ZI;ex(a,3,!0),hn(a,1,e.keypoint.x),hn(a,2,e.keypoint.y),g2(s,5,m6,a)}else{if(!e.scribble)throw Error("Must provide either a keypoint or a scribble.");for(a of(o=new o_e,e.scribble))ex(e=new ZI,3,!0),hn(e,1,a.x),hn(e,2,a.y),cw(o,1,ZI,e);g2(s,15,m6,o)}cw(n,1,LN,s),this.g.addProtoToStream(n.g(),"drishti.RenderData","roi_in",t),Cc(this,i,r);e:{try{const c=new pw(this.confidenceMasks,this.categoryMask,this.qualityScores);if(!this.j){var l=c;break e}this.j(c)}finally{rC(this)}l=void 0}return l}m(){var i=new sl;Mr(i,"image_in"),Mr(i,"roi_in"),Mr(i,"norm_rect_in");const e=new Fl;Lu(e,aY,this.h);const t=new wa;Ol(t,"mediapipe.tasks.vision.interactive_segmenter.InteractiveSegmenterGraph"),yr(t,"IMAGE:image_in"),yr(t,"ROI:roi_in"),yr(t,"NORM_RECT:norm_rect_in"),t.o(e),Nl(i,t),iC(this,i),this.outputConfidenceMasks&&(Ii(i,"confidence_masks"),mi(t,"CONFIDENCE_MASKS:confidence_masks"),AA(this,"confidence_masks"),this.g.fa("confidence_masks",((n,r)=>{this.confidenceMasks=n.map((s=>xA(this,s,!0,!this.j))),en(this,r)})),this.g.attachEmptyPacketListener("confidence_masks",(n=>{this.confidenceMasks=[],en(this,n)}))),this.outputCategoryMask&&(Ii(i,"category_mask"),mi(t,"CATEGORY_MASK:category_mask"),AA(this,"category_mask"),this.g.W("category_mask",((n,r)=>{this.categoryMask=xA(this,n,!1,!this.j),en(this,r)})),this.g.attachEmptyPacketListener("category_mask",(n=>{this.categoryMask=void 0,en(this,n)}))),Ii(i,"quality_scores"),mi(t,"QUALITY_SCORES:quality_scores"),this.g.attachFloatVectorListener("quality_scores",((n,r)=>{this.qualityScores=n,en(this,r)})),this.g.attachEmptyPacketListener("quality_scores",(n=>{this.categoryMask=void 0,en(this,n)})),i=i.g(),this.setGraph(new Uint8Array(i),!0)}};uu.prototype.segment=uu.prototype.ha,uu.prototype.setOptions=uu.prototype.o,uu.createFromModelPath=function(i,e){return di(uu,i,{baseOptions:{modelAssetPath:e}})},uu.createFromModelBuffer=function(i,e){return di(uu,i,{baseOptions:{modelAssetBuffer:e}})},uu.createFromOptions=function(i,e){return di(uu,i,e)};var wl=class extends Ca{constructor(i,e){super(new wc(i,e),"input_frame_gpu","norm_rect",!1),this.j={detections:[]},Cn(i=this.h=new lY,0,1,e=new Fr)}get baseOptions(){return wi(this.h,Fr,1)}set baseOptions(i){Cn(this.h,0,1,i)}o(i){return i.displayNamesLocale!==void 0?Ar(this.h,2,FA(i.displayNamesLocale)):"displayNamesLocale"in i&&Ar(this.h,2),i.maxResults!==void 0?wh(this.h,3,i.maxResults):"maxResults"in i&&Ar(this.h,3),i.scoreThreshold!==void 0?hn(this.h,4,i.scoreThreshold):"scoreThreshold"in i&&Ar(this.h,4),i.categoryAllowlist!==void 0?uw(this.h,5,i.categoryAllowlist):"categoryAllowlist"in i&&Ar(this.h,5),i.categoryDenylist!==void 0?uw(this.h,6,i.categoryDenylist):"categoryDenylist"in i&&Ar(this.h,6),this.l(i)}D(i,e){return this.j={detections:[]},Cc(this,i,e),this.j}F(i,e,t){return this.j={detections:[]},Ih(this,i,t,e),this.j}m(){var i=new sl;Mr(i,"input_frame_gpu"),Mr(i,"norm_rect"),Ii(i,"detections");const e=new Fl;Lu(e,ZEe,this.h);const t=new wa;Ol(t,"mediapipe.tasks.vision.ObjectDetectorGraph"),yr(t,"IMAGE:input_frame_gpu"),yr(t,"NORM_RECT:norm_rect"),mi(t,"DETECTIONS:detections"),t.o(e),Nl(i,t),this.g.attachProtoVectorListener("detections",((n,r)=>{for(const s of n)n=BK(s),this.j.detections.push(uY(n));en(this,r)})),this.g.attachEmptyPacketListener("detections",(n=>{en(this,n)})),i=i.g(),this.setGraph(new Uint8Array(i),!0)}};wl.prototype.detectForVideo=wl.prototype.F,wl.prototype.detect=wl.prototype.D,wl.prototype.setOptions=wl.prototype.o,wl.createFromModelPath=async function(i,e){return di(wl,i,{baseOptions:{modelAssetPath:e}})},wl.createFromModelBuffer=function(i,e){return di(wl,i,{baseOptions:{modelAssetBuffer:e}})},wl.createFromOptions=function(i,e){return di(wl,i,e)};var g6=class{constructor(i,e,t){this.landmarks=i,this.worldLandmarks=e,this.segmentationMasks=t}close(){var i;(i=this.segmentationMasks)==null||i.forEach((e=>{e.close()}))}};function BN(i){i.landmarks=[],i.worldLandmarks=[],i.segmentationMasks=void 0}function DN(i){try{const e=new g6(i.landmarks,i.worldLandmarks,i.segmentationMasks);if(!i.s)return e;i.s(e)}finally{rC(i)}}g6.prototype.close=g6.prototype.close;var Wa=class extends Ca{constructor(i,e){super(new wc(i,e),"image_in","norm_rect",!1),this.landmarks=[],this.worldLandmarks=[],this.outputSegmentationMasks=!1,Cn(i=this.h=new cY,0,1,e=new Fr),this.v=new tY,Cn(this.h,0,3,this.v),this.j=new eY,Cn(this.h,0,2,this.j),wh(this.j,4,1),hn(this.j,2,.5),hn(this.v,2,.5),hn(this.h,4,.5)}get baseOptions(){return wi(this.h,Fr,1)}set baseOptions(i){Cn(this.h,0,1,i)}o(i){return"numPoses"in i&&wh(this.j,4,i.numPoses??1),"minPoseDetectionConfidence"in i&&hn(this.j,2,i.minPoseDetectionConfidence??.5),"minTrackingConfidence"in i&&hn(this.h,4,i.minTrackingConfidence??.5),"minPosePresenceConfidence"in i&&hn(this.v,2,i.minPosePresenceConfidence??.5),"outputSegmentationMasks"in i&&(this.outputSegmentationMasks=i.outputSegmentationMasks??!1),this.l(i)}D(i,e,t){const n=typeof e!="function"?e:{};return this.s=typeof e=="function"?e:t,BN(this),Cc(this,i,n),DN(this)}F(i,e,t,n){const r=typeof t!="function"?t:{};return this.s=typeof t=="function"?t:n,BN(this),Ih(this,i,r,e),DN(this)}m(){var i=new sl;Mr(i,"image_in"),Mr(i,"norm_rect"),Ii(i,"normalized_landmarks"),Ii(i,"world_landmarks"),Ii(i,"segmentation_masks");const e=new Fl;Lu(e,e_e,this.h);const t=new wa;Ol(t,"mediapipe.tasks.vision.pose_landmarker.PoseLandmarkerGraph"),yr(t,"IMAGE:image_in"),yr(t,"NORM_RECT:norm_rect"),mi(t,"NORM_LANDMARKS:normalized_landmarks"),mi(t,"WORLD_LANDMARKS:world_landmarks"),t.o(e),Nl(i,t),iC(this,i),this.g.attachProtoVectorListener("normalized_landmarks",((n,r)=>{this.landmarks=[];for(const s of n)n=Dx(s),this.landmarks.push(nC(n));en(this,r)})),this.g.attachEmptyPacketListener("normalized_landmarks",(n=>{this.landmarks=[],en(this,n)})),this.g.attachProtoVectorListener("world_landmarks",((n,r)=>{this.worldLandmarks=[];for(const s of n)n=Z1(s),this.worldLandmarks.push(v2(n));en(this,r)})),this.g.attachEmptyPacketListener("world_landmarks",(n=>{this.worldLandmarks=[],en(this,n)})),this.outputSegmentationMasks&&(mi(t,"SEGMENTATION_MASK:segmentation_masks"),AA(this,"segmentation_masks"),this.g.fa("segmentation_masks",((n,r)=>{this.segmentationMasks=n.map((s=>xA(this,s,!0,!this.s))),en(this,r)})),this.g.attachEmptyPacketListener("segmentation_masks",(n=>{this.segmentationMasks=[],en(this,n)}))),i=i.g(),this.setGraph(new Uint8Array(i),!0)}};Wa.prototype.detectForVideo=Wa.prototype.F,Wa.prototype.detect=Wa.prototype.D,Wa.prototype.setOptions=Wa.prototype.o,Wa.createFromModelPath=function(i,e){return di(Wa,i,{baseOptions:{modelAssetPath:e}})},Wa.createFromModelBuffer=function(i,e){return di(Wa,i,{baseOptions:{modelAssetBuffer:e}})},Wa.createFromOptions=function(i,e){return di(Wa,i,e)},Wa.POSE_CONNECTIONS=SY;const a_e=Object.freeze(Object.defineProperty({__proto__:null,FaceDetector:_l,FaceLandmarker:Qr,FaceStylizer:cu,FilesetResolver:Tm,GestureRecognizer:Qa,HandLandmarker:Va,HolisticLandmarker:wr,ImageClassifier:Sl,ImageEmbedder:ja,ImageSegmenter:ga,ImageSegmenterResult:dw,InteractiveSegmenter:uu,InteractiveSegmenterResult:pw,MPImage:qs,MPMask:Xs,ObjectDetector:wl,PoseLandmarker:Wa,VisionTaskRunner:Ca},Symbol.toStringTag,{value:"Module"}));</script>
  <style rel="stylesheet" crossorigin>@import"https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap";*,:before,:after{--tw-border-spacing-x: 0;--tw-border-spacing-y: 0;--tw-translate-x: 0;--tw-translate-y: 0;--tw-rotate: 0;--tw-skew-x: 0;--tw-skew-y: 0;--tw-scale-x: 1;--tw-scale-y: 1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness: proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width: 0px;--tw-ring-offset-color: #fff;--tw-ring-color: rgb(59 130 246 / .5);--tw-ring-offset-shadow: 0 0 #0000;--tw-ring-shadow: 0 0 #0000;--tw-shadow: 0 0 #0000;--tw-shadow-colored: 0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }::backdrop{--tw-border-spacing-x: 0;--tw-border-spacing-y: 0;--tw-translate-x: 0;--tw-translate-y: 0;--tw-rotate: 0;--tw-skew-x: 0;--tw-skew-y: 0;--tw-scale-x: 1;--tw-scale-y: 1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness: proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width: 0px;--tw-ring-offset-color: #fff;--tw-ring-color: rgb(59 130 246 / .5);--tw-ring-offset-shadow: 0 0 #0000;--tw-ring-shadow: 0 0 #0000;--tw-shadow: 0 0 #0000;--tw-shadow-colored: 0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }*,:before,:after{box-sizing:border-box;border-width:0;border-style:solid;border-color:#e5e7eb}:before,:after{--tw-content: ""}html,:host{line-height:1.5;-webkit-text-size-adjust:100%;-moz-tab-size:4;-o-tab-size:4;tab-size:4;font-family:ui-sans-serif,system-ui,sans-serif,"Apple Color Emoji","Segoe UI Emoji",Segoe UI Symbol,"Noto Color Emoji";font-feature-settings:normal;font-variation-settings:normal;-webkit-tap-highlight-color:transparent}body{margin:0;line-height:inherit}hr{height:0;color:inherit;border-top-width:1px}abbr:where([title]){-webkit-text-decoration:underline dotted;text-decoration:underline dotted}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}b,strong{font-weight:bolder}code,kbd,samp,pre{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace;font-feature-settings:normal;font-variation-settings:normal;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}table{text-indent:0;border-color:inherit;border-collapse:collapse}button,input,optgroup,select,textarea{font-family:inherit;font-feature-settings:inherit;font-variation-settings:inherit;font-size:100%;font-weight:inherit;line-height:inherit;letter-spacing:inherit;color:inherit;margin:0;padding:0}button,select{text-transform:none}button,input:where([type=button]),input:where([type=reset]),input:where([type=submit]){-webkit-appearance:button;background-color:transparent;background-image:none}:-moz-focusring{outline:auto}:-moz-ui-invalid{box-shadow:none}progress{vertical-align:baseline}::-webkit-inner-spin-button,::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}blockquote,dl,dd,h1,h2,h3,h4,h5,h6,hr,figure,p,pre{margin:0}fieldset{margin:0;padding:0}legend{padding:0}ol,ul,menu{list-style:none;margin:0;padding:0}dialog{padding:0}textarea{resize:vertical}input::-moz-placeholder,textarea::-moz-placeholder{opacity:1;color:#9ca3af}input::placeholder,textarea::placeholder{opacity:1;color:#9ca3af}button,[role=button]{cursor:pointer}:disabled{cursor:default}img,svg,video,canvas,audio,iframe,embed,object{display:block;vertical-align:middle}img,video{max-width:100%;height:auto}[hidden]:where(:not([hidden=until-found])){display:none}.mx-auto{margin-left:auto;margin-right:auto}.mb-1{margin-bottom:.25rem}.mb-2{margin-bottom:.5rem}.mb-3{margin-bottom:.75rem}.mb-4{margin-bottom:1rem}.mb-6{margin-bottom:1.5rem}.mb-8{margin-bottom:2rem}.mt-1{margin-top:.25rem}.mt-2{margin-top:.5rem}.mt-4{margin-top:1rem}.mt-6{margin-top:1.5rem}.mt-8{margin-top:2rem}.block{display:block}.inline-block{display:inline-block}.flex{display:flex}.table{display:table}.grid{display:grid}.h-1{height:.25rem}.h-2{height:.5rem}.h-4{height:1rem}.min-h-48{min-height:12rem}.min-h-screen{min-height:100vh}.w-4{width:1rem}.w-full{width:100%}.max-w-2xl{max-width:42rem}.max-w-3xl{max-width:48rem}.max-w-4xl{max-width:56rem}.max-w-5xl{max-width:64rem}.flex-1{flex:1 1 0%}.flex-shrink-0{flex-shrink:0}.transform{transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.cursor-not-allowed{cursor:not-allowed}.cursor-pointer{cursor:pointer}.resize-none{resize:none}.grid-cols-2{grid-template-columns:repeat(2,minmax(0,1fr))}.grid-cols-3{grid-template-columns:repeat(3,minmax(0,1fr))}.flex-col{flex-direction:column}.flex-wrap{flex-wrap:wrap}.items-start{align-items:flex-start}.items-center{align-items:center}.justify-end{justify-content:flex-end}.justify-center{justify-content:center}.justify-between{justify-content:space-between}.gap-1{gap:.25rem}.gap-2{gap:.5rem}.gap-3{gap:.75rem}.gap-4{gap:1rem}.gap-6{gap:1.5rem}.space-y-1>:not([hidden])~:not([hidden]){--tw-space-y-reverse: 0;margin-top:calc(.25rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(.25rem * var(--tw-space-y-reverse))}.space-y-2>:not([hidden])~:not([hidden]){--tw-space-y-reverse: 0;margin-top:calc(.5rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(.5rem * var(--tw-space-y-reverse))}.space-y-3>:not([hidden])~:not([hidden]){--tw-space-y-reverse: 0;margin-top:calc(.75rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(.75rem * var(--tw-space-y-reverse))}.space-y-4>:not([hidden])~:not([hidden]){--tw-space-y-reverse: 0;margin-top:calc(1rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(1rem * var(--tw-space-y-reverse))}.overflow-x-auto{overflow-x:auto}.whitespace-pre{white-space:pre}.rounded{border-radius:.25rem}.rounded-2xl{border-radius:1rem}.rounded-full{border-radius:9999px}.rounded-lg{border-radius:.5rem}.rounded-sm{border-radius:.125rem}.rounded-xl{border-radius:.75rem}.border{border-width:1px}.border-2{border-width:2px}.border-4{border-width:4px}.border-t{border-top-width:1px}.border-blue-400{--tw-border-opacity: 1;border-color:rgb(96 165 250 / var(--tw-border-opacity, 1))}.border-gray-200{--tw-border-opacity: 1;border-color:rgb(229 231 235 / var(--tw-border-opacity, 1))}.border-gray-300{--tw-border-opacity: 1;border-color:rgb(209 213 219 / var(--tw-border-opacity, 1))}.border-green-200{--tw-border-opacity: 1;border-color:rgb(187 247 208 / var(--tw-border-opacity, 1))}.border-green-400{--tw-border-opacity: 1;border-color:rgb(74 222 128 / var(--tw-border-opacity, 1))}.border-green-500{--tw-border-opacity: 1;border-color:rgb(34 197 94 / var(--tw-border-opacity, 1))}.border-indigo-200{--tw-border-opacity: 1;border-color:rgb(199 210 254 / var(--tw-border-opacity, 1))}.border-purple-200{--tw-border-opacity: 1;border-color:rgb(233 213 255 / var(--tw-border-opacity, 1))}.border-purple-400{--tw-border-opacity: 1;border-color:rgb(192 132 252 / var(--tw-border-opacity, 1))}.border-red-200{--tw-border-opacity: 1;border-color:rgb(254 202 202 / var(--tw-border-opacity, 1))}.border-red-500{--tw-border-opacity: 1;border-color:rgb(239 68 68 / var(--tw-border-opacity, 1))}.border-slate-600{--tw-border-opacity: 1;border-color:rgb(71 85 105 / var(--tw-border-opacity, 1))}.border-slate-700{--tw-border-opacity: 1;border-color:rgb(51 65 85 / var(--tw-border-opacity, 1))}.border-teal-200{--tw-border-opacity: 1;border-color:rgb(153 246 228 / var(--tw-border-opacity, 1))}.border-teal-400{--tw-border-opacity: 1;border-color:rgb(45 212 191 / var(--tw-border-opacity, 1))}.border-teal-500{--tw-border-opacity: 1;border-color:rgb(20 184 166 / var(--tw-border-opacity, 1))}.border-yellow-200{--tw-border-opacity: 1;border-color:rgb(254 240 138 / var(--tw-border-opacity, 1))}.border-yellow-400{--tw-border-opacity: 1;border-color:rgb(250 204 21 / var(--tw-border-opacity, 1))}.border-yellow-500\/30{border-color:#eab3084d}.bg-blue-100{--tw-bg-opacity: 1;background-color:rgb(219 234 254 / var(--tw-bg-opacity, 1))}.bg-blue-400{--tw-bg-opacity: 1;background-color:rgb(96 165 250 / var(--tw-bg-opacity, 1))}.bg-blue-50{--tw-bg-opacity: 1;background-color:rgb(239 246 255 / var(--tw-bg-opacity, 1))}.bg-gray-100{--tw-bg-opacity: 1;background-color:rgb(243 244 246 / var(--tw-bg-opacity, 1))}.bg-gray-200{--tw-bg-opacity: 1;background-color:rgb(229 231 235 / var(--tw-bg-opacity, 1))}.bg-gray-50{--tw-bg-opacity: 1;background-color:rgb(249 250 251 / var(--tw-bg-opacity, 1))}.bg-gray-900{--tw-bg-opacity: 1;background-color:rgb(17 24 39 / var(--tw-bg-opacity, 1))}.bg-green-100{--tw-bg-opacity: 1;background-color:rgb(220 252 231 / var(--tw-bg-opacity, 1))}.bg-green-50{--tw-bg-opacity: 1;background-color:rgb(240 253 244 / var(--tw-bg-opacity, 1))}.bg-green-500{--tw-bg-opacity: 1;background-color:rgb(34 197 94 / var(--tw-bg-opacity, 1))}.bg-indigo-50{--tw-bg-opacity: 1;background-color:rgb(238 242 255 / var(--tw-bg-opacity, 1))}.bg-orange-100{--tw-bg-opacity: 1;background-color:rgb(255 237 213 / var(--tw-bg-opacity, 1))}.bg-purple-100{--tw-bg-opacity: 1;background-color:rgb(243 232 255 / var(--tw-bg-opacity, 1))}.bg-purple-50{--tw-bg-opacity: 1;background-color:rgb(250 245 255 / var(--tw-bg-opacity, 1))}.bg-red-50{--tw-bg-opacity: 1;background-color:rgb(254 242 242 / var(--tw-bg-opacity, 1))}.bg-slate-700{--tw-bg-opacity: 1;background-color:rgb(51 65 85 / var(--tw-bg-opacity, 1))}.bg-slate-700\/50{background-color:#33415580}.bg-slate-800{--tw-bg-opacity: 1;background-color:rgb(30 41 59 / var(--tw-bg-opacity, 1))}.bg-slate-900{--tw-bg-opacity: 1;background-color:rgb(15 23 42 / var(--tw-bg-opacity, 1))}.bg-teal-100{--tw-bg-opacity: 1;background-color:rgb(204 251 241 / var(--tw-bg-opacity, 1))}.bg-teal-400\/30{background-color:#2dd4bf4d}.bg-teal-50{--tw-bg-opacity: 1;background-color:rgb(240 253 250 / var(--tw-bg-opacity, 1))}.bg-teal-500{--tw-bg-opacity: 1;background-color:rgb(20 184 166 / var(--tw-bg-opacity, 1))}.bg-teal-500\/30{background-color:#14b8a64d}.bg-teal-600{--tw-bg-opacity: 1;background-color:rgb(13 148 136 / var(--tw-bg-opacity, 1))}.bg-white{--tw-bg-opacity: 1;background-color:rgb(255 255 255 / var(--tw-bg-opacity, 1))}.bg-yellow-400\/50{background-color:#facc1580}.bg-yellow-50{--tw-bg-opacity: 1;background-color:rgb(254 252 232 / var(--tw-bg-opacity, 1))}.bg-yellow-500\/10{background-color:#eab3081a}.bg-gradient-to-br{background-image:linear-gradient(to bottom right,var(--tw-gradient-stops))}.from-slate-800{--tw-gradient-from: #1e293b var(--tw-gradient-from-position);--tw-gradient-to: rgb(30 41 59 / 0) var(--tw-gradient-to-position);--tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to)}.from-teal-50{--tw-gradient-from: #f0fdfa var(--tw-gradient-from-position);--tw-gradient-to: rgb(240 253 250 / 0) var(--tw-gradient-to-position);--tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to)}.to-cyan-100{--tw-gradient-to: #cffafe var(--tw-gradient-to-position)}.to-slate-900{--tw-gradient-to: #0f172a var(--tw-gradient-to-position)}.p-2{padding:.5rem}.p-3{padding:.75rem}.p-4{padding:1rem}.p-5{padding:1.25rem}.p-6{padding:1.5rem}.px-2{padding-left:.5rem;padding-right:.5rem}.px-3{padding-left:.75rem;padding-right:.75rem}.px-4{padding-left:1rem;padding-right:1rem}.px-6{padding-left:1.5rem;padding-right:1.5rem}.py-1{padding-top:.25rem;padding-bottom:.25rem}.py-1\.5{padding-top:.375rem;padding-bottom:.375rem}.py-2{padding-top:.5rem;padding-bottom:.5rem}.py-4{padding-top:1rem;padding-bottom:1rem}.pt-1{padding-top:.25rem}.pt-4{padding-top:1rem}.text-left{text-align:left}.text-center{text-align:center}.text-right{text-align:right}.font-mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace}.text-2xl{font-size:1.5rem;line-height:2rem}.text-3xl{font-size:1.875rem;line-height:2.25rem}.text-4xl{font-size:2.25rem;line-height:2.5rem}.text-6xl{font-size:3.75rem;line-height:1}.text-lg{font-size:1.125rem;line-height:1.75rem}.text-sm{font-size:.875rem;line-height:1.25rem}.text-xl{font-size:1.25rem;line-height:1.75rem}.text-xs{font-size:.75rem;line-height:1rem}.font-bold{font-weight:700}.font-medium{font-weight:500}.font-semibold{font-weight:600}.uppercase{text-transform:uppercase}.text-blue-400{--tw-text-opacity: 1;color:rgb(96 165 250 / var(--tw-text-opacity, 1))}.text-blue-600{--tw-text-opacity: 1;color:rgb(37 99 235 / var(--tw-text-opacity, 1))}.text-blue-800{--tw-text-opacity: 1;color:rgb(30 64 175 / var(--tw-text-opacity, 1))}.text-gray-300{--tw-text-opacity: 1;color:rgb(209 213 219 / var(--tw-text-opacity, 1))}.text-gray-400{--tw-text-opacity: 1;color:rgb(156 163 175 / var(--tw-text-opacity, 1))}.text-gray-500{--tw-text-opacity: 1;color:rgb(107 114 128 / var(--tw-text-opacity, 1))}.text-gray-600{--tw-text-opacity: 1;color:rgb(75 85 99 / var(--tw-text-opacity, 1))}.text-gray-700{--tw-text-opacity: 1;color:rgb(55 65 81 / var(--tw-text-opacity, 1))}.text-gray-800{--tw-text-opacity: 1;color:rgb(31 41 55 / var(--tw-text-opacity, 1))}.text-green-600{--tw-text-opacity: 1;color:rgb(22 163 74 / var(--tw-text-opacity, 1))}.text-green-700{--tw-text-opacity: 1;color:rgb(21 128 61 / var(--tw-text-opacity, 1))}.text-green-800{--tw-text-opacity: 1;color:rgb(22 101 52 / var(--tw-text-opacity, 1))}.text-indigo-600{--tw-text-opacity: 1;color:rgb(79 70 229 / var(--tw-text-opacity, 1))}.text-indigo-800{--tw-text-opacity: 1;color:rgb(55 48 163 / var(--tw-text-opacity, 1))}.text-orange-800{--tw-text-opacity: 1;color:rgb(154 52 18 / var(--tw-text-opacity, 1))}.text-purple-600{--tw-text-opacity: 1;color:rgb(147 51 234 / var(--tw-text-opacity, 1))}.text-purple-800{--tw-text-opacity: 1;color:rgb(107 33 168 / var(--tw-text-opacity, 1))}.text-purple-900{--tw-text-opacity: 1;color:rgb(88 28 135 / var(--tw-text-opacity, 1))}.text-red-700{--tw-text-opacity: 1;color:rgb(185 28 28 / var(--tw-text-opacity, 1))}.text-slate-300{--tw-text-opacity: 1;color:rgb(203 213 225 / var(--tw-text-opacity, 1))}.text-teal-300{--tw-text-opacity: 1;color:rgb(94 234 212 / var(--tw-text-opacity, 1))}.text-teal-400{--tw-text-opacity: 1;color:rgb(45 212 191 / var(--tw-text-opacity, 1))}.text-teal-600{--tw-text-opacity: 1;color:rgb(13 148 136 / var(--tw-text-opacity, 1))}.text-teal-700{--tw-text-opacity: 1;color:rgb(15 118 110 / var(--tw-text-opacity, 1))}.text-teal-800{--tw-text-opacity: 1;color:rgb(17 94 89 / var(--tw-text-opacity, 1))}.text-teal-900{--tw-text-opacity: 1;color:rgb(19 78 74 / var(--tw-text-opacity, 1))}.text-white{--tw-text-opacity: 1;color:rgb(255 255 255 / var(--tw-text-opacity, 1))}.text-yellow-200{--tw-text-opacity: 1;color:rgb(254 240 138 / var(--tw-text-opacity, 1))}.text-yellow-300{--tw-text-opacity: 1;color:rgb(253 224 71 / var(--tw-text-opacity, 1))}.text-yellow-400{--tw-text-opacity: 1;color:rgb(250 204 21 / var(--tw-text-opacity, 1))}.text-yellow-600{--tw-text-opacity: 1;color:rgb(202 138 4 / var(--tw-text-opacity, 1))}.text-yellow-800{--tw-text-opacity: 1;color:rgb(133 77 14 / var(--tw-text-opacity, 1))}.text-yellow-900{--tw-text-opacity: 1;color:rgb(113 63 18 / var(--tw-text-opacity, 1))}.underline{text-decoration-line:underline}.opacity-50{opacity:.5}.opacity-60{opacity:.6}.shadow{--tw-shadow: 0 1px 3px 0 rgb(0 0 0 / .1), 0 1px 2px -1px rgb(0 0 0 / .1);--tw-shadow-colored: 0 1px 3px 0 var(--tw-shadow-color), 0 1px 2px -1px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}.shadow-2xl{--tw-shadow: 0 25px 50px -12px rgb(0 0 0 / .25);--tw-shadow-colored: 0 25px 50px -12px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}.shadow-lg{--tw-shadow: 0 10px 15px -3px rgb(0 0 0 / .1), 0 4px 6px -4px rgb(0 0 0 / .1);--tw-shadow-colored: 0 10px 15px -3px var(--tw-shadow-color), 0 4px 6px -4px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}.ring{--tw-ring-offset-shadow: var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);--tw-ring-shadow: var(--tw-ring-inset) 0 0 0 calc(3px + var(--tw-ring-offset-width)) var(--tw-ring-color);box-shadow:var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow, 0 0 #0000)}.ring-2{--tw-ring-offset-shadow: var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);--tw-ring-shadow: var(--tw-ring-inset) 0 0 0 calc(2px + var(--tw-ring-offset-width)) var(--tw-ring-color);box-shadow:var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow, 0 0 #0000)}.ring-teal-200{--tw-ring-opacity: 1;--tw-ring-color: rgb(153 246 228 / var(--tw-ring-opacity, 1))}.drop-shadow{--tw-drop-shadow: drop-shadow(0 1px 2px rgb(0 0 0 / .1)) drop-shadow(0 1px 1px rgb(0 0 0 / .06));filter:var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow)}.filter{filter:var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow)}.transition-all{transition-property:all;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s}.transition-colors{transition-property:color,background-color,border-color,text-decoration-color,fill,stroke;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s}.duration-300{transition-duration:.3s}*{font-family:Inter,sans-serif}.skip-link{position:absolute;top:-40px;left:0;background:#f36b22;color:#fff;padding:8px;text-decoration:none;z-index:100}.skip-link:focus{top:0}*:focus-visible{outline:2px solid #f36b22;outline-offset:2px}.bg-primary-orange{background-color:#f36b22}.bg-dark-orange{background-color:#d95a1a}.border-primary-orange{border-color:#f36b22}.text-primary-orange{color:#f36b22}.molecule-3d-container{position:relative;overflow:hidden;border-radius:.75rem;background-image:linear-gradient(to bottom right,var(--tw-gradient-stops));--tw-gradient-from: #111827 var(--tw-gradient-from-position);--tw-gradient-to: rgb(17 24 39 / 0) var(--tw-gradient-to-position);--tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to);--tw-gradient-to: #1f2937 var(--tw-gradient-to-position);perspective:1000px}.molecule-3d{position:relative;height:16rem;width:100%}@media(min-width:768px){.molecule-3d{height:20rem}}.molecule-3d{transform-style:preserve-3d;transition:transform .3s ease-out}.atom-sphere{position:absolute;border-radius:9999px;--tw-shadow: 0 10px 15px -3px rgb(0 0 0 / .1), 0 4px 6px -4px rgb(0 0 0 / .1);--tw-shadow-colored: 0 10px 15px -3px var(--tw-shadow-color), 0 4px 6px -4px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow);transform-style:preserve-3d}.bond-cylinder{position:absolute;background-image:linear-gradient(to right,var(--tw-gradient-stops));--tw-gradient-from: #9ca3af var(--tw-gradient-from-position);--tw-gradient-to: rgb(156 163 175 / 0) var(--tw-gradient-to-position);--tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to);--tw-gradient-to: #6b7280 var(--tw-gradient-to-position);transform-origin:left center}.lone-pair{position:absolute}.lone-pair-dot{height:.5rem;width:.5rem;border-radius:9999px;--tw-bg-opacity: 1;background-color:rgb(250 204 21 / var(--tw-bg-opacity, 1));--tw-shadow: 0 4px 6px -1px rgb(0 0 0 / .1), 0 2px 4px -2px rgb(0 0 0 / .1);--tw-shadow-colored: 0 4px 6px -1px var(--tw-shadow-color), 0 2px 4px -2px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}.geometry-card{cursor:pointer;border-radius:.75rem;border-width:2px;--tw-border-opacity: 1;border-color:rgb(229 231 235 / var(--tw-border-opacity, 1));--tw-bg-opacity: 1;background-color:rgb(255 255 255 / var(--tw-bg-opacity, 1));padding:1rem;transition-property:all;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.2s}.geometry-card:hover{--tw-scale-x: 1.05;--tw-scale-y: 1.05;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y));--tw-border-opacity: 1;border-color:rgb(45 212 191 / var(--tw-border-opacity, 1));--tw-shadow: 0 10px 15px -3px rgb(0 0 0 / .1), 0 4px 6px -4px rgb(0 0 0 / .1);--tw-shadow-colored: 0 10px 15px -3px var(--tw-shadow-color), 0 4px 6px -4px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}.geometry-card.selected{--tw-border-opacity: 1;border-color:rgb(20 184 166 / var(--tw-border-opacity, 1));--tw-ring-offset-shadow: var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);--tw-ring-shadow: var(--tw-ring-inset) 0 0 0 calc(4px + var(--tw-ring-offset-width)) var(--tw-ring-color);box-shadow:var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow, 0 0 #0000);--tw-ring-color: rgb(45 212 191 / var(--tw-ring-opacity, 1));--tw-ring-opacity: .5}.geometry-card.correct{--tw-border-opacity: 1;border-color:rgb(34 197 94 / var(--tw-border-opacity, 1));--tw-bg-opacity: 1;background-color:rgb(240 253 244 / var(--tw-bg-opacity, 1))}.geometry-card.incorrect{--tw-border-opacity: 1;border-color:rgb(239 68 68 / var(--tw-border-opacity, 1));--tw-bg-opacity: 1;background-color:rgb(254 242 242 / var(--tw-bg-opacity, 1))}.bond-angle{position:absolute;border-radius:.25rem;background-color:#ffffffe6;padding-left:.25rem;padding-right:.25rem;font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace;font-size:.75rem;line-height:1rem;font-weight:700}.electron-domain{position:absolute;display:flex;align-items:center;justify-content:center}.bonding-pair{height:.75rem;width:2rem;border-radius:9999px;--tw-bg-opacity: 1;background-color:rgb(59 130 246 / var(--tw-bg-opacity, 1))}.lone-pair-domain{height:1.5rem;width:1.5rem;border-radius:9999px;--tw-bg-opacity: 1;background-color:rgb(250 204 21 / var(--tw-bg-opacity, 1));opacity:.6}.dipole-arrow{position:absolute}.dipole-arrow:after{content:"";position:absolute;height:0px;width:0px;border-left:4px solid transparent;border-right:4px solid transparent;border-bottom:8px solid currentColor}.delta-plus{font-size:.75rem;line-height:1rem;font-weight:700;--tw-text-opacity: 1;color:rgb(37 99 235 / var(--tw-text-opacity, 1))}.delta-minus{font-size:.75rem;line-height:1rem;font-weight:700;--tw-text-opacity: 1;color:rgb(220 38 38 / var(--tw-text-opacity, 1))}@keyframes rotate3d{0%{transform:rotateY(0)}to{transform:rotateY(360deg)}}@keyframes pulseGlow{0%,to{box-shadow:0 0 5px currentColor}50%{box-shadow:0 0 20px currentColor}}@keyframes slideIn{0%{opacity:0;transform:translateY(-20px)}to{opacity:1;transform:translateY(0)}}@keyframes pulseGreen{0%,to{box-shadow:0 0 #22c55eb3}50%{box-shadow:0 0 0 10px #22c55e00}}@keyframes shake{0%,to{transform:translate(0)}25%{transform:translate(-5px)}75%{transform:translate(5px)}}.animate-rotate-slow{animation:rotate3d 20s linear infinite}.animate-pulse-glow{animation:pulseGlow 2s ease-in-out infinite}.animate-slide-in{animation:slideIn .3s ease-out}.animate-pulse-green{animation:pulseGreen 1s infinite}.animate-shake{animation:shake .3s ease-in-out}.hybridization-badge{display:inline-block;border-radius:9999px;padding:.25rem .5rem;font-size:.75rem;line-height:1rem;font-weight:700}.hybridization-sp{--tw-bg-opacity: 1;background-color:rgb(243 232 255 / var(--tw-bg-opacity, 1));--tw-text-opacity: 1;color:rgb(107 33 168 / var(--tw-text-opacity, 1))}.hybridization-sp2{--tw-bg-opacity: 1;background-color:rgb(219 234 254 / var(--tw-bg-opacity, 1));--tw-text-opacity: 1;color:rgb(30 64 175 / var(--tw-text-opacity, 1))}.hybridization-sp3{--tw-bg-opacity: 1;background-color:rgb(220 252 231 / var(--tw-bg-opacity, 1));--tw-text-opacity: 1;color:rgb(22 101 52 / var(--tw-text-opacity, 1))}.hybridization-sp3d{--tw-bg-opacity: 1;background-color:rgb(255 237 213 / var(--tw-bg-opacity, 1));--tw-text-opacity: 1;color:rgb(154 52 18 / var(--tw-text-opacity, 1))}.hybridization-sp3d2{--tw-bg-opacity: 1;background-color:rgb(254 226 226 / var(--tw-bg-opacity, 1));--tw-text-opacity: 1;color:rgb(153 27 27 / var(--tw-text-opacity, 1))}@media(prefers-reduced-motion:reduce){*{animation-duration:.01ms!important;animation-iteration-count:1!important;transition-duration:.01ms!important}}input::-webkit-outer-spin-button,input::-webkit-inner-spin-button{-webkit-appearance:none;margin:0}input[type=number]{-moz-appearance:textfield}.hover\:border-teal-300:hover{--tw-border-opacity: 1;border-color:rgb(94 234 212 / var(--tw-border-opacity, 1))}.hover\:border-teal-400:hover{--tw-border-opacity: 1;border-color:rgb(45 212 191 / var(--tw-border-opacity, 1))}.hover\:bg-blue-100:hover{--tw-bg-opacity: 1;background-color:rgb(219 234 254 / var(--tw-bg-opacity, 1))}.hover\:bg-gray-300:hover{--tw-bg-opacity: 1;background-color:rgb(209 213 219 / var(--tw-bg-opacity, 1))}.hover\:bg-green-100:hover{--tw-bg-opacity: 1;background-color:rgb(220 252 231 / var(--tw-bg-opacity, 1))}.hover\:bg-purple-100:hover{--tw-bg-opacity: 1;background-color:rgb(243 232 255 / var(--tw-bg-opacity, 1))}.hover\:bg-slate-600:hover{--tw-bg-opacity: 1;background-color:rgb(71 85 105 / var(--tw-bg-opacity, 1))}.hover\:bg-slate-600\/50:hover{background-color:#47556980}.hover\:bg-teal-50:hover{--tw-bg-opacity: 1;background-color:rgb(240 253 250 / var(--tw-bg-opacity, 1))}.hover\:bg-teal-50\/50:hover{background-color:#f0fdfa80}.hover\:bg-teal-600:hover{--tw-bg-opacity: 1;background-color:rgb(13 148 136 / var(--tw-bg-opacity, 1))}.hover\:text-gray-800:hover{--tw-text-opacity: 1;color:rgb(31 41 55 / var(--tw-text-opacity, 1))}.hover\:text-red-500:hover{--tw-text-opacity: 1;color:rgb(239 68 68 / var(--tw-text-opacity, 1))}.hover\:text-teal-800:hover{--tw-text-opacity: 1;color:rgb(17 94 89 / var(--tw-text-opacity, 1))}.disabled\:bg-gray-300:disabled{--tw-bg-opacity: 1;background-color:rgb(209 213 219 / var(--tw-bg-opacity, 1))}@media(min-width:768px){.md\:grid-cols-2{grid-template-columns:repeat(2,minmax(0,1fr))}.md\:grid-cols-4{grid-template-columns:repeat(4,minmax(0,1fr))}.md\:flex-row{flex-direction:row}.md\:p-8{padding:2rem}.md\:text-4xl{font-size:2.25rem;line-height:2.5rem}}</style>
</head>
<body>
  <div id="root"></div>
</body>
</html>
