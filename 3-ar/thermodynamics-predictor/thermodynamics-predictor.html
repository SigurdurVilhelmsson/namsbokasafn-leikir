<!DOCTYPE html>
<html lang="is">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Varmafr√¶√∞i Sp√°ma√∞ur - Kvenno Efnafr√¶√∞i</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Kvenno Brand Colors */
        :root {
            --kvenno-orange: #f36b22;
            --kvenno-orange-dark: #d95a1a;
            --exothermic: #ff6b6b;
            --endothermic: #4dabf7;
            --entropy-increase: #22c55e;
            --entropy-decrease: #a855f7;
            --spontaneous: #22c55e;
            --non-spontaneous: #ef4444;
        }

        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
                'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
                sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            background: #f9fafb;
        }

        /* Header Styles */
        .site-header {
            background: white;
            border-bottom: 2px solid #e5e7eb;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1rem;
            height: 60px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .site-logo {
            font-size: 1.25rem;
            font-weight: bold;
            color: var(--kvenno-orange);
            text-decoration: none;
        }

        .site-logo:hover {
            color: var(--kvenno-orange-dark);
        }

        .header-btn {
            background: white;
            border: 2px solid var(--kvenno-orange);
            color: var(--kvenno-orange);
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-left: 0.5rem;
        }

        .header-btn:hover {
            background: var(--kvenno-orange);
            color: white;
        }

        /* Back Button */
        .back-btn {
            background: white;
            border: 2px solid var(--kvenno-orange);
            color: var(--kvenno-orange);
            padding: 8px 16px;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
            font-size: 0.875rem;
            margin: 0 1rem 1rem 1rem;
        }

        .back-btn:hover {
            background: var(--kvenno-orange);
            color: white;
        }

        /* Graph Canvas */
        #deltaGGraph {
            border-radius: 12px;
            background: white;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        /* Entropy Particles */
        .entropy-container {
            position: relative;
            width: 100%;
            height: 150px;
            border-radius: 12px;
            overflow: hidden;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .particle {
            position: absolute;
            width: 12px;
            height: 12px;
            background: white;
            border-radius: 50%;
            opacity: 0.9;
            transition: all 0.5s ease;
        }

        .particle-ordered {
            animation: vibrate 1s infinite;
        }

        .particle-disordered {
            animation: float 3s infinite ease-in-out;
        }

        @keyframes vibrate {
            0%, 100% { transform: translate(0, 0); }
            25% { transform: translate(-2px, -2px); }
            50% { transform: translate(2px, 2px); }
            75% { transform: translate(-2px, 2px); }
        }

        @keyframes float {
            0%, 100% { transform: translate(0, 0); }
            33% { transform: translate(var(--float-x), var(--float-y)); }
            66% { transform: translate(var(--float-x2), var(--float-y2)); }
        }

        /* Animations */
        @keyframes pulse-success {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .pulse-success {
            animation: pulse-success 0.6s ease-in-out;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        .shake {
            animation: shake 0.4s ease-in-out;
        }

        /* Slider Styles */
        input[type="range"] {
            width: 100%;
            height: 8px;
            border-radius: 5px;
            background: #e5e7eb;
            outline: none;
            -webkit-appearance: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--kvenno-orange);
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--kvenno-orange);
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        /* Mobile Optimizations */
        @media (max-width: 768px) {
            #deltaGGraph {
                max-width: 100%;
                height: auto;
            }

            .header-content {
                font-size: 0.875rem;
            }

            .entropy-container {
                height: 120px;
            }
        }

        /* Scenario Badge Colors */
        .scenario-1 { background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%); }
        .scenario-2 { background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); }
        .scenario-3 { background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); }
        .scenario-4 { background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="site-header">
        <div class="header-content">
            <a href="/" class="site-logo">Kvenno Efnafr√¶√∞i</a>
            <div>
                <button class="header-btn" onclick="window.location.href='/'">‚Üê Heim</button>
            </div>
        </div>
    </header>

    <!-- Main App Container -->
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // Problem Bank - 30 Thermodynamics Problems
        const PROBLEMS = {
            beginner: [
                {
                    id: 1,
                    reaction: "CH‚ÇÑ(g) + 2O‚ÇÇ(g) ‚Üí CO‚ÇÇ(g) + 2H‚ÇÇO(g)",
                    name: "Brennsla metans",
                    deltaH: -802,
                    deltaS: -5,
                    defaultTemp: 298,
                    scenario: 3,
                    difficulty: "Au√∞velt"
                },
                {
                    id: 2,
                    reaction: "H‚ÇÇO(l) ‚Üí H‚ÇÇO(s)",
                    name: "Frysing vatns",
                    deltaH: -6.0,
                    deltaS: -22,
                    defaultTemp: 273,
                    scenario: 3,
                    difficulty: "Au√∞velt"
                },
                {
                    id: 3,
                    reaction: "2H‚ÇÇO‚ÇÇ(l) ‚Üí 2H‚ÇÇO(l) + O‚ÇÇ(g)",
                    name: "Ni√∞urbrot vetnisprox√≠√∞s",
                    deltaH: -196,
                    deltaS: 126,
                    defaultTemp: 298,
                    scenario: 1,
                    difficulty: "Au√∞velt"
                },
                {
                    id: 4,
                    reaction: "3O‚ÇÇ(g) ‚Üí 2O‚ÇÉ(g)",
                    name: "Myndun √≥sons",
                    deltaH: 285,
                    deltaS: -137,
                    defaultTemp: 298,
                    scenario: 2,
                    difficulty: "Au√∞velt"
                },
                {
                    id: 5,
                    reaction: "H‚ÇÇO(l) ‚Üí H‚ÇÇO(g)",
                    name: "Uppgufun vatns vi√∞ 25¬∞C",
                    deltaH: 44.0,
                    deltaS: 118,
                    defaultTemp: 298,
                    scenario: 4,
                    difficulty: "Au√∞velt"
                },
                {
                    id: 6,
                    reaction: "2H‚ÇÇ(g) + O‚ÇÇ(g) ‚Üí 2H‚ÇÇO(l)",
                    name: "Myndun vatns",
                    deltaH: -572,
                    deltaS: -327,
                    defaultTemp: 298,
                    scenario: 3,
                    difficulty: "Au√∞velt"
                },
                {
                    id: 7,
                    reaction: "NaCl(s) ‚Üí Na‚Å∫(aq) + Cl‚Åª(aq)",
                    name: "Leysing NaCl",
                    deltaH: 3.9,
                    deltaS: 43,
                    defaultTemp: 298,
                    scenario: 4,
                    difficulty: "Au√∞velt"
                },
                {
                    id: 8,
                    reaction: "C(s) + O‚ÇÇ(g) ‚Üí CO‚ÇÇ(g)",
                    name: "Brennsla kolefnis",
                    deltaH: -394,
                    deltaS: 3,
                    defaultTemp: 298,
                    scenario: 1,
                    difficulty: "Au√∞velt"
                },
                {
                    id: 9,
                    reaction: "N‚ÇÇ(g) + O‚ÇÇ(g) ‚Üí 2NO(g)",
                    name: "Myndun k√∂fnunarefnisox√≠√∞s",
                    deltaH: 180,
                    deltaS: 25,
                    defaultTemp: 298,
                    scenario: 4,
                    difficulty: "Au√∞velt"
                },
                {
                    id: 10,
                    reaction: "CO(g) + ¬ΩO‚ÇÇ(g) ‚Üí CO‚ÇÇ(g)",
                    name: "Brennsla kols√Ωrings",
                    deltaH: -283,
                    deltaS: -87,
                    defaultTemp: 298,
                    scenario: 3,
                    difficulty: "Au√∞velt"
                }
            ],
            intermediate: [
                {
                    id: 11,
                    reaction: "N‚ÇÇ(g) + 3H‚ÇÇ(g) ‚Üí 2NH‚ÇÉ(g)",
                    name: "Haber a√∞fer√∞in",
                    deltaH: -92,
                    deltaS: -199,
                    defaultTemp: 500,
                    scenario: 3,
                    difficulty: "Mi√∞lungs"
                },
                {
                    id: 12,
                    reaction: "CaCO‚ÇÉ(s) ‚Üí CaO(s) + CO‚ÇÇ(g)",
                    name: "Ni√∞urbrot kals√≠umkarb√≥nats",
                    deltaH: 178,
                    deltaS: 161,
                    defaultTemp: 1000,
                    scenario: 4,
                    difficulty: "Mi√∞lungs"
                },
                {
                    id: 13,
                    reaction: "H‚ÇÇO(l) ‚Üí H‚ÇÇO(g)",
                    name: "Uppgufun vatns vi√∞ 100¬∞C",
                    deltaH: 44.0,
                    deltaS: 118,
                    defaultTemp: 373,
                    scenario: 4,
                    difficulty: "Mi√∞lungs"
                },
                {
                    id: 14,
                    reaction: "6CO‚ÇÇ(g) + 6H‚ÇÇO(l) ‚Üí C‚ÇÜH‚ÇÅ‚ÇÇO‚ÇÜ(s) + 6O‚ÇÇ(g)",
                    name: "Lj√≥still√≠fun",
                    deltaH: 2803,
                    deltaS: -210,
                    defaultTemp: 298,
                    scenario: 2,
                    difficulty: "Mi√∞lungs"
                },
                {
                    id: 15,
                    reaction: "C(demant) ‚Üí C(graf√≠t)",
                    name: "Demant ‚Üí Graf√≠t",
                    deltaH: -1.9,
                    deltaS: 3.3,
                    defaultTemp: 298,
                    scenario: 1,
                    difficulty: "Mi√∞lungs"
                },
                {
                    id: 16,
                    reaction: "2SO‚ÇÇ(g) + O‚ÇÇ(g) ‚Üí 2SO‚ÇÉ(g)",
                    name: "Contact a√∞fer√∞in",
                    deltaH: -198,
                    deltaS: -188,
                    defaultTemp: 723,
                    scenario: 3,
                    difficulty: "Mi√∞lungs"
                },
                {
                    id: 17,
                    reaction: "CH‚ÇÑ(g) + H‚ÇÇO(g) ‚Üí CO(g) + 3H‚ÇÇ(g)",
                    name: "Gufumyndun",
                    deltaH: 206,
                    deltaS: 216,
                    defaultTemp: 1000,
                    scenario: 4,
                    difficulty: "Mi√∞lungs"
                },
                {
                    id: 18,
                    reaction: "Fe‚ÇÇO‚ÇÉ(s) + 3CO(g) ‚Üí 2Fe(s) + 3CO‚ÇÇ(g)",
                    name: "J√°rnframlei√∞sla",
                    deltaH: -25,
                    deltaS: 15,
                    defaultTemp: 1200,
                    scenario: 1,
                    difficulty: "Mi√∞lungs"
                },
                {
                    id: 19,
                    reaction: "NH‚ÇÑCl(s) ‚Üí NH‚ÇÉ(g) + HCl(g)",
                    name: "Ni√∞urbrot ammon√≠umkl√≥r√≠√∞s",
                    deltaH: 176,
                    deltaS: 285,
                    defaultTemp: 298,
                    scenario: 4,
                    difficulty: "Mi√∞lungs"
                },
                {
                    id: 20,
                    reaction: "PCl‚ÇÖ(g) ‚Üí PCl‚ÇÉ(g) + Cl‚ÇÇ(g)",
                    name: "Ni√∞urbrot PCl‚ÇÖ",
                    deltaH: 88,
                    deltaS: 140,
                    defaultTemp: 500,
                    scenario: 4,
                    difficulty: "Mi√∞lungs"
                },
                {
                    id: 21,
                    reaction: "2NO‚ÇÇ(g) ‚Üí N‚ÇÇO‚ÇÑ(g)",
                    name: "D√≠mun NO‚ÇÇ",
                    deltaH: -57,
                    deltaS: -176,
                    defaultTemp: 298,
                    scenario: 3,
                    difficulty: "Mi√∞lungs"
                },
                {
                    id: 22,
                    reaction: "Br‚ÇÇ(l) ‚Üí Br‚ÇÇ(g)",
                    name: "Uppgufun br√≥ms",
                    deltaH: 31,
                    deltaS: 93,
                    defaultTemp: 298,
                    scenario: 4,
                    difficulty: "Mi√∞lungs"
                }
            ],
            advanced: [
                {
                    id: 23,
                    reaction: "N‚ÇÇ(g) + 3H‚ÇÇ(g) ‚Üí 2NH‚ÇÉ(g)",
                    name: "ŒîG¬∞ ‚Üí K umbreyting",
                    deltaH: -92,
                    deltaS: -199,
                    defaultTemp: 298,
                    scenario: 3,
                    difficulty: "Erfitt",
                    advancedTask: "Reikna√∞u K vi√∞ 298 K"
                },
                {
                    id: 24,
                    reaction: "N‚ÇÇ(g) + 3H‚ÇÇ(g) ‚Üí 2NH‚ÇÉ(g)",
                    name: "Hitastigsh√°√∞ K",
                    deltaH: -92,
                    deltaS: -199,
                    defaultTemp: 500,
                    scenario: 3,
                    difficulty: "Erfitt",
                    advancedTask: "Reikna√∞u K vi√∞ 298 K, 500 K, og 700 K"
                },
                {
                    id: 25,
                    reaction: "C(s) + ¬ΩO‚ÇÇ(g) ‚Üí CO(g)",
                    name: "Samtvinnu√∞ hvarfefni",
                    deltaH: -137,
                    deltaS: 90,
                    defaultTemp: 298,
                    scenario: 1,
                    difficulty: "Erfitt",
                    advancedTask: "Nota√∞u Hess l√∂gm√°l"
                },
                {
                    id: 26,
                    reaction: "Pr√≥te√≠n (felltur) ‚Üí Pr√≥te√≠n (√≥vafinn)",
                    name: "Afv√∂fnun pr√≥t√≠ns",
                    deltaH: 250,
                    deltaS: 750,
                    defaultTemp: 310,
                    scenario: 4,
                    difficulty: "Erfitt",
                    advancedTask: "Hvers vegna afvafnast pr√≥t√≠n vi√∞ h√°um hita?"
                },
                {
                    id: 27,
                    reaction: "ATP + H‚ÇÇO ‚Üí ADP + P·µ¢",
                    name: "ATP vatnsrofhvarfun",
                    deltaH: -20,
                    deltaS: 35,
                    defaultTemp: 310,
                    scenario: 1,
                    difficulty: "Erfitt",
                    advancedTask: "Reikna√∞u K og √∫tsk√Ωr√∞u l√≠ffr√¶√∞ilega √æ√Ω√∞ingu"
                },
                {
                    id: 28,
                    reaction: "Zn(s) + Cu¬≤‚Å∫(aq) ‚Üí Zn¬≤‚Å∫(aq) + Cu(s)",
                    name: "Rafefnafr√¶√∞ileg tenging",
                    deltaH: -218,
                    deltaS: -20,
                    defaultTemp: 298,
                    scenario: 3,
                    difficulty: "Erfitt",
                    advancedTask: "Nota√∞u ŒîG¬∞ = -nFE¬∞ (E¬∞ = 1.10 V)"
                },
                {
                    id: 29,
                    reaction: "H‚ÇÇO(s) ‚Üí H‚ÇÇO(l)",
                    name: "Br√¶√∞sla √≠s",
                    deltaH: 6.0,
                    deltaS: 22,
                    defaultTemp: 273,
                    scenario: 4,
                    difficulty: "Erfitt",
                    advancedTask: "Sp√°√∞u br√¶√∞slumarki vi√∞ 1 atm"
                },
                {
                    id: 30,
                    reaction: "2SO‚ÇÇ(g) + O‚ÇÇ(g) ‚Üí 2SO‚ÇÉ(g)",
                    name: "Hagr√¶√∞ing i√∞na√∞arhvarfs",
                    deltaH: -198,
                    deltaS: -188,
                    defaultTemp: 723,
                    scenario: 3,
                    difficulty: "Erfitt",
                    advancedTask: "Hva√∞a hitastig h√°markar framlei√∞slu?"
                }
            ]
        };

        // Main App Component
        function ThermodynamicsPredictor() {
            const [mode, setMode] = useState('menu'); // menu, learning, challenge
            const [difficulty, setDifficulty] = useState('beginner');
            const [currentProblem, setCurrentProblem] = useState(null);
            const [temperature, setTemperature] = useState(298);
            const [userDeltaG, setUserDeltaG] = useState('');
            const [userSpontaneity, setUserSpontaneity] = useState('');
            const [showSolution, setShowSolution] = useState(false);
            const [feedback, setFeedback] = useState('');
            const [score, setScore] = useState(0);
            const [streak, setStreak] = useState(0);
            const [problemsCompleted, setProblemsCompleted] = useState(0);
            const [timeLeft, setTimeLeft] = useState(90);
            const graphRef = useRef(null);

            // Start new problem
            const startNewProblem = () => {
                const problems = PROBLEMS[difficulty];
                const randomProblem = problems[Math.floor(Math.random() * problems.length)];
                setCurrentProblem(randomProblem);
                setTemperature(randomProblem.defaultTemp);
                setUserDeltaG('');
                setUserSpontaneity('');
                setShowSolution(false);
                setFeedback('');
                if (mode === 'challenge') {
                    setTimeLeft(90);
                }
            };

            // Calculate ŒîG
            const calculateDeltaG = (temp) => {
                if (!currentProblem) return 0;
                const deltaH = currentProblem.deltaH;
                const deltaS = currentProblem.deltaS / 1000; // Convert J to kJ
                return deltaH - (temp * deltaS);
            };

            // Get spontaneity
            const getSpontaneity = (deltaG) => {
                if (Math.abs(deltaG) < 1) return 'equilibrium';
                return deltaG < 0 ? 'spontaneous' : 'non-spontaneous';
            };

            // Get scenario description
            const getScenarioDescription = (scenario) => {
                const descriptions = {
                    1: "Alltaf sj√°lfviljugt (ŒîH<0, ŒîS>0 e√∞a ŒîH<<0)",
                    2: "Aldrei sj√°lfviljugt (ŒîH>0, ŒîS<0)",
                    3: "Sj√°lfviljugt vi√∞ l√°gt hitastig (ŒîH<0, ŒîS<0)",
                    4: "Sj√°lfviljugt vi√∞ h√°tt hitastig (ŒîH>0, ŒîS>0)"
                };
                return descriptions[scenario] || "";
            };

            // Check answer
            const checkAnswer = () => {
                const calculatedDeltaG = calculateDeltaG(temperature);
                const correctSpontaneity = getSpontaneity(calculatedDeltaG);

                const deltaGDiff = Math.abs(parseFloat(userDeltaG) - calculatedDeltaG);
                const deltaGCorrect = deltaGDiff <= 5;
                const spontaneityCorrect = userSpontaneity === correctSpontaneity;

                if (deltaGCorrect && spontaneityCorrect) {
                    const points = 100 + (streak * 10);
                    setScore(score + points);
                    setStreak(streak + 1);
                    setFeedback(`R√©tt! +${points} stig`);
                    setProblemsCompleted(problemsCompleted + 1);
                } else {
                    setStreak(0);
                    if (!deltaGCorrect && !spontaneityCorrect) {
                        setFeedback('Rangt. B√¶√∞i ŒîG √∫treikningur og sj√°lfviljugheit eru r√∂ng.');
                    } else if (!deltaGCorrect) {
                        setFeedback(`Sj√°lfviljugheit er r√©tt en ŒîG er rangt. R√©tt svar: ${calculatedDeltaG.toFixed(1)} kJ/mol`);
                    } else {
                        setFeedback(`ŒîG er r√©tt en sj√°lfviljugheit er r√∂ng. R√©tt svar: ${correctSpontaneity === 'spontaneous' ? 'Sj√°lfviljugt' : correctSpontaneity === 'equilibrium' ? 'Jafnv√¶gi' : 'Ekki sj√°lfviljugt'}`);
                    }
                }
                setShowSolution(true);
            };

            // Draw graph
            useEffect(() => {
                if (!graphRef.current || !currentProblem) return;

                const canvas = graphRef.current;
                const ctx = canvas.getContext('2d');
                const width = canvas.width;
                const height = canvas.height;

                // Clear canvas
                ctx.clearRect(0, 0, width, height);

                // Calculate values
                const deltaH = currentProblem.deltaH;
                const deltaS = currentProblem.deltaS / 1000;
                const tempRange = { min: 200, max: 1200 };
                const deltaGRange = { min: -500, max: 500 };

                // Draw axes
                ctx.strokeStyle = '#374151';
                ctx.lineWidth = 2;

                // Y-axis
                ctx.beginPath();
                ctx.moveTo(50, 30);
                ctx.lineTo(50, height - 30);
                ctx.stroke();

                // X-axis
                ctx.beginPath();
                ctx.moveTo(50, height / 2);
                ctx.lineTo(width - 30, height / 2);
                ctx.stroke();

                // Labels
                ctx.fillStyle = '#374151';
                ctx.font = '12px sans-serif';
                ctx.fillText('ŒîG (kJ/mol)', 10, 20);
                ctx.fillText('T (K)', width - 50, height - 10);

                // Draw ŒîG line
                ctx.strokeStyle = '#f36b22';
                ctx.lineWidth = 3;
                ctx.beginPath();

                for (let t = tempRange.min; t <= tempRange.max; t += 10) {
                    const deltaG = deltaH - (t * deltaS);
                    const x = 50 + ((t - tempRange.min) / (tempRange.max - tempRange.min)) * (width - 80);
                    const y = height / 2 - (deltaG / deltaGRange.max) * (height / 2 - 40);

                    if (t === tempRange.min) {
                        ctx.moveTo(x, y);
                    } else {
                        ctx.lineTo(x, y);
                    }
                }
                ctx.stroke();

                // Draw current temperature marker
                const currentDeltaG = calculateDeltaG(temperature);
                const x = 50 + ((temperature - tempRange.min) / (tempRange.max - tempRange.min)) * (width - 80);
                const y = height / 2 - (currentDeltaG / deltaGRange.max) * (height / 2 - 40);

                ctx.fillStyle = currentDeltaG < 0 ? '#22c55e' : '#ef4444';
                ctx.beginPath();
                ctx.arc(x, y, 6, 0, 2 * Math.PI);
                ctx.fill();

                // Draw spontaneity zones
                ctx.fillStyle = 'rgba(34, 197, 94, 0.1)';
                ctx.fillRect(50, height / 2, width - 80, height / 2 - 30);

                ctx.fillStyle = 'rgba(239, 68, 68, 0.1)';
                ctx.fillRect(50, 30, width - 80, height / 2 - 30);

            }, [currentProblem, temperature]);

            // Timer for challenge mode
            useEffect(() => {
                if (mode === 'challenge' && timeLeft > 0 && !showSolution) {
                    const timer = setTimeout(() => setTimeLeft(timeLeft - 1), 1000);
                    return () => clearTimeout(timer);
                }
                if (timeLeft === 0 && !showSolution) {
                    setFeedback('T√≠minn rann √∫t!');
                    setShowSolution(true);
                    setStreak(0);
                }
            }, [mode, timeLeft, showSolution]);

            // Menu Screen
            if (mode === 'menu') {
                return (
                    <div className="max-w-4xl mx-auto px-4 py-8">
                        <div className="bg-white rounded-lg shadow-lg p-8">
                            <h1 className="text-4xl font-bold text-center mb-4" style={{color: 'var(--kvenno-orange)'}}>
                                üå°Ô∏è Varmafr√¶√∞i Sp√°ma√∞ur
                            </h1>
                            <p className="text-center text-gray-600 mb-8">
                                L√¶r√∞u um Gibbs frj√°lsa orku og sj√°lfviljugheit efnahvarfa
                            </p>

                            <div className="mb-8 p-6 bg-blue-50 rounded-lg">
                                <h2 className="text-xl font-bold mb-4">üìö Um leikinn</h2>
                                <p className="mb-4">√ûessi leikur kennir √æ√©r a√∞:</p>
                                <ul className="list-disc list-inside space-y-2 text-gray-700">
                                    <li>Reikna Gibbs frj√°lsa orku: <strong>ŒîG = ŒîH - TŒîS</strong></li>
                                    <li>Sp√° fyrir um sj√°lfviljugheit hvarfa</li>
                                    <li>Skilja √°hrif hitastigs √° hvarfefni</li>
                                    <li>√ûekkja fj√∂gur varmafr√¶√∞ileg atbur√∞ar√°s</li>
                                    <li>T√∫lka ŒîG vs T gr√∂f</li>
                                </ul>
                            </div>

                            <div className="mb-8">
                                <h3 className="text-lg font-bold mb-4">Veldu erfi√∞leikastig:</h3>
                                <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <button
                                        onClick={() => setDifficulty('beginner')}
                                        className={`p-4 rounded-lg border-2 transition ${
                                            difficulty === 'beginner'
                                                ? 'border-orange-500 bg-orange-50'
                                                : 'border-gray-300 hover:border-orange-300'
                                        }`}
                                    >
                                        <div className="text-lg font-bold">üü¢ Au√∞velt</div>
                                        <div className="text-sm text-gray-600">Einf√∂ld hvarfefni</div>
                                    </button>
                                    <button
                                        onClick={() => setDifficulty('intermediate')}
                                        className={`p-4 rounded-lg border-2 transition ${
                                            difficulty === 'intermediate'
                                                ? 'border-orange-500 bg-orange-50'
                                                : 'border-gray-300 hover:border-orange-300'
                                        }`}
                                    >
                                        <div className="text-lg font-bold">üü° Mi√∞lungs</div>
                                        <div className="text-sm text-gray-600">I√∞na√∞arhvarfefni</div>
                                    </button>
                                    <button
                                        onClick={() => setDifficulty('advanced')}
                                        className={`p-4 rounded-lg border-2 transition ${
                                            difficulty === 'advanced'
                                                ? 'border-orange-500 bg-orange-50'
                                                : 'border-gray-300 hover:border-orange-300'
                                        }`}
                                    >
                                        <div className="text-lg font-bold">üî¥ Erfitt</div>
                                        <div className="text-sm text-gray-600">H√°√ær√≥a√∞ir √∫treikningar</div>
                                    </button>
                                </div>
                            </div>

                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <button
                                    onClick={() => {
                                        setMode('learning');
                                        startNewProblem();
                                    }}
                                    className="p-6 rounded-lg text-white font-bold text-lg transition"
                                    style={{background: 'linear-gradient(135deg, #22c55e 0%, #16a34a 100%)'}}
                                >
                                    üìñ √Üfingarhamur
                                    <div className="text-sm font-normal mt-1">√ìtakmarka√∞ur t√≠mi, v√≠sbendingar</div>
                                </button>
                                <button
                                    onClick={() => {
                                        setMode('challenge');
                                        setScore(0);
                                        setStreak(0);
                                        setProblemsCompleted(0);
                                        startNewProblem();
                                    }}
                                    className="p-6 rounded-lg text-white font-bold text-lg transition"
                                    style={{background: 'linear-gradient(135deg, #f36b22 0%, #d95a1a 100%)'}}
                                >
                                    ‚ö° Keppnishamur
                                    <div className="text-sm font-normal mt-1">90 sek t√≠mi, stigagj√∂f</div>
                                </button>
                            </div>
                        </div>
                    </div>
                );
            }

            // Game Screen
            if (!currentProblem) return null;

            const currentDeltaG = calculateDeltaG(temperature);
            const currentSpontaneity = getSpontaneity(currentDeltaG);
            const crossoverTemp = currentProblem.deltaS !== 0
                ? Math.abs(currentProblem.deltaH / (currentProblem.deltaS / 1000))
                : null;

            return (
                <div className="max-w-6xl mx-auto px-4 py-6">
                    {/* Header */}
                    <div className="bg-white rounded-lg shadow p-4 mb-4">
                        <div className="flex justify-between items-center flex-wrap gap-4">
                            <button
                                onClick={() => setMode('menu')}
                                className="px-4 py-2 border-2 rounded-lg font-medium"
                                style={{borderColor: 'var(--kvenno-orange)', color: 'var(--kvenno-orange)'}}
                            >
                                ‚Üê Til baka
                            </button>

                            <div className="flex gap-4 items-center">
                                {mode === 'challenge' && (
                                    <>
                                        <div className="text-center">
                                            <div className="text-sm text-gray-600">Stig</div>
                                            <div className="text-xl font-bold">{score}</div>
                                        </div>
                                        <div className="text-center">
                                            <div className="text-sm text-gray-600">Runa</div>
                                            <div className="text-xl font-bold">{streak}üî•</div>
                                        </div>
                                        <div className="text-center">
                                            <div className="text-sm text-gray-600">T√≠mi</div>
                                            <div className={`text-xl font-bold ${timeLeft < 20 ? 'text-red-500' : ''}`}>
                                                {timeLeft}s
                                            </div>
                                        </div>
                                    </>
                                )}
                            </div>

                            <div className="text-center">
                                <div className="text-sm text-gray-600">Spurning</div>
                                <div className="text-xl font-bold">{problemsCompleted + 1}</div>
                            </div>
                        </div>
                    </div>

                    <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        {/* Left Column - Problem & Controls */}
                        <div className="space-y-4">
                            {/* Problem Display */}
                            <div className="bg-white rounded-lg shadow-lg p-6">
                                <div className="mb-4">
                                    <span className={`inline-block px-3 py-1 rounded-full text-white text-sm scenario-${currentProblem.scenario}`}>
                                        Atbur√∞ar√°s {currentProblem.scenario}
                                    </span>
                                    <span className="ml-2 text-sm text-gray-600">{currentProblem.difficulty}</span>
                                </div>

                                <h2 className="text-xl font-bold mb-2">{currentProblem.name}</h2>
                                <div className="text-lg mb-4 font-mono bg-gray-50 p-3 rounded">
                                    {currentProblem.reaction}
                                </div>

                                <div className="grid grid-cols-2 gap-4 mb-4">
                                    <div className="bg-red-50 p-3 rounded-lg">
                                        <div className="text-sm text-gray-600">Entalp√≠a (ŒîH¬∞)</div>
                                        <div className="text-xl font-bold" style={{color: currentProblem.deltaH < 0 ? 'var(--exothermic)' : 'var(--endothermic)'}}>
                                            {currentProblem.deltaH > 0 ? '+' : ''}{currentProblem.deltaH} kJ/mol
                                        </div>
                                        <div className="text-xs mt-1">
                                            {currentProblem.deltaH < 0 ? 'üî• Varmalosandi' : '‚ùÑÔ∏è Varmabindandi'}
                                        </div>
                                    </div>

                                    <div className="bg-purple-50 p-3 rounded-lg">
                                        <div className="text-sm text-gray-600">√ìrei√∞a (ŒîS¬∞)</div>
                                        <div className="text-xl font-bold" style={{color: currentProblem.deltaS > 0 ? 'var(--entropy-increase)' : 'var(--entropy-decrease)'}}>
                                            {currentProblem.deltaS > 0 ? '+' : ''}{currentProblem.deltaS} J/(mol¬∑K)
                                        </div>
                                        <div className="text-xs mt-1">
                                            {currentProblem.deltaS > 0 ? '‚Üë √ìrei√∞a eykst' : '‚Üì √ìrei√∞a minnkar'}
                                        </div>
                                    </div>
                                </div>

                                {currentProblem.advancedTask && (
                                    <div className="bg-yellow-50 border-l-4 border-yellow-400 p-3 mb-4">
                                        <div className="text-sm font-bold">√Åskorun:</div>
                                        <div className="text-sm">{currentProblem.advancedTask}</div>
                                    </div>
                                )}
                            </div>

                            {/* Temperature Slider */}
                            <div className="bg-white rounded-lg shadow-lg p-6">
                                <h3 className="font-bold mb-3">üå°Ô∏è Hitastig</h3>
                                <div className="mb-4">
                                    <input
                                        type="range"
                                        min="200"
                                        max="1200"
                                        value={temperature}
                                        onChange={(e) => setTemperature(parseInt(e.target.value))}
                                        className="w-full"
                                    />
                                    <div className="flex justify-between text-sm text-gray-600 mt-2">
                                        <span>200 K</span>
                                        <span className="text-xl font-bold" style={{color: 'var(--kvenno-orange)'}}>
                                            {temperature} K ({(temperature - 273).toFixed(0)}¬∞C)
                                        </span>
                                        <span>1200 K</span>
                                    </div>
                                </div>

                                {/* Real-time ŒîG calculation */}
                                <div className="bg-gradient-to-r from-blue-50 to-purple-50 p-4 rounded-lg">
                                    <div className="text-sm text-gray-600 mb-2">Vi√∞ n√∫verandi hitastig:</div>
                                    <div className="font-mono text-sm mb-2">
                                        ŒîG¬∞ = ŒîH¬∞ - TŒîS¬∞<br/>
                                        ŒîG¬∞ = ({currentProblem.deltaH}) - ({temperature})({(currentProblem.deltaS/1000).toFixed(3)})<br/>
                                        ŒîG¬∞ = <span className="font-bold text-lg">{currentDeltaG.toFixed(1)} kJ/mol</span>
                                    </div>
                                    <div className={`text-lg font-bold ${currentSpontaneity === 'spontaneous' ? 'text-green-600' : currentSpontaneity === 'equilibrium' ? 'text-yellow-600' : 'text-red-600'}`}>
                                        {currentSpontaneity === 'spontaneous' && '‚úì Sj√°lfviljugt'}
                                        {currentSpontaneity === 'equilibrium' && '‚öñÔ∏è Jafnv√¶gi'}
                                        {currentSpontaneity === 'non-spontaneous' && '‚úó Ekki sj√°lfviljugt'}
                                    </div>
                                </div>

                                {crossoverTemp && (
                                    <div className="mt-3 text-sm text-gray-600 bg-gray-50 p-3 rounded">
                                        üí° V√≠sbending: Umbreytingarhitastig = {crossoverTemp.toFixed(0)} K ({(crossoverTemp - 273).toFixed(0)}¬∞C)
                                    </div>
                                )}
                            </div>

                            {/* Answer Input */}
                            {!showSolution && (
                                <div className="bg-white rounded-lg shadow-lg p-6">
                                    <h3 className="font-bold mb-4">Svari√∞ √æitt:</h3>

                                    <div className="mb-4">
                                        <label className="block text-sm font-medium mb-2">
                                            ŒîG¬∞ vi√∞ {temperature} K (kJ/mol):
                                        </label>
                                        <input
                                            type="number"
                                            step="0.1"
                                            value={userDeltaG}
                                            onChange={(e) => setUserDeltaG(e.target.value)}
                                            className="w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:border-orange-500 focus:outline-none"
                                            placeholder="t.d. -33.5"
                                        />
                                    </div>

                                    <div className="mb-4">
                                        <label className="block text-sm font-medium mb-2">
                                            Sj√°lfviljugheit:
                                        </label>
                                        <div className="grid grid-cols-3 gap-2">
                                            <button
                                                onClick={() => setUserSpontaneity('spontaneous')}
                                                className={`px-4 py-2 rounded-lg border-2 transition ${
                                                    userSpontaneity === 'spontaneous'
                                                        ? 'border-green-500 bg-green-50 font-bold'
                                                        : 'border-gray-300 hover:border-green-300'
                                                }`}
                                            >
                                                ‚úì Sj√°lfviljugt
                                            </button>
                                            <button
                                                onClick={() => setUserSpontaneity('equilibrium')}
                                                className={`px-4 py-2 rounded-lg border-2 transition ${
                                                    userSpontaneity === 'equilibrium'
                                                        ? 'border-yellow-500 bg-yellow-50 font-bold'
                                                        : 'border-gray-300 hover:border-yellow-300'
                                                }`}
                                            >
                                                ‚öñÔ∏è Jafnv√¶gi
                                            </button>
                                            <button
                                                onClick={() => setUserSpontaneity('non-spontaneous')}
                                                className={`px-4 py-2 rounded-lg border-2 transition ${
                                                    userSpontaneity === 'non-spontaneous'
                                                        ? 'border-red-500 bg-red-50 font-bold'
                                                        : 'border-gray-300 hover:border-red-300'
                                                }`}
                                            >
                                                ‚úó Ekki sj√°lfviljugt
                                            </button>
                                        </div>
                                    </div>

                                    <button
                                        onClick={checkAnswer}
                                        disabled={!userDeltaG || !userSpontaneity}
                                        className="w-full py-3 rounded-lg text-white font-bold text-lg transition disabled:opacity-50 disabled:cursor-not-allowed"
                                        style={{background: 'linear-gradient(135deg, #f36b22 0%, #d95a1a 100%)'}}
                                    >
                                        Athuga svar
                                    </button>
                                </div>
                            )}

                            {/* Feedback */}
                            {feedback && (
                                <div className={`rounded-lg shadow-lg p-6 ${
                                    feedback.includes('R√©tt') ? 'bg-green-50 border-2 border-green-500' : 'bg-red-50 border-2 border-red-500'
                                }`}>
                                    <div className="text-lg font-bold mb-2">{feedback}</div>
                                    {showSolution && (
                                        <button
                                            onClick={startNewProblem}
                                            className="mt-4 w-full py-2 rounded-lg text-white font-bold"
                                            style={{background: 'var(--kvenno-orange)'}}
                                        >
                                            N√¶sta spurning ‚Üí
                                        </button>
                                    )}
                                </div>
                            )}

                            {/* Solution */}
                            {showSolution && (
                                <div className="bg-white rounded-lg shadow-lg p-6">
                                    <h3 className="font-bold text-lg mb-4">üìù Lausn:</h3>
                                    <div className="space-y-3 text-sm">
                                        <div>
                                            <strong>Skref 1:</strong> Umbreyta ŒîS¬∞ √≠ kJ/(mol¬∑K)<br/>
                                            ŒîS¬∞ = {currentProblem.deltaS} J/(mol¬∑K) √ó (1 kJ / 1000 J) = {(currentProblem.deltaS/1000).toFixed(3)} kJ/(mol¬∑K)
                                        </div>
                                        <div>
                                            <strong>Skref 2:</strong> Beita Gibbs j√∂fnunni<br/>
                                            ŒîG¬∞ = ŒîH¬∞ - TŒîS¬∞<br/>
                                            ŒîG¬∞ = ({currentProblem.deltaH}) - ({temperature})({(currentProblem.deltaS/1000).toFixed(3)})<br/>
                                            ŒîG¬∞ = {currentProblem.deltaH} - {(temperature * currentProblem.deltaS/1000).toFixed(1)}<br/>
                                            <strong>ŒîG¬∞ = {currentDeltaG.toFixed(1)} kJ/mol</strong>
                                        </div>
                                        <div>
                                            <strong>Skref 3:</strong> T√∫lka ni√∞urst√∂√∞u<br/>
                                            {currentDeltaG < -1 && 'ŒîG¬∞ < 0 ‚Üí SJ√ÅLFVILJUGT ‚úì'}
                                            {Math.abs(currentDeltaG) <= 1 && 'ŒîG¬∞ ‚âà 0 ‚Üí JAFNV√ÜGI ‚öñÔ∏è'}
                                            {currentDeltaG > 1 && 'ŒîG¬∞ > 0 ‚Üí EKKI SJ√ÅLFVILJUGT ‚úó'}
                                        </div>
                                        <div className="bg-blue-50 p-3 rounded">
                                            <strong>Atbur√∞ar√°s {currentProblem.scenario}:</strong><br/>
                                            {getScenarioDescription(currentProblem.scenario)}
                                        </div>
                                    </div>
                                </div>
                            )}
                        </div>

                        {/* Right Column - Visualizations */}
                        <div className="space-y-4">
                            {/* Graph */}
                            <div className="bg-white rounded-lg shadow-lg p-6">
                                <h3 className="font-bold mb-3">üìä ŒîG¬∞ vs Hitastig</h3>
                                <canvas
                                    ref={graphRef}
                                    id="deltaGGraph"
                                    width="500"
                                    height="300"
                                    className="w-full"
                                />
                                <div className="mt-3 text-xs text-gray-600 grid grid-cols-2 gap-2">
                                    <div>üî¥ L√≠nuhalli: -ŒîS¬∞</div>
                                    <div>üü¢ Sj√°lfviljugt: ŒîG¬∞ < 0</div>
                                    <div>üîµ Y-skur√∞ur: ŒîH¬∞</div>
                                    <div>üî¥ Ekki sj√°lfviljugt: ŒîG¬∞ > 0</div>
                                </div>
                            </div>

                            {/* Entropy Visualization */}
                            <div className="bg-white rounded-lg shadow-lg p-6">
                                <h3 className="font-bold mb-3">üé≤ √ìrei√∞a (Entropy)</h3>
                                <EntropyVisualization deltaS={currentProblem.deltaS} />
                                <div className="mt-4 text-sm">
                                    <div className={`font-bold ${currentProblem.deltaS > 0 ? 'text-green-600' : 'text-purple-600'}`}>
                                        {currentProblem.deltaS > 0 ? (
                                            <>
                                                ‚Üë √ìrei√∞a eykst (ŒîS¬∞ {'>'} 0)
                                                <div className="text-xs font-normal mt-1">Eftirfarandi gerist:</div>
                                                <ul className="text-xs font-normal list-disc list-inside mt-1">
                                                    <li>Lofttegundir myndast</li>
                                                    <li>Fasaskipti: solid ‚Üí liquid ‚Üí gas</li>
                                                    <li>Uppleysingarferli</li>
                                                </ul>
                                            </>
                                        ) : (
                                            <>
                                                ‚Üì √ìrei√∞a minnkar (ŒîS¬∞ {'<'} 0)
                                                <div className="text-xs font-normal mt-1">Eftirfarandi gerist:</div>
                                                <ul className="text-xs font-normal list-disc list-inside mt-1">
                                                    <li>Lofttegundir hvarf</li>
                                                    <li>Fasaskipti: gas ‚Üí liquid ‚Üí solid</li>
                                                    <li>√ötfelling</li>
                                                </ul>
                                            </>
                                        )}
                                    </div>
                                </div>
                            </div>

                            {/* Scenario Guide */}
                            <div className="bg-white rounded-lg shadow-lg p-6">
                                <h3 className="font-bold mb-3">üéØ Fj√∂gur Atbur√∞ar√°s</h3>
                                <div className="space-y-2 text-xs">
                                    <div className="p-2 rounded scenario-1 text-white">
                                        <strong>1: ŒîH{'<'}0, ŒîS{'>'}0</strong> ‚Üí Alltaf sj√°lfviljugt
                                    </div>
                                    <div className="p-2 rounded scenario-2 text-white">
                                        <strong>2: ŒîH{'>'}0, ŒîS{'<'}0</strong> ‚Üí Aldrei sj√°lfviljugt
                                    </div>
                                    <div className="p-2 rounded scenario-3 text-white">
                                        <strong>3: ŒîH{'<'}0, ŒîS{'<'}0</strong> ‚Üí Sj√°lfviljugt vi√∞ l√°gt T
                                    </div>
                                    <div className="p-2 rounded scenario-4 text-white">
                                        <strong>4: ŒîH{'>'}0, ŒîS{'>'}0</strong> ‚Üí Sj√°lfviljugt vi√∞ h√°tt T
                                    </div>
                                </div>
                            </div>

                            {/* Formula Reference */}
                            <div className="bg-gradient-to-br from-orange-50 to-red-50 rounded-lg shadow-lg p-6">
                                <h3 className="font-bold mb-3">üìê Form√∫lur</h3>
                                <div className="space-y-2 text-sm font-mono">
                                    <div className="bg-white p-2 rounded">ŒîG¬∞ = ŒîH¬∞ - TŒîS¬∞</div>
                                    <div className="bg-white p-2 rounded">ŒîG¬∞ = -RT ln K</div>
                                    <div className="bg-white p-2 rounded">T<sub>cross</sub> = ŒîH¬∞ / ŒîS¬∞</div>
                                </div>
                                <div className="mt-3 text-xs text-gray-600">
                                    R = 8.314 J/(mol¬∑K)<br/>
                                    T √≠ Kelvin (K = ¬∞C + 273)
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        // Entropy Visualization Component
        function EntropyVisualization({ deltaS }) {
            const isIncreasing = deltaS > 0;
            const particleCount = 16;

            return (
                <div className="entropy-container">
                    {[...Array(particleCount)].map((_, i) => {
                        const row = Math.floor(i / 4);
                        const col = i % 4;

                        let style;
                        if (isIncreasing) {
                            // Disordered - random positions
                            style = {
                                left: `${Math.random() * 90 + 5}%`,
                                top: `${Math.random() * 80 + 10}%`,
                                '--float-x': `${Math.random() * 40 - 20}px`,
                                '--float-y': `${Math.random() * 40 - 20}px`,
                                '--float-x2': `${Math.random() * 40 - 20}px`,
                                '--float-y2': `${Math.random() * 40 - 20}px`,
                            };
                        } else {
                            // Ordered - grid pattern
                            style = {
                                left: `${col * 22 + 15}%`,
                                top: `${row * 22 + 15}%`,
                            };
                        }

                        return (
                            <div
                                key={i}
                                className={`particle ${isIncreasing ? 'particle-disordered' : 'particle-ordered'}`}
                                style={style}
                            />
                        );
                    })}
                </div>
            );
        }

        // Render App
        ReactDOM.render(<ThermodynamicsPredictor />, document.getElementById('root'));
    </script>
</body>
</html>
