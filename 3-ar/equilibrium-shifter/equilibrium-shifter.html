<!DOCTYPE html>
<html lang="is">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Equilibrium Shifter - Kvenno Efnafr√¶√∞i</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Kvenno Brand Colors */
        :root {
            --kvenno-orange: #f36b22;
            --kvenno-orange-dark: #d95a1a;
        }

        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
                'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
                sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            background: #f9fafb;
        }

        /* Header Styles */
        .site-header {
            background: white;
            border-bottom: 2px solid #e5e7eb;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1rem;
            height: 60px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .site-logo {
            font-size: 1.25rem;
            font-weight: bold;
            color: var(--kvenno-orange);
            text-decoration: none;
        }

        .site-logo:hover {
            color: var(--kvenno-orange-dark);
        }

        .header-btn {
            background: white;
            border: 2px solid var(--kvenno-orange);
            color: var(--kvenno-orange);
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-left: 0.5rem;
        }

        .header-btn:hover {
            background: var(--kvenno-orange);
            color: white;
        }

        /* Back Button */
        .back-btn {
            background: white;
            border: 2px solid var(--kvenno-orange);
            color: var(--kvenno-orange);
            padding: 8px 16px;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
            font-size: 0.875rem;
            margin: 0 1rem 1rem 1rem;
        }

        .back-btn:hover {
            background: var(--kvenno-orange);
            color: white;
        }

        /* Equilibrium Arrow Styles */
        .equilibrium-arrows {
            font-size: 3rem;
            transition: all 0.5s ease;
        }

        .equilibrium-arrows.shift-right {
            color: #22c55e;
            transform: scale(1.2);
        }

        .equilibrium-arrows.shift-left {
            color: #22c55e;
            transform: scale(1.2) scaleX(-1);
        }

        .equilibrium-arrows.no-shift {
            color: #eab308;
            animation: shake 0.5s ease;
        }

        /* Molecule Container */
        .molecule-container {
            display: flex;
            gap: 8px;
            align-items: center;
            justify-content: center;
            min-height: 100px;
            padding: 20px;
            border-radius: 12px;
            transition: all 0.5s ease;
        }

        .molecule {
            font-size: 2rem;
            transition: all 0.3s ease;
            animation: float 2s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        .reactants-side {
            background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
        }

        .products-side {
            background: linear-gradient(135deg, #fce7f3 0%, #fbcfe8 100%);
        }

        .reactants-side.glowing {
            background: linear-gradient(135deg, #86efac 0%, #4ade80 100%);
            box-shadow: 0 0 20px rgba(74, 222, 128, 0.5);
        }

        .products-side.glowing {
            background: linear-gradient(135deg, #86efac 0%, #4ade80 100%);
            box-shadow: 0 0 20px rgba(74, 222, 128, 0.5);
        }

        /* Thermodynamics Indicator */
        .thermo-indicator {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
        }

        .thermo-indicator.exothermic {
            background: linear-gradient(135deg, #fca5a5 0%, #f87171 100%);
            color: #7f1d1d;
        }

        .thermo-indicator.endothermic {
            background: linear-gradient(135deg, #93c5fd 0%, #60a5fa 100%);
            color: #1e3a8a;
        }

        /* Stress Buttons */
        .stress-btn {
            background: linear-gradient(135deg, #a78bfa 0%, #8b5cf6 100%);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.875rem;
        }

        .stress-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(139, 92, 246, 0.4);
        }

        .stress-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .stress-btn.selected {
            background: linear-gradient(135deg, #eab308 0%, #f59e0b 100%);
            box-shadow: 0 0 20px rgba(234, 179, 8, 0.5);
        }

        /* Prediction Buttons */
        .predict-btn {
            flex: 1;
            padding: 20px;
            border-radius: 16px;
            font-size: 1.25rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 3px solid transparent;
        }

        .predict-btn:hover:not(:disabled) {
            transform: scale(1.05);
        }

        .predict-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .predict-btn.left {
            background: linear-gradient(135deg, #93c5fd 0%, #60a5fa 100%);
            color: #1e3a8a;
        }

        .predict-btn.none {
            background: linear-gradient(135deg, #fde68a 0%, #fbbf24 100%);
            color: #78350f;
        }

        .predict-btn.right {
            background: linear-gradient(135deg, #86efac 0%, #4ade80 100%);
            color: #14532d;
        }

        .predict-btn.correct {
            border-color: #22c55e;
            animation: pulse-success 0.6s ease-in-out;
        }

        .predict-btn.incorrect {
            border-color: #ef4444;
            animation: shake 0.4s ease-in-out;
        }

        /* Animations */
        @keyframes pulse-success {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0) rotate(0deg); }
            25% { transform: translateX(-10px) rotate(-2deg); }
            75% { transform: translateX(10px) rotate(2deg); }
        }

        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(-30px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .slide-in-right {
            animation: slideInRight 0.5s ease-out;
        }

        /* Explanation Box */
        .explanation-box {
            background: linear-gradient(135deg, #e0e7ff 0%, #c7d2fe 100%);
            border-left: 4px solid #6366f1;
            padding: 20px;
            border-radius: 12px;
            margin-top: 20px;
        }

        .explanation-box.correct {
            background: linear-gradient(135deg, #dcfce7 0%, #bbf7d0 100%);
            border-left-color: #22c55e;
        }

        .explanation-box.incorrect {
            background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
            border-left-color: #ef4444;
        }

        /* Priority 3: Enhanced Visual Effects */

        /* Particle Effects */
        @keyframes confetti-fall {
            0% {
                transform: translateY(0) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(300px) rotate(360deg);
                opacity: 0;
            }
        }

        @keyframes sparkle {
            0%, 100% {
                transform: scale(0) rotate(0deg);
                opacity: 0;
            }
            50% {
                transform: scale(1.5) rotate(180deg);
                opacity: 1;
            }
        }

        .confetti-particle {
            position: fixed;
            width: 10px;
            height: 10px;
            z-index: 1000;
            animation: confetti-fall 2s ease-out forwards;
            pointer-events: none;
        }

        .sparkle-effect {
            position: absolute;
            width: 20px;
            height: 20px;
            animation: sparkle 0.8s ease-out;
            pointer-events: none;
        }

        /* Enhanced Molecule Animations */
        @keyframes molecule-increase {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.3); opacity: 0.7; }
            100% { transform: scale(1); opacity: 1; }
        }

        @keyframes molecule-decrease {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(0.7); opacity: 0.5; }
            100% { transform: scale(1); opacity: 1; }
        }

        @keyframes particle-flow-right {
            0% {
                transform: translateX(0) scale(1);
                opacity: 1;
            }
            50% {
                transform: translateX(50%) scale(0.8);
                opacity: 0.6;
            }
            100% {
                transform: translateX(100%) scale(0);
                opacity: 0;
            }
        }

        @keyframes particle-flow-left {
            0% {
                transform: translateX(0) scale(1);
                opacity: 1;
            }
            50% {
                transform: translateX(-50%) scale(0.8);
                opacity: 0.6;
            }
            100% {
                transform: translateX(-100%) scale(0);
                opacity: 0;
            }
        }

        .molecule-increasing {
            animation: molecule-increase 1s ease-in-out;
        }

        .molecule-decreasing {
            animation: molecule-decrease 1s ease-in-out;
        }

        /* Stressed Component Highlighting */
        .stressed-component {
            position: relative;
            animation: stress-pulse 1.5s ease-in-out infinite;
        }

        @keyframes stress-pulse {
            0%, 100% {
                transform: scale(1);
                filter: brightness(1);
            }
            50% {
                transform: scale(1.1);
                filter: brightness(1.3) drop-shadow(0 0 10px rgba(251, 146, 60, 0.8));
            }
        }

        /* Enhanced Shift Animations */
        .equilibrium-arrows.shift-right-enhanced {
            animation: shift-right-flow 1.5s ease-in-out;
        }

        .equilibrium-arrows.shift-left-enhanced {
            animation: shift-left-flow 1.5s ease-in-out;
        }

        @keyframes shift-right-flow {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(10px); color: #4ade80; }
            50% { transform: translateX(20px); color: #22c55e; }
            75% { transform: translateX(10px); color: #4ade80; }
        }

        @keyframes shift-left-flow {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); color: #60a5fa; }
            50% { transform: translateX(-20px); color: #3b82f6; }
            75% { transform: translateX(-10px); color: #60a5fa; }
        }

        /* Celebration Effect */
        @keyframes celebrate {
            0% { transform: scale(1) rotate(0deg); }
            25% { transform: scale(1.1) rotate(-5deg); }
            50% { transform: scale(1.2) rotate(5deg); }
            75% { transform: scale(1.1) rotate(-5deg); }
            100% { transform: scale(1) rotate(0deg); }
        }

        .celebrate {
            animation: celebrate 0.6s ease-in-out;
        }

        /* Enhanced Thermodynamics Indicator */
        .thermo-indicator-enhanced {
            position: relative;
            overflow: hidden;
        }

        .thermo-indicator-enhanced::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: shine 3s infinite;
        }

        @keyframes shine {
            to { left: 100%; }
        }

        /* Sound Toggle Button */
        .sound-toggle {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
            color: white;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            box-shadow: 0 4px 12px rgba(139, 92, 246, 0.4);
            transition: all 0.3s ease;
            z-index: 999;
        }

        .sound-toggle:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 16px rgba(139, 92, 246, 0.6);
        }

        .sound-toggle.muted {
            background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%);
            opacity: 0.7;
        }

        /* Mobile Optimizations */
        @media (max-width: 768px) {
            .molecule {
                font-size: 1.5rem;
            }

            .equilibrium-arrows {
                font-size: 2rem;
            }

            .predict-btn {
                padding: 15px;
                font-size: 1rem;
            }

            .stress-btn {
                font-size: 0.75rem;
                padding: 10px 15px;
            }

            .sound-toggle {
                bottom: 15px;
                right: 15px;
                width: 45px;
                height: 45px;
                font-size: 1.25rem;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // ============================================
        // CONFIGURATION & CONSTANTS
        // ============================================

        const TRANSLATIONS = {
            learningMode: "L√¶rd√≥mshamur",
            challengeMode: "Keppnishamur",
            equilibrium: "Jafnv√¶gi",
            stress: "√Ålag",
            predict: "Forsp√°",
            shiftLeft: "Hli√∞run til vinstri",
            shiftRight: "Hli√∞run til h√¶gri",
            noShift: "Engin hli√∞run",
            addReactant: "B√¶ta vi√∞ hvarfefni",
            addProduct: "B√¶ta vi√∞ afur√∞",
            removeReactant: "Fjarl√¶gja hvarfefni",
            removeProduct: "Fjarl√¶gja afur√∞",
            heat: "Hita",
            cool: "K√¶la",
            increasePressure: "Auka √ær√Ωsting",
            decreasePressure: "Minnka √ær√Ωsting",
            addCatalyst: "B√¶ta vi√∞ hvata",
            correct: "R√©tt!",
            incorrect: "Rangt",
            explanation: "√ötsk√Ωring",
            exothermic: "Varmalosandi",
            endothermic: "Varmabindandi",
            back: "Til baka",
            nextEquilibrium: "N√¶sta jafnv√¶gi",
            instructions: "Lei√∞beiningar",
            tryAgain: "Reyndu aftur",
            // Challenge Mode translations
            question: "Spurning",
            nextQuestion: "N√¶sta spurning",
            showResults: "S√Ωna √∫rslit",
            appliedStress: "Beitt √°lag",
        };

        // ============================================
        // LE CHATELIER LOGIC ENGINE
        // ============================================

        const calculateShift = (equilibrium, stressType, stressTarget) => {
            let shift = 'none';
            let explanation = '';
            let explanationIs = '';

            switch(stressType) {
                case 'add-reactant':
                    shift = 'right';
                    explanation = `Adding ${stressTarget} (a reactant) increases reactant concentration. The system shifts RIGHT toward products to consume the added ${stressTarget}.`;
                    explanationIs = `B√¶ta vi√∞ ${stressTarget} (hvarfefni) eykur styrk hvarfefna. Kerfi√∞ hli√∞rast TIL H√ÜGRI √≠ √°tt a√∞ afur√∞um til a√∞ neyta vi√∞b√¶tts ${stressTarget}.`;
                    break;

                case 'add-product':
                    shift = 'left';
                    explanation = `Adding ${stressTarget} (a product) increases product concentration. The system shifts LEFT toward reactants to consume the added ${stressTarget}.`;
                    explanationIs = `B√¶ta vi√∞ ${stressTarget} (afur√∞) eykur styrk afur√∞a. Kerfi√∞ hli√∞rast TIL VINSTRI √≠ √°tt a√∞ hvarfefnum til a√∞ neyta vi√∞b√¶tts ${stressTarget}.`;
                    break;

                case 'remove-reactant':
                    shift = 'left';
                    explanation = `Removing ${stressTarget} (a reactant) decreases reactant concentration. The system shifts LEFT to produce more ${stressTarget}.`;
                    explanationIs = `Fjarl√¶gja ${stressTarget} (hvarfefni) minnkar styrk hvarfefna. Kerfi√∞ hli√∞rast TIL VINSTRI til a√∞ framlei√∞a meira ${stressTarget}.`;
                    break;

                case 'remove-product':
                    shift = 'right';
                    explanation = `Removing ${stressTarget} (a product) decreases product concentration. The system shifts RIGHT to produce more ${stressTarget}.`;
                    explanationIs = `Fjarl√¶gja ${stressTarget} (afur√∞) minnkar styrk afur√∞a. Kerfi√∞ hli√∞rast TIL H√ÜGRI til a√∞ framlei√∞a meira ${stressTarget}.`;
                    break;

                case 'increase-temp':
                    if (equilibrium.deltaH > 0) {
                        shift = 'right';
                        explanation = 'This is an ENDOTHERMIC reaction (ŒîH > 0), so heat is a REACTANT. Adding heat shifts the equilibrium RIGHT toward products.';
                        explanationIs = '√ûetta er VARMABINDANDI hvarf (ŒîH > 0), √æannig a√∞ varmi er HVARFEFNI. A√∞ b√¶ta vi√∞ hita hli√∞rar jafnv√¶ginu TIL H√ÜGRI √≠ √°tt a√∞ afur√∞um.';
                    } else {
                        shift = 'left';
                        explanation = 'This is an EXOTHERMIC reaction (ŒîH < 0), so heat is a PRODUCT. Adding heat shifts the equilibrium LEFT toward reactants.';
                        explanationIs = '√ûetta er VARMALOSANDI hvarf (ŒîH < 0), √æannig a√∞ varmi er AFUR√ê. A√∞ b√¶ta vi√∞ hita hli√∞rar jafnv√¶ginu TIL VINSTRI √≠ √°tt a√∞ hvarfefnum.';
                    }
                    break;

                case 'decrease-temp':
                    if (equilibrium.deltaH > 0) {
                        shift = 'left';
                        explanation = 'This is an ENDOTHERMIC reaction (ŒîH > 0). Removing heat shifts the equilibrium LEFT toward the side that releases heat.';
                        explanationIs = '√ûetta er VARMABINDANDI hvarf (ŒîH > 0). A√∞ fjarl√¶gja hita hli√∞rar jafnv√¶ginu TIL VINSTRI √≠ √°tt a√∞ √æeirri hli√∞ sem losar hita.';
                    } else {
                        shift = 'right';
                        explanation = 'This is an EXOTHERMIC reaction (ŒîH < 0). Removing heat shifts the equilibrium RIGHT toward the side that produces heat.';
                        explanationIs = '√ûetta er VARMALOSANDI hvarf (ŒîH < 0). A√∞ fjarl√¶gja hita hli√∞rar jafnv√¶ginu TIL H√ÜGRI √≠ √°tt a√∞ √æeirri hli√∞ sem framlei√∞ir hita.';
                    }
                    break;

                case 'increase-pressure':
                    const reactantMoles = equilibrium.totalGasMoles.reactants;
                    const productMoles = equilibrium.totalGasMoles.products;

                    if (reactantMoles > productMoles) {
                        shift = 'right';
                        explanation = `Increasing pressure shifts toward the side with FEWER gas moles. Reactants: ${reactantMoles} moles, Products: ${productMoles} moles. Shifts RIGHT.`;
                        explanationIs = `A√∞ auka √ær√Ωsting hli√∞rar √≠ √°tt a√∞ √æeirri hli√∞ me√∞ F√ÜRRI gasm√≥lum. Hvarfefni: ${reactantMoles} m√≥l, Afur√∞ir: ${productMoles} m√≥l. Hli√∞rast TIL H√ÜGRI.`;
                    } else if (reactantMoles < productMoles) {
                        shift = 'left';
                        explanation = `Increasing pressure shifts toward the side with FEWER gas moles. Reactants: ${reactantMoles} moles, Products: ${productMoles} moles. Shifts LEFT.`;
                        explanationIs = `A√∞ auka √ær√Ωsting hli√∞rar √≠ √°tt a√∞ √æeirri hli√∞ me√∞ F√ÜRRI gasm√≥lum. Hvarfefni: ${reactantMoles} m√≥l, Afur√∞ir: ${productMoles} m√≥l. Hli√∞rast TIL VINSTRI.`;
                    } else {
                        shift = 'none';
                        explanation = `Equal gas moles on both sides (${reactantMoles} moles each). Pressure change has NO EFFECT on equilibrium position.`;
                        explanationIs = `Jafn fj√∂ldi gasm√≥la √° b√°√∞um hli√∞um (${reactantMoles} m√≥l hvor). √ûr√Ωstingsbreyting hefur ENGIN √ÅHRIF √° jafnv√¶gisst√∂√∞u.`;
                    }
                    break;

                case 'decrease-pressure':
                    const rMoles = equilibrium.totalGasMoles.reactants;
                    const pMoles = equilibrium.totalGasMoles.products;

                    if (rMoles < pMoles) {
                        shift = 'right';
                        explanation = `Decreasing pressure shifts toward the side with MORE gas moles. Reactants: ${rMoles} moles, Products: ${pMoles} moles. Shifts RIGHT.`;
                        explanationIs = `A√∞ minnka √ær√Ωsting hli√∞rar √≠ √°tt a√∞ √æeirri hli√∞ me√∞ FLEIRI gasm√≥lum. Hvarfefni: ${rMoles} m√≥l, Afur√∞ir: ${pMoles} m√≥l. Hli√∞rast TIL H√ÜGRI.`;
                    } else if (rMoles > pMoles) {
                        shift = 'left';
                        explanation = `Decreasing pressure shifts toward the side with MORE gas moles. Reactants: ${rMoles} moles, Products: ${pMoles} moles. Shifts LEFT.`;
                        explanationIs = `A√∞ minnka √ær√Ωsting hli√∞rar √≠ √°tt a√∞ √æeirri hli√∞ me√∞ FLEIRI gasm√≥lum. Hvarfefni: ${rMoles} m√≥l, Afur√∞ir: ${pMoles} m√≥l. Hli√∞rast TIL VINSTRI.`;
                    } else {
                        shift = 'none';
                        explanation = `Equal gas moles on both sides (${rMoles} moles each). Pressure change has NO EFFECT on equilibrium position.`;
                        explanationIs = `Jafn fj√∂ldi gasm√≥la √° b√°√∞um hli√∞um (${rMoles} m√≥l hvor). √ûr√Ωstingsbreyting hefur ENGIN √ÅHRIF √° jafnv√¶gisst√∂√∞u.`;
                    }
                    break;

                case 'add-catalyst':
                    shift = 'none';
                    explanation = 'A catalyst speeds up BOTH the forward and reverse reactions equally. It helps the system reach equilibrium FASTER but does NOT change the equilibrium position. K remains unchanged.';
                    explanationIs = 'Hvati fl√Ωtir fyrir B√Å√êUM framhvarfi og bakrefer√∞ jafnt. √ûa√∞ hj√°lpar kerfinu a√∞ n√° jafnv√¶gi HRA√êAR en breytir EKKI jafnv√¶gisst√∂√∞unni. K helst √≥breytt.';
                    break;
            }

            return { shift, explanation, explanationIs };
        };

        // ============================================
        // EQUILIBRIUM DATA
        // ============================================

        const EQUILIBRIUM_BANK = [
            // ============================================
            // BEGINNER LEVEL (10 Equilibria)
            // ============================================
            {
                id: 1,
                equation: 'N‚ÇÇO‚ÇÑ(g) ‚áå 2NO‚ÇÇ(g)',
                name: 'Dinitrogen Tetroxide',
                nameIs: 'D√≠k√∂fnunarefnisox√≠√∞',
                difficulty: 'beginner',

                reactants: [
                    { formula: 'N‚ÇÇO‚ÇÑ', coefficient: 1, phase: 'g', display: '‚ö´' }
                ],

                products: [
                    { formula: 'NO‚ÇÇ', coefficient: 2, phase: 'g', display: 'üü§' }
                ],

                deltaH: 58,

                totalGasMoles: {
                    reactants: 1,
                    products: 2
                },

                description: 'Colorless N‚ÇÇO‚ÇÑ gas converts to brown NO‚ÇÇ gas when heated.',
                descriptionIs: 'Litlaust N‚ÇÇO‚ÇÑ gas breytist √≠ br√∫nt NO‚ÇÇ gas vi√∞ upphitun.',

                possibleStresses: [
                    { type: 'add-reactant', target: 'N‚ÇÇO‚ÇÑ' },
                    { type: 'add-product', target: 'NO‚ÇÇ' },
                    { type: 'remove-reactant', target: 'N‚ÇÇO‚ÇÑ' },
                    { type: 'remove-product', target: 'NO‚ÇÇ' },
                    { type: 'increase-temp', target: null },
                    { type: 'decrease-temp', target: null },
                    { type: 'increase-pressure', target: null },
                    { type: 'decrease-pressure', target: null },
                    { type: 'add-catalyst', target: null }
                ]
            },
            {
                id: 2,
                equation: 'H‚ÇÇ(g) + I‚ÇÇ(g) ‚áå 2HI(g)',
                name: 'Hydrogen Iodide Formation',
                nameIs: 'Vetnisj√≥√∞√≠√∞myndun',
                difficulty: 'beginner',

                reactants: [
                    { formula: 'H‚ÇÇ', coefficient: 1, phase: 'g', display: '‚ö™‚ö™' },
                    { formula: 'I‚ÇÇ', coefficient: 1, phase: 'g', display: 'üü£üü£' }
                ],

                products: [
                    { formula: 'HI', coefficient: 2, phase: 'g', display: '‚ö™üü£' }
                ],

                deltaH: 53,

                totalGasMoles: {
                    reactants: 2,
                    products: 2
                },

                description: 'Simple formation reaction used to teach equilibrium constants.',
                descriptionIs: 'Einfalt myndunarhvarf sem nota√∞ er til a√∞ kenna jafnv√¶gisfasta.',

                possibleStresses: [
                    { type: 'add-reactant', target: 'H‚ÇÇ' },
                    { type: 'add-reactant', target: 'I‚ÇÇ' },
                    { type: 'add-product', target: 'HI' },
                    { type: 'remove-reactant', target: 'H‚ÇÇ' },
                    { type: 'remove-product', target: 'HI' },
                    { type: 'increase-temp', target: null },
                    { type: 'decrease-temp', target: null },
                    { type: 'increase-pressure', target: null },
                    { type: 'add-catalyst', target: null }
                ]
            },
            {
                id: 3,
                equation: 'PCl‚ÇÖ(g) ‚áå PCl‚ÇÉ(g) + Cl‚ÇÇ(g)',
                name: 'Phosphorus Pentachloride',
                nameIs: 'Fosf√≥rpentakl√≥r√≠√∞',
                difficulty: 'beginner',

                reactants: [
                    { formula: 'PCl‚ÇÖ', coefficient: 1, phase: 'g', display: 'üî∑' }
                ],

                products: [
                    { formula: 'PCl‚ÇÉ', coefficient: 1, phase: 'g', display: 'üîπ' },
                    { formula: 'Cl‚ÇÇ', coefficient: 1, phase: 'g', display: 'üü¢üü¢' }
                ],

                deltaH: 88,

                totalGasMoles: {
                    reactants: 1,
                    products: 2
                },

                description: 'Decomposition of PCl‚ÇÖ upon heating.',
                descriptionIs: 'Umbreyting PCl‚ÇÖ vi√∞ upphitun.',

                possibleStresses: [
                    { type: 'add-reactant', target: 'PCl‚ÇÖ' },
                    { type: 'add-product', target: 'PCl‚ÇÉ' },
                    { type: 'add-product', target: 'Cl‚ÇÇ' },
                    { type: 'remove-reactant', target: 'PCl‚ÇÖ' },
                    { type: 'remove-product', target: 'Cl‚ÇÇ' },
                    { type: 'increase-temp', target: null },
                    { type: 'decrease-temp', target: null },
                    { type: 'increase-pressure', target: null },
                    { type: 'decrease-pressure', target: null },
                    { type: 'add-catalyst', target: null }
                ]
            },
            {
                id: 4,
                equation: 'CO(g) + 2H‚ÇÇ(g) ‚áå CH‚ÇÉOH(g)',
                name: 'Methanol Synthesis',
                nameIs: 'Metan√≥lsamsetning',
                difficulty: 'beginner',

                reactants: [
                    { formula: 'CO', coefficient: 1, phase: 'g', display: '‚ö´üî¥' },
                    { formula: 'H‚ÇÇ', coefficient: 2, phase: 'g', display: '‚ö™‚ö™' }
                ],

                products: [
                    { formula: 'CH‚ÇÉOH', coefficient: 1, phase: 'g', display: 'üß™' }
                ],

                deltaH: -91,

                totalGasMoles: {
                    reactants: 3,
                    products: 1
                },

                description: 'Industrial production of methanol for fuel and chemicals.',
                descriptionIs: 'I√∞na√∞arframlei√∞sla √° metan√≥li sem eldsneyti og efni.',

                possibleStresses: [
                    { type: 'add-reactant', target: 'CO' },
                    { type: 'add-reactant', target: 'H‚ÇÇ' },
                    { type: 'add-product', target: 'CH‚ÇÉOH' },
                    { type: 'remove-reactant', target: 'CO' },
                    { type: 'remove-product', target: 'CH‚ÇÉOH' },
                    { type: 'increase-temp', target: null },
                    { type: 'decrease-temp', target: null },
                    { type: 'increase-pressure', target: null },
                    { type: 'decrease-pressure', target: null },
                    { type: 'add-catalyst', target: null }
                ]
            },
            {
                id: 5,
                equation: 'CaCO‚ÇÉ(s) ‚áå CaO(s) + CO‚ÇÇ(g)',
                name: 'Calcium Carbonate Decomposition',
                nameIs: 'Kalksteinsuppleysing',
                difficulty: 'beginner',

                reactants: [
                    { formula: 'CaCO‚ÇÉ', coefficient: 1, phase: 's', display: 'ü™®' }
                ],

                products: [
                    { formula: 'CaO', coefficient: 1, phase: 's', display: '‚ö™' },
                    { formula: 'CO‚ÇÇ', coefficient: 1, phase: 'g', display: '‚ö´üî¥üî¥' }
                ],

                deltaH: 178,

                totalGasMoles: {
                    reactants: 0,
                    products: 1
                },

                description: 'Limestone decomposition, used in cement production.',
                descriptionIs: 'Kalksteinn vi√∞ upphitun, nota√∞ √≠ sementframlei√∞slu.',

                possibleStresses: [
                    { type: 'add-product', target: 'CO‚ÇÇ' },
                    { type: 'remove-product', target: 'CO‚ÇÇ' },
                    { type: 'increase-temp', target: null },
                    { type: 'decrease-temp', target: null },
                    { type: 'increase-pressure', target: null },
                    { type: 'decrease-pressure', target: null },
                    { type: 'add-catalyst', target: null }
                ]
            },
            {
                id: 6,
                equation: 'Fe¬≥‚Å∫(aq) + SCN‚Åª(aq) ‚áå FeSCN¬≤‚Å∫(aq)',
                name: 'Iron Thiocyanate Complex',
                nameIs: 'J√°rn√æ√≠√≥s√Ωanatkomplexinn',
                difficulty: 'beginner',

                reactants: [
                    { formula: 'Fe¬≥‚Å∫', coefficient: 1, phase: 'aq', display: 'üü°‚Å∫' },
                    { formula: 'SCN‚Åª', coefficient: 1, phase: 'aq', display: '‚ö™‚Åª' }
                ],

                products: [
                    { formula: 'FeSCN¬≤‚Å∫', coefficient: 1, phase: 'aq', display: 'üî¥' }
                ],

                deltaH: -20,

                totalGasMoles: {
                    reactants: 0,
                    products: 0
                },

                description: 'Blood-red complex ion, used in chemistry demonstrations.',
                descriptionIs: 'Bl√≥√∞rau√∞ur komplexj√≥n, nota√∞ur √≠ efnafr√¶√∞is√Ωningum.',

                possibleStresses: [
                    { type: 'add-reactant', target: 'Fe¬≥‚Å∫' },
                    { type: 'add-reactant', target: 'SCN‚Åª' },
                    { type: 'add-product', target: 'FeSCN¬≤‚Å∫' },
                    { type: 'remove-reactant', target: 'Fe¬≥‚Å∫' },
                    { type: 'remove-product', target: 'FeSCN¬≤‚Å∫' },
                    { type: 'increase-temp', target: null },
                    { type: 'decrease-temp', target: null },
                    { type: 'add-catalyst', target: null }
                ]
            },
            {
                id: 7,
                equation: 'H‚ÇÇO(l) ‚áå H‚Å∫(aq) + OH‚Åª(aq)',
                name: 'Water Autoionization',
                nameIs: 'Sj√°lfj√∂fnun vatns',
                difficulty: 'beginner',

                reactants: [
                    { formula: 'H‚ÇÇO', coefficient: 1, phase: 'l', display: 'üíß' }
                ],

                products: [
                    { formula: 'H‚Å∫', coefficient: 1, phase: 'aq', display: '‚äï' },
                    { formula: 'OH‚Åª', coefficient: 1, phase: 'aq', display: '‚äñ' }
                ],

                deltaH: 56,

                totalGasMoles: {
                    reactants: 0,
                    products: 0
                },

                description: 'Self-ionization of water, basis of pH system.',
                descriptionIs: 'Sj√°lfjafnv√¶gi vatns, grunnur pH kerfis.',

                possibleStresses: [
                    { type: 'add-product', target: 'H‚Å∫' },
                    { type: 'add-product', target: 'OH‚Åª' },
                    { type: 'remove-product', target: 'H‚Å∫' },
                    { type: 'remove-product', target: 'OH‚Åª' },
                    { type: 'increase-temp', target: null },
                    { type: 'decrease-temp', target: null },
                    { type: 'add-catalyst', target: null }
                ]
            },
            {
                id: 8,
                equation: 'CH‚ÇÉCOOH(aq) ‚áå CH‚ÇÉCOO‚Åª(aq) + H‚Å∫(aq)',
                name: 'Acetic Acid Dissociation',
                nameIs: 'Ediks√Ωrusundrun',
                difficulty: 'beginner',

                reactants: [
                    { formula: 'CH‚ÇÉCOOH', coefficient: 1, phase: 'aq', display: 'üß™' }
                ],

                products: [
                    { formula: 'CH‚ÇÉCOO‚Åª', coefficient: 1, phase: 'aq', display: 'üß™‚Åª' },
                    { formula: 'H‚Å∫', coefficient: 1, phase: 'aq', display: '‚äï' }
                ],

                deltaH: 5,

                totalGasMoles: {
                    reactants: 0,
                    products: 0
                },

                description: 'Acetic acid, typical weak acid equilibrium.',
                descriptionIs: 'Ediks√Ωra, d√¶migert veikt s√Ωrujafnv√¶gi.',

                possibleStresses: [
                    { type: 'add-reactant', target: 'CH‚ÇÉCOOH' },
                    { type: 'add-product', target: 'H‚Å∫' },
                    { type: 'add-product', target: 'CH‚ÇÉCOO‚Åª' },
                    { type: 'remove-reactant', target: 'CH‚ÇÉCOOH' },
                    { type: 'remove-product', target: 'H‚Å∫' },
                    { type: 'increase-temp', target: null },
                    { type: 'decrease-temp', target: null },
                    { type: 'add-catalyst', target: null }
                ]
            },
            {
                id: 9,
                equation: 'NH‚ÇÉ(aq) + H‚ÇÇO(l) ‚áå NH‚ÇÑ‚Å∫(aq) + OH‚Åª(aq)',
                name: 'Ammonia Base',
                nameIs: 'Amm√≥n√≠akbasi',
                difficulty: 'beginner',

                reactants: [
                    { formula: 'NH‚ÇÉ', coefficient: 1, phase: 'aq', display: 'üî∑' },
                    { formula: 'H‚ÇÇO', coefficient: 1, phase: 'l', display: 'üíß' }
                ],

                products: [
                    { formula: 'NH‚ÇÑ‚Å∫', coefficient: 1, phase: 'aq', display: 'üî∑‚Å∫' },
                    { formula: 'OH‚Åª', coefficient: 1, phase: 'aq', display: '‚äñ' }
                ],

                deltaH: -3,

                totalGasMoles: {
                    reactants: 0,
                    products: 0
                },

                description: 'Ammonia as a weak base in water.',
                descriptionIs: 'Amm√≥n√≠ak sem veikur basi √≠ vatni.',

                possibleStresses: [
                    { type: 'add-reactant', target: 'NH‚ÇÉ' },
                    { type: 'add-product', target: 'NH‚ÇÑ‚Å∫' },
                    { type: 'add-product', target: 'OH‚Åª' },
                    { type: 'remove-reactant', target: 'NH‚ÇÉ' },
                    { type: 'remove-product', target: 'OH‚Åª' },
                    { type: 'increase-temp', target: null },
                    { type: 'decrease-temp', target: null },
                    { type: 'add-catalyst', target: null }
                ]
            },
            {
                id: 10,
                equation: 'AgCl(s) ‚áå Ag‚Å∫(aq) + Cl‚Åª(aq)',
                name: 'Silver Chloride Precipitation',
                nameIs: 'Silfurkl√≥r√≠√∞leysnijafnv√¶gi',
                difficulty: 'beginner',

                reactants: [
                    { formula: 'AgCl', coefficient: 1, phase: 's', display: 'üîò' }
                ],

                products: [
                    { formula: 'Ag‚Å∫', coefficient: 1, phase: 'aq', display: '‚ö™‚Å∫' },
                    { formula: 'Cl‚Åª', coefficient: 1, phase: 'aq', display: 'üü¢‚Åª' }
                ],

                deltaH: 65,

                totalGasMoles: {
                    reactants: 0,
                    products: 0
                },

                description: 'Solubility equilibrium of silver chloride, white precipitate.',
                descriptionIs: 'Leysnijafnv√¶gi silfurkl√≥r√≠√∞s, hv√≠tur fellur √∫t.',

                possibleStresses: [
                    { type: 'add-product', target: 'Ag‚Å∫' },
                    { type: 'add-product', target: 'Cl‚Åª' },
                    { type: 'remove-product', target: 'Ag‚Å∫' },
                    { type: 'remove-product', target: 'Cl‚Åª' },
                    { type: 'increase-temp', target: null },
                    { type: 'decrease-temp', target: null },
                    { type: 'add-catalyst', target: null }
                ]
            },

            // ============================================
            // INTERMEDIATE LEVEL (12 Equilibria)
            // ============================================
            {
                id: 11,
                equation: 'N‚ÇÇ(g) + 3H‚ÇÇ(g) ‚áå 2NH‚ÇÉ(g)',
                name: 'Haber Process',
                nameIs: 'Haber-a√∞fer√∞',
                difficulty: 'intermediate',

                reactants: [
                    { formula: 'N‚ÇÇ', coefficient: 1, phase: 'g', display: 'üîµüîµ' },
                    { formula: 'H‚ÇÇ', coefficient: 3, phase: 'g', display: '‚ö™‚ö™' }
                ],

                products: [
                    { formula: 'NH‚ÇÉ', coefficient: 2, phase: 'g', display: 'üî∑' }
                ],

                deltaH: -92,

                totalGasMoles: {
                    reactants: 4,
                    products: 2
                },

                description: 'Industrial ammonia synthesis for fertilizers.',
                descriptionIs: 'I√∞na√∞arframlei√∞sla √° amm√≥n√≠aki fyrir √°bur√∞.',

                possibleStresses: [
                    { type: 'add-reactant', target: 'N‚ÇÇ' },
                    { type: 'add-reactant', target: 'H‚ÇÇ' },
                    { type: 'add-product', target: 'NH‚ÇÉ' },
                    { type: 'remove-reactant', target: 'N‚ÇÇ' },
                    { type: 'remove-product', target: 'NH‚ÇÉ' },
                    { type: 'increase-temp', target: null },
                    { type: 'decrease-temp', target: null },
                    { type: 'increase-pressure', target: null },
                    { type: 'decrease-pressure', target: null },
                    { type: 'add-catalyst', target: null }
                ]
            },
            {
                id: 12,
                equation: '2SO‚ÇÇ(g) + O‚ÇÇ(g) ‚áå 2SO‚ÇÉ(g)',
                name: 'Contact Process',
                nameIs: 'Snertia√∞fer√∞',
                difficulty: 'intermediate',

                reactants: [
                    { formula: 'SO‚ÇÇ', coefficient: 2, phase: 'g', display: 'üíõ' },
                    { formula: 'O‚ÇÇ', coefficient: 1, phase: 'g', display: 'üî¥üî¥' }
                ],

                products: [
                    { formula: 'SO‚ÇÉ', coefficient: 2, phase: 'g', display: 'üü°' }
                ],

                deltaH: -198,

                totalGasMoles: {
                    reactants: 3,
                    products: 2
                },

                description: 'Sulfuric acid production in industry.',
                descriptionIs: 'Brennisteinss√Ωruframlei√∞sla √≠ i√∞na√∞i.',

                possibleStresses: [
                    { type: 'add-reactant', target: 'SO‚ÇÇ' },
                    { type: 'add-reactant', target: 'O‚ÇÇ' },
                    { type: 'add-product', target: 'SO‚ÇÉ' },
                    { type: 'remove-reactant', target: 'SO‚ÇÇ' },
                    { type: 'remove-product', target: 'SO‚ÇÉ' },
                    { type: 'increase-temp', target: null },
                    { type: 'decrease-temp', target: null },
                    { type: 'increase-pressure', target: null },
                    { type: 'decrease-pressure', target: null },
                    { type: 'add-catalyst', target: null }
                ]
            },
            {
                id: 13,
                equation: '4NH‚ÇÉ(g) + 5O‚ÇÇ(g) ‚áå 4NO(g) + 6H‚ÇÇO(g)',
                name: 'Ostwald Process',
                nameIs: 'Ostwald-a√∞fer√∞',
                difficulty: 'intermediate',

                reactants: [
                    { formula: 'NH‚ÇÉ', coefficient: 4, phase: 'g', display: 'üî∑' },
                    { formula: 'O‚ÇÇ', coefficient: 5, phase: 'g', display: 'üî¥üî¥' }
                ],

                products: [
                    { formula: 'NO', coefficient: 4, phase: 'g', display: 'üî¥‚ö´' },
                    { formula: 'H‚ÇÇO', coefficient: 6, phase: 'g', display: 'üíß' }
                ],

                deltaH: -905,

                totalGasMoles: {
                    reactants: 9,
                    products: 10
                },

                description: 'Nitrogen oxide production for nitric acid.',
                descriptionIs: 'K√∂fnunarefnisox√≠√∞framlei√∞sla fyrir salpeturss√Ωru.',

                possibleStresses: [
                    { type: 'add-reactant', target: 'NH‚ÇÉ' },
                    { type: 'add-reactant', target: 'O‚ÇÇ' },
                    { type: 'add-product', target: 'NO' },
                    { type: 'remove-reactant', target: 'NH‚ÇÉ' },
                    { type: 'remove-product', target: 'NO' },
                    { type: 'increase-temp', target: null },
                    { type: 'decrease-temp', target: null },
                    { type: 'increase-pressure', target: null },
                    { type: 'decrease-pressure', target: null },
                    { type: 'add-catalyst', target: null }
                ]
            },
            {
                id: 14,
                equation: 'CO(g) + H‚ÇÇO(g) ‚áå CO‚ÇÇ(g) + H‚ÇÇ(g)',
                name: 'Water Gas Shift',
                nameIs: 'Vatnsgashli√∞run',
                difficulty: 'intermediate',

                reactants: [
                    { formula: 'CO', coefficient: 1, phase: 'g', display: '‚ö´üî¥' },
                    { formula: 'H‚ÇÇO', coefficient: 1, phase: 'g', display: 'üíß' }
                ],

                products: [
                    { formula: 'CO‚ÇÇ', coefficient: 1, phase: 'g', display: '‚ö´üî¥üî¥' },
                    { formula: 'H‚ÇÇ', coefficient: 1, phase: 'g', display: '‚ö™‚ö™' }
                ],

                deltaH: -41,

                totalGasMoles: {
                    reactants: 2,
                    products: 2
                },

                description: 'Important in hydrogen production and industry.',
                descriptionIs: 'Mikilv√¶gt √≠ vetniframlei√∞slu og i√∞na√∞i.',

                possibleStresses: [
                    { type: 'add-reactant', target: 'CO' },
                    { type: 'add-reactant', target: 'H‚ÇÇO' },
                    { type: 'add-product', target: 'CO‚ÇÇ' },
                    { type: 'add-product', target: 'H‚ÇÇ' },
                    { type: 'remove-reactant', target: 'CO' },
                    { type: 'remove-product', target: 'H‚ÇÇ' },
                    { type: 'increase-temp', target: null },
                    { type: 'decrease-temp', target: null },
                    { type: 'increase-pressure', target: null },
                    { type: 'add-catalyst', target: null }
                ]
            },
            {
                id: 15,
                equation: '2NO(g) + O‚ÇÇ(g) ‚áå 2NO‚ÇÇ(g)',
                name: 'Nitrogen Oxide Formation',
                nameIs: 'K√∂fnunarefnisox√≠√∞myndun',
                difficulty: 'intermediate',

                reactants: [
                    { formula: 'NO', coefficient: 2, phase: 'g', display: 'üî¥‚ö´' },
                    { formula: 'O‚ÇÇ', coefficient: 1, phase: 'g', display: 'üî¥üî¥' }
                ],

                products: [
                    { formula: 'NO‚ÇÇ', coefficient: 2, phase: 'g', display: 'üü§' }
                ],

                deltaH: -114,

                totalGasMoles: {
                    reactants: 3,
                    products: 2
                },

                description: 'Air pollution and industrial reaction.',
                descriptionIs: 'Loftmengun og i√∞na√∞arhvarf.',

                possibleStresses: [
                    { type: 'add-reactant', target: 'NO' },
                    { type: 'add-reactant', target: 'O‚ÇÇ' },
                    { type: 'add-product', target: 'NO‚ÇÇ' },
                    { type: 'remove-reactant', target: 'NO' },
                    { type: 'remove-product', target: 'NO‚ÇÇ' },
                    { type: 'increase-temp', target: null },
                    { type: 'decrease-temp', target: null },
                    { type: 'increase-pressure', target: null },
                    { type: 'decrease-pressure', target: null },
                    { type: 'add-catalyst', target: null }
                ]
            },
            {
                id: 16,
                equation: 'C(s) + CO‚ÇÇ(g) ‚áå 2CO(g)',
                name: 'Boudouard Reaction',
                nameIs: 'Boudouard-hvarf',
                difficulty: 'intermediate',

                reactants: [
                    { formula: 'C', coefficient: 1, phase: 's', display: '‚ö´' },
                    { formula: 'CO‚ÇÇ', coefficient: 1, phase: 'g', display: '‚ö´üî¥üî¥' }
                ],

                products: [
                    { formula: 'CO', coefficient: 2, phase: 'g', display: '‚ö´üî¥' }
                ],

                deltaH: 172,

                totalGasMoles: {
                    reactants: 1,
                    products: 2
                },

                description: 'Carbon reaction in high-temperature furnaces and metallurgy.',
                descriptionIs: 'Kolefnishvarf √≠ h√°hitasm√≠√∞i og m√°lmvinnslu.',

                possibleStresses: [
                    { type: 'add-reactant', target: 'CO‚ÇÇ' },
                    { type: 'add-product', target: 'CO' },
                    { type: 'remove-reactant', target: 'CO‚ÇÇ' },
                    { type: 'remove-product', target: 'CO' },
                    { type: 'increase-temp', target: null },
                    { type: 'decrease-temp', target: null },
                    { type: 'increase-pressure', target: null },
                    { type: 'decrease-pressure', target: null },
                    { type: 'add-catalyst', target: null }
                ]
            },
            {
                id: 17,
                equation: 'CH‚ÇÑ(g) + H‚ÇÇO(g) ‚áå CO(g) + 3H‚ÇÇ(g)',
                name: 'Steam Reforming',
                nameIs: 'Gufuumbr√¶√∞a',
                difficulty: 'intermediate',

                reactants: [
                    { formula: 'CH‚ÇÑ', coefficient: 1, phase: 'g', display: '‚ö´‚ö™' },
                    { formula: 'H‚ÇÇO', coefficient: 1, phase: 'g', display: 'üíß' }
                ],

                products: [
                    { formula: 'CO', coefficient: 1, phase: 'g', display: '‚ö´üî¥' },
                    { formula: 'H‚ÇÇ', coefficient: 3, phase: 'g', display: '‚ö™‚ö™' }
                ],

                deltaH: 206,

                totalGasMoles: {
                    reactants: 2,
                    products: 4
                },

                description: 'Primary method for hydrogen production from natural gas.',
                descriptionIs: 'Helsta a√∞fer√∞ vi√∞ vetniframlei√∞slu √∫r n√°tt√∫rugasi.',

                possibleStresses: [
                    { type: 'add-reactant', target: 'CH‚ÇÑ' },
                    { type: 'add-reactant', target: 'H‚ÇÇO' },
                    { type: 'add-product', target: 'CO' },
                    { type: 'add-product', target: 'H‚ÇÇ' },
                    { type: 'remove-reactant', target: 'CH‚ÇÑ' },
                    { type: 'remove-product', target: 'H‚ÇÇ' },
                    { type: 'increase-temp', target: null },
                    { type: 'decrease-temp', target: null },
                    { type: 'increase-pressure', target: null },
                    { type: 'decrease-pressure', target: null },
                    { type: 'add-catalyst', target: null }
                ]
            },
            {
                id: 18,
                equation: 'H‚ÇÇ(g) + CO‚ÇÇ(g) ‚áå H‚ÇÇO(g) + CO(g)',
                name: 'Reverse Water Gas',
                nameIs: 'Andhverfvatnsgas',
                difficulty: 'intermediate',

                reactants: [
                    { formula: 'H‚ÇÇ', coefficient: 1, phase: 'g', display: '‚ö™‚ö™' },
                    { formula: 'CO‚ÇÇ', coefficient: 1, phase: 'g', display: '‚ö´üî¥üî¥' }
                ],

                products: [
                    { formula: 'H‚ÇÇO', coefficient: 1, phase: 'g', display: 'üíß' },
                    { formula: 'CO', coefficient: 1, phase: 'g', display: '‚ö´üî¥' }
                ],

                deltaH: 41,

                totalGasMoles: {
                    reactants: 2,
                    products: 2
                },

                description: 'Reverse of the Water Gas Shift reaction.',
                descriptionIs: 'Andhverfa Water Gas Shift hvarfsins.',

                possibleStresses: [
                    { type: 'add-reactant', target: 'H‚ÇÇ' },
                    { type: 'add-reactant', target: 'CO‚ÇÇ' },
                    { type: 'add-product', target: 'H‚ÇÇO' },
                    { type: 'add-product', target: 'CO' },
                    { type: 'remove-reactant', target: 'H‚ÇÇ' },
                    { type: 'remove-product', target: 'CO' },
                    { type: 'increase-temp', target: null },
                    { type: 'decrease-temp', target: null },
                    { type: 'increase-pressure', target: null },
                    { type: 'add-catalyst', target: null }
                ]
            },
            {
                id: 19,
                equation: 'N‚ÇÇ(g) + O‚ÇÇ(g) ‚áå 2NO(g)',
                name: 'Nitrogen Fixation',
                nameIs: 'K√∂fnunarefnisbinding',
                difficulty: 'intermediate',

                reactants: [
                    { formula: 'N‚ÇÇ', coefficient: 1, phase: 'g', display: 'üîµüîµ' },
                    { formula: 'O‚ÇÇ', coefficient: 1, phase: 'g', display: 'üî¥üî¥' }
                ],

                products: [
                    { formula: 'NO', coefficient: 2, phase: 'g', display: 'üî¥‚ö´' }
                ],

                deltaH: 181,

                totalGasMoles: {
                    reactants: 2,
                    products: 2
                },

                description: 'Lightning in atmosphere fixes nitrogen.',
                descriptionIs: 'Eldingar √≠ andr√∫mslofti binda k√∂fnunarefni.',

                possibleStresses: [
                    { type: 'add-reactant', target: 'N‚ÇÇ' },
                    { type: 'add-reactant', target: 'O‚ÇÇ' },
                    { type: 'add-product', target: 'NO' },
                    { type: 'remove-reactant', target: 'N‚ÇÇ' },
                    { type: 'remove-product', target: 'NO' },
                    { type: 'increase-temp', target: null },
                    { type: 'decrease-temp', target: null },
                    { type: 'increase-pressure', target: null },
                    { type: 'add-catalyst', target: null }
                ]
            },
            {
                id: 20,
                equation: '2H‚ÇÇS(g) + 3O‚ÇÇ(g) ‚áå 2H‚ÇÇO(g) + 2SO‚ÇÇ(g)',
                name: 'Hydrogen Sulfide Oxidation',
                nameIs: 'Vetisbrennssteinsoxun',
                difficulty: 'intermediate',

                reactants: [
                    { formula: 'H‚ÇÇS', coefficient: 2, phase: 'g', display: 'üíõ‚ö™' },
                    { formula: 'O‚ÇÇ', coefficient: 3, phase: 'g', display: 'üî¥üî¥' }
                ],

                products: [
                    { formula: 'H‚ÇÇO', coefficient: 2, phase: 'g', display: 'üíß' },
                    { formula: 'SO‚ÇÇ', coefficient: 2, phase: 'g', display: 'üíõ' }
                ],

                deltaH: -1036,

                totalGasMoles: {
                    reactants: 5,
                    products: 4
                },

                description: 'Combustion of hydrogen sulfide, rotten egg smell.',
                descriptionIs: 'Brennsla vetisbrennsisteinss, lykt af rotnum eggjum.',

                possibleStresses: [
                    { type: 'add-reactant', target: 'H‚ÇÇS' },
                    { type: 'add-reactant', target: 'O‚ÇÇ' },
                    { type: 'add-product', target: 'H‚ÇÇO' },
                    { type: 'add-product', target: 'SO‚ÇÇ' },
                    { type: 'remove-reactant', target: 'H‚ÇÇS' },
                    { type: 'remove-product', target: 'SO‚ÇÇ' },
                    { type: 'increase-temp', target: null },
                    { type: 'decrease-temp', target: null },
                    { type: 'increase-pressure', target: null },
                    { type: 'decrease-pressure', target: null },
                    { type: 'add-catalyst', target: null }
                ]
            },
            {
                id: 21,
                equation: 'H‚ÇÇCO‚ÇÉ(aq) ‚áå H‚Å∫(aq) + HCO‚ÇÉ‚Åª(aq)',
                name: 'Carbonic Acid',
                nameIs: 'Kols√Ωra',
                difficulty: 'intermediate',

                reactants: [
                    { formula: 'H‚ÇÇCO‚ÇÉ', coefficient: 1, phase: 'aq', display: 'üíß‚ö´' }
                ],

                products: [
                    { formula: 'H‚Å∫', coefficient: 1, phase: 'aq', display: '‚äï' },
                    { formula: 'HCO‚ÇÉ‚Åª', coefficient: 1, phase: 'aq', display: '‚äñ' }
                ],

                deltaH: 10,

                totalGasMoles: {
                    reactants: 0,
                    products: 0
                },

                description: 'Carbonic acid in water, important in blood buffer system.',
                descriptionIs: 'Kols√Ωra √≠ vatni, mikilv√¶gt √≠ bl√≥√∞pufferkerfi.',

                possibleStresses: [
                    { type: 'add-reactant', target: 'H‚ÇÇCO‚ÇÉ' },
                    { type: 'add-product', target: 'H‚Å∫' },
                    { type: 'add-product', target: 'HCO‚ÇÉ‚Åª' },
                    { type: 'remove-reactant', target: 'H‚ÇÇCO‚ÇÉ' },
                    { type: 'remove-product', target: 'H‚Å∫' },
                    { type: 'increase-temp', target: null },
                    { type: 'decrease-temp', target: null },
                    { type: 'add-catalyst', target: null }
                ]
            },
            {
                id: 22,
                equation: 'Cu(NH‚ÇÉ)‚ÇÑ¬≤‚Å∫(aq) ‚áå Cu¬≤‚Å∫(aq) + 4NH‚ÇÉ(aq)',
                name: 'Copper Ammonia Complex',
                nameIs: 'Koparamm√≥n√≠akkomplexinn',
                difficulty: 'intermediate',

                reactants: [
                    { formula: 'Cu(NH‚ÇÉ)‚ÇÑ¬≤‚Å∫', coefficient: 1, phase: 'aq', display: 'üîµ' }
                ],

                products: [
                    { formula: 'Cu¬≤‚Å∫', coefficient: 1, phase: 'aq', display: 'üíô' },
                    { formula: 'NH‚ÇÉ', coefficient: 4, phase: 'aq', display: 'üî∑' }
                ],

                deltaH: 42,

                totalGasMoles: {
                    reactants: 0,
                    products: 0
                },

                description: 'Deep blue copper-ammonia complex, example of ligand exchange.',
                descriptionIs: 'Dj√∫pbl√°r koparamm√≥n√≠akkomplexinn, d√¶mi um ligandskipti.',

                possibleStresses: [
                    { type: 'add-reactant', target: 'Cu(NH‚ÇÉ)‚ÇÑ¬≤‚Å∫' },
                    { type: 'add-product', target: 'Cu¬≤‚Å∫' },
                    { type: 'add-product', target: 'NH‚ÇÉ' },
                    { type: 'remove-reactant', target: 'Cu(NH‚ÇÉ)‚ÇÑ¬≤‚Å∫' },
                    { type: 'remove-product', target: 'NH‚ÇÉ' },
                    { type: 'increase-temp', target: null },
                    { type: 'decrease-temp', target: null },
                    { type: 'add-catalyst', target: null }
                ]
            },

            // ============================================
            // ADVANCED LEVEL (8 Equilibria)
            // ============================================
            {
                id: 23,
                equation: '2C(s) + O‚ÇÇ(g) ‚áå 2CO(g)',
                name: 'Carbon Combustion',
                nameIs: 'Kolefnisbrennsla',
                difficulty: 'advanced',

                reactants: [
                    { formula: 'C', coefficient: 2, phase: 's', display: '‚ö´' },
                    { formula: 'O‚ÇÇ', coefficient: 1, phase: 'g', display: 'üî¥üî¥' }
                ],

                products: [
                    { formula: 'CO', coefficient: 2, phase: 'g', display: '‚ö´üî¥' }
                ],

                deltaH: -221,

                totalGasMoles: {
                    reactants: 1,
                    products: 2
                },

                description: 'Carbon combustion, first step in coupled reactions.',
                descriptionIs: 'Kolefnisbrennsla, fyrsta skref √≠ samtengdum hv√∂rfum.',

                possibleStresses: [
                    { type: 'add-reactant', target: 'O‚ÇÇ' },
                    { type: 'add-product', target: 'CO' },
                    { type: 'remove-reactant', target: 'O‚ÇÇ' },
                    { type: 'remove-product', target: 'CO' },
                    { type: 'increase-temp', target: null },
                    { type: 'decrease-temp', target: null },
                    { type: 'increase-pressure', target: null },
                    { type: 'decrease-pressure', target: null },
                    { type: 'add-catalyst', target: null }
                ]
            },
            {
                id: 24,
                equation: 'CH‚ÇÉCOOH(aq) + H‚ÇÇO(l) ‚áå CH‚ÇÉCOO‚Åª(aq) + H‚ÇÉO‚Å∫(aq)',
                name: 'Acetate Buffer System',
                nameIs: 'Ediks√Ωrupufferkerfi',
                difficulty: 'advanced',

                reactants: [
                    { formula: 'CH‚ÇÉCOOH', coefficient: 1, phase: 'aq', display: 'üß™' },
                    { formula: 'H‚ÇÇO', coefficient: 1, phase: 'l', display: 'üíß' }
                ],

                products: [
                    { formula: 'CH‚ÇÉCOO‚Åª', coefficient: 1, phase: 'aq', display: 'üß™‚Åª' },
                    { formula: 'H‚ÇÉO‚Å∫', coefficient: 1, phase: 'aq', display: '‚äï' }
                ],

                deltaH: 0,

                totalGasMoles: {
                    reactants: 0,
                    products: 0
                },

                description: 'Buffer system that maintains stable pH.',
                descriptionIs: 'Bufferkerfi sem vi√∞heldur pH st√∂√∞ugu.',

                possibleStresses: [
                    { type: 'add-reactant', target: 'CH‚ÇÉCOOH' },
                    { type: 'add-product', target: 'CH‚ÇÉCOO‚Åª' },
                    { type: 'add-product', target: 'H‚ÇÉO‚Å∫' },
                    { type: 'remove-product', target: 'H‚ÇÉO‚Å∫' },
                    { type: 'increase-temp', target: null },
                    { type: 'add-catalyst', target: null }
                ]
            },
            {
                id: 25,
                equation: 'N‚ÇÇ(g) + 3H‚ÇÇ(g) ‚áå 2NH‚ÇÉ(g) [K vs T]',
                name: 'Temperature-Dependent K',
                nameIs: 'Hitastig-h√°√∞ur K',
                difficulty: 'advanced',

                reactants: [
                    { formula: 'N‚ÇÇ', coefficient: 1, phase: 'g', display: 'üîµüîµ' },
                    { formula: 'H‚ÇÇ', coefficient: 3, phase: 'g', display: '‚ö™‚ö™' }
                ],

                products: [
                    { formula: 'NH‚ÇÉ', coefficient: 2, phase: 'g', display: 'üî∑' }
                ],

                deltaH: -92,

                totalGasMoles: {
                    reactants: 4,
                    products: 2
                },

                description: 'How equilibrium constant changes with temperature.',
                descriptionIs: 'Hvernig jafnv√¶gisfasti breytist me√∞ hitastigi.',

                possibleStresses: [
                    { type: 'add-reactant', target: 'N‚ÇÇ' },
                    { type: 'add-product', target: 'NH‚ÇÉ' },
                    { type: 'increase-temp', target: null },
                    { type: 'decrease-temp', target: null },
                    { type: 'increase-pressure', target: null },
                    { type: 'add-catalyst', target: null }
                ]
            },
            {
                id: 26,
                equation: 'N‚ÇÇ(g) + 3H‚ÇÇ(g) ‚áå 2NH‚ÇÉ(g) [Industrial]',
                name: 'Pressure-Dependent Industrial',
                nameIs: '√ûr√Ωstings-h√°√∞ur i√∞na√∞ur',
                difficulty: 'advanced',

                reactants: [
                    { formula: 'N‚ÇÇ', coefficient: 1, phase: 'g', display: 'üîµüîµ' },
                    { formula: 'H‚ÇÇ', coefficient: 3, phase: 'g', display: '‚ö™‚ö™' }
                ],

                products: [
                    { formula: 'NH‚ÇÉ', coefficient: 2, phase: 'g', display: 'üî∑' }
                ],

                deltaH: -92,

                totalGasMoles: {
                    reactants: 4,
                    products: 2
                },

                description: 'Real industrial optimization with trade-offs.',
                descriptionIs: 'Raunveruleg i√∞na√∞arbestun me√∞ m√≥ts√∂gnum.',

                possibleStresses: [
                    { type: 'add-reactant', target: 'N‚ÇÇ' },
                    { type: 'increase-temp', target: null },
                    { type: 'decrease-temp', target: null },
                    { type: 'increase-pressure', target: null },
                    { type: 'decrease-pressure', target: null },
                    { type: 'add-catalyst', target: null }
                ]
            },
            {
                id: 27,
                equation: 'H‚ÇÉPO‚ÇÑ(aq) ‚áå H‚Å∫(aq) + H‚ÇÇPO‚ÇÑ‚Åª(aq)',
                name: 'Phosphoric Acid (First Step)',
                nameIs: 'Fosf√≥rs√Ωra (fyrsta √ærep)',
                difficulty: 'advanced',

                reactants: [
                    { formula: 'H‚ÇÉPO‚ÇÑ', coefficient: 1, phase: 'aq', display: 'üî∂' }
                ],

                products: [
                    { formula: 'H‚Å∫', coefficient: 1, phase: 'aq', display: '‚äï' },
                    { formula: 'H‚ÇÇPO‚ÇÑ‚Åª', coefficient: 1, phase: 'aq', display: 'üî∂‚Åª' }
                ],

                deltaH: 15,

                totalGasMoles: {
                    reactants: 0,
                    products: 0
                },

                description: 'Stepwise deprotonation of phosphoric acid (first step).',
                descriptionIs: '√ûrepin deprotonun fosfors√Ωru (fyrsta √ærep).',

                possibleStresses: [
                    { type: 'add-reactant', target: 'H‚ÇÉPO‚ÇÑ' },
                    { type: 'add-product', target: 'H‚Å∫' },
                    { type: 'remove-product', target: 'H‚Å∫' },
                    { type: 'increase-temp', target: null },
                    { type: 'decrease-temp', target: null },
                    { type: 'add-catalyst', target: null }
                ]
            },
            {
                id: 28,
                equation: 'N‚ÇÇ(g) + 3H‚ÇÇ(g) ‚áå 2NH‚ÇÉ(g) [Catalyst]',
                name: 'Heterogeneous Catalysis',
                nameIs: '√ìl√≠kfasa hv√∂tunara√∞fer√∞',
                difficulty: 'advanced',

                reactants: [
                    { formula: 'N‚ÇÇ', coefficient: 1, phase: 'g', display: 'üîµüîµ' },
                    { formula: 'H‚ÇÇ', coefficient: 3, phase: 'g', display: '‚ö™‚ö™' }
                ],

                products: [
                    { formula: 'NH‚ÇÉ', coefficient: 2, phase: 'g', display: 'üî∑' }
                ],

                deltaH: -92,

                totalGasMoles: {
                    reactants: 4,
                    products: 2
                },

                description: 'How catalysts speed equilibrium without shifting it.',
                descriptionIs: 'Hvernig hvatar fl√Ωta fyrir jafnv√¶gi √°n √æess a√∞ hli√∞ra √æv√≠.',

                possibleStresses: [
                    { type: 'add-reactant', target: 'N‚ÇÇ' },
                    { type: 'add-product', target: 'NH‚ÇÉ' },
                    { type: 'increase-temp', target: null },
                    { type: 'increase-pressure', target: null },
                    { type: 'add-catalyst', target: null }
                ]
            },
            {
                id: 29,
                equation: 'Hb(aq) + 4O‚ÇÇ(g) ‚áå Hb(O‚ÇÇ)‚ÇÑ(aq)',
                name: 'Hemoglobin Oxygen Binding',
                nameIs: 'Hem√≥gl√≥b√≠ns√∫refnisbinding',
                difficulty: 'advanced',

                reactants: [
                    { formula: 'Hb', coefficient: 1, phase: 'aq', display: 'üî¥' },
                    { formula: 'O‚ÇÇ', coefficient: 4, phase: 'g', display: 'üî¥üî¥' }
                ],

                products: [
                    { formula: 'Hb(O‚ÇÇ)‚ÇÑ', coefficient: 1, phase: 'aq', display: 'ü©∏' }
                ],

                deltaH: -50,

                totalGasMoles: {
                    reactants: 4,
                    products: 0
                },

                description: 'Hemoglobin binding oxygen in blood.',
                descriptionIs: 'Hem√≥gl√≥b√≠n binding s√∫refnis √≠ bl√≥√∞i.',

                possibleStresses: [
                    { type: 'add-reactant', target: 'Hb' },
                    { type: 'add-reactant', target: 'O‚ÇÇ' },
                    { type: 'add-product', target: 'Hb(O‚ÇÇ)‚ÇÑ' },
                    { type: 'remove-reactant', target: 'O‚ÇÇ' },
                    { type: 'increase-temp', target: null },
                    { type: 'decrease-temp', target: null },
                    { type: 'increase-pressure', target: null },
                    { type: 'decrease-pressure', target: null },
                    { type: 'add-catalyst', target: null }
                ]
            },
            {
                id: 30,
                equation: '2SO‚ÇÇ(g) + O‚ÇÇ(g) ‚áå 2SO‚ÇÉ(g) [Optimization]',
                name: 'Industrial Optimization Problem',
                nameIs: 'I√∞na√∞arbestunarvandam√°l',
                difficulty: 'advanced',

                reactants: [
                    { formula: 'SO‚ÇÇ', coefficient: 2, phase: 'g', display: 'üíõ' },
                    { formula: 'O‚ÇÇ', coefficient: 1, phase: 'g', display: 'üî¥üî¥' }
                ],

                products: [
                    { formula: 'SO‚ÇÉ', coefficient: 2, phase: 'g', display: 'üü°' }
                ],

                deltaH: -198,

                totalGasMoles: {
                    reactants: 3,
                    products: 2
                },

                description: 'Real industrial decision-making with multiple variables.',
                descriptionIs: 'Raunveruleg i√∞na√∞ar√°kv√∂r√∞un me√∞ m√∂rgum breytum.',

                possibleStresses: [
                    { type: 'add-reactant', target: 'SO‚ÇÇ' },
                    { type: 'add-reactant', target: 'O‚ÇÇ' },
                    { type: 'increase-temp', target: null },
                    { type: 'decrease-temp', target: null },
                    { type: 'increase-pressure', target: null },
                    { type: 'decrease-pressure', target: null },
                    { type: 'add-catalyst', target: null }
                ]
            }
        ];

        // ============================================
        // MAIN GAME COMPONENT
        // ============================================

        const EquilibriumShifter = () => {
            const [gameState, setGameState] = useState({
                screen: 'menu',
                mode: null,
                currentEquilibriumIndex: 0,
                appliedStress: null,
                userPrediction: null,
                correctShift: null,
                showExplanation: false,
                animationState: 'balanced',
                feedbackClass: '',
                // Challenge Mode states
                score: 0,
                streak: 0,
                questionNumber: 0,
                totalQuestions: 10,
                timeLeft: 20,
                questionStartTime: null,
                correctCount: 0,
                incorrectCount: 0,
                bestStreak: 0,
                questionHistory: [],
                // Priority 3: Enhanced visuals
                soundEnabled: true,
            });

            const [timerInterval, setTimerInterval] = useState(null);

            const currentEquilibrium = EQUILIBRIUM_BANK[gameState.currentEquilibriumIndex];

            // ============================================
            // PRIORITY 3: SOUND EFFECTS
            // ============================================

            const playSound = (type) => {
                if (!gameState.soundEnabled) return;

                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();

                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);

                // Different frequencies for different sounds
                switch(type) {
                    case 'correct':
                        oscillator.frequency.setValueAtTime(523.25, audioContext.currentTime); // C5
                        oscillator.frequency.setValueAtTime(659.25, audioContext.currentTime + 0.1); // E5
                        oscillator.frequency.setValueAtTime(783.99, audioContext.currentTime + 0.2); // G5
                        gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
                        oscillator.start(audioContext.currentTime);
                        oscillator.stop(audioContext.currentTime + 0.5);
                        break;
                    case 'incorrect':
                        oscillator.frequency.setValueAtTime(200, audioContext.currentTime);
                        gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                        oscillator.start(audioContext.currentTime);
                        oscillator.stop(audioContext.currentTime + 0.3);
                        break;
                    case 'shift':
                        oscillator.frequency.setValueAtTime(440, audioContext.currentTime);
                        oscillator.frequency.exponentialRampToValueAtTime(880, audioContext.currentTime + 0.2);
                        gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                        oscillator.start(audioContext.currentTime);
                        oscillator.stop(audioContext.currentTime + 0.3);
                        break;
                    case 'click':
                        oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
                        gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
                        oscillator.start(audioContext.currentTime);
                        oscillator.stop(audioContext.currentTime + 0.1);
                        break;
                }
            };

            const toggleSound = () => {
                setGameState(prev => ({
                    ...prev,
                    soundEnabled: !prev.soundEnabled
                }));
                playSound('click');
            };

            // ============================================
            // PRIORITY 3: PARTICLE EFFECTS
            // ============================================

            const createConfetti = () => {
                const colors = ['#22c55e', '#3b82f6', '#f59e0b', '#ec4899', '#8b5cf6'];
                const confettiCount = 30;

                for (let i = 0; i < confettiCount; i++) {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti-particle';
                    confetti.style.left = `${Math.random() * 100}%`;
                    confetti.style.top = '0';
                    confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.animationDelay = `${Math.random() * 0.3}s`;
                    confetti.style.animationDuration = `${1.5 + Math.random() * 0.5}s`;

                    document.body.appendChild(confetti);

                    setTimeout(() => {
                        confetti.remove();
                    }, 2000);
                }
            };

            const createSparkles = (element) => {
                if (!element) return;

                const rect = element.getBoundingClientRect();
                const sparkleCount = 5;

                for (let i = 0; i < sparkleCount; i++) {
                    const sparkle = document.createElement('div');
                    sparkle.className = 'sparkle-effect';
                    sparkle.textContent = '‚ú®';
                    sparkle.style.left = `${rect.left + rect.width / 2}px`;
                    sparkle.style.top = `${rect.top + rect.height / 2}px`;
                    sparkle.style.animationDelay = `${i * 0.1}s`;

                    document.body.appendChild(sparkle);

                    setTimeout(() => {
                        sparkle.remove();
                    }, 1000);
                }
            };

            // ============================================
            // CHALLENGE MODE: Timer Management
            // ============================================

            useEffect(() => {
                if (gameState.mode === 'challenge' && gameState.screen === 'playing' &&
                    gameState.appliedStress && !gameState.userPrediction && gameState.timeLeft > 0) {

                    const interval = setInterval(() => {
                        setGameState(prev => {
                            if (prev.timeLeft <= 1) {
                                // Time's up! Auto-submit as timeout
                                handleTimeout();
                                return prev;
                            }
                            return {
                                ...prev,
                                timeLeft: prev.timeLeft - 1
                            };
                        });
                    }, 1000);

                    setTimerInterval(interval);
                    return () => clearInterval(interval);
                }
            }, [gameState.mode, gameState.screen, gameState.appliedStress, gameState.userPrediction, gameState.timeLeft]);

            const handleTimeout = () => {
                // Calculate correct answer
                const result = calculateShift(
                    currentEquilibrium,
                    gameState.appliedStress.type,
                    gameState.appliedStress.target
                );

                setGameState(prev => ({
                    ...prev,
                    userPrediction: 'timeout',
                    correctShift: result,
                    showExplanation: true,
                    animationState: result.shift === 'left' ? 'shifting-left' :
                                   result.shift === 'right' ? 'shifting-right' : 'no-shift',
                    feedbackClass: 'incorrect',
                    streak: 0, // Reset streak on timeout
                    incorrectCount: prev.incorrectCount + 1,
                    questionHistory: [...prev.questionHistory, {
                        equilibrium: currentEquilibrium.name,
                        correct: false,
                        timeout: true,
                        timeSpent: 20
                    }]
                }));
            };

            // ============================================
            // CHALLENGE MODE: Random Selection
            // ============================================

            const selectRandomEquilibrium = () => {
                return Math.floor(Math.random() * EQUILIBRIUM_BANK.length);
            };

            const selectRandomStress = (equilibrium) => {
                const stresses = equilibrium.possibleStresses;
                const randomStress = stresses[Math.floor(Math.random() * stresses.length)];
                return randomStress;
            };

            // ============================================
            // CHALLENGE MODE: Scoring
            // ============================================

            const calculatePoints = (difficulty, timeSpent, streak) => {
                let basePoints = 0;
                if (difficulty === 'beginner') basePoints = 10;
                else if (difficulty === 'intermediate') basePoints = 20;
                else if (difficulty === 'advanced') basePoints = 30;

                // Speed bonus if answered in < 10 seconds
                const speedBonus = timeSpent < 10 ? 5 : 0;

                // Streak bonus: +5, +10, +15, +20, +25 (max)
                const streakBonus = Math.min(streak * 5, 25);

                return basePoints + speedBonus + streakBonus;
            };

            const startGame = (mode) => {
                if (mode === 'challenge') {
                    // Challenge Mode: Start with random equilibrium and auto-apply stress
                    const randomIndex = selectRandomEquilibrium();
                    const randomEq = EQUILIBRIUM_BANK[randomIndex];
                    const randomStress = selectRandomStress(randomEq);

                    setGameState({
                        screen: 'playing',
                        mode: mode,
                        currentEquilibriumIndex: randomIndex,
                        appliedStress: { type: randomStress.type, target: randomStress.target },
                        userPrediction: null,
                        correctShift: null,
                        showExplanation: false,
                        animationState: 'balanced',
                        feedbackClass: '',
                        // Challenge Mode specific
                        score: 0,
                        streak: 0,
                        questionNumber: 1,
                        totalQuestions: 10,
                        timeLeft: 20,
                        questionStartTime: Date.now(),
                        correctCount: 0,
                        incorrectCount: 0,
                        bestStreak: 0,
                        questionHistory: [],
                    });
                } else {
                    // Learning Mode: No timer, no auto-stress
                    setGameState({
                        screen: 'playing',
                        mode: mode,
                        currentEquilibriumIndex: 0,
                        appliedStress: null,
                        userPrediction: null,
                        correctShift: null,
                        showExplanation: false,
                        animationState: 'balanced',
                        feedbackClass: '',
                        score: 0,
                        streak: 0,
                        questionNumber: 0,
                        totalQuestions: 10,
                        timeLeft: 20,
                        questionStartTime: null,
                        correctCount: 0,
                        incorrectCount: 0,
                        bestStreak: 0,
                        questionHistory: [],
                    });
                }
            };

            const applyStress = (stressType, stressTarget) => {
                setGameState(prev => ({
                    ...prev,
                    appliedStress: { type: stressType, target: stressTarget },
                    userPrediction: null,
                    showExplanation: false,
                    animationState: 'balanced',
                    feedbackClass: '',
                }));
            };

            const makePrediction = (prediction) => {
                const result = calculateShift(
                    currentEquilibrium,
                    gameState.appliedStress.type,
                    gameState.appliedStress.target
                );

                const isCorrect = result.shift === prediction;

                // Priority 3: Sound and visual effects
                if (isCorrect) {
                    playSound('correct');
                    createConfetti();
                } else {
                    playSound('incorrect');
                }
                playSound('shift');

                if (gameState.mode === 'challenge') {
                    // Challenge Mode: Calculate score and update statistics
                    const timeSpent = Math.floor((Date.now() - gameState.questionStartTime) / 1000);
                    const newStreak = isCorrect ? gameState.streak + 1 : 0;
                    const newBestStreak = Math.max(gameState.bestStreak, newStreak);

                    let pointsEarned = 0;
                    if (isCorrect) {
                        pointsEarned = calculatePoints(currentEquilibrium.difficulty, timeSpent, gameState.streak);
                    } else {
                        pointsEarned = -5; // Penalty for wrong answer
                    }

                    setGameState(prev => ({
                        ...prev,
                        userPrediction: prediction,
                        correctShift: result,
                        showExplanation: true,
                        animationState: result.shift === 'left' ? 'shifting-left' :
                                       result.shift === 'right' ? 'shifting-right' : 'no-shift',
                        feedbackClass: isCorrect ? 'correct' : 'incorrect',
                        score: prev.score + pointsEarned,
                        streak: newStreak,
                        bestStreak: newBestStreak,
                        correctCount: prev.correctCount + (isCorrect ? 1 : 0),
                        incorrectCount: prev.incorrectCount + (isCorrect ? 0 : 1),
                        questionHistory: [...prev.questionHistory, {
                            equilibrium: currentEquilibrium.name,
                            correct: isCorrect,
                            timeout: false,
                            timeSpent: timeSpent,
                            pointsEarned: pointsEarned
                        }]
                    }));
                } else {
                    // Learning Mode: Just show result
                    setGameState(prev => ({
                        ...prev,
                        userPrediction: prediction,
                        correctShift: result,
                        showExplanation: true,
                        animationState: result.shift === 'left' ? 'shifting-left' :
                                       result.shift === 'right' ? 'shifting-right' : 'no-shift',
                        feedbackClass: isCorrect ? 'correct' : 'incorrect',
                    }));
                }
            };

            const nextEquilibrium = () => {
                if (gameState.mode === 'challenge') {
                    // Check if we've completed all questions
                    if (gameState.questionNumber >= gameState.totalQuestions) {
                        // Game over! Show results
                        setGameState(prev => ({
                            ...prev,
                            screen: 'results'
                        }));
                        return;
                    }

                    // Move to next question
                    const randomIndex = selectRandomEquilibrium();
                    const randomEq = EQUILIBRIUM_BANK[randomIndex];
                    const randomStress = selectRandomStress(randomEq);

                    setGameState(prev => ({
                        ...prev,
                        currentEquilibriumIndex: randomIndex,
                        appliedStress: { type: randomStress.type, target: randomStress.target },
                        userPrediction: null,
                        correctShift: null,
                        showExplanation: false,
                        animationState: 'balanced',
                        feedbackClass: '',
                        questionNumber: prev.questionNumber + 1,
                        timeLeft: 20,
                        questionStartTime: Date.now(),
                    }));
                } else {
                    // Learning Mode: Just move to next equilibrium
                    setGameState(prev => ({
                        ...prev,
                        currentEquilibriumIndex: (prev.currentEquilibriumIndex + 1) % EQUILIBRIUM_BANK.length,
                        appliedStress: null,
                        userPrediction: null,
                        correctShift: null,
                        showExplanation: false,
                        animationState: 'balanced',
                        feedbackClass: '',
                    }));
                }
            };

            const tryAgain = () => {
                setGameState(prev => ({
                    ...prev,
                    userPrediction: null,
                    showExplanation: false,
                    animationState: 'balanced',
                    feedbackClass: '',
                }));
            };

            const backToMenu = () => {
                setGameState({
                    screen: 'menu',
                    mode: null,
                    currentEquilibriumIndex: 0,
                    appliedStress: null,
                    userPrediction: null,
                    correctShift: null,
                    showExplanation: false,
                    animationState: 'balanced',
                    feedbackClass: '',
                });
            };

            const showInstructions = () => {
                alert(`Le Chatelier's Principle - Jafnv√¶gisspil

Lei√∞beiningar / Instructions:

1. Veldu √°lag (stress) til a√∞ beita √° jafnv√¶gi
2. Forsp√°√∞u hvernig jafnv√¶gi√∞ mun hli√∞rast
3. F√°√∞u √∫tsk√Ωringu √° ni√∞urst√∂√∞unni

Le Chatelier reglan:
√ûegar √°lag er beitt √° kerfi √≠ jafnv√¶gi, hli√∞rast kerfi√∞ til a√∞ draga √∫r √°laginu.

When stress is applied to a system at equilibrium, the system shifts to relieve that stress.`);
            };

            // ============================================
            // RENDER: Menu Screen
            // ============================================

            if (gameState.screen === 'menu') {
                return (
                    <div>
                        <header className="site-header">
                            <div className="header-content">
                                <a href="https://kvenno.app" className="site-logo">Kvenno.app</a>
                                <div>
                                    <button className="header-btn" onClick={showInstructions}>
                                        {TRANSLATIONS.instructions}
                                    </button>
                                </div>
                            </div>
                        </header>

                        <nav className="nav-container">
                            <a href="https://kvenno.app/games" className="back-btn">
                                ‚Üê {TRANSLATIONS.back}
                            </a>
                        </nav>

                        <div className="max-w-4xl mx-auto px-4 py-8">
                            <div className="bg-white rounded-2xl shadow-xl p-8 text-center">
                                <h1 className="text-4xl md:text-5xl font-bold mb-4"
                                    style={{color: 'var(--kvenno-orange)'}}>
                                    Equilibrium Shifter
                                </h1>
                                <h2 className="text-2xl text-gray-600 mb-8">
                                    Le Chatelier - Jafnv√¶gishli√∞run
                                </h2>

                                <div className="text-6xl mb-6">‚öñÔ∏èüß™‚áå</div>

                                <p className="text-lg text-gray-700 mb-4 max-w-2xl mx-auto">
                                    L√¶ra um Le Chatelier's principle me√∞ gagnvirkum jafnv√¶gisspilum.
                                    Forsp√° hvernig jafnv√¶gi hli√∞rast √æegar √°lag er beitt!
                                </p>

                                <p className="text-base text-gray-600 mb-8">
                                    Learn Le Chatelier's principle with interactive equilibrium games.
                                    Predict how equilibrium shifts when stress is applied!
                                </p>

                                <div className="max-w-md mx-auto space-y-4">
                                    <button
                                        onClick={() => startGame('learning')}
                                        className="w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-6 px-8 rounded-xl text-xl transition-all transform hover:scale-105">
                                        üìö {TRANSLATIONS.learningMode}
                                        <div className="text-sm mt-2 opacity-90">
                                            √ìt√≠matakm√∂rku√∞ ‚Ä¢ √ötsk√Ωringar ‚Ä¢ √Üfa
                                        </div>
                                    </button>

                                    <button
                                        onClick={() => startGame('challenge')}
                                        className="w-full bg-gradient-to-r from-orange-500 to-red-500 hover:from-orange-600 hover:to-red-600 text-white font-bold py-6 px-8 rounded-xl text-xl transition-all transform hover:scale-105">
                                        üèÜ {TRANSLATIONS.challengeMode}
                                        <div className="text-sm mt-2 opacity-90">
                                            10 spurningar ‚Ä¢ 20 sek ‚Ä¢ Stigakerfi
                                        </div>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }

            // ============================================
            // RENDER: Playing Screen
            // ============================================

            if (gameState.screen === 'playing') {
                const eq = currentEquilibrium;
                const isCorrect = gameState.feedbackClass === 'correct';

                return (
                    <div>
                        <header className="site-header">
                            <div className="header-content">
                                <a href="https://kvenno.app" className="site-logo">Kvenno.app</a>
                                <div className="flex items-center gap-4">
                                    <button className="header-btn" onClick={showInstructions}>
                                        {TRANSLATIONS.instructions}
                                    </button>
                                    <button className="header-btn" onClick={backToMenu}>
                                        {TRANSLATIONS.back}
                                    </button>
                                </div>
                            </div>
                        </header>

                        <div className="max-w-6xl mx-auto px-4 py-8">
                            {/* Challenge Mode: Timer and Score Display */}
                            {gameState.mode === 'challenge' && (
                                <div className="bg-gradient-to-r from-orange-500 to-red-500 rounded-2xl shadow-xl p-6 mb-6 text-white">
                                    <div className="grid grid-cols-2 md:grid-cols-5 gap-4 text-center">
                                        <div>
                                            <div className="text-3xl font-bold">{gameState.questionNumber}/{gameState.totalQuestions}</div>
                                            <div className="text-sm opacity-90">Spurning / Question</div>
                                        </div>
                                        <div>
                                            <div className={`text-3xl font-bold ${gameState.timeLeft <= 5 ? 'animate-pulse' : ''}`}>
                                                {gameState.timeLeft}s
                                            </div>
                                            <div className="text-sm opacity-90">T√≠mi / Time</div>
                                        </div>
                                        <div>
                                            <div className="text-3xl font-bold">{gameState.score}</div>
                                            <div className="text-sm opacity-90">Stig / Points</div>
                                        </div>
                                        <div>
                                            <div className="text-3xl font-bold">üî• {gameState.streak}</div>
                                            <div className="text-sm opacity-90">R√°s / Streak</div>
                                        </div>
                                        <div>
                                            <div className="text-3xl font-bold">{gameState.correctCount}/{gameState.questionNumber - 1}</div>
                                            <div className="text-sm opacity-90">R√©tt / Correct</div>
                                        </div>
                                    </div>
                                </div>
                            )}

                            {/* Chemical Equation */}
                            <div className="bg-white rounded-2xl shadow-xl p-8 mb-6">
                                <div className="text-center mb-4">
                                    <div className="text-sm text-gray-500 mb-2">
                                        {gameState.mode === 'challenge' ? (
                                            `${TRANSLATIONS.question} ${gameState.questionNumber}`
                                        ) : (
                                            `Jafnv√¶gi ${gameState.currentEquilibriumIndex + 1} af ${EQUILIBRIUM_BANK.length}`
                                        )}
                                    </div>
                                    <h2 className="text-xl font-bold text-gray-800 mb-2">
                                        {eq.nameIs} / {eq.name}
                                    </h2>
                                    <div className="text-3xl font-bold text-gray-900 mb-4">
                                        {eq.equation}
                                    </div>
                                    <div className={`thermo-indicator thermo-indicator-enhanced ${eq.deltaH < 0 ? 'exothermic' : 'endothermic'}`}>
                                        <span className="text-2xl">{eq.deltaH < 0 ? 'üî•' : '‚ùÑÔ∏è'}</span>
                                        <span className="font-bold">ŒîH = {eq.deltaH > 0 ? '+' : ''}{eq.deltaH} kJ</span>
                                        <span className="opacity-90">
                                            ({eq.deltaH < 0 ? TRANSLATIONS.exothermic : TRANSLATIONS.endothermic})
                                        </span>
                                    </div>
                                    <p className="text-sm text-gray-600 mt-3">
                                        {eq.descriptionIs}
                                    </p>
                                </div>

                                {/* Visual Equilibrium Display */}
                                <div className="grid md:grid-cols-3 gap-4 items-center mt-6">
                                    <div className={`molecule-container reactants-side ${gameState.animationState === 'shifting-left' ? 'glowing' : ''}`}>
                                        {eq.reactants.map((reactant, idx) => (
                                            <div key={idx} className="text-center">
                                                <div className="molecule">{reactant.display}</div>
                                                <div className="text-sm font-semibold">{reactant.formula}</div>
                                            </div>
                                        ))}
                                    </div>

                                    <div className="text-center">
                                        <div className={`equilibrium-arrows ${gameState.animationState === 'shifting-right' ? 'shift-right' : gameState.animationState === 'shifting-left' ? 'shift-left' : gameState.animationState === 'no-shift' ? 'no-shift' : ''}`}>
                                            ‚áå
                                        </div>
                                    </div>

                                    <div className={`molecule-container products-side ${gameState.animationState === 'shifting-right' ? 'glowing' : ''}`}>
                                        {eq.products.map((product, idx) => (
                                            <div key={idx} className="text-center">
                                                <div className="molecule">{product.display}</div>
                                                <div className="text-sm font-semibold">{product.formula}</div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            </div>

                            {/* Stress Selection & Prediction */}
                            <div className={`grid ${gameState.mode === 'challenge' ? 'md:grid-cols-1' : 'md:grid-cols-2'} gap-6`}>
                                {/* Stress Buttons - Hidden in Challenge Mode */}
                                {gameState.mode !== 'challenge' && (
                                    <div className="bg-white rounded-2xl shadow-xl p-6">
                                        <h3 className="text-lg font-bold mb-4">{TRANSLATIONS.stress}:</h3>
                                    <div className="grid grid-cols-1 gap-3">
                                        {eq.possibleStresses.map((stress, idx) => {
                                            const isSelected = gameState.appliedStress &&
                                                             gameState.appliedStress.type === stress.type &&
                                                             gameState.appliedStress.target === stress.target;

                                            const label = stress.type === 'add-reactant' ? `‚ûï B√¶ta vi√∞ ${stress.target}` :
                                                         stress.type === 'add-product' ? `‚ûï B√¶ta vi√∞ ${stress.target}` :
                                                         stress.type === 'remove-reactant' ? `‚ûñ Fjarl√¶gja ${stress.target}` :
                                                         stress.type === 'remove-product' ? `‚ûñ Fjarl√¶gja ${stress.target}` :
                                                         stress.type === 'increase-temp' ? `üî• ${TRANSLATIONS.heat}` :
                                                         stress.type === 'decrease-temp' ? `‚ùÑÔ∏è ${TRANSLATIONS.cool}` :
                                                         stress.type === 'increase-pressure' ? `‚¨ÜÔ∏è ${TRANSLATIONS.increasePressure}` :
                                                         stress.type === 'decrease-pressure' ? `‚¨áÔ∏è ${TRANSLATIONS.decreasePressure}` :
                                                         stress.type === 'add-catalyst' ? `‚öóÔ∏è ${TRANSLATIONS.addCatalyst}` : '';

                                            return (
                                                <button
                                                    key={idx}
                                                    className={`stress-btn ${isSelected ? 'selected' : ''}`}
                                                    onClick={() => applyStress(stress.type, stress.target)}
                                                    disabled={gameState.userPrediction !== null}
                                                >
                                                    {label}
                                                </button>
                                            );
                                        })}
                                    </div>
                                    </div>
                                )}

                                {/* Prediction Buttons */}
                                <div className="bg-white rounded-2xl shadow-xl p-6">
                                    {gameState.mode === 'challenge' && gameState.appliedStress && (
                                        <div className="mb-4 p-4 bg-orange-100 rounded-lg border-2 border-orange-300">
                                            <h4 className="font-bold text-orange-900 mb-2">{TRANSLATIONS.appliedStress}:</h4>
                                            <p className="text-lg text-orange-800">
                                                {gameState.appliedStress.type === 'add-reactant' ? `‚ûï B√¶ta vi√∞ ${gameState.appliedStress.target}` :
                                                 gameState.appliedStress.type === 'add-product' ? `‚ûï B√¶ta vi√∞ ${gameState.appliedStress.target}` :
                                                 gameState.appliedStress.type === 'remove-reactant' ? `‚ûñ Fjarl√¶gja ${gameState.appliedStress.target}` :
                                                 gameState.appliedStress.type === 'remove-product' ? `‚ûñ Fjarl√¶gja ${gameState.appliedStress.target}` :
                                                 gameState.appliedStress.type === 'increase-temp' ? `üî• ${TRANSLATIONS.heat}` :
                                                 gameState.appliedStress.type === 'decrease-temp' ? `‚ùÑÔ∏è ${TRANSLATIONS.cool}` :
                                                 gameState.appliedStress.type === 'increase-pressure' ? `‚¨ÜÔ∏è ${TRANSLATIONS.increasePressure}` :
                                                 gameState.appliedStress.type === 'decrease-pressure' ? `‚¨áÔ∏è ${TRANSLATIONS.decreasePressure}` :
                                                 gameState.appliedStress.type === 'add-catalyst' ? `‚öóÔ∏è ${TRANSLATIONS.addCatalyst}` : ''}
                                            </p>
                                        </div>
                                    )}
                                    <h3 className="text-lg font-bold mb-4">{TRANSLATIONS.predict}:</h3>
                                    {!gameState.appliedStress ? (
                                        <div className="text-center py-12 text-gray-500">
                                            Veldu √°lag fyrst / Select a stress first
                                        </div>
                                    ) : (
                                        <div className="flex flex-col gap-4">
                                            <button
                                                className={`predict-btn left ${gameState.userPrediction === 'left' ? gameState.feedbackClass : ''}`}
                                                onClick={() => makePrediction('left')}
                                                disabled={gameState.userPrediction !== null}
                                            >
                                                ‚Üê {TRANSLATIONS.shiftLeft}
                                            </button>
                                            <button
                                                className={`predict-btn none ${gameState.userPrediction === 'none' ? gameState.feedbackClass : ''}`}
                                                onClick={() => makePrediction('none')}
                                                disabled={gameState.userPrediction !== null}
                                            >
                                                ‚öñÔ∏è {TRANSLATIONS.noShift}
                                            </button>
                                            <button
                                                className={`predict-btn right ${gameState.userPrediction === 'right' ? gameState.feedbackClass : ''}`}
                                                onClick={() => makePrediction('right')}
                                                disabled={gameState.userPrediction !== null}
                                            >
                                                {TRANSLATIONS.shiftRight} ‚Üí
                                            </button>
                                        </div>
                                    )}
                                </div>
                            </div>

                            {/* Explanation */}
                            {gameState.showExplanation && (
                                <div className={`explanation-box ${gameState.feedbackClass} slide-in-right`}>
                                    <h3 className="text-2xl font-bold mb-4">
                                        {isCorrect ? '‚úì ' + TRANSLATIONS.correct : '‚úó ' + TRANSLATIONS.incorrect}
                                    </h3>

                                    <div className="mb-4">
                                        <h4 className="font-bold text-lg mb-2">Le Chatelier's Principle:</h4>
                                        <p className="mb-3">{gameState.correctShift.explanationIs}</p>
                                        <p className="text-sm opacity-90">{gameState.correctShift.explanation}</p>
                                    </div>

                                    <div className="mb-4">
                                        <p className="font-bold">
                                            R√©tt svar / Correct answer:
                                            <span className="ml-2 text-xl">
                                                {gameState.correctShift.shift === 'left' ? '‚Üê ' + TRANSLATIONS.shiftLeft :
                                                 gameState.correctShift.shift === 'right' ? TRANSLATIONS.shiftRight + ' ‚Üí' :
                                                 '‚öñÔ∏è ' + TRANSLATIONS.noShift}
                                            </span>
                                        </p>
                                    </div>

                                    {gameState.mode === 'challenge' && gameState.userPrediction && gameState.userPrediction !== 'timeout' && (
                                        <div className="p-4 bg-blue-100 rounded-lg mb-4">
                                            <p className="font-bold text-blue-900">
                                                {isCorrect ? 'üéâ +' : '‚ùå '}
                                                {gameState.questionHistory[gameState.questionHistory.length - 1]?.pointsEarned || 0} stig
                                            </p>
                                            {isCorrect && gameState.streak > 1 && (
                                                <p className="text-sm text-blue-800">
                                                    üî• R√°s: {gameState.streak} r√©tt √≠ r√∂√∞!
                                                </p>
                                            )}
                                        </div>
                                    )}

                                    {gameState.mode === 'challenge' && gameState.userPrediction === 'timeout' && (
                                        <div className="p-4 bg-red-100 rounded-lg mb-4">
                                            <p className="font-bold text-red-900">
                                                ‚è±Ô∏è T√≠minn rann √∫t! R√°s endurstillt.
                                            </p>
                                        </div>
                                    )}

                                    <div className="flex gap-4 mt-6">
                                        {!isCorrect && gameState.mode !== 'challenge' && (
                                            <button
                                                onClick={tryAgain}
                                                className="flex-1 bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-6 rounded-lg transition-all"
                                            >
                                                {TRANSLATIONS.tryAgain}
                                            </button>
                                        )}
                                        <button
                                            onClick={nextEquilibrium}
                                            className="flex-1 bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-6 rounded-lg transition-all"
                                        >
                                            {gameState.mode === 'challenge' ?
                                                (gameState.questionNumber >= gameState.totalQuestions ?
                                                    TRANSLATIONS.showResults :
                                                    TRANSLATIONS.nextQuestion + ' ‚Üí')
                                                :
                                                TRANSLATIONS.nextEquilibrium + ' ‚Üí'
                                            }
                                        </button>
                                    </div>
                                </div>
                            )}
                        </div>

                        {/* Sound Toggle Button */}
                        <button
                            className={`sound-toggle ${!gameState.soundEnabled ? 'muted' : ''}`}
                            onClick={toggleSound}
                            title={gameState.soundEnabled ? 'Sl√∂kkva √° hlj√≥√∞i / Mute sound' : 'Kveikja √° hlj√≥√∞i / Enable sound'}
                        >
                            {gameState.soundEnabled ? 'üîä' : 'üîá'}
                        </button>
                    </div>
                );
            }

            // ============================================
            // RENDER: Results Screen
            // ============================================

            if (gameState.screen === 'results') {
                const totalTime = gameState.questionHistory.reduce((sum, q) => sum + q.timeSpent, 0);
                const avgTime = totalTime / gameState.totalQuestions;
                const accuracy = Math.round((gameState.correctCount / gameState.totalQuestions) * 100);

                return (
                    <div>
                        <header className="site-header">
                            <div className="header-content">
                                <a href="https://kvenno.app" className="site-logo">Kvenno.app</a>
                                <div>
                                    <button className="header-btn" onClick={backToMenu}>
                                        {TRANSLATIONS.back}
                                    </button>
                                </div>
                            </div>
                        </header>

                        <div className="max-w-4xl mx-auto px-4 py-8">
                            <div className="bg-white rounded-2xl shadow-xl p-8">
                                <div className="text-center mb-8">
                                    <h1 className="text-4xl font-bold mb-2" style={{color: 'var(--kvenno-orange)'}}>
                                        üèÜ Loka√∫rslit / Final Results
                                    </h1>
                                    <p className="text-gray-600">Challenge Mode loki√∞!</p>
                                </div>

                                {/* Main Score Display */}
                                <div className="bg-gradient-to-r from-orange-500 to-red-500 text-white rounded-2xl p-8 mb-8 text-center">
                                    <div className="text-6xl font-bold mb-2">{gameState.score}</div>
                                    <div className="text-2xl opacity-90">Heildarst ig / Total Points</div>
                                </div>

                                {/* Statistics Grid */}
                                <div className="grid md:grid-cols-3 gap-6 mb-8">
                                    <div className="bg-green-100 rounded-xl p-6 text-center">
                                        <div className="text-4xl font-bold text-green-800 mb-2">
                                            {gameState.correctCount}/{gameState.totalQuestions}
                                        </div>
                                        <div className="text-green-700 font-semibold">R√©ttar / Correct</div>
                                        <div className="text-green-600 text-sm mt-2">{accuracy}% n√°kv√¶mni</div>
                                    </div>

                                    <div className="bg-orange-100 rounded-xl p-6 text-center">
                                        <div className="text-4xl font-bold text-orange-800 mb-2">
                                            üî• {gameState.bestStreak}
                                        </div>
                                        <div className="text-orange-700 font-semibold">Besta r√°s / Best Streak</div>
                                        <div className="text-orange-600 text-sm mt-2">√ç r√∂√∞</div>
                                    </div>

                                    <div className="bg-blue-100 rounded-xl p-6 text-center">
                                        <div className="text-4xl font-bold text-blue-800 mb-2">
                                            {avgTime.toFixed(1)}s
                                        </div>
                                        <div className="text-blue-700 font-semibold">Me√∞alt√≠mi / Avg Time</div>
                                        <div className="text-blue-600 text-sm mt-2">Per question</div>
                                    </div>
                                </div>

                                {/* Performance Message */}
                                <div className="bg-gray-50 rounded-xl p-6 mb-8 text-center">
                                    <div className="text-2xl font-bold mb-2">
                                        {accuracy >= 90 ? 'üåü Fr√°b√¶rt! / Excellent!' :
                                         accuracy >= 70 ? 'üëç Vel gert! / Well Done!' :
                                         accuracy >= 50 ? 'üí™ G√≥√∞ tilraun! / Good Effort!' :
                                         'üìö Haltu √°fram a√∞ √¶fa! / Keep Practicing!'}
                                    </div>
                                    <p className="text-gray-700">
                                        {accuracy >= 90 ? '√û√∫ hefur n√°√∞ t√∂kum √° Le Chatelier\'s Principle!' :
                                         accuracy >= 70 ? 'Mj√∂g g√≥√∞ frammista√∞a! Haltu √°fram!' :
                                         accuracy >= 50 ? '√û√∫ ert √° r√©ttri lei√∞! Pr√≥fa√∞u aftur!' :
                                         'Lestu lei√∞beiningarnar og reyndu aftur!'}
                                    </p>
                                </div>

                                {/* Question History */}
                                <div className="mb-8">
                                    <h3 className="text-xl font-bold mb-4 text-center">
                                        Spurningayfirlit / Question History
                                    </h3>
                                    <div className="space-y-2">
                                        {gameState.questionHistory.map((question, idx) => (
                                            <div key={idx} className={`p-4 rounded-lg flex items-center justify-between ${
                                                question.correct ? 'bg-green-50 border-2 border-green-200' :
                                                question.timeout ? 'bg-gray-100 border-2 border-gray-300' :
                                                'bg-red-50 border-2 border-red-200'
                                            }`}>
                                                <div className="flex items-center gap-3">
                                                    <div className="text-2xl">
                                                        {question.correct ? '‚úì' : question.timeout ? '‚è±Ô∏è' : '‚úó'}
                                                    </div>
                                                    <div>
                                                        <div className="font-semibold">{idx + 1}. {question.equilibrium}</div>
                                                        <div className="text-sm text-gray-600">
                                                            {question.timeSpent}s
                                                            {question.timeout && ' (Timeout)'}
                                                        </div>
                                                    </div>
                                                </div>
                                                <div className={`font-bold text-lg ${
                                                    question.pointsEarned > 0 ? 'text-green-700' :
                                                    question.pointsEarned < 0 ? 'text-red-700' :
                                                    'text-gray-600'
                                                }`}>
                                                    {question.pointsEarned > 0 ? '+' : ''}{question.pointsEarned}
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>

                                {/* Action Buttons */}
                                <div className="flex gap-4">
                                    <button
                                        onClick={() => startGame('challenge')}
                                        className="flex-1 bg-gradient-to-r from-orange-500 to-red-500 hover:from-orange-600 hover:to-red-600 text-white font-bold py-4 px-8 rounded-xl text-lg transition-all transform hover:scale-105"
                                    >
                                        üîÑ Spila aftur / Play Again
                                    </button>
                                    <button
                                        onClick={backToMenu}
                                        className="flex-1 bg-gray-500 hover:bg-gray-600 text-white font-bold py-4 px-8 rounded-xl text-lg transition-all"
                                    >
                                        üè† A√∞alvalmynd / Main Menu
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }

            return null;
        };

        // ============================================
        // RENDER APP
        // ============================================

        ReactDOM.render(<EquilibriumShifter />, document.getElementById('root'));
    </script>
</body>
</html>
